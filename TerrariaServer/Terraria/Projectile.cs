using System;
using System.Collections.Generic;
using Microsoft.Xna.Framework;
using Microsoft.Xna.Framework.Audio;
using ReLogic.Utilities;
using Terraria.Audio;
using Terraria.Chat;
using Terraria.DataStructures;
using Terraria.Enums;
using Terraria.GameContent;
using Terraria.GameContent.Achievements;
using Terraria.GameContent.Drawing;
using Terraria.GameContent.Events;
using Terraria.GameContent.FishDropRules;
using Terraria.GameContent.Golf;
using Terraria.GameContent.Shaders;
using Terraria.GameContent.Tile_Entities;
using Terraria.GameContent.UI;
using Terraria.Graphics;
using Terraria.Graphics.Effects;
using Terraria.Graphics.Shaders;
using Terraria.ID;
using Terraria.Localization;
using Terraria.ObjectData;
using Terraria.Physics;
using Terraria.Testing;
using Terraria.Utilities;
using Terraria.WorldBuilding;

namespace Terraria;

public class Projectile : Entity
{
	private class NPCDistanceByIndexComparator : IComparer<Tuple<int, float>>
	{
		public int Compare(Tuple<int, float> npcIndex1, Tuple<int, float> npcIndex2)
		{
			return npcIndex1.Item2.CompareTo(npcIndex2.Item2);
		}
	}

	public struct HallowBossPelletStormInfo
	{
		public float StartAngle;

		public float AnglePerBullet;

		public int BulletsInStorm;

		public float BulletsProgressInStormStartNormalized;

		public float BulletsProgressInStormBonusByIndexNormalized;

		public float StormTotalRange;

		public Vector2 BulletSize;

		public float GetBulletProgress(int bulletIndex)
		{
			return BulletsProgressInStormStartNormalized + BulletsProgressInStormBonusByIndexNormalized * (float)bulletIndex;
		}

		public bool IsValid(int bulletIndex)
		{
			float bulletProgress = GetBulletProgress(bulletIndex);
			if (bulletProgress >= 0f)
			{
				return bulletProgress <= 1f;
			}
			return false;
		}

		public Vector2 GetBulletPosition(int bulletIndex, Vector2 centerPoint)
		{
			return centerPoint + Vector2.UnitX.RotatedBy(StartAngle + AnglePerBullet * (float)bulletIndex) * StormTotalRange * GetBulletProgress(bulletIndex);
		}

		public Rectangle GetBulletHitbox(int bulletIndex, Vector2 centerPoint)
		{
			return Utils.CenteredRectangle(GetBulletPosition(bulletIndex, centerPoint), BulletSize);
		}
	}

	public bool active;

	public static uint[][] perIDStaticNPCImmunity = new uint[ProjectileID.Count][];

	public const int SentryLifeTime = 36000;

	public const int ArrowLifeTime = 1200;

	public float ownerHitCheckDistance = 1000f;

	public bool arrow;

	public int numHits;

	public bool bobber;

	public bool netImportant;

	public bool noDropItem;

	public static int maxAI = 3;

	public bool counterweight;

	public float scale = 1f;

	public float rotation;

	public int type;

	public int alpha;

	public bool sentry;

	public short glowMask;

	public int owner = 255;

	public float[] ai = new float[maxAI];

	public float[] localAI = new float[maxAI];

	public float gfxOffY;

	public float stepSpeed = 1f;

	public int aiStyle;

	public int timeLeft;

	public int soundDelay;

	public int damage;

	public int originalDamage;

	public int spriteDirection = 1;

	public bool hostile;

	public bool reflected;

	public float knockBack;

	public bool friendly;

	public int penetrate = 1;

	public int[] localNPCImmunity = new int[Main.maxNPCs];

	public bool usesLocalNPCImmunity;

	public bool usesIDStaticNPCImmunity;

	public bool appliesImmunityTimeOnSingleHits;

	public int maxPenetrate = 1;

	public int identity;

	public float light;

	public bool netUpdate;

	public bool netUpdate2;

	public int netSpam;

	internal bool[] netSyncSkippedForPlayer = new bool[255];

	public Vector2[] oldPos = new Vector2[10];

	public float[] oldRot = new float[10];

	public int[] oldSpriteDirection = new int[10];

	public bool minion;

	public float minionSlots;

	public int minionPos;

	public int restrikeDelay;

	public bool tileCollide;

	public int extraUpdates;

	public bool stopsDealingDamageAfterPenetrateHits;

	public int numUpdates;

	public bool ignoreWater;

	public bool isAPreviewDummy;

	public bool isAPreviewDisplayDoll;

	public MinionSpawnInfo MinionSpawnInfo;

	public int drawLayer;

	public bool usesOwnerLight;

	public bool hide;

	public bool ownerHitCheck;

	public bool usesOwnerMeleeHitCD;

	public int[] playerImmune = new int[255];

	public string miscText = "";

	public bool melee;

	public bool ranged;

	public bool magic;

	public bool coldDamage;

	public bool noEnchantments;

	public bool noEnchantmentVisuals;

	public bool trap;

	public bool npcProj;

	public bool originatedFromActivableTile;

	public int frameCounter;

	public int frame;

	public bool manualDirectionChange;

	public int projUUID = -1;

	public bool correctSlopeCollision;

	public bool decidesManualFallThrough;

	public bool shouldFallThrough;

	public int localNPCHitCooldown = -2;

	public int idStaticNPCHitCooldown = -1;

	public int bannerIdToRespondTo;

	public int tagEffectType;

	public int bonusTagDamage;

	public int armorPenetration;

	public int bonusCritChance;

	public GameDifficultyData.LinearCurve hostileDamageScaling = GameDifficultyData.HostileProjectileDamageMultiplier;

	private static Conditions.IsSolid _cachedConditions_solid = new Conditions.IsSolid();

	private static Conditions.NotNull _cachedConditions_notNull = new Conditions.NotNull();

	private static Point[] _javelinsMax6 = new Point[6];

	private static Point[] _javelinsMax8 = new Point[8];

	private static Point[] _javelinsMax10 = new Point[10];

	private Vector2? _lightningLastHitChainPos;

	public List<Vector2> WhipPointsForCollision = new List<Vector2>();

	private static Rectangle _lanceHitboxBounds = new Rectangle(0, 0, 300, 300);

	private static MultiPointHitbox _lightningCollisionBounds;

	private static List<NPC> _rainbowBoulderTargetsAny = new List<NPC>();

	private static List<NPC> _rainbowBoulderTargetsFar = new List<NPC>();

	private static List<FishPossibilityEntry> _availableFishTypesToShow = new List<FishPossibilityEntry>();

	private static FishingContext _context = new FishingContext();

	public const int StormLightningLiquidDamageRadius = 500;

	private static List<Tuple<int, float>> _medusaHeadTargetList = new List<Tuple<int, float>>();

	private static NPCDistanceByIndexComparator _medusaTargetComparer = new NPCDistanceByIndexComparator();

	private static List<int> _ai164_blacklistedTargets = new List<int>();

	public static float kiteSoundPitch = 0f;

	public const float MinimumWindStrengthToFlyKite = 0.2f;

	private static List<int> _ai158_blacklistedTargets = new List<int>();

	private static List<Point> _miningHelperPointsToSkip = new List<Point>();

	private static List<int> _ai156_blacklistedTargets = new List<int>();

	private static float[] _CompanionCubeScreamCooldown = new float[255];

	public string Name => Lang.GetProjectileName(type).Value;

	public bool WipableTurret
	{
		get
		{
			if (owner == Main.myPlayer && sentry)
			{
				return !TurretShouldPersist();
			}
			return false;
		}
	}

	public float Opacity
	{
		get
		{
			return 1f - (float)alpha / 255f;
		}
		set
		{
			alpha = (int)MathHelper.Clamp((1f - value) * 255f, 0f, 255f);
		}
	}

	public int MaxUpdates
	{
		get
		{
			return extraUpdates + 1;
		}
		set
		{
			extraUpdates = value - 1;
		}
	}

	public NPC OwnerMinionAttackTargetNPC
	{
		get
		{
			if (Main.player[owner].MinionAttackTargetNPC < 0)
			{
				return null;
			}
			return Main.npc[Main.player[owner].MinionAttackTargetNPC];
		}
	}

	public bool OwnedBySomeone
	{
		get
		{
			if (!npcProj)
			{
				return !trap;
			}
			return false;
		}
	}

	public bool CareForAttackCD
	{
		get
		{
			if (usesOwnerMeleeHitCD && OwnedBySomeone)
			{
				return owner < 255;
			}
			return false;
		}
	}

	public Point NetSectionCoordinates => new Point(Netplay.GetSectionX((int)position.X >> 4), Netplay.GetSectionY((int)position.Y >> 4));

	public static void InitializeStaticThings()
	{
		perIDStaticNPCImmunity = new uint[ProjectileID.Count][];
		for (int i = 0; i < perIDStaticNPCImmunity.Length; i++)
		{
			perIDStaticNPCImmunity[i] = new uint[Main.maxNPCs];
		}
	}

	public static bool IsNPCIndexImmuneToProjectileType(int projectileType, int npcIndex)
	{
		return perIDStaticNPCImmunity[projectileType][npcIndex] <= Main.GameUpdateCount;
	}

	public static void ResetNPCSlotData(int npcIndex)
	{
		for (int i = 0; i < ProjectileID.Count; i++)
		{
			perIDStaticNPCImmunity[i][npcIndex] = 0u;
		}
		for (int j = 0; j < 1000; j++)
		{
			Main.projectile[j].localNPCImmunity[npcIndex] = 0;
		}
	}

	public bool TurretShouldPersist()
	{
		switch (type)
		{
		case 663:
		case 665:
		case 667:
		case 677:
		case 678:
		case 679:
		case 688:
		case 689:
		case 690:
		case 691:
		case 692:
		case 693:
			return DD2Event.Ongoing;
		default:
			return false;
		}
	}

	public void SetDefaults(int Type)
	{
		ownerHitCheckDistance = 1000f;
		counterweight = false;
		sentry = false;
		arrow = false;
		bobber = false;
		numHits = 0;
		netImportant = false;
		manualDirectionChange = false;
		correctSlopeCollision = Main.projPet[Type];
		decidesManualFallThrough = false;
		shouldFallThrough = false;
		bannerIdToRespondTo = 0;
		stopsDealingDamageAfterPenetrateHits = false;
		localNPCHitCooldown = -2;
		idStaticNPCHitCooldown = -1;
		usesLocalNPCImmunity = false;
		usesIDStaticNPCImmunity = false;
		usesOwnerMeleeHitCD = false;
		appliesImmunityTimeOnSingleHits = false;
		int num = 10;
		if (Type >= 0)
		{
			num = ProjectileID.Sets.TrailCacheLength[Type];
		}
		if (num != oldPos.Length)
		{
			Array.Resize(ref oldPos, num);
			Array.Resize(ref oldRot, num);
			Array.Resize(ref oldSpriteDirection, num);
		}
		for (int i = 0; i < oldPos.Length; i++)
		{
			oldPos[i].X = 0f;
			oldPos[i].Y = 0f;
			oldRot[i] = 0f;
			oldSpriteDirection[i] = 0;
		}
		for (int j = 0; j < maxAI; j++)
		{
			ai[j] = 0f;
			localAI[j] = 0f;
		}
		for (int k = 0; k < 255; k++)
		{
			playerImmune[k] = 0;
		}
		ResetLocalNPCHitImmunity();
		noDropItem = false;
		minion = false;
		minionSlots = 0f;
		soundDelay = 0;
		spriteDirection = 1;
		melee = false;
		ranged = false;
		magic = false;
		ownerHitCheck = false;
		drawLayer = 0;
		usesOwnerLight = false;
		hide = false;
		lavaWet = false;
		wetCount = 0;
		wet = false;
		ignoreWater = false;
		isAPreviewDummy = false;
		isAPreviewDisplayDoll = false;
		hostile = false;
		reflected = false;
		netUpdate = false;
		netUpdate2 = false;
		netSpam = 0;
		Array.Clear(netSyncSkippedForPlayer, 0, netSyncSkippedForPlayer.Length);
		numUpdates = 0;
		extraUpdates = 0;
		identity = 0;
		restrikeDelay = 0;
		light = 0f;
		penetrate = 1;
		tileCollide = true;
		position = Vector2.Zero;
		velocity = Vector2.Zero;
		aiStyle = 0;
		alpha = 0;
		glowMask = -1;
		type = Type;
		active = Type != 0;
		rotation = 0f;
		scale = 1f;
		owner = 255;
		timeLeft = 3600;
		friendly = false;
		damage = 0;
		originalDamage = 0;
		knockBack = 0f;
		miscText = "";
		coldDamage = false;
		noEnchantments = false;
		noEnchantmentVisuals = false;
		trap = false;
		npcProj = false;
		originatedFromActivableTile = false;
		MinionSpawnInfo = null;
		projUUID = -1;
		tagEffectType = 0;
		bonusTagDamage = 0;
		armorPenetration = 0;
		bonusCritChance = 0;
		hostileDamageScaling = GameDifficultyData.HostileProjectileDamageMultiplier;
		frame = 0;
		frameCounter = 0;
		if (type == 1)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			timeLeft = 1200;
		}
		else if (type == 2)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			light = 1f;
			ranged = true;
			timeLeft = 1200;
		}
		else if (type == 3)
		{
			width = 22;
			height = 22;
			aiStyle = 2;
			friendly = true;
			penetrate = 4;
			ranged = true;
		}
		else if (type == 4)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			light = 0.35f;
			penetrate = 5;
			ranged = true;
			timeLeft = 1200;
		}
		else if (type == 5)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			light = 0.4f;
			penetrate = -1;
			alpha = 100;
			ignoreWater = true;
			ranged = true;
			extraUpdates = 1;
			timeLeft = 120;
		}
		else if (type == 6)
		{
			width = 22;
			height = 22;
			aiStyle = 3;
			friendly = true;
			penetrate = -1;
			melee = true;
			light = 0.4f;
		}
		else if (type == 7 || type == 8)
		{
			width = 28;
			height = 28;
			aiStyle = 4;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			alpha = 255;
			ignoreWater = true;
			magic = true;
		}
		else if (type == 9)
		{
			width = 24;
			height = 24;
			aiStyle = 5;
			friendly = true;
			penetrate = 2;
			scale = 0.8f;
			tileCollide = false;
			melee = true;
		}
		else if (type == 10)
		{
			width = 64;
			height = 64;
			aiStyle = 6;
			friendly = true;
			tileCollide = false;
			penetrate = -1;
			alpha = 255;
			ignoreWater = true;
			if (Main.infectedSeed)
			{
				width += width / 3 * 2;
				height += height / 3 * 2;
			}
		}
		else if (type == 11)
		{
			width = 64;
			height = 64;
			aiStyle = 6;
			friendly = true;
			tileCollide = false;
			penetrate = -1;
			alpha = 255;
			ignoreWater = true;
		}
		else if (type == 12)
		{
			width = 18;
			height = 18;
			aiStyle = 5;
			if (Main.remixWorld)
			{
				hostile = true;
			}
			friendly = true;
			penetrate = -1;
			alpha = 50;
			light = 1f;
			trap = true;
		}
		else if (type == 13)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
		}
		else if (type == 14)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 1;
			light = 0.5f;
			alpha = 255;
			scale = 1.2f;
			timeLeft = 600;
			ranged = true;
			extraUpdates = 1;
		}
		else if (type == 15)
		{
			width = 16;
			height = 16;
			aiStyle = 8;
			friendly = true;
			light = 0.8f;
			alpha = 100;
			magic = true;
		}
		else if (type == 16)
		{
			width = 32;
			height = 32;
			aiStyle = 9;
			friendly = true;
			light = 0.8f;
			alpha = 100;
			magic = true;
			ignoreWater = true;
		}
		else if (type == 17)
		{
			width = 10;
			height = 10;
			aiStyle = 10;
			friendly = true;
			ignoreWater = true;
		}
		else if (type == 18)
		{
			netImportant = true;
			width = 32;
			height = 32;
			aiStyle = 11;
			friendly = true;
			light = 0.9f;
			alpha = 150;
			tileCollide = false;
			penetrate = -1;
			timeLeft *= 5;
			ignoreWater = true;
			scale = 0.8f;
		}
		else if (type == 19)
		{
			width = 22;
			height = 22;
			aiStyle = 3;
			friendly = true;
			penetrate = -1;
			light = 1f;
			melee = true;
		}
		else if (type == 20)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 3;
			light = 0.75f;
			extraUpdates = 2;
			scale = 0.65f;
			timeLeft = 600;
			magic = true;
		}
		else if (type == 21)
		{
			width = 16;
			height = 16;
			aiStyle = 2;
			scale = 1.2f;
			friendly = true;
			ranged = true;
		}
		else if (type == 22)
		{
			width = 18;
			height = 18;
			aiStyle = 12;
			friendly = true;
			alpha = 255;
			penetrate = 5;
			extraUpdates = 2;
			ignoreWater = true;
			magic = true;
			if (Main.remixWorld)
			{
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 12;
			}
		}
		else if (type == 23)
		{
			width = 4;
			height = 4;
			aiStyle = 13;
			friendly = true;
			penetrate = 3;
			alpha = 255;
			ranged = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 12;
		}
		else if (type == 24)
		{
			width = 14;
			height = 14;
			aiStyle = 14;
			friendly = true;
			penetrate = 7;
			timeLeft = 4800;
			ranged = true;
		}
		else if (type == 25)
		{
			netImportant = true;
			width = 22;
			height = 22;
			scale = 0.9f;
			DefaultToFlail();
		}
		else if (type == 26)
		{
			netImportant = true;
			width = 22;
			height = 22;
			scale = 0.8f;
			DefaultToFlail();
		}
		else if (type == 27)
		{
			width = 16;
			height = 16;
			aiStyle = 8;
			friendly = true;
			alpha = 255;
			timeLeft /= 2;
			penetrate = 10;
			magic = true;
		}
		else if (type == 28)
		{
			width = 22;
			height = 22;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
		}
		else if (type == 29)
		{
			width = 10;
			height = 10;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
		}
		else if (type == 30)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 31)
		{
			knockBack = 6f;
			width = 10;
			height = 10;
			aiStyle = 10;
			friendly = true;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 32)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
		}
		else if (type == 33)
		{
			width = 38;
			height = 38;
			aiStyle = 3;
			friendly = true;
			scale = 0.9f;
			penetrate = -1;
			melee = true;
		}
		else if (type == 34)
		{
			width = 32;
			height = 32;
			aiStyle = 9;
			friendly = true;
			light = 0.8f;
			penetrate = 2;
			magic = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 12;
		}
		else if (type == 35)
		{
			netImportant = true;
			width = 22;
			height = 22;
			scale = 0.8f;
			DefaultToFlail();
		}
		else if (type == 36)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 2;
			light = 0.6f;
			alpha = 255;
			scale = 1.4f;
			timeLeft = 600;
			ranged = true;
			extraUpdates = 1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 7;
		}
		else if (type == 37)
		{
			width = 22;
			height = 22;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
		}
		else if (type == 38)
		{
			width = 14;
			height = 14;
			aiStyle = 0;
			hostile = true;
			penetrate = -1;
			aiStyle = 1;
			tileCollide = true;
		}
		else if (type == 39)
		{
			knockBack = 6f;
			width = 10;
			height = 10;
			aiStyle = 10;
			friendly = true;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 40)
		{
			knockBack = 6f;
			width = 10;
			height = 10;
			aiStyle = 10;
			friendly = true;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 41)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			penetrate = -1;
			ranged = true;
			light = 0.3f;
		}
		else if (type == 42)
		{
			knockBack = 8f;
			width = 10;
			height = 10;
			aiStyle = 10;
			ranged = true;
			friendly = true;
			extraUpdates = 1;
		}
		else if (type == 43)
		{
			knockBack = 12f;
			width = 24;
			height = 24;
			aiStyle = 17;
			penetrate = -1;
			if (Main.getGoodWorld)
			{
				friendly = true;
				hostile = true;
			}
		}
		else if (type == 44)
		{
			width = 48;
			height = 48;
			alpha = 100;
			light = 0.2f;
			aiStyle = 18;
			hostile = true;
			penetrate = -1;
			tileCollide = true;
			scale = 0.9f;
		}
		else if (type == 45)
		{
			width = 48;
			height = 48;
			alpha = 100;
			light = 0.2f;
			aiStyle = 18;
			friendly = true;
			penetrate = 5;
			tileCollide = true;
			scale = 0.9f;
			magic = true;
		}
		else if (type == 46)
		{
			width = 20;
			height = 20;
			DefaultToSpear();
			scale = 1.1f;
		}
		else if (type == 47)
		{
			width = 18;
			height = 18;
			scale = 1.1f;
			DefaultToSpear();
		}
		else if (type == 48)
		{
			width = 12;
			height = 12;
			aiStyle = 2;
			friendly = true;
			penetrate = 2;
			ranged = true;
		}
		else if (type == 49)
		{
			width = 18;
			height = 18;
			scale = 1.2f;
			DefaultToSpear();
		}
		else if (type == 50)
		{
			netImportant = true;
			width = 6;
			height = 6;
			aiStyle = 14;
			penetrate = -1;
			alpha = 75;
			light = 1f;
			timeLeft *= 5;
		}
		else if (type == 51)
		{
			width = 8;
			height = 8;
			aiStyle = 1;
			ranged = true;
			friendly = true;
		}
		else if (type == 52)
		{
			width = 22;
			height = 22;
			aiStyle = 3;
			friendly = true;
			penetrate = -1;
			melee = true;
		}
		else if (type == 53)
		{
			netImportant = true;
			width = 6;
			height = 6;
			aiStyle = 14;
			penetrate = -1;
			alpha = 75;
			light = 1f;
			timeLeft *= 5;
			tileCollide = false;
		}
		else if (type == 54)
		{
			width = 12;
			height = 12;
			aiStyle = 2;
			friendly = true;
			penetrate = 2;
			ranged = true;
		}
		else if (type == 55)
		{
			width = 10;
			height = 10;
			aiStyle = 0;
			hostile = true;
			penetrate = -1;
			aiStyle = 1;
			tileCollide = true;
		}
		else if (type == 56)
		{
			knockBack = 6f;
			width = 10;
			height = 10;
			aiStyle = 10;
			friendly = true;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 57)
		{
			width = 18;
			height = 18;
			DefaultToDrillOrChainsaw();
		}
		else if (type == 58)
		{
			width = 18;
			height = 18;
			DefaultToDrillOrChainsaw();
			scale = 1.08f;
		}
		else if (type == 59)
		{
			width = 22;
			height = 22;
			DefaultToDrillOrChainsaw();
			scale = 0.9f;
		}
		else if (type == 60)
		{
			width = 22;
			height = 22;
			DefaultToDrillOrChainsaw();
			scale = 0.9f;
		}
		else if (type == 61)
		{
			width = 18;
			height = 18;
			DefaultToDrillOrChainsaw();
			scale = 1.16f;
		}
		else if (type == 62)
		{
			width = 22;
			height = 22;
			DefaultToDrillOrChainsaw();
			scale = 0.9f;
		}
		else if (type == 63)
		{
			netImportant = true;
			width = 22;
			height = 22;
			DefaultToFlail();
		}
		else if (type == 64)
		{
			width = 18;
			height = 18;
			scale = 1.25f;
			DefaultToSpear();
		}
		else if (type == 65)
		{
			knockBack = 6f;
			width = 10;
			height = 10;
			aiStyle = 10;
			friendly = true;
			ranged = true;
			penetrate = -1;
			extraUpdates = 1;
		}
		else if (type == 66)
		{
			width = 18;
			height = 18;
			scale = 1.27f;
			DefaultToSpear();
		}
		else if (type == 67)
		{
			knockBack = 6f;
			width = 10;
			height = 10;
			aiStyle = 10;
			friendly = true;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 68)
		{
			knockBack = 6f;
			width = 10;
			height = 10;
			aiStyle = 10;
			friendly = true;
			ranged = true;
			penetrate = -1;
			extraUpdates = 1;
		}
		else if (type == 69)
		{
			width = 14;
			height = 14;
			aiStyle = 2;
			friendly = true;
			penetrate = 1;
		}
		else if (type == 70)
		{
			width = 14;
			height = 14;
			aiStyle = 2;
			friendly = true;
			penetrate = 1;
		}
		else if (type == 621)
		{
			width = 14;
			height = 14;
			aiStyle = 2;
			friendly = true;
			penetrate = 1;
		}
		else if (type == 71)
		{
			knockBack = 6f;
			width = 10;
			height = 10;
			aiStyle = 10;
			friendly = true;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 72)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 11;
			friendly = true;
			light = 0.9f;
			tileCollide = false;
			penetrate = -1;
			timeLeft *= 5;
			ignoreWater = true;
			scale = 0.8f;
		}
		else if (type == 73 || type == 74)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
			light = 0.4f;
		}
		else if (type == 75)
		{
			width = 22;
			height = 22;
			aiStyle = 16;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 76 || type == 77 || type == 78)
		{
			if (type == 76)
			{
				width = 10;
				height = 22;
			}
			else if (type == 77)
			{
				width = 18;
				height = 24;
			}
			else
			{
				width = 22;
				height = 24;
			}
			aiStyle = 21;
			friendly = true;
			alpha = 100;
			light = 0.3f;
			penetrate = -1;
			timeLeft = 180;
			magic = true;
		}
		else if (type == 79)
		{
			width = 32;
			height = 32;
			aiStyle = 9;
			friendly = true;
			light = 0.8f;
			magic = true;
			penetrate = 3;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 12;
			ignoreWater = true;
		}
		else if (type == 80)
		{
			width = 16;
			height = 16;
			aiStyle = 22;
			friendly = true;
			magic = true;
			tileCollide = false;
			light = 0.5f;
			coldDamage = true;
		}
		else if (type == 81)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			hostile = true;
		}
		else if (type == 82)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			hostile = true;
		}
		else if (type == 83)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			hostile = true;
			penetrate = 3;
			light = 0.75f;
			alpha = 255;
			extraUpdates = 2;
			scale = 1.7f;
			timeLeft = 600;
			magic = true;
		}
		else if (type == 84)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			hostile = true;
			penetrate = 3;
			light = 0.75f;
			alpha = 255;
			extraUpdates = 2;
			scale = 1.2f;
			timeLeft = 600;
			magic = true;
		}
		else if (type == 85)
		{
			width = 6;
			height = 6;
			aiStyle = 193;
			friendly = true;
			alpha = 255;
			penetrate = 4;
			extraUpdates = 2;
			ranged = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			armorPenetration = 15;
		}
		else if (type == 86)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 11;
			friendly = true;
			light = 0.9f;
			tileCollide = false;
			penetrate = -1;
			timeLeft *= 5;
			ignoreWater = true;
			scale = 0.8f;
		}
		else if (type == 87)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 11;
			friendly = true;
			light = 0.9f;
			tileCollide = false;
			penetrate = -1;
			timeLeft *= 5;
			ignoreWater = true;
			scale = 0.8f;
		}
		else if (type == 88)
		{
			width = 6;
			height = 6;
			aiStyle = 1;
			friendly = true;
			penetrate = 3;
			light = 0.75f;
			extraUpdates = 4;
			scale = 0.65f;
			timeLeft = 600;
			magic = true;
		}
		else if (type == 89)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 1;
			light = 0.5f;
			alpha = 255;
			scale = 1.2f;
			timeLeft = 600;
			ranged = true;
			extraUpdates = 1;
		}
		else if (type == 90)
		{
			width = 6;
			height = 6;
			aiStyle = 24;
			friendly = true;
			penetrate = 1;
			light = 0.5f;
			alpha = 50;
			scale = 1.2f;
			timeLeft = 600;
			ranged = true;
			tileCollide = false;
		}
		else if (type == 91)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			timeLeft = 1200;
		}
		else if (type == 92)
		{
			width = 24;
			height = 24;
			aiStyle = 5;
			friendly = true;
			penetrate = 1;
			alpha = 50;
			scale = 0.8f;
			tileCollide = false;
			ranged = true;
		}
		else if (type == 93)
		{
			light = 0.15f;
			width = 12;
			height = 12;
			aiStyle = 2;
			friendly = true;
			penetrate = 3;
			magic = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 20;
		}
		else if (type == 94)
		{
			ignoreWater = true;
			width = 8;
			height = 8;
			aiStyle = 24;
			friendly = true;
			light = 0.5f;
			alpha = 50;
			scale = 1.2f;
			timeLeft = 600;
			magic = true;
			tileCollide = true;
			penetrate = 1;
		}
		else if (type == 95)
		{
			width = 16;
			height = 16;
			aiStyle = 8;
			friendly = true;
			light = 0.8f;
			alpha = 100;
			magic = true;
			penetrate = 2;
		}
		else if (type == 96)
		{
			width = 16;
			height = 16;
			aiStyle = 8;
			hostile = true;
			light = 0.8f;
			alpha = 100;
			magic = true;
			penetrate = -1;
			scale = 0.9f;
			scale = 1.3f;
		}
		else if (type == 97)
		{
			width = 18;
			scale = 1.1f;
			height = 18;
			DefaultToSpear();
		}
		else if (type == 98)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			hostile = true;
			penetrate = -1;
			trap = true;
		}
		else if (type == 99 || type == 727 || type == 1013 || type == 1014 || type == 1053 || type == 1054 || type == 1055 || type == 1057)
		{
			width = 31;
			height = 31;
			aiStyle = 25;
			friendly = true;
			hostile = true;
			penetrate = -1;
			trap = true;
			if (type == 1054)
			{
				timeLeft = 300;
			}
			if (type == 1055)
			{
				timeLeft = 900;
			}
		}
		else if (type == 1005)
		{
			width = 15;
			height = 15;
			aiStyle = 25;
			friendly = true;
			hostile = true;
			penetrate = -1;
			trap = true;
		}
		else if (type == 1021)
		{
			width = 31;
			height = 31;
			aiStyle = 25;
			hostile = true;
			penetrate = -1;
			extraUpdates = 1;
			timeLeft *= 3;
		}
		else if (type == 100)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			hostile = true;
			penetrate = 3;
			light = 0.75f;
			alpha = 255;
			extraUpdates = 2;
			scale = 1.8f;
			timeLeft = 2700;
			magic = true;
		}
		else if (type == 101)
		{
			width = 6;
			height = 6;
			aiStyle = 23;
			hostile = true;
			alpha = 255;
			penetrate = -1;
			extraUpdates = 3;
			magic = true;
		}
		else if (type == 102)
		{
			width = 22;
			height = 22;
			aiStyle = 16;
			hostile = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 103)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			light = 1f;
			ranged = true;
			timeLeft = 1200;
		}
		else if (type == 104)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 1;
			light = 0.5f;
			alpha = 255;
			scale = 1.2f;
			timeLeft = 600;
			ranged = true;
			extraUpdates = 2;
		}
		else if (type == 105)
		{
			width = 18;
			height = 18;
			scale = 1.3f;
			DefaultToSpear();
		}
		else if (type == 106)
		{
			width = 32;
			height = 32;
			aiStyle = 3;
			friendly = true;
			penetrate = -1;
			melee = true;
			light = 0.4f;
		}
		else if (type == 107)
		{
			width = 22;
			height = 22;
			DefaultToDrillOrChainsaw();
			scale = 1.1f;
		}
		else if (type == 108)
		{
			width = 260;
			height = 260;
			aiStyle = 16;
			friendly = true;
			hostile = true;
			penetrate = -1;
			tileCollide = false;
			alpha = 255;
			timeLeft = 2;
			trap = true;
		}
		else if (type == 109)
		{
			knockBack = 6f;
			width = 10;
			height = 10;
			aiStyle = 10;
			hostile = true;
			scale = 0.9f;
			penetrate = -1;
			coldDamage = true;
			ranged = true;
		}
		else if (type == 110)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			hostile = true;
			penetrate = -1;
			light = 0.5f;
			alpha = 255;
			scale = 1.2f;
			timeLeft = 600;
			ranged = true;
			extraUpdates = 1;
		}
		else if (type == 111)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 112)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 113)
		{
			width = 22;
			height = 22;
			aiStyle = 3;
			friendly = true;
			penetrate = -1;
			melee = true;
			light = 0.4f;
			coldDamage = true;
		}
		else if (type == 114)
		{
			width = 16;
			height = 16;
			aiStyle = 27;
			magic = true;
			penetrate = 3;
			light = 0.5f;
			alpha = 255;
			friendly = true;
		}
		else if (type == 115)
		{
			width = 16;
			height = 16;
			aiStyle = 27;
			hostile = true;
			magic = true;
			penetrate = -1;
			light = 0.5f;
			alpha = 255;
		}
		else if (type == 116)
		{
			width = 16;
			height = 16;
			aiStyle = 27;
			melee = true;
			penetrate = 2;
			light = 0.5f;
			alpha = 255;
			friendly = true;
		}
		else if (type == 117)
		{
			arrow = true;
			extraUpdates = 2;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			timeLeft = 1200;
		}
		else if (type == 118)
		{
			width = 10;
			height = 10;
			aiStyle = 28;
			alpha = 255;
			melee = true;
			penetrate = 1;
			friendly = true;
			coldDamage = true;
		}
		else if (type == 119)
		{
			width = 14;
			height = 14;
			aiStyle = 28;
			alpha = 255;
			melee = true;
			penetrate = 3;
			friendly = true;
			coldDamage = true;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 120)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			coldDamage = true;
			extraUpdates = 1;
			timeLeft = 1200;
		}
		else if (type == 121)
		{
			width = 10;
			height = 10;
			aiStyle = 29;
			alpha = 255;
			magic = true;
			penetrate = 1;
			friendly = true;
		}
		else if (type == 122)
		{
			width = 10;
			height = 10;
			aiStyle = 29;
			alpha = 255;
			magic = true;
			penetrate = 1;
			friendly = true;
		}
		else if (type == 123)
		{
			width = 10;
			height = 10;
			aiStyle = 29;
			alpha = 255;
			magic = true;
			penetrate = 1;
			friendly = true;
		}
		else if (type == 124)
		{
			width = 10;
			height = 10;
			aiStyle = 29;
			alpha = 255;
			magic = true;
			penetrate = 2;
			friendly = true;
		}
		else if (type == 125)
		{
			width = 10;
			height = 10;
			aiStyle = 29;
			alpha = 255;
			magic = true;
			penetrate = 2;
			friendly = true;
		}
		else if (type == 126)
		{
			width = 10;
			height = 10;
			aiStyle = 29;
			alpha = 255;
			magic = true;
			penetrate = 2;
			friendly = true;
		}
		else if (type == 127)
		{
			netImportant = true;
			width = 22;
			height = 22;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 128)
		{
			width = 14;
			height = 14;
			aiStyle = 28;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
			coldDamage = true;
		}
		else if (type == 129)
		{
			width = 14;
			height = 14;
			aiStyle = 28;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
			tileCollide = false;
		}
		else if (type == 130)
		{
			width = 22;
			height = 22;
			scale = 1.2f;
			DefaultToSpear();
		}
		else if (type == 131)
		{
			width = 22;
			height = 22;
			aiStyle = 30;
			friendly = true;
			penetrate = 1;
			tileCollide = false;
			melee = true;
			light = 0.5f;
		}
		else if (type == 132)
		{
			width = 16;
			height = 16;
			aiStyle = 27;
			melee = true;
			penetrate = 3;
			light = 0.5f;
			alpha = 255;
			friendly = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 10;
		}
		else if (type == 133)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 134)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 135)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 136)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 137)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 138)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 139)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 140)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 141)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 142)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 143)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 144)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 145)
		{
			width = 6;
			height = 6;
			aiStyle = 31;
			friendly = true;
			alpha = 255;
			penetrate = -1;
			extraUpdates = 2;
			tileCollide = false;
			ignoreWater = true;
		}
		else if (type == 146)
		{
			width = 6;
			height = 6;
			aiStyle = 31;
			friendly = true;
			alpha = 255;
			penetrate = -1;
			extraUpdates = 2;
			tileCollide = false;
			ignoreWater = true;
		}
		else if (type == 147)
		{
			width = 6;
			height = 6;
			aiStyle = 31;
			friendly = true;
			alpha = 255;
			penetrate = -1;
			extraUpdates = 2;
			tileCollide = false;
			ignoreWater = true;
		}
		else if (type == 148)
		{
			width = 6;
			height = 6;
			aiStyle = 31;
			friendly = true;
			alpha = 255;
			penetrate = -1;
			extraUpdates = 2;
			tileCollide = false;
			ignoreWater = true;
		}
		else if (type == 149)
		{
			width = 6;
			height = 6;
			aiStyle = 31;
			friendly = true;
			alpha = 255;
			penetrate = -1;
			extraUpdates = 2;
			tileCollide = false;
			ignoreWater = true;
		}
		else if (type == 150 || type == 151 || type == 152)
		{
			width = 28;
			height = 28;
			aiStyle = 4;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			alpha = 255;
			ignoreWater = true;
			magic = true;
			armorPenetration = 10;
		}
		else if (type == 153)
		{
			width = 18;
			height = 18;
			scale = 1.1f;
			DefaultToSpear();
		}
		else if (type == 154)
		{
			netImportant = true;
			width = 22;
			height = 22;
			scale = 0.8f;
			DefaultToFlail();
		}
		else if (type == 155)
		{
			netImportant = true;
			width = 44;
			height = 44;
			aiStyle = 32;
			friendly = true;
		}
		else if (type == 156)
		{
			width = 16;
			height = 16;
			aiStyle = 27;
			melee = true;
			penetrate = 2;
			light = 0.5f;
			alpha = 255;
			friendly = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 10;
		}
		else if (type == 157)
		{
			width = 32;
			height = 32;
			aiStyle = 27;
			melee = true;
			light = 0.5f;
			alpha = 255;
			friendly = true;
			scale = 1.2f;
		}
		else if (type == 158)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 1;
			alpha = 255;
			timeLeft = 600;
			ranged = true;
			extraUpdates = 1;
		}
		else if (type == 159)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 1;
			alpha = 255;
			timeLeft = 600;
			ranged = true;
			extraUpdates = 1;
		}
		else if (type == 160)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 1;
			alpha = 255;
			timeLeft = 600;
			ranged = true;
			extraUpdates = 1;
		}
		else if (type == 161)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 1;
			alpha = 255;
			timeLeft = 600;
			ranged = true;
			extraUpdates = 1;
		}
		else if (type == 162)
		{
			width = 16;
			height = 16;
			aiStyle = 2;
			friendly = true;
			penetrate = 4;
			alpha = 255;
		}
		else if (type == 163)
		{
			netImportant = true;
			width = 6;
			height = 6;
			aiStyle = 33;
			friendly = true;
			penetrate = -1;
			alpha = 255;
			timeLeft = 36000;
		}
		else if (type == 164)
		{
			width = 128;
			height = 128;
			aiStyle = 16;
			friendly = true;
			hostile = true;
			penetrate = -1;
			tileCollide = false;
			alpha = 255;
			timeLeft = 2;
		}
		else if (type == 165)
		{
			netImportant = true;
			width = 12;
			height = 12;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
		}
		else if (type == 166)
		{
			width = 14;
			height = 14;
			aiStyle = 2;
			friendly = true;
			ranged = true;
			coldDamage = true;
		}
		else if (type == 167 || type == 168 || type == 169 || type == 170)
		{
			width = 14;
			height = 14;
			aiStyle = 34;
			friendly = true;
			ranged = true;
			timeLeft = 45;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 1;
			appliesImmunityTimeOnSingleHits = true;
		}
		else if (type == 171 || type == 505 || type == 506)
		{
			width = 14;
			height = 14;
			aiStyle = 35;
			penetrate = -1;
			tileCollide = false;
			timeLeft = 400;
		}
		else if (type == 172)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			light = 1f;
			ranged = true;
			coldDamage = true;
			timeLeft = 1200;
		}
		else if (type == 173)
		{
			width = 16;
			height = 16;
			aiStyle = 27;
			melee = true;
			penetrate = 1;
			light = 0.2f;
			alpha = 255;
			friendly = true;
		}
		else if (type == 174)
		{
			alpha = 255;
			width = 6;
			height = 6;
			aiStyle = 1;
			hostile = true;
			penetrate = -1;
			coldDamage = true;
		}
		else if (type == 175)
		{
			width = 34;
			height = 34;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 176)
		{
			alpha = 255;
			width = 6;
			height = 6;
			aiStyle = 1;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 177)
		{
			width = 10;
			height = 10;
			aiStyle = 28;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
			coldDamage = true;
		}
		else if (type == 178)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			alpha = 255;
			penetrate = -1;
			timeLeft = 2;
		}
		else if (type == 179)
		{
			knockBack = 6f;
			width = 10;
			height = 10;
			aiStyle = 10;
			friendly = true;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 180)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			hostile = true;
			penetrate = -1;
			light = 0.5f;
			alpha = 255;
			scale = 1.2f;
			timeLeft = 600;
			extraUpdates = 1;
		}
		else if (type == 181)
		{
			width = 8;
			height = 8;
			aiStyle = 36;
			friendly = true;
			penetrate = 3;
			alpha = 255;
			timeLeft = 600;
			extraUpdates = 3;
			noEnchantmentVisuals = true;
		}
		else if (type == 182)
		{
			light = 0.15f;
			width = 30;
			height = 30;
			aiStyle = 3;
			friendly = true;
			penetrate = 10;
			melee = true;
			extraUpdates = 1;
		}
		else if (type == 183)
		{
			width = 14;
			height = 22;
			aiStyle = 14;
			penetrate = 1;
			timeLeft = 180;
			ranged = true;
			friendly = true;
		}
		else if (type == 184)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			hostile = true;
			penetrate = -1;
			trap = true;
		}
		else if (type == 185)
		{
			width = 14;
			height = 14;
			aiStyle = 14;
			friendly = true;
			hostile = true;
			penetrate = -1;
			timeLeft = 900;
			trap = true;
		}
		else if (type == 186)
		{
			width = 10;
			height = 14;
			aiStyle = 37;
			friendly = true;
			tileCollide = false;
			ignoreWater = true;
			hostile = true;
			penetrate = -1;
			timeLeft = 300;
			trap = true;
		}
		else if (type == 187)
		{
			width = 6;
			height = 6;
			aiStyle = 38;
			alpha = 255;
			tileCollide = false;
			ignoreWater = true;
			timeLeft = 60;
			trap = true;
		}
		else if (type == 188)
		{
			width = 6;
			height = 6;
			aiStyle = 23;
			friendly = true;
			hostile = true;
			alpha = 255;
			penetrate = -1;
			extraUpdates = 2;
			trap = true;
		}
		else if (type == 189)
		{
			width = 8;
			height = 8;
			aiStyle = 36;
			friendly = true;
			penetrate = 3;
			alpha = 255;
			timeLeft = 600;
			magic = true;
			extraUpdates = 3;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
			armorPenetration = 10;
		}
		else if (type == 190)
		{
			width = 22;
			height = 22;
			aiStyle = 39;
			friendly = true;
			penetrate = -1;
			alpha = 255;
			ranged = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 14;
		}
		else if (type >= 191 && type <= 194)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 26;
			penetrate = -1;
			timeLeft *= 5;
			minion = true;
			minionSlots = 1f;
			if (type == 192)
			{
				scale = 1.025f;
			}
			if (type == 193)
			{
				scale = 1.05f;
			}
			if (type == 194)
			{
				scale = 1.075f;
			}
		}
		else if (type == 195)
		{
			tileCollide = false;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			extraUpdates = 1;
		}
		else if (type == 196)
		{
			width = 16;
			height = 16;
			aiStyle = 14;
			penetrate = -1;
			scale = 0.8f;
		}
		else if (type == 197)
		{
			netImportant = true;
			width = 42;
			height = 42;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 198)
		{
			netImportant = true;
			width = 26;
			height = 26;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 199)
		{
			netImportant = true;
			width = 28;
			height = 28;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
			ignoreWater = true;
		}
		else if (type == 200)
		{
			netImportant = true;
			width = 28;
			height = 28;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 201)
		{
			knockBack = 12f;
			width = 24;
			height = 24;
			aiStyle = 17;
			penetrate = -1;
			if (Main.getGoodWorld)
			{
				friendly = true;
				hostile = true;
			}
		}
		else if (type == 202)
		{
			knockBack = 12f;
			width = 24;
			height = 24;
			aiStyle = 17;
			penetrate = -1;
			if (Main.getGoodWorld)
			{
				friendly = true;
				hostile = true;
			}
		}
		else if (type == 203)
		{
			knockBack = 12f;
			width = 24;
			height = 24;
			aiStyle = 17;
			penetrate = -1;
			if (Main.getGoodWorld)
			{
				friendly = true;
				hostile = true;
			}
		}
		else if (type == 204)
		{
			knockBack = 12f;
			width = 24;
			height = 24;
			aiStyle = 17;
			penetrate = -1;
			if (Main.getGoodWorld)
			{
				friendly = true;
				hostile = true;
			}
		}
		else if (type == 205)
		{
			knockBack = 12f;
			width = 24;
			height = 24;
			aiStyle = 17;
			penetrate = -1;
			if (Main.getGoodWorld)
			{
				friendly = true;
				hostile = true;
			}
		}
		else if (type == 206)
		{
			width = 14;
			height = 14;
			aiStyle = 40;
			friendly = true;
			penetrate = 1;
			alpha = 255;
			timeLeft = 600;
			magic = true;
		}
		else if (type == 207)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 1;
			light = 0.5f;
			alpha = 255;
			extraUpdates = 2;
			scale = 1.2f;
			timeLeft = 600;
			ranged = true;
		}
		else if (type == 208)
		{
			netImportant = true;
			width = 18;
			height = 36;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 209)
		{
			width = 12;
			height = 32;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
			light = 0.5f;
		}
		else if (type == 210)
		{
			netImportant = true;
			width = 14;
			height = 30;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 211)
		{
			netImportant = true;
			width = 24;
			height = 24;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
			light = 1f;
			ignoreWater = true;
		}
		else if (type == 212)
		{
			width = 18;
			height = 18;
			scale = 1.12f;
			DefaultToSpear();
		}
		else if (type == 213)
		{
			width = 22;
			height = 22;
			DefaultToDrillOrChainsaw();
			scale = 0.92f;
		}
		else if (type == 214)
		{
			width = 18;
			height = 18;
			DefaultToDrillOrChainsaw();
		}
		else if (type == 215)
		{
			width = 18;
			height = 18;
			scale = 1.27f;
			DefaultToSpear();
		}
		else if (type == 216)
		{
			width = 22;
			height = 22;
			DefaultToDrillOrChainsaw();
			scale = 0.93f;
		}
		else if (type == 217)
		{
			width = 18;
			height = 18;
			DefaultToDrillOrChainsaw();
			scale = 1.12f;
		}
		else if (type == 218)
		{
			width = 18;
			height = 18;
			scale = 1.28f;
			DefaultToSpear();
		}
		else if (type == 219)
		{
			width = 22;
			height = 22;
			DefaultToDrillOrChainsaw();
			scale = 0.95f;
		}
		else if (type == 220)
		{
			width = 18;
			height = 18;
			DefaultToDrillOrChainsaw();
			scale = 1.2f;
		}
		else if (type == 221)
		{
			width = 20;
			height = 20;
			aiStyle = 41;
			friendly = true;
			tileCollide = false;
			ignoreWater = true;
			timeLeft = 120;
			penetrate = -1;
			scale = 1f + (float)Main.rand.Next(30) * 0.01f;
			extraUpdates = 2;
		}
		else if (type == 222)
		{
			width = 18;
			height = 18;
			scale = 1.3f;
			DefaultToSpear();
		}
		else if (type == 223)
		{
			width = 22;
			height = 22;
			DefaultToDrillOrChainsaw();
			scale = 1f;
		}
		else if (type == 224)
		{
			width = 18;
			height = 18;
			DefaultToDrillOrChainsaw();
			scale = 1.1f;
		}
		else if (type == 225)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			extraUpdates = 1;
			timeLeft = 1200;
		}
		else if (type == 226)
		{
			netImportant = true;
			width = 22;
			height = 42;
			aiStyle = 42;
			friendly = true;
			tileCollide = false;
			penetrate = -1;
			timeLeft *= 5;
			light = 0.4f;
			ignoreWater = true;
		}
		else if (type == 227)
		{
			netImportant = true;
			tileCollide = false;
			width = 14;
			height = 14;
			aiStyle = 43;
			friendly = true;
			penetrate = 1;
			timeLeft = 180;
			extraUpdates = 180;
			hide = true;
		}
		else if (type == 228)
		{
			tileCollide = false;
			width = 30;
			height = 30;
			aiStyle = 44;
			friendly = true;
			melee = true;
			scale = 1.1f;
			penetrate = -1;
			noEnchantmentVisuals = true;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 229)
		{
			width = 30;
			height = 30;
			aiStyle = 44;
			friendly = true;
			melee = true;
			penetrate = -1;
			light = 0.2f;
			noEnchantmentVisuals = true;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type >= 230 && type <= 235)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
		}
		else if (type == 236)
		{
			netImportant = true;
			width = 34;
			height = 34;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 237)
		{
			netImportant = true;
			width = 28;
			height = 28;
			aiStyle = 45;
			penetrate = -1;
		}
		else if (type == 238)
		{
			netImportant = true;
			tileCollide = false;
			ignoreWater = true;
			width = 54;
			height = 28;
			aiStyle = 45;
			penetrate = -1;
			timeLeft = 18000;
		}
		else if (type == 239)
		{
			ignoreWater = true;
			width = 4;
			height = 40;
			aiStyle = 45;
			friendly = true;
			penetrate = 5;
			timeLeft = 300;
			scale = 1.1f;
			magic = true;
			extraUpdates = 1;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 240)
		{
			width = 16;
			height = 16;
			aiStyle = 2;
			hostile = true;
			penetrate = -1;
			alpha = 255;
		}
		else if (type == 241)
		{
			knockBack = 6f;
			width = 10;
			height = 10;
			aiStyle = 10;
			friendly = true;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 242)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 3;
			light = 0.5f;
			alpha = 255;
			extraUpdates = 7;
			scale = 1.18f;
			timeLeft = 600;
			ranged = true;
			ignoreWater = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 243)
		{
			netImportant = true;
			width = 28;
			height = 28;
			aiStyle = 45;
			penetrate = -1;
		}
		else if (type == 244)
		{
			netImportant = true;
			tileCollide = false;
			ignoreWater = true;
			width = 54;
			height = 28;
			aiStyle = 45;
			penetrate = -1;
			timeLeft = 18000;
		}
		else if (type == 245)
		{
			ignoreWater = true;
			width = 4;
			height = 40;
			aiStyle = 45;
			friendly = true;
			penetrate = 2;
			timeLeft = 300;
			scale = 1.1f;
			magic = true;
			extraUpdates = 1;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 246)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			alpha = 255;
			extraUpdates = 1;
		}
		else if (type == 247)
		{
			netImportant = true;
			width = 34;
			height = 34;
			DefaultToFlail();
		}
		else if (type == 248)
		{
			width = 18;
			height = 18;
			aiStyle = 1;
			friendly = true;
			melee = true;
		}
		else if (type == 249)
		{
			width = 12;
			height = 12;
			aiStyle = 2;
			friendly = true;
			ranged = true;
		}
		else if (type == 250)
		{
			width = 12;
			height = 12;
			aiStyle = 46;
			penetrate = -1;
			magic = true;
			alpha = 255;
			ignoreWater = true;
			scale = 1.25f;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 251)
		{
			width = 14;
			height = 14;
			aiStyle = 46;
			friendly = true;
			penetrate = -1;
			magic = true;
			alpha = 255;
			light = 0.3f;
			tileCollide = false;
			ignoreWater = true;
			scale = 1.25f;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 252)
		{
			width = 18;
			height = 18;
			DefaultToDrillOrChainsaw();
			scale = 1.1f;
		}
		else if (type == 253)
		{
			width = 16;
			height = 16;
			aiStyle = 8;
			friendly = true;
			light = 0.8f;
			alpha = 100;
			magic = true;
			coldDamage = true;
		}
		else if (type == 254)
		{
			width = 38;
			height = 38;
			aiStyle = 47;
			magic = true;
			timeLeft = 900;
			light = 0.5f;
		}
		else if (type == 255)
		{
			width = 8;
			height = 8;
			aiStyle = 48;
			friendly = true;
			magic = true;
			extraUpdates = 100;
			timeLeft = 100;
		}
		else if (type == 256)
		{
			netImportant = true;
			tileCollide = false;
			width = 6;
			height = 6;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			scale = 1f;
			timeLeft *= 10;
			extraUpdates = 1;
		}
		else if (type == 257)
		{
			ignoreWater = true;
			width = 4;
			height = 4;
			aiStyle = 1;
			hostile = true;
			penetrate = -1;
			light = 0.75f;
			alpha = 255;
			scale = 1.2f;
			timeLeft = 600;
			magic = true;
			coldDamage = true;
			extraUpdates = 1;
		}
		else if (type == 258)
		{
			width = 16;
			height = 16;
			aiStyle = 8;
			hostile = true;
			penetrate = -1;
			alpha = 100;
			timeLeft = 300;
		}
		else if (type == 259)
		{
			ignoreWater = true;
			tileCollide = false;
			width = 8;
			height = 8;
			aiStyle = 1;
			hostile = true;
			penetrate = -1;
			light = 0.3f;
			scale = 1.1f;
			magic = true;
			extraUpdates = 1;
		}
		else if (type == 260)
		{
			width = 8;
			height = 8;
			aiStyle = 48;
			friendly = true;
			magic = true;
			extraUpdates = 100;
			timeLeft = 200;
			penetrate = 1;
		}
		else if (type == 261)
		{
			width = 32;
			height = 34;
			aiStyle = 14;
			friendly = true;
			penetrate = 6;
			magic = true;
			ignoreWater = true;
			extraUpdates = 1;
		}
		else if (type == 262)
		{
			width = 30;
			height = 30;
			aiStyle = 13;
			friendly = true;
			penetrate = -1;
			alpha = 255;
			melee = true;
			extraUpdates = 1;
		}
		else if (type == 263)
		{
			width = 34;
			height = 34;
			alpha = 100;
			light = 0.5f;
			aiStyle = 18;
			friendly = true;
			penetrate = 4;
			tileCollide = true;
			scale = 1f;
			melee = true;
			timeLeft = 180;
			coldDamage = true;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 8;
		}
		else if (type == 264)
		{
			ignoreWater = true;
			width = 4;
			height = 40;
			aiStyle = 45;
			hostile = true;
			penetrate = -1;
			timeLeft = 120;
			scale = 1.1f;
			extraUpdates = 1;
		}
		else if (type == 265)
		{
			width = 12;
			height = 12;
			aiStyle = 1;
			alpha = 255;
			friendly = true;
			magic = true;
			penetrate = 3;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 10;
			timeLeft = 37;
		}
		else if (type == 266)
		{
			netImportant = true;
			width = 24;
			height = 16;
			aiStyle = 26;
			penetrate = -1;
			timeLeft *= 5;
			minion = true;
			minionSlots = 1f;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 12;
		}
		else if (type == 267)
		{
			alpha = 255;
			width = 14;
			height = 14;
			aiStyle = 1;
			friendly = true;
			ranged = true;
		}
		else if (type == 268)
		{
			netImportant = true;
			width = 18;
			height = 32;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 269)
		{
			netImportant = true;
			width = 20;
			height = 26;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 270)
		{
			width = 26;
			height = 26;
			aiStyle = 1;
			alpha = 255;
			hostile = true;
			penetrate = 3;
		}
		else if (type == 271)
		{
			width = 20;
			height = 20;
			aiStyle = 13;
			friendly = true;
			penetrate = -1;
			alpha = 255;
			melee = true;
			scale = 1.2f;
		}
		else if (type == 272)
		{
			width = 32;
			height = 32;
			aiStyle = 3;
			friendly = true;
			scale = 0.9f;
			penetrate = -1;
			melee = true;
		}
		else if (type == 273)
		{
			width = 26;
			height = 26;
			aiStyle = 13;
			friendly = true;
			penetrate = -1;
			alpha = 255;
			melee = true;
		}
		else if (type == 274)
		{
			width = 42;
			height = 42;
			alpha = 100;
			light = 0.5f;
			aiStyle = 18;
			friendly = true;
			penetrate = 5;
			tileCollide = false;
			scale = 1.1f;
			melee = true;
			timeLeft = 180;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 275)
		{
			alpha = 255;
			width = 14;
			height = 14;
			aiStyle = 1;
			hostile = true;
		}
		else if (type == 276)
		{
			alpha = 255;
			width = 14;
			height = 14;
			aiStyle = 1;
			hostile = true;
		}
		else if (type == 277)
		{
			alpha = 255;
			width = 38;
			height = 38;
			aiStyle = 14;
			hostile = true;
		}
		else if (type == 278)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			light = 1f;
			ranged = true;
			extraUpdates = 1;
			timeLeft = 1200;
		}
		else if (type == 279)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 1;
			light = 0.5f;
			alpha = 255;
			extraUpdates = 2;
			scale = 1.25f;
			timeLeft = 600;
			ranged = true;
		}
		else if (type == 280)
		{
			width = 32;
			height = 32;
			aiStyle = 12;
			friendly = true;
			alpha = 255;
			penetrate = 5;
			extraUpdates = 2;
			ignoreWater = true;
			magic = true;
		}
		else if (type == 281)
		{
			width = 28;
			height = 28;
			aiStyle = 49;
			friendly = true;
			alpha = 255;
			timeLeft = 600;
			idStaticNPCHitCooldown = 10;
			usesIDStaticNPCImmunity = true;
			penetrate = -1;
		}
		else if (type == 282)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			extraUpdates = 1;
			timeLeft = 1200;
		}
		else if (type == 283)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 1;
			light = 0.5f;
			alpha = 255;
			extraUpdates = 2;
			scale = 1.25f;
			timeLeft = 600;
			ranged = true;
		}
		else if (type == 284)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 1;
			light = 0.5f;
			alpha = 255;
			extraUpdates = 2;
			scale = 1.3f;
			timeLeft = 600;
			ranged = true;
		}
		else if (type == 285)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 1;
			light = 0.5f;
			alpha = 255;
			extraUpdates = 2;
			scale = 1.3f;
			timeLeft = 600;
			ranged = true;
		}
		else if (type == 286)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 1;
			light = 0.5f;
			alpha = 255;
			extraUpdates = 2;
			scale = 1.3f;
			timeLeft = 600;
			ranged = true;
		}
		else if (type == 287)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 1;
			light = 0.5f;
			alpha = 255;
			extraUpdates = 2;
			scale = 1.3f;
			timeLeft = 600;
			ranged = true;
		}
		else if (type == 288)
		{
			width = 32;
			height = 32;
			aiStyle = 12;
			hostile = true;
			alpha = 255;
			penetrate = -1;
			extraUpdates = 2;
			ignoreWater = true;
			magic = true;
		}
		else if (type == 289)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			alpha = 255;
			penetrate = -1;
			timeLeft = 2;
		}
		else if (type == 290)
		{
			width = 4;
			height = 4;
			aiStyle = 48;
			hostile = true;
			magic = true;
			extraUpdates = 100;
			timeLeft = 100;
			penetrate = -1;
		}
		else if (type == 291)
		{
			width = 12;
			height = 12;
			aiStyle = 50;
			hostile = true;
			alpha = 255;
			magic = true;
			tileCollide = false;
			penetrate = -1;
		}
		else if (type == 292)
		{
			width = 130;
			height = 130;
			aiStyle = 50;
			hostile = true;
			alpha = 255;
			magic = true;
			tileCollide = false;
			penetrate = -1;
		}
		else if (type == 293)
		{
			width = 12;
			height = 12;
			aiStyle = 51;
			hostile = true;
			alpha = 255;
			magic = true;
			tileCollide = false;
			penetrate = -1;
			extraUpdates = 1;
		}
		else if (type == 294)
		{
			width = 4;
			height = 4;
			aiStyle = 48;
			friendly = true;
			magic = true;
			extraUpdates = 100;
			timeLeft = 300;
			penetrate = -1;
		}
		else if (type == 295)
		{
			width = 12;
			height = 12;
			aiStyle = 50;
			friendly = true;
			alpha = 255;
			magic = true;
			tileCollide = true;
		}
		else if (type == 296)
		{
			width = 150;
			height = 150;
			aiStyle = 50;
			friendly = true;
			alpha = 255;
			magic = true;
			tileCollide = false;
			penetrate = -1;
		}
		else if (type == 297)
		{
			width = 12;
			height = 12;
			aiStyle = 51;
			friendly = true;
			alpha = 255;
			magic = true;
			extraUpdates = 1;
			penetrate = 3;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 298)
		{
			width = 6;
			height = 6;
			aiStyle = 52;
			alpha = 255;
			magic = true;
			tileCollide = false;
			extraUpdates = 3;
		}
		else if (type == 299)
		{
			width = 6;
			height = 6;
			aiStyle = 1;
			hostile = true;
			alpha = 255;
			penetrate = -1;
			extraUpdates = 2;
			magic = true;
			ignoreWater = true;
			tileCollide = false;
		}
		else if (type == 300)
		{
			width = 38;
			height = 38;
			aiStyle = 2;
			hostile = true;
			penetrate = -1;
			ignoreWater = true;
			tileCollide = false;
		}
		else if (type == 301)
		{
			width = 38;
			height = 38;
			aiStyle = 3;
			friendly = true;
			penetrate = -1;
			melee = true;
			extraUpdates = 2;
		}
		else if (type == 302)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			hostile = true;
			penetrate = -1;
			light = 0.3f;
			alpha = 255;
			extraUpdates = 7;
			scale = 1.18f;
			timeLeft = 300;
			ranged = true;
			ignoreWater = true;
		}
		else if (type == 303)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			hostile = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 304)
		{
			alpha = 255;
			width = 30;
			height = 30;
			aiStyle = 2;
			friendly = true;
			penetrate = 1;
			melee = true;
			light = 0.2f;
			ignoreWater = true;
			extraUpdates = 0;
		}
		else if (type == 305)
		{
			width = 6;
			height = 6;
			aiStyle = 52;
			alpha = 255;
			tileCollide = false;
			extraUpdates = 10;
		}
		else if (type == 306)
		{
			alpha = 255;
			width = 14;
			height = 14;
			aiStyle = 2;
			friendly = true;
			penetrate = 1;
			melee = true;
			ignoreWater = true;
			extraUpdates = 1;
		}
		else if (type == 307)
		{
			width = 16;
			height = 16;
			aiStyle = 36;
			penetrate = 1;
			alpha = 255;
			timeLeft = 600;
			melee = true;
			extraUpdates = 3;
		}
		else if (type == 308)
		{
			width = 80;
			height = 74;
			aiStyle = 53;
			timeLeft = 36000;
			light = 0.25f;
			ignoreWater = true;
			coldDamage = true;
			sentry = true;
			netImportant = true;
		}
		else if (type == 309)
		{
			width = 14;
			height = 14;
			aiStyle = 28;
			alpha = 255;
			penetrate = 3;
			friendly = true;
			extraUpdates = 3;
			coldDamage = true;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 310)
		{
			netImportant = true;
			width = 6;
			height = 6;
			aiStyle = 33;
			friendly = true;
			penetrate = -1;
			alpha = 255;
			timeLeft = 36000;
		}
		else if (type == 311)
		{
			width = 10;
			height = 12;
			aiStyle = 1;
			friendly = true;
			penetrate = 3;
			alpha = 255;
			timeLeft = 300;
			ranged = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 10;
		}
		else if (type == 312)
		{
			alpha = 255;
			width = 32;
			height = 32;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			timeLeft = 300;
			glowMask = 257;
		}
		else if (type == 313)
		{
			netImportant = true;
			width = 30;
			height = 30;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 314)
		{
			netImportant = true;
			width = 24;
			height = 40;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 315)
		{
			netImportant = true;
			width = 14;
			height = 14;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
		}
		else if (type == 316)
		{
			alpha = 255;
			width = 16;
			height = 16;
			aiStyle = 36;
			friendly = true;
			penetrate = 1;
			timeLeft = 600;
			magic = true;
		}
		else if (type == 317)
		{
			netImportant = true;
			width = 28;
			height = 28;
			aiStyle = 54;
			penetrate = 1;
			timeLeft *= 5;
			minion = true;
			minionSlots = 1f;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 10;
		}
		else if (type == 318)
		{
			width = 12;
			height = 14;
			aiStyle = 2;
			friendly = true;
			ranged = true;
		}
		else if (type == 319)
		{
			netImportant = true;
			width = 36;
			height = 30;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 320)
		{
			width = 34;
			height = 34;
			aiStyle = 3;
			friendly = true;
			penetrate = -1;
			melee = true;
		}
		else if (type == 321)
		{
			width = 30;
			height = 30;
			aiStyle = 55;
			friendly = true;
			melee = true;
			tileCollide = false;
			ignoreWater = true;
		}
		else if (type == 322)
		{
			netImportant = true;
			width = 14;
			height = 14;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
		}
		else if (type == 323)
		{
			penetrate = 10;
			extraUpdates = 3;
			width = 14;
			height = 14;
			aiStyle = 1;
			alpha = 255;
			friendly = true;
			ranged = true;
			scale = 0.8f;
		}
		else if (type == 324)
		{
			netImportant = true;
			width = 26;
			height = 38;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 325)
		{
			alpha = 255;
			penetrate = -1;
			width = 14;
			height = 14;
			aiStyle = 1;
			hostile = true;
			tileCollide = false;
			timeLeft = 420;
		}
		else if (type >= 326 && type <= 328)
		{
			if (type == 326)
			{
				width = 14;
				height = 16;
			}
			else if (type == 327)
			{
				width = 12;
				height = 14;
			}
			else
			{
				width = 6;
				height = 12;
			}
			aiStyle = 14;
			hostile = true;
			penetrate = -1;
			timeLeft = 360;
		}
		else if (type == 329)
		{
			width = 80;
			height = 80;
			light = 0.25f;
			aiStyle = 56;
			hostile = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft = 420;
		}
		else if (type == 330)
		{
			width = 22;
			height = 22;
			aiStyle = 2;
			friendly = true;
			penetrate = 6;
			ranged = true;
		}
		else if (type == 331)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
		}
		else if (type == 332)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
			light = 0.5f;
		}
		else if (type == 333)
		{
			width = 38;
			height = 38;
			aiStyle = 3;
			friendly = true;
			scale = 0.9f;
			penetrate = -1;
			melee = true;
		}
		else if (type == 334)
		{
			netImportant = true;
			width = 28;
			height = 28;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 335)
		{
			width = 22;
			height = 22;
			aiStyle = 30;
			friendly = true;
			penetrate = 1;
			melee = true;
		}
		else if (type == 336)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			magic = true;
			scale = 0.8f;
			extraUpdates = 1;
		}
		else if (type == 337)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			magic = true;
			tileCollide = false;
			coldDamage = true;
			extraUpdates = 1;
		}
		else if (type == 338 || type == 339 || type == 340 || type == 341)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			penetrate = -1;
			friendly = true;
			ranged = true;
			scale = 0.9f;
		}
		else if (type == 342)
		{
			width = 22;
			height = 2;
			scale = 1.1f;
			DefaultToSpear();
			coldDamage = true;
		}
		else if (type == 343)
		{
			alpha = 255;
			width = 10;
			height = 10;
			aiStyle = 57;
			friendly = true;
			melee = true;
			scale = 1.1f;
			penetrate = 3;
			coldDamage = true;
			timeLeft = 120;
		}
		else if (type == 344)
		{
			width = 26;
			height = 26;
			aiStyle = 1;
			friendly = true;
			scale = 0.9f;
			alpha = 255;
			melee = true;
			coldDamage = true;
			tileCollide = false;
			noEnchantmentVisuals = true;
			timeLeft = 240;
		}
		else if (type == 345)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			hostile = true;
			scale = 0.8f;
		}
		else if (type == 346)
		{
			width = 18;
			height = 18;
			aiStyle = 14;
			hostile = true;
			penetrate = -1;
			timeLeft = 300;
		}
		else if (type == 347)
		{
			width = 6;
			height = 6;
			aiStyle = 2;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 348)
		{
			aiStyle = 1;
			width = 48;
			height = 48;
			hostile = true;
			penetrate = -1;
			tileCollide = false;
			coldDamage = true;
			extraUpdates = 1;
			timeLeft = 900;
		}
		else if (type == 349)
		{
			aiStyle = 1;
			width = 12;
			height = 12;
			hostile = true;
			penetrate = -1;
			coldDamage = true;
			timeLeft = 900;
		}
		else if (type == 350)
		{
			alpha = 255;
			penetrate = -1;
			width = 14;
			height = 14;
			aiStyle = 1;
			hostile = true;
			tileCollide = false;
			timeLeft /= 2;
		}
		else if (type == 351)
		{
			alpha = 255;
			penetrate = -1;
			width = 24;
			height = 24;
			aiStyle = 58;
			hostile = true;
			tileCollide = false;
		}
		else if (type == 352)
		{
			width = 30;
			height = 30;
			aiStyle = 14;
			hostile = true;
			penetrate = -1;
			timeLeft /= 3;
		}
		else if (type == 353)
		{
			netImportant = true;
			width = 18;
			height = 28;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 354)
		{
			knockBack = 6f;
			width = 10;
			height = 10;
			aiStyle = 10;
			friendly = true;
			ranged = true;
			penetrate = -1;
			extraUpdates = 1;
		}
		else if (type == 355)
		{
			width = 12;
			height = 12;
			aiStyle = 1;
			alpha = 255;
			friendly = true;
			magic = true;
			penetrate = 5;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 10;
			timeLeft = 58;
		}
		else if (type == 356)
		{
			width = 6;
			height = 6;
			aiStyle = 59;
			alpha = 255;
			magic = true;
			tileCollide = false;
			extraUpdates = 3;
		}
		else if (type == 357)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 6;
			alpha = 255;
			extraUpdates = 2;
			scale = 1.2f;
			timeLeft = 600;
			ranged = true;
		}
		else if (type == 358)
		{
			width = 18;
			height = 18;
			aiStyle = 60;
			alpha = 255;
			penetrate = -1;
			extraUpdates = 2;
			ignoreWater = true;
		}
		else if (type == 359)
		{
			width = 14;
			height = 14;
			aiStyle = 28;
			alpha = 255;
			magic = true;
			penetrate = 2;
			friendly = true;
			coldDamage = true;
		}
		else if ((type >= 360 && type <= 366) || type == 381 || type == 382 || type == 760 || type == 775)
		{
			width = 14;
			height = 14;
			aiStyle = 61;
			penetrate = -1;
			netImportant = true;
			bobber = true;
		}
		else if (type == 367)
		{
			width = 18;
			height = 18;
			scale = 1.1f;
			DefaultToSpear();
		}
		else if (type == 368)
		{
			width = 18;
			height = 18;
			DefaultToSpear();
		}
		else if (type == 369)
		{
			width = 22;
			height = 22;
			DefaultToDrillOrChainsaw();
		}
		else if (type == 370)
		{
			width = 14;
			height = 14;
			aiStyle = 2;
			friendly = true;
			penetrate = 1;
		}
		else if (type == 371)
		{
			width = 14;
			height = 14;
			aiStyle = 2;
			friendly = true;
			penetrate = 1;
		}
		else if (type == 372)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
		}
		else if (type == 373)
		{
			netImportant = true;
			width = 24;
			height = 26;
			aiStyle = 62;
			penetrate = -1;
			timeLeft *= 5;
			minion = true;
			minionSlots = 1f;
			tileCollide = false;
			ignoreWater = true;
		}
		else if (type == 374)
		{
			width = 10;
			height = 10;
			aiStyle = 0;
			friendly = true;
			penetrate = 1;
			aiStyle = 1;
			tileCollide = true;
			scale *= 0.9f;
		}
		else if (type == 375)
		{
			netImportant = true;
			width = 34;
			height = 26;
			aiStyle = 62;
			penetrate = -1;
			timeLeft *= 5;
			minion = true;
			minionSlots = 1f;
			tileCollide = false;
			ignoreWater = true;
		}
		else if (type == 376)
		{
			width = 12;
			height = 12;
			aiStyle = 0;
			friendly = true;
			penetrate = 5;
			aiStyle = 1;
			tileCollide = true;
			timeLeft = 100;
			alpha = 255;
			extraUpdates = 1;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 6;
		}
		else if (type == 377)
		{
			width = 66;
			height = 50;
			aiStyle = 53;
			timeLeft = 36000;
			ignoreWater = true;
			sentry = true;
			netImportant = true;
		}
		else if (type == 378)
		{
			width = 16;
			height = 16;
			aiStyle = 14;
			friendly = true;
			penetrate = -1;
			timeLeft = 60;
			scale = 0.9f;
		}
		else if (type == 379)
		{
			width = 14;
			height = 10;
			aiStyle = 63;
			friendly = true;
			timeLeft = 300;
			penetrate = 1;
			decidesManualFallThrough = true;
		}
		else if (type == 380)
		{
			netImportant = true;
			width = 26;
			height = 26;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 383)
		{
			width = 34;
			height = 34;
			aiStyle = 3;
			friendly = true;
			penetrate = -1;
			melee = true;
		}
		else if (type == 384)
		{
			width = 150;
			height = 42;
			hostile = true;
			penetrate = -1;
			aiStyle = 64;
			tileCollide = false;
			ignoreWater = true;
			alpha = 255;
			timeLeft = 540;
		}
		else if (type == 385)
		{
			width = 30;
			height = 30;
			hostile = true;
			penetrate = -1;
			aiStyle = 65;
			alpha = 255;
			timeLeft = 300;
		}
		else if (type == 386)
		{
			width = 150;
			height = 42;
			hostile = true;
			penetrate = -1;
			aiStyle = 64;
			tileCollide = false;
			ignoreWater = true;
			alpha = 255;
			timeLeft = 840;
		}
		else if (type == 387)
		{
			netImportant = true;
			width = 40;
			height = 20;
			aiStyle = 66;
			penetrate = -1;
			timeLeft *= 5;
			minion = true;
			minionSlots = 0.5f;
			tileCollide = false;
			ignoreWater = true;
			friendly = true;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 16;
		}
		else if (type == 388)
		{
			netImportant = true;
			width = 40;
			height = 20;
			aiStyle = 66;
			penetrate = -1;
			timeLeft *= 5;
			minion = true;
			minionSlots = 0.5f;
			tileCollide = false;
			ignoreWater = true;
			friendly = true;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 12;
		}
		else if (type == 389)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			light = 0.75f;
			alpha = 255;
			extraUpdates = 2;
			scale = 1.2f;
			timeLeft = 600;
		}
		else if (type == 390 || type == 391 || type == 392)
		{
			width = 30;
			height = 30;
			aiStyle = 26;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			minion = true;
			minionSlots = 1f;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 15;
		}
		else if (type == 393 || type == 394 || type == 395)
		{
			width = 20;
			height = 30;
			aiStyle = 67;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			minion = true;
			minionSlots = 1f;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 18;
			decidesManualFallThrough = true;
		}
		else if (type == 396)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
			alpha = 100;
		}
		else if (type == 397)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
			tileCollide = false;
		}
		else if (type == 398)
		{
			netImportant = true;
			width = 18;
			height = 40;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 399)
		{
			width = 14;
			height = 14;
			aiStyle = 68;
			friendly = true;
			penetrate = 1;
			alpha = 255;
			ranged = true;
			noEnchantmentVisuals = true;
		}
		else if (type >= 400 && type <= 402)
		{
			if (type == 400)
			{
				width = 14;
				height = 16;
			}
			else if (type == 401)
			{
				width = 12;
				height = 14;
			}
			else
			{
				width = 6;
				height = 12;
			}
			penetrate = 3;
			aiStyle = 14;
			friendly = true;
			timeLeft = 360;
			ranged = true;
			noEnchantmentVisuals = true;
		}
		else if (type == 403)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
		}
		else if (type == 404)
		{
			width = 26;
			height = 26;
			aiStyle = 69;
			friendly = true;
			penetrate = -1;
			alpha = 255;
			melee = true;
		}
		else if (type == 405)
		{
			width = 14;
			height = 14;
			aiStyle = 70;
			friendly = true;
			penetrate = 1;
			alpha = 255;
			timeLeft = 120;
			melee = true;
		}
		else if (type == 406)
		{
			width = 14;
			height = 14;
			aiStyle = 60;
			alpha = 255;
			penetrate = -1;
			extraUpdates = 2;
			ignoreWater = true;
		}
		else if (type == 407)
		{
			netImportant = true;
			width = 28;
			height = 40;
			aiStyle = 62;
			penetrate = -1;
			timeLeft *= 5;
			minion = true;
			friendly = true;
			minionSlots = 1f;
			tileCollide = false;
			ignoreWater = true;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 408)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			alpha = 255;
			ignoreWater = true;
		}
		else if (type == 409)
		{
			width = 30;
			height = 30;
			penetrate = -1;
			aiStyle = 71;
			alpha = 255;
			timeLeft = 300;
			friendly = true;
			tileCollide = true;
			extraUpdates = 2;
			magic = true;
			ignoreWater = true;
		}
		else if (type == 410)
		{
			width = 14;
			height = 14;
			aiStyle = 72;
			friendly = true;
			penetrate = 1;
			alpha = 255;
			timeLeft = 100;
			magic = true;
			ignoreWater = true;
			if (Main.remixWorld)
			{
				armorPenetration = 20;
			}
		}
		else if (type >= 411 && type <= 414)
		{
			switch (type)
			{
			}
			width = 10;
			height = 10;
			aiStyle = 10;
		}
		else if (type == 415 || type == 416 || type == 417 || type == 418)
		{
			width = 14;
			height = 14;
			aiStyle = 34;
			friendly = true;
			ranged = true;
			timeLeft = 45;
		}
		else if (type >= 419 && type <= 422)
		{
			width = 4;
			height = 4;
			aiStyle = 73;
			friendly = true;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 3;
		}
		else if (type == 423)
		{
			netImportant = true;
			width = 28;
			height = 28;
			aiStyle = 62;
			penetrate = -1;
			timeLeft *= 5;
			minion = true;
			friendly = true;
			minionSlots = 1f;
			ignoreWater = true;
		}
		else if (type >= 424 && type <= 426)
		{
			width = 24;
			height = 24;
			aiStyle = 1;
			friendly = true;
			magic = true;
			tileCollide = false;
			extraUpdates = 2;
		}
		else if (type == 427)
		{
			width = 22;
			height = 56;
			DefaultToDrillOrChainsaw();
			glowMask = 2;
		}
		else if (type == 428)
		{
			width = 26;
			height = 54;
			DefaultToDrillOrChainsaw();
			glowMask = 3;
		}
		else if (type == 429)
		{
			width = 18;
			height = 56;
			DefaultToDrillOrChainsaw();
			glowMask = 7;
		}
		else if (type == 430)
		{
			width = 30;
			height = 54;
			DefaultToDrillOrChainsaw();
			glowMask = 8;
		}
		else if (type == 431)
		{
			width = 28;
			height = 64;
			DefaultToDrillOrChainsaw();
		}
		else if (type == 432)
		{
			width = 30;
			height = 54;
			DefaultToDrillOrChainsaw();
		}
		else if (type == 610)
		{
			width = 28;
			height = 64;
			DefaultToDrillOrChainsaw();
			glowMask = 179;
		}
		else if (type == 609)
		{
			width = 30;
			height = 54;
			DefaultToDrillOrChainsaw();
			glowMask = 180;
		}
		else if (type == 433)
		{
			width = 8;
			height = 8;
			aiStyle = 48;
			friendly = true;
			extraUpdates = 100;
			timeLeft = 100;
			ignoreWater = true;
		}
		else if (type == 434)
		{
			width = 1;
			height = 1;
			aiStyle = 74;
			friendly = true;
			extraUpdates = 100;
			penetrate = -1;
		}
		else if (type == 435)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			hostile = true;
			ignoreWater = true;
		}
		else if (type == 436)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			hostile = true;
			ignoreWater = true;
		}
		else if (type == 437)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			hostile = true;
			extraUpdates = 2;
			ignoreWater = true;
		}
		else if (type == 438)
		{
			width = 8;
			height = 8;
			aiStyle = 1;
			hostile = true;
			alpha = 255;
			extraUpdates = 3;
			ignoreWater = true;
		}
		else if (type == 439)
		{
			width = 22;
			height = 22;
			aiStyle = 75;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			drawLayer = 7;
			usesOwnerLight = true;
			magic = true;
			ignoreWater = true;
		}
		else if (type == 440)
		{
			width = 5;
			height = 5;
			aiStyle = 1;
			friendly = true;
			alpha = 255;
			extraUpdates = 2;
			scale = 1f;
			timeLeft = 600;
			magic = true;
			ignoreWater = true;
		}
		else if (type == 441)
		{
			width = 1;
			height = 1;
			aiStyle = 76;
			hide = true;
			ignoreWater = true;
			tileCollide = false;
		}
		else if (type == 442)
		{
			width = 14;
			height = 14;
			aiStyle = 1;
			friendly = true;
			alpha = 255;
			scale = 1f;
			timeLeft = 600;
			ranged = true;
		}
		else if (type == 443)
		{
			width = 80;
			height = 80;
			aiStyle = 77;
			friendly = true;
			alpha = 255;
			scale = 1f;
			ranged = true;
			ignoreWater = true;
			tileCollide = false;
			penetrate = -1;
		}
		else if (type == 444)
		{
			width = 10;
			height = 10;
			aiStyle = 78;
			friendly = true;
			alpha = 255;
			scale = 1f;
			ranged = true;
			ignoreWater = true;
			extraUpdates = 1;
		}
		else if (type == 445)
		{
			width = 10;
			height = 10;
			aiStyle = 75;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			drawLayer = 7;
			usesOwnerLight = true;
			melee = true;
			ignoreWater = true;
			ownerHitCheck = true;
		}
		else if (type == 446)
		{
			netImportant = true;
			width = 14;
			height = 14;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
			light = 0.7f;
		}
		else if (type == 447)
		{
			width = 30;
			height = 30;
			aiStyle = 79;
			hostile = true;
			penetrate = -1;
			tileCollide = false;
			ignoreWater = true;
			timeLeft = 240;
		}
		else if (type == 448)
		{
			width = 14;
			height = 14;
			aiStyle = 80;
			hostile = true;
			penetrate = -1;
			tileCollide = false;
		}
		else if (type == 449)
		{
			width = 5;
			height = 5;
			aiStyle = 1;
			hostile = true;
			alpha = 255;
			extraUpdates = 1;
			scale = 1f;
			timeLeft = 600;
			ignoreWater = true;
		}
		else if (type == 450)
		{
			width = 14;
			height = 14;
			aiStyle = 14;
			hostile = true;
			penetrate = -1;
			timeLeft = 360;
		}
		else if (type == 451)
		{
			width = 16;
			height = 16;
			aiStyle = 81;
			melee = true;
			penetrate = 3;
			light = 0.2f;
			alpha = 255;
			friendly = true;
		}
		else if (type == 452)
		{
			width = 14;
			height = 14;
			aiStyle = 82;
			hostile = true;
			penetrate = -1;
			alpha = 255;
			timeLeft = 600;
		}
		else if (type == 453)
		{
			width = 1;
			height = 1;
			aiStyle = 76;
			hide = true;
			ignoreWater = true;
			tileCollide = false;
		}
		else if (type == 454)
		{
			width = 40;
			height = 40;
			aiStyle = 83;
			hostile = true;
			penetrate = -1;
			alpha = 255;
			timeLeft = 600;
			tileCollide = false;
		}
		else if (type == 455)
		{
			width = 36;
			height = 36;
			aiStyle = 84;
			hostile = true;
			penetrate = -1;
			alpha = 255;
			timeLeft = 600;
			tileCollide = false;
		}
		else if (type == 456)
		{
			width = 16;
			height = 16;
			aiStyle = 85;
			hostile = true;
			penetrate = -1;
			alpha = 255;
			timeLeft = 600;
			tileCollide = false;
		}
		else if (type == 459)
		{
			width = 22;
			height = 22;
			aiStyle = 1;
			friendly = true;
			magic = true;
			alpha = 255;
			scale = 1f;
			ignoreWater = true;
			extraUpdates = 1;
		}
		else if (type == 460)
		{
			width = 14;
			height = 18;
			aiStyle = 75;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			drawLayer = 8;
			usesOwnerLight = true;
			magic = true;
			ignoreWater = true;
		}
		else if (type == 461)
		{
			width = 18;
			height = 18;
			aiStyle = 84;
			friendly = true;
			magic = true;
			penetrate = -1;
			alpha = 255;
			tileCollide = false;
			hide = true;
		}
		else if (type == 462)
		{
			width = 8;
			height = 8;
			aiStyle = 1;
			hostile = true;
			alpha = 255;
			extraUpdates = 3;
			ignoreWater = true;
			tileCollide = false;
		}
		else if (type == 463)
		{
			width = 64;
			height = 64;
			aiStyle = 6;
			friendly = true;
			tileCollide = false;
			penetrate = -1;
			alpha = 255;
			ignoreWater = true;
		}
		else if (type == 464)
		{
			width = 60;
			height = 60;
			aiStyle = 86;
			hostile = true;
			tileCollide = false;
			penetrate = -1;
			alpha = 255;
			ignoreWater = true;
		}
		else if (type == 467)
		{
			width = 40;
			height = 40;
			aiStyle = 1;
			hostile = true;
			alpha = 255;
			ignoreWater = true;
			extraUpdates = 1;
		}
		else if (type == 468)
		{
			width = 40;
			height = 40;
			aiStyle = 1;
			hostile = true;
			alpha = 255;
			ignoreWater = true;
			extraUpdates = 1;
		}
		else if (type == 465)
		{
			width = 80;
			height = 80;
			aiStyle = 88;
			hostile = true;
			alpha = 255;
			ignoreWater = true;
			tileCollide = false;
		}
		else if (type == 466)
		{
			width = 14;
			height = 14;
			aiStyle = 88;
			hostile = true;
			alpha = 255;
			ignoreWater = true;
			tileCollide = true;
			extraUpdates = 4;
			timeLeft = 120 * (extraUpdates + 1);
		}
		else if (type == 491)
		{
			width = 26;
			height = 26;
			aiStyle = 9;
			friendly = true;
			melee = true;
			penetrate = -1;
		}
		else if (type == 500)
		{
			width = 20;
			height = 20;
			aiStyle = 67;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			friendly = true;
			ignoreWater = true;
			scale = 0.8f;
		}
		else if (type == 499)
		{
			netImportant = true;
			width = 34;
			height = 34;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 469)
		{
			alpha = 255;
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			timeLeft = 1200;
		}
		else if (type == 470)
		{
			width = 10;
			height = 10;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
		}
		else if (type == 471)
		{
			width = 16;
			height = 16;
			aiStyle = 2;
			scale = 1.2f;
			hostile = true;
			ranged = true;
		}
		else if (type == 472)
		{
			width = 8;
			height = 8;
			aiStyle = 0;
			hostile = true;
			penetrate = -1;
			aiStyle = 1;
			tileCollide = true;
			timeLeft = 60;
		}
		else if (type == 474)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			timeLeft = 1200;
			penetrate = 2;
		}
		else if (type == 473)
		{
			netImportant = true;
			width = 8;
			height = 8;
			aiStyle = 14;
			penetrate = -1;
			alpha = 75;
			light = 1f;
			timeLeft *= 2;
		}
		else if (type == 475)
		{
			width = 14;
			height = 14;
			aiStyle = 35;
			penetrate = -1;
			tileCollide = false;
			timeLeft = 400;
		}
		else if (type == 476)
		{
			width = 200;
			height = 200;
			aiStyle = 185;
			friendly = true;
			tileCollide = false;
			penetrate = -1;
			alpha = 255;
			ignoreWater = true;
			timeLeft = 3;
			magic = true;
		}
		else if (type == 477)
		{
			alpha = 255;
			width = 14;
			height = 14;
			aiStyle = 1;
			friendly = true;
			penetrate = 5;
			extraUpdates = 1;
			ranged = true;
		}
		else if (type == 478)
		{
			alpha = 255;
			width = 14;
			height = 14;
			aiStyle = 1;
			friendly = true;
			penetrate = 2;
			timeLeft = 300;
			ranged = true;
		}
		else if (type == 479)
		{
			alpha = 255;
			width = 14;
			height = 14;
			aiStyle = 1;
			friendly = true;
			ranged = true;
		}
		else if (type == 480)
		{
			alpha = 255;
			width = 12;
			height = 12;
			penetrate = 1;
			aiStyle = 14;
			friendly = true;
			timeLeft = 120;
			ranged = true;
			noEnchantments = true;
		}
		else if (type == 481)
		{
			width = 22;
			height = 22;
			aiStyle = 13;
			friendly = true;
			penetrate = -1;
			alpha = 255;
			melee = true;
			extraUpdates = 0;
		}
		else if (type == 482)
		{
			width = 16;
			height = 200;
			aiStyle = 87;
			friendly = true;
			tileCollide = false;
			penetrate = -1;
			alpha = 255;
			ignoreWater = true;
			timeLeft = 18000;
			magic = true;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 483)
		{
			width = 14;
			height = 14;
			aiStyle = 14;
			friendly = true;
			melee = true;
		}
		else if (type == 484)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			melee = true;
			extraUpdates = 1;
		}
		else if (type == 485)
		{
			arrow = true;
			width = 24;
			height = 24;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			penetrate = -1;
			timeLeft = 1200;
		}
		else if (type >= 486 && type <= 489)
		{
			if (type == 486)
			{
				width = 12;
				height = 12;
			}
			else if (type == 487)
			{
				width = 22;
				height = 22;
			}
			else if (type == 488)
			{
				width = 12;
				height = 12;
				light = 0.3f;
			}
			else if (type == 489)
			{
				width = 20;
				height = 16;
			}
			netImportant = true;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
		}
		else if (type == 492)
		{
			netImportant = true;
			width = 18;
			height = 32;
			aiStyle = 90;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 490)
		{
			width = 14;
			height = 14;
			aiStyle = 89;
			hostile = true;
			alpha = 255;
			ignoreWater = true;
			tileCollide = false;
			timeLeft = 600;
			netImportant = true;
		}
		else if (type == 493 || type == 494)
		{
			width = 32;
			height = 32;
			aiStyle = 4;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			alpha = 255;
			ignoreWater = true;
			magic = true;
			light = 0.2f;
			armorPenetration = 10;
		}
		else if (type == 495)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			penetrate = 3;
			timeLeft = 1200;
		}
		else if (type == 496)
		{
			alpha = 255;
			width = 40;
			height = 40;
			aiStyle = 91;
			friendly = true;
			magic = true;
			MaxUpdates = 3;
			penetrate = 3;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 497)
		{
			width = 30;
			height = 30;
			aiStyle = 2;
			friendly = true;
			penetrate = 3;
			melee = true;
		}
		else if (type == 498)
		{
			width = 6;
			height = 6;
			aiStyle = 1;
			hostile = true;
			penetrate = -1;
			timeLeft = 180;
		}
		else if (type == 501)
		{
			width = 14;
			height = 14;
			aiStyle = 2;
			scale = 1.1f;
			hostile = true;
			ranged = true;
		}
		else if (type == 502)
		{
			width = 16;
			height = 16;
			aiStyle = 8;
			friendly = true;
			melee = true;
			penetrate = 5;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 10;
		}
		else if (type == 503)
		{
			width = 24;
			height = 24;
			aiStyle = 5;
			friendly = true;
			penetrate = 2;
			alpha = 255;
			tileCollide = false;
			melee = true;
			extraUpdates = 1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 15;
		}
		else if (type == 504)
		{
			width = 10;
			height = 10;
			aiStyle = 2;
			friendly = true;
			melee = true;
			alpha = 255;
			penetrate = 2;
			noEnchantmentVisuals = true;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 507)
		{
			width = 16;
			height = 16;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			penetrate = 3;
		}
		else if (type == 508)
		{
			width = 16;
			height = 16;
			aiStyle = 1;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 509)
		{
			width = 22;
			height = 22;
			DefaultToDrillOrChainsaw();
			scale = 1.2f;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 510)
		{
			width = 18;
			height = 18;
			aiStyle = 2;
			friendly = true;
			penetrate = 1;
			magic = true;
		}
		else if (type == 511)
		{
			width = 32;
			height = 32;
			aiStyle = 92;
			friendly = true;
			penetrate = -1;
			scale = 1.1f;
			magic = true;
		}
		else if (type == 512)
		{
			width = 40;
			height = 38;
			aiStyle = 92;
			friendly = true;
			penetrate = -1;
			scale = 1.1f;
			magic = true;
		}
		else if (type == 513)
		{
			width = 30;
			height = 28;
			aiStyle = 92;
			friendly = true;
			penetrate = -1;
			scale = 1.1f;
			magic = true;
		}
		else if (type == 514)
		{
			width = 10;
			height = 10;
			aiStyle = 93;
			friendly = true;
			penetrate = 3;
			alpha = 255;
			ranged = true;
		}
		else if (type == 515)
		{
			netImportant = true;
			width = 6;
			height = 6;
			aiStyle = 14;
			penetrate = -1;
			alpha = 75;
			light = 1f;
			timeLeft *= 5;
		}
		else if (type == 516)
		{
			width = 22;
			height = 22;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
		}
		else if (type == 517)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 518)
		{
			width = 32;
			height = 32;
			aiStyle = 94;
			friendly = true;
			alpha = 255;
			tileCollide = false;
			ignoreWater = true;
		}
		else if (type == 519)
		{
			width = 24;
			height = 24;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
		}
		else if (type == 520)
		{
			width = 22;
			height = 22;
			aiStyle = 2;
			friendly = true;
			penetrate = 3;
			ranged = true;
			coldDamage = true;
		}
		else if (type == 521)
		{
			width = 14;
			height = 14;
			aiStyle = 29;
			alpha = 255;
			magic = true;
			penetrate = 1;
			friendly = true;
			extraUpdates = 1;
		}
		else if (type == 522)
		{
			width = 8;
			height = 8;
			aiStyle = 29;
			alpha = 255;
			magic = true;
			penetrate = 1;
			friendly = true;
		}
		else if (type == 523)
		{
			width = 32;
			height = 32;
			aiStyle = 95;
			alpha = 255;
			ranged = true;
			penetrate = 1;
			friendly = true;
		}
		else if (type == 524)
		{
			width = 10;
			height = 10;
			aiStyle = 96;
			friendly = true;
			alpha = 255;
			penetrate = 5;
			ignoreWater = true;
			melee = true;
			extraUpdates = 5;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 525)
		{
			width = 30;
			height = 24;
			aiStyle = 97;
			tileCollide = false;
			timeLeft = 10800;
			drawLayer = 3;
		}
		else if (type == 526)
		{
			width = 8;
			height = 8;
			aiStyle = 98;
			tileCollide = false;
			timeLeft = 120;
			alpha = 255;
		}
		else if (type >= 527 && type <= 531)
		{
			knockBack = 12f;
			width = 24;
			height = 24;
			aiStyle = 17;
			penetrate = -1;
			if (Main.getGoodWorld)
			{
				friendly = true;
				hostile = true;
			}
		}
		else if (type == 532)
		{
			width = 16;
			height = 16;
			aiStyle = 1;
			scale = 1f;
			friendly = true;
			penetrate = 3;
			extraUpdates = 1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 5;
			armorPenetration = 25;
		}
		else if (type == 533)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 66;
			penetrate = -1;
			timeLeft *= 5;
			minion = true;
			minionSlots = 1f;
			tileCollide = false;
			ignoreWater = true;
			friendly = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 12;
		}
		else if (type == 534)
		{
			extraUpdates = 0;
			width = 16;
			height = 16;
			DefaultToYoyo();
			scale = 1f;
		}
		else if (type >= 541 && type <= 555)
		{
			extraUpdates = 0;
			width = 16;
			height = 16;
			DefaultToYoyo();
			scale = 1f;
			if (type == 547)
			{
				scale = 1.1f;
			}
			if (type == 554)
			{
				scale = 1.2f;
			}
			if (type == 555)
			{
				scale = 1.15f;
			}
			if (type == 551 || type == 550)
			{
				scale = 1.1f;
			}
		}
		else if (type >= 562 && type <= 564)
		{
			extraUpdates = 0;
			width = 16;
			height = 16;
			DefaultToYoyo();
			scale = 1f;
			if (type == 563)
			{
				scale = 1.05f;
			}
			if (type == 564)
			{
				scale = 1.075f;
			}
		}
		else if (type == 603)
		{
			extraUpdates = 0;
			width = 16;
			height = 16;
			DefaultToYoyo();
			scale = 1.15f;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 604)
		{
			extraUpdates = 0;
			width = 14;
			height = 14;
			aiStyle = 115;
			friendly = true;
			penetrate = -1;
			melee = true;
			scale = 1.2f;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if ((type >= 556 && type <= 561) || type == 1079)
		{
			extraUpdates = 1;
			width = 10;
			height = 10;
			DefaultToYoyo();
			drawLayer = 0;
			scale = 1f;
			counterweight = true;
		}
		else if (type == 535)
		{
			width = 18;
			height = 18;
			aiStyle = 100;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			drawLayer = 8;
			usesOwnerLight = true;
			magic = true;
			ignoreWater = true;
		}
		else if (type == 536)
		{
			width = 10;
			height = 10;
			aiStyle = 101;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			drawLayer = 7;
			usesOwnerLight = true;
			magic = true;
			ignoreWater = true;
		}
		else if (type == 537)
		{
			width = 22;
			height = 22;
			aiStyle = 84;
			hostile = true;
			penetrate = -1;
			alpha = 255;
			timeLeft = 240;
			tileCollide = false;
		}
		else if (type == 538)
		{
			width = 12;
			height = 12;
			aiStyle = 14;
			hostile = true;
			penetrate = -1;
			timeLeft = 120;
			extraUpdates = 1;
			alpha = 255;
		}
		else if (type == 539)
		{
			width = 18;
			height = 30;
			aiStyle = 102;
			hostile = true;
			penetrate = -1;
			timeLeft = 600;
		}
		else if (type == 540)
		{
			width = 20;
			height = 20;
			aiStyle = 103;
			hostile = true;
			penetrate = -1;
			timeLeft = 300;
			alpha = 255;
		}
		else if (type == 565)
		{
			width = 28;
			height = 28;
			aiStyle = 104;
			penetrate = -1;
			tileCollide = false;
			ignoreWater = true;
			alpha = 255;
			scale = 0.8f;
		}
		else if (type == 566)
		{
			width = 16;
			height = 16;
			aiStyle = 36;
			friendly = true;
			penetrate = 4;
			alpha = 255;
			timeLeft = 660;
			extraUpdates = 3;
			noEnchantmentVisuals = true;
		}
		else if (type == 567 || type == 568)
		{
			if (type == 567)
			{
				width = 14;
				height = 14;
			}
			else
			{
				width = 16;
				height = 16;
			}
			aiStyle = 105;
			friendly = true;
			penetrate = 1;
			alpha = 255;
			timeLeft = 3600;
			tileCollide = false;
			ignoreWater = true;
			usesIDStaticNPCImmunity = true;
		}
		else if (type >= 569 && type <= 571)
		{
			width = 32;
			height = 32;
			aiStyle = 106;
			friendly = true;
			penetrate = -1;
			alpha = 255;
			timeLeft = 3600;
			tileCollide = false;
			ignoreWater = true;
		}
		else if (type == 575)
		{
			width = 24;
			height = 24;
			aiStyle = 107;
			hostile = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft = 420;
			alpha = 255;
		}
		else if (type == 573)
		{
			width = 18;
			height = 30;
			aiStyle = 102;
			hostile = true;
			penetrate = -1;
			timeLeft = 600;
		}
		else if (type == 574)
		{
			width = 18;
			height = 18;
			aiStyle = 102;
			hostile = true;
			timeLeft = 600;
			tileCollide = false;
		}
		else if (type == 572)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
		}
		else if (type == 576)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			hostile = true;
			penetrate = -1;
			alpha = 255;
			extraUpdates = 2;
			scale = 1.2f;
			timeLeft = 600;
		}
		else if (type == 577)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			hostile = true;
			penetrate = -1;
			alpha = 255;
			extraUpdates = 2;
			scale = 1.2f;
			timeLeft = 600;
		}
		else if (type == 578 || type == 579 || type == 813)
		{
			width = 32;
			height = 32;
			aiStyle = 108;
			friendly = true;
			alpha = 255;
			tileCollide = false;
			ignoreWater = true;
			hostile = true;
			drawLayer = 1;
		}
		else if (type == 580)
		{
			width = 14;
			height = 14;
			aiStyle = 88;
			hostile = true;
			alpha = 255;
			ignoreWater = true;
			tileCollide = true;
			extraUpdates = 4;
			timeLeft = 600;
		}
		else if (type == 581)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
		}
		else if (type == 582)
		{
			width = 20;
			height = 20;
			aiStyle = 109;
			friendly = true;
			penetrate = -1;
			MaxUpdates = 2;
		}
		else if (type == 583)
		{
			width = 10;
			height = 10;
			aiStyle = 2;
			friendly = true;
			scale = 0.8f;
		}
		else if (type == 589)
		{
			width = 10;
			height = 10;
			aiStyle = 2;
			friendly = true;
		}
		else if (type == 584)
		{
			width = 10;
			height = 10;
			aiStyle = 110;
			friendly = true;
			scale = 0.8f;
			penetrate = 3;
		}
		else if (type == 585)
		{
			width = 26;
			height = 26;
			aiStyle = 1;
			alpha = 255;
			friendly = true;
			penetrate = 3;
		}
		else if (type == 586)
		{
			width = 26;
			height = 26;
			aiStyle = 111;
			alpha = 255;
			friendly = true;
			penetrate = -1;
		}
		else if (type == 587)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			alpha = 255;
			friendly = true;
			ranged = true;
		}
		else if (type == 588)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 590)
		{
			width = 14;
			height = 14;
			aiStyle = 112;
			friendly = true;
			penetrate = 1;
			alpha = 255;
			timeLeft = 900;
			tileCollide = false;
			ignoreWater = true;
		}
		else if (type == 591)
		{
			width = 8;
			height = 8;
			aiStyle = 101;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			drawLayer = 7;
			usesOwnerLight = true;
			ignoreWater = true;
		}
		else if (type == 592)
		{
			width = 8;
			height = 8;
			aiStyle = 1;
			hostile = true;
			alpha = 255;
			extraUpdates = 3;
			ignoreWater = true;
		}
		else if (type == 593)
		{
			width = 16;
			height = 16;
			aiStyle = 1;
			hostile = true;
			alpha = 255;
			extraUpdates = 1;
			ignoreWater = true;
		}
		else if (type == 594)
		{
			width = 40;
			height = 40;
			aiStyle = 1;
			alpha = 255;
			extraUpdates = 2;
		}
		else if (type == 595)
		{
			width = 68;
			height = 64;
			aiStyle = 75;
			drawLayer = 7;
			friendly = true;
			tileCollide = false;
			melee = true;
			penetrate = -1;
			ownerHitCheck = true;
			armorPenetration = 20;
		}
		else if (type == 596)
		{
			width = 8;
			height = 8;
			aiStyle = 107;
			hostile = true;
			alpha = 255;
			ignoreWater = true;
			timeLeft = 180;
			tileCollide = false;
		}
		else if (type == 597)
		{
			width = 10;
			height = 10;
			aiStyle = 29;
			alpha = 255;
			magic = true;
			penetrate = 2;
			friendly = true;
		}
		else if (type == 598)
		{
			width = 16;
			height = 16;
			aiStyle = 113;
			friendly = true;
			ranged = true;
			penetrate = -1;
			alpha = 255;
			drawLayer = 3;
		}
		else if (type == 599)
		{
			width = 22;
			height = 22;
			aiStyle = 2;
			friendly = true;
			penetrate = 6;
			ranged = true;
		}
		else if (type == 600)
		{
			width = 14;
			height = 14;
			aiStyle = 75;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			drawLayer = 8;
			usesOwnerLight = true;
			ignoreWater = true;
		}
		else if (type == 601)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			alpha = 255;
			friendly = true;
			extraUpdates = 30;
		}
		else if (type == 602)
		{
			width = 10;
			height = 10;
			aiStyle = 114;
			alpha = 255;
			friendly = true;
			tileCollide = false;
			netImportant = true;
		}
		else if (type == 605)
		{
			alpha = 255;
			width = 6;
			height = 6;
			aiStyle = 1;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 606)
		{
			width = 5;
			height = 5;
			aiStyle = 1;
			friendly = true;
			alpha = 255;
			extraUpdates = 2;
			scale = 1f;
			timeLeft = 600;
			ignoreWater = true;
		}
		else if (type == 607)
		{
			width = 10;
			height = 10;
			aiStyle = 116;
			friendly = true;
			alpha = 255;
			timeLeft = 600;
			ignoreWater = true;
			tileCollide = false;
			penetrate = -1;
		}
		else if (type == 608)
		{
			width = 160;
			height = 160;
			aiStyle = 117;
			friendly = true;
			alpha = 255;
			timeLeft = 3;
			ignoreWater = true;
			tileCollide = false;
			penetrate = -1;
			hide = true;
		}
		else if (type == 611)
		{
			width = 16;
			height = 16;
			aiStyle = 75;
			friendly = true;
			melee = true;
			penetrate = -1;
			alpha = 255;
			drawLayer = 7;
			usesOwnerLight = true;
			tileCollide = false;
			ignoreWater = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 6;
			noEnchantmentVisuals = true;
		}
		else if (type == 612)
		{
			width = 8;
			height = 8;
			aiStyle = 117;
			friendly = true;
			alpha = 255;
			ignoreWater = true;
			timeLeft = 60;
			tileCollide = false;
			penetrate = -1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 6;
		}
		else if (type == 613)
		{
			netImportant = true;
			width = 24;
			height = 24;
			aiStyle = 62;
			penetrate = -1;
			timeLeft *= 5;
			minion = true;
			friendly = true;
			minionSlots = 1f;
			ignoreWater = true;
		}
		else if (type == 614)
		{
			width = 16;
			height = 16;
			aiStyle = 113;
			friendly = true;
			penetrate = -1;
			alpha = 255;
		}
		else if (type == 615)
		{
			width = 22;
			height = 22;
			aiStyle = 75;
			penetrate = -1;
			tileCollide = false;
			drawLayer = 7;
			usesOwnerLight = true;
			ranged = true;
			ignoreWater = true;
		}
		else if (type == 616)
		{
			width = 14;
			height = 14;
			aiStyle = 1;
			friendly = true;
			penetrate = 1;
			alpha = 255;
			ranged = true;
			extraUpdates = 2;
			timeLeft = 90 * MaxUpdates;
		}
		else if (type == 617)
		{
			width = 32;
			height = 32;
			aiStyle = 118;
			friendly = true;
			alpha = 255;
			ignoreWater = true;
			drawLayer = 1;
			magic = true;
			penetrate = 3;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 8;
		}
		else if (type == 618)
		{
			tileCollide = false;
			width = 18;
			height = 30;
			aiStyle = 119;
			penetrate = -1;
			timeLeft = 420;
			magic = true;
			friendly = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 20;
		}
		else if (type == 619)
		{
			width = 14;
			height = 14;
			aiStyle = 29;
			alpha = 255;
			magic = true;
			penetrate = 1;
			friendly = true;
		}
		else if (type == 620)
		{
			width = 8;
			height = 8;
			aiStyle = 29;
			alpha = 255;
			magic = true;
			penetrate = 1;
			friendly = true;
		}
		else if (type == 622)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			alpha = 255;
			extraUpdates = 2;
		}
		else if (type == 623)
		{
			netImportant = true;
			width = 50;
			height = 80;
			aiStyle = 120;
			penetrate = -1;
			timeLeft *= 5;
			minion = true;
			friendly = true;
			minionSlots = 0f;
			ignoreWater = true;
			tileCollide = false;
			netImportant = true;
			manualDirectionChange = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 5;
		}
		else if (type == 624)
		{
			width = 8;
			height = 8;
			aiStyle = 117;
			friendly = true;
			alpha = 255;
			ignoreWater = true;
			timeLeft = 60;
			tileCollide = false;
			penetrate = -1;
		}
		else if (type >= 625 && type <= 628)
		{
			if (type == 625 || type == 628)
			{
				netImportant = true;
			}
			if (type == 626 || type == 627)
			{
				minionSlots = 0.5f;
			}
			width = 24;
			height = 24;
			aiStyle = 121;
			penetrate = -1;
			timeLeft *= 5;
			minion = true;
			friendly = true;
			ignoreWater = true;
			tileCollide = false;
			alpha = 255;
			drawLayer = 3;
			netImportant = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 7;
		}
		else if (type == 629)
		{
			width = 8;
			height = 8;
			aiStyle = 122;
			hostile = true;
			alpha = 255;
			ignoreWater = true;
			timeLeft = 3600;
			tileCollide = false;
			penetrate = -1;
			extraUpdates = 2;
		}
		else if (type == 630 || type == 705)
		{
			width = 22;
			height = 22;
			aiStyle = 75;
			penetrate = -1;
			tileCollide = false;
			drawLayer = 7;
			usesOwnerLight = true;
			ranged = true;
			ignoreWater = true;
		}
		else if (type == 631)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 122;
			friendly = true;
			ranged = true;
			tileCollide = false;
			alpha = 255;
			ignoreWater = true;
			extraUpdates = 1;
			timeLeft = 1200;
		}
		else if (type == 633)
		{
			width = 14;
			height = 18;
			aiStyle = 75;
			drawLayer = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			magic = true;
			ignoreWater = true;
		}
		else if (type == 632)
		{
			width = 18;
			height = 18;
			aiStyle = 84;
			friendly = true;
			magic = true;
			penetrate = -1;
			alpha = 255;
			tileCollide = false;
		}
		else if (type == 634)
		{
			width = 40;
			height = 40;
			aiStyle = 1;
			friendly = true;
			alpha = 255;
			ignoreWater = true;
			extraUpdates = 2;
			magic = true;
		}
		else if (type == 635)
		{
			width = 40;
			height = 40;
			aiStyle = 1;
			friendly = true;
			alpha = 255;
			friendly = true;
			extraUpdates = 3;
			magic = true;
		}
		else if (type == 636)
		{
			width = 16;
			height = 16;
			aiStyle = 113;
			friendly = true;
			melee = true;
			penetrate = -1;
			alpha = 255;
			drawLayer = 3;
			MaxUpdates = 2;
		}
		else if (type == 637)
		{
			width = 10;
			height = 10;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
		}
		else if (type == 638)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			alpha = 255;
			extraUpdates = 5;
			timeLeft = 600;
			ranged = true;
			ignoreWater = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			penetrate = -1;
		}
		else if (type == 639)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			MaxUpdates = 2;
			timeLeft = MaxUpdates * 45;
			ignoreWater = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			alpha = 255;
			penetrate = 4;
		}
		else if (type == 640)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			MaxUpdates = 3;
			timeLeft = 90;
			ignoreWater = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			alpha = 255;
			penetrate = 4;
		}
		else if (type == 642)
		{
			width = 18;
			height = 18;
			aiStyle = 84;
			friendly = true;
			penetrate = -1;
			alpha = 255;
			tileCollide = false;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 10;
		}
		else if (type == 641)
		{
			width = 32;
			height = 32;
			aiStyle = 123;
			timeLeft = 36000;
			ignoreWater = true;
			tileCollide = false;
			alpha = 255;
			drawLayer = 1;
			sentry = true;
			netImportant = true;
		}
		else if (type == 643)
		{
			width = 32;
			height = 32;
			aiStyle = 123;
			timeLeft = 36000;
			ignoreWater = true;
			tileCollide = false;
			alpha = 255;
			sentry = true;
			netImportant = true;
		}
		else if (type == 644)
		{
			width = 14;
			height = 14;
			aiStyle = 112;
			penetrate = 1;
			timeLeft = 900;
			tileCollide = false;
			ignoreWater = true;
			alpha = 255;
			usesIDStaticNPCImmunity = true;
		}
		else if (type == 645)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			magic = true;
			tileCollide = false;
			extraUpdates = 5;
			penetrate = -1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type >= 646 && type <= 649)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
		}
		else if (type == 650)
		{
			width = 20;
			height = 20;
			aiStyle = 124;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			friendly = true;
			ignoreWater = true;
			tileCollide = false;
			manualDirectionChange = true;
		}
		else if (type == 651)
		{
			width = 10;
			height = 10;
			aiStyle = 125;
			friendly = true;
			ignoreWater = true;
			tileCollide = false;
			penetrate = -1;
			drawLayer = 5;
		}
		else if (type == 652)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
		}
		else if (type == 653)
		{
			width = 30;
			height = 30;
			aiStyle = 67;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			friendly = true;
			ignoreWater = true;
			scale = 0.8f;
		}
		else if (type == 654)
		{
			width = 30;
			height = 30;
			aiStyle = 126;
			alpha = 255;
			tileCollide = false;
			ignoreWater = true;
			timeLeft = 120;
			friendly = true;
			hostile = true;
			penetrate = -1;
			trap = true;
		}
		else if (type == 655)
		{
			width = 31;
			height = 31;
			aiStyle = 25;
			friendly = true;
			hostile = true;
			penetrate = -1;
			trap = true;
		}
		else if (type == 656)
		{
			width = 10;
			height = 10;
			aiStyle = 127;
			friendly = true;
			magic = true;
			tileCollide = false;
			penetrate = -1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 8;
			timeLeft = 1200;
		}
		else if (type == 657)
		{
			width = 10;
			height = 10;
			aiStyle = 127;
			hostile = true;
			tileCollide = false;
			penetrate = -1;
			timeLeft = 1200;
		}
		else if (type == 658)
		{
			width = 14;
			height = 14;
			aiStyle = 128;
			penetrate = 1;
			timeLeft = 900;
			tileCollide = false;
			ignoreWater = true;
			alpha = 255;
			hostile = true;
		}
		else if (type == 659)
		{
			width = 8;
			height = 8;
			aiStyle = 129;
			friendly = true;
			magic = true;
			alpha = 255;
			ignoreWater = true;
			timeLeft = 240;
			tileCollide = false;
			penetrate = -1;
		}
		else if (type == 660)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			alpha = 255;
			timeLeft = 600;
			magic = true;
			ignoreWater = true;
			extraUpdates = 1;
		}
		else if (type == 661)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			alpha = 255;
			timeLeft = 40;
			extraUpdates = 1;
			ranged = true;
			ignoreWater = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 662 || type == 685)
		{
			width = 16;
			height = 16;
			aiStyle = 1;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 663 || type == 665 || type == 667)
		{
			width = 30;
			height = 54;
			aiStyle = 130;
			timeLeft = 36000;
			ignoreWater = true;
			tileCollide = false;
			manualDirectionChange = true;
			switch (type)
			{
			case 665:
				height = 58;
				width = 28;
				break;
			case 667:
				height = 60;
				width = 28;
				break;
			}
			sentry = true;
			netImportant = true;
		}
		else if (type == 664 || type == 666 || type == 668)
		{
			width = 16;
			height = 16;
			aiStyle = 131;
			friendly = true;
			alpha = 255;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 669)
		{
			width = 14;
			height = 14;
			aiStyle = 68;
			friendly = true;
			alpha = 255;
			melee = true;
			noEnchantmentVisuals = true;
			penetrate = -1;
		}
		else if (type == 670)
		{
			width = 30;
			height = 30;
			aiStyle = 126;
			alpha = 255;
			tileCollide = false;
			ignoreWater = true;
			timeLeft = 120;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 671)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
		}
		else if (type == 672)
		{
			width = 10;
			height = 10;
			aiStyle = 132;
			alpha = 255;
			tileCollide = false;
			ignoreWater = true;
			timeLeft = 900;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 674 || type == 673)
		{
			width = 10;
			height = 10;
			aiStyle = 133;
			alpha = 255;
			tileCollide = false;
			ignoreWater = true;
			timeLeft = 900;
			hostile = true;
			penetrate = -1;
			drawLayer = 2;
		}
		else if (type == 675)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
		}
		else if (type == 676)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
		}
		else if (type == 677 || type == 678 || type == 679)
		{
			width = 26;
			height = 54;
			aiStyle = 134;
			timeLeft = 36000;
			ignoreWater = true;
			tileCollide = false;
			manualDirectionChange = true;
			sentry = true;
			netImportant = true;
		}
		else if (type == 680)
		{
			width = 16;
			height = 16;
			aiStyle = 1;
			friendly = true;
			penetrate = 4;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 681)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			hostile = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 682)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			hostile = true;
			ignoreWater = true;
			timeLeft = 30;
			scale = 1.2f;
		}
		else if (type == 683)
		{
			width = 30;
			height = 30;
			aiStyle = 135;
			alpha = 255;
			tileCollide = false;
			ignoreWater = true;
			timeLeft = 120;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 684)
		{
			width = 16;
			height = 16;
			aiStyle = 1;
			melee = true;
			penetrate = 5;
			alpha = 255;
			friendly = true;
			tileCollide = false;
		}
		else if (type == 686)
		{
			width = 30;
			height = 30;
			aiStyle = 1;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
		}
		else if (type == 687)
		{
			width = 30;
			height = 30;
			aiStyle = 136;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
		}
		else if (type == 688 || type == 689 || type == 690)
		{
			width = 16;
			height = 16;
			aiStyle = 137;
			friendly = true;
			ignoreWater = true;
			usesLocalNPCImmunity = true;
			timeLeft = 36000;
			localNPCHitCooldown = 3;
			tileCollide = false;
			penetrate = -1;
			sentry = true;
			netImportant = true;
		}
		else if (type == 691 || type == 692 || type == 693)
		{
			width = 16;
			height = 16;
			aiStyle = 138;
			ignoreWater = true;
			friendly = true;
			timeLeft = 36000;
			tileCollide = false;
			penetrate = -1;
			drawLayer = 2;
			sentry = true;
			netImportant = true;
		}
		else if (type == 694 || type == 695 || type == 696)
		{
			aiStyle = 139;
			friendly = true;
			tileCollide = false;
			penetrate = -1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 30;
			alpha = 255;
			width = 144;
			height = 144;
		}
		else if (type == 697)
		{
			width = 16;
			height = 16;
			aiStyle = 140;
			friendly = true;
			melee = true;
			scale = 1.35f;
			penetrate = -1;
			alpha = 255;
			drawLayer = 7;
			usesOwnerLight = true;
			tileCollide = false;
			ignoreWater = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 12;
			ownerHitCheck = true;
		}
		else if (type == 698)
		{
			width = 50;
			height = 200;
			aiStyle = 141;
			alpha = 255;
			tileCollide = false;
			ignoreWater = true;
			timeLeft = 120;
			friendly = true;
			penetrate = -1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			melee = true;
		}
		else if (type == 699)
		{
			width = 24;
			height = 24;
			aiStyle = 142;
			friendly = true;
			melee = true;
			penetrate = -1;
			alpha = 255;
			drawLayer = 7;
			usesOwnerLight = true;
			tileCollide = false;
			ignoreWater = true;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
			ownerHitCheck = true;
		}
		else if (type == 700)
		{
			width = 40;
			height = 40;
			aiStyle = 143;
			alpha = 255;
			penetrate = -1;
			friendly = true;
			melee = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			ignoreWater = true;
			tileCollide = false;
		}
		else if (type == 703 || type == 701 || type == 702)
		{
			width = 20;
			height = 20;
			aiStyle = 144;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			scale = 1f;
			friendly = true;
			ignoreWater = true;
			tileCollide = false;
			manualDirectionChange = true;
		}
		else if (type == 704)
		{
			width = 60;
			height = 210;
			aiStyle = 145;
			friendly = true;
			magic = true;
			tileCollide = false;
			penetrate = -1;
			usesLocalNPCImmunity = true;
			timeLeft = 600;
			localNPCHitCooldown = -1;
			ignoreWater = true;
		}
		else if (type == 706)
		{
			width = 66;
			height = 66;
			aiStyle = 1;
			friendly = true;
			alpha = 255;
			timeLeft = 300;
			ranged = true;
			usesLocalNPCImmunity = true;
			penetrate = -1;
			localNPCHitCooldown = 10;
		}
		else if (type == 707)
		{
			width = 16;
			height = 16;
			aiStyle = 140;
			friendly = true;
			melee = true;
			penetrate = -1;
			alpha = 255;
			drawLayer = 7;
			usesOwnerLight = true;
			tileCollide = false;
			ignoreWater = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 6;
			ownerHitCheck = true;
		}
		else if (type == 708)
		{
			width = 24;
			height = 24;
			aiStyle = 142;
			friendly = true;
			melee = true;
			penetrate = -1;
			alpha = 255;
			drawLayer = 7;
			usesOwnerLight = true;
			tileCollide = false;
			ignoreWater = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 6;
			ownerHitCheck = true;
		}
		else if (type == 709)
		{
			width = 12;
			height = 12;
			aiStyle = 1;
			friendly = true;
			melee = true;
			alpha = 255;
			ignoreWater = true;
			extraUpdates = 1;
			noEnchantmentVisuals = true;
			scale = 0.6f;
		}
		else if (type == 710)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			ignoreWater = true;
			extraUpdates = 1;
			timeLeft = extraUpdates * 60 * 5;
			usesLocalNPCImmunity = true;
			alpha = 255;
			localNPCHitCooldown = -1;
		}
		else if (type == 711)
		{
			width = 30;
			height = 30;
			aiStyle = 1;
			alpha = 255;
			friendly = true;
			magic = true;
			extraUpdates = 1;
			scale = 0.7f;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 712)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			alpha = 255;
			timeLeft = 600;
			magic = true;
			extraUpdates = 1;
		}
		else if (type == 713)
		{
			width = 10;
			height = 10;
			aiStyle = 146;
			alpha = 255;
			tileCollide = false;
			ignoreWater = true;
			timeLeft = 900;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 714)
		{
			width = 22;
			height = 22;
			aiStyle = 75;
			penetrate = -1;
			tileCollide = false;
			drawLayer = 7;
			usesOwnerLight = true;
			ranged = true;
			ignoreWater = true;
		}
		else if (type == 715 || type == 717)
		{
			width = 14;
			height = 14;
			aiStyle = 147;
			friendly = true;
			penetrate = 1;
			alpha = 255;
			ranged = true;
			extraUpdates = 2;
			timeLeft = 360 * MaxUpdates;
		}
		else if (type == 716 || type == 718)
		{
			width = 14;
			height = 14;
			aiStyle = 147;
			friendly = true;
			penetrate = 1;
			alpha = 255;
			ranged = true;
			extraUpdates = 2;
			timeLeft = 360 * MaxUpdates;
		}
		else if (type == 719)
		{
			width = 10;
			height = 10;
			hostile = true;
			penetrate = -1;
			aiStyle = 1;
			tileCollide = true;
		}
		else if (type == 720)
		{
			width = 16;
			height = 16;
			aiStyle = 148;
			tileCollide = false;
			penetrate = -1;
			alpha = 255;
		}
		else if (type == 721 || type == 739 || type == 740 || type == 741 || type == 742 || type == 743 || type == 744 || type == 745 || type == 746 || type == 747 || type == 748 || type == 749 || type == 750 || type == 751 || type == 752)
		{
			netImportant = true;
			width = 7;
			height = 7;
			friendly = true;
			penetrate = -1;
			aiStyle = 149;
			tileCollide = false;
		}
		else if (type == 722)
		{
			width = 2;
			height = 2;
			aiStyle = 150;
			tileCollide = false;
			ignoreWater = true;
			penetrate = -1;
			hide = true;
		}
		else if (type == 723 || type == 724 || type == 725 || type == 726)
		{
			width = 24;
			height = 24;
			aiStyle = 5;
			friendly = true;
			penetrate = 2;
			alpha = 50;
			tileCollide = false;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 10;
			armorPenetration = 25;
		}
		else if (type == 728)
		{
			width = 24;
			height = 24;
			aiStyle = 151;
			alpha = 255;
			tileCollide = true;
			ranged = true;
			friendly = true;
			penetrate = -1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 729)
		{
			width = 20;
			height = 20;
			aiStyle = 152;
			friendly = true;
			tileCollide = false;
			ignoreWater = true;
			ranged = true;
			penetrate = -1;
			scale = 1f + (float)Main.rand.Next(30) * 0.01f;
			extraUpdates = 2;
			timeLeft = 10 * MaxUpdates;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 730)
		{
			width = 18;
			height = 18;
			DefaultToSpear();
		}
		else if (type == 731)
		{
			width = 10;
			height = 10;
			aiStyle = 29;
			alpha = 255;
			magic = true;
			friendly = true;
			extraUpdates = 1;
			timeLeft = 90;
		}
		else if (type == 732)
		{
			tileCollide = true;
			width = 15;
			height = 15;
			aiStyle = 44;
			friendly = true;
			penetrate = 1;
			melee = true;
			noEnchantmentVisuals = true;
		}
		else if (type == 733)
		{
			width = 2;
			height = 2;
			aiStyle = 153;
			tileCollide = false;
			ignoreWater = true;
			penetrate = -1;
			alpha = 255;
		}
		else if (type == 734)
		{
			width = 30;
			height = 24;
			aiStyle = 154;
			tileCollide = false;
			timeLeft = 10800;
			alpha = 255;
			drawLayer = 3;
		}
		else if (type == 735)
		{
			width = 68;
			height = 64;
			aiStyle = 75;
			drawLayer = 7;
			friendly = true;
			tileCollide = false;
			melee = true;
			penetrate = -1;
			ownerHitCheck = true;
		}
		else if (type == 736 || type == 737 || type == 738)
		{
			knockBack = 6f;
			width = 10;
			height = 10;
			aiStyle = 10;
			penetrate = -1;
		}
		else if (type == 753)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
		}
		else if (type == 754)
		{
			width = 16;
			height = 16;
			aiStyle = 155;
			tileCollide = false;
			ignoreWater = true;
			penetrate = -1;
			alpha = 255;
		}
		else if (type == 755)
		{
			netImportant = true;
			width = 10;
			height = 10;
			penetrate = -1;
			ignoreWater = true;
			tileCollide = false;
			friendly = true;
			minion = true;
			minionSlots = 1f;
			timeLeft *= 5;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			aiStyle = 156;
		}
		else if (type == 756)
		{
			width = 32;
			height = 32;
			aiStyle = 157;
			friendly = true;
			alpha = 255;
			magic = true;
			tileCollide = false;
			ignoreWater = true;
			penetrate = 4;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 25;
		}
		else if (type == 757)
		{
			netImportant = true;
			width = 34;
			height = 34;
			DefaultToFlail();
		}
		else if (type == 758)
		{
			width = 20;
			height = 30;
			aiStyle = 67;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			minion = true;
			minionSlots = 1f;
			friendly = true;
			decidesManualFallThrough = true;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 759)
		{
			netImportant = true;
			width = 10;
			height = 10;
			penetrate = -1;
			ignoreWater = true;
			tileCollide = true;
			friendly = true;
			minion = true;
			minionSlots = 1f;
			timeLeft *= 5;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 15;
			aiStyle = 158;
			drawLayer = 4;
		}
		else if (type == 761 || type == 762)
		{
			width = 10;
			height = 10;
			aiStyle = 159;
			friendly = true;
			ranged = true;
			manualDirectionChange = true;
		}
		else if (type == 763)
		{
			width = 10;
			height = 10;
			hostile = true;
			friendly = true;
			penetrate = -1;
			aiStyle = 1;
			tileCollide = true;
			extraUpdates = 1;
		}
		else if (type == 764)
		{
			width = 20;
			height = 20;
			aiStyle = 144;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			friendly = true;
			ignoreWater = true;
			tileCollide = false;
			manualDirectionChange = true;
		}
		else if (type == 765)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if ((type >= 766 && type <= 770) || type == 771)
		{
			DefaultToKite();
		}
		else if (type == 772)
		{
			width = 22;
			height = 22;
			friendly = true;
			aiStyle = 1;
			tileCollide = true;
			extraUpdates = 1;
		}
		else if (type == 773)
		{
			width = 22;
			height = 22;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
		}
		else if (type == 774)
		{
			netImportant = true;
			width = 26;
			height = 26;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 802)
		{
			DefaultToShortsword();
		}
		else if (type == 811 || type == 814)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
			if (type == 814)
			{
				tileCollide = false;
			}
		}
		else if ((type >= 776 && type <= 801) || (type >= 803 && type <= 810))
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
			if (type == 777 || type == 781 || type == 794 || type == 797 || type == 800 || type == 785 || type == 788 || type == 800)
			{
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
			}
		}
		else if (type == 812)
		{
			knockBack = 6f;
			width = 10;
			height = 10;
			aiStyle = 10;
			friendly = true;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 815)
		{
			netImportant = true;
			width = 26;
			height = 26;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 816)
		{
			netImportant = true;
			width = 26;
			height = 32;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 817)
		{
			netImportant = true;
			width = 26;
			height = 26;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 819)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			alpha = 255;
			extraUpdates = 1;
			hide = true;
			friendly = true;
			ranged = true;
		}
		else if (type == 818)
		{
			width = 132;
			height = 132;
			aiStyle = 162;
			friendly = true;
			alpha = 255;
			tileCollide = false;
			ignoreWater = true;
			penetrate = -1;
			extraUpdates = 3;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 820)
		{
			width = 12;
			height = 12;
			friendly = true;
			aiStyle = 163;
			tileCollide = true;
			netImportant = true;
			penetrate = -1;
			timeLeft = 86400;
		}
		else if (type == 821)
		{
			netImportant = true;
			width = 20;
			height = 36;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type >= 822 && type <= 824)
		{
			netImportant = true;
			DefaultToKite();
		}
		else if (type == 825)
		{
			netImportant = true;
			width = 26;
			height = 32;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type >= 826 && type <= 830)
		{
			netImportant = true;
			DefaultToKite();
		}
		else if (type == 836)
		{
			width = 4;
			height = 4;
			aiStyle = 112;
			hostile = true;
		}
		else if (type == 831)
		{
			netImportant = true;
			width = 10;
			height = 10;
			penetrate = -1;
			ignoreWater = true;
			tileCollide = false;
			friendly = true;
			minion = true;
			minionSlots = 1f;
			timeLeft = 60;
			aiStyle = 164;
			hide = true;
		}
		else if (type == 833)
		{
			width = 26;
			height = 20;
			aiStyle = 67;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			minion = true;
			minionSlots = 0f;
			decidesManualFallThrough = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 10;
		}
		else if (type == 834)
		{
			width = 20;
			height = 30;
			aiStyle = 67;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			minion = true;
			minionSlots = 0f;
			decidesManualFallThrough = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 10;
		}
		else if (type == 835)
		{
			width = 20;
			height = 30;
			aiStyle = 67;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			minion = true;
			minionSlots = 0f;
			decidesManualFallThrough = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 10;
		}
		else if (type == 837)
		{
			width = 26;
			height = 26;
			aiStyle = 1;
			alpha = 255;
			friendly = true;
			magic = true;
			penetrate = 3;
		}
		else if (type >= 838 && type <= 840)
		{
			netImportant = true;
			DefaultToKite();
		}
		else if (type == 841)
		{
			DefaultToWhip();
		}
		else if (type == 842)
		{
			DefaultToShortsword();
		}
		else if (type >= 843 && type <= 846)
		{
			netImportant = true;
			DefaultToKite();
		}
		else if (type == 847)
		{
			DefaultToWhip();
			extraUpdates = 2;
		}
		else if (type == 848)
		{
			DefaultToWhip();
		}
		else if (type == 849)
		{
			DefaultToWhip();
			extraUpdates = 2;
		}
		else if (type == 850)
		{
			netImportant = true;
			DefaultToKite();
		}
		else if (type == 851)
		{
			netImportant = true;
			width = 4;
			height = 4;
			aiStyle = 166;
			penetrate = -1;
			timeLeft = 300;
		}
		else if (type >= 852 && type <= 853)
		{
			netImportant = true;
			DefaultToKite();
		}
		else if (type == 854)
		{
			netImportant = true;
			width = 26;
			height = 32;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 855)
		{
			netImportant = true;
			width = 12;
			height = 12;
			aiStyle = 166;
			penetrate = -1;
			timeLeft = 1000;
		}
		else if (type == 856)
		{
			width = 32;
			height = 32;
			aiStyle = 167;
			friendly = true;
			alpha = 255;
			magic = true;
			tileCollide = false;
			ignoreWater = true;
			extraUpdates = 2;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 857)
		{
			width = 32;
			height = 32;
			aiStyle = 168;
			friendly = true;
			alpha = 255;
			melee = true;
			tileCollide = false;
			ignoreWater = true;
			extraUpdates = 1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 10;
			manualDirectionChange = true;
			penetrate = -1;
			drawLayer = 6;
		}
		else if (type == 858)
		{
			netImportant = true;
			width = 26;
			height = 20;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 859)
		{
			netImportant = true;
			width = 20;
			height = 32;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 860)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 861)
		{
			netImportant = true;
			width = 10;
			height = 10;
			aiStyle = 2;
			friendly = true;
		}
		else if (type == 862 || type == 863)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 864)
		{
			netImportant = true;
			width = 10;
			height = 10;
			penetrate = -1;
			usesLocalNPCImmunity = true;
			ignoreWater = true;
			tileCollide = false;
			friendly = true;
			minion = true;
			minionSlots = 1f;
			timeLeft = 60;
			aiStyle = 169;
			localNPCHitCooldown = 10;
			armorPenetration = 25;
		}
		else if (type == 865)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
		}
		else if (type == 866)
		{
			light = 0.15f;
			width = 30;
			height = 30;
			aiStyle = 3;
			friendly = true;
			penetrate = 5;
			melee = true;
			extraUpdates = 1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 867)
		{
			width = 22;
			height = 22;
			aiStyle = 3;
			friendly = true;
			penetrate = -1;
			melee = true;
			light = 0.6f;
		}
		else if (type == 868 || type == 869)
		{
			width = 18;
			height = 18;
			aiStyle = 2;
			friendly = true;
			penetrate = 1;
		}
		else if (type == 870)
		{
			netImportant = true;
			width = 6;
			height = 6;
			aiStyle = 14;
			penetrate = -1;
			alpha = 75;
			light = 1f;
			timeLeft *= 5;
		}
		else if (type == 873)
		{
			width = 30;
			height = 30;
			aiStyle = 171;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
			timeLeft = 200;
			tileCollide = false;
			ignoreWater = true;
		}
		else if (type == 874)
		{
			width = 30;
			height = 30;
			aiStyle = 0;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
			timeLeft = 210;
			tileCollide = false;
			ignoreWater = true;
		}
		else if (type == 871)
		{
			width = 30;
			height = 30;
			aiStyle = 172;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
			timeLeft = 240;
			tileCollide = false;
			ignoreWater = true;
		}
		else if (type == 875)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 872)
		{
			width = 30;
			height = 30;
			aiStyle = 173;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
			timeLeft = 660;
			tileCollide = false;
			ignoreWater = true;
		}
		else if (type == 876)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 8;
			light = 0.75f;
			alpha = 255;
			extraUpdates = 3;
			scale = 1.4f;
			timeLeft = 3600;
			magic = true;
		}
		else if (type >= 877 && type <= 879)
		{
			netImportant = true;
			width = 25;
			height = 25;
			DefaultToSpear();
			alpha = 255;
		}
		else if (type == 880)
		{
			width = 32;
			height = 32;
			aiStyle = 183;
			penetrate = -1;
			timeLeft = 18;
			ignoreWater = true;
			tileCollide = false;
			friendly = true;
			hostile = false;
			manualDirectionChange = true;
		}
		else if (type == 881)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 882)
		{
			width = 20;
			height = 20;
			aiStyle = 124;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			friendly = true;
			ignoreWater = true;
			tileCollide = false;
			manualDirectionChange = true;
		}
		else if (type == 883)
		{
			width = 20;
			height = 20;
			aiStyle = 174;
			penetrate = -1;
			timeLeft *= 5;
			friendly = true;
			ignoreWater = true;
			tileCollide = false;
			netImportant = true;
		}
		else if (type >= 884 && type <= 886)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 887)
		{
			width = 20;
			height = 20;
			aiStyle = 174;
			penetrate = -1;
			timeLeft *= 5;
			friendly = true;
			ignoreWater = true;
			tileCollide = false;
			netImportant = true;
		}
		else if (type == 888)
		{
			width = 20;
			height = 20;
			aiStyle = 124;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			friendly = true;
			ignoreWater = true;
			tileCollide = false;
			manualDirectionChange = true;
		}
		else if (type >= 889 && type <= 892)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 893)
		{
			width = 20;
			height = 20;
			aiStyle = 174;
			penetrate = -1;
			timeLeft *= 5;
			friendly = true;
			ignoreWater = true;
			tileCollide = false;
			netImportant = true;
		}
		else if (type == 894)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type >= 895 && type <= 896)
		{
			width = 20;
			height = 20;
			aiStyle = 124;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			friendly = true;
			ignoreWater = true;
			tileCollide = false;
			manualDirectionChange = true;
		}
		else if (type == 897)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 898)
		{
			width = 20;
			height = 20;
			aiStyle = 124;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			friendly = true;
			ignoreWater = true;
			tileCollide = false;
			manualDirectionChange = true;
		}
		else if (type >= 899 && type <= 901)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 902)
		{
			width = 20;
			height = 20;
			aiStyle = 3;
			friendly = true;
			penetrate = -1;
			melee = true;
			MaxUpdates = 2;
		}
		else if (type >= 903 && type <= 906)
		{
			width = 22;
			height = 22;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
		}
		else if (type == 907)
		{
			width = 22;
			height = 22;
			aiStyle = 30;
			friendly = true;
			penetrate = 2;
			melee = true;
		}
		else if (type == 908)
		{
			tileCollide = false;
			ignoreWater = true;
			width = 14;
			height = 14;
			aiStyle = 175;
			friendly = true;
			penetrate = 1;
			timeLeft = 3600;
			drawLayer = 3;
		}
		else if (type == 909)
		{
			width = 12;
			height = 12;
			aiStyle = 2;
			friendly = false;
			hostile = true;
			penetrate = 1;
		}
		else if (type == 910)
		{
			width = 22;
			height = 22;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
		}
		else if (type == 911)
		{
			width = 22;
			height = 22;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
		}
		else if (type >= 912 && type <= 915)
		{
			DefaultToWhip();
			if (type == 915)
			{
				extraUpdates = 2;
			}
			if (type == 912)
			{
				coldDamage = true;
			}
		}
		else if (type == 916)
		{
			width = 18;
			height = 18;
			aiStyle = 176;
			friendly = true;
			tileCollide = false;
			penetrate = 3;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			extraUpdates = 2;
			armorPenetration = 50;
		}
		else if (type == 918)
		{
			aiStyle = 178;
			friendly = true;
			tileCollide = false;
			penetrate = -1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			alpha = 255;
			width = 96;
			height = 96;
		}
		else if (type == 917)
		{
			width = 30;
			height = 30;
			aiStyle = 177;
			friendly = true;
			tileCollide = false;
			penetrate = -1;
			usesLocalNPCImmunity = true;
			coldDamage = true;
			localNPCHitCooldown = 20;
			armorPenetration = 30;
		}
		else if (type == 919)
		{
			width = 8;
			height = 8;
			aiStyle = 179;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
			timeLeft = 240;
			tileCollide = false;
			ignoreWater = true;
		}
		else if (type == 920)
		{
			alpha = 255;
			width = 6;
			height = 6;
			aiStyle = 1;
			hostile = true;
			penetrate = 1;
		}
		else if (type == 921)
		{
			alpha = 255;
			width = 6;
			height = 6;
			aiStyle = 1;
			hostile = true;
			penetrate = 3;
		}
		else if (type == 922)
		{
			width = 30;
			height = 30;
			aiStyle = 135;
			alpha = 255;
			tileCollide = false;
			ignoreWater = true;
			timeLeft = 120;
			hostile = true;
			penetrate = -1;
		}
		else if (type == 923)
		{
			width = 30;
			height = 30;
			aiStyle = 180;
			alpha = 255;
			penetrate = -1;
			friendly = false;
			hostile = true;
			timeLeft = 180;
			tileCollide = false;
			ignoreWater = true;
			drawLayer = 2;
		}
		else if (type == 926)
		{
			alpha = 255;
			width = 12;
			height = 12;
			scale = 1f;
			aiStyle = 1;
			hostile = true;
			penetrate = 2;
		}
		else if (type == 927)
		{
			width = 40;
			height = 40;
			aiStyle = 75;
			drawLayer = 7;
			friendly = true;
			tileCollide = false;
			melee = true;
			penetrate = -1;
			ownerHitCheck = true;
		}
		else if (type == 928)
		{
			netImportant = true;
			width = 34;
			height = 34;
			aiStyle = 14;
			friendly = true;
			penetrate = 2;
			melee = true;
			timeLeft = 250;
		}
		else if (type == 929)
		{
			width = 32;
			height = 32;
			aiStyle = 183;
			penetrate = -1;
			timeLeft = 18;
			ignoreWater = true;
			tileCollide = false;
			friendly = true;
			hostile = false;
			manualDirectionChange = true;
		}
		else if (type == 930)
		{
			width = 14;
			height = 14;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 931)
		{
			width = 30;
			height = 30;
			aiStyle = 171;
			alpha = 255;
			penetrate = 3;
			friendly = true;
			timeLeft = 240;
			magic = true;
			tileCollide = true;
			ignoreWater = true;
			extraUpdates = 1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 30;
		}
		else if (type == 932)
		{
			ranged = true;
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 181;
			penetrate = 5;
			friendly = true;
			timeLeft = 120;
			alpha = 0;
			ignoreWater = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 60;
		}
		else if (type == 933)
		{
			width = 32;
			height = 32;
			aiStyle = 182;
			friendly = true;
			melee = true;
			tileCollide = false;
			ignoreWater = true;
			alpha = 255;
			extraUpdates = 1;
			usesLocalNPCImmunity = true;
			manualDirectionChange = true;
			localNPCHitCooldown = 15 / MaxUpdates;
			penetrate = -1;
			noEnchantmentVisuals = true;
		}
		else if (type == 934)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 935)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 7;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			timeLeft *= 10;
			extraUpdates = 3;
		}
		else if (type == 936)
		{
			width = 14;
			height = 14;
			aiStyle = 2;
			friendly = true;
			penetrate = 1;
			Opacity = 0.6f;
		}
		else if (type == 937)
		{
			alpha = 255;
			width = 10;
			height = 10;
			aiStyle = 1;
			hostile = false;
			friendly = true;
			penetrate = 3;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type >= 938 && type <= 945)
		{
			DefaultToShortsword();
			timeLeft = 360;
		}
		else if (type == 946)
		{
			netImportant = true;
			width = 10;
			height = 10;
			penetrate = -1;
			ignoreWater = true;
			tileCollide = false;
			friendly = true;
			minion = true;
			minionSlots = 1f;
			timeLeft *= 5;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			aiStyle = 156;
			scale = 0.75f;
			manualDirectionChange = true;
			drawLayer = 3;
		}
		else if (type == 947 || type == 948)
		{
			netImportant = true;
			width = 20;
			height = 20;
			DefaultToFlail();
		}
		else if (type == 949)
		{
			width = 4;
			height = 4;
			aiStyle = 184;
			penetrate = -1;
			hostile = true;
			tileCollide = false;
		}
		else if (type == 950)
		{
			width = 104;
			height = 104;
			aiStyle = 186;
			friendly = true;
			magic = true;
			alpha = 255;
			ignoreWater = true;
			timeLeft = 180;
			tileCollide = false;
			penetrate = -1;
		}
		else if (type == 951)
		{
			width = 26;
			height = 26;
			aiStyle = 67;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			minion = true;
			minionSlots = 1f;
			friendly = true;
			decidesManualFallThrough = true;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 10;
		}
		else if (type == 952)
		{
			DefaultToWhip();
		}
		else if (type == 953)
		{
			width = 8;
			height = 8;
			aiStyle = 117;
			friendly = true;
			alpha = 255;
			ignoreWater = true;
			timeLeft = 60;
			tileCollide = false;
			penetrate = -1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 80;
		}
		else if (type == 954)
		{
			width = 10;
			height = 10;
			aiStyle = 2;
			friendly = true;
			magic = true;
			alpha = 255;
			penetrate = 2;
			noEnchantmentVisuals = true;
		}
		else if (type == 955)
		{
			width = 18;
			height = 18;
			aiStyle = 5;
			friendly = true;
			penetrate = -1;
			alpha = 50;
			light = 1f;
			ranged = true;
		}
		else if (type == 956)
		{
			netImportant = true;
			width = 20;
			height = 28;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 957)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 124;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
			ignoreWater = true;
			tileCollide = false;
			manualDirectionChange = true;
		}
		else if (type == 958)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 959)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 960)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
			drawLayer = 3;
		}
		else if (type == 961)
		{
			width = 32;
			height = 32;
			aiStyle = 157;
			hostile = true;
			alpha = 255;
			tileCollide = false;
			ignoreWater = true;
			coldDamage = true;
		}
		else if (type == 962)
		{
			width = 32;
			height = 32;
			aiStyle = 1;
			hostile = true;
			tileCollide = false;
			ignoreWater = true;
			timeLeft = 220;
			coldDamage = true;
		}
		else if (type == 963)
		{
			netImportant = true;
			width = 30;
			height = 48;
			penetrate = -1;
			ignoreWater = true;
			tileCollide = false;
			friendly = true;
			minion = true;
			minionSlots = 0f;
			timeLeft *= 5;
			aiStyle = 62;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 20;
		}
		else if (type == 965)
		{
			width = 40;
			height = 40;
			aiStyle = 187;
			hostile = true;
			tileCollide = false;
			ignoreWater = true;
			timeLeft = 300;
			alpha = 255;
		}
		else if (type == 964)
		{
			width = 40;
			height = 40;
			aiStyle = 187;
			alpha = 255;
			penetrate = 3;
			friendly = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			ignoreWater = true;
			tileCollide = false;
			extraUpdates = 1;
			scale = 0.7f;
			armorPenetration = 20;
		}
		else if (type == 966)
		{
			width = 18;
			height = 60;
			aiStyle = 53;
			timeLeft = 36000;
			ignoreWater = true;
			sentry = true;
			netImportant = true;
		}
		else if (type == 967)
		{
			width = 14;
			height = 14;
			aiStyle = 28;
			friendly = true;
		}
		else if (type == 968)
		{
			width = 14;
			height = 14;
			aiStyle = 2;
			friendly = true;
			ranged = true;
			alpha = 255;
		}
		else if (type == 969)
		{
			width = 56;
			height = 64;
			aiStyle = 177;
			friendly = true;
			magic = true;
			tileCollide = true;
			penetrate = 15;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 25;
			armorPenetration = 10;
		}
		else if (type == 970)
		{
			netImportant = true;
			width = 10;
			height = 10;
			penetrate = -1;
			ignoreWater = true;
			tileCollide = false;
			friendly = true;
			minion = true;
			minionSlots = 1f;
			timeLeft = 60;
			aiStyle = 164;
			hide = true;
		}
		else if (type == 971)
		{
			width = 16;
			height = 16;
			aiStyle = 113;
			friendly = true;
			melee = true;
			penetrate = -1;
			alpha = 255;
			drawLayer = 3;
		}
		else if (type == 977)
		{
			width = 20;
			height = 20;
			aiStyle = 152;
			friendly = true;
			tileCollide = false;
			ignoreWater = true;
			melee = true;
			penetrate = 1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			armorPenetration = 5;
			scale = 1f + (float)Main.rand.Next(30) * 0.01f;
			extraUpdates = 2;
			timeLeft = 10 * MaxUpdates;
		}
		else if (type == 979)
		{
			width = 10;
			height = 10;
			aiStyle = 2;
			friendly = true;
			magic = true;
			alpha = 255;
			penetrate = 2;
			noEnchantmentVisuals = true;
			coldDamage = true;
		}
		else if (type == 974)
		{
			width = 20;
			height = 20;
			aiStyle = 188;
			friendly = true;
			tileCollide = false;
			ignoreWater = true;
			melee = true;
			penetrate = 2;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			timeLeft = 30;
			stopsDealingDamageAfterPenetrateHits = true;
			armorPenetration = 5;
		}
		else if (type == 978)
		{
			width = 160;
			height = 160;
			aiStyle = 189;
			friendly = true;
			alpha = 255;
			ignoreWater = true;
			timeLeft = 60;
			tileCollide = false;
			ownerHitCheck = true;
			penetrate = 3;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			melee = true;
			timeLeft = 30;
		}
		else if (type == 976)
		{
			width = 20;
			height = 20;
			aiStyle = 152;
			friendly = true;
			tileCollide = false;
			ignoreWater = true;
			melee = true;
			penetrate = 2;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			scale = 1f + (float)Main.rand.Next(30) * 0.01f;
			extraUpdates = 0;
			timeLeft = 60 * MaxUpdates;
			armorPenetration = 20;
		}
		else if (type == 975)
		{
			width = 16;
			height = 16;
			aiStyle = 113;
			friendly = true;
			melee = true;
			penetrate = -1;
			alpha = 0;
			hide = true;
		}
		else if (type == 972)
		{
			width = 16;
			height = 16;
			aiStyle = 190;
			friendly = true;
			melee = true;
			penetrate = 2;
			usesLocalNPCImmunity = true;
			tileCollide = false;
			ignoreWater = true;
			localNPCHitCooldown = -1;
			ownerHitCheck = true;
			ownerHitCheckDistance = 300f;
			usesOwnerMeleeHitCD = true;
			stopsDealingDamageAfterPenetrateHits = true;
		}
		else if (type == 973)
		{
			width = 30;
			height = 30;
			aiStyle = 191;
			friendly = true;
			melee = true;
			penetrate = 3;
			usesLocalNPCImmunity = true;
			tileCollide = false;
			ignoreWater = true;
			localNPCHitCooldown = 10;
			alpha = 255;
			timeLeft = 90;
		}
		else if (type == 980)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			hostile = true;
			penetrate = -1;
			trap = true;
		}
		else if (type == 981)
		{
			width = 4;
			height = 4;
			aiStyle = 1;
			friendly = true;
			penetrate = 1;
			light = 0.5f;
			alpha = 255;
			scale = 1.2f;
			timeLeft = 600;
			ranged = true;
			extraUpdates = 1;
		}
		else if (type == 982)
		{
			width = 16;
			height = 16;
			aiStyle = 190;
			friendly = true;
			melee = true;
			penetrate = 3;
			usesLocalNPCImmunity = true;
			tileCollide = false;
			ignoreWater = true;
			localNPCHitCooldown = -1;
			ownerHitCheck = true;
			ownerHitCheckDistance = 300f;
			usesOwnerMeleeHitCD = true;
			stopsDealingDamageAfterPenetrateHits = true;
		}
		else if (type == 983)
		{
			width = 16;
			height = 16;
			aiStyle = 190;
			friendly = true;
			melee = true;
			penetrate = 6;
			usesLocalNPCImmunity = true;
			tileCollide = false;
			ignoreWater = true;
			localNPCHitCooldown = -1;
			ownerHitCheck = true;
			ownerHitCheckDistance = 300f;
			usesOwnerMeleeHitCD = true;
			stopsDealingDamageAfterPenetrateHits = true;
		}
		else if (type == 984)
		{
			width = 16;
			height = 16;
			aiStyle = 190;
			friendly = true;
			melee = true;
			penetrate = 3;
			usesLocalNPCImmunity = true;
			tileCollide = false;
			ignoreWater = true;
			localNPCHitCooldown = -1;
			ownerHitCheck = true;
			ownerHitCheckDistance = 300f;
			usesOwnerMeleeHitCD = true;
			stopsDealingDamageAfterPenetrateHits = true;
		}
		else if (type == 985)
		{
			width = 8;
			height = 8;
			aiStyle = 191;
			friendly = true;
			melee = true;
			penetrate = -1;
			usesLocalNPCImmunity = true;
			tileCollide = true;
			ignoreWater = true;
			localNPCHitCooldown = -1;
			alpha = 255;
			timeLeft = 90;
			ownerHitCheck = true;
			ownerHitCheckDistance = 300f;
		}
		else if (type >= 986 && type <= 993)
		{
			width = 14;
			height = 14;
			aiStyle = 61;
			penetrate = -1;
			netImportant = true;
			bobber = true;
			if (type >= 987 && type <= 993)
			{
				glowMask = (short)(318 + (type - 987));
				light = 1f;
			}
		}
		else if (type == 994)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 995)
		{
			netImportant = true;
			width = 240;
			height = 104;
			aiStyle = 192;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			ignoreWater = true;
			timeLeft *= 5;
		}
		else if (type == 996)
		{
			width = 18;
			height = 18;
			aiStyle = 2;
			friendly = true;
			penetrate = 1;
		}
		else if (type == 997)
		{
			width = 16;
			height = 16;
			aiStyle = 190;
			friendly = true;
			melee = true;
			penetrate = 3;
			usesLocalNPCImmunity = true;
			tileCollide = false;
			ignoreWater = true;
			localNPCHitCooldown = -1;
			ownerHitCheck = true;
			ownerHitCheckDistance = 300f;
			usesOwnerMeleeHitCD = true;
			stopsDealingDamageAfterPenetrateHits = true;
		}
		else if (type == 999)
		{
			extraUpdates = 0;
			width = 16;
			height = 16;
			DefaultToYoyo();
			scale = 1f;
		}
		else if (type == 1000)
		{
			width = 22;
			height = 22;
			aiStyle = 3;
			friendly = true;
			penetrate = -1;
			melee = true;
			light = 0.6f;
		}
		else if (type == 998)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 1001)
		{
			width = 26;
			height = 26;
			aiStyle = 194;
			hostile = true;
			tileCollide = false;
			ignoreWater = true;
			scale = 1f + (float)Main.rand.Next(51) * 0.01f;
			timeLeft = 360;
			alpha = 255;
		}
		else if (type == 1002)
		{
			width = 260;
			height = 260;
			aiStyle = 16;
			friendly = true;
			hostile = true;
			penetrate = -1;
			tileCollide = false;
			alpha = 255;
			timeLeft = 2;
			trap = true;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 15;
		}
		else if (type == 1003)
		{
			netImportant = true;
			width = 26;
			height = 26;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 1004)
		{
			netImportant = true;
			width = 26;
			height = 26;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 1007)
		{
			width = 50;
			height = 50;
			aiStyle = 92;
			hostile = true;
			friendly = true;
			penetrate = -1;
			scale = 1.1f;
			trap = true;
			hide = true;
		}
		else if (type == 1006)
		{
			arrow = true;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			timeLeft = 1200;
		}
		else if (type == 1008)
		{
			netImportant = true;
			width = 6;
			height = 6;
			aiStyle = 33;
			friendly = true;
			penetrate = -1;
			alpha = 255;
			timeLeft = 36000;
		}
		else if (type == 1009)
		{
			netImportant = true;
			width = 6;
			height = 6;
			aiStyle = 33;
			friendly = true;
			penetrate = -1;
			alpha = 255;
			timeLeft = 36000;
		}
		else if (type == 1010)
		{
			netImportant = true;
			width = 6;
			height = 6;
			aiStyle = 33;
			friendly = true;
			penetrate = -1;
			alpha = 255;
			timeLeft = 36000;
		}
		else if (type == 1011)
		{
			netImportant = true;
			width = 6;
			height = 6;
			aiStyle = 33;
			friendly = true;
			penetrate = -1;
			alpha = 255;
			timeLeft = 36000;
		}
		else if (type == 1012)
		{
			width = 18;
			height = 18;
			aiStyle = 2;
			friendly = true;
			melee = true;
			penetrate = 1;
		}
		else if (type == 1015 || type == 1016 || type == 1017)
		{
			DefaultToSpray();
		}
		else if (type == 1018)
		{
			width = 16;
			height = 16;
			aiStyle = 67;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			friendly = true;
			ignoreWater = true;
		}
		else if (type == 1019)
		{
			width = 64;
			height = 64;
			aiStyle = 6;
			friendly = true;
			tileCollide = false;
			penetrate = -1;
			alpha = 255;
			ignoreWater = true;
		}
		else if (type == 1020)
		{
			width = 12;
			height = 12;
			aiStyle = 195;
			friendly = true;
			penetrate = -1;
		}
		else if (type == 1022)
		{
			width = 20;
			height = 30;
			aiStyle = 67;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			minion = true;
			minionSlots = 1f;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 18;
			decidesManualFallThrough = true;
		}
		else if (type == 1023)
		{
			alpha = 255;
			width = 26;
			height = 26;
			aiStyle = 1;
			friendly = true;
			ranged = true;
			timeLeft = 180;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 1024)
		{
			width = 16;
			height = 16;
			aiStyle = 113;
			friendly = true;
			magic = true;
			penetrate = -1;
			alpha = 255;
			drawLayer = 3;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			extraUpdates = 1;
		}
		else if (type == 1025)
		{
			width = 42;
			height = 38;
			aiStyle = 197;
			timeLeft = 36000;
			ignoreWater = true;
			sentry = true;
			netImportant = true;
		}
		else if (type == 1026)
		{
			width = 14;
			height = 14;
			aiStyle = 28;
			friendly = true;
			extraUpdates = 2;
		}
		else if (type == 1027)
		{
			netImportant = true;
			width = 26;
			height = 26;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 1028)
		{
			DefaultToWhip();
		}
		else if (type == 1029)
		{
			DefaultToWhip();
		}
		else if (type == 1030)
		{
			DefaultToWhip();
		}
		else if (type == 1031)
		{
			DefaultToWhip();
		}
		else if (type == 1032)
		{
			DefaultToWhip();
		}
		else if (type == 1033)
		{
			DefaultToWhip();
		}
		else if (type == 1034)
		{
			DefaultToWhip();
		}
		else if (type == 1035)
		{
			DefaultToWhip();
		}
		else if (type == 1036)
		{
			width = 18;
			height = 10;
			aiStyle = 67;
			friendly = true;
			penetrate = -1;
			netImportant = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 20;
			armorPenetration = 30;
			decidesManualFallThrough = true;
		}
		else if (type == 1037)
		{
			width = 24;
			height = 24;
			aiStyle = 5;
			friendly = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			scale = 0.8f;
			extraUpdates = 1;
			alpha = 254;
			tileCollide = false;
		}
		else if (type == 1038)
		{
			width = 18;
			height = 18;
			aiStyle = 196;
			friendly = true;
			timeLeft = 120;
			penetrate = 1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			tileCollide = false;
			ignoreWater = true;
			armorPenetration = 50;
		}
		else if (type == 1039)
		{
			width = 30;
			height = 30;
			aiStyle = 171;
			alpha = 255;
			friendly = true;
			timeLeft = 240;
			tileCollide = true;
			ignoreWater = true;
			extraUpdates = 1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 1040)
		{
			width = 2;
			height = 2;
			aiStyle = 198;
			tileCollide = false;
			ignoreWater = true;
			penetrate = -1;
			drawLayer = 7;
			usesOwnerLight = true;
			alpha = 255;
			manualDirectionChange = true;
		}
		else if (type == 1041)
		{
			width = 32;
			height = 32;
			aiStyle = 157;
			friendly = true;
			alpha = 255;
			melee = true;
			tileCollide = false;
			ignoreWater = true;
			penetrate = 4;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 25;
		}
		else if (type == 1042)
		{
			width = 18;
			height = 18;
			aiStyle = 60;
			alpha = 255;
			penetrate = -1;
			extraUpdates = 2;
			ignoreWater = true;
		}
		else if (type == 1043)
		{
			width = 16;
			height = 16;
			aiStyle = 190;
			friendly = true;
			melee = true;
			penetrate = 2;
			usesLocalNPCImmunity = true;
			tileCollide = false;
			ignoreWater = true;
			localNPCHitCooldown = -1;
			ownerHitCheck = true;
			ownerHitCheckDistance = 300f;
			usesOwnerMeleeHitCD = true;
			stopsDealingDamageAfterPenetrateHits = true;
		}
		else if (type == 1044)
		{
			width = 8;
			height = 8;
			aiStyle = 117;
			friendly = true;
			alpha = 255;
			ignoreWater = true;
			timeLeft = 60;
			tileCollide = false;
			penetrate = -1;
			hide = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}
		else if (type == 1045)
		{
			width = 20;
			height = 20;
			aiStyle = 152;
			friendly = true;
			tileCollide = false;
			ignoreWater = true;
			melee = true;
			penetrate = 1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
			scale = 1f + (float)Main.rand.Next(30) * 0.01f;
			extraUpdates = 1;
			timeLeft = 24 * MaxUpdates;
			alpha = 255;
			armorPenetration = 50;
		}
		else if (type == 1046)
		{
			netImportant = true;
			width = 26;
			height = 26;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 1047)
		{
			width = 31;
			height = 31;
			aiStyle = 25;
			friendly = true;
			penetrate = -1;
			timeLeft = 3600;
			ignoreWater = true;
		}
		else if (type == 1048)
		{
			width = 31;
			height = 31;
			aiStyle = 25;
			friendly = true;
			hostile = true;
			penetrate = -1;
			trap = true;
		}
		else if (type == 1049)
		{
			width = 24;
			height = 24;
			aiStyle = 5;
			friendly = true;
			hostile = true;
			scale = 0.8f;
			extraUpdates = 1;
			alpha = 254;
			penetrate = -1;
			tileCollide = false;
			trap = true;
		}
		else if (type == 1050)
		{
			width = 20;
			height = 20;
			aiStyle = 144;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			scale = 1f;
			friendly = true;
			ignoreWater = true;
			tileCollide = false;
			manualDirectionChange = true;
		}
		else if (type == 1051)
		{
			width = 64;
			height = 64;
			aiStyle = 6;
			friendly = true;
			tileCollide = false;
			penetrate = -1;
			alpha = 255;
			ignoreWater = true;
		}
		else if (type == 1052)
		{
			width = 22;
			height = 22;
			aiStyle = 3;
			friendly = true;
			penetrate = -1;
			melee = true;
		}
		else if (type == 1056)
		{
			width = 32;
			height = 32;
			aiStyle = 67;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			friendly = true;
			ignoreWater = true;
		}
		else if (type == 1058)
		{
			netImportant = true;
			width = 26;
			height = 26;
			DefaultToFlail();
			alpha = 255;
		}
		else if ((type >= 1059 && type <= 1064) || type == 1071 || type == 1075 || type == 1101)
		{
			width = 38;
			height = 38;
			aiStyle = 3;
			friendly = true;
			penetrate = -1;
			melee = true;
			netImportant = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 10;
			if (type == 1101)
			{
				glowMask = 372;
			}
		}
		else if ((type >= 1065 && type <= 1070) || type == 1072 || type == 1076 || type == 1102)
		{
			width = 46;
			height = 46;
			aiStyle = 3;
			friendly = true;
			penetrate = -1;
			melee = true;
			netImportant = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 10;
			if (type == 1102)
			{
				glowMask = 373;
			}
		}
		else if (type == 1073)
		{
			width = 10;
			height = 10;
			aiStyle = 1;
			hostile = true;
			penetrate = -1;
			trap = true;
		}
		else if (type == 1074)
		{
			width = 46;
			height = 46;
			aiStyle = 3;
			friendly = true;
			penetrate = -1;
			melee = true;
			netImportant = true;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 10;
		}
		else if (type == 1077)
		{
			width = 22;
			height = 22;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
		}
		else if (type == 1078)
		{
			width = 14;
			height = 14;
			aiStyle = 199;
			hostile = true;
			friendly = true;
			penetrate = -1;
			trap = true;
			netImportant = true;
		}
		else if (type == 1080)
		{
			width = 10;
			height = 10;
			aiStyle = 200;
			alpha = 255;
			penetrate = -1;
			ignoreWater = true;
		}
		else if (type == 1081)
		{
			penetrate = -1;
			width = 12;
			height = 12;
			aiStyle = 10;
			friendly = true;
		}
		else if (type == 1082)
		{
			width = 26;
			height = 26;
			aiStyle = 201;
			friendly = true;
			penetrate = 1;
			melee = true;
			usesOwnerMeleeHitCD = true;
		}
		else if (type == 1083)
		{
			width = 28;
			height = 28;
			aiStyle = 201;
			friendly = true;
			penetrate = 2;
			melee = true;
			usesOwnerMeleeHitCD = true;
		}
		else if (type == 1084)
		{
			extraUpdates = 2;
			timeLeft = 300;
			width = 4;
			height = 4;
			aiStyle = 202;
			penetrate = -1;
			tileCollide = false;
		}
		else if (type == 1085)
		{
			width = 18;
			height = 18;
			aiStyle = 2;
			friendly = true;
			penetrate = 1;
		}
		else if (type == 1086 || type == 1087)
		{
			width = 22;
			height = 22;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			if (type == 1087)
			{
				tileCollide = false;
			}
		}
		else if (type == 1088)
		{
			width = 20;
			height = 20;
			aiStyle = 16;
			friendly = true;
			penetrate = -1;
			ranged = true;
		}
		else if (type == 1089)
		{
			netImportant = true;
			width = 6;
			height = 6;
			aiStyle = 14;
			penetrate = -1;
			light = 1f;
			timeLeft *= 5;
		}
		else if (type == 1090)
		{
			width = 32;
			height = 32;
			aiStyle = 67;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			scale = 0.5f;
			friendly = true;
			ignoreWater = true;
		}
		else if (type == 1091)
		{
			width = (height = 16);
			netImportant = true;
			friendly = true;
			hostile = true;
			trap = true;
			ignoreWater = true;
			aiStyle = 203;
			hostileDamageScaling = GameDifficultyData.LightningPlayerDamageScaling;
		}
		else if (type == 1092)
		{
			width = 16;
			height = 16;
			aiStyle = 18;
			hostile = true;
			penetrate = -1;
			timeLeft = 420;
		}
		else if (type == 1093)
		{
			width = 14;
			height = 22;
			aiStyle = 67;
			penetrate = -1;
			netImportant = true;
			timeLeft *= 5;
			minion = true;
			minionSlots = 1f;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = 8;
			decidesManualFallThrough = true;
			alpha = 255;
		}
		else if (type == 1094)
		{
			netImportant = true;
			width = 18;
			height = 18;
			aiStyle = 26;
			penetrate = -1;
			timeLeft *= 5;
			minion = true;
			minionSlots = 1f;
			alpha = 255;
		}
		else if (type == 1095 || type == 1096)
		{
			netImportant = true;
			width = 20;
			height = 20;
			aiStyle = 26;
			friendly = true;
			penetrate = -1;
			timeLeft *= 5;
		}
		else if (type == 1097)
		{
			tileCollide = false;
			width = 10;
			height = 10;
			aiStyle = 1;
			friendly = true;
			extraUpdates = 1;
		}
		else if (type == 1098)
		{
			width = 34;
			height = 34;
			aiStyle = 204;
			friendly = true;
			alpha = 255;
			netImportant = true;
			correctSlopeCollision = true;
		}
		else if (type == 1099)
		{
			width = 66;
			height = 66;
			aiStyle = 1;
			friendly = true;
			penetrate = -1;
			light = 0.75f;
			scale = 0.6f;
			alpha = 255;
			timeLeft = 600;
			tileCollide = false;
			magic = true;
		}
		else if (type == 1100)
		{
			width = 32;
			height = 32;
			aiStyle = 182;
			friendly = true;
			melee = true;
			tileCollide = false;
			ignoreWater = true;
			alpha = 255;
			extraUpdates = 1;
			usesLocalNPCImmunity = true;
			manualDirectionChange = true;
			localNPCHitCooldown = 15 / MaxUpdates;
			penetrate = -1;
			noEnchantmentVisuals = true;
		}
		else if (type == 1103)
		{
			width = 18;
			height = 18;
			scale = 1.2f;
			DefaultToSpear();
			alpha = 90;
		}
		else if (type == 1104)
		{
			DefaultToWhip();
		}
		else if (type == 1105)
		{
			width = 26;
			height = 26;
			aiStyle = 205;
			friendly = true;
			tileCollide = true;
			correctSlopeCollision = true;
		}
		else if (type == 1106)
		{
			width = 6;
			height = 6;
			aiStyle = 193;
			friendly = true;
			alpha = 255;
			penetrate = 4;
			extraUpdates = 2;
			usesIDStaticNPCImmunity = true;
			idStaticNPCHitCooldown = 15;
			armorPenetration = 5;
			drawLayer = 4;
		}
		else if (type >= 1107 && type <= 1109)
		{
			if (type == 1107)
			{
				width = 14;
				height = 16;
			}
			else if (type == 1108)
			{
				width = 12;
				height = 14;
			}
			else
			{
				width = 6;
				height = 12;
			}
			penetrate = 3;
			aiStyle = 14;
			friendly = true;
			timeLeft = 360;
			melee = true;
			noEnchantmentVisuals = true;
		}
		else if (type == 1110)
		{
			width = 80;
			height = 80;
			aiStyle = 77;
			friendly = true;
			alpha = 255;
			scale = 1f;
			melee = true;
			ignoreWater = true;
			tileCollide = false;
			penetrate = -1;
		}
		else
		{
			active = false;
		}
		width = (int)((float)width * scale);
		height = (int)((float)height * scale);
		maxPenetrate = penetrate;
	}

	public void DefaultToSpray()
	{
		width = 6;
		height = 6;
		aiStyle = 31;
		friendly = true;
		alpha = 255;
		penetrate = -1;
		extraUpdates = 2;
		tileCollide = false;
		ignoreWater = true;
	}

	public void DefaultToWhip()
	{
		width = 18;
		height = 18;
		aiStyle = 165;
		drawLayer = 7;
		friendly = true;
		penetrate = -1;
		tileCollide = false;
		scale = 1f;
		ownerHitCheck = true;
		extraUpdates = 1;
		usesLocalNPCImmunity = true;
		localNPCHitCooldown = -1;
	}

	public void DefaultToSpear()
	{
		aiStyle = 19;
		friendly = true;
		penetrate = -1;
		tileCollide = false;
		drawLayer = 7;
		usesOwnerLight = true;
		ownerHitCheck = true;
		melee = true;
	}

	public void DefaultToDrillOrChainsaw()
	{
		aiStyle = 20;
		friendly = true;
		penetrate = -1;
		tileCollide = false;
		drawLayer = 7;
		usesOwnerLight = true;
		ownerHitCheck = true;
		melee = true;
	}

	public void DefaultToKite()
	{
		width = 4;
		height = 4;
		aiStyle = 160;
		penetrate = -1;
		extraUpdates = 60;
	}

	public void DefaultToFlail()
	{
		aiStyle = 15;
		drawLayer = 7;
		friendly = true;
		penetrate = -1;
		melee = true;
		usesLocalNPCImmunity = true;
		localNPCHitCooldown = 10;
	}

	public void DefaultToYoyo()
	{
		aiStyle = 99;
		drawLayer = 7;
		friendly = true;
		penetrate = -1;
		melee = true;
	}

	public void DefaultToShortsword()
	{
		width = 18;
		height = 18;
		aiStyle = 161;
		friendly = true;
		penetrate = -1;
		tileCollide = false;
		scale = 1f;
		ownerHitCheck = true;
		melee = true;
		extraUpdates = 1;
		drawLayer = 7;
		usesOwnerLight = true;
	}

	public static int GetNextSlot()
	{
		int result = 1000;
		for (int i = 0; i < 1000; i++)
		{
			if (!Main.projectile[i].active)
			{
				result = i;
				break;
			}
		}
		return result;
	}

	public static int NewProjectile(IEntitySource spawnSource, Vector2 position, Vector2 velocity, int Type, int Damage, float KnockBack, int Owner = -1, float ai0 = 0f, float ai1 = 0f, float ai2 = 0f, NewProjectileModifier modifer = null)
	{
		return NewProjectile(spawnSource, position.X, position.Y, velocity.X, velocity.Y, Type, Damage, KnockBack, Owner, ai0, ai1, ai2, modifer);
	}

	public static int FindOldestProjectile()
	{
		int result = 1000;
		int num = 9999999;
		for (int i = 0; i < 1000; i++)
		{
			if (!Main.projectile[i].netImportant && Main.projectile[i].timeLeft < num)
			{
				result = i;
				num = Main.projectile[i].timeLeft;
			}
		}
		return result;
	}

	public static int NewProjectile(IEntitySource spawnSource, float X, float Y, float SpeedX, float SpeedY, int Type, int Damage, float KnockBack, int Owner = -1, float ai0 = 0f, float ai1 = 0f, float ai2 = 0f, NewProjectileModifier modifer = null)
	{
		if (Owner == -1)
		{
			Owner = 255;
		}
		int num = 1000;
		for (int i = 0; i < 1000; i++)
		{
			if (!Main.projectile[i].active)
			{
				num = i;
				break;
			}
		}
		if (num == 1000)
		{
			num = FindOldestProjectile();
		}
		Projectile projectile = Main.projectile[num];
		if (Main.NoPooling)
		{
			projectile = (Main.projectile[num] = new Projectile());
		}
		projectile.SetDefaults(Type);
		projectile.whoAmI = num;
		projectile.position.X = X - (float)projectile.width * 0.5f;
		projectile.position.Y = Y - (float)projectile.height * 0.5f;
		projectile.owner = Owner;
		projectile.velocity.X = SpeedX;
		projectile.velocity.Y = SpeedY;
		projectile.damage = Damage;
		projectile.knockBack = KnockBack;
		projectile.identity = num;
		projectile.gfxOffY = 0f;
		projectile.stepSpeed = 1f;
		projectile.wet = Collision.WetCollision(projectile.position, projectile.width, projectile.height);
		if (projectile.ignoreWater)
		{
			projectile.wet = false;
		}
		projectile.honeyWet = Collision.honey;
		projectile.shimmerWet = Collision.shimmer;
		Main.projectileIdentity[Owner, num] = num;
		projectile.ApplyStatsFromSource(spawnSource);
		projectile.FindBannerToAssociateTo(spawnSource);
		projectile.TrackMinionSpawnSource(spawnSource);
		if (projectile.aiStyle == 1)
		{
			while (projectile.velocity.X >= 16f || projectile.velocity.X <= -16f || projectile.velocity.Y >= 16f || projectile.velocity.Y < -16f)
			{
				projectile.velocity.X *= 0.97f;
				projectile.velocity.Y *= 0.97f;
			}
		}
		if (Owner == Main.myPlayer)
		{
			switch (Type)
			{
			case 206:
				projectile.ai[0] = (float)Main.rand.Next(-100, 101) * 0.0005f;
				projectile.ai[1] = (float)Main.rand.Next(-100, 101) * 0.0005f;
				break;
			case 335:
				projectile.ai[1] = Main.rand.Next(4);
				break;
			case 358:
				projectile.ai[1] = (float)Main.rand.Next(10, 31) * 0.1f;
				break;
			case 406:
				projectile.ai[1] = (float)Main.rand.Next(10, 21) * 0.1f;
				break;
			default:
				projectile.ai[0] = ai0;
				projectile.ai[1] = ai1;
				projectile.ai[2] = ai2;
				break;
			}
		}
		if (Type == 434)
		{
			projectile.ai[0] = projectile.position.X;
			projectile.ai[1] = projectile.position.Y;
		}
		if (Type > 0 && Type < ProjectileID.Count)
		{
			if (ProjectileID.Sets.NeedsUUID[Type])
			{
				projectile.projUUID = projectile.identity;
			}
			if (ProjectileID.Sets.StardustDragon[Type])
			{
				int num2 = Main.projectile[(int)projectile.ai[0]].projUUID;
				if (num2 >= 0)
				{
					projectile.ai[0] = num2;
				}
			}
		}
		if (Owner == Main.myPlayer)
		{
			if (ProjectileID.Sets.IsAGolfBall[Type] && Damage <= 0)
			{
				int num3 = 0;
				int num4 = 0;
				int num5 = 99999999;
				for (int j = 0; j < 1000; j++)
				{
					if (Main.projectile[j].active && ProjectileID.Sets.IsAGolfBall[Main.projectile[j].type] && Main.projectile[j].owner == Owner && Main.projectile[j].damage <= 0)
					{
						num3++;
						if (num5 > Main.projectile[j].timeLeft)
						{
							num4 = j;
							num5 = Main.projectile[j].timeLeft;
						}
					}
				}
				if (num3 > 10)
				{
					Main.projectile[num4].Kill();
				}
			}
			if (ProjectileID.Sets.CopiesOwnerAttackCDToLocalImmunityOnSpawn[Type])
			{
				int[] meleeNPCHitCooldown = Main.player[Owner].meleeNPCHitCooldown;
				int[] array = projectile.localNPCImmunity;
				for (int k = 0; k < Main.maxNPCs; k++)
				{
					int num6 = meleeNPCHitCooldown[k];
					if (num6 > 0)
					{
						array[k] = num6;
					}
				}
			}
			if (Type == 28)
			{
				projectile.timeLeft = 180;
			}
			if (Type == 1077)
			{
				projectile.timeLeft = 180;
			}
			if (Type == 516)
			{
				projectile.timeLeft = 180;
			}
			if (Type == 519)
			{
				projectile.timeLeft = 180;
			}
			if (Type == 1086 || Type == 1087)
			{
				projectile.timeLeft = 300;
			}
			if (Type == 29 || Type == 470 || Type == 637)
			{
				projectile.timeLeft = 300;
			}
			if (Type == 30)
			{
				projectile.timeLeft = 180;
			}
			if (Type == 517)
			{
				projectile.timeLeft = 180;
			}
			if (Type == 37)
			{
				projectile.timeLeft = 180;
			}
			if (Type == 773)
			{
				projectile.timeLeft = 180;
			}
			if (Type == 75)
			{
				projectile.timeLeft = 180;
			}
			if (Type == 133)
			{
				projectile.timeLeft = 180;
			}
			if (Type == 136)
			{
				projectile.timeLeft = 180;
			}
			if (Type == 139)
			{
				projectile.timeLeft = 180;
			}
			if (Type == 142)
			{
				projectile.timeLeft = 180;
			}
			if (Type == 397)
			{
				projectile.timeLeft = 180;
			}
			if (Type == 419)
			{
				projectile.timeLeft = 600;
			}
			if (Type == 420)
			{
				projectile.timeLeft = 600;
			}
			if (Type == 421)
			{
				projectile.timeLeft = 600;
			}
			if (Type == 422)
			{
				projectile.timeLeft = 600;
			}
			if (Type == 588)
			{
				projectile.timeLeft = 180;
			}
			if (Type == 779)
			{
				projectile.timeLeft = 60;
			}
			if (Type == 783)
			{
				projectile.timeLeft = 60;
			}
			if (Type == 862 || Type == 863)
			{
				projectile.timeLeft = 60;
			}
			if (Type == 443 || Type == 1110)
			{
				projectile.timeLeft = 300;
			}
			if (Type == 681)
			{
				projectile.timeLeft = 600;
			}
			if (Type == 684)
			{
				projectile.timeLeft = 60;
			}
			if (Type == 706)
			{
				projectile.timeLeft = 120;
			}
			if (Type == 680 && Main.player[projectile.owner].setSquireT2)
			{
				projectile.penetrate = 7;
			}
			if (Type == 777 || Type == 781 || Type == 794 || Type == 797 || Type == 800 || Type == 785 || Type == 788 || Type == 791 || Type == 903 || Type == 904 || Type == 905 || Type == 906 || Type == 910 || Type == 911)
			{
				projectile.timeLeft = 180;
			}
		}
		if (Type == 249)
		{
			projectile.frame = Main.rand.Next(5);
		}
		modifer?.Invoke(projectile);
		if (Main.netMode != 0 && Owner == Main.myPlayer)
		{
			NetMessage.SendData(27, -1, -1, null, num);
		}
		if (Owner == Main.myPlayer)
		{
			Main.player[Owner].TryUpdateChannel(projectile);
		}
		return num;
	}

	private void FindBannerToAssociateTo(IEntitySource spawnSource)
	{
		if (spawnSource is EntitySource_Parent entitySource_Parent)
		{
			if (entitySource_Parent.Entity is Projectile projectile)
			{
				bannerIdToRespondTo = projectile.bannerIdToRespondTo;
			}
			else if (entitySource_Parent.Entity is NPC nPC)
			{
				bannerIdToRespondTo = BannerSystem.NPCtoBanner(nPC.BannerID());
			}
		}
	}

	private void ApplyStatsFromSource(IEntitySource spawnSource)
	{
		if (spawnSource is EntitySource_ItemUse { Item: var item } entitySource_ItemUse)
		{
			if (ItemID.Sets.UniqueTagEffects[item.type] != null)
			{
				tagEffectType = item.type;
			}
			bonusTagDamage += item.bonusTagDamage;
			armorPenetration += item.armorPenetration;
			if (item.type == 2269 && entitySource_ItemUse.Entity is Player)
			{
				Player player = (Player)entitySource_ItemUse.Entity;
				bonusCritChance += player.revolverCritChanceBonus;
			}
		}
		if (spawnSource is EntitySource_Parent { Entity: Projectile entity })
		{
			tagEffectType = entity.tagEffectType;
			bonusTagDamage += entity.bonusTagDamage;
			armorPenetration += entity.armorPenetration;
			bonusCritChance += entity.bonusCritChance;
		}
	}

	private void TrackMinionSpawnSource(IEntitySource spawnSource)
	{
		if (minion && ProjectileID.Sets.TrackMinionSpawnFromItemUse[type] && spawnSource is EntitySource_ItemUse entitySource_ItemUse)
		{
			MinionSpawnInfo = new MinionSpawnFromInventoryItem(entitySource_ItemUse.Item);
		}
	}

	public static Color GetGolfTrailColor(Projectile proj)
	{
		return proj.type switch
		{
			739 => new Color(50, 50, 50, 80), 
			740 => new Color(30, 50, 255, 40), 
			741 => new Color(150, 90, 60, 90), 
			742 => new Color(30, 255, 170, 30), 
			743 => new Color(30, 255, 30, 40), 
			744 => new Color(190, 255, 30, 50), 
			745 => new Color(255, 130, 30, 50), 
			746 => new Color(255, 50, 110, 50), 
			747 => new Color(130, 10, 200, 40), 
			748 => new Color(255, 30, 50, 50), 
			749 => new Color(100, 180, 255, 30), 
			750 => new Color(50, 240, 160, 30), 
			751 => new Color(220, 80, 220, 70), 
			752 => new Color(255, 180, 50, 30), 
			_ => new Color(160, 160, 255, 50), 
		};
	}

	public void StatusNPC(int i)
	{
		NPC nPC = Main.npc[i];
		if ((melee || ProjectileID.Sets.IsAWhip[type]) && Main.player[owner].meleeEnchant > 0 && !noEnchantments)
		{
			byte meleeEnchant = Main.player[owner].meleeEnchant;
			if (meleeEnchant == 1)
			{
				nPC.AddBuff(70, 60 * Main.rand.Next(5, 10));
			}
			if (meleeEnchant == 2)
			{
				nPC.AddBuff(39, 60 * Main.rand.Next(3, 7));
			}
			if (meleeEnchant == 3)
			{
				nPC.AddBuff(24, 60 * Main.rand.Next(3, 7));
			}
			if (meleeEnchant == 5)
			{
				nPC.AddBuff(69, 60 * Main.rand.Next(10, 20));
			}
			if (meleeEnchant == 6)
			{
				nPC.AddBuff(31, 60 * Main.rand.Next(1, 4));
			}
			if (meleeEnchant == 8)
			{
				nPC.AddBuff(20, 60 * Main.rand.Next(5, 10));
			}
			if (meleeEnchant == 4)
			{
				nPC.AddBuff(72, 120);
			}
		}
		if (type == 1083)
		{
			nPC.AddBuff(30, 60 * Main.rand.Next(4, 7));
		}
		if (type == 1078)
		{
			nPC.AddBuff(24, Main.rand.Next(300, 600));
		}
		if (type == 1026)
		{
			nPC.AddBuff(20, Main.rand.Next(300, 600));
		}
		if (type == 1104)
		{
			nPC.AddBuff(137, 180);
			GetWhipSettings(this, out var timeToFlyOut, out var _, out var _);
			int num = (int)(timeToFlyOut / 3f) * 2;
			int num2 = 1;
			if (ai[0] >= (float)(num - num2) && ai[0] <= (float)(num + num2))
			{
				WhipPointsForCollision.Clear();
				FillWhipControlPoints(this, WhipPointsForCollision, null, getActualCollisionPoints: true);
				if (Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(50f, 50f)).Intersects(nPC.Hitbox))
				{
					nPC.AddBuff(24, 60 * Main.rand.Next(3, 6));
				}
			}
		}
		if (type == 182)
		{
			nPC.AddBuff(375, 60 * Main.rand.Next(8, 13));
		}
		if (type == 190)
		{
			nPC.AddBuff(375, 60 * Main.rand.Next(4, 7));
		}
		if (type == 301)
		{
			nPC.AddBuff(36, 60 * Main.rand.Next(10, 21));
		}
		if (type == 383 && Main.rand.Next(3) == 0)
		{
			nPC.AddBuff(31, 60 * (int)((double)Main.rand.Next(10, 21) * 0.1));
		}
		if (type == 262 && Main.rand.Next(3) == 0)
		{
			nPC.AddBuff(31, 60 * (int)((double)Main.rand.Next(10, 21) * 0.1));
		}
		if (type == 23)
		{
			nPC.AddBuff(30, 60 * Main.rand.Next(8, 13));
		}
		if (type == 320)
		{
			nPC.AddBuff(30, 60 * Main.rand.Next(3, 6));
		}
		if (type == 195)
		{
			nPC.AddBuff(70, 60 * Main.rand.Next(5, 11));
		}
		if (type == 119)
		{
			nPC.AddBuff(324, 240);
		}
		if (type == 309)
		{
			nPC.AddBuff(324, 300);
		}
		if (type == 359)
		{
			nPC.AddBuff(324, 420);
		}
		if (type == 1097)
		{
			nPC.AddBuff(24, Main.rand.Next(300, 600));
		}
		if (type == 669 && Main.rand.Next(20) == 0)
		{
			nPC.AddBuff(31, 60 * Main.rand.Next(2, 6));
		}
		ApplyWhipDebuffs(nPC);
		if (type == 664 && Main.rand.Next(3) == 0)
		{
			nPC.AddBuff(24, 60 * Main.rand.Next(3, 6));
		}
		if (type == 666 && Main.rand.Next(2) == 0)
		{
			nPC.AddBuff(323, 60 * Main.rand.Next(3, 9));
		}
		if (type == 668 && Main.rand.Next(3) != 0)
		{
			nPC.AddBuff(323, 60 * Main.rand.Next(6, 9));
		}
		if (type == 567 || type == 568)
		{
			nPC.AddBuff(20, 60 * Main.rand.Next(5, 11));
		}
		if (type == 598 && ai[1] == (float)i)
		{
			nPC.AddBuff(169, 900);
		}
		if (type == 636 && ai[1] == (float)i)
		{
			nPC.AddBuff(189, 300);
		}
		if (type == 971 && ai[1] == (float)i)
		{
			nPC.AddBuff(337, 540);
		}
		if (type == 975 && ai[1] == (float)i)
		{
			nPC.AddBuff(344, 540);
		}
		if (type == 611)
		{
			nPC.AddBuff(189, 300);
		}
		if (type == 612)
		{
			nPC.AddBuff(189, 300);
		}
		if (type == 978)
		{
			nPC.AddBuff(24, 180);
		}
		if (type == 953)
		{
			nPC.AddBuff(189, 300);
		}
		if (type == 711)
		{
			nPC.AddBuff(203, 600);
		}
		if (type == 706)
		{
			nPC.AddBuff(323, 480);
		}
		if (type == 614 && ai[1] == (float)i)
		{
			nPC.AddBuff(183, 900);
		}
		if (type == 585)
		{
			nPC.AddBuff(153, 60 * Main.rand.Next(5, 11));
		}
		if (type == 583)
		{
			nPC.AddBuff(20, 60 * Main.rand.Next(3, 6));
		}
		if (type == 524)
		{
			nPC.AddBuff(69, 60 * Main.rand.Next(3, 8));
		}
		if (type == 954 && Main.rand.Next(2) == 0)
		{
			int num3 = 24;
			if (Main.remixWorld)
			{
				num3 = 323;
			}
			if (Main.rand.Next(3) == 0)
			{
				nPC.AddBuff(num3, Main.rand.Next(60, 240));
			}
			else
			{
				nPC.AddBuff(num3, Main.rand.Next(60, 120));
			}
		}
		if (type == 504 && Main.rand.Next(2) == 0)
		{
			if (Main.rand.Next(3) == 0)
			{
				nPC.AddBuff(323, Main.rand.Next(60, 240));
			}
			else
			{
				nPC.AddBuff(323, Main.rand.Next(60, 120));
			}
		}
		if (type == 979 && Main.rand.Next(2) == 0)
		{
			int num4 = 44;
			if (Main.remixWorld)
			{
				num4 = 324;
			}
			if (Main.rand.Next(3) == 0)
			{
				nPC.AddBuff(num4, Main.rand.Next(60, 240));
			}
			else
			{
				nPC.AddBuff(num4, Main.rand.Next(60, 120));
			}
		}
		if ((type == 694 || type == 695 || type == 696) && Main.player[owner].setHuntressT2)
		{
			nPC.AddBuff(204, Main.rand.Next(8, 18) * 30);
		}
		if (type == 545 && Main.rand.Next(3) == 0)
		{
			nPC.AddBuff(24, Main.rand.Next(60, 240));
		}
		if (type == 553)
		{
			nPC.AddBuff(323, Main.rand.Next(180, 480));
		}
		if (type == 552 && Main.rand.Next(3) != 0)
		{
			nPC.AddBuff(324, Main.rand.Next(120, 320));
		}
		if (type == 495)
		{
			nPC.AddBuff(153, Main.rand.Next(120, 300));
		}
		if (type == 497)
		{
			nPC.AddBuff(153, Main.rand.Next(60, 180));
		}
		if (type == 496)
		{
			nPC.AddBuff(153, Main.rand.Next(240, 480));
		}
		if (type == 46)
		{
			nPC.AddBuff(153, Main.rand.Next(240, 300));
		}
		if (type == 476)
		{
			nPC.AddBuff(151, 30);
		}
		if (type == 523)
		{
			nPC.AddBuff(20, 60 * Main.rand.Next(10, 30));
		}
		if (type == 478 || type == 480)
		{
			nPC.AddBuff(39, 60 * Main.rand.Next(3, 7));
		}
		if (type == 479)
		{
			nPC.AddBuff(69, 60 * Main.rand.Next(7, 15));
		}
		if (type == 379)
		{
			nPC.AddBuff(70, 60 * Main.rand.Next(2, 5));
		}
		if (type >= 390 && type <= 392)
		{
			nPC.AddBuff(70, 60 * Main.rand.Next(2, 5));
		}
		if (type == 374)
		{
			nPC.AddBuff(20, 60 * Main.rand.Next(4, 7));
		}
		if (type == 376)
		{
			nPC.AddBuff(24, 60 * Main.rand.Next(3, 7));
		}
		if (type == 399 || (type >= 400 && type <= 402))
		{
			nPC.AddBuff(24, 60 * Main.rand.Next(3, 7));
		}
		if (type >= 1107 && type <= 1109)
		{
			nPC.AddBuff(323, 60 * Main.rand.Next(3, 7));
		}
		if (type == 295 || type == 296)
		{
			nPC.AddBuff(323, 60 * Main.rand.Next(8, 16));
		}
		if ((melee || ranged) && !npcProj && Main.player[owner].frostBurn && !noEnchantments)
		{
			nPC.AddBuff(324, 60 * Main.rand.Next(5, 15));
		}
		if (melee && Main.player[owner].magmaStone && !noEnchantments)
		{
			if (Main.rand.Next(7) == 0)
			{
				nPC.AddBuff(323, 360);
			}
			else if (Main.rand.Next(3) == 0)
			{
				nPC.AddBuff(323, 120);
			}
			else
			{
				nPC.AddBuff(323, 60);
			}
		}
		if (type == 287)
		{
			nPC.AddBuff(72, 120);
		}
		if (type == 285)
		{
			if (Main.rand.Next(3) == 0)
			{
				nPC.AddBuff(31, 180);
			}
			else
			{
				nPC.AddBuff(31, 60);
			}
		}
		if (type == 2 && Main.rand.Next(3) == 0)
		{
			nPC.AddBuff(24, 180);
		}
		if (type == 172)
		{
			if (Main.rand.Next(3) == 0)
			{
				nPC.AddBuff(44, 180);
			}
		}
		else if (type == 15)
		{
			int num5 = 24;
			if (Main.remixWorld)
			{
				num5 = 323;
			}
			if (Main.rand.Next(2) == 0)
			{
				nPC.AddBuff(num5, 300);
			}
		}
		else if (type == 253)
		{
			nPC.AddBuff(324, 480);
		}
		else if (type == 19)
		{
			if (Main.rand.Next(2) == 0)
			{
				nPC.AddBuff(24, 360);
			}
		}
		else if (type == 113)
		{
			if (Main.rand.Next(2) == 0)
			{
				nPC.AddBuff(44, 180);
			}
		}
		else if (type == 33)
		{
			if (Main.rand.Next(2) == 0)
			{
				nPC.AddBuff(20, 420);
			}
		}
		else if (type == 976)
		{
			if (Main.rand.Next(4) == 0)
			{
				nPC.AddBuff(20, 420);
			}
		}
		else if (type == 34)
		{
			if (Main.rand.Next(2) == 0)
			{
				nPC.AddBuff(24, Main.rand.Next(240, 480));
			}
		}
		else if (type == 948)
		{
			if (Main.rand.Next(6) == 0)
			{
				nPC.AddBuff(24, 60 * Main.rand.Next(2, 4));
			}
		}
		else if (type == 35)
		{
			if (Main.rand.Next(2) == 0)
			{
				nPC.AddBuff(24, 300);
			}
		}
		else if (type == 54)
		{
			if (Main.rand.Next(2) == 0)
			{
				nPC.AddBuff(20, 600);
			}
		}
		else if (type == 267)
		{
			if (Main.rand.Next(3) == 0)
			{
				nPC.AddBuff(20, 3600);
			}
			else
			{
				nPC.AddBuff(20, 1800);
			}
		}
		else if (type == 63)
		{
			if (Main.rand.Next(5) != 0)
			{
				nPC.AddBuff(31, 60 * Main.rand.Next(2, 5));
			}
		}
		else if (type == 85)
		{
			int num6 = ((ai[0] == 1f) ? 324 : 323);
			nPC.AddBuff(num6, 1200);
		}
		else if (type == 1106)
		{
			nPC.AddBuff(24, 300);
		}
		else if (type == 188)
		{
			nPC.AddBuff(323, 1200);
		}
		else if (type == 95 || type == 103 || type == 104 || type == 482)
		{
			nPC.AddBuff(39, 420);
		}
		else if (type == 278 || type == 279 || type == 280)
		{
			nPC.AddBuff(69, 600);
		}
		else if (type == 282 || type == 283)
		{
			nPC.AddBuff(70, 600);
		}
		if (type == 163 || type == 310 || type == 1008 || type == 1010 || type == 1011)
		{
			if (Main.rand.Next(3) == 0)
			{
				nPC.AddBuff(24, 600);
			}
			else
			{
				nPC.AddBuff(24, 300);
			}
		}
		if (type == 1053)
		{
			nPC.AddBuff(24, 300);
		}
		if (type == 1009)
		{
			nPC.AddBuff(39, 600);
		}
		else if (type == 98)
		{
			nPC.AddBuff(20, 600);
		}
		else if (type == 184)
		{
			nPC.AddBuff(20, 900);
		}
		else if (type == 980)
		{
			nPC.AddBuff(70, 300);
		}
		else if (type == 265)
		{
			nPC.AddBuff(20, 1800);
		}
		else if (type == 355)
		{
			nPC.AddBuff(70, 1800);
		}
		else if (type == 1103)
		{
			nPC.AddBuff(137, 180);
		}
	}

	private void ApplyWhipDebuffs(NPC targetNPC)
	{
		switch (type)
		{
		case 913:
			targetNPC.AddBuff(323, 240);
			break;
		case 912:
			targetNPC.AddBuff(324, 240);
			break;
		case 914:
			if (Main.rand.Next(5) == 0)
			{
				targetNPC.AddBuff(20, 180);
			}
			break;
		case 1033:
			targetNPC.AddBuff(362, 240);
			break;
		case 849:
			targetNPC.AddBuff(310, 240);
			break;
		}
	}

	public void StatusPvP(int i)
	{
		Player player = Main.player[i];
		if ((melee || ProjectileID.Sets.IsAWhip[type]) && Main.player[owner].meleeEnchant > 0 && !noEnchantments)
		{
			byte meleeEnchant = Main.player[owner].meleeEnchant;
			if (meleeEnchant == 1)
			{
				ApplyBuffTo(player, 70, 60 * Main.rand.Next(5, 10));
			}
			if (meleeEnchant == 2)
			{
				ApplyBuffTo(player, 39, 60 * Main.rand.Next(3, 7));
			}
			if (meleeEnchant == 3)
			{
				ApplyBuffTo(player, 24, 60 * Main.rand.Next(3, 7));
			}
			if (meleeEnchant == 5)
			{
				ApplyBuffTo(player, 69, 60 * Main.rand.Next(10, 20));
			}
			if (meleeEnchant == 6)
			{
				ApplyBuffTo(player, 31, 60 * Main.rand.Next(1, 4));
			}
			if (meleeEnchant == 8)
			{
				ApplyBuffTo(player, 20, 60 * Main.rand.Next(5, 10));
			}
		}
		if (type == 1083)
		{
			ApplyBuffTo(player, 30, 60 * Main.rand.Next(4, 7));
		}
		if (type == 285)
		{
			if (Main.rand.Next(3) == 0)
			{
				ApplyBuffTo(player, 31, 180);
			}
			else
			{
				ApplyBuffTo(player, 31, 60);
			}
		}
		if (type == 669 && Main.rand.Next(20) == 0)
		{
			ApplyBuffTo(player, 31, 60 * Main.rand.Next(2, 6));
		}
		if (type == 182)
		{
			ApplyBuffTo(player, 30, 60 * Main.rand.Next(8, 13));
		}
		if (type == 190)
		{
			ApplyBuffTo(player, 30, 60 * Main.rand.Next(4, 7));
		}
		if (type == 301)
		{
			ApplyBuffTo(player, 36, 60 * Main.rand.Next(10, 21));
		}
		if (type == 383 && Main.rand.Next(3) == 0)
		{
			ApplyBuffTo(player, 31, 60 * (int)((double)Main.rand.Next(10, 21) * 0.1));
		}
		if (type == 262 && Main.rand.Next(3) == 0)
		{
			ApplyBuffTo(player, 31, 60 * (int)((double)Main.rand.Next(10, 21) * 0.1));
		}
		if (type == 23)
		{
			ApplyBuffTo(player, 30, 60 * Main.rand.Next(8, 13));
		}
		if (type == 320)
		{
			ApplyBuffTo(player, 30, 60 * Main.rand.Next(3, 6));
		}
		if (type == 1048)
		{
			ApplyBuffTo(player, 20, 600);
			ApplyBuffTo(player, 120, 600);
		}
		if (type == 978)
		{
			ApplyBuffTo(player, 24, 180);
		}
		if (type == 295 || type == 296)
		{
			ApplyBuffTo(player, 323, 60 * Main.rand.Next(8, 16));
		}
		if (type >= 399 && type <= 402)
		{
			ApplyBuffTo(player, 24, 60 * Main.rand.Next(3, 7));
		}
		if (type == 478 || type == 480)
		{
			ApplyBuffTo(player, 39, 60 * Main.rand.Next(3, 7));
		}
		if ((melee || ranged) && Main.player[owner].frostBurn && !noEnchantments)
		{
			ApplyBuffTo(player, 324, 60 * Main.rand.Next(1, 8));
		}
		if (melee && Main.player[owner].magmaStone && !noEnchantments)
		{
			if (Main.rand.Next(4) == 0)
			{
				ApplyBuffTo(player, 24, 360);
			}
			else if (Main.rand.Next(2) == 0)
			{
				ApplyBuffTo(player, 24, 240);
			}
			else
			{
				ApplyBuffTo(player, 24, 120);
			}
		}
		if (type == 2 && Main.rand.Next(3) == 0)
		{
			ApplyBuffTo(player, 24, 180);
		}
		if (type == 172)
		{
			if (Main.rand.Next(3) == 0)
			{
				ApplyBuffTo(player, 44, 240);
			}
		}
		else if (type == 15)
		{
			int buffType = 24;
			if (Main.remixWorld)
			{
				buffType = 323;
			}
			if (Main.rand.Next(2) == 0)
			{
				ApplyBuffTo(player, buffType, 300);
			}
		}
		else if (type == 253)
		{
			if (Main.rand.Next(2) == 0)
			{
				ApplyBuffTo(player, 44, 480);
			}
		}
		else if (type == 19)
		{
			if (Main.rand.Next(5) == 0)
			{
				ApplyBuffTo(player, 24, 180);
			}
		}
		else if (type == 113)
		{
			if (Main.rand.Next(5) == 0)
			{
				ApplyBuffTo(player, 44, 180);
			}
		}
		else if (type == 33)
		{
			if (Main.rand.Next(5) == 0)
			{
				ApplyBuffTo(player, 20, 420);
			}
		}
		else if (type == 976)
		{
			if (Main.rand.Next(4) == 0)
			{
				ApplyBuffTo(player, 20, 420);
			}
		}
		else if (type == 34)
		{
			if (Main.rand.Next(2) == 0)
			{
				ApplyBuffTo(player, 24, 240);
			}
		}
		else if (type == 35)
		{
			if (Main.rand.Next(4) == 0)
			{
				ApplyBuffTo(player, 24, 180);
			}
		}
		else if (type == 54)
		{
			if (Main.rand.Next(2) == 0)
			{
				ApplyBuffTo(player, 20, 600);
			}
		}
		else if (type == 267)
		{
			if (Main.rand.Next(3) == 0)
			{
				ApplyBuffTo(player, 20, 3600);
			}
			else
			{
				ApplyBuffTo(player, 20, 1800);
			}
		}
		else if (type == 63)
		{
			if (Main.rand.Next(3) != 0)
			{
				ApplyBuffTo(player, 31, 120);
			}
		}
		else if (type == 85)
		{
			ApplyBuffTo(player, 24, 1200);
		}
		else if (type == 95 || type == 103 || type == 104 || type == 482)
		{
			ApplyBuffTo(player, 39, 420);
		}
		else if (type == 278 || type == 279 || type == 280)
		{
			ApplyBuffTo(player, 69, 900);
		}
		else if (type == 282 || type == 283)
		{
			ApplyBuffTo(player, 70, 600);
		}
		if (type == 163 || type == 310 || type == 1008 || type == 1010 || type == 1011)
		{
			if (Main.rand.Next(3) == 0)
			{
				ApplyBuffTo(player, 24, 600);
			}
			else
			{
				ApplyBuffTo(player, 24, 300);
			}
		}
		if (type == 1009)
		{
			ApplyBuffTo(player, 39, 300);
		}
		else if (type == 265)
		{
			ApplyBuffTo(player, 20, 1200);
		}
		else if (type == 355)
		{
			ApplyBuffTo(player, 70, 1800);
		}
	}

	public void ghostHurt(int dmg, Vector2 Position, Entity victim)
	{
		if (!magic || damage <= 0)
		{
			return;
		}
		int num = damage;
		if (dmg <= 1)
		{
			return;
		}
		int num2 = -1;
		int num3 = 1500;
		if (Main.player[Main.myPlayer].ghostDmg > (float)num3)
		{
			return;
		}
		Main.player[Main.myPlayer].ghostDmg += num;
		int[] array = new int[Main.maxNPCs];
		int num4 = 0;
		_ = new int[Main.maxNPCs];
		int num5 = 0;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (!Main.npc[i].CanBeChasedBy(this))
			{
				continue;
			}
			float num6 = Math.Abs(Main.npc[i].position.X + (float)(Main.npc[i].width / 2) - position.X + (float)(width / 2)) + Math.Abs(Main.npc[i].position.Y + (float)(Main.npc[i].height / 2) - position.Y + (float)(height / 2));
			if (num6 < 800f)
			{
				if (Collision.CanHit(position, 1, 1, Main.npc[i].position, Main.npc[i].width, Main.npc[i].height) && num6 > 50f)
				{
					array[num5] = i;
					num5++;
				}
				else if (num5 == 0)
				{
					array[num4] = i;
					num4++;
				}
			}
		}
		if (num4 != 0 || num5 != 0)
		{
			num2 = ((num5 <= 0) ? array[Main.rand.Next(num4)] : array[Main.rand.Next(num5)]);
			float num7 = Main.rand.Next(-100, 101);
			float num8 = Main.rand.Next(-100, 101);
			float num9 = (float)Math.Sqrt(num7 * num7 + num8 * num8);
			num9 = 4f / num9;
			num7 *= num9;
			num8 *= num9;
			NewProjectile(GetProjectileSource_OnHit(victim, 16), Position.X, Position.Y, num7, num8, 356, num, 0f, owner, num2);
		}
	}

	public void ghostHeal(int dmg, Vector2 Position, Entity victim)
	{
		float num = 0.2f;
		num -= (float)numHits * 0.05f;
		if (num <= 0f)
		{
			return;
		}
		float num2 = (float)dmg * num;
		if ((int)num2 <= 0 || Main.player[Main.myPlayer].lifeSteal <= 0f)
		{
			return;
		}
		Main.player[Main.myPlayer].lifeSteal -= num2;
		if (!magic)
		{
			return;
		}
		float num3 = 0f;
		int num4 = owner;
		for (int i = 0; i < 255; i++)
		{
			if (Main.player[i].active && !Main.player[i].dead && ((!Main.player[owner].hostile && !Main.player[i].hostile) || Main.player[owner].team == Main.player[i].team) && Distance(Main.player[i].Center) <= 3000f)
			{
				int num5 = Main.player[i].statLifeMax2 - Main.player[i].statLife;
				if ((float)num5 > num3)
				{
					num3 = num5;
					num4 = i;
				}
			}
		}
		NewProjectile(GetProjectileSource_OnHit(victim, 15), Position.X, Position.Y, 0f, 0f, 298, 0, 0f, owner, num4, num2);
	}

	public void vampireHeal(int dmg, Vector2 Position, Entity victim)
	{
		float num = (float)dmg * 0.075f;
		if ((int)num != 0 && !(Main.player[Main.myPlayer].lifeSteal <= 0f))
		{
			Main.player[Main.myPlayer].lifeSteal -= num;
			int num2 = owner;
			NewProjectile(GetProjectileSource_OnHit(victim, 18), Position.X, Position.Y, 0f, 0f, 305, 0, 0f, owner, num2, num);
		}
	}

	public void StatusPlayer(Player player)
	{
		if (player.creativeGodMode)
		{
			return;
		}
		if (type == 1078)
		{
			ApplyBuffTo(player, 24, Main.rand.Next(300, 600));
		}
		if (type == 285)
		{
			if (Main.rand.Next(3) == 0)
			{
				ApplyBuffTo(player, 31, 180);
			}
			else
			{
				ApplyBuffTo(player, 31, 60);
			}
		}
		if (type == 1048)
		{
			ApplyBuffTo(player, 20, 600);
			ApplyBuffTo(player, 120, 600);
		}
		if (type == 669 && Main.rand.Next(20) == 0)
		{
			ApplyBuffTo(player, 31, 60 * Main.rand.Next(2, 6));
		}
		if (type == 119)
		{
			ApplyBuffTo(player, 324, 240);
		}
		if (type == 359)
		{
			ApplyBuffTo(player, 324, 420);
		}
		if (type == 188)
		{
			ApplyBuffTo(player, 323, 1200);
		}
		if (type == 472)
		{
			ApplyBuffTo(player, 149, Main.rand.Next(30, 150));
		}
		if (type == 961)
		{
			ApplyBuffTo(player, 47, 20);
		}
		if (type == 467)
		{
			ApplyBuffTo(player, 24, Main.rand.Next(30, 150));
		}
		if (type == 581)
		{
			if (Main.expertMode)
			{
				ApplyBuffTo(player, 164, Main.rand.Next(300, 540));
			}
			else if (Main.rand.Next(2) == 0)
			{
				ApplyBuffTo(player, 164, Main.rand.Next(360, 720));
			}
		}
		if (type == 687)
		{
			ApplyBuffTo(player, 24, 60 * Main.rand.Next(7, 11));
		}
		if (type == 258 && Main.rand.Next(2) == 0)
		{
			ApplyBuffTo(player, 24, 60 * Main.rand.Next(5, 8));
		}
		if (type == 572 && Main.rand.Next(3) != 0)
		{
			ApplyBuffTo(player, 20, Main.rand.Next(120, 240));
		}
		if (type == 276)
		{
			if (Main.expertMode)
			{
				ApplyBuffTo(player, 20, Main.rand.Next(120, 540));
			}
			else if (Main.rand.Next(2) == 0)
			{
				ApplyBuffTo(player, 20, Main.rand.Next(180, 420));
			}
		}
		if (type == 436 && Main.rand.Next(5) >= 2)
		{
			ApplyBuffTo(player, 31, 300);
		}
		if (type == 435 && Main.rand.Next(3) != 0)
		{
			ApplyBuffTo(player, 144, 300);
		}
		if (type == 682)
		{
			ApplyBuffTo(player, 196, 300);
		}
		if (type == 437)
		{
			ApplyBuffTo(player, 144, 60 * Main.rand.Next(4, 9));
		}
		if (type == 348)
		{
			if (Main.rand.Next(2) == 0)
			{
				ApplyBuffTo(player, 46, 600);
			}
			else
			{
				ApplyBuffTo(player, 46, 300);
			}
			if (Main.rand.Next(3) != 0)
			{
				if (Main.rand.Next(16) == 0)
				{
					ApplyBuffTo(player, 47, 60);
				}
				else if (Main.rand.Next(12) == 0)
				{
					ApplyBuffTo(player, 47, 40);
				}
				else if (Main.rand.Next(8) == 0)
				{
					ApplyBuffTo(player, 47, 20);
				}
			}
		}
		if (type == 349)
		{
			if (Main.rand.Next(3) == 0)
			{
				ApplyBuffTo(player, 46, 600);
			}
			else if (Main.rand.Next(2) == 0)
			{
				ApplyBuffTo(player, 46, 300);
			}
		}
		if (type >= 399 && type <= 402 && !hostile)
		{
			ApplyBuffTo(player, 24, 60 * Main.rand.Next(3, 7));
		}
		if (type == 55 || type == 719)
		{
			if (Main.rand.Next(3) == 0)
			{
				ApplyBuffTo(player, 20, 600);
			}
			else if (Main.expertMode)
			{
				ApplyBuffTo(player, 20, Main.rand.Next(60, 300));
			}
		}
		if (type == 44 && Main.rand.Next(3) == 0)
		{
			ApplyBuffTo(player, 22, 900);
		}
		if (type == 293)
		{
			ApplyBuffTo(player, 80, 60 * Main.rand.Next(2, 7));
		}
		if (type == 299)
		{
			ApplyBuffTo(player, 23, 240);
		}
		if (type == 82 && Main.rand.Next(3) == 0)
		{
			ApplyBuffTo(player, 24, 420);
		}
		if (type == 285 && !hostile)
		{
			if (Main.rand.Next(3) == 0)
			{
				ApplyBuffTo(player, 31, 180);
			}
			else
			{
				ApplyBuffTo(player, 31, 60);
			}
		}
		if (type == 96 || type == 101)
		{
			if (Main.rand.Next(6) == 0)
			{
				ApplyBuffTo(player, 39, 180);
			}
			else if (Main.rand.Next(4) == 0)
			{
				ApplyBuffTo(player, 39, 180);
			}
			else if (Main.rand.Next(2) == 0)
			{
				ApplyBuffTo(player, 39, 120);
			}
		}
		else if (type == 288)
		{
			ApplyBuffTo(player, 69, 900);
		}
		else if (type == 253 && !hostile)
		{
			ApplyBuffTo(player, 324, 600);
		}
		if (type == 291 || type == 292)
		{
			ApplyBuffTo(player, 24, 60 * Main.rand.Next(8, 16));
		}
		if (type == 98 || type == 1073)
		{
			ApplyBuffTo(player, 20, 600);
		}
		if (type == 1053)
		{
			ApplyBuffTo(player, 24, 300);
		}
		if (type == 184)
		{
			ApplyBuffTo(player, 20, 900);
		}
		if (type == 980)
		{
			ApplyBuffTo(player, 70, 300);
		}
		if (type == 290)
		{
			ApplyBuffTo(player, 32, 60 * Main.rand.Next(5, 16));
		}
		if (type == 174)
		{
			ApplyBuffTo(player, 46, 1200);
			if (!player.frozen && Main.rand.Next(20) == 0)
			{
				ApplyBuffTo(player, 47, 90);
			}
			else if (!player.frozen && Main.expertMode && Main.rand.Next(20) == 0)
			{
				ApplyBuffTo(player, 47, 60);
			}
		}
		if (type == 257)
		{
			ApplyBuffTo(player, 46, 2700);
			if (!player.frozen && Main.rand.Next(5) == 0)
			{
				ApplyBuffTo(player, 47, 60);
			}
		}
		if (type == 177)
		{
			ApplyBuffTo(player, 46, 1500);
			if (!player.frozen && Main.rand.Next(10) == 0)
			{
				ApplyBuffTo(player, 47, Main.rand.Next(30, 120));
			}
		}
		if (type == 128 && Main.rand.Next(3) == 0)
		{
			ApplyBuffTo(player, 44, 360);
		}
		if (type == 176)
		{
			if (Main.rand.Next(4) == 0)
			{
				ApplyBuffTo(player, 20, 1200);
			}
			else if (Main.rand.Next(2) == 0)
			{
				ApplyBuffTo(player, 20, 300);
			}
		}
	}

	public void ApplyBuffTo(Player player, int buffType, int buffTime)
	{
		if (trap && player.deadMansSweater)
		{
			buffTime /= 2;
		}
		player.AddBuff(buffType, buffTime);
	}

	public bool CanHitWithMeleeWeapon(Entity ent)
	{
		if (Distance(ent.Center) > ownerHitCheckDistance)
		{
			return false;
		}
		if (!Collision.CanHit(Main.player[owner].position, Main.player[owner].width, Main.player[owner].height, ent.position, ent.width, ent.height) && !Collision.CanHitLine(Main.player[owner].Center + new Vector2(Main.player[owner].direction * Main.player[owner].width / 2, Main.player[owner].gravDir * (float)(-Main.player[owner].height) / 3f), 0, 0, ent.Center + new Vector2(0f, -ent.height / 3), 0, 0) && !Collision.CanHitLine(Main.player[owner].Center + new Vector2(Main.player[owner].direction * Main.player[owner].width / 2, Main.player[owner].gravDir * (float)(-Main.player[owner].height) / 3f), 0, 0, ent.Center, 0, 0))
		{
			return Collision.CanHitLine(Main.player[owner].Center + new Vector2(Main.player[owner].direction * Main.player[owner].width / 2, 0f), 0, 0, ent.Center + new Vector2(0f, ent.height / 3), 0, 0);
		}
		return true;
	}

	public bool CanHitWithOwnBody(Entity ent)
	{
		if (Distance(ent.Center) > ownerHitCheckDistance)
		{
			return false;
		}
		bool flag = Collision.CanHit(base.position, width, height, ent.position, ent.width, ent.height) || Collision.CanHitLine(base.Center + new Vector2(direction * width / 2, -height / 3), 0, 0, ent.Center + new Vector2(0f, -ent.height / 3), 0, 0) || Collision.CanHitLine(base.Center + new Vector2(direction * width / 2, -height / 3), 0, 0, ent.Center, 0, 0) || Collision.CanHitLine(base.Center + new Vector2(direction * width / 2, 0f), 0, 0, ent.Center + new Vector2(0f, ent.height / 3), 0, 0);
		float num = ProjectileID.Sets.ExtendedCanHitCheckRange[type];
		if (num != 0f)
		{
			if (flag)
			{
				return flag;
			}
			GenSearch genSearch = ProjectileID.Sets.ExtendedCanHitCheckSearch[type];
			Vector2 position = base.Top + new Vector2(0f, 0f - num);
			Vector2 position2 = ent.Top + new Vector2(0f, 0f - num);
			if (genSearch != null)
			{
				if (WorldUtils.Find(base.Top.ToTileCoordinates(), Searches.Chain(genSearch, _cachedConditions_notNull, _cachedConditions_solid), out var result))
				{
					position = result.ToWorldCoordinates();
				}
				if (WorldUtils.Find(ent.Top.ToTileCoordinates(), Searches.Chain(genSearch, _cachedConditions_notNull, _cachedConditions_solid), out result))
				{
					position2 = result.ToWorldCoordinates();
				}
			}
			flag |= Collision.CanHitLine(position, 0, 0, position2, 0, 0);
		}
		return flag;
	}

	private bool Damage_CanDealDamage()
	{
		if (type == 18 || type == 72 || type == 86 || type == 87 || aiStyle == 31 || aiStyle == 32 || type == 226 || type == 378 || type == 613 || type == 650 || type == 882 || type == 888 || type == 895 || type == 896 || (type == 434 && localAI[0] != 0f) || type == 439 || type == 444 || (type == 451 && ((int)(ai[0] - 1f) / penetrate == 0 || ai[1] < 5f) && ai[0] != 0f) || type == 500 || type == 653 || type == 1018 || type == 1056 || type == 1090 || type == 460 || type == 633 || type == 600 || type == 601 || type == 602 || type == 535 || (type == 631 && localAI[1] == 0f) || (type == 537 && localAI[0] <= 30f) || type == 651 || (type == 188 && localAI[0] < 5f) || (aiStyle == 137 && ai[0] != 0f) || aiStyle == 138 || (type == 261 && velocity.Length() < 1.5f) || (type == 818 && ai[0] < 1f) || type == 831 || type == 970 || (type == 833 && ai[0] == 4f) || (type == 834 && ai[0] == 4f) || (type == 835 && ai[0] == 4f) || (type == 281 && ai[0] == -3f) || ((type == 598 || type == 636 || type == 614 || type == 971 || type == 975 || type == 1024) && ai[0] == 1f) || (type == 923 && localAI[0] <= 60f) || (type == 919 && localAI[0] <= 60f) || (aiStyle == 15 && ai[0] == 0f && localAI[1] <= 12f) || type == 861 || (type >= 511 && type <= 513 && ai[1] >= 1f) || type == 1007 || (type == 1022 && ai[2] > 0f) || (type == 1092 && ai[0] <= 1f))
		{
			return false;
		}
		if (aiStyle == 93 && ai[0] != 0f && ai[0] != 2f)
		{
			return false;
		}
		if (aiStyle == 10 && localAI[1] == -1f)
		{
			return false;
		}
		if (type == 85 && localAI[0] >= 54f)
		{
			return false;
		}
		if (type == 1106 && localAI[0] >= 54f)
		{
			return false;
		}
		if (type == 1091 && localAI[0] <= 0f)
		{
			return false;
		}
		if (aiStyle == 25 && type != 1021 && type != 1047 && type != 1005 && type != 1014 && localAI[2] <= 7f)
		{
			return false;
		}
		if (Main.projPet[type] && type != 266 && type != 407 && type != 317 && (type != 388 || ai[0] != 2f) && (type < 390 || type > 392) && (type < 393 || type > 395) && type != 1093 && (type != 533 || !(ai[0] >= 6f) || !(ai[0] <= 8f)) && (type < 625 || type > 628) && (type != 755 || ai[0] == 0f) && (type != 946 || ai[0] == 0f) && type != 758 && type != 951 && type != 963 && type != 1022 && (type != 759 || frame == Main.projFrames[type] - 1) && type != 833 && type != 834 && type != 835 && type != 864 && (type != 623 || ai[0] != 2f))
		{
			return false;
		}
		return true;
	}

	public void Damage()
	{
		if (Damage_CanDealDamage())
		{
			Rectangle projRectangle = Damage_GetHitbox();
			if (friendly && owner == Main.myPlayer && !npcProj && !minion && type != 1054)
			{
				CutTiles();
			}
			Damage_TryUsingPowders(projRectangle);
			if (owner == Main.myPlayer)
			{
				float projectileSpecificDamageMultiplier = Damage_GetProjectileSpecificDamageMultiplier();
				Damage_PVE(projRectangle, projectileSpecificDamageMultiplier);
				Damage_PVP(projRectangle, projectileSpecificDamageMultiplier);
			}
			if (Main.netMode != 2)
			{
				Damage_EVP(projRectangle);
			}
		}
	}

	private void Damage_StartIteratingNPC(NPC targetNPC)
	{
		targetNPC.position += targetNPC.netOffset;
	}

	private void Damage_StopIteratingNPC(NPC targetNPC)
	{
		targetNPC.position -= targetNPC.netOffset;
	}

	private void Damage_PVE(Rectangle projRectangle, float projectileSpecificDamageMultiplier)
	{
		bool ownedBySomeone = OwnedBySomeone;
		bool flag = usesOwnerMeleeHitCD && ownedBySomeone && owner < 255;
		if (damage <= 0)
		{
			return;
		}
		int[] array = localNPCImmunity;
		if (type == 626 || type == 627 || type == 628)
		{
			Projectile projectile = FindStardustDragonHeadOfOwner();
			if (projectile != null)
			{
				array = projectile.localNPCImmunity;
			}
		}
		bool keepIterating = true;
		for (int i = 0; i < Main.maxNPCs && keepIterating; i++)
		{
			NPC nPC = Main.npc[i];
			if (nPC.active)
			{
				bool flag2 = (!usesLocalNPCImmunity && !usesIDStaticNPCImmunity) || (usesLocalNPCImmunity && array[i] == 0) || (usesIDStaticNPCImmunity && IsNPCIndexImmuneToProjectileType(type, i));
				if (flag && !Main.player[owner].CanHitNPCWithMeleeHit(i))
				{
					flag2 = false;
				}
				if (flag2 && (!nPC.dontTakeDamage || NPCID.Sets.ZappingJellyfish[nPC.type]) && (nPC.aiStyle != 112 || !(nPC.ai[2] > 1f)))
				{
					Damage_StartIteratingNPC(nPC);
					Damage_PVE_Inner(i, nPC, projRectangle, projectileSpecificDamageMultiplier, array, ref keepIterating);
					Damage_StopIteratingNPC(nPC);
				}
			}
		}
	}

	private void Damage_PVE_Inner(int victimIndex, NPC targetNPC, Rectangle projRectangle, float projectileSpecificDamageMultiplier, int[] immuneArray, ref bool keepIterating)
	{
		bool ownedBySomeone = OwnedBySomeone;
		bool flag = !targetNPC.friendly;
		flag |= type == 318;
		flag |= targetNPC.type == 22 && owner < 255 && Main.player[owner].killGuide;
		flag |= targetNPC.type == 54 && owner < 255 && Main.player[owner].killClothier;
		if (owner < 255 && !Main.player[owner].CanNPCBeHitByPlayerOrPlayerProjectile(targetNPC, this))
		{
			flag = false;
		}
		bool flag2 = targetNPC.friendly && !targetNPC.dontTakeDamageFromHostiles;
		if ((!friendly || (!flag && !NPCID.Sets.ZappingJellyfish[targetNPC.type])) && !(hostile && flag2))
		{
			return;
		}
		bool flag3 = maxPenetrate == 1 && !usesLocalNPCImmunity && !usesIDStaticNPCImmunity;
		if (!(owner < 0 || targetNPC.immune[owner] == 0 || flag3))
		{
			return;
		}
		bool flag4 = false;
		if (type == 11 && (targetNPC.type == 47 || targetNPC.type == 57))
		{
			flag4 = true;
		}
		else if (type == 31 && targetNPC.type == 69)
		{
			flag4 = true;
		}
		else if (targetNPC.trapImmune && trap)
		{
			flag4 = true;
		}
		else if (targetNPC.immortal && npcProj)
		{
			flag4 = true;
		}
		if (flag4 || (!targetNPC.noTileCollide && ownerHitCheck && !CanHitWithMeleeWeapon(targetNPC)))
		{
			return;
		}
		bool flag5 = false;
		if (targetNPC.type == 414)
		{
			Rectangle rect = targetNPC.getRect();
			int num = 8;
			rect.X -= num;
			rect.Y -= num;
			rect.Width += num * 2;
			rect.Height += num * 2;
			flag5 = Colliding(projRectangle, rect);
		}
		else
		{
			flag5 = Colliding(projRectangle, targetNPC.getRect());
		}
		if (!flag5)
		{
			return;
		}
		if (NPCID.Sets.ZappingJellyfish[targetNPC.type])
		{
			if ((targetNPC.dontTakeDamage || !Main.player[owner].CanNPCBeHitByPlayerOrPlayerProjectile(targetNPC, this)) && (aiStyle == 19 || aiStyle == 161 || aiStyle == 75 || aiStyle == 140 || ProjectileID.Sets.IsAWhip[type] || ProjectileID.Sets.AllowsContactDamageFromJellyfish[type]))
			{
				Main.player[owner].TakeDamageFromJellyfish(victimIndex);
			}
			if (targetNPC.dontTakeDamage || !flag)
			{
				return;
			}
		}
		if (type == 876)
		{
			Vector2 vector = position;
			if (Main.rand.Next(20) == 0)
			{
				tileCollide = false;
				position.X += Main.rand.Next(-256, 257);
			}
			if (Main.rand.Next(20) == 0)
			{
				tileCollide = false;
				position.Y += Main.rand.Next(-256, 257);
			}
			if (Main.rand.Next(2) == 0)
			{
				tileCollide = false;
			}
			if (Main.rand.Next(3) != 0)
			{
				vector = position;
				position -= velocity * Main.rand.Next(0, 40);
				if (tileCollide && Collision.SolidTiles(position, width, height))
				{
					position = vector;
					position -= velocity * Main.rand.Next(0, 40);
					if (tileCollide && Collision.SolidTiles(position, width, height))
					{
						position = vector;
					}
				}
			}
			velocity *= 0.6f;
			if (Main.rand.Next(7) == 0)
			{
				velocity.X += (float)Main.rand.Next(30, 31) * 0.01f;
			}
			if (Main.rand.Next(7) == 0)
			{
				velocity.Y += (float)Main.rand.Next(30, 31) * 0.01f;
			}
			damage = (int)((double)damage * 0.9);
			knockBack *= 0.9f;
			if (Main.rand.Next(20) == 0)
			{
				knockBack *= 10f;
			}
			if (Main.rand.Next(50) == 0)
			{
				damage *= 10;
			}
			if (Main.rand.Next(7) == 0)
			{
				vector = position;
				position.X += Main.rand.Next(-64, 65);
				if (tileCollide && Collision.SolidTiles(position, width, height))
				{
					position = vector;
				}
			}
			if (Main.rand.Next(7) == 0)
			{
				vector = position;
				position.Y += Main.rand.Next(-64, 65);
				if (tileCollide && Collision.SolidTiles(position, width, height))
				{
					position = vector;
				}
			}
			if (Main.rand.Next(14) == 0)
			{
				velocity.X *= -1f;
			}
			if (Main.rand.Next(14) == 0)
			{
				velocity.Y *= -1f;
			}
			if (Main.rand.Next(10) == 0)
			{
				velocity *= (float)Main.rand.Next(1, 201) * 0.0005f;
			}
			if (tileCollide)
			{
				ai[1] = 0f;
			}
			else
			{
				ai[1] = 1f;
			}
			netUpdate = true;
		}
		bool flag6 = targetNPC.reflectsProjectiles;
		if (Main.getGoodWorld && NPCID.Sets.ReflectStarShotsInForTheWorthy[targetNPC.type] && (type == 955 || type == 728))
		{
			flag6 = true;
		}
		if (flag6 && CanBeReflected() && targetNPC.CanReflectProjectile(this))
		{
			targetNPC.ReflectProjectile(this);
			keepIterating = false;
			return;
		}
		if (type == 604)
		{
			Main.player[owner].Counterweight(targetNPC.Center, damage, knockBack);
		}
		float num2 = knockBack;
		bool crit = false;
		float armorPenetrationPercent = 0f;
		int num3 = Main.player[owner].GetArmorPenetration(melee) + armorPenetration;
		bool flag7 = false;
		switch (type)
		{
		case 442:
			flag7 = true;
			break;
		case 189:
			if (ownedBySomeone && Main.player[owner].strongBees)
			{
				num3 += 5;
			}
			break;
		case 877:
		case 878:
		case 879:
			num2 *= Main.player[owner].velocity.Length() / 7f;
			break;
		case 963:
			num2 = ((!(ai[0] >= 2f)) ? 0f : 2f);
			break;
		}
		if (flag7)
		{
			Kill();
			keepIterating = false;
			return;
		}
		int num4 = (int)((float)damage * projectileSpecificDamageMultiplier);
		if (type > 0 && type < ProjectileID.Count && ProjectileID.Sets.StardustDragon[type])
		{
			float value = (scale - 1f) * 100f;
			value = Utils.Clamp(value, 0f, 50f);
			num4 = (int)((float)num4 * (1f + value * 0.23f));
		}
		if (type > 0 && type < ProjectileID.Count && ProjectileID.Sets.StormTiger[type])
		{
			int num5 = Math.Max(0, Main.player[owner].ownedProjectileCounts[831] - 1);
			num4 = (int)((float)num4 * (1f + (float)num5 * 0.4f));
		}
		if (type == 818)
		{
			int num6 = Math.Max(0, Main.player[owner].ownedProjectileCounts[831] - 1);
			num4 = (int)((float)num4 * (1.5f + (float)num6 * 0.4f));
		}
		if (type == 963)
		{
			int num7 = Math.Max(0, Main.player[owner].ownedProjectileCounts[970] - 1);
			int num8 = 3 + num7 / 2;
			if (CountEnemiesWhoAreImmuneToMeRightNow(num8) >= num8)
			{
				return;
			}
			float num9 = 0.55f;
			if (Main.hardMode)
			{
				num9 = 1.3f;
			}
			num4 = (int)((float)num4 * (1f + (float)num7 * num9));
		}
		if (ownedBySomeone && type == 189 && Main.player[owner].strongBees)
		{
			num4 += 5;
		}
		if (ownedBySomeone)
		{
			int num10 = 0;
			if (bonusCritChance > 0)
			{
				num10 += bonusCritChance;
			}
			if (melee && Main.rand.Next(1, 101) <= Main.player[owner].meleeCrit + num10)
			{
				crit = true;
			}
			if (ranged && Main.rand.Next(1, 101) <= Main.player[owner].rangedCrit + num10)
			{
				crit = true;
			}
			if (magic && Main.rand.Next(1, 101) <= Main.player[owner].magicCrit + num10)
			{
				crit = true;
			}
			int num11 = type;
			if ((uint)(num11 - 688) <= 2u)
			{
				if (Main.player[owner].setMonkT3)
				{
					if (Main.rand.Next(4) == 0)
					{
						crit = true;
					}
				}
				else if (Main.player[owner].setMonkT2 && Main.rand.Next(6) == 0)
				{
					crit = true;
				}
			}
		}
		int damageDealt = num4;
		Main.player[owner].TagEffectState.ModifyHit(this, targetNPC, ref damageDealt, ref crit);
		int num12 = ((!ownedBySomeone) ? Main.DamageVar(damageDealt) : Main.DamageVar(damageDealt, Main.player[owner].luck));
		if (type == 1002)
		{
			num12 /= 2;
		}
		if (type == 1074)
		{
			num12 = targetNPC.KeyBrandStrike(owner, num12, base.Center);
		}
		if (trap && NPCID.Sets.BelongsToInvasionOldOnesArmy[targetNPC.type])
		{
			num12 /= 2;
		}
		if (type == 482 && (targetNPC.aiStyle == 6 || targetNPC.aiStyle == 37))
		{
			num12 /= 2;
		}
		if (ownedBySomeone)
		{
			Vector2 positionInWorld = Main.rand.NextVector2FromRectangle(targetNPC.Hitbox);
			ParticleOrchestraSettings settings = new ParticleOrchestraSettings
			{
				PositionInWorld = positionInWorld
			};
			switch (type)
			{
			case 972:
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.NightsEdge, settings, owner);
				break;
			case 973:
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.TrueNightsEdge, settings, owner);
				break;
			case 984:
			case 985:
				settings.MovementVector = velocity;
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.TerraBlade, settings, owner);
				break;
			case 982:
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.Excalibur, settings, owner);
				break;
			case 983:
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.TrueExcalibur, settings, owner);
				break;
			case 1035:
				settings.MovementVector = velocity.RotatedBy(Main.rand.NextFloatDirection() * ((float)Math.PI * 2f) * 0.1f);
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.MoonLordWhipHit, settings, owner);
				break;
			case 1045:
				settings.PositionInWorld = Vector2.Lerp(settings.PositionInWorld, targetNPC.Center, 0.5f);
				settings.MovementVector = velocity;
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.MoonLordWhipHit, settings, owner);
				break;
			}
		}
		if (type == 604)
		{
			friendly = false;
			ai[1] = 1000f;
		}
		if ((type == 400 || type == 401 || type == 402 || type == 1107 || type == 1108 || type == 1109) && targetNPC.type >= 13 && targetNPC.type <= 15)
		{
			num12 = (int)((double)num12 * 0.65);
			if (penetrate > 1)
			{
				penetrate--;
			}
		}
		if (type == 710 && !WorldUtils.Find(base.Center.ToTileCoordinates(), Searches.Chain(new Searches.Down(12), _cachedConditions_notNull, _cachedConditions_solid), out var _))
		{
			num12 = (int)((float)num12 * 1.5f);
		}
		if (type == 504 || type == 954 || type == 979)
		{
			float num13 = (60f - ai[0]) / 2f;
			ai[0] += num13;
		}
		if (type == 301)
		{
			if (projRectangle.Width > width)
			{
				num2 *= 1.75f;
			}
			float x = Main.player[owner].Center.X;
			if (targetNPC.Center.X < x)
			{
				direction = -1;
			}
			else
			{
				direction = 1;
			}
		}
		if (type == 383)
		{
			if (projRectangle.Width > width)
			{
				num2 *= 1.5f;
				num12 = (int)((float)num12 * 0.6f);
			}
			float x2 = Main.player[owner].Center.X;
			if (targetNPC.Center.X < x2)
			{
				direction = -1;
			}
			else
			{
				direction = 1;
			}
		}
		else if (aiStyle == 3 && type != 301 && type != 866 && type != 902 && !ProjectileID.Sets.IsAPhaseblade[type])
		{
			if (ai[0] == 0f)
			{
				if (type == 106)
				{
					LightDisc_Bounce(base.Center + velocity.SafeNormalize(Vector2.UnitX) * 8f, (-velocity).SafeNormalize(Vector2.UnitX));
				}
				velocity.X = 0f - velocity.X;
				velocity.Y = 0f - velocity.Y;
				netUpdate = true;
			}
			ai[0] = 1f;
		}
		else if (type == 951)
		{
			Vector2 vector2 = (targetNPC.Center - base.Center).SafeNormalize(Vector2.Zero);
			vector2.X += (-0.5f + Main.rand.NextFloat()) * 13f;
			vector2.Y = -5f;
			velocity.X = vector2.X;
			velocity.Y = vector2.Y;
			netUpdate = true;
		}
		else if (type == 582 || type == 902)
		{
			if (ai[0] != 0f)
			{
				direction *= -1;
			}
		}
		else if (type == 612 || type == 953 || type == 978)
		{
			direction = Main.player[owner].direction;
		}
		else if (type == 624)
		{
			float num14 = 1f;
			if (targetNPC.knockBackResist > 0f)
			{
				num14 = 1f / targetNPC.knockBackResist;
			}
			knockBack = 4f * num14;
			num2 = knockBack;
			if (targetNPC.Center.X < base.Center.X)
			{
				direction = 1;
			}
			else
			{
				direction = -1;
			}
		}
		else if (aiStyle == 16)
		{
			if (timeLeft > 3)
			{
				timeLeft = 3;
			}
			if (targetNPC.position.X + (float)(targetNPC.width / 2) < position.X + (float)(width / 2))
			{
				direction = -1;
			}
			else
			{
				direction = 1;
			}
		}
		else if (type == 669)
		{
			damage = (int)((double)damage * 0.8);
			timeLeft = 1;
			float x3 = Main.player[owner].Center.X;
			if (targetNPC.Center.X < x3)
			{
				direction = -1;
			}
			else
			{
				direction = 1;
			}
		}
		else if (aiStyle == 68)
		{
			if (timeLeft > 3)
			{
				timeLeft = 3;
			}
			if (targetNPC.position.X + (float)(targetNPC.width / 2) < position.X + (float)(width / 2))
			{
				direction = -1;
			}
			else
			{
				direction = 1;
			}
		}
		else if (aiStyle == 50)
		{
			if (targetNPC.position.X + (float)(targetNPC.width / 2) < position.X + (float)(width / 2))
			{
				direction = -1;
			}
			else
			{
				direction = 1;
			}
		}
		else if (type == 908)
		{
			if (targetNPC.position.X + (float)(targetNPC.width / 2) < position.X + (float)(width / 2))
			{
				direction = -1;
			}
			else
			{
				direction = 1;
			}
		}
		if (type == 509)
		{
			int num15 = Main.rand.Next(2, 6);
			for (int i = 0; i < num15; i++)
			{
				Vector2 vector3 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
				vector3 += velocity * 3f;
				vector3.Normalize();
				vector3 *= (float)Main.rand.Next(35, 81) * 0.1f;
				int num16 = (int)((double)damage * 0.5);
				NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector3.X, vector3.Y, 504, num16, knockBack * 0.2f, owner);
			}
		}
		if ((type == 476 || type == 950) && !npcProj)
		{
			float x4 = Main.player[owner].Center.X;
			if (targetNPC.Center.X < x4)
			{
				direction = -1;
			}
			else
			{
				direction = 1;
			}
		}
		if (aiStyle == 113 && ai[0] < 2f)
		{
			ai[0] = 1f;
			ai[1] = victimIndex;
			velocity = (targetNPC.Center - base.Center) * 0.75f;
			netUpdate = true;
			AI_113_UpdateDrawLayer();
		}
		if (type >= 511 && type <= 513)
		{
			ai[1] += 1f;
			netUpdate = true;
		}
		if (type == 659)
		{
			timeLeft = 0;
		}
		if (type == 524)
		{
			netUpdate = true;
			ai[0] += 50f;
		}
		if ((type == 688 || type == 689 || type == 690) && targetNPC.type != 68 && targetNPC.defense < 999)
		{
			armorPenetrationPercent = 1f;
		}
		if (aiStyle == 39)
		{
			if (ai[1] == 0f)
			{
				ai[1] = victimIndex + 1;
				netUpdate = true;
			}
			if (Main.player[owner].position.X + (float)(Main.player[owner].width / 2) < position.X + (float)(width / 2))
			{
				direction = 1;
			}
			else
			{
				direction = -1;
			}
		}
		if (type == 41 && timeLeft > 1)
		{
			timeLeft = 1;
		}
		if (aiStyle == 99)
		{
			if (ai[0] == -2f)
			{
				float num17 = velocity.Length();
				velocity.Normalize();
				velocity *= num17 / 5f;
				velocity.Y -= (float)Main.rand.Next(50, 81) * 0.1f;
				if (velocity.Y < -16f)
				{
					velocity.Y = -16f;
				}
				netUpdate = true;
			}
			else
			{
				Main.player[owner].Counterweight(targetNPC.Center, damage, knockBack);
				if (targetNPC.Center.X < Main.player[owner].Center.X)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
				if (ai[0] >= 0f)
				{
					Vector2 vector4 = base.Center - targetNPC.Center;
					vector4.Normalize();
					float num18 = 16f;
					velocity *= -0.5f;
					velocity += vector4 * num18;
					netUpdate = true;
					localAI[0] += 20f;
					if (!Collision.CanHit(position, width, height, Main.player[owner].position, Main.player[owner].width, Main.player[owner].height))
					{
						localAI[0] += 40f;
						num12 = (int)((double)num12 * 0.75);
					}
				}
			}
		}
		if (type == 856)
		{
			ModifyStellarTuneDamage(ref num12);
		}
		if (ProjectileID.Sets.IsAPhaseblade[type] && ai[0] == 2f)
		{
			switch (type)
			{
			default:
				num12 = (int)((double)num12 * 0.6);
				break;
			case 1065:
			case 1066:
			case 1067:
			case 1068:
			case 1069:
			case 1070:
			case 1072:
			case 1076:
				num12 = (int)((double)num12 * 0.5);
				break;
			}
			num2 *= 0.6f;
			if (targetNPC.Center.X < Main.player[owner].Center.X)
			{
				direction = -1;
			}
			else
			{
				direction = 1;
			}
		}
		if (aiStyle == 93)
		{
			if (ai[0] == 0f)
			{
				ai[1] = 0f;
				int num19 = -victimIndex - 1;
				ai[0] = num19;
				velocity = targetNPC.Center - base.Center;
			}
			num12 = ((ai[0] != 2f) ? ((int)((double)num12 * 0.15)) : ((int)((double)num12 * 1.35)));
		}
		if (ownedBySomeone)
		{
			int num20 = BannerSystem.NPCtoBanner(targetNPC.BannerID());
			if (num20 >= 0)
			{
				Main.player[Main.myPlayer].lastCreatureHit = num20;
			}
		}
		if (Main.netMode != 2 && ownedBySomeone && Main.player[owner].GetBannerBuffEffect(targetNPC, out var effect))
		{
			num12 = (int)((float)num12 * effect.DamageDealt.Sample(Main.Difficulty));
		}
		if (Main.expertMode)
		{
			if ((type == 30 || type == 397 || type == 517 || type == 28 || type == 37 || type == 516 || type == 29 || type == 470 || type == 637 || type == 1086 || type == 1087 || type == 108 || type == 281 || type == 588 || type == 519 || type == 773 || type == 183 || type == 181 || type == 566 || type == 1002) && targetNPC.type >= 13 && targetNPC.type <= 15)
			{
				num12 /= 5;
			}
			if (type == 280 && ((targetNPC.type >= 134 && targetNPC.type <= 136) || targetNPC.type == 139))
			{
				num12 = (int)((double)num12 * 0.75);
			}
		}
		if (Main.netMode != 2 && targetNPC.type == 439 && type >= 0 && type <= ProjectileID.Count && ProjectileID.Sets.CultistIsResistantTo[type])
		{
			num12 = (int)((float)num12 * 0.75f);
		}
		if (type == 497 && penetrate != 1)
		{
			ai[0] = 25f;
			float num21 = velocity.Length();
			Vector2 vector5 = targetNPC.Center - base.Center;
			vector5.Normalize();
			vector5 *= num21;
			velocity = -vector5 * 0.9f;
			netUpdate = true;
		}
		if (type == 323 && (targetNPC.type == 159 || targetNPC.type == 158))
		{
			num12 *= 10;
		}
		if (type == 981 && targetNPC.type == 104)
		{
			num12 *= 3;
		}
		switch (type)
		{
		case 294:
			damage = (int)((double)damage * 0.9);
			break;
		case 265:
			damage = (int)((double)damage * 0.75);
			break;
		case 355:
			damage = (int)((double)damage * 0.75);
			break;
		case 114:
			damage = (int)((double)damage * 0.9);
			break;
		case 76:
		case 77:
		case 78:
			damage = (int)((double)damage * 0.95);
			break;
		case 85:
			damage = (int)((double)damage * 0.85);
			break;
		case 1106:
			damage = (int)((double)damage * 0.85);
			break;
		case 866:
			damage = (int)((double)damage * 0.8);
			break;
		case 1104:
			damage = (int)((double)damage * 0.4);
			break;
		case 1028:
			damage = (int)((double)damage * 0.4);
			break;
		case 841:
			damage = (int)((double)damage * 0.5);
			break;
		case 1029:
			damage = (int)((double)damage * 0.6);
			break;
		case 1030:
			damage = (int)((double)damage * 0.6);
			break;
		case 914:
			damage = (int)((double)damage * 0.6);
			break;
		case 1031:
			damage = (int)((double)damage * 0.7);
			break;
		case 952:
			damage = (int)((double)damage * 0.9);
			break;
		case 913:
			damage = (int)((double)damage * 0.66);
			break;
		case 912:
			damage = (int)((double)damage * 0.7);
			break;
		case 847:
			damage = (int)((double)damage * 0.8);
			break;
		case 1032:
			damage = (int)((double)damage * 0.85);
			break;
		case 848:
			damage = (int)((double)damage * 0.95);
			break;
		case 849:
			damage = (int)((double)damage * 0.9);
			break;
		case 1033:
			damage = (int)((double)damage * 0.95);
			break;
		case 915:
			damage = (int)((double)damage * 0.8);
			break;
		case 1034:
			damage = (int)((double)damage * 0.9);
			break;
		case 1035:
			damage = (int)((double)damage * 0.95);
			break;
		case 931:
			damage = (int)((double)damage * 0.8);
			break;
		case 242:
			damage = (int)((double)damage * 0.85);
			break;
		case 323:
			damage = (int)((double)damage * 0.9);
			break;
		case 5:
			damage = (int)((double)damage * 0.9);
			break;
		case 4:
			damage = (int)((double)damage * 0.95);
			break;
		case 309:
			damage = (int)((double)damage * 0.85);
			break;
		case 132:
			damage = (int)((double)damage * 0.85);
			break;
		case 985:
			damage = (int)((double)damage * 0.75);
			break;
		case 950:
			damage = (int)((double)damage * 0.98);
			break;
		case 964:
			damage = (int)((double)damage * 0.85);
			break;
		}
		if (type == 477 && penetrate > 1)
		{
			int[] array = new int[10];
			int num22 = 0;
			int num23 = 700;
			int num24 = 20;
			for (int j = 0; j < Main.maxNPCs; j++)
			{
				if (j == victimIndex || !Main.npc[j].CanBeChasedBy(this))
				{
					continue;
				}
				float num25 = (base.Center - Main.npc[j].Center).Length();
				if (num25 > (float)num24 && num25 < (float)num23 && Collision.CanHitLine(base.Center, 1, 1, Main.npc[j].Center, 1, 1))
				{
					array[num22] = j;
					num22++;
					if (num22 >= 9)
					{
						break;
					}
				}
			}
			if (num22 > 0)
			{
				num22 = Main.rand.Next(num22);
				Vector2 vector6 = Main.npc[array[num22]].Center - base.Center;
				float num26 = velocity.Length();
				vector6.Normalize();
				velocity = vector6 * num26;
				rotation = velocity.ToRotation() + (float)Math.PI / 2f;
				netUpdate = true;
			}
		}
		if (type == 261 && velocity.Length() < 3.5f)
		{
			num12 /= 2;
			num2 /= 2f;
		}
		if (ownedBySomeone && melee && Main.player[owner].parryDamageBuff && !ProjectileID.Sets.DontApplyParryDamageBuff[type])
		{
			num12 *= 5;
			Main.player[owner].parryDamageBuff = false;
			Main.player[owner].ClearBuff(198);
		}
		SpawnHitVisuals(targetNPC);
		StatusNPC(victimIndex);
		if (ownedBySomeone && tagEffectType > 0)
		{
			Main.player[owner].TagEffectState.TryApplyTagToNPC(tagEffectType, targetNPC);
		}
		if (ownedBySomeone && targetNPC.life > 5)
		{
			TryDoingOnHitEffects(targetNPC);
		}
		if (ProjectileID.Sets.ImmediatelyUpdatesNPCBuffFlags[type])
		{
			targetNPC.UpdateNPC_BuffSetFlags(lowerBuffTime: false);
		}
		if (type == 317)
		{
			ai[1] = -1f;
			netUpdate = true;
		}
		int num27 = direction;
		switch (type)
		{
		case 697:
		case 699:
		case 707:
		case 708:
		case 759:
			num27 = ((Main.player[owner].Center.X < targetNPC.Center.X) ? 1 : (-1));
			break;
		}
		if (aiStyle == 188 || aiStyle == 189 || aiStyle == 190 || aiStyle == 191)
		{
			num27 = ((Main.player[owner].Center.X < targetNPC.Center.X) ? 1 : (-1));
		}
		if (aiStyle == 15)
		{
			num27 = ((Main.player[owner].Center.X < targetNPC.Center.X) ? 1 : (-1));
			if (ai[0] == 0f)
			{
				num2 *= 0.35f;
			}
			if (ai[0] == 6f)
			{
				num2 *= 0.5f;
			}
		}
		if (type == 22)
		{
			num27 = ((Main.player[owner].Center.X < targetNPC.Center.X) ? 1 : (-1));
		}
		if (ownedBySomeone && !hostile)
		{
			num12 += targetNPC.checkArmorPenetration(num3, armorPenetrationPercent);
		}
		NPCKillAttempt attempt = new NPCKillAttempt(targetNPC);
		int num28 = ((!ownedBySomeone) ? ((int)targetNPC.StrikeNPCNoInteraction(num12, num2, num27, crit)) : ((int)targetNPC.StrikeNPC(num12, num2, num27, crit, noEffect: false, fromNet: false, owner)));
		if (ownedBySomeone && attempt.DidNPCDie())
		{
			Main.player[owner].OnKillNPC(ref attempt, this);
		}
		if (ownedBySomeone && Main.player[owner].accDreamCatcher)
		{
			Main.player[owner].addDPS(num28);
		}
		Main.player[owner].TagEffectState.OnHit(this, targetNPC, num4);
		bool flag8 = !targetNPC.immortal;
		bool flag9 = num28 > 0 && targetNPC.lifeMax > 5 && friendly && !hostile && aiStyle != 59;
		bool flag10 = false;
		if (DebugOptions.LetProjectilesAimAtTargetDummies && targetNPC.type == 488)
		{
			flag8 = true;
			flag10 = true;
			flag9 |= friendly && aiStyle != 59;
		}
		if (flag8 && active && timeLeft > 10 && targetNPC.active && targetNPC.type == 676 && CanBeReflected())
		{
			targetNPC.ReflectProjectile(this);
			penetrate++;
		}
		if (ownedBySomeone && flag8)
		{
			if (type == 997 && (!targetNPC.immortal || flag10) && !targetNPC.SpawnedFromStatue && !NPCID.Sets.CountsAsCritter[targetNPC.type])
			{
				Main.player[owner].HorsemansBlade_SpawnPumpkin(victimIndex, (int)((float)damage * 1f), knockBack);
			}
			if (type == 756 && penetrate == 1)
			{
				damage = 0;
				penetrate = -1;
				keepIterating = false;
			}
			if ((flag10 || targetNPC.value > 0f) && Main.player[owner].hasLuckyCoin && Main.rand.Next(5) == 0)
			{
				int num29 = 71;
				if (Main.rand.Next(10) == 0)
				{
					num29 = 72;
				}
				if (Main.rand.Next(100) == 0)
				{
					num29 = 73;
				}
				int num30 = Item.NewItem(GetItemSource_OnHit(targetNPC, ItemSourceID.LuckyCoin), (int)targetNPC.position.X, (int)targetNPC.position.Y, targetNPC.width, targetNPC.height, num29);
				Main.item[num30].stack = Main.rand.Next(1, 11);
				Main.item[num30].velocity.Y = (float)Main.rand.Next(-20, 1) * 0.2f;
				Main.item[num30].velocity.X = (float)Main.rand.Next(10, 31) * 0.2f * (float)num27;
				Main.item[num30].timeLeftInWhichTheItemCannotBeTakenByEnemies = 60;
				if (Main.netMode == 1)
				{
					NetMessage.SendData(148, -1, -1, null, num30);
				}
			}
			if (type == 999 && owner == Main.myPlayer && Main.rand.Next(3) == 0)
			{
				Player player = Main.player[owner];
				Vector2 vector7 = (base.Center - targetNPC.Center).SafeNormalize(Vector2.Zero) * 0.25f;
				int dmg = damage / 2;
				float kB = knockBack;
				int num31 = NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector7.X, vector7.Y, player.beeType(), player.beeDamage(dmg), player.beeKB(kB), owner);
				Main.projectile[num31].melee = true;
			}
			if (flag9)
			{
				if (type == 304 && !Main.player[owner].moonLeech)
				{
					vampireHeal(num28, new Vector2(targetNPC.Center.X, targetNPC.Center.Y), targetNPC);
				}
				if (targetNPC.canGhostHeal || flag10)
				{
					if (Main.player[owner].ghostHeal && !Main.player[owner].moonLeech)
					{
						ghostHeal(num28, new Vector2(targetNPC.Center.X, targetNPC.Center.Y), targetNPC);
					}
					if (Main.player[owner].ghostHurt)
					{
						ghostHurt(num28, new Vector2(targetNPC.Center.X, targetNPC.Center.Y), targetNPC);
					}
					if (magic && Main.player[owner].setNebula && Main.player[owner].nebulaCD == 0 && Main.rand.Next(3) == 0)
					{
						Main.player[owner].nebulaCD = 30;
						int num32 = Utils.SelectRandom<int>(Main.rand, 3453, 3454, 3455);
						int num33 = Item.NewItem(GetItemSource_OnHit(targetNPC, ItemSourceID.SetBonus_Nebula), (int)targetNPC.position.X, (int)targetNPC.position.Y, targetNPC.width, targetNPC.height, num32);
						Main.item[num33].velocity.Y = (float)Main.rand.Next(-20, 1) * 0.2f;
						Main.item[num33].velocity.X = (float)Main.rand.Next(10, 31) * 0.2f * (float)num27;
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, num33);
						}
					}
				}
				if (melee && Main.player[owner].beetleOffense && (!targetNPC.immortal || flag10))
				{
					if (Main.player[owner].beetleOrbs == 0)
					{
						Main.player[owner].beetleCounter += num28 * 3;
					}
					else if (Main.player[owner].beetleOrbs == 1)
					{
						Main.player[owner].beetleCounter += num28 * 2;
					}
					else
					{
						Main.player[owner].beetleCounter += num28;
					}
					Main.player[owner].beetleCountdown = 0;
				}
				if (arrow && type != 631 && Main.player[owner].phantasmTime > 0)
				{
					Vector2 source = Main.player[owner].position + Main.player[owner].Size * Utils.RandomVector2(Main.rand, 0f, 1f);
					Vector2 vector8 = targetNPC.DirectionFrom(source) * 6f;
					int num34 = (int)((float)damage * 0.3f);
					NewProjectile(GetProjectileSource_FromThis(), source.X, source.Y, vector8.X, vector8.Y, 631, num34, 0f, owner, victimIndex);
					NewProjectile(GetProjectileSource_FromThis(), source.X, source.Y, vector8.X, vector8.Y, 631, num34, 0f, owner, victimIndex, 15f);
					NewProjectile(GetProjectileSource_FromThis(), source.X, source.Y, vector8.X, vector8.Y, 631, num34, 0f, owner, victimIndex, 30f);
				}
				Player player2 = Main.player[owner];
				switch (type)
				{
				case 913:
				case 1031:
				case 1032:
					if (localAI[0] == 0f)
					{
						localAI[0] = 1f;
						Main.player[owner].TagEffectState.TryEnableProcOnNPC(tagEffectType, targetNPC);
					}
					break;
				case 912:
				{
					int num35 = 15;
					if (!player2.coolWhipBuff)
					{
						NewProjectile(GetProjectileSource_FromThis(), targetNPC.Center, Vector2.Zero, 917, num35, 0f, owner);
						player2.coolWhipBuff = true;
					}
					player2.AddBuff(312, 180);
					break;
				}
				case 1028:
				{
					int num36 = 2;
					if (!player2.cobWhipBuff)
					{
						NewProjectile(GetProjectileSource_FromThis(), targetNPC.Center, Vector2.Zero, 1036, num36, 0f, owner);
						player2.cobWhipBuff = true;
					}
					player2.AddBuff(365, 180);
					break;
				}
				case 1034:
					if (localAI[0] == 0f)
					{
						localAI[0] = 1f;
						SpawnConstellationStarsTowards(targetNPC, damage);
					}
					break;
				case 1035:
					Main.player[owner].TagEffectState.TryEnableProcOnNPC(tagEffectType, targetNPC);
					break;
				case 1045:
					if (ai[1] < 2f)
					{
						SpawnMoonLordWhipProc(this, targetNPC, damage, (int)ai[1] + 1);
					}
					break;
				}
			}
		}
		if (ownedBySomeone && (melee || ProjectileID.Sets.IsAWhip[type]) && Main.player[owner].meleeEnchant == 7)
		{
			NewProjectile(GetProjectileSource_FromThis(), targetNPC.Center.X, targetNPC.Center.Y, targetNPC.velocity.X, targetNPC.velocity.Y, 289, 0, 0f, owner);
		}
		if (Main.netMode != 0)
		{
			if (crit)
			{
				NetMessage.SendData(28, -1, -1, null, victimIndex, num12, num2, num27, 1);
			}
			else
			{
				NetMessage.SendData(28, -1, -1, null, victimIndex, num12, num2, num27);
			}
		}
		if (type == 1088)
		{
			Kill();
		}
		if (type >= 390 && type <= 392)
		{
			localAI[1] = 20f;
		}
		if (usesIDStaticNPCImmunity)
		{
			if (penetrate != 1 || appliesImmunityTimeOnSingleHits)
			{
				targetNPC.immune[owner] = 0;
				perIDStaticNPCImmunity[type][victimIndex] = Main.GameUpdateCount + (uint)idStaticNPCHitCooldown;
			}
		}
		else if (type == 434)
		{
			numUpdates = 0;
		}
		else if (type == 598 || type == 636 || type == 614)
		{
			Point[] bufferForScan = _javelinsMax6;
			if (type == 636)
			{
				bufferForScan = _javelinsMax8;
			}
			if (type == 614)
			{
				bufferForScan = _javelinsMax10;
			}
			KillOldestJavelin(whoAmI, type, victimIndex, bufferForScan);
		}
		else if (type == 632)
		{
			targetNPC.immune[owner] = 5;
		}
		else if (type == 514)
		{
			targetNPC.immune[owner] = 1;
		}
		else if (type == 595 || type == 735)
		{
			targetNPC.immune[owner] = 5;
		}
		else if (type == 927)
		{
			targetNPC.immune[owner] = 4;
		}
		else if (type == 286)
		{
			targetNPC.immune[owner] = 5;
		}
		else if (type == 443 || type == 1110)
		{
			targetNPC.immune[owner] = 8;
		}
		else if (type >= 424 && type <= 426)
		{
			targetNPC.immune[owner] = 5;
		}
		else if (type == 634 || type == 635)
		{
			targetNPC.immune[owner] = 5;
		}
		else if (type == 659)
		{
			targetNPC.immune[owner] = 5;
		}
		else if (type == 246)
		{
			targetNPC.immune[owner] = 7;
		}
		else if (type == 249)
		{
			targetNPC.immune[owner] = 7;
		}
		else if (type == 16)
		{
			targetNPC.immune[owner] = 8;
		}
		else if (type == 409)
		{
			targetNPC.immune[owner] = 6;
		}
		else if (type == 582 || type == 902)
		{
			targetNPC.immune[owner] = 7;
			if (ai[0] != 1f)
			{
				ai[0] = 1f;
				netUpdate = true;
			}
		}
		else
		{
			if (type == 451)
			{
				if (ai[0] == 0f)
				{
					ai[0] += penetrate;
				}
				else
				{
					ai[0] -= penetrate + 1;
				}
				ai[1] = 0f;
				netUpdate = true;
				keepIterating = false;
				return;
			}
			if (type == 864)
			{
				immuneArray[victimIndex] = localNPCHitCooldown;
				targetNPC.immune[owner] = 0;
				if (ai[0] > 0f)
				{
					ai[0] = -1f;
					ai[1] = 0f;
					netUpdate = true;
				}
			}
			else if (type == 866)
			{
				immuneArray[victimIndex] = localNPCHitCooldown;
				targetNPC.immune[owner] = 0;
				penetrate--;
				if (penetrate == 0)
				{
					penetrate = 1;
					damage = 0;
					ai[1] = -1f;
					netUpdate = true;
					keepIterating = false;
					return;
				}
				if (owner == Main.myPlayer)
				{
					int num37 = FindTargetWithLineOfSight();
					float num38 = ai[1];
					ai[1] = num37;
					if (ai[1] != num38)
					{
						netUpdate = true;
					}
					if (num37 != -1)
					{
						velocity = velocity.Length() * DirectionTo(Main.npc[num37].Center);
					}
				}
			}
			else if (type == 611 || type == 612)
			{
				targetNPC.immune[owner] = 4;
				immuneArray[victimIndex] = localNPCHitCooldown;
			}
			else if (usesLocalNPCImmunity && localNPCHitCooldown != -2)
			{
				targetNPC.immune[owner] = 0;
				immuneArray[victimIndex] = localNPCHitCooldown;
			}
			else if (penetrate != 1 || appliesImmunityTimeOnSingleHits)
			{
				targetNPC.immune[owner] = 10;
			}
		}
		if (type == 710)
		{
			BetsySharpnel(victimIndex);
		}
		if (penetrate > 0 && type != 317 && type != 866)
		{
			if (type == 357)
			{
				damage = (int)((double)damage * 0.8);
			}
			penetrate--;
			if (penetrate == 0)
			{
				if (stopsDealingDamageAfterPenetrateHits)
				{
					penetrate = -1;
					damage = 0;
				}
				keepIterating = false;
			}
		}
		if (aiStyle == 7)
		{
			ai[0] = 1f;
			damage = 0;
			netUpdate = true;
		}
		else if (type == 23)
		{
			if (penetrate <= 0)
			{
				if (ai[0] == 0f)
				{
					velocity *= 0f;
				}
				penetrate = -1;
				ai[0] = 1f;
				netUpdate = true;
			}
		}
		else if (aiStyle == 13)
		{
			ai[0] = 1f;
			netUpdate = true;
		}
		else if (aiStyle == 69)
		{
			ai[0] = 1f;
			netUpdate = true;
		}
		else if (type == 607)
		{
			ai[0] = 1f;
			netUpdate = true;
			friendly = false;
		}
		else if (type == 638 || type == 639 || type == 640)
		{
			damage = (int)((double)damage * 0.96);
		}
		else if (type == 656)
		{
			localAI[0] += 1f;
		}
		else if (type == 611)
		{
			if (localAI[1] <= 0f)
			{
				NewProjectile(GetProjectileSource_FromThis(), targetNPC.Center.X, targetNPC.Center.Y, 0f, 0f, 612, damage, 10f, owner, 0f, 0.85f + Main.rand.NextFloat() * 1.15f);
			}
			localAI[1] = 4f;
		}
		else if (type == 645 && ai[1] != -1f)
		{
			ai[0] = 0f;
			ai[1] = -1f;
			netUpdate = true;
		}
		numHits++;
		if (type == 697)
		{
			if (ai[0] >= 42f)
			{
				localAI[1] = 1f;
			}
		}
		else if (type == 699)
		{
			SummonMonkGhast();
		}
		else if (type == 706)
		{
			damage = (int)((float)damage * 0.95f);
		}
		else if (type == 728)
		{
			SummonSuperStarSlash(targetNPC.Center);
		}
		else if (type == 34)
		{
			if (ai[0] == -1f)
			{
				ai[1] = -1f;
				netUpdate = true;
			}
		}
		else if (type == 79)
		{
			if (ai[0] == -1f)
			{
				ai[1] = -1f;
				netUpdate = true;
			}
			ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.RainbowRodHit, new ParticleOrchestraSettings
			{
				PositionInWorld = targetNPC.Center,
				MovementVector = velocity
			});
		}
		else if (type == 931 || type == 1039)
		{
			int num39 = FindTargetWithLineOfSight();
			if (num39 != -1)
			{
				ai[0] = num39;
				netUpdate = true;
			}
			if (type == 1039)
			{
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.StardustPunch, new ParticleOrchestraSettings
				{
					PositionInWorld = Vector2.Lerp(base.Center, targetNPC.Hitbox.ClosestPointInRect(base.Center), 0.5f) + new Vector2(0f, Main.rand.NextFloatDirection() * 10f),
					MovementVector = new Vector2(direction, Main.rand.NextFloatDirection() * 0.5f) * (2f + 2f * Main.rand.NextFloat())
				});
			}
		}
		else if (aiStyle == 165)
		{
			if (targetNPC.active)
			{
				Main.player[owner].MinionAttackTargetNPC = victimIndex;
			}
		}
		else if (type == 623)
		{
			ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.StardustPunch, new ParticleOrchestraSettings
			{
				PositionInWorld = Vector2.Lerp(base.Center, targetNPC.Hitbox.ClosestPointInRect(base.Center), 0.5f) + new Vector2(0f, Main.rand.NextFloatDirection() * 10f),
				MovementVector = new Vector2(direction, Main.rand.NextFloatDirection() * 0.5f) * (3f + 3f * Main.rand.NextFloat())
			});
		}
		else if (type == 1047 && targetNPC.TreatedAsABossForRainbowBoulders)
		{
			Kill();
			keepIterating = false;
		}
		if (CareForAttackCD)
		{
			Main.player[owner].SetMeleeHitCooldown(victimIndex, Main.player[owner].itemAnimation);
		}
	}

	private void SpawnHitVisuals(Entity target)
	{
		if (type == 916)
		{
			EmitBlackLightningParticles(target.Center);
		}
		if (type == 1091)
		{
			if (!GetStormLightningExplosionRect().Intersects(target.Hitbox))
			{
				ParticleOrchestrator.SpawnLightningExplosionDust(target.Center, AI_203_GetLightningColor());
			}
			if (StormLightningLiquidCollisionCheck(target.Center))
			{
				Vector2 vector = _lightningLastHitChainPos ?? base.Center;
				Vector2 vector2 = Main.rand.NextVector2FromRectangle(target.Hitbox);
				_lightningLastHitChainPos = vector2;
				ParticleOrchestrator.BroadcastOrRequestParticleSpawn(ParticleOrchestraType.BlueLightningSmallLong, new ParticleOrchestraSettings
				{
					PositionInWorld = vector,
					MovementVector = vector2 - vector
				});
			}
		}
		if (type == 1093)
		{
			ParticleOrchestrator.BroadcastOrRequestParticleSpawn(ParticleOrchestraType.CattivaHit, new ParticleOrchestraSettings
			{
				PositionInWorld = base.Center + new Vector2(direction * 8, 0f) + Main.rand.NextVector2Circular(4f, 4f),
				MovementVector = Main.rand.NextVector2CircularEdge(4f, 4f)
			});
		}
	}

	private float Damage_GetProjectileSpecificDamageMultiplier()
	{
		float num = 1f;
		if (ProjectileID.Sets.IsARocketThatDealsDoubleDamageToPrimaryEnemy[type] && timeLeft > 3)
		{
			num *= 2f;
		}
		if (ProjectileID.Sets.IsAMineThatDealsTripleDamageWhenStationary[type] && velocity.Length() < 0.5f)
		{
			num *= 3f;
		}
		if (type == 34 && penetrate == 1)
		{
			num *= 1f;
		}
		if (aiStyle == 15 && ai[0] == 0f)
		{
			num *= 1.2f;
			if (type == 26 || type == 35)
			{
				for (int i = 0; i < 1000; i++)
				{
					if (Main.projectile[i].active && Main.projectile[i].type != type && Main.projectile[i].owner == owner && (Main.projectile[i].type == 35 || Main.projectile[i].type == 26))
					{
						num *= 0.8f;
						break;
					}
				}
			}
		}
		if (aiStyle == 15 && (ai[0] == 1f || ai[0] == 2f))
		{
			num *= 2f;
		}
		if (type == 877 || type == 879 || type == 878)
		{
			num = 0.1f + Main.player[owner].velocity.Length() / 7f * 0.9f;
		}
		if (type == 968)
		{
			num = 1f;
			switch ((int)ai[1])
			{
			case 0:
				num = 1.5f;
				break;
			case 1:
				num = 1f;
				break;
			case 2:
				num = 1.5f;
				break;
			case 3:
				num = 0.1f;
				break;
			case 4:
				num = 1f;
				break;
			case 5:
				num = 1f;
				break;
			case 6:
				num = 1f;
				break;
			case 7:
				num = 0.25f;
				break;
			case 8:
				num = 1f;
				break;
			case 9:
				num = 0.75f;
				break;
			case 10:
				num = 0.5f;
				break;
			case 11:
				num = 0.5f;
				break;
			case 12:
				num = 0.5f;
				break;
			case 13:
				num = 0.5f;
				break;
			case 14:
				num = 0.5f;
				break;
			case 15:
				num = 0.5f;
				break;
			case 16:
				num = 0.5f;
				break;
			case 17:
				num = 1.5f;
				break;
			case 18:
				num = 1.6f;
				break;
			case 19:
				num = 1.8f;
				break;
			case 20:
				num = 1.9f;
				break;
			case 21:
				num = 1.7f;
				break;
			case 22:
				num = 2f;
				break;
			case 23:
				num = 1.9f;
				break;
			}
		}
		if (type == 533 && localAI[2] >= 40f)
		{
			num *= 0.5f;
		}
		if (type == 1024 && ai[0] == 2f)
		{
			num *= 1.5f;
		}
		if (type == 1023 && localAI[1] > 0f)
		{
			num *= 1.33f;
		}
		if (type == 1091)
		{
			num *= Utils.Remap(Main.Difficulty, GameDifficultyLevel.Classic, GameDifficultyLevel.Master, 1f, 3f);
		}
		return num;
	}

	private void Damage_PVP(Rectangle projRectangle, float projectileSpecificDamageMultiplier)
	{
		if (damage <= 0 || !Main.player[Main.myPlayer].hostile)
		{
			return;
		}
		for (int i = 0; i < 255; i++)
		{
			if (i == owner)
			{
				continue;
			}
			Player player = Main.player[i];
			if (!player.active || player.dead || player.immune || !player.hostile || playerImmune[i] > 0 || (Main.player[Main.myPlayer].team != 0 && Main.player[Main.myPlayer].team == player.team))
			{
				continue;
			}
			bool flag = !ownerHitCheck;
			if (ownerHitCheck)
			{
				flag |= CanHitWithMeleeWeapon(player);
			}
			if (!flag || !Colliding(projRectangle, player.getRect()))
			{
				continue;
			}
			if (aiStyle == 3 && !ProjectileID.Sets.IsAPhaseblade[type])
			{
				if (ai[0] == 0f)
				{
					velocity.X = 0f - velocity.X;
					velocity.Y = 0f - velocity.Y;
					netUpdate = true;
				}
				ai[0] = 1f;
			}
			else if (aiStyle == 16)
			{
				if (timeLeft > 3)
				{
					timeLeft = 3;
				}
				if (player.position.X + (float)(player.width / 2) < position.X + (float)(width / 2))
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
			}
			else if (aiStyle == 68)
			{
				if (timeLeft > 3)
				{
					timeLeft = 3;
				}
				if (player.position.X + (float)(player.width / 2) < position.X + (float)(width / 2))
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
			}
			int playerIndex = owner;
			if (ProjectileID.Sets.IsAGravestone[type])
			{
				playerIndex = (int)ai[0];
			}
			PlayerDeathReason playerDeathReason = PlayerDeathReason.ByProjectile(playerIndex, whoAmI);
			if (type == 41 && timeLeft > 1)
			{
				timeLeft = 1;
			}
			bool flag2 = false;
			if (melee && Main.rand.Next(1, 101) <= Main.player[owner].meleeCrit)
			{
				flag2 = true;
			}
			int num = Main.DamageVar((int)((float)damage * projectileSpecificDamageMultiplier), Main.player[owner].luck);
			bool dodgeable = IsDamageDodgable();
			if (type == 856)
			{
				ModifyStellarTuneDamage(ref num);
			}
			if ((type == 476 || type == 950) && !npcProj)
			{
				float x = Main.player[owner].Center.X;
				if (player.Center.X < x)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
			}
			if (!player.immune)
			{
				StatusPvP(i);
			}
			TryDoingOnHitEffects(player);
			int num2 = (int)player.Hurt(playerDeathReason, num, direction, pvp: true, quiet: false, flag2, -1, dodgeable);
			if (num2 > 0 && Main.player[owner].ghostHeal && friendly && !hostile)
			{
				ghostHeal(num2, new Vector2(player.Center.X, player.Center.Y), player);
			}
			if (type == 304 && num2 > 0)
			{
				vampireHeal(num2, new Vector2(player.Center.X, player.Center.Y), player);
			}
			if ((melee || ProjectileID.Sets.IsAWhip[type]) && Main.player[owner].meleeEnchant == 7)
			{
				NewProjectile(GetProjectileSource_FromThis(), player.Center.X, player.Center.Y, player.velocity.X, player.velocity.Y, 289, 0, 0f, owner);
			}
			if (Main.netMode != 0)
			{
				NetMessage.SendPlayerHurt(i, playerDeathReason, num, direction, flag2, pvp: true, ImmunityCooldownID.General);
			}
			playerImmune[i] = 40;
			if (penetrate > 0)
			{
				penetrate--;
				if (penetrate == 0)
				{
					break;
				}
			}
			if (aiStyle == 7)
			{
				ai[0] = 1f;
				damage = 0;
				netUpdate = true;
			}
			else if (aiStyle == 13)
			{
				ai[0] = 1f;
				netUpdate = true;
			}
			else if (aiStyle == 69)
			{
				ai[0] = 1f;
				netUpdate = true;
			}
		}
	}

	private void Damage_TryUsingPowders(Rectangle projRectangle)
	{
		if (type == 10 && Main.netMode != 1)
		{
			for (int i = 0; i < Main.maxNPCs; i++)
			{
				NPC nPC = Main.npc[i];
				if (!nPC.active)
				{
					continue;
				}
				if (nPC.type == 534)
				{
					if (projRectangle.Intersects(nPC.Hitbox))
					{
						nPC.Transform(441);
					}
				}
				else
				{
					if (nPC.type != 687 || !projRectangle.Intersects(nPC.Hitbox))
					{
						continue;
					}
					nPC.Transform(683);
					Vector2 vector = nPC.Center - new Vector2(20f);
					Utils.PoofOfSmoke(vector);
					if (Main.netMode == 2)
					{
						NetMessage.SendData(106, -1, -1, null, (int)vector.X, vector.Y);
					}
					if (!NPC.unlockedSlimeYellowSpawn)
					{
						NPC.unlockedSlimeYellowSpawn = true;
						if (Main.netMode == 2)
						{
							NetMessage.SendData(7);
						}
					}
				}
			}
		}
		if ((type != 11 && type != 463) || Main.netMode == 1)
		{
			return;
		}
		bool crimson = type == 463;
		for (int j = 0; j < Main.maxNPCs; j++)
		{
			if (Main.npc[j].active)
			{
				Rectangle value = new Rectangle((int)Main.npc[j].position.X, (int)Main.npc[j].position.Y, Main.npc[j].width, Main.npc[j].height);
				if (projRectangle.Intersects(value))
				{
					Main.npc[j].AttemptToConvertNPCToEvil(crimson);
				}
			}
		}
	}

	private void Damage_EVP(Rectangle projRectangle)
	{
		if (!hostile || Main.myPlayer >= 255 || damage <= 0)
		{
			return;
		}
		int num = ImmunityCooldownID.General;
		switch (type)
		{
		case 452:
		case 454:
		case 455:
		case 462:
			num = ImmunityCooldownID.BossNoCheese;
			break;
		case 871:
		case 872:
		case 873:
		case 874:
		case 919:
		case 923:
		case 924:
			num = ImmunityCooldownID.BossNoCheese;
			break;
		}
		int myPlayer = Main.myPlayer;
		bool flag = Main.player[myPlayer].active && !Main.player[myPlayer].dead && (!Main.player[myPlayer].immune || num != ImmunityCooldownID.General);
		if (flag && type == 281)
		{
			flag = ai[1] - 1f == (float)myPlayer;
		}
		if (Main.getGoodWorld && type == 281)
		{
			flag = true;
		}
		if (type == 1073 && Main.player[myPlayer].npcTypeNoAggro[1])
		{
			flag = false;
		}
		if (type == 1078 && Main.player[myPlayer].spaceGun)
		{
			flag = false;
		}
		if (!flag || !Colliding(projRectangle, Main.player[myPlayer].getRect()))
		{
			return;
		}
		int num2 = direction;
		num2 = ((!(Main.player[myPlayer].position.X + (float)(Main.player[myPlayer].width / 2) < position.X + (float)(width / 2))) ? 1 : (-1));
		if (!Main.player[myPlayer].CanParryAgainst(Main.player[myPlayer].Hitbox, base.Hitbox, velocity))
		{
			SpawnHitVisuals(Main.player[myPlayer]);
			TryDoingOnHitEffects(Main.player[myPlayer]);
			int num3 = Main.DamageVar(damage, 0f - Main.player[owner].luck);
			if (Main.player[myPlayer].GetBannerBuffEffect(bannerIdToRespondTo, out var effect))
			{
				num3 = (int)((float)num3 * effect.DamageReceived.Sample(Main.Difficulty));
			}
			if (Main.player[myPlayer].resistCold && coldDamage)
			{
				num3 = (int)((float)num3 * 0.7f);
			}
			if (!reflected)
			{
				num3 = (int)((float)num3 * hostileDamageScaling.Sample(Main.Difficulty));
			}
			int num4 = 2;
			num3 *= num4;
			if (Main.player[myPlayer].deadMansSweater && trap)
			{
				num3 = (int)((float)num3 * 0.5f);
				num3 = Math.Min(num3, 300);
			}
			int num5 = num3;
			if (type == 961)
			{
				if (penetrate == 1)
				{
					damage = 0;
					penetrate = -1;
				}
				else
				{
					damage = (int)((double)damage * 0.7);
				}
			}
			bool dodgeable = IsDamageDodgable();
			int playerIndex = -1;
			if (ProjectileID.Sets.IsAGravestone[type])
			{
				playerIndex = (int)ai[0];
			}
			if (Main.player[myPlayer].Hurt(PlayerDeathReason.ByProjectile(playerIndex, whoAmI), num5, num2, pvp: false, quiet: false, Crit: false, num, dodgeable) > 0.0 && !Main.player[myPlayer].dead)
			{
				StatusPlayer(Main.player[myPlayer]);
			}
			if (trap)
			{
				Main.player[myPlayer].trapDebuffSource = true;
				if (Main.player[myPlayer].dead)
				{
					AchievementsHelper.HandleSpecialEvent(Main.player[myPlayer], 4);
				}
			}
		}
		if (true)
		{
			if (type == 435 || type == 682)
			{
				penetrate--;
			}
			if (type == 436)
			{
				penetrate--;
			}
			if (type == 681)
			{
				timeLeft = 0;
			}
			if (type == 437)
			{
				penetrate--;
			}
		}
	}

	public static void SpawnMoonLordWhipProc(Projectile parent, NPC targetNPC, int procDamage, int aiCounter)
	{
		int num = Main.rand.Next(1, 4);
		num = 1;
		for (int i = 0; i < num; i++)
		{
			Rectangle hitbox = targetNPC.Hitbox;
			hitbox.Inflate(30, 16);
			hitbox.Y -= 8;
			Vector2 vector = Main.rand.NextVector2FromRectangle(hitbox);
			Vector2 vector2 = hitbox.Center.ToVector2();
			float num2 = 7f + Main.rand.NextFloat() * 8f;
			Vector2 spinningpoint = (vector2 - vector).SafeNormalize(parent.velocity.SafeNormalize(-Vector2.UnitY)) * num2;
			float num3 = (float)(Main.rand.Next(2) * 2 - 1) * ((float)Math.PI / 5f + (float)Math.PI * 4f / 5f * Main.rand.NextFloat());
			num3 *= 0.5f;
			spinningpoint = spinningpoint.RotatedBy(0.7853981852531433);
			int num4 = 1;
			int num5 = 24 * num4;
			int num6 = 16;
			int num7 = num6 * num4;
			vector = vector2;
			for (int j = 0; j < num7; j++)
			{
				vector -= spinningpoint;
				spinningpoint = spinningpoint.RotatedBy((0f - num3) / (float)num5);
			}
			vector += targetNPC.velocity * num6;
			ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.MoonLordWhipEye, new ParticleOrchestraSettings
			{
				PositionInWorld = vector,
				MovementVector = -spinningpoint
			}, parent.owner);
			NewProjectile(parent.GetProjectileSource_FromThis(), vector, spinningpoint, 1045, procDamage, 0f, parent.owner, num3, aiCounter);
		}
	}

	private void SpawnConstellationStarsTowards(NPC targetNPC, int calcDamage)
	{
		int num = (int)((float)calcDamage * 0.33f);
		WhipPointsForCollision.Clear();
		FillWhipControlPoints(this, WhipPointsForCollision);
		for (int i = 2; i < WhipPointsForCollision.Count - 1; i += 3)
		{
			Vector2 vector = WhipPointsForCollision[i + 1];
			Vector2 vector2 = WhipPointsForCollision[i];
			Vector2 v = (vector - vector2).RotatedBy(-(float)Math.PI / 2f * (float)Main.player[owner].direction * Main.player[owner].gravDir);
			NewProjectile(GetProjectileSource_FromThis(), vector2, v.SafeNormalize(Vector2.Zero) * (1f + Main.rand.NextFloatDirection() * 3f), 1039, num, knockBack, owner, targetNPC.whoAmI, 0.02f + 0.09f * Main.rand.NextFloat());
		}
	}

	private Rectangle Damage_GetHitbox()
	{
		Rectangle result = new Rectangle((int)position.X, (int)position.Y, width, height);
		if (ProjectileID.Sets.IsAPhaseblade[type] && ai[0] == 2f)
		{
			result.Inflate(-14, 0);
		}
		if (type == 301 && localAI[0] > 0f)
		{
			result.Inflate(-width / 2, -height / 2);
			result.Inflate((int)(localAI[0] / 2f), (int)localAI[0] / 2);
			localAI[0] = -1f;
		}
		if (type == 383 && localAI[0] > 0f)
		{
			result.Inflate(-width / 2, -height / 2);
			result.Inflate((int)(localAI[0] / 2f), (int)localAI[0] / 2);
			localAI[0] = -1f;
		}
		if (type == 262 && localAI[0] > 0f)
		{
			result.Inflate(-width / 2, -height / 2);
			result.Inflate((int)(localAI[0] / 2f), (int)localAI[0] / 2);
			localAI[0] = -1f;
		}
		if (type == 101)
		{
			result.Inflate(30, 30);
		}
		if (type == 1024)
		{
			result.Inflate(6, 6);
		}
		if (type == 1023)
		{
			result.Inflate(8, 8);
		}
		if (type == 85)
		{
			int num = (int)Utils.Remap(localAI[0], 0f, 72f, 10f, 40f);
			result.Inflate(num, num);
		}
		if (type == 1106)
		{
			int num2 = (int)Utils.Remap(localAI[0], 0f, 72f, 0f, 20f);
			result.Inflate(num2, num2);
		}
		if (type == 188)
		{
			result.Inflate(20, 20);
		}
		if (aiStyle == 29)
		{
			result.Inflate(4, 4);
		}
		if (type == 967)
		{
			result.Inflate(10, 10);
		}
		return result;
	}

	private void BombsHurtPlayers(Rectangle projRectangle)
	{
		Player localPlayer = Main.LocalPlayer;
		if (!localPlayer.active || localPlayer.dead || localPlayer.immune || (ownerHitCheck && !CanHitWithMeleeWeapon(localPlayer)) || !projRectangle.Intersects(localPlayer.Hitbox))
		{
			return;
		}
		direction = ((!(localPlayer.Center.X < base.Center.X)) ? 1 : (-1));
		int num = Main.DamageVar(damage, 0f - localPlayer.luck);
		if (localPlayer.deadMansSweater && trap)
		{
			num = (int)((float)num * 0.5f);
			num = Math.Min(num, 300);
		}
		int playerIndex = owner;
		bool pvp = true;
		if (type == 108 || type == 1002)
		{
			playerIndex = -1;
			pvp = false;
		}
		if (ProjectileID.Sets.IsAGravestone[type])
		{
			playerIndex = (int)ai[0];
		}
		bool dodgeable = IsDamageDodgable();
		PlayerDeathReason damageSource = PlayerDeathReason.ByProjectile(playerIndex, whoAmI);
		if (localPlayer.Hurt(damageSource, num, direction, pvp, quiet: false, Crit: false, -1, dodgeable) > 0.0 && !localPlayer.dead)
		{
			StatusPlayer(localPlayer);
		}
		if (trap)
		{
			localPlayer.trapDebuffSource = true;
			if (localPlayer.dead)
			{
				AchievementsHelper.HandleSpecialEvent(localPlayer, 4);
			}
		}
	}

	public bool IsDamageDodgable()
	{
		int num = type;
		if (((uint)(num - 871) <= 3u || num == 919 || (uint)(num - 923) <= 1u) && damage == 9999)
		{
			return false;
		}
		return true;
	}

	public static void KillOldestJavelin(int protectedProjectileIndex, int projectileType, int targetNPCIndex, Point[] bufferForScan)
	{
		int num = 0;
		for (int i = 0; i < 1000; i++)
		{
			if (i != protectedProjectileIndex && Main.projectile[i].active && Main.projectile[i].owner == Main.myPlayer && Main.projectile[i].type == projectileType && Main.projectile[i].ai[0] == 1f && Main.projectile[i].ai[1] == (float)targetNPCIndex)
			{
				bufferForScan[num++] = new Point(i, Main.projectile[i].timeLeft);
				if (num >= bufferForScan.Length)
				{
					break;
				}
			}
		}
		if (num < bufferForScan.Length)
		{
			return;
		}
		int num2 = 0;
		for (int j = 1; j < bufferForScan.Length; j++)
		{
			if (bufferForScan[j].Y < bufferForScan[num2].Y)
			{
				num2 = j;
			}
		}
		Main.projectile[bufferForScan[num2].X].Kill();
	}

	private int CountEnemiesWhoAreImmuneToMeRightNow(int cap)
	{
		int num = 0;
		for (int i = 0; i < localNPCImmunity.Length; i++)
		{
			if (localNPCImmunity[i] != 0)
			{
				num++;
				if (num >= cap)
				{
					break;
				}
			}
		}
		return num;
	}

	private static void EmitBlackLightningParticles(Vector2 position)
	{
		ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.BlackLightningHit, new ParticleOrchestraSettings
		{
			PositionInWorld = position
		});
	}

	private void TryDoingOnHitEffects(Entity entity)
	{
		switch (type)
		{
		case 221:
		case 227:
		case 614:
		case 729:
		case 908:
		case 977:
			return;
		}
		Main.player[owner].OnHit(entity.Center.X, entity.Center.Y, entity);
	}

	private void SummonSuperStarSlash(Vector2 target)
	{
		Vector2 v = Main.rand.NextVector2CircularEdge(200f, 200f);
		if (v.Y < 0f)
		{
			v.Y *= -1f;
		}
		v.Y += 100f;
		Vector2 vector = v.SafeNormalize(Vector2.UnitY) * 6f;
		NewProjectile(GetProjectileSource_FromThis(), target - vector * 20f, vector, 729, (int)((double)damage * 0.75), 0f, owner, 0f, target.Y);
	}

	private void SummonMonkGhast()
	{
		if (localAI[0] > 0f)
		{
			return;
		}
		localAI[0] = 1000f;
		List<NPC> list = new List<NPC>();
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			NPC nPC = Main.npc[i];
			if (nPC.CanBeChasedBy(this) && Distance(nPC.Center) < 800f)
			{
				list.Add(nPC);
			}
		}
		Vector2 center = base.Center;
		Vector2 zero = Vector2.Zero;
		if (list.Count > 0)
		{
			NPC nPC2 = list[Main.rand.Next(list.Count)];
			center = nPC2.Center;
			zero = nPC2.velocity;
		}
		int num = Main.rand.Next(2) * 2 - 1;
		Vector2 vector = new Vector2((float)num * (4f + (float)Main.rand.Next(3)), 0f);
		Vector2 vector2 = center + new Vector2(-num * 120, 0f);
		vector += (center + zero * 15f - vector2).SafeNormalize(Vector2.Zero) * 2f;
		NewProjectile(GetProjectileSource_FromThis(), vector2, vector, 700, damage, 0f, owner);
	}

	private void ModifyStellarTuneDamage(ref int damage)
	{
		if (type == 856 && owner >= 0 && owner < 255 && !Collision.CanHit(this, Main.player[owner]))
		{
			damage = (int)((double)damage * 0.75);
		}
	}

	private void CutTiles()
	{
		if (!CanCutTiles())
		{
			return;
		}
		AchievementsHelper.CurrentlyMining = true;
		bool flag = true;
		bool[] tileCutIgnorance = Main.player[owner].GetTileCutIgnorance(allowRegrowth: false, trap);
		DelegateMethods.tilecut_0 = TileCuttingContext.AttackProjectile;
		DelegateMethods.tileCutIgnore = tileCutIgnorance;
		Rectangle extensionBox;
		if (type == 461 || type == 632 || type == 642)
		{
			Utils.PlotTileLine(base.Center, base.Center + velocity * localAI[1], (float)width * scale, DelegateMethods.CutTiles);
		}
		else if (ProjectileID.Sets.IsAWhip[type])
		{
			flag = false;
			WhipPointsForCollision.Clear();
			FillWhipControlPoints(this, WhipPointsForCollision, null, getActualCollisionPoints: true);
			Vector2 vector = new Vector2((float)width * scale / 2f, 0f);
			for (int i = 0; i < WhipPointsForCollision.Count; i++)
			{
				Utils.PlotTileLine(WhipPointsForCollision[i] - vector, WhipPointsForCollision[i] + vector, (float)height * scale, DelegateMethods.CutTiles);
			}
		}
		else if (type == 756)
		{
			Utils.PlotTileLine(base.Center, base.Center + velocity.SafeNormalize(-Vector2.UnitY) * 200f * scale, 22f * scale, DelegateMethods.CutTiles);
		}
		else if (type == 927)
		{
			Vector2 end = base.Center + velocity.SafeNormalize(Vector2.UnitX) * 220f * scale;
			Utils.PlotTileLine(base.Center, end, 80f * scale, DelegateMethods.CutTiles);
		}
		else if (type == 802 || type == 842 || type == 938 || type == 939 || type == 940 || type == 941 || type == 942 || type == 943 || type == 944 || type == 945)
		{
			Utils.PlotTileLine(base.Center, base.Center + velocity.SafeNormalize(-Vector2.UnitY) * 10f, 10f * scale, DelegateMethods.CutTiles);
		}
		else if (type == 611)
		{
			Utils.PlotTileLine(base.Center, base.Center + velocity + velocity.SafeNormalize(Vector2.Zero) * 48f, (float)width * scale, DelegateMethods.CutTiles);
		}
		else if (type == 697 || type == 707)
		{
			float num = 40f;
			if (type == 707)
			{
				num = 60f;
			}
			float f = rotation - (float)Math.PI / 4f * (float)Math.Sign(velocity.X);
			Utils.PlotTileLine(base.Center + f.ToRotationVector2() * (0f - num), base.Center + f.ToRotationVector2() * num, (float)width * scale, DelegateMethods.CutTiles);
		}
		else if (aiStyle == 190 || aiStyle == 191)
		{
			flag = false;
			Vector2 vector2 = (rotation - (float)Math.PI / 4f).ToRotationVector2() * 60f * scale;
			Vector2 vector3 = (rotation + (float)Math.PI / 4f).ToRotationVector2() * 60f * scale;
			float num2 = 60f * scale;
			Utils.PlotTileLine(base.Center + vector2, base.Center + vector3, num2, DelegateMethods.CutTiles);
		}
		else if (aiStyle == 19 && AI_019_Spears_GetExtensionHitbox(Main.player[owner], out extensionBox))
		{
			CutTilesAt(extensionBox.TopLeft(), extensionBox.Width, extensionBox.Height);
		}
		if (flag)
		{
			CutTilesAt(position, width, height);
		}
		AchievementsHelper.CurrentlyMining = false;
	}

	private void CutTilesAt(Vector2 boxPosition, int boxWidth, int boxHeight)
	{
		int num = (int)(boxPosition.X / 16f);
		int num2 = (int)((boxPosition.X + (float)boxWidth) / 16f) + 1;
		int num3 = (int)(boxPosition.Y / 16f);
		int num4 = (int)((boxPosition.Y + (float)boxHeight) / 16f) + 1;
		if (num < 0)
		{
			num = 0;
		}
		if (num2 > Main.maxTilesX)
		{
			num2 = Main.maxTilesX;
		}
		if (num3 < 0)
		{
			num3 = 0;
		}
		if (num4 > Main.maxTilesY)
		{
			num4 = Main.maxTilesY;
		}
		bool[] tileCutIgnorance = Main.player[owner].GetTileCutIgnorance(allowRegrowth: false, trap);
		for (int i = num; i < num2; i++)
		{
			for (int j = num3; j < num4; j++)
			{
				Tile tile = Main.tile[i, j];
				if (tile == null || !tile.active() || tile.type < 0 || tileCutIgnorance[tile.type])
				{
					continue;
				}
				bool flag = Main.tileCut[tile.type];
				if (type == 1052 && ai[0] == 0f)
				{
					flag = flag || TileID.Sets.IsATreeTrunk[tile.type] || tile.type == 323;
				}
				if (type == 1047 && tile.type == 231)
				{
					flag = false;
				}
				if (flag && WorldGen.CanCutTile(i, j, TileCuttingContext.AttackProjectile))
				{
					WorldGen.KillTile(i, j);
					if (Main.netMode != 0)
					{
						NetMessage.SendData(17, -1, -1, null, 0, i, j);
					}
				}
			}
		}
	}

	private bool CanCutTiles()
	{
		if (type == 1041 && ai[0] < 0f)
		{
			return false;
		}
		if (aiStyle != 45 && aiStyle != 137 && aiStyle != 92 && aiStyle != 105 && aiStyle != 106 && !ProjectileID.Sets.IsAGolfBall[type] && type != 463 && type != 69 && type != 70 && type != 621 && type != 10 && type != 11 && type != 379 && type != 407 && type != 476 && type != 623 && (type < 625 || type > 628) && type != 833 && type != 834 && type != 835 && type != 818 && type != 831 && type != 820 && type != 864 && type != 970 && type != 995 && type != 908 && type != 1020 && type != 1105 && type != 1040)
		{
			return type != 1091;
		}
		return false;
	}

	public bool Colliding(Rectangle myRect, Rectangle targetRect)
	{
		if (aiStyle == 15)
		{
			if (ai[0] == 0f)
			{
				Vector2 mountedCenter = Main.player[owner].MountedCenter;
				Vector2 vector = targetRect.ClosestPointInRect(mountedCenter) - mountedCenter;
				vector.Y /= 0.8f;
				float num = 55f;
				return vector.Length() <= num;
			}
		}
		else if (type == 973)
		{
			Vector2 v = targetRect.ClosestPointInRect(base.Center) - base.Center;
			v.SafeNormalize(Vector2.UnitX);
			float num2 = 100f * scale;
			if (v.Length() < num2 && Collision.CanHit(base.Center, 0, 0, targetRect.Center.ToVector2(), 0, 0))
			{
				return true;
			}
		}
		else
		{
			if (type == 85 || type == 1106)
			{
				if (!myRect.Intersects(targetRect))
				{
					return false;
				}
				return Collision.CanHit(base.Center, 0, 0, targetRect.Center.ToVector2(), 0, 0);
			}
			if (type == 985)
			{
				float coneLength = 90f * scale;
				float maximumAngle = (float)Math.PI / 4f;
				float coneRotation = rotation;
				if (targetRect.IntersectsConeFastInaccurate(base.Center, coneLength, coneRotation, maximumAngle) && Collision.CanHit(base.Center, 0, 0, targetRect.Center.ToVector2(), 0, 0))
				{
					return true;
				}
			}
			else
			{
				if (aiStyle == 190)
				{
					float coneLength2 = 94f * scale;
					float num3 = (float)Math.PI * 2f / 25f * ai[0];
					float maximumAngle2 = (float)Math.PI / 4f;
					float num4 = rotation + num3;
					if (targetRect.IntersectsConeSlowMoreAccurate(base.Center, coneLength2, num4, maximumAngle2))
					{
						return true;
					}
					float num5 = Utils.Remap(localAI[0], ai[1] * 0.3f, ai[1] * 0.5f, 1f, 0f);
					if (num5 > 0f)
					{
						float coneRotation2 = num4 - (float)Math.PI / 4f * ai[0] * num5;
						if (targetRect.IntersectsConeSlowMoreAccurate(base.Center, coneLength2, coneRotation2, maximumAngle2))
						{
							return true;
						}
					}
					return false;
				}
				if (type == 623)
				{
					if (ai[0] == 2f)
					{
						Rectangle value = Utils.CenteredRectangle(base.Center + new Vector2(direction * 40, 0f), new Vector2(80f, 40f));
						if (targetRect.Intersects(value))
						{
							return true;
						}
					}
				}
				else
				{
					if (type == 933 || type == 1100)
					{
						float collisionPoint = 0f;
						float num6 = 40f;
						for (int i = 14; i < oldPos.Length; i += 15)
						{
							float num7 = localAI[0] - (float)i;
							if (!(num7 < 0f) && !(num7 > 60f))
							{
								Vector2 vector2 = oldPos[i] + base.Size / 2f;
								Vector2 vector3 = (oldRot[i] + (float)Math.PI / 2f).ToRotationVector2();
								_lanceHitboxBounds.X = (int)vector2.X - _lanceHitboxBounds.Width / 2;
								_lanceHitboxBounds.Y = (int)vector2.Y - _lanceHitboxBounds.Height / 2;
								if (_lanceHitboxBounds.Intersects(targetRect) && Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), vector2 - vector3 * num6, vector2 + vector3 * num6, 20f, ref collisionPoint))
								{
									return true;
								}
							}
						}
						Vector2 vector4 = (rotation + (float)Math.PI / 2f).ToRotationVector2();
						_lanceHitboxBounds.X = (int)position.X - _lanceHitboxBounds.Width / 2;
						_lanceHitboxBounds.Y = (int)position.Y - _lanceHitboxBounds.Height / 2;
						if (_lanceHitboxBounds.Intersects(targetRect) && Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center - vector4 * num6, base.Center + vector4 * num6, 20f, ref collisionPoint))
						{
							return true;
						}
						return false;
					}
					if (type == 927)
					{
						for (float num8 = 0f; num8 <= 1f; num8 += 0.05f)
						{
							float num9 = Utils.Remap(num8, 0f, 1f, 1f, 5f);
							Rectangle rectangle = myRect;
							Vector2 vector5 = velocity.SafeNormalize(Vector2.Zero) * width * num9 * scale;
							rectangle.Offset((int)vector5.X, (int)vector5.Y);
							if (rectangle.Intersects(targetRect))
							{
								return true;
							}
						}
					}
					else
					{
						if (type == 877 || type == 878 || type == 879)
						{
							float f = rotation - (float)Math.PI / 4f - (float)Math.PI / 2f - ((spriteDirection == 1) ? ((float)Math.PI) : ((float)Math.PI / 2f));
							float collisionPoint2 = 0f;
							float num10 = 95f;
							_lanceHitboxBounds.X = (int)position.X - _lanceHitboxBounds.Width / 2;
							_lanceHitboxBounds.Y = (int)position.Y - _lanceHitboxBounds.Height / 2;
							if (_lanceHitboxBounds.Intersects(targetRect) && Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + f.ToRotationVector2() * num10, 23f * scale, ref collisionPoint2))
							{
								return true;
							}
							return false;
						}
						if (type == 974)
						{
							float f2 = rotation;
							float collisionPoint3 = 0f;
							float num11 = 46f * scale;
							float num12 = 8f;
							Vector2 vector6 = f2.ToRotationVector2();
							Rectangle hitbox = base.Hitbox;
							hitbox.Inflate((int)num11, (int)num11);
							if (hitbox.Intersects(targetRect) && Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center - vector6 * num11, base.Center + vector6 * num11, num12 * scale, ref collisionPoint3))
							{
								return true;
							}
							return false;
						}
						if (type == 919 || type == 932)
						{
							float f3 = rotation;
							float collisionPoint4 = 0f;
							float num13 = 40f;
							Vector2 vector7 = f3.ToRotationVector2();
							_lanceHitboxBounds.X = (int)position.X - _lanceHitboxBounds.Width / 2;
							_lanceHitboxBounds.Y = (int)position.Y - _lanceHitboxBounds.Height / 2;
							if (_lanceHitboxBounds.Intersects(targetRect) && Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center - vector7 * num13, base.Center + vector7 * num13, 8f, ref collisionPoint4))
							{
								return true;
							}
							return false;
						}
						if (type == 923)
						{
							float collisionPoint5 = 0f;
							_ = scale;
							float f4 = rotation;
							Vector2 objectPosition = targetRect.TopLeft();
							Vector2 objectDimensions = targetRect.Size();
							Vector2 vector8 = f4.ToRotationVector2();
							float num14 = scale * 0.7f;
							if (Collision.CheckAABBvLineCollision(objectPosition, objectDimensions, base.Center, base.Center + vector8 * scale * 510f, num14 * 100f, ref collisionPoint5))
							{
								return true;
							}
							if (Collision.CheckAABBvLineCollision(objectPosition, objectDimensions, base.Center, base.Center + vector8 * scale * 660f, num14 * 60f, ref collisionPoint5))
							{
								return true;
							}
							if (Collision.CheckAABBvLineCollision(objectPosition, objectDimensions, base.Center, base.Center + vector8 * scale * 800f, num14 * 10f, ref collisionPoint5))
							{
								return true;
							}
							return false;
						}
						if (type == 598 && targetRect.Width > 8 && targetRect.Height > 8)
						{
							targetRect.Inflate(-targetRect.Width / 8, -targetRect.Height / 8);
						}
						else
						{
							if (type == 872)
							{
								Rectangle hitbox2 = base.Hitbox;
								int num15 = 80;
								for (int j = 0; j < num15; j += 2)
								{
									Vector2 vector9 = oldPos[j];
									if (!(vector9 == Vector2.Zero))
									{
										hitbox2.X = (int)vector9.X;
										hitbox2.Y = (int)vector9.Y;
										if (hitbox2.Intersects(targetRect))
										{
											return true;
										}
									}
								}
								return false;
							}
							if (type == 871)
							{
								int num16 = AI_172_GetPelletStormsCount();
								for (int k = 0; k < num16; k++)
								{
									HallowBossPelletStormInfo hallowBossPelletStormInfo = AI_172_GetPelletStormInfo(k);
									for (int l = 0; l < hallowBossPelletStormInfo.BulletsInStorm; l++)
									{
										if (hallowBossPelletStormInfo.IsValid(l) && hallowBossPelletStormInfo.GetBulletHitbox(l, base.Center).Intersects(targetRect))
										{
											return true;
										}
									}
								}
								return false;
							}
							if (ProjectileID.Sets.IsAWhip[type])
							{
								WhipPointsForCollision.Clear();
								FillWhipControlPoints(this, WhipPointsForCollision, null, getActualCollisionPoints: true);
								for (int m = 0; m < WhipPointsForCollision.Count; m++)
								{
									Point point = WhipPointsForCollision[m].ToPoint();
									myRect.Location = new Point(point.X - myRect.Width / 2, point.Y - myRect.Height / 2);
									if (myRect.Intersects(targetRect))
									{
										return true;
									}
								}
								return false;
							}
							if (type == 614 && targetRect.Width > 8 && targetRect.Height > 8)
							{
								targetRect.Inflate(-targetRect.Width / 8, -targetRect.Height / 8);
							}
							else if (type == 963 && ai[0] >= 2f)
							{
								targetRect.Inflate(30, 30);
							}
							else if (type == 758)
							{
								if (ai[0] == 2f && Utils.CenteredRectangle(base.Center + new Vector2(spriteDirection * 30, 0f), new Vector2(50f, 20f)).Intersects(targetRect))
								{
									return true;
								}
							}
							else if (type == 1093)
							{
								if (ai[0] == 2f && Utils.CenteredRectangle(base.Center + new Vector2(spriteDirection * 8, 0f), new Vector2(20f, 20f)).Intersects(targetRect))
								{
									return true;
								}
							}
							else if (type == 636 && targetRect.Width > 8 && targetRect.Height > 8)
							{
								targetRect.Inflate(-targetRect.Width / 8, -targetRect.Height / 8);
							}
							else if (type == 607)
							{
								myRect.X += (int)velocity.X;
								myRect.Y += (int)velocity.Y;
							}
							else if (type == 661)
							{
								if (Vector2.Distance(myRect.Center.ToVector2(), targetRect.Center.ToVector2()) > 500f || !Collision.CanHitLine(myRect.Center.ToVector2(), 0, 0, targetRect.Center.ToVector2(), 0, 0))
								{
									return false;
								}
							}
							else
							{
								if (aiStyle == 137)
								{
									if (myRect.Intersects(targetRect) && targetRect.Distance(base.Center) < (float)(height / 2 - 20))
									{
										if (AI_137_CanHit(targetRect.Center.ToVector2()))
										{
											return true;
										}
										if (AI_137_CanHit(targetRect.TopLeft() + new Vector2(targetRect.Width / 2, 0f)))
										{
											return true;
										}
									}
									return false;
								}
								if (aiStyle == 19)
								{
									Vector2 center = base.Center;
									if (AI_019_Spears_GetExtensionHitbox(Main.player[owner], out var extensionBox))
									{
										Vector2 vector10 = extensionBox.Center.ToVector2();
										float num17 = Vector2.Distance(vector10, center);
										Vector2 size = extensionBox.Size();
										float num18 = MathHelper.Max(extensionBox.Width, extensionBox.Height);
										if (num18 < 12f)
										{
											num18 = 12f;
										}
										for (float num19 = num18; num19 < num17; num19 += num18)
										{
											if (Utils.CenteredRectangle(Vector2.Lerp(center, vector10, num19 / num17), size).Intersects(targetRect))
											{
												return true;
											}
										}
										if (extensionBox.Intersects(targetRect))
										{
											return true;
										}
									}
								}
								else
								{
									if (type == 756 || type == 961 || type == 1041)
									{
										float collisionPoint6 = 0f;
										if (ai[0] < 0f)
										{
											return false;
										}
										if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + velocity.SafeNormalize(-Vector2.UnitY) * 200f * scale, 22f * scale, ref collisionPoint6))
										{
											return true;
										}
										return false;
									}
									if (aiStyle == 203)
									{
										return StormLightningCollisionCheck(targetRect);
									}
								}
							}
						}
					}
				}
			}
		}
		if (myRect.Intersects(targetRect))
		{
			return true;
		}
		if (type == 461)
		{
			float collisionPoint7 = 0f;
			if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + velocity * localAI[1], 22f * scale, ref collisionPoint7))
			{
				return true;
			}
			return false;
		}
		if (type == 697 || type == 707)
		{
			float f5 = rotation - (float)Math.PI / 4f * (float)Math.Sign(velocity.X);
			float collisionPoint8 = 0f;
			float num20 = 50f;
			if (type == 697)
			{
				num20 = 65f;
			}
			if (type == 707)
			{
				num20 = 110f;
			}
			if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center + f5.ToRotationVector2() * (0f - num20), base.Center + f5.ToRotationVector2() * num20, 23f * scale, ref collisionPoint8))
			{
				return true;
			}
			return false;
		}
		if (type == 699)
		{
			float f6 = rotation - (float)Math.PI / 4f * (float)Math.Sign(velocity.X) + ((spriteDirection == -1) ? ((float)Math.PI) : 0f);
			float collisionPoint9 = 0f;
			float num21 = -95f;
			if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + f6.ToRotationVector2() * num21, 23f * scale, ref collisionPoint9))
			{
				return true;
			}
			return false;
		}
		if (type == 642)
		{
			float collisionPoint10 = 0f;
			if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + velocity * localAI[1], 30f * scale, ref collisionPoint10))
			{
				return true;
			}
			return false;
		}
		if (type == 802 || type == 842 || type == 938 || type == 939 || type == 940 || type == 941 || type == 942 || type == 943 || type == 944 || type == 945)
		{
			float collisionPoint11 = 0f;
			if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + velocity * 6f, 10f * scale, ref collisionPoint11))
			{
				return true;
			}
			return false;
		}
		if (type == 632)
		{
			float collisionPoint12 = 0f;
			if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + velocity * localAI[1], 22f * scale, ref collisionPoint12))
			{
				return true;
			}
			return false;
		}
		if (type == 455)
		{
			float collisionPoint13 = 0f;
			if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + velocity * localAI[1], 36f * scale, ref collisionPoint13))
			{
				return true;
			}
			return false;
		}
		if (type == 611)
		{
			float collisionPoint14 = 0f;
			if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + velocity + velocity.SafeNormalize(Vector2.Zero) * 48f, 16f * scale, ref collisionPoint14))
			{
				return true;
			}
			return false;
		}
		if (type == 684)
		{
			float collisionPoint15 = 0f;
			Vector2 vector11 = velocity.SafeNormalize(Vector2.UnitY).RotatedBy(-1.5707963705062866) * scale;
			if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center - vector11 * 40f, base.Center + vector11 * 40f, 16f * scale, ref collisionPoint15))
			{
				return true;
			}
			return false;
		}
		if (type == 537)
		{
			float collisionPoint16 = 0f;
			if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + velocity * localAI[1], 22f * scale, ref collisionPoint16))
			{
				return true;
			}
			return false;
		}
		if (type == 687)
		{
			float collisionPoint17 = 0f;
			float num22 = ai[0] / 25f;
			if (num22 > 1f)
			{
				num22 = 1f;
			}
			float num23 = (ai[0] - 38f) / 40f;
			if (num23 < 0f)
			{
				num23 = 0f;
			}
			Vector2 lineStart = base.Center + rotation.ToRotationVector2() * 400f * num23;
			Vector2 lineEnd = base.Center + rotation.ToRotationVector2() * 400f * num22;
			if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), lineStart, lineEnd, 40f * scale, ref collisionPoint17))
			{
				return true;
			}
			return false;
		}
		if (type == 466 || type == 580 || type == 686)
		{
			for (int n = 0; n < oldPos.Length && (oldPos[n].X != 0f || oldPos[n].Y != 0f); n++)
			{
				myRect.X = (int)oldPos[n].X;
				myRect.Y = (int)oldPos[n].Y;
				if (myRect.Intersects(targetRect))
				{
					return true;
				}
			}
			return false;
		}
		if (type == 711)
		{
			if (penetrate != -1)
			{
				for (int num24 = 0; num24 < oldPos.Length && (oldPos[num24].X != 0f || oldPos[num24].Y != 0f); num24++)
				{
					myRect.X = (int)oldPos[num24].X;
					myRect.Y = (int)oldPos[num24].Y;
					if (myRect.Intersects(targetRect))
					{
						return true;
					}
				}
			}
		}
		else if (type == 464 && ai[1] != 1f)
		{
			Vector2 vector12 = new Vector2(0f, -720f).RotatedBy(velocity.ToRotation());
			float num25 = ai[0] % 45f / 45f;
			Vector2 spinningpoint = vector12 * num25;
			for (int num26 = 0; num26 < 6; num26++)
			{
				float num27 = (float)num26 * ((float)Math.PI * 2f) / 6f;
				if (Utils.CenteredRectangle(base.Center + spinningpoint.RotatedBy(num27), new Vector2(30f, 30f)).Intersects(targetRect))
				{
					return true;
				}
			}
		}
		return false;
	}

	private bool StormLightningCollisionCheck(Rectangle targetRect)
	{
		if (localAI[0] == 1f && GetStormLightningExplosionRect().Intersects(targetRect))
		{
			return true;
		}
		if (StormLightningLiquidCollisionCheck(targetRect.Center()))
		{
			return true;
		}
		if (_lightningCollisionBounds != null && _lightningCollisionBounds.Intersects(targetRect))
		{
			return true;
		}
		return false;
	}

	private Rectangle GetStormLightningExplosionRect()
	{
		return Utils.CenteredRectangle(base.Center, new Vector2(64f));
	}

	private bool StormLightningLiquidCollisionCheck(Vector2 targetCenter)
	{
		if (localAI[0] == 3f && targetCenter.Y >= base.Center.Y && Vector2.Distance(base.Center, targetCenter) < 500f && Utils.PlotLine(base.Center.ToTileCoordinates(), targetCenter.ToTileCoordinates(), (int x, int y) => WorldGen.InWorld(x, y) && Main.tile[x, y].liquid != 0))
		{
			return true;
		}
		return false;
	}

	public void ProjLight()
	{
		if (!(light > 0f))
		{
			return;
		}
		float num = light;
		float num2 = light;
		float num3 = light;
		switch (type)
		{
		case 987:
			num *= 0.6f;
			num2 *= 0.5f;
			num3 *= 0.1f;
			break;
		case 988:
			num *= 0.8f;
			num2 *= 0.35f;
			num3 *= 0f;
			break;
		case 989:
			num *= 0f;
			num2 *= 0.65f;
			num3 *= 0f;
			break;
		case 990:
			num *= 0f;
			num2 *= 0.35f;
			num3 *= 0.7f;
			break;
		case 991:
			num *= 0.9f;
			num2 *= 0f;
			num3 *= 0.5f;
			break;
		case 992:
			num *= 0.75f;
			num2 *= 0f;
			num3 *= 0.75f;
			break;
		case 993:
			num *= (float)Main.DiscoR / 255f;
			num2 *= (float)Main.DiscoG / 255f;
			num3 *= (float)Main.DiscoB / 255f;
			break;
		}
		if (type == 446)
		{
			num *= 0f;
			num3 *= 0.8f;
		}
		else if (type == 493 || type == 494)
		{
			num2 *= 0.3f;
		}
		else if (type == 876)
		{
			num *= 0.1f;
			num2 *= 0.7f;
			num3 *= 1f;
		}
		else if (type == 867)
		{
			float num4 = (float)Main.rand.Next(28, 42) * 0.005f;
			num4 += (float)(270 - Main.mouseTextColor) / 500f;
			num = 0.1f;
			num2 = 0.3f + num4 / 2f;
			num3 = 0.6f + num4;
		}
		else if (type == 1000)
		{
			float num5 = (float)Main.rand.Next(28, 42) * 0.005f;
			num5 += (float)(270 - Main.mouseTextColor) / 500f;
			num = 0.3f + num5 * 0.25f;
			num2 = 0.35f + num5 * 0.75f;
			num3 = 0.5f + num5;
		}
		else if (type == 332)
		{
			num3 *= 0.1f;
			num2 *= 0.6f;
		}
		else if (type == 259)
		{
			num3 *= 0.1f;
			if (Main.getGoodWorld)
			{
				num = 0f;
				num2 = 0f;
				num3 = 0f;
			}
		}
		else if (type == 329)
		{
			num3 *= 0.1f;
			num2 *= 0.9f;
		}
		else if (type == 2 || type == 82)
		{
			num2 *= 0.75f;
			num3 *= 0.55f;
		}
		else if (type == 172)
		{
			num2 *= 0.55f;
			num *= 0.35f;
		}
		else if (type == 308)
		{
			num2 *= 0.7f;
			num *= 0.1f;
		}
		else if (type == 304)
		{
			num2 *= 0.2f;
			num3 *= 0.1f;
		}
		else if (type == 263)
		{
			num2 *= 0.7f;
			num *= 0.1f;
		}
		else if (type == 274)
		{
			num2 *= 0.1f;
			num *= 0.7f;
		}
		else if (type == 254)
		{
			num *= 0.1f;
		}
		else if (type == 94)
		{
			num *= 0.5f;
			num2 *= 0f;
		}
		else if (type == 95 || type == 96 || type == 103 || type == 104)
		{
			num *= 0.35f;
			num2 *= 1f;
			num3 *= 0f;
		}
		else if (type == 4)
		{
			num2 *= 0.1f;
			num *= 0.5f;
		}
		else if (type == 257)
		{
			num2 *= 0.9f;
			num *= 0.1f;
		}
		else if (type == 9)
		{
			num2 *= 0.1f;
			num3 *= 0.6f;
		}
		else if (type == 488)
		{
			num = 0.3f;
			num3 = 0.25f;
			num2 = 0f;
		}
		else if (type == 92)
		{
			num2 *= 0.6f;
			num *= 0.8f;
		}
		else if (type == 93)
		{
			num2 *= 1f;
			num *= 1f;
			num3 *= 0.01f;
		}
		else if (type == 12 || type == 955)
		{
			num *= 0.9f;
			num2 *= 0.8f;
			num3 *= 0.1f;
		}
		else if (type == 14 || type == 110 || type == 180 || type == 242 || type == 302)
		{
			num2 *= 0.7f;
			num3 *= 0.1f;
		}
		else if (type == 981)
		{
			num2 *= 0.7f;
			num3 *= 0.7f;
		}
		else if (type == 15)
		{
			num2 *= 0.4f;
			num3 *= 0.1f;
			num = 1f;
		}
		else if (type == 16)
		{
			num *= 0.1f;
			num2 *= 0.4f;
			num3 = 1f;
		}
		else if (type == 18)
		{
			num2 *= 0.1f;
			num *= 0.6f;
		}
		else if (type == 19)
		{
			num2 *= 0.5f;
			num3 *= 0.1f;
		}
		else if (type == 20)
		{
			num *= 0.1f;
			num3 *= 0.3f;
		}
		else if (type == 22)
		{
			num = 0f;
			num2 = 0f;
		}
		else if (type == 27)
		{
			num *= 0f;
			num2 *= 0.3f;
			num3 = 1f;
		}
		else if (type == 34)
		{
			num2 *= 0.1f;
			num3 *= 0.1f;
		}
		else if (type == 36)
		{
			num = 0.8f;
			num2 *= 0.2f;
			num3 *= 0.6f;
		}
		else if (type == 41)
		{
			num2 *= 0.8f;
			num3 *= 0.6f;
		}
		else if (type == 44 || type == 45)
		{
			num3 = 1f;
			num *= 0.6f;
			num2 *= 0.1f;
		}
		else if (type == 50)
		{
			num *= 0.7f;
			num3 *= 0.8f;
		}
		else if (type == 515)
		{
			num2 *= 0.6f;
			num3 *= 0.85f;
		}
		else if (type == 870)
		{
			num *= 0.9f;
			num2 = 0.35f;
		}
		else if (type == 53)
		{
			num *= 0.7f;
			num2 *= 0.8f;
		}
		else if (type == 473)
		{
			num *= 1.05f;
			num2 *= 0.95f;
			num3 *= 0.55f;
		}
		else if (type == 1089)
		{
			num = (float)Main.DiscoR / 255f;
			num2 = (float)Main.DiscoG / 255f;
			num3 = (float)Main.DiscoB / 255f;
		}
		else if (type == 72)
		{
			num *= 0.45f;
			num2 *= 0.75f;
			num3 = 1f;
		}
		else if (type == 86)
		{
			num *= 1f;
			num2 *= 0.45f;
			num3 = 0.75f;
		}
		else if (type == 87)
		{
			num *= 0.45f;
			num2 = 1f;
			num3 *= 0.75f;
		}
		else if (type == 73)
		{
			num *= 0.4f;
			num2 *= 0.6f;
			num3 *= 1f;
		}
		else if (type == 74)
		{
			num *= 1f;
			num2 *= 0.4f;
			num3 *= 0.6f;
		}
		else if (type == 284)
		{
			num *= 1f;
			num2 *= 0.1f;
			num3 *= 0.8f;
		}
		else if (type == 285)
		{
			num *= 0.1f;
			num2 *= 0.5f;
			num3 *= 1f;
		}
		else if (type == 286)
		{
			num *= 1f;
			num2 *= 0.5f;
			num3 *= 0.1f;
		}
		else if (type == 287)
		{
			num *= 0.9f;
			num2 *= 1f;
			num3 *= 0.4f;
		}
		else if (type == 283)
		{
			num *= 0.8f;
			num2 *= 0.1f;
		}
		else if (type == 76 || type == 77 || type == 78)
		{
			num *= 1f;
			num2 *= 0.3f;
			num3 *= 0.6f;
		}
		else if (type == 79)
		{
			num = (float)Main.DiscoR / 255f;
			num2 = (float)Main.DiscoG / 255f;
			num3 = (float)Main.DiscoB / 255f;
		}
		else if (type == 80)
		{
			num *= 0f;
			num2 *= 0.8f;
			num3 *= 1f;
		}
		else if (type == 83 || type == 88)
		{
			num *= 0.7f;
			num2 *= 0f;
			num3 *= 1f;
		}
		else if (type == 100)
		{
			num *= 1f;
			num2 *= 0.5f;
			num3 *= 0f;
		}
		else if (type == 84 || type == 389)
		{
			num *= 0.8f;
			num2 *= 0f;
			num3 *= 0.5f;
		}
		else if (type == 89 || type == 90)
		{
			num2 *= 0.2f;
			num3 *= 1f;
			num *= 0.05f;
		}
		else if (type == 106)
		{
			num *= 0f;
			num2 *= 0.5f;
			num3 *= 1f;
		}
		else if (type == 113)
		{
			num *= 0.25f;
			num2 *= 0.75f;
			num3 *= 1f;
		}
		else if (type == 114 || type == 115)
		{
			num *= 0.5f;
			num2 *= 0.05f;
			num3 *= 1f;
		}
		else if (type == 116)
		{
			num3 *= 0.25f;
		}
		else if (type == 131)
		{
			num *= 0.1f;
			num2 *= 0.4f;
		}
		else if (type == 132 || type == 157)
		{
			num *= 0.2f;
			num3 *= 0.6f;
		}
		else if (type == 156)
		{
			num *= 1f;
			num3 *= 0.6f;
			num2 = 0f;
		}
		else if (type == 173)
		{
			num *= 0.3f;
			num3 *= 1f;
			num2 = 0.4f;
		}
		else if (type == 207)
		{
			num *= 0.4f;
			num3 *= 0.4f;
		}
		else if (type == 253)
		{
			num = 0f;
			num2 *= 0.4f;
		}
		else if (type == 211)
		{
			num *= 0.5f;
			num2 *= 0.9f;
			num3 *= 1f;
			if (localAI[0] == 0f)
			{
				light = 1.5f;
			}
			else
			{
				light = 1f;
			}
		}
		else if (type == 209)
		{
			float num6 = (255f - (float)alpha) / 255f;
			num *= 0.3f;
			num2 *= 0.4f;
			num3 *= 1.75f;
			num3 *= num6;
			num *= num6;
			num2 *= num6;
		}
		else if (type == 226 || ((type == 221) | (type == 229)))
		{
			num *= 0.25f;
			num2 *= 1f;
			num3 *= 0.5f;
		}
		else if (type == 251)
		{
			num = (float)Main.DiscoR / 255f;
			num2 = (float)Main.DiscoG / 255f;
			num3 = (float)Main.DiscoB / 255f;
			num = (num + 1f) / 2f;
			num2 = (num2 + 1f) / 2f;
			num3 = (num3 + 1f) / 2f;
			num *= light;
			num2 *= light;
			num3 *= light;
		}
		else if (type == 278 || type == 279)
		{
			num *= 1f;
			num2 *= 1f;
			num3 *= 0f;
		}
		if (type == 870)
		{
			Vector3 rgb = (DelegateMethods.v3_1 = new Vector3(num, num2, num3));
			Point point = base.Center.ToTileCoordinates();
			DelegateMethods.v2_1 = point.ToVector2();
			DelegateMethods.f_1 = 4.5f;
			Utils.FloodFillTile(point, 4.5f, DelegateMethods.SpreadLightOpen_StopForSolids);
			Lighting.AddLight(base.Center, rgb);
		}
		else
		{
			Lighting.AddLight((int)((position.X + (float)(width / 2)) / 16f), (int)((position.Y + (float)(height / 2)) / 16f), num, num2, num3);
		}
	}

	public Rectangle getRect()
	{
		return new Rectangle((int)position.X, (int)position.Y, width, height);
	}

	public void Update(int i)
	{
		if (!active)
		{
			return;
		}
		if (Main.netMode == 1 && (ProjectileID.Sets.IsAGolfBall[type] || type == 820))
		{
			int num = (int)(position.X + (float)(width / 2)) / 16;
			int num2 = (int)(position.Y + (float)(height / 2)) / 16;
			if (Main.tile[num, num2] == null)
			{
				return;
			}
		}
		DecrementLocalImmuneTimeCounters();
		numUpdates = extraUpdates;
		while (numUpdates >= 0)
		{
			numUpdates--;
			if (type == 640 && ai[1] > 0f)
			{
				ai[1] -= 1f;
				continue;
			}
			if (aiStyle != 3 && (position.X <= Main.leftWorld || position.X + (float)width >= Main.rightWorld || position.Y <= Main.topWorld || position.Y + (float)height >= Main.bottomWorld))
			{
				if (minion)
				{
					Player player = Main.player[owner];
					if (player.active && !player.dead)
					{
						base.Center = player.Center;
						netUpdate = true;
					}
					else
					{
						active = false;
					}
				}
				else
				{
					active = false;
				}
				return;
			}
			if (!noEnchantmentVisuals)
			{
				UpdateEnchantmentVisuals();
			}
			if (numUpdates == -1 && (minion || sentry))
			{
				Player player2 = Main.player[owner];
				damage = (int)((float)originalDamage * player2.minionDamage + 5E-06f);
			}
			if (minion && numUpdates == -1 && type != 625 && type != 628)
			{
				minionPos = Main.player[owner].numMinions;
				if (Main.player[owner].slotsMinions + minionSlots > (float)Main.player[owner].maxMinions && owner == Main.myPlayer)
				{
					if ((type == 627 || type == 626) && owner == Main.myPlayer)
					{
						int byUUID = GetByUUID(owner, ai[0]);
						if (byUUID != -1)
						{
							Projectile projectile = Main.projectile[byUUID];
							if (projectile.type != 625)
							{
								projectile.localAI[1] = localAI[1];
							}
							projectile = Main.projectile[(int)localAI[1]];
							projectile.ai[0] = ai[0];
							projectile.ai[1] = 1f;
							projectile.netUpdate = true;
						}
					}
					Kill();
				}
				else
				{
					Main.player[owner].numMinions++;
					Main.player[owner].slotsMinions += minionSlots;
				}
			}
			float num3 = 1f + Math.Abs(velocity.X) / 3f;
			if (gfxOffY > 0f)
			{
				gfxOffY -= num3 * stepSpeed;
				if (gfxOffY < 0f)
				{
					gfxOffY = 0f;
				}
			}
			else if (gfxOffY < 0f)
			{
				gfxOffY += num3 * stepSpeed;
				if (gfxOffY > 0f)
				{
					gfxOffY = 0f;
				}
			}
			if (gfxOffY > 16f)
			{
				gfxOffY = 16f;
			}
			if (gfxOffY < -16f)
			{
				gfxOffY = -16f;
			}
			Vector2 wetVelocity = velocity;
			oldVelocity = velocity;
			whoAmI = i;
			if (soundDelay > 0)
			{
				soundDelay--;
			}
			netUpdate = false;
			if (active)
			{
				AI();
			}
			if (ShouldUseWindPhysics() && (double)base.Center.Y < Main.worldSurface * 16.0 && Main.tile[(int)base.Center.X / 16, (int)base.Center.Y / 16] != null && Main.tile[(int)base.Center.X / 16, (int)base.Center.Y / 16].wall == 0 && ((velocity.X > 0f && Main.windSpeedCurrent < 0f) || (velocity.X < 0f && Main.windSpeedCurrent > 0f) || Math.Abs(velocity.X) < Math.Abs(Main.windSpeedCurrent * Main.windPhysicsStrength) * 180f) && Math.Abs(velocity.X) < 16f)
			{
				velocity.X += Main.windSpeedCurrent * Main.windPhysicsStrength;
				MathHelper.Clamp(velocity.X, -16f, 16f);
			}
			if (owner < 255 && !Main.player[owner].active)
			{
				Kill();
			}
			if (type == 242 || type == 302 || type == 638)
			{
				wet = false;
			}
			if (!ignoreWater)
			{
				bool flag;
				bool flag2;
				try
				{
					flag = Collision.LavaCollision(position, width, height);
					flag2 = Collision.WetCollision(position, width, height);
					if (flag)
					{
						lavaWet = true;
					}
					if (Collision.honey)
					{
						honeyWet = true;
					}
					if (Collision.shimmer)
					{
						shimmerWet = true;
					}
				}
				catch
				{
					active = false;
					return;
				}
				if (wet && !lavaWet)
				{
					if (ProjectileID.Sets.IsDestroyedByWater[type])
					{
						Kill();
					}
					if (type == 2)
					{
						type = 1;
						light = 0f;
					}
				}
				if (type == 34 && lavaWet)
				{
					flag2 = (wet = (lavaWet = false));
				}
				if (type == 80)
				{
					flag2 = false;
					wet = false;
					if (flag && ai[0] >= 0f)
					{
						Kill();
					}
				}
				if (flag2)
				{
					if (type != 155 && wetCount == 0 && !wet)
					{
						if (!flag)
						{
							if (shimmerWet)
							{
								for (int j = 0; j < 10; j++)
								{
									int num4 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 308);
									Main.dust[num4].velocity.Y -= 4f;
									Main.dust[num4].velocity.X *= 2.5f;
									Main.dust[num4].scale = 1.3f;
									Main.dust[num4].noGravity = true;
									switch (Main.rand.Next(6))
									{
									case 0:
										Main.dust[num4].color = new Color(255, 255, 210);
										break;
									case 1:
										Main.dust[num4].color = new Color(190, 245, 255);
										break;
									case 2:
										Main.dust[num4].color = new Color(255, 150, 255);
										break;
									default:
										Main.dust[num4].color = new Color(190, 175, 255);
										break;
									}
									SoundEngine.PlaySound(19, (int)position.X, (int)position.Y, 4);
								}
							}
							else if (honeyWet)
							{
								for (int k = 0; k < 10; k++)
								{
									int num5 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 152);
									Main.dust[num5].velocity.Y -= 1f;
									Main.dust[num5].velocity.X *= 2.5f;
									Main.dust[num5].scale = 1.3f;
									Main.dust[num5].alpha = 100;
									Main.dust[num5].noGravity = true;
								}
								SoundEngine.PlaySound(19, (int)position.X, (int)position.Y);
							}
							else
							{
								for (int l = 0; l < 10; l++)
								{
									int num6 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, Dust.dustWater());
									Main.dust[num6].velocity.Y -= 4f;
									Main.dust[num6].velocity.X *= 2.5f;
									Main.dust[num6].scale = 1.3f;
									Main.dust[num6].alpha = 100;
									Main.dust[num6].noGravity = true;
								}
								SoundEngine.PlaySound(19, (int)position.X, (int)position.Y);
							}
						}
						else
						{
							for (int m = 0; m < 10; m++)
							{
								int num7 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 35);
								Main.dust[num7].velocity.Y -= 1.5f;
								Main.dust[num7].velocity.X *= 2.5f;
								Main.dust[num7].scale = 1.3f;
								Main.dust[num7].alpha = 100;
								Main.dust[num7].noGravity = true;
							}
							SoundEngine.PlaySound(19, (int)position.X, (int)position.Y);
						}
					}
					wet = true;
				}
				else if (wet)
				{
					wet = false;
					if (type == 155)
					{
						velocity.Y *= 0.5f;
					}
					else if (wetCount == 0)
					{
						wetCount = 10;
						if (!lavaWet)
						{
							if (shimmerWet)
							{
								for (int n = 0; n < 10; n++)
								{
									int num8 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 308);
									Main.dust[num8].velocity.Y -= 4f;
									Main.dust[num8].velocity.X *= 2.5f;
									Main.dust[num8].scale = 1.3f;
									Main.dust[num8].noGravity = true;
									switch (Main.rand.Next(6))
									{
									case 0:
										Main.dust[num8].color = new Color(255, 255, 210);
										break;
									case 1:
										Main.dust[num8].color = new Color(190, 245, 255);
										break;
									case 2:
										Main.dust[num8].color = new Color(255, 150, 255);
										break;
									default:
										Main.dust[num8].color = new Color(190, 175, 255);
										break;
									}
									SoundEngine.PlaySound(19, (int)position.X, (int)position.Y, 5);
								}
							}
							else if (honeyWet)
							{
								for (int num9 = 0; num9 < 10; num9++)
								{
									int num10 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 152);
									Main.dust[num10].velocity.Y -= 1f;
									Main.dust[num10].velocity.X *= 2.5f;
									Main.dust[num10].scale = 1.3f;
									Main.dust[num10].alpha = 100;
									Main.dust[num10].noGravity = true;
								}
								SoundEngine.PlaySound(19, (int)position.X, (int)position.Y);
							}
							else
							{
								for (int num11 = 0; num11 < 10; num11++)
								{
									int num12 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2)), width + 12, 24, Dust.dustWater());
									Main.dust[num12].velocity.Y -= 4f;
									Main.dust[num12].velocity.X *= 2.5f;
									Main.dust[num12].scale = 1.3f;
									Main.dust[num12].alpha = 100;
									Main.dust[num12].noGravity = true;
								}
								SoundEngine.PlaySound(19, (int)position.X, (int)position.Y);
							}
						}
						else
						{
							for (int num13 = 0; num13 < 10; num13++)
							{
								int num14 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 35);
								Main.dust[num14].velocity.Y -= 1.5f;
								Main.dust[num14].velocity.X *= 2.5f;
								Main.dust[num14].scale = 1.3f;
								Main.dust[num14].alpha = 100;
								Main.dust[num14].noGravity = true;
							}
							SoundEngine.PlaySound(19, (int)position.X, (int)position.Y);
						}
					}
				}
				if (!wet)
				{
					lavaWet = false;
					honeyWet = false;
					shimmerWet = false;
				}
				if (wetCount > 0)
				{
					wetCount--;
				}
			}
			if (shimmerWet)
			{
				Shimmer();
			}
			oldPosition = position;
			oldDirection = direction;
			HandleMovement(wetVelocity);
			if (AutomaticallyChangesDirection())
			{
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
			}
			if (!active)
			{
				return;
			}
			ProjLight();
			if (!npcProj && friendly && Main.player[owner].magicQuiver && extraUpdates < 1 && arrow)
			{
				extraUpdates = 1;
			}
			if (type == 2 || type == 82)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100);
			}
			else if (type == 172)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 135, 0f, 0f, 100);
			}
			else if (type == 103)
			{
				int num15 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 75, 0f, 0f, 100);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num15].noGravity = true;
					Main.dust[num15].scale *= 2f;
				}
			}
			else if (type == 278)
			{
				int num16 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 169, 0f, 0f, 100);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num16].noGravity = true;
					Main.dust[num16].scale *= 1.5f;
				}
			}
			else if (type == 4)
			{
				if (Main.rand.Next(5) == 0)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 14, 0f, 0f, 150, default(Color), 1.1f);
				}
			}
			else if (type == 5)
			{
				int num17 = Main.rand.Next(3);
				Dust.NewDust(position, width, height, num17 switch
				{
					0 => 15, 
					1 => 57, 
					_ => 58, 
				}, velocity.X * 0.5f, velocity.Y * 0.5f, 150, default(Color), 1.2f);
			}
			Damage();
			if (type == 434 && localAI[0] == 0f && numUpdates == 0)
			{
				extraUpdates = 1;
				velocity = Vector2.Zero;
				localAI[0] = 1f;
				localAI[1] = 0.9999f;
				netUpdate = true;
			}
			if (Main.netMode != 1 && (type == 99 || type == 1013 || type == 1047 || type == 655 || type == 727 || type == 1014 || type == 1021 || type == 1048 || type == 1053 || type == 1054 || type == 1055 || type == 1057))
			{
				Collision.SwitchTiles(position, width, height, oldPosition, 3);
			}
			if (ProjectileID.Sets.TrailingMode[type] == 0)
			{
				for (int num18 = oldPos.Length - 1; num18 > 0; num18--)
				{
					oldPos[num18] = oldPos[num18 - 1];
				}
				oldPos[0] = position;
			}
			else if (ProjectileID.Sets.TrailingMode[type] == 1)
			{
				if (frameCounter == 0 || oldPos[0] == Vector2.Zero)
				{
					for (int num19 = oldPos.Length - 1; num19 > 0; num19--)
					{
						oldPos[num19] = oldPos[num19 - 1];
					}
					oldPos[0] = position;
					if (velocity == Vector2.Zero && type == 466)
					{
						float num20 = rotation + (float)Math.PI / 2f + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * ((float)Math.PI / 2f);
						float num21 = (float)Main.rand.NextDouble() * 2f + 2f;
						Vector2 vector = new Vector2((float)Math.Cos(num20) * num21, (float)Math.Sin(num20) * num21);
						int num22 = Dust.NewDust(oldPos[oldPos.Length - 1], 0, 0, 229, vector.X, vector.Y);
						Main.dust[num22].noGravity = true;
						Main.dust[num22].scale = 1.7f;
					}
					if (velocity == Vector2.Zero && type == 580)
					{
						float num23 = rotation + (float)Math.PI / 2f + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * ((float)Math.PI / 2f);
						float num24 = (float)Main.rand.NextDouble() * 2f + 2f;
						Vector2 vector2 = new Vector2((float)Math.Cos(num23) * num24, (float)Math.Sin(num23) * num24);
						int num25 = Dust.NewDust(oldPos[oldPos.Length - 1], 0, 0, 229, vector2.X, vector2.Y);
						Main.dust[num25].noGravity = true;
						Main.dust[num25].scale = 1.7f;
					}
				}
			}
			else if (ProjectileID.Sets.TrailingMode[type] == 2)
			{
				for (int num26 = oldPos.Length - 1; num26 > 0; num26--)
				{
					oldPos[num26] = oldPos[num26 - 1];
					oldRot[num26] = oldRot[num26 - 1];
					oldSpriteDirection[num26] = oldSpriteDirection[num26 - 1];
				}
				oldPos[0] = position;
				oldRot[0] = rotation;
				oldSpriteDirection[0] = spriteDirection;
			}
			else if (ProjectileID.Sets.TrailingMode[type] == 3)
			{
				for (int num27 = oldPos.Length - 1; num27 > 0; num27--)
				{
					oldPos[num27] = oldPos[num27 - 1];
					oldRot[num27] = oldRot[num27 - 1];
					oldSpriteDirection[num27] = oldSpriteDirection[num27 - 1];
				}
				oldPos[0] = position;
				oldRot[0] = rotation;
				oldSpriteDirection[0] = spriteDirection;
				float amount = 0.65f;
				int num28 = 1;
				for (int num29 = 0; num29 < num28; num29++)
				{
					for (int num30 = oldPos.Length - 1; num30 > 0; num30--)
					{
						if (!(oldPos[num30] == Vector2.Zero))
						{
							if (oldPos[num30].Distance(oldPos[num30 - 1]) > 2f)
							{
								oldPos[num30] = Vector2.Lerp(oldPos[num30], oldPos[num30 - 1], amount);
							}
							oldRot[num30] = (oldPos[num30 - 1] - oldPos[num30]).SafeNormalize(Vector2.Zero).ToRotation();
						}
					}
				}
			}
			else if (ProjectileID.Sets.TrailingMode[type] == 4)
			{
				Vector2 vector3 = Main.player[owner].position - Main.player[owner].oldPosition;
				for (int num31 = oldPos.Length - 1; num31 > 0; num31--)
				{
					oldPos[num31] = oldPos[num31 - 1];
					oldRot[num31] = oldRot[num31 - 1];
					oldSpriteDirection[num31] = oldSpriteDirection[num31 - 1];
					if (numUpdates == 0 && oldPos[num31] != Vector2.Zero)
					{
						oldPos[num31] += vector3;
					}
				}
				oldPos[0] = position;
				oldRot[0] = rotation;
				oldSpriteDirection[0] = spriteDirection;
			}
			else if (ProjectileID.Sets.TrailingMode[type] == 5)
			{
				for (int num32 = oldPos.Length - 1; num32 > 0; num32--)
				{
					oldPos[num32] = oldPos[num32 - 1];
					oldRot[num32] = oldRot[num32 - 1];
					oldSpriteDirection[num32] = oldSpriteDirection[num32 - 1];
				}
				oldPos[0] = position;
				oldRot[0] = velocity.ToRotation();
				oldSpriteDirection[0] = spriteDirection;
			}
			if (ProjectileID.Sets.IsADD2Turret[type] && DD2Event.Ongoing)
			{
				timeLeft++;
			}
			timeLeft--;
			if (timeLeft <= 0)
			{
				Kill();
			}
			if (penetrate == 0)
			{
				Kill();
			}
			if (!active || owner != Main.myPlayer)
			{
				continue;
			}
			if (netUpdate2)
			{
				netUpdate = true;
			}
			if (!active)
			{
				netSpam = 0;
			}
			if (netUpdate)
			{
				if (netSpam < 60)
				{
					netSpam += 5;
					NetMessage.SendData(27, -1, -1, null, i);
					netUpdate2 = false;
				}
				else
				{
					netUpdate2 = true;
				}
			}
			if (netSpam > 0)
			{
				netSpam--;
			}
		}
		if (active && Main.netMode == 2)
		{
			RecheckSectionsForSkippedUpdates();
		}
		netUpdate = false;
	}

	private void RecheckSectionsForSkippedUpdates()
	{
		bool[] array = netSyncSkippedForPlayer;
		for (int i = 0; i < array.Length; i++)
		{
			if (array[i] && Main.player[i].active && Netplay.Clients[i].IsSectionActive(NetSectionCoordinates))
			{
				NetMessage.SendData(27, i, -1, null, whoAmI);
			}
		}
	}

	public void DecrementLocalImmuneTimeCounters()
	{
		for (int i = 0; i < 255; i++)
		{
			if (playerImmune[i] > 0)
			{
				playerImmune[i]--;
			}
		}
		if (!usesLocalNPCImmunity)
		{
			return;
		}
		for (int j = 0; j < Main.maxNPCs; j++)
		{
			if (localNPCImmunity[j] > 0)
			{
				localNPCImmunity[j]--;
			}
		}
	}

	private bool AutomaticallyChangesDirection()
	{
		if ((aiStyle != 3 || ai[0] != 1f) && (aiStyle != 7 || ai[0] != 1f) && (aiStyle != 13 || ai[0] != 1f) && aiStyle != 65 && aiStyle != 69 && aiStyle != 114 && aiStyle != 123 && aiStyle != 112 && !manualDirectionChange && aiStyle != 67 && aiStyle != 26 && aiStyle != 15)
		{
			return aiStyle != 150;
		}
		return false;
	}

	private void UpdateEnchantmentVisuals()
	{
		if (npcProj)
		{
			return;
		}
		Vector2 boxPosition = position;
		int boxWidth = width;
		int boxHeight = height;
		if (aiStyle == 190 || aiStyle == 191)
		{
			for (float num = -(float)Math.PI / 4f; num <= (float)Math.PI / 4f; num += (float)Math.PI / 2f)
			{
				Rectangle r = Utils.CenteredRectangle(base.Center + (rotation + num).ToRotationVector2() * 70f * scale, new Vector2(60f * scale, 60f * scale));
				EmitEnchantmentVisualsAt(r.TopLeft(), r.Width, r.Height);
			}
		}
		else if (ProjectileID.Sets.IsAWhip[type])
		{
			WhipPointsForCollision.Clear();
			FillWhipControlPoints(this, WhipPointsForCollision);
			Vector2 vector = WhipPointsForCollision[WhipPointsForCollision.Count - 1];
			EmitEnchantmentVisualsAt(new Vector2(vector.X - (float)(width / 2), vector.Y - (float)(height / 2)), width, height);
		}
		else
		{
			EmitEnchantmentVisualsAt(boxPosition, boxWidth, boxHeight);
		}
	}

	public void EmitEnchantmentVisualsAt(Vector2 boxPosition, int boxWidth, int boxHeight)
	{
		Player player = Main.player[owner];
		if (player.frostBurn && (melee || ranged) && friendly && !hostile && !noEnchantments && Main.rand.Next(2 * (1 + extraUpdates)) == 0)
		{
			int num = Dust.NewDust(boxPosition, boxWidth, boxHeight, 135, velocity.X * 0.2f + (float)(direction * 3), velocity.Y * 0.2f, 100, default(Color), 2f);
			Main.dust[num].noGravity = true;
			Main.dust[num].velocity *= 0.7f;
			Main.dust[num].velocity.Y -= 0.5f;
		}
		if (melee && player.magmaStone && !noEnchantments && Main.rand.Next(3) != 0)
		{
			int num2 = Dust.NewDust(new Vector2(boxPosition.X - 4f, boxPosition.Y - 4f), boxWidth + 8, boxHeight + 8, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
			if (Main.rand.Next(2) == 0)
			{
				Main.dust[num2].scale = 1.5f;
			}
			Main.dust[num2].noGravity = true;
			Main.dust[num2].velocity.X *= 2f;
			Main.dust[num2].velocity.Y *= 2f;
		}
		if (player.mount.Active && (player.mount.Type == 62 || player.mount.Type == 63) && (melee || ranged) && friendly && !hostile && !noEnchantments)
		{
			Vector3 vector = ((player.mount.Type == 63) ? new Vector3(0.6f, 0.3f, 0.1f) : new Vector3(0.5f, 0.1f, 0.6f));
			Lighting.AddLight(boxPosition + new Vector2((float)boxWidth / 2f, (float)boxHeight / 2f), vector * 0.5f);
			if (Main.rand.Next(5) == 0)
			{
				int num3 = Dust.NewDust(new Vector2(boxPosition.X - 4f, boxPosition.Y - 4f), boxWidth + 8, boxHeight + 8, 306, velocity.X * 0.2f, velocity.Y * 0.2f, 100);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num3].scale = 1.2f;
				}
				Main.dust[num3].noGravity = true;
				Main.dust[num3].velocity.X *= 0.2f;
				Main.dust[num3].velocity.Y *= 0.2f;
				float num4 = Main.rand.NextFloat();
				Main.dust[num3].color = Color.Lerp(new Color(0.9f, 0.7f, 1f), Color.White, num4 * num4 * num4);
				if (player.mount.Type == 63)
				{
					Main.dust[num3].color = Color.Lerp(new Color(1f, 0.7f, 0.5f), Color.White, num4 * num4 * num4);
				}
			}
		}
		if ((!melee && !ProjectileID.Sets.IsAWhip[type]) || player.meleeEnchant <= 0 || noEnchantments)
		{
			return;
		}
		if (player.meleeEnchant == 1 && Main.rand.Next(3) == 0)
		{
			int num5 = Dust.NewDust(boxPosition, boxWidth, boxHeight, 171, 0f, 0f, 100);
			Main.dust[num5].noGravity = true;
			Main.dust[num5].fadeIn = 1.5f;
			Main.dust[num5].velocity *= 0.25f;
		}
		if (player.meleeEnchant == 1)
		{
			if (Main.rand.Next(3) == 0)
			{
				int num6 = Dust.NewDust(boxPosition, boxWidth, boxHeight, 171, 0f, 0f, 100);
				Main.dust[num6].noGravity = true;
				Main.dust[num6].fadeIn = 1.5f;
				Main.dust[num6].velocity *= 0.25f;
			}
		}
		else if (player.meleeEnchant == 2)
		{
			if (Main.rand.Next(2) == 0)
			{
				int num7 = Dust.NewDust(boxPosition, boxWidth, boxHeight, 75, velocity.X * 0.2f + (float)(direction * 3), velocity.Y * 0.2f, 100, default(Color), 2.5f);
				Main.dust[num7].noGravity = true;
				Main.dust[num7].velocity *= 0.7f;
				Main.dust[num7].velocity.Y -= 0.5f;
			}
		}
		else if (player.meleeEnchant == 3)
		{
			if (Main.rand.Next(2) == 0)
			{
				int num8 = Dust.NewDust(boxPosition, boxWidth, boxHeight, 6, velocity.X * 0.2f + (float)(direction * 3), velocity.Y * 0.2f, 100, default(Color), 2.5f);
				Main.dust[num8].noGravity = true;
				Main.dust[num8].velocity *= 0.7f;
				Main.dust[num8].velocity.Y -= 0.5f;
			}
		}
		else if (player.meleeEnchant == 4)
		{
			int num9 = 0;
			if (Main.rand.Next(2) == 0)
			{
				num9 = Dust.NewDust(boxPosition, boxWidth, boxHeight, 57, velocity.X * 0.2f + (float)(direction * 3), velocity.Y * 0.2f, 100, default(Color), 1.1f);
				Main.dust[num9].noGravity = true;
				Main.dust[num9].velocity.X /= 2f;
				Main.dust[num9].velocity.Y /= 2f;
			}
		}
		else if (player.meleeEnchant == 5)
		{
			if (Main.rand.Next(2) == 0)
			{
				int num10 = Dust.NewDust(boxPosition, boxWidth, boxHeight, 169, 0f, 0f, 100);
				Main.dust[num10].velocity.X += direction;
				Main.dust[num10].velocity.Y += 0.2f;
				Main.dust[num10].noGravity = true;
			}
		}
		else if (player.meleeEnchant == 6)
		{
			if (Main.rand.Next(2) == 0)
			{
				int num11 = Dust.NewDust(boxPosition, boxWidth, boxHeight, 135, 0f, 0f, 100);
				Main.dust[num11].velocity.X += direction;
				Main.dust[num11].velocity.Y += 0.2f;
				Main.dust[num11].noGravity = true;
			}
		}
		else if (player.meleeEnchant == 7)
		{
			Vector2 vector2 = velocity;
			if (vector2.Length() > 4f)
			{
				vector2 *= 4f / vector2.Length();
			}
			if (Main.rand.Next(20) == 0)
			{
				int num12 = Main.rand.Next(139, 143);
				int num13 = Dust.NewDust(boxPosition, boxWidth, boxHeight, num12, vector2.X, vector2.Y, 0, default(Color), 1.2f);
				Main.dust[num13].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.dust[num13].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.dust[num13].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
				Main.dust[num13].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.05f;
				Main.dust[num13].scale *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
			}
			if (Main.rand.Next(40) == 0)
			{
				int num14 = Main.rand.Next(276, 283);
				int num15 = Gore.NewGore(position, vector2, num14);
				Main.gore[num15].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.gore[num15].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.gore[num15].scale *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
				Main.gore[num15].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
				Main.gore[num15].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.05f;
			}
		}
		else if (player.meleeEnchant == 8 && Main.rand.Next(4) == 0)
		{
			int num16 = Dust.NewDust(boxPosition, boxWidth, boxHeight, 46, 0f, 0f, 100);
			Main.dust[num16].noGravity = true;
			Main.dust[num16].fadeIn = 1.5f;
			Main.dust[num16].velocity *= 0.25f;
		}
	}

	public void HandleMovement(Vector2 wetVelocity)
	{
		bool flag = false;
		bool flag2 = false;
		bool? flag3 = ProjectileID.Sets.ForcePlateDetection[type];
		bool flag4 = flag3.HasValue && !flag3.Value;
		bool flag5 = flag3.HasValue && flag3.Value;
		if (tileCollide)
		{
			bool flag6 = true;
			bool ignoreDoors = Main.projPet[type];
			if (Main.projPet[type])
			{
				flag6 = false;
				if (Main.player[owner].position.Y + (float)Main.player[owner].height - 12f > position.Y + (float)height)
				{
					flag6 = true;
				}
			}
			if (type == 500)
			{
				flag6 = false;
				if (Main.player[owner].Bottom.Y > base.Bottom.Y + 4f)
				{
					flag6 = true;
				}
			}
			if (type == 653 || type == 1018)
			{
				flag6 = false;
				if (Main.player[owner].Bottom.Y > base.Bottom.Y + 4f)
				{
					flag6 = true;
				}
			}
			if (type == 378)
			{
				flag6 = false;
			}
			if (aiStyle == 62)
			{
				flag6 = true;
			}
			if (aiStyle == 66)
			{
				flag6 = true;
			}
			if (type == 317)
			{
				flag6 = true;
			}
			if (type == 373)
			{
				flag6 = true;
			}
			if (type == 281)
			{
				flag6 = false;
			}
			if (type == 253)
			{
				flag6 = false;
			}
			if (aiStyle == 53)
			{
				flag6 = false;
			}
			if (aiStyle == 197)
			{
				flag6 = true;
			}
			if (type == 9 || type == 1037 || type == 1049 || type == 12 || type == 15 || type == 13)
			{
				flag6 = false;
			}
			if (aiStyle == 10 && ProjectileID.Sets.FallingBlockDoesNotFallThroughPlatforms[type])
			{
				flag6 = false;
			}
			if (type == 24)
			{
				flag6 = false;
			}
			if (aiStyle == 99 && ai[0] == -2f)
			{
				flag6 = false;
			}
			switch (type)
			{
			case 663:
			case 665:
			case 667:
			case 677:
			case 678:
			case 679:
			case 688:
			case 689:
			case 690:
			case 691:
			case 692:
			case 693:
			case 1105:
				flag6 = false;
				break;
			case 759:
				flag6 = true;
				break;
			case 1020:
			{
				float num = MathHelper.WrapAngle(rotation);
				flag6 = num >= (float)Math.PI / 2f || num < -(float)Math.PI / 2f;
				break;
			}
			}
			if (decidesManualFallThrough)
			{
				flag6 = shouldFallThrough;
			}
			Vector2 lastVelocity = velocity;
			GetCollisionParams(out var resizeAnchor, out var colWidth, out var colHeight);
			Vector2 vector = base.Center - new Vector2(colWidth, colHeight) * resizeAnchor;
			if (((type != 440 && type != 449 && type != 606) || ai[1] != 1f) && (type != 466 || localAI[1] != 1f) && (type != 580 || !(localAI[1] > 0f)) && (type != 640 || !(localAI[1] > 0f)))
			{
				if (aiStyle == 10)
				{
					if (type >= 736 && type <= 738)
					{
						velocity = Collision.TileCollision(position, velocity, width, height, flag6, flag6);
					}
					else if (type == 411 || type == 412 || type == 413 || type == 414)
					{
						velocity = Collision.TileCollision(position, velocity, width, height, flag6, flag6);
						velocity = Collision.AnyCollisionWithSpecificTiles(position, velocity, width, height, TileID.Sets.Falling, evenActuated: true);
					}
					else if (type == 42 || type == 65 || type == 68 || type == 354 || (type == 31 && ai[0] == 2f))
					{
						velocity = Collision.TileCollision(position, velocity, width, height, flag6, flag6);
					}
					else
					{
						velocity = Collision.TileCollision(position, velocity, width, height, flag6, flag6);
					}
				}
				else if (wet)
				{
					if (shimmerWet)
					{
						Vector2 vector2 = velocity;
						velocity = Collision.TileCollision(vector, velocity, colWidth, colHeight, flag6, flag6, 1, ignoreDoors);
						wetVelocity = velocity * 0.375f;
						if (velocity.X != vector2.X)
						{
							wetVelocity.X = velocity.X;
						}
						if (velocity.Y != vector2.Y)
						{
							wetVelocity.Y = velocity.Y;
						}
					}
					else if (honeyWet)
					{
						Vector2 vector3 = velocity;
						velocity = Collision.TileCollision(vector, velocity, colWidth, colHeight, flag6, flag6, 1, ignoreDoors);
						wetVelocity = velocity * 0.25f;
						if (velocity.X != vector3.X)
						{
							wetVelocity.X = velocity.X;
						}
						if (velocity.Y != vector3.Y)
						{
							wetVelocity.Y = velocity.Y;
						}
					}
					else
					{
						Vector2 vector4 = velocity;
						velocity = Collision.TileCollision(vector, velocity, colWidth, colHeight, flag6, flag6, 1, ignoreDoors);
						wetVelocity = velocity * 0.5f;
						if (velocity.X != vector4.X)
						{
							wetVelocity.X = velocity.X;
						}
						if (velocity.Y != vector4.Y)
						{
							wetVelocity.Y = velocity.Y;
						}
					}
					if (!correctSlopeCollision)
					{
						Vector4 vector5 = Collision.SlopeCollision(vector, velocity, colWidth, colHeight, 0f, fall: true);
						Vector2 vector6 = position - vector;
						if (aiStyle == 137)
						{
							if (vector.Y != vector5.Y)
							{
								flag = true;
							}
							if (velocity.Y != vector5.W)
							{
								flag = true;
							}
							vector.Y = vector5.Y;
							position.Y = vector.Y + vector6.Y;
							velocity.Y = vector5.W;
						}
						else
						{
							if (vector.X != vector5.X)
							{
								flag = true;
							}
							if (vector.Y != vector5.Y)
							{
								flag = true;
							}
							if (velocity.X != vector5.Z)
							{
								flag = true;
							}
							if (velocity.Y != vector5.W)
							{
								flag = true;
							}
							vector.X = vector5.X;
							vector.Y = vector5.Y;
							position = vector + vector6;
							velocity.X = vector5.Z;
							velocity.Y = vector5.W;
						}
					}
				}
				else
				{
					int num2 = Math.Min(colWidth, colHeight);
					if (num2 < 3)
					{
						num2 = 3;
					}
					if (num2 > 16)
					{
						num2 = 16;
					}
					if (velocity.Length() > (float)num2)
					{
						bool hoik = true;
						Vector2 vector7 = Collision.TileCollision(vector, velocity, colWidth, colHeight, flag6, flag6, 1, ignoreDoors);
						float num3 = velocity.Length();
						float num4 = num2;
						Vector2 vector8 = velocity.SafeNormalize(Vector2.Zero);
						if (vector7.Y == 0f)
						{
							vector8.Y = 0f;
						}
						Vector2 zero = Vector2.Zero;
						_ = Vector2.Zero;
						_ = Vector2.Zero;
						Vector2 vector9 = vector;
						int num5 = 0;
						while (num3 > 0f)
						{
							num5++;
							if (num5 > 300)
							{
								break;
							}
							vector9 = vector;
							float num6 = num3;
							if (num6 > num4)
							{
								num6 = num4;
							}
							num3 -= num6;
							Vector2 vector10 = vector8 * num6;
							Vector2 vector11 = Collision.TileCollision(vector, vector10, colWidth, colHeight, flag6, flag6, 1, ignoreDoors, ignoreAetheriumPlatforms: false, hoik);
							vector += vector11;
							velocity = vector11;
							if (!correctSlopeCollision)
							{
								Vector4 vector12 = Collision.SlopeCollision(vector, velocity, colWidth, colHeight, 0f, fall: true);
								Vector2 vector13 = position - vector;
								if (aiStyle == 137)
								{
									if (vector.Y != vector12.Y)
									{
										flag = true;
									}
									if (velocity.Y != vector12.W)
									{
										flag = true;
									}
									vector.Y = vector12.Y;
									position.Y = vector.Y + vector13.Y;
									velocity.Y = vector12.W;
								}
								else
								{
									if (vector.X != vector12.X)
									{
										flag = true;
									}
									if (vector.Y != vector12.Y)
									{
										flag = true;
									}
									if (velocity.X != vector12.Z)
									{
										flag = true;
									}
									if (velocity.Y != vector12.W)
									{
										flag = true;
									}
									vector.X = vector12.X;
									vector.Y = vector12.Y;
									position = vector + vector13;
									velocity.X = vector12.Z;
									velocity.Y = vector12.W;
								}
							}
							flag2 = true;
							if (owner == Main.myPlayer && vector != vector9 && !flag4)
							{
								Collision.SwitchTiles(vector, colWidth, colHeight, vector9, 4);
							}
							vector11 = velocity;
							zero += vector11;
						}
						velocity = zero;
						if (Math.Abs(velocity.X - lastVelocity.X) < 0.0001f)
						{
							velocity.X = lastVelocity.X;
						}
						if (Math.Abs(velocity.Y - lastVelocity.Y) < 0.0001f)
						{
							velocity.Y = lastVelocity.Y;
						}
						if (!correctSlopeCollision)
						{
							Vector4 vector14 = Collision.SlopeCollision(vector, velocity, colWidth, colHeight, 0f, fall: true);
							Vector2 vector15 = position - vector;
							if (aiStyle == 137)
							{
								if (vector.Y != vector14.Y)
								{
									flag = true;
								}
								if (velocity.Y != vector14.W)
								{
									flag = true;
								}
								vector.Y = vector14.Y;
								position.Y = vector.Y + vector15.Y;
								velocity.Y = vector14.W;
							}
							else
							{
								if (vector.X != vector14.X)
								{
									flag = true;
								}
								if (vector.Y != vector14.Y)
								{
									flag = true;
								}
								if (velocity.X != vector14.Z)
								{
									flag = true;
								}
								if (velocity.Y != vector14.W)
								{
									flag = true;
								}
								vector.X = vector14.X;
								vector.Y = vector14.Y;
								position = vector + vector15;
								velocity.X = vector14.Z;
								velocity.Y = vector14.W;
							}
						}
					}
					else
					{
						velocity = Collision.TileCollision(vector, velocity, colWidth, colHeight, flag6, flag6, 1, ignoreDoors);
						if (!correctSlopeCollision)
						{
							Vector4 vector16 = Collision.SlopeCollision(vector, velocity, colWidth, colHeight, 0f, fall: true);
							Vector2 vector17 = position - vector;
							if (aiStyle == 137)
							{
								if (vector.Y != vector16.Y)
								{
									flag = true;
								}
								if (velocity.Y != vector16.W)
								{
									flag = true;
								}
								vector.Y = vector16.Y;
								position.Y = vector.Y + vector17.Y;
								velocity.Y = vector16.W;
							}
							else
							{
								if (vector.X != vector16.X)
								{
									flag = true;
								}
								if (vector.Y != vector16.Y)
								{
									flag = true;
								}
								if (velocity.X != vector16.Z)
								{
									flag = true;
								}
								if (velocity.Y != vector16.W)
								{
									flag = true;
								}
								vector.X = vector16.X;
								vector.Y = vector16.Y;
								position = vector + vector17;
								velocity.X = vector16.Z;
								velocity.Y = vector16.W;
							}
						}
					}
				}
			}
			if (lastVelocity != velocity)
			{
				flag = true;
			}
			if (aiStyle == 3 && (position.X <= Main.leftWorld || position.X + (float)width >= Main.rightWorld || position.Y <= Main.topWorld || position.Y + (float)height >= Main.bottomWorld))
			{
				flag = true;
			}
			if (flag)
			{
				if (ProjectileID.Sets.BreaksFromToyBreaker[type] && Collision.AnyCollisionWithSpecificTiles(vector, lastVelocity, colWidth, colHeight, TileID.Sets.BreaksToys, evenActuated: true) != lastVelocity)
				{
					Kill();
				}
				if (owner == Main.myPlayer && CanCutTiles() && (friendly || hostile) && damage > 0)
				{
					int num7 = (int)(position.X + velocity.X - 1f) / 16;
					int num8 = (int)((position.X + (float)width + velocity.X + 1f) / 16f) + 1;
					int num9 = (int)(position.Y + velocity.Y - 1f) / 16;
					int num10 = (int)((position.Y + (float)height + velocity.Y + 1f) / 16f) + 1;
					if (num7 < 0)
					{
						num7 = 0;
					}
					if (num8 > Main.maxTilesX)
					{
						num8 = Main.maxTilesX;
					}
					if (num9 < 0)
					{
						num9 = 0;
					}
					if (num10 > Main.maxTilesY)
					{
						num10 = Main.maxTilesY;
					}
					bool[] tileCutIgnorance = Main.player[owner].GetTileCutIgnorance(allowRegrowth: false, trap);
					for (int i = num7; i < num8; i++)
					{
						for (int j = num9; j < num10; j++)
						{
							if (Main.tile[i, j] != null && !tileCutIgnorance[Main.tile[i, j].type] && Main.tile[i, j].type == 484 && WorldGen.CanCutTile(i, j, TileCuttingContext.AttackProjectile))
							{
								WorldGen.KillTile(i, j);
								if (Main.netMode != 0)
								{
									NetMessage.SendData(17, -1, -1, null, 0, i, j);
								}
							}
						}
					}
				}
				if (Main.rand.Next(3) == 0 && owner == Main.myPlayer && CanCutTiles() && (friendly || hostile) && damage > 0)
				{
					int num11 = (int)(position.X + velocity.X - 1f) / 16;
					int num12 = (int)((position.X + (float)width + velocity.X + 1f) / 16f) + 1;
					int num13 = (int)(position.Y + velocity.Y - 1f) / 16;
					int num14 = (int)((position.Y + (float)height + velocity.Y + 1f) / 16f) + 1;
					if (num11 < 0)
					{
						num11 = 0;
					}
					if (num12 > Main.maxTilesX)
					{
						num12 = Main.maxTilesX;
					}
					if (num13 < 0)
					{
						num13 = 0;
					}
					if (num14 > Main.maxTilesY)
					{
						num14 = Main.maxTilesY;
					}
					bool[] tileCutIgnorance2 = Main.player[owner].GetTileCutIgnorance(allowRegrowth: false, trap);
					for (int k = num11; k < num12; k++)
					{
						for (int l = num13; l < num14; l++)
						{
							if (Main.tile[k, l] != null && !tileCutIgnorance2[Main.tile[k, l].type] && TileID.Sets.CrackedBricks[Main.tile[k, l].type] && WorldGen.CanCutTile(k, l, TileCuttingContext.AttackProjectile))
							{
								WorldGen.KillTile(k, l);
								if (Main.netMode != 0)
								{
									NetMessage.SendData(17, -1, -1, null, 0, k, l);
								}
							}
						}
					}
				}
				if (type == 663 || type == 665 || type == 667 || type == 677 || type == 678 || type == 679 || type == 691 || type == 692 || type == 693 || type == 688 || type == 689 || type == 690)
				{
					position += velocity;
					velocity = Vector2.Zero;
				}
				else if (type == 434)
				{
					position += velocity;
					numUpdates = 0;
				}
				else if (type == 1020)
				{
					if (velocity.X != lastVelocity.X && Math.Abs(lastVelocity.X) > 1f)
					{
						velocity.X = (0f - lastVelocity.X) * 0.25f;
					}
					if (velocity.Y != lastVelocity.Y && Math.Abs(lastVelocity.Y) > 1f)
					{
						velocity.Y = (0f - lastVelocity.Y) * 0.25f;
					}
				}
				else if (type == 601)
				{
					if (Main.netMode != 2 && alpha > 0)
					{
						if (ai[1] != 0f)
						{
							SoundEngine.PlaySound(SoundID.Item114, position);
						}
						else
						{
							SoundEngine.PlaySound(SoundID.Item115, position);
						}
					}
					if (owner == Main.myPlayer)
					{
						PortalHelper.TryPlacingPortal(this, lastVelocity, velocity);
					}
					position += velocity;
					Kill();
				}
				else if (type == 985)
				{
					position += velocity;
					velocity = lastVelocity;
					velocity *= 0.01f;
					localAI[1] = 1f;
				}
				else if (type == 451)
				{
					ai[0] = 1f;
					ai[1] = 0f;
					netUpdate = true;
					velocity = lastVelocity / 2f;
				}
				else if (type == 645)
				{
					ai[0] = 0f;
					ai[1] = -1f;
					netUpdate = true;
				}
				else if (type == 584)
				{
					bool flag7 = false;
					if (velocity.X != lastVelocity.X)
					{
						velocity.X = lastVelocity.X * -0.75f;
						flag7 = true;
					}
					if ((velocity.Y != lastVelocity.Y && lastVelocity.Y > 2f) || velocity.Y == 0f)
					{
						velocity.Y = lastVelocity.Y * -0.75f;
						flag7 = true;
					}
					if (flag7)
					{
						float num15 = lastVelocity.Length() / velocity.Length();
						if (num15 == 0f)
						{
							num15 = 1f;
						}
						velocity /= num15;
						penetrate--;
					}
				}
				else if (type == 532)
				{
					bool flag8 = false;
					if (velocity.X != lastVelocity.X)
					{
						velocity.X = lastVelocity.X * -0.75f;
						flag8 = true;
					}
					if ((velocity.Y != lastVelocity.Y && lastVelocity.Y > 2f) || velocity.Y == 0f)
					{
						velocity.Y = lastVelocity.Y * -0.75f;
						flag8 = true;
					}
					if (flag8)
					{
						float num16 = lastVelocity.Length() / velocity.Length();
						if (num16 == 0f)
						{
							num16 = 1f;
						}
						velocity /= num16;
						penetrate--;
						Collision.HitTiles(position, lastVelocity, width, height);
					}
				}
				else if (type == 533)
				{
					float num17 = 1f;
					bool flag9 = false;
					if (velocity.X != lastVelocity.X)
					{
						velocity.X = lastVelocity.X * (0f - num17);
						flag9 = true;
					}
					if (velocity.Y != lastVelocity.Y || velocity.Y == 0f)
					{
						velocity.Y = lastVelocity.Y * (0f - num17) * 0.5f;
						flag9 = true;
					}
					if (flag9)
					{
						float num18 = lastVelocity.Length() / velocity.Length();
						if (num18 == 0f)
						{
							num18 = 1f;
						}
						velocity /= num18;
						if (ai[0] == 7f && (double)velocity.Y < -0.1)
						{
							velocity.Y += 0.1f;
						}
						if (ai[0] >= 6f && ai[0] < 9f)
						{
							Collision.HitTiles(position, lastVelocity, width, height);
						}
						localAI[2] += 30f;
					}
				}
				else if (type == 502)
				{
					ai[0] += 1f;
					SoundEngine.PlaySound(37, (int)position.X, (int)position.Y, 5 + (int)ai[0]);
					if (ai[0] >= 5f)
					{
						position += velocity;
						Kill();
					}
					else
					{
						if (velocity.Y != lastVelocity.Y)
						{
							velocity.Y = 0f - lastVelocity.Y;
						}
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = 0f - lastVelocity.X;
						}
					}
					Vector2 spinningpoint = new Vector2(0f, -3f - ai[0]).RotatedByRandom(3.1415927410125732);
					float num19 = 10f + ai[0] * 4f;
					Vector2 vector18 = new Vector2(1.05f, 1f);
					for (float num20 = 0f; num20 < num19; num20 += 1f)
					{
						int num21 = Dust.NewDust(base.Center, 0, 0, 66, 0f, 0f, 0, Color.Transparent);
						Main.dust[num21].position = base.Center;
						Main.dust[num21].velocity = spinningpoint.RotatedBy((float)Math.PI * 2f * num20 / num19) * vector18 * (0.8f + Main.rand.NextFloat() * 0.4f);
						Main.dust[num21].color = Main.hslToRgb(num20 / num19, 1f, 0.5f);
						Main.dust[num21].noGravity = true;
						Main.dust[num21].scale = 1f + ai[0] / 3f;
					}
					if (Main.myPlayer == owner)
					{
						int num22 = width;
						int num23 = height;
						int num24 = penetrate;
						position = base.Center;
						width = (height = 40 + 8 * (int)ai[0]);
						base.Center = position;
						penetrate = -1;
						Damage();
						penetrate = num24;
						position = base.Center;
						width = num22;
						height = num23;
						base.Center = position;
					}
				}
				else if (type == 444)
				{
					if (velocity.X != lastVelocity.X)
					{
						velocity.X = 0f - lastVelocity.X;
					}
					if (velocity.Y != lastVelocity.Y)
					{
						velocity.Y = 0f - lastVelocity.Y;
					}
					ai[0] = velocity.ToRotation();
				}
				else if (type == 617)
				{
					if (velocity.X != lastVelocity.X)
					{
						velocity.X = (0f - lastVelocity.X) * 0.35f;
					}
					if (velocity.Y != lastVelocity.Y)
					{
						velocity.Y = (0f - lastVelocity.Y) * 0.35f;
					}
				}
				else if (type == 440 || type == 449 || type == 606)
				{
					if (ai[1] != 1f)
					{
						ai[1] = 1f;
						position += velocity;
						velocity = lastVelocity;
					}
				}
				else if (type == 1024)
				{
					if (ai[0] == 0f)
					{
						Collision.HitTiles(position, lastVelocity, width, height);
						SoundEngine.PlaySound(SoundID.Item10, position);
						position += velocity;
					}
					if (ai[0] < 2f)
					{
						ai[0] = 1f;
						ai[1] = -1f;
						velocity = lastVelocity.SafeNormalize(Vector2.Zero);
						netUpdate = true;
					}
				}
				else if (type == 85 || type == 1106)
				{
					velocity = lastVelocity * 0.95f;
					position -= velocity;
				}
				else if (type == 466 || type == 580 || type == 640)
				{
					if (localAI[1] < 1f)
					{
						localAI[1] += 2f;
						position += velocity;
						velocity = Vector2.Zero;
					}
				}
				else if (type == 405)
				{
					localAI[0] += 1f;
					if (localAI[0] < 2f)
					{
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = 0f - lastVelocity.X;
						}
						if (velocity.Y != lastVelocity.Y)
						{
							velocity.Y = 0f - lastVelocity.Y;
						}
					}
					else
					{
						Kill();
					}
				}
				else if (type == 851)
				{
					if (velocity.X != lastVelocity.X)
					{
						velocity.X = (0f - lastVelocity.X) * 0.8f;
					}
					if (velocity.Y != lastVelocity.Y)
					{
						velocity.Y = (0f - lastVelocity.Y) * 0.5f;
					}
				}
				else if (type == 855)
				{
					if (velocity.X != lastVelocity.X)
					{
						velocity.X = 0f - lastVelocity.X;
					}
					if (velocity.Y != lastVelocity.Y)
					{
						velocity.Y = 0f - lastVelocity.Y;
						if (lastVelocity.Y < 0f)
						{
							velocity.Y *= 0.25f;
						}
					}
				}
				else if (aiStyle == 54)
				{
					if (velocity.X != lastVelocity.X)
					{
						velocity.X = lastVelocity.X * -0.6f;
					}
					if (velocity.Y != lastVelocity.Y)
					{
						velocity.Y = lastVelocity.Y * -0.6f;
					}
				}
				else if (type == 861)
				{
					float num25 = -1f;
					if (ai[1] == 1f)
					{
						num25 = -0.6f;
					}
					if (velocity.X != lastVelocity.X)
					{
						velocity.X = lastVelocity.X * num25;
					}
					if (velocity.Y != lastVelocity.Y && (double)lastVelocity.Y > 0.7)
					{
						velocity.Y = lastVelocity.Y * num25;
					}
					if (Math.Abs(velocity.Y) < 0.5f)
					{
						velocity.Y = 0f;
					}
					if (ai[1] != 1f)
					{
						netUpdate = true;
					}
					ai[1] = 1f;
				}
				else if (!correctSlopeCollision && type != 1036 && type != 500 && type != 820 && aiStyle != 160 && type != 650 && type != 882 && type != 888 && type != 894 && type != 895 && type != 898 && type != 901 && type != 957)
				{
					if (aiStyle == 99)
					{
						if (ai[0] == -2f)
						{
							if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 4f)
							{
								velocity.Y = (0f - lastVelocity.Y) * 0.6f;
							}
							if (velocity.X != lastVelocity.X)
							{
								Collision.HitTiles(position, velocity, width, height);
								SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
								Kill();
							}
						}
						else if ((type >= 556 && type <= 561) || type == 1079)
						{
							bool flag10 = false;
							if (velocity.X != lastVelocity.X)
							{
								flag10 = true;
								velocity.X = lastVelocity.X * -1f;
							}
							if (velocity.Y != lastVelocity.Y)
							{
								flag10 = true;
								velocity.Y = lastVelocity.Y * -1f;
							}
							if (flag10)
							{
								Vector2 v = Main.player[owner].Center - base.Center;
								v = v.SafeNormalize(Vector2.UnitY);
								v *= velocity.Length();
								v *= 0.25f;
								velocity *= 0.75f;
								velocity += v;
								if (velocity.Length() > 6f)
								{
									velocity *= 0.5f;
								}
							}
						}
					}
					else if (type == 604)
					{
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = 0f - lastVelocity.X;
						}
						if (velocity.Y != lastVelocity.Y)
						{
							velocity.Y = 0f - lastVelocity.Y;
						}
					}
					else if (type == 379)
					{
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = lastVelocity.X * -0.6f;
						}
						if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 2f)
						{
							velocity.Y = lastVelocity.Y * -0.6f;
						}
					}
					else if (type == 491)
					{
						if (ai[0] <= 0f)
						{
							ai[0] = -10f;
						}
						if (velocity.X != lastVelocity.X && Math.Abs(lastVelocity.X) > 0f)
						{
							velocity.X = lastVelocity.X * -1f;
						}
						if (velocity.Y != lastVelocity.Y && Math.Abs(lastVelocity.Y) > 0f)
						{
							velocity.Y = lastVelocity.Y * -1f;
						}
					}
					else if ((type >= 515 && type <= 517) || type == 637)
					{
						if (velocity.X != lastVelocity.X && Math.Abs(lastVelocity.X) > 1f)
						{
							velocity.X = lastVelocity.X * -0.9f;
						}
						if (velocity.Y != lastVelocity.Y && Math.Abs(lastVelocity.Y) > 1f)
						{
							velocity.Y = lastVelocity.Y * -0.9f;
						}
					}
					else if (type == 921 || type == 926 || type == 937)
					{
						if (velocity.X != lastVelocity.X && Math.Abs(lastVelocity.X) > 1f)
						{
							velocity.X = lastVelocity.X * -0.4f;
						}
						if (velocity.Y != lastVelocity.Y && Math.Abs(lastVelocity.Y) > 1f)
						{
							velocity.Y = lastVelocity.Y * -0.95f;
						}
						penetrate--;
					}
					else if (type == 969)
					{
						if (velocity.X != lastVelocity.X && Math.Abs(lastVelocity.X) > 1f)
						{
							velocity.X = lastVelocity.X * -0.75f;
						}
						if (velocity.Y != lastVelocity.Y && Math.Abs(lastVelocity.Y) > 1f)
						{
							velocity.Y = lastVelocity.Y * -0.75f;
						}
					}
					else if (type == 681)
					{
						timeLeft = 4;
					}
					else if (type == 409)
					{
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = lastVelocity.X * -1f;
						}
						if (velocity.Y != lastVelocity.Y)
						{
							velocity.Y = lastVelocity.Y * -1f;
						}
					}
					else if (type == 254)
					{
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = lastVelocity.X * -1f;
						}
						if (velocity.Y != lastVelocity.Y)
						{
							velocity.Y = lastVelocity.Y * -1f;
						}
					}
					else if (type == 225)
					{
						ai[1] += 1f;
						if (ai[1] == 1f)
						{
							damage = (int)((float)damage * 0.66f);
						}
						if (ai[1] >= 4f)
						{
							Kill();
							return;
						}
						velocity.X = 0f - lastVelocity.X;
						velocity.Y = 0f - lastVelocity.Y;
						int num26 = FindTargetWithLineOfSight();
						if (num26 != -1)
						{
							NPC nPC = Main.npc[num26];
							float t = Distance(nPC.Center);
							Vector2 vector19 = -Vector2.UnitY * MathHelper.Lerp((float)nPC.height * 0.1f, (float)nPC.height * 0.5f, Utils.GetLerpValue(0f, 300f, t));
							velocity = DirectionTo(nPC.Center + vector19).SafeNormalize(-Vector2.UnitY) * velocity.Length();
							netUpdate = true;
						}
					}
					else if (type == 285)
					{
						ai[1] += 1f;
						if (ai[1] == 1f)
						{
							damage = (int)((float)damage * 0.66f);
						}
						if (ai[1] >= 2f)
						{
							Kill();
							return;
						}
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = lastVelocity.X * -1f;
						}
						if (velocity.Y != lastVelocity.Y)
						{
							velocity.Y = lastVelocity.Y * -1f;
						}
						int num27 = FindTargetWithLineOfSight();
						if (num27 != -1)
						{
							NPC nPC2 = Main.npc[num27];
							Distance(nPC2.Center);
							velocity = DirectionTo(nPC2.Center).SafeNormalize(-Vector2.UnitY) * velocity.Length();
							netUpdate = true;
						}
					}
					else if (type == 931 || type == 1039)
					{
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = lastVelocity.X * -1f;
						}
						if (velocity.Y != lastVelocity.Y)
						{
							velocity.Y = lastVelocity.Y * -1f;
						}
					}
					else if (type == 155)
					{
						if (ai[1] > 10f)
						{
							NetworkText networkText = NetworkText.FromKey("Game.BallBounceResult", NetworkText.FromKey(Lang.GetProjectileName(type).Key), ai[1]);
							if (Main.netMode == 0)
							{
								Main.NewText(networkText.ToString(), byte.MaxValue, 240, 20);
							}
							else if (Main.netMode == 2)
							{
								ChatHelper.BroadcastChatMessage(networkText, new Color(255, 240, 20));
							}
						}
						ai[1] = 0f;
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = lastVelocity.X * -0.6f;
						}
						if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 2f)
						{
							velocity.Y = lastVelocity.Y * -0.6f;
						}
					}
					else if (aiStyle == 33)
					{
						if (localAI[0] == 0f)
						{
							if (wet)
							{
								position += lastVelocity / 2f;
							}
							else
							{
								position += lastVelocity;
							}
							velocity *= 0f;
							localAI[0] = 1f;
						}
					}
					else if (type != 308 && type != 377 && type != 966)
					{
						if (aiStyle == 197)
						{
							if (ai[0] == 0f)
							{
								AI_197_HandleTileCollision();
							}
						}
						else if (type == 477)
						{
							if (velocity.Y != lastVelocity.Y || velocity.X != lastVelocity.X)
							{
								penetrate--;
								if (penetrate <= 0)
								{
									Kill();
								}
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = 0f - lastVelocity.X;
								}
								if (velocity.Y != lastVelocity.Y)
								{
									velocity.Y = 0f - lastVelocity.Y;
								}
								rotation = velocity.ToRotation() + (float)Math.PI / 2f;
								damage = (int)((float)damage * 0.85f);
							}
							if (penetrate > 0 && owner == Main.myPlayer)
							{
								int[] array = new int[10];
								int num28 = 0;
								int num29 = 700;
								int num30 = 20;
								for (int m = 0; m < Main.maxNPCs; m++)
								{
									if (!Main.npc[m].CanBeChasedBy(this))
									{
										continue;
									}
									float num31 = (base.Center - Main.npc[m].Center).Length();
									if (num31 > (float)num30 && num31 < (float)num29 && Collision.CanHitLine(base.Center, 1, 1, Main.npc[m].Center, 1, 1))
									{
										array[num28] = m;
										num28++;
										if (num28 >= 9)
										{
											break;
										}
									}
								}
								if (num28 > 0)
								{
									num28 = Main.rand.Next(num28);
									Vector2 vector20 = Main.npc[array[num28]].Center - base.Center;
									float num32 = velocity.Length();
									vector20.Normalize();
									velocity = vector20 * num32;
									rotation = velocity.ToRotation() + (float)Math.PI / 2f;
									netUpdate = true;
								}
							}
						}
						else if (type == 94)
						{
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = 0f - lastVelocity.X;
							}
							if (velocity.Y != lastVelocity.Y)
							{
								velocity.Y = 0f - lastVelocity.Y;
							}
						}
						else if (type == 496)
						{
							if (velocity.X != lastVelocity.X)
							{
								if (Math.Abs(velocity.X) < 1f)
								{
									velocity.X = 0f - lastVelocity.X;
								}
								else
								{
									Kill();
								}
							}
							if (velocity.Y != lastVelocity.Y)
							{
								if (Math.Abs(velocity.Y) < 1f)
								{
									velocity.Y = 0f - lastVelocity.Y;
								}
								else
								{
									Kill();
								}
							}
						}
						else if (type == 311)
						{
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = 0f - lastVelocity.X;
								ai[1] += 1f;
							}
							if (velocity.Y != lastVelocity.Y)
							{
								velocity.Y = 0f - lastVelocity.Y;
								ai[1] += 1f;
							}
							if (ai[1] > 4f)
							{
								Kill();
							}
						}
						else if (type == 1023)
						{
							bool flag11 = false;
							if (velocity.X != lastVelocity.X)
							{
								bool num33 = Math.Abs(velocity.X - lastVelocity.X) < 5f;
								velocity.X = 0f - lastVelocity.X;
								if (num33)
								{
									velocity.X = ((velocity.X < 0f) ? (-5f) : 5f);
								}
								localAI[1] = 1f;
								flag11 = true;
							}
							if (velocity.Y != lastVelocity.Y)
							{
								bool num34 = lastVelocity.Y > 0f && lastVelocity.Y < 5f;
								velocity.Y = 0f - lastVelocity.Y;
								if (num34)
								{
									velocity.Y = -5f;
								}
								localAI[1] = 1f;
								flag11 = true;
							}
							if (flag11)
							{
								Collision.HitTiles(position, lastVelocity, width, height);
								SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
							}
						}
						else if (type == 312)
						{
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = 0f - lastVelocity.X;
								ai[1] += 1f;
							}
							if (velocity.Y != lastVelocity.Y)
							{
								velocity.Y = 0f - lastVelocity.Y;
								ai[1] += 1f;
							}
						}
						else if (type == 522 || type == 620)
						{
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = 0f - lastVelocity.X;
							}
							if (velocity.Y != lastVelocity.Y)
							{
								velocity.Y = 0f - lastVelocity.Y;
							}
						}
						else if (type == 524)
						{
							ai[0] += 100f;
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = 0f - lastVelocity.X;
							}
							if (velocity.Y != lastVelocity.Y)
							{
								velocity.Y = 0f - lastVelocity.Y;
							}
						}
						else if (aiStyle == 93)
						{
							if (velocity != lastVelocity)
							{
								ai[1] = 0f;
								ai[0] = 1f;
								netUpdate = true;
								tileCollide = false;
								position += velocity;
								velocity = lastVelocity;
								velocity.Normalize();
								velocity *= 3f;
							}
						}
						else if (type == 281)
						{
							bool flag12 = Math.Abs(velocity.X) + Math.Abs(velocity.Y) < 2f || ai[0] == -1f;
							if (ai[0] == -2f || ai[0] == -3f)
							{
								flag12 = false;
							}
							if (flag12)
							{
								if (Main.myPlayer == owner)
								{
									int num35 = ((velocity.X > 0f) ? 1 : 2);
									num35 += 2;
									NPC.ReleaseNPC((int)base.Center.X, (int)base.Bottom.Y - 4, 614, num35, owner);
									ai[0] = -3f;
									netUpdate = true;
								}
							}
							else
							{
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = (0f - lastVelocity.X) * 0.5f;
								}
								if (velocity.Y != lastVelocity.Y)
								{
									velocity.Y = (0f - lastVelocity.Y) * 0.5f;
								}
							}
						}
						else if (type == 290 || type == 294)
						{
							if (velocity.X != lastVelocity.X)
							{
								position.X += velocity.X;
								velocity.X = 0f - lastVelocity.X;
							}
							if (velocity.Y != lastVelocity.Y)
							{
								position.Y += velocity.Y;
								velocity.Y = 0f - lastVelocity.Y;
							}
							bool num36 = type == 290;
							bool flag13 = owner == Main.myPlayer;
							if (num36)
							{
								flag13 = Main.netMode != 1 || Main.dedServ;
							}
							if (flag13)
							{
								int num37 = AI_048_GetStartPositionSettingDelay();
								if (localAI[0] >= (float)num37)
								{
									float num38 = localAI[1];
									float num39 = localAI[2];
									ParticleOrchestraType particleOrchestraType = ParticleOrchestraType.ShadowbeamHostile;
									if (type == 294)
									{
										particleOrchestraType = ParticleOrchestraType.ShadowbeamFriendly;
									}
									if (num38 > 0f && num39 > 0f)
									{
										ParticleOrchestrator.BroadcastOrRequestParticleSpawn(particleOrchestraType, new ParticleOrchestraSettings
										{
											PositionInWorld = base.Center,
											MovementVector = new Vector2(num38, num39),
											UniqueInfoPiece = (int)(velocity.Length() * 1000f)
										});
									}
								}
								localAI[1] = base.Center.X;
								localAI[2] = base.Center.Y;
							}
						}
						else if ((type == 181 || type == 189 || type == 357 || type == 566) && penetrate > 0)
						{
							if (type == 357)
							{
								damage = (int)((double)damage * 0.9);
							}
							penetrate--;
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = 0f - lastVelocity.X;
							}
							if (velocity.Y != lastVelocity.Y)
							{
								velocity.Y = 0f - lastVelocity.Y;
							}
						}
						else if (type == 1080)
						{
							if (velocity != lastVelocity)
							{
								position += velocity;
								Kill();
							}
						}
						else if (type == 307 && ai[1] < 5f)
						{
							ai[1] += 1f;
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = 0f - lastVelocity.X;
							}
							if (velocity.Y != lastVelocity.Y)
							{
								velocity.Y = 0f - lastVelocity.Y;
							}
						}
						else if (type == 1055 || type == 99 || type == 1005 || type == 1014 || type == 1053 || type == 1057)
						{
							if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 5f)
							{
								if (type == 1053)
								{
									for (int n = 0; n < 10; n++)
									{
										int num40 = Dust.NewDust(new Vector2(position.X, position.Y + 8f), width, height - 8, 6, 0f, 0f, 100, default(Color), 2f);
										Main.dust[num40].velocity *= 8f;
										Main.dust[num40].noGravity = true;
										num40 = Dust.NewDust(new Vector2(position.X, position.Y + 8f), width, height - 8, 6, 0f, 0f, 100, default(Color), 1.25f);
										Main.dust[num40].velocity *= 2f;
										Main.dust[num40].velocity.X *= 1.5f;
										Main.dust[num40].velocity.Y -= 2f;
									}
								}
								Collision.HitTiles(position, velocity, width, height);
								SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
								velocity.Y = (0f - lastVelocity.Y) * 0.2f;
								if (type == 1055)
								{
									ai[1] = 1f;
								}
								else if (type == 1057)
								{
									Kill();
								}
							}
							if (velocity.X != lastVelocity.X)
							{
								if (type == 1055)
								{
									if (ai[1] != 1f)
									{
										ai[1] = 1f;
										Collision.HitTiles(position, velocity, width, height);
										SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
									}
								}
								else
								{
									Kill();
								}
							}
						}
						else if (type == 1021)
						{
							if (velocity.Y != lastVelocity.Y)
							{
								if (lastVelocity.Y > 4f)
								{
									Collision.HitTiles(position, velocity, width, height);
									SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
									velocity.Y = (0f - lastVelocity.Y) * 0.9f;
								}
								else if (lastVelocity.Y > 0f)
								{
									localAI[1] = 999f;
								}
							}
							if (velocity.X != lastVelocity.X)
							{
								if (localAI[1] <= 3f)
								{
									velocity.X = lastVelocity.X * -0.75f;
									localAI[1] += 1f;
								}
								else
								{
									Kill();
								}
							}
						}
						else if (type == 1013)
						{
							float num41 = Math.Abs(lastVelocity.X);
							float num42 = Math.Abs(lastVelocity.Y);
							float num43 = 0.95f;
							float num44 = 0.95f;
							if (num41 < 0.5f)
							{
								num43 = 0.1f;
							}
							else if (num41 < 0.75f)
							{
								num43 = 0.25f;
							}
							else if (num41 < 1f)
							{
								num43 = 0.5f;
							}
							if (num42 < 0.5f)
							{
								num44 = 0.1f;
							}
							else if (num42 < 0.75f)
							{
								num44 = 0.25f;
							}
							else if (num42 < 1f)
							{
								num44 = 0.5f;
							}
							bool flag14 = localAI[0] >= 500f;
							bool flag15 = false;
							if (velocity.Y != lastVelocity.Y)
							{
								if (flag14 || Math.Abs(lastVelocity.Y) > 5f)
								{
									flag15 = true;
								}
								velocity.Y = (0f - lastVelocity.Y) * num44;
							}
							if (velocity.X != lastVelocity.X)
							{
								if (flag14 || Math.Abs(lastVelocity.X) > 5f)
								{
									flag15 = true;
								}
								velocity.X = (0f - lastVelocity.X) * num43;
							}
							if (flag15)
							{
								localAI[1] += 1f;
								Collision.HitTiles(position, velocity, width, height);
								SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
							}
							if (velocity.Length() < 0.1f && localAI[0] > 50f)
							{
								Kill();
							}
							if (localAI[1] > 20f)
							{
								Kill();
							}
						}
						else if (type == 1047)
						{
							RainbowBoulder_CheckBounce(ref lastVelocity);
						}
						else if (type == 727)
						{
							int num45 = 30;
							float num46 = 2f;
							float num47 = 2f;
							if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 5f)
							{
								Collision.HitTiles(position, velocity, width, height);
								SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
								velocity.Y = (0f - lastVelocity.Y) * 0.65f;
								if (owner == Main.myPlayer)
								{
									int num48 = Main.rand.Next(3, 6);
									float num49 = Main.rand.NextFloat();
									for (float num50 = 0f; num50 < 1f; num50 += 1f / (float)num48)
									{
										Vector2 vector21 = ((num49 + num50) * ((float)Math.PI * 2f)).ToRotationVector2() * num47;
										if (vector21.Y > 0f)
										{
											vector21 *= -0.7f;
										}
										NewProjectile(GetProjectileSource_FromThis(), base.Center, vector21, 763, num45, num46, Main.myPlayer);
									}
								}
							}
							if (velocity.X != lastVelocity.X)
							{
								Kill();
								if (owner == Main.myPlayer)
								{
									int num51 = Main.rand.Next(3, 6);
									float num52 = Main.rand.NextFloat();
									for (float num53 = 0f; num53 < 1f; num53 += 1f / (float)num51)
									{
										Vector2 vector22 = ((num52 + num53) * ((float)Math.PI * 2f)).ToRotationVector2() * num47;
										if (vector22.Y > 0f)
										{
											vector22 *= -0.7f;
										}
										NewProjectile(GetProjectileSource_FromThis(), base.Center, vector22, 763, num45, num46, Main.myPlayer);
									}
								}
							}
						}
						else if (type == 1054)
						{
							float num54 = Math.Abs(lastVelocity.X);
							float num55 = Math.Abs(lastVelocity.Y);
							float num56 = 0.8f;
							float num57 = 0.6f;
							if (num54 < 0.5f)
							{
								num56 = 0.1f;
							}
							else if (num54 < 0.75f)
							{
								num56 = 0.25f;
							}
							else if (num54 < 1f)
							{
								num56 = 0.5f;
							}
							if (num55 < 0.5f)
							{
								num57 = 0.1f;
							}
							else if (num55 < 0.75f)
							{
								num57 = 0.25f;
							}
							else if (num55 < 1f)
							{
								num57 = 0.5f;
							}
							bool flag16 = localAI[0] >= 500f;
							bool flag17 = false;
							if (velocity.Y != lastVelocity.Y)
							{
								if (flag16 || Math.Abs(lastVelocity.Y) > 5f)
								{
									flag17 = true;
								}
								velocity.Y = (0f - lastVelocity.Y) * num57;
							}
							if (velocity.X != lastVelocity.X)
							{
								if (flag16 || Math.Abs(lastVelocity.X) > 2f)
								{
									flag17 = true;
									localAI[1] += 1f;
								}
								velocity.X = (0f - lastVelocity.X) * num56;
							}
							if (flag17)
							{
								Collision.HitTiles(position, velocity, width, height);
								SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
							}
							if (velocity.Length() < 0.1f && localAI[0] > 50f)
							{
								Kill();
							}
							if (localAI[1] > 1f)
							{
								Kill();
							}
						}
						else if (type == 1048)
						{
							float num58 = Math.Abs(lastVelocity.X);
							float num59 = Math.Abs(lastVelocity.Y);
							float num60 = 0.75f;
							float num61 = 0.75f;
							if (num58 < 0.5f)
							{
								num60 = 0.1f;
							}
							else if (num58 < 0.75f)
							{
								num60 = 0.2f;
							}
							else if (num58 < 1f)
							{
								num60 = 0.45f;
							}
							if (num59 < 0.5f)
							{
								num61 = 0.1f;
							}
							else if (num59 < 0.75f)
							{
								num61 = 0.2f;
							}
							else if (num59 < 1f)
							{
								num61 = 0.45f;
							}
							bool flag18 = localAI[0] >= 500f;
							bool flag19 = false;
							if (velocity.Y != lastVelocity.Y)
							{
								if (flag18 || Math.Abs(lastVelocity.Y) > 4f)
								{
									flag19 = true;
								}
								velocity.Y = (0f - lastVelocity.Y) * num61;
							}
							if (velocity.X != lastVelocity.X)
							{
								if (flag18 || Math.Abs(lastVelocity.X) > 4f)
								{
									flag19 = true;
								}
								velocity.X = (0f - lastVelocity.X) * num60;
							}
							if (flag19)
							{
								localAI[1] += 3f;
								Collision.HitTiles(position, velocity, width, height);
								SoundEngine.PlaySound(SoundID.Item177, (int)position.X, (int)position.Y);
								for (int num62 = 0; num62 < 10; num62++)
								{
									Vector2 vector23 = Main.rand.NextVector2FromRectangle(base.Hitbox);
									_ = Main.dust[Dust.NewDust(vector23 - Vector2.One, 2, 2, 322, (0f - velocity.X) * 0.5f, (0f - velocity.Y) * 0.5f)];
								}
								for (int num63 = 0; num63 < 2 + Main.rand.Next(2); num63++)
								{
									Vector2 vector24 = Main.rand.NextVector2FromRectangle(base.Hitbox);
									ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.PooFly, new ParticleOrchestraSettings
									{
										PositionInWorld = vector24 + velocity * -1f
									});
								}
							}
							if (velocity.Length() < 0.1f && localAI[0] > 50f)
							{
								Kill();
							}
							if (localAI[1] > 20f)
							{
								Kill();
							}
						}
						else if (type == 655)
						{
							if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 5f)
							{
								Collision.HitTiles(position, velocity, width, height);
								SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
								velocity.Y = (0f - lastVelocity.Y) * 0.2f;
							}
							if (velocity.X != lastVelocity.X)
							{
								Kill();
							}
						}
						else if (type == 36)
						{
							if (penetrate > 1)
							{
								Collision.HitTiles(position, velocity, width, height);
								SoundEngine.PlaySound(SoundID.Item10, position);
								penetrate--;
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = 0f - lastVelocity.X;
								}
								if (velocity.Y != lastVelocity.Y)
								{
									velocity.Y = 0f - lastVelocity.Y;
								}
							}
							else
							{
								Kill();
							}
						}
						else if (aiStyle == 21)
						{
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = 0f - lastVelocity.X;
							}
							if (velocity.Y != lastVelocity.Y)
							{
								velocity.Y = 0f - lastVelocity.Y;
							}
						}
						else if (aiStyle == 17)
						{
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = lastVelocity.X * -0.75f;
							}
							if (velocity.Y != lastVelocity.Y && (double)lastVelocity.Y > 1.5)
							{
								velocity.Y = lastVelocity.Y * -0.7f;
							}
						}
						else if (aiStyle == 15)
						{
							AI_015_HandleMovementCollision(ref wetVelocity, ref lastVelocity);
						}
						else if (aiStyle == 9)
						{
							bool flag20 = owner == Main.myPlayer;
							if (type == 79)
							{
								bool flag21 = ai[0] >= 0f;
								flag20 = flag20 && !flag21;
								if (flag21)
								{
									if (velocity.X != lastVelocity.X)
									{
										velocity.X *= 0.1f;
									}
									if (velocity.Y != lastVelocity.Y)
									{
										velocity.Y *= 0.1f;
									}
								}
							}
							if (flag20)
							{
								Kill();
							}
						}
						else if (aiStyle == 39)
						{
							Collision.HitTiles(position, velocity, width, height);
							if (type == 33 || type == 106)
							{
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = 0f - lastVelocity.X;
								}
								if (velocity.Y != lastVelocity.Y)
								{
									velocity.Y = 0f - lastVelocity.Y;
								}
							}
							else
							{
								ai[0] = 1f;
								if (aiStyle == 3)
								{
									velocity.X = 0f - lastVelocity.X;
									velocity.Y = 0f - lastVelocity.Y;
								}
							}
							netUpdate = true;
							SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
						}
						else if (ProjectileID.Sets.IsAPhaseblade[type])
						{
							ai[0] = 2f;
							if (lastVelocity.X == velocity.X && lastVelocity.Y > 0f)
							{
								if (type == 1074)
								{
									for (int num64 = 0; num64 < 15; num64++)
									{
										int num65 = 57;
										if (Main.rand.Next(2) == 0)
										{
											num65 = 43;
										}
										Dust dust = new Dust();
										if (Main.rand.Next(10) == 0)
										{
											dust = Dust.NewDustPerfect(base.Center, num65, null, 255);
											dust.color = new Color(255, 255, 255, 0);
											dust.scale *= 0.5f;
											dust.velocity *= 0.7f;
											dust.velocity.Y -= 3f;
											dust.position.X += Main.rand.Next(-4, 6);
										}
										else
										{
											dust = Dust.NewDustPerfect(base.Center, num65, null, 255);
											dust.color = new Color(200, 200, 200, 0);
											if (Main.rand.Next(4) == 0)
											{
												dust.noGravity = true;
											}
											dust.scale *= 0.5f;
											dust.velocity.Y *= 0.15f;
											dust.velocity.Y -= 0.6f;
											dust.velocity.X *= 0.6f;
											dust.position.X += Main.rand.Next(-4, 6);
											if (dust.position.X < base.Center.X)
											{
												dust.velocity.X = 0f - Math.Abs(dust.velocity.X);
											}
											else
											{
												dust.velocity.X = Math.Abs(dust.velocity.X);
											}
										}
										dust.position.Y += 6f;
										dust.position.Y += (float)Main.rand.Next(300) * 0.1f;
									}
								}
								else
								{
									int num66 = 0;
									Color color = Color.Black;
									if (type == 1059 || type == 1065)
									{
										num66 = 88;
									}
									else if (type == 1060 || type == 1066)
									{
										num66 = 90;
									}
									else if (type == 1061 || type == 1067)
									{
										num66 = 89;
									}
									else if (type == 1062 || type == 1068)
									{
										num66 = 86;
									}
									else if (type == 1064 || type == 1070)
									{
										num66 = 87;
									}
									else if (type == 1063 || type == 1069)
									{
										num66 = 91;
									}
									else if (type == 1071 || type == 1072)
									{
										num66 = 138;
									}
									else if (type == 1075 || type == 1076)
									{
										num66 = 325;
									}
									else if (type == 1101 || type == 1102)
									{
										num66 = 267;
										color = Item.GetPhaseColor(type);
									}
									for (int num67 = 0; num67 < 5; num67++)
									{
										Dust dust2 = Dust.NewDustPerfect(base.Center, num66);
										dust2.color = new Color(255, 255, 255, 255);
										if (color != Color.Black)
										{
											dust2.color = color;
										}
										if (Main.rand.Next(10) == 0)
										{
											dust2.scale *= 0.45f;
											dust2.velocity *= 0.7f;
											dust2.velocity.X *= 1.2f;
											dust2.velocity.Y -= 3.5f;
											if (num66 == 267)
											{
												dust2.velocity *= 2f;
												dust2.noGravity = true;
											}
										}
										else
										{
											dust2.velocity *= 0.3f;
											dust2.scale *= 0.7f;
											dust2.noGravity = true;
											dust2.velocity.Y -= 0.5f;
										}
										dust2.position.X += Main.rand.Next(-2, 4);
										if (num66 != 138)
										{
											dust2.position.X += 1f;
										}
										if (height < 42)
										{
											dust2.position.Y += 6f;
											dust2.position.Y += (float)Main.rand.Next(240) * 0.1f;
										}
										else
										{
											dust2.position.Y += 6f;
											dust2.position.Y += (float)Main.rand.Next(320) * 0.1f;
										}
									}
								}
							}
						}
						else if (aiStyle == 3 || aiStyle == 13 || aiStyle == 69 || aiStyle == 109)
						{
							if (type == 106)
							{
								Vector2 hitPoint = base.Center + velocity.SafeNormalize(Vector2.UnitX) * 8f * scale;
								Vector2 normal = new Vector2((velocity.X != lastVelocity.X) ? (-Math.Sign(lastVelocity.X)) : 0, (velocity.Y != lastVelocity.Y) ? (-Math.Sign(lastVelocity.Y)) : 0);
								LightDisc_Bounce(hitPoint, normal);
							}
							if (type == 23)
							{
								velocity *= 0f;
							}
							else if (type == 383)
							{
								if (ai[1] >= 10f)
								{
									int num68 = 300;
									localAI[0] = num68;
									Collision.HitTilesInACircle(new Vector2(position.X - (float)(num68 / 2), position.Y - (float)(num68 / 2)), velocity, num68, num68);
									SoundEngine.PlaySound(SoundID.Item14, position);
								}
							}
							else if (type == 301)
							{
								int num69 = 200;
								localAI[0] = num69;
								if (owner == Main.myPlayer)
								{
									ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.PaladinsHammerShockwave, new ParticleOrchestraSettings
									{
										PositionInWorld = position,
										MovementVector = base.Size
									}, owner);
								}
							}
							else
							{
								Collision.HitTiles(position, velocity, width, height);
							}
							if (type == 33 || type == 106 || type == 866)
							{
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = 0f - lastVelocity.X;
								}
								if (velocity.Y != lastVelocity.Y)
								{
									velocity.Y = 0f - lastVelocity.Y;
								}
							}
							else
							{
								ai[0] = 1f;
								if ((aiStyle == 3 || aiStyle == 109) && type != 383)
								{
									velocity.X = 0f - lastVelocity.X;
									velocity.Y = 0f - lastVelocity.Y;
								}
							}
							netUpdate = true;
							SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
						}
						else if (aiStyle == 8 && type != 96)
						{
							SoundEngine.PlaySound(SoundID.Item10, position);
							ai[0] += 1f;
							int num70 = 5;
							if (type == 27 && ai[1] == 1f)
							{
								num70 = 7;
							}
							switch (type)
							{
							case 15:
								num70 = 6;
								break;
							case 253:
								num70 = 8;
								break;
							}
							if (ai[0] >= (float)num70)
							{
								position += velocity;
								Kill();
							}
							else
							{
								if (type == 15 && velocity.Y > 4f)
								{
									if (velocity.Y != lastVelocity.Y)
									{
										velocity.Y = (0f - lastVelocity.Y) * 0.8f;
									}
								}
								else if (velocity.Y != lastVelocity.Y)
								{
									velocity.Y = 0f - lastVelocity.Y;
								}
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = 0f - lastVelocity.X;
								}
							}
						}
						else if (aiStyle == 61)
						{
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = lastVelocity.X * -0.3f;
							}
							if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 1f)
							{
								velocity.Y = lastVelocity.Y * -0.3f;
							}
						}
						else if (aiStyle == 14)
						{
							if (type == 928)
							{
								int num71 = 0;
								for (int num72 = 1000; num72 >= 0; num72--)
								{
									if (num72 != whoAmI && Main.projectile[num72].active && Main.projectile[num72].owner == owner && Main.projectile[num72].type == type)
									{
										num71++;
										if (num71 >= 2 && timeLeft > Main.projectile[num72].timeLeft && Main.projectile[num72].timeLeft > 30)
										{
											Main.projectile[num72].timeLeft = 2;
										}
									}
								}
							}
							if (type == 261 && ((velocity.X != lastVelocity.X && (lastVelocity.X < -3f || lastVelocity.X > 3f)) || (velocity.Y != lastVelocity.Y && (lastVelocity.Y < -3f || lastVelocity.Y > 3f))))
							{
								for (int num73 = 0; num73 < 10; num73++)
								{
									Collision.HitTiles(position, velocity, width, height);
								}
								SoundEngine.PlaySound(0, (int)base.Center.X, (int)base.Center.Y);
								MakeBoulderOfEarthExplosion();
							}
							if (type >= 326 && type <= 328 && velocity.X != lastVelocity.X)
							{
								velocity.X = lastVelocity.X * -0.1f;
							}
							if ((type >= 400 && type <= 402) || (type >= 1107 && type <= 1109))
							{
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = lastVelocity.X * -0.1f;
								}
							}
							else if (type == 870 && ai[1] == 0f)
							{
								if (velocity.X != lastVelocity.X || velocity.Y != lastVelocity.Y)
								{
									velocity = -lastVelocity;
									ai[1] = 1f;
								}
							}
							else if (type == 50)
							{
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = lastVelocity.X * -0.2f;
								}
								if (velocity.Y != lastVelocity.Y && (double)lastVelocity.Y > 1.5)
								{
									velocity.Y = lastVelocity.Y * -0.2f;
								}
							}
							else if (type >= 1089)
							{
								if (velocity.X != lastVelocity.X)
								{
									bool num74 = Math.Abs(velocity.X - lastVelocity.X) < 1f;
									velocity.X = (0f - lastVelocity.X) * 0.99f;
									if (num74)
									{
										velocity.X = ((velocity.X < 0f) ? (-1f) : 1f);
									}
								}
								if (velocity.Y != lastVelocity.Y)
								{
									bool num75 = lastVelocity.Y > 0f && lastVelocity.Y < 1f;
									velocity.Y = (0f - lastVelocity.Y) * 0.99f;
									if (num75)
									{
										velocity.Y = -1f;
									}
								}
							}
							else if (type == 185)
							{
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = lastVelocity.X * -0.9f;
								}
								if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 1f)
								{
									velocity.Y = lastVelocity.Y * -0.9f;
								}
							}
							else if (type == 277)
							{
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = lastVelocity.X * -0.9f;
								}
								if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 3f)
								{
									velocity.Y = lastVelocity.Y * -0.9f;
								}
							}
							else if (type != 480)
							{
								if (type == 450)
								{
									if (velocity.X != lastVelocity.X)
									{
										velocity.X = lastVelocity.X * -0.1f;
									}
								}
								else
								{
									if (velocity.X != lastVelocity.X)
									{
										velocity.X = lastVelocity.X * -0.5f;
									}
									if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 1f)
									{
										velocity.Y = lastVelocity.Y * -0.5f;
									}
								}
							}
						}
						else if (aiStyle == 16)
						{
							if (type == 1088)
							{
								Point plantPoint = Point.Zero;
								if (AI_016_CanAcornPlant(out plantPoint))
								{
									Kill();
								}
							}
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = lastVelocity.X * -0.4f;
								if (type == 29)
								{
									velocity.X *= 0.8f;
								}
							}
							if (velocity.Y != lastVelocity.Y && (double)lastVelocity.Y > 0.7 && type != 102)
							{
								velocity.Y = lastVelocity.Y * -0.4f;
								if (type == 29)
								{
									velocity.Y *= 0.8f;
								}
							}
							if (type == 134 || type == 137 || type == 140 || type == 143 || type == 303 || (type >= 338 && type <= 341) || type == 776 || type == 780 || type == 793 || type == 796 || type == 799 || type == 784 || type == 787 || type == 790 || type == 803 || type == 804 || type == 808 || type == 809 || type == 810 || type == 805 || type == 806 || type == 807 || type == 930)
							{
								velocity *= 0f;
								alpha = 255;
								timeLeft = 3;
							}
						}
						else if (aiStyle == 68)
						{
							velocity *= 0f;
							alpha = 255;
							timeLeft = 3;
							netUpdate = true;
						}
						else if (type == 870)
						{
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = lastVelocity.X * -0.2f;
							}
							if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 0f)
							{
								velocity.Y = lastVelocity.Y * -0.2f;
							}
						}
						else if (aiStyle == 201)
						{
							ai[1] = 1f;
							velocity = lastVelocity;
						}
						else if (type == 116)
						{
							ai[2] += 1f;
							if (ai[2] < 4f)
							{
								SoundEngine.PlaySound(SoundID.Item10, position);
								for (int num76 = 0; num76 < 30; num76++)
								{
									int num77 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 64, 0f, 0f, 100, Color.White, 1.8f);
									Main.dust[num77].noGravity = true;
									Main.dust[num77].velocity *= (float)Main.rand.Next(1, 7);
								}
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = lastVelocity.X * -1f;
								}
								if (velocity.Y != lastVelocity.Y)
								{
									velocity.Y = lastVelocity.Y * -1f;
								}
							}
							else
							{
								Kill();
							}
						}
						else if (type == 1081)
						{
							if (lastVelocity.Y != velocity.Y && lastVelocity.Y > 0f)
							{
								position += velocity;
								Kill();
							}
							else if (velocity != lastVelocity)
							{
								if (velocity.Y < 0f)
								{
									velocity.Y = 0f;
								}
								if (localAI[0] == 0f)
								{
									localAI[0] = 1f;
									SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
								}
							}
						}
						else
						{
							position += velocity;
							Kill();
						}
					}
				}
			}
		}
		UpdatePosition(wetVelocity);
		if (!flag2 && !flag4 && owner == Main.myPlayer && (tileCollide || flag5) && position != oldPosition)
		{
			GetCollisionParams(out var resizeAnchor2, out var colWidth2, out var colHeight2);
			Vector2 vector25 = base.Size / 2f - new Vector2(colWidth2, colHeight2) * resizeAnchor2;
			Collision.SwitchTiles(position + vector25, colWidth2, colHeight2, oldPosition + vector25, 4);
		}
	}

	public void GetCollisionParams(out Vector2 resizeAnchor, out int colWidth, out int colHeight)
	{
		resizeAnchor = new Vector2(0.5f, 0.5f);
		colWidth = width;
		colHeight = height;
		if (aiStyle == 60)
		{
			colWidth = 1;
			colHeight = 1;
		}
		if (type == 1097)
		{
			colWidth = 2;
			colHeight = 2;
		}
		if (type == 1023)
		{
			colWidth = 14;
			colHeight = 14;
		}
		else if (type == 969)
		{
			colWidth = 18;
			colHeight = 32;
		}
		else if (type == 771 || type == 822 || type == 823 || type == 843 || type == 846 || type == 845 || type == 852)
		{
			colWidth = width;
			colHeight = 34;
			resizeAnchor = new Vector2(0.75f, 0.75f);
		}
		else if (type == 824 || type == 839 || type == 840 || type == 850 || type == 853)
		{
			colWidth = width;
			colHeight = 58;
			resizeAnchor = new Vector2(0.75f, 0.75f);
		}
		else if (type == 826 || type == 830 || type == 838)
		{
			colWidth = width;
			colHeight = 38;
			resizeAnchor = new Vector2(0.75f, 0.75f);
		}
		else if (type == 828 || type == 829 || type == 827 || type == 844)
		{
			colWidth = width;
			colHeight = 22;
			resizeAnchor = new Vector2(0.75f, 0.75f);
		}
		else if (aiStyle == 29 || type == 28 || aiStyle == 49 || type == 906 || type == 903 || type == 904 || type == 910 || type == 1077)
		{
			colWidth = width - 8;
			colHeight = height - 8;
		}
		else if (type == 250 || type == 267 || type == 297 || type == 323 || type == 3 || type == 711)
		{
			colWidth = 6;
			colHeight = 6;
		}
		else if (type == 383)
		{
			colHeight = 14;
			colWidth = 14;
		}
		else if (type == 308)
		{
			colWidth = 26;
			colHeight = height;
		}
		else if (type == 663 || type == 665 || type == 667 || type == 677 || type == 678 || type == 679 || type == 691 || type == 692 || type == 693)
		{
			colWidth = 16;
			colHeight = height;
		}
		else if (type == 688 || type == 689 || type == 690)
		{
			colWidth = 16;
			colHeight = height;
			resizeAnchor = new Vector2(0.5f, 1f);
		}
		else if (type == 669 || type == 706)
		{
			colWidth = 10;
			colHeight = 10;
		}
		else if (type == 261 || type == 277)
		{
			colWidth = 26;
			colHeight = 26;
		}
		else if (type == 481 || type == 491 || type == 106 || type == 262 || type == 271 || type == 270 || type == 272 || type == 273 || type == 274 || type == 280 || type == 288 || type == 301 || type == 320 || type == 333 || type == 335 || type == 343 || type == 344 || type == 497 || type == 496 || type == 6 || type == 19 || type == 113 || type == 52 || type == 520 || type == 523 || type == 585 || type == 598 || type == 599 || type == 636 || type == 837 || type == 861 || type == 867 || type == 971 || type == 975 || type == 1000 || type == 1052 || ProjectileID.Sets.IsAPhaseblade[type] || type == 1088)
		{
			colWidth = 10;
			colHeight = 10;
		}
		else if (type == 514 || type == 1024)
		{
			colWidth = 4;
			colHeight = 4;
		}
		else if (type == 1038 || type == 248 || type == 247 || type == 507 || type == 508 || type == 662 || type == 680 || type == 685 || type == 757 || type == 928)
		{
			colWidth = width - 12;
			colHeight = height - 12;
		}
		else if (aiStyle == 18 || type == 254)
		{
			colWidth = width - 36;
			colHeight = height - 36;
		}
		else if (type == 182 || type == 190 || type == 33 || type == 229 || type == 237 || type == 243 || type == 866)
		{
			colWidth = width - 20;
			colHeight = height - 20;
		}
		else if (aiStyle == 27)
		{
			colWidth = width - 12;
			colHeight = height - 12;
		}
		else if (type == 533 && ai[0] >= 6f)
		{
			colWidth = width + 6;
			colHeight = height + 6;
		}
		else if (type == 755 && ai[0] >= 0f)
		{
			colWidth = width + 6;
			colHeight = height + 6;
		}
		else if (type == 582 || type == 634 || type == 635 || type == 902)
		{
			colWidth = 8;
			colHeight = 8;
		}
		else if (type == 617)
		{
			colWidth = (int)(20f * scale);
			colHeight = (int)(20f * scale);
		}
		else if (type == 304)
		{
			colWidth = 4;
			colHeight = 4;
		}
		else if (aiStyle == 9)
		{
			colWidth = 4;
			colHeight = 4;
		}
		else if (type == 931 || type == 1039)
		{
			colWidth = 4;
			colHeight = 4;
		}
	}

	private void RainbowBoulder_PreventSpam()
	{
		int num = 7;
		int num2 = 0;
		Rectangle value = Utils.CenteredRectangle(base.Center, new Vector2(6000f, 6000f));
		for (int i = 0; i < 1000; i++)
		{
			if (num2 >= num)
			{
				break;
			}
			if (i != whoAmI)
			{
				Projectile projectile = Main.projectile[i];
				if (projectile.active && projectile.owner == owner && projectile.type == type && projectile.Hitbox.Intersects(value))
				{
					num2++;
				}
			}
		}
		if (num2 >= num)
		{
			Kill();
		}
	}

	private void RainbowBoulder_CheckBounce(ref Vector2 lastVelocity)
	{
		float num = Math.Abs(lastVelocity.X);
		float num2 = Math.Abs(lastVelocity.Y);
		float num3 = 0.95f;
		float num4 = 0.95f;
		if (num < 0.5f)
		{
			num3 = 0.1f;
		}
		else if (num < 0.75f)
		{
			num3 = 0.25f;
		}
		else if (num < 1f)
		{
			num3 = 0.5f;
		}
		if (num2 < 0.5f)
		{
			num4 = 0.1f;
		}
		else if (num2 < 0.75f)
		{
			num4 = 0.25f;
		}
		else if (num2 < 1f)
		{
			num4 = 0.5f;
		}
		bool flag = false;
		bool flag2 = false;
		if (velocity.Y != lastVelocity.Y)
		{
			if (Math.Abs(lastVelocity.Y) > 5f)
			{
				flag = true;
			}
			velocity.Y = (0f - lastVelocity.Y) * num4;
			flag2 = true;
		}
		if (velocity.X != lastVelocity.X)
		{
			if (Math.Abs(lastVelocity.X) > 5f)
			{
				flag = true;
			}
			velocity.X = (0f - lastVelocity.X) * num3;
			flag2 = true;
		}
		if (flag)
		{
			localAI[1] += 1f;
			Collision.HitTiles(position, velocity, width, height);
			SoundEngine.PlaySound(SoundID.RainbowBoulder, (int)position.X, (int)position.Y);
		}
		if (flag2)
		{
			RainbowBoulder_PerformSmartBounce();
		}
	}

	private void RainbowBoulder_PerformSmartBounce()
	{
		RainbowBoulder_PreventSpam();
		if (!active)
		{
			return;
		}
		RainbowBoulder_HighlightNearbyTreasure();
		RainbowBoulder_GetAreas(out var closestPlayer, out var playArea, out var closeToMe);
		float num = float.PositiveInfinity;
		float num2 = float.PositiveInfinity;
		NPC nPC = null;
		NPC nPC2 = null;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			NPC nPC3 = Main.npc[i];
			if (!nPC3.CanBeChasedBy(this) || !nPC3.Hitbox.Intersects(playArea))
			{
				continue;
			}
			float num3 = closestPlayer.Distance(nPC3.Center);
			if (!(num <= num3))
			{
				num = num3;
				nPC = nPC3;
				if (!nPC3.Hitbox.Intersects(closeToMe) && num2 > num3)
				{
					num2 = num3;
					nPC2 = nPC3;
				}
			}
		}
		if (nPC != null || nPC2 != null)
		{
			NPC nPC4 = nPC;
			RainbowBoulder_JumpToEnemy(nPC4);
			return;
		}
		Rectangle playArea2 = playArea;
		playArea2.X /= 16;
		playArea2.Y /= 16;
		playArea2.Width /= 16;
		playArea2.Height /= 16;
		if (RainbowBoulder_GetTreasureCoords(playArea2, out var treasureCoords))
		{
			RainbowBoulder_JumpToTreasure(treasureCoords);
		}
		else if (Distance(closestPlayer.Center) < 3000f)
		{
			RainbowBoulder_JumpToPlayer(closestPlayer);
		}
	}

	private void RainbowBoulder_HighlightNearbyTreasure()
	{
		Rectangle rectangle = Utils.CenteredRectangle(base.Center.ToTileCoordinates().ToVector2(), new Vector2(5f, 5f));
		for (int i = rectangle.Left; i <= rectangle.Right; i++)
		{
			for (int j = rectangle.Top; j <= rectangle.Bottom; j++)
			{
				if (!WorldGen.InWorld(i, j, 2))
				{
					continue;
				}
				Tile tile = Main.tile[i, j];
				if (tile != null && tile.active() && TileID.Sets.FriendlyFairyCanLureTo[tile.type] && SceneMetrics.IsValidForOreFinder(tile))
				{
					Vector2 positionInWorld = new Vector2(i * 16 + 8, j * 16 + 8) + Main.rand.NextVector2Circular(16f, 16f);
					for (float num = 0f; num < 0.5f; num += 1f)
					{
						ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.RainbowBoulder1, new ParticleOrchestraSettings
						{
							PositionInWorld = positionInWorld,
							MovementVector = Vector2.UnitX.RotatedBy(num * ((float)Math.PI * 2f)) * 16f
						}, owner);
					}
					j++;
				}
			}
		}
	}

	private void RainbowBoulder_GetAreas(out Player closestPlayer, out Rectangle playArea, out Rectangle closeToMe)
	{
		byte b = Player.FindClosest(position, width, height);
		closestPlayer = Main.player[b];
		playArea = Utils.CenteredRectangle(closestPlayer.Center, Main.MaxWorldViewSize.ToVector2());
		closeToMe = Utils.CenteredRectangle(base.Center, new Vector2(300f, 150f));
	}

	private void RainbowBoulder_JumpToPlayer(Player player)
	{
		RainbowBoulder_JumpToPosition(player.Center, player.position);
	}

	private void RainbowBoulder_JumpToEnemy(NPC npcProj)
	{
		RainbowBoulder_JumpToPosition(npcProj.Center, npcProj.velocity);
	}

	private void RainbowBoulder_JumpAwayFromEnemy(NPC npcProj)
	{
		Vector2 vector = npcProj.Center - base.Center;
		RainbowBoulder_JumpToPosition(base.Center - vector, Vector2.Zero);
	}

	private void RainbowBoulder_JumpToTreasure(Point point)
	{
		RainbowBoulder_JumpToPosition(point.ToWorldCoordinates(), Vector2.Zero);
	}

	private void RainbowBoulder_JumpToPosition(Vector2 targetPosition, Vector2 targetVelocity)
	{
		Vector2 v = targetPosition - base.Center;
		int num = 32;
		float num2 = Utils.Remap(v.Length(), 0f, 200f, 4f, num);
		float num3 = v.Length() / num2;
		float y = 0.6f;
		velocity = v.SafeNormalize(Vector2.UnitY * -1f) * num2;
		if (owner == Main.myPlayer)
		{
			ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.RainbowBoulder4, new ParticleOrchestraSettings
			{
				PositionInWorld = base.Center,
				MovementVector = velocity
			});
		}
		bool flag = false;
		for (float num4 = 8f; num4 <= (float)num; num4 += 2f)
		{
			Utils.ChaseResults chaseResults = Utils.GetChaseResults(base.Center, num4, targetPosition, targetVelocity);
			if (chaseResults.InterceptionHappens)
			{
				velocity = chaseResults.ChaserVelocity;
				velocity = Utils.FactorAcceleration(velocity, chaseResults.InterceptionTime, new Vector2(0f, y), 0);
				num3 = (int)(chaseResults.InterceptionTime - 2f);
				flag = true;
			}
		}
		if (!flag)
		{
			velocity = Utils.FactorAcceleration(velocity, Math.Min(120f, num3), new Vector2(0f, y), 0);
		}
		ai[1] = num3;
		netUpdate = true;
	}

	private bool RainbowBoulder_GetTreasureCoords(Rectangle playArea, out Point treasureCoords)
	{
		treasureCoords = default(Point);
		Point point = base.Center.ToTileCoordinates();
		Rectangle rectangle = new Rectangle(point.X, point.Y, 1, 1);
		rectangle = playArea;
		int num = 40;
		Rectangle value = new Rectangle(0, 0, Main.maxTilesX, Main.maxTilesY);
		value.Inflate(-num, -num);
		rectangle = Rectangle.Intersect(rectangle, value);
		int num2 = -1;
		float num3 = -1f;
		for (int i = rectangle.Left; i <= rectangle.Right; i++)
		{
			for (int j = rectangle.Top; j <= rectangle.Bottom; j++)
			{
				Tile tile = Main.tile[i, j];
				if (tile == null || !tile.active() || !TileID.Sets.FriendlyFairyCanLureTo[tile.type] || !SceneMetrics.IsValidForOreFinder(tile))
				{
					continue;
				}
				short num4 = Main.tileOreFinderPriority[tile.type];
				if (TileID.Sets.Ore[tile.type])
				{
					int num5 = 3;
					int num6 = 3;
					int num7 = 40;
					int num8 = 0;
					for (int k = i - num5; k <= i + num5; k++)
					{
						for (int l = j - num6; l <= j + num6; l++)
						{
							if (Main.tile[k, l].active() && Main.tile[k, l].type == tile.type)
							{
								num8++;
							}
						}
					}
					if (num8 < num7)
					{
						num4 = -1;
					}
				}
				if (num2 <= num4)
				{
					float num9 = Distance(new Vector2(i * 16 + 8, j * 16 + 8));
					if (num2 != num4 || !(num9 >= num3))
					{
						num2 = num4;
						num3 = num9;
						treasureCoords.X = i;
						treasureCoords.Y = j;
					}
				}
			}
		}
		return num2 != -1;
	}

	private void LightDisc_Bounce(Vector2 hitPoint, Vector2 normal)
	{
		Vector2 spinningpoint = Vector2.Reflect(velocity, normal);
		for (int i = 0; i < 4; i++)
		{
			Dust dust = Dust.NewDustPerfect(hitPoint, 306, spinningpoint.RotatedBy((float)Math.PI / 4f * Main.rand.NextFloatDirection()) * 0.6f * Main.rand.NextFloat(), 200, default(Color), 1.6f);
			dust.color = Color.Lerp(new Color(219, 253, 0), Color.Cyan, Main.rand.NextFloat());
			Dust dust2 = Dust.CloneDust(dust);
			dust2.color = Color.White;
			dust2.scale = 1f;
			dust2.alpha = 50;
		}
	}

	private void AI_149_GolfBall()
	{
		if (!npcProj && timeLeft < 10)
		{
			timeLeft = 10;
		}
		if (ai[1] == -1f)
		{
			Tile tileSafely = Framing.GetTileSafely(base.Bottom.ToTileCoordinates());
			if (!tileSafely.active() || tileSafely.type != 494)
			{
				ai[1] = 0f;
				netUpdate = true;
			}
			return;
		}
		BallStepResult ballStepResult = GolfHelper.StepGolfBall(this, ref localAI[0]);
		if (ballStepResult.State == BallState.Resting)
		{
			damage = 0;
			if (Main.netMode == 1 && owner == Main.myPlayer && localAI[1] != (float)ballStepResult.State)
			{
				netUpdate = true;
			}
		}
		localAI[1] = (float)ballStepResult.State;
		rotation += localAI[0];
		if (velocity.Y != 0f && ballStepResult.State == BallState.Moving)
		{
			rotation += velocity.X * 0.1f + velocity.Y * 0.1f;
		}
		if (ballStepResult.State == BallState.Moving && owner == Main.myPlayer)
		{
			bool? flag = ProjectileID.Sets.ForcePlateDetection[135];
			if ((!flag.HasValue || flag.Value) && localAI[1] != 0f)
			{
				Collision.SwitchTiles(position, width, height, oldPosition, 4);
			}
		}
		if (ballStepResult.State == BallState.Moving)
		{
			CheckSectionsInCaseOwnerIsWatching();
		}
	}

	public void CheckSectionsInCaseOwnerIsWatching()
	{
		if (Main.player.IndexInRange(owner) && Main.player[owner].active)
		{
			if (Main.netMode == 2)
			{
				RemoteClient.CheckSection(owner, position);
			}
			else if (owner == Main.myPlayer)
			{
				ActiveSections.CheckSection(position);
			}
		}
	}

	private void MakeBoulderOfEarthExplosion()
	{
		localAI[0] = 40f;
		float mAX_SPREAD = 20f;
		int fluff = 10;
		int distFluff = 50;
		int layerStart = 1;
		int num = 6;
		if (velocity.Length() < 8f || Math.Abs(velocity.Y) < 4f)
		{
			mAX_SPREAD = 15f;
			fluff = 7;
			distFluff = 30;
			num = 4;
		}
		if (velocity.Length() < 4f || Math.Abs(velocity.Y) < 2f)
		{
			mAX_SPREAD = 15f;
			fluff = 7;
			distFluff = 30;
			num = 2;
			layerStart = 0;
		}
		int layerEnd = num;
		int num2 = num - 2;
		if (num2 < 1)
		{
			num2 = 1;
		}
		CreateGroundExplosion(mAX_SPREAD, fluff, distFluff, layerStart, layerEnd, num2);
		for (int i = 0; i < 10; i++)
		{
			Dust dust = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(width / 2, height / 2), 228, Main.rand.NextVector2Circular(3f, 3f));
			dust.scale = 0.6f;
			if (i < 5)
			{
				dust.noGravity = true;
				dust.scale = 1.8f;
			}
		}
	}

	private void UpdatePosition(Vector2 wetVelocity)
	{
		if (aiStyle == 4 || aiStyle == 38 || aiStyle == 84 || aiStyle == 148 || (aiStyle == 7 && ai[0] == 2f) || ((type == 440 || type == 449 || type == 606) && ai[1] == 1f) || (aiStyle == 93 && ai[0] < 0f) || type == 540 || type == 756 || type == 818 || type == 856 || type == 961 || type == 1041 || type == 933 || type == 1100 || ProjectileID.Sets.IsAGolfBall[type])
		{
			return;
		}
		if (wet)
		{
			position += wetVelocity;
		}
		else
		{
			position += velocity;
		}
		if (correctSlopeCollision && tileCollide)
		{
			bool fall = false;
			if (aiStyle == 62)
			{
				fall = true;
			}
			switch (type)
			{
			case 317:
			case 387:
			case 388:
			case 533:
			case 759:
				fall = true;
				break;
			}
			Vector4 vector = Collision.SlopeCollision(position, velocity, width, height, 0f, fall);
			position.X = vector.X;
			position.Y = vector.Y;
			velocity.X = vector.Z;
			velocity.Y = vector.W;
		}
	}

	private void SpawnFakeFishInWater(int x, int y)
	{
		GetFishingPondWidth(x, y, out var minX, out var maxX);
		int num = 10;
		minX = Math.Max(x - num, minX);
		maxX = Math.Min(x + num, maxX);
		int num2 = 1;
		int num3 = 1;
		int num4 = 10;
		int num5 = 3;
		minX += num2;
		maxX -= num2;
		_availableFishTypesToShow.Clear();
		Main.FishDropsDB.GetDisplayableDrops(_context, _availableFishTypesToShow);
		if (_availableFishTypesToShow.Count == 0)
		{
			return;
		}
		float num6 = 0f;
		foreach (FishPossibilityEntry item in _availableFishTypesToShow)
		{
			num6 += item.Frequency;
		}
		for (int i = minX; i <= maxX; i++)
		{
			int j = y;
			int num7 = 0;
			for (; Main.tile[i, j] != null && Main.tile[i, j].liquid > 0 && !WorldGen.SolidTile(i, j) && j < Main.maxTilesY - 10; j++)
			{
				if (num7 >= num4)
				{
					break;
				}
				num7++;
			}
			if (num7 < num5)
			{
				continue;
			}
			if (Main.rand.Next(5) == 0)
			{
				Vector2 positionInWorld = new Vector2(i * 16 + Main.rand.Next(4, 13), y * 16 + Main.rand.Next(num3 * 16 + 4, num7 * 16 + 16 - num3 * 16 - 4 + 1));
				float num8 = (float)(y * 16) - positionInWorld.Y;
				num8 *= Main.rand.NextFloat();
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.LakeSparkle, new ParticleOrchestraSettings
				{
					PositionInWorld = positionInWorld,
					MovementVector = new Vector2(0f, num8)
				});
			}
			if (Main.rand.Next(10) != 0)
			{
				continue;
			}
			Vector2 positionInWorld2 = new Vector2(i * 16 + Main.rand.Next(4, 13), y * 16 + Main.rand.Next(num3 * 16 + 4, num7 * 16 + 16 - num3 * 16 - 4 + 1));
			Vector2 vector = new Point(x, y).ToWorldCoordinates();
			float num9 = num6 * Main.rand.NextFloat();
			int itemType = _availableFishTypesToShow[0].ItemType;
			foreach (FishPossibilityEntry item2 in _availableFishTypesToShow)
			{
				itemType = item2.ItemType;
				num9 -= item2.Frequency;
				if (num9 <= 0f)
				{
					break;
				}
			}
			bool num10 = Main.rand.Next(4) == 0;
			ParticleOrchestraType particleOrchestraType = ParticleOrchestraType.FakeFish;
			Vector2 movementVector = vector;
			if (num10)
			{
				int num11 = Main.rand.Next(minX, maxX + 1);
				int num12 = Main.rand.Next(minX, maxX + 1);
				_ = (num11 + num12) / 2;
				int num13 = Math.Min(num11, num12);
				int num14 = Math.Abs(num11 - num12);
				int num15 = 6;
				int num16 = 0;
				Rectangle r = new Rectangle(num13 * 16 + 2, y * 16 - 2, num14 * 16 - 4, 12);
				int num17 = 0;
				while (num17 < num15 && !Collision.SolidTiles(r.TopLeft(), r.Width, r.Height))
				{
					num17++;
					r.Y -= 16;
					num16++;
				}
				int num18 = 3;
				if (num16 >= num18)
				{
					particleOrchestraType = ParticleOrchestraType.FakeFishJump;
					int num19 = Main.rand.Next(1, 4);
					int num20 = num18 + num19;
					int num21 = Main.rand.Next(16 * num20, (num19 + num16) * 16);
					float atGravity = 0.2f;
					float jumpForce = Utils.GetJumpForce(num21, atGravity);
					float num22 = Utils.GetJumpTimeToApex(num21, atGravity) * 2f;
					movementVector = new Vector2((float)((num12 - num11) * 16) / num22, 0f - jumpForce);
					positionInWorld2 = new Vector2(num11 * 16 + 4 + Main.rand.Next(9), (y + num19) * 16 + 4 + Main.rand.Next(9));
				}
			}
			ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, particleOrchestraType, new ParticleOrchestraSettings
			{
				PositionInWorld = positionInWorld2,
				UniqueInfoPiece = itemType,
				MovementVector = movementVector
			});
		}
	}

	public void FishingCheck()
	{
		FishingContext context = _context;
		if (TryBuildFishingContext(context))
		{
			SpawnFakeFishInWater(context.Fisher.X, context.Fisher.Y);
			int num = (context.Fisher.fishingLevel + 75) / 2;
			if (Main.rand.Next(100) <= num)
			{
				SetFishingCheckResults(ref context.Fisher);
			}
		}
	}

	private bool TryBuildFishingContext(FishingContext context)
	{
		if (Main.player[owner].wet && !(base.Center.Y >= Main.player[owner].RotatedRelativePoint(Main.player[owner].MountedCenter).Y))
		{
			return false;
		}
		FishingAttempt fisher = new FishingAttempt
		{
			X = (int)(base.Center.X / 16f),
			Y = (int)(base.Center.Y / 16f),
			bobberType = type
		};
		GetFishingPondState(fisher.X, fisher.Y, out fisher.inLava, out fisher.inHoney, out fisher.waterTilesCount, out fisher.chumsInWater);
		if (Main.notTheBeesWorld && Main.rand.Next(2) == 0)
		{
			fisher.inHoney = false;
		}
		if (fisher.waterTilesCount < 75)
		{
			Main.player[owner].displayedFishingInfo = Language.GetTextValue("GameUI.NotEnoughWater");
			return false;
		}
		fisher.playerFishingConditions = Main.player[owner].GetFishingConditions();
		int baitItemType = fisher.playerFishingConditions.BaitItemType;
		if (baitItemType == 2673)
		{
			Main.player[owner].displayedFishingInfo = Language.GetTextValue("GameUI.FishingWarning");
			if ((fisher.X < 380 || fisher.X > Main.maxTilesX - 380) && fisher.waterTilesCount > 1000 && !NPC.AnyNPCs(370))
			{
				ai[1] = Main.rand.Next(-180, -60) - 100;
				localAI[1] = 1f;
				localAI[2] = 2673f;
				netUpdate = true;
			}
			return false;
		}
		fisher.fishingLevel = fisher.playerFishingConditions.FinalFishingLevel;
		if (fisher.fishingLevel == 0)
		{
			return false;
		}
		fisher.CanFishInLava = ItemID.Sets.CanFishInLava[fisher.playerFishingConditions.PoleItemType] || ItemID.Sets.IsLavaBait[fisher.playerFishingConditions.BaitItemType] || Main.player[owner].accLavaFishing;
		if (fisher.chumsInWater > 0)
		{
			fisher.fishingLevel += 11;
		}
		if (fisher.chumsInWater > 1)
		{
			fisher.fishingLevel += 6;
		}
		if (fisher.chumsInWater > 2)
		{
			fisher.fishingLevel += 3;
		}
		Main.player[owner].displayedFishingInfo = Language.GetTextValue("GameUI.FishingPower", fisher.fishingLevel);
		fisher.waterNeededToFish = 300;
		float num = (float)Main.maxTilesX / 4200f;
		num *= num;
		fisher.atmo = (float)((double)(position.Y / 16f - (60f + 10f * num)) / (Main.worldSurface / 6.0));
		if ((double)fisher.atmo < 0.25)
		{
			fisher.atmo = 0.25f;
		}
		if (fisher.atmo > 1f)
		{
			fisher.atmo = 1f;
		}
		fisher.waterNeededToFish = (int)((float)fisher.waterNeededToFish * fisher.atmo);
		fisher.waterQuality = (float)fisher.waterTilesCount / (float)fisher.waterNeededToFish;
		if (fisher.waterQuality < 1f)
		{
			fisher.fishingLevel = (int)((float)fisher.fishingLevel * fisher.waterQuality);
		}
		fisher.waterQuality = 1f - fisher.waterQuality;
		if (fisher.waterTilesCount < fisher.waterNeededToFish)
		{
			Main.player[owner].displayedFishingInfo = Language.GetTextValue("GameUI.FullFishingPower", fisher.fishingLevel, 0.0 - Math.Round(fisher.waterQuality * 100f));
		}
		if (Main.player[owner].luck < 0f)
		{
			if (Main.rand.NextFloat() < 0f - Main.player[owner].luck)
			{
				fisher.fishingLevel = (int)((double)fisher.fishingLevel * (0.9 - (double)Main.rand.NextFloat() * 0.3));
			}
		}
		else if (Main.rand.NextFloat() < Main.player[owner].luck)
		{
			fisher.fishingLevel = (int)((double)fisher.fishingLevel * (1.1 + (double)Main.rand.NextFloat() * 0.3));
		}
		fisher.heightLevel = 0;
		if (Main.remixWorld)
		{
			if ((double)fisher.Y < Main.worldSurface * 0.5)
			{
				fisher.heightLevel = 0;
			}
			else if ((double)fisher.Y < Main.worldSurface)
			{
				fisher.heightLevel = 1;
			}
			else if ((double)fisher.Y < Main.rockLayer)
			{
				fisher.heightLevel = 3;
			}
			else if (fisher.Y < Main.maxTilesY - 300)
			{
				fisher.heightLevel = 2;
			}
			else
			{
				fisher.heightLevel = 4;
			}
			if (fisher.heightLevel == 2 && Main.rand.Next(2) == 0)
			{
				fisher.heightLevel = 1;
			}
		}
		else if ((double)fisher.Y < Main.worldSurface * 0.5)
		{
			fisher.heightLevel = 0;
		}
		else if ((double)fisher.Y < Main.worldSurface)
		{
			fisher.heightLevel = 1;
		}
		else if ((double)fisher.Y < Main.rockLayer)
		{
			fisher.heightLevel = 2;
		}
		else if (fisher.Y < Main.maxTilesY - 300)
		{
			fisher.heightLevel = 3;
		}
		else
		{
			fisher.heightLevel = 4;
		}
		fisher.junk = Main.rand.Next(50) > fisher.fishingLevel && Main.rand.Next(50) > fisher.fishingLevel && fisher.waterTilesCount < fisher.waterNeededToFish;
		FishingCheck_RollDropLevels(fisher.fishingLevel, out fisher.common, out fisher.uncommon, out fisher.rare, out fisher.veryrare, out fisher.legendary, out fisher.crate);
		FishingCheck_ProbeForQuestFish(ref fisher);
		PrepareFishingContext(context, fisher);
		return true;
	}

	private void SetFishingCheckResults(ref FishingAttempt fisher)
	{
		FishingCheck_RollEnemySpawns(ref fisher);
		FishingCheck_RollItemDrop(ref fisher);
		bool flag = false;
		if (fisher.rolledItemDrop > 0)
		{
			if (Main.player[owner].sonarPotion)
			{
				Item item = new Item();
				item.SetDefaults(fisher.rolledItemDrop);
				PopupText.AssignAsSonarText(PopupText.NewText(PopupTextContext.SonarAlert, item, base.Center, 1, noStack: true));
				SoundEngine.PlaySound(SoundID.SonarPotion, position);
			}
			float num = fisher.fishingLevel;
			ai[1] = (float)Main.rand.Next(-240, -90) - num;
			localAI[1] = fisher.rolledItemDrop;
			localAI[2] = fisher.playerFishingConditions.BaitItemType;
			netUpdate = true;
			flag = true;
		}
		if (fisher.rolledEnemySpawn > 0)
		{
			if (Main.player[owner].sonarPotion)
			{
				PopupText.AssignAsSonarText(PopupText.NewText(PopupTextContext.SonarAlert, fisher.rolledEnemySpawn, base.Center, stay5TimesLonger: false));
				SoundEngine.PlaySound(SoundID.SonarPotion, position);
			}
			float num2 = fisher.fishingLevel;
			ai[1] = (float)Main.rand.Next(-240, -90) - num2;
			localAI[1] = -fisher.rolledEnemySpawn;
			localAI[2] = fisher.playerFishingConditions.BaitItemType;
			netUpdate = true;
			flag = true;
		}
		if (!flag && fisher.inLava)
		{
			int num3 = 0;
			if (ItemID.Sets.IsLavaBait[fisher.playerFishingConditions.BaitItemType])
			{
				num3++;
			}
			if (ItemID.Sets.CanFishInLava[fisher.playerFishingConditions.PoleItemType])
			{
				num3++;
			}
			if (Main.player[owner].accLavaFishing)
			{
				num3++;
			}
			if (num3 >= 3)
			{
				localAI[1] += 480f;
			}
			else if (num3 >= 2)
			{
				localAI[1] += 240f;
			}
		}
		if (fisher.CanFishInLava && fisher.inLava)
		{
			AchievementsHelper.HandleSpecialEvent(Main.player[owner], 19);
		}
	}

	private void FishingCheck_RollEnemySpawns(ref FishingAttempt fisher)
	{
		if (fisher.inLava || fisher.inHoney || !Main.bloodMoon || Main.dayTime)
		{
			return;
		}
		int maxValue = 6;
		if (fisher.playerFishingConditions.PoleItemType == 4325)
		{
			maxValue = 3;
		}
		if (Main.rand.Next(maxValue) != 0)
		{
			return;
		}
		if (!NPC.unlockedSlimeRedSpawn && Main.rand.Next(5) == 0)
		{
			fisher.rolledEnemySpawn = 682;
		}
		else if (Main.hardMode)
		{
			fisher.rolledEnemySpawn = Utils.SelectRandom(Main.rand, new short[4] { 620, 621, 586, 587 });
			if (Main.rand.Next(10) == 0)
			{
				fisher.rolledEnemySpawn = 618;
			}
		}
		else
		{
			fisher.rolledEnemySpawn = Utils.SelectRandom(Main.rand, new short[2] { 586, 587 });
		}
	}

	private void FishingCheck_RollItemDrop(ref FishingAttempt fisher)
	{
		fisher.rolledItemDrop = Main.FishDropsDB.TryGetItemDropType(_context);
		if (fisher.rolledItemDrop != 0)
		{
			if (Main.player[owner].sonarPotion)
			{
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.FakeFish, new ParticleOrchestraSettings
				{
					PositionInWorld = base.Center + new Vector2(0f, 24f) + Main.rand.NextVector2Circular(16f, 0f),
					MovementVector = base.Center + new Vector2(0f, 24f),
					UniqueInfoPiece = fisher.rolledItemDrop
				}, owner);
				ParticleOrchestrator.PingFakeFish(this, fisher.rolledItemDrop);
				ParticleOrchestrator.PushAwayFakeFish(this, fisher.rolledItemDrop);
			}
			ParticleOrchestrator.MagnetFakeFish(this, fisher.rolledItemDrop);
		}
	}

	private FishingContext PrepareFishingContext(FishingContext context, FishingAttempt fisher)
	{
		bool flag = Main.player[owner].ZoneCorrupt;
		bool flag2 = Main.player[owner].ZoneCrimson;
		bool flag3 = Main.player[owner].ZoneJungle;
		bool flag4 = Main.player[owner].ZoneSnow;
		bool flag5 = Main.player[owner].ZoneDungeon;
		if (!NPC.downedBoss3)
		{
			flag5 = false;
		}
		if (Main.notTheBeesWorld && !Main.remixWorld && Main.rand.Next(2) == 0)
		{
			flag3 = false;
		}
		if (Main.remixWorld && fisher.heightLevel == 0)
		{
			flag = false;
			flag2 = false;
		}
		else if (flag && flag2)
		{
			if (Main.rand.Next(2) == 0)
			{
				flag2 = false;
			}
			else
			{
				flag = false;
			}
		}
		if (flag4 && flag3 && Main.rand.Next(2) == 0)
		{
			flag4 = false;
		}
		bool flag6 = Main.player[owner].ZoneDesert;
		if (flag5)
		{
			flag6 = false;
		}
		bool rolledRemixOcean = Main.remixWorld && fisher.heightLevel == 1 && (double)fisher.Y >= Main.rockLayer && Main.rand.Next(3) == 0;
		context.Player = Main.player[owner];
		context.Fisher = fisher;
		context.RolledCorruption = flag;
		context.RolledCrimson = flag2;
		context.RolledJungle = flag3;
		context.RolledSnow = flag4;
		context.RolledDesert = flag6;
		context.RolledInfectedDesert = flag6 && Main.rand.Next(2) == 0;
		context.RolledRemixOcean = rolledRemixOcean;
		return context;
	}

	private void FishingCheck_RollItemDropOld(ref FishingAttempt fisher)
	{
		bool flag = Main.player[owner].ZoneCorrupt;
		bool flag2 = Main.player[owner].ZoneCrimson;
		bool flag3 = Main.player[owner].ZoneJungle;
		bool flag4 = Main.player[owner].ZoneSnow;
		bool flag5 = Main.player[owner].ZoneDungeon;
		if (!NPC.downedBoss3)
		{
			flag5 = false;
		}
		if (Main.notTheBeesWorld && !Main.remixWorld && Main.rand.Next(2) == 0)
		{
			flag3 = false;
		}
		if (Main.remixWorld && fisher.heightLevel == 0)
		{
			flag = false;
			flag2 = false;
		}
		else if (flag && flag2)
		{
			if (Main.rand.Next(2) == 0)
			{
				flag2 = false;
			}
			else
			{
				flag = false;
			}
		}
		if (flag4 && flag3 && Main.rand.Next(2) == 0)
		{
			flag4 = false;
		}
		bool flag6 = Main.player[owner].ZoneDesert;
		if (flag5)
		{
			flag6 = false;
		}
		bool flag7 = Main.remixWorld && fisher.heightLevel == 1 && (double)fisher.Y >= Main.rockLayer && Main.rand.Next(3) == 0;
		if (fisher.rolledEnemySpawn > 0)
		{
			return;
		}
		if (fisher.inLava)
		{
			if (fisher.CanFishInLava)
			{
				if (fisher.crate && Main.rand.Next(6) == 0)
				{
					fisher.rolledItemDrop = (Main.hardMode ? 4878 : 4877);
				}
				else if (fisher.legendary && Main.hardMode && Main.rand.Next(3) == 0)
				{
					fisher.rolledItemDrop = Main.rand.NextFromList(new short[4] { 4819, 4820, 4872, 2331 });
				}
				else if (fisher.legendary && !Main.hardMode && Main.rand.Next(3) == 0)
				{
					fisher.rolledItemDrop = Main.rand.NextFromList(new short[3] { 4819, 4820, 4872 });
				}
				else if (fisher.veryrare)
				{
					fisher.rolledItemDrop = 2312;
				}
				else if (fisher.rare)
				{
					fisher.rolledItemDrop = 2315;
				}
			}
			return;
		}
		if (fisher.inHoney)
		{
			if (fisher.rare || (fisher.uncommon && Main.rand.Next(2) == 0))
			{
				fisher.rolledItemDrop = 2314;
			}
			else if (fisher.uncommon && fisher.questFish == 2451)
			{
				fisher.rolledItemDrop = 2451;
			}
			return;
		}
		if (fisher.junk)
		{
			fisher.rolledItemDrop = Main.rand.Next(2337, 2340);
			if (Main.rand.Next(8) == 0)
			{
				fisher.rolledItemDrop = 5275;
			}
			return;
		}
		if (fisher.crate)
		{
			bool hardMode = Main.hardMode;
			if (fisher.rare && flag5)
			{
				fisher.rolledItemDrop = (hardMode ? 3984 : 3205);
			}
			else if (fisher.rare && (Main.player[owner].ZoneBeach || (Main.remixWorld && fisher.heightLevel == 1 && (double)fisher.Y >= Main.rockLayer && Main.rand.Next(2) == 0)))
			{
				fisher.rolledItemDrop = (hardMode ? 5003 : 5002);
			}
			else if (fisher.rare && flag)
			{
				fisher.rolledItemDrop = (hardMode ? 3982 : 3203);
			}
			else if (fisher.rare && flag2)
			{
				fisher.rolledItemDrop = (hardMode ? 3983 : 3204);
			}
			else if (fisher.rare && Main.player[owner].ZoneHallow)
			{
				fisher.rolledItemDrop = (hardMode ? 3986 : 3207);
			}
			else if (fisher.rare && flag3)
			{
				fisher.rolledItemDrop = (hardMode ? 3987 : 3208);
			}
			else if (fisher.rare && Main.player[owner].ZoneSnow)
			{
				fisher.rolledItemDrop = (hardMode ? 4406 : 4405);
			}
			else if (fisher.rare && Main.player[owner].ZoneDesert)
			{
				fisher.rolledItemDrop = (hardMode ? 4408 : 4407);
			}
			else if (fisher.rare && fisher.heightLevel == 0)
			{
				fisher.rolledItemDrop = (hardMode ? 3985 : 3206);
			}
			else if (fisher.veryrare || fisher.legendary)
			{
				fisher.rolledItemDrop = (hardMode ? 3981 : 2336);
			}
			else if (fisher.uncommon || fisher.rare)
			{
				fisher.rolledItemDrop = (hardMode ? 3980 : 2335);
			}
			else
			{
				fisher.rolledItemDrop = (hardMode ? 3979 : 2334);
			}
			return;
		}
		if (!NPC.combatBookWasUsed && Main.bloodMoon && fisher.legendary && Main.rand.Next(3) == 0)
		{
			fisher.rolledItemDrop = 4382;
			return;
		}
		if (Main.bloodMoon && fisher.legendary && Main.rand.Next(2) == 0)
		{
			fisher.rolledItemDrop = 5240;
			return;
		}
		if (fisher.legendary && Main.rand.Next(5) == 0)
		{
			fisher.rolledItemDrop = 2423;
			return;
		}
		if (fisher.legendary && Main.rand.Next(5) == 0)
		{
			fisher.rolledItemDrop = 3225;
			return;
		}
		if (fisher.legendary && Main.rand.Next(10) == 0)
		{
			fisher.rolledItemDrop = 2420;
			return;
		}
		if (!fisher.legendary && !fisher.veryrare && fisher.uncommon && Main.rand.Next(5) == 0)
		{
			fisher.rolledItemDrop = 3196;
			return;
		}
		if (flag5)
		{
			if (fisher.rolledItemDrop == 0 && fisher.veryrare && Main.rand.Next(7) == 0)
			{
				fisher.rolledItemDrop = 3000;
			}
		}
		else
		{
			if (flag)
			{
				if (fisher.legendary && Main.hardMode && Main.player[owner].ZoneSnow && fisher.heightLevel == 3 && Main.rand.Next(3) != 0)
				{
					fisher.rolledItemDrop = 2429;
				}
				else if (fisher.legendary && Main.hardMode && Main.rand.Next(2) == 0)
				{
					fisher.rolledItemDrop = 3210;
				}
				else if (fisher.rare)
				{
					fisher.rolledItemDrop = 2330;
				}
				else if (fisher.uncommon && fisher.questFish == 2454)
				{
					fisher.rolledItemDrop = 2454;
				}
				else if (fisher.uncommon && fisher.questFish == 2485)
				{
					fisher.rolledItemDrop = 2485;
				}
				else if (fisher.uncommon && fisher.questFish == 2457)
				{
					fisher.rolledItemDrop = 2457;
				}
				else if (fisher.uncommon)
				{
					fisher.rolledItemDrop = 2318;
				}
			}
			else if (flag2)
			{
				if (fisher.legendary && Main.hardMode && Main.player[owner].ZoneSnow && fisher.heightLevel == 3 && Main.rand.Next(3) != 0)
				{
					fisher.rolledItemDrop = 2429;
				}
				else if (fisher.legendary && Main.hardMode && Main.rand.Next(2) == 0)
				{
					fisher.rolledItemDrop = 3211;
				}
				else if (fisher.uncommon && fisher.questFish == 2477)
				{
					fisher.rolledItemDrop = 2477;
				}
				else if (fisher.uncommon && fisher.questFish == 2463)
				{
					fisher.rolledItemDrop = 2463;
				}
				else if (fisher.uncommon)
				{
					fisher.rolledItemDrop = 2319;
				}
				else if (fisher.common)
				{
					fisher.rolledItemDrop = 2305;
				}
			}
			else if (Main.player[owner].ZoneHallow)
			{
				if (flag6 && Main.rand.Next(2) == 0)
				{
					if (fisher.uncommon && fisher.questFish == 4393)
					{
						fisher.rolledItemDrop = 4393;
					}
					else if (fisher.uncommon && fisher.questFish == 4394)
					{
						fisher.rolledItemDrop = 4394;
					}
					else if (fisher.uncommon)
					{
						fisher.rolledItemDrop = 4410;
					}
					else if (Main.rand.Next(3) == 0)
					{
						fisher.rolledItemDrop = 4402;
					}
					else
					{
						fisher.rolledItemDrop = 4401;
					}
				}
				else if (fisher.legendary && Main.hardMode && Main.player[owner].ZoneSnow && fisher.heightLevel == 3 && Main.rand.Next(3) != 0)
				{
					fisher.rolledItemDrop = 2429;
				}
				else if (fisher.legendary && Main.hardMode && Main.rand.Next(2) == 0)
				{
					fisher.rolledItemDrop = 3209;
				}
				else if (fisher.legendary && Main.hardMode && Main.rand.Next(3) != 0)
				{
					fisher.rolledItemDrop = 5274;
				}
				else if (fisher.heightLevel > 1 && fisher.veryrare)
				{
					fisher.rolledItemDrop = 2317;
				}
				else if (fisher.heightLevel > 1 && fisher.uncommon && fisher.questFish == 2465)
				{
					fisher.rolledItemDrop = 2465;
				}
				else if (fisher.heightLevel < 2 && fisher.uncommon && fisher.questFish == 2468)
				{
					fisher.rolledItemDrop = 2468;
				}
				else if (fisher.rare)
				{
					fisher.rolledItemDrop = 2310;
				}
				else if (fisher.uncommon && fisher.questFish == 2471)
				{
					fisher.rolledItemDrop = 2471;
				}
				else if (fisher.uncommon)
				{
					fisher.rolledItemDrop = 2307;
				}
			}
			if (fisher.rolledItemDrop == 0 && Main.player[owner].ZoneGlowshroom && fisher.uncommon && fisher.questFish == 2475)
			{
				fisher.rolledItemDrop = 2475;
			}
			if (fisher.rolledItemDrop == 0 && flag4)
			{
				if (fisher.heightLevel < 2 && fisher.uncommon && fisher.questFish == 2467)
				{
					fisher.rolledItemDrop = 2467;
				}
				else if (fisher.heightLevel == 1 && fisher.uncommon && fisher.questFish == 2470)
				{
					fisher.rolledItemDrop = 2470;
				}
				else if (fisher.heightLevel >= 2 && fisher.uncommon && fisher.questFish == 2484)
				{
					fisher.rolledItemDrop = 2484;
				}
				else if (fisher.heightLevel > 1 && fisher.uncommon && fisher.questFish == 2466)
				{
					fisher.rolledItemDrop = 2466;
				}
				else if ((fisher.common && Main.rand.Next(12) == 0) || (fisher.uncommon && Main.rand.Next(6) == 0))
				{
					fisher.rolledItemDrop = 3197;
				}
				else if (fisher.uncommon)
				{
					fisher.rolledItemDrop = 2306;
				}
				else if (fisher.common)
				{
					fisher.rolledItemDrop = 2299;
				}
				else if (fisher.heightLevel > 1 && Main.rand.Next(3) == 0)
				{
					fisher.rolledItemDrop = 2309;
				}
			}
			if (fisher.rolledItemDrop == 0 && flag3)
			{
				if (fisher.legendary && Main.hardMode && Main.rand.Next(2) == 0)
				{
					fisher.rolledItemDrop = 5463;
				}
				else if (fisher.heightLevel == 1 && fisher.uncommon && fisher.questFish == 2452)
				{
					fisher.rolledItemDrop = 2452;
				}
				else if (fisher.heightLevel == 1 && fisher.uncommon && fisher.questFish == 2483)
				{
					fisher.rolledItemDrop = 2483;
				}
				else if (fisher.heightLevel == 1 && fisher.uncommon && fisher.questFish == 2488)
				{
					fisher.rolledItemDrop = 2488;
				}
				else if (fisher.heightLevel >= 1 && fisher.uncommon && fisher.questFish == 2486)
				{
					fisher.rolledItemDrop = 2486;
				}
				else if (fisher.heightLevel > 1 && fisher.uncommon)
				{
					fisher.rolledItemDrop = 2311;
				}
				else if (fisher.uncommon)
				{
					fisher.rolledItemDrop = 2313;
				}
				else if (fisher.common)
				{
					fisher.rolledItemDrop = 2302;
				}
			}
		}
		if (fisher.rolledItemDrop == 0)
		{
			if (flag7 || (fisher.heightLevel <= 1 && (fisher.X < 380 || fisher.X > Main.maxTilesX - 380) && fisher.waterTilesCount > 1000))
			{
				if (fisher.veryrare && Main.rand.Next(2) == 0)
				{
					fisher.rolledItemDrop = 2341;
				}
				else if (fisher.veryrare)
				{
					fisher.rolledItemDrop = 2342;
				}
				else if (fisher.rare && Main.rand.Next(5) == 0)
				{
					fisher.rolledItemDrop = 2438;
				}
				else if (fisher.rare && Main.rand.Next(3) == 0)
				{
					fisher.rolledItemDrop = 2332;
				}
				else if (fisher.uncommon && fisher.questFish == 2480)
				{
					fisher.rolledItemDrop = 2480;
				}
				else if (fisher.uncommon && fisher.questFish == 2481)
				{
					fisher.rolledItemDrop = 2481;
				}
				else if (fisher.uncommon)
				{
					fisher.rolledItemDrop = 2316;
				}
				else if (fisher.common && Main.rand.Next(2) == 0)
				{
					fisher.rolledItemDrop = 2301;
				}
				else if (fisher.common)
				{
					fisher.rolledItemDrop = 2300;
				}
				else
				{
					fisher.rolledItemDrop = 2297;
				}
			}
			else if (flag6)
			{
				if (fisher.legendary)
				{
					fisher.rolledItemDrop = 5490;
				}
				else if (fisher.uncommon && fisher.questFish == 4393)
				{
					fisher.rolledItemDrop = 4393;
				}
				else if (fisher.uncommon && fisher.questFish == 4394)
				{
					fisher.rolledItemDrop = 4394;
				}
				else if (fisher.uncommon)
				{
					fisher.rolledItemDrop = 4410;
				}
				else if (Main.rand.Next(3) == 0)
				{
					fisher.rolledItemDrop = 4402;
				}
				else
				{
					fisher.rolledItemDrop = 4401;
				}
			}
		}
		if (fisher.rolledItemDrop != 0)
		{
			return;
		}
		if (fisher.heightLevel < 2 && fisher.uncommon && fisher.questFish == 2461)
		{
			fisher.rolledItemDrop = 2461;
		}
		else if (fisher.heightLevel == 0 && fisher.uncommon && fisher.questFish == 2453)
		{
			fisher.rolledItemDrop = 2453;
		}
		else if (fisher.heightLevel == 0 && fisher.uncommon && fisher.questFish == 2473)
		{
			fisher.rolledItemDrop = 2473;
		}
		else if (fisher.heightLevel == 0 && fisher.uncommon && fisher.questFish == 2476)
		{
			fisher.rolledItemDrop = 2476;
		}
		else if (fisher.heightLevel < 2 && fisher.uncommon && fisher.questFish == 2458)
		{
			fisher.rolledItemDrop = 2458;
		}
		else if (fisher.heightLevel < 2 && fisher.uncommon && fisher.questFish == 2459)
		{
			fisher.rolledItemDrop = 2459;
		}
		else if (fisher.heightLevel == 0 && fisher.uncommon)
		{
			fisher.rolledItemDrop = 2304;
		}
		else if (fisher.heightLevel > 0 && fisher.heightLevel < 3 && fisher.uncommon && fisher.questFish == 2455)
		{
			fisher.rolledItemDrop = 2455;
		}
		else if (fisher.heightLevel == 1 && fisher.uncommon && fisher.questFish == 2479)
		{
			fisher.rolledItemDrop = 2479;
		}
		else if (fisher.heightLevel == 1 && fisher.uncommon && fisher.questFish == 2456)
		{
			fisher.rolledItemDrop = 2456;
		}
		else if (fisher.heightLevel == 1 && fisher.uncommon && fisher.questFish == 2474)
		{
			fisher.rolledItemDrop = 2474;
		}
		else if (fisher.heightLevel > 1 && fisher.rare && Main.rand.Next(5) == 0)
		{
			if (Main.hardMode && Main.rand.Next(2) == 0)
			{
				fisher.rolledItemDrop = 2437;
			}
			else
			{
				fisher.rolledItemDrop = 2436;
			}
		}
		else if (fisher.heightLevel > 1 && fisher.legendary && Main.rand.Next(3) != 0)
		{
			fisher.rolledItemDrop = 2308;
		}
		else if (fisher.heightLevel > 1 && fisher.veryrare && Main.rand.Next(2) == 0)
		{
			fisher.rolledItemDrop = 2320;
		}
		else if (fisher.heightLevel > 1 && fisher.rare)
		{
			fisher.rolledItemDrop = 2321;
		}
		else if (fisher.heightLevel > 1 && fisher.uncommon && fisher.questFish == 2478)
		{
			fisher.rolledItemDrop = 2478;
		}
		else if (fisher.heightLevel > 1 && fisher.uncommon && fisher.questFish == 2450)
		{
			fisher.rolledItemDrop = 2450;
		}
		else if (fisher.heightLevel > 1 && fisher.uncommon && fisher.questFish == 2464)
		{
			fisher.rolledItemDrop = 2464;
		}
		else if (fisher.heightLevel > 1 && fisher.uncommon && fisher.questFish == 2469)
		{
			fisher.rolledItemDrop = 2469;
		}
		else if (fisher.heightLevel > 2 && fisher.uncommon && fisher.questFish == 2462)
		{
			fisher.rolledItemDrop = 2462;
		}
		else if (fisher.heightLevel > 2 && fisher.uncommon && fisher.questFish == 2482)
		{
			fisher.rolledItemDrop = 2482;
		}
		else if (fisher.heightLevel > 2 && fisher.uncommon && fisher.questFish == 2472)
		{
			fisher.rolledItemDrop = 2472;
		}
		else if (fisher.heightLevel > 2 && fisher.uncommon && fisher.questFish == 2460)
		{
			fisher.rolledItemDrop = 2460;
		}
		else if (fisher.heightLevel > 1 && fisher.uncommon && Main.rand.Next(4) != 0)
		{
			fisher.rolledItemDrop = 2303;
		}
		else if (fisher.heightLevel > 1 && (fisher.uncommon || fisher.common || Main.rand.Next(4) == 0))
		{
			if (Main.rand.Next(4) == 0)
			{
				fisher.rolledItemDrop = 2303;
			}
			else
			{
				fisher.rolledItemDrop = 2309;
			}
		}
		else if (fisher.uncommon && fisher.questFish == 2487)
		{
			fisher.rolledItemDrop = 2487;
		}
		else if (fisher.waterTilesCount > 1000 && fisher.common)
		{
			fisher.rolledItemDrop = 2298;
		}
		else
		{
			fisher.rolledItemDrop = 2290;
		}
	}

	private void FishingCheck_ProbeForQuestFish(ref FishingAttempt fisher)
	{
		fisher.questFish = Main.anglerQuestItemNetIDs[Main.anglerQuest];
		if (Main.player[owner].HasItem(fisher.questFish))
		{
			fisher.questFish = -1;
		}
		if (!NPC.AnyNPCs(369))
		{
			fisher.questFish = -1;
		}
		if (Main.anglerQuestFinished)
		{
			fisher.questFish = -1;
		}
	}

	private void FishingCheck_RollDropLevels(int fishingLevel, out bool common, out bool uncommon, out bool rare, out bool veryrare, out bool legendary, out bool crate)
	{
		int num = 150 / fishingLevel;
		int num2 = 150 * 2 / fishingLevel;
		int num3 = 150 * 7 / fishingLevel;
		int num4 = 150 * 15 / fishingLevel;
		int num5 = 150 * 30 / fishingLevel;
		int num6 = 10;
		if (Main.player[owner].cratePotion)
		{
			num6 += 15;
		}
		if (num < 2)
		{
			num = 2;
		}
		if (num2 < 3)
		{
			num2 = 3;
		}
		if (num3 < 4)
		{
			num3 = 4;
		}
		if (num4 < 5)
		{
			num4 = 5;
		}
		if (num5 < 6)
		{
			num5 = 6;
		}
		common = false;
		uncommon = false;
		rare = false;
		veryrare = false;
		legendary = false;
		crate = false;
		if (Main.rand.Next(num) == 0)
		{
			common = true;
		}
		if (Main.rand.Next(num2) == 0)
		{
			uncommon = true;
		}
		if (Main.rand.Next(num3) == 0)
		{
			rare = true;
		}
		if (Main.rand.Next(num4) == 0)
		{
			veryrare = true;
		}
		if (Main.rand.Next(num5) == 0)
		{
			legendary = true;
		}
		if (Main.rand.Next(100) < num6)
		{
			crate = true;
		}
	}

	private static void GetFishingPondState(int x, int y, out bool lava, out bool honey, out int numWaters, out int chumCount)
	{
		lava = false;
		honey = false;
		numWaters = 0;
		chumCount = 0;
		Point tileCoords = new Point(0, 0);
		GetFishingPondWidth(x, y, out var minX, out var maxX);
		for (int i = minX; i <= maxX; i++)
		{
			for (int j = y; Main.tile[i, j] != null && Main.tile[i, j].liquid > 0 && !WorldGen.SolidTile(i, j) && j < Main.maxTilesY - 10; j++)
			{
				numWaters++;
				if (Main.tile[i, j].lava())
				{
					lava = true;
				}
				else if (Main.tile[i, j].honey())
				{
					honey = true;
				}
				tileCoords.X = i;
				tileCoords.Y = j;
				chumCount += Main.instance.ChumBucketProjectileHelper.GetChumsInLocation(tileCoords);
			}
		}
		if (honey)
		{
			numWaters = (int)((double)numWaters * 1.5);
		}
	}

	private static void GetFishingPondWidth(int x, int y, out int minX, out int maxX)
	{
		minX = x;
		maxX = x;
		while (minX > 10 && Main.tile[minX, y] != null && Main.tile[minX, y].liquid > 0 && !WorldGen.SolidTile(minX, y))
		{
			minX--;
		}
		while (maxX < Main.maxTilesX - 10 && Main.tile[maxX, y] != null && Main.tile[maxX, y].liquid > 0 && !WorldGen.SolidTile(maxX, y))
		{
			maxX++;
		}
	}

	public bool CanBeReflected()
	{
		if (active && friendly && !hostile && damage > 0)
		{
			if (type == 728 || type == 955)
			{
				return true;
			}
			if (aiStyle == 1 || aiStyle == 2 || aiStyle == 8 || aiStyle == 21 || aiStyle == 24 || aiStyle == 28 || aiStyle == 29 || aiStyle == 131)
			{
				return true;
			}
		}
		return false;
	}

	public Color GetConstellationColor(float alphaChannelMultiplier = 1f, float lerpToWhite = 0f, float? rawHueOverride = null)
	{
		float num = ai[1];
		if (rawHueOverride.HasValue)
		{
			num = rawHueOverride.Value;
		}
		float hue = (num + 0.5f) % 1f;
		float saturation = 1f;
		float luminosity = 0.5f;
		Color color = Main.hslToRgb(hue, saturation, luminosity);
		color *= Opacity;
		if (lerpToWhite != 0f)
		{
			color = Color.Lerp(color, Color.White, lerpToWhite);
		}
		color.A = (byte)((float)(int)color.A * alphaChannelMultiplier);
		return color;
	}

	public Color GetFairyQueenWeaponsColor(float alphaChannelMultiplier = 1f, float lerpToWhite = 0f, float? rawHueOverride = null)
	{
		float hueRaw = ai[1];
		if (rawHueOverride.HasValue)
		{
			hueRaw = rawHueOverride.Value;
		}
		return GetFairyQueenWeaponsColorFull(owner, base.Center, hueRaw, alphaChannelMultiplier, lerpToWhite, Opacity);
	}

	public static Color GetFairyQueenWeaponsColorFull(int playerIndex, Vector2 center, float hueRaw, float alphaChannelMultiplier = 1f, float lerpToWhite = 0f, float Opacity = 1f, float luminance = 0.5f)
	{
		float saturation = 1f;
		float num = (hueRaw + 0.5f) % 1f;
		if (playerIndex != -1)
		{
			Player player = Main.player[playerIndex];
			if (player.active)
			{
				switch (player.name)
				{
				case "Cenx":
				{
					float amount17 = Utils.PingPongFrom01To010(num);
					amount17 = MathHelper.SmoothStep(0f, 1f, amount17);
					amount17 = MathHelper.SmoothStep(0f, 1f, amount17);
					Color color4 = Color.Lerp(new Color(0.3f, 1f, 0.2f), Color.HotPink, amount17);
					if (lerpToWhite != 0f)
					{
						color4 = Color.Lerp(color4, Color.White, lerpToWhite);
					}
					color4.A = (byte)((float)(int)color4.A * alphaChannelMultiplier);
					return color4;
				}
				case "Crowno":
					luminance = MathHelper.Lerp(0.25f, 0.4f, Utils.Turn01ToCyclic010(num));
					num = MathHelper.Lerp(127f / 180f, 47f / 60f, Utils.Turn01ToCyclic010(num));
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.5f, 0.5f);
					break;
				case "Yoraiz0r":
					num = MathHelper.Lerp(0.9f, 0.95f, Utils.Turn01ToCyclic010(num));
					break;
				case "Jaxrud":
					num = MathHelper.Lerp(13f / 72f, 0.43611112f, Utils.Turn01ToCyclic010(num));
					break;
				case "Lazure":
					num = MathHelper.Lerp(8f / 15f, 83f / 90f, Utils.Turn01ToCyclic010(num));
					break;
				case "Leinfors":
					num = MathHelper.Lerp(0.7f, 0.77f, Utils.Turn01ToCyclic010(num));
					break;
				case "Grox The Great":
					num = MathHelper.Lerp(0.31f, 0.5f, Utils.Turn01ToCyclic010(num));
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 1f, 0.8f);
					break;
				case "Acamaeda":
					num = MathHelper.Lerp(0.06f, 0.28f, Utils.Turn01ToCyclic010(num));
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.6f, 0.5f);
					break;
				case "Alchemystics":
					num = MathHelper.Lerp(0.74f, 0.96f, Utils.Turn01ToCyclic010(num));
					luminance = 0.6f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.6f, 0.5f);
					break;
				case "Antithesis":
				{
					num = 0.51f;
					float amount18 = (float)Math.Cos(hueRaw * ((float)Math.PI * 2f)) * 0.5f + 0.5f;
					luminance = MathHelper.Lerp(0f, 0.5f, amount18);
					break;
				}
				case "Artyrian":
				{
					float amount16 = Utils.PingPongFrom01To010(num);
					amount16 = MathHelper.SmoothStep(0f, 1f, amount16);
					amount16 = MathHelper.SmoothStep(0f, 1f, amount16);
					Color color3 = Color.Lerp(new Color(1f, 0.31f, 0f), new Color(0.7f, 0f, 1f), amount16);
					if (lerpToWhite != 0f)
					{
						color3 = Color.Lerp(color3, Color.White, lerpToWhite);
					}
					color3.A = (byte)((float)(int)color3.A * alphaChannelMultiplier);
					return color3;
				}
				case "Aurora3500":
					num = MathHelper.Lerp(0.33f, 0.8f, Utils.Turn01ToCyclic010(num));
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.5f, 0.5f);
					break;
				case "Bame":
				{
					float amount15 = Utils.PingPongFrom01To010(num);
					amount15 = MathHelper.SmoothStep(0f, 1f, amount15);
					amount15 = MathHelper.SmoothStep(0f, 1f, amount15);
					Color color2 = Color.Lerp(Color.Yellow, new Color(0.4f, 0f, 0.75f), amount15);
					if (lerpToWhite != 0f)
					{
						color2 = Color.Lerp(color2, Color.White, lerpToWhite);
					}
					color2.A = (byte)((float)(int)color2.A * alphaChannelMultiplier);
					return color2;
				}
				case "CheesyPaninie":
					num = MathHelper.Lerp(0.88f, 1.09f, Utils.Turn01ToCyclic010(num));
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.5f, 0.5f);
					break;
				case "Criddle":
					num = MathHelper.Lerp(0.05f, 0.15f, Utils.Turn01ToCyclic010(num));
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.5f, 0.5f);
					break;
				case "Darthkitten":
				{
					num = 1f;
					float amount14 = (float)Math.Cos(hueRaw * ((float)Math.PI * 2f)) * 0.5f + 0.5f;
					luminance = MathHelper.Lerp(1f, 0.4f, amount14);
					break;
				}
				case "darthmorf":
				{
					num = 0f;
					float amount13 = (float)Math.Cos(hueRaw * ((float)Math.PI * 2f)) * 0.5f + 0.5f;
					luminance = MathHelper.Lerp(0f, 0.2f, amount13);
					break;
				}
				case "Discipile":
				{
					num = 0.53f;
					float amount12 = (float)Math.Cos(hueRaw * ((float)Math.PI * 2f)) * 0.5f + 0.5f;
					luminance = MathHelper.Lerp(0.05f, 0.5f, amount12);
					break;
				}
				case "Doylee":
					num = MathHelper.Lerp(0.68f, 1f, Utils.Turn01ToCyclic010(num));
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.6f, 0.5f);
					break;
				case "Ghostar":
				{
					num = 0.66f;
					float amount11 = (float)Math.Cos(hueRaw * ((float)Math.PI * 2f)) * 0.5f + 0.5f;
					luminance = MathHelper.Lerp(0.15f, 0.85f, amount11);
					break;
				}
				case "GreyL1me":
				{
					num = 0.24f;
					float amount10 = (float)Math.Cos(hueRaw * ((float)Math.PI * 2f)) * 0.5f + 0.5f;
					luminance = MathHelper.Lerp(0.4f, 0.6f, amount10);
					alphaChannelMultiplier = 0.3f;
					break;
				}
				case "Jenosis":
					num = MathHelper.Lerp(0.9f, 1.13f, Utils.Turn01ToCyclic010(num)) % 1f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.5f, 0.5f);
					break;
				case "jopojelly":
				case "Jopojelly":
				{
					Vector2 vector = player.Center - center;
					float num2 = 10f;
					float amount8 = Utils.Turn01ToCyclic010(num);
					float value = MathHelper.Lerp(0.072f, 0.086f, amount8);
					float value2 = MathHelper.Lerp(0.47f, 0.55f, amount8);
					float amount9 = MathHelper.Clamp(vector.X / num2, -1f, 1f) * 0.5f + 0.5f;
					num = MathHelper.Lerp(value, value2, amount9);
					break;
				}
				case "Kazzymodus":
				{
					num = 0.33f;
					float amount7 = (float)Math.Cos(hueRaw * ((float)Math.PI * 2f)) * 0.5f + 0.5f;
					luminance = MathHelper.Lerp(0.15f, 0.4f, amount7);
					break;
				}
				case "Khaios":
				{
					num = 0.33f;
					float amount6 = (float)Math.Cos(hueRaw * ((float)Math.PI * 2f)) * 0.5f + 0.5f;
					luminance = MathHelper.Lerp(0f, 0.2f, amount6);
					break;
				}
				case "Loki":
				{
					num = 0f;
					float amount5 = (float)Math.Cos(hueRaw * ((float)Math.PI * 2f)) * 0.5f + 0.5f;
					luminance = MathHelper.Lerp(0f, 0.25f, amount5);
					break;
				}
				case "ManaUser":
					num = MathHelper.Lerp(0.41f, 0.57f, Utils.Turn01ToCyclic010(num));
					break;
				case "Mid":
				{
					num = 0f;
					float amount4 = (float)Math.Cos(hueRaw * ((float)Math.PI * 2f)) * 0.5f + 0.5f;
					luminance = MathHelper.Lerp(0f, 0.9f, amount4);
					break;
				}
				case "Nimbus":
					num = MathHelper.Lerp(0.75f, 1f, Utils.Turn01ToCyclic010(num));
					luminance = 1f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.5f, 0.8f);
					break;
				case "Nike Leon":
					num = MathHelper.Lerp(0.04f, 0.1f, Utils.Turn01ToCyclic010(num));
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.5f, 0.5f);
					break;
				case "ppowersteef":
					num = MathHelper.Lerp(0f, 0.15f, Utils.Turn01ToCyclic010(num));
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.6f, 0.5f);
					break;
				case "RBrandon":
					num = 0.03f;
					luminance = 0.3f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.6f, 0.5f);
					break;
				case "Redigit":
					num = 0.7f;
					break;
				case "Serenity":
				{
					num = 0.85f;
					float amount3 = (float)Math.Cos(hueRaw * ((float)Math.PI * 2f)) * 0.5f + 0.5f;
					luminance = MathHelper.Lerp(1f, 0.5f, amount3);
					break;
				}
				case "Sigma":
					num = MathHelper.Lerp(0f, 0.12f, Utils.Turn01ToCyclic010(num));
					luminance = 0.5f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.6f, 0.5f);
					break;
				case "teiull":
					num = MathHelper.Lerp(0.66f, 1f, Utils.Turn01ToCyclic010(num));
					luminance = 0.5f;
					break;
				case "Unit One":
				{
					float amount2 = Utils.PingPongFrom01To010(num);
					amount2 = MathHelper.SmoothStep(0f, 1f, amount2);
					Color color = Color.Lerp(Color.Yellow, Color.Blue, amount2);
					if (lerpToWhite != 0f)
					{
						color = Color.Lerp(color, Color.White, lerpToWhite);
					}
					color.A = (byte)((float)(int)color.A * alphaChannelMultiplier);
					return color;
				}
				case "Vulpes Inculta":
					num = MathHelper.Lerp(0.65f, 0.75f, Utils.Turn01ToCyclic010(num));
					luminance = 0.5f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.5f, 0.5f);
					break;
				case "Waze3174":
					num = MathHelper.Lerp(0.33f, 0f, Utils.Turn01ToCyclic010(num));
					luminance = 0.3f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.6f, 0.5f);
					break;
				case "Xman101":
				{
					num = 0.06f;
					float amount = (float)Math.Cos(hueRaw * ((float)Math.PI * 2f)) * 0.5f + 0.5f;
					luminance = MathHelper.Lerp(0f, 0.5f, amount);
					break;
				}
				case "Zoomo":
					num = 0.77f;
					luminance = 0.5f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.6f, 0.5f);
					break;
				}
			}
		}
		Color color5 = Main.hslToRgb(num, saturation, luminance);
		color5 *= Opacity;
		if (lerpToWhite != 0f)
		{
			color5 = Color.Lerp(color5, Color.White, lerpToWhite);
		}
		color5.A = (byte)((float)(int)color5.A * alphaChannelMultiplier);
		return color5;
	}

	public float GetLastPrismHue(float laserIndex, ref float laserLuminance, ref float laserAlphaMultiplier)
	{
		if (Main.player[owner].active)
		{
			double timeForVisualEffects = Main.timeForVisualEffects;
			switch (Main.player[owner].name)
			{
			case "Cenx":
			{
				float amount = Utils.PingPongFrom01To010(laserIndex / 6f);
				amount = MathHelper.SmoothStep(0f, 1f, amount);
				amount = MathHelper.SmoothStep(0f, 1f, amount);
				return Main.rgbToHsl(Color.Lerp(new Color(0.3f, 1f, 0.2f), Color.HotPink, amount)).X;
			}
			case "Crowno":
				laserLuminance = MathHelper.Lerp(0.25f, 0.4f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 105.0 * 6.2831854820251465)));
				laserAlphaMultiplier = 0.5f;
				return MathHelper.Lerp(127f / 180f, 47f / 60f, Utils.Turn01ToCyclic010(laserIndex / 6f));
			case "Tsuki":
			case "Yoraiz0r":
				return 0.92f;
			case "Lazure":
				return MathHelper.Lerp(8f / 15f, 83f / 90f, Utils.Turn01ToCyclic010(laserIndex / 6f));
			case "Jaxrud":
				return MathHelper.Lerp(13f / 72f, 0.43611112f, Utils.Turn01ToCyclic010(laserIndex / 6f));
			case "Ghostar":
				laserLuminance = MathHelper.Lerp(0.4f, 0.7f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 120.0 * 6.2831854820251465)));
				laserAlphaMultiplier = 0.3f;
				return 0.66f;
			case "Devalaous":
				return 0.66f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.1f;
			case "Leinfors":
				return 0.73f + (float)Math.Cos(timeForVisualEffects / 3.0 * 6.2831854820251465) * 0.03f;
			case "Aeroblop":
				return 0.25f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.1f;
			case "Doylee":
				return 0.84f + (float)Math.Cos(timeForVisualEffects / 90.0 * 6.2831854820251465) * 0.16f;
			case "Darkhalis":
			case "Arkhalis":
				return 0.75f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.07f;
			case "Nike Leon":
				return 0.07f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.04f;
			case "Suweeka":
				return 0.5f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.18f;
			case "W1K":
				return 0.75f + (float)Math.Cos(timeForVisualEffects / 120.0 * 6.2831854820251465) * 0.05f;
			case "Grox The Great":
				return 0.41f + (float)Math.Cos(timeForVisualEffects / 120.0 * 6.2831854820251465) * 0.1f;
			case "Acamaeda":
				return 0.18f + (float)Math.Cos(timeForVisualEffects / 90.0 * 6.2831854820251465) * 0.1f;
			case "Alchemystics":
				return 0.73f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.18f;
			case "Antithesis":
				laserLuminance = 0.25f;
				laserAlphaMultiplier = 0.4f;
				return 0.7f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.05f;
			case "Artyrian":
			{
				float amount3 = Utils.PingPongFrom01To010(laserIndex / 6f);
				amount3 = MathHelper.SmoothStep(0f, 1f, amount3);
				amount3 = MathHelper.SmoothStep(0f, 1f, amount3);
				return Main.rgbToHsl(Color.Lerp(new Color(1f, 0.31f, 0f), new Color(0.7f, 0f, 1f), amount3)).X;
			}
			case "Aurora3500":
				laserLuminance = MathHelper.Lerp(0f, 0.5f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 105.0 * 6.2831854820251465)));
				laserAlphaMultiplier = 0.25f;
				return 0.35f;
			case "Bame":
			{
				float amount2 = Utils.PingPongFrom01To010(laserIndex / 6f);
				amount2 = MathHelper.SmoothStep(0f, 1f, amount2);
				amount2 = MathHelper.SmoothStep(0f, 1f, amount2);
				return Main.rgbToHsl(Color.Lerp(Color.Yellow, new Color(0.2f, 0f, 0.7f), amount2)).X;
			}
			case "CheesyPaninie":
				return 0.98f + (float)Math.Cos(timeForVisualEffects / 90.0 * 6.2831854820251465) * 0.105f;
			case "Criddle":
				laserLuminance = 0.75f + (float)Math.Cos(timeForVisualEffects / 150.0 * 6.2831854820251465) * -0.25f;
				return 0.89f + (float)Math.Cos(timeForVisualEffects / 300.0 * 6.2831854820251465) * 0.17f;
			case "Darthkitten":
				laserLuminance = MathHelper.Lerp(0.4f, 0.9f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 120.0 * 6.2831854820251465)));
				laserAlphaMultiplier = 0.3f;
				return 1f;
			case "darthmorf":
				laserLuminance = MathHelper.Lerp(0f, 0.2f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 105.0 * 6.2831854820251465)));
				laserAlphaMultiplier = 0.4f;
				return 0f;
			case "Discipile":
				laserLuminance = MathHelper.Lerp(0f, 0.4f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 105.0 * 6.2831854820251465)));
				laserAlphaMultiplier = 0.35f;
				return 0.55f;
			case "GreyL1me":
				laserLuminance = MathHelper.Lerp(0.4f, 0.6f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 105.0 * 6.2831854820251465)));
				laserAlphaMultiplier = 0.3f;
				return 0.24f;
			case "Jenosis":
				return 0.66f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.08f;
			case "jopojelly":
			case "Jopojelly":
				if ((int)laserIndex % 2 != 0)
				{
					return MathHelper.Lerp(0.072f, 0.086f, laserIndex / 3f);
				}
				return MathHelper.Lerp(0.47f, 0.55f, laserIndex / 3f);
			case "Kazzymodus":
				laserLuminance = MathHelper.Lerp(0.6f, 0.8f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 90.0 * 6.2831854820251465)));
				laserAlphaMultiplier = 0.3f;
				return 0.33f;
			case "Khaios":
				laserLuminance = MathHelper.Lerp(0f, 0.1f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 105.0 * 6.2831854820251465)));
				laserAlphaMultiplier = 0.25f;
				return 0.35f;
			case "Loki":
				laserLuminance = MathHelper.Lerp(0f, 0.3f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 5.0 * 6.2831854820251465)));
				laserAlphaMultiplier = 0.4f;
				return 0f;
			case "ManaUser":
				return 0.49f + (float)Math.Cos(timeForVisualEffects / 140.0 * 6.2831854820251465) * 0.08f;
			case "Mid":
				laserLuminance = 0.25f;
				laserAlphaMultiplier = 0.4f;
				return 0.86f + (float)Math.Cos(timeForVisualEffects / 270.0 * 6.2831854820251465) * 0.13f;
			case "Nimbus":
				laserLuminance = MathHelper.Lerp(0f, 0.3f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 20.0 * 6.2831854820251465)));
				laserAlphaMultiplier = 0.2f;
				return 0.75f;
			case "ppowersteef":
				laserLuminance = MathHelper.Lerp(0.1f, 0.5f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 105.0 * 6.2831854820251465)));
				laserAlphaMultiplier = 0.25f;
				return 0.6f;
			case "RBrandon":
				laserLuminance = MathHelper.Lerp(0f, 0.5f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 105.0 * 6.2831854820251465)));
				laserAlphaMultiplier = 0.4f;
				return 1f;
			case "Redigit":
				return 0.7f;
			case "Serenity":
				laserLuminance = MathHelper.Lerp(0.9f, 0.65f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 120.0 * 6.2831854820251465)));
				laserAlphaMultiplier = 0.3f;
				return 0.85f;
			case "Sigma":
				return 0.06f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.06f;
			case "teiull":
				return 0.5f + (float)Math.Cos(timeForVisualEffects / 45.0 * 6.2831854820251465) * 0.3f;
			case "Unit One":
				return 0.38f + (float)Math.Cos(timeForVisualEffects / 90.0 * 6.2831854820251465) * 0.24f;
			case "Vulpes Inculta":
				return 0.7f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.05f;
			case "Waze3174":
				return 0.38f + (float)Math.Cos(timeForVisualEffects / 90.0 * 6.2831854820251465) * 0.24f;
			case "Xman101":
				laserLuminance = MathHelper.Lerp(0.9f, 0.55f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 120.0 * 6.2831854820251465)));
				laserAlphaMultiplier = 0.2f;
				return 0.33f;
			case "Zoomo":
				return 0.77f;
			case "Random":
				return Main.rand.NextFloat();
			}
		}
		return (float)(int)laserIndex / 6f;
	}

	public static int GetByUUID(int owner, float uuid)
	{
		return GetByUUID(owner, (int)uuid);
	}

	public static int GetByUUID(int owner, int uuid)
	{
		if (uuid < 0 || uuid >= 1000 || owner < 0 || owner >= 255)
		{
			return -1;
		}
		int num = Main.projectileIdentity[owner, uuid];
		if (num >= 0 && Main.projectile[num].active)
		{
			return num;
		}
		return -1;
	}

	public void ProjectileFixDesperation()
	{
		if (owner < 0 || owner >= 255)
		{
			return;
		}
		switch (type)
		{
		case 461:
		case 632:
		case 642:
		case 644:
		{
			for (int i = 0; i < 1000; i++)
			{
				if (Main.projectile[i].owner == owner && (float)Main.projectile[i].identity == ai[1] && Main.projectile[i].active)
				{
					ai[1] = i;
					break;
				}
			}
			break;
		}
		}
	}

	public bool ShouldUseWindPhysics()
	{
		if (Main.windPhysics)
		{
			bool? flag = ProjectileID.Sets.WindPhysicsImmunity[type];
			if (flag.HasValue)
			{
				return !flag.Value;
			}
			switch (aiStyle)
			{
			case 1:
			case 2:
			case 8:
			case 10:
			case 14:
			case 16:
			case 17:
			case 21:
			case 24:
			case 28:
			case 29:
			case 32:
			case 33:
			case 34:
			case 35:
			case 49:
			case 72:
			case 93:
			case 96:
			case 106:
				return true;
			}
		}
		return false;
	}

	private void AI_151_SuperStar()
	{
		alpha -= 10;
		int num = 100;
		if (alpha < num)
		{
			alpha = num;
		}
		if (soundDelay == 0)
		{
			soundDelay = 20 + Main.rand.Next(40);
			SoundEngine.PlaySound(SoundID.Item9, position);
		}
		rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.005f * (float)direction;
		Vector2 vector = new Vector2(Main.screenWidth, Main.screenHeight);
		if (base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector / 2f, vector + new Vector2(400f))) && Main.rand.Next(6) == 0)
		{
			Gore.NewGore(position, velocity * 0.2f, Utils.SelectRandom<int>(Main.rand, 16, 17, 17, 17));
		}
		for (int i = 0; i < 2; i++)
		{
			if (Main.rand.Next(8) == 0)
			{
				int num2 = 228;
				Dust dust = Dust.NewDustDirect(position, width, height, num2, 0f, 0f, 127);
				dust.velocity *= 0.25f;
				dust.scale = 1.3f;
				dust.noGravity = true;
				dust.velocity += velocity.RotatedBy((float)Math.PI / 8f * (1f - (float)(2 * i))) * 0.2f;
			}
		}
	}

	public bool IsInterruptible(Player player)
	{
		int num = aiStyle;
		if (num == 160)
		{
			return true;
		}
		return false;
	}

	public void Interrupt(Player player)
	{
		int num = aiStyle;
		if (num == 160)
		{
			Kill();
			player.heldProj = -1;
			player.itemAnimation = 0;
			player.itemTime = 0;
		}
	}

	public static IEntitySource GetNoneSource()
	{
		return null;
	}

	public IEntitySource GetNPCSource_FromThis()
	{
		return new EntitySource_Parent(this);
	}

	public IEntitySource GetProjectileSource_FromThis()
	{
		return new EntitySource_Parent(this);
	}

	public IEntitySource GetItemSource_DropAsItem()
	{
		return new EntitySource_DropAsItem(this);
	}

	public IEntitySource GetItemSource_FromThis()
	{
		return new EntitySource_Parent(this);
	}

	public IEntitySource GetProjectileSource_OnHit(Entity victim, int projectileSourceId)
	{
		return new EntitySource_OnHit_ByProjectileSourceID(this, victim, projectileSourceId);
	}

	public IEntitySource GetItemSource_OnHit(Entity victim, int itemSourceId)
	{
		return new EntitySource_OnHit_ByItemSourceID(this, victim, itemSourceId);
	}

	public static IEntitySource InheritSource(Projectile projectile)
	{
		return projectile?.GetProjectileSource_FromThis();
	}

	private void AI_152_SuperStarSlash()
	{
		float num = (float)Math.PI / 2f;
		bool flag = true;
		if (type == 976)
		{
			flag = false;
		}
		if (flag)
		{
			int num2 = 10;
			int num3 = 100;
			if (type == 1045)
			{
				num3 = 0;
				num2 = 50;
			}
			alpha -= num2;
			if (alpha < num3)
			{
				alpha = num3;
			}
		}
		int num4 = 10;
		if (type == 1045)
		{
			num4 = 24;
		}
		if (soundDelay == 0)
		{
			if (type == 977)
			{
				soundDelay = -1;
				SoundEngine.PlaySound(SoundID.Item1, position);
			}
			else if (type == 1045)
			{
				soundDelay = -1;
				SoundEngine.PlaySound(SoundID.Item1, position);
			}
			else if (type == 976)
			{
				soundDelay = -1;
			}
			else
			{
				soundDelay = 20 + Main.rand.Next(40);
				SoundEngine.PlaySound(SoundID.Item9, position);
			}
		}
		if (ai[0] != 0f)
		{
			if (type == 976)
			{
				velocity = velocity.RotatedBy(ai[0]);
			}
			else
			{
				int num5 = num4 * MaxUpdates;
				velocity = velocity.RotatedBy(ai[0] / (float)num5);
			}
		}
		if (type == 977)
		{
			velocity *= 0.96f;
			if (Main.rand.Next(8) == 0)
			{
				Dust dust = Dust.NewDustDirect(base.Center, 0, 0, 172, velocity.X * 0.1f, velocity.Y * 0.1f, 100, default(Color), 0.9f);
				dust.noGravity = true;
				dust.position = base.Center;
				dust.velocity = Main.rand.NextVector2Circular(1f, 1f) + velocity * 0.5f;
			}
		}
		if (type == 1045)
		{
			velocity *= 0.96f;
			if (Main.rand.Next(8) == 0)
			{
				Dust dust2 = Dust.NewDustDirect(base.Center, 0, 0, 229, velocity.X * 0.1f, velocity.Y * 0.1f, 100, default(Color), 0.9f);
				dust2.noGravity = true;
				dust2.position = base.Center;
				dust2.velocity = Main.rand.NextVector2Circular(1f, 1f) + velocity * 0.5f;
			}
		}
		if (type == 976)
		{
			if (Collision.LavaCollision(position, width, height))
			{
				Kill();
				return;
			}
			if (++frameCounter >= 2)
			{
				frameCounter = 0;
				if (++frame >= 7)
				{
					frame = 0;
				}
			}
			float fromValue = 60 - timeLeft;
			float fromMax = ai[1] + 20f;
			float num6 = Utils.Remap(fromValue, ai[1], fromMax, 0f, 1f) * Utils.Remap(fromValue, ai[1], ai[1] + 60f, 1f, 0f);
			velocity = velocity.SafeNormalize(Vector2.UnitY) * (4f + 12f * (1f - num6));
			Opacity = Utils.Remap(fromValue, 0f, 10f, 0f, 1f) * Utils.Remap(fromValue, 30f, 60f, 1f, 0f);
			num = 0f;
			if (Main.rand.Next(3) == 0)
			{
				Dust dust3 = Dust.NewDustDirect(position, width, height, 40, 0f, 0f, 0, default(Color), 1.2f);
				dust3.noGravity = true;
				dust3.velocity = velocity * 0.5f;
			}
			if (localAI[1] == 0f)
			{
				localAI[1] = 1f;
				for (int i = 0; i < 10; i++)
				{
					Dust.NewDustDirect(position, width, height, 40, 0f, 0f, 0, default(Color), 0.7f).velocity = velocity.SafeNormalize(Vector2.UnitY).RotatedBy(Main.rand.NextFloat() * ((float)Math.PI * 2f) * 0.25f) * (Main.rand.NextFloat() * 3f);
				}
			}
		}
		rotation = velocity.ToRotation() + num;
		tileCollide = false;
	}

	public void Resize(int newWidth, int newHeight)
	{
		position = base.Center;
		width = newWidth;
		height = newHeight;
		base.Center = position;
	}

	private void Shimmer()
	{
		if ((hostile && aiStyle != 25 && aiStyle != 17) || (aiStyle == 99 && ai[0] == -1f) || (aiStyle == 15 && (ai[0] == 2f || ai[0] == 4f)))
		{
			return;
		}
		if (type == 502)
		{
			velocity.Y -= 0.4f;
			timeLeft -= 5;
		}
		else if (type == 469 || type == 181 || type == 566)
		{
			velocity.Y -= 0.2f;
			if (type == 469 && velocity.Y < 0f)
			{
				Kill();
			}
		}
		else if (type == 819 || type == 117 || type == 474 || type == 225 || type == 103 || type == 2 || type == 82 || type == 120 || type == 172 || type == 41 || type == 91 || type == 278 || type == 5 || type == 639 || type == 631 || type == 495 || type == 4 || type == 282 || type == 1 || type == 81)
		{
			velocity.Y -= 0.4f;
		}
		else if (ProjectileID.Sets.IsAPhaseblade[type])
		{
			if (ai[0] == 1f)
			{
				return;
			}
			ai[1] = 0f;
			ai[0] = 0f;
			if (velocity.Y > -11f)
			{
				if (velocity.Y > 16f)
				{
					velocity.Y *= 0.9f;
				}
				velocity.Y -= 0.5f;
			}
			velocity.X *= 1.1f;
			velocity.X = Utils.Clamp(velocity.X, -14f, 14f);
		}
		else if (aiStyle == 1 || aiStyle == 16 || aiStyle == 40 || type == 229)
		{
			int num = (int)(base.Center.X / 16f);
			int num2 = (int)(position.Y / 16f);
			if (WorldGen.InWorld(num, num2) && Main.tile[num, num2] != null && Main.tile[num, num2].liquid == byte.MaxValue && Main.tile[num, num2].shimmer() && WorldGen.InWorld(num, num2 - 1) && Main.tile[num, num2 - 1] != null && Main.tile[num, num2 - 1].liquid > 0 && Main.tile[num, num2 - 1].shimmer())
			{
				Kill();
			}
			else if (velocity.Y > 0f)
			{
				velocity.Y *= -1f;
				netUpdate = true;
				if (timeLeft > 600)
				{
					timeLeft = 600;
				}
				timeLeft -= 60;
				shimmerWet = false;
				wet = false;
			}
		}
		else if (aiStyle == 5 || aiStyle == 8 || aiStyle == 21 || aiStyle == 28 || aiStyle == 29 || aiStyle == 33 || aiStyle == 36 || aiStyle == 47 || aiStyle == 93 || aiStyle == 115 || aiStyle == 151 || aiStyle == 152 || type == 1024 || type == 669)
		{
			int num3 = (int)(base.Center.X / 16f);
			int num4 = (int)(position.Y / 16f);
			if (WorldGen.InWorld(num3, num4) && Main.tile[num3, num4] != null && Main.tile[num3, num4].liquid == byte.MaxValue && Main.tile[num3, num4].shimmer() && WorldGen.InWorld(num3, num4 - 1) && Main.tile[num3, num4 - 1] != null && Main.tile[num3, num4 - 1].liquid > 0 && Main.tile[num3, num4 - 1].shimmer())
			{
				Kill();
			}
			else if (velocity.Y > 0f)
			{
				velocity.Y *= -1f;
				netUpdate = true;
				shimmerWet = false;
				wet = false;
			}
		}
		else if (aiStyle == 15)
		{
			if (velocity.Y > 0f)
			{
				velocity.Y *= -1f;
				netUpdate = true;
			}
			velocity.Y -= 0.4f;
			if (velocity.Y < -8f)
			{
				velocity.Y = -8f;
			}
		}
		else if (aiStyle == 99)
		{
			if (velocity.Y > 0f)
			{
				velocity.Y *= -1f;
				netUpdate = true;
				shimmerWet = false;
				wet = false;
			}
			if (velocity.Y > -8f)
			{
				velocity.Y = -8f;
			}
		}
		else if (aiStyle == 7 || aiStyle == 9 || aiStyle == 13 || aiStyle == 35 || aiStyle == 53 || aiStyle == 197 || aiStyle == 130 || aiStyle == 134 || aiStyle == 137 || aiStyle == 138 || aiStyle == 149 || aiStyle == 160)
		{
			Kill();
		}
		else if (aiStyle == 2)
		{
			velocity.Y -= 0.7f;
			if (type == 936 && !NPC.unlockedSlimeRainbowSpawn && velocity.Y < 0f)
			{
				if (timeLeft > 5)
				{
					timeLeft = 5;
				}
				if (Main.netMode != 1)
				{
					NPC.unlockedSlimeRainbowSpawn = true;
					NetMessage.SendData(7);
					int num5 = NPC.NewNPC(GetNPCSource_FromThis(), (int)base.Center.X + 4, (int)base.Center.Y, 681);
					NPC obj = Main.npc[num5];
					obj.velocity = velocity;
					obj.netUpdate = true;
					WorldGen.CheckAchievement_RealEstateAndTownSlimes();
				}
			}
			else
			{
				timeLeft -= 20;
			}
		}
		else if (aiStyle == 14 || aiStyle == 16)
		{
			if (timeLeft > 3000)
			{
				timeLeft -= 60;
			}
			velocity.Y -= 0.5f;
		}
		else if (aiStyle == 25 || aiStyle == 17)
		{
			if (velocity.Y > 10f)
			{
				velocity.Y *= 0.97f;
			}
			velocity.Y -= 0.7f;
			if (velocity.Y < -10f)
			{
				velocity.Y = -10f;
			}
		}
	}

	public void AI_AdjustPlayerItemRotationToFaceProjectile(int itemIDPlayerNeedsToBeHolding = -1, float minSpeed = 0f)
	{
		if (alpha > 0)
		{
			return;
		}
		Player player = Main.player[owner];
		if (player.HeldItem == null || (itemIDPlayerNeedsToBeHolding > -1 && player.HeldItem.type != itemIDPlayerNeedsToBeHolding) || player.HeldItem.shoot != type)
		{
			return;
		}
		float x = velocity.X;
		float y = velocity.Y;
		Vector2 center = base.Center;
		x = player.MountedCenter.X - center.X;
		y = player.MountedCenter.Y + player.gfxOffY - center.Y;
		if (!(minSpeed > 0f) || !(Math.Abs(x) + Math.Abs(y) <= minSpeed))
		{
			int num = -1;
			if (base.Center.X < player.MountedCenter.X)
			{
				num = 1;
			}
			player.itemRotation = (float)Math.Atan2(y * (float)num, x * (float)num);
		}
	}

	private void AI_DisplayDoll_Reset(Player doll)
	{
		spriteDirection = (direction = doll.direction);
		base.Center = doll.MountedCenter;
	}

	public void AI_DisplayDoll(Player doll, TEDisplayDoll.DisplayDollPose pose, out bool botherDrawing)
	{
		AI_DisplayDoll_Reset(doll);
		botherDrawing = true;
		bool flag = false;
		DisplayDollPoseID pose2 = pose.Pose;
		if ((uint)(pose2 - 4) <= 4u)
		{
			flag = true;
		}
		switch (aiStyle)
		{
		default:
			botherDrawing = false;
			break;
		case 19:
		{
			direction = doll.direction;
			spriteDirection = -direction;
			Vector2 unitX = Vector2.UnitX;
			float num2 = 0f;
			if (pose.ItemAimRadians.HasValue)
			{
				num2 = pose.ItemAimRadians.Value;
			}
			unitX = unitX.RotatedBy(num2);
			if (direction == -1)
			{
				unitX.X *= -1f;
			}
			velocity = unitX;
			int itemAnimation = 25;
			switch (type)
			{
			case 367:
			case 368:
				itemAnimation = 20;
				break;
			case 130:
				position += velocity * 44f;
				itemAnimation = 50;
				break;
			case 877:
			case 878:
			case 879:
				position += velocity * 74f;
				itemAnimation = 50;
				alpha = 0;
				break;
			}
			position += velocity * AI_019_Spears_GetSpearOffsetRelativeToPlayer(doll, itemAnimation, 100);
			rotation = (float)Math.Atan2(unitX.Y, unitX.X) + (float)Math.PI / 2f + (float)Math.PI / 4f;
			if (spriteDirection == -1)
			{
				rotation -= (float)Math.PI / 2f;
			}
			if (!flag)
			{
				botherDrawing = false;
			}
			break;
		}
		case 20:
		{
			spriteDirection = direction;
			Vector2 spinningpoint3 = Vector2.UnitX * 20f;
			float num5 = 0f;
			if (pose.ItemAimRadians.HasValue)
			{
				num5 = pose.ItemAimRadians.Value;
			}
			spinningpoint3 = spinningpoint3.RotatedBy(num5);
			if (direction == -1)
			{
				spinningpoint3.X *= -1f;
			}
			velocity = spinningpoint3;
			position += spinningpoint3;
			rotation = (float)Math.Atan2(spinningpoint3.Y, spinningpoint3.X) + (float)Math.PI / 2f;
			if (!flag)
			{
				botherDrawing = false;
			}
			break;
		}
		case 75:
		case 161:
		{
			spriteDirection = direction;
			Vector2 spinningpoint2 = Vector2.UnitX * 12f;
			float num3 = 0f;
			if (pose.ItemAimRadians.HasValue)
			{
				num3 = pose.ItemAimRadians.Value;
			}
			spinningpoint2 = spinningpoint2.RotatedBy(num3);
			if (direction == -1)
			{
				spinningpoint2.X *= -1f;
			}
			velocity = spinningpoint2;
			position += spinningpoint2;
			float num4 = (float)Math.PI / 2f;
			if (aiStyle == 161)
			{
				position += spinningpoint2 * 1.5f;
			}
			switch (type)
			{
			case 595:
			case 615:
			case 630:
			case 705:
			case 714:
			case 735:
				num4 = 0f;
				if (spriteDirection == -1)
				{
					num4 = (float)Math.PI;
				}
				break;
			case 927:
				num4 = 0f;
				break;
			case 842:
				position -= spinningpoint2 * 0.7f;
				break;
			}
			rotation = (float)Math.Atan2(spinningpoint2.Y, spinningpoint2.X) + num4;
			if (!flag)
			{
				botherDrawing = false;
			}
			break;
		}
		case 140:
		case 142:
		{
			spriteDirection = direction;
			Vector2 spinningpoint4 = Vector2.UnitX * 12f;
			float num6 = 0f;
			if (pose.ItemAimRadians.HasValue)
			{
				num6 = pose.ItemAimRadians.Value;
			}
			spinningpoint4 = spinningpoint4.RotatedBy(num6);
			if (direction == -1)
			{
				spinningpoint4.X *= -1f;
			}
			velocity = spinningpoint4;
			position += spinningpoint4;
			float num7 = (float)Math.PI / 2f;
			int num8 = type;
			if (num8 != 699)
			{
				num7 = 0f;
				if (spriteDirection == -1)
				{
					num7 = (float)Math.PI;
				}
			}
			else
			{
				num7 = (float)Math.PI / 4f * (float)direction;
				if (spriteDirection == -1)
				{
					num7 = (float)Math.PI / 4f * (float)direction + (float)Math.PI;
				}
				position += new Vector2(1f, -1f).RotatedBy(num6) * 75f * new Vector2(doll.direction, 1f);
				if (pose.Pose == DisplayDollPoseID.Use2)
				{
					position.X -= doll.direction * 4;
				}
				if (pose.Pose == DisplayDollPoseID.Use5)
				{
					position.Y -= 8f;
				}
			}
			alpha = 0;
			rotation = (float)Math.Atan2(spinningpoint4.Y, spinningpoint4.X) + num7;
			if (type == 699)
			{
				position += new Vector2(110 * direction, -6f).RotatedBy(rotation);
				position += spinningpoint4.SafeNormalize(Vector2.Zero) * -20f;
			}
			if (!flag)
			{
				botherDrawing = false;
			}
			break;
		}
		case 99:
			spriteDirection = direction;
			position = new Vector2(doll.Center.X + (float)(9 * doll.direction), doll.Bottom.Y - 8f);
			if (!flag)
			{
				botherDrawing = false;
			}
			break;
		case 15:
			spriteDirection = direction;
			position = new Vector2(doll.Center.X + (float)(9 * doll.direction), doll.Bottom.Y - 12f);
			if (!flag)
			{
				botherDrawing = false;
			}
			break;
		case 100:
		{
			Vector2 zero = Vector2.Zero;
			zero.X = (float)doll.direction * 6f;
			zero.Y = doll.gravDir * -14f;
			rotation = ((doll.gravDir == 1f) ? 0f : ((float)Math.PI));
			spriteDirection = direction;
			Vector2 vector = Main.OffsetsPlayerOnhand[doll.bodyFrame.Y / 56] * 2f;
			if (doll.direction != 1)
			{
				vector.X = (float)doll.bodyFrame.Width - vector.X;
			}
			if (doll.gravDir != 1f)
			{
				vector.Y = (float)doll.bodyFrame.Height - vector.Y;
			}
			vector -= new Vector2(doll.bodyFrame.Width - doll.width, doll.bodyFrame.Height - 42) / 2f;
			base.Center = (doll.RotatedRelativePoint(doll.MountedCenter - new Vector2(20f, 42f) / 2f + vector + zero) - velocity).Floor();
			if (!flag)
			{
				botherDrawing = false;
			}
			break;
		}
		case 165:
		{
			ai[0] = 12f;
			ai[1] = 0.4f;
			Vector2 spinningpoint = Vector2.UnitX * 1f;
			float num = 0f;
			if (pose.ItemAimRadians.HasValue)
			{
				num = pose.ItemAimRadians.Value;
			}
			spinningpoint = spinningpoint.RotatedBy(num);
			if (direction == -1)
			{
				spinningpoint.X *= -1f;
			}
			velocity = spinningpoint;
			base.Center = Main.GetPlayerArmPosition(this, doll) + velocity * (ai[0] - 1f);
			spriteDirection = ((!(Vector2.Dot(velocity, Vector2.UnitX) < 0f)) ? 1 : (-1));
			if (!flag)
			{
				botherDrawing = false;
			}
			break;
		}
		}
	}

	public void AI()
	{
		if (aiStyle == 1)
		{
			AI_001();
		}
		else if (aiStyle == 2)
		{
			if (Main.windPhysics)
			{
				velocity.X += Main.windSpeedCurrent * Main.windPhysicsStrength;
			}
			if (type == 93 && Main.rand.Next(5) == 0)
			{
				int num = Dust.NewDust(base.position, width, height, 57, velocity.X * 0.2f + (float)(direction * 3), velocity.Y * 0.2f, 100);
				Main.dust[num].noGravity = true;
				Main.dust[num].fadeIn = 1f;
				Main.dust[num].velocity.X *= 0.3f;
				Main.dust[num].velocity.Y *= 0.3f;
			}
			if (type == 968)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					Vector2 vector = Main.player[owner].velocity;
					float num2 = Utils.Remap(vector.Length(), 0f, 3f, 0f, 0.5f);
					Vector2 vector2 = base.Center + new Vector2(-8f, -8f) + velocity.SafeNormalize(Vector2.Zero) * 25f;
					for (int i = 0; i < 8; i++)
					{
						Dust dust = Main.dust[Dust.NewDust(vector2, 16, 16, 31, velocity.X, velocity.Y, 50, default(Color), 0.75f + Main.rand.NextFloat() * 0.3f)];
						dust.velocity = (velocity * (0.2f + num2)).RotatedByRandom(0.699999988079071) + vector * 0.25f;
						Dust dust2 = dust;
						dust2.velocity *= 0f + Main.rand.NextFloat() * 1f;
						dust.fadeIn = 0.1f;
						dust2 = dust;
						dust2.position -= dust.velocity;
						dust.noGravity = true;
					}
				}
				alpha = Math.Max(0, alpha - 50);
				frame = (int)this.ai[1];
			}
			if (type == 304 && localAI[0] == 0f)
			{
				localAI[0] += 1f;
				alpha = 0;
			}
			if (type == 1085)
			{
				rotation += (float)direction * 0.4f;
			}
			else if (type == 510)
			{
				rotation += Math.Abs(velocity.X) * 0.04f * (float)direction;
			}
			else
			{
				rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.03f * (float)direction;
			}
			if (type == 909)
			{
				int num3 = 38;
				this.ai[0] += 1f;
				if (this.ai[0] >= (float)num3)
				{
					velocity.Y += 0.4f;
					velocity.X *= 0.97f;
				}
				if (Main.netMode != 1 && this.ai[1] == 0f)
				{
					this.ai[1] = 1 + Main.rand.Next(6);
					netUpdate = true;
				}
				if (this.ai[1] > 0f)
				{
					frame = (int)this.ai[1] - 1;
				}
			}
			else if (type == 162)
			{
				if (this.ai[1] == 0f)
				{
					this.ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item14, base.position);
				}
				this.ai[0] += 1f;
				if (this.ai[0] >= 18f)
				{
					velocity.Y += 0.28f;
					velocity.X *= 0.99f;
				}
				if (this.ai[0] > 2f)
				{
					alpha = 0;
					if (this.ai[0] == 3f)
					{
						for (int j = 0; j < 10; j++)
						{
							int num4 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
							Dust dust2 = Main.dust[num4];
							dust2.velocity *= 0.5f;
							dust2 = Main.dust[num4];
							dust2.velocity += velocity * 0.1f;
						}
						for (int k = 0; k < 5; k++)
						{
							int num5 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2f);
							Main.dust[num5].noGravity = true;
							Dust dust2 = Main.dust[num5];
							dust2.velocity *= 3f;
							dust2 = Main.dust[num5];
							dust2.velocity += velocity * 0.2f;
							num5 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100);
							dust2 = Main.dust[num5];
							dust2.velocity *= 2f;
							dust2 = Main.dust[num5];
							dust2.velocity += velocity * 0.3f;
						}
						for (int l = 0; l < 1; l++)
						{
							int num6 = Gore.NewGore(new Vector2(base.position.X - 10f, base.position.Y - 10f), default(Vector2), Main.rand.Next(61, 64));
							Gore gore = Main.gore[num6];
							gore.position += velocity * 1.25f;
							Main.gore[num6].scale = 1.5f;
							gore = Main.gore[num6];
							gore.velocity += velocity * 0.5f;
							gore = Main.gore[num6];
							gore.velocity *= 0.02f;
						}
					}
				}
			}
			else if (type == 281)
			{
				if (this.ai[1] == 0f)
				{
					this.ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item14, base.position);
				}
				this.ai[0] += 1f;
				if (this.ai[0] >= 18f)
				{
					velocity.Y += 0.28f;
					velocity.X *= 0.99f;
				}
				if (this.ai[0] > 2f)
				{
					alpha = 0;
					if (this.ai[0] == 3f)
					{
						for (int m = 0; m < 10; m++)
						{
							int num7 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
							Dust dust2 = Main.dust[num7];
							dust2.velocity *= 0.5f;
							dust2 = Main.dust[num7];
							dust2.velocity += velocity * 0.1f;
						}
						for (int n = 0; n < 5; n++)
						{
							int num8 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2f);
							Main.dust[num8].noGravity = true;
							Dust dust2 = Main.dust[num8];
							dust2.velocity *= 3f;
							dust2 = Main.dust[num8];
							dust2.velocity += velocity * 0.2f;
							num8 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100);
							dust2 = Main.dust[num8];
							dust2.velocity *= 2f;
							dust2 = Main.dust[num8];
							dust2.velocity += velocity * 0.3f;
						}
						for (int num9 = 0; num9 < 1; num9++)
						{
							int num10 = Gore.NewGore(new Vector2(base.position.X - 10f, base.position.Y - 10f), default(Vector2), Main.rand.Next(61, 64));
							Gore gore = Main.gore[num10];
							gore.position += velocity * 1.25f;
							Main.gore[num10].scale = 1.5f;
							gore = Main.gore[num10];
							gore.velocity += velocity * 0.5f;
							gore = Main.gore[num10];
							gore.velocity *= 0.02f;
						}
					}
				}
			}
			else if (type == 240)
			{
				if (this.ai[1] == 0f)
				{
					this.ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item14, base.position);
				}
				this.ai[0] += 1f;
				if (this.ai[0] >= 16f)
				{
					velocity.Y += 0.18f;
					velocity.X *= 0.991f;
				}
				if (this.ai[0] > 2f)
				{
					alpha = 0;
					if (this.ai[0] == 3f)
					{
						for (int num11 = 0; num11 < 7; num11++)
						{
							int num12 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
							Dust dust2 = Main.dust[num12];
							dust2.velocity *= 0.5f;
							dust2 = Main.dust[num12];
							dust2.velocity += velocity * 0.1f;
						}
						for (int num13 = 0; num13 < 3; num13++)
						{
							int num14 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2f);
							Main.dust[num14].noGravity = true;
							Dust dust2 = Main.dust[num14];
							dust2.velocity *= 3f;
							dust2 = Main.dust[num14];
							dust2.velocity += velocity * 0.2f;
							num14 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100);
							dust2 = Main.dust[num14];
							dust2.velocity *= 2f;
							dust2 = Main.dust[num14];
							dust2.velocity += velocity * 0.3f;
						}
						for (int num15 = 0; num15 < 1; num15++)
						{
							int num16 = Gore.NewGore(new Vector2(base.position.X - 10f, base.position.Y - 10f), default(Vector2), Main.rand.Next(61, 64));
							Gore gore = Main.gore[num16];
							gore.position += velocity * 1.25f;
							Main.gore[num16].scale = 1.25f;
							gore = Main.gore[num16];
							gore.velocity += velocity * 0.5f;
							gore = Main.gore[num16];
							gore.velocity *= 0.02f;
						}
					}
				}
			}
			else if (type == 497)
			{
				int num17 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 27, velocity.X, velocity.Y, 100, default(Color), 1.2f);
				Main.dust[num17].position = (Main.dust[num17].position + base.Center) / 2f;
				Main.dust[num17].noGravity = true;
				Dust dust2 = Main.dust[num17];
				dust2.velocity *= 0.3f;
				dust2 = Main.dust[num17];
				dust2.velocity -= velocity * 0.1f;
				this.ai[0] += 1f;
				if (this.ai[0] >= 30f)
				{
					velocity.X *= 0.99f;
					velocity.Y += 0.5f;
				}
				else
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				}
			}
			else if (type == 861)
			{
				if (Main.myPlayer == owner)
				{
					localAI[0]++;
					if (localAI[0] > 30f)
					{
						localAI[0] = 30f;
					}
					Player player = Main.player[owner];
					for (int num18 = 0; num18 < 255; num18++)
					{
						Player player2 = Main.player[num18];
						if (player2 != null && player2.active && !player2.dead && (player2.whoAmI != player.whoAmI || !(localAI[0] < 30f)) && Colliding(base.Hitbox, player2.Hitbox))
						{
							Kill();
							break;
						}
					}
				}
				if (velocity.Y == 0f)
				{
					velocity.X *= 0.95f;
				}
				else
				{
					velocity.X *= 0.995f;
				}
				if (Math.Abs(velocity.X) < 0.5f)
				{
					velocity.X = 0f;
				}
				if (velocity.X == 0f && velocity.Y == 0f)
				{
					Kill();
				}
				velocity.Y += 0.1f;
				if (this.ai[1] == 1f)
				{
					frame = (frameCounter = 0);
					rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.03f * (float)direction;
				}
				else
				{
					if (frame == 0)
					{
						frame = 1;
					}
					frameCounter++;
					if (frameCounter > 4)
					{
						frameCounter = 0;
						frame++;
						if (frame >= Main.projFrames[type])
						{
							frame = 1;
						}
					}
					rotation = velocity.ToRotation() + (float)Math.PI / 4f;
					spriteDirection = ((!(velocity.X < 0f)) ? 1 : (-1));
					if (spriteDirection == -1)
					{
						rotation += (float)Math.PI / 2f;
					}
				}
			}
			else if (type == 249)
			{
				this.ai[0] += 1f;
				if (this.ai[0] >= 0f)
				{
					velocity.Y += 0.25f;
				}
			}
			else if (type == 347)
			{
				this.ai[0] += 1f;
				if (this.ai[0] >= 5f)
				{
					velocity.Y += 0.25f;
				}
			}
			else if (type == 501)
			{
				this.ai[0] += 1f;
				if (this.ai[0] >= 18f)
				{
					velocity.X *= 0.995f;
					velocity.Y += 0.2f;
				}
			}
			else if (type == 504 || type == 954 || type == 979)
			{
				alpha = 255;
				this.ai[0] += 1f;
				if (this.ai[0] > 3f)
				{
					int num19 = 100;
					if (this.ai[0] > 20f)
					{
						int num20 = 40;
						float num21 = this.ai[0] - 20f;
						num19 = (int)(100f * (1f - num21 / (float)num20));
						if (num21 >= (float)num20)
						{
							Kill();
						}
					}
					if (this.ai[0] <= 10f)
					{
						num19 = (int)this.ai[0] * 10;
					}
					if (Main.rand.Next(100) < num19)
					{
						int num22 = ((type != 979) ? Dust.NewDust(base.position, width, height, 6, 0f, 0f, 150) : Dust.NewDust(base.position, width, height, 135, 0f, 0f, 150));
						Main.dust[num22].position = (Main.dust[num22].position + base.Center) / 2f;
						Main.dust[num22].noGravity = true;
						Dust dust2 = Main.dust[num22];
						dust2.velocity *= 2f;
						dust2 = Main.dust[num22];
						dust2.scale *= 1.6f;
						dust2 = Main.dust[num22];
						dust2.velocity += velocity;
					}
				}
				if (this.ai[0] >= 20f)
				{
					velocity.X *= 0.99f;
					velocity.Y += 0.1f;
				}
			}
			else if (type == 69 || type == 70 || type == 621)
			{
				this.ai[0] += 1f;
				if (this.ai[0] >= 10f)
				{
					velocity.Y += 0.25f;
					velocity.X *= 0.99f;
				}
			}
			else if (type == 166)
			{
				if (owner == Main.myPlayer && this.ai[1] == 1f)
				{
					for (int num23 = 0; num23 < Main.maxNPCs; num23++)
					{
						if (Main.npc[num23].active && Main.npc[num23].townNPC && Colliding(base.Hitbox, Main.npc[num23].Hitbox))
						{
							Kill();
							return;
						}
					}
					if (Main.netMode == 1)
					{
						for (int num24 = 0; num24 < 255; num24++)
						{
							if (num24 != owner && Main.player[num24].active && !Main.player[owner].InOpposingTeam(Main.player[num24]) && Colliding(base.Hitbox, Main.player[num24].Hitbox))
							{
								Kill();
								return;
							}
						}
					}
				}
				this.ai[0] += 1f;
				if (this.ai[0] >= 20f)
				{
					velocity.Y += 0.3f;
					velocity.X *= 0.98f;
				}
			}
			else if (type == 300)
			{
				if (this.ai[0] == 0f)
				{
					SoundEngine.PlaySound(SoundID.Item1, base.position);
				}
				this.ai[0] += 1f;
				if (this.ai[0] >= 60f)
				{
					velocity.Y += 0.2f;
					velocity.X *= 0.99f;
				}
			}
			else if (type == 306)
			{
				if (alpha <= 200)
				{
					for (int num25 = 0; num25 < 4; num25++)
					{
						float num26 = velocity.X / 4f * (float)num25;
						float num27 = velocity.Y / 4f * (float)num25;
						int num28 = Dust.NewDust(base.position, width, height, 184);
						Main.dust[num28].position.X = base.Center.X - num26;
						Main.dust[num28].position.Y = base.Center.Y - num27;
						Dust dust2 = Main.dust[num28];
						dust2.velocity *= 0f;
						Main.dust[num28].scale = 0.7f;
					}
				}
				alpha -= 50;
				if (alpha < 0)
				{
					alpha = 0;
				}
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 0.785f;
			}
			else if (type == 304)
			{
				this.ai[0] += 1f;
				if (this.ai[0] >= 30f)
				{
					alpha += 10;
					damage = (int)((double)damage * 0.9);
					knockBack = (int)((double)knockBack * 0.9);
					if (alpha >= 255)
					{
						active = false;
					}
				}
				if (this.ai[0] < 30f)
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				}
			}
			else if (type == 370 || type == 371 || type == 936)
			{
				this.ai[0] += 1f;
				if (this.ai[0] >= 15f)
				{
					velocity.Y += 0.3f;
					velocity.X *= 0.98f;
				}
			}
			else
			{
				int num29 = 20;
				if (type == 93)
				{
					num29 = 28 + Main.rand.Next(6);
				}
				this.ai[0] += 1f;
				if (this.ai[0] >= (float)num29)
				{
					if (type == 93)
					{
						this.ai[0] = 40f;
					}
					velocity.Y += 0.4f;
					velocity.X *= 0.97f;
				}
				else if (type == 48 || type == 54 || type == 93 || type == 520 || type == 599)
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				}
			}
			if (velocity.Y > 32f)
			{
				velocity.Y = 32f;
			}
			if (type == 54 && Main.rand.Next(20) == 0)
			{
				Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 40, velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.75f);
			}
		}
		else if (aiStyle == 3)
		{
			AI_003_Boomerang();
		}
		else if (aiStyle == 4)
		{
			if (Main.netMode != 2 && this.ai[1] == 0f && localAI[0] == 0f)
			{
				localAI[0] = 1f;
				LegacySoundStyle legacySoundStyle = SoundID.Item8;
				if (type == 494)
				{
					legacySoundStyle = SoundID.Item101;
				}
				SoundEngine.PlaySound(legacySoundStyle, base.Center);
			}
			rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
			if (this.ai[0] == 0f)
			{
				if (type >= 150 && type <= 152 && this.ai[1] == 0f && alpha == 255 && Main.rand.Next(2) == 0)
				{
					type++;
					netUpdate = true;
				}
				alpha -= 50;
				if (type >= 150 && type <= 152)
				{
					alpha -= 25;
				}
				else if (type == 493 || type == 494)
				{
					alpha -= 50;
				}
				if (alpha > 0)
				{
					return;
				}
				alpha = 0;
				this.ai[0] = 1f;
				if (this.ai[1] == 0f)
				{
					this.ai[1] += 1f;
					base.position += velocity * 1f;
				}
				if (type == 7 && Main.myPlayer == owner)
				{
					int num30 = type;
					if (this.ai[1] >= 6f)
					{
						num30++;
					}
					int num31 = NewProjectile(GetProjectileSource_FromThis(), base.position.X + velocity.X + (float)(width / 2), base.position.Y + velocity.Y + (float)(height / 2), velocity.X, velocity.Y, num30, damage, knockBack, owner);
					Main.projectile[num31].damage = damage;
					Main.projectile[num31].ai[1] = this.ai[1] + 1f;
					NetMessage.SendData(27, -1, -1, null, num31);
				}
				else if (type == 494 && Main.myPlayer == owner)
				{
					int num32 = type;
					if (this.ai[1] >= (float)(7 + Main.rand.Next(2)))
					{
						num32--;
					}
					int num33 = damage;
					float num34 = knockBack;
					if (num32 == 493)
					{
						num33 = (int)((double)damage * 1.25);
						num34 = knockBack * 1.25f;
					}
					int number = NewProjectile(GetProjectileSource_FromThis(), base.position.X + velocity.X + (float)(width / 2), base.position.Y + velocity.Y + (float)(height / 2), velocity.X, velocity.Y, num32, num33, num34, owner, 0f, this.ai[1] + 1f);
					NetMessage.SendData(27, -1, -1, null, number);
				}
				else if ((type == 150 || type == 151) && Main.myPlayer == owner)
				{
					int num35 = type;
					if (type == 150)
					{
						num35 = 151;
					}
					else if (type == 151)
					{
						num35 = 150;
					}
					if (this.ai[1] >= 10f && type == 151)
					{
						num35 = 152;
					}
					int num36 = NewProjectile(GetProjectileSource_FromThis(), base.position.X + velocity.X + (float)(width / 2), base.position.Y + velocity.Y + (float)(height / 2), velocity.X, velocity.Y, num35, damage, knockBack, owner);
					Main.projectile[num36].damage = damage;
					Main.projectile[num36].ai[1] = this.ai[1] + 1f;
					NetMessage.SendData(27, -1, -1, null, num36);
				}
				return;
			}
			if (alpha < 170 && alpha + 5 >= 170)
			{
				if (type >= 150 && type <= 152)
				{
					for (int num37 = 0; num37 < 8; num37++)
					{
						int num38 = Dust.NewDust(base.position, width, height, 7, velocity.X * 0.025f, velocity.Y * 0.025f, 200, default(Color), 1.3f);
						Main.dust[num38].noGravity = true;
						Dust dust2 = Main.dust[num38];
						dust2.velocity *= 0.5f;
					}
				}
				else if (type == 493 || type == 494)
				{
					for (int num39 = 0; num39 < 8; num39++)
					{
						int num40 = Dust.NewDust(base.position, width, height, Main.rand.Next(68, 71), velocity.X * 0.025f, velocity.Y * 0.025f, 200, default(Color), 1.3f);
						Main.dust[num40].noGravity = true;
						Dust dust2 = Main.dust[num40];
						dust2.velocity *= 0.5f;
					}
				}
				else
				{
					for (int num41 = 0; num41 < 3; num41++)
					{
						Dust.NewDust(base.position, width, height, 18, velocity.X * 0.025f, velocity.Y * 0.025f, 170, default(Color), 1.2f);
					}
					Dust.NewDust(base.position, width, height, 14, 0f, 0f, 170, default(Color), 1.1f);
				}
			}
			if (type >= 150 && type <= 152)
			{
				alpha += 3;
			}
			else if (type == 493 || type == 494)
			{
				alpha += 4;
			}
			else
			{
				alpha += 5;
			}
			if (alpha >= 255)
			{
				Kill();
			}
		}
		else if (aiStyle == 5)
		{
			if (Main.netMode == 2 && type == 1049)
			{
				localAI[0] += 1f;
				if (localAI[0] >= 60f)
				{
					localAI[0] = 0f;
					netUpdate = true;
				}
			}
			if (!Main.remixWorld && type == 12 && Main.dayTime && damage == 1000)
			{
				Kill();
			}
			if (type == 503 || type == 723 || type == 724 || type == 725 || type == 726)
			{
				if (base.Center.Y > this.ai[1])
				{
					tileCollide = true;
				}
			}
			else if (type == 92)
			{
				if (base.position.Y > this.ai[1])
				{
					tileCollide = true;
				}
			}
			else if (type == 9 || type == 1037)
			{
				tileCollide = base.Bottom.Y >= this.ai[1];
			}
			else
			{
				if (this.ai[1] == 0f && !Collision.SolidCollision(base.position, width, height))
				{
					this.ai[1] = 1f;
					netUpdate = true;
				}
				if (this.ai[1] != 0f)
				{
					tileCollide = true;
				}
			}
			if (type != 1037 && type != 1049 && soundDelay == 0)
			{
				soundDelay = 20 + Main.rand.Next(40);
				SoundEngine.PlaySound(SoundID.Item9, base.position);
			}
			if (type == 1037 || type == 1049)
			{
				alpha -= 10;
				int num42 = 0;
				if (base.Center.Y >= this.ai[1])
				{
					num42 = 0;
				}
				if (alpha < num42)
				{
					alpha = num42;
				}
				localAI[0] += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f * (float)direction;
			}
			else if (type == 503 || type == 9)
			{
				alpha -= 15;
				int num43 = 150;
				if (base.Center.Y >= this.ai[1])
				{
					num43 = 0;
				}
				if (alpha < num43)
				{
					alpha = num43;
				}
				localAI[0] += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f * (float)direction;
			}
			else if (type == 723 || type == 724 || type == 725 || type == 726)
			{
				alpha -= 15;
				int num44 = 100;
				if (base.Center.Y >= this.ai[1])
				{
					num44 = 0;
				}
				if (alpha < num44)
				{
					alpha = num44;
				}
				localAI[0] += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f * (float)direction;
			}
			else
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
				}
				alpha += (int)(25f * localAI[0]);
				if (alpha > 200)
				{
					alpha = 200;
					localAI[0] = -1f;
				}
				if (alpha < 0)
				{
					alpha = 0;
					localAI[0] = 1f;
				}
			}
			if (type == 503 || type == 1037 || type == 1049)
			{
				rotation = velocity.ToRotation() - (float)Math.PI / 2f;
			}
			else
			{
				rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f * (float)direction;
			}
			if (type == 503)
			{
				if (Main.rand.Next(16) == 0)
				{
					Vector2 vector3 = Vector2.UnitX.RotatedByRandom(1.5707963705062866).RotatedBy(velocity.ToRotation());
					int num45 = Dust.NewDust(base.position, width, height, 58, velocity.X * 0.5f, velocity.Y * 0.5f, 150, default(Color), 1.2f);
					Main.dust[num45].velocity = vector3 * 0.66f;
					Main.dust[num45].position = base.Center + vector3 * 12f;
				}
				if (Main.rand.Next(48) == 0)
				{
					int num46 = Gore.NewGore(base.Center, new Vector2(velocity.X * 0.2f, velocity.Y * 0.2f), 16);
					Gore gore = Main.gore[num46];
					gore.velocity *= 0.66f;
					gore = Main.gore[num46];
					gore.velocity += velocity * 0.3f;
				}
			}
			if (type == 12 || type == 955)
			{
				Vector2 vector4 = new Vector2(Main.screenWidth, Main.screenHeight);
				if (base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector4 / 2f, vector4 + new Vector2(400f))) && Main.rand.Next(6) == 0)
				{
					int num47 = Utils.SelectRandom<int>(Main.rand, 16, 17, 17, 17);
					if (Main.tenthAnniversaryWorld)
					{
						num47 = Utils.SelectRandom<int>(Main.rand, 16, 16, 16, 17);
					}
					Gore.NewGore(base.position, velocity * 0.2f, num47);
				}
				light = 0.9f;
				if (Main.rand.Next(20) == 0 || (Main.tenthAnniversaryWorld && Main.rand.Next(15) == 0))
				{
					Dust.NewDust(base.position, width, height, 58, velocity.X * 0.5f, velocity.Y * 0.5f, 150, default(Color), 1.2f);
				}
			}
			else if (type == 723 || type == 724 || type == 725 || type == 726)
			{
				if (type == 726 || type == 725 || type == 726)
				{
					Vector2 vector5 = new Vector2(Main.screenWidth, Main.screenHeight);
					if (base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector5 / 2f, vector5 + new Vector2(400f))) && Main.rand.Next(24) == 0)
					{
						Gore.NewGore(base.position, velocity * 0.2f, Utils.SelectRandom<int>(Main.rand, 16, 17));
					}
					if (Main.rand.Next(3) == 0)
					{
						Dust dust3 = Dust.NewDustDirect(base.position, width, height, 86, 0f, 0f, 127);
						Dust dust2 = dust3;
						dust2.velocity *= 0.5f;
						dust3.noGravity = true;
					}
				}
				if (type == 723)
				{
					Vector2 vector6 = new Vector2(Main.screenWidth, Main.screenHeight);
					if (base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector6 / 2f, vector6 + new Vector2(400f))) && Main.rand.Next(6) == 0)
					{
						Gore.NewGore(base.position, velocity * 0.2f, 17);
					}
					for (float num48 = 0f; num48 < 3f; num48 += 1f)
					{
						Vector2 vector7 = base.Center + new Vector2(0f, 12f * scale).RotatedBy(base.position.Y / 200f + num48 * ((float)Math.PI * 2f) + rotation) - velocity * 0.5f;
						Dust dust4 = Dust.NewDustPerfect(vector7, 267, velocity * 0.2f * num48, 0, Color.Blue);
						dust4.noLight = true;
						dust4.noGravity = true;
						dust4 = Dust.NewDustPerfect(vector7, 267, velocity * 0.2f * num48, 0, Color.White, 0.4f);
						dust4.noLight = true;
						dust4.noGravity = true;
					}
				}
			}
			else if (type == 9)
			{
				Vector2 vector8 = new Vector2(Main.screenWidth, Main.screenHeight);
				if (base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector8 / 2f, vector8 + new Vector2(400f))) && Main.rand.Next(20) == 0)
				{
					Gore.NewGore(base.position, velocity * 0.2f, Main.rand.Next(16, 18));
				}
				if (Main.rand.Next(4) == 0)
				{
					Dust dust5 = Dust.NewDustDirect(base.position, width, height, 86, 0f, 0f, 127);
					Dust dust2 = dust5;
					dust2.velocity *= 0.7f;
					dust5.noGravity = true;
					dust2 = dust5;
					dust2.velocity += velocity * 0.3f;
					if (Main.rand.Next(2) == 0)
					{
						dust2 = dust5;
						dust2.position -= velocity * 4f;
					}
				}
			}
			else if (this.ai[1] == 1f || type == 92)
			{
				light = 0.9f;
				if (Main.rand.Next(10) == 0)
				{
					Dust.NewDust(base.position, width, height, 58, velocity.X * 0.5f, velocity.Y * 0.5f, 150, default(Color), 1.2f);
				}
				if (Main.rand.Next(20) == 0)
				{
					Gore.NewGore(base.position, new Vector2(velocity.X * 0.2f, velocity.Y * 0.2f), Main.rand.Next(16, 18));
				}
			}
			if (type != 1037 && type != 1049)
			{
				return;
			}
			Vector2 vector9 = base.Center + Vector2.Normalize(velocity) * 10f;
			if (Main.rand.Next(2) == 0)
			{
				Dust dust6 = Main.dust[Dust.NewDust(base.position, width, height, (Main.rand.Next(4) == 0) ? 6 : 31)];
				dust6.position = vector9;
				dust6.velocity = (velocity.RotatedBy(1.5707963705062866) * 0.25f + velocity / 3f) * 0.9f;
				Dust dust2 = dust6;
				dust2.position += velocity.RotatedBy(1.5707963705062866);
				dust2 = dust6;
				dust2.scale *= 0.3f + 0.9f * Main.rand.NextFloat();
				dust2 = dust6;
				dust2.velocity *= Main.rand.NextFloat();
				dust6.noGravity = true;
			}
			if (Main.rand.Next(2) == 0)
			{
				Dust dust6 = Main.dust[Dust.NewDust(base.position, width, height, (Main.rand.Next(4) == 0) ? 6 : 31)];
				dust6.position = vector9;
				dust6.velocity = (velocity.RotatedBy(-1.5707963705062866) * 0.25f + velocity / 3f) * 0.9f;
				Dust dust2 = dust6;
				dust2.position += velocity.RotatedBy(-1.5707963705062866);
				dust2 = dust6;
				dust2.scale *= 0.3f + 0.9f * Main.rand.NextFloat();
				dust2 = dust6;
				dust2.velocity *= Main.rand.NextFloat();
				dust6.noGravity = true;
			}
			if (!wet)
			{
				for (int num49 = 0; num49 < 1; num49++)
				{
					Dust dust6 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(25f, 25f), 6);
					Dust dust2 = dust6;
					dust2.velocity *= 0.5f;
					dust2 = dust6;
					dust2.scale *= 1.3f;
					dust6.fadeIn = 1f;
					dust6.noGravity = true;
				}
			}
		}
		else if (aiStyle == 6)
		{
			bool flag = type == 1051;
			bool flag2 = type == 1019 || flag;
			velocity *= 0.95f;
			this.ai[0] += 1f;
			if (this.ai[0] == 180f)
			{
				Kill();
			}
			if (this.ai[1] == 0f)
			{
				this.ai[1] = 1f;
				int num50 = 10 + type;
				int num51 = 30;
				if (type == 463)
				{
					num50 = 231;
				}
				if (flag2)
				{
					num50 = 0;
					num51 = 40;
				}
				if (flag)
				{
					num51 = 50;
				}
				for (int num52 = 0; num52 < num51; num52++)
				{
					if (flag)
					{
						num50 = ((Main.rand.Next(3) == 0) ? 309 : 0);
					}
					Dust dust7 = Main.dust[Dust.NewDust(base.position, width, height, num50, velocity.X, velocity.Y, 50)];
					if (flag2)
					{
						dust7.noGravity = num52 % 3 != 0;
						if (!dust7.noGravity)
						{
							Dust dust2 = dust7;
							dust2.scale *= 1.25f;
							dust2 = dust7;
							dust2.velocity /= 2f;
							dust7.velocity.Y -= 2.2f;
						}
						else
						{
							Dust dust2 = dust7;
							dust2.scale *= 1.75f;
							dust2 = dust7;
							dust2.velocity += velocity * 0.65f;
						}
					}
				}
			}
			bool flag3 = Main.myPlayer == owner;
			if (flag2)
			{
				flag3 = Main.netMode != 1;
			}
			if (flag3 && (type == 10 || type == 11 || type == 463 || flag2))
			{
				int num53 = (int)(base.position.X / 16f) - 1;
				int num54 = (int)((base.position.X + (float)width) / 16f) + 2;
				int num55 = (int)(base.position.Y / 16f) - 1;
				int num56 = (int)((base.position.Y + (float)height) / 16f) + 2;
				if (num53 < 0)
				{
					num53 = 0;
				}
				if (num54 > Main.maxTilesX)
				{
					num54 = Main.maxTilesX;
				}
				if (num55 < 0)
				{
					num55 = 0;
				}
				if (num56 > Main.maxTilesY)
				{
					num56 = Main.maxTilesY;
				}
				Vector2 vector10 = default(Vector2);
				for (int num57 = num53; num57 < num54; num57++)
				{
					for (int num58 = num55; num58 < num56; num58++)
					{
						vector10.X = num57 * 16;
						vector10.Y = num58 * 16;
						if (!(base.position.X + (float)width > vector10.X) || !(base.position.X < vector10.X + 16f) || !(base.position.Y + (float)height > vector10.Y) || !(base.position.Y < vector10.Y + 16f))
						{
							continue;
						}
						bool flag4 = Main.tile[num57, num58].active();
						if (type == 10)
						{
							WorldGen.Convert(num57, num58, 11, 1);
						}
						if (type == 11)
						{
							WorldGen.Convert(num57, num58, 1, 1);
						}
						if (type == 463)
						{
							WorldGen.Convert(num57, num58, 4, 1);
						}
						if (!(flag4 && flag2))
						{
							continue;
						}
						int treeHeightAddon = 0;
						if (flag)
						{
							treeHeightAddon = 15;
						}
						Tile tile = Main.tile[num57, num58];
						if (tile.type >= 0 && tile.type < TileID.Count && TileID.Sets.CommonSapling[tile.type])
						{
							if (Main.remixWorld && num58 >= (int)Main.worldSurface - 1 && num58 < Main.maxTilesY - 20)
							{
								WorldGen.AttemptToGrowTreeFromSapling(num57, num58, underground: false, treeHeightAddon, ignoreWalls: true);
							}
							WorldGen.AttemptToGrowTreeFromSapling(num57, num58, num58 > (int)Main.worldSurface - 1, treeHeightAddon, ignoreWalls: true);
						}
					}
				}
			}
			if (flag2 && velocity.Length() < 0.5f)
			{
				Kill();
			}
		}
		else if (aiStyle == 7)
		{
			AI_007_GrapplingHooks();
		}
		else if (aiStyle == 8)
		{
			if (type == 258 && localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlaySound(SoundID.Item20, base.position);
			}
			if (type == 96 && localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlaySound(SoundID.Item20, base.position);
			}
			if (type == 27)
			{
				if (this.ai[1] == 1f)
				{
					extraUpdates = 5;
				}
				if (velocity.Y > 0f)
				{
					int num59 = (int)base.Center.X / 16;
					int num60 = (int)base.Center.Y / 16;
					if (WorldGen.InWorld(num59, num60) && Main.tile[num59, num60].lava())
					{
						this.ai[1] = 1f;
						velocity.Y = 0f - velocity.Y;
						for (int num61 = 0; num61 < 4; num61++)
						{
							int num62 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
							Dust dust2 = Main.dust[num62];
							dust2.velocity *= 0.6f;
							Main.dust[num62].velocity.Y -= 2f;
						}
						if (Main.rand.Next(3) == 0)
						{
							int num63 = Gore.NewGore(base.position, default(Vector2), Main.rand.Next(61, 64));
							Main.gore[num63].position.X -= 6f;
							Gore gore = Main.gore[num63];
							gore.velocity *= 0.4f;
							Main.gore[num63].velocity.Y -= 1f;
						}
					}
				}
				if (this.ai[1] == 1f && Main.rand.Next(2) == 0)
				{
					int num64 = Dust.NewDust(base.Center, 0, 0, 31, 0f, 0f, 100, default(Color), 0.8f);
					Dust dust2 = Main.dust[num64];
					dust2.velocity *= 0.2f;
				}
				if (this.ai[1] == 0f || Main.rand.Next(5) == 0)
				{
					for (int num65 = 0; num65 < 5; num65++)
					{
						float num66 = velocity.X / 3f * (float)num65;
						float num67 = velocity.Y / 3f * (float)num65;
						int num68 = 4;
						int num69 = Dust.NewDust(new Vector2(base.position.X + (float)num68, base.position.Y + (float)num68), width - num68 * 2, height - num68 * 2, 172, 0f, 0f, 100, default(Color), 1.2f);
						Main.dust[num69].noGravity = true;
						Dust dust2 = Main.dust[num69];
						dust2.velocity *= 0.1f;
						dust2 = Main.dust[num69];
						dust2.velocity += velocity * 0.1f;
						Main.dust[num69].position.X -= num66;
						Main.dust[num69].position.Y -= num67;
					}
					if (Main.rand.Next(5) == 0)
					{
						int num70 = 4;
						int num71 = Dust.NewDust(new Vector2(base.position.X + (float)num70, base.position.Y + (float)num70), width - num70 * 2, height - num70 * 2, 172, 0f, 0f, 100, default(Color), 0.6f);
						Dust dust2 = Main.dust[num71];
						dust2.velocity *= 0.25f;
						dust2 = Main.dust[num71];
						dust2.velocity += velocity * 0.5f;
					}
				}
			}
			else if (type == 502)
			{
				float num72 = (float)Main.DiscoR / 255f;
				float num73 = (float)Main.DiscoG / 255f;
				float num74 = (float)Main.DiscoB / 255f;
				num72 = (0.5f + num72) / 2f;
				num73 = (0.5f + num73) / 2f;
				num74 = (0.5f + num74) / 2f;
				Lighting.AddLight(base.Center, num72, num73, num74);
			}
			else if (type == 95 || type == 96)
			{
				int num75 = Dust.NewDust(new Vector2(base.position.X + velocity.X, base.position.Y + velocity.Y), width, height, 75, velocity.X, velocity.Y, 100, default(Color), 3f * scale);
				Main.dust[num75].noGravity = true;
			}
			else if (type == 253)
			{
				for (int num76 = 0; num76 < 2; num76++)
				{
					int num77 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 135, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
					Main.dust[num77].noGravity = true;
					Main.dust[num77].velocity.X *= 0.3f;
					Main.dust[num77].velocity.Y *= 0.3f;
				}
			}
			else
			{
				for (int num78 = 0; num78 < 2; num78++)
				{
					int num79 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
					if (type == 258 && Main.getGoodWorld)
					{
						Main.dust[num79].noLight = true;
					}
					Main.dust[num79].noGravity = true;
					Main.dust[num79].velocity.X *= 0.3f;
					Main.dust[num79].velocity.Y *= 0.3f;
				}
			}
			if (type != 27 && type != 96 && type != 258)
			{
				this.ai[1] += 1f;
			}
			if (this.ai[1] >= 20f)
			{
				velocity.Y += 0.2f;
			}
			if (type == 502)
			{
				rotation = velocity.ToRotation() + (float)Math.PI / 2f;
				if (velocity.X != 0f)
				{
					spriteDirection = (direction = Math.Sign(velocity.X));
				}
			}
			else
			{
				rotation += 0.3f * (float)direction;
			}
			if (velocity.Y > 16f)
			{
				velocity.Y = 16f;
			}
		}
		else if (aiStyle == 9)
		{
			AI_009_MagicMissiles();
		}
		else if (aiStyle == 10)
		{
			AI_010();
		}
		else if (aiStyle == 11)
		{
			bool flag5 = type == 72 || type == 86 || type == 87;
			if (flag5)
			{
				if (velocity.X > 0f)
				{
					spriteDirection = -1;
				}
				else if (velocity.X < 0f)
				{
					spriteDirection = 1;
				}
				rotation = velocity.X * 0.1f;
				frameCounter++;
				if (frameCounter >= 4)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame >= 4)
				{
					frame = 0;
				}
				if (Main.rand.Next(6) == 0)
				{
					int num80 = 56;
					if (type == 86)
					{
						num80 = 73;
					}
					else if (type == 87)
					{
						num80 = 74;
					}
					int num81 = Dust.NewDust(base.position, width, height, num80, 0f, 0f, 200, default(Color), 0.8f);
					Dust dust2 = Main.dust[num81];
					dust2.velocity *= 0.3f;
					Main.dust[num81].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cLight, Main.player[owner]);
				}
			}
			else
			{
				rotation += 0.02f;
			}
			if (type == 72)
			{
				if (Main.player[owner].blueFairy)
				{
					timeLeft = 2;
				}
			}
			else if (type == 86)
			{
				if (Main.player[owner].redFairy)
				{
					timeLeft = 2;
				}
			}
			else if (type == 87)
			{
				if (Main.player[owner].greenFairy)
				{
					timeLeft = 2;
				}
			}
			else if (type == 18 && Main.player[owner].lightOrb)
			{
				timeLeft = 2;
			}
			if (!Main.player[owner].dead)
			{
				float num82 = 3f;
				if (flag5)
				{
					num82 = 6f;
				}
				Vector2 vector11 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
				float num83 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector11.X;
				float num84 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector11.Y;
				int num85 = 800;
				int num86 = 70;
				if (type == 18)
				{
					if (Main.player[owner].controlUp)
					{
						num84 = Main.player[owner].position.Y - 40f - vector11.Y;
						num83 -= 6f;
						num86 = 4;
					}
					else if (Main.player[owner].controlDown)
					{
						num84 = Main.player[owner].position.Y + (float)Main.player[owner].height + 40f - vector11.Y;
						num83 -= 6f;
						num86 = 4;
					}
				}
				if (flag5)
				{
					num86 = 50;
				}
				float num87 = (float)Math.Sqrt(num83 * num83 + num84 * num84);
				num87 = (float)Math.Sqrt(num83 * num83 + num84 * num84);
				if (num87 > (float)num85)
				{
					base.position.X = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - (float)(width / 2);
					base.position.Y = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - (float)(height / 2);
				}
				else if (num87 > (float)num86)
				{
					float num88 = num87 - (float)num86;
					num87 = num82 / num87;
					num83 *= num87;
					num84 *= num87;
					velocity.X = num83;
					velocity.Y = num84;
					if (flag5 && velocity.Length() > num88)
					{
						velocity = velocity.SafeNormalize(Vector2.Zero) * num88;
					}
				}
				else
				{
					velocity.X = (velocity.Y = 0f);
				}
			}
			else
			{
				Kill();
			}
		}
		else if (aiStyle == 12)
		{
			if (type == 288 && localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlaySound(SoundID.Item17, base.position);
			}
			if (type == 280 || type == 288)
			{
				scale -= 0.002f;
				if (scale <= 0f)
				{
					Kill();
				}
				if (type == 288)
				{
					this.ai[0] = 4f;
				}
				if (this.ai[0] > 3f)
				{
					velocity.Y += 0.075f;
					for (int num89 = 0; num89 < 3; num89++)
					{
						float num90 = velocity.X / 3f * (float)num89;
						float num91 = velocity.Y / 3f * (float)num89;
						int num92 = 14;
						int num93 = Dust.NewDust(new Vector2(base.position.X + (float)num92, base.position.Y + (float)num92), width - num92 * 2, height - num92 * 2, 170, 0f, 0f, 100);
						Main.dust[num93].noGravity = true;
						Dust dust2 = Main.dust[num93];
						dust2.velocity *= 0.1f;
						dust2 = Main.dust[num93];
						dust2.velocity += velocity * 0.5f;
						Main.dust[num93].position.X -= num90;
						Main.dust[num93].position.Y -= num91;
					}
					if (Main.rand.Next(8) == 0)
					{
						int num94 = 16;
						int num95 = Dust.NewDust(new Vector2(base.position.X + (float)num94, base.position.Y + (float)num94), width - num94 * 2, height - num94 * 2, 170, 0f, 0f, 100, default(Color), 0.5f);
						Dust dust2 = Main.dust[num95];
						dust2.velocity *= 0.25f;
						dust2 = Main.dust[num95];
						dust2.velocity += velocity * 0.5f;
					}
				}
				else
				{
					this.ai[0] += 1f;
				}
				return;
			}
			float num96 = 0.02f;
			float num97 = 0.2f;
			if (type == 22)
			{
				num96 = 0.01f;
				num97 = 0.15f;
				if (this.ai[1] == 1f)
				{
					num97 /= 2f;
					num96 = 0f;
					extraUpdates = 0;
					penetrate = -1;
				}
				if (velocity.Y > 0f && this.ai[1] == 0f)
				{
					int num98 = (int)base.Center.X / 16;
					int num99 = (int)base.Center.Y / 16;
					if (WorldGen.InWorld(num98, num99) && Main.tile[num98, num99].lava())
					{
						LCG32Random lCG32Random = new LCG32Random((uint)this.ai[2]);
						velocity.Y = lCG32Random.NextFloat() * -4f - 4f;
						velocity.X = (lCG32Random.NextFloat() - 0.5f) * 5f;
						this.ai[1] = 1f;
						if (Main.myPlayer == owner)
						{
							netUpdate = true;
						}
						for (int num100 = 0; num100 < 4; num100++)
						{
							int num101 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
							Dust dust2 = Main.dust[num101];
							dust2.velocity *= 0.6f;
							Main.dust[num101].velocity.Y -= 2f;
						}
						if (Main.rand.Next(3) == 0)
						{
							int num102 = Gore.NewGore(base.position, default(Vector2), Main.rand.Next(61, 64));
							Main.gore[num102].position.X -= 6f;
							Gore gore = Main.gore[num102];
							gore.velocity *= 0.4f;
							Main.gore[num102].velocity.Y -= 1f;
						}
					}
				}
			}
			scale -= num96;
			if (scale <= 0f)
			{
				Kill();
			}
			if (this.ai[0] > 3f)
			{
				velocity.Y += num97;
				if (this.ai[1] == 1f && Main.rand.Next(2) == 0)
				{
					int num103 = Dust.NewDust(base.Center, 0, 0, 31, 0f, 0f, 100, default(Color), 0.8f);
					Dust dust2 = Main.dust[num103];
					dust2.velocity *= 0.1f;
				}
				if (this.ai[1] != 0f && Main.rand.Next(2) != 0)
				{
					return;
				}
				for (int num104 = 0; num104 < 1; num104++)
				{
					for (int num105 = 0; num105 < 3; num105++)
					{
						float num106 = velocity.X / 3f * (float)num105;
						float num107 = velocity.Y / 3f * (float)num105;
						int num108 = 6;
						int num109 = Dust.NewDust(new Vector2(base.position.X + (float)num108, base.position.Y + (float)num108), width - num108 * 2, height - num108 * 2, 172, 0f, 0f, 100, default(Color), 1.2f);
						Main.dust[num109].noGravity = true;
						Dust dust2 = Main.dust[num109];
						dust2.velocity *= 0.3f;
						dust2 = Main.dust[num109];
						dust2.velocity += velocity * 0.5f;
						Main.dust[num109].position.X -= num106;
						Main.dust[num109].position.Y -= num107;
					}
					if (Main.rand.Next(8) == 0)
					{
						int num110 = 6;
						int num111 = Dust.NewDust(new Vector2(base.position.X + (float)num110, base.position.Y + (float)num110), width - num110 * 2, height - num110 * 2, 172, 0f, 0f, 100, default(Color), 0.75f);
						Dust dust2 = Main.dust[num111];
						dust2.velocity *= 0.5f;
						dust2 = Main.dust[num111];
						dust2.velocity += velocity * 0.5f;
					}
				}
			}
			else
			{
				this.ai[0] += 1f;
			}
		}
		else if (aiStyle == 13)
		{
			bool flag6 = Main.player[owner].dead;
			if (!flag6)
			{
				float num112 = (Main.player[owner].Center - base.Center).Length();
				flag6 = num112 > 2000f;
			}
			if (flag6)
			{
				Kill();
				return;
			}
			if (type != 481)
			{
				int dummyItemTime = 5;
				Main.player[owner].SetDummyItemTime(dummyItemTime);
			}
			if (alpha == 0)
			{
				if (base.position.X + (float)(width / 2) > Main.player[owner].position.X + (float)(Main.player[owner].width / 2))
				{
					Main.player[owner].ChangeDir(1);
				}
				else
				{
					Main.player[owner].ChangeDir(-1);
				}
			}
			if (type == 481)
			{
				if (this.ai[0] == 0f)
				{
					extraUpdates = 1;
				}
				else
				{
					extraUpdates = 2;
				}
			}
			Vector2 vector12 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
			float num113 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector12.X;
			float num114 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector12.Y;
			float num115 = (float)Math.Sqrt(num113 * num113 + num114 * num114);
			if (type == 23 && this.ai[1] > 10f && !Main.player[owner].controlUseItem)
			{
				this.ai[0] = 1f;
			}
			if (this.ai[0] == 0f)
			{
				if (type == 23)
				{
					if (num115 > 1000f)
					{
						this.ai[0] = 1f;
					}
				}
				else if (num115 > 700f)
				{
					this.ai[0] = 1f;
				}
				else if (type == 262 && num115 > 500f)
				{
					this.ai[0] = 1f;
				}
				else if (type == 271 && num115 > 200f)
				{
					this.ai[0] = 1f;
				}
				else if (type == 273 && (Main.remixWorld ? (num115 > 300f) : (num115 > 150f)))
				{
					this.ai[0] = 1f;
				}
				else if (type == 481 && num115 > 525f)
				{
					this.ai[0] = 1f;
				}
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				this.ai[1] += 1f;
				if (this.ai[1] > 5f)
				{
					alpha = 0;
				}
				if (type == 262 && this.ai[1] > 8f)
				{
					this.ai[1] = 8f;
				}
				if (type == 271 && this.ai[1] > 8f)
				{
					this.ai[1] = 8f;
				}
				if (type == 273 && this.ai[1] > 8f)
				{
					this.ai[1] = 8f;
				}
				if (type == 481 && this.ai[1] > 8f)
				{
					this.ai[1] = 8f;
				}
				if (type == 23)
				{
					if (this.ai[1] >= 17f)
					{
						this.ai[1] = 17f;
						velocity.Y += 0.6f;
						velocity.X *= 0.995f;
					}
				}
				else if (this.ai[1] >= 10f)
				{
					this.ai[1] = 15f;
					velocity.Y += 0.3f;
				}
				if (type == 262 && velocity.X < 0f)
				{
					spriteDirection = -1;
				}
				else if (type == 262)
				{
					spriteDirection = 1;
				}
				if (type == 271 && velocity.X < 0f)
				{
					spriteDirection = -1;
				}
				else if (type == 271)
				{
					spriteDirection = 1;
				}
				if (type == 262 && this.ai[0] != 0f)
				{
					localAI[0] = -1f;
				}
			}
			else if (this.ai[0] == 1f)
			{
				if (type == 262 && localAI[0] == 0f)
				{
					if (Vector2.Distance(base.Center, Main.player[owner].Center) < 150f)
					{
						localAI[0] = -1f;
					}
					else
					{
						int num116 = 200;
						localAI[0] = num116;
						Vector2 vector13 = new Vector2(base.position.X - (float)(num116 / 2), base.position.Y - (float)(num116 / 2));
						Collision.HitTilesInACircle(vector13, velocity, num116, num116);
						SoundEngine.PlaySound(SoundID.Item14, base.position);
					}
				}
				tileCollide = false;
				rotation = (float)Math.Atan2(num114, num113) - 1.57f;
				float num117 = 20f;
				if (type == 262)
				{
					num117 = 30f;
				}
				if (num115 < 50f)
				{
					Kill();
					return;
				}
				num115 = num117 / num115;
				num113 *= num115;
				num114 *= num115;
				velocity.X = num113;
				velocity.Y = num114;
				if (type == 262 && velocity.X < 0f)
				{
					spriteDirection = 1;
				}
				else if (type == 262)
				{
					spriteDirection = -1;
				}
				if (type == 271 && velocity.X < 0f)
				{
					spriteDirection = 1;
				}
				else if (type == 271)
				{
					spriteDirection = -1;
				}
			}
			if (type == 23)
			{
				if (this.ai[0] == 0f)
				{
					AI_AdjustPlayerItemRotationToFaceProjectile(-1, 50f);
				}
			}
			else if (type == 262 || type == 273 || type == 481 || type == 271)
			{
				AI_AdjustPlayerItemRotationToFaceProjectile();
			}
		}
		else if (aiStyle == 14)
		{
			if (type == 870 && this.ai[1] > 0f)
			{
				aiStyle = 170;
			}
			if (type == 473 && Main.netMode != 2)
			{
				localAI[0] += 1f;
				if (localAI[0] >= 10f)
				{
					localAI[0] = 0f;
					int num118 = 30;
					if ((base.Center - Main.player[Main.myPlayer].Center).Length() < (float)(Main.screenWidth + num118 * 16))
					{
						Main.instance.SpelunkerProjectileHelper.AddSpotToCheck(base.Center);
					}
				}
			}
			if (type == 352)
			{
				if (localAI[1] == 0f)
				{
					localAI[1] = 1f;
				}
				alpha += (int)(25f * localAI[1]);
				if (alpha <= 0)
				{
					alpha = 0;
					localAI[1] = 1f;
				}
				else if (alpha >= 255)
				{
					alpha = 255;
					localAI[1] = -1f;
				}
				scale += localAI[1] * 0.01f;
			}
			if (type == 346)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					SoundEngine.PlaySound(SoundID.Item1, base.position);
				}
				frame = (int)this.ai[1];
				if (frame == 0)
				{
					Lighting.AddLight(base.Center, 0.25f, 0.2f, 0f);
				}
				else
				{
					Lighting.AddLight(base.Center, 0.15f, 0.15f, 0.15f);
				}
				if (owner == Main.myPlayer && timeLeft == 1)
				{
					for (int num119 = 0; num119 < 5; num119++)
					{
						float num120 = 10f;
						Vector2 vector14 = new Vector2(base.Center.X, base.Center.Y);
						float num121 = Main.rand.Next(-20, 21);
						float num122 = Main.rand.Next(-20, 0);
						float num123 = (float)Math.Sqrt(num121 * num121 + num122 * num122);
						num123 = num120 / num123;
						num121 *= num123;
						num122 *= num123;
						num121 *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
						num122 *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
						int num124 = NewProjectile(GetProjectileSource_FromThis(), vector14.X, vector14.Y, num121, num122, 347, 40, 0f, Main.myPlayer, 0f, this.ai[1]);
					}
				}
			}
			if (type == 196)
			{
				int num125 = Main.rand.Next(1, 3);
				for (int num126 = 0; num126 < num125; num126++)
				{
					int num127 = Dust.NewDust(base.position, width, height, 31, 0f, 0f, 100);
					Dust dust2 = Main.dust[num127];
					dust2.alpha += Main.rand.Next(100);
					dust2 = Main.dust[num127];
					dust2.velocity *= 0.3f;
					Main.dust[num127].velocity.X += (float)Main.rand.Next(-10, 11) * 0.025f;
					Main.dust[num127].velocity.Y -= 0.4f + (float)Main.rand.Next(-3, 14) * 0.15f;
					Main.dust[num127].fadeIn = 1.25f + (float)Main.rand.Next(20) * 0.15f;
				}
			}
			if (type == 53)
			{
				try
				{
					int num128 = (int)(base.position.X / 16f) - 1;
					int num129 = (int)((base.position.X + (float)width) / 16f) + 2;
					int num130 = (int)(base.position.Y / 16f) - 1;
					int num131 = (int)((base.position.Y + (float)height) / 16f) + 2;
					if (num128 < 0)
					{
						num128 = 0;
					}
					if (num129 > Main.maxTilesX)
					{
						num129 = Main.maxTilesX;
					}
					if (num130 < 0)
					{
						num130 = 0;
					}
					if (num131 > Main.maxTilesY)
					{
						num131 = Main.maxTilesY;
					}
					Vector2 vector15 = default(Vector2);
					for (int num132 = num128; num132 < num129; num132++)
					{
						for (int num133 = num130; num133 < num131; num133++)
						{
							Tile tile2 = Main.tile[num132, num133];
							if (tile2 == null || !tile2.nactive() || !Main.tileSolid[tile2.type] || Main.tileSolidTop[tile2.type])
							{
								continue;
							}
							vector15.X = num132 * 16;
							vector15.Y = num133 * 16;
							if (base.position.X + (float)width > vector15.X && base.position.X < vector15.X + 16f && base.position.Y + (float)height > vector15.Y && base.position.Y < vector15.Y + 16f)
							{
								velocity.X = 0f;
								velocity.Y = -0.2f;
								if (type >= 0 && ProjectileID.Sets.BreaksFromToyBreaker[type] && tile2.type >= 0 && TileID.Sets.BreaksToys[tile2.type])
								{
									Kill();
								}
							}
						}
					}
				}
				catch
				{
				}
			}
			if (type == 277)
			{
				if (alpha > 0)
				{
					alpha -= 30;
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				if (Main.expertMode)
				{
					float num134 = 12f;
					int num135 = Player.FindClosest(base.Center, 1, 1);
					Vector2 vector16 = Main.player[num135].Center - base.Center;
					vector16.Normalize();
					vector16 *= num134;
					int num136 = 200;
					velocity.X = (velocity.X * (float)(num136 - 1) + vector16.X) / (float)num136;
					if (velocity.Length() > 16f)
					{
						velocity.Normalize();
						velocity *= 16f;
					}
				}
			}
			if (type == 261)
			{
				if (localAI[1] == 0f)
				{
					localAI[1] = 1f;
					localAI[0] = 80f;
				}
				rotation += velocity.X * 0.05f;
				if (velocity.Y != 0f)
				{
					rotation += (float)spriteDirection * 0.01f;
				}
				this.ai[0]++;
				if (this.ai[0] > 15f)
				{
					if (velocity.Y == 0f && velocity.X != 0f)
					{
						velocity.X *= 0.97f;
						Math.Abs(velocity.X);
						_ = 2f;
						if (Math.Abs(velocity.X) <= 0.01f)
						{
							Kill();
						}
					}
					this.ai[0] = 15f;
					velocity.Y += 0.2f;
				}
				if (localAI[0] > 0f)
				{
					localAI[0]--;
					int num137 = 5;
					int maxValue = num137;
					if (localAI[0] < 20f)
					{
						maxValue = num137 + num137;
					}
					if (localAI[0] < 10f)
					{
						maxValue = num137 + num137 + num137;
					}
					if (Main.rand.Next(maxValue) == 0)
					{
						Dust dust8 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(width / 2, height / 2), 31);
						Dust dust2 = dust8;
						dust2.velocity *= 0.33f;
						dust8.scale = 0.7f;
					}
					if (Main.rand.Next(maxValue) == 0)
					{
						Dust dust9 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(width / 2, height / 2), 228, Main.rand.NextVector2Circular(3f, 3f));
						dust9.scale = 0.6f;
						Dust dust2 = dust9;
						dust2.velocity *= 0.33f;
					}
				}
			}
			else if (type == 277)
			{
				this.ai[0] += 1f;
				if (this.ai[0] > 15f)
				{
					this.ai[0] = 15f;
					if (velocity.Y == 0f && velocity.X != 0f)
					{
						velocity.X *= 0.97f;
						if ((double)velocity.X > -0.01 && (double)velocity.X < 0.01)
						{
							Kill();
						}
					}
					velocity.Y += 0.2f;
				}
				rotation += velocity.X * 0.05f;
			}
			else if (type == 378)
			{
				if (localAI[0] == 0f)
				{
					SoundEngine.PlaySound(SoundID.Item17, base.position);
					localAI[0] += 1f;
				}
				Rectangle rectangle = new Rectangle((int)base.position.X, (int)base.position.Y, width, height);
				for (int num138 = 0; num138 < Main.maxNPCs; num138++)
				{
					if (Main.npc[num138].CanBeChasedBy(this, ignoreDontTakeDamage: true))
					{
						Rectangle value = new Rectangle((int)Main.npc[num138].position.X, (int)Main.npc[num138].position.Y, Main.npc[num138].width, Main.npc[num138].height);
						if (rectangle.Intersects(value))
						{
							Kill();
							return;
						}
					}
				}
				this.ai[0] += 1f;
				if (this.ai[0] > 10f)
				{
					this.ai[0] = 90f;
					if (velocity.Y == 0f && velocity.X != 0f)
					{
						velocity.X *= 0.96f;
						if ((double)velocity.X > -0.01 && (double)velocity.X < 0.01)
						{
							Kill();
						}
					}
					velocity.Y += 0.2f;
				}
				rotation += velocity.X * 0.1f;
			}
			else if (type == 483)
			{
				this.ai[0] += 1f;
				if (this.ai[0] > 5f)
				{
					if (owner == Main.myPlayer && this.ai[0] > (float)Main.rand.Next(20, 130))
					{
						Kill();
					}
					if (velocity.Y == 0f && velocity.X != 0f)
					{
						velocity.X *= 0.97f;
						if ((double)velocity.X > -0.01 && (double)velocity.X < 0.01)
						{
							velocity.X = 0f;
							netUpdate = true;
						}
					}
					velocity.Y += 0.3f;
					velocity.X *= 0.99f;
				}
				rotation += velocity.X * 0.05f;
			}
			else if (type == 538)
			{
				this.ai[0] += 1f;
				if (this.ai[0] > 60f || velocity.Y >= 0f)
				{
					alpha += 6;
					velocity *= 0.5f;
				}
				else if (this.ai[0] > 5f)
				{
					velocity.Y += 0.1f;
					velocity.X *= 1.025f;
					alpha -= 23;
					scale = 0.8f * (255f - (float)alpha) / 255f;
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				if (alpha >= 255 && this.ai[0] > 5f)
				{
					Kill();
					return;
				}
			}
			else
			{
				this.ai[0] += 1f;
				if (this.ai[0] > 5f)
				{
					this.ai[0] = 5f;
					if (velocity.Y == 0f && velocity.X != 0f)
					{
						velocity.X *= 0.97f;
						if ((double)velocity.X > -0.01 && (double)velocity.X < 0.01)
						{
							velocity.X = 0f;
							netUpdate = true;
						}
					}
					velocity.Y += 0.2f;
				}
				rotation += velocity.X * 0.1f;
			}
			if (type == 538)
			{
				if (localAI[1] == 0f)
				{
					localAI[1] = 1f;
					SoundEngine.PlaySound(4, (int)base.position.X, (int)base.position.Y, 7);
				}
				if (velocity.Y < 0f && this.ai[0] < 60f)
				{
					if (Main.rand.Next(4) == 0)
					{
						int num139 = Dust.NewDust(base.position, width, height, 180, 0f, 0f, 100);
						Main.dust[num139].position = base.Center;
						Dust dust2 = Main.dust[num139];
						dust2.scale += (float)Main.rand.Next(50) * 0.01f;
						Main.dust[num139].noGravity = true;
						Main.dust[num139].velocity.Y -= 2f;
					}
					if (Main.rand.Next(6) == 0)
					{
						int num140 = Dust.NewDust(base.position, width, height, 176, 0f, 0f, 100);
						Main.dust[num140].position = base.Center;
						Dust dust2 = Main.dust[num140];
						dust2.scale += 0.3f + (float)Main.rand.Next(50) * 0.01f;
						Main.dust[num140].noGravity = true;
						dust2 = Main.dust[num140];
						dust2.velocity *= 0.1f;
					}
				}
			}
			if (type == 450)
			{
				if (this.ai[1] == 0f)
				{
					this.ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item13, base.position);
				}
				if (Main.rand.Next(2) == 0)
				{
					int num141 = Dust.NewDust(base.position, width, height, 228, 0f, 0f, 100);
					Main.dust[num141].position.X -= 2f;
					Main.dust[num141].position.Y += 2f;
					Dust dust2 = Main.dust[num141];
					dust2.scale += (float)Main.rand.Next(50) * 0.01f;
					Main.dust[num141].noGravity = true;
					Main.dust[num141].velocity.Y -= 2f;
				}
				if (Main.rand.Next(4) == 0)
				{
					int num142 = Dust.NewDust(base.position, width, height, 228, 0f, 0f, 100);
					Main.dust[num142].position.X -= 2f;
					Main.dust[num142].position.Y += 2f;
					Dust dust2 = Main.dust[num142];
					dust2.scale += 0.3f + (float)Main.rand.Next(50) * 0.01f;
					Main.dust[num142].noGravity = true;
					dust2 = Main.dust[num142];
					dust2.velocity *= 0.1f;
				}
				if (++frameCounter >= 3)
				{
					frameCounter = 0;
					if (++frame >= 5)
					{
						frame = 0;
					}
				}
				if ((double)velocity.Y < 0.25 && (double)velocity.Y > 0.15)
				{
					velocity.X *= 0.8f;
				}
				rotation = (0f - velocity.X) * 0.05f;
			}
			if (type == 480)
			{
				alpha = 255;
				int num143 = Dust.NewDust(base.position, width, height, 75, 0f, 0f, 100);
				Main.dust[num143].position.X -= 2f;
				Main.dust[num143].position.Y += 2f;
				Dust dust2 = Main.dust[num143];
				dust2.scale += (float)Main.rand.Next(50) * 0.01f;
				Main.dust[num143].noGravity = true;
				Main.dust[num143].velocity.Y -= 2f;
				if (Main.rand.Next(2) == 0)
				{
					int num144 = Dust.NewDust(base.position, width, height, 75, 0f, 0f, 100);
					Main.dust[num144].position.X -= 2f;
					Main.dust[num144].position.Y += 2f;
					dust2 = Main.dust[num144];
					dust2.scale += 0.3f + (float)Main.rand.Next(50) * 0.01f;
					Main.dust[num144].noGravity = true;
					dust2 = Main.dust[num144];
					dust2.velocity *= 0.1f;
				}
			}
			if (type >= 326 && type <= 328)
			{
				if (wet)
				{
					Kill();
				}
				if (this.ai[1] == 0f && type >= 326 && type <= 328)
				{
					this.ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item13, base.position);
				}
				if (Main.rand.Next(3) != 0)
				{
					Dust dust10 = Dust.NewDustDirect(base.position, width, height, 6);
					dust10.velocity.Y -= 2f;
					dust10.noGravity = true;
					Dust dust2 = dust10;
					dust2.scale += Main.rand.NextFloat() * 0.8f + 0.3f;
					dust2 = dust10;
					dust2.velocity += velocity * 1f;
				}
				if ((double)velocity.Y < 0.25 && (double)velocity.Y > 0.15)
				{
					velocity.X *= 0.8f;
				}
				rotation = (0f - velocity.X) * 0.05f;
			}
			if ((type >= 400 && type <= 402) || (type >= 1107 && type <= 1109))
			{
				if (wet)
				{
					Kill();
				}
				if (this.ai[1] == 0f && type >= 326 && type <= 328)
				{
					this.ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item13, base.position);
				}
				int num145 = Dust.NewDust(base.position, width, height, 6, 0f, 0f, 100);
				Main.dust[num145].position.X -= 2f;
				Main.dust[num145].position.Y += 2f;
				Dust dust2 = Main.dust[num145];
				dust2.scale += (float)Main.rand.Next(50) * 0.01f;
				Main.dust[num145].noGravity = true;
				Main.dust[num145].velocity.Y -= 2f;
				if (Main.rand.Next(2) == 0)
				{
					int num146 = Dust.NewDust(base.position, width, height, 6, 0f, 0f, 100);
					Main.dust[num146].position.X -= 2f;
					Main.dust[num146].position.Y += 2f;
					dust2 = Main.dust[num146];
					dust2.scale += 0.3f + (float)Main.rand.Next(50) * 0.01f;
					Main.dust[num146].noGravity = true;
					dust2 = Main.dust[num146];
					dust2.velocity *= 0.1f;
				}
				if (velocity.Y < 0.25f && velocity.Y > 0.15f)
				{
					velocity.X *= 0.8f;
				}
				rotation = (0f - velocity.X) * 0.05f;
			}
			if (velocity.Y > 16f)
			{
				velocity.Y = 16f;
			}
		}
		else if (aiStyle == 15)
		{
			AI_015_Flails();
		}
		else if (aiStyle == 16)
		{
			AI_016_Bombs();
		}
		else if (aiStyle == 17)
		{
			if (velocity.Y == 0f)
			{
				velocity.X *= 0.98f;
			}
			rotation += velocity.X * 0.1f;
			velocity.Y += 0.2f;
			if (Main.getGoodWorld && Math.Abs(velocity.X) + Math.Abs(velocity.Y) < 1f)
			{
				damage = 0;
				knockBack = 0f;
			}
			if (owner != Main.myPlayer)
			{
				return;
			}
			int num147 = (int)((base.position.X + (float)(width / 2)) / 16f);
			int num148 = (int)((base.position.Y + (float)height - 4f) / 16f);
			if (Main.tile[num147, num148] == null)
			{
				return;
			}
			int style = 0;
			if (type >= 201 && type <= 205)
			{
				style = type - 200;
			}
			if (type >= 527 && type <= 531)
			{
				style = type - 527 + 6;
			}
			bool flag7 = false;
			TileObject objectData = default(TileObject);
			if (TileObject.CanPlace(num147, num148, 85, style, direction, out objectData))
			{
				flag7 = TileObject.Place(objectData);
			}
			if (flag7)
			{
				NetMessage.SendObjectPlacement(-1, num147, num148, objectData.type, objectData.style, objectData.alternate, objectData.random, direction);
				SoundEngine.PlaySound(0, num147 * 16, num148 * 16);
				int num149 = Sign.ReadSign(num147, num148);
				if (num149 >= 0)
				{
					Sign.TextSign(num149, miscText);
					NetMessage.SendData(47, -1, -1, null, num149, 0f, (int)(byte)new BitsByte(b1: true));
				}
				Kill();
			}
		}
		else if (aiStyle == 18)
		{
			if (this.ai[1] == 0f && type == 44)
			{
				this.ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item8, base.position);
			}
			if (type == 263 || type == 274)
			{
				if (type == 274 && velocity.X < 0f)
				{
					spriteDirection = -1;
				}
				rotation += (float)direction * 0.05f;
				rotation += (float)direction * 0.5f * ((float)timeLeft / 180f);
				if (type == 274)
				{
					velocity *= 0.96f;
				}
				else
				{
					velocity *= 0.95f;
				}
				return;
			}
			if (type == 1092)
			{
				Lighting.AddLight(base.Center, 0.3f, 0.25f, 0.1f);
				if (this.ai[0] == 0f)
				{
					frame = Main.rand.Next(6) * 9 + Main.rand.Next(3);
					velocity.Y = -3f;
					this.ai[0] = 1f;
					for (int num150 = 0; num150 < 6; num150++)
					{
						Dust dust11 = Dust.NewDustDirect(base.Bottom, 1, 1, 269, Main.rand.Next(-10, 11), Main.rand.Next(-10, 11), 100, Color.White, 1.5f);
						dust11.noLight = true;
						dust11.noGravity = true;
					}
				}
				if (this.ai[0] == 1f)
				{
					velocity.Y *= 0.95f;
					Player player3 = null;
					if (this.ai[1] < 20f)
					{
						player3 = Main.player[(int)this.ai[2]];
						int num151 = Math.Sign(player3.position.X - base.position.X);
						float targetAngle = base.Center.AngleTo(player3.Center) + (float)Math.PI / 2f;
						rotation = rotation.AngleTowards(targetAngle, 0.25f);
					}
					if (this.ai[1]-- <= 0f)
					{
						this.ai[0] = 2f;
						if (!player3.active)
						{
							Kill();
						}
						Vector2 vector17 = (player3.Center - base.Center).SafeNormalize(Vector2.One);
						velocity = vector17 * 9f;
						frame = frame / 9 * 9 + 3 + Main.rand.Next(6);
					}
				}
				else if (this.ai[0] == 2f)
				{
					int num152 = Math.Sign(velocity.X);
					if (num152 == 0)
					{
						num152 = 1;
					}
					rotation += velocity.Length() * (float)num152 * 0.03f;
					for (int num153 = 0; num153 < 1; num153++)
					{
						if (Main.rand.Next(5) == 0)
						{
							Gore gore2 = Gore.NewGoreDirect(base.TopLeft + Main.rand.NextVector2Square(0f, 1f) * base.Size, new Vector2(velocity.X * 1.5f, (0f - Main.rand.NextFloat()) * 16f), Utils.SelectRandom<int>(Main.rand, 1007, 1008, 1008));
							gore2.timeLeft = 60;
							gore2.alpha = 50;
							gore2.velocity.X += velocity.X;
						}
					}
				}
				if (Main.rand.Next(15) == 0)
				{
					Dust dust12 = Dust.NewDustDirect(base.Left, width, 4, 269, 0f, 0f, 0, Color.White, 1.2f);
					dust12.velocity.X = 0f;
					dust12.velocity.Y = 0.5f;
					dust12.velocity.X += velocity.X * 0.5f;
					dust12.velocity.Y += velocity.Y * 0.25f;
					dust12.noLight = true;
				}
				return;
			}
			rotation += (float)direction * 0.8f;
			this.ai[0] += 1f;
			if (!(this.ai[0] < 30f))
			{
				if (this.ai[0] < 100f)
				{
					velocity *= 1.06f;
				}
				else
				{
					this.ai[0] = 200f;
				}
			}
			for (int num154 = 0; num154 < 2; num154++)
			{
				int num155 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 27, 0f, 0f, 100);
				Main.dust[num155].noGravity = true;
			}
		}
		else if (aiStyle == 19)
		{
			AI_019_Spears();
		}
		else if (aiStyle == 20)
		{
			timeLeft = 60;
			if (type == 252)
			{
				frameCounter++;
				if (frameCounter >= 4)
				{
					frameCounter = 0;
					frame++;
				}
				if (frame > 3)
				{
					frame = 0;
				}
			}
			if (type == 509)
			{
				frameCounter++;
				if (frameCounter >= 2)
				{
					frameCounter = 0;
					frame++;
				}
				if (frame > 1)
				{
					frame = 0;
				}
			}
			if (soundDelay <= 0)
			{
				if (Main.player[owner].inventory[Main.player[owner].selectedItem].pick > 0)
				{
					SoundEngine.PlaySound(SoundID.Item190, base.position);
					soundDelay = 15;
				}
				else
				{
					SoundEngine.PlaySound(SoundID.Item189, base.position);
					soundDelay = 20;
				}
			}
			Vector2 vector18 = Main.player[owner].RotatedRelativePoint(Main.player[owner].MountedCenter);
			if (Main.myPlayer == owner)
			{
				if (Main.player[owner].channel)
				{
					float num156 = Main.player[owner].inventory[Main.player[owner].selectedItem].shootSpeed * scale;
					Vector2 vector19 = vector18;
					float num157 = (float)Main.mouseX + Main.screenPosition.X - vector19.X;
					float num158 = (float)Main.mouseY + Main.screenPosition.Y - vector19.Y;
					if (Main.player[owner].gravDir == -1f)
					{
						num158 = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector19.Y;
					}
					float num159 = (float)Math.Sqrt(num157 * num157 + num158 * num158);
					num159 = (float)Math.Sqrt(num157 * num157 + num158 * num158);
					num159 = num156 / num159;
					num157 *= num159;
					num158 *= num159;
					if (num157 != velocity.X || num158 != velocity.Y)
					{
						netUpdate = true;
					}
					velocity.X = num157;
					velocity.Y = num158;
				}
				else
				{
					Kill();
				}
			}
			if (velocity.X > 0f)
			{
				Main.player[owner].ChangeDir(1);
			}
			else if (velocity.X < 0f)
			{
				Main.player[owner].ChangeDir(-1);
			}
			spriteDirection = direction;
			Main.player[owner].ChangeDir(direction);
			Main.player[owner].heldProj = whoAmI;
			Main.player[owner].SetDummyItemTime(2);
			base.position.X = vector18.X - (float)(width / 2);
			base.position.Y = vector18.Y - (float)(height / 2);
			rotation = (float)(Math.Atan2(velocity.Y, velocity.X) + 1.5700000524520874);
			if (Main.player[owner].direction == 1)
			{
				Main.player[owner].itemRotation = (float)Math.Atan2(velocity.Y * (float)direction, velocity.X * (float)direction);
			}
			else
			{
				Main.player[owner].itemRotation = (float)Math.Atan2(velocity.Y * (float)direction, velocity.X * (float)direction);
			}
			velocity.X *= 1f + (float)Main.rand.Next(-3, 4) * 0.01f;
			if (Main.rand.Next(6) == 0)
			{
				int num160 = Dust.NewDust(base.position + velocity * Main.rand.Next(6, 10) * 0.1f, width, height, 31, 0f, 0f, 80, default(Color), 1.4f);
				Main.dust[num160].position.X -= 4f;
				Main.dust[num160].noGravity = true;
				Dust dust2 = Main.dust[num160];
				dust2.velocity *= 0.2f;
				Main.dust[num160].velocity.Y = (float)(-Main.rand.Next(7, 13)) * 0.15f;
			}
		}
		else if (aiStyle == 21)
		{
			rotation = velocity.X * 0.1f;
			spriteDirection = -direction;
			if (Main.rand.Next(3) == 0)
			{
				int num161 = Dust.NewDust(base.position, width, height, 27, 0f, 0f, 80);
				Main.dust[num161].noGravity = true;
				Dust dust2 = Main.dust[num161];
				dust2.velocity *= 0.2f;
			}
			if (this.ai[1] == 1f)
			{
				this.ai[1] = 0f;
				Main.musicPitch = this.ai[0];
				SoundEngine.PlaySound(SoundID.Item26, base.position);
			}
		}
		else if (aiStyle == 22)
		{
			if (velocity.X == 0f && velocity.Y == 0f)
			{
				alpha = 255;
			}
			Dust dust2;
			if (this.ai[1] < 0f)
			{
				if (timeLeft > 60)
				{
					timeLeft = 60;
				}
				if (velocity.X > 0f)
				{
					rotation += 0.3f;
				}
				else
				{
					rotation -= 0.3f;
				}
				int num162 = (int)(base.position.X / 16f) - 1;
				int num163 = (int)((base.position.X + (float)width) / 16f) + 2;
				int num164 = (int)(base.position.Y / 16f) - 1;
				int num165 = (int)((base.position.Y + (float)height) / 16f) + 2;
				if (num162 < 0)
				{
					num162 = 0;
				}
				if (num163 > Main.maxTilesX)
				{
					num163 = Main.maxTilesX;
				}
				if (num164 < 0)
				{
					num164 = 0;
				}
				if (num165 > Main.maxTilesY)
				{
					num165 = Main.maxTilesY;
				}
				int num166 = (int)base.position.X + 4;
				int num167 = (int)base.position.Y + 4;
				Vector2 vector20 = default(Vector2);
				for (int num168 = num162; num168 < num163; num168++)
				{
					for (int num169 = num164; num169 < num165; num169++)
					{
						if (Main.tile[num168, num169] != null && Main.tile[num168, num169].active() && Main.tile[num168, num169].type != 127 && Main.tileSolid[Main.tile[num168, num169].type] && !Main.tileSolidTop[Main.tile[num168, num169].type])
						{
							vector20.X = num168 * 16;
							vector20.Y = num169 * 16;
							if ((float)(num166 + 8) > vector20.X && (float)num166 < vector20.X + 16f && (float)(num167 + 8) > vector20.Y && (float)num167 < vector20.Y + 16f)
							{
								Kill();
							}
						}
					}
				}
				int num170 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 67);
				Main.dust[num170].noGravity = true;
				dust2 = Main.dust[num170];
				dust2.velocity *= 0.3f;
				return;
			}
			if (this.ai[0] < 0f)
			{
				if (this.ai[0] == -1f)
				{
					for (int num171 = 0; num171 < 10; num171++)
					{
						int num172 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 67, 0f, 0f, 0, default(Color), 1.1f);
						Main.dust[num172].noGravity = true;
						dust2 = Main.dust[num172];
						dust2.velocity *= 1.3f;
					}
				}
				else if (Main.rand.Next(30) == 0)
				{
					int num173 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 67, 0f, 0f, 100);
					dust2 = Main.dust[num173];
					dust2.velocity *= 0.2f;
				}
				int num174 = (int)base.position.X / 16;
				int num175 = (int)base.position.Y / 16;
				if (Main.tile[num174, num175] == null || !Main.tile[num174, num175].active())
				{
					Kill();
				}
				this.ai[0] -= 1f;
				if (this.ai[0] <= -900f && (Main.myPlayer == owner || Main.netMode == 2) && Main.tile[num174, num175].active() && Main.tile[num174, num175].type == 127)
				{
					WorldGen.KillTile(num174, num175);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(17, -1, -1, null, 0, num174, num175);
					}
					Kill();
				}
				return;
			}
			int num176 = (int)(base.position.X / 16f) - 1;
			int num177 = (int)((base.position.X + (float)width) / 16f) + 2;
			int num178 = (int)(base.position.Y / 16f) - 1;
			int num179 = (int)((base.position.Y + (float)height) / 16f) + 2;
			if (num176 < 0)
			{
				num176 = 0;
			}
			if (num177 > Main.maxTilesX)
			{
				num177 = Main.maxTilesX;
			}
			if (num178 < 0)
			{
				num178 = 0;
			}
			if (num179 > Main.maxTilesY)
			{
				num179 = Main.maxTilesY;
			}
			int num180 = (int)base.position.X + 4;
			int num181 = (int)base.position.Y + 4;
			Vector2 vector21 = default(Vector2);
			for (int num182 = num176; num182 < num177; num182++)
			{
				for (int num183 = num178; num183 < num179; num183++)
				{
					if (Main.tile[num182, num183] != null && Main.tile[num182, num183].nactive() && Main.tile[num182, num183].type != 127 && Main.tileSolid[Main.tile[num182, num183].type] && !Main.tileSolidTop[Main.tile[num182, num183].type])
					{
						vector21.X = num182 * 16;
						vector21.Y = num183 * 16;
						if ((float)(num180 + 8) > vector21.X && (float)num180 < vector21.X + 16f && (float)(num181 + 8) > vector21.Y && (float)num181 < vector21.Y + 16f)
						{
							Kill();
						}
					}
				}
			}
			if (lavaWet)
			{
				Kill();
			}
			int num184 = (int)(base.Center.X / 16f);
			int num185 = (int)(base.Center.Y / 16f);
			if (WorldGen.InWorld(num184, num185) && Main.tile[num184, num185] != null && Main.tile[num184, num185].liquid > 0 && Main.tile[num184, num185].shimmer())
			{
				Kill();
			}
			if (!active)
			{
				return;
			}
			int num186 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 67);
			Main.dust[num186].noGravity = true;
			dust2 = Main.dust[num186];
			dust2.velocity *= 0.3f;
			int num187 = (int)this.ai[0];
			int num188 = (int)this.ai[1];
			if (WorldGen.InWorld(num187, num188) && WorldGen.SolidTile(num187, num188))
			{
				if (Math.Abs(velocity.X) > Math.Abs(velocity.Y))
				{
					if (base.Center.Y < (float)(num188 * 16 + 8) && WorldGen.InWorld(num187, num188 - 1) && !WorldGen.SolidTile(num187, num188 - 1))
					{
						num188--;
					}
					else if (WorldGen.InWorld(num187, num188 + 1) && !WorldGen.SolidTile(num187, num188 + 1))
					{
						num188++;
					}
					else if (WorldGen.InWorld(num187, num188 - 1) && !WorldGen.SolidTile(num187, num188 - 1))
					{
						num188--;
					}
					else if (base.Center.X < (float)(num187 * 16 + 8) && WorldGen.InWorld(num187 - 1, num188) && !WorldGen.SolidTile(num187 - 1, num188))
					{
						num187--;
					}
					else if (WorldGen.InWorld(num187 + 1, num188) && !WorldGen.SolidTile(num187 + 1, num188))
					{
						num187++;
					}
					else if (WorldGen.InWorld(num187 - 1, num188) && !WorldGen.SolidTile(num187 - 1, num188))
					{
						num187--;
					}
				}
				else if (base.Center.X < (float)(num187 * 16 + 8) && WorldGen.InWorld(num187 - 1, num188) && !WorldGen.SolidTile(num187 - 1, num188))
				{
					num187--;
				}
				else if (WorldGen.InWorld(num187 + 1, num188) && !WorldGen.SolidTile(num187 + 1, num188))
				{
					num187++;
				}
				else if (WorldGen.InWorld(num187 - 1, num188) && !WorldGen.SolidTile(num187 - 1, num188))
				{
					num187--;
				}
				else if (base.Center.Y < (float)(num188 * 16 + 8) && WorldGen.InWorld(num187, num188 - 1) && !WorldGen.SolidTile(num187, num188 - 1))
				{
					num188--;
				}
				else if (WorldGen.InWorld(num187, num188 + 1) && !WorldGen.SolidTile(num187, num188 + 1))
				{
					num188++;
				}
				else if (WorldGen.InWorld(num187, num188 - 1) && !WorldGen.SolidTile(num187, num188 - 1))
				{
					num188--;
				}
			}
			if (velocity.X > 0f)
			{
				rotation += 0.3f;
			}
			else
			{
				rotation -= 0.3f;
			}
			if (Main.myPlayer != owner)
			{
				return;
			}
			int num189 = (int)((base.position.X + (float)(width / 2)) / 16f);
			int num190 = (int)((base.position.Y + (float)(height / 2)) / 16f);
			bool flag8 = false;
			if (num189 == num187 && num190 == num188)
			{
				flag8 = true;
			}
			if (((velocity.X <= 0f && num189 <= num187) || (velocity.X >= 0f && num189 >= num187)) && ((velocity.Y <= 0f && num190 <= num188) || (velocity.Y >= 0f && num190 >= num188)))
			{
				flag8 = true;
			}
			if (!flag8)
			{
				return;
			}
			if (WorldGen.PlaceTile(num187, num188, 127, mute: false, forced: false, owner))
			{
				if (Main.netMode == 1)
				{
					NetMessage.SendData(17, -1, -1, null, 1, num187, num188, 127f);
				}
				damage = 0;
				this.ai[0] = -1f;
				velocity *= 0f;
				alpha = 255;
				base.position.X = num187 * 16;
				base.position.Y = num188 * 16;
				netUpdate = true;
			}
			else
			{
				this.ai[1] = -1f;
			}
		}
		else if (aiStyle == 23)
		{
			if (type == 188)
			{
				if (this.ai[0] < 8f)
				{
					this.ai[0] = 8f;
				}
				localAI[0]++;
			}
			if (timeLeft > 60)
			{
				timeLeft = 60;
			}
			if (this.ai[0] > 7f)
			{
				float num191 = 1f;
				if (this.ai[0] == 8f)
				{
					num191 = 0.25f;
				}
				else if (this.ai[0] == 9f)
				{
					num191 = 0.5f;
				}
				else if (this.ai[0] == 10f)
				{
					num191 = 0.75f;
				}
				this.ai[0] += 1f;
				int num192 = 6;
				if (type == 101)
				{
					num192 = 75;
				}
				if (num192 == 6 || Main.rand.Next(2) == 0)
				{
					for (int num193 = 0; num193 < 1; num193++)
					{
						int num194 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, num192, velocity.X * 0.2f, velocity.Y * 0.2f, 100);
						Dust dust2;
						if (Main.rand.Next(3) != 0 || (num192 == 75 && Main.rand.Next(3) == 0))
						{
							Main.dust[num194].noGravity = true;
							dust2 = Main.dust[num194];
							dust2.scale *= 3f;
							Main.dust[num194].velocity.X *= 2f;
							Main.dust[num194].velocity.Y *= 2f;
						}
						if (type == 188)
						{
							dust2 = Main.dust[num194];
							dust2.scale *= 1.25f;
						}
						else
						{
							dust2 = Main.dust[num194];
							dust2.scale *= 1.5f;
						}
						Main.dust[num194].velocity.X *= 1.2f;
						Main.dust[num194].velocity.Y *= 1.2f;
						dust2 = Main.dust[num194];
						dust2.scale *= num191;
						if (num192 == 75)
						{
							dust2 = Main.dust[num194];
							dust2.velocity += velocity;
							if (!Main.dust[num194].noGravity)
							{
								dust2 = Main.dust[num194];
								dust2.velocity *= 0.5f;
							}
						}
					}
				}
			}
			else
			{
				this.ai[0] += 1f;
			}
			rotation += 0.3f * (float)direction;
		}
		else if (aiStyle == 24)
		{
			light = scale * 0.5f;
			rotation += velocity.X * 0.2f;
			this.ai[1] += 1f;
			if (type == 94)
			{
				if (Main.rand.Next(4) == 0)
				{
					int num195 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 70);
					Main.dust[num195].noGravity = true;
					Dust dust2 = Main.dust[num195];
					dust2.velocity *= 0.5f;
					dust2 = Main.dust[num195];
					dust2.scale *= 0.9f;
				}
				velocity *= 0.985f;
				if (this.ai[1] > 130f)
				{
					scale -= 0.05f;
					if ((double)scale <= 0.2)
					{
						scale = 0.2f;
						Kill();
					}
				}
				return;
			}
			velocity *= 0.96f;
			if (this.ai[1] > 15f)
			{
				scale -= 0.05f;
				if ((double)scale <= 0.2)
				{
					scale = 0.2f;
					Kill();
				}
			}
		}
		else if (aiStyle == 25)
		{
			localAI[2] += 1f;
			if (Main.netMode == 2 && (double)base.Center.Y < Main.worldSurface * 16.0 && localAI[2] % 60f == 0f)
			{
				netUpdate = true;
			}
			if (type == 1013 || type == 1048)
			{
				localAI[0]++;
			}
			if (type == 1014)
			{
				frame = Main.tileFrame[665];
			}
			bool flag9 = false;
			if (type == 1053)
			{
				if (Main.rand.Next(3) == 0)
				{
					int num196 = Dust.NewDust(new Vector2(base.position.X + 6f, base.position.Y + 6f), width - 12, height - 12, 31, 0f, 0f, 100, default(Color), 1.5f);
					Dust dust2 = Main.dust[num196];
					dust2.velocity *= 0.3f;
					Main.dust[num196].velocity.Y -= 2f;
				}
				if (Main.rand.Next(3) == 0)
				{
					int num197 = Dust.NewDust(new Vector2(base.position.X + 4f, base.position.Y + 4f), width - 8, height - 8, 6, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num197].noGravity = true;
				}
				if (Main.rand.Next(3) == 0)
				{
					int num198 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100);
					Main.dust[num198].velocity.Y -= 1f;
				}
			}
			if (type == 1054 && Main.netMode != 1)
			{
				for (int num199 = (int)(base.position.X + 1f) / 16; num199 <= (int)(base.position.X + (float)width) / 16; num199++)
				{
					for (int num200 = (int)(base.position.Y + 1f) / 16; num200 <= (int)(base.position.Y + (float)height) / 16; num200++)
					{
						if (!Main.tile[num199, num200].active() && Main.tile[num199, num200].liquid == 0 && Main.rand.Next(7) == 0)
						{
							WorldGen.PlaceTile(num199, num200, 51, mute: true);
							if (Main.netMode == 2)
							{
								NetMessage.SendTileSquare(-1, num199, num200);
							}
						}
					}
				}
			}
			if (type == 1047)
			{
				Vector3 vector22 = Main.hslToRgb(Main.GlobalTimeWrappedHourly * 120f % 300f / 300f, 1f, 0.6f).ToVector3();
				if (++frameCounter >= 2)
				{
					frameCounter = 0;
					if (++frame >= 100)
					{
						frame = 0;
					}
				}
				Vector3 vector23 = (DelegateMethods.v3_1 = vector22 * 1.4f);
				for (int num201 = 0; num201 < oldPos.Length && !(oldPos[num201] == Vector2.Zero); num201++)
				{
					float fromValue = (float)num201 / (float)oldPos.Length;
					int num202 = 1;
					float num203 = Utils.Remap(fromValue, 0f, 1f, 1f, 0f);
					num202 *= num202;
					float num204 = num203 * (float)num202;
					DelegateMethods.v3_1 = vector23 * num204;
					Point point = (oldPos[num201] + base.Size / 2f).ToTileCoordinates();
					DelegateMethods.CastLightOpen(point.X, point.Y);
				}
				tileCollide = this.ai[1] == 0f && !Collision.SolidCollision(base.position, width, height);
				if (this.ai[1] > 0f)
				{
					flag9 = !tileCollide;
					this.ai[1]--;
					if (!(this.ai[1] <= 0f))
					{
					}
				}
				else
				{
					if (Main.rand.Next(4) == 0)
					{
						RainbowBoulder_GetAreas(out var _, out var playArea, out var _);
						if (!base.Hitbox.Intersects(playArea))
						{
							RainbowBoulder_PerformSmartBounce();
						}
					}
					if (owner == Main.myPlayer && Main.rand.Next(180) == 0)
					{
						RainbowBoulder_PerformSmartBounce();
					}
				}
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.ShimmerBlock, new ParticleOrchestraSettings
				{
					PositionInWorld = base.Center + Main.rand.NextVector2CircularEdge(width / 2, height / 2),
					MovementVector = velocity * 0.05f
				});
			}
			if (type == 1055)
			{
				if ((double)rotation < Math.PI * -2.0)
				{
					rotation += (float)Math.PI * 2f;
				}
				else if ((double)rotation > Math.PI * 2.0)
				{
					rotation -= (float)Math.PI * 2f;
				}
				if (this.ai[1] == 1f)
				{
					flag9 = true;
					bool flag10 = false;
					int num205 = Player.FindClosest(base.position, width, height);
					if (base.Right.X > Main.player[num205].Left.X && base.Left.X < Main.player[num205].Right.X)
					{
						flag10 = true;
					}
					else if (base.Center.X < Main.player[num205].Center.X)
					{
						if (Main.player[num205].direction > 0)
						{
							flag10 = true;
						}
					}
					else if (Main.player[num205].direction < 0)
					{
						flag10 = true;
					}
					if (flag10)
					{
						if (localAI[0] < 84f)
						{
							localAI[0] += 3f;
						}
						else
						{
							localAI[0] = 84f;
						}
						if (frame < 7)
						{
							frameCounter++;
							if (frameCounter > 3)
							{
								frame++;
								frameCounter = 0;
							}
						}
						else if (frame > 7)
						{
							frameCounter++;
							if (frameCounter > 3)
							{
								frame--;
								frameCounter = 0;
							}
						}
						else
						{
							frame = 7;
							frameCounter = 0;
						}
						tileCollide = false;
						float num206 = 6f;
						int num207 = 35;
						rotation *= 0.6f;
						if (velocity.X < 0f)
						{
							spriteDirection = -1;
						}
						else if (velocity.X > 0f)
						{
							spriteDirection = 1;
						}
						Vector2 vector24 = Main.player[num205].Center - base.Center;
						vector24.Normalize();
						vector24 *= num206;
						velocity = (velocity * num207 + vector24) / (num207 + 1);
					}
					else
					{
						if (localAI[0] > 0f)
						{
							localAI[0] -= 3f;
						}
						else
						{
							localAI[0] = 0f;
						}
						if (frame >= 7)
						{
							frameCounter++;
							if (frameCounter > 3)
							{
								if (frame >= 9)
								{
									frame = 4;
								}
								else
								{
									frame++;
								}
								frameCounter = 0;
							}
						}
						else if (frame > 0)
						{
							frameCounter++;
							if (frameCounter > 3)
							{
								frame--;
								frameCounter = 0;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
						tileCollide = true;
						velocity.X *= 0.92f;
						velocity.Y += 0.3f;
					}
				}
				else
				{
					rotation += velocity.X * 0.06f;
					frame = 0;
				}
			}
			if (this.ai[0] != 0f && velocity.Y <= 0f && !flag9 && velocity.X == 0f)
			{
				float num208 = 0.5f;
				int i2 = (int)((base.position.X - 8f) / 16f);
				int num209 = (int)(base.position.Y / 16f);
				bool flag11 = false;
				bool flag12 = false;
				if (WorldGen.SolidTile(i2, num209) || WorldGen.SolidTile(i2, num209 + 1))
				{
					flag11 = true;
				}
				i2 = (int)((base.position.X + (float)width + 8f) / 16f);
				if (WorldGen.SolidTile(i2, num209) || WorldGen.SolidTile(i2, num209 + 1))
				{
					flag12 = true;
				}
				if (flag11)
				{
					velocity.X = num208;
				}
				else if (flag12)
				{
					velocity.X = 0f - num208;
				}
				else
				{
					i2 = (int)((base.position.X - 8f - 16f) / 16f);
					num209 = (int)(base.position.Y / 16f);
					flag11 = false;
					flag12 = false;
					if (WorldGen.SolidTile(i2, num209) || WorldGen.SolidTile(i2, num209 + 1))
					{
						flag11 = true;
					}
					i2 = (int)((base.position.X + (float)width + 8f + 16f) / 16f);
					if (WorldGen.SolidTile(i2, num209) || WorldGen.SolidTile(i2, num209 + 1))
					{
						flag12 = true;
					}
					if (flag11)
					{
						velocity.X = num208;
					}
					else if (flag12)
					{
						velocity.X = 0f - num208;
					}
					else
					{
						i2 = (int)((base.position.X - 8f - 32f) / 16f);
						num209 = (int)(base.position.Y / 16f);
						flag11 = false;
						flag12 = false;
						if (WorldGen.SolidTile(i2, num209) || WorldGen.SolidTile(i2, num209 + 1))
						{
							flag11 = true;
						}
						i2 = (int)((base.position.X + (float)width + 8f + 32f) / 16f);
						if (WorldGen.SolidTile(i2, num209) || WorldGen.SolidTile(i2, num209 + 1))
						{
							flag12 = true;
						}
						if (!flag11 && !flag12)
						{
							if ((int)(base.Center.X / 16f) % 2 == 0)
							{
								flag11 = true;
							}
							else
							{
								flag12 = true;
							}
						}
						if (flag11)
						{
							velocity.X = num208;
						}
						else if (flag12)
						{
							velocity.X = 0f - num208;
						}
					}
				}
			}
			if (type != 1055)
			{
				rotation += velocity.X * 0.06f;
			}
			this.ai[0] = 1f;
			if (velocity.Y > 16f)
			{
				velocity.Y = 16f;
			}
			if (type == 1055)
			{
				if (this.ai[1] == 0f)
				{
					if (velocity.X > 0f && velocity.X < 7f)
					{
						velocity.X += 0.05f;
					}
					if (velocity.X < 0f && velocity.X > -7f)
					{
						velocity.X -= 0.05f;
					}
				}
			}
			else if (type == 1021)
			{
				if (Math.Abs(velocity.Y) <= 1f)
				{
					if (velocity.X > 0f && (double)velocity.X < 3.5)
					{
						velocity.X += 0.025f;
					}
					if (velocity.X < 0f && (double)velocity.X > -3.5)
					{
						velocity.X -= 0.025f;
					}
				}
			}
			else if (velocity.Y <= 6f)
			{
				if (velocity.X > 0f && velocity.X < 7f)
				{
					velocity.X += 0.05f;
				}
				if (velocity.X < 0f && velocity.X > -7f)
				{
					velocity.X -= 0.05f;
				}
			}
			if (type == 1021)
			{
				velocity.Y += 0.06f;
			}
			else if (type == 1055)
			{
				if (this.ai[1] == 0f)
				{
					velocity.Y += 0.3f;
				}
			}
			else
			{
				velocity.Y += 0.3f;
			}
			if (type == 1048 && Main.netMode != 2 && velocity.Length() > 1f)
			{
				Vector2 vector25 = base.Center + Main.rand.NextVector2Circular((float)width * 0.4f, (float)height * 0.4f);
				Dust dust13 = Main.dust[Dust.NewDust(vector25 - Vector2.One, 2, 2, 322, (0f - velocity.X) * 0.5f, (0f - velocity.Y) * 0.5f, 0, default(Color), 0.75f + Main.rand.NextFloat() * 0.25f)];
				dust13.noGravity = true;
			}
			if (base.AnyWet && Main.netMode != 1)
			{
				if (type == 1053)
				{
					Kill();
				}
				else if (wet && type == 655)
				{
					Kill();
				}
				else if (lavaWet && (type == 727 || type == 1054))
				{
					Kill();
				}
			}
		}
		else if (aiStyle == 26)
		{
			AI_026();
		}
		else if (aiStyle == 27)
		{
			if (type == 115)
			{
				this.ai[0] += 1f;
				if (this.ai[0] < 30f)
				{
					velocity *= 1.125f;
				}
			}
			if (type == 115 && localAI[1] < 5f)
			{
				localAI[1] = 5f;
				for (int num210 = 5; num210 < 25; num210++)
				{
					float num211 = velocity.X * (30f / (float)num210);
					float num212 = velocity.Y * (30f / (float)num210);
					num211 *= 80f;
					num212 *= 80f;
					int num213 = Dust.NewDust(new Vector2(base.position.X - num211, base.position.Y - num212), 8, 8, 27, oldVelocity.X, oldVelocity.Y, 100, default(Color), 0.9f);
					Dust dust2 = Main.dust[num213];
					dust2.velocity *= 0.25f;
					dust2 = Main.dust[num213];
					dust2.velocity -= velocity * 5f;
				}
			}
			if (localAI[1] > 7f && type == 173)
			{
				int num214 = Main.rand.Next(3);
				int num215 = Dust.NewDust(new Vector2(base.position.X - velocity.X * 4f + 2f, base.position.Y + 2f - velocity.Y * 4f), 8, 8, num214 switch
				{
					0 => 15, 
					1 => 57, 
					_ => 58, 
				}, 0f, 0f, 100, default(Color), 1.25f);
				Dust dust2 = Main.dust[num215];
				dust2.velocity *= 0.1f;
			}
			if (localAI[1] > 7f && type == 132)
			{
				int num216 = Dust.NewDust(new Vector2(base.position.X - velocity.X * 4f + 2f, base.position.Y + 2f - velocity.Y * 4f), 8, 8, 107, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.25f);
				Dust dust2 = Main.dust[num216];
				dust2.velocity *= -0.25f;
				num216 = Dust.NewDust(new Vector2(base.position.X - velocity.X * 4f + 2f, base.position.Y + 2f - velocity.Y * 4f), 8, 8, 107, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.25f);
				dust2 = Main.dust[num216];
				dust2.velocity *= -0.25f;
				dust2 = Main.dust[num216];
				dust2.position -= velocity * 0.5f;
			}
			if (localAI[1] < 15f)
			{
				localAI[1] += 1f;
			}
			else
			{
				if (type == 114 || type == 115)
				{
					int num217 = Dust.NewDust(new Vector2(base.position.X, base.position.Y + 4f), 8, 8, 27, oldVelocity.X, oldVelocity.Y, 100, default(Color), 0.6f);
					Dust dust2 = Main.dust[num217];
					dust2.velocity *= -0.25f;
				}
				else if (type == 116)
				{
					int num218 = Dust.NewDust(new Vector2(base.position.X - velocity.X * 5f + 2f, base.position.Y + 2f - velocity.Y * 5f), 8, 8, 64, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.5f);
					Dust dust2 = Main.dust[num218];
					dust2.velocity *= -0.25f;
					Main.dust[num218].noGravity = true;
				}
				if (localAI[0] == 0f)
				{
					scale -= 0.02f;
					alpha += 30;
					if (alpha >= 250)
					{
						alpha = 255;
						localAI[0] = 1f;
					}
				}
				else if (localAI[0] == 1f)
				{
					scale += 0.02f;
					alpha -= 30;
					if (alpha <= 0)
					{
						alpha = 0;
						localAI[0] = 0f;
					}
				}
			}
			if (this.ai[1] == 0f)
			{
				this.ai[1] = 1f;
				if (type == 132)
				{
					SoundEngine.PlaySound(SoundID.Item60, base.position);
				}
				else
				{
					SoundEngine.PlaySound(SoundID.Item8, base.position);
				}
			}
			if (type == 157)
			{
				rotation += (float)direction * 0.4f;
				spriteDirection = direction;
			}
			else
			{
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 0.785f;
			}
			if (velocity.Y > 16f)
			{
				velocity.Y = 16f;
			}
		}
		else if (aiStyle == 28)
		{
			if (type == 1026)
			{
				localAI[0]++;
				if (localAI[0] >= 8f && timeLeft % 2 == 0)
				{
					localAI[0] = 8f;
					Vector2 vector26 = new Vector2(base.position.X, base.position.Y) - velocity.SafeNormalize(Vector2.Zero) * 5f;
					int num219 = Dust.NewDust(vector26, width, height, 2, velocity.X, velocity.Y, 0, default(Color), 0.7f + (float)Main.rand.Next(-5, 5) * 0.01f);
					Main.dust[num219].alpha = 50;
					Main.dust[num219].fadeIn = 0.5f;
					Main.dust[num219].noGravity = true;
					Main.dust[num219].velocity = velocity * 0.25f;
				}
				frameCounter++;
				if (frameCounter > 4)
				{
					frameCounter = 0;
					frame++;
				}
				if (frame < 0 || frame >= Main.projFrames[type])
				{
					frame = 0;
				}
				spriteDirection = ((!(velocity.X < 0f)) ? 1 : (-1));
				rotation = velocity.ToRotation() + ((spriteDirection == -1) ? (-(float)Math.PI) : 0f);
			}
			if (type == 967)
			{
				localAI[0]++;
				if (localAI[0] >= 5f && timeLeft % 3 == 0)
				{
					localAI[0] = 5f;
					int num220 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 219, velocity.X, velocity.Y, 0, default(Color), 0.35f + (float)Main.rand.Next(-5, 5) * 0.01f);
					Main.dust[num220].noGravity = true;
					Main.dust[num220].velocity = velocity * 1.5f;
				}
				if (++frameCounter > 6)
				{
					frameCounter = 0;
					frame++;
					if (frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
			}
			if (type == 177)
			{
				for (int num221 = 0; num221 < 3; num221++)
				{
					int num222 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 137, velocity.X, velocity.Y, Main.rand.Next(0, 101), default(Color), 1f + (float)Main.rand.Next(-20, 40) * 0.01f);
					Main.dust[num222].noGravity = true;
					Dust dust2 = Main.dust[num222];
					dust2.velocity *= 0.3f;
				}
			}
			if (type == 118)
			{
				for (int num223 = 0; num223 < 2; num223++)
				{
					int num224 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 92, velocity.X, velocity.Y, 50, default(Color), 1.2f);
					Main.dust[num224].noGravity = true;
					Dust dust2 = Main.dust[num224];
					dust2.velocity *= 0.3f;
				}
			}
			if (type == 119 || type == 128 || type == 359)
			{
				for (int num225 = 0; num225 < 3; num225++)
				{
					int num226 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 92, velocity.X, velocity.Y, 50, default(Color), 1.2f);
					Main.dust[num226].noGravity = true;
					Dust dust2 = Main.dust[num226];
					dust2.velocity *= 0.3f;
				}
			}
			if (type == 309)
			{
				for (int num227 = 0; num227 < 3; num227++)
				{
					int num228 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 185, velocity.X, velocity.Y, 50, default(Color), 1.2f);
					Main.dust[num228].noGravity = true;
					Dust dust2 = Main.dust[num228];
					dust2.velocity *= 0.3f;
				}
			}
			if (type == 129)
			{
				for (int num229 = 0; num229 < 6; num229++)
				{
					int num230 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 106, velocity.X, velocity.Y, 100);
					Main.dust[num230].noGravity = true;
					Dust dust2 = Main.dust[num230];
					dust2.velocity *= 0.1f + (float)Main.rand.Next(4) * 0.1f;
					dust2 = Main.dust[num230];
					dust2.scale *= 1f + (float)Main.rand.Next(5) * 0.1f;
				}
			}
			if (this.ai[1] != 0f)
			{
				return;
			}
			this.ai[1] = 1f;
			if (type == 967)
			{
				for (int num231 = 0; num231 < 10; num231++)
				{
					int num232 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 219, velocity.X, velocity.Y, 0, default(Color), 0.4f + (float)Main.rand.Next(-20, 40) * 0.01f);
					Main.dust[num232].noGravity = true;
					Main.dust[num232].velocity = (velocity * 0.5f).RotatedByRandom(0.5);
				}
				SoundEngine.PlaySound(SoundID.Item60, base.position);
			}
			else if (type == 1026)
			{
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.DeadCellsBarnacleShotFiring, new ParticleOrchestraSettings
				{
					PositionInWorld = base.Center,
					MovementVector = velocity
				});
			}
			else
			{
				SoundEngine.PlaySound(SoundID.Item28, base.position);
			}
		}
		else if (aiStyle == 29)
		{
			if (type == 619)
			{
				int num233 = (int)this.ai[0];
				for (int num234 = 0; num234 < 3; num234++)
				{
					int num235 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 254, velocity.X, velocity.Y, num233, default(Color), 1.2f);
					Main.dust[num235].position = (Main.dust[num235].position + base.Center) / 2f;
					Main.dust[num235].noGravity = true;
					Dust dust2 = Main.dust[num235];
					dust2.velocity *= 0.5f;
				}
				for (int num236 = 0; num236 < 2; num236++)
				{
					int num235 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 255, velocity.X, velocity.Y, num233, default(Color), 0.4f);
					switch (num236)
					{
					case 0:
						Main.dust[num235].position = (Main.dust[num235].position + base.Center * 5f) / 6f;
						break;
					case 1:
						Main.dust[num235].position = (Main.dust[num235].position + (base.Center + velocity / 2f) * 5f) / 6f;
						break;
					}
					Dust dust2 = Main.dust[num235];
					dust2.velocity *= 0.1f;
					Main.dust[num235].noGravity = true;
					Main.dust[num235].fadeIn = 1f;
				}
			}
			else if (type == 620)
			{
				int num237 = (int)this.ai[0];
				this.ai[1] += 1f;
				float num238 = (60f - this.ai[1]) / 60f;
				if (this.ai[1] > 40f)
				{
					Kill();
				}
				velocity.Y += 0.2f;
				if (velocity.Y > 18f)
				{
					velocity.Y = 18f;
				}
				velocity.X *= 0.98f;
				for (int num239 = 0; num239 < 2; num239++)
				{
					int num240 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, num237, velocity.X, velocity.Y, 50, default(Color), 1.1f);
					Main.dust[num240].position = (Main.dust[num240].position + base.Center) / 2f;
					Main.dust[num240].noGravity = true;
					Dust dust2 = Main.dust[num240];
					dust2.velocity *= 0.3f;
					dust2 = Main.dust[num240];
					dust2.scale *= num238;
				}
				for (int num241 = 0; num241 < 1; num241++)
				{
					int num240 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, num237, velocity.X, velocity.Y, 50, default(Color), 0.6f);
					Main.dust[num240].position = (Main.dust[num240].position + base.Center * 5f) / 6f;
					Dust dust2 = Main.dust[num240];
					dust2.velocity *= 0.1f;
					Main.dust[num240].noGravity = true;
					Main.dust[num240].fadeIn = 0.9f * num238;
					dust2 = Main.dust[num240];
					dust2.scale *= num238;
				}
			}
			else if (type == 521)
			{
				if (alpha == 0)
				{
					for (int num242 = 0; num242 < 3; num242++)
					{
						int num243 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 254, velocity.X, velocity.Y, 50, default(Color), 1.2f);
						Main.dust[num243].position = (Main.dust[num243].position + base.Center) / 2f;
						Main.dust[num243].noGravity = true;
						Dust dust2 = Main.dust[num243];
						dust2.velocity *= 0.5f;
					}
					for (int num244 = 0; num244 < 2; num244++)
					{
						int num243 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 255, velocity.X, velocity.Y, 50, default(Color), 0.4f);
						switch (num244)
						{
						case 0:
							Main.dust[num243].position = (Main.dust[num243].position + base.Center * 5f) / 6f;
							break;
						case 1:
							Main.dust[num243].position = (Main.dust[num243].position + (base.Center + velocity / 2f) * 5f) / 6f;
							break;
						}
						Dust dust2 = Main.dust[num243];
						dust2.velocity *= 0.1f;
						Main.dust[num243].noGravity = true;
						Main.dust[num243].fadeIn = 1f;
					}
				}
				if (alpha >= 0)
				{
					alpha -= 50;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			else if (type == 522)
			{
				this.ai[1] += 1f;
				float num245 = (60f - this.ai[1]) / 60f;
				if (this.ai[1] > 40f)
				{
					Kill();
				}
				velocity.Y += 0.2f;
				if (velocity.Y > 18f)
				{
					velocity.Y = 18f;
				}
				velocity.X *= 0.98f;
				for (int num246 = 0; num246 < 2; num246++)
				{
					int num247 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 254, velocity.X, velocity.Y, 50, default(Color), 1.1f);
					Main.dust[num247].position = (Main.dust[num247].position + base.Center) / 2f;
					Main.dust[num247].noGravity = true;
					Dust dust2 = Main.dust[num247];
					dust2.velocity *= 0.3f;
					dust2 = Main.dust[num247];
					dust2.scale *= num245;
				}
				for (int num248 = 0; num248 < 1; num248++)
				{
					int num247 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 255, velocity.X, velocity.Y, 50, default(Color), 0.6f);
					Main.dust[num247].position = (Main.dust[num247].position + base.Center * 5f) / 6f;
					Dust dust2 = Main.dust[num247];
					dust2.velocity *= 0.1f;
					Main.dust[num247].noGravity = true;
					Main.dust[num247].fadeIn = 0.9f * num245;
					dust2 = Main.dust[num247];
					dust2.scale *= num245;
				}
			}
			else if (type == 731)
			{
				if (++frameCounter >= 4)
				{
					frameCounter = 0;
					if (++frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
				alpha -= 15;
				if (alpha < 0)
				{
					alpha = 0;
				}
				this.ai[0]++;
				if ((int)this.ai[0] % 2 != 0 && Main.rand.Next(4) == 0)
				{
					this.ai[0]++;
				}
				float num249 = 5f;
				switch ((int)this.ai[0])
				{
				case 10:
					velocity.Y -= num249;
					break;
				case 12:
					velocity.Y += num249;
					break;
				case 18:
					velocity.Y += num249;
					break;
				case 20:
					velocity.Y -= num249;
					this.ai[0] = 0f;
					break;
				}
				if (Main.rand.Next(3) == 0)
				{
					Dust dust14 = Dust.NewDustDirect(base.position, width, height, 226, velocity.X, velocity.Y, 50, default(Color), 0.4f);
					dust14.noGravity = true;
					dust14.velocity = dust14.velocity * 0f + velocity * 0.5f;
					if (Main.rand.Next(3) != 0)
					{
						Dust dust2 = dust14;
						dust2.velocity *= 1.4f;
					}
				}
				Lighting.AddLight(base.Center, 0.2f, 0.5f, 0.7f);
			}
			else
			{
				int num250 = type - 121 + 86;
				if (type == 597)
				{
					num250 = 262;
				}
				for (int num251 = 0; num251 < 2; num251++)
				{
					int num252 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, num250, velocity.X, velocity.Y, 50, default(Color), 1.2f);
					Main.dust[num252].noGravity = true;
					Dust dust2 = Main.dust[num252];
					dust2.velocity *= 0.3f;
				}
				if (this.ai[1] == 0f)
				{
					this.ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item8, base.position);
				}
			}
		}
		else if (aiStyle == 30)
		{
			if (type == 907)
			{
				float num253 = 100f;
				float num254 = num253 - 50f;
				if (Main.rand.Next(Math.Max(4, 8 - (int)velocity.Length())) == 0)
				{
					int num255 = 5;
					int num256 = Dust.NewDust(base.position + new Vector2(num255, num255), width - num255 * 2, height - num255 * 2, 43, 0f, 0f, 254, new Color(255, 255, 0));
					Main.dust[num256].velocity = velocity * 0.75f;
				}
				if (this.ai[0] > num254)
				{
					velocity *= 0.9f;
					rotation *= 0.9f;
				}
				else
				{
					rotation += 0.2f;
					if (rotation > (float)Math.PI * 2f)
					{
						rotation -= (float)Math.PI * 2f;
					}
				}
				float num257 = this.ai[0];
				this.ai[0]++;
				if (Main.myPlayer == owner && this.ai[0] < num254 && this.ai[0] % 10f == 0f)
				{
					float num258 = (float)Math.PI / 2f * (float)((this.ai[0] % 20f != 0f) ? 1 : (-1));
					num258 *= (float)((whoAmI % 2 != 0) ? 1 : (-1));
					num258 += (float)Main.rand.Next(-5, 5) * MathHelper.Lerp(0.2f, 0.03f, this.ai[0] / num254);
					Vector2 v = velocity.RotatedBy(num258);
					v = v.SafeNormalize(Vector2.Zero);
					v *= Math.Max(2.5f, (num254 - this.ai[0]) / num254 * (7f + (-2f + (float)Main.rand.Next(2) * 2f)));
					int num259 = NewProjectile(GetProjectileSource_FromThis(), base.Center, v, 335, damage, knockBack * 0.25f, owner, 0f, Main.rand.Next(4));
				}
				if (num257 <= num254 && this.ai[0] > num254)
				{
					netUpdate = true;
				}
				if (this.ai[0] > num253)
				{
					Kill();
				}
			}
			else if (type == 335)
			{
				int num260 = (frame = (int)this.ai[1]);
				if (this.ai[0] < 0f)
				{
					velocity.Y += 0.25f;
					if (velocity.Y > 14f)
					{
						velocity.Y = 14f;
					}
				}
				else
				{
					if (Main.rand.Next(Math.Max(4, 8 - (int)velocity.Length())) == 0)
					{
						Color newColor = Color.White;
						switch (num260)
						{
						case 0:
							newColor = new Color(255, 100, 100);
							break;
						case 1:
							newColor = new Color(100, 255, 100);
							break;
						case 2:
							newColor = new Color(100, 100, 255);
							break;
						case 3:
							newColor = new Color(255, 255, 100);
							break;
						}
						int num261 = 5;
						int num262 = Dust.NewDust(base.position + new Vector2(num261, num261), width - num261 * 2, height - num261 * 2, 43, 0f, 0f, 254, newColor);
						Main.dust[num262].velocity = velocity * 0.75f;
					}
					velocity *= 0.95f;
				}
				if (this.ai[0] >= 0f && velocity.Length() < 0.25f)
				{
					if (velocity != Vector2.Zero)
					{
						velocity = Vector2.Zero;
						if (Main.netMode != 1)
						{
							this.ai[0] = 50f;
							netUpdate = true;
						}
					}
					this.ai[0]--;
				}
				localAI[0]++;
				rotation = (float)Math.Sin(localAI[0] / 10f);
			}
			else
			{
				velocity *= 0.8f;
				rotation += 0.2f;
				alpha += 4;
				if (alpha >= 255)
				{
					Kill();
				}
			}
		}
		else if (aiStyle == 31)
		{
			bool flag13 = this.ai[1] == 1f;
			short num263 = 110;
			int num264 = 0;
			switch (type)
			{
			default:
				num263 = 110;
				num264 = 0;
				break;
			case 147:
				num263 = 112;
				num264 = 1;
				break;
			case 146:
				num263 = 111;
				num264 = 2;
				break;
			case 148:
				num263 = 113;
				num264 = 3;
				break;
			case 149:
				num263 = 114;
				num264 = 4;
				break;
			case 1015:
				num263 = 311;
				num264 = 5;
				break;
			case 1016:
				num263 = 312;
				num264 = 6;
				break;
			case 1017:
				num263 = 313;
				num264 = 7;
				break;
			}
			if (owner == Main.myPlayer)
			{
				int size = 2;
				if (flag13)
				{
					size = 3;
				}
				Point point2 = base.Center.ToTileCoordinates();
				WorldGen.Convert(point2.X, point2.Y, num264, size);
			}
			if (timeLeft > 133)
			{
				timeLeft = 133;
			}
			int num265 = 7;
			if (flag13)
			{
				num265 = 3;
			}
			if (this.ai[0] > (float)num265)
			{
				float num266 = 1f;
				if (this.ai[0] == (float)(num265 + 1))
				{
					num266 = 0.2f;
				}
				else if (this.ai[0] == (float)(num265 + 2))
				{
					num266 = 0.4f;
				}
				else if (this.ai[0] == (float)(num265 + 3))
				{
					num266 = 0.6f;
				}
				else if (this.ai[0] == (float)(num265 + 4))
				{
					num266 = 0.8f;
				}
				int num267 = 0;
				if (flag13)
				{
					num266 *= 1.2f;
					num267 = (int)(12f * num266);
				}
				this.ai[0]++;
				for (int num268 = 0; num268 < 1; num268++)
				{
					int num269 = Dust.NewDust(new Vector2(base.position.X - (float)num267, base.position.Y - (float)num267), width + num267 * 2, height + num267 * 2, num263, velocity.X * 0.2f, velocity.Y * 0.2f, 100);
					Main.dust[num269].noGravity = true;
					Dust dust2 = Main.dust[num269];
					dust2.scale *= 1.75f;
					Main.dust[num269].velocity.X *= 2f;
					Main.dust[num269].velocity.Y *= 2f;
					dust2 = Main.dust[num269];
					dust2.scale *= num266;
				}
			}
			else
			{
				this.ai[0]++;
			}
			rotation += 0.3f * (float)direction;
		}
		else if (aiStyle == 32)
		{
			timeLeft = 10;
			this.ai[0] += 1f;
			if (this.ai[0] >= 20f)
			{
				this.ai[0] = 18f;
				Rectangle rectangle2 = new Rectangle((int)base.position.X, (int)base.position.Y, width, height);
				for (int num270 = 0; num270 < 255; num270++)
				{
					Player player4 = Main.player[num270];
					if (player4.active && rectangle2.Intersects(player4.Hitbox))
					{
						this.ai[0] = 0f;
						velocity.Y = -4.5f;
						if (velocity.X > 2f)
						{
							velocity.X = 2f;
						}
						if (velocity.X < -2f)
						{
							velocity.X = -2f;
						}
						velocity.X = (velocity.X + (float)player4.direction * 1.75f) / 2f;
						velocity.X += player4.velocity.X * 3f;
						velocity.Y += player4.velocity.Y;
						if (velocity.X > 6f)
						{
							velocity.X = 6f;
						}
						if (velocity.X < -6f)
						{
							velocity.X = -6f;
						}
						if (velocity.Length() > 16f)
						{
							velocity = velocity.SafeNormalize(Vector2.Zero) * 16f;
						}
						netUpdate = true;
						this.ai[1] += 1f;
					}
				}
				for (int num271 = 0; num271 < Main.maxNPCs; num271++)
				{
					NPC nPC = Main.npc[num271];
					if (nPC.active && rectangle2.Intersects(nPC.Hitbox))
					{
						this.ai[0] = 0f;
						velocity.Y = -4.5f;
						if (velocity.X > 2f)
						{
							velocity.X = 2f;
						}
						if (velocity.X < -2f)
						{
							velocity.X = -2f;
						}
						velocity.X = (velocity.X + (float)nPC.direction * 1.75f) / 2f;
						velocity.X += nPC.velocity.X * 3f;
						velocity.Y += nPC.velocity.Y;
						if (velocity.X > 6f)
						{
							velocity.X = 6f;
						}
						if (velocity.X < -6f)
						{
							velocity.X = -6f;
						}
						if (velocity.Length() > 16f)
						{
							velocity = velocity.SafeNormalize(Vector2.Zero) * 16f;
						}
						netUpdate = true;
						this.ai[1] += 1f;
					}
				}
				for (int num272 = 0; num272 < 1000; num272++)
				{
					if (num272 == whoAmI)
					{
						continue;
					}
					Projectile projectile = Main.projectile[num272];
					if (projectile.active && rectangle2.Intersects(projectile.Hitbox))
					{
						this.ai[0] = 0f;
						velocity.Y = -4.5f;
						if (velocity.X > 2f)
						{
							velocity.X = 2f;
						}
						if (velocity.X < -2f)
						{
							velocity.X = -2f;
						}
						velocity.X = (velocity.X + (float)projectile.direction * 1.75f) / 2f;
						velocity.X += projectile.velocity.X * 3f;
						velocity.Y += projectile.velocity.Y;
						if (velocity.X > 6f)
						{
							velocity.X = 6f;
						}
						if (velocity.X < -6f)
						{
							velocity.X = -6f;
						}
						if (velocity.Length() > 16f)
						{
							velocity = velocity.SafeNormalize(Vector2.Zero) * 16f;
						}
						netUpdate = true;
						this.ai[1] += 1f;
					}
				}
			}
			if (velocity.X == 0f && velocity.Y == 0f)
			{
				Kill();
			}
			rotation += 0.02f * velocity.X;
			if (velocity.Y == 0f)
			{
				velocity.X *= 0.98f;
			}
			else if (wet)
			{
				velocity.X *= 0.99f;
			}
			else
			{
				velocity.X *= 0.995f;
			}
			if ((double)velocity.X > -0.03 && (double)velocity.X < 0.03)
			{
				velocity.X = 0f;
			}
			if (wet)
			{
				this.ai[1] = 0f;
				if (velocity.Y > 0f)
				{
					velocity.Y *= 0.95f;
				}
				velocity.Y -= 0.1f;
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
				if (velocity.X == 0f)
				{
					Kill();
				}
			}
			else
			{
				velocity.Y += 0.1f;
			}
			if (velocity.Y > 10f)
			{
				velocity.Y = 10f;
			}
		}
		else if (aiStyle == 33)
		{
			if (alpha > 0)
			{
				alpha -= 50;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			float num273 = 4f;
			float num274 = this.ai[0];
			float num275 = this.ai[1];
			if (num274 == 0f && num275 == 0f)
			{
				num274 = 1f;
			}
			float num276 = (float)Math.Sqrt(num274 * num274 + num275 * num275);
			num276 = num273 / num276;
			num274 *= num276;
			num275 *= num276;
			if (alpha < 70)
			{
				short num277 = 127;
				switch (type)
				{
				case 163:
					num277 = 127;
					break;
				case 310:
					num277 = 187;
					break;
				case 1008:
					num277 = 169;
					break;
				case 1009:
					num277 = 75;
					break;
				case 1010:
					num277 = 66;
					break;
				case 1011:
					num277 = 310;
					break;
				}
				int num278 = Dust.NewDust(new Vector2(base.position.X, base.position.Y - 2f), 6, 6, num277, velocity.X, velocity.Y, 100, default(Color), 1.6f);
				Main.dust[num278].noGravity = true;
				Main.dust[num278].position.X -= num274 * 1f;
				Main.dust[num278].position.Y -= num275 * 1f;
				Main.dust[num278].velocity.X -= num274;
				Main.dust[num278].velocity.Y -= num275;
				if (type == 1010)
				{
					Main.dust[num278].color = Main.hslToRgb(Main.GlobalTimeWrappedHourly * 0.6f % 1f, 1f, 0.5f);
					Dust dust2 = Main.dust[num278];
					dust2.scale *= 0.5f;
					dust2 = Main.dust[num278];
					dust2.velocity *= 0.75f;
				}
			}
			if (localAI[0] == 0f)
			{
				this.ai[0] = velocity.X;
				this.ai[1] = velocity.Y;
				localAI[1] += 1f;
				if (localAI[1] >= 30f)
				{
					velocity.Y += 0.09f;
					localAI[1] = 30f;
				}
			}
			else
			{
				if (!Collision.SolidCollision(base.position, width, height))
				{
					localAI[0] = 0f;
					localAI[1] = 30f;
				}
				if (type == 1008 && Main.netMode != 2)
				{
					int num279 = 30;
					if ((base.Center - Main.player[Main.myPlayer].Center).Length() < (float)(Main.screenWidth + num279 * 16))
					{
						Main.instance.SpelunkerProjectileHelper.AddSpotToCheck(base.Center);
					}
				}
				damage = 0;
			}
			if (velocity.Y > 16f)
			{
				velocity.Y = 16f;
			}
			rotation = (float)Math.Atan2(this.ai[1], this.ai[0]) + 1.57f;
		}
		else if (aiStyle == 34)
		{
			rotation = velocity.ToRotation() + (float)Math.PI / 2f;
			if (this.ai[1] == 1f)
			{
				this.ai[0]++;
				if (this.ai[0] == 1f)
				{
					for (int num280 = 0; num280 < 8; num280++)
					{
						int num281 = Dust.NewDust(base.position, width, height, 6, 0f, 0f, 100, default(Color), 1.8f);
						Main.dust[num281].noGravity = true;
						Dust dust2 = Main.dust[num281];
						dust2.velocity *= 3f;
						Main.dust[num281].fadeIn = 0.5f;
						dust2 = Main.dust[num281];
						dust2.position += velocity / 2f;
						dust2 = Main.dust[num281];
						dust2.velocity += velocity / 4f + Main.player[owner].velocity * 0.1f;
					}
				}
				if (this.ai[0] > 2f)
				{
					int num282 = Dust.NewDust(new Vector2(base.position.X + 2f, base.position.Y + 20f), 8, 8, 6, velocity.X, velocity.Y, 100, default(Color), 1.2f);
					Main.dust[num282].noGravity = true;
					Dust dust2 = Main.dust[num282];
					dust2.velocity *= 0.2f;
					Main.dust[num282].position = Main.dust[num282].position.RotatedBy(rotation, base.Center);
					num282 = Dust.NewDust(new Vector2(base.position.X + 2f, base.position.Y + 15f), 8, 8, 6, velocity.X, velocity.Y, 100, default(Color), 1.2f);
					Main.dust[num282].noGravity = true;
					dust2 = Main.dust[num282];
					dust2.velocity *= 0.2f;
					Main.dust[num282].position = Main.dust[num282].position.RotatedBy(rotation, base.Center);
					num282 = Dust.NewDust(new Vector2(base.position.X + 2f, base.position.Y + 10f), 8, 8, 6, velocity.X, velocity.Y, 100, default(Color), 1.2f);
					Main.dust[num282].noGravity = true;
					dust2 = Main.dust[num282];
					dust2.velocity *= 0.2f;
					Main.dust[num282].position = Main.dust[num282].position.RotatedBy(rotation, base.Center);
				}
			}
			else if (type >= 415 && type <= 418)
			{
				this.ai[0]++;
				if (this.ai[0] > 4f)
				{
					int num283 = Dust.NewDust(new Vector2(base.position.X + 2f, base.position.Y + 20f), 8, 8, 6, velocity.X, velocity.Y, 100, default(Color), 1.2f);
					Main.dust[num283].noGravity = true;
					Dust dust2 = Main.dust[num283];
					dust2.velocity *= 0.2f;
					Main.dust[num283].position = Main.dust[num283].position.RotatedBy(rotation, base.Center);
				}
			}
			else
			{
				int num284 = Dust.NewDust(new Vector2(base.position.X + 2f, base.position.Y + 20f), 8, 8, 6, velocity.X, velocity.Y, 100, default(Color), 1.2f);
				Main.dust[num284].noGravity = true;
				Dust dust2 = Main.dust[num284];
				dust2.velocity *= 0.2f;
				Main.dust[num284].position = Main.dust[num284].position.RotatedBy(rotation, base.Center);
			}
		}
		else if (aiStyle == 35)
		{
			this.ai[0] += 1f;
			if (this.ai[0] > 30f)
			{
				velocity.Y += 0.2f;
				velocity.X *= 0.985f;
				if (velocity.Y > 14f)
				{
					velocity.Y = 14f;
				}
			}
			rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * (float)direction * 0.02f;
			if (owner != Main.myPlayer)
			{
				return;
			}
			Vector2 vector27 = Collision.TileCollision(base.position, velocity, width, height, fallThrough: true, fall2: true);
			bool flag14 = false;
			if (vector27 != velocity)
			{
				flag14 = true;
			}
			else
			{
				int num285 = (int)(base.Center.X + velocity.X) / 16;
				int num286 = (int)(base.Center.Y + velocity.Y) / 16;
				if (Main.tile[num285, num286] != null && Main.tile[num285, num286].active() && Main.tile[num285, num286].bottomSlope())
				{
					flag14 = true;
					base.position.Y = num286 * 16 + 16 + 8;
					base.position.X = num285 * 16 + 8;
				}
			}
			if (!flag14)
			{
				return;
			}
			int num287 = 213;
			if (type == 475)
			{
				num287 = 353;
			}
			if (type == 506)
			{
				num287 = 366;
			}
			if (type == 505)
			{
				num287 = 365;
			}
			int num288 = (int)(base.position.X + (float)(width / 2)) / 16;
			int num289 = (int)(base.position.Y + (float)(height / 2)) / 16;
			base.position += vector27;
			int num290 = 10;
			if (Main.tile[num288, num289] == null)
			{
				return;
			}
			for (; WorldGen.IsRope(num288, num289); num289++)
			{
			}
			bool flag15 = false;
			while (num290 > 0)
			{
				bool flag16 = false;
				if (Main.tile[num288, num289] == null)
				{
					break;
				}
				if (Main.tile[num288, num289].active())
				{
					if (Main.tile[num288, num289].type == 314 || TileID.Sets.Platforms[Main.tile[num288, num289].type])
					{
						flag15 = !flag15;
					}
					else if (Main.tileCut[Main.tile[num288, num289].type] || Main.tile[num288, num289].type == 165)
					{
						flag15 = false;
						WorldGen.KillTile(num288, num289);
						NetMessage.SendData(17, -1, -1, null, 0, num288, num289);
					}
				}
				if (!Main.tile[num288, num289].active())
				{
					flag15 = false;
					flag16 = true;
					WorldGen.PlaceTile(num288, num289, num287);
					NetMessage.SendData(17, -1, -1, null, 1, num288, num289, num287);
					this.ai[1] += 1f;
				}
				else if (!flag15)
				{
					num290 = 0;
				}
				if (flag16)
				{
					num290--;
				}
				num289++;
			}
			Kill();
		}
		else if (aiStyle == 36)
		{
			if (type != 307 && wet && !honeyWet && !shimmerWet)
			{
				Kill();
			}
			if (alpha > 0)
			{
				alpha -= 50;
			}
			else
			{
				extraUpdates = 0;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (type == 307)
			{
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
				frameCounter++;
				if (frameCounter >= 6)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame >= 2)
				{
					frame = 0;
				}
				for (int num291 = 0; num291 < 3; num291++)
				{
					float num292 = velocity.X / 3f * (float)num291;
					float num293 = velocity.Y / 3f * (float)num291;
					int num294 = Dust.NewDust(base.position, width, height, 184);
					Main.dust[num294].position.X = base.Center.X - num292;
					Main.dust[num294].position.Y = base.Center.Y - num293;
					Dust dust2 = Main.dust[num294];
					dust2.velocity *= 0f;
					Main.dust[num294].scale = 0.5f;
				}
			}
			else
			{
				if (type == 316)
				{
					if (velocity.X > 0f)
					{
						spriteDirection = -1;
					}
					else if (velocity.X < 0f)
					{
						spriteDirection = 1;
					}
				}
				else if (velocity.X > 0f)
				{
					spriteDirection = 1;
				}
				else if (velocity.X < 0f)
				{
					spriteDirection = -1;
				}
				rotation = velocity.X * 0.1f;
				frameCounter++;
				if (frameCounter >= 3)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame >= 3)
				{
					frame = 0;
				}
			}
			float num295 = base.position.X;
			float num296 = base.position.Y;
			float num297 = 100000f;
			bool flag17 = false;
			this.ai[0] += 1f;
			if (this.ai[0] > 30f)
			{
				this.ai[0] = 30f;
				for (int num298 = 0; num298 < Main.maxNPCs; num298++)
				{
					if (Main.npc[num298].CanBeChasedBy(this) && (!Main.npc[num298].wet || Main.npc[num298].type == 370 || type == 307))
					{
						float num299 = Main.npc[num298].position.X + (float)(Main.npc[num298].width / 2);
						float num300 = Main.npc[num298].position.Y + (float)(Main.npc[num298].height / 2);
						float num301 = Math.Abs(base.position.X + (float)(width / 2) - num299) + Math.Abs(base.position.Y + (float)(height / 2) - num300);
						if (num301 < 800f && num301 < num297 && Collision.CanHit(base.position, width, height, Main.npc[num298].position, Main.npc[num298].width, Main.npc[num298].height))
						{
							num297 = num301;
							num295 = num299;
							num296 = num300;
							flag17 = true;
						}
					}
				}
			}
			if (!flag17)
			{
				num295 = base.position.X + (float)(width / 2) + velocity.X * 100f;
				num296 = base.position.Y + (float)(height / 2) + velocity.Y * 100f;
			}
			else if (type == 307)
			{
				friendly = true;
			}
			float num302 = 6f;
			float num303 = 0.1f;
			if (type == 189)
			{
				num302 = 9f;
				num303 = 0.2f;
			}
			if (type == 307)
			{
				num302 = 13f;
				num303 = 0.35f;
			}
			if (type == 316)
			{
				if (flag17)
				{
					num302 = 13f;
					num303 = 0.325f;
				}
				else
				{
					num302 = 10f;
					num303 = 0.25f;
				}
			}
			if (type == 566)
			{
				num302 = 6.8f;
				num303 = 0.14f;
			}
			Vector2 vector28 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
			float num304 = num295 - vector28.X;
			float num305 = num296 - vector28.Y;
			float num306 = (float)Math.Sqrt(num304 * num304 + num305 * num305);
			float num307 = num306;
			num306 = num302 / num306;
			num304 *= num306;
			num305 *= num306;
			if (velocity.X < num304)
			{
				velocity.X += num303;
				if (velocity.X < 0f && num304 > 0f)
				{
					velocity.X += num303 * 2f;
				}
			}
			else if (velocity.X > num304)
			{
				velocity.X -= num303;
				if (velocity.X > 0f && num304 < 0f)
				{
					velocity.X -= num303 * 2f;
				}
			}
			if (velocity.Y < num305)
			{
				velocity.Y += num303;
				if (velocity.Y < 0f && num305 > 0f)
				{
					velocity.Y += num303 * 2f;
				}
			}
			else if (velocity.Y > num305)
			{
				velocity.Y -= num303;
				if (velocity.Y > 0f && num305 < 0f)
				{
					velocity.Y -= num303 * 2f;
				}
			}
		}
		else if (aiStyle == 37)
		{
			if (this.ai[1] == 0f)
			{
				this.ai[1] = 1f;
				localAI[0] = base.Center.X - velocity.X * 1.5f;
				localAI[1] = base.Center.Y - velocity.Y * 1.5f;
			}
			Vector2 vector29 = new Vector2(localAI[0], localAI[1]);
			rotation = (base.Center - vector29).ToRotation() - (float)Math.PI / 2f;
			if (this.ai[0] == 0f)
			{
				if (Collision.SolidCollision(base.position, width, height))
				{
					velocity *= -1f;
					this.ai[0] += 1f;
					return;
				}
				float num308 = Vector2.Distance(base.Center, vector29);
				if (num308 > 300f)
				{
					velocity *= -1f;
					this.ai[0] += 1f;
				}
			}
			else if (Collision.SolidCollision(base.position, width, height) || Vector2.Distance(base.Center, vector29) < velocity.Length())
			{
				Kill();
			}
		}
		else if (aiStyle == 38)
		{
			this.ai[0] += 1f;
			if (this.ai[0] >= 6f)
			{
				this.ai[0] = 0f;
				SoundEngine.PlaySound(SoundID.Item34, base.position);
				if (Main.myPlayer == owner)
				{
					NewProjectile(GetProjectileSource_FromThis(), base.position.X, base.position.Y, velocity.X, velocity.Y, 188, damage, knockBack, owner);
				}
			}
		}
		else if (aiStyle == 39)
		{
			alpha -= 50;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (!active || !Main.player[owner].active || Main.player[owner].dead || Vector2.Distance(Main.player[owner].Center, base.Center) > 2000f)
			{
				Kill();
				return;
			}
			if (active && alpha == 0)
			{
				Main.player[owner].SetDummyItemTime(5);
				if (base.Center.X > Main.player[owner].Center.X)
				{
					Main.player[owner].ChangeDir(1);
				}
				else
				{
					Main.player[owner].ChangeDir(-1);
				}
			}
			Vector2 center = base.Center;
			float num309 = Main.player[owner].Center.X - center.X;
			float num310 = Main.player[owner].Center.Y - center.Y;
			float num311 = (float)Math.Sqrt(num309 * num309 + num310 * num310);
			if (!Main.player[owner].channel && active && alpha == 0)
			{
				this.ai[0] = 1f;
				this.ai[1] = -1f;
			}
			if (this.ai[1] > 0f && num311 > 1500f)
			{
				this.ai[1] = 0f;
				this.ai[0] = 1f;
			}
			if (this.ai[1] > 0f)
			{
				tileCollide = false;
				int num312 = (int)this.ai[1] - 1;
				if (Main.npc[num312].active && Main.npc[num312].life > 0)
				{
					float num313 = 16f;
					center = base.Center;
					num309 = Main.npc[num312].Center.X - center.X;
					num310 = Main.npc[num312].Center.Y - center.Y;
					num311 = (float)Math.Sqrt(num309 * num309 + num310 * num310);
					if (num311 < num313)
					{
						velocity.X = num309;
						velocity.Y = num310;
						if (num311 > num313 / 3f)
						{
							if (velocity.X < 0f)
							{
								spriteDirection = -1;
								rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
							}
							else
							{
								spriteDirection = 1;
								rotation = (float)Math.Atan2(velocity.Y, velocity.X);
							}
							if (type == 190)
							{
								velocity.X = 0f;
								velocity.Y = 0f;
							}
						}
					}
					else
					{
						if (num311 == 0f)
						{
							num311 = 0.0001f;
						}
						num311 = num313 / num311;
						num309 *= num311;
						num310 *= num311;
						velocity.X = num309;
						velocity.Y = num310;
						if (velocity.X < 0f)
						{
							spriteDirection = -1;
							rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
						}
						else
						{
							spriteDirection = 1;
							rotation = (float)Math.Atan2(velocity.Y, velocity.X);
						}
					}
					if (type == 190)
					{
						base.position += Main.npc[num312].velocity;
						for (int num314 = 0; num314 < 1000; num314++)
						{
							if (num314 != whoAmI && Main.projectile[num314].active && Main.projectile[num314].owner == owner && Main.projectile[num314].type == 190 && Vector2.Distance(base.Center, Main.projectile[num314].Center) < 8f)
							{
								if (base.position.X < Main.projectile[num314].position.X)
								{
									velocity.X -= 4f;
								}
								else
								{
									velocity.X += 4f;
								}
								if (base.position.Y < Main.projectile[num314].position.Y)
								{
									velocity.Y -= 4f;
								}
								else
								{
									velocity.Y += 4f;
								}
							}
						}
					}
					if (Main.myPlayer == owner)
					{
						float num315 = this.ai[0];
						this.ai[0] = 1f;
						if (num315 != this.ai[0])
						{
							netUpdate = true;
						}
					}
				}
				else if (Main.myPlayer == owner)
				{
					float num316 = this.ai[1];
					this.ai[1] = 0f;
					if (num316 != this.ai[1])
					{
						netUpdate = true;
					}
					float num317 = base.position.X;
					float num318 = base.position.Y;
					float num319 = 3000f;
					int num320 = -1;
					for (int num321 = 0; num321 < Main.maxNPCs; num321++)
					{
						if (Main.npc[num321].CanBeChasedBy(this))
						{
							float x = Main.npc[num321].Center.X;
							float y = Main.npc[num321].Center.Y;
							float num322 = Math.Abs(base.Center.X - x) + Math.Abs(base.Center.Y - y);
							if (num322 < num319 && Collision.CanHit(base.position, width, height, Main.npc[num321].position, Main.npc[num321].width, Main.npc[num321].height))
							{
								num319 = num322;
								num317 = x;
								num318 = y;
								num320 = num321;
							}
						}
					}
					if (num320 >= 0)
					{
						float num323 = 16f;
						center = base.Center;
						num309 = num317 - center.X;
						num310 = num318 - center.Y;
						num311 = (float)Math.Sqrt(num309 * num309 + num310 * num310);
						if (num311 == 0f)
						{
							num311 = 0.0001f;
						}
						num311 = num323 / num311;
						num309 *= num311;
						num310 *= num311;
						velocity.X = num309;
						velocity.Y = num310;
						this.ai[0] = 0f;
						this.ai[1] = num320 + 1;
						netUpdate = true;
					}
				}
			}
			else if (this.ai[0] == 0f)
			{
				if (Main.myPlayer == owner && num311 > 700f)
				{
					this.ai[0] = 1f;
					netUpdate = true;
				}
				if (velocity.X < 0f)
				{
					spriteDirection = -1;
					rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
				}
				else
				{
					spriteDirection = 1;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X);
				}
			}
			else if (this.ai[0] == 1f)
			{
				tileCollide = false;
				if (velocity.X < 0f)
				{
					spriteDirection = 1;
					rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
				}
				else
				{
					spriteDirection = -1;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X);
				}
				if (velocity.X < 0f)
				{
					spriteDirection = -1;
					rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
				}
				else
				{
					spriteDirection = 1;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X);
				}
				float num324 = 20f;
				if (Main.myPlayer == owner && num311 < 70f)
				{
					Kill();
				}
				num311 = num324 / num311;
				num309 *= num311;
				num310 *= num311;
				velocity.X = num309;
				velocity.Y = num310;
				if (type == 190)
				{
					base.position += Main.player[owner].velocity;
				}
			}
			frameCounter++;
			if (frameCounter >= 4)
			{
				frameCounter = 0;
				frame++;
			}
			if (frame >= 4)
			{
				frame = 0;
			}
			if (type == 190)
			{
				AI_AdjustPlayerItemRotationToFaceProjectile();
			}
		}
		else if (aiStyle == 40)
		{
			localAI[0] += 1f;
			if (localAI[0] > 3f)
			{
				localAI[0] = 100f;
				alpha -= 50;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			frameCounter++;
			if (frameCounter >= 3)
			{
				frame++;
				frameCounter = 0;
			}
			if (frame >= 5)
			{
				frame = 0;
			}
			velocity.X += this.ai[0];
			velocity.Y += this.ai[1];
			localAI[1] += 1f;
			if (localAI[1] == 50f)
			{
				localAI[1] = 51f;
				this.ai[0] = (float)Main.rand.Next(-100, 101) * 6E-05f;
				this.ai[1] = (float)Main.rand.Next(-100, 101) * 6E-05f;
			}
			if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) > 16f)
			{
				velocity.X *= 0.95f;
				velocity.Y *= 0.95f;
			}
			if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < 12f)
			{
				velocity.X *= 1.05f;
				velocity.Y *= 1.05f;
			}
			rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 3.14f;
		}
		else if (aiStyle == 41)
		{
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				frame = Main.rand.Next(3);
			}
			rotation += velocity.X * 0.01f;
		}
		else if (aiStyle == 42)
		{
			if (!Main.player[owner].crystalLeaf)
			{
				Kill();
				return;
			}
			base.position.X = Main.player[owner].Center.X - (float)(width / 2);
			base.position.Y = Main.player[owner].Center.Y - (float)(height / 2) + Main.player[owner].gfxOffY - 60f;
			base.position += Main.player[owner].netOffset;
			if (Main.player[owner].gravDir == -1f)
			{
				base.position.Y += 120f;
				rotation = 3.14f;
			}
			else
			{
				rotation = 0f;
			}
			base.position.X = (int)base.position.X;
			base.position.Y = (int)base.position.Y;
			float num325 = (float)(int)Main.mouseTextColor / 200f - 0.35f;
			num325 *= 0.2f;
			scale = num325 + 0.95f;
			if (owner != Main.myPlayer || Main.player[owner].crystalLeafCooldown != 0)
			{
				return;
			}
			float x2 = base.position.X;
			float y2 = base.position.Y;
			float num326 = 700f;
			NPC nPC2 = null;
			for (int num327 = 0; num327 < Main.maxNPCs; num327++)
			{
				if (Main.npc[num327].CanBeChasedBy(this))
				{
					float num328 = Main.npc[num327].position.X + (float)(Main.npc[num327].width / 2);
					float num329 = Main.npc[num327].position.Y + (float)(Main.npc[num327].height / 2);
					float num330 = Math.Abs(base.position.X + (float)(width / 2) - num328) + Math.Abs(base.position.Y + (float)(height / 2) - num329);
					if (num330 < num326 && Collision.CanHit(base.position, width, height, Main.npc[num327].position, Main.npc[num327].width, Main.npc[num327].height))
					{
						num326 = num330;
						nPC2 = Main.npc[num327];
					}
				}
			}
			if (nPC2 != null)
			{
				float num331 = 12f;
				Vector2 vector30 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
				float num332 = x2 - vector30.X;
				float num333 = y2 - vector30.Y;
				float num334 = (float)Math.Sqrt(num332 * num332 + num333 * num333);
				float num335 = num334;
				num334 = num331 / num334;
				num332 *= num334;
				num333 *= num334;
				int num336 = 180;
				Utils.ChaseResults chaseResults = Utils.GetChaseResults(base.Center, num331 * (float)num336, nPC2.Center, nPC2.velocity);
				if (chaseResults.InterceptionHappens && chaseResults.InterceptionTime <= 180f)
				{
					Vector2 vector31 = chaseResults.ChaserVelocity / num336;
					num332 = vector31.X;
					num333 = vector31.Y;
				}
				NewProjectile(GetProjectileSource_FromThis(), base.Center.X - 4f, base.Center.Y, num332, num333, 227, Player.crystalLeafDamage, Player.crystalLeafKB, owner);
				Main.player[owner].crystalLeafCooldown = 40;
			}
		}
		else if (aiStyle == 43)
		{
			rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 3.14f;
			if (soundDelay == 0 && type == 227)
			{
				soundDelay = -1;
				SoundEngine.PlaySound(6, (int)base.position.X, (int)base.position.Y);
				for (int num337 = 0; num337 < 8; num337++)
				{
					int num338 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 157);
					Main.dust[num338].noGravity = true;
					Dust dust2 = Main.dust[num338];
					dust2.velocity *= 3f;
					Main.dust[num338].scale = 1.5f;
					dust2 = Main.dust[num338];
					dust2.velocity += velocity * Main.rand.NextFloat();
				}
			}
			float num339 = 1f - (float)timeLeft / 180f;
			float num340 = ((num339 * -6f * 0.85f + 0.33f) % 1f + 1f) % 1f;
			Color value2 = Main.hslToRgb(num340, 1f, 0.5f);
			value2 = Color.Lerp(value2, Color.Red, Utils.Remap(num340, 0.33f, 0.7f, 0f, 1f));
			value2 = Color.Lerp(value2, Color.Lerp(Color.LimeGreen, Color.Gold, 0.3f), (float)(int)value2.R / 255f * 1f);
			if (frameCounter++ >= 1)
			{
				frameCounter = 0;
				if (owner == Main.myPlayer)
				{
					ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.ChlorophyteLeafCrystalShot, new ParticleOrchestraSettings
					{
						PositionInWorld = base.Center,
						MovementVector = velocity,
						UniqueInfoPiece = (byte)(Main.rgbToHsl(value2).X * 255f)
					});
				}
			}
		}
		else if (aiStyle == 44)
		{
			int num341 = 6;
			if (type == 228)
			{
				velocity *= 0.96f;
				alpha += 2;
				if (alpha > 200)
				{
					Kill();
				}
			}
			else if (type == 732)
			{
				num341 = 3;
				alpha += 12;
				if (alpha > 255)
				{
					Kill();
				}
				if (Main.rand.Next(5) == 0)
				{
					Dust dust15 = Dust.NewDustDirect(base.position, width, height, 226, 0f, 0f, 150, default(Color), 0.8f);
					dust15.noGravity = true;
					Dust dust2 = dust15;
					dust2.velocity *= 1.2f;
				}
				rotation = velocity.ToRotation();
				Lighting.AddLight(base.Center, 0.3f, 0.6f, 0.8f);
			}
			else if (type == 229)
			{
				if (this.ai[0] == 0f)
				{
					SoundEngine.PlaySound(SoundID.Item8, base.position);
				}
				this.ai[0] += 1f;
				if (this.ai[0] > 20f)
				{
					velocity.Y += 0.3f;
					velocity.X *= 0.98f;
				}
			}
			if (++frameCounter >= num341)
			{
				frameCounter = 0;
				if (++frame >= Main.projFrames[type])
				{
					frame = 0;
				}
			}
		}
		else if (aiStyle == 45)
		{
			if (type == 237 || type == 243)
			{
				float num342 = this.ai[0];
				float num343 = this.ai[1];
				if (num342 != 0f && num343 != 0f)
				{
					bool flag18 = false;
					bool flag19 = false;
					if (velocity.X == 0f || (velocity.X < 0f && base.Center.X < num342) || (velocity.X > 0f && base.Center.X > num342))
					{
						velocity.X = 0f;
						flag18 = true;
					}
					if (velocity.Y == 0f || (velocity.Y < 0f && base.Center.Y < num343) || (velocity.Y > 0f && base.Center.Y > num343))
					{
						velocity.Y = 0f;
						flag19 = true;
					}
					if (owner == Main.myPlayer && flag18 && flag19)
					{
						Kill();
					}
				}
				rotation += velocity.X * 0.02f;
				frameCounter++;
				if (frameCounter > 4)
				{
					frameCounter = 0;
					frame++;
					if (frame > 3)
					{
						frame = 0;
					}
				}
			}
			else if (type == 238 || type == 244)
			{
				bool flag20 = true;
				int num344 = (int)base.Center.X;
				int num345 = (int)(base.position.Y + (float)height);
				if (Collision.SolidTiles(new Vector2(num344, num345), 2, 20))
				{
					flag20 = false;
				}
				frameCounter++;
				if (frameCounter > 8)
				{
					frameCounter = 0;
					frame++;
					if ((!flag20 && frame > 2) || frame > 5)
					{
						frame = 0;
					}
				}
				this.ai[1] += 1f;
				if (type == 244 && this.ai[1] >= 18000f)
				{
					alpha += 5;
					if (alpha > 255)
					{
						alpha = 255;
						Kill();
					}
				}
				else if (type == 238 && this.ai[1] >= 18000f)
				{
					alpha += 5;
					if (alpha > 255)
					{
						alpha = 255;
						Kill();
					}
				}
				else if (flag20)
				{
					this.ai[0] += 1f;
					if (type == 244)
					{
						if (this.ai[0] > 10f)
						{
							this.ai[0] = 0f;
							if (owner == Main.myPlayer)
							{
								num344 += Main.rand.Next(-14, 15);
								NewProjectile(GetProjectileSource_FromThis(), num344, num345, 0f, 5f, 245, damage, 0f, owner);
							}
						}
					}
					else if (this.ai[0] > 8f)
					{
						this.ai[0] = 0f;
						if (owner == Main.myPlayer)
						{
							num344 += Main.rand.Next(-14, 15);
							NewProjectile(GetProjectileSource_FromThis(), num344, num345, 0f, 5f, 239, damage, 0f, owner);
						}
					}
				}
				localAI[0] += 1f;
				if (!(localAI[0] >= 10f))
				{
					return;
				}
				localAI[0] = 0f;
				int num346 = 0;
				int num347 = 0;
				float num348 = 0f;
				int num349 = type;
				for (int num350 = 0; num350 < 1000; num350++)
				{
					if (Main.projectile[num350].active && Main.projectile[num350].owner == owner && Main.projectile[num350].type == num349 && Main.projectile[num350].ai[1] < 18000f)
					{
						num346++;
						if (Main.projectile[num350].ai[1] > num348)
						{
							num347 = num350;
							num348 = Main.projectile[num350].ai[1];
						}
					}
				}
				if (type == 244)
				{
					if (num346 > 1)
					{
						Main.projectile[num347].netUpdate = true;
						Main.projectile[num347].ai[1] = 18000f;
					}
				}
				else if (num346 > 2)
				{
					Main.projectile[num347].netUpdate = true;
					Main.projectile[num347].ai[1] = 18000f;
				}
			}
			else if (type == 239 || type == 245 || type == 264)
			{
				int num351 = (int)(base.Center.X / 16f);
				int num352 = (int)((base.position.Y + (float)height) / 16f);
				if (WorldGen.InWorld(num351, num352) && Main.tile[num351, num352] != null && Main.tile[num351, num352].liquid == byte.MaxValue && Main.tile[num351, num352].shimmer() && velocity.Y > 0f)
				{
					velocity.Y *= -1f;
					netUpdate = true;
				}
				if (type == 239)
				{
					alpha = 50;
				}
				else if (type == 245)
				{
					alpha = 100;
				}
				else if (type == 264)
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				}
			}
		}
		else if (aiStyle == 46)
		{
			int num353 = (int)(base.Center.X / 16f);
			int num354 = (int)(base.Center.Y / 16f);
			if (WorldGen.InWorld(num353, num354) && Main.tile[num353, num354] != null && Main.tile[num353, num354].liquid > 0 && Main.tile[num353, num354].shimmer())
			{
				Kill();
			}
			int num355 = 2400;
			if (type == 250)
			{
				Point point3 = base.Center.ToTileCoordinates();
				if (!WorldGen.InWorld(point3.X, point3.Y, 2) || Main.tile[point3.X, point3.Y] == null)
				{
					Kill();
					return;
				}
				if (owner == Main.myPlayer)
				{
					localAI[0] += 1f;
					if (localAI[0] > 4f)
					{
						localAI[0] = 3f;
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, velocity.X * 0.001f, velocity.Y * 0.001f, 251, damage, knockBack, owner);
					}
					if (timeLeft > num355)
					{
						timeLeft = num355;
					}
				}
				float num356 = 1f;
				if (velocity.Y < 0f)
				{
					num356 -= velocity.Y / 3f;
				}
				this.ai[0] += num356;
				if (this.ai[0] > 30f)
				{
					velocity.Y += 0.5f;
					if (velocity.Y > 0f)
					{
						velocity.X *= 0.95f;
					}
					else
					{
						velocity.X *= 1.05f;
					}
				}
				float x3 = velocity.X;
				float y3 = velocity.Y;
				float num357 = (float)Math.Sqrt(x3 * x3 + y3 * y3);
				num357 = 15.95f * scale / num357;
				x3 *= num357;
				y3 *= num357;
				velocity.X = x3;
				velocity.Y = y3;
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
				return;
			}
			if (localAI[0] == 0f)
			{
				if (velocity.X > 0f)
				{
					spriteDirection = -1;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
				}
				else
				{
					spriteDirection = 1;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
				}
				localAI[0] = 1f;
				timeLeft = num355;
			}
			velocity.X *= 0.98f;
			velocity.Y *= 0.98f;
			if (rotation == 0f)
			{
				alpha = 255;
			}
			else if (timeLeft < 10)
			{
				alpha = 255 - (int)(255f * (float)timeLeft / 10f);
			}
			else if (timeLeft > num355 - 10)
			{
				int num358 = num355 - timeLeft;
				alpha = 255 - (int)(255f * (float)num358 / 10f);
			}
			else
			{
				alpha = 0;
			}
		}
		else if (aiStyle == 47)
		{
			AI_047_MagnetSphere();
		}
		else if (aiStyle == 48)
		{
			if (!WorldGen.InWorld(base.Center.ToTileCoordinates(), 5))
			{
				Kill();
				return;
			}
			int num359 = AI_048_GetStartPositionSettingDelay();
			if (localAI[0] == (float)num359)
			{
				localAI[1] = base.Center.X;
				localAI[2] = base.Center.Y;
			}
			localAI[0]++;
			if (type == 255)
			{
				alpha = 255;
			}
			else if (type == 433)
			{
				alpha = 255;
			}
			else if (type == 290)
			{
				alpha = 255;
				if (localAI[0] == 1f)
				{
					SoundEngine.PlaySound(SoundID.Item8, base.position);
				}
			}
			else if (type == 294)
			{
				alpha = 255;
			}
			else
			{
				alpha = 255;
			}
		}
		else if (aiStyle == 49)
		{
			if (this.ai[0] == -2f)
			{
				hostile = true;
				Kill();
				return;
			}
			if (this.ai[0] == -3f)
			{
				Kill();
				return;
			}
			if (soundDelay == 0)
			{
				soundDelay = 3000;
				SoundEngine.PlaySound(SoundID.Item14, base.position);
			}
			if (this.ai[0] >= 0f)
			{
				if (velocity.X > 0f)
				{
					direction = 1;
				}
				else if (velocity.X < 0f)
				{
					direction = -1;
				}
				spriteDirection = direction;
				this.ai[0] += 1f;
				rotation += velocity.X * 0.05f + (float)direction * 0.05f;
				if (this.ai[0] >= 18f)
				{
					velocity.Y += 0.28f;
					velocity.X *= 0.99f;
				}
				if ((double)velocity.Y > 15.9)
				{
					velocity.Y = 15.9f;
				}
				if (!(this.ai[0] > 2f))
				{
					return;
				}
				alpha = 0;
				if (this.ai[0] == 3f)
				{
					for (int num360 = 0; num360 < 10; num360++)
					{
						int num361 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num361];
						dust2.velocity *= 0.5f;
						dust2 = Main.dust[num361];
						dust2.velocity += velocity * 0.1f;
					}
					for (int num362 = 0; num362 < 5; num362++)
					{
						int num363 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2f);
						Main.dust[num363].noGravity = true;
						Dust dust2 = Main.dust[num363];
						dust2.velocity *= 3f;
						dust2 = Main.dust[num363];
						dust2.velocity += velocity * 0.2f;
						num363 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100);
						dust2 = Main.dust[num363];
						dust2.velocity *= 2f;
						dust2 = Main.dust[num363];
						dust2.velocity += velocity * 0.3f;
					}
					for (int num364 = 0; num364 < 1; num364++)
					{
						int num365 = Gore.NewGore(new Vector2(base.position.X - 10f, base.position.Y - 10f), default(Vector2), Main.rand.Next(61, 64));
						Gore gore = Main.gore[num365];
						gore.position += velocity * 1.25f;
						Main.gore[num365].scale = 1.5f;
						gore = Main.gore[num365];
						gore.velocity += velocity * 0.5f;
						gore = Main.gore[num365];
						gore.velocity *= 0.02f;
					}
				}
			}
			else if (this.ai[0] == -1f)
			{
				rotation = 0f;
				velocity.X *= 0.95f;
				velocity.Y += 0.2f;
			}
		}
		else if (aiStyle == 50)
		{
			if (type == 291)
			{
				if (localAI[0] == 0f)
				{
					SoundEngine.PlaySound(SoundID.Item20, base.position);
					localAI[0] += 1f;
				}
				bool flag21 = false;
				bool flag22 = false;
				if (velocity.X < 0f && base.position.X < this.ai[0])
				{
					flag21 = true;
				}
				if (velocity.X > 0f && base.position.X > this.ai[0])
				{
					flag21 = true;
				}
				if (velocity.Y < 0f && base.position.Y < this.ai[1])
				{
					flag22 = true;
				}
				if (velocity.Y > 0f && base.position.Y > this.ai[1])
				{
					flag22 = true;
				}
				if (flag21 && flag22)
				{
					Kill();
				}
				for (int num366 = 0; num366 < 10; num366++)
				{
					int num367 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 174, 0f, 0f, 100, default(Color), 1.2f);
					Main.dust[num367].noGravity = true;
					Dust dust2 = Main.dust[num367];
					dust2.velocity *= 0.5f;
					dust2 = Main.dust[num367];
					dust2.velocity += velocity * 0.1f;
				}
				return;
			}
			if (type == 295)
			{
				for (int num368 = 0; num368 < 8; num368++)
				{
					int num369 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 174, 0f, 0f, 100, default(Color), 1.2f);
					Main.dust[num369].noGravity = true;
					Dust dust2 = Main.dust[num369];
					dust2.velocity *= 0.5f;
					dust2 = Main.dust[num369];
					dust2.velocity += velocity * 0.1f;
				}
				return;
			}
			if (localAI[0] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item74, base.position);
				localAI[0] += 1f;
			}
			this.ai[0] += 1f;
			if (type == 296)
			{
				this.ai[0] += 3f;
			}
			float num370 = 25f;
			if (this.ai[0] > 540f)
			{
				num370 -= (this.ai[0] - 180f) / 2f;
			}
			if (num370 <= 0f)
			{
				num370 = 0f;
				Kill();
			}
			if (type == 296)
			{
				num370 *= 0.7f;
			}
			for (int num371 = 0; (float)num371 < num370; num371++)
			{
				float num372 = Main.rand.Next(-10, 11);
				float num373 = Main.rand.Next(-10, 11);
				float num374 = Main.rand.Next(3, 9);
				float num375 = (float)Math.Sqrt(num372 * num372 + num373 * num373);
				num375 = num374 / num375;
				num372 *= num375;
				num373 *= num375;
				int num376 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 174, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num376].noGravity = true;
				Main.dust[num376].position.X = base.Center.X;
				Main.dust[num376].position.Y = base.Center.Y;
				Main.dust[num376].position.X += Main.rand.Next(-10, 11);
				Main.dust[num376].position.Y += Main.rand.Next(-10, 11);
				Main.dust[num376].velocity.X = num372;
				Main.dust[num376].velocity.Y = num373;
			}
		}
		else if (aiStyle == 51)
		{
			if (type == 297)
			{
				localAI[0] += 1f;
				if (localAI[0] > 4f)
				{
					for (int num377 = 0; num377 < 5; num377++)
					{
						int num378 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 175, 0f, 0f, 100, default(Color), 2f);
						Main.dust[num378].noGravity = true;
						Dust dust2 = Main.dust[num378];
						dust2.velocity *= 0f;
					}
				}
			}
			else
			{
				if (localAI[0] == 0f)
				{
					SoundEngine.PlaySound(SoundID.Item8, base.position);
					localAI[0] += 1f;
				}
				for (int num379 = 0; num379 < 9; num379++)
				{
					int num380 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 175, 0f, 0f, 100, default(Color), 1.3f);
					Main.dust[num380].noGravity = true;
					Dust dust2 = Main.dust[num380];
					dust2.velocity *= 0f;
				}
			}
			float num381 = base.Center.X;
			float num382 = base.Center.Y;
			float num383 = 400f;
			bool flag23 = false;
			int num384 = 0;
			if (type == 297)
			{
				for (int num385 = 0; num385 < Main.maxNPCs; num385++)
				{
					if (Main.npc[num385].CanBeChasedBy(this) && Distance(Main.npc[num385].Center) < num383 && Collision.CanHit(base.Center, 1, 1, Main.npc[num385].Center, 1, 1))
					{
						float num386 = Main.npc[num385].position.X + (float)(Main.npc[num385].width / 2);
						float num387 = Main.npc[num385].position.Y + (float)(Main.npc[num385].height / 2);
						float num388 = Math.Abs(base.position.X + (float)(width / 2) - num386) + Math.Abs(base.position.Y + (float)(height / 2) - num387);
						if (num388 < num383)
						{
							num383 = num388;
							num381 = num386;
							num382 = num387;
							flag23 = true;
							num384 = num385;
						}
					}
				}
			}
			else
			{
				num383 = 200f;
				for (int num389 = 0; num389 < 255; num389++)
				{
					if (Main.player[num389].active && !Main.player[num389].dead)
					{
						float num390 = Main.player[num389].position.X + (float)(Main.player[num389].width / 2);
						float num391 = Main.player[num389].position.Y + (float)(Main.player[num389].height / 2);
						float num392 = Math.Abs(base.position.X + (float)(width / 2) - num390) + Math.Abs(base.position.Y + (float)(height / 2) - num391);
						if (num392 < num383)
						{
							num383 = num392;
							num381 = num390;
							num382 = num391;
							flag23 = true;
							num384 = num389;
						}
					}
				}
			}
			if (flag23)
			{
				float num393 = 3f;
				if (type == 297)
				{
					num393 = 6f;
				}
				Vector2 vector32 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
				float num394 = num381 - vector32.X;
				float num395 = num382 - vector32.Y;
				float num396 = (float)Math.Sqrt(num394 * num394 + num395 * num395);
				float num397 = num396;
				num396 = num393 / num396;
				num394 *= num396;
				num395 *= num396;
				if (type == 297)
				{
					velocity.X = (velocity.X * 20f + num394) / 21f;
					velocity.Y = (velocity.Y * 20f + num395) / 21f;
				}
				else
				{
					velocity.X = (velocity.X * 100f + num394) / 101f;
					velocity.Y = (velocity.Y * 100f + num395) / 101f;
				}
			}
		}
		else if (aiStyle == 52)
		{
			int num398 = (int)this.ai[0];
			float num399 = 4f;
			Vector2 vector33 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
			float num400 = Main.player[num398].Center.X - vector33.X;
			float num401 = Main.player[num398].Center.Y - vector33.Y;
			float num402 = (float)Math.Sqrt(num400 * num400 + num401 * num401);
			float num403 = num402;
			if (num402 < 50f && base.position.X < Main.player[num398].position.X + (float)Main.player[num398].width && base.position.X + (float)width > Main.player[num398].position.X && base.position.Y < Main.player[num398].position.Y + (float)Main.player[num398].height && base.position.Y + (float)height > Main.player[num398].position.Y)
			{
				if (owner == Main.myPlayer && !Main.player[Main.myPlayer].moonLeech)
				{
					int num404 = (int)this.ai[1];
					Main.player[num398].HealEffect(num404, broadcast: false);
					Player player5 = Main.player[num398];
					player5.statLife += num404;
					if (Main.player[num398].statLife > Main.player[num398].statLifeMax2)
					{
						Main.player[num398].statLife = Main.player[num398].statLifeMax2;
					}
					NetMessage.SendData(66, -1, -1, null, num398, num404);
				}
				Kill();
			}
			num402 = num399 / num402;
			num400 *= num402;
			num401 *= num402;
			velocity.X = (velocity.X * 15f + num400) / 16f;
			velocity.Y = (velocity.Y * 15f + num401) / 16f;
			if (type == 305)
			{
				for (int num405 = 0; num405 < 3; num405++)
				{
					float num406 = velocity.X * 0.334f * (float)num405;
					float num407 = (0f - velocity.Y * 0.334f) * (float)num405;
					int num408 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 183, 0f, 0f, 100, default(Color), 1.1f);
					Main.dust[num408].noGravity = true;
					Dust dust2 = Main.dust[num408];
					dust2.velocity *= 0f;
					Main.dust[num408].position.X -= num406;
					Main.dust[num408].position.Y -= num407;
				}
			}
			else
			{
				for (int num409 = 0; num409 < 5; num409++)
				{
					float num410 = velocity.X * 0.2f * (float)num409;
					float num411 = (0f - velocity.Y * 0.2f) * (float)num409;
					int num412 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 175, 0f, 0f, 100, default(Color), 1.3f);
					Main.dust[num412].noGravity = true;
					Dust dust2 = Main.dust[num412];
					dust2.velocity *= 0f;
					Main.dust[num412].position.X -= num410;
					Main.dust[num412].position.Y -= num411;
				}
			}
		}
		else if (aiStyle == 53)
		{
			if (localAI[0] == 0f)
			{
				localAI[1] = 1f;
				localAI[0] = 1f;
				this.ai[0] = 120f;
				int num413 = 80;
				SoundEngine.PlaySound(SoundID.Item46, base.position);
				if (type == 308)
				{
					for (int num414 = 0; num414 < num413; num414++)
					{
						int num415 = Dust.NewDust(new Vector2(base.position.X, base.position.Y + 16f), width, height - 16, 185);
						Dust dust2 = Main.dust[num415];
						dust2.velocity *= 2f;
						Main.dust[num415].noGravity = true;
						dust2 = Main.dust[num415];
						dust2.scale *= 1.15f;
					}
				}
				if (type == 377)
				{
					frame = 4;
					num413 = 40;
					for (int num416 = 0; num416 < num413; num416++)
					{
						int num417 = Dust.NewDust(base.position + Vector2.UnitY * 16f, width, height - 16, 171, 0f, 0f, 100);
						Main.dust[num417].scale = (float)Main.rand.Next(1, 10) * 0.1f;
						Main.dust[num417].noGravity = true;
						Main.dust[num417].fadeIn = 1.5f;
						Dust dust2 = Main.dust[num417];
						dust2.velocity *= 0.75f;
					}
				}
				if (type == 966)
				{
					this.ai[1] = -1f;
					frame = 0;
					num413 = 30;
					int num418 = 25;
					int num419 = 30;
					for (int num420 = 0; num420 < num413; num420++)
					{
						int num421 = Dust.NewDust(base.Center - new Vector2(num418, num419), num418 * 2, num419 * 2, 219);
						Dust dust2 = Main.dust[num421];
						dust2.velocity *= 2f;
						Main.dust[num421].noGravity = true;
						dust2 = Main.dust[num421];
						dust2.scale *= 0.5f;
					}
				}
			}
			velocity.X = 0f;
			velocity.Y += 0.2f;
			if (velocity.Y > 16f)
			{
				velocity.Y = 16f;
			}
			int targetSlot = -1;
			float x4 = -1f;
			float y4 = -1f;
			Vector2 zero = Vector2.Zero;
			if (type == 966)
			{
				zero.Y -= 16f;
			}
			bool straightLine = false;
			if (AI_053_HandleSentryNPCTargeting(zero, straightLine, out targetSlot, out x4, out y4))
			{
				if (type == 966 && this.ai[1] != (float)targetSlot)
				{
					this.ai[1] = targetSlot;
					netUpdate = true;
				}
				float num422 = x4;
				float num423 = y4;
				x4 -= base.Center.X;
				y4 -= base.Center.Y;
				int num424 = 0;
				if (type != 966)
				{
					if (frameCounter > 0)
					{
						frameCounter--;
					}
					if (frameCounter <= 0)
					{
						int num425 = spriteDirection;
						if (x4 < 0f)
						{
							spriteDirection = -1;
						}
						else
						{
							spriteDirection = 1;
						}
						num424 = ((!(y4 > 0f)) ? ((Math.Abs(y4) > Math.Abs(x4) * 3f) ? 4 : ((Math.Abs(y4) > Math.Abs(x4) * 2f) ? 3 : ((!(Math.Abs(x4) > Math.Abs(y4) * 3f)) ? ((Math.Abs(x4) > Math.Abs(y4) * 2f) ? 1 : 2) : 0))) : 0);
						int num426 = frame;
						if (type == 308)
						{
							frame = num424 * 2;
						}
						else if (type == 377)
						{
							frame = num424;
						}
						if (this.ai[0] > 40f && localAI[1] == 0f && type == 308)
						{
							frame++;
						}
						if (num426 != frame || num425 != spriteDirection)
						{
							frameCounter = 8;
							if (this.ai[0] <= 0f)
							{
								frameCounter = 4;
							}
						}
					}
				}
				if (this.ai[0] <= 0f)
				{
					float num427 = 60f;
					if (type == 966)
					{
						num427 = 90f;
					}
					localAI[1] = 0f;
					this.ai[0] = num427;
					netUpdate = true;
					if (Main.myPlayer == owner)
					{
						float num428 = 6f;
						int num429 = 309;
						if (type == 308)
						{
							num429 = 309;
							num428 = 9f;
						}
						if (type == 377)
						{
							num429 = 378;
							num428 = 9f;
						}
						if (type == 966)
						{
							num429 = 967;
							num428 = 12.5f;
						}
						bool flag24 = type == 966;
						if (!flag24)
						{
							switch (num424)
							{
							case 0:
								zero.Y += 12f;
								zero.X += 24 * spriteDirection;
								break;
							case 1:
								zero.Y += 0f;
								zero.X += 24 * spriteDirection;
								break;
							case 2:
								zero.Y -= 2f;
								zero.X += 24 * spriteDirection;
								break;
							case 3:
								zero.Y -= 6f;
								zero.X += 14 * spriteDirection;
								break;
							case 4:
								zero.Y -= 14f;
								zero.X += 2 * spriteDirection;
								break;
							}
						}
						if (!flag24 && spriteDirection < 0)
						{
							zero.X += 10f;
						}
						Vector2 vector34 = base.Center + zero;
						float num430 = num422 - vector34.X;
						float num431 = num423 - vector34.Y;
						float num432 = (float)Math.Sqrt(num430 * num430 + num431 * num431);
						float num433 = num432;
						num432 = num428 / num432;
						num430 *= num432;
						num431 *= num432;
						int num434 = damage;
						int num435 = NewProjectile(GetProjectileSource_FromThis(), vector34.X, vector34.Y, num430, num431, num429, num434, knockBack, Main.myPlayer);
					}
				}
			}
			else
			{
				if (type == 966 && this.ai[1] != -1f)
				{
					this.ai[1] = -1f;
					netUpdate = true;
				}
				if (type != 966 && this.ai[0] <= 60f && (frame == 1 || frame == 3 || frame == 5 || frame == 7 || frame == 9))
				{
					frame--;
				}
			}
			if (this.ai[0] > 0f)
			{
				this.ai[0] -= 1f;
			}
		}
		else if (aiStyle == 54)
		{
			if (type == 317)
			{
				if (Main.player[Main.myPlayer].dead)
				{
					Main.player[Main.myPlayer].raven = false;
				}
				if (Main.player[Main.myPlayer].raven)
				{
					timeLeft = 2;
				}
			}
			for (int num436 = 0; num436 < 1000; num436++)
			{
				if (num436 != whoAmI && Main.projectile[num436].active && Main.projectile[num436].owner == owner && Main.projectile[num436].type == type && Math.Abs(base.position.X - Main.projectile[num436].position.X) + Math.Abs(base.position.Y - Main.projectile[num436].position.Y) < (float)width)
				{
					if (base.position.X < Main.projectile[num436].position.X)
					{
						velocity.X -= 0.05f;
					}
					else
					{
						velocity.X += 0.05f;
					}
					if (base.position.Y < Main.projectile[num436].position.Y)
					{
						velocity.Y -= 0.05f;
					}
					else
					{
						velocity.Y += 0.05f;
					}
				}
			}
			float num437 = base.position.X;
			float num438 = base.position.Y;
			float num439 = 900f;
			bool flag25 = false;
			int num440 = 500;
			if (this.ai[1] != 0f || friendly)
			{
				num440 = 1400;
			}
			if (Math.Abs(base.Center.X - Main.player[owner].Center.X) + Math.Abs(base.Center.Y - Main.player[owner].Center.Y) > (float)num440)
			{
				this.ai[0] = 1f;
			}
			if (this.ai[0] == 0f)
			{
				tileCollide = true;
				NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
				if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this))
				{
					float num441 = ownerMinionAttackTargetNPC.position.X + (float)(ownerMinionAttackTargetNPC.width / 2);
					float num442 = ownerMinionAttackTargetNPC.position.Y + (float)(ownerMinionAttackTargetNPC.height / 2);
					float num443 = Math.Abs(base.position.X + (float)(width / 2) - num441) + Math.Abs(base.position.Y + (float)(height / 2) - num442);
					if (num443 < num439 && Collision.CanHit(base.position, width, height, ownerMinionAttackTargetNPC.position, ownerMinionAttackTargetNPC.width, ownerMinionAttackTargetNPC.height))
					{
						num439 = num443;
						num437 = num441;
						num438 = num442;
						flag25 = true;
					}
				}
				if (!flag25)
				{
					for (int num444 = 0; num444 < Main.maxNPCs; num444++)
					{
						if (Main.npc[num444].CanBeChasedBy(this))
						{
							float num445 = Main.npc[num444].position.X + (float)(Main.npc[num444].width / 2);
							float num446 = Main.npc[num444].position.Y + (float)(Main.npc[num444].height / 2);
							float num447 = Math.Abs(base.position.X + (float)(width / 2) - num445) + Math.Abs(base.position.Y + (float)(height / 2) - num446);
							if (num447 < num439 && Collision.CanHit(base.position, width, height, Main.npc[num444].position, Main.npc[num444].width, Main.npc[num444].height))
							{
								num439 = num447;
								num437 = num445;
								num438 = num446;
								flag25 = true;
							}
						}
					}
				}
			}
			else
			{
				tileCollide = false;
			}
			if (!flag25)
			{
				friendly = true;
				float num448 = 8f;
				if (this.ai[0] == 1f)
				{
					num448 = 12f;
				}
				Vector2 vector35 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
				float num449 = Main.player[owner].Center.X - vector35.X;
				float num450 = Main.player[owner].Center.Y - vector35.Y - 60f;
				float num451 = (float)Math.Sqrt(num449 * num449 + num450 * num450);
				float num452 = num451;
				if (num451 < 100f && this.ai[0] == 1f && !Collision.SolidCollision(base.position, width, height))
				{
					this.ai[0] = 0f;
				}
				if (num451 > 2000f)
				{
					base.position.X = Main.player[owner].Center.X - (float)(width / 2);
					base.position.Y = Main.player[owner].Center.Y - (float)(width / 2);
				}
				if (type == 317 && num451 > 100f)
				{
					num448 = 12f;
					if (this.ai[0] == 1f)
					{
						num448 = 15f;
					}
				}
				if (num451 > 70f)
				{
					num451 = num448 / num451;
					num449 *= num451;
					num450 *= num451;
					velocity.X = (velocity.X * 20f + num449) / 21f;
					velocity.Y = (velocity.Y * 20f + num450) / 21f;
				}
				else
				{
					if (velocity.X == 0f && velocity.Y == 0f)
					{
						velocity.X = -0.15f;
						velocity.Y = -0.05f;
					}
					velocity *= 1.01f;
				}
				friendly = false;
				rotation = velocity.X * 0.05f;
				frameCounter++;
				if (frameCounter >= 4)
				{
					frameCounter = 0;
					frame++;
				}
				if (frame > 3)
				{
					frame = 0;
				}
				if ((double)Math.Abs(velocity.X) > 0.2)
				{
					spriteDirection = -direction;
				}
				return;
			}
			if (this.ai[1] == -1f)
			{
				this.ai[1] = 17f;
			}
			if (this.ai[1] > 0f)
			{
				this.ai[1] -= 1f;
			}
			if (this.ai[1] == 0f)
			{
				friendly = true;
				float num453 = 16f;
				Vector2 vector36 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
				float num454 = num437 - vector36.X;
				float num455 = num438 - vector36.Y;
				float num456 = (float)Math.Sqrt(num454 * num454 + num455 * num455);
				float num457 = num456;
				if (num456 < 100f)
				{
					num453 = 10f;
				}
				num456 = num453 / num456;
				num454 *= num456;
				num455 *= num456;
				velocity.X = (velocity.X * 14f + num454) / 15f;
				velocity.Y = (velocity.Y * 14f + num455) / 15f;
			}
			else
			{
				friendly = false;
				if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < 10f)
				{
					velocity *= 1.05f;
				}
			}
			rotation = velocity.X * 0.05f;
			frameCounter++;
			if (frameCounter >= 4)
			{
				frameCounter = 0;
				frame++;
			}
			if (frame < 4)
			{
				frame = 4;
			}
			if (frame > 7)
			{
				frame = 4;
			}
			if ((double)Math.Abs(velocity.X) > 0.2)
			{
				spriteDirection = -direction;
			}
		}
		else if (aiStyle == 55)
		{
			frameCounter++;
			if (frameCounter > 0)
			{
				frame++;
				frameCounter = 0;
				if (frame > 2)
				{
					frame = 0;
				}
			}
			if (velocity.X < 0f)
			{
				spriteDirection = -1;
				rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
			}
			else
			{
				spriteDirection = 1;
				rotation = (float)Math.Atan2(velocity.Y, velocity.X);
			}
			if (this.ai[0] >= 0f && this.ai[0] < (float)Main.maxNPCs)
			{
				int num458 = (int)this.ai[0];
				NPC nPC3 = Main.npc[num458];
				if (nPC3.CanBeChasedBy(this) && !NPCID.Sets.CountsAsCritter[nPC3.type])
				{
					float num459 = 8f;
					Vector2 center2 = base.Center;
					float num460 = nPC3.Center.X - center2.X;
					float num461 = nPC3.Center.Y - center2.Y;
					float num462 = (float)Math.Sqrt(num460 * num460 + num461 * num461);
					float num463 = num462;
					num462 = num459 / num462;
					num460 *= num462;
					num461 *= num462;
					velocity.X = (velocity.X * 14f + num460) / 15f;
					velocity.Y = (velocity.Y * 14f + num461) / 15f;
				}
				else
				{
					float num464 = 1000f;
					for (int num465 = 0; num465 < Main.maxNPCs; num465++)
					{
						NPC nPC4 = Main.npc[num465];
						if (nPC4.CanBeChasedBy(this) && !NPCID.Sets.CountsAsCritter[nPC4.type])
						{
							float x5 = nPC4.Center.X;
							float y5 = nPC4.Center.Y;
							float num466 = Math.Abs(base.Center.X - x5) + Math.Abs(base.Center.Y - y5);
							if (num466 < num464 && Collision.CanHit(base.position, width, height, nPC4.position, nPC4.width, nPC4.height))
							{
								num464 = num466;
								this.ai[0] = num465;
							}
						}
					}
				}
				int num467 = 8;
				int num468 = Dust.NewDust(new Vector2(base.position.X + (float)num467, base.position.Y + (float)num467), width - num467 * 2, height - num467 * 2, 6);
				Dust dust2 = Main.dust[num468];
				dust2.velocity *= 0.5f;
				dust2 = Main.dust[num468];
				dust2.velocity += velocity * 0.5f;
				Main.dust[num468].noGravity = true;
				Main.dust[num468].noLight = true;
				Main.dust[num468].scale = 1.4f;
			}
			else
			{
				Kill();
			}
		}
		else if (aiStyle == 56)
		{
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				rotation = this.ai[0];
				spriteDirection = -(int)this.ai[1];
			}
			if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < 16f)
			{
				velocity *= 1.05f;
			}
			if (velocity.X < 0f)
			{
				direction = -1;
			}
			else
			{
				direction = 1;
			}
			rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.025f * (float)direction;
		}
		else if (aiStyle == 57)
		{
			this.ai[0] += 1f;
			if (this.ai[0] > 30f)
			{
				this.ai[0] = 30f;
				velocity.Y += 0.25f;
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
				velocity.X *= 0.995f;
			}
			rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
			alpha -= 50;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (owner == Main.myPlayer)
			{
				if (localAI[1] == 0f)
				{
					localAI[1] = Main.rand.Next(7);
				}
				localAI[0]++;
				int num469 = 8;
				if (localAI[1] > 0f)
				{
					num469 += (int)localAI[1];
				}
				if (localAI[0] >= (float)num469)
				{
					localAI[0] = 0f;
					localAI[1] = -1f;
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 344, (int)((float)damage * 0.7f), knockBack * 0.55f, owner, 0f, Main.rand.Next(3));
				}
			}
		}
		else if (aiStyle == 58)
		{
			alpha -= 50;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (this.ai[0] == 0f)
			{
				frame = 0;
				this.ai[1] += 1f;
				if (this.ai[1] > 30f)
				{
					velocity.Y += 0.1f;
				}
				if (velocity.Y >= 0f)
				{
					this.ai[0] = 1f;
				}
			}
			if (this.ai[0] == 1f)
			{
				frame = 1;
				velocity.Y += 0.1f;
				if (velocity.Y > 3f)
				{
					velocity.Y = 3f;
				}
				velocity.X *= 0.99f;
			}
			rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
		}
		else if (aiStyle == 59)
		{
			this.ai[1] += 1f;
			if (this.ai[1] >= 60f)
			{
				friendly = true;
				int num470 = (int)this.ai[0];
				if (Main.myPlayer == owner && (num470 == -1 || !Main.npc[num470].CanBeChasedBy(this)))
				{
					num470 = -1;
					int[] array = new int[Main.maxNPCs];
					int num471 = 0;
					for (int num472 = 0; num472 < Main.maxNPCs; num472++)
					{
						if (Main.npc[num472].CanBeChasedBy(this))
						{
							float num473 = Math.Abs(Main.npc[num472].position.X + (float)(Main.npc[num472].width / 2) - base.position.X + (float)(width / 2)) + Math.Abs(Main.npc[num472].position.Y + (float)(Main.npc[num472].height / 2) - base.position.Y + (float)(height / 2));
							if (num473 < 800f)
							{
								array[num471] = num472;
								num471++;
							}
						}
					}
					if (num471 == 0)
					{
						Kill();
						return;
					}
					num470 = array[Main.rand.Next(num471)];
					this.ai[0] = num470;
					netUpdate = true;
				}
				if (num470 != -1)
				{
					float num474 = 4f;
					Vector2 vector37 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
					float num475 = Main.npc[num470].Center.X - vector37.X;
					float num476 = Main.npc[num470].Center.Y - vector37.Y;
					float num477 = (float)Math.Sqrt(num475 * num475 + num476 * num476);
					float num478 = num477;
					num477 = num474 / num477;
					num475 *= num477;
					num476 *= num477;
					int num479 = 30;
					velocity.X = (velocity.X * (float)(num479 - 1) + num475) / (float)num479;
					velocity.Y = (velocity.Y * (float)(num479 - 1) + num476) / (float)num479;
				}
			}
			for (int num480 = 0; num480 < 5; num480++)
			{
				float num481 = velocity.X * 0.2f * (float)num480;
				float num482 = (0f - velocity.Y * 0.2f) * (float)num480;
				int num483 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 175, 0f, 0f, 100, default(Color), 1.3f);
				Main.dust[num483].noGravity = true;
				Dust dust2 = Main.dust[num483];
				dust2.velocity *= 0f;
				Main.dust[num483].position.X -= num481;
				Main.dust[num483].position.Y -= num482;
			}
		}
		else if (aiStyle == 60)
		{
			scale -= 0.015f;
			if (scale <= 0f)
			{
				velocity *= 5f;
				oldVelocity = velocity;
				Kill();
			}
			if (this.ai[0] > 3f)
			{
				int num484 = 103;
				int num485 = 1500;
				bool flag26 = false;
				bool flag27 = true;
				switch (type)
				{
				case 358:
					num484 = 103;
					break;
				case 406:
					num484 = 137;
					num485 = 180;
					break;
				case 1042:
					num484 = 353;
					num485 = 100;
					flag27 = false;
					break;
				}
				if (owner == Main.myPlayer)
				{
					Rectangle rectangle3 = new Rectangle((int)base.position.X, (int)base.position.Y, width, height);
					for (int num486 = 0; num486 < Main.maxNPCs; num486++)
					{
						NPC nPC5 = Main.npc[num486];
						if (!nPC5.active || nPC5.dontTakeDamage || nPC5.lifeMax <= 1)
						{
							continue;
						}
						Rectangle value3 = new Rectangle((int)nPC5.position.X, (int)nPC5.position.Y, nPC5.width, nPC5.height);
						if (rectangle3.Intersects(value3))
						{
							bool flag28 = true;
							if (flag26 && nPC5.type > 0 && nPC5.type < NPCID.Count && !NPCID.Sets.ShimmerTownTransform[nPC5.type])
							{
								flag28 = false;
							}
							if (flag28)
							{
								nPC5.AddBuff(num484, num485);
							}
							Kill();
						}
					}
					if (flag27 && !flag26)
					{
						for (int num487 = 0; num487 < 255; num487++)
						{
							if (num487 != owner && Main.player[num487].active && !Main.player[num487].dead)
							{
								Rectangle value4 = new Rectangle((int)Main.player[num487].position.X, (int)Main.player[num487].position.Y, Main.player[num487].width, Main.player[num487].height);
								if (rectangle3.Intersects(value4))
								{
									ApplyBuffTo(Main.player[num487], num484, num485);
									Kill();
								}
							}
						}
					}
					if (num484 == 103)
					{
						float y6 = base.Bottom.Y;
						int num488 = (int)base.Left.X / 16;
						int num489 = (int)base.Right.X / 16;
						int num490 = (int)(base.Top.Y / 16f);
						int num491 = (int)(y6 / 16f);
						for (int num492 = num488; num492 <= num489; num492++)
						{
							for (int num493 = num490; num493 <= num491; num493++)
							{
								if (!WorldGen.InWorld(num492, num493, 10))
								{
									continue;
								}
								byte liquid = Main.tile[num492, num493].liquid;
								if (liquid > 0)
								{
									int num494 = 256 - liquid;
									num494 /= 32;
									if (y6 > (float)(num493 * 16 + num494 * 2))
									{
										Kill();
									}
								}
								else if (Main.tile[num492, num493].active())
								{
									WorldGen.TryToggleLight(num492, num493, false, skipWires: false);
								}
							}
						}
					}
					if (num484 == 137)
					{
						float y7 = base.Bottom.Y;
						int num495 = (int)base.Left.X / 16;
						int num496 = (int)base.Right.X / 16;
						int num497 = (int)(base.Top.Y / 16f);
						int num498 = (int)(y7 / 16f);
						for (int num499 = num495; num499 <= num496; num499++)
						{
							for (int num500 = num497; num500 <= num498; num500++)
							{
								if (!WorldGen.InWorld(num499, num500, 10))
								{
									continue;
								}
								byte liquid2 = Main.tile[num499, num500].liquid;
								if (liquid2 > 0)
								{
									int num501 = 256 - liquid2;
									num501 /= 32;
									if (y7 > (float)(num500 * 16 + num501 * 2))
									{
										Kill();
									}
								}
								else if (Main.tile[num499, num500].active())
								{
									WorldGen.TryToggleLight(num499, num500, true, skipWires: false);
								}
							}
						}
					}
					if (num484 == 353)
					{
						float y8 = base.Bottom.Y;
						int num502 = (int)base.Left.X / 16;
						int num503 = (int)base.Right.X / 16;
						int num504 = (int)(base.Top.Y / 16f);
						int num505 = (int)(y8 / 16f);
						for (int num506 = num502; num506 <= num503; num506++)
						{
							for (int num507 = num504; num507 <= num505; num507++)
							{
								if (!WorldGen.InWorld(num506, num507, 10))
								{
									continue;
								}
								byte liquid3 = Main.tile[num506, num507].liquid;
								if (liquid3 > 0)
								{
									int num508 = 256 - liquid3;
									num508 /= 32;
									if (y8 > (float)(num507 * 16 + num508 * 2))
									{
										Kill();
									}
								}
								else if (Main.tile[num506, num507].active() && Main.tile[num506, num507].type == 4 && TorchID.Sets.IsABiomeTorch[Main.tile[num506, num507].frameY / 22])
								{
									int num509 = 4;
									int style2 = 0;
									Main.player[owner].BiomeTorchPlaceStyle(ref num509, ref style2, useWithoutTorchGodsFavor: true);
									if (style2 != Main.tile[num506, num507].frameY / 22)
									{
										Main.tile[num506, num507].frameY = (short)(style2 * 22);
										NetMessage.SendTileSquare(-1, num506, num507);
									}
								}
							}
						}
					}
				}
				this.ai[0] += this.ai[1];
				if (this.ai[0] > 30f)
				{
					velocity.Y += 0.1f;
				}
				if (type == 358)
				{
					for (int num510 = 0; num510 < 1; num510++)
					{
						for (int num511 = 0; num511 < 6; num511++)
						{
							float num512 = velocity.X / 6f * (float)num511;
							float num513 = velocity.Y / 6f * (float)num511;
							int num514 = 6;
							int num515 = Dust.NewDust(new Vector2(base.position.X + (float)num514, base.position.Y + (float)num514), width - num514 * 2, height - num514 * 2, 211, 0f, 0f, 75, default(Color), 1.2f);
							Dust dust2;
							if (Main.rand.Next(2) == 0)
							{
								dust2 = Main.dust[num515];
								dust2.alpha += 25;
							}
							if (Main.rand.Next(2) == 0)
							{
								dust2 = Main.dust[num515];
								dust2.alpha += 25;
							}
							if (Main.rand.Next(2) == 0)
							{
								dust2 = Main.dust[num515];
								dust2.alpha += 25;
							}
							Main.dust[num515].noGravity = true;
							dust2 = Main.dust[num515];
							dust2.velocity *= 0.3f;
							dust2 = Main.dust[num515];
							dust2.velocity += velocity * 0.5f;
							Main.dust[num515].position = base.Center;
							Main.dust[num515].position.X -= num512;
							Main.dust[num515].position.Y -= num513;
							dust2 = Main.dust[num515];
							dust2.velocity *= 0.2f;
						}
						if (Main.rand.Next(4) == 0)
						{
							int num516 = 6;
							int num517 = Dust.NewDust(new Vector2(base.position.X + (float)num516, base.position.Y + (float)num516), width - num516 * 2, height - num516 * 2, 211, 0f, 0f, 75, default(Color), 0.65f);
							Dust dust2 = Main.dust[num517];
							dust2.velocity *= 0.5f;
							dust2 = Main.dust[num517];
							dust2.velocity += velocity * 0.5f;
						}
					}
				}
				if (type == 406)
				{
					int num518 = 175;
					Color newColor2 = new Color(0, 80, 255, 100);
					for (int num519 = 0; num519 < 6; num519++)
					{
						Vector2 vector38 = velocity * num519 / 6f;
						int num520 = 6;
						int num521 = Dust.NewDust(base.position + Vector2.One * 6f, width - num520 * 2, height - num520 * 2, 4, 0f, 0f, num518, newColor2, 1.2f);
						Dust dust2;
						if (Main.rand.Next(2) == 0)
						{
							dust2 = Main.dust[num521];
							dust2.alpha += 25;
						}
						if (Main.rand.Next(2) == 0)
						{
							dust2 = Main.dust[num521];
							dust2.alpha += 25;
						}
						if (Main.rand.Next(2) == 0)
						{
							dust2 = Main.dust[num521];
							dust2.alpha += 25;
						}
						Main.dust[num521].noGravity = true;
						dust2 = Main.dust[num521];
						dust2.velocity *= 0.3f;
						dust2 = Main.dust[num521];
						dust2.velocity += velocity * 0.5f;
						Main.dust[num521].position = base.Center;
						Main.dust[num521].position.X -= vector38.X;
						Main.dust[num521].position.Y -= vector38.Y;
						dust2 = Main.dust[num521];
						dust2.velocity *= 0.2f;
					}
					if (Main.rand.Next(4) == 0)
					{
						int num522 = 6;
						int num523 = Dust.NewDust(base.position + Vector2.One * 6f, width - num522 * 2, height - num522 * 2, 4, 0f, 0f, num518, newColor2, 1.2f);
						Dust dust2 = Main.dust[num523];
						dust2.velocity *= 0.5f;
						dust2 = Main.dust[num523];
						dust2.velocity += velocity * 0.5f;
					}
				}
				if (type != 1042)
				{
					return;
				}
				for (int num524 = 0; num524 < 1; num524++)
				{
					for (int num525 = 0; num525 < 6; num525++)
					{
						float num526 = velocity.X / 6f * (float)num525;
						float num527 = velocity.Y / 6f * (float)num525;
						int num528 = 6;
						int num529 = Dust.NewDust(new Vector2(base.position.X + (float)num528, base.position.Y + (float)num528), width - num528 * 2, height - num528 * 2, 324, 0f, 0f, 75);
						Dust dust2;
						if (Main.rand.Next(2) == 0)
						{
							dust2 = Main.dust[num529];
							dust2.alpha += 25;
						}
						if (Main.rand.Next(2) == 0)
						{
							dust2 = Main.dust[num529];
							dust2.alpha += 25;
						}
						if (Main.rand.Next(2) == 0)
						{
							dust2 = Main.dust[num529];
							dust2.alpha += 25;
						}
						Main.dust[num529].noGravity = true;
						dust2 = Main.dust[num529];
						dust2.velocity *= 0.3f;
						dust2 = Main.dust[num529];
						dust2.velocity += velocity * 0.5f;
						Main.dust[num529].position = base.Center;
						Main.dust[num529].position.X -= num526;
						Main.dust[num529].position.Y -= num527;
						dust2 = Main.dust[num529];
						dust2.velocity *= 0.2f;
						switch (Main.rand.Next(6))
						{
						case 0:
							Main.dust[num529].color = new Color(255, 255, 220);
							break;
						case 1:
							Main.dust[num529].color = new Color(230, 255, 255);
							break;
						case 2:
							Main.dust[num529].color = new Color(255, 210, 255);
							break;
						default:
							Main.dust[num529].color = new Color(225, 210, 255);
							break;
						}
					}
					if (Main.rand.Next(4) == 0)
					{
						int num530 = 6;
						int num531 = Dust.NewDust(new Vector2(base.position.X + (float)num530, base.position.Y + (float)num530), width - num530 * 2, height - num530 * 2, 324, 0f, 0f, 75, default(Color), 0.6f);
						Dust dust2 = Main.dust[num531];
						dust2.velocity *= 0.5f;
						dust2 = Main.dust[num531];
						dust2.velocity += velocity * 0.5f;
						switch (Main.rand.Next(6))
						{
						case 0:
							Main.dust[num531].color = new Color(255, 255, 220);
							break;
						case 1:
							Main.dust[num531].color = new Color(230, 255, 255);
							break;
						case 2:
							Main.dust[num531].color = new Color(255, 210, 255);
							break;
						default:
							Main.dust[num531].color = new Color(225, 210, 255);
							break;
						}
					}
				}
			}
			else
			{
				this.ai[0] += 1f;
			}
		}
		else if (aiStyle == 61)
		{
			AI_061_FishingBobber();
		}
		else if (aiStyle == 62)
		{
			AI_062();
		}
		else if (aiStyle == 63)
		{
			if (!Main.player[owner].active)
			{
				active = false;
				return;
			}
			Vector2 center3 = base.position;
			bool flag29 = false;
			float num532 = 2000f;
			for (int num533 = 0; num533 < Main.maxNPCs; num533++)
			{
				NPC nPC6 = Main.npc[num533];
				if (nPC6.CanBeChasedBy(this))
				{
					float num534 = Vector2.Distance(nPC6.Center, base.Center);
					if (!(num534 >= num532) && Collision.CanHit(base.position, width, height, nPC6.position, nPC6.width, nPC6.height))
					{
						num532 = num534;
						center3 = nPC6.Center;
						flag29 = true;
					}
				}
			}
			if (!flag29)
			{
				velocity.X *= 0.95f;
				shouldFallThrough = false;
			}
			else
			{
				shouldFallThrough = center3.Y > base.Bottom.Y;
				float num535 = 5f;
				float num536 = 0.08f;
				if (velocity.Y == 0f)
				{
					bool flag30 = false;
					if (base.Center.Y - 50f > center3.Y)
					{
						flag30 = true;
					}
					if (flag30)
					{
						velocity.Y = -6f;
					}
				}
				else
				{
					num535 = 8f;
					num536 = 0.12f;
				}
				velocity.X += (float)Math.Sign(center3.X - base.Center.X) * num536;
				if (velocity.X < 0f - num535)
				{
					velocity.X = 0f - num535;
				}
				if (velocity.X > num535)
				{
					velocity.X = num535;
				}
			}
			float num537 = 0f;
			Collision.StepUp(ref base.position, ref velocity, width, height, ref num537, ref gfxOffY);
			if (velocity.Y != 0f)
			{
				frame = 3;
			}
			else
			{
				if (Math.Abs(velocity.X) > 0.2f)
				{
					frameCounter++;
				}
				if (frameCounter >= 9)
				{
					frameCounter = 0;
				}
				if (frameCounter >= 6)
				{
					frame = 2;
				}
				else if (frameCounter >= 3)
				{
					frame = 1;
				}
				else
				{
					frame = 0;
				}
			}
			if (velocity.X != 0f)
			{
				direction = Math.Sign(velocity.X);
			}
			spriteDirection = -direction;
			velocity.Y += 0.2f;
			if (velocity.Y > 16f)
			{
				velocity.Y = 16f;
			}
		}
		else if (aiStyle == 64)
		{
			int num538 = 10;
			int num539 = 15;
			float num540 = 1f;
			int num541 = 150;
			int num542 = 42;
			if (type == 386)
			{
				num538 = 16;
				num539 = 16;
				num540 = 1.5f;
			}
			if (velocity.X != 0f)
			{
				direction = (spriteDirection = -Math.Sign(velocity.X));
			}
			frameCounter++;
			if (frameCounter > 2)
			{
				frame++;
				frameCounter = 0;
			}
			if (frame >= 6)
			{
				frame = 0;
			}
			if (localAI[0] == 0f && Main.myPlayer == owner)
			{
				localAI[0] = 1f;
				base.position.X += width / 2;
				base.position.Y += height / 2;
				scale = ((float)(num538 + num539) - this.ai[1]) * num540 / (float)(num539 + num538);
				width = (int)((float)num541 * scale);
				height = (int)((float)num542 * scale);
				base.position.X -= width / 2;
				base.position.Y -= height / 2;
				netUpdate = true;
			}
			if (this.ai[1] != -1f)
			{
				scale = ((float)(num538 + num539) - this.ai[1]) * num540 / (float)(num539 + num538);
				width = (int)((float)num541 * scale);
				height = (int)((float)num542 * scale);
			}
			if (!Collision.SolidCollision(base.position, width, height))
			{
				alpha -= 30;
				if (alpha < 60)
				{
					alpha = 60;
				}
				if (type == 386 && alpha < 100)
				{
					alpha = 100;
				}
			}
			else
			{
				alpha += 30;
				if (alpha > 150)
				{
					alpha = 150;
				}
			}
			if (this.ai[0] > 0f)
			{
				this.ai[0]--;
			}
			if (this.ai[0] == 1f && this.ai[1] > 0f && owner == Main.myPlayer)
			{
				netUpdate = true;
				Vector2 center4 = base.Center;
				center4.Y -= (float)num542 * scale / 2f;
				float num543 = ((float)(num538 + num539) - this.ai[1] + 1f) * num540 / (float)(num539 + num538);
				center4.Y -= (float)num542 * num543 / 2f;
				center4.Y += 2f;
				NewProjectile(GetProjectileSource_FromThis(), center4.X, center4.Y, velocity.X, velocity.Y, type, damage, knockBack, owner, 10f, this.ai[1] - 1f);
				int num544 = 4;
				if (type == 386)
				{
					num544 = 2;
				}
				if ((int)this.ai[1] % num544 == 0 && this.ai[1] != 0f)
				{
					int num545 = 372;
					if (type == 386)
					{
						num545 = 373;
					}
					int num546 = NPC.NewNPC(GetNPCSource_FromThis(), (int)center4.X, (int)center4.Y, num545);
					Main.npc[num546].velocity = velocity;
					Main.npc[num546].netUpdate = true;
					if (type == 386)
					{
						Main.npc[num546].ai[2] = width;
						Main.npc[num546].ai[3] = -1.5f;
					}
				}
			}
			if (this.ai[0] <= 0f)
			{
				float num547 = (float)Math.PI / 30f;
				float num548 = (float)width / 5f;
				if (type == 386)
				{
					num548 *= 2f;
				}
				float num549 = (float)(Math.Cos(num547 * (0f - this.ai[0])) - 0.5) * num548;
				base.position.X -= num549 * (float)(-direction);
				this.ai[0]--;
				num549 = (float)(Math.Cos(num547 * (0f - this.ai[0])) - 0.5) * num548;
				base.position.X += num549 * (float)(-direction);
			}
		}
		else if (aiStyle == 65)
		{
			if (this.ai[1] > 0f)
			{
				int num550 = (int)this.ai[1] - 1;
				if (num550 < 255)
				{
					localAI[0]++;
					if (localAI[0] > 10f)
					{
						int num551 = 6;
						for (int num552 = 0; num552 < num551; num552++)
						{
							Vector2 spinningpoint = Vector2.Normalize(velocity) * new Vector2((float)width / 2f, height) * 0.75f;
							spinningpoint = spinningpoint.RotatedBy((double)(num552 - (num551 / 2 - 1)) * Math.PI / (double)num551) + base.Center;
							Vector2 vector39 = ((float)(Main.rand.NextDouble() * 3.1415927410125732) - (float)Math.PI / 2f).ToRotationVector2() * Main.rand.Next(3, 8);
							int num553 = Dust.NewDust(spinningpoint + vector39, 0, 0, 172, vector39.X * 2f, vector39.Y * 2f, 100, default(Color), 1.4f);
							Main.dust[num553].noGravity = true;
							Main.dust[num553].noLight = true;
							Dust dust2 = Main.dust[num553];
							dust2.velocity /= 4f;
							dust2 = Main.dust[num553];
							dust2.velocity -= velocity;
						}
						alpha -= 5;
						if (alpha < 100)
						{
							alpha = 100;
						}
						rotation += velocity.X * 0.1f;
						frame = (int)(localAI[0] / 3f) % 3;
					}
					Vector2 value5 = Main.player[num550].Center - base.Center;
					float num554 = 4f;
					if (this.ai[2] == 1f)
					{
						num554 += 12f;
					}
					num554 += localAI[0] / 20f;
					velocity = Vector2.Normalize(value5) * num554;
					if (value5.Length() < 50f)
					{
						Kill();
					}
				}
			}
			else
			{
				float num555 = (float)Math.PI / 15f;
				float num556 = 4f;
				float num557 = (float)(Math.Cos(num555 * this.ai[0]) - 0.5) * num556;
				velocity.Y -= num557;
				this.ai[0]++;
				num557 = (float)(Math.Cos(num555 * this.ai[0]) - 0.5) * num556;
				velocity.Y += num557;
				localAI[0]++;
				if (localAI[0] > 10f)
				{
					alpha -= 5;
					if (alpha < 100)
					{
						alpha = 100;
					}
					rotation += velocity.X * 0.1f;
					frame = (int)(localAI[0] / 3f) % 3;
				}
			}
			if (wet)
			{
				base.position.Y -= 16f;
				Kill();
			}
		}
		else if (aiStyle == 66)
		{
			float num558 = 0f;
			float num559 = 0f;
			float num560 = 0f;
			float num561 = 0f;
			bool flag31 = type == 387 || type == 388;
			if (flag31)
			{
				num558 = 2000f;
				num559 = 800f;
				num560 = 1200f;
				num561 = 150f;
				if (Main.player[owner].dead)
				{
					Main.player[owner].twinsMinion = false;
				}
				if (Main.player[owner].twinsMinion)
				{
					timeLeft = 2;
				}
			}
			if (type == 533)
			{
				num558 = 2000f;
				num559 = 900f;
				num560 = 1500f;
				num561 = 450f;
				if (Main.player[owner].dead)
				{
					Main.player[owner].DeadlySphereMinion = false;
				}
				if (Main.player[owner].DeadlySphereMinion)
				{
					timeLeft = 2;
				}
				localAI[2] = Utils.Clamp(localAI[2] - 1f, 0f, 60f);
			}
			float num562 = 0.05f;
			for (int num563 = 0; num563 < 1000; num563++)
			{
				bool flag32 = (Main.projectile[num563].type == 387 || Main.projectile[num563].type == 388) && (type == 387 || type == 388);
				if (!flag32)
				{
					flag32 = type == 533 && Main.projectile[num563].type == 533;
				}
				if (num563 != whoAmI && Main.projectile[num563].active && Main.projectile[num563].owner == owner && flag32 && Math.Abs(base.position.X - Main.projectile[num563].position.X) + Math.Abs(base.position.Y - Main.projectile[num563].position.Y) < (float)width)
				{
					if (base.position.X < Main.projectile[num563].position.X)
					{
						velocity.X -= num562;
					}
					else
					{
						velocity.X += num562;
					}
					if (base.position.Y < Main.projectile[num563].position.Y)
					{
						velocity.Y -= num562;
					}
					else
					{
						velocity.Y += num562;
					}
				}
			}
			if (type == 533)
			{
				if ((int)this.ai[0] % 3 != 2)
				{
					Lighting.AddLight(base.Center, 0.8f, 0.3f, 0.1f);
				}
				else
				{
					Lighting.AddLight(base.Center, 0.3f, 0.5f, 0.7f);
				}
			}
			bool flag33 = false;
			if (this.ai[0] == 2f && type == 388)
			{
				this.ai[1]++;
				extraUpdates = 1;
				rotation = velocity.ToRotation() + (float)Math.PI;
				frameCounter++;
				if (frameCounter > 1)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame > 2)
				{
					frame = 0;
				}
				if (this.ai[1] > 40f)
				{
					this.ai[1] = 1f;
					this.ai[0] = 0f;
					extraUpdates = 0;
					numUpdates = 0;
					netUpdate = true;
				}
				else
				{
					flag33 = true;
				}
			}
			if (type == 533 && this.ai[0] >= 3f && this.ai[0] <= 5f)
			{
				int num564 = 2;
				flag33 = true;
				velocity *= 0.9f;
				this.ai[1]++;
				int num565 = (int)this.ai[1] / num564 + (int)(this.ai[0] - 3f) * 8;
				if (num565 < 4)
				{
					frame = 17 + num565;
				}
				else if (num565 < 5)
				{
					frame = 0;
				}
				else if (num565 < 8)
				{
					frame = 1 + num565 - 5;
				}
				else if (num565 < 11)
				{
					frame = 11 - num565;
				}
				else if (num565 < 12)
				{
					frame = 0;
				}
				else if (num565 < 16)
				{
					frame = num565 - 2;
				}
				else if (num565 < 20)
				{
					frame = 29 - num565;
				}
				else if (num565 < 21)
				{
					frame = 0;
				}
				else
				{
					frame = num565 - 4;
				}
				if (this.ai[1] > (float)(num564 * 8))
				{
					this.ai[0] -= 3f;
					this.ai[1] = 0f;
				}
			}
			if (type == 533 && this.ai[0] >= 6f && this.ai[0] <= 8f)
			{
				this.ai[1]++;
				MaxUpdates = 2;
				if (this.ai[0] == 7f)
				{
					rotation = velocity.ToRotation() + (float)Math.PI;
				}
				else
				{
					rotation += (float)Math.PI / 6f;
				}
				int num566 = 0;
				switch ((int)this.ai[0])
				{
				case 6:
					frame = 5;
					num566 = 40;
					break;
				case 7:
					frame = 13;
					num566 = 30;
					break;
				case 8:
					frame = 17;
					num566 = 30;
					break;
				}
				if (this.ai[1] > (float)num566)
				{
					this.ai[1] = 1f;
					this.ai[0] -= 6f;
					localAI[0]++;
					extraUpdates = 0;
					numUpdates = 0;
					netUpdate = true;
				}
				else
				{
					flag33 = true;
				}
				if (this.ai[0] == 8f)
				{
					for (int num567 = 0; num567 < 4; num567++)
					{
						int num568 = Utils.SelectRandom<int>(Main.rand, 226, 228, 75);
						int num569 = Dust.NewDust(base.Center, 0, 0, num568);
						Dust dust16 = Main.dust[num569];
						Vector2 vector40 = Vector2.One.RotatedBy((float)num567 * ((float)Math.PI / 2f)).RotatedBy(rotation);
						dust16.position = base.Center + vector40 * 10f;
						dust16.velocity = vector40 * 1f;
						dust16.scale = 0.6f + Main.rand.NextFloat() * 0.5f;
						dust16.noGravity = true;
					}
				}
			}
			if (flag33)
			{
				return;
			}
			Vector2 center5 = base.position;
			Vector2 zero2 = Vector2.Zero;
			bool flag34 = false;
			if (this.ai[0] != 1f && flag31)
			{
				tileCollide = true;
			}
			if (type == 533 && this.ai[0] < 9f)
			{
				tileCollide = true;
			}
			if (tileCollide && WorldGen.SolidTile(Framing.GetTileSafely((int)base.Center.X / 16, (int)base.Center.Y / 16)))
			{
				tileCollide = false;
			}
			NPC ownerMinionAttackTargetNPC2 = OwnerMinionAttackTargetNPC;
			if (ownerMinionAttackTargetNPC2 != null && ownerMinionAttackTargetNPC2.CanBeChasedBy(this))
			{
				float num570 = Vector2.Distance(ownerMinionAttackTargetNPC2.Center, base.Center);
				float num571 = num558 * 3f;
				if (num570 < num571 && !flag34 && Collision.CanHitLine(base.position, width, height, ownerMinionAttackTargetNPC2.position, ownerMinionAttackTargetNPC2.width, ownerMinionAttackTargetNPC2.height))
				{
					num558 = num570;
					center5 = ownerMinionAttackTargetNPC2.Center;
					flag34 = true;
				}
			}
			if (!flag34)
			{
				for (int num572 = 0; num572 < Main.maxNPCs; num572++)
				{
					NPC nPC7 = Main.npc[num572];
					if (nPC7.CanBeChasedBy(this))
					{
						float num573 = Vector2.Distance(nPC7.Center, base.Center);
						if (!(num573 >= num558) && Collision.CanHitLine(base.position, width, height, nPC7.position, nPC7.width, nPC7.height))
						{
							num558 = num573;
							center5 = nPC7.Center;
							zero2 = nPC7.velocity;
							flag34 = true;
						}
					}
				}
			}
			float num574 = num559;
			if (flag34)
			{
				num574 = num560;
			}
			Player player6 = Main.player[owner];
			if (Vector2.Distance(player6.Center, base.Center) > num574)
			{
				if (flag31)
				{
					this.ai[0] = 1f;
				}
				if (type == 533 && this.ai[0] < 9f)
				{
					this.ai[0] += 3 * (3 - (int)(this.ai[0] / 3f));
				}
				tileCollide = false;
				netUpdate = true;
			}
			if (flag31 && flag34 && this.ai[0] == 0f)
			{
				Vector2 vector41 = center5 - base.Center;
				float num575 = vector41.Length();
				vector41.Normalize();
				if (num575 > 200f)
				{
					float num576 = 6f;
					if (type == 388)
					{
						num576 = 14f;
					}
					vector41 *= num576;
					velocity = (velocity * 40f + vector41) / 41f;
				}
				else
				{
					float num577 = 4f;
					vector41 *= 0f - num577;
					velocity = (velocity * 40f + vector41) / 41f;
				}
			}
			else
			{
				bool flag35 = false;
				if (!flag35 && flag31)
				{
					flag35 = this.ai[0] == 1f;
				}
				if (!flag35 && type == 533)
				{
					flag35 = this.ai[0] >= 9f;
				}
				float num578 = 6f;
				float num579 = 40f;
				if (type == 533)
				{
					num578 = 12f;
				}
				if (flag35)
				{
					num578 = 15f;
				}
				Vector2 center6 = base.Center;
				Vector2 vector42 = player6.Center - center6 + new Vector2(0f, -60f);
				float num580 = vector42.Length();
				float num581 = num580;
				if (num580 > 200f && num578 < 8f)
				{
					num578 = 8f;
				}
				if (num578 < Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y))
				{
					num579 = 30f;
					num578 = Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y);
					if (num580 > 200f)
					{
						num579 = 20f;
						num578 += 4f;
					}
					else if (num580 > 100f)
					{
						num578 += 3f;
					}
				}
				if (flag35 && num580 > 300f)
				{
					num578 += 6f;
					num579 -= 10f;
				}
				if (num580 < num561 && flag35 && !Collision.SolidCollision(base.position, width, height))
				{
					if (type == 387 || type == 388)
					{
						this.ai[0] = 0f;
					}
					if (type == 533)
					{
						this.ai[0] -= 9f;
					}
					netUpdate = true;
				}
				if (num580 > 2000f)
				{
					base.position.X = Main.player[owner].Center.X - (float)(width / 2);
					base.position.Y = Main.player[owner].Center.Y - (float)(height / 2);
					netUpdate = true;
				}
				if (num580 > 70f)
				{
					Vector2 vector43 = vector42;
					vector42.Normalize();
					vector42 *= num578;
					velocity = (velocity * num579 + vector42) / (num579 + 1f);
				}
				else if (velocity.X == 0f && velocity.Y == 0f)
				{
					velocity.X = -0.15f;
					velocity.Y = -0.05f;
				}
				if (velocity.Length() > num578)
				{
					velocity *= 0.95f;
				}
			}
			if (type == 388)
			{
				rotation = velocity.ToRotation() + (float)Math.PI;
			}
			if (type == 387)
			{
				if (this.ai[0] != 1f && flag34)
				{
					rotation = (center5 - base.Center).ToRotation() + (float)Math.PI;
				}
				else
				{
					rotation = velocity.ToRotation() + (float)Math.PI;
				}
			}
			if (type == 533 && (this.ai[0] < 3f || this.ai[0] >= 9f))
			{
				rotation += velocity.X * 0.04f;
			}
			if (type == 388 || type == 387)
			{
				frameCounter++;
				if (frameCounter > 3)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame > 2)
				{
					frame = 0;
				}
			}
			else if (type == 533)
			{
				if (this.ai[0] < 3f || this.ai[0] >= 9f)
				{
					frameCounter++;
					if (frameCounter >= 24)
					{
						frameCounter = 0;
					}
					int num582 = frameCounter / 4;
					frame = 4 + num582;
					switch ((int)this.ai[0])
					{
					case 0:
					case 9:
						frame = 4 + num582;
						break;
					case 1:
					case 10:
						num582 = frameCounter / 8;
						frame = 14 + num582;
						break;
					case 2:
					case 11:
						num582 = frameCounter / 3;
						if (num582 >= 4)
						{
							num582 -= 4;
						}
						frame = 17 + num582;
						break;
					}
				}
				if (this.ai[0] == 2f && Main.rand.Next(2) == 0)
				{
					for (int num583 = 0; num583 < 4; num583++)
					{
						if (Main.rand.Next(2) != 0)
						{
							int num584 = Utils.SelectRandom<int>(Main.rand, 226, 228, 75);
							int num585 = Dust.NewDust(base.Center, 0, 0, num584);
							Dust dust17 = Main.dust[num585];
							Vector2 vector44 = Vector2.One.RotatedBy((float)num583 * ((float)Math.PI / 2f)).RotatedBy(rotation);
							dust17.position = base.Center + vector44 * 10f;
							dust17.velocity = vector44 * 1f;
							dust17.scale = 0.3f + Main.rand.NextFloat() * 0.5f;
							dust17.noGravity = true;
							dust17.customData = this;
							dust17.noLight = true;
						}
					}
				}
			}
			if (this.ai[1] > 0f && flag31)
			{
				this.ai[1] += Main.rand.Next(1, 4);
			}
			if (this.ai[1] > 90f && type == 387)
			{
				this.ai[1] = 0f;
				netUpdate = true;
			}
			if (this.ai[1] > 40f && type == 388)
			{
				this.ai[1] = 0f;
				netUpdate = true;
			}
			if (this.ai[1] > 0f && type == 533)
			{
				this.ai[1]++;
				int num586 = 10;
				if (this.ai[1] > (float)num586)
				{
					this.ai[1] = 0f;
					netUpdate = true;
				}
			}
			if (this.ai[0] == 0f && flag31)
			{
				if (type == 387)
				{
					float num587 = 8f;
					int num588 = 389;
					if (flag34 && this.ai[1] == 0f)
					{
						this.ai[1]++;
						if (Main.myPlayer == owner && Collision.CanHitLine(base.position, width, height, center5, 0, 0))
						{
							Vector2 vector45 = center5 - base.Center;
							vector45.Normalize();
							vector45 *= num587;
							int num589 = NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector45.X, vector45.Y, num588, (int)((float)damage * 1.15f), 0f, Main.myPlayer);
							Main.projectile[num589].timeLeft = 300;
							netUpdate = true;
						}
					}
				}
				if (type == 388 && this.ai[1] == 0f && flag34 && num558 < 500f)
				{
					this.ai[1]++;
					if (Main.myPlayer == owner)
					{
						this.ai[0] = 2f;
						Vector2 v2 = center5 - base.Center;
						v2 = v2.SafeNormalize(velocity);
						float num590 = 8f;
						velocity = v2 * num590;
						AI_066_TryInterceptingTarget(center5, zero2, num590);
						netUpdate = true;
					}
				}
			}
			else
			{
				if (type != 533 || !(this.ai[0] < 9f))
				{
					return;
				}
				int num591 = 0;
				num591 = 800;
				if (!(this.ai[1] == 0f && flag34) || !(num558 < (float)num591))
				{
					return;
				}
				this.ai[1]++;
				if (Main.myPlayer != owner)
				{
					return;
				}
				if (localAI[0] >= 3f)
				{
					this.ai[0] += 4f;
					if (this.ai[0] == 6f)
					{
						this.ai[0] = 3f;
					}
					localAI[0] = 0f;
				}
				else
				{
					this.ai[0] += 6f;
					Vector2 v3 = center5 - base.Center;
					v3 = v3.SafeNormalize(Vector2.Zero);
					float num592 = ((this.ai[0] == 8f) ? 12f : 10f);
					velocity = v3 * num592;
					AI_066_TryInterceptingTarget(center5, zero2, num592);
					netUpdate = true;
				}
			}
		}
		else if (aiStyle == 67)
		{
			AI_067_FreakingPirates();
		}
		else if (aiStyle == 68)
		{
			rotation += 0.25f * (float)direction;
			bool flag36 = type == 399;
			bool flag37 = type == 669;
			this.ai[0] += 1f;
			if (this.ai[0] >= 3f)
			{
				alpha -= 40;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			if (this.ai[0] >= 15f)
			{
				velocity.Y += 0.2f;
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
				velocity.X *= 0.99f;
			}
			if (alpha == 0)
			{
				if (flag36)
				{
					Vector2 spinningpoint2 = new Vector2(4f, -8f);
					float num593 = rotation;
					if (direction == -1)
					{
						spinningpoint2.X = -4f;
					}
					spinningpoint2 = spinningpoint2.RotatedBy(num593);
					for (int num594 = 0; num594 < 1; num594++)
					{
						int num595 = Dust.NewDust(base.Center + spinningpoint2 - Vector2.One * 5f, 4, 4, 6);
						Main.dust[num595].scale = 1.5f;
						Main.dust[num595].noGravity = true;
						Main.dust[num595].velocity = Main.dust[num595].velocity * 0.25f + Vector2.Normalize(spinningpoint2) * 1f;
						Main.dust[num595].velocity = Main.dust[num595].velocity.RotatedBy(-(float)Math.PI / 2f * (float)direction);
					}
				}
				if (flag37)
				{
					for (int num596 = 0; num596 < 2; num596++)
					{
						Vector2 spinningpoint3 = new Vector2(MathHelper.Lerp(-8f, 8f, Main.rand.NextFloat()), -4f);
						float num597 = rotation;
						spinningpoint3 = spinningpoint3.RotatedBy(num597);
						int num598 = Dust.NewDust(base.Center + spinningpoint3 - Vector2.One * 5f, 4, 4, 4);
						Main.dust[num598].scale = 0.8f - Main.rand.NextFloat() * 0.2f;
						Main.dust[num598].velocity = Main.dust[num598].velocity * 0.25f + Vector2.Normalize(spinningpoint3) * 1f;
						Main.dust[num598].velocity = Main.dust[num598].velocity.RotatedBy(-(float)Math.PI / 2f * (float)direction);
						Main.dust[num598].color = Utils.SelectRandom<Color>(Main.rand, new Color(255, 255, 255, 110), new Color(245, 200, 30, 110));
					}
				}
			}
			spriteDirection = direction;
			if (timeLeft <= 3)
			{
				tileCollide = false;
				alpha = 255;
				base.position.X += width / 2;
				base.position.Y += height / 2;
				width = 80;
				height = 80;
				base.position.X -= width / 2;
				base.position.Y -= height / 2;
				knockBack = 8f;
			}
			if (wet && timeLeft > 3)
			{
				timeLeft = 3;
			}
		}
		else if (aiStyle == 69)
		{
			Vector2 vector46 = Main.player[owner].Center - base.Center;
			rotation = vector46.ToRotation() - 1.57f;
			if (Main.player[owner].dead)
			{
				Kill();
				return;
			}
			Main.player[owner].SetDummyItemTime(10);
			_ = vector46.X;
			_ = 0f;
			if (vector46.X < 0f)
			{
				Main.player[owner].ChangeDir(1);
				direction = 1;
			}
			else
			{
				Main.player[owner].ChangeDir(-1);
				direction = -1;
			}
			Main.player[owner].itemRotation = (vector46 * -1f * direction).ToRotation();
			spriteDirection = ((!(vector46.X > 0f)) ? 1 : (-1));
			if (this.ai[0] == 0f && vector46.Length() > 400f)
			{
				this.ai[0] = 1f;
			}
			if (this.ai[0] == 1f || this.ai[0] == 2f)
			{
				float num599 = vector46.Length();
				if (num599 > 1500f)
				{
					Kill();
					return;
				}
				if (num599 > 600f)
				{
					this.ai[0] = 2f;
				}
				tileCollide = false;
				float num600 = 20f;
				if (this.ai[0] == 2f)
				{
					num600 = 40f;
				}
				velocity = Vector2.Normalize(vector46) * num600;
				if (vector46.Length() < num600)
				{
					Kill();
					return;
				}
			}
			this.ai[1]++;
			if (this.ai[1] > 5f)
			{
				alpha = 0;
			}
			if ((int)this.ai[1] % 4 == 0 && owner == Main.myPlayer)
			{
				Vector2 v4 = vector46 * -1f;
				v4 = v4.SafeNormalize(Vector2.Zero);
				v4 *= (float)Main.rand.Next(45, 65) * 0.1f;
				v4 = v4.RotatedBy((Main.rand.NextDouble() - 0.5) * 1.5707963705062866);
				NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, v4.X, v4.Y, 405, damage, knockBack, owner, -10f);
			}
		}
		else if (aiStyle == 70)
		{
			if (this.ai[0] == 0f)
			{
				float num601 = 650f;
				int num602 = -1;
				for (int num603 = 0; num603 < Main.maxNPCs; num603++)
				{
					NPC nPC8 = Main.npc[num603];
					float num604 = (nPC8.Center - base.Center).Length();
					if (!(num604 >= num601) && nPC8.CanBeChasedBy(this) && Collision.CanHit(base.position, width, height, nPC8.position, nPC8.width, nPC8.height))
					{
						num602 = num603;
						num601 = num604;
					}
				}
				this.ai[0] = num602 + 1;
				if (this.ai[0] == 0f)
				{
					this.ai[0] = -15f;
				}
				if (this.ai[0] > 0f)
				{
					float num605 = (float)Main.rand.Next(35, 75) / 30f;
					Vector2 vector47 = (Main.npc[(int)this.ai[0] - 1].Center - base.Center + new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101))).SafeNormalize(Vector2.Zero);
					velocity = (velocity * 20f + vector47 * num605) / 21f;
					netUpdate = true;
				}
			}
			else if (this.ai[0] > 0f)
			{
				Vector2 vector48 = (Main.npc[(int)this.ai[0] - 1].Center - base.Center).SafeNormalize(Vector2.Zero);
				velocity = (velocity * 40f + vector48 * 12f) / 41f;
			}
			else
			{
				this.ai[0]++;
				alpha -= 25;
				if (alpha < 50)
				{
					alpha = 50;
				}
				velocity *= 0.95f;
			}
			if (this.ai[1] == 0f)
			{
				this.ai[1] = (float)Main.rand.Next(80, 121) / 100f;
				netUpdate = true;
			}
			scale = this.ai[1];
		}
		else if (aiStyle == 71)
		{
			localAI[1]++;
			if (localAI[1] > 10f && Main.rand.Next(3) == 0)
			{
				int num606 = 6;
				for (int num607 = 0; num607 < num606; num607++)
				{
					Vector2 spinningpoint4 = Vector2.Normalize(velocity) * new Vector2(width, height) / 2f;
					spinningpoint4 = spinningpoint4.RotatedBy((double)(num607 - (num606 / 2 - 1)) * Math.PI / (double)num606) + base.Center;
					Vector2 vector49 = ((float)(Main.rand.NextDouble() * 3.1415927410125732) - (float)Math.PI / 2f).ToRotationVector2() * Main.rand.Next(3, 8);
					int num608 = Dust.NewDust(spinningpoint4 + vector49, 0, 0, 217, vector49.X * 2f, vector49.Y * 2f, 100, default(Color), 1.4f);
					Main.dust[num608].noGravity = true;
					Main.dust[num608].noLight = true;
					Dust dust2 = Main.dust[num608];
					dust2.velocity /= 4f;
					dust2 = Main.dust[num608];
					dust2.velocity -= velocity;
				}
				alpha -= 5;
				if (alpha < 50)
				{
					alpha = 50;
				}
				rotation += velocity.X * 0.1f;
				frame = (int)(localAI[1] / 3f) % 3;
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.1f, 0.4f, 0.6f);
			}
			int num609 = -1;
			Vector2 vector50 = base.Center;
			float num610 = 500f;
			if (localAI[0] > 0f)
			{
				localAI[0]--;
			}
			if (this.ai[0] == 0f && localAI[0] == 0f)
			{
				for (int num611 = 0; num611 < Main.maxNPCs; num611++)
				{
					NPC nPC9 = Main.npc[num611];
					if (nPC9.CanBeChasedBy(this) && (this.ai[0] == 0f || this.ai[0] == (float)(num611 + 1)))
					{
						Vector2 center7 = nPC9.Center;
						float num612 = Vector2.Distance(center7, vector50);
						if (num612 < num610 && Collision.CanHit(base.position, width, height, nPC9.position, nPC9.width, nPC9.height))
						{
							num610 = num612;
							vector50 = center7;
							num609 = num611;
						}
					}
				}
				if (num609 >= 0)
				{
					this.ai[0] = num609 + 1;
					netUpdate = true;
				}
				num609 = -1;
			}
			if (localAI[0] == 0f && this.ai[0] == 0f)
			{
				localAI[0] = 30f;
			}
			bool flag38 = false;
			if (this.ai[0] != 0f)
			{
				int num613 = (int)(this.ai[0] - 1f);
				if (Main.npc[num613].active && !Main.npc[num613].dontTakeDamage && Main.npc[num613].immune[owner] == 0)
				{
					float num614 = Main.npc[num613].position.X + (float)(Main.npc[num613].width / 2);
					float num615 = Main.npc[num613].position.Y + (float)(Main.npc[num613].height / 2);
					float num616 = Math.Abs(base.position.X + (float)(width / 2) - num614) + Math.Abs(base.position.Y + (float)(height / 2) - num615);
					if (num616 < 1000f)
					{
						flag38 = true;
						vector50 = Main.npc[num613].Center;
					}
				}
				else
				{
					this.ai[0] = 0f;
					flag38 = false;
					netUpdate = true;
				}
			}
			if (flag38)
			{
				Vector2 v5 = vector50 - base.Center;
				float num617 = velocity.ToRotation();
				float num618 = v5.ToRotation();
				double num619 = num618 - num617;
				if (num619 > Math.PI)
				{
					num619 -= Math.PI * 2.0;
				}
				if (num619 < -Math.PI)
				{
					num619 += Math.PI * 2.0;
				}
				velocity = velocity.RotatedBy(num619 * 0.10000000149011612);
			}
			float num620 = velocity.Length();
			velocity.Normalize();
			velocity *= num620 + 0.0025f;
		}
		else if (aiStyle == 72)
		{
			localAI[0]++;
			if (localAI[0] > 3f)
			{
				alpha -= 25;
				if (alpha < 50)
				{
					alpha = 50;
				}
			}
			velocity *= 0.96f;
			if (this.ai[1] == 0f)
			{
				this.ai[1] = (float)Main.rand.Next(60, 121) / 100f;
				netUpdate = true;
			}
			scale = this.ai[1];
			base.position = base.Center;
			int num621 = 14;
			int num622 = 14;
			width = (int)((float)num621 * this.ai[1]);
			height = (int)((float)num622 * this.ai[1]);
			base.position -= new Vector2(width / 2, height / 2);
		}
		else if (aiStyle == 73)
		{
			int num623 = (int)this.ai[0];
			int num624 = (int)this.ai[1];
			Tile tile3 = Main.tile[num623, num624];
			if (tile3 == null || !tile3.active() || tile3.type != 338)
			{
				Kill();
				return;
			}
			float num625 = 2f;
			float num626 = (float)timeLeft / 60f;
			if (num626 < 1f)
			{
				num625 *= num626;
			}
			if (type == 419)
			{
				for (int num627 = 0; num627 < 2; num627++)
				{
					Vector2 spinningpoint5 = new Vector2(0f, 0f - num625);
					spinningpoint5 *= 0.85f + (float)Main.rand.NextDouble() * 0.2f;
					spinningpoint5 = spinningpoint5.RotatedBy((Main.rand.NextDouble() - 0.5) * 1.5707963705062866);
					int num628 = Dust.NewDust(base.position, width, height, 222, 0f, 0f, 100);
					Dust dust18 = Main.dust[num628];
					dust18.scale = 1f + (float)Main.rand.NextDouble() * 0.3f;
					Dust dust2 = dust18;
					dust2.velocity *= 0.5f;
					if (dust18.velocity.Y > 0f)
					{
						dust18.velocity.Y *= -1f;
					}
					dust2 = dust18;
					dust2.position -= new Vector2(2 + Main.rand.Next(-2, 3), 0f);
					dust2 = dust18;
					dust2.velocity += spinningpoint5;
					dust18.scale = 0.6f;
					dust18.fadeIn = dust18.scale + 0.2f;
					dust18.velocity.Y *= 2f;
				}
			}
			if (type == 420)
			{
				for (int num629 = 0; num629 < 2; num629++)
				{
					Vector2 spinningpoint6 = new Vector2(0f, 0f - num625);
					spinningpoint6 *= 0.85f + (float)Main.rand.NextDouble() * 0.2f;
					spinningpoint6 = spinningpoint6.RotatedBy((Main.rand.NextDouble() - 0.5) * 1.5707963705062866);
					int num630 = 219;
					if (Main.rand.Next(5) == 0)
					{
						num630 = 222;
					}
					int num631 = Dust.NewDust(base.position, width, height, num630, 0f, 0f, 100);
					Dust dust19 = Main.dust[num631];
					dust19.scale = 1f + (float)Main.rand.NextDouble() * 0.3f;
					Dust dust2 = dust19;
					dust2.velocity *= 0.5f;
					if (dust19.velocity.Y > 0f)
					{
						dust19.velocity.Y *= -1f;
					}
					dust2 = dust19;
					dust2.position -= new Vector2(2 + Main.rand.Next(-2, 3), 0f);
					dust2 = dust19;
					dust2.velocity += spinningpoint6;
					dust19.velocity.X *= 0.5f;
					dust19.scale = 0.6f;
					dust19.fadeIn = dust19.scale + 0.2f;
					dust19.velocity.Y *= 2f;
				}
			}
			if (type == 421)
			{
				for (int num632 = 0; num632 < 2; num632++)
				{
					Vector2 spinningpoint7 = new Vector2(0f, 0f - num625);
					spinningpoint7 *= 0.85f + (float)Main.rand.NextDouble() * 0.2f;
					spinningpoint7 = spinningpoint7.RotatedBy((Main.rand.NextDouble() - 0.5) * 0.7853981852531433);
					int num633 = Dust.NewDust(base.position, width, height, 221, 0f, 0f, 100);
					Dust dust20 = Main.dust[num633];
					dust20.scale = 1f + (float)Main.rand.NextDouble() * 0.3f;
					Dust dust2 = dust20;
					dust2.velocity *= 0.1f;
					if (dust20.velocity.Y > 0f)
					{
						dust20.velocity.Y *= -1f;
					}
					dust2 = dust20;
					dust2.position -= new Vector2(2 + Main.rand.Next(-2, 3), 0f);
					dust2 = dust20;
					dust2.velocity += spinningpoint7;
					dust20.scale = 0.6f;
					dust20.fadeIn = dust20.scale + 0.2f;
					dust20.velocity.Y *= 2.5f;
				}
				if (timeLeft % 10 == 0)
				{
					float num634 = 0.85f + (float)Main.rand.NextDouble() * 0.2f;
					for (int num635 = 0; num635 < 9; num635++)
					{
						Vector2 vector51 = new Vector2((float)(num635 - 4) / 5f, (0f - num625) * num634);
						int num636 = Dust.NewDust(base.position, width, height, 222, 0f, 0f, 100);
						Dust dust21 = Main.dust[num636];
						dust21.scale = 0.7f + (float)Main.rand.NextDouble() * 0.3f;
						Dust dust2 = dust21;
						dust2.velocity *= 0f;
						if (dust21.velocity.Y > 0f)
						{
							dust21.velocity.Y *= -1f;
						}
						dust2 = dust21;
						dust2.position -= new Vector2(2 + Main.rand.Next(-2, 3), 0f);
						dust2 = dust21;
						dust2.velocity += vector51;
						dust21.scale = 0.6f;
						dust21.fadeIn = dust21.scale + 0.2f;
						dust21.velocity.Y *= 2f;
					}
				}
			}
			if (type != 422)
			{
				return;
			}
			for (int num637 = 0; num637 < 2; num637++)
			{
				Vector2 spinningpoint8 = new Vector2(0f, 0f - num625);
				spinningpoint8 *= 0.85f + (float)Main.rand.NextDouble() * 0.2f;
				spinningpoint8 = spinningpoint8.RotatedBy((Main.rand.NextDouble() - 0.5) * 1.5707963705062866);
				int num638 = Dust.NewDust(base.position, width, height, 219 + Main.rand.Next(5), 0f, 0f, 100);
				Dust dust22 = Main.dust[num638];
				dust22.scale = 1f + (float)Main.rand.NextDouble() * 0.3f;
				Dust dust2 = dust22;
				dust2.velocity *= 0.5f;
				if (dust22.velocity.Y > 0f)
				{
					dust22.velocity.Y *= -1f;
				}
				dust2 = dust22;
				dust2.position -= new Vector2(2 + Main.rand.Next(-2, 3), 0f);
				dust2 = dust22;
				dust2.velocity += spinningpoint8;
				dust22.scale = 0.6f;
				dust22.fadeIn = dust22.scale + 0.2f;
				dust22.velocity.Y *= 2f;
			}
		}
		else if (aiStyle == 74)
		{
			if (extraUpdates == 1)
			{
				localAI[0] *= localAI[1];
				localAI[1] -= 0.001f;
				if ((double)localAI[0] < 0.01)
				{
					Kill();
				}
			}
		}
		else if (aiStyle == 75)
		{
			AI_075();
		}
		else if (aiStyle == 76)
		{
			Player player7 = Main.player[owner];
			player7.heldProj = whoAmI;
			if (type == 441)
			{
				if (player7.mount.Type != 9)
				{
					Kill();
					return;
				}
			}
			else if (type == 453 && player7.mount.Type != 8)
			{
				Kill();
				return;
			}
			if (Main.myPlayer == owner)
			{
				base.position.X = Main.screenPosition.X + (float)Main.mouseX;
				base.position.Y = Main.screenPosition.Y + (float)Main.mouseY;
				if (this.ai[0] != base.position.X - player7.position.X || this.ai[1] != base.position.Y - player7.position.Y)
				{
					netUpdate = true;
				}
				this.ai[0] = base.position.X - player7.position.X;
				this.ai[1] = base.position.Y - player7.position.Y;
				player7.mount.AimAbility(player7, base.position);
				if (!player7.channel)
				{
					player7.mount.UseAbility(player7, base.position, toggleOn: false);
					Kill();
				}
				return;
			}
			base.position.X = player7.position.X + this.ai[0];
			base.position.Y = player7.position.Y + this.ai[1];
			if (type == 441)
			{
				if (!player7.mount.AbilityCharging)
				{
					player7.mount.StartAbilityCharge(player7);
				}
			}
			else if (type == 453 && !player7.mount.AbilityActive)
			{
				player7.mount.UseAbility(player7, base.position, toggleOn: false);
			}
			player7.mount.AimAbility(player7, base.position);
		}
		else if (aiStyle == 77)
		{
			ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[0]));
			if (activeSound != null)
			{
				if (activeSound.Volume == 0f)
				{
					activeSound.Stop();
					localAI[0] = SlotId.Invalid.ToFloat();
				}
				activeSound.Volume = Math.Max(0f, activeSound.Volume - 0.05f);
			}
			else
			{
				localAI[0] = SlotId.Invalid.ToFloat();
			}
			if (this.ai[1] == 1f)
			{
				friendly = false;
				if (alpha < 255)
				{
					alpha += 51;
				}
				if (alpha >= 255)
				{
					alpha = 255;
					Kill();
					return;
				}
			}
			else
			{
				if (alpha > 0)
				{
					alpha -= 50;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			float num639 = 30f;
			float num640 = num639 * 4f;
			this.ai[0]++;
			if (this.ai[0] > num640)
			{
				this.ai[0] = 0f;
			}
			Vector2 vector52 = -Vector2.UnitY.RotatedBy((float)Math.PI * 2f * this.ai[0] / num639);
			float val = 0.75f + vector52.Y * 0.25f;
			float val2 = 0.8f - vector52.Y * 0.2f;
			float num641 = Math.Max(val, val2);
			base.position += new Vector2(width, height) / 2f;
			width = (height = (int)(80f * num641));
			base.position -= new Vector2(width, height) / 2f;
			frameCounter++;
			if (frameCounter >= 3)
			{
				frameCounter = 0;
				frame++;
				if (frame >= 4)
				{
					frame = 0;
				}
			}
			for (int num642 = 0; num642 < 1; num642++)
			{
				float num643 = 55f * num641;
				float num644 = 11f * num641;
				float num645 = 0.5f;
				int num646 = Dust.NewDust(base.position, width, height, 226, 0f, 0f, 100, default(Color), 0.5f);
				Main.dust[num646].noGravity = true;
				Dust dust2 = Main.dust[num646];
				dust2.velocity *= 2f;
				Main.dust[num646].position = ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2() * (num644 + num645 * (float)Main.rand.NextDouble() * num643) + base.Center;
				Main.dust[num646].velocity = Main.dust[num646].velocity / 2f + Vector2.Normalize(Main.dust[num646].position - base.Center);
				if (Main.rand.Next(2) == 0)
				{
					num646 = Dust.NewDust(base.position, width, height, 226, 0f, 0f, 100, default(Color), 0.9f);
					Main.dust[num646].noGravity = true;
					dust2 = Main.dust[num646];
					dust2.velocity *= 1.2f;
					Main.dust[num646].position = ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2() * (num644 + num645 * (float)Main.rand.NextDouble() * num643) + base.Center;
					Main.dust[num646].velocity = Main.dust[num646].velocity / 2f + Vector2.Normalize(Main.dust[num646].position - base.Center);
				}
				if (Main.rand.Next(4) == 0)
				{
					num646 = Dust.NewDust(base.position, width, height, 226, 0f, 0f, 100, default(Color), 0.7f);
					Main.dust[num646].noGravity = true;
					dust2 = Main.dust[num646];
					dust2.velocity *= 1.2f;
					Main.dust[num646].position = ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2() * (num644 + num645 * (float)Main.rand.NextDouble() * num643) + base.Center;
					Main.dust[num646].velocity = Main.dust[num646].velocity / 2f + Vector2.Normalize(Main.dust[num646].position - base.Center);
				}
			}
		}
		else if (aiStyle == 78)
		{
			if (alpha > 0)
			{
				alpha -= 30;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
			Vector2 v6 = this.ai[0].ToRotationVector2();
			float num647 = velocity.ToRotation();
			float num648 = v6.ToRotation();
			double num649 = num648 - num647;
			if (num649 > Math.PI)
			{
				num649 -= Math.PI * 2.0;
			}
			if (num649 < -Math.PI)
			{
				num649 += Math.PI * 2.0;
			}
			velocity = velocity.RotatedBy(num649 * 0.05000000074505806);
			velocity *= 0.96f;
			rotation = velocity.ToRotation() - (float)Math.PI / 2f;
			if (Main.myPlayer == owner && timeLeft > 60)
			{
				timeLeft = 60;
			}
		}
		else if (aiStyle == 79)
		{
			bool flag39 = true;
			int num650 = (int)this.ai[0] - 1;
			if (type == 447 && (this.ai[0] == 0f || ((!Main.npc[num650].active || Main.npc[num650].type != 392) && (!Main.npc[num650].active || Main.npc[num650].type != 395 || !(Main.npc[num650].ai[3] % 120f >= 60f) || Main.npc[num650].ai[0] != 2f))))
			{
				flag39 = false;
			}
			if (!flag39)
			{
				Kill();
				return;
			}
			NPC nPC10 = Main.npc[num650];
			float num651 = nPC10.Center.Y + 46f;
			float num652 = num651;
			if (type == 447)
			{
				int target = nPC10.target;
				if (nPC10.type == 392)
				{
					target = Main.npc[(int)nPC10.ai[0]].target;
				}
				Player player8 = Main.player[target];
				if (player8 != null && player8.active && !player8.dead)
				{
					num652 = player8.Bottom.Y;
				}
			}
			num652 /= 16f;
			int num653 = (int)nPC10.Center.X / 16;
			int num654 = (int)num651 / 16;
			int num655 = 0;
			if ((float)num654 >= num652 && Main.tile[num653, num654].nactive() && Main.tileSolid[Main.tile[num653, num654].type] && !Main.tileSolidTop[Main.tile[num653, num654].type])
			{
				num655 = 1;
			}
			else
			{
				for (; num655 < 150 && num654 + num655 < Main.maxTilesY; num655++)
				{
					int num656 = num654 + num655;
					if ((float)num656 >= num652 && Main.tile[num653, num656].nactive() && Main.tileSolid[Main.tile[num653, num656].type] && !Main.tileSolidTop[Main.tile[num653, num656].type])
					{
						num655--;
						break;
					}
				}
			}
			base.position.X = nPC10.Center.X - (float)(width / 2);
			base.position.Y = num651;
			height = (num655 + 1) * 16;
			int num657 = (int)base.position.Y + height;
			if (Main.tile[num653, num657 / 16].nactive() && Main.tileSolid[Main.tile[num653, num657 / 16].type] && !Main.tileSolidTop[Main.tile[num653, num657 / 16].type])
			{
				int num658 = num657 % 16;
				height -= num658 - 2;
			}
			if (type == 447)
			{
				for (int num659 = 0; num659 < 2; num659++)
				{
					int num660 = Dust.NewDust(new Vector2(base.position.X, base.position.Y + (float)height - 16f), width, 16, 228);
					Main.dust[num660].noGravity = true;
					Dust dust2 = Main.dust[num660];
					dust2.velocity *= 0.5f;
					Main.dust[num660].velocity.X -= (float)num659 - nPC10.velocity.X * 2f / 3f;
					Main.dust[num660].scale = 2.8f;
				}
				if (Main.rand.Next(5) == 0)
				{
					int num661 = Dust.NewDust(new Vector2(base.position.X + (float)(width / 2) - (float)(width / 2 * Math.Sign(nPC10.velocity.X)) - 4f, base.position.Y + (float)height - 16f), 4, 16, 31, 0f, 0f, 100, default(Color), 1.5f);
					Dust dust2 = Main.dust[num661];
					dust2.velocity *= 0.5f;
					Main.dust[num661].velocity.X -= nPC10.velocity.X / 2f;
					Main.dust[num661].velocity.Y = 0f - Math.Abs(Main.dust[num661].velocity.Y);
				}
			}
			if (type == 447 && ++frameCounter >= 5)
			{
				frameCounter = 0;
				if (++frame >= 4)
				{
					frame = 0;
				}
			}
		}
		else if (aiStyle == 80)
		{
			if (this.ai[0] == 0f && this.ai[1] > 0f)
			{
				this.ai[1]--;
			}
			else if (this.ai[0] == 0f && this.ai[1] == 0f)
			{
				this.ai[0] = 1f;
				this.ai[1] = (int)Player.FindClosest(base.position, width, height);
				netUpdate = true;
				float num662 = velocity.Length();
				velocity = Vector2.Normalize(velocity) * (num662 + 4f);
				for (int num663 = 0; num663 < 8; num663++)
				{
					Vector2 spinningpoint9 = Vector2.UnitX * -8f;
					spinningpoint9 += -Vector2.UnitY.RotatedBy((float)num663 * (float)Math.PI / 4f) * new Vector2(2f, 8f);
					spinningpoint9 = spinningpoint9.RotatedBy(rotation - (float)Math.PI / 2f);
					int num664 = Dust.NewDust(base.Center, 0, 0, 228);
					Main.dust[num664].scale = 1.5f;
					Main.dust[num664].noGravity = true;
					Main.dust[num664].position = base.Center + spinningpoint9;
					Main.dust[num664].velocity = velocity * 0f;
				}
			}
			else if (this.ai[0] == 1f)
			{
				tileCollide = true;
				localAI[1]++;
				float num665 = 180f;
				float num666 = 0f;
				float num667 = 30f;
				if (localAI[1] == num665)
				{
					Kill();
					return;
				}
				if (localAI[1] >= num666 && localAI[1] < num666 + num667)
				{
					Vector2 v7 = Main.player[(int)this.ai[1]].Center - base.Center;
					float num668 = velocity.ToRotation();
					float num669 = v7.ToRotation();
					double num670 = num669 - num668;
					if (num670 > Math.PI)
					{
						num670 -= Math.PI * 2.0;
					}
					if (num670 < -Math.PI)
					{
						num670 += Math.PI * 2.0;
					}
					velocity = velocity.RotatedBy(num670 * 0.20000000298023224);
				}
				if (localAI[1] % 5f == 0f)
				{
					for (int num671 = 0; num671 < 4; num671++)
					{
						Vector2 spinningpoint10 = Vector2.UnitX * -8f;
						spinningpoint10 += -Vector2.UnitY.RotatedBy((float)num671 * (float)Math.PI / 4f) * new Vector2(2f, 4f);
						spinningpoint10 = spinningpoint10.RotatedBy(rotation - (float)Math.PI / 2f);
						int num672 = Dust.NewDust(base.Center, 0, 0, 228);
						Main.dust[num672].scale = 1.5f;
						Main.dust[num672].noGravity = true;
						Main.dust[num672].position = base.Center + spinningpoint10;
						Main.dust[num672].velocity = velocity * 0f;
					}
				}
			}
			rotation = velocity.ToRotation() + (float)Math.PI / 2f;
			if (++frameCounter >= 3)
			{
				frameCounter = 0;
				if (++frame >= 3)
				{
					frame = 0;
				}
			}
			for (int num673 = 0; (float)num673 < 1f + this.ai[0]; num673++)
			{
				Vector2 vector53 = Vector2.UnitY.RotatedBy(rotation) * 8f * (num673 + 1);
				int num674 = Dust.NewDust(base.Center, 0, 0, 228);
				Main.dust[num674].position = base.Center + vector53;
				Main.dust[num674].scale = 1f;
				Main.dust[num674].noGravity = true;
			}
			for (int num675 = 0; num675 < 255; num675++)
			{
				Player player9 = Main.player[num675];
				if (player9.active && !player9.dead && Vector2.Distance(player9.Center, base.Center) <= 42f)
				{
					Kill();
					break;
				}
			}
		}
		else if (aiStyle == 81)
		{
			int num676 = penetrate;
			int num677 = 11;
			float num678 = Math.Max(1f, velocity.Length() / (float)num677);
			if (this.ai[0] == -1f)
			{
				tileCollide = true;
				localAI[0]++;
				if (localAI[0] > 7f)
				{
					int num679 = Utils.SelectRandom<int>(Main.rand, 226, 229);
					Vector2 center8 = base.Center;
					Vector2 spinningpoint11 = new Vector2(-16f, 16f);
					float num680 = 1f;
					spinningpoint11 += new Vector2(-16f, 16f);
					spinningpoint11 = spinningpoint11.RotatedBy(rotation);
					int num681 = 4;
					int num682 = Dust.NewDust(center8 + spinningpoint11 + Vector2.One * -num681, num681 * 2, num681 * 2, num679, 0f, 0f, 100, default(Color), num680);
					Dust dust2 = Main.dust[num682];
					dust2.velocity *= 0.1f;
					if (Main.rand.Next(6) != 0)
					{
						Main.dust[num682].noGravity = true;
					}
				}
				float num683 = 0.01f * num678;
				int num684 = (int)(5f * num678);
				int num685 = 75;
				int num686 = Math.Min(7, (int)(7f / num678));
				if (localAI[0] > (float)num686 && localAI[1] == 0f)
				{
					scale -= num683;
					alpha += num684;
					if (alpha > num685)
					{
						alpha = num685;
						this.ai[0] = 0f;
						netUpdate = true;
					}
				}
				rotation = velocity.ToRotation() + (float)Math.PI / 4f;
			}
			else if (this.ai[0] == 0f)
			{
				tileCollide = true;
				localAI[0]++;
				if (localAI[0] > 7f)
				{
					int num687 = Utils.SelectRandom<int>(Main.rand, 226, 229);
					Vector2 center9 = base.Center;
					Vector2 spinningpoint12 = new Vector2(-16f, 16f);
					float num688 = 1f;
					spinningpoint12 += new Vector2(-16f, 16f);
					spinningpoint12 = spinningpoint12.RotatedBy(rotation);
					int num689 = 4;
					int num690 = Dust.NewDust(center9 + spinningpoint12 + Vector2.One * -num689, num689 * 2, num689 * 2, num687, 0f, 0f, 100, default(Color), num688);
					Dust dust2 = Main.dust[num690];
					dust2.velocity *= 0.1f;
					if (Main.rand.Next(6) != 0)
					{
						Main.dust[num690].noGravity = true;
					}
				}
				float num691 = 0.01f;
				int num692 = 5;
				int num693 = num692 * 15;
				int num694 = 0;
				int num695 = Math.Min(7, (int)(7f * num678));
				if (localAI[0] > (float)num695)
				{
					if (localAI[1] == 0f)
					{
						scale -= num691;
						alpha += num692;
						if (alpha > num693)
						{
							alpha = num693;
							localAI[1] = 1f;
						}
					}
					else if (localAI[1] == 1f)
					{
						scale += num691;
						alpha -= num692;
						if (alpha <= num694)
						{
							alpha = num694;
							localAI[1] = 0f;
						}
					}
				}
				rotation = velocity.ToRotation() + (float)Math.PI / 4f;
			}
			else if (this.ai[0] >= 1f && this.ai[0] < (float)(1 + num676))
			{
				tileCollide = false;
				int num696 = (int)(15f * num678);
				float num697 = 0.98f / num678;
				alpha += num696;
				velocity *= num697;
				localAI[0] = 0f;
				int num698 = -1;
				Vector2 vector54 = base.Center;
				float num699 = 250f;
				for (int num700 = 0; num700 < Main.maxNPCs; num700++)
				{
					NPC nPC11 = Main.npc[num700];
					if (nPC11.CanBeChasedBy(this))
					{
						Vector2 center10 = nPC11.Center;
						float num701 = Vector2.Distance(center10, base.Center);
						if (num701 < num699)
						{
							num699 = num701;
							vector54 = center10;
							num698 = num700;
						}
					}
				}
				if (alpha >= 255)
				{
					alpha = 255;
					if (this.ai[0] == 1f)
					{
						Kill();
						return;
					}
					if (num698 >= 0)
					{
						netUpdate = true;
						this.ai[0] += num676;
						base.position = vector54 + ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2() * 100f - new Vector2(width, height) / 2f;
						velocity = Vector2.Normalize(vector54 - base.Center) * 15f;
						rotation = velocity.ToRotation() + (float)Math.PI / 4f;
					}
					else
					{
						Kill();
					}
				}
				if (active && num698 >= 0)
				{
					base.position += Main.npc[num698].velocity;
				}
				if (Main.rand.Next(3) == 0)
				{
					int num702 = Utils.SelectRandom<int>(Main.rand, 226, 229);
					Vector2 center11 = base.Center;
					Vector2 vector55 = new Vector2(-16f, 16f);
					vector55 = vector55;
					float num703 = 0.6f;
					vector55 += new Vector2(-16f, 16f);
					vector55 = vector55.RotatedBy(rotation);
					int num704 = 4;
					int num705 = Dust.NewDust(center11 + vector55 + Vector2.One * -num704, num704 * 2, num704 * 2, num702, 0f, 0f, 100, default(Color), num703);
					Dust dust2 = Main.dust[num705];
					dust2.velocity *= 0.1f;
					Main.dust[num705].noGravity = true;
				}
			}
			else if (this.ai[0] >= (float)(1 + num676) && this.ai[0] < (float)(1 + num676 * 2))
			{
				scale = 0.9f;
				tileCollide = false;
				rotation = velocity.ToRotation() + (float)Math.PI / 4f;
				this.ai[1]++;
				if (this.ai[1] >= 15f)
				{
					alpha += 51;
					velocity *= 0.8f;
					if (alpha >= 255)
					{
						Kill();
					}
				}
				else
				{
					alpha -= 125;
					if (alpha < 0)
					{
						alpha = 0;
					}
					velocity *= 0.98f;
				}
				localAI[0]++;
				int num706 = -1;
				Vector2 center12 = base.Center;
				float num707 = 250f;
				for (int num708 = 0; num708 < Main.maxNPCs; num708++)
				{
					NPC nPC12 = Main.npc[num708];
					if (nPC12.CanBeChasedBy(this))
					{
						Vector2 center13 = nPC12.Center;
						float num709 = Vector2.Distance(center13, base.Center);
						if (num709 < num707)
						{
							num707 = num709;
							center12 = center13;
							num706 = num708;
						}
					}
				}
				if (num706 >= 0)
				{
					base.position += Main.npc[num706].velocity;
				}
				int num710 = Utils.SelectRandom<int>(Main.rand, 226, 229);
				Vector2 center14 = base.Center;
				Vector2 spinningpoint13 = new Vector2(-16f, 16f);
				float num711 = 0.6f;
				spinningpoint13 += new Vector2(-16f, 16f);
				spinningpoint13 = spinningpoint13.RotatedBy(rotation);
				int num712 = 4;
				int num713 = Dust.NewDust(center14 + spinningpoint13 + Vector2.One * -num712, num712 * 2, num712 * 2, num710, 0f, 0f, 100, default(Color), num711);
				Dust dust2 = Main.dust[num713];
				dust2.velocity *= 0.1f;
				Main.dust[num713].noGravity = true;
			}
			float num714 = (float)alpha / 255f;
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.3f * num714, 0.4f * num714, 1f * num714);
		}
		else if (aiStyle == 82)
		{
			alpha -= 40;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (this.ai[0] == 0f)
			{
				localAI[0]++;
				if (localAI[0] >= 45f)
				{
					localAI[0] = 0f;
					this.ai[0] = 1f;
					this.ai[1] = 0f - this.ai[1];
					netUpdate = true;
				}
				velocity.X = velocity.RotatedBy(this.ai[1]).X;
				velocity.X = MathHelper.Clamp(velocity.X, -6f, 6f);
				velocity.Y -= 0.08f;
				if (velocity.Y > 0f)
				{
					velocity.Y -= 0.2f;
				}
				if (velocity.Y < -7f)
				{
					velocity.Y = -7f;
				}
			}
			else if (this.ai[0] == 1f)
			{
				localAI[0]++;
				if (localAI[0] >= 90f)
				{
					localAI[0] = 0f;
					this.ai[0] = 2f;
					this.ai[1] = (int)Player.FindClosest(base.position, width, height);
					netUpdate = true;
				}
				velocity.X = velocity.RotatedBy(this.ai[1]).X;
				velocity.X = MathHelper.Clamp(velocity.X, -6f, 6f);
				velocity.Y -= 0.08f;
				if (velocity.Y > 0f)
				{
					velocity.Y -= 0.2f;
				}
				if (velocity.Y < -7f)
				{
					velocity.Y = -7f;
				}
			}
			else if (this.ai[0] == 2f)
			{
				Vector2 value6 = Main.player[(int)this.ai[1]].Center - base.Center;
				if (value6.Length() < 30f)
				{
					Kill();
					return;
				}
				value6.Normalize();
				value6 *= 14f;
				value6 = Vector2.Lerp(velocity, value6, 0.6f);
				if (value6.Y < 6f)
				{
					value6.Y = 6f;
				}
				float num715 = 0.4f;
				if (velocity.X < value6.X)
				{
					velocity.X += num715;
					if (velocity.X < 0f && value6.X > 0f)
					{
						velocity.X += num715;
					}
				}
				else if (velocity.X > value6.X)
				{
					velocity.X -= num715;
					if (velocity.X > 0f && value6.X < 0f)
					{
						velocity.X -= num715;
					}
				}
				if (velocity.Y < value6.Y)
				{
					velocity.Y += num715;
					if (velocity.Y < 0f && value6.Y > 0f)
					{
						velocity.Y += num715;
					}
				}
				else if (velocity.Y > value6.Y)
				{
					velocity.Y -= num715;
					if (velocity.Y > 0f && value6.Y < 0f)
					{
						velocity.Y -= num715;
					}
				}
			}
			if (alpha < 40)
			{
				int num716 = Dust.NewDust(base.Center - Vector2.One * 5f, 10, 10, 229, (0f - velocity.X) / 3f, (0f - velocity.Y) / 3f, 150, Color.Transparent, 1.2f);
				Main.dust[num716].noGravity = true;
			}
			rotation = velocity.ToRotation() + (float)Math.PI / 2f;
		}
		else if (aiStyle == 83)
		{
			if (alpha > 200)
			{
				alpha = 200;
			}
			alpha -= 5;
			if (alpha < 0)
			{
				alpha = 0;
			}
			float num717 = (float)alpha / 255f;
			scale = 1f - num717;
			if (this.ai[0] >= 0f)
			{
				this.ai[0]++;
			}
			if (this.ai[0] == -1f)
			{
				frame = 1;
				extraUpdates = 1;
			}
			else if (this.ai[0] < 30f)
			{
				base.position = Main.npc[(int)this.ai[1]].Center - new Vector2(width, height) / 2f - velocity;
			}
			else
			{
				velocity *= 0.96f;
				if (++frameCounter >= 6)
				{
					frameCounter = 0;
					if (++frame >= 2)
					{
						frame = 0;
					}
				}
			}
			if (alpha >= 40)
			{
				return;
			}
			for (int num718 = 0; num718 < 2; num718++)
			{
				float num719 = (float)Main.rand.NextDouble() * 1f - 0.5f;
				if (num719 < -0.5f)
				{
					num719 = -0.5f;
				}
				if (num719 > 0.5f)
				{
					num719 = 0.5f;
				}
				Vector2 vector56 = new Vector2((float)(-width) * 0.65f * scale, 0f).RotatedBy(num719 * ((float)Math.PI * 2f)).RotatedBy(velocity.ToRotation());
				int num720 = Dust.NewDust(base.Center - Vector2.One * 5f, 10, 10, 229, (0f - velocity.X) / 3f, (0f - velocity.Y) / 3f, 150, Color.Transparent, 0.7f);
				Main.dust[num720].velocity = Vector2.Zero;
				Main.dust[num720].position = base.Center + vector56;
				Main.dust[num720].noGravity = true;
			}
		}
		else if (aiStyle == 84)
		{
			Vector2? vector57 = null;
			if (velocity.HasNaNs() || velocity == Vector2.Zero)
			{
				velocity = -Vector2.UnitY;
			}
			if (type == 455 && Main.npc[(int)this.ai[1]].active && Main.npc[(int)this.ai[1]].type == 396)
			{
				if (Main.npc[(int)this.ai[1]].ai[0] == -2f)
				{
					Kill();
					return;
				}
				Vector2 vector58 = Utils.Vector2FromElipse(elipseSizes: new Vector2(27f, 59f) * Main.npc[(int)this.ai[1]].localAI[1], angleVector: Main.npc[(int)this.ai[1]].localAI[0].ToRotationVector2());
				base.position = Main.npc[(int)this.ai[1]].Center + vector58 - new Vector2(width, height) / 2f;
			}
			else if (type == 455 && Main.npc[(int)this.ai[1]].active && Main.npc[(int)this.ai[1]].type == 400)
			{
				Vector2 vector59 = Utils.Vector2FromElipse(elipseSizes: new Vector2(30f, 30f) * Main.npc[(int)this.ai[1]].localAI[1], angleVector: Main.npc[(int)this.ai[1]].localAI[0].ToRotationVector2());
				base.position = Main.npc[(int)this.ai[1]].Center + vector59 - new Vector2(width, height) / 2f;
			}
			else if (type == 537 && Main.npc[(int)this.ai[1]].active && Main.npc[(int)this.ai[1]].type == 411)
			{
				Vector2 vector60 = new Vector2(Main.npc[(int)this.ai[1]].direction * 6, -4f);
				base.position = Main.npc[(int)this.ai[1]].Center + vector60 - base.Size / 2f + new Vector2(0f, 0f - Main.npc[(int)this.ai[1]].gfxOffY);
			}
			else if (type == 461 && Main.projectile[(int)this.ai[1]].active && Main.projectile[(int)this.ai[1]].type == 460)
			{
				Vector2 vector61 = Vector2.Normalize(Main.projectile[(int)this.ai[1]].velocity);
				base.position = Main.projectile[(int)this.ai[1]].Center + vector61 * 16f - new Vector2(width, height) / 2f + new Vector2(0f, 0f - Main.projectile[(int)this.ai[1]].gfxOffY);
				velocity = Vector2.Normalize(Main.projectile[(int)this.ai[1]].velocity);
			}
			else if (type == 642 && Main.projectile[(int)this.ai[1]].active && Main.projectile[(int)this.ai[1]].type == 641)
			{
				Projectile projectile2 = Main.projectile[(int)this.ai[1]];
				base.Center = projectile2.Center;
				Vector2 vector62 = this.ai[0].ToRotationVector2().RotatedBy((float)(-projectile2.direction) * ((float)Math.PI / 3f) / 50f);
				this.ai[0] = vector62.ToRotation();
				velocity = Vector2.Normalize(vector62);
			}
			else
			{
				if (type != 632 || !Main.projectile[(int)this.ai[1]].active || Main.projectile[(int)this.ai[1]].type != 633)
				{
					Kill();
					return;
				}
				float num721 = (float)(int)this.ai[0] - 2.5f;
				Vector2 vector63 = Vector2.Normalize(Main.projectile[(int)this.ai[1]].velocity);
				Projectile projectile3 = Main.projectile[(int)this.ai[1]];
				float num722 = num721 * ((float)Math.PI / 6f);
				float num723 = 20f;
				Vector2 zero3 = Vector2.Zero;
				float num724 = 1f;
				float num725 = 15f;
				float num726 = -2f;
				if (projectile3.ai[0] < 180f)
				{
					num724 = 1f - projectile3.ai[0] / 180f;
					num725 = 20f - projectile3.ai[0] / 180f * 14f;
					if (projectile3.ai[0] < 120f)
					{
						num723 = 20f - 4f * (projectile3.ai[0] / 120f);
						Opacity = projectile3.ai[0] / 120f * 0.4f;
					}
					else
					{
						num723 = 16f - 10f * ((projectile3.ai[0] - 120f) / 60f);
						Opacity = 0.4f + (projectile3.ai[0] - 120f) / 60f * 0.6f;
					}
					num726 = -22f + projectile3.ai[0] / 180f * 20f;
				}
				else
				{
					num724 = 0f;
					num723 = 1.75f;
					num725 = 6f;
					Opacity = 1f;
					num726 = -2f;
				}
				float num727 = (projectile3.ai[0] + num721 * num723) / (num723 * 6f) * ((float)Math.PI * 2f);
				num722 = Vector2.UnitY.RotatedBy(num727).Y * ((float)Math.PI / 6f) * num724;
				zero3 = (Vector2.UnitY.RotatedBy(num727) * new Vector2(4f, num725)).RotatedBy(projectile3.velocity.ToRotation());
				base.position = projectile3.Center + vector63 * 16f - base.Size / 2f + new Vector2(0f, 0f - Main.projectile[(int)this.ai[1]].gfxOffY);
				base.position += projectile3.velocity.ToRotation().ToRotationVector2() * num726;
				base.position += zero3;
				velocity = Vector2.Normalize(projectile3.velocity).RotatedBy(num722);
				scale = 1.4f * (1f - num724);
				damage = projectile3.damage;
				if (projectile3.ai[0] >= 180f)
				{
					damage *= 3;
					vector57 = projectile3.Center;
				}
				if (!Collision.CanHitLine(Main.player[owner].Center, 0, 0, projectile3.Center, 0, 0))
				{
					vector57 = Main.player[owner].Center;
				}
				friendly = projectile3.ai[0] > 30f;
			}
			if (velocity.HasNaNs() || velocity == Vector2.Zero)
			{
				velocity = -Vector2.UnitY;
			}
			if (type == 461)
			{
				this.ai[0]++;
				if (this.ai[0] >= 300f)
				{
					Kill();
					return;
				}
				scale = (float)Math.Sin(this.ai[0] * (float)Math.PI / 300f) * 10f;
				if (scale > 1f)
				{
					scale = 1f;
				}
			}
			if (type == 455)
			{
				if (localAI[0] == 0f)
				{
					SoundEngine.PlaySound(29, (int)base.position.X, (int)base.position.Y, 104);
				}
				float num728 = 1f;
				if (Main.npc[(int)this.ai[1]].type == 400)
				{
					num728 = 0.4f;
				}
				localAI[0]++;
				if (localAI[0] >= 180f)
				{
					Kill();
					return;
				}
				scale = (float)Math.Sin(localAI[0] * (float)Math.PI / 180f) * 10f * num728;
				if (scale > num728)
				{
					scale = num728;
				}
			}
			if (type == 642)
			{
				float num729 = 1f;
				localAI[0]++;
				if (localAI[0] >= 50f)
				{
					Kill();
					return;
				}
				scale = (float)Math.Sin(localAI[0] * (float)Math.PI / 50f) * 10f * num729;
				if (scale > num729)
				{
					scale = num729;
				}
			}
			if (type == 537)
			{
				float num730 = 0.8f;
				localAI[0]++;
				if (localAI[0] >= 90f)
				{
					Kill();
					return;
				}
				scale = (float)Math.Sin(localAI[0] * (float)Math.PI / 90f) * 10f * num730;
				if (scale > num730)
				{
					scale = num730;
				}
			}
			float num731 = velocity.ToRotation();
			if (type == 455)
			{
				num731 += this.ai[0];
			}
			rotation = num731 - (float)Math.PI / 2f;
			velocity = num731.ToRotationVector2();
			float num732 = 0f;
			float num733 = 0f;
			Vector2 samplingPoint = base.Center;
			if (vector57.HasValue)
			{
				samplingPoint = vector57.Value;
			}
			if (type == 455)
			{
				num732 = 3f;
				num733 = width;
			}
			else if (type == 461)
			{
				num732 = 2f;
				num733 = 0f;
			}
			else if (type == 642)
			{
				num732 = 2f;
				num733 = 0f;
			}
			else if (type == 632)
			{
				num732 = 2f;
				num733 = 0f;
			}
			else if (type == 537)
			{
				num732 = 2f;
				num733 = 0f;
			}
			float[] array2 = new float[(int)num732];
			Collision.LaserScan(samplingPoint, velocity, num733 * scale, 2400f, array2);
			float num734 = 0f;
			for (int num735 = 0; num735 < array2.Length; num735++)
			{
				num734 += array2[num735];
			}
			num734 /= num732;
			float amount = 0.5f;
			if (type == 455)
			{
				NPC nPC13 = Main.npc[(int)this.ai[1]];
				if (nPC13.type == 396)
				{
					Player player10 = Main.player[nPC13.target];
					if (!Collision.CanHitLine(nPC13.position, nPC13.width, nPC13.height, player10.position, player10.width, player10.height))
					{
						num734 = Math.Min(2400f, Vector2.Distance(nPC13.Center, player10.Center) + 150f);
						amount = 0.75f;
					}
				}
			}
			if (type == 632)
			{
				amount = 0.75f;
			}
			localAI[1] = MathHelper.Lerp(localAI[1], num734, amount);
			if (type == 455)
			{
				Vector2 vector64 = base.Center + velocity * (localAI[1] - 14f);
				for (int num736 = 0; num736 < 2; num736++)
				{
					float num737 = velocity.ToRotation() + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * ((float)Math.PI / 2f);
					float num738 = (float)Main.rand.NextDouble() * 2f + 2f;
					Vector2 vector65 = new Vector2((float)Math.Cos(num737) * num738, (float)Math.Sin(num737) * num738);
					int num739 = Dust.NewDust(vector64, 0, 0, 229, vector65.X, vector65.Y);
					Main.dust[num739].noGravity = true;
					Main.dust[num739].scale = 1.7f;
				}
				if (Main.rand.Next(5) == 0)
				{
					Vector2 vector66 = velocity.RotatedBy(1.5707963705062866) * ((float)Main.rand.NextDouble() - 0.5f) * width;
					int num740 = Dust.NewDust(vector64 + vector66 - Vector2.One * 4f, 8, 8, 31, 0f, 0f, 100, default(Color), 1.5f);
					Dust dust2 = Main.dust[num740];
					dust2.velocity *= 0.5f;
					Main.dust[num740].velocity.Y = 0f - Math.Abs(Main.dust[num740].velocity.Y);
				}
				DelegateMethods.v3_1 = new Vector3(0.3f, 0.65f, 0.7f);
				Utils.PlotTileLine(base.Center, base.Center + velocity * localAI[1], (float)width * scale, DelegateMethods.CastLight);
			}
			else if (type == 642)
			{
				Vector2 vector67 = base.Center + velocity * (localAI[1] - 14f);
				for (int num741 = 0; num741 < 2; num741++)
				{
					float num742 = velocity.ToRotation() + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * ((float)Math.PI / 2f);
					float num743 = (float)Main.rand.NextDouble() * 2f + 2f;
					Vector2 vector68 = new Vector2((float)Math.Cos(num742) * num743, (float)Math.Sin(num742) * num743);
					int num744 = Dust.NewDust(vector67, 0, 0, 229, vector68.X, vector68.Y);
					Main.dust[num744].noGravity = true;
					Main.dust[num744].scale = 1.7f;
				}
				if (Main.rand.Next(5) == 0)
				{
					Vector2 vector69 = velocity.RotatedBy(1.5707963705062866) * ((float)Main.rand.NextDouble() - 0.5f) * width;
					int num745 = Dust.NewDust(vector67 + vector69 - Vector2.One * 4f, 8, 8, 31, 0f, 0f, 100, default(Color), 1.5f);
					Dust dust2 = Main.dust[num745];
					dust2.velocity *= 0.5f;
					Main.dust[num745].velocity.Y = 0f - Math.Abs(Main.dust[num745].velocity.Y);
				}
				DelegateMethods.v3_1 = new Vector3(0.3f, 0.65f, 0.7f);
				Utils.PlotTileLine(base.Center, base.Center + velocity * localAI[1], (float)width * scale, DelegateMethods.CastLight);
			}
			if (type == 461)
			{
				Vector2 vector70 = base.Center + velocity * (localAI[1] - 8f);
				for (int num746 = 0; num746 < 2; num746++)
				{
					float num747 = velocity.ToRotation() + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * ((float)Math.PI / 2f);
					float num748 = (float)Main.rand.NextDouble() * 0.8f + 1f;
					Vector2 vector71 = new Vector2((float)Math.Cos(num747) * num748, (float)Math.Sin(num747) * num748);
					int num749 = Dust.NewDust(vector70, 0, 0, 226, vector71.X, vector71.Y);
					Main.dust[num749].noGravity = true;
					Main.dust[num749].scale = 1.2f;
				}
				if (Main.rand.Next(5) == 0)
				{
					Vector2 vector72 = velocity.RotatedBy(1.5707963705062866) * ((float)Main.rand.NextDouble() - 0.5f) * width;
					int num750 = Dust.NewDust(vector70 + vector72 - Vector2.One * 4f, 8, 8, 31, 0f, 0f, 100, default(Color), 1.5f);
					Dust dust2 = Main.dust[num750];
					dust2.velocity *= 0.5f;
					Main.dust[num750].velocity.Y = 0f - Math.Abs(Main.dust[num750].velocity.Y);
				}
				DelegateMethods.v3_1 = new Vector3(0.4f, 0.85f, 0.9f);
				Utils.PlotTileLine(base.Center, base.Center + velocity * localAI[1], (float)width * scale, DelegateMethods.CastLight);
			}
			if (type == 537)
			{
				float num751 = MathHelper.Clamp(MathHelper.Lerp(0f, 1f, localAI[0] / 30f), 0f, 1f);
				Vector2 vector73 = base.Center + velocity * (localAI[1] - 8f);
				int num752 = (int)(2f * num751);
				if (num752 > 0)
				{
					for (int num753 = 0; num753 < num752; num753++)
					{
						float num754 = velocity.ToRotation() + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * ((float)Math.PI / 2f);
						float num755 = (float)Main.rand.NextDouble() * 0.8f + 1f;
						Vector2 vector74 = new Vector2((float)Math.Cos(num754) * num755, (float)Math.Sin(num754) * num755);
						int num756 = Dust.NewDust(vector73, 0, 0, 226, vector74.X, vector74.Y);
						Main.dust[num756].noGravity = true;
						Main.dust[num756].scale = 1.2f;
					}
				}
				int maxValue2 = 5 + (int)((1f - num751) * 5f);
				if (Main.rand.Next(maxValue2) == 0)
				{
					Vector2 vector75 = velocity.RotatedBy(1.5707963705062866) * ((float)Main.rand.NextDouble() - 0.5f) * width;
					int num757 = Dust.NewDust(vector73 + vector75 - Vector2.One * 4f, 8, 8, 31, 0f, 0f, 100, default(Color), 1.5f);
					Dust dust2 = Main.dust[num757];
					dust2.velocity *= 0.5f;
					Main.dust[num757].velocity.Y = 0f - Math.Abs(Main.dust[num757].velocity.Y);
				}
				DelegateMethods.v3_1 = new Vector3(0.4f, 0.85f, 0.9f);
				Utils.PlotTileLine(base.Center, base.Center + velocity * localAI[1], (float)width * scale, DelegateMethods.CastLight);
			}
			if (type != 632 || !(Math.Abs(localAI[1] - num734) < 100f) || !(scale > 0.15f))
			{
				return;
			}
			float laserLuminance = 0.5f;
			float laserAlphaMultiplier = 0f;
			float lastPrismHue = GetLastPrismHue(this.ai[0], ref laserLuminance, ref laserAlphaMultiplier);
			Color color = Main.hslToRgb(lastPrismHue, 1f, laserLuminance);
			color.A = (byte)((float)(int)color.A * laserAlphaMultiplier);
			Color color2 = color;
			Vector2 vector76 = base.Center + velocity * (localAI[1] - 14.5f * scale);
			float x6 = Main.rgbToHsl(new Color(Main.DiscoR, Main.DiscoG, Main.DiscoB)).X;
			for (int num758 = 0; num758 < 2; num758++)
			{
				float num759 = velocity.ToRotation() + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * ((float)Math.PI / 2f);
				float num760 = (float)Main.rand.NextDouble() * 0.8f + 1f;
				Vector2 vector77 = new Vector2((float)Math.Cos(num759) * num760, (float)Math.Sin(num759) * num760);
				int num761 = Dust.NewDust(vector76, 0, 0, 267, vector77.X, vector77.Y);
				Main.dust[num761].color = color;
				Main.dust[num761].scale = 1.2f;
				if (scale > 1f)
				{
					Dust dust2 = Main.dust[num761];
					dust2.velocity *= scale;
					dust2 = Main.dust[num761];
					dust2.scale *= scale;
				}
				Main.dust[num761].noGravity = true;
				if (scale != 1.4f && num761 != 6000)
				{
					Dust dust23 = Dust.CloneDust(num761);
					dust23.color = Color.White;
					Dust dust2 = dust23;
					dust2.scale /= 2f;
				}
				float hue = (x6 + Main.rand.NextFloat() * 0.4f) % 1f;
				Main.dust[num761].color = Color.Lerp(color, Main.hslToRgb(hue, 1f, 0.75f), scale / 1.4f);
			}
			if (Main.rand.Next(5) == 0)
			{
				Vector2 vector78 = velocity.RotatedBy(1.5707963705062866) * ((float)Main.rand.NextDouble() - 0.5f) * width;
				int num762 = Dust.NewDust(vector76 + vector78 - Vector2.One * 4f, 8, 8, 31, 0f, 0f, 100, default(Color), 1.5f);
				Dust dust2 = Main.dust[num762];
				dust2.velocity *= 0.5f;
				Main.dust[num762].velocity.Y = 0f - Math.Abs(Main.dust[num762].velocity.Y);
			}
			DelegateMethods.v3_1 = color.ToVector3() * 0.3f;
			float value7 = 0.1f * (float)Math.Sin(Main.GlobalTimeWrappedHourly * 20f);
			Vector2 size2 = new Vector2(velocity.Length() * localAI[1], (float)width * scale);
			float num763 = velocity.ToRotation();
			if (Main.netMode != 2)
			{
				((WaterShaderData)Filters.Scene["WaterDistortion"].GetShader()).QueueRipple(base.position + new Vector2(size2.X * 0.5f, 0f).RotatedBy(num763), new Color(0.5f, 0.1f * (float)Math.Sign(value7) + 0.5f, 0f, 1f) * Math.Abs(value7), size2, RippleShape.Square, num763);
			}
			Utils.PlotTileLine(base.Center, base.Center + velocity * localAI[1], (float)width * scale, DelegateMethods.CastLight);
		}
		else if (aiStyle == 85)
		{
			Vector2 vector79 = new Vector2(0f, 216f);
			alpha -= 15;
			if (alpha < 0)
			{
				alpha = 0;
			}
			int num764 = (int)Math.Abs(this.ai[0]) - 1;
			int num765 = (int)this.ai[1];
			if (!Main.npc[num764].active || Main.npc[num764].type != 396)
			{
				Kill();
				return;
			}
			localAI[0]++;
			if (localAI[0] >= 330f && this.ai[0] > 0f && Main.netMode != 1)
			{
				this.ai[0] *= -1f;
				netUpdate = true;
			}
			if (Main.netMode != 1 && this.ai[0] > 0f && (!Main.player[(int)this.ai[1]].active || Main.player[(int)this.ai[1]].dead))
			{
				this.ai[0] *= -1f;
				netUpdate = true;
			}
			rotation = (Main.npc[(int)Math.Abs(this.ai[0]) - 1].Center - Main.player[(int)this.ai[1]].Center + vector79).ToRotation() + (float)Math.PI / 2f;
			if (this.ai[0] > 0f)
			{
				Vector2 value8 = Main.player[(int)this.ai[1]].Center - base.Center;
				if (value8.X != 0f || value8.Y != 0f)
				{
					velocity = Vector2.Normalize(value8) * Math.Min(16f, value8.Length());
				}
				else
				{
					velocity = Vector2.Zero;
				}
				if (value8.Length() < 20f && localAI[1] == 0f)
				{
					localAI[1] = 1f;
					int buffTime = 840;
					if (Main.expertMode)
					{
						buffTime = 960;
					}
					if (!Main.player[num765].creativeGodMode)
					{
						ApplyBuffTo(Main.player[num765], 145, buffTime);
					}
				}
			}
			else
			{
				Vector2 value9 = Main.npc[(int)Math.Abs(this.ai[0]) - 1].Center - base.Center + vector79;
				if (value9.X != 0f || value9.Y != 0f)
				{
					velocity = Vector2.Normalize(value9) * Math.Min(16f, value9.Length());
				}
				else
				{
					velocity = Vector2.Zero;
				}
				if (value9.Length() < 20f)
				{
					Kill();
				}
			}
		}
		else if (aiStyle == 86)
		{
			if (localAI[1] == 0f)
			{
				localAI[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item120, base.position);
			}
			this.ai[0]++;
			if (this.ai[1] == 1f)
			{
				if (this.ai[0] >= 130f)
				{
					alpha += 10;
				}
				else
				{
					alpha -= 10;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (alpha > 255)
				{
					alpha = 255;
				}
				if (this.ai[0] >= 150f)
				{
					Kill();
					return;
				}
				if (this.ai[0] % 30f == 0f && Main.netMode != 1)
				{
					Vector2 vector80 = rotation.ToRotationVector2();
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector80.X, vector80.Y, 464, damage, knockBack, owner);
				}
				rotation += (float)Math.PI / 30f;
				Lighting.AddLight(base.Center, 0.3f, 0.75f, 0.9f);
				return;
			}
			base.position -= velocity;
			if (this.ai[0] >= 40f)
			{
				alpha += 3;
			}
			else
			{
				alpha -= 40;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (alpha > 255)
			{
				alpha = 255;
			}
			if (this.ai[0] >= 45f)
			{
				Kill();
				return;
			}
			Vector2 vector81 = new Vector2(0f, -720f).RotatedBy(velocity.ToRotation());
			float num766 = this.ai[0] % 45f / 45f;
			Vector2 spinningpoint14 = vector81 * num766;
			for (int num767 = 0; num767 < 6; num767++)
			{
				Vector2 vector82 = base.Center + spinningpoint14.RotatedBy((float)num767 * ((float)Math.PI * 2f) / 6f);
				Lighting.AddLight(vector82, 0.3f, 0.75f, 0.9f);
				for (int num768 = 0; num768 < 2; num768++)
				{
					int num769 = Dust.NewDust(vector82 + Utils.RandomVector2(Main.rand, -8f, 8f) / 2f, 8, 8, 197, 0f, 0f, 100, Color.Transparent);
					Main.dust[num769].noGravity = true;
				}
			}
		}
		else if (aiStyle == 87)
		{
			base.position.Y = this.ai[0];
			height = (int)this.ai[1];
			if (base.Center.X > Main.player[owner].Center.X)
			{
				direction = 1;
			}
			else
			{
				direction = -1;
			}
			velocity.X = (float)direction * 1E-06f;
			if (owner == Main.myPlayer)
			{
				for (int num770 = 0; num770 < 1000; num770++)
				{
					if (Main.projectile[num770].active && num770 != whoAmI && Main.projectile[num770].type == type && Main.projectile[num770].owner == owner && Main.projectile[num770].timeLeft > timeLeft)
					{
						Kill();
						return;
					}
				}
			}
			float num771 = (float)(width * height) * 0.0045f;
			for (int num772 = 0; (float)num772 < num771; num772++)
			{
				int num773 = Dust.NewDust(base.position, width, height, 75, 0f, 0f, 100);
				Main.dust[num773].noGravity = true;
				Dust dust2 = Main.dust[num773];
				dust2.velocity *= 0.5f;
				Main.dust[num773].velocity.Y -= 0.5f;
				Main.dust[num773].scale = 1.4f;
				Main.dust[num773].position.X += 6f;
				Main.dust[num773].position.Y -= 2f;
			}
		}
		else if (aiStyle == 88)
		{
			if (type == 465)
			{
				if (localAI[1] == 0f)
				{
					SoundEngine.PlaySound(SoundID.Item121, base.position);
					localAI[1] = 1f;
				}
				if (this.ai[0] < 180f)
				{
					alpha -= 5;
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				else
				{
					alpha += 5;
					if (alpha > 255)
					{
						alpha = 255;
						Kill();
						return;
					}
				}
				this.ai[0]++;
				if (this.ai[0] % 30f == 0f && this.ai[0] < 180f && Main.netMode != 1)
				{
					int[] array3 = new int[5];
					Vector2[] array4 = new Vector2[5];
					int num774 = 0;
					float num775 = 2000f;
					for (int num776 = 0; num776 < 255; num776++)
					{
						if (!Main.player[num776].active || Main.player[num776].dead)
						{
							continue;
						}
						Vector2 center15 = Main.player[num776].Center;
						float num777 = Vector2.Distance(center15, base.Center);
						if (num777 < num775 && Collision.CanHit(base.Center, 1, 1, center15, 1, 1))
						{
							array3[num774] = num776;
							array4[num774] = center15;
							int num778 = num774 + 1;
							num774 = num778;
							if (num778 >= array4.Length)
							{
								break;
							}
						}
					}
					for (int num779 = 0; num779 < num774; num779++)
					{
						Vector2 vector83 = array4[num779] - base.Center;
						float ai = Main.rand.Next(100);
						Vector2 vector84 = Vector2.Normalize(vector83.RotatedByRandom(0.7853981852531433)) * 7f;
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector84.X, vector84.Y, 466, damage, 0f, Main.myPlayer, vector83.ToRotation(), ai);
					}
				}
				Lighting.AddLight(base.Center, 0.4f, 0.85f, 0.9f);
				if (++frameCounter >= 4)
				{
					frameCounter = 0;
					if (++frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
				if (alpha >= 150 || !(this.ai[0] < 180f))
				{
					return;
				}
				for (int num780 = 0; num780 < 1; num780++)
				{
					float num781 = (float)Main.rand.NextDouble() * 1f - 0.5f;
					if (num781 < -0.5f)
					{
						num781 = -0.5f;
					}
					if (num781 > 0.5f)
					{
						num781 = 0.5f;
					}
					Vector2 vector85 = new Vector2((float)(-width) * 0.2f * scale, 0f).RotatedBy(num781 * ((float)Math.PI * 2f)).RotatedBy(velocity.ToRotation());
					int num782 = Dust.NewDust(base.Center - Vector2.One * 5f, 10, 10, 226, (0f - velocity.X) / 3f, (0f - velocity.Y) / 3f, 150, Color.Transparent, 0.7f);
					Main.dust[num782].position = base.Center + vector85;
					Main.dust[num782].velocity = Vector2.Normalize(Main.dust[num782].position - base.Center) * 2f;
					Main.dust[num782].noGravity = true;
				}
				for (int num783 = 0; num783 < 1; num783++)
				{
					float num784 = (float)Main.rand.NextDouble() * 1f - 0.5f;
					if (num784 < -0.5f)
					{
						num784 = -0.5f;
					}
					if (num784 > 0.5f)
					{
						num784 = 0.5f;
					}
					Vector2 vector86 = new Vector2((float)(-width) * 0.6f * scale, 0f).RotatedBy(num784 * ((float)Math.PI * 2f)).RotatedBy(velocity.ToRotation());
					int num785 = Dust.NewDust(base.Center - Vector2.One * 5f, 10, 10, 226, (0f - velocity.X) / 3f, (0f - velocity.Y) / 3f, 150, Color.Transparent, 0.7f);
					Main.dust[num785].velocity = Vector2.Zero;
					Main.dust[num785].position = base.Center + vector86;
					Main.dust[num785].noGravity = true;
				}
			}
			else if (type == 466)
			{
				frameCounter++;
				Lighting.AddLight(base.Center, 0.3f, 0.45f, 0.5f);
				if (velocity == Vector2.Zero)
				{
					if (frameCounter >= extraUpdates * 2)
					{
						frameCounter = 0;
						bool flag40 = true;
						for (int num786 = 1; num786 < oldPos.Length; num786++)
						{
							if (oldPos[num786] != oldPos[0])
							{
								flag40 = false;
							}
						}
						if (flag40)
						{
							Kill();
							return;
						}
					}
					if (Main.rand.Next(extraUpdates) == 0)
					{
						for (int num787 = 0; num787 < 2; num787++)
						{
							float num788 = rotation + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * ((float)Math.PI / 2f);
							float num789 = (float)Main.rand.NextDouble() * 0.8f + 1f;
							Vector2 vector87 = new Vector2((float)Math.Cos(num788) * num789, (float)Math.Sin(num788) * num789);
							int num790 = Dust.NewDust(base.Center, 0, 0, 226, vector87.X, vector87.Y);
							Main.dust[num790].noGravity = true;
							Main.dust[num790].scale = 1.2f;
						}
						if (Main.rand.Next(5) == 0)
						{
							Vector2 vector88 = velocity.RotatedBy(1.5707963705062866) * ((float)Main.rand.NextDouble() - 0.5f) * width;
							int num791 = Dust.NewDust(base.Center + vector88 - Vector2.One * 4f, 8, 8, 31, 0f, 0f, 100, default(Color), 1.5f);
							Dust dust2 = Main.dust[num791];
							dust2.velocity *= 0.5f;
							Main.dust[num791].velocity.Y = 0f - Math.Abs(Main.dust[num791].velocity.Y);
						}
					}
				}
				else
				{
					if (frameCounter < extraUpdates * 2)
					{
						return;
					}
					frameCounter = 0;
					float num792 = velocity.Length();
					UnifiedRandom unifiedRandom = new UnifiedRandom((int)this.ai[1]);
					int num793 = 0;
					Vector2 spinningpoint15 = -Vector2.UnitY;
					while (true)
					{
						int num794 = unifiedRandom.Next();
						this.ai[1] = num794;
						num794 %= 100;
						float f = (float)num794 / 100f * ((float)Math.PI * 2f);
						Vector2 vector89 = f.ToRotationVector2();
						if (vector89.Y > 0f)
						{
							vector89.Y *= -1f;
						}
						bool flag41 = false;
						if (vector89.Y > -0.02f)
						{
							flag41 = true;
						}
						if (vector89.X * (float)(extraUpdates + 1) * 2f * num792 + localAI[0] > 40f)
						{
							flag41 = true;
						}
						if (vector89.X * (float)(extraUpdates + 1) * 2f * num792 + localAI[0] < -40f)
						{
							flag41 = true;
						}
						if (flag41)
						{
							if (num793++ >= 100)
							{
								velocity = Vector2.Zero;
								localAI[1] = 1f;
								break;
							}
							continue;
						}
						spinningpoint15 = vector89;
						break;
					}
					if (velocity != Vector2.Zero)
					{
						localAI[0] += spinningpoint15.X * (float)(extraUpdates + 1) * 2f * num792;
						velocity = spinningpoint15.RotatedBy(this.ai[0] + (float)Math.PI / 2f) * num792;
						rotation = velocity.ToRotation() + (float)Math.PI / 2f;
					}
				}
			}
			else
			{
				if (type != 580)
				{
					return;
				}
				if (localAI[1] == 0f && this.ai[0] >= 900f)
				{
					this.ai[0] -= 1000f;
					localAI[1] = -1f;
				}
				frameCounter++;
				Lighting.AddLight(base.Center, 0.3f, 0.45f, 0.5f);
				if (velocity == Vector2.Zero)
				{
					if (frameCounter >= extraUpdates * 2)
					{
						frameCounter = 0;
						bool flag42 = true;
						for (int num795 = 1; num795 < oldPos.Length; num795++)
						{
							if (oldPos[num795] != oldPos[0])
							{
								flag42 = false;
							}
						}
						if (flag42)
						{
							Kill();
							return;
						}
					}
					if (Main.rand.Next(extraUpdates) == 0 && (velocity != Vector2.Zero || Main.rand.Next((localAI[1] == 2f) ? 2 : 6) == 0))
					{
						for (int num796 = 0; num796 < 2; num796++)
						{
							float num797 = rotation + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * ((float)Math.PI / 2f);
							float num798 = (float)Main.rand.NextDouble() * 0.8f + 1f;
							Vector2 vector90 = new Vector2((float)Math.Cos(num797) * num798, (float)Math.Sin(num797) * num798);
							int num799 = Dust.NewDust(base.Center, 0, 0, 226, vector90.X, vector90.Y);
							Main.dust[num799].noGravity = true;
							Main.dust[num799].scale = 1.2f;
						}
						if (Main.rand.Next(5) == 0)
						{
							Vector2 vector91 = velocity.RotatedBy(1.5707963705062866) * ((float)Main.rand.NextDouble() - 0.5f) * width;
							int num800 = Dust.NewDust(base.Center + vector91 - Vector2.One * 4f, 8, 8, 31, 0f, 0f, 100, default(Color), 1.5f);
							Dust dust2 = Main.dust[num800];
							dust2.velocity *= 0.5f;
							Main.dust[num800].velocity.Y = 0f - Math.Abs(Main.dust[num800].velocity.Y);
						}
					}
				}
				else
				{
					if (frameCounter < extraUpdates * 2)
					{
						return;
					}
					frameCounter = 0;
					float num801 = velocity.Length();
					UnifiedRandom unifiedRandom2 = new UnifiedRandom((int)this.ai[1]);
					int num802 = 0;
					Vector2 spinningpoint16 = -Vector2.UnitY;
					while (true)
					{
						int num803 = unifiedRandom2.Next();
						this.ai[1] = num803;
						num803 %= 100;
						float f2 = (float)num803 / 100f * ((float)Math.PI * 2f);
						Vector2 vector92 = f2.ToRotationVector2();
						if (vector92.Y > 0f)
						{
							vector92.Y *= -1f;
						}
						bool flag43 = false;
						if (vector92.Y > -0.02f)
						{
							flag43 = true;
						}
						if (vector92.X * (float)(extraUpdates + 1) * 2f * num801 + localAI[0] > 40f)
						{
							flag43 = true;
						}
						if (vector92.X * (float)(extraUpdates + 1) * 2f * num801 + localAI[0] < -40f)
						{
							flag43 = true;
						}
						if (flag43)
						{
							if (num802++ >= 100)
							{
								velocity = Vector2.Zero;
								if (localAI[1] < 1f)
								{
									localAI[1] += 2f;
								}
								break;
							}
							continue;
						}
						spinningpoint16 = vector92;
						break;
					}
					if (!(velocity != Vector2.Zero))
					{
						return;
					}
					localAI[0] += spinningpoint16.X * (float)(extraUpdates + 1) * 2f * num801;
					velocity = spinningpoint16.RotatedBy(this.ai[0] + (float)Math.PI / 2f) * num801;
					rotation = velocity.ToRotation() + (float)Math.PI / 2f;
					if (Main.rand.Next(4) == 0 && Main.netMode != 1 && localAI[1] == 0f)
					{
						float num804 = (float)Main.rand.Next(-3, 4) * ((float)Math.PI / 3f) / 3f;
						Vector2 vector93 = this.ai[0].ToRotationVector2().RotatedBy(num804) * velocity.Length();
						if (!Collision.CanHitLine(base.Center, 0, 0, base.Center + vector93 * 50f, 0, 0))
						{
							NewProjectile(GetProjectileSource_FromThis(), base.Center.X - vector93.X, base.Center.Y - vector93.Y, vector93.X, vector93.Y, type, damage, knockBack, owner, vector93.ToRotation() + 1000f, this.ai[1]);
						}
					}
				}
			}
		}
		else if (aiStyle == 89)
		{
			if (this.ai[1] == -1f)
			{
				alpha += 12;
			}
			else if (this.ai[0] < 300f)
			{
				alpha -= 5;
			}
			else
			{
				alpha += 12;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (alpha > 255)
			{
				alpha = 255;
			}
			scale = 1f - (float)alpha / 255f;
			scale *= 0.6f;
			rotation += (float)Math.PI / 210f;
			if (localAI[1] == 0f)
			{
				localAI[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item123, base.position);
			}
			if (alpha == 0)
			{
				for (int num805 = 0; num805 < 2; num805++)
				{
					float num806 = Main.rand.Next(2, 4);
					float num807 = scale;
					if (num805 == 1)
					{
						num807 *= 0.42f;
						num806 *= -0.75f;
					}
					Vector2 vector94 = new Vector2(Main.rand.Next(-10, 11), Main.rand.Next(-10, 11));
					vector94.Normalize();
					int num808 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 228, 0f, 0f, 100, default(Color), 2f);
					Main.dust[num808].noGravity = true;
					Main.dust[num808].noLight = true;
					Main.dust[num808].position = base.Center + vector94 * 204f * num807;
					if (Main.rand.Next(8) == 0)
					{
						Main.dust[num808].velocity = vector94 * (0f - num806) * 2f;
						Dust dust2 = Main.dust[num808];
						dust2.scale += 0.5f;
					}
					else
					{
						Main.dust[num808].velocity = vector94 * (0f - num806);
					}
				}
			}
			this.ai[0]++;
			if (this.ai[0] >= 60f)
			{
				int num809 = (int)(this.ai[0] - 0f) / 60;
				float num810 = scale * 0.4f;
				for (int num811 = 0; num811 < 1; num811++)
				{
					float num812 = Main.rand.Next(1, 3);
					Vector2 vector95 = new Vector2(Main.rand.Next(-10, 11), Main.rand.Next(-10, 11));
					vector95.Normalize();
					int num813 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 228, 0f, 0f, 100, default(Color), 2f);
					Main.dust[num813].noGravity = true;
					Main.dust[num813].noLight = true;
					Main.dust[num813].position = base.Center;
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num813].velocity = vector95 * num812 * 2f;
						Dust dust2 = Main.dust[num813];
						dust2.scale += 0.5f;
					}
					else
					{
						Main.dust[num813].velocity = vector95 * num812;
					}
					Main.dust[num813].fadeIn = 2f;
				}
			}
			if (this.ai[0] == 300f && this.ai[1] != -1f && Main.netMode != 1)
			{
				if (!NPC.AnyNPCs(454))
				{
					this.ai[1] = NPC.NewNPC(GetNPCSource_FromThis(), (int)base.Center.X, (int)base.Center.Y, 454);
				}
				else
				{
					this.ai[1] = NPC.NewNPC(GetNPCSource_FromThis(), (int)base.Center.X, (int)base.Center.Y, 521);
				}
			}
			else if (this.ai[0] == 320f)
			{
				Kill();
				return;
			}
			bool flag44 = false;
			if (this.ai[1] == -1f)
			{
				if (alpha == 255)
				{
					flag44 = true;
				}
			}
			else
			{
				flag44 = !(this.ai[1] >= 0f) || !Main.npc[(int)this.ai[1]].active;
				if ((flag44 || Main.npc[(int)this.ai[1]].type != 439) && (flag44 || Main.npc[(int)this.ai[1]].type != 454) && (flag44 || Main.npc[(int)this.ai[1]].type != 521))
				{
					flag44 = true;
				}
			}
			if (flag44)
			{
				Kill();
			}
			else
			{
				Lighting.AddLight(base.Center, 1.1f, 0.9f, 0.4f);
			}
		}
		else if (aiStyle == 90)
		{
			if (Main.player[owner].dead)
			{
				Kill();
			}
			if (Main.player[owner].magicLantern)
			{
				timeLeft = 2;
			}
			if (tileCollide)
			{
				if (!Collision.CanHit(base.position, width, height, Main.player[owner].Center, 1, 1))
				{
					tileCollide = false;
				}
				else if (!Collision.SolidCollision(base.position, width, height) && Collision.CanHitLine(base.position, width, height, Main.player[owner].Center, 1, 1))
				{
					tileCollide = true;
				}
			}
			direction = Main.player[owner].direction;
			spriteDirection = direction;
			Lighting.AddLight(base.position, 0.35f, 0.35f, 0.1f);
			localAI[0] += 1f;
			if (localAI[0] >= 10f)
			{
				localAI[0] = 0f;
				int num814 = 17;
				if ((base.Center - Main.player[Main.myPlayer].Center).Length() < (float)(Main.screenWidth + num814 * 16))
				{
					int num815 = (int)base.Center.X / 16;
					int num816 = (int)base.Center.Y / 16;
					for (int num817 = num815 - num814; num817 <= num815 + num814; num817++)
					{
						for (int num818 = num816 - num814; num818 <= num816 + num814; num818++)
						{
							if (Main.rand.Next(4) == 0 && new Vector2(num815 - num817, num816 - num818).Length() < (float)num814 && num817 > 0 && num817 < Main.maxTilesX - 1 && num818 > 0 && num818 < Main.maxTilesY - 1 && Main.tile[num817, num818] != null && Main.tile[num817, num818].active() && Main.IsTileSpelunkable(Main.tile[num817, num818]))
							{
								int num819 = Dust.NewDust(new Vector2(num817 * 16, num818 * 16), 16, 16, 204, 0f, 0f, 150, default(Color), 0.3f);
								Main.dust[num819].fadeIn = 0.75f;
								Dust dust2 = Main.dust[num819];
								dust2.velocity *= 0.1f;
								Main.dust[num819].noLight = true;
							}
						}
					}
				}
			}
			Vector2 vector96 = Main.player[owner].Center - base.Center;
			vector96.X += 40 * direction;
			vector96.Y -= 40f;
			float num820 = vector96.Length();
			if (num820 > 1000f)
			{
				base.Center = Main.player[owner].Center;
			}
			float num821 = 3f;
			float num822 = 4f;
			if (num820 > 200f)
			{
				num822 += (num820 - 200f) * 0.1f;
				tileCollide = false;
			}
			if (num820 < num822)
			{
				velocity *= 0.25f;
				num822 = num820;
			}
			if (vector96.X != 0f || vector96.Y != 0f)
			{
				vector96.Normalize();
				vector96 *= num822;
			}
			velocity = (velocity * (num821 - 1f) + vector96) / num821;
			if (velocity.Length() > 6f)
			{
				float num823 = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				if ((double)Math.Abs(rotation - num823) >= 3.14)
				{
					if (num823 < rotation)
					{
						rotation -= 6.28f;
					}
					else
					{
						rotation += 6.28f;
					}
				}
				rotation = (rotation * 4f + num823) / 5f;
				frameCounter++;
				if (frameCounter > 4)
				{
					frameCounter = 0;
					frame++;
					if (frame > 7)
					{
						frame = 4;
					}
				}
				if (frame < 4)
				{
					frame = 7;
				}
				return;
			}
			if ((double)rotation > 3.14)
			{
				rotation -= 6.28f;
			}
			if ((double)rotation > -0.01 && (double)rotation < 0.01)
			{
				rotation = 0f;
			}
			else
			{
				rotation *= 0.9f;
			}
			frameCounter++;
			if (frameCounter > 6)
			{
				frameCounter = 0;
				frame++;
				if (frame > 3)
				{
					frame = 0;
				}
			}
		}
		else if (aiStyle == 91)
		{
			Vector2 center16 = base.Center;
			scale = 1f - localAI[0];
			width = (int)(20f * scale);
			height = width;
			base.position.X = center16.X - (float)(width / 2);
			base.position.Y = center16.Y - (float)(height / 2);
			if ((double)localAI[0] < 0.1)
			{
				localAI[0] += 0.01f;
			}
			else
			{
				localAI[0] += 0.025f;
			}
			if (localAI[0] >= 0.95f)
			{
				Kill();
			}
			velocity.X += this.ai[0] * 1.5f;
			velocity.Y += this.ai[1] * 1.5f;
			if (velocity.Length() > 16f)
			{
				velocity.Normalize();
				velocity *= 16f;
			}
			this.ai[0] *= 1.05f;
			this.ai[1] *= 1.05f;
			if (scale < 1f)
			{
				for (int num824 = 0; (float)num824 < scale * 10f; num824++)
				{
					int num825 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 27, velocity.X, velocity.Y, 100, default(Color), 1.1f);
					Main.dust[num825].position = (Main.dust[num825].position + base.Center) / 2f;
					Main.dust[num825].noGravity = true;
					Dust dust2 = Main.dust[num825];
					dust2.velocity *= 0.1f;
					dust2 = Main.dust[num825];
					dust2.velocity -= velocity * (1.3f - scale);
					Main.dust[num825].fadeIn = 100 + owner;
					dust2 = Main.dust[num825];
					dust2.scale += scale * 0.75f;
				}
			}
		}
		else if (aiStyle == 92)
		{
			bool flag45 = type == 1007;
			bool flag46 = type >= 511 && type <= 513;
			tileCollide = false;
			if (Main.netMode != 1 && flag45 && localAI[0] == 0f)
			{
				if (direction == 0)
				{
					direction = 1;
				}
				ParticleOrchestrator.BroadcastParticleSpawn(ParticleOrchestraType.GasTrap, new ParticleOrchestraSettings
				{
					PositionInWorld = base.Center,
					MovementVector = Vector2.Zero
				});
			}
			this.ai[0] += 1f;
			if (this.ai[1] >= 1f)
			{
				this.ai[0] += 2f;
			}
			float num826 = 260f;
			if (flag45)
			{
				num826 = 80f;
			}
			if (this.ai[0] > num826)
			{
				Kill();
				this.ai[0] = num826;
				return;
			}
			float fromValue2 = this.ai[0] / num826;
			if (flag45)
			{
				scale = Utils.Remap(fromValue2, 0f, 0.95f, 1f, 6f);
				Vector2 center17 = base.Center;
				width = (int)(50f * scale);
				height = (int)(50f * scale);
				base.Center = center17;
				Opacity = MathHelper.Clamp(Utils.Remap(fromValue2, 0f, 0.25f, 0f, 1f) * Utils.Remap(fromValue2, 0.75f, 1f, 1f, 0f), 0f, 1f) * 0.85f;
			}
			else
			{
				Opacity = Utils.Remap(fromValue2, 0f, 0.3f, 0f, 1f) * Utils.Remap(fromValue2, 0.3f, 1f, 1f, 0f) * 0.7f;
			}
			localAI[0] += direction;
			rotation = (float)whoAmI * 0.4002029f + localAI[0] * ((float)Math.PI * 2f) / 480f;
			if (flag45)
			{
				velocity = Vector2.Zero;
			}
			else
			{
				velocity *= 0.96f;
			}
			if (flag46)
			{
				Rectangle rectangle4 = new Rectangle((int)base.position.X, (int)base.position.Y, width, height);
				for (int num827 = 0; num827 < 1000; num827++)
				{
					if (num827 == whoAmI)
					{
						continue;
					}
					Projectile projectile4 = Main.projectile[num827];
					if (!projectile4.active || projectile4.type < 511 || projectile4.type > 513)
					{
						continue;
					}
					Rectangle value10 = new Rectangle((int)projectile4.position.X, (int)projectile4.position.Y, projectile4.width, projectile4.height);
					if (!rectangle4.Intersects(value10))
					{
						continue;
					}
					Vector2 vector97 = projectile4.Center - base.Center;
					if (vector97 == Vector2.Zero)
					{
						if (num827 < whoAmI)
						{
							vector97.X = -1f;
							vector97.Y = 1f;
						}
						else
						{
							vector97.X = 1f;
							vector97.Y = -1f;
						}
					}
					Vector2 vector98 = vector97.SafeNormalize(Vector2.UnitX) * 0.005f;
					velocity = Vector2.Lerp(velocity, velocity - vector98, 0.6f);
					projectile4.velocity = Vector2.Lerp(projectile4.velocity, projectile4.velocity + vector98, 0.6f);
				}
			}
			Vector2 vector99 = velocity.SafeNormalize(Vector2.Zero);
			Vector2 pos = base.Center + vector99 * 16f;
			if (!flag45 && Collision.IsWorldPointSolid(pos, treatPlatformsAsNonSolid: true))
			{
				velocity = Vector2.Lerp(velocity, velocity - vector99 * 1f, 0.5f);
			}
			if (!flag45)
			{
				return;
			}
			int num828 = 20;
			int num829 = 2940;
			float num830 = MathHelper.Clamp(Utils.Remap(fromValue2, 0f, 0.2f, 0f, 1f), 0f, 1f) * 180f;
			if (localAI[1] > 0f)
			{
				localAI[1]--;
			}
			if (!(localAI[1] <= 0f))
			{
				return;
			}
			localAI[1] = 15f;
			if (Main.netMode != 2)
			{
				Player localPlayer = Main.LocalPlayer;
				if (localPlayer.active && !localPlayer.dead && localPlayer.Center.Distance(base.Center) <= num830)
				{
					ApplyBuffTo(localPlayer, num828, num829);
				}
			}
			if (Main.netMode == 1)
			{
				return;
			}
			for (int num831 = 0; num831 < Main.maxNPCs; num831++)
			{
				NPC nPC14 = Main.npc[num831];
				if (nPC14.active && !nPC14.buffImmune[num828] && nPC14.Center.Distance(base.Center) <= num830)
				{
					nPC14.AddBuff(num828, num829);
				}
			}
		}
		else if (aiStyle == 93)
		{
			if (alpha > 0)
			{
				alpha -= 25;
				if (alpha <= 0)
				{
					alpha = 0;
				}
			}
			if (velocity.Y > 18f)
			{
				velocity.Y = 18f;
			}
			if (this.ai[0] == 0f)
			{
				this.ai[1] += 1f;
				if (this.ai[1] > 20f)
				{
					velocity.Y += 0.1f;
					velocity.X *= 0.992f;
				}
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				return;
			}
			tileCollide = false;
			if (this.ai[0] == 1f)
			{
				tileCollide = false;
				velocity *= 0.6f;
			}
			else
			{
				tileCollide = false;
				int num832 = (int)(0f - this.ai[0]);
				num832--;
				base.position = Main.npc[num832].Center - velocity;
				base.position.X -= width / 2;
				base.position.Y -= height / 2;
				if (!Main.npc[num832].active || Main.npc[num832].life < 0)
				{
					tileCollide = true;
					this.ai[0] = 0f;
					this.ai[1] = 20f;
					velocity = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
					velocity.Normalize();
					velocity *= 6f;
					netUpdate = true;
				}
				else if (velocity.Length() > (float)((Main.npc[num832].width + Main.npc[num832].height) / 3))
				{
					velocity *= 0.99f;
				}
			}
			if (this.ai[0] != 0f)
			{
				this.ai[1] += 1f;
				if (this.ai[1] > 90f)
				{
					Kill();
				}
			}
		}
		else if (aiStyle == 94)
		{
			if (++frameCounter >= 4)
			{
				frameCounter = 0;
				if (++frame >= Main.projFrames[type])
				{
					frame = 0;
				}
			}
			this.ai[0]++;
			if (this.ai[0] <= 40f)
			{
				alpha -= 5;
				if (alpha < 0)
				{
					alpha = 0;
				}
				velocity *= 0.85f;
				if (this.ai[0] == 40f)
				{
					netUpdate = true;
					switch (Main.rand.Next(3))
					{
					case 0:
						this.ai[1] = 10f;
						break;
					case 1:
						this.ai[1] = 15f;
						break;
					case 2:
						this.ai[1] = 30f;
						break;
					}
				}
			}
			else if (this.ai[0] <= 60f)
			{
				velocity = Vector2.Zero;
				if (this.ai[0] == 60f)
				{
					netUpdate = true;
				}
			}
			else if (this.ai[0] <= 210f)
			{
				if (Main.netMode != 1 && (localAI[0] += 1f) >= this.ai[1])
				{
					localAI[0] = 0f;
					int num833 = Item.NewItem(GetItemSource_FromThis(), (int)base.Center.X, (int)base.Center.Y, 0, 0, 73);
					Main.item[num833].velocity = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * new Vector2(3f, 2f) * (Main.rand.NextFloat() * 0.5f + 0.5f) - Vector2.UnitY * 1f;
				}
				if (this.ai[0] == 210f)
				{
					netUpdate = true;
				}
			}
			else
			{
				scale -= 1f / 30f;
				alpha += 15;
				if (this.ai[0] == 239f)
				{
					netUpdate = true;
				}
				if (this.ai[0] == 240f)
				{
					Kill();
				}
			}
			if (alpha < 90 && Main.rand.Next(3) == 0)
			{
				Vector2 vector100 = new Vector2(width, height) * scale * 0.85f;
				vector100 /= 2f;
				Vector2 vector101 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * vector100;
				int num834 = Dust.NewDust(base.Center + vector101, 0, 0, 246);
				Main.dust[num834].position = base.Center + vector101;
				Main.dust[num834].velocity = Vector2.Zero;
			}
			float num835 = 0.8f;
			float num836 = 0.70980394f;
			float num837 = 24f / 85f;
			Lighting.AddLight(base.Center, num835 * 0.3f, num836 * 0.3f, num837 * 0.3f);
		}
		else if (aiStyle == 95)
		{
			if (localAI[0] > 2f)
			{
				alpha -= 20;
				if (alpha < 100)
				{
					alpha = 100;
				}
			}
			else
			{
				localAI[0] += 1f;
			}
			if (this.ai[0] > 30f)
			{
				if (velocity.Y > -8f)
				{
					velocity.Y -= 0.05f;
				}
				velocity.X *= 0.98f;
			}
			else
			{
				this.ai[0] += 1f;
			}
			rotation = velocity.X * 0.1f;
			if (wet)
			{
				if (velocity.Y > 0f)
				{
					velocity.Y *= 0.98f;
				}
				if (velocity.Y > -8f)
				{
					velocity.Y -= 0.2f;
				}
				velocity.X *= 0.94f;
			}
		}
		else if (aiStyle == 96)
		{
			this.ai[0] += 0.6f;
			if (this.ai[0] > 500f)
			{
				Kill();
			}
			for (int num838 = 0; num838 < 2; num838++)
			{
				if (Main.rand.Next(3) != 0)
				{
					int num839 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 170, 0f, 0f, 100);
					Main.dust[num839].position = (Main.dust[num839].position + base.Center) / 2f;
					Main.dust[num839].noGravity = true;
					Dust dust2 = Main.dust[num839];
					dust2.velocity *= 0.1f;
					if (num838 == 1)
					{
						dust2 = Main.dust[num839];
						dust2.position += velocity / 2f;
					}
					float num840 = (800f - this.ai[0]) / 800f;
					dust2 = Main.dust[num839];
					dust2.scale *= num840 + 0.1f;
				}
			}
			velocity.Y += 0.008f;
		}
		else if (aiStyle == 97)
		{
			frameCounter++;
			float num841 = 4f;
			if ((float)frameCounter < num841 * 1f)
			{
				frame = 0;
			}
			else if ((float)frameCounter < num841 * 2f)
			{
				frame = 1;
			}
			else if ((float)frameCounter < num841 * 3f)
			{
				frame = 2;
			}
			else if ((float)frameCounter < num841 * 4f)
			{
				frame = 3;
			}
			else if ((float)frameCounter < num841 * 5f)
			{
				frame = 4;
			}
			else if ((float)frameCounter < num841 * 6f)
			{
				frame = 3;
			}
			else if ((float)frameCounter < num841 * 7f)
			{
				frame = 2;
			}
			else if ((float)frameCounter < num841 * 8f)
			{
				frame = 1;
			}
			else
			{
				frameCounter = 0;
				frame = 0;
			}
			Main.CurrentFrameFlags.HadAnActiveInteractibleProjectile = true;
			if (owner == Main.myPlayer)
			{
				for (int num842 = 0; num842 < 1000; num842++)
				{
					if (num842 != whoAmI && Main.projectile[num842].active && Main.projectile[num842].owner == owner && Main.projectile[num842].type == type)
					{
						if (timeLeft >= Main.projectile[num842].timeLeft)
						{
							Main.projectile[num842].Kill();
						}
						else
						{
							Kill();
						}
					}
				}
			}
			if (this.ai[0] == 0f)
			{
				if ((double)velocity.Length() < 0.1)
				{
					velocity.X = 0f;
					velocity.Y = 0f;
					this.ai[0] = 1f;
					this.ai[1] = 45f;
					return;
				}
				velocity *= 0.94f;
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
				spriteDirection = direction;
				return;
			}
			if (Main.player[owner].Center.X < base.Center.X)
			{
				direction = -1;
			}
			else
			{
				direction = 1;
			}
			spriteDirection = direction;
			this.ai[1] += 1f;
			float num843 = 0.005f;
			if (this.ai[1] > 0f)
			{
				velocity.Y -= num843;
			}
			else
			{
				velocity.Y += num843;
			}
			if (this.ai[1] >= 90f)
			{
				this.ai[1] *= -1f;
			}
		}
		else if (aiStyle == 98)
		{
			Vector2 vector102 = new Vector2(this.ai[0], this.ai[1]);
			Vector2 value11 = vector102 - base.Center;
			if (value11.Length() < velocity.Length())
			{
				Kill();
				return;
			}
			value11.Normalize();
			value11 *= 15f;
			velocity = Vector2.Lerp(velocity, value11, 0.1f);
			for (int num844 = 0; num844 < 2; num844++)
			{
				int num845 = Dust.NewDust(base.Center, 0, 0, 228, 0f, 0f, 100);
				Main.dust[num845].noGravity = true;
				Dust dust2 = Main.dust[num845];
				dust2.position += new Vector2(4f);
				dust2 = Main.dust[num845];
				dust2.scale += Main.rand.NextFloat() * 1f;
			}
		}
		else if ((aiStyle == 99 && type >= 556 && type <= 561) || type == 1079)
		{
			AI_099_1_Counterweights();
		}
		else if (aiStyle == 99)
		{
			AI_099_2_Yoyos();
		}
		else if (aiStyle == 100)
		{
			AI_100_Medusa();
		}
		else if (aiStyle == 101)
		{
			float num846 = 20f;
			localAI[0]++;
			alpha = (int)MathHelper.Lerp(0f, 255f, localAI[0] / num846);
			int num847 = (int)this.ai[0];
			int num848 = -1;
			int num849 = -1;
			switch (type)
			{
			case 536:
				num848 = 535;
				num849 = 0;
				break;
			case 591:
				num849 = 1;
				break;
			}
			switch (num849)
			{
			case 1:
				if (localAI[0] >= num846 || num847 < 0 || num847 > 255 || !Main.player[num847].active || Main.player[num847].dead)
				{
					Kill();
					return;
				}
				if (type == 591)
				{
					base.position -= velocity;
					base.position += Main.player[owner].position - Main.player[owner].oldPosition;
					rotation = velocity.ToRotation() + (float)Math.PI / 2f;
					if (Math.Sign(velocity.X) != Math.Sign(Main.player[num847].velocity.X) && Main.player[num847].velocity.X != 0f)
					{
						Kill();
						return;
					}
				}
				else
				{
					base.Center = Main.player[num847].Center - velocity;
				}
				break;
			case 0:
				if (localAI[0] >= num846 || num847 < 0 || num847 > 1000 || !Main.projectile[num847].active || Main.projectile[num847].type != num848)
				{
					Kill();
					return;
				}
				base.Center = Main.projectile[num847].Center - velocity;
				break;
			}
			rotation = velocity.ToRotation() + (float)Math.PI / 2f;
		}
		else if (aiStyle == 102)
		{
			int num850 = 0;
			float num851 = 0f;
			float x7 = 0f;
			float y9 = 0f;
			int num852 = -1;
			int num853 = 0;
			float num854 = 0f;
			bool flag47 = true;
			bool flag48 = false;
			bool flag49 = false;
			switch (type)
			{
			case 539:
				num850 = 407;
				num851 = 210f;
				x7 = 0.15f;
				y9 = 0.075f;
				num854 = 16f;
				break;
			case 573:
				num850 = 424;
				num851 = 90f;
				num854 = 20f;
				flag47 = false;
				flag48 = true;
				break;
			case 574:
				num850 = 420;
				num851 = 180f;
				x7 = 0.15f;
				y9 = 0.075f;
				num854 = 8f;
				flag47 = false;
				num852 = 576;
				num853 = 65;
				if (Main.expertMode)
				{
					num853 = 50;
				}
				flag49 = true;
				break;
			}
			if (flag49)
			{
				int num855 = (int)this.ai[1];
				if (!Main.npc[num855].active || Main.npc[num855].type != num850)
				{
					Kill();
					return;
				}
				timeLeft = 2;
			}
			this.ai[0]++;
			if (this.ai[0] < num851)
			{
				bool flag50 = true;
				int num856 = (int)this.ai[1];
				if (Main.npc[num856].active && Main.npc[num856].type == num850)
				{
					if (!flag48 && Main.npc[num856].oldPos[1] != Vector2.Zero)
					{
						base.position += Main.npc[num856].position - Main.npc[num856].oldPos[1];
					}
				}
				else
				{
					this.ai[0] = num851;
					flag50 = false;
				}
				if (flag50 && !flag48)
				{
					velocity += new Vector2(Math.Sign(Main.npc[num856].Center.X - base.Center.X), Math.Sign(Main.npc[num856].Center.Y - base.Center.Y)) * new Vector2(x7, y9);
					if (velocity.Length() > 6f)
					{
						velocity *= 6f / velocity.Length();
					}
				}
				if (type == 539)
				{
					if (Main.rand.Next(12) == 0)
					{
						int num857 = Dust.NewDust(base.Center, 8, 8, 180);
						Main.dust[num857].position = base.Center;
						Dust dust2 = Main.dust[num857];
						dust2.velocity *= 0.2f;
						Main.dust[num857].noGravity = true;
					}
					if (++frameCounter >= 4)
					{
						frameCounter = 0;
						if (++frame >= Main.projFrames[type])
						{
							frame = 0;
						}
					}
					rotation = velocity.X * 0.1f;
				}
				if (type == 573)
				{
					if (Main.rand.Next(2) == 0)
					{
						int num858 = Dust.NewDust(base.Center, 8, 8, 242);
						Main.dust[num858].position = base.Center;
						Main.dust[num858].velocity = velocity;
						Main.dust[num858].noGravity = true;
						Main.dust[num858].scale = 1.5f;
					}
					alpha = 255;
				}
				if (type == 574)
				{
					if (Main.rand.Next(10) == 0)
					{
						int num859 = Dust.NewDust(base.Center, 8, 8, 242);
						Main.dust[num859].position = base.Center;
						Main.dust[num859].velocity = velocity;
						Main.dust[num859].noGravity = true;
						Main.dust[num859].scale = 1.5f;
					}
					if (flag50)
					{
						int target2 = Main.npc[num856].target;
						float num860 = velocity.ToRotation();
						if (Collision.CanHitLine(base.Center, 0, 0, Main.player[target2].Center, 0, 0))
						{
							num860 = DirectionTo(Main.player[target2].Center).ToRotation();
						}
						rotation = rotation.AngleLerp(num860 + (float)Math.PI / 2f, 0.2f);
					}
					frame = 1;
				}
			}
			if (this.ai[0] == num851)
			{
				bool flag51 = true;
				int num861 = -1;
				if (!flag47)
				{
					int num862 = (int)this.ai[1];
					if (Main.npc[num862].active && Main.npc[num862].type == num850)
					{
						num861 = Main.npc[num862].target;
					}
					else
					{
						flag51 = false;
					}
				}
				else
				{
					flag51 = false;
				}
				if (!flag51)
				{
					num861 = Player.FindClosest(base.position, width, height);
				}
				Vector2 value12 = Main.player[num861].Center - base.Center;
				value12.X += Main.rand.Next(-50, 51);
				value12.Y += Main.rand.Next(-50, 51);
				value12.X *= (float)Main.rand.Next(80, 121) * 0.01f;
				value12.Y *= (float)Main.rand.Next(80, 121) * 0.01f;
				Vector2 vector103 = Vector2.Normalize(value12);
				if (vector103.HasNaNs())
				{
					vector103 = Vector2.UnitY;
				}
				if (num852 == -1)
				{
					velocity = vector103 * num854;
					netUpdate = true;
				}
				else
				{
					if (Main.netMode != 1 && Collision.CanHitLine(base.Center, 0, 0, Main.player[num861].Center, 0, 0))
					{
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector103.X * num854, vector103.Y * num854, num852, num853, 1f, Main.myPlayer);
					}
					this.ai[0] = 0f;
				}
			}
			if (!(this.ai[0] >= num851))
			{
				return;
			}
			rotation = rotation.AngleLerp(velocity.ToRotation() + (float)Math.PI / 2f, 0.4f);
			if (type == 539)
			{
				if (++frameCounter >= 2)
				{
					frameCounter = 0;
					if (++frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
				if (Main.rand.Next(2) == 0)
				{
					int num863 = Dust.NewDust(base.position, width, height, 180, 0f, 0f, 100);
					Dust dust2 = Main.dust[num863];
					dust2.scale += (float)Main.rand.Next(50) * 0.01f;
					Main.dust[num863].noGravity = true;
					dust2 = Main.dust[num863];
					dust2.velocity *= 0.1f;
					Main.dust[num863].fadeIn = Main.rand.NextFloat() * 1.5f;
				}
				if (Main.rand.Next(3) == 0)
				{
					int num864 = Dust.NewDust(base.position, width, height, 176, 0f, 0f, 100);
					Dust dust2 = Main.dust[num864];
					dust2.scale += 0.3f + (float)Main.rand.Next(50) * 0.01f;
					Main.dust[num864].noGravity = true;
					dust2 = Main.dust[num864];
					dust2.velocity *= 0.1f;
					Main.dust[num864].fadeIn = Main.rand.NextFloat() * 1.5f;
				}
			}
			if (type == 573)
			{
				if (Main.rand.Next(4) == 0)
				{
					int num865 = Dust.NewDust(base.Center, 8, 8, 242);
					Main.dust[num865].position = base.Center;
					Dust dust2 = Main.dust[num865];
					dust2.velocity *= 0.2f;
					Main.dust[num865].noGravity = true;
					Main.dust[num865].scale = 1.5f;
				}
				alpha = 0;
			}
		}
		else if (aiStyle == 103)
		{
			scale = this.ai[1];
			this.ai[0]++;
			if (this.ai[0] >= 30f)
			{
				alpha += 25;
				if (alpha >= 250)
				{
					Kill();
				}
			}
			else
			{
				if (!(this.ai[0] >= 0f))
				{
					return;
				}
				alpha -= 25;
				if (alpha < 0)
				{
					alpha = 0;
					if (localAI[1] == 0f && Main.netMode != 1 && localAI[0] != 0f)
					{
						localAI[1] = 1f;
						NPC.NewNPC(GetNPCSource_FromThis(), (int)base.Center.X, (int)base.Bottom.Y, (int)localAI[0]);
					}
				}
			}
		}
		else if (aiStyle == 104)
		{
			if (this.ai[0] == 1f)
			{
				scale *= 0.995f;
				alpha += 3;
				if (alpha >= 250)
				{
					Kill();
				}
			}
			else
			{
				scale *= 1.01f;
				alpha -= 7;
				if (alpha < 0)
				{
					alpha = 0;
					this.ai[0] = 1f;
				}
			}
			frameCounter++;
			if (frameCounter > 6)
			{
				frameCounter = 0;
				frame++;
				if (frame > 3)
				{
					frame = 0;
				}
			}
			velocity.Y -= 0.03f;
			velocity.X *= 0.97f;
		}
		else if (aiStyle == 105)
		{
			AI_105_SporeSac();
		}
		else if (aiStyle == 106)
		{
			rotation += velocity.X * 0.02f;
			if (velocity.X < 0f)
			{
				rotation -= Math.Abs(velocity.Y) * 0.02f;
			}
			else
			{
				rotation += Math.Abs(velocity.Y) * 0.02f;
			}
			velocity *= 0.98f;
			this.ai[0] += 1f;
			if (this.ai[0] >= 60f)
			{
				if (alpha < 255)
				{
					alpha += 5;
					if (alpha > 255)
					{
						alpha = 255;
					}
				}
				else if (owner == Main.myPlayer)
				{
					Kill();
				}
			}
			else if (alpha > 80)
			{
				alpha -= 30;
				if (alpha < 80)
				{
					alpha = 80;
				}
			}
		}
		else if (aiStyle == 107)
		{
			float num866 = 10f;
			float num867 = 5f;
			float num868 = 40f;
			if (type == 575)
			{
				if (timeLeft > 30 && alpha > 0)
				{
					alpha -= 25;
				}
				if (timeLeft > 30 && alpha < 128 && Collision.SolidCollision(base.position, width, height))
				{
					alpha = 128;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (++frameCounter > 4)
				{
					frameCounter = 0;
					if (++frame >= 4)
					{
						frame = 0;
					}
				}
				Lighting.AddLight(base.Center, 0.5f, 0.1f, 0.3f);
			}
			else if (type == 596)
			{
				num866 = 10f;
				num867 = 7.5f;
				if (timeLeft > 30 && alpha > 0)
				{
					alpha -= 25;
				}
				if (timeLeft > 30 && alpha < 128 && Collision.SolidCollision(base.position, width, height))
				{
					alpha = 128;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (++frameCounter > 4)
				{
					frameCounter = 0;
					if (++frame >= 4)
					{
						frame = 0;
					}
				}
				float num869 = 0.5f;
				if (timeLeft < 120)
				{
					num869 = 1.1f;
				}
				if (timeLeft < 60)
				{
					num869 = 1.6f;
				}
				this.ai[1]++;
				float num870 = this.ai[1] / 180f * ((float)Math.PI * 2f);
				for (float num871 = 0f; num871 < 3f; num871++)
				{
					if (Main.rand.Next(3) != 0)
					{
						return;
					}
					Dust dust24 = Main.dust[Dust.NewDust(base.Center, 0, 0, 27, 0f, -2f)];
					dust24.position = base.Center + Vector2.UnitY.RotatedBy(num871 * ((float)Math.PI * 2f) / 3f + this.ai[1]) * 10f;
					dust24.noGravity = true;
					dust24.velocity = DirectionFrom(dust24.position);
					dust24.scale = num869;
					dust24.fadeIn = 0.5f;
					dust24.alpha = 200;
				}
				if (timeLeft < 4)
				{
					int num872 = 30;
					if (Main.expertMode)
					{
						num872 = 22;
					}
					base.position = base.Center;
					width = (height = 60);
					base.Center = base.position;
					damage = num872;
					for (int num873 = 0; num873 < 10; num873++)
					{
						Dust dust24 = Main.dust[Dust.NewDust(base.position, width, height, Utils.SelectRandom<int>(Main.rand, 27, 6), 0f, -2f)];
						dust24.noGravity = true;
						if (dust24.position != base.Center)
						{
							dust24.velocity = DirectionTo(dust24.position) * 3f;
						}
					}
				}
			}
			int num874 = (int)this.ai[0];
			if (num874 >= 0 && Main.player[num874].active && !Main.player[num874].dead)
			{
				if (Distance(Main.player[num874].Center) > num868)
				{
					Vector2 vector104 = DirectionTo(Main.player[num874].Center);
					if (vector104.HasNaNs())
					{
						vector104 = Vector2.UnitY;
					}
					velocity = (velocity * (num866 - 1f) + vector104 * num867) / num866;
				}
			}
			else
			{
				if (timeLeft > 30)
				{
					timeLeft = 30;
				}
				if (this.ai[0] != -1f)
				{
					this.ai[0] = -1f;
					netUpdate = true;
				}
			}
		}
		else if (aiStyle == 108)
		{
			bool flag52 = type == 579 || type == 578;
			if (flag52 && this.ai[1] == 1f && Main.netMode != 2)
			{
				this.ai[1] = 0f;
				for (int num875 = 0; num875 < 25; num875++)
				{
					int num876 = Utils.SelectRandom<int>(Main.rand, 229, 229, 161);
					Dust dust25 = Main.dust[Dust.NewDust(base.position, width, height, num876)];
					dust25.noGravity = true;
					dust25.scale = 1.75f + Main.rand.NextFloat() * 1.25f;
					dust25.fadeIn = 0.25f;
					Dust dust2 = dust25;
					dust2.velocity *= 3.5f + Main.rand.NextFloat() * 0.5f;
					dust25.noLight = true;
				}
			}
			if (flag52 && localAI[1] == 0f)
			{
				localAI[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item117, base.position);
			}
			if (type == 578 && localAI[0] == 0f)
			{
				localAI[0] = 1f;
				int num877 = Player.FindClosest(base.Center, 0, 0);
				Vector2 vector105 = Main.player[num877].Center - base.Center;
				if (vector105 == Vector2.Zero)
				{
					vector105 = Vector2.UnitY;
				}
				this.ai[1] = vector105.ToRotation();
				netUpdate = true;
			}
			this.ai[0]++;
			if (this.ai[0] <= 50f)
			{
				if (type == 579)
				{
					if (Main.rand.Next(4) == 0)
					{
						Vector2 vector106 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust26 = Main.dust[Dust.NewDust(base.Center - vector106 * 30f, 0, 0, 229)];
						dust26.noGravity = true;
						dust26.position = base.Center - vector106 * Main.rand.Next(10, 21);
						dust26.velocity = vector106.RotatedBy(1.5707963705062866) * 4f;
						dust26.scale = 0.5f + Main.rand.NextFloat();
						dust26.fadeIn = 0.5f;
					}
					if (Main.rand.Next(4) == 0)
					{
						Vector2 vector107 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust27 = Main.dust[Dust.NewDust(base.Center - vector107 * 30f, 0, 0, 240)];
						dust27.noGravity = true;
						dust27.position = base.Center - vector107 * 30f;
						dust27.velocity = vector107.RotatedBy(-1.5707963705062866) * 2f;
						dust27.scale = 0.5f + Main.rand.NextFloat();
						dust27.fadeIn = 0.5f;
					}
				}
				if (type == 578 && Main.rand.Next(2) == 0)
				{
					Vector2 vector108 = this.ai[1].ToRotationVector2();
					Vector2 vector109 = vector108.RotatedBy(1.5707963705062866) * (Main.rand.Next(2) == 0).ToDirectionInt() * Main.rand.Next(10, 21);
					Vector2 vector110 = vector108 * Main.rand.Next(-80, 81);
					Vector2 vector111 = vector110 - vector109;
					vector111 /= 10f;
					int num878 = 229;
					Dust dust28 = Main.dust[Dust.NewDust(base.Center, 0, 0, num878)];
					dust28.noGravity = true;
					dust28.position = base.Center + vector109;
					dust28.velocity = vector111;
					dust28.scale = 0.5f + Main.rand.NextFloat();
					dust28.fadeIn = 0.5f;
					vector110 = vector108 * Main.rand.Next(40, 121);
					vector111 = vector110 - vector109 / 2f;
					vector111 /= 10f;
					dust28 = Main.dust[Dust.NewDust(base.Center, 0, 0, num878)];
					dust28.noGravity = true;
					dust28.position = base.Center + vector109 / 2f;
					dust28.velocity = vector111;
					dust28.scale = 1f + Main.rand.NextFloat();
				}
				if (type == 813)
				{
					if (Main.rand.Next(4) == 0)
					{
						Vector2 vector112 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust29 = Main.dust[Dust.NewDust(base.Center - vector112 * 30f, 0, 0, 5)];
						dust29.noGravity = true;
						dust29.position = base.Center - vector112 * Main.rand.Next(10, 21);
						dust29.velocity = vector112.RotatedBy(1.5707963705062866) * 4f;
						dust29.scale = 0.5f + Main.rand.NextFloat();
						dust29.fadeIn = 0.5f;
					}
					if (Main.rand.Next(4) == 0)
					{
						Vector2 vector113 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust30 = Main.dust[Dust.NewDust(base.Center - vector113 * 30f, 0, 0, 240)];
						dust30.noGravity = true;
						dust30.position = base.Center - vector113 * 30f;
						dust30.velocity = vector113.RotatedBy(-1.5707963705062866) * 2f;
						dust30.scale = 0.5f + Main.rand.NextFloat();
						dust30.fadeIn = 0.5f;
					}
				}
			}
			else if (this.ai[0] <= 90f)
			{
				if (this.ai[0] == 90f)
				{
					if (flag52)
					{
						SoundEngine.PlaySound(SoundID.Item113, base.position);
					}
					else
					{
						SoundEngine.PlaySound(SoundID.Item8, base.position);
					}
				}
				scale = (this.ai[0] - 50f) / 40f;
				alpha = 255 - (int)(255f * scale);
				rotation -= (float)Math.PI / 20f;
				if (type == 579)
				{
					if (Main.rand.Next(2) == 0)
					{
						Vector2 vector114 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust31 = Main.dust[Dust.NewDust(base.Center - vector114 * 30f, 0, 0, 229)];
						dust31.noGravity = true;
						dust31.position = base.Center - vector114 * Main.rand.Next(10, 21);
						dust31.velocity = vector114.RotatedBy(1.5707963705062866) * 6f;
						dust31.scale = 0.5f + Main.rand.NextFloat();
						dust31.fadeIn = 0.5f;
						dust31.customData = base.Center;
					}
					if (Main.rand.Next(2) == 0)
					{
						Vector2 vector115 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust32 = Main.dust[Dust.NewDust(base.Center - vector115 * 30f, 0, 0, 240)];
						dust32.noGravity = true;
						dust32.position = base.Center - vector115 * 30f;
						dust32.velocity = vector115.RotatedBy(-1.5707963705062866) * 3f;
						dust32.scale = 0.5f + Main.rand.NextFloat();
						dust32.fadeIn = 0.5f;
						dust32.customData = base.Center;
					}
				}
				if (type == 578)
				{
					Vector2 vector116 = this.ai[1].ToRotationVector2();
					Vector2 vector117 = vector116.RotatedBy(1.5707963705062866) * (Main.rand.Next(2) == 0).ToDirectionInt() * Main.rand.Next(10, 21);
					vector116 *= (float)Main.rand.Next(-80, 81);
					Vector2 vector118 = vector116 - vector117;
					vector118 /= 10f;
					int num879 = Utils.SelectRandom<int>(Main.rand, 229, 229);
					Dust dust33 = Main.dust[Dust.NewDust(base.Center, 0, 0, num879)];
					dust33.noGravity = true;
					dust33.position = base.Center + vector117;
					dust33.velocity = vector118;
					dust33.scale = 0.5f + Main.rand.NextFloat();
					dust33.fadeIn = 0.5f;
					if (this.ai[0] == 90f && Main.netMode != 1)
					{
						Vector2 vector119 = this.ai[1].ToRotationVector2() * 8f;
						float ai2 = Main.rand.Next(80);
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X - vector119.X, base.Center.Y - vector119.Y, vector119.X, vector119.Y, 580, 50, 1f, Main.myPlayer, this.ai[1], ai2);
					}
				}
				else if (type == 579)
				{
					if (this.ai[0] == 90f && Main.netMode != 1)
					{
						this.ai[1] = 1f;
						netUpdate = true;
						for (int num880 = 0; num880 < 2; num880++)
						{
							int num881 = NPC.NewNPC(GetNPCSource_FromThis(), (int)base.Center.X, (int)base.Center.Y, 427, whoAmI);
							Main.npc[num881].velocity = -Vector2.UnitY.RotatedByRandom(6.2831854820251465) * Main.rand.Next(4, 9) - Vector2.UnitY * 2f;
							Main.npc[num881].netUpdate = true;
						}
					}
				}
				else if (type == 813)
				{
					if (Main.rand.Next(2) == 0)
					{
						Vector2 vector120 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust34 = Main.dust[Dust.NewDust(base.Center - vector120 * 30f, 0, 0, 5)];
						dust34.noGravity = true;
						dust34.position = base.Center - vector120 * Main.rand.Next(10, 21);
						dust34.velocity = vector120.RotatedBy(1.5707963705062866) * 6f;
						dust34.scale = 0.5f + Main.rand.NextFloat();
						dust34.fadeIn = 0.5f;
						dust34.customData = base.Center;
					}
					if (Main.rand.Next(2) == 0)
					{
						Vector2 vector121 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust35 = Main.dust[Dust.NewDust(base.Center - vector121 * 30f, 0, 0, 240)];
						dust35.noGravity = true;
						dust35.position = base.Center - vector121 * 30f;
						dust35.velocity = vector121.RotatedBy(-1.5707963705062866) * 3f;
						dust35.scale = 0.5f + Main.rand.NextFloat();
						dust35.fadeIn = 0.5f;
						dust35.customData = base.Center;
					}
					if (this.ai[0] == 90f && Main.netMode != 1)
					{
						int num882 = NPC.NewNPC(GetNPCSource_FromThis(), (int)base.Center.X, (int)base.Center.Y, 619, whoAmI);
						Main.npc[num882].netUpdate = true;
					}
				}
			}
			else if (this.ai[0] <= 120f)
			{
				scale = 1f;
				alpha = 0;
				rotation -= (float)Math.PI / 60f;
				if (type == 813)
				{
					if (Main.rand.Next(2) == 0)
					{
						Vector2 vector122 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust36 = Main.dust[Dust.NewDust(base.Center - vector122 * 30f, 0, 0, 5)];
						dust36.noGravity = true;
						dust36.position = base.Center - vector122 * Main.rand.Next(10, 21);
						dust36.velocity = vector122.RotatedBy(1.5707963705062866) * 6f;
						dust36.scale = 0.5f + Main.rand.NextFloat();
						dust36.fadeIn = 0.5f;
						dust36.customData = base.Center;
					}
					else
					{
						Vector2 vector123 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust37 = Main.dust[Dust.NewDust(base.Center - vector123 * 30f, 0, 0, 240)];
						dust37.noGravity = true;
						dust37.position = base.Center - vector123 * 30f;
						dust37.velocity = vector123.RotatedBy(-1.5707963705062866) * 3f;
						dust37.scale = 0.5f + Main.rand.NextFloat();
						dust37.fadeIn = 0.5f;
						dust37.customData = base.Center;
					}
				}
				else if (Main.rand.Next(2) == 0)
				{
					Vector2 vector124 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
					Dust dust38 = Main.dust[Dust.NewDust(base.Center - vector124 * 30f, 0, 0, 229)];
					dust38.noGravity = true;
					dust38.position = base.Center - vector124 * Main.rand.Next(10, 21);
					dust38.velocity = vector124.RotatedBy(1.5707963705062866) * 6f;
					dust38.scale = 0.5f + Main.rand.NextFloat();
					dust38.fadeIn = 0.5f;
					dust38.customData = base.Center;
				}
				else
				{
					Vector2 vector125 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
					Dust dust39 = Main.dust[Dust.NewDust(base.Center - vector125 * 30f, 0, 0, 240)];
					dust39.noGravity = true;
					dust39.position = base.Center - vector125 * 30f;
					dust39.velocity = vector125.RotatedBy(-1.5707963705062866) * 3f;
					dust39.scale = 0.5f + Main.rand.NextFloat();
					dust39.fadeIn = 0.5f;
					dust39.customData = base.Center;
				}
			}
			else
			{
				scale = 1f - (this.ai[0] - 120f) / 60f;
				alpha = 255 - (int)(255f * scale);
				rotation -= (float)Math.PI / 30f;
				if (alpha >= 255)
				{
					Kill();
				}
				if (type == 813)
				{
					for (int num883 = 0; num883 < 2; num883++)
					{
						switch (Main.rand.Next(3))
						{
						case 0:
						{
							Vector2 vector127 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * scale;
							Dust dust41 = Main.dust[Dust.NewDust(base.Center - vector127 * 30f, 0, 0, 5)];
							dust41.noGravity = true;
							dust41.position = base.Center - vector127 * Main.rand.Next(10, 21);
							dust41.velocity = vector127.RotatedBy(1.5707963705062866) * 6f;
							dust41.scale = 0.5f + Main.rand.NextFloat();
							dust41.fadeIn = 0.5f;
							dust41.customData = base.Center;
							break;
						}
						case 1:
						{
							Vector2 vector126 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * scale;
							Dust dust40 = Main.dust[Dust.NewDust(base.Center - vector126 * 30f, 0, 0, 240)];
							dust40.noGravity = true;
							dust40.position = base.Center - vector126 * 30f;
							dust40.velocity = vector126.RotatedBy(-1.5707963705062866) * 3f;
							dust40.scale = 0.5f + Main.rand.NextFloat();
							dust40.fadeIn = 0.5f;
							dust40.customData = base.Center;
							break;
						}
						}
					}
				}
				else
				{
					for (int num884 = 0; num884 < 2; num884++)
					{
						switch (Main.rand.Next(3))
						{
						case 0:
						{
							Vector2 vector129 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * scale;
							Dust dust43 = Main.dust[Dust.NewDust(base.Center - vector129 * 30f, 0, 0, 229)];
							dust43.noGravity = true;
							dust43.position = base.Center - vector129 * Main.rand.Next(10, 21);
							dust43.velocity = vector129.RotatedBy(1.5707963705062866) * 6f;
							dust43.scale = 0.5f + Main.rand.NextFloat();
							dust43.fadeIn = 0.5f;
							dust43.customData = base.Center;
							break;
						}
						case 1:
						{
							Vector2 vector128 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * scale;
							Dust dust42 = Main.dust[Dust.NewDust(base.Center - vector128 * 30f, 0, 0, 240)];
							dust42.noGravity = true;
							dust42.position = base.Center - vector128 * 30f;
							dust42.velocity = vector128.RotatedBy(-1.5707963705062866) * 3f;
							dust42.scale = 0.5f + Main.rand.NextFloat();
							dust42.fadeIn = 0.5f;
							dust42.customData = base.Center;
							break;
						}
						}
					}
				}
			}
			if (type == 813 && Main.rand.NextFloat() < Opacity)
			{
				Dust dust44 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(3f, 20f), 90);
				dust44.velocity = Vector2.UnitY;
				dust44.noGravity = true;
				dust44.scale = scale;
			}
		}
		else if (aiStyle == 109)
		{
			if (localAI[1] == 0f)
			{
				localAI[1] = velocity.Length();
			}
			if (this.ai[0] == 0f)
			{
				localAI[0]++;
				if (localAI[0] > 30f)
				{
					this.ai[0] = 1f;
					localAI[0] = 0f;
					return;
				}
			}
			else if (this.ai[0] == 1f)
			{
				Vector2 zero4 = Vector2.Zero;
				if (type != 582 || !Main.npc[(int)this.ai[1]].active || Main.npc[(int)this.ai[1]].type != 124)
				{
					Kill();
					return;
				}
				NPC.lazyNPCOwnedProjectileSearchArray[(int)this.ai[1]] = whoAmI;
				zero4 = Main.npc[(int)this.ai[1]].Center;
				tileCollide = false;
				float num885 = localAI[1];
				Vector2 value13 = zero4 - base.Center;
				if (value13.Length() < num885)
				{
					Kill();
					return;
				}
				value13.Normalize();
				value13 *= num885;
				velocity = Vector2.Lerp(velocity, value13, 0.04f);
			}
			rotation += (float)Math.PI / 10f;
		}
		else if (aiStyle == 110)
		{
			if (localAI[1] == 0f)
			{
				localAI[1] = velocity.Length();
			}
			Vector2 zero5 = Vector2.Zero;
			if (Main.npc[(int)this.ai[0]].active && Main.npc[(int)this.ai[0]].townNPC)
			{
				zero5 = Main.npc[(int)this.ai[0]].Center;
				float num886 = localAI[1];
				Vector2 value14 = zero5 - base.Center;
				if (value14.Length() < num886 || base.Hitbox.Intersects(Main.npc[(int)this.ai[0]].Hitbox))
				{
					Kill();
					int num887 = Main.npc[(int)this.ai[0]].lifeMax - Main.npc[(int)this.ai[0]].life;
					if (num887 > 20)
					{
						num887 = 20;
					}
					if (num887 > 0)
					{
						NPC nPC15 = Main.npc[(int)this.ai[0]];
						nPC15.life += num887;
						Main.npc[(int)this.ai[0]].HealEffect(num887);
					}
				}
				else
				{
					value14.Normalize();
					value14 *= num886;
					if (value14.Y < velocity.Y)
					{
						value14.Y = velocity.Y;
					}
					value14.Y += 1f;
					velocity = Vector2.Lerp(velocity, value14, 0.04f);
					rotation += velocity.X * 0.05f;
				}
			}
			else
			{
				Kill();
			}
		}
		else if (aiStyle == 111)
		{
			AI_111_DryadsWard();
		}
		else if (aiStyle == 112)
		{
			if (type == 836)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					for (int num888 = 0; num888 < 3; num888++)
					{
						int num889 = Dust.NewDust(base.position, width, height, 31, 0f, 0f, 50, Color.White, 1.2f);
						Dust dust2 = Main.dust[num889];
						dust2.velocity *= 0.3f;
						Main.dust[num889].noGravity = true;
					}
				}
				if (++frameCounter >= 6)
				{
					frameCounter = 0;
					if (++frame >= 4)
					{
						frame = 0;
					}
				}
				Player player11 = Main.player[(int)this.ai[1]];
				bool flag53 = player11.active && !player11.dead && Vector2.Distance(player11.Center, base.Center) < 800f;
				int num890 = (spriteDirection = ((Main.WindForVisuals > 0f) ? 1 : (-1)));
				direction = ((player11.Center.X > base.Center.X) ? 1 : (-1));
				bool flag54 = num890 != direction;
				float num891 = 2.5f;
				float num892 = 2f;
				if (flag54)
				{
					num891 = 1.5f;
					num892 = 1f;
				}
				if (flag53)
				{
					if (!flag54)
					{
						float num893 = player11.Center.X - base.Center.X;
						velocity.X += 0.05f * (float)direction * (0.6f + Math.Abs(Main.WindForVisuals));
						if (velocity.X > num891)
						{
							velocity.X -= 0.1f;
						}
						if (velocity.X < 0f - num891)
						{
							velocity.X += 0.1f;
						}
					}
					if (player11.Top.Y >= base.Center.Y || flag54)
					{
						velocity.Y += 0.05f;
						if (velocity.Y > num891)
						{
							velocity.Y -= 0.1f;
						}
					}
					else if (player11.Top.Y < base.Center.Y)
					{
						velocity.Y -= 0.1f;
						if (velocity.Y < 0f - num892)
						{
							velocity.Y += 0.2f;
						}
					}
				}
				else
				{
					velocity.Y += 0.2f;
					if (velocity.Y < 0f - num892)
					{
						velocity.Y += 0.2f;
					}
					if (velocity.Y > num892)
					{
						velocity.Y -= 0.2f;
					}
				}
				rotation = velocity.X * 0.125f;
			}
			if (type == 590)
			{
				if (++frameCounter >= 4)
				{
					int num894 = 0;
					int num895 = 3;
					if (this.ai[2] == 1f)
					{
						num894 = 3;
						num895 = 6;
					}
					frameCounter = 0;
					if (++frame >= num895)
					{
						frame = num894;
					}
				}
				if (alpha > 0)
				{
					alpha -= 15;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (alpha == 0)
				{
					float num896 = (float)Main.rand.Next(28, 42) * 0.005f;
					num896 += (float)(270 - Main.mouseTextColor) / 500f;
					float num897 = 0.1f;
					float num898 = 0.3f + num896 / 2f;
					float num899 = 0.6f + num896;
					float num900 = 0.35f;
					num897 *= num900;
					num898 *= num900;
					num899 *= num900;
					Lighting.AddLight(base.Center, num897, num898, num899);
				}
				velocity = new Vector2(0f, (float)Math.Sin((float)Math.PI * 2f * this.ai[0] / 180f) * 0.15f);
				this.ai[0]++;
				if (this.ai[0] >= 180f)
				{
					this.ai[0] = 0f;
				}
			}
			if (type != 644)
			{
				return;
			}
			Color newColor3 = Main.hslToRgb(this.ai[0], 1f, 0.5f);
			int num901 = (int)this.ai[1];
			if (num901 < 0 || num901 >= 1000 || (!Main.projectile[num901].active && Main.projectile[num901].type != 643))
			{
				this.ai[1] = -1f;
			}
			else
			{
				DelegateMethods.v3_1 = newColor3.ToVector3() * 0.5f;
				Utils.PlotTileLine(base.Center, Main.projectile[num901].Center, 8f, DelegateMethods.CastLight);
			}
			if (localAI[0] == 0f)
			{
				localAI[0] = Main.rand.NextFloat() * 0.8f + 0.8f;
				direction = ((Main.rand.Next(2) > 0) ? 1 : (-1));
			}
			rotation = localAI[1] / 40f * ((float)Math.PI * 2f) * (float)direction;
			if (alpha > 0)
			{
				alpha -= 8;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (alpha == 0)
			{
				Lighting.AddLight(base.Center, newColor3.ToVector3() * 0.5f);
			}
			for (int num902 = 0; num902 < 2; num902++)
			{
				if (Main.rand.Next(10) == 0)
				{
					Vector2 vector130 = Vector2.UnitY.RotatedBy((float)num902 * (float)Math.PI).RotatedBy(rotation);
					Dust dust45 = Main.dust[Dust.NewDust(base.Center, 0, 0, 267, 0f, 0f, 225, newColor3, 1.5f)];
					dust45.noGravity = true;
					dust45.noLight = true;
					dust45.scale = Opacity * localAI[0];
					dust45.position = base.Center;
					dust45.velocity = vector130 * 2.5f;
				}
			}
			for (int num903 = 0; num903 < 2; num903++)
			{
				if (Main.rand.Next(10) == 0)
				{
					Vector2 vector131 = Vector2.UnitY.RotatedBy((float)num903 * (float)Math.PI);
					Dust dust46 = Main.dust[Dust.NewDust(base.Center, 0, 0, 267, 0f, 0f, 225, newColor3, 1.5f)];
					dust46.noGravity = true;
					dust46.noLight = true;
					dust46.scale = Opacity * localAI[0];
					dust46.position = base.Center;
					dust46.velocity = vector131 * 2.5f;
				}
			}
			if (Main.rand.Next(10) == 0)
			{
				float num904 = 1f + Main.rand.NextFloat() * 2f;
				float fadeIn = 1f + Main.rand.NextFloat();
				float num905 = 1f + Main.rand.NextFloat();
				Vector2 vector132 = Utils.RandomVector2(Main.rand, -1f, 1f);
				if (vector132 != Vector2.Zero)
				{
					vector132.Normalize();
				}
				vector132 *= 20f + Main.rand.NextFloat() * 100f;
				Vector2 vec = base.Center + vector132;
				Point point4 = vec.ToTileCoordinates();
				bool flag55 = true;
				if (!WorldGen.InWorld(point4.X, point4.Y))
				{
					flag55 = false;
				}
				if (flag55 && WorldGen.SolidTile(point4.X, point4.Y))
				{
					flag55 = false;
				}
				if (flag55)
				{
					Dust dust47 = Main.dust[Dust.NewDust(vec, 0, 0, 267, 0f, 0f, 127, newColor3)];
					dust47.noGravity = true;
					dust47.position = vec;
					dust47.velocity = -Vector2.UnitY * num904 * (Main.rand.NextFloat() * 0.9f + 1.6f);
					dust47.fadeIn = fadeIn;
					dust47.scale = num905;
					dust47.noLight = true;
					if (dust47.dustIndex != 6000)
					{
						Dust dust48 = Dust.CloneDust(dust47);
						Dust dust2 = dust48;
						dust2.scale *= 0.65f;
						dust2 = dust48;
						dust2.fadeIn *= 0.65f;
						dust48.color = new Color(255, 255, 255, 255);
					}
				}
			}
			scale = Opacity / 2f * localAI[0];
			velocity = Vector2.Zero;
			localAI[1]++;
			if (localAI[1] >= 60f)
			{
				Kill();
			}
			if (localAI[1] == 30f)
			{
				DoRainbowCrystalStaffExplosion();
				if (Main.myPlayer == owner)
				{
					friendly = true;
					int num906 = width;
					int num907 = height;
					int num908 = penetrate;
					base.position = base.Center;
					width = (height = 60);
					base.Center = base.position;
					penetrate = -1;
					maxPenetrate = -1;
					Damage();
					penetrate = num908;
					base.position = base.Center;
					width = num906;
					height = num907;
					base.Center = base.position;
					friendly = false;
				}
			}
		}
		else if (aiStyle == 113)
		{
			AI_113_TargetSticker();
		}
		else if (aiStyle == 114)
		{
			if (Main.netMode == 2 && localAI[0] == 0f)
			{
				PortalHelper.SyncPortalSections(base.Center, 1);
				localAI[0] = 1f;
			}
			timeLeft = 3;
			bool flag56 = false;
			if (owner != 255 && (!Main.player[owner].active || Main.player[owner].dead || Distance(Main.player[owner].Center) > 12800f))
			{
				flag56 = true;
			}
			if (!flag56 && !WorldGen.InWorld((int)base.Center.X / 16, (int)base.Center.Y / 16, 40))
			{
				flag56 = true;
			}
			if (!flag56 && !PortalHelper.SupportedTilesAreFine(base.Center, this.ai[0]))
			{
				flag56 = true;
			}
			if (flag56)
			{
				Kill();
				return;
			}
			Color portalColor = PortalHelper.GetPortalColor(owner, (int)this.ai[1]);
			alpha -= 25;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (alpha == 0)
			{
				Lighting.AddLight(base.Center + velocity * 3f, portalColor.ToVector3() * 0.5f);
			}
			if (++frameCounter >= 6)
			{
				frameCounter = 0;
				if (++frame >= Main.projFrames[type])
				{
					frame = 0;
				}
			}
			rotation = this.ai[0] - (float)Math.PI / 2f;
		}
		else if (aiStyle == 115)
		{
			Lighting.AddLight(base.Center, new Vector3(0.075f, 0.3f, 0.15f));
			velocity *= 0.985f;
			rotation += velocity.X * 0.2f;
			if (velocity.X > 0f)
			{
				rotation += 0.08f;
			}
			else
			{
				rotation -= 0.08f;
			}
			this.ai[1] += 1f;
			if (this.ai[1] > 30f)
			{
				alpha += 10;
				if (alpha >= 255)
				{
					alpha = 255;
					Kill();
				}
			}
		}
		else if (aiStyle == 116)
		{
			if (localAI[0] == 0f)
			{
				rotation = this.ai[1];
				localAI[0] = 1f;
			}
			Player player12 = Main.player[owner];
			if (player12.setSolar)
			{
				timeLeft = 2;
			}
			float angle = (float)player12.miscCounter / 300f * ((float)Math.PI * 4f) + this.ai[1];
			angle = MathHelper.WrapAngle(angle);
			rotation = rotation.AngleLerp(angle, 0.05f);
			alpha -= 15;
			if (alpha < 0)
			{
				alpha = 0;
			}
			velocity = rotation.ToRotationVector2() * 100f - player12.velocity;
			base.Center = player12.Center - velocity;
		}
		else if (aiStyle == 117)
		{
			bool flag57 = type == 612 || type == 953 || type == 978;
			bool flag58 = type == 624;
			bool flag59 = type == 1044;
			this.ai[1] += 0.01f;
			scale = this.ai[1];
			this.ai[0]++;
			if (this.ai[0] >= (float)(3 * Main.projFrames[type]))
			{
				Kill();
				return;
			}
			if (++frameCounter >= 3)
			{
				frameCounter = 0;
				if (++frame >= Main.projFrames[type])
				{
					hide = true;
				}
			}
			alpha -= 63;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (flag57)
			{
				Lighting.AddLight(base.Center, 0.9f, 0.8f, 0.6f);
			}
			if (this.ai[0] != 1f)
			{
				return;
			}
			int num909 = 52;
			if (flag59)
			{
				num909 = 52;
			}
			base.position = base.Center;
			width = (height = (int)((float)num909 * scale));
			base.Center = base.position;
			Damage();
			if (flag57)
			{
				SoundEngine.PlaySound(SoundID.Item14, base.position);
				for (int num910 = 0; num910 < 4; num910++)
				{
					int num911 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num911].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				}
				for (int num912 = 0; num912 < 10; num912++)
				{
					int num913 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 200, default(Color), 2.7f);
					Main.dust[num913].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Main.dust[num913].noGravity = true;
					Dust dust2 = Main.dust[num913];
					dust2.velocity *= 3f;
					num913 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num913].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					dust2 = Main.dust[num913];
					dust2.velocity *= 2f;
					Main.dust[num913].noGravity = true;
					Main.dust[num913].fadeIn = 2.5f;
				}
				for (int num914 = 0; num914 < 5; num914++)
				{
					int num915 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 0, default(Color), 2.7f);
					Main.dust[num915].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num915].noGravity = true;
					Dust dust2 = Main.dust[num915];
					dust2.velocity *= 3f;
				}
				for (int num916 = 0; num916 < 10; num916++)
				{
					int num917 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num917].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num917].noGravity = true;
					Dust dust2 = Main.dust[num917];
					dust2.velocity *= 3f;
				}
			}
			if (flag58)
			{
				SoundEngine.PlaySound(SoundID.Item14, base.position);
				for (int num918 = 0; num918 < 20; num918++)
				{
					int num919 = Dust.NewDust(base.position, width, height, 135, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num919].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Dust dust2 = Main.dust[num919];
					dust2.velocity *= 2f;
					Main.dust[num919].noGravity = true;
					Main.dust[num919].fadeIn = 2.5f;
					Main.dust[num919].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
				}
				for (int num920 = 0; num920 < 15; num920++)
				{
					int num921 = Dust.NewDust(base.position, width, height, 135, 0f, 0f, 0, default(Color), 2.7f);
					Main.dust[num921].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num921].noGravity = true;
					Dust dust2 = Main.dust[num921];
					dust2.velocity *= 3f;
					Main.dust[num921].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
				}
				float num922 = (float)Main.rand.NextDouble() * ((float)Math.PI * 2f);
				float num923 = (float)Main.rand.NextDouble() * ((float)Math.PI * 2f);
				float num924 = (float)Main.rand.NextDouble() * ((float)Math.PI * 2f);
				float num925 = 7f + (float)Main.rand.NextDouble() * 7f;
				float num926 = 7f + (float)Main.rand.NextDouble() * 7f;
				float num927 = 7f + (float)Main.rand.NextDouble() * 7f;
				float num928 = num925;
				if (num926 > num928)
				{
					num928 = num926;
				}
				if (num927 > num928)
				{
					num928 = num927;
				}
				for (int num929 = 0; num929 < 200; num929++)
				{
					int num930 = 135;
					float num931 = num928;
					if (num929 > 50)
					{
						num931 = num926;
					}
					if (num929 > 100)
					{
						num931 = num925;
					}
					if (num929 > 150)
					{
						num931 = num927;
					}
					int num932 = Dust.NewDust(base.position, 6, 6, num930, 0f, 0f, 100);
					Vector2 vector133 = Main.dust[num932].velocity;
					Main.dust[num932].position = base.Center;
					vector133.Normalize();
					vector133 *= num931;
					if (num929 > 150)
					{
						vector133.Y *= 0.5f;
						vector133 = vector133.RotatedBy(num924);
					}
					else if (num929 > 100)
					{
						vector133.X *= 0.5f;
						vector133 = vector133.RotatedBy(num922);
					}
					else if (num929 > 50)
					{
						vector133.Y *= 0.5f;
						vector133 = vector133.RotatedBy(num923);
					}
					Dust dust2 = Main.dust[num932];
					dust2.velocity *= 0.2f;
					dust2 = Main.dust[num932];
					dust2.velocity += vector133;
					Main.dust[num932].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
					if (num929 <= 200)
					{
						Main.dust[num932].scale = 2f;
						Main.dust[num932].noGravity = true;
						Main.dust[num932].fadeIn = Main.rand.NextFloat() * 2f;
						if (Main.rand.Next(4) == 0)
						{
							Main.dust[num932].fadeIn = 2.5f;
						}
						Main.dust[num932].noLight = true;
						if (num929 < 100)
						{
							dust2 = Main.dust[num932];
							dust2.position += Main.dust[num932].velocity * 20f;
							dust2 = Main.dust[num932];
							dust2.velocity *= -1f;
						}
					}
				}
			}
			if (flag59)
			{
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.DeadCellsMushroomBoiExplosion, new ParticleOrchestraSettings
				{
					PositionInWorld = base.Center,
					MovementVector = Vector2.Zero
				}, owner);
			}
		}
		else if (aiStyle == 118)
		{
			this.ai[0]++;
			int num933 = 0;
			if (velocity.Length() <= 4f)
			{
				num933 = 1;
			}
			alpha -= 15;
			if (alpha < 0)
			{
				alpha = 0;
			}
			switch (num933)
			{
			case 0:
				rotation -= (float)Math.PI / 30f;
				if (Main.rand.Next(3) == 0)
				{
					if (Main.rand.Next(2) == 0)
					{
						Vector2 vector139 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust51 = Main.dust[Dust.NewDust(base.Center - vector139 * 30f, 0, 0, Utils.SelectRandom<int>(Main.rand, 86, 90))];
						dust51.noGravity = true;
						dust51.position = base.Center - vector139 * Main.rand.Next(10, 21);
						dust51.velocity = vector139.RotatedBy(1.5707963705062866) * 6f;
						dust51.scale = 0.5f + Main.rand.NextFloat();
						dust51.fadeIn = 0.5f;
						dust51.customData = this;
					}
					else
					{
						Vector2 vector140 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust52 = Main.dust[Dust.NewDust(base.Center - vector140 * 30f, 0, 0, 240)];
						dust52.noGravity = true;
						dust52.position = base.Center - vector140 * 30f;
						dust52.velocity = vector140.RotatedBy(-1.5707963705062866) * 3f;
						dust52.scale = 0.5f + Main.rand.NextFloat();
						dust52.fadeIn = 0.5f;
						dust52.customData = this;
					}
				}
				if (this.ai[0] >= 30f)
				{
					velocity *= 0.98f;
					scale += 0.0074468083f;
					if (scale > 1.3f)
					{
						scale = 1.3f;
					}
					rotation -= (float)Math.PI / 180f;
				}
				if (velocity.Length() < 4.1f)
				{
					velocity.Normalize();
					velocity *= 4f;
					this.ai[0] = 0f;
				}
				break;
			case 1:
			{
				rotation -= (float)Math.PI / 30f;
				for (int num934 = 0; num934 < 1; num934++)
				{
					if (Main.rand.Next(2) == 0)
					{
						Vector2 vector134 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust49 = Main.dust[Dust.NewDust(base.Center - vector134 * 30f, 0, 0, 86)];
						dust49.noGravity = true;
						dust49.position = base.Center - vector134 * Main.rand.Next(10, 21);
						dust49.velocity = vector134.RotatedBy(1.5707963705062866) * 6f;
						dust49.scale = 0.9f + Main.rand.NextFloat();
						dust49.fadeIn = 0.5f;
						dust49.customData = this;
						vector134 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						dust49 = Main.dust[Dust.NewDust(base.Center - vector134 * 30f, 0, 0, 90)];
						dust49.noGravity = true;
						dust49.position = base.Center - vector134 * Main.rand.Next(10, 21);
						dust49.velocity = vector134.RotatedBy(1.5707963705062866) * 6f;
						dust49.scale = 0.9f + Main.rand.NextFloat();
						dust49.fadeIn = 0.5f;
						dust49.customData = this;
						dust49.color = Color.Crimson;
					}
					else
					{
						Vector2 vector135 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust50 = Main.dust[Dust.NewDust(base.Center - vector135 * 30f, 0, 0, 240)];
						dust50.noGravity = true;
						dust50.position = base.Center - vector135 * Main.rand.Next(20, 31);
						dust50.velocity = vector135.RotatedBy(-1.5707963705062866) * 5f;
						dust50.scale = 0.9f + Main.rand.NextFloat();
						dust50.fadeIn = 0.5f;
						dust50.customData = this;
					}
				}
				if (this.ai[0] % 30f == 0f && this.ai[0] < 241f && Main.myPlayer == owner)
				{
					Vector2 vector136 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * 12f;
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector136.X, vector136.Y, 618, damage / 2, 0f, owner, 0f, whoAmI);
				}
				Vector2 vector137 = base.Center;
				float num935 = 800f;
				bool flag60 = false;
				int num936 = 0;
				if (this.ai[1] == 0f)
				{
					for (int num937 = 0; num937 < Main.maxNPCs; num937++)
					{
						if (Main.npc[num937].CanBeChasedBy(this))
						{
							Vector2 center18 = Main.npc[num937].Center;
							if (Distance(center18) < num935 && Collision.CanHit(new Vector2(base.position.X + (float)(width / 2), base.position.Y + (float)(height / 2)), 1, 1, Main.npc[num937].position, Main.npc[num937].width, Main.npc[num937].height))
							{
								num935 = Distance(center18);
								vector137 = center18;
								flag60 = true;
								num936 = num937;
							}
						}
					}
					if (flag60)
					{
						if (this.ai[1] != (float)(num936 + 1))
						{
							netUpdate = true;
						}
						this.ai[1] = num936 + 1;
					}
					flag60 = false;
				}
				if (this.ai[1] != 0f)
				{
					int num938 = (int)(this.ai[1] - 1f);
					if (Main.npc[num938].active && Main.npc[num938].CanBeChasedBy(this, ignoreDontTakeDamage: true) && Distance(Main.npc[num938].Center) < 1000f)
					{
						flag60 = true;
						vector137 = Main.npc[num938].Center;
					}
				}
				if (!friendly)
				{
					flag60 = false;
				}
				if (flag60)
				{
					float num939 = 4f;
					int num940 = 8;
					Vector2 vector138 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
					float num941 = vector137.X - vector138.X;
					float num942 = vector137.Y - vector138.Y;
					float num943 = (float)Math.Sqrt(num941 * num941 + num942 * num942);
					float num944 = num943;
					num943 = num939 / num943;
					num941 *= num943;
					num942 *= num943;
					velocity.X = (velocity.X * (float)(num940 - 1) + num941) / (float)num940;
					velocity.Y = (velocity.Y * (float)(num940 - 1) + num942) / (float)num940;
				}
				break;
			}
			}
			if (alpha < 150)
			{
				Lighting.AddLight(base.Center, 0.7f, 0.2f, 0.6f);
			}
			if (this.ai[0] >= 600f)
			{
				Kill();
			}
		}
		else if (aiStyle == 119)
		{
			int num945 = 0;
			float num946 = 0f;
			float x8 = 0f;
			float y10 = 0f;
			bool flag61 = false;
			bool flag62 = false;
			int num778 = type;
			if (num778 == 618)
			{
				num945 = 617;
				num946 = 420f;
				x8 = 0.15f;
				y10 = 0.15f;
			}
			if (flag62)
			{
				int num947 = (int)this.ai[1];
				if (!Main.projectile[num947].active || Main.projectile[num947].type != num945)
				{
					Kill();
					return;
				}
				timeLeft = 2;
			}
			this.ai[0]++;
			if (!(this.ai[0] < num946))
			{
				return;
			}
			bool flag63 = true;
			int num948 = (int)this.ai[1];
			if (Main.projectile[num948].active && Main.projectile[num948].type == num945)
			{
				if (!flag61 && Main.projectile[num948].oldPos[1] != Vector2.Zero)
				{
					base.position += Main.projectile[num948].position - Main.projectile[num948].oldPos[1];
				}
				if (base.Center.HasNaNs())
				{
					Kill();
					return;
				}
			}
			else
			{
				this.ai[0] = num946;
				flag63 = false;
				Kill();
			}
			if (flag63 && !flag61)
			{
				velocity += new Vector2(Math.Sign(Main.projectile[num948].Center.X - base.Center.X), Math.Sign(Main.projectile[num948].Center.Y - base.Center.Y)) * new Vector2(x8, y10);
				if (velocity.Length() > 6f)
				{
					velocity *= 6f / velocity.Length();
				}
			}
			if (type == 618)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num949 = Dust.NewDust(base.Center, 8, 8, 86);
					Main.dust[num949].position = base.Center;
					Main.dust[num949].velocity = velocity;
					Main.dust[num949].noGravity = true;
					Main.dust[num949].scale = 1.5f;
					if (flag63)
					{
						Main.dust[num949].customData = Main.projectile[(int)this.ai[1]];
					}
				}
				alpha = 255;
			}
			else
			{
				Kill();
			}
		}
		else if (aiStyle == 120)
		{
			AI_120_StardustGuardian();
		}
		else if (aiStyle == 121)
		{
			AI_121_StardustDragon();
		}
		else if (aiStyle == 122)
		{
			int num950 = (int)this.ai[0];
			bool flag64 = false;
			if (num950 == -1 || !Main.npc[num950].active)
			{
				flag64 = true;
			}
			if (flag64)
			{
				if (type == 629)
				{
					Kill();
					return;
				}
				if (type == 631 && this.ai[0] != -1f)
				{
					this.ai[0] = -1f;
					netUpdate = true;
				}
			}
			if (!flag64 && base.Hitbox.Intersects(Main.npc[num950].Hitbox))
			{
				Kill();
				if (type == 631)
				{
					localAI[1] = 1f;
					Damage();
				}
				return;
			}
			if (type == 629)
			{
				Vector2 value15 = Main.npc[num950].Center - base.Center;
				velocity = Vector2.Normalize(value15) * 5f;
				Dust.QuickDust(base.Center, Color.Red);
			}
			if (type != 631)
			{
				return;
			}
			if (this.ai[1] > 0f)
			{
				this.ai[1]--;
				velocity = Vector2.Zero;
				return;
			}
			if (flag64)
			{
				if (velocity == Vector2.Zero)
				{
					Kill();
				}
				tileCollide = true;
				alpha += 10;
				if (alpha > 255)
				{
					Kill();
				}
			}
			else
			{
				Vector2 value16 = Main.npc[num950].Center - base.Center;
				velocity = Vector2.Normalize(value16) * 12f;
				alpha -= 15;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			rotation = velocity.ToRotation() - (float)Math.PI / 2f;
		}
		else if (aiStyle == 123)
		{
			bool flag65 = type == 641;
			bool flag66 = type == 643;
			float num951 = 1000f;
			velocity = Vector2.Zero;
			if (flag65)
			{
				alpha -= 5;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (direction == 0)
				{
					direction = Main.player[owner].direction;
				}
				rotation -= (float)direction * ((float)Math.PI * 2f) / 120f;
				scale = Opacity;
				Lighting.AddLight(base.Center, new Vector3(0.3f, 0.9f, 0.7f) * Opacity);
				if (Main.rand.Next(2) == 0)
				{
					Vector2 vector141 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
					Dust dust53 = Main.dust[Dust.NewDust(base.Center - vector141 * 30f, 0, 0, 229)];
					dust53.noGravity = true;
					dust53.position = base.Center - vector141 * Main.rand.Next(10, 21);
					dust53.velocity = vector141.RotatedBy(1.5707963705062866) * 6f;
					dust53.scale = 0.5f + Main.rand.NextFloat();
					dust53.fadeIn = 0.5f;
					dust53.customData = base.Center;
				}
				if (Main.rand.Next(2) == 0)
				{
					Vector2 vector142 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
					Dust dust54 = Main.dust[Dust.NewDust(base.Center - vector142 * 30f, 0, 0, 240)];
					dust54.noGravity = true;
					dust54.position = base.Center - vector142 * 30f;
					dust54.velocity = vector142.RotatedBy(-1.5707963705062866) * 3f;
					dust54.scale = 0.5f + Main.rand.NextFloat();
					dust54.fadeIn = 0.5f;
					dust54.customData = base.Center;
				}
				if (this.ai[0] < 0f)
				{
					Vector2 center19 = base.Center;
					int num952 = Dust.NewDust(center19 - Vector2.One * 8f, 16, 16, 229, velocity.X / 2f, velocity.Y / 2f);
					Dust dust2 = Main.dust[num952];
					dust2.velocity *= 2f;
					Main.dust[num952].noGravity = true;
					Main.dust[num952].scale = Utils.SelectRandom<float>(Main.rand, 0.8f, 1.65f);
					Main.dust[num952].customData = this;
				}
			}
			if (flag66)
			{
				alpha -= 5;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (direction == 0)
				{
					direction = Main.player[owner].direction;
				}
				if (++frameCounter >= 3)
				{
					frameCounter = 0;
					if (++frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
				if (alpha == 0 && Main.rand.Next(15) == 0)
				{
					Dust dust55 = Main.dust[Dust.NewDust(base.Top, 0, 0, 261, 0f, 0f, 100)];
					dust55.velocity.X = 0f;
					dust55.noGravity = true;
					dust55.fadeIn = 1f;
					dust55.position = base.Center + Vector2.UnitY.RotatedByRandom(6.2831854820251465) * (4f * Main.rand.NextFloat() + 26f);
					dust55.scale = 0.5f;
				}
				localAI[0]++;
				if (localAI[0] >= 60f)
				{
					localAI[0] = 0f;
				}
			}
			if (this.ai[0] < 0f)
			{
				this.ai[0]++;
				if (flag65)
				{
					this.ai[1] -= (float)direction * ((float)Math.PI / 8f) / 50f;
				}
			}
			if (this.ai[0] == 0f)
			{
				int num953 = -1;
				float num954 = num951;
				NPC ownerMinionAttackTargetNPC3 = OwnerMinionAttackTargetNPC;
				if (ownerMinionAttackTargetNPC3 != null && ownerMinionAttackTargetNPC3.CanBeChasedBy(this))
				{
					float num955 = Distance(ownerMinionAttackTargetNPC3.Center);
					if (num955 < num954 && Collision.CanHitLine(base.Center, 0, 0, ownerMinionAttackTargetNPC3.Center, 0, 0))
					{
						num954 = num955;
						num953 = ownerMinionAttackTargetNPC3.whoAmI;
					}
				}
				if (num953 < 0)
				{
					for (int num956 = 0; num956 < Main.maxNPCs; num956++)
					{
						NPC nPC16 = Main.npc[num956];
						if (nPC16.CanBeChasedBy(this))
						{
							float num957 = Distance(nPC16.Center);
							if (num957 < num954 && Collision.CanHitLine(base.Center, 0, 0, nPC16.Center, 0, 0))
							{
								num954 = num957;
								num953 = num956;
							}
						}
					}
				}
				if (num953 != -1)
				{
					this.ai[0] = 1f;
					this.ai[1] = num953;
					netUpdate = true;
					return;
				}
			}
			if (!(this.ai[0] > 0f))
			{
				return;
			}
			int num958 = (int)this.ai[1];
			if (!Main.npc[num958].CanBeChasedBy(this))
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				netUpdate = true;
				return;
			}
			this.ai[0]++;
			float num959 = 30f;
			if (flag65)
			{
				num959 = 10f;
			}
			if (flag66)
			{
				num959 = 5f;
			}
			if (!(this.ai[0] >= num959))
			{
				return;
			}
			Vector2 vector143 = DirectionTo(Main.npc[num958].Center);
			if (vector143.HasNaNs())
			{
				vector143 = Vector2.UnitY;
			}
			float num960 = vector143.ToRotation();
			int num961 = ((vector143.X > 0f) ? 1 : (-1));
			if (flag65)
			{
				direction = num961;
				this.ai[0] = -20f;
				this.ai[1] = num960 + (float)num961 * (float)Math.PI / 6f;
				netUpdate = true;
				if (owner == Main.myPlayer)
				{
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector143.X, vector143.Y, 642, damage, knockBack, owner, this.ai[1], whoAmI);
				}
			}
			if (!flag66)
			{
				return;
			}
			direction = num961;
			this.ai[0] = -20f;
			netUpdate = true;
			if (owner != Main.myPlayer)
			{
				return;
			}
			NPC nPC17 = Main.npc[num958];
			Vector2 vector144 = nPC17.position + nPC17.Size * Utils.RandomVector2(Main.rand, 0f, 1f) - base.Center;
			for (int num962 = 0; num962 < 3; num962++)
			{
				Vector2 other = base.Center + vector144;
				Vector2 vector145 = nPC17.velocity * 30f;
				other += vector145;
				float num963 = MathHelper.Lerp(0.1f, 0.75f, Utils.GetLerpValue(800f, 200f, Distance(other)));
				if (num962 > 0)
				{
					other = base.Center + vector144.RotatedByRandom(0.7853981852531433) * (Main.rand.NextFloat() * num963 + 0.5f);
				}
				float x9 = Main.rgbToHsl(new Color(Main.DiscoR, Main.DiscoG, Main.DiscoB)).X;
				NewProjectile(GetProjectileSource_FromThis(), other.X, other.Y, 0f, 0f, 644, damage, knockBack, owner, x9, whoAmI);
			}
		}
		else if (aiStyle == 124)
		{
			bool flag67 = type == 650;
			Player player13 = Main.player[owner];
			if (player13.dead)
			{
				Kill();
				return;
			}
			if (type == 650 && player13.suspiciouslookingTentacle)
			{
				timeLeft = 2;
			}
			if (type == 882 && player13.petFlagEyeOfCthulhuPet)
			{
				timeLeft = 2;
			}
			if (type == 888 && player13.petFlagTwinsPet)
			{
				timeLeft = 2;
			}
			if (type == 895 && player13.petFlagFairyQueenPet)
			{
				timeLeft = 2;
			}
			if (type == 896 && player13.petFlagPumpkingPet)
			{
				timeLeft = 2;
			}
			if (type == 898 && player13.petFlagIceQueenPet)
			{
				timeLeft = 2;
			}
			if (type == 957 && player13.petFlagGlommerPet)
			{
				timeLeft = 2;
			}
			direction = (spriteDirection = player13.direction);
			if (type == 650)
			{
				Vector3 v3_ = new Vector3(0.5f, 0.9f, 1f) * 2f;
				DelegateMethods.v3_1 = v3_;
				Utils.PlotTileLine(base.Center, base.Center + velocity * 6f, 20f, DelegateMethods.CastLightOpen);
				Utils.PlotTileLine(base.Left, base.Right, 20f, DelegateMethods.CastLightOpen);
				Utils.PlotTileLine(player13.Center, player13.Center + player13.velocity * 6f, 40f, DelegateMethods.CastLightOpen);
				Utils.PlotTileLine(player13.Left, player13.Right, 40f, DelegateMethods.CastLightOpen);
			}
			if (type == 895)
			{
				Vector3 vector146 = new Vector3(1f, 0.6f, 1f) * 1.5f;
				if (Main.netMode != 2 && !Lighting.NotRetro)
				{
					vector146 *= 0.8f;
				}
				DelegateMethods.v3_1 = vector146 * 1.5f;
				Utils.PlotTileLine(base.Center, base.Center + velocity * 6f, 30f, DelegateMethods.CastLightOpen);
				Utils.PlotTileLine(base.Left, base.Right, 20f, DelegateMethods.CastLightOpen);
				DelegateMethods.v3_1 = vector146 * 0.75f;
				Utils.PlotTileLine(player13.Center, player13.Center + player13.velocity * 6f, 40f, DelegateMethods.CastLightOpen);
				Utils.PlotTileLine(player13.Left, player13.Right, 40f, DelegateMethods.CastLightOpen);
			}
			if (type == 896)
			{
				Vector3 vector147 = new Vector3(1f, 0.7f, 0.05f) * 1.5f;
				if (Main.netMode != 2 && !Lighting.NotRetro)
				{
					vector147 *= 0.8f;
				}
				DelegateMethods.v3_1 = vector147 * 1.5f;
				Utils.PlotTileLine(base.Center, base.Center + velocity * 6f, 30f, DelegateMethods.CastLightOpen);
				Utils.PlotTileLine(base.Left, base.Right, 20f, DelegateMethods.CastLightOpen);
				DelegateMethods.v3_1 = vector147 * 0.75f;
				Utils.PlotTileLine(player13.Center, player13.Center + player13.velocity * 6f, 40f, DelegateMethods.CastLightOpen);
				Utils.PlotTileLine(player13.Left, player13.Right, 40f, DelegateMethods.CastLightOpen);
			}
			float num964 = 30f;
			float y11 = -20f;
			int num965 = player13.direction;
			if (type == 882 && player13.ownedProjectileCounts[650] > 0)
			{
				num965 *= -1;
			}
			if (type == 888)
			{
				num964 = 30f;
				y11 = -50f;
				if (player13.ownedProjectileCounts[650] > 0)
				{
					y11 = -70f;
				}
			}
			if (type == 895)
			{
				num964 = -36f;
				y11 = -50f;
			}
			if (type == 896)
			{
				num964 = 30f;
				y11 = -60f;
				if (player13.ownedProjectileCounts[888] > 0)
				{
					num964 = -30f;
				}
			}
			if (type == 898)
			{
				num964 = -30f;
				y11 = -50f;
				if (player13.ownedProjectileCounts[895] > 0)
				{
					num964 = 30f;
				}
			}
			if (type == 957)
			{
				num964 = -40f;
				y11 = -40f;
				if (player13.ownedProjectileCounts[895] > 0)
				{
					num964 = 40f;
				}
			}
			Vector2 vector148 = new Vector2((float)num965 * num964, y11);
			Vector2 vector149 = player13.MountedCenter + vector148;
			float num966 = Vector2.Distance(base.Center, vector149);
			if (num966 > 1000f)
			{
				base.Center = player13.Center + vector148;
			}
			Vector2 vector150 = vector149 - base.Center;
			float num967 = 4f;
			if (num966 < num967)
			{
				velocity *= 0.25f;
			}
			if (vector150 != Vector2.Zero)
			{
				if (vector150.Length() < num967)
				{
					velocity = vector150;
				}
				else
				{
					velocity = vector150 * 0.1f;
				}
			}
			if (num966 > 50f && (type == 895 || type == 898 || type == 957))
			{
				direction = (spriteDirection = 1);
				if (velocity.X < 0f)
				{
					direction = (spriteDirection = -1);
				}
			}
			if (velocity.Length() > 6f)
			{
				if (type == 650)
				{
					float num968 = velocity.ToRotation() + (float)Math.PI / 2f;
					if (Math.Abs(rotation - num968) >= (float)Math.PI)
					{
						if (num968 < rotation)
						{
							rotation -= (float)Math.PI * 2f;
						}
						else
						{
							rotation += (float)Math.PI * 2f;
						}
					}
					float num969 = 12f;
					rotation = (rotation * (num969 - 1f) + num968) / num969;
					if (++frameCounter >= 4)
					{
						frameCounter = 0;
						if (++frame >= Main.projFrames[type])
						{
							frame = 0;
						}
					}
				}
				else if (type == 882)
				{
					rotation = velocity.X * 0.125f;
					if (++frameCounter >= 3)
					{
						frameCounter = 0;
						if (frame < 6)
						{
							frame = 6;
						}
						else
						{
							frame++;
							if (frame > 15)
							{
								frame = 10;
							}
						}
					}
				}
				else if (type == 888)
				{
					float num970 = velocity.ToRotation() + (float)Math.PI / 2f;
					if (Math.Abs(rotation - num970) >= (float)Math.PI)
					{
						if (num970 < rotation)
						{
							rotation -= (float)Math.PI * 2f;
						}
						else
						{
							rotation += (float)Math.PI * 2f;
						}
					}
					float num971 = 12f;
					rotation = (rotation * (num971 - 1f) + num970) / num971;
					if (++frameCounter >= 3)
					{
						frameCounter = 0;
						if (frame < 6)
						{
							frame = 6;
						}
						else
						{
							frame++;
							if (frame > 17)
							{
								frame = 6;
							}
						}
					}
				}
				else if (type == 895)
				{
					float num972 = velocity.X * 0.1f;
					if (Math.Abs(rotation - num972) >= (float)Math.PI)
					{
						if (num972 < rotation)
						{
							rotation -= (float)Math.PI * 2f;
						}
						else
						{
							rotation += (float)Math.PI * 2f;
						}
					}
					float num973 = 12f;
					rotation = (rotation * (num973 - 1f) + num972) / num973;
					if (++frameCounter >= 3)
					{
						frameCounter = 0;
						frame++;
						if (frame >= Main.projFrames[type])
						{
							frame = 0;
						}
					}
					if (frameCounter == 0)
					{
						int num974 = Dust.NewDust(base.position, width, height, 242, 0f, 0f, 50, default(Color), 2f);
						Main.dust[num974].noGravity = true;
					}
				}
				else if (type == 896)
				{
					float num975 = velocity.ToRotation() + (float)Math.PI / 2f;
					if (Math.Abs(rotation - num975) >= (float)Math.PI)
					{
						if (num975 < rotation)
						{
							rotation -= (float)Math.PI * 2f;
						}
						else
						{
							rotation += (float)Math.PI * 2f;
						}
					}
					float num976 = 12f;
					rotation = (rotation * (num976 - 1f) + num975) / num976;
					if (++frameCounter >= 4)
					{
						frameCounter = 0;
						if (frame < 8)
						{
							frame = 8;
						}
						else
						{
							frame++;
							if (frame >= Main.projFrames[type])
							{
								frame = 8;
							}
						}
					}
				}
				else if (type == 898)
				{
					float num977 = velocity.X * 0.1f;
					if (Math.Abs(rotation - num977) >= (float)Math.PI)
					{
						if (num977 < rotation)
						{
							rotation -= (float)Math.PI * 2f;
						}
						else
						{
							rotation += (float)Math.PI * 2f;
						}
					}
					float num978 = 12f;
					rotation = (rotation * (num978 - 1f) + num977) / num978;
					if (++frameCounter >= 3)
					{
						frameCounter = 0;
						frame++;
						if (frame >= Main.projFrames[type])
						{
							frame = 0;
						}
					}
					if (frameCounter == 0)
					{
						int num979 = Dust.NewDust(base.position, width, height, 80, 0f, 0f, 50);
						Main.dust[num979].noGravity = true;
					}
				}
				else if (type == 957)
				{
					float num980 = velocity.X * 0.05f;
					if (Math.Abs(rotation - num980) >= (float)Math.PI)
					{
						if (num980 < rotation)
						{
							rotation -= (float)Math.PI * 2f;
						}
						else
						{
							rotation += (float)Math.PI * 2f;
						}
					}
					float num981 = 12f;
					rotation = (rotation * (num981 - 1f) + num980) / num981;
					if (++frameCounter >= 4)
					{
						frameCounter = 0;
						frame++;
						if (frame >= Main.projFrames[type] * 2)
						{
							frame = 0;
						}
					}
				}
			}
			else if (type == 650)
			{
				if (rotation > (float)Math.PI)
				{
					rotation -= (float)Math.PI * 2f;
				}
				if (rotation > -0.005f && rotation < 0.005f)
				{
					rotation = 0f;
				}
				else
				{
					rotation *= 0.96f;
				}
				if (++frameCounter >= 6)
				{
					frameCounter = 0;
					if (++frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
			}
			else if (type == 882)
			{
				rotation = velocity.X * 0.125f;
				if (++frameCounter >= 5)
				{
					frameCounter = 0;
					frame++;
					if (frame == 6 || frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
			}
			else if (type == 888)
			{
				if (rotation > (float)Math.PI)
				{
					rotation -= (float)Math.PI * 2f;
				}
				if (rotation > -0.005f && rotation < 0.005f)
				{
					rotation = 0f;
				}
				else
				{
					rotation *= 0.96f;
				}
				if (++frameCounter >= 5)
				{
					frameCounter = 0;
					frame++;
					if (frame == 6 || frame >= 18)
					{
						frame = 0;
					}
				}
			}
			else if (type == 895)
			{
				if (rotation > (float)Math.PI)
				{
					rotation -= (float)Math.PI * 2f;
				}
				if (rotation > -0.005f && rotation < 0.005f)
				{
					rotation = 0f;
				}
				else
				{
					rotation *= 0.96f;
				}
				if (++frameCounter >= 5)
				{
					frameCounter = 0;
					frame++;
					if (frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
			}
			else if (type == 896)
			{
				if (rotation > (float)Math.PI)
				{
					rotation -= (float)Math.PI * 2f;
				}
				if (rotation > -0.005f && rotation < 0.005f)
				{
					rotation = 0f;
				}
				else
				{
					rotation *= 0.96f;
				}
				if (++frameCounter >= 5)
				{
					frameCounter = 0;
					frame++;
					if (frame == 8 || frame >= Main.projFrames[type])
					{
						frame = 0;
						if (Main.rand.Next(15) == 0)
						{
							frame = 8;
						}
					}
				}
			}
			else if (type == 898)
			{
				if (rotation > (float)Math.PI)
				{
					rotation -= (float)Math.PI * 2f;
				}
				if (rotation > -0.005f && rotation < 0.005f)
				{
					rotation = 0f;
				}
				else
				{
					rotation *= 0.96f;
				}
				if (++frameCounter >= 5)
				{
					frameCounter = 0;
					frame++;
					if (frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
			}
			else if (type == 957)
			{
				int num982 = Main.projFrames[type];
				if (rotation > (float)Math.PI)
				{
					rotation -= (float)Math.PI * 2f;
				}
				if (rotation > -0.005f && rotation < 0.005f)
				{
					rotation = 0f;
				}
				else
				{
					rotation *= 0.96f;
				}
				if (velocity.Length() <= 0.01f)
				{
					bool flag68 = true;
					int num983 = (int)base.Center.X / 16;
					int num984 = (int)base.Center.Y / 16;
					int num985 = 4;
					for (int num986 = 0; num986 < num985 + 1; num986++)
					{
						if (num983 < 0 || num983 >= Main.maxTilesX || num984 < 0 || num984 >= Main.maxTilesY)
						{
							flag68 = false;
							break;
						}
						bool flag69 = WorldGen.SolidTileAllowBottomSlope(num983, num984);
						if ((num986 == num985 && !flag69) || (num986 < num985 && flag69))
						{
							flag68 = false;
							break;
						}
						num984++;
					}
					if (flag68)
					{
						localAI[0]--;
						if (localAI[0] <= 0f)
						{
							localAI[0] = 0f;
							if (frame < num982 * 2)
							{
								frame = num982 * 2;
							}
							int num987 = 3;
							if (frame <= 30 && frame <= 33)
							{
								num987 = 2;
							}
							if (++frameCounter >= num987)
							{
								frameCounter = 0;
								frame++;
								if (frame >= num982 * 3)
								{
									localAI[0] = 200 + Main.rand.Next(150);
									frame = 0;
								}
								if (frame == 32)
								{
									SoundEngine.PlaySound(SoundID.GlommerBounce, base.Bottom);
								}
							}
						}
						else if (++frameCounter >= 4)
						{
							frameCounter = 0;
							frame++;
							if (frame >= num982 * 2)
							{
								frame = 0;
							}
						}
					}
					else
					{
						localAI[0] = 300f;
						if (++frameCounter >= 4)
						{
							frameCounter = 0;
							frame++;
							if (frame >= num982 * 2)
							{
								frame = 0;
							}
						}
					}
				}
				else
				{
					localAI[0] = 300f;
					if (++frameCounter >= 4)
					{
						frameCounter = 0;
						frame++;
						if (frame >= num982 * 2)
						{
							frame = 0;
						}
					}
				}
			}
			if (flag67 && this.ai[0] > 0f && (this.ai[0] += 1f) >= 60f)
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
			}
			if (flag67 && Main.rand.Next(15) == 0)
			{
				int num988 = -1;
				int num989 = -1;
				float num990 = -1f;
				int num991 = 17;
				if ((base.Center - player13.Center).Length() < (float)Main.screenWidth)
				{
					int num992 = (int)base.Center.X / 16;
					int num993 = (int)base.Center.Y / 16;
					num992 = (int)MathHelper.Clamp(num992, num991 + 1, Main.maxTilesX - num991 - 1);
					num993 = (int)MathHelper.Clamp(num993, num991 + 1, Main.maxTilesY - num991 - 1);
					for (int num994 = num992 - num991; num994 <= num992 + num991; num994++)
					{
						for (int num995 = num993 - num991; num995 <= num993 + num991; num995++)
						{
							int num996 = Main.rand.Next(8);
							if (num996 < 4 && new Vector2(num992 - num994, num993 - num995).Length() < (float)num991 && Main.tile[num994, num995] != null && Main.tile[num994, num995].active() && Main.IsTileSpelunkable(Main.tile[num994, num995]))
							{
								float num997 = Distance(new Vector2(num994 * 16 + 8, num995 * 16 + 8));
								if (num997 < num990 || num990 == -1f)
								{
									num990 = num997;
									num988 = num994;
									num989 = num995;
									this.ai[0] = 1f;
									this.ai[1] = AngleTo(new Vector2(num994 * 16 + 8, num995 * 16 + 8));
								}
								if (num996 < 2)
								{
									int num998 = Dust.NewDust(new Vector2(num994 * 16, num995 * 16), 16, 16, 204, 0f, 0f, 150, default(Color), 0.3f);
									Main.dust[num998].fadeIn = 0.75f;
									Dust dust2 = Main.dust[num998];
									dust2.velocity *= 0.1f;
								}
							}
						}
					}
				}
			}
			if (!flag67)
			{
				return;
			}
			float f3 = localAI[0] % ((float)Math.PI * 2f) - (float)Math.PI;
			float num999 = (float)Math.IEEERemainder(localAI[1], 1.0);
			if (num999 < 0f)
			{
				num999 += 1f;
			}
			float num1000 = (float)Math.Floor(localAI[1]);
			float max = 0.999f;
			float num1001 = 0f;
			int num1002 = 0;
			float amount2 = 0.1f;
			bool flag70 = player13.velocity.Length() > 3f;
			int num1003 = -1;
			int num1004 = -1;
			float num1005 = 300f;
			float num1006 = 500f;
			for (int num1007 = 0; num1007 < Main.maxNPCs; num1007++)
			{
				NPC nPC18 = Main.npc[num1007];
				if (!nPC18.active || !nPC18.chaseable || nPC18.dontTakeDamage || nPC18.immortal)
				{
					continue;
				}
				float num1008 = Distance(nPC18.Center);
				if (nPC18.friendly || nPC18.lifeMax <= 5)
				{
					if (num1008 < num1005 && !flag70)
					{
						num1005 = num1008;
						num1004 = num1007;
					}
				}
				else if (num1008 < num1006)
				{
					num1006 = num1008;
					num1003 = num1007;
				}
			}
			if (flag70)
			{
				num1001 = AngleTo(base.Center + player13.velocity);
				num1002 = 1;
				num999 = MathHelper.Clamp(num999 + 0.05f, 0f, max);
				num1000 += (float)Math.Sign(-10f - num1000);
			}
			else if (num1003 != -1)
			{
				num1001 = AngleTo(Main.npc[num1003].Center);
				num1002 = 2;
				num999 = MathHelper.Clamp(num999 + 0.05f, 0f, max);
				num1000 += (float)Math.Sign(-12f - num1000);
			}
			else if (num1004 != -1)
			{
				num1001 = AngleTo(Main.npc[num1004].Center);
				num1002 = 3;
				num999 = MathHelper.Clamp(num999 + 0.05f, 0f, max);
				num1000 += (float)Math.Sign(6f - num1000);
			}
			else if (this.ai[0] > 0f)
			{
				num1001 = this.ai[1];
				num999 = MathHelper.Clamp(num999 + (float)Math.Sign(0.75f - num999) * 0.05f, 0f, max);
				num1002 = 4;
				num1000 += (float)Math.Sign(10f - num1000);
				if (Main.rand.Next(10) == 0)
				{
					int num1009 = Dust.NewDust(base.Center + f3.ToRotationVector2() * 6f * num999 - Vector2.One * 4f, 8, 8, 204, 0f, 0f, 150, default(Color), 0.3f);
					Main.dust[num1009].fadeIn = 0.75f;
					Dust dust2 = Main.dust[num1009];
					dust2.velocity *= 0.1f;
				}
			}
			else
			{
				num1001 = ((player13.direction == 1) ? 0f : 3.1416028f);
				num999 = MathHelper.Clamp(num999 + (float)Math.Sign(0.75f - num999) * 0.05f, 0f, max);
				num1000 += (float)Math.Sign(0f - num1000);
				amount2 = 0.12f;
			}
			Vector2 value17 = num1001.ToRotationVector2();
			num1001 = Vector2.Lerp(f3.ToRotationVector2(), value17, amount2).ToRotation();
			localAI[0] = num1001 + (float)num1002 * ((float)Math.PI * 2f) + (float)Math.PI;
			localAI[1] = num1000 + num999;
		}
		else if (aiStyle == 125)
		{
			Player player14 = Main.player[owner];
			if (Main.myPlayer == owner)
			{
				if (localAI[1] > 0f)
				{
					localAI[1]--;
				}
				if (player14.noItems || player14.CCed || player14.dead)
				{
					Kill();
				}
				else if (Main.mouseRight && Main.mouseRightRelease)
				{
					Kill();
					player14.mouseInterface = true;
					Main.blockMouse = true;
				}
				else if (!player14.channel)
				{
					if (localAI[0] == 0f)
					{
						localAI[0] = 1f;
					}
					Kill();
				}
				else if (localAI[1] == 0f)
				{
					Vector2 vector151 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY);
					if (player14.gravDir == -1f)
					{
						vector151.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y;
					}
					if (vector151 != base.Center)
					{
						netUpdate = true;
						base.Center = vector151;
						localAI[1] = 1f;
					}
					if (this.ai[0] == 0f && this.ai[1] == 0f)
					{
						this.ai[0] = (int)base.Center.X / 16;
						this.ai[1] = (int)base.Center.Y / 16;
						netUpdate = true;
						velocity = Vector2.Zero;
					}
				}
				velocity = Vector2.Zero;
				Point point5 = new Vector2(this.ai[0], this.ai[1]).ToPoint();
				Point point6 = base.Center.ToTileCoordinates();
				int num1010 = Math.Abs(point5.X - point6.X);
				int num1011 = Math.Abs(point5.Y - point6.Y);
				int num1012 = Math.Sign(point6.X - point5.X);
				int num1013 = Math.Sign(point6.Y - point5.Y);
				Point point7 = default(Point);
				bool flag71 = false;
				bool flag72 = player14.direction == 1;
				int num1014;
				int num1015;
				int num1016;
				if (flag72)
				{
					point7.X = point5.X;
					num1014 = point5.Y;
					num1015 = point6.Y;
					num1016 = num1013;
				}
				else
				{
					point7.Y = point5.Y;
					num1014 = point5.X;
					num1015 = point6.X;
					num1016 = num1012;
				}
				for (int num1017 = num1014; num1017 != num1015; num1017 += num1016)
				{
					if (flag71)
					{
						break;
					}
					if (flag72)
					{
						point7.Y = num1017;
					}
					else
					{
						point7.X = num1017;
					}
					if (WorldGen.InWorld(point7.X, point7.Y, 1))
					{
						Tile tile4 = Main.tile[point7.X, point7.Y];
					}
				}
				if (flag72)
				{
					point7.Y = point6.Y;
					num1014 = point5.X;
					num1015 = point6.X;
					num1016 = num1012;
				}
				else
				{
					point7.X = point6.X;
					num1014 = point5.Y;
					num1015 = point6.Y;
					num1016 = num1013;
				}
				for (int num1018 = num1014; num1018 != num1015; num1018 += num1016)
				{
					if (flag71)
					{
						break;
					}
					if (!flag72)
					{
						point7.Y = num1018;
					}
					else
					{
						point7.X = num1018;
					}
					if (WorldGen.InWorld(point7.X, point7.Y, 1))
					{
						Tile tile4 = Main.tile[point7.X, point7.Y];
					}
				}
			}
			int num1019 = Math.Sign(player14.velocity.X);
			if (num1019 != 0)
			{
				player14.ChangeDir(num1019);
			}
			player14.heldProj = whoAmI;
			player14.SetDummyItemTime(2);
			player14.itemRotation = 0f;
		}
		else if (aiStyle == 126)
		{
			int num1020 = Math.Sign(velocity.Y);
			int num1021 = ((num1020 != -1) ? 1 : 0);
			if (this.ai[0] == 0f)
			{
				if (!Collision.SolidCollision(base.position + new Vector2(0f, (num1020 == -1) ? (height - 48) : 0), width, 48) && !Collision.WetCollision(base.position + new Vector2(0f, (num1020 == -1) ? (height - 20) : 0), width, 20))
				{
					velocity = new Vector2(0f, (float)Math.Sign(velocity.Y) * 0.001f);
					this.ai[0] = 1f;
					this.ai[1] = 0f;
					timeLeft = 60;
				}
				this.ai[1]++;
				if (this.ai[1] >= 60f)
				{
					Kill();
				}
				for (int num1022 = 0; num1022 < 3; num1022++)
				{
					int num1023 = Dust.NewDust(base.position, width, height, 31, 0f, 0f, 100);
					Main.dust[num1023].scale = 0.1f + (float)Main.rand.Next(5) * 0.1f;
					Main.dust[num1023].fadeIn = 1.5f + (float)Main.rand.Next(5) * 0.1f;
					Main.dust[num1023].noGravity = true;
					Main.dust[num1023].position = base.Center + new Vector2(0f, -height / 2).RotatedBy(rotation) * 1.1f;
				}
			}
			if (this.ai[0] != 1f)
			{
				return;
			}
			velocity = new Vector2(0f, (float)Math.Sign(velocity.Y) * 0.001f);
			if (num1020 != 0)
			{
				int num1024 = 16;
				int num1025 = 320;
				if (type == 670)
				{
					num1025 -= (int)Math.Abs(localAI[1]) * 64;
				}
				for (; num1024 < num1025 && !Collision.SolidCollision(base.position + new Vector2(0f, (num1020 == -1) ? (height - num1024 - 16) : 0), width, num1024 + 16); num1024 += 16)
				{
				}
				if (num1020 == -1)
				{
					base.position.Y += height;
					height = num1024;
					base.position.Y -= num1024;
				}
				else
				{
					height = num1024;
				}
			}
			this.ai[1]++;
			if (type == 670 && owner == Main.myPlayer && this.ai[1] == 12f && localAI[1] < 3f && localAI[1] > -3f)
			{
				if (localAI[1] == 0f)
				{
					int num1026 = NewProjectile(GetProjectileSource_FromThis(), base.Bottom + new Vector2(-50f, -10f), -Vector2.UnitY, type, damage, knockBack, owner);
					Main.projectile[num1026].localAI[1] = localAI[1] - 1f;
					num1026 = NewProjectile(GetProjectileSource_FromThis(), base.Bottom + new Vector2(50f, -10f), -Vector2.UnitY, type, damage, knockBack, owner);
					Main.projectile[num1026].localAI[1] = localAI[1] + 1f;
				}
				else
				{
					int num1027 = Math.Sign(localAI[1]);
					int num1028 = NewProjectile(GetProjectileSource_FromThis(), base.Bottom + new Vector2(50 * num1027, -10f), -Vector2.UnitY, type, damage, knockBack, owner);
					Main.projectile[num1028].localAI[1] = localAI[1] + (float)num1027;
				}
			}
			if (this.ai[1] >= 60f)
			{
				Kill();
			}
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				for (int num1029 = 0; (float)num1029 < 60f; num1029++)
				{
					int num1030 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
					int num1031 = Dust.NewDust(base.position, width, height, num1030, 0f, -2.5f * (float)(-num1020));
					Main.dust[num1031].alpha = 200;
					Dust dust2 = Main.dust[num1031];
					dust2.velocity *= new Vector2(0.3f, 2f);
					Main.dust[num1031].velocity.Y += 2 * num1020;
					dust2 = Main.dust[num1031];
					dust2.scale += Main.rand.NextFloat();
					Main.dust[num1031].position = new Vector2(base.Center.X, base.Center.Y + (float)height * 0.5f * (float)(-num1020));
					Main.dust[num1031].customData = num1021;
					if (num1020 == -1 && Main.rand.Next(4) != 0)
					{
						Main.dust[num1031].velocity.Y -= 0.2f;
					}
				}
				SoundEngine.PlaySound(SoundID.Item34, base.position);
			}
			if (num1020 == 1)
			{
				for (int num1032 = 0; (float)num1032 < 9f; num1032++)
				{
					int num1033 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
					int num1034 = Dust.NewDust(base.position, width, height, num1033, 0f, -2.5f * (float)(-num1020));
					Main.dust[num1034].alpha = 200;
					Dust dust2 = Main.dust[num1034];
					dust2.velocity *= new Vector2(0.3f, 2f);
					Main.dust[num1034].velocity.Y += 2 * num1020;
					dust2 = Main.dust[num1034];
					dust2.scale += Main.rand.NextFloat();
					Main.dust[num1034].position = new Vector2(base.Center.X, base.Center.Y + (float)height * 0.5f * (float)(-num1020));
					Main.dust[num1034].customData = num1021;
					if (num1020 == -1 && Main.rand.Next(4) != 0)
					{
						Main.dust[num1034].velocity.Y -= 0.2f;
					}
				}
			}
			int num1035 = (int)(this.ai[1] / 60f * (float)height) * 3;
			if (num1035 > height)
			{
				num1035 = height;
			}
			Vector2 vector152 = base.position + ((num1020 == -1) ? new Vector2(0f, height - num1035) : Vector2.Zero);
			Vector2 vector153 = base.position + ((num1020 == -1) ? new Vector2(0f, height) : Vector2.Zero);
			for (int num1036 = 0; (float)num1036 < 6f; num1036++)
			{
				if (Main.rand.Next(3) < 2)
				{
					int num1037 = Dust.NewDust(vector152, width, num1035, 6, 0f, 0f, 90, default(Color), 2.5f);
					Main.dust[num1037].noGravity = true;
					Main.dust[num1037].fadeIn = 1f;
					if (Main.dust[num1037].velocity.Y > 0f)
					{
						Main.dust[num1037].velocity.Y *= -1f;
					}
					if (Main.rand.Next(6) < 3)
					{
						Main.dust[num1037].position.Y = MathHelper.Lerp(Main.dust[num1037].position.Y, vector153.Y, 0.5f);
						Dust dust2 = Main.dust[num1037];
						dust2.velocity *= 5f;
						Main.dust[num1037].velocity.Y -= 3f;
						Main.dust[num1037].position.X = base.Center.X;
						Main.dust[num1037].noGravity = false;
						Main.dust[num1037].noLight = true;
						Main.dust[num1037].fadeIn = 0.4f;
						dust2 = Main.dust[num1037];
						dust2.scale *= 0.3f;
					}
					else
					{
						Main.dust[num1037].velocity = DirectionFrom(Main.dust[num1037].position) * Main.dust[num1037].velocity.Length() * 0.25f;
					}
					Main.dust[num1037].velocity.Y *= -num1020;
					Main.dust[num1037].customData = num1021;
				}
			}
			for (int num1038 = 0; (float)num1038 < 6f; num1038++)
			{
				if (!(Main.rand.NextFloat() < 0.5f))
				{
					int num1039 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
					int num1040 = Dust.NewDust(vector152, width, num1035, num1039, 0f, -2.5f * (float)(-num1020));
					Main.dust[num1040].alpha = 200;
					Dust dust2 = Main.dust[num1040];
					dust2.velocity *= new Vector2(0.6f, 1.5f);
					dust2 = Main.dust[num1040];
					dust2.scale += Main.rand.NextFloat();
					if (num1020 == -1 && Main.rand.Next(4) != 0)
					{
						Main.dust[num1040].velocity.Y -= 0.2f;
					}
					Main.dust[num1040].customData = num1021;
				}
			}
		}
		else if (aiStyle == 127)
		{
			float num1041 = 900f;
			if (type == 657)
			{
				num1041 = 300f;
			}
			if (soundDelay == 0)
			{
				soundDelay = -1;
				SoundEngine.PlaySound(SoundID.Item82, base.Center);
			}
			this.ai[0]++;
			if (this.ai[0] >= num1041)
			{
				Kill();
			}
			if (type == 656 && localAI[0] >= 30f)
			{
				damage = 0;
				if (this.ai[0] < num1041 - 120f)
				{
					float num1042 = this.ai[0] % 60f;
					this.ai[0] = num1041 - 120f + num1042;
					netUpdate = true;
				}
			}
			float num1043 = 15f;
			float num1044 = 15f;
			Point point8 = base.Center.ToTileCoordinates();
			Collision.ExpandVertically(point8.X, point8.Y, out var topY, out var bottomY, (int)num1043, (int)num1044);
			topY++;
			bottomY--;
			Vector2 value18 = new Vector2(point8.X, topY) * 16f + new Vector2(8f);
			Vector2 value19 = new Vector2(point8.X, bottomY) * 16f + new Vector2(8f);
			Vector2 vector154 = Vector2.Lerp(value18, value19, 0.5f);
			Vector2 vector155 = new Vector2(0f, value19.Y - value18.Y);
			vector155.X = vector155.Y * 0.2f;
			width = (int)(vector155.X * 0.65f);
			height = (int)vector155.Y;
			base.Center = vector154;
			if (type == 656 && owner == Main.myPlayer)
			{
				bool flag73 = false;
				Vector2 center20 = Main.player[owner].Center;
				Vector2 top = Main.player[owner].Top;
				for (float num1045 = 0f; num1045 < 1f; num1045 += 0.05f)
				{
					Vector2 position = Vector2.Lerp(value18, value19, num1045);
					if (Collision.CanHitLine(position, 0, 0, center20, 0, 0) || Collision.CanHitLine(position, 0, 0, top, 0, 0))
					{
						flag73 = true;
						break;
					}
				}
				if (!flag73 && this.ai[0] < num1041 - 120f)
				{
					float num1046 = this.ai[0] % 60f;
					this.ai[0] = num1041 - 120f + num1046;
					netUpdate = true;
				}
			}
			if (!(this.ai[0] < num1041 - 120f))
			{
				return;
			}
			for (int num1047 = 0; num1047 < 1; num1047++)
			{
				float value20 = -0.5f;
				float value21 = 0.9f;
				float amount3 = Main.rand.NextFloat();
				Vector2 vector156 = new Vector2(MathHelper.Lerp(0.1f, 1f, Main.rand.NextFloat()), MathHelper.Lerp(value20, value21, amount3));
				vector156.X *= MathHelper.Lerp(2.2f, 0.6f, amount3);
				vector156.X *= -1f;
				Vector2 vector157 = new Vector2(6f, 10f);
				Vector2 vector158 = vector154 + vector155 * vector156 * 0.5f + vector157;
				Dust dust56 = Main.dust[Dust.NewDust(vector158, 0, 0, 269)];
				dust56.position = vector158;
				dust56.customData = vector154 + vector157;
				dust56.fadeIn = 1f;
				dust56.scale = 0.3f;
				if (vector156.X > -1.2f)
				{
					dust56.velocity.X = 1f + Main.rand.NextFloat();
				}
				dust56.velocity.Y = Main.rand.NextFloat() * -0.5f - 1f;
			}
		}
		else if (aiStyle == 128)
		{
			Color newColor4 = new Color(255, 255, 255);
			if (soundDelay == 0)
			{
				soundDelay = -1;
				SoundEngine.PlaySound(SoundID.Item60, base.Center);
			}
			if (localAI[1] < 30f)
			{
				for (int num1048 = 0; num1048 < 1; num1048++)
				{
					float value22 = -0.5f;
					float value23 = 0.9f;
					float amount4 = Main.rand.NextFloat();
					Vector2 vector159 = new Vector2(MathHelper.Lerp(0.1f, 1f, Main.rand.NextFloat()), MathHelper.Lerp(value22, value23, amount4));
					vector159.X *= MathHelper.Lerp(2.2f, 0.6f, amount4);
					vector159.X *= -1f;
					Vector2 vector160 = new Vector2(2f, 10f);
					Vector2 vector161 = base.Center + new Vector2(60f, 200f) * vector159 * 0.5f + vector160;
					Dust dust57 = Main.dust[Dust.NewDust(vector161, 0, 0, 269)];
					dust57.position = vector161;
					dust57.customData = base.Center + vector160;
					dust57.fadeIn = 1f;
					dust57.scale = 0.3f;
					if (vector159.X > -1.2f)
					{
						dust57.velocity.X = 1f + Main.rand.NextFloat();
					}
					dust57.velocity.Y = Main.rand.NextFloat() * -0.5f - 1f;
				}
			}
			if (localAI[0] == 0f)
			{
				localAI[0] = 0.8f;
				direction = 1;
				Point point9 = base.Center.ToTileCoordinates();
				base.Center = new Vector2(point9.X * 16 + 8, point9.Y * 16 + 8);
			}
			rotation = localAI[1] / 40f * ((float)Math.PI * 2f) * (float)direction;
			if (localAI[1] < 33f)
			{
				if (alpha > 0)
				{
					alpha -= 8;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			if (localAI[1] > 103f)
			{
				if (alpha < 255)
				{
					alpha += 16;
				}
				if (alpha > 255)
				{
					alpha = 255;
				}
			}
			if (alpha == 0)
			{
				Lighting.AddLight(base.Center, newColor4.ToVector3() * 0.5f);
			}
			for (int num1049 = 0; num1049 < 2; num1049++)
			{
				if (Main.rand.Next(10) == 0)
				{
					Vector2 vector162 = Vector2.UnitY.RotatedBy((float)num1049 * (float)Math.PI).RotatedBy(rotation);
					Dust dust58 = Main.dust[Dust.NewDust(base.Center, 0, 0, 267, 0f, 0f, 225, newColor4, 1.5f)];
					dust58.noGravity = true;
					dust58.noLight = true;
					dust58.scale = Opacity * localAI[0];
					dust58.position = base.Center;
					dust58.velocity = vector162 * 2.5f;
				}
			}
			for (int num1050 = 0; num1050 < 2; num1050++)
			{
				if (Main.rand.Next(10) == 0)
				{
					Vector2 vector163 = Vector2.UnitY.RotatedBy((float)num1050 * (float)Math.PI);
					Dust dust59 = Main.dust[Dust.NewDust(base.Center, 0, 0, 267, 0f, 0f, 225, newColor4, 1.5f)];
					dust59.noGravity = true;
					dust59.noLight = true;
					dust59.scale = Opacity * localAI[0];
					dust59.position = base.Center;
					dust59.velocity = vector163 * 2.5f;
				}
			}
			if (localAI[1] < 33f || localAI[1] > 87f)
			{
				scale = Opacity / 2f * localAI[0];
			}
			velocity = Vector2.Zero;
			localAI[1]++;
			if (localAI[1] == 60f && owner == Main.myPlayer)
			{
				int num1051 = 30;
				if (Main.expertMode)
				{
					num1051 = 22;
				}
				NewProjectile(GetProjectileSource_FromThis(), base.Center, Vector2.Zero, 657, num1051, 3f, owner);
			}
			if (localAI[1] >= 120f)
			{
				Kill();
			}
		}
		else if (aiStyle == 129)
		{
			float num1052 = 10f;
			float num1053 = 5f;
			float num1054 = 40f;
			int num1055 = 300;
			int num1056 = 180;
			if (type == 659)
			{
				num1055 = 420;
				num1056 = 240;
				num1052 = 3f;
				num1053 = 7.5f;
				num1054 = 1f;
				if (localAI[0] > 0f)
				{
					localAI[0]--;
				}
				if (localAI[0] == 0f && this.ai[0] < 0f && owner == Main.myPlayer)
				{
					localAI[0] = 5f;
					for (int num1057 = 0; num1057 < Main.maxNPCs; num1057++)
					{
						NPC nPC19 = Main.npc[num1057];
						if (nPC19.CanBeChasedBy(this))
						{
							bool flag74 = this.ai[0] < 0f || Main.npc[(int)this.ai[0]].Distance(base.Center) > nPC19.Distance(base.Center);
							if ((flag74 & (nPC19.Distance(base.Center) < 400f)) && (Collision.CanHitLine(base.Center, 0, 0, nPC19.Center, 0, 0) || Collision.CanHitLine(base.Center, 0, 0, nPC19.Top, 0, 0)))
							{
								this.ai[0] = num1057;
							}
						}
					}
					if (this.ai[0] >= 0f)
					{
						timeLeft = num1055;
						netUpdate = true;
					}
				}
				if (timeLeft > 30 && alpha > 0)
				{
					alpha -= 12;
				}
				if (timeLeft > 30 && alpha < 128 && Collision.SolidCollision(base.position, width, height))
				{
					alpha = 128;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (++frameCounter > 4)
				{
					frameCounter = 0;
					if (++frame >= 4)
					{
						frame = 0;
					}
				}
				float num1058 = 0.5f;
				if (timeLeft < 120)
				{
					num1058 = 1.1f;
				}
				if (timeLeft < 60)
				{
					num1058 = 1.6f;
				}
				this.ai[1]++;
				float num1059 = this.ai[1] / 180f * ((float)Math.PI * 2f);
				for (float num1060 = 0f; num1060 < 3f; num1060++)
				{
					if (Main.rand.Next(3) == 0)
					{
						Dust dust60 = Main.dust[Dust.NewDust(base.Center, 0, 0, 27, 0f, -2f)];
						dust60.position = base.Center + Vector2.UnitY.RotatedBy(num1060 * ((float)Math.PI * 2f) / 3f + this.ai[1]) * 10f;
						dust60.noGravity = true;
						dust60.velocity = DirectionFrom(dust60.position);
						dust60.scale = num1058;
						dust60.fadeIn = 0.5f;
						dust60.alpha = 200;
					}
				}
			}
			if (timeLeft > 2 && Collision.SolidCollision(base.position, width, height))
			{
				timeLeft = 2;
			}
			int num1061 = (int)this.ai[0];
			if (num1061 >= 0 && Main.npc[num1061].active)
			{
				if (Distance(Main.npc[num1061].Center) > num1054)
				{
					Vector2 vector164 = DirectionTo(Main.npc[num1061].Center);
					if (vector164.HasNaNs())
					{
						vector164 = Vector2.UnitY;
					}
					velocity = (velocity * (num1052 - 1f) + vector164 * num1053) / num1052;
				}
				return;
			}
			if (this.ai[0] == -1f && timeLeft > 5)
			{
				timeLeft = 5;
			}
			if (this.ai[0] == -2f && timeLeft > num1056)
			{
				timeLeft = num1056;
			}
			if (this.ai[0] >= 0f)
			{
				this.ai[0] = -1f;
				netUpdate = true;
			}
		}
		else if (aiStyle == 130)
		{
			AI_130_FlameBurstTower();
		}
		else if (aiStyle == 131)
		{
			AI_131_FlameBurstShot();
		}
		else if (aiStyle == 132)
		{
			if (localAI[1] == 0f)
			{
				if (localAI[0] == 0f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_DefeatScene, base.Center);
				}
				if (localAI[0] == 105f)
				{
					for (int num1062 = 0; num1062 < 20; num1062++)
					{
						float num1063 = (float)num1062 / 20f;
						Vector2 vector165 = new Vector2(Main.rand.NextFloat() * 10f, 0f).RotatedBy(num1063 * -(float)Math.PI + Main.rand.NextFloat() * 0.1f - 0.05f);
						Gore gore3 = Gore.NewGoreDirect(base.Center + vector165 * 3f, vector165, Utils.SelectRandom<int>(Main.rand, 1027, 1028, 1029, 1030));
						if (gore3.velocity.Y > 0f)
						{
							Gore gore = gore3;
							gore.velocity *= -0.5f;
						}
						if (gore3.velocity.Y < -5f)
						{
							gore3.velocity.Y *= 0.8f;
						}
						gore3.velocity.Y *= 1.1f;
						gore3.velocity.X *= 0.88f;
					}
				}
				if (!Main.dedServ)
				{
					if (!Filters.Scene["CrystalDestructionVortex"].IsActive())
					{
						Filters.Scene.Activate("CrystalDestructionVortex", default(Vector2));
					}
					if (!Filters.Scene["CrystalDestructionColor"].IsActive())
					{
						Filters.Scene.Activate("CrystalDestructionColor", default(Vector2));
					}
					float num1064 = Math.Min(1f, localAI[0] / 120f);
					Filters.Scene["CrystalDestructionColor"].GetShader().UseIntensity(num1064);
					Filters.Scene["CrystalDestructionVortex"].GetShader().UseIntensity(num1064 * 2f).UseProgress(0f)
						.UseTargetPosition(base.Center);
				}
				if (localAI[0] == 120f)
				{
					localAI[0] = 0f;
					localAI[1]++;
				}
			}
			else if (localAI[1] == 1f)
			{
				if (!Main.dedServ)
				{
					float num1065 = localAI[0] / 300f;
					float num1066 = Math.Min(1f, localAI[0] / 150f);
					velocity.Y = num1066 * -0.25f;
					if (!Filters.Scene["CrystalDestructionVortex"].IsActive())
					{
						Filters.Scene.Activate("CrystalDestructionVortex", default(Vector2));
					}
					if (!Filters.Scene["CrystalDestructionColor"].IsActive())
					{
						Filters.Scene.Activate("CrystalDestructionColor", default(Vector2));
					}
					num1066 = 1f;
					Filters.Scene["CrystalDestructionColor"].GetShader().UseIntensity(num1066);
					Filters.Scene["CrystalDestructionVortex"].GetShader().UseIntensity(num1066 * 2f).UseProgress(0f)
						.UseTargetPosition(base.Center);
				}
				if (localAI[0] == 300f)
				{
					localAI[0] = 0f;
					localAI[1]++;
				}
			}
			else if (localAI[1] == 2f)
			{
				float num1067 = localAI[0] / 300f;
				if (Main.netMode != 2)
				{
					Filters.Scene["CrystalDestructionVortex"].GetShader().UseIntensity(2f).UseProgress(num1067 * 30f);
				}
				velocity.Y -= 1f;
				if (localAI[0] == 60f)
				{
					localAI[0] = 0f;
					localAI[1]++;
				}
			}
			else if (localAI[1] == 3f)
			{
				if (!Main.dedServ)
				{
					Filters.Scene.Deactivate("CrystalDestructionVortex");
					Filters.Scene.Deactivate("CrystalDestructionColor");
				}
				Kill();
			}
			if (localAI[1] >= 1f)
			{
				for (int num1068 = 0; num1068 < 1 + (int)(0f - velocity.Y); num1068++)
				{
					if (Main.rand.Next(2) == 0)
					{
						float num1069 = Main.rand.NextFloat() * (0f - velocity.Y);
						Vector2 vector166 = new Vector2(Main.rand.NextFloat() * 0.1f - 0.05f, 0f);
						vector166.X += (float)Math.Sin((double)((base.position.Y + num1069) * 0.01f) + 6.2831854820251465 * ((double)Main.rand.Next(3) / 3.0)) * 0.5f;
						vector166.X = MathHelper.Lerp(Main.rand.NextFloat() - 0.5f, vector166.X, MathHelper.Clamp(0f - velocity.Y, 0f, 1f));
						vector166.Y = 0.5f - Math.Abs(vector166.X);
						vector166 *= new Vector2(100f, 50f);
						vector166.Y += num1069;
						Vector2 vector167 = base.Center + vector166;
						Dust dust61 = Dust.NewDustPerfect(vector167, 27, Vector2.Zero, 0, Color.White * 0.1f, 1.1f);
						dust61.velocity.Y = Main.rand.NextFloat() * 2f;
						dust61.fadeIn = 0.1f;
					}
				}
			}
			localAI[0]++;
		}
		else if (aiStyle == 133)
		{
			if (type == 673)
			{
				if (this.ai[0] == 70f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_SkeletonSummoned, base.Center);
				}
				this.ai[0]++;
				float opacity = 0f;
				if (this.ai[0] < 20f)
				{
					opacity = Utils.GetLerpValue(0f, 20f, this.ai[0], clamped: true);
				}
				else if (this.ai[0] < 60f)
				{
					opacity = 1f;
				}
				else if (this.ai[0] < 80f)
				{
					opacity = Utils.GetLerpValue(80f, 60f, this.ai[0], clamped: true);
				}
				else
				{
					Kill();
				}
				Opacity = opacity;
				_ = owner;
				_ = Main.myPlayer;
			}
			if (type != 674)
			{
				return;
			}
			if (this.ai[0] == 0f)
			{
				SoundEngine.PlayTrackedSound(SoundID.DD2_DarkMageHealImpact, base.Center);
			}
			this.ai[0]++;
			if (!(this.ai[0] >= 40f))
			{
				return;
			}
			for (int num1070 = 0; num1070 < Main.maxNPCs; num1070++)
			{
				NPC nPC20 = Main.npc[num1070];
				if (nPC20.active && nPC20.damage >= 1 && nPC20.lifeMax >= 30 && !(Distance(nPC20.Center) > 1000f) && nPC20.type != 564 && nPC20.type != 565)
				{
					int num1071 = 500;
					int num1072 = nPC20.lifeMax - nPC20.life;
					if (num1071 > num1072)
					{
						num1071 = num1072;
					}
					if (num1071 > 0)
					{
						NPC nPC15 = nPC20;
						nPC15.life += num1071;
						nPC20.HealEffect(num1071);
						nPC20.netUpdate = true;
					}
				}
			}
			Kill();
		}
		else if (aiStyle == 134)
		{
			AI_134_Ballista();
		}
		else if (aiStyle == 135)
		{
			AI_135_OgreStomp();
		}
		else if (aiStyle == 136)
		{
			AI_136_BetsyBreath();
		}
		else if (aiStyle == 137)
		{
			AI_137_LightningAura();
		}
		else if (aiStyle == 138)
		{
			AI_138_ExplosiveTrap();
		}
		else if (aiStyle == 139)
		{
			AI_139_ExplosiveTrapExplosion();
		}
		else if (aiStyle == 140)
		{
			AI_140_MonkStaffT1();
		}
		else if (aiStyle == 141)
		{
			AI_141_MonkStaffT1Explosion();
		}
		else if (aiStyle == 142)
		{
			AI_142_MonkStaffT2And3();
		}
		else if (aiStyle == 143)
		{
			AI_143_MonkStaffT2Ghast();
		}
		else if (aiStyle == 144)
		{
			AI_144_DD2Pet();
		}
		else if (aiStyle == 145)
		{
			AI_145_BookStaffStorm();
		}
		else if (aiStyle == 146)
		{
			AI_146_DD2Victory();
		}
		else if (aiStyle == 147)
		{
			AI_147_Celeb2Rocket();
		}
		else if (aiStyle == 148)
		{
			AI_148_StarSpawner();
		}
		else if (aiStyle == 149)
		{
			AI_149_GolfBall();
		}
		else if (aiStyle == 150)
		{
			AI_150_GolfClubHelper();
		}
		else if (aiStyle == 151)
		{
			AI_151_SuperStar();
		}
		else if (aiStyle == 152)
		{
			AI_152_SuperStarSlash();
		}
		else if (aiStyle == 153)
		{
			AI_153_ToiletPop();
		}
		else if (aiStyle == 154)
		{
			AI_154_VoidLens();
		}
		else if (aiStyle == 155)
		{
			AI_155_MysticSnakeCoil();
		}
		else if (aiStyle == 156)
		{
			AI_156_BatOfLight();
		}
		else if (aiStyle == 157)
		{
			AI_157_SharpTears();
		}
		else if (aiStyle == 158)
		{
			AI_158_BabyBird();
		}
		else if (aiStyle == 159)
		{
			AI_159_PaperAirplanes();
		}
		else if (aiStyle == 160)
		{
			AI_160_Kites();
		}
		else if (aiStyle == 161)
		{
			AI_161_RapierStabs();
		}
		else if (aiStyle == 162)
		{
			AI_162_TigerPounce();
		}
		else if (aiStyle == 163)
		{
			AI_163_Chum();
		}
		else if (aiStyle == 164)
		{
			AI_164_StormTigerGem();
		}
		else if (aiStyle == 165)
		{
			AI_165_Whip();
		}
		else if (aiStyle == 166)
		{
			AI_166_Dove();
		}
		else if (aiStyle == 167)
		{
			AI_167_SparkleGuitar();
		}
		else if (aiStyle == 168)
		{
			AI_168_FirstFractal();
		}
		else if (aiStyle == 169)
		{
			AI_169_Smolstars();
		}
		else if (aiStyle == 170)
		{
			AI_170_FairyGlowstick();
		}
		else if (aiStyle == 171)
		{
			AI_171_HallowBossRainbowStreak();
		}
		else if (aiStyle == 172)
		{
			AI_172_HallowBossRainbowPelletStorm();
		}
		else if (aiStyle == 173)
		{
			AI_173_HallowBossRainbowTrail();
		}
		else if (aiStyle == 174)
		{
			AI_174_MultisegmentPet();
		}
		else if (aiStyle == 175)
		{
			AI_175_TitaniumStormShards();
		}
		else if (aiStyle == 176)
		{
			AI_176_EdgyLightning();
		}
		else if (aiStyle == 177)
		{
			AI_177_IceWhipSlicer();
		}
		else if (aiStyle == 178)
		{
			AI_178_FireExplosion();
		}
		else if (aiStyle == 179)
		{
			AI_179_FairyQueenLance();
		}
		else if (aiStyle == 180)
		{
			AI_180_FairyQueenSunDance();
		}
		else if (aiStyle == 181)
		{
			AI_181_FairyQueenRangedItemShot();
		}
		else if (aiStyle == 182)
		{
			AI_182_FinalFractal();
		}
		else if (aiStyle == 183)
		{
			AI_183_ZoologistStrike();
		}
		else if (aiStyle == 184)
		{
			AI_184_BadTorchLuck();
		}
		else if (aiStyle == 185)
		{
			AI_185_LifeDrain();
		}
		else if (aiStyle == 186)
		{
			AI_186_PrincessWeapon();
		}
		else if (aiStyle == 187)
		{
			AI_187_ShadowHand();
		}
		else if (aiStyle == 188)
		{
			AI_188_LightsBane();
		}
		else if (aiStyle == 189)
		{
			AI_189_Volcano();
		}
		else if (aiStyle == 190)
		{
			AI_190_NightsEdge();
		}
		else if (aiStyle == 191)
		{
			AI_191_TrueNightsEdge();
		}
		else if (aiStyle == 192)
		{
			AI_192_JuminoAnimation();
		}
		else if (aiStyle == 193)
		{
			AI_193_Flamethrower();
		}
		else if (aiStyle == 194)
		{
			AI_194_HorsemanPumpkin();
		}
		else if (aiStyle == 195)
		{
			AI_195_JimsDrone();
		}
		else if (aiStyle == 196)
		{
			AI_196_Petal();
		}
		else if (aiStyle == 197)
		{
			AI_197_CeilingAndHoverTurret();
		}
		else if (aiStyle == 198)
		{
			AI_198_Flint();
		}
		else if (aiStyle == 199)
		{
			AI_199_MeteorOre();
		}
		else if (aiStyle == 200)
		{
			AI_200_BirdDroppings();
		}
		else if (aiStyle == 201)
		{
			AI_201_ThrownMelee();
		}
		else if (aiStyle == 202)
		{
			AI_202_TorchGodHelper();
		}
		else if (aiStyle == 203)
		{
			AI_203_StormLightning();
		}
		else if (aiStyle == 204)
		{
			AI_204_Digtoise();
		}
		else if (aiStyle == 205)
		{
			AI_205_RemoteControlCar();
		}
	}

	private void AI_205_RemoteControlCar()
	{
		Player player = Main.player[owner];
		bool flag = false;
		if (player.dead)
		{
			flag = true;
		}
		if (owner == Main.myPlayer)
		{
			if (position.Y - (float)height <= 640f)
			{
				Kill();
				return;
			}
			if (player.HeldItem.type != 5738)
			{
				flag = true;
			}
			BitsByte bitsByte = (byte)ai[0];
			bool flag2 = bitsByte[4];
			bool flag3 = bitsByte[5];
			bool flag4 = player.gravDir == -1f;
			BitsByte bitsByte2 = (byte)0;
			Player.PlayerInputSyncCache localInputCache = player.LocalInputCache;
			bitsByte2[0] = localInputCache.controlLeft ^ flag4;
			bitsByte2[1] = localInputCache.controlRight ^ flag4;
			bitsByte2[2] = localInputCache.controlUp;
			bitsByte2[3] = localInputCache.controlDown;
			bitsByte2[4] = localInputCache.controlJump;
			if (!flag2 && localInputCache.controlJump && velocity.Y != 0f)
			{
				SoundEngine.PlaySound(22);
				flag3 = !flag3;
				for (int i = 0; i < 2; i++)
				{
					Dust dust = Dust.NewDustDirect(position, width, height, 226);
					dust.noLightEmittence = true;
					dust.scale = 0.6f;
					dust.noGravity = true;
				}
			}
			bitsByte2[5] = flag3;
			float num = (int)(byte)bitsByte2;
			if (ai[0] != num)
			{
				ai[0] = num;
				netUpdate = true;
			}
			Main.DroneCameraTracker.Track(this);
		}
		if (flag)
		{
			Kill();
			return;
		}
		BitsByte bitsByte3 = (byte)ai[0];
		rotation = ai[1];
		bool flag5 = bitsByte3[0];
		bool flag6 = bitsByte3[1];
		bool flag7 = bitsByte3[2];
		bool flag8 = bitsByte3[3];
		bool flag9 = bitsByte3[4];
		bool flag10 = bitsByte3[5];
		bool flag11 = flag5 || flag6 || flag7 || flag8;
		localAI[0] += 1f;
		if (!flag7 && !flag8)
		{
			localAI[0] = 0f;
		}
		bool flag12 = Framing.GetTileSafely((oldPosition + base.Size / 2f).ToTileCoordinates()).wall > 0 && flag10;
		bool flag13 = Framing.GetTileSafely(base.Center.ToTileCoordinates()).wall > 0 && flag10;
		bool num2 = !flag13;
		if (flag13)
		{
			bool flag14 = flag8;
			bool value = flag6;
			bool value2 = flag5;
			float num3 = ((flag7 || flag14) ? 0.037699115f : 0.07539823f);
			float num4 = (float)(flag7.ToInt() - flag14.ToInt()) * 0.275f;
			rotation += (float)(value.ToInt() - value2.ToInt()) * num3;
			velocity += rotation.ToRotationVector2() * num4;
			velocity *= 0.96f;
			if (frame < 4)
			{
				velocity *= 0.5f;
				frame = 4;
				if (direction == -1)
				{
					rotation += (float)Math.PI;
				}
				direction = (spriteDirection = 1);
			}
			int num5 = 999999;
			float num6 = velocity.Length();
			if (num6 >= 0.02f)
			{
				num5 = 16;
			}
			if (num6 >= 0.2f)
			{
				num5 = 12;
			}
			if (num6 >= 0.5f)
			{
				num5 = 10;
			}
			if (num6 >= 0.8f)
			{
				num5 = 8;
			}
			if (num6 >= 1.5f)
			{
				num5 = 6;
			}
			if (num6 >= 3f)
			{
				num5 = 3;
			}
			if (num6 >= 6f)
			{
				num5 = 2;
			}
			if (num6 >= 9f)
			{
				num5 = 1;
			}
			if (flag11)
			{
				num5 = 1;
			}
			if (++frameCounter >= num5)
			{
				frameCounter = 0;
				if (++frame >= 7)
				{
					frame = 4;
				}
			}
			spriteDirection = (direction = 1);
			int num7 = 0;
			if (num4 != 0f)
			{
				num7 = 3;
			}
			else if (num6 > 0.2f)
			{
				num7 = 6;
			}
			else if (flag11)
			{
				num7 = 2;
			}
			if (num7 != 0)
			{
				float num8 = 0.3f;
				float num9 = 10f;
				Vector2 vector = velocity;
				if (num6 < 0.2f)
				{
					vector = rotation.ToRotationVector2() * -4f;
				}
				if (Main.rand.Next(num7) == 0)
				{
					Dust.NewDustPerfect(base.Center + new Vector2(-15f, 0f - num9).RotatedBy(rotation) * scale, 31, vector * 0.2f + Main.rand.NextVector2Circular(num8, num8), 127);
				}
				if (Main.rand.Next(num7) == 0)
				{
					Dust.NewDustPerfect(base.Center + new Vector2(-15f, num9).RotatedBy(rotation) * scale, 31, vector * 0.2f + Main.rand.NextVector2Circular(num8, num8), 127);
				}
			}
			int num10 = 0;
			if (flag11)
			{
				num10 = 100;
			}
			localAI[1] = MathHelper.Lerp(localAI[1], num10, 0.2f);
			float num11 = Utils.Remap(localAI[0], 0f, 5f, 0f, 1f) * Utils.Remap(localAI[0], 5f, 15f, 1f, 0f);
			float num12 = Utils.Clamp(MathHelper.Max(Utils.Remap(localAI[1], 0f, 100f, 0f, 25f), num11 * 12f), 0f, 100f);
			ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2]));
			if (activeSound == null && num12 != 0f)
			{
				localAI[2] = SoundEngine.PlayTrackedLoopedSound(SoundID.RCCar, base.Center, new ProjectileAudioTracker(this).IsActiveAndInGame).ToFloat();
				activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2]));
			}
			if (activeSound != null)
			{
				activeSound.Volume = num12;
				activeSound.Position = base.Center;
				activeSound.Pitch = Utils.Clamp(Utils.Remap(localAI[1], 0f, 100f, -1f, 1f) + num11, -1f, 1f);
			}
			if (velocity.Y == 0f)
			{
				velocity.Y = 0.0001f;
			}
		}
		if (num2)
		{
			bool flag15 = velocity.Y == 0f;
			int num13 = 0;
			if (flag11)
			{
				num13 = 100;
				if (!flag15)
				{
					num13 = 10;
				}
			}
			localAI[1] = MathHelper.Lerp(localAI[1], num13, 0.2f);
			float num14 = Utils.Remap(localAI[0], 0f, 5f, 0f, 1f) * Utils.Remap(localAI[0], 5f, 15f, 1f, 0f);
			float num15 = Utils.Clamp(MathHelper.Max(Utils.Remap(localAI[1], 0f, 100f, 0f, 25f), num14 * 12f), 0f, 100f);
			ActiveSound activeSound2 = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2]));
			if (activeSound2 == null && num15 != 0f)
			{
				localAI[2] = SoundEngine.PlayTrackedLoopedSound(SoundID.RCCar, base.Center, new ProjectileAudioTracker(this).IsActiveAndInGame).ToFloat();
				activeSound2 = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2]));
			}
			if (activeSound2 != null)
			{
				activeSound2.Volume = num15;
				activeSound2.Position = base.Center;
				activeSound2.Pitch = Utils.Clamp(Utils.Remap(localAI[1], 0f, 100f, -1f, 1f) + num14, -1f, 1f);
			}
			float num16 = 0.3f;
			if (flag15)
			{
				float value3 = 0f;
				Tile tileSafely = Framing.GetTileSafely((position + new Vector2(0f, (float)height + 0.02f)).ToTileCoordinates());
				Tile tileSafely2 = Framing.GetTileSafely((position + new Vector2(width, (float)height + 0.02f)).ToTileCoordinates());
				if (tileSafely.blockType() == 2)
				{
					value3 = (float)Math.PI / 4f;
				}
				if (tileSafely2.blockType() == 3)
				{
					value3 = -(float)Math.PI / 4f;
				}
				rotation = MathHelper.Lerp(MathHelper.WrapAngle(rotation), value3, 0.3f);
				velocity.X *= 0.97f;
				int num17 = 0;
				if (flag5)
				{
					num17 = -1;
				}
				if (flag6)
				{
					num17 = 1;
				}
				if (num17 != 0)
				{
					if (spriteDirection != num17)
					{
						localAI[1] = 0f;
					}
					spriteDirection = (direction = num17);
				}
				if (flag9)
				{
					Vector2 vector2 = (rotation - (float)Math.PI / 2f).ToRotationVector2();
					velocity += vector2 * 6f;
					num16 = 0f;
				}
			}
			else if (!flag10)
			{
				float num18 = (float)Math.PI / 15f;
				num18 = Utils.Remap(localAI[0], 0f, 10f, num18 * 0.1f, num18);
				int num19 = flag7.ToInt() - flag8.ToInt();
				rotation += (float)num19 * num18 * (float)spriteDirection;
			}
			if (flag12 && !flag13)
			{
				velocity *= 1.5f;
				rotation = MathHelper.WrapAngle(rotation);
			}
			bool flag16 = !flag15 && frame >= 4 && flag10;
			if ((flag15 || !flag10) && frame >= 4)
			{
				if (!flag15 && velocity.X < 0f)
				{
					direction = (spriteDirection = -1);
					rotation += (float)Math.PI;
				}
				frame = 0;
			}
			float num20 = Math.Abs(velocity.X);
			int num21 = 99999999;
			if (num20 >= 0.02f)
			{
				num21 = 16;
			}
			if (num20 >= 0.2f)
			{
				num21 = 12;
			}
			if (num20 >= 0.5f)
			{
				num21 = 10;
			}
			if (num20 >= 0.8f)
			{
				num21 = 8;
			}
			if (num20 >= 1.5f)
			{
				num21 = 6;
			}
			if (num20 >= 3f)
			{
				num21 = 3;
			}
			if (num20 >= 6f)
			{
				num21 = 2;
			}
			if (num20 >= 9f)
			{
				num21 = 1;
			}
			if (flag11)
			{
				num21 = 1;
			}
			if (!flag16 && ++frameCounter >= num21)
			{
				frameCounter = 0;
				if (++frame >= 4)
				{
					frame = 0;
				}
			}
			velocity.Y += num16;
			float num22 = (flag15 ? 0.3f : 0.1f);
			if (flag5)
			{
				velocity.X -= num22;
			}
			if (flag6)
			{
				velocity.X += num22;
			}
			Vector4 vector3 = Collision.WalkDownSlope(position, velocity, width, height, num16);
			position = new Vector2(vector3.X, vector3.Y);
			velocity = new Vector2(vector3.Z, vector3.W);
			if (flag15 && flag11)
			{
				Vector2 vector4 = position;
				float num23 = 0f;
				int num24 = 3;
				int num25 = 16 * num24;
				for (int j = 0; j < num24; j++)
				{
					Vector2 vector5 = new Vector2(0f, 16f);
					Vector2 vector6 = Collision.TileCollision(vector4 + vector5 * j, vector5, width, height);
					num23 += vector6.Y;
					if (vector6 != vector5)
					{
						break;
					}
				}
				if (num23 != (float)num25)
				{
					for (int k = 0; k < 2; k++)
					{
						if (!(Main.rand.NextFloat() < 0.66f))
						{
							Vector2 vector7 = vector4 + new Vector2(0f, num23) + new Vector2((float)width / 2f, height) + new Vector2((float)(-11 * spriteDirection) * scale, 0f);
							Vector2 value4 = Main.rand.NextVector2CircularEdge(2.5f, 1f) * 0.5f;
							if (value4.Y > 0f)
							{
								value4.Y *= -1f;
							}
							Dust.NewDustPerfect(vector7, 31, value4, 127);
						}
					}
				}
			}
		}
		ai[1] = rotation;
		if (velocity.Length() > 16f)
		{
			velocity *= 16f / velocity.Length();
		}
		Lighting.AddLight(base.Center, Vector3.One * 0.3f);
		timeLeft = 2;
		CheckSectionsInCaseOwnerIsWatching();
	}

	private void AI_204_Digtoise()
	{
		if (!WorldGen.InWorld(base.Center.ToTileCoordinates(), 20))
		{
			Kill();
			return;
		}
		bool flag = ai[0] == 0f;
		bool flag2 = ai[0] == 1f;
		bool flag3 = ai[0] == 2f;
		bool flag4 = ai[0] == 3f;
		bool flag5 = ai[0] == 4f;
		bool flag6 = ai[0] == 5f;
		Player player = Main.player[owner];
		velocity.Y += 2f / 15f;
		if (velocity.Y > 16f)
		{
			velocity.Y = 16f;
		}
		timeLeft = 2;
		if (player.dead || player.noBuilding)
		{
			Kill();
			return;
		}
		if (player.petting.isPetting && player.petting.proj == whoAmI)
		{
			if (!flag6)
			{
				spriteDirection = (direction = ((!(base.Center.X > player.Center.X)) ? 1 : (-1)));
				flag = false;
				flag6 = true;
				ai[0] = 5f;
				ai[1] = 0f;
				SoundEngine.PlaySound(SoundID.PalDigtoiseJoy, base.Center);
			}
		}
		else if (flag6)
		{
			flag = true;
			flag6 = false;
			ai[0] = 0f;
			ai[1] = 0f;
		}
		if (flag)
		{
			if (--soundDelay == -20)
			{
				SoundEngine.PlaySound(SoundID.PalDigtoise, base.Center);
			}
			if (soundDelay == -1)
			{
				SoundEngine.PlaySound(SoundID.PalSummon, base.Center);
			}
		}
		if (flag || flag5 || flag6)
		{
			DoPalAppearEffect(player, withParticles: true);
			if ((!player.active || player.HeldItem.type != 5667) && owner == Main.myPlayer)
			{
				Kill();
			}
			velocity.X *= 0.7f;
			if (ai[1] == 0f && flag)
			{
				spriteDirection = (direction = ((base.Center.X > player.Center.X) ? 1 : (-1)));
			}
			ai[1] += 1f;
			if (flag && ai[1] >= 180f)
			{
				ai[1] = 0f;
				ai[0] = 1f;
				netUpdate = true;
			}
			if (flag5 && ai[1] >= 600f && owner == Main.myPlayer)
			{
				Kill();
			}
			if (frame > 2)
			{
				frame = 2;
			}
			int num = ((frame == 1) ? 60 : 4);
			if (++frameCounter >= num)
			{
				frameCounter = 0;
				frame--;
				if (frame < 0)
				{
					frame = 0;
				}
			}
		}
		bool flag7 = flag2 || flag4 || flag3;
		if (!flag7)
		{
			return;
		}
		alpha = 0;
		int num2 = 0;
		int num3 = 0;
		if (flag2)
		{
			num3 = 1;
		}
		if (flag4)
		{
			num2 = -1;
		}
		if (flag3)
		{
			num2 = 1;
		}
		if (num2 != 0)
		{
			spriteDirection = (direction = num2);
		}
		int num4 = 40;
		if (ai[1] > (float)num4)
		{
			velocity.X += (float)(num2 * 8) / 60f;
			int num5 = 8;
			if (Math.Abs(velocity.X) >= (float)num5)
			{
				velocity.X = ((velocity.X >= 0f) ? num5 : (-num5));
			}
		}
		if (num2 != 0 && ai[1] > (float)num4)
		{
			Point point = (base.Bottom + new Vector2((float)(width * num2) / 2f + (float)(num2 * 2), 2f)).ToTileCoordinates();
			Point point2 = new Point(point.X + num2, point.Y);
			Point point3 = new Point(point.X + num2, point.Y);
			if (!WorldGen.SolidTile3(point.X, point.Y) && !WorldGen.SolidTile3(point2.X, point2.Y) && !WorldGen.SolidTile3(point3.X, point3.Y))
			{
				flag7 = false;
				ai[1] = 0f;
				ai[0] = 4f;
				velocity.X *= 0.5f;
				netUpdate = true;
			}
		}
		Point point4 = (base.Bottom + new Vector2(0f, -15f)).ToTileCoordinates();
		if (flag7 && num2 != 0)
		{
			int num6 = point4.X + num2 * 2;
			bool flag8 = false;
			for (int i = point4.Y - 2; i <= point4.Y; i++)
			{
				if (WorldGen.SolidTile3(num6, i))
				{
					flag8 = true;
				}
			}
			if (flag8)
			{
				if (num2 > 0)
				{
					velocity.X = Math.Min(velocity.X, (float)(num6 * 16) - base.Right.X);
				}
				else
				{
					velocity.X = Math.Max(velocity.X, (float)(num6 * 16 + 16) - base.Left.X);
				}
			}
		}
		if (flag7 && ai[1] > (float)num4)
		{
			if (frame < 2)
			{
				frame = 2;
				localAI[1] = 0f;
				frameCounter = 0;
			}
			int num7 = 4 - (int)(localAI[1] / 4f);
			if (num7 < 1)
			{
				num7 = 1;
			}
			int num8 = ((frame == 2) ? 5 : num7);
			if (++frameCounter >= num8)
			{
				localAI[1] += 1f;
				frameCounter = 0;
				if (++frame >= 10)
				{
					frame = 3;
				}
			}
			if (soundDelay <= 0)
			{
				soundDelay = 10;
				SoundEngine.PlaySound(SoundID.Item190, base.Center);
			}
			bool flag9 = false;
			if (num3 != 0)
			{
				int j = point4.Y + 1;
				for (int k = point4.X - 1; k <= point4.X + 1; k++)
				{
					if (WorldGen.SolidTile3(k, j))
					{
						flag9 = true;
					}
				}
			}
			if (num2 != 0)
			{
				int i2 = point4.X + num2 * 2;
				for (int l = point4.Y - 2; l <= point4.Y; l++)
				{
					if (WorldGen.SolidTile3(i2, l))
					{
						flag9 = true;
					}
				}
			}
			Lighting.AddLight(base.Center, 0.3f, 0.3f, 0.1f);
			if (flag9)
			{
				for (int m = 0; m < 3; m++)
				{
					Dust dust = Dust.NewDustDirect(position + new Vector2(num2 * 20, height / 2), width, height / 2, 213, -num2 * 3, -2f);
					if (Main.rand.Next(3) == 0)
					{
						dust.scale = 2f;
						dust.fadeIn = 3f;
					}
					else
					{
						dust.scale = 3f;
					}
				}
			}
		}
		if (flag7 && ai[1] <= (float)num4)
		{
			ai[1] += 1f;
			frame = 0;
		}
		if (!flag7 || !(ai[1] > (float)num4))
		{
			return;
		}
		ai[1] += 1f;
		if (!(ai[1] >= (float)(num4 + 30)))
		{
			return;
		}
		ai[1] = num4 + 10;
		if (owner != Main.myPlayer)
		{
			return;
		}
		int pickPower = 26;
		int num9 = 0;
		int num10 = 0;
		if (num3 != 0)
		{
			int num11 = point4.Y + 1;
			for (int n = point4.X - 1; n <= point4.X + 1; n++)
			{
				if (WorldGen.SolidTile3(n, num11))
				{
					num10++;
					player.PickTile_DetermineDamage(n, num11, pickPower, Main.tile[n, num11], out var _, out var num12);
					if (num12 > 0)
					{
						num9++;
						player.PickTile(n, num11, pickPower);
					}
				}
			}
		}
		if (num2 != 0)
		{
			int num13 = point4.X + num2 * 2;
			for (int num14 = point4.Y - 2; num14 <= point4.Y; num14++)
			{
				if (WorldGen.SolidTile3(num13, num14))
				{
					num10++;
					player.PickTile_DetermineDamage(num13, num14, pickPower, Main.tile[num13, num14], out var _, out var num15);
					if (num15 > 0)
					{
						num9++;
						player.PickTile(num13, num14, pickPower);
					}
				}
			}
		}
		if (num10 > 0 && num9 < num10)
		{
			ai[1] = 0f;
			ai[0] = 4f;
			netUpdate = true;
		}
	}

	private void DoPalAppearEffect(Player master, bool withParticles)
	{
		if (alpha <= 0)
		{
			return;
		}
		int num = alpha;
		alpha -= 15;
		if (alpha < 0)
		{
			alpha = 0;
		}
		float num2 = 1f - (float)num / 255f;
		float num3 = 1f - (float)alpha / 255f;
		num2 *= 2f;
		num3 *= 2f;
		if (!(num2 < 1f && withParticles))
		{
			return;
		}
		Vector2 value = master.MountedCenter + new Vector2(master.direction * 10, 0f);
		Vector2 tangent = new Vector2(0f, -100f);
		Vector2 tangent2 = new Vector2(0f, -100f);
		Vector2 vector = Vector2.Hermite(value, tangent, base.Center, tangent2, num2);
		Vector2 vector2 = Vector2.Hermite(value, tangent, base.Center, tangent2, num3);
		for (float num4 = 0f; num4 <= 1f; num4 += 0.1f)
		{
			Dust dust = Dust.NewDustPerfect(Vector2.Lerp(vector, vector2, num4), 306, (vector2 - vector) * 0.1f, 0, new Color(100, 227, 255, 127), 1f + num3);
			dust.noGravity = true;
			if (num3 >= 0.9f)
			{
				dust.velocity = Main.rand.NextVector2Circular(3f, 3f);
			}
		}
	}

	public PlayerPettingInfo GetPettingInfo(Player player)
	{
		int num = ((base.Center.X > player.Center.X) ? 1 : (-1));
		int num2 = 36;
		bool isPetSmall = false;
		switch (type)
		{
		case 1098:
			isPetSmall = true;
			num2 = 48;
			break;
		case 1093:
			isPetSmall = false;
			num2 = 24;
			break;
		case 1094:
			isPetSmall = false;
			num2 = 32;
			break;
		}
		return new PlayerPettingInfo(this, new Vector2(-num * num2, 0f), isPetSmall);
	}

	private void AI_003_Boomerang()
	{
		if (type != 383 && !ProjectileID.Sets.IsAPhaseblade[type] && soundDelay == 0)
		{
			if (type == 301)
			{
				if (ai[0] != 0f)
				{
					soundDelay = 10;
					if (extraUpdates > 0)
					{
						soundDelay *= extraUpdates + 1;
					}
					SoundEngine.PlaySound(SoundID.Item7, position, -0.33f);
				}
			}
			else
			{
				soundDelay = 8;
				if (extraUpdates > 0)
				{
					soundDelay *= extraUpdates + 1;
				}
				SoundEngine.PlaySound(SoundID.Item7, position);
			}
		}
		if (type == 19)
		{
			for (int i = 0; i < 2; i++)
			{
				int num = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
				Main.dust[num].noGravity = true;
				Main.dust[num].velocity.X *= 0.3f;
				Main.dust[num].velocity.Y *= 0.3f;
			}
		}
		else if (type == 1000)
		{
			if (Main.rand.Next(3) == 0)
			{
				switch (Main.rand.Next(3))
				{
				default:
				{
					int num2 = Main.rand.Next(3) switch
					{
						1 => 57, 
						2 => 58, 
						_ => 15, 
					};
					Main.dust[Dust.NewDust(position, width, height, num2, velocity.X * 0.25f, velocity.Y * 0.25f, 150, default(Color), 0.7f)].velocity *= 0.5f;
					break;
				}
				case 1:
				{
					Dust obj = Main.dust[Dust.NewDust(position, width, height, 267, velocity.X, velocity.Y, 50, new Color(50, 50, 200), 1.1f)];
					obj.fadeIn = 0.1f;
					obj.velocity = velocity * 0.5f;
					obj.noGravity = true;
					break;
				}
				case 2:
					Main.dust[Dust.NewDust(position, width, height, 76, velocity.X * 0.15f, velocity.Y * 0.15f, 0, default(Color), 1.1f)].noGravity = true;
					Dust.NewDust(position, width, height, 15, velocity.X * 0.05f, velocity.Y * 0.05f, 150, default(Color), 0.6f);
					break;
				}
			}
		}
		else if (type == 867)
		{
			if (Main.rand.Next(3) == 0)
			{
				int num3 = Dust.NewDust(position, width, height, 165, velocity.X, velocity.Y, 50);
				Main.dust[num3].velocity *= 0.5f;
				Main.dust[num3].noGravity = true;
			}
		}
		else if (type == 33)
		{
			if (Main.rand.Next(1) == 0)
			{
				int num4 = Dust.NewDust(position, width, height, 40, velocity.X * 0.25f, velocity.Y * 0.25f, 0, default(Color), 1.4f);
				Main.dust[num4].noGravity = true;
			}
		}
		else if (type == 320)
		{
			if (Main.rand.Next(3) == 0)
			{
				int num5 = Dust.NewDust(position, width, height, 5, velocity.X * 0.25f, velocity.Y * 0.25f, 0, default(Color), 1.1f);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num5].scale = 0.9f;
					Main.dust[num5].velocity *= 0.2f;
				}
				else
				{
					Main.dust[num5].noGravity = true;
				}
			}
		}
		else if (type == 6)
		{
			if (Main.rand.Next(5) == 0)
			{
				int num6 = Main.rand.Next(3);
				Dust.NewDust(position, width, height, num6 switch
				{
					0 => 15, 
					1 => 57, 
					_ => 58, 
				}, velocity.X * 0.25f, velocity.Y * 0.25f, 150, default(Color), 0.7f);
			}
		}
		else if (type == 113 && Main.rand.Next(1) == 0)
		{
			int num7 = Dust.NewDust(position, width, height, 76, velocity.X * 0.15f, velocity.Y * 0.15f, 0, default(Color), 1.1f);
			Main.dust[num7].noGravity = true;
			Dust.NewDust(position, width, height, 15, velocity.X * 0.05f, velocity.Y * 0.05f, 150, default(Color), 0.6f);
		}
		if (ProjectileID.Sets.IsAPhaseblade[type])
		{
			if (timeLeft < 5 && Main.player[owner].active && !Main.player[owner].dead)
			{
				timeLeft = 5;
				if (Main.myPlayer == owner && ai[0] != 1f)
				{
					ai[0] = 1f;
					netUpdate = true;
				}
			}
			if ((double)rotation < Math.PI * -2.0)
			{
				rotation += (float)Math.PI * 2f;
			}
			if ((double)rotation > Math.PI * 2.0)
			{
				rotation -= (float)Math.PI * 2f;
			}
			if (ProjectileID.Sets.IsAPhaseblade[Main.player[owner].HeldItem.shoot] && owner == Main.myPlayer && ai[0] != 1f && Main.player[owner].active && !Main.player[owner].dead && Main.player[owner].controlUseItem)
			{
				ai[0] = 1f;
				netUpdate = true;
			}
			Color color = Item.GetPhaseColor(type) * 0.5f;
			float r = (float)(int)color.R / 255f;
			float g = (float)(int)color.G / 255f;
			float b = (float)(int)color.B / 255f;
			if (type != 1074)
			{
				Lighting.AddLight((int)(base.Center.X / 16f), (int)(base.Center.Y / 16f), r, g, b);
				Lighting.AddLight((int)(base.Center.X / 16f), (int)(base.Center.Y / 16f) - 1, r, g, b);
			}
		}
		if (ai[0] == 0f)
		{
			bool flag = true;
			int num8 = type;
			if (num8 == 866)
			{
				flag = false;
			}
			if (flag)
			{
				ai[1] += 1f;
			}
			if (type == 106 && ai[1] >= 45f)
			{
				ai[0] = 1f;
				ai[1] = 0f;
				netUpdate = true;
			}
			if (ProjectileID.Sets.IsAPhaseblade[type])
			{
				if (ai[1] >= 30f)
				{
					velocity.Y += 1f;
					velocity.X *= 0.96f;
					if (velocity.Y > 16f)
					{
						velocity.Y = 16f;
					}
					if (velocity.Y > 0f)
					{
						if (direction > 0)
						{
							if (rotation <= 2.335f)
							{
								rotation = (rotation * 4f + 2.335f) / 5f;
							}
							else
							{
								rotation = (rotation * 9f + 2.335f + (float)Math.PI * 2f) / 10f;
							}
						}
						else if (rotation >= -3.948f)
						{
							rotation = (rotation * 4f - 3.948f) / 5f;
						}
						else
						{
							rotation = (rotation * 9f - 3.948f - (float)Math.PI * 2f) / 10f;
						}
					}
					else
					{
						rotation += 0.4f * (float)direction;
						if (type == 1074)
						{
							if (soundDelay == 0)
							{
								SoundEngine.PlaySound(SoundID.Item7, position);
								soundDelay = 9;
							}
						}
						else if (soundDelay == 0)
						{
							SoundEngine.PlaySound(SoundID.Item15, position);
							soundDelay = 14;
						}
					}
				}
				else
				{
					rotation += 0.4f * (float)direction;
					if (type == 1074)
					{
						if (soundDelay == 0)
						{
							SoundEngine.PlaySound(SoundID.Item7, position, -0.3f);
							soundDelay = 11;
						}
					}
					else if (soundDelay == 0)
					{
						SoundEngine.PlaySound(SoundID.Item15, position);
						soundDelay = 14;
					}
				}
			}
			else if (type == 320 || type == 383)
			{
				if (ai[1] >= 10f)
				{
					velocity.Y += 0.5f;
					if (type == 383 && velocity.Y < 0f)
					{
						velocity.Y += 0.35f;
					}
					velocity.X *= 0.95f;
					if (velocity.Y > 16f)
					{
						velocity.Y = 16f;
					}
					if (type == 383 && Vector2.Distance(base.Center, Main.player[owner].Center) > 800f)
					{
						ai[0] = 1f;
						netUpdate = true;
					}
				}
			}
			else if (type == 182)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num9 = Dust.NewDust(position, width, height, 57, 0f, 0f, 255, default(Color), 0.75f);
					Main.dust[num9].velocity *= 0.1f;
					Main.dust[num9].noGravity = true;
				}
				if (velocity.X > 0f)
				{
					spriteDirection = 1;
				}
				else if (velocity.X < 0f)
				{
					spriteDirection = -1;
				}
				float num10 = position.X;
				float num11 = position.Y;
				float num12 = 800f;
				bool flag2 = false;
				if (ai[1] > 10f && ai[1] < 360f)
				{
					for (int j = 0; j < Main.maxNPCs; j++)
					{
						if (Main.npc[j].CanBeChasedBy(this))
						{
							float num13 = Main.npc[j].position.X + (float)(Main.npc[j].width / 2);
							float num14 = Main.npc[j].position.Y + (float)(Main.npc[j].height / 2);
							float num15 = Distance(Main.npc[j].Center);
							if (num15 < num12 && Collision.CanHit(new Vector2(position.X + (float)(width / 2), position.Y + (float)(height / 2)), 1, 1, Main.npc[j].position, Main.npc[j].width, Main.npc[j].height))
							{
								num12 = num15;
								num10 = num13;
								num11 = num14;
								flag2 = true;
							}
						}
					}
				}
				if (!flag2)
				{
					num10 = position.X + (float)(width / 2) + velocity.X * 100f;
					num11 = position.Y + (float)(height / 2) + velocity.Y * 100f;
					if (ai[1] >= 30f)
					{
						ai[0] = 1f;
						ai[1] = 0f;
						netUpdate = true;
					}
				}
				float num16 = 0.25f;
				Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num17 = num10 - vector.X;
				float num18 = num11 - vector.Y;
				float num19 = (float)Math.Sqrt(num17 * num17 + num18 * num18);
				num19 = 12f / num19;
				num17 *= num19;
				num18 *= num19;
				if (velocity.X < num17)
				{
					velocity.X += num16;
					if (velocity.X < 0f && num17 > 0f)
					{
						velocity.X += num16 * 2f;
					}
				}
				else if (velocity.X > num17)
				{
					velocity.X -= num16;
					if (velocity.X > 0f && num17 < 0f)
					{
						velocity.X -= num16 * 2f;
					}
				}
				if (velocity.Y < num18)
				{
					velocity.Y += num16;
					if (velocity.Y < 0f && num18 > 0f)
					{
						velocity.Y += num16 * 2f;
					}
				}
				else if (velocity.Y > num18)
				{
					velocity.Y -= num16;
					if (velocity.Y > 0f && num18 < 0f)
					{
						velocity.Y -= num16 * 2f;
					}
				}
			}
			else if (type == 866)
			{
				if (owner == Main.myPlayer && damage > 0)
				{
					float num20 = ai[1];
					if (localAI[0] >= 10f && localAI[0] <= 360f)
					{
						int num21 = FindTargetWithLineOfSight();
						ai[1] = num21;
					}
					else
					{
						ai[1] = -1f;
					}
					if (ai[1] != num20)
					{
						netUpdate = true;
					}
				}
				localAI[0] += 1f;
				int num22 = (int)ai[1];
				Vector2 vector2;
				if (Main.npc.IndexInRange(num22) && Main.npc[num22].CanBeChasedBy(this))
				{
					vector2 = Main.npc[num22].Center;
				}
				else
				{
					vector2 = base.Center + velocity * 100f;
					int num23 = 30;
					if (owner != Main.myPlayer)
					{
						num23 = 60;
					}
					if (localAI[0] >= (float)num23)
					{
						ai[0] = 1f;
						ai[1] = 0f;
						netUpdate = true;
					}
				}
				float num24 = 0.25f;
				Vector2 vector3 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num25 = vector2.X - vector3.X;
				float num26 = vector2.Y - vector3.Y;
				float num27 = (float)Math.Sqrt(num25 * num25 + num26 * num26);
				num27 = 12f / num27;
				num25 *= num27;
				num26 *= num27;
				if (velocity.X < num25)
				{
					velocity.X += num24;
					if (velocity.X < 0f && num25 > 0f)
					{
						velocity.X += num24 * 2f;
					}
				}
				else if (velocity.X > num25)
				{
					velocity.X -= num24;
					if (velocity.X > 0f && num25 < 0f)
					{
						velocity.X -= num24 * 2f;
					}
				}
				if (velocity.Y < num26)
				{
					velocity.Y += num24;
					if (velocity.Y < 0f && num26 > 0f)
					{
						velocity.Y += num24 * 2f;
					}
				}
				else if (velocity.Y > num26)
				{
					velocity.Y -= num24;
					if (velocity.Y > 0f && num26 < 0f)
					{
						velocity.Y -= num24 * 2f;
					}
				}
			}
			else if (type == 301)
			{
				if (Main.player[owner].active && !Main.player[owner].dead && Main.player[owner].controlUseItem)
				{
					if (ai[1] >= 20f)
					{
						ai[0] = 1f;
						ai[1] = 0f;
						velocity = Vector2.Zero;
						netUpdate = true;
					}
				}
				else if (ai[1] >= 100f)
				{
					ai[0] = 1f;
					ai[1] = 0f;
					velocity = Vector2.Zero;
					netUpdate = true;
				}
			}
			else if (ai[1] >= 30f)
			{
				ai[0] = 1f;
				ai[1] = 0f;
				netUpdate = true;
			}
		}
		else if (ProjectileID.Sets.IsAPhaseblade[type] && ai[0] == 2f)
		{
			if (velocity.Y < 0f)
			{
				velocity.Y *= 0.5f;
			}
			rotation = 2.335f;
			velocity.X = 0f;
			velocity.Y += 1f;
			if (localAI[1] == 0f)
			{
				if (type == 1074)
				{
					localAI[0] = -1f;
					SoundEngine.PlaySound(SoundID.Item182, position);
				}
				else
				{
					SoundEngine.PlaySound(SoundID.Item15, position);
				}
				localAI[1] = 1f;
			}
		}
		else
		{
			if (ProjectileID.Sets.IsAPhaseblade[type])
			{
				if (base.Center.X < Main.player[owner].Center.X)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
				rotation = velocity.ToRotation() - 2.335f;
				if (localAI[0] <= 0f)
				{
					if (type == 1074)
					{
						if (localAI[0] < 0f)
						{
							SoundEngine.PlaySound(SoundID.Item182, position, -0.2f);
						}
						else
						{
							SoundEngine.PlaySound(SoundID.Item7, position, -0.5f);
						}
					}
					else
					{
						SoundEngine.PlaySound(SoundID.Item15, position);
					}
					localAI[0] = 1f;
				}
			}
			tileCollide = false;
			float num28 = 9f;
			float num29 = 0.4f;
			if (ProjectileID.Sets.IsAPhaseblade[type])
			{
				num28 = 40f;
				num29 = 3f;
			}
			else if (type == 1000)
			{
				num28 = 9.5f;
			}
			else if (type == 19)
			{
				num28 = 20f;
				num29 = 1.5f;
			}
			else if (type == 33)
			{
				num28 = 18f;
				num29 = 1.2f;
			}
			else if (type == 182)
			{
				num28 = 16f;
				num29 = 1.2f;
			}
			else if (type == 866)
			{
				num28 = 16f;
				num29 = 1.2f;
			}
			else if (type == 106)
			{
				num28 = 16f;
				num29 = 1.2f;
			}
			else if (type == 272)
			{
				num28 = 20f;
				num29 = 1.5f;
			}
			else if (type == 333)
			{
				num28 = 12f;
				num29 = 0.6f;
			}
			else if (type == 301)
			{
				num28 = 15f;
				num29 = 3f;
			}
			else if (type == 320)
			{
				num28 = 15f;
				num29 = 3f;
			}
			else if (type == 383)
			{
				num28 = 16f;
				num29 = 4f;
			}
			Vector2 vector4 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num30 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector4.X;
			float num31 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector4.Y;
			float num32 = (float)Math.Sqrt(num30 * num30 + num31 * num31);
			if (ProjectileID.Sets.IsAPhaseblade[type])
			{
				extraUpdates = (int)(num32 / 3000f);
				if (type == 1074)
				{
					extraUpdates++;
				}
				if (extraUpdates > 20)
				{
					extraUpdates = 20;
				}
			}
			else if (type == 301)
			{
				if (num32 > 6000f)
				{
					Kill();
				}
			}
			else if (num32 > 3000f)
			{
				Kill();
			}
			num32 = num28 / num32;
			num30 *= num32;
			num31 *= num32;
			if (type == 383)
			{
				Vector2 vector5 = new Vector2(num30, num31) - velocity;
				if (vector5 != Vector2.Zero)
				{
					Vector2 vector6 = vector5;
					vector6.Normalize();
					velocity += vector6 * Math.Min(num29, vector5.Length());
				}
			}
			else
			{
				if (velocity.X < num30)
				{
					velocity.X += num29;
					if (velocity.X < 0f && num30 > 0f)
					{
						velocity.X += num29;
					}
				}
				else if (velocity.X > num30)
				{
					velocity.X -= num29;
					if (velocity.X > 0f && num30 < 0f)
					{
						velocity.X -= num29;
					}
				}
				if (velocity.Y < num31)
				{
					velocity.Y += num29;
					if (velocity.Y < 0f && num31 > 0f)
					{
						velocity.Y += num29;
					}
				}
				else if (velocity.Y > num31)
				{
					velocity.Y -= num29;
					if (velocity.Y > 0f && num31 < 0f)
					{
						velocity.Y -= num29;
					}
				}
			}
			if (Main.myPlayer == owner)
			{
				Rectangle rectangle = new Rectangle((int)position.X, (int)position.Y, width, height);
				Rectangle value = new Rectangle((int)Main.player[owner].position.X, (int)Main.player[owner].position.Y, Main.player[owner].width, Main.player[owner].height);
				if (rectangle.Intersects(value))
				{
					Kill();
				}
			}
		}
		if (type == 106)
		{
			rotation += 0.3f * (float)direction;
		}
		else if (type == 866)
		{
			rotation = velocity.ToRotation();
			if (Main.rand.Next(2) == 0)
			{
				int num33 = Dust.NewDust(position, width, height, 212);
				Main.dust[num33].velocity *= 0.1f;
				Main.dust[num33].noGravity = true;
			}
		}
		else if (type == 383)
		{
			if (ai[0] == 0f)
			{
				Vector2 v = velocity;
				v = v.SafeNormalize(Vector2.Zero);
				rotation = (float)Math.Atan2(v.Y, v.X) + 1.57f;
			}
			else
			{
				Vector2 v2 = base.Center - Main.player[owner].Center;
				v2 = v2.SafeNormalize(Vector2.Zero);
				rotation = (float)Math.Atan2(v2.Y, v2.X) + 1.57f;
			}
		}
		else if (type == 301)
		{
			if (ai[0] == 0f)
			{
				rotation = velocity.ToRotation() + (float)Math.PI / 4f;
				if (Main.rand.Next(2) == 0)
				{
					int num34 = Dust.NewDust(position, width, height, 57, velocity.X * 0.2f, velocity.Y * 0.2f, 200, default(Color), 1.2f);
					Main.dust[num34].velocity += velocity * 0.3f;
					Main.dust[num34].velocity *= 0.2f;
					Main.dust[num34].noGravity = true;
				}
				if (Main.rand.Next(3) == 0)
				{
					int num35 = Dust.NewDust(position, width, height, 43, 0f, 0f, 254, default(Color), 0.3f);
					Main.dust[num35].velocity += velocity * 0.5f;
					Main.dust[num35].velocity *= 0.5f;
					Main.dust[num35].noGravity = true;
				}
			}
			else
			{
				rotation += 0.4f * (float)direction;
			}
		}
		else if (!ProjectileID.Sets.IsAPhaseblade[type])
		{
			rotation += 0.4f * (float)direction;
		}
	}

	private void AI_203_StormLightning()
	{
		int num = 240;
		UnpackTargetIndex(ai[0], out var npcIndex, out var playerIndex);
		bool num2 = npcIndex != -1 || playerIndex != -1;
		if (npcIndex != -1)
		{
			NPC nPC = Main.npc[npcIndex];
			if (!nPC.active || nPC.dontTakeDamage || AI_203_TooFar(nPC))
			{
				npcIndex = -1;
			}
		}
		if (playerIndex != -1)
		{
			Player player = Main.player[playerIndex];
			if (!player.active || player.dead || AI_203_TooFar(player) || player.dashDelay < 0)
			{
				playerIndex = -1;
			}
		}
		if (num2 && npcIndex == -1 && playerIndex == -1)
		{
			Kill();
			return;
		}
		_ = ai[1];
		if (npcIndex == -1 && playerIndex == -1)
		{
			Entity entity = null;
			float num3 = 32f;
			float num4 = ((Main.Difficulty < GameDifficultyLevel.Legendary) ? 14 : 32);
			int num5 = ((Main.Difficulty < GameDifficultyLevel.Legendary) ? 5 : 0);
			for (int i = 0; i < Main.maxNPCs; i++)
			{
				if (entity != null)
				{
					break;
				}
				NPC nPC2 = Main.npc[i];
				if (nPC2.active && !nPC2.dontTakeDamage && !(Distance(nPC2.Hitbox.ClosestPointInRect(base.Center)) > num3))
				{
					entity = nPC2;
					npcIndex = nPC2.whoAmI;
				}
			}
			bool flag = localAI[2] >= (float)num5;
			for (int j = 0; j < 255; j++)
			{
				if (entity != null)
				{
					break;
				}
				Player player2 = Main.player[j];
				if (player2.active && !player2.dead && !(Distance(player2.Hitbox.ClosestPointInRect(base.Center)) > num4))
				{
					if (!flag)
					{
						localAI[2] += 1f;
						break;
					}
					entity = player2;
					playerIndex = player2.whoAmI;
				}
			}
			if (entity != null)
			{
				ai[0] = PackTargetIndex(npcIndex, playerIndex);
				netUpdate = true;
			}
		}
		Vector2 center = base.Center;
		Vector2 zero = Vector2.Zero;
		if (npcIndex != -1)
		{
			center = Main.npc[npcIndex].Center;
			zero = Main.npc[npcIndex].velocity;
		}
		if (playerIndex != -1)
		{
			center = Main.player[playerIndex].Center;
			zero = Main.player[playerIndex].velocity;
		}
		base.Center = base.Center.MoveTowards(center, 32f);
		ai[1] += 1f;
		if (ai[1] >= (float)num)
		{
			Kill();
		}
		float num6 = ai[1] / (float)num;
		float num7 = Utils.Remap(num6, 0f, 0.5f, 0f, 1f);
		float num8 = (float)Math.Sqrt(1.0 - Math.Pow(num7 - 1f, 2.0)) * 0.3f;
		Color color = AI_203_GetLightningColor();
		Vector3 rgb = color.ToVector3() * num8;
		Lighting.AddLight(base.Center, rgb);
		if (ai[1] == (float)(int)((float)num * 0.15f))
		{
			SoundEngine.PlaySound(SoundID.NPCHit34, base.Center);
			for (int k = 0; k < 5; k++)
			{
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.StormlightningWindup, new ParticleOrchestraSettings
				{
					PositionInWorld = base.Center,
					MovementVector = zero,
					UniqueInfoPiece = (int)color.PackedValue
				});
			}
		}
		if (Main.rand.NextFloat() <= num6 * 0.2f)
		{
			ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.StormlightningWindup, new ParticleOrchestraSettings
			{
				PositionInWorld = base.Center,
				MovementVector = zero,
				UniqueInfoPiece = (int)color.PackedValue
			});
		}
		for (int l = 0; l < 3; l++)
		{
			if (Main.rand.Next(4) == 0 && !(Main.rand.NextFloat() > num7 * num7 * 0.13f))
			{
				Dust dust = Dust.NewDustDirect(position, width, height, 306, 0f, 0f, 0, new Color(color.R, color.G, color.B, 0));
				dust.velocity = new Vector2(0f, -4f).RotatedByRandom(1.5707963705062866) * (0.5f + 0.2f * Main.rand.NextFloatDirection());
				dust.scale = 1.8f;
				dust.fadeIn = 0f;
				dust.noGravity = Main.rand.Next(3) != 0;
				dust.noLight = (dust.noLightEmittence = true);
				Dust dust2 = Dust.CloneDust(dust);
				dust2.color = new Color(255, 255, 255, 0);
				dust2.scale = 1.3f;
			}
		}
		float num9 = Utils.Remap(num6, 0.7f, 1f, 0f, 1f);
		for (int m = -1; m <= 1; m += 2)
		{
			if (Main.rand.Next(4) == 0 && !(Main.rand.NextFloat() > num9 * 0.2f))
			{
				Dust dust3 = Dust.NewDustPerfect(base.Center, 306, new Vector2(0f, -4f).RotatedBy((float)Math.PI / 4f * (float)m * (1f - num9)));
				dust3.color = new Color(color.R, color.G, color.B, 0);
				dust3.scale = 1.8f;
				dust3.fadeIn = 0f;
				dust3.noGravity = Main.rand.Next(3) != 0;
				dust3.noLight = (dust3.noLightEmittence = true);
				Dust dust4 = Dust.CloneDust(dust3);
				dust4.color = new Color(255, 255, 255, 0);
				dust4.scale = 1.3f;
			}
		}
		for (int n = 0; n < 2; n++)
		{
			if (Main.rand.Next(4) == 0 && !(Main.rand.NextFloat() > 0.2f))
			{
				Dust dust5 = Dust.NewDustPerfect(base.Center, 226);
				dust5.HackFrame(278);
				dust5.color = color;
				dust5.customData = dust5.color;
				dust5.velocity *= 1f + Main.rand.NextFloat() * 2.5f;
				dust5.velocity += new Vector2(0f, -2f);
				dust5.fadeIn = 0f;
				dust5.scale = 0.4f + Main.rand.NextFloat() * 0.5f;
				dust5.velocity.X *= 2f;
				dust5.velocity = Main.rand.NextVector2Circular(3f, 2f) + new Vector2(0f, -2f);
				dust5.noLight = (dust5.noLightEmittence = true);
				dust5.position -= dust5.velocity * 3f;
			}
		}
	}

	public Color AI_203_GetLightningColor()
	{
		return new Color(80, 220, 220);
	}

	private bool AI_203_TooFar(Entity entity)
	{
		return Distance(entity.Center) > 600f;
	}

	private int PackTargetIndex(int npcIndex = -1, int playerIndex = -1)
	{
		if (npcIndex != -1)
		{
			return npcIndex;
		}
		if (playerIndex != -1)
		{
			return -2 - playerIndex;
		}
		return -1;
	}

	private void UnpackTargetIndex(float aiValue, out int npcIndex, out int playerIndex)
	{
		npcIndex = -1;
		playerIndex = -1;
		if (aiValue >= 0f)
		{
			npcIndex = (int)aiValue;
		}
		if (aiValue <= -2f)
		{
			playerIndex = -(int)aiValue - 2;
		}
	}

	private void AI_202_TorchGodHelper()
	{
		int num = (int)ai[1];
		int num2 = (int)ai[2];
		Vector2 vector = new Point(num, num2).ToWorldCoordinates();
		if (vector.Distance(base.Center) < 16f)
		{
			base.Center = vector;
			velocity = Vector2.Zero;
			if (owner == Main.myPlayer && WorldGen.InWorld(num, num2) && Main.tile[num, num2].active() && Main.tile[num, num2].type == 4)
			{
				Main.tile[num, num2].frameY = (short)(ai[0] * 22f);
				NetMessage.SendTileSquare(owner, num, num2, 1);
			}
			Kill();
		}
		if (localAI[0] == 0f)
		{
			localAI[0] = 1f;
			SoundEngine.PlaySound(SoundID.Item8, base.Center);
		}
		int num3 = TorchID.Dust[(int)ai[0]];
		float num4 = 4f;
		for (float num5 = 0f; num5 < num4; num5 += 1f)
		{
			int num6 = Dust.NewDust(position + velocity / num4 * num5, 4, 4, num3, 0f, 0f, 100);
			if (Main.rand.Next(3) != 0)
			{
				Main.dust[num6].noGravity = true;
			}
			Main.dust[num6].velocity *= 0.3f;
			Main.dust[num6].scale *= 1.1f;
			Main.dust[num6].noLightEmittence = true;
			Main.dust[num6].fullBright = true;
			if (num3 == 66)
			{
				Main.dust[num6].color = new Color(Main.DiscoR, Main.DiscoG, Main.DiscoB);
				Main.dust[num6].noGravity = true;
			}
		}
	}

	private void AI_201_ThrownMelee()
	{
		if (localAI[0] == 0f)
		{
			rotation = (float)((double)Main.rand.NextFloat() * Math.PI * 2.0);
			localAI[0] = 1f;
		}
		if (ai[1] == 0f)
		{
			rotation += (float)direction * 0.45f;
			if (ai[0] > 15f)
			{
				velocity.X *= 0.95f;
				velocity.Y += 0.4f;
			}
			else
			{
				ai[0] += 1f;
			}
			return;
		}
		tileCollide = false;
		damage = 0;
		velocity *= 0.6f;
		alpha += 7;
		if (alpha >= 255)
		{
			Kill();
		}
	}

	private void AI_200_BirdDroppings()
	{
		velocity.Y += 0.3f;
		if (velocity.Y > 16f)
		{
			velocity.Y = 16f;
		}
		for (int i = 0; i < 2; i++)
		{
			int num = Dust.NewDust(base.Center, 1, 1, 329);
			Main.dust[num].velocity *= 0.1f;
			if (Main.rand.Next(2) == 0)
			{
				Main.dust[num].scale = Main.rand.NextFloat() * 0.5f + 0.5f;
				Main.dust[num].velocity += velocity;
				Main.dust[num].noGravity = true;
			}
			else
			{
				Main.dust[num].scale = Main.rand.NextFloat() * 0.4f + 0.4f;
				Main.dust[num].velocity *= 0.5f;
				Main.dust[num].velocity += velocity / 2f;
			}
		}
		Rectangle rectangle = new Rectangle((int)position.X, (int)position.Y, width, height);
		for (int j = 0; j < 255; j++)
		{
			if (Main.player[j].active && !Main.player[j].dead)
			{
				Rectangle value = new Rectangle((int)Main.player[j].position.X, (int)Main.player[j].position.Y, Main.player[j].width, Main.player[j].height);
				if (rectangle.Intersects(value))
				{
					Kill();
				}
			}
		}
	}

	private void AI_199_MeteorOre()
	{
		if (localAI[0] == 0f)
		{
			localAI[0] = 1f;
			frame = Main.rand.Next(3);
		}
		int num = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100);
		Main.dust[num].scale = 0.1f + (float)Main.rand.Next(5) * 0.1f;
		Main.dust[num].fadeIn = 1.5f + (float)Main.rand.Next(5) * 0.1f;
		Main.dust[num].noGravity = true;
		if (!wet)
		{
			int num2 = 6;
			Dust dust = Dust.NewDustDirect(position, width, height, num2, 0f, 0f, 100);
			dust.scale = 1f + (float)Main.rand.Next(5) * 0.1f;
			dust.position.X += (float)Main.rand.Next(-40, 41) * 0.1f;
			dust.position.Y += (float)Main.rand.Next(-40, 41) * 0.1f;
			dust.noGravity = true;
		}
		Lighting.AddLight(base.Center, 1f, 0f, 0f);
		rotation += velocity.X * 0.06f;
		rotation += (float)direction * 0.06f;
	}

	private void AI_105_SporeSac()
	{
		float num = 1f - (float)alpha / 255f;
		num *= scale;
		Lighting.AddLight(base.Center, 0.2f * num, 0.275f * num, 0.075f * num);
		bool flag = type == 567 || type == 568;
		localAI[0] += 1f;
		if (localAI[0] >= 90f)
		{
			localAI[0] *= -1f;
		}
		if (localAI[0] >= 0f)
		{
			scale += 0.003f;
		}
		else
		{
			scale -= 0.003f;
		}
		rotation += 0.0025f * scale;
		float num2 = 1f;
		float num3 = 1f;
		if (identity % 6 == 0)
		{
			num3 *= -1f;
		}
		if (identity % 6 == 1)
		{
			num2 *= -1f;
		}
		if (identity % 6 == 2)
		{
			num3 *= -1f;
			num2 *= -1f;
		}
		if (identity % 6 == 3)
		{
			num3 = 0f;
		}
		if (identity % 6 == 4)
		{
			num2 = 0f;
		}
		localAI[1] += 1f;
		if (localAI[1] > 60f)
		{
			localAI[1] = -180f;
		}
		if (localAI[1] >= -60f)
		{
			velocity.X += 0.002f * num3;
			velocity.Y += 0.002f * num2;
		}
		else
		{
			velocity.X -= 0.002f * num3;
			velocity.Y -= 0.002f * num2;
		}
		ai[0] += 1f;
		if (ai[0] > 5400f)
		{
			damage = 0;
			ai[1] = 1f;
			if (alpha < 255)
			{
				alpha += 5;
				if (alpha > 255)
				{
					alpha = 255;
				}
			}
			else if (owner == Main.myPlayer)
			{
				Kill();
			}
		}
		else
		{
			float num4 = (base.Center - Main.player[owner].Center).Length() / 100f;
			if (num4 > 4f)
			{
				num4 *= 1.1f;
			}
			if (num4 > 5f)
			{
				num4 *= 1.2f;
			}
			if (num4 > 6f)
			{
				num4 *= 1.3f;
			}
			if (num4 > 7f)
			{
				num4 *= 1.4f;
			}
			if (num4 > 8f)
			{
				num4 *= 1.5f;
			}
			if (num4 > 9f)
			{
				num4 *= 1.6f;
			}
			if (num4 > 10f)
			{
				num4 *= 1.7f;
			}
			if (flag && !Main.player[owner].sporeSac)
			{
				num4 += 100f;
			}
			ai[0] += num4;
			if (alpha > 50)
			{
				alpha -= 10;
				if (alpha < 50)
				{
					alpha = 50;
				}
			}
		}
		bool flag2 = false;
		Vector2 vector = new Vector2(0f, 0f);
		float num5 = 340f;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (Main.npc[i].CanBeChasedBy(this))
			{
				float num6 = Main.npc[i].position.X + (float)(Main.npc[i].width / 2);
				float num7 = Main.npc[i].position.Y + (float)(Main.npc[i].height / 2);
				float num8 = Math.Abs(position.X + (float)(width / 2) - num6) + Math.Abs(position.Y + (float)(height / 2) - num7);
				if (num8 < num5)
				{
					num5 = num8;
					vector = Main.npc[i].Center;
					flag2 = true;
				}
			}
		}
		if (flag2)
		{
			Vector2 vector2 = vector - base.Center;
			vector2.Normalize();
			vector2 *= 4f;
			velocity = (velocity * 40f + vector2) / 41f;
		}
		else if ((double)velocity.Length() > 0.2)
		{
			velocity *= 0.98f;
		}
	}

	public bool AI_053_HandleSentryNPCTargeting(Vector2 firingOffset, bool straightLine, out int targetSlot, out float x, out float y, float maxDistance = 1000f)
	{
		bool flag = false;
		Vector2 position = base.Center + firingOffset;
		x = position.X;
		y = position.Y;
		targetSlot = -1;
		NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
		if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this))
		{
			Vector2 center = ownerMinionAttackTargetNPC.Center;
			float num = Math.Abs(x - center.X) + Math.Abs(y - center.Y);
			if (num < maxDistance)
			{
				bool flag2 = false;
				if ((!straightLine) ? Collision.CanHit(position, 0, 0, center, 0, 0) : Collision.CanHitLine(position, 0, 0, center, 0, 0))
				{
					maxDistance = num;
					x = center.X;
					y = center.Y;
					flag = true;
					targetSlot = ownerMinionAttackTargetNPC.whoAmI;
				}
			}
		}
		if (!flag)
		{
			for (int i = 0; i < Main.maxNPCs; i++)
			{
				if (!Main.npc[i].CanBeChasedBy(this))
				{
					continue;
				}
				Vector2 center2 = Main.npc[i].Center;
				float num2 = Math.Abs(position.X - center2.X) + Math.Abs(position.Y - center2.Y);
				if (num2 < maxDistance)
				{
					bool flag3 = false;
					if ((!straightLine) ? Collision.CanHit(position, 0, 0, center2, 0, 0) : Collision.CanHitLine(position, 0, 0, center2, 0, 0))
					{
						maxDistance = num2;
						x = center2.X;
						y = center2.Y;
						flag = true;
						targetSlot = Main.npc[i].whoAmI;
					}
				}
			}
		}
		return flag;
	}

	private void AI_197_HandleTileCollision()
	{
		Collision.HitTiles(position, velocity + velocity.SafeNormalize(Vector2.Zero) * 8f, width, height);
		SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
		ai[0] = 1f;
		netUpdate = true;
		if (type != 1025)
		{
			return;
		}
		SoundEngine.PlaySound(SoundID.Item167, position);
		Vector2 vector = position + new Vector2(0f, -22f);
		for (int i = 0; i < 30; i++)
		{
			int num = Dust.NewDust(vector, width, 28, 2, velocity.X, velocity.Y, 0, default(Color), 1.4f + (float)Main.rand.Next(-20, 40) * 0.01f);
			Main.dust[num].alpha = 50;
			Main.dust[num].fadeIn = 0.5f;
			if (i % 3 != 0)
			{
				Main.dust[num].noGravity = true;
			}
			else
			{
				Main.dust[num].scale *= 0.75f;
			}
			Main.dust[num].velocity = Main.rand.NextVector2Circular(5f, 5f) + new Vector2(0f, -2f);
		}
		int num2 = 20;
		Vector2 vector2 = base.Top - Vector2.UnitY * 62f;
		Vector2 vector3 = new Vector2(-num2, 6f);
		Vector2 vector4 = new Vector2(num2, 6f);
		for (int j = 0; j < 3; j++)
		{
			int num3 = 1128;
			Vector2 vector5 = vector2;
			switch (j)
			{
			case 0:
				num3 = 1143;
				vector5 += vector3;
				break;
			case 1:
				num3 = 1137;
				break;
			case 2:
				num3 = 1128;
				vector5 += vector4;
				break;
			}
			Gore gore = Gore.NewGorePerfect(vector5, Main.rand.NextVector2Circular(2f, 2f), num3 + Main.rand.Next(3));
			gore.velocity.Y -= Main.rand.NextFloat();
			gore.velocity *= 2f;
			Gore gore2 = Gore.NewGorePerfect(vector5 + new Vector2(-4 + Main.rand.Next(5), -4 + Main.rand.Next(5)), Main.rand.NextVector2Circular(2f, 2f), num3 + Main.rand.Next(3));
			gore2.velocity.Y -= Main.rand.NextFloat();
			gore2.velocity *= 2f;
			Gore gore3 = Gore.NewGorePerfect(vector5 + new Vector2(-4 + Main.rand.Next(5), -4 + Main.rand.Next(5) + 10), Main.rand.NextVector2Circular(2f, 2f), 1146);
			gore3.velocity.Y -= Main.rand.NextFloat();
			gore3.velocity *= 0.5f;
		}
	}

	private void AI_197_CeilingAndHoverTurret()
	{
		bool flag = type == 1025;
		if (localAI[1] == 0f)
		{
			localAI[1] = 1f;
			if (flag)
			{
				frame = 3;
				int num = 10;
				for (int i = 0; i < 40; i++)
				{
					int num2 = Dust.NewDust(base.Center - new Vector2(num, num), num * 2, num * 2, 2);
					Main.dust[num2].alpha = 100;
					Main.dust[num2].velocity *= 2f;
					Main.dust[num2].noGravity = true;
				}
			}
		}
		int num3 = 15;
		int num4 = 50;
		short num5 = 1026;
		int num6 = damage;
		float num7 = 12f;
		bool flag2 = false;
		Vector2 vector = velocity + new Vector2(0f, -2f);
		bool flag3 = Collision.SolidCollision(position + vector, width, height);
		Point point = base.Top.ToTileCoordinates();
		for (int j = 0; j < num3; j++)
		{
			Point point2 = new Point(point.X, point.Y + j);
			if (!WorldGen.InWorld(point2.X, point2.Y, 2))
			{
				break;
			}
			Tile tile = Main.tile[point2.X, point2.Y];
			if (tile == null || WorldGen.SolidOrSlopedTile(tile))
			{
				flag2 = true;
				break;
			}
		}
		if (Main.myPlayer == owner && ai[0] == 1f && !flag3)
		{
			ai[0] = 0f;
			netUpdate = true;
		}
		if (flag)
		{
			if (ai[0] == 1f)
			{
				if (frame < 0 || frame >= 3)
				{
					frame = Main.rand.Next(3);
				}
			}
			else
			{
				frame = 3;
			}
		}
		if (flag2)
		{
			if (ai[0] == 1f)
			{
				velocity = Vector2.Zero;
			}
			else
			{
				velocity.Y -= 0.1f;
				if (velocity.Y < -12f)
				{
					velocity.Y = -12f;
				}
			}
		}
		else
		{
			velocity *= 0.9f;
			if (velocity.Length() < 0.01f)
			{
				velocity = Vector2.Zero;
			}
		}
		if (Main.myPlayer != owner)
		{
			return;
		}
		int targetSlot = -1;
		float x = -1f;
		float y = -1f;
		Vector2 vector2 = new Vector2(0f, 10f);
		bool straightLine = false;
		int num8 = 1000;
		if (flag)
		{
			num8 += num3 * 16;
		}
		bool flag4 = AI_053_HandleSentryNPCTargeting(vector2, straightLine, out targetSlot, out x, out y, num8);
		localAI[0] += 1f;
		if (localAI[0] >= (float)num4)
		{
			if (!flag4)
			{
				localAI[0] = num4;
				return;
			}
			localAI[0] = 0f;
			NPC obj = Main.npc[targetSlot];
			Vector2 vector3 = base.Center + vector2;
			Vector2 vector4 = (obj.Center - vector3).SafeNormalize(Vector2.Zero) * num7;
			NewProjectile(GetProjectileSource_FromThis(), vector3.X, vector3.Y, vector4.X, vector4.Y, num5, num6, knockBack, owner);
		}
	}

	private void AI_196_Petal()
	{
		int num = 20;
		bool num2 = ai[0] < (float)num;
		if (localAI[0] == 0f)
		{
			localAI[0] = 1f;
			if (Main.netMode != 2)
			{
				SoundEngine.PlaySound(SoundID.Item17, base.Center);
			}
			frame = Main.rand.Next(8);
			spriteDirection = ((!(velocity.X < 0f)) ? 1 : (-1));
			rotation = Main.rand.NextFloat() * ((float)Math.PI * 2f);
			scale = 0.6f + 0.3f * Main.rand.NextFloat();
		}
		if (++frameCounter >= 4)
		{
			frameCounter = 0;
			if (++frame >= 8)
			{
				frame = 0;
			}
		}
		rotation += velocity.X * 0.1f + velocity.Y * 0.1f;
		if (num2)
		{
			ai[0] += 1f;
			velocity *= 0.95f;
			if (ai[0] >= 10f)
			{
				Lighting.AddLight(base.Center, new Vector3(0.5f, 0f, 0.2f));
			}
			return;
		}
		bool flag = false;
		Vector2 vector = new Vector2(0f, 0f);
		float num3 = 340f;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			NPC nPC = Main.npc[i];
			if (nPC.CanBeChasedBy(this))
			{
				float num4 = Distance(nPC.Center);
				if (!(num4 >= num3))
				{
					num3 = num4;
					vector = nPC.Center;
					flag = true;
				}
			}
		}
		if (flag)
		{
			Vector2 vector2 = (vector - base.Center).SafeNormalize(Vector2.Zero) * 8f;
			float num5 = 15f;
			velocity = (velocity * num5 + vector2) / (num5 + 1f);
		}
		else
		{
			velocity.X = MathHelper.Lerp(velocity.X, (float)Math.Sin(ai[0]) * 2.5f, 0.1f);
			velocity.Y = MathHelper.Lerp(velocity.Y, 0.3f, 0.1f);
		}
	}

	private void AI_113_TargetSticker()
	{
		int num = 25;
		if (type == 614)
		{
			num = 63;
		}
		if (alpha > 0)
		{
			alpha -= num;
		}
		if (alpha < 0)
		{
			alpha = 0;
		}
		if (ai[0] == 0f)
		{
			if (type == 1024)
			{
				frameCounter++;
				if (frameCounter > 3)
				{
					frameCounter = 0;
					frame++;
					if (frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
			}
			if (type == 614)
			{
				int num2 = (int)ai[1];
				if (!Main.npc[num2].CanBeChasedBy(this))
				{
					Kill();
					return;
				}
				velocity.ToRotation();
				Vector2 vector = Main.npc[num2].Center - base.Center;
				if (vector != Vector2.Zero)
				{
					vector.Normalize();
					vector *= 14f;
				}
				float num3 = 5f;
				velocity = (velocity * (num3 - 1f) + vector) / num3;
			}
			else
			{
				ai[1] += 1f;
				int num4 = 45;
				if (type == 1024)
				{
					num4 = 60;
				}
				if (ai[1] >= (float)num4)
				{
					float num5 = 0.98f;
					float num6 = 0.35f;
					if (type == 636)
					{
						num5 = 0.995f;
						num6 = 0.15f;
					}
					velocity.X *= num5;
					velocity.Y += num6;
				}
				if (type == 1024)
				{
					if (velocity.Y > 12f)
					{
						velocity.Y = 12f;
					}
					if (ai[1] == 1f)
					{
						frame = Main.rand.Next(Main.projFrames[type]);
						for (int i = 0; i < 6; i++)
						{
							Dust dust = Dust.NewDustDirect(position, width, height, 306, 0f, 0f, 0, Color.Transparent, 0.8f + Main.rand.NextFloat() * 1.7f);
							dust.velocity = velocity.SafeNormalize(Vector2.Zero).RotatedBy((double)ai[2] * Math.PI * 0.10000000149011612) * 8f * (0.1f + Main.rand.NextFloat() * 1.2f);
							dust.color = Color.Lerp(Color.White, new Color(140, 234, 180), (float)i / 10f);
							dust.noGravity = true;
						}
					}
				}
				rotation = velocity.ToRotation() + (float)Math.PI / 2f;
				if (type == 1024)
				{
					rotation -= (float)Math.PI / 2f;
				}
				if (type == 1024)
				{
					float num7 = (float)Math.PI / 30f;
					float num8 = 40f * ai[2];
					double num9 = (double)(num8 * num7 * num7) * (0.0 - Math.Sin(ai[1] * num7));
					if (ai[1] == 1f)
					{
						num9 += (double)(num8 * num7);
					}
					velocity += Vector2.UnitY.RotatedBy(rotation) * (float)num9;
				}
			}
		}
		if (ai[0] == 1f)
		{
			frame = 0;
			int num10 = -1;
			Vector2 center = base.Center;
			ignoreWater = true;
			tileCollide = false;
			int num11 = 15;
			if (type == 636)
			{
				num11 = 5 * MaxUpdates;
			}
			if (type == 971)
			{
				num11 = 9 * MaxUpdates;
			}
			if (type == 975)
			{
				num11 = 9 * MaxUpdates;
			}
			if (type == 1024)
			{
				num11 = 5 * MaxUpdates;
			}
			if (type == 1024 && localAI[0] == 0f)
			{
				for (int j = 0; j < 12; j++)
				{
					Dust dust2 = Dust.NewDustDirect(position, width, height, 306, 0f, 0f, 0, Color.Transparent, 0.8f + Main.rand.NextFloat() * 1.7f);
					dust2.velocity = velocity.SafeNormalize(Vector2.Zero).RotatedBy((float)Math.PI * 2f * (float)j / 12f) * 8f * (0.1f + Main.rand.NextFloat() * 1.2f);
					dust2.color = Color.Lerp(Color.White, new Color(140, 234, 180), (float)j / 10f);
					dust2.noGravity = true;
				}
			}
			bool flag = false;
			bool flag2 = false;
			localAI[0] += 1f;
			if (localAI[0] % 30f == 0f)
			{
				flag2 = true;
			}
			if (type == 1024)
			{
				flag2 = false;
			}
			int num12 = (int)ai[1];
			bool num13 = type == 1024;
			bool flag3 = type == 1024;
			if (num13 && num12 == num10)
			{
				bool flag4 = false;
				try
				{
					int num14 = (int)MathHelper.Clamp((int)(position.X / 16f) - 1, 0f, Main.maxTilesX);
					int num15 = (int)MathHelper.Clamp((int)((position.X + (float)width) / 16f) + 2, 0f, Main.maxTilesX);
					int num16 = (int)MathHelper.Clamp((int)(position.Y / 16f) - 1, 0f, Main.maxTilesY);
					int num17 = (int)MathHelper.Clamp((int)((position.Y + (float)height) / 16f) + 2, 0f, Main.maxTilesY);
					Vector2 vector2 = default(Vector2);
					for (int k = num14; k < num15; k++)
					{
						for (int l = num16; l < num17; l++)
						{
							if (Main.tile[k, l] != null && Main.tile[k, l].nactive() && Main.tileSolid[Main.tile[k, l].type] && !Main.tileSolidTop[Main.tile[k, l].type])
							{
								vector2.X = k * 16;
								vector2.Y = l * 16;
								if (position.X + (float)width + 7f > vector2.X && position.X - 7f < vector2.X + 16f && position.Y + (float)height + 7f > vector2.Y && position.Y - 7f < vector2.Y + 16f)
								{
									velocity = Vector2.Zero;
									flag4 = true;
								}
							}
						}
					}
				}
				catch
				{
				}
				if (!flag4)
				{
					flag = true;
				}
				if (localAI[0] >= (float)(60 * num11))
				{
					flag = true;
				}
			}
			else if (localAI[0] >= (float)(60 * num11))
			{
				flag = true;
			}
			else if (num12 < 0 || num12 >= Main.maxNPCs)
			{
				flag = true;
			}
			else if (Main.npc[num12].active && !Main.npc[num12].dontTakeDamage)
			{
				base.Center = Main.npc[num12].Center - velocity * 2f;
				gfxOffY = Main.npc[num12].gfxOffY;
				if (flag2)
				{
					Main.npc[num12].HitEffect(0, 1.0);
				}
			}
			else
			{
				flag = true;
			}
			if (flag)
			{
				if (flag3)
				{
					velocity = Vector2.Zero;
					ai[0] = 2f;
					netUpdate = true;
					if (type == 1024)
					{
						ResetLocalNPCHitImmunity();
						Damage();
					}
				}
				else
				{
					Kill();
				}
			}
			if (!flag && type == 971)
			{
				if (num12 > 0 && num12 < Main.maxNPCs && timeLeft % 2 == 0)
				{
					Vector2 vector3 = center - velocity.SafeNormalize(Vector2.Zero) * 8f;
					Vector2 value = Main.npc[num12].velocity + new Vector2(Main.rand.NextFloatDirection() * 0.35f, 2.5f);
					Dust dust3 = Dust.NewDustPerfect(vector3, 4, value, 0, new Color(120, 50, 120), 0.65f);
					dust3.fadeIn = 0.25f;
					dust3.noGravity = true;
				}
				if (localAI[1] == 0f)
				{
					localAI[1] = 1f;
					rotation = velocity.ToRotation() + (float)Math.PI / 2f;
					if (type == 1024)
					{
						rotation -= (float)Math.PI / 2f;
					}
				}
			}
			if (!flag && type == 975)
			{
				if (num12 > 0 && num12 < Main.maxNPCs && timeLeft % 2 == 0)
				{
					Vector2 vector4 = velocity.SafeNormalize(Vector2.Zero) * -7f + velocity.SafeNormalize(Vector2.Zero).RotatedByRandom(0.19634954631328583);
					Dust dust4 = Dust.NewDustPerfect(center, 5, Vector2.Zero, 0, default(Color), 1.5f);
					dust4.scale = 1.1f;
					dust4.velocity = vector4 * 0.85f + new Vector2(0f, 0.85f);
					Vector2 spinningpoint = dust4.velocity;
					dust4.velocity = spinningpoint.RotatedBy((float)Math.PI * 2f * Main.rand.NextFloatDirection() * 0.025f);
					dust4 = Dust.CloneDust(dust4.dustIndex);
					dust4.velocity = spinningpoint.RotatedBy((float)Math.PI * 2f * Main.rand.NextFloatDirection() * 0.025f);
					dust4.position += dust4.velocity;
					if (Main.rand.Next(3) == 0)
					{
						dust4 = Dust.CloneDust(dust4.dustIndex);
						dust4.velocity = dust4.velocity.RotatedByRandom(0.39269909262657166) * 0.9f;
					}
				}
				if (localAI[1] == 0f)
				{
					localAI[1] = 1f;
					rotation = velocity.ToRotation() + (float)Math.PI / 2f;
					if (type == 1024)
					{
						rotation -= (float)Math.PI / 2f;
					}
					Vector2 vector5 = center;
					for (int m = 0; m < 10; m++)
					{
						Vector2 vector6 = Main.rand.NextVector2CircularEdge(4f, 4f);
						Dust dust5 = Dust.NewDustPerfect(vector5, 5, Vector2.Zero, 0, default(Color), 1.5f);
						dust5.scale = 1.5f;
						dust5.velocity = vector6;
						dust5.noGravity = true;
					}
				}
			}
		}
		if (ai[0] == 2f)
		{
			if (type == 1024)
			{
				frameCounter++;
				if (frameCounter > 3)
				{
					frameCounter = 0;
					frame++;
					if (frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
			}
			tileCollide = false;
			Player player = Main.player[owner];
			if (!player.active || player.dead || player.Hitbox.Intersects(base.Hitbox))
			{
				Kill();
				return;
			}
			velocity = (player.Center - base.Center).SafeNormalize(Vector2.Zero) * 16f;
			rotation = velocity.ToRotation() + (float)Math.PI / 2f;
			if (type == 1024)
			{
				rotation -= (float)Math.PI / 2f;
			}
			if (type == 1024 && localAI[1] == 0f)
			{
				localAI[1] += 1f;
				for (int n = 0; n < 6; n++)
				{
					Dust dust6 = Dust.NewDustDirect(position, width, height, 306, 0f, 0f, 0, Color.Transparent, 0.8f + Main.rand.NextFloat() * 1.7f);
					dust6.velocity = velocity.SafeNormalize(Vector2.Zero) * 3f * (-1f + Main.rand.NextFloat() * 2f) + Main.rand.NextVector2Circular(1f, 1f);
					dust6.color = Color.Lerp(Color.White, new Color(140, 234, 180), (float)n / 10f);
					dust6.noGravity = true;
					dust6.position = base.Center;
				}
			}
		}
		if (type == 614)
		{
			Lighting.AddLight(base.Center, 0.2f, 0.6f, 0.7f);
		}
		if (type == 636)
		{
			Lighting.AddLight(base.Center, 0.8f, 0.7f, 0.4f);
		}
		AI_113_UpdateDrawLayer();
	}

	private void AI_113_UpdateDrawLayer()
	{
		if (type == 614 || type == 975)
		{
			return;
		}
		drawLayer = 3;
		if (ai[0] != 1f)
		{
			return;
		}
		int num = (int)ai[1];
		if (num >= 0 && num < Main.maxNPCs)
		{
			NPC nPC = Main.npc[num];
			if (nPC.active && nPC.type != 492)
			{
				drawLayer = (nPC.behindTiles ? 1 : 2);
			}
		}
	}

	private void AI_195_JimsDrone()
	{
		Player player = Main.player[owner];
		bool flag = false;
		if (player.dead)
		{
			flag = true;
		}
		if (owner == Main.myPlayer)
		{
			if (position.Y - (float)height <= 640f)
			{
				Kill();
				return;
			}
			if (player.HeldItem.type != 5451)
			{
				flag = true;
			}
			bool flag2 = player.gravDir == -1f;
			BitsByte bitsByte = (byte)0;
			Player.PlayerInputSyncCache localInputCache = player.LocalInputCache;
			bitsByte[0] = localInputCache.controlLeft ^ flag2;
			bitsByte[1] = localInputCache.controlRight ^ flag2;
			bitsByte[2] = localInputCache.controlUp;
			bitsByte[3] = localInputCache.controlDown;
			float num = (int)(byte)bitsByte;
			if (ai[0] != num)
			{
				ai[0] = num;
				netUpdate = true;
			}
			Main.DroneCameraTracker.Track(this);
		}
		if (flag)
		{
			Kill();
			return;
		}
		BitsByte bitsByte2 = (byte)ai[0];
		rotation = ai[1];
		bool flag3 = bitsByte2[0];
		bool flag4 = bitsByte2[1];
		bool flag5 = bitsByte2[2];
		_ = bitsByte2[3];
		localAI[0] += 1f;
		if (!flag3 && !flag4)
		{
			localAI[0] = 0f;
		}
		bool flag6 = velocity.Y == 0f;
		int num2 = 0;
		if (!flag6)
		{
			num2 = 10;
		}
		if (flag5)
		{
			num2 = 100;
		}
		localAI[1] = MathHelper.Lerp(localAI[1], num2, 0.2f);
		float num3 = Utils.Remap(localAI[0], 0f, 5f, 0f, 1f) * Utils.Remap(localAI[0], 5f, 15f, 1f, 0f);
		float num4 = Utils.Clamp(MathHelper.Max(Utils.Remap(localAI[1], 0f, 100f, 0f, 25f), num3 * 12f), 0f, 100f);
		ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2]));
		if (activeSound == null && num4 != 0f)
		{
			localAI[2] = SoundEngine.PlayTrackedLoopedSound(SoundID.JimsDrone, base.Center, new ProjectileAudioTracker(this).IsActiveAndInGame).ToFloat();
			activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2]));
		}
		if (activeSound != null)
		{
			activeSound.Volume = num4;
			activeSound.Position = base.Center;
			activeSound.Pitch = Utils.Clamp(Utils.Remap(localAI[1], 0f, 100f, -1f, 1f) + num3, -1f, 1f);
		}
		float num5 = 0.15f;
		if (flag6)
		{
			rotation = MathHelper.WrapAngle(rotation) * 0.7f;
			velocity.X *= 0.97f;
			if (flag5)
			{
				Vector2 vector = (rotation - (float)Math.PI / 2f).ToRotationVector2();
				velocity += vector * 0.5f;
				num5 = 0.05f;
			}
		}
		else
		{
			float num6 = (float)Math.PI / 15f;
			num6 = Utils.Remap(localAI[0], 0f, 10f, num6 * 0.1f, num6);
			int num7 = flag4.ToInt() - flag3.ToInt();
			rotation += (float)num7 * num6;
			if (flag5)
			{
				Vector2 vector2 = (rotation - (float)Math.PI / 2f).ToRotationVector2();
				velocity.X *= 0.97f;
				velocity += vector2 * 0.5f;
			}
		}
		velocity.Y += num5;
		ai[1] = rotation;
		if (!flag5 && velocity.Y > 12f)
		{
			velocity.Y *= 0.95f;
		}
		if (velocity.Length() > 16f)
		{
			velocity *= 16f / velocity.Length();
		}
		Lighting.AddLight(base.Center, Vector3.One * 0.3f);
		timeLeft = 2;
		if (!flag6)
		{
			Vector2 vector3 = position;
			float num8 = 0f;
			int num9 = 3;
			int num10 = 16 * num9;
			for (int i = 0; i < num9; i++)
			{
				Vector2 vector4 = new Vector2(0f, 16f);
				Vector2 vector5 = Collision.TileCollision(vector3 + vector4 * i, vector4, width, height);
				num8 += vector5.Y;
				if (vector5 != vector4)
				{
					break;
				}
			}
			if (num8 != (float)num10)
			{
				for (int j = 0; j < 2; j++)
				{
					if (!(Main.rand.NextFloat() < 0.66f))
					{
						Vector2 vector6 = vector3 + new Vector2(0f, num8) + new Vector2((float)width / 2f, height);
						Vector2 value = Main.rand.NextVector2CircularEdge(2.5f, 1f) * 0.5f;
						if (value.Y > 0f)
						{
							value.Y *= -1f;
						}
						Dust.NewDustPerfect(vector6, (Main.rand.Next(2) == 0) ? 31 : 16, value, 127);
					}
				}
			}
		}
		CheckSectionsInCaseOwnerIsWatching();
	}

	public static void UseGasTrapInChest(int chestIndex, Chest theChest, int gasTrapIndex, int gasOffsetX, int gasOffsetY)
	{
		if (Main.netMode == 1)
		{
			return;
		}
		bool flag = false;
		int num = -1;
		for (int i = 0; i < theChest.maxItems; i++)
		{
			Item item = theChest.item[i];
			if (item == null)
			{
				continue;
			}
			if (item.IsAir)
			{
				if (num == -1)
				{
					num = i;
				}
			}
			else if (item.type == 5356 && item.stack < item.maxStack)
			{
				flag = true;
				item.stack++;
				if (Main.netMode != 0)
				{
					NetMessage.SendData(32, -1, -1, null, chestIndex, i);
				}
				break;
			}
		}
		theChest.item[gasTrapIndex].stack--;
		if (theChest.item[gasTrapIndex].stack <= 0)
		{
			if (flag)
			{
				theChest.item[gasTrapIndex].TurnToAir();
			}
			else
			{
				flag = true;
				theChest.item[gasTrapIndex].SetDefaults(5356);
			}
		}
		if (Main.netMode != 0)
		{
			NetMessage.SendData(32, -1, -1, null, chestIndex, gasTrapIndex);
		}
		if (!flag && num > -1)
		{
			flag = true;
			theChest.item[num].SetDefaults(5356);
			if (Main.netMode != 0)
			{
				NetMessage.SendData(32, -1, -1, null, chestIndex, num);
			}
		}
		if (!flag)
		{
			Item.NewItem(pos: new Vector2(theChest.x * 16 + gasOffsetX, theChest.y * 16 + gasOffsetY), source: new EntitySource_OverfullChest(theChest.x, theChest.y, theChest), randomBox: Vector2.One, Type: 5356);
		}
	}

	private void AI_111_DryadsWard()
	{
		if (!Main.npc[(int)ai[1]].active || Main.npc[(int)ai[1]].type != 20 || Main.npc[(int)ai[1]].ai[0] != 14f)
		{
			Kill();
			return;
		}
		ai[0] += 1f;
		rotation += (float)Math.PI / 300f;
		scale = ai[0] / 100f;
		if (scale > 1f)
		{
			scale = 1f;
		}
		alpha = (int)(255f * (1f - scale));
		float num = 300f;
		if (ai[0] >= 100f)
		{
			num = MathHelper.Lerp(300f, 600f, (ai[0] - 100f) / 200f);
		}
		if (num > 600f)
		{
			num = 600f;
		}
		if (ai[0] >= 500f)
		{
			alpha = (int)MathHelper.Lerp(0f, 255f, (ai[0] - 500f) / 100f);
			num = MathHelper.Lerp(600f, 1200f, (ai[0] - 500f) / 100f);
			rotation += (float)Math.PI / 300f;
		}
		int num2 = 163;
		if (ai[2] == 1f)
		{
			float num3 = (float)Math.Sin(ai[0] % 120f * ((float)Math.PI * 2f) / 120f) * 0.5f + 0.5f;
			if (Main.rand.NextFloat() < num3)
			{
				num2 = 70;
			}
		}
		if (Main.rand.Next(4) == 0)
		{
			float num4 = num;
			Vector2 vector = new Vector2(Main.rand.Next(-10, 11), Main.rand.Next(-10, 11));
			float num5 = Main.rand.Next(3, 9);
			vector.Normalize();
			int num6 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num2, 0f, 0f, 100);
			Main.dust[num6].noGravity = true;
			Main.dust[num6].position = base.Center + vector * num4;
			if (Main.rand.Next(8) == 0)
			{
				Main.dust[num6].velocity = vector * (0f - num5) * 3f;
				Main.dust[num6].scale += 0.5f;
			}
			else
			{
				Main.dust[num6].velocity = vector * (0f - num5);
			}
		}
		if (Main.rand.Next(2) == 0)
		{
			Vector2 vector2 = new Vector2(Main.rand.Next(-10, 11), Main.rand.Next(-10, 11));
			float num7 = Main.rand.Next(3, 9);
			vector2.Normalize();
			int num8 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num2, 0f, 0f, 100, default(Color), 1.5f);
			Main.dust[num8].noGravity = true;
			Main.dust[num8].position = base.Center + vector2 * 30f;
			if (Main.rand.Next(8) == 0)
			{
				Main.dust[num8].velocity = vector2 * (0f - num7) * 3f;
				Main.dust[num8].scale += 0.5f;
			}
			else
			{
				Main.dust[num8].velocity = vector2 * (0f - num7);
			}
		}
		if (ai[0] >= 30f && Main.netMode != 2)
		{
			Player player = Main.player[Main.myPlayer];
			if (player.active && !player.dead && Distance(player.Center) <= num && player.FindBuffIndex(165) == -1)
			{
				player.AddBuff(165, 120);
			}
		}
		if (ai[0] >= 30f && ai[0] % 10f == 0f && Main.netMode != 1)
		{
			for (int i = 0; i < Main.maxNPCs; i++)
			{
				NPC nPC = Main.npc[i];
				if (nPC.type != 488 && nPC.active && Distance(nPC.Center) <= num)
				{
					if (nPC.townNPC && (nPC.FindBuffIndex(165) == -1 || nPC.buffTime[nPC.FindBuffIndex(165)] <= 20))
					{
						nPC.AddBuff(165, 120);
					}
					else if (!nPC.friendly && nPC.lifeMax > 5 && !nPC.dontTakeDamage && (nPC.FindBuffIndex(186) == -1 || nPC.buffTime[nPC.FindBuffIndex(186)] <= 20) && (nPC.dryadBane || Collision.CanHit(base.Center, 1, 1, nPC.position, nPC.width, nPC.height)))
					{
						nPC.AddBuff(186, 120);
					}
				}
			}
		}
		if (ai[0] >= 570f)
		{
			Kill();
		}
	}

	public static bool GasTrapCheck(int x, int y, Player user)
	{
		if (Main.netMode == 1)
		{
			return false;
		}
		int num = Chest.FindChest(x, y);
		if (num < 0)
		{
			return false;
		}
		Chest chest = Main.chest[num];
		int num2 = 16;
		int num3 = 16;
		bool flag = false;
		for (int i = 0; i < chest.maxItems; i++)
		{
			ushort num4 = Main.tile[chest.x, chest.y].type;
			if (TileObjectData.CustomPlace(num4, 0))
			{
				TileObjectData tileData = TileObjectData.GetTileData(num4, 0);
				if (tileData != null)
				{
					int num5 = (int)Math.Ceiling((float)tileData.Width / 2f);
					int num6 = (int)Math.Ceiling((float)tileData.Width / 2f);
					num2 = num5 * 16;
					num3 = num6 * 16;
					if (num5 % 2 != 0)
					{
						num2 += 8;
					}
					if (num6 % 2 != 0)
					{
						num3 += 8;
					}
				}
			}
			if (chest.item[i] != null && chest.item[i].type == 5346)
			{
				UseGasTrapInChest(num, chest, i, num2, num3);
				flag = true;
				break;
			}
		}
		if (flag)
		{
			num3 -= 8;
			NewProjectile(position: new Vector2(x * 16 + num2, y * 16 + num3), spawnSource: user.GetProjectileSource_TileInteraction(x, y), velocity: Vector2.Zero, Type: 1007, Damage: 10, KnockBack: 0f, Owner: Main.myPlayer);
		}
		return flag;
	}

	private void AI_194_HorsemanPumpkin()
	{
		int num = (int)ai[0];
		Vector2 center = base.Center;
		if (Main.player.IndexInRange(num))
		{
			Player player = Main.player[num];
			if (player.active && !player.dead)
			{
				center = player.Center;
			}
		}
		Vector2 vector = center - base.Center;
		int num2 = 30;
		float num3 = 4f;
		float num4 = 5f;
		float num5 = 0.4f;
		float num6 = 0.4f;
		if (!(vector.Y < (float)num2) || !(vector.Y > (float)(-num2)))
		{
			float num7 = (float)Math.Sign(vector.Y) * num6;
			velocity.Y = Utils.Clamp(velocity.Y + num7, 0f - num4, num4);
		}
		velocity.X = Utils.Clamp(velocity.X + (float)Math.Sign(vector.X) * num5, 0f - num3, num3);
		rotation = velocity.ToRotation();
		spriteDirection = ((!(velocity.X < 0f)) ? 1 : (-1));
		if (timeLeft < 6)
		{
			Opacity -= 0.1f;
		}
		else
		{
			Opacity += 1f / 30f;
		}
		if (Main.rand.Next(3) != 0)
		{
			Dust dust = Dust.NewDustDirect(position, width, height, 6, velocity.X, velocity.Y);
			dust.scale = 0.6f;
			dust.fadeIn = 1.1f;
			dust.noGravity = true;
			dust.noLight = true;
		}
	}

	private void AI_193_Flamethrower()
	{
		localAI[0] += 1f;
		int num = 60;
		int num2 = 12;
		int num3 = num + num2;
		if (localAI[0] >= (float)num3)
		{
			Kill();
		}
		if (localAI[0] >= (float)num)
		{
			velocity *= 0.95f;
		}
		bool flag = ai[0] == 1f;
		int num4 = 50;
		int num5 = num4;
		if (flag)
		{
			num4 = 0;
			num5 = num;
		}
		int num6 = 60;
		int num7 = 50;
		float num8 = 0.25f;
		float num9 = 0.5f;
		if (type == 1106)
		{
			num6 = 15;
			num7 = 15;
			num8 *= 0.5f;
			if (soundDelay == 0 && whoAmI % 3 == 0)
			{
				soundDelay = -1;
				SoundEngine.PlaySound(SoundID.FoxparksFlame, base.Center);
			}
		}
		if (localAI[0] < (float)num5 && Main.rand.NextFloat() < num8)
		{
			short num10 = (short)(flag ? 135 : 6);
			Dust dust = Dust.NewDustDirect(base.Center + Main.rand.NextVector2Circular(num6, num6) * Utils.Remap(localAI[0], 0f, 72f, 0.5f, 1f), 4, 4, num10, velocity.X * 0.2f, velocity.Y * 0.2f, 100);
			if (Main.rand.Next(4) == 0)
			{
				dust.noGravity = true;
				dust.scale *= 3f;
				dust.velocity.X *= 2f;
				dust.velocity.Y *= 2f;
			}
			else
			{
				dust.scale *= 1.5f;
			}
			dust.scale *= 1.5f;
			dust.velocity *= 1.2f;
			dust.velocity += velocity * 1f * Utils.Remap(localAI[0], 0f, (float)num * 0.75f, 1f, 0.1f) * Utils.Remap(localAI[0], 0f, (float)num * 0.1f, 0.1f, 1f);
			dust.customData = 1;
		}
		if (num4 > 0 && localAI[0] >= (float)num4 && Main.rand.NextFloat() < num9)
		{
			Vector2 center = Main.player[owner].Center;
			Vector2 vector = (base.Center - center).SafeNormalize(Vector2.Zero).RotatedByRandom(0.19634954631328583) * 7f;
			short num11 = 31;
			Dust dust2 = Dust.NewDustDirect(base.Center + Main.rand.NextVector2Circular(num7, num7) - vector * 2f, 4, 4, num11, 0f, 0f, 150, new Color(80, 80, 80));
			dust2.noGravity = true;
			dust2.velocity = vector;
			dust2.scale *= 1.1f + Main.rand.NextFloat() * 0.2f;
			dust2.customData = -0.3f - 0.15f * Main.rand.NextFloat();
		}
	}

	private void AI_047_MagnetSphere()
	{
		if (ai[0] == 0f)
		{
			ai[0] = velocity.X;
			ai[1] = velocity.Y;
		}
		if (velocity.X > 0f)
		{
			rotation += (Math.Abs(velocity.Y) + Math.Abs(velocity.X)) * 0.001f;
		}
		else
		{
			rotation -= (Math.Abs(velocity.Y) + Math.Abs(velocity.X)) * 0.001f;
		}
		frameCounter++;
		if (frameCounter > 6)
		{
			frameCounter = 0;
			frame++;
			if (frame > 4)
			{
				frame = 0;
			}
		}
		if (velocity.Length() > 2f)
		{
			velocity *= 0.98f;
		}
		for (int i = 0; i < 1000; i++)
		{
			if (i != whoAmI)
			{
				Projectile projectile = Main.projectile[i];
				if (projectile.active && projectile.owner == owner && projectile.type == type && timeLeft > Main.projectile[i].timeLeft && Main.projectile[i].timeLeft > 30)
				{
					Main.projectile[i].timeLeft = 30;
				}
			}
		}
		AI_047_MagnetSphere_TryAttacking();
	}

	private void AI_047_MagnetSphere_TryAttacking()
	{
		if (owner != Main.myPlayer)
		{
			return;
		}
		int[] array = new int[20];
		int num = 0;
		float num2 = 300f;
		bool flag = false;
		float num3 = 0f;
		float num4 = 0f;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (!Main.npc[i].CanBeChasedBy(this))
			{
				continue;
			}
			float num5 = Main.npc[i].position.X + (float)(Main.npc[i].width / 2);
			float num6 = Main.npc[i].position.Y + (float)(Main.npc[i].height / 2);
			if (Math.Abs(position.X + (float)(width / 2) - num5) + Math.Abs(position.Y + (float)(height / 2) - num6) < num2 && Collision.CanHit(base.Center, 1, 1, Main.npc[i].Center, 1, 1))
			{
				if (num < 20)
				{
					array[num] = i;
					num++;
					num3 = num5;
					num4 = num6;
				}
				flag = true;
			}
		}
		if (timeLeft < 30)
		{
			flag = false;
		}
		if (flag)
		{
			int num7 = Main.rand.Next(num);
			num7 = array[num7];
			num3 = Main.npc[num7].position.X + (float)(Main.npc[num7].width / 2);
			num4 = Main.npc[num7].position.Y + (float)(Main.npc[num7].height / 2);
			localAI[0] += 1f;
			if (localAI[0] > 8f)
			{
				localAI[0] = 0f;
				Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				vector += velocity * 4f;
				float num8 = num3 - vector.X;
				float num9 = num4 - vector.Y;
				float num10 = (float)Math.Sqrt(num8 * num8 + num9 * num9);
				num10 = 6f / num10;
				num8 *= num10;
				num9 *= num10;
				NewProjectile(GetProjectileSource_FromThis(), vector.X, vector.Y, num8, num9, 255, damage, knockBack, owner);
			}
		}
	}

	public static void AI_192_GetJuminoFall(Projectile proj, out float timeSinceFall, out float fall)
	{
		int num = 420;
		timeSinceFall = proj.ai[0] - (float)num;
		if (timeSinceFall < 0f)
		{
			timeSinceFall = 0f;
		}
		int num2 = 24;
		int num3 = -4;
		float num4 = 0.2f;
		fall = (float)num3 * timeSinceFall + num4 * (timeSinceFall * timeSinceFall) / 2f;
		if (fall > (float)num2)
		{
			fall = num2;
		}
	}

	private void AI_192_JuminoAnimation()
	{
		float num = 120f;
		float num2 = 420f + num;
		float num3 = num2 - 150f;
		if (Opacity > 0f && Opacity < 1f)
		{
			for (int i = 0; i < 1; i++)
			{
				Rectangle r = Utils.CenteredRectangle(base.Center + new Vector2(0f, 20f), new Vector2(32f, 32f));
				Dust dust = Dust.NewDustDirect(r.TopLeft(), r.Width, r.Height, 263, 0f, 0f, 100, new Color(80, 200, 255), 0.6f);
				dust.noGravity = true;
				dust.fadeIn = 0.9f;
				dust.velocity = new Vector2(0f, -0.3f);
			}
		}
		int num4 = 20;
		int num5 = 4;
		if (frame == 1)
		{
			num5 = 60;
		}
		AI_192_GetJuminoFall(this, out var timeSinceFall, out var fall);
		if (timeSinceFall > 0f)
		{
			if (fall < 20f)
			{
				frame = 0;
			}
			else if (++frameCounter >= num5)
			{
				frameCounter = 0;
				if (++frame >= num4)
				{
					frame = num4 - 1;
				}
			}
		}
		else
		{
			frame = 1;
		}
		float num6 = Main.player[owner].Center.X - base.Center.X;
		direction = (spriteDirection = ((num6 >= 0f) ? 1 : (-1)));
		int num7 = 30;
		float num8 = num2 + (float)(num4 * num5) + (float)num7;
		Opacity = Utils.Remap(ai[0], num3 + 0f, num3 + 20f, 0f, 1f) * Utils.Remap(ai[0], num8 - 5f, num8, 1f, 0.5f);
		ai[0] += 1f;
		if (ai[0] <= 130f && ai[0] >= 60f)
		{
			float num9 = Utils.Remap(ai[0], 60f, 130f, 0f, 1f);
			if (Main.rand.NextFloat() < num9 * 0.5f)
			{
				Rectangle r2 = Utils.CenteredRectangle(base.Center + new Vector2(0f, 0f), new Vector2(70f, 70f) * num9);
				Dust dust2 = Dust.NewDustDirect(r2.TopLeft(), r2.Width, r2.Height, 263, 0f, 0f, 100, new Color(80, 200, 255), 0.6f);
				dust2.noGravity = true;
				dust2.fadeIn = 0.9f;
				dust2.velocity = Main.rand.NextVector2Circular(2f, 2f);
			}
			for (float num10 = 0f; num10 < 1f; num10 += 0.5f)
			{
				if (Main.rand.NextFloat() < 0.5f)
				{
					Dust dust3 = Dust.NewDustPerfect(base.Center, 263, (-Vector2.UnitY).RotatedBy(((0f - num9) * (3f - num9 * 0.6f) + num10 + Main.rand.NextFloatDirection() * 0.05f * (1f - num9)) * ((float)Math.PI * 2f)) * (2f + Main.rand.NextFloat() + Main.rand.NextFloat() * 3f * num9), 30, new Color(80, 200, 255));
					dust3.noGravity = true;
					dust3.fadeIn = 1.1f;
				}
			}
		}
		if (ai[0] <= 60f)
		{
			float num11 = Utils.Remap(ai[0], 0f, 60f, 0f, 1f);
			for (float num12 = 0f; num12 < 1f; num12 += 0.5f)
			{
				if (Main.rand.NextFloat() < 0.5f)
				{
					Dust dust4 = Dust.NewDustPerfect(base.Center, 263, (-Vector2.UnitY).RotatedBy(((0f - num11) * 3f + num12 + Main.rand.NextFloatDirection() * 0.05f) * ((float)Math.PI * 2f)) * (2f * num11 + Main.rand.NextFloat() * num11), 100, new Color(80, 200, 255), 2f - num11);
					dust4.noGravity = true;
					dust4.fadeIn = 1.1f;
				}
			}
			if (ai[0] == 58f)
			{
				for (float num13 = 0f; num13 < 1f; num13 += 1f / 12f)
				{
					Dust dust5 = Dust.NewDustPerfect(base.Center, 263, (-Vector2.UnitY).RotatedBy(((0f - num11) * 2f + num13 + Main.rand.NextFloatDirection() * 0.05f) * ((float)Math.PI * 2f)) * (1f * num11 + Main.rand.NextFloat() * num11 * 2f), 100, new Color(80, 200, 255), 0.8f);
					dust5.noGravity = true;
					dust5.fadeIn = 1.2f;
				}
			}
		}
		if (ai[0] >= num8 - 20f)
		{
			float num14 = Utils.Remap(ai[0], num8 - 20f, num8, 0.25f, 1f);
			Rectangle r3 = Utils.CenteredRectangle(base.Center + new Vector2(0f, 30f + num14 * -20f), new Vector2(82f, 72f) * num14);
			for (int j = 0; j < 5; j++)
			{
				Dust dust6 = Dust.NewDustDirect(r3.TopLeft(), r3.Width, r3.Height, 263, 0f, num14 * -4f, 100, new Color(80, 200, 255) * 0.75f, 0.1f);
				dust6.noGravity = true;
				dust6.fadeIn = 0.6f + Main.rand.NextFloat() * 0.3f;
				dust6.velocity = new Vector2(0f, -0.3f);
			}
			for (int k = 0; k < 1; k++)
			{
				Rectangle r4 = Utils.CenteredRectangle(base.Center + new Vector2(0f, 40f), new Vector2(32f, 32f));
				Dust dust7 = Dust.NewDustDirect(r4.TopLeft(), r4.Width, r4.Height, 263, 0f, 0f, 100, new Color(80, 200, 255), 0.6f);
				dust7.noGravity = true;
				dust7.fadeIn = 0.9f;
				dust7.velocity = new Vector2(0f, -0.3f);
			}
		}
		if (Main.rand.Next(6) == 0 && ai[0] >= 90f && ai[0] < num2)
		{
			Rectangle r5 = Utils.CenteredRectangle(base.Center + new Vector2(0f, 0f), new Vector2(104f, 104f));
			Dust dust8 = Dust.NewDustDirect(r5.TopLeft(), r5.Width, r5.Height, 263, 0f, 0f, 100, new Color(80, 200, 255), 0.6f);
			dust8.noGravity = true;
			dust8.fadeIn = 0.9f;
			dust8.velocity = new Vector2(0f, -0.3f);
		}
		if (ai[0] >= num8)
		{
			int num15 = Item.NewItem(new EntitySource_Gift(this), base.Center + new Vector2(0f, 12f), Vector2.Zero, 5276);
			Main.item[num15].velocity = new Vector2(0f, 0f);
			Kill();
		}
	}

	private void AI_191_TrueNightsEdge()
	{
		float num = 50f;
		float num2 = 15f;
		float num3 = ai[1] + num;
		float num4 = num3 + num2;
		float num5 = 77f;
		if (type == 985)
		{
			num = 0f;
			num3 = ai[1];
			num4 = ai[1] + 25f;
			num5 = num4;
		}
		if (localAI[0] == 0f && type == 973)
		{
			SoundEngine.PlaySound(SoundID.Item8, base.position);
		}
		localAI[0] += 1f;
		if (type == 985 && localAI[1] == 1f)
		{
			localAI[0] += 2f;
		}
		if (type == 973 && damage == 0 && localAI[0] < MathHelper.Lerp(num3, num4, 0.5f))
		{
			localAI[0] += 6f;
		}
		Opacity = Utils.Remap(localAI[0], 0f, ai[1], 0f, 1f) * Utils.Remap(localAI[0], num3, num4, 1f, 0f);
		if (localAI[0] >= num4)
		{
			localAI[1] = 1f;
			Kill();
			return;
		}
		Player player = Main.player[owner];
		float fromValue = localAI[0] / ai[1];
		float num6 = Utils.Remap(localAI[0], ai[1] * 0.4f, num4, 0f, 1f);
		direction = (spriteDirection = (int)ai[0]);
		if (type == 973)
		{
			int num7 = 3;
			if (damage != 0 && localAI[0] >= num5 + (float)num7)
			{
				damage = 0;
			}
			if (damage != 0)
			{
				int num8 = 80;
				bool flag = false;
				float num9 = velocity.ToRotation();
				for (float num10 = -1f; num10 <= 1f; num10 += 0.5f)
				{
					Vector2 position = base.Center + (num9 + num10 * ((float)Math.PI / 4f) * 0.25f).ToRotationVector2() * num8 * 0.5f * scale;
					Vector2 position2 = base.Center + (num9 + num10 * ((float)Math.PI / 4f) * 0.25f).ToRotationVector2() * num8 * scale;
					if (!Collision.SolidTiles(base.Center, 0, 0) && Collision.CanHit(position, 0, 0, position2, 0, 0))
					{
						flag = true;
						break;
					}
				}
				if (!flag)
				{
					damage = 0;
				}
			}
			fromValue = localAI[0] / ai[1];
			localAI[1] += 1f;
			num6 = Utils.Remap(localAI[1], ai[1] * 0.4f, num4, 0f, 1f);
			base.Center = player.RotatedRelativePoint(player.MountedCenter) - velocity + velocity * num6 * num6 * num5;
			rotation += ai[0] * ((float)Math.PI * 2f) * (4f + Opacity * 4f) / 90f;
			scale = Utils.Remap(localAI[0], ai[1] + 2f, num4, 1.12f, 1f) * ai[2];
			float f = rotation + Main.rand.NextFloatDirection() * ((float)Math.PI / 2f) * 0.7f;
			Vector2 vector = base.Center + f.ToRotationVector2() * 84f * scale;
			if (Main.rand.Next(5) == 0)
			{
				Dust dust = Dust.NewDustPerfect(vector, 14, null, 150, default(Color), 1.4f);
				dust.noLight = (dust.noLightEmittence = true);
			}
			for (int i = 0; (float)i < 3f * Opacity; i++)
			{
				Vector2 vector2 = velocity.SafeNormalize(Vector2.UnitX);
				int num11 = ((Main.rand.NextFloat() < Opacity) ? 75 : 27);
				Dust dust2 = Dust.NewDustPerfect(vector, num11, velocity * 0.2f + vector2 * 3f, 100, default(Color), 1.4f);
				dust2.noGravity = true;
				dust2.customData = Opacity * 0.2f;
			}
		}
		if (type != 985)
		{
			return;
		}
		ownerHitCheck = localAI[0] <= 6f;
		if (localAI[0] >= MathHelper.Lerp(num3, num4, 0.65f))
		{
			damage = 0;
		}
		float fromValue2 = 1f - (1f - num6) * (1f - num6);
		rotation = velocity.ToRotation();
		scale = Utils.Remap(fromValue2, 0f, 1f, 1.5f, 1f) * ai[2];
		num6 = Utils.Remap(localAI[0], ai[1] / 2f, num4, 0f, 1f);
		Opacity = Utils.Remap(localAI[0], 0f, ai[1] * 0.5f, 0f, 1f) * Utils.Remap(localAI[0], num4 - 12f, num4, 1f, 0f);
		if (velocity.Length() > 8f)
		{
			velocity *= 0.94f;
			new Vector2(32f, 32f);
			float num12 = Utils.Remap(fromValue, 0.7f, 1f, 110f, 110f);
			if (localAI[1] == 0f)
			{
				bool flag2 = false;
				for (float num13 = -1f; num13 <= 1f; num13 += 0.5f)
				{
					Vector2 position3 = base.Center + (rotation + num13 * ((float)Math.PI / 4f) * 0.25f).ToRotationVector2() * num12 * 0.5f * scale;
					Vector2 position4 = base.Center + (rotation + num13 * ((float)Math.PI / 4f) * 0.25f).ToRotationVector2() * num12 * scale;
					if (Collision.CanHit(position3, 0, 0, position4, 0, 0))
					{
						flag2 = true;
						break;
					}
				}
				if (!flag2)
				{
					localAI[1] = 1f;
				}
			}
			if (localAI[1] == 1f && velocity.Length() > 8f)
			{
				velocity *= 0.8f;
			}
			if (localAI[1] == 1f)
			{
				velocity *= 0.88f;
			}
		}
		float num14 = rotation + Main.rand.NextFloatDirection() * ((float)Math.PI / 2f) * 0.9f;
		Vector2 vector3 = base.Center + num14.ToRotationVector2() * 85f * scale;
		(num14 + ai[0] * ((float)Math.PI / 2f)).ToRotationVector2();
		Color value = new Color(64, 220, 96);
		Color value2 = new Color(15, 84, 125);
		Lighting.AddLight(base.Center + rotation.ToRotationVector2() * 85f * scale, value.ToVector3());
		for (int j = 0; j < 3; j++)
		{
			if (Main.rand.NextFloat() < Opacity + 0.1f)
			{
				Color.Lerp(Color.Lerp(Color.Lerp(value2, value, Utils.Remap(fromValue, 0f, 0.6f, 0f, 1f)), Color.White, Utils.Remap(fromValue, 0.6f, 0.8f, 0f, 0.5f)), Color.White, Main.rand.NextFloat() * 0.3f);
				Dust dust3 = Dust.NewDustPerfect(vector3, 107, velocity * 0.7f, 100, default(Color) * Opacity, 0.8f * Opacity);
				dust3.scale *= 0.7f;
				dust3.velocity += player.velocity * 0.1f;
				dust3.position -= dust3.velocity * 6f;
			}
		}
		if (damage == 0)
		{
			localAI[0] += 3f;
			velocity *= 0.76f;
		}
		if (localAI[0] < 10f && (localAI[1] == 1f || damage == 0))
		{
			localAI[0] += 1f;
			velocity *= 0.85f;
			for (int k = 0; k < 4; k++)
			{
				float num15 = Main.rand.NextFloatDirection();
				float num16 = 1f - Math.Abs(num15);
				num14 = rotation + num15 * ((float)Math.PI / 2f) * 0.9f;
				vector3 = base.Center + num14.ToRotationVector2() * 85f * scale;
				Color.Lerp(Color.Lerp(Color.Lerp(value2, value, Utils.Remap(fromValue, 0f, 0.6f, 0f, 1f)), Color.White, Utils.Remap(fromValue, 0.6f, 0.8f, 0f, 0.5f)), Color.White, Main.rand.NextFloat() * 0.3f);
				Dust dust4 = Dust.NewDustPerfect(vector3, 107, velocity.RotatedBy(num15 * ((float)Math.PI / 4f)) * 0.2f * Main.rand.NextFloat(), 100, default(Color), 1.4f * num16);
				dust4.velocity += player.velocity * 0.1f;
				dust4.position -= dust4.velocity * Main.rand.NextFloat() * 3f;
			}
		}
	}

	private void AI_190_NightsEdge()
	{
		if (localAI[0] == 0f && type == 984)
		{
			SoundEffectInstance soundEffectInstance = SoundEngine.PlaySound(SoundID.Item60, position);
			if (soundEffectInstance != null)
			{
				soundEffectInstance.Volume *= 0.65f;
			}
		}
		localAI[0] += 1f;
		Player player = Main.player[owner];
		float num = localAI[0] / ai[1];
		float num2 = ai[0];
		float num3 = velocity.ToRotation();
		float num4 = (float)Math.PI * num2 * num + num3 + num2 * (float)Math.PI + player.fullRotation;
		rotation = num4;
		float num5 = 0.2f;
		float num6 = 1f;
		switch (type)
		{
		case 982:
			num5 = 0.6f;
			break;
		case 997:
			num5 = 0.6f;
			break;
		case 983:
			num5 = 1f;
			num6 = 1.2f;
			break;
		case 984:
			num5 = 0.6f;
			break;
		}
		base.Center = player.RotatedRelativePoint(player.MountedCenter) - velocity;
		scale = num6 + num * num5;
		if (type == 972)
		{
			if (Math.Abs(num2) < 0.2f)
			{
				rotation += (float)Math.PI * 4f * num2 * 10f * num;
				float num7 = Utils.Remap(localAI[0], 10f, ai[1] - 5f, 0f, 1f);
				position += velocity.SafeNormalize(Vector2.Zero) * (45f * num7);
				scale += num7 * 0.4f;
			}
			if (Main.rand.Next(2) == 0)
			{
				float f = rotation + Main.rand.NextFloatDirection() * ((float)Math.PI / 2f) * 0.7f;
				Vector2 vector = base.Center + f.ToRotationVector2() * 84f * scale;
				if (Main.rand.Next(5) == 0)
				{
					Dust dust = Dust.NewDustPerfect(vector, 14, null, 150, default(Color), 1.4f);
					dust.noLight = (dust.noLightEmittence = true);
				}
				if (Main.rand.Next(2) == 0)
				{
					Dust.NewDustPerfect(vector, 27, new Vector2(player.velocity.X * 0.2f + (float)(player.direction * 3), player.velocity.Y * 0.2f), 100, default(Color), 1.4f).noGravity = true;
				}
			}
		}
		if (type == 1043 && Math.Abs(num2) < 0.2f)
		{
			rotation += (float)Math.PI * 4f * num2 * 10f * num;
			float num8 = Utils.Remap(localAI[0], 10f, ai[1] - 5f, 0f, 1f);
			position += velocity.SafeNormalize(Vector2.Zero) * (45f * num8);
			scale += num8 * 0.4f;
		}
		if (type == 982)
		{
			float num9 = rotation + Main.rand.NextFloatDirection() * ((float)Math.PI / 2f) * 0.7f;
			Vector2 vector2 = base.Center + num9.ToRotationVector2() * 84f * scale;
			Vector2 vector3 = (num9 + ai[0] * ((float)Math.PI / 2f)).ToRotationVector2();
			if (Main.rand.NextFloat() * 2f < Opacity)
			{
				Dust dust2 = Dust.NewDustPerfect(base.Center + num9.ToRotationVector2() * (Main.rand.NextFloat() * 80f * scale + 20f * scale), 278, vector3 * 1f, 100, Color.Lerp(Color.Gold, Color.White, Main.rand.NextFloat() * 0.3f), 0.4f);
				dust2.fadeIn = 0.4f + Main.rand.NextFloat() * 0.15f;
				dust2.noGravity = true;
			}
			if (Main.rand.NextFloat() * 1.5f < Opacity)
			{
				Dust.NewDustPerfect(vector2, 43, vector3 * 1f, 100, Color.White * Opacity, 1.2f * Opacity);
			}
		}
		if (type == 997)
		{
			float num10 = rotation + Main.rand.NextFloatDirection() * ((float)Math.PI / 2f) * 0.7f;
			_ = base.Center + num10.ToRotationVector2() * 84f * scale;
			Vector2 vector4 = (num10 + ai[0] * ((float)Math.PI / 2f)).ToRotationVector2();
			if (Main.rand.NextFloat() * 2f < Opacity)
			{
				Dust dust3 = Dust.NewDustPerfect(base.Center + num10.ToRotationVector2() * (Main.rand.NextFloat() * 80f * scale + 20f * scale), 6, vector4 * 4f, 0, default(Color), 0.4f);
				dust3.noGravity = true;
				dust3.scale = 1.4f;
			}
		}
		if (type == 983)
		{
			float num11 = rotation + Main.rand.NextFloatDirection() * ((float)Math.PI / 2f) * 0.7f;
			Vector2 vector5 = base.Center + num11.ToRotationVector2() * 84f * scale;
			Vector2 vector6 = (num11 + ai[0] * ((float)Math.PI / 2f)).ToRotationVector2();
			if (Main.rand.NextFloat() < Opacity)
			{
				Dust dust4 = Dust.NewDustPerfect(base.Center + num11.ToRotationVector2() * (Main.rand.NextFloat() * 80f * scale + 20f * scale), 278, vector6 * 1f, 100, Color.Lerp(Color.HotPink, Color.White, Main.rand.NextFloat() * 0.3f), 0.4f);
				dust4.fadeIn = 0.4f + Main.rand.NextFloat() * 0.15f;
				dust4.noGravity = true;
			}
			if (Main.rand.NextFloat() * 1.5f < Opacity)
			{
				Dust.NewDustPerfect(vector5, 43, vector6 * 1f, 100, Color.White * Opacity, 1.2f * Opacity);
			}
		}
		if (type == 984)
		{
			float num12 = rotation + Main.rand.NextFloatDirection() * ((float)Math.PI / 2f) * 0.7f;
			Vector2 vector7 = base.Center + num12.ToRotationVector2() * 85f * scale;
			Vector2 vector8 = (num12 + ai[0] * ((float)Math.PI / 2f)).ToRotationVector2();
			Color value = new Color(64, 220, 96);
			Color value2 = new Color(15, 84, 125);
			Lighting.AddLight(base.Center, value2.ToVector3());
			if (Main.rand.NextFloat() * 2f < Opacity)
			{
				Color value3 = Color.Lerp(value2, value, Utils.Remap(num, 0f, 0.6f, 0f, 1f));
				value3 = Color.Lerp(value3, Color.White, Utils.Remap(num, 0.6f, 0.8f, 0f, 0.5f));
				Dust dust5 = Dust.NewDustPerfect(base.Center + num12.ToRotationVector2() * (Main.rand.NextFloat() * 80f * scale + 20f * scale), 278, vector8 * 1f, 100, Color.Lerp(value3, Color.White, Main.rand.NextFloat() * 0.3f), 0.4f);
				dust5.fadeIn = 0.4f + Main.rand.NextFloat() * 0.15f;
				dust5.noGravity = true;
			}
			if (Main.rand.NextFloat() < Opacity)
			{
				Color.Lerp(Color.Lerp(Color.Lerp(value2, value, Utils.Remap(num, 0f, 0.6f, 0f, 1f)), Color.White, Utils.Remap(num, 0.6f, 0.8f, 0f, 0.5f)), Color.White, Main.rand.NextFloat() * 0.3f);
				Dust dust6 = Dust.NewDustPerfect(vector7, 107, vector8 * 3f, 100, default(Color) * Opacity, 0.8f * Opacity);
				dust6.velocity += player.velocity * 0.1f;
				dust6.velocity += new Vector2(player.direction, 0f);
				dust6.position -= dust6.velocity * 6f;
			}
		}
		scale *= ai[2];
		if (localAI[0] >= ai[1])
		{
			Kill();
		}
	}

	private void AI_188_LightsBane()
	{
		if (soundDelay == 0)
		{
			soundDelay = -1;
			SoundEffectInstance soundEffectInstance = SoundEngine.PlaySound(SoundID.Item60, base.Center);
			if (soundEffectInstance != null)
			{
				soundEffectInstance.Volume *= 0.15f * ai[0];
			}
		}
		scale = ai[0];
		localAI[0] += 1f;
		if (++frameCounter >= 3)
		{
			frameCounter = 0;
			if (++frame >= 12)
			{
				Kill();
				return;
			}
		}
		rotation = velocity.ToRotation();
		float f = rotation;
		float num = 46f * scale;
		Vector2 vector = f.ToRotationVector2();
		float num2 = localAI[0] / 36f * 4f;
		if (num2 >= 0f && num2 <= 1f)
		{
			Dust dust = Dust.NewDustPerfect(Vector2.Lerp(base.Center - vector * num, base.Center + vector * num, localAI[0] / 36f), 278, vector.RotatedBy((float)Math.PI * 2f * Main.rand.NextFloatDirection() * 0.02f) * 8f * Main.rand.NextFloat(), 0, new Color(60, 0, 150), 0.7f * num2);
			dust.noGravity = true;
			dust.noLight = (dust.noLightEmittence = true);
		}
	}

	private void AI_189_Volcano()
	{
		if (soundDelay == 0)
		{
			soundDelay = -1;
			SoundEngine.PlaySound(SoundID.DD2_ExplosiveTrapExplode, base.Center);
		}
		alpha = (int)(255f * (1f - Utils.Remap(ai[0], 0f, 2f, 0f, 1f) * Utils.Remap(ai[0], 6f, 10f, 1f, 0f)));
		float num = width / 2;
		float num2 = height / 2;
		num = (num2 = 8f);
		scale = 1f + 1f * (ai[0] / 15f);
		if (++frameCounter >= 2)
		{
			frameCounter = 0;
			if (++frame >= 5)
			{
				Kill();
				return;
			}
		}
		ai[0] += 1f;
		if (ai[0] == 1f)
		{
			for (int i = 0; i < 20; i++)
			{
				int num3 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
				Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(num, num2), num3, velocity.RotatedBy(Main.rand.NextFloatDirection() * ((float)Math.PI / 4f) * 0.6f) * (2f + 5f * Main.rand.NextFloat()), 200, default(Color), 1f + Main.rand.NextFloat()).customData = 0;
			}
			int num4 = Main.rand.Next(3, 7);
			for (int j = 0; j < num4 * 5; j++)
			{
				Dust dust = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(num, num2), 31, velocity.RotatedBy(Main.rand.NextFloatDirection() * ((float)Math.PI / 4f) * 0.6f) * (2f + 5f * Main.rand.NextFloat()), 50, default(Color), 1f + Main.rand.NextFloat());
				dust.noGravity = true;
				dust.velocity *= 3f;
			}
			for (int k = 0; k < num4; k++)
			{
				Gore.NewGorePerfect(base.Center + Main.rand.NextVector2Circular(num, num2) - new Vector2(16f, 16f), velocity.RotatedBy(Main.rand.NextFloatDirection() * ((float)Math.PI / 4f) * 0.6f) * (0f + 4f * Main.rand.NextFloat()), 61 + Main.rand.Next(3));
			}
		}
		for (int l = 0; l < 2; l++)
		{
			if (Main.rand.Next(3) < 2)
			{
				Dust dust2 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(num, num2), 6, velocity.RotatedBy(Main.rand.NextFloatDirection() * ((float)Math.PI / 4f)) * (1.5f + 2f * Main.rand.NextFloat()), 90, default(Color), 2.5f);
				dust2.noGravity = true;
				dust2.fadeIn = 1f;
				if (Main.rand.Next(6) < 3)
				{
					dust2.noGravity = false;
					dust2.noLight = true;
					dust2.fadeIn = 0.4f;
					dust2.scale *= 0.3f;
				}
				else
				{
					dust2.velocity = DirectionFrom(dust2.position) * dust2.velocity.Length() * 0.25f;
				}
				dust2.customData = 0;
			}
		}
		for (int m = 0; m < 2; m++)
		{
			if (!(Main.rand.NextFloat() < 0.5f))
			{
				int num5 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
				Dust dust3 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(num, num2), num5, velocity.RotatedBy(Main.rand.NextFloatDirection() * ((float)Math.PI / 4f) * 0.5f) * (1f + 2f * Main.rand.NextFloat()), 200, default(Color), 1f + Main.rand.NextFloat());
				dust3.velocity *= new Vector2(0.6f, 1.5f);
				dust3.customData = 0;
			}
		}
	}

	private void AI_066_TryInterceptingTarget(Vector2 targetDir, Vector2 targetVelocity, float speed)
	{
		float num = 5f;
		float num2 = 30f;
		float num3 = num2 + num;
		int num4 = 1;
		int num5 = 4;
		int num6 = 2;
		bool flag = false;
		if (type == 533)
		{
			num4 = 2;
		}
		if (type == 388)
		{
			num4 = 2;
			num2 = 40f;
		}
		targetVelocity /= (float)num4;
		for (float num7 = 1f; num7 <= 1.5f; num7 += 0.1f)
		{
			Utils.ChaseResults chaseResults = Utils.GetChaseResults(base.Center, speed, targetDir, targetVelocity);
			if (chaseResults.InterceptionHappens && chaseResults.InterceptionTime <= num3)
			{
				velocity = chaseResults.ChaserVelocity;
				if (flag)
				{
					int num8 = (int)Utils.Clamp((float)Math.Ceiling(chaseResults.InterceptionTime) + (float)num6, num5, num2 - 1f) / num4;
					float num9 = num2 / (float)num4 - (float)num8;
					ai[1] += num9 * (float)num4;
				}
				break;
			}
		}
	}

	public static void RandomizeInsanityShadowFor(Entity targetEntity, bool isHostile, out Vector2 spawnposition, out Vector2 spawnvelocity, out float ai0, out float ai1)
	{
		spawnposition = targetEntity.Center;
		spawnvelocity = Vector2.Zero;
		ai0 = 0f;
		ai1 = 0f;
		int num = Main.rand.Next(2) * 2 - 1;
		int num2 = Main.rand.Next(4);
		float num3 = (isHostile ? 200f : 100f);
		float num4 = (isHostile ? 30 : 20);
		float num5 = (isHostile ? 30 : 0);
		if (isHostile && targetEntity.velocity.X * (float)num > 0f)
		{
			num *= -1;
		}
		bool flag = false;
		int num6 = 0;
		while (!flag && num6 < 8)
		{
			num6++;
			if (num2 == 0 && isHostile)
			{
				num4 += 10f;
			}
			switch (num2)
			{
			default:
			{
				float num11 = Main.rand.NextFloatDirection() * (float)Math.PI * 0.125f;
				spawnposition = targetEntity.Center + targetEntity.velocity * num5 + new Vector2((float)num * (0f - num3), 0f).RotatedBy(num11);
				float num12 = (isHostile ? (num4 + 10f) : num4);
				spawnvelocity = new Vector2((float)num * num3 / num12, 0f).RotatedBy(num11);
				ai0 = 0f;
				ai1 = 0f;
				break;
			}
			case 1:
			{
				float num10 = (float)Math.PI * 2f * Main.rand.NextFloat();
				spawnposition = targetEntity.Center - num10.ToRotationVector2() * (isHostile ? num3 : (num3 * 0.5f));
				ai0 = 180f;
				ai1 = num10 - (float)Math.PI / 2f;
				spawnvelocity = num10.ToRotationVector2() * (isHostile ? 4 : 2);
				break;
			}
			case 2:
			{
				float num9 = (float)Math.PI * 2f * Main.rand.NextFloat();
				spawnposition = targetEntity.Center - num9.ToRotationVector2() * num3;
				ai0 = 300f;
				ai1 = num9;
				spawnvelocity = num9.ToRotationVector2() * (isHostile ? 4 : 2);
				break;
			}
			case 3:
			{
				float f = (float)Math.PI * 2f * Main.rand.NextFloat();
				float num7 = (isHostile ? 60 : 30);
				float num8 = (float)Math.PI / 2f / num7 * Main.rand.NextFloatDirection();
				spawnposition = targetEntity.Center + targetEntity.velocity * num7;
				Vector2 vector = f.ToRotationVector2() * (isHostile ? 8 : 3);
				for (int i = 0; (float)i < num7; i++)
				{
					spawnposition -= vector;
					vector = vector.RotatedBy(0f - num8);
				}
				spawnvelocity = vector;
				ai0 = 390f;
				ai1 = num8;
				break;
			}
			}
			flag = true;
			if (isHostile)
			{
				int num13 = (int)num3 / 4;
				int num14 = num13 * 2;
				Rectangle value = new Rectangle((int)spawnposition.X - num13, (int)spawnposition.Y - num13, 40 + num14, 40 + num14);
				for (int j = 0; j < 255; j++)
				{
					Player player = Main.player[j];
					if (player != targetEntity && player.active && !player.dead && player.Hitbox.Intersects(value))
					{
						flag = false;
						break;
					}
				}
			}
			if (!flag)
			{
				num2 = (num2 + 1) % 4;
			}
		}
	}

	private void AI_187_ShadowHand()
	{
		AI_187_ShadowHand_GetVariation(out var variation, out var fakeCounter, out var counterMax);
		float fromValue = fakeCounter / counterMax;
		if (fakeCounter == 0f)
		{
			localAI[1] = SoundEngine.PlayTrackedSound(SoundID.DD2_GhastlyGlaiveImpactGhost, base.Center).ToFloat();
		}
		ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]));
		if (activeSound == null)
		{
			localAI[1] = SlotId.Invalid.ToFloat();
		}
		else
		{
			activeSound.Position = base.Center;
		}
		float num = counterMax - 15f;
		if (fakeCounter > num)
		{
			alpha += 25;
			if (alpha > 255)
			{
				alpha = 255;
			}
		}
		else
		{
			alpha -= 25;
			if (alpha < 50)
			{
				alpha = 50;
			}
		}
		if (fakeCounter >= counterMax - 1f)
		{
			Kill();
			return;
		}
		if (variation == 0)
		{
			velocity *= 0.98f;
			direction = (spriteDirection = ((velocity.X > 0f) ? 1 : (-1)));
			rotation = velocity.ToRotation();
			if (spriteDirection == -1)
			{
				rotation += (float)Math.PI;
			}
		}
		if (variation == 1)
		{
			float num2 = 70f;
			direction = (spriteDirection = ((velocity.X > 0f) ? 1 : (-1)));
			if (velocity.Length() > 0.1f)
			{
				velocity *= 0.95f;
			}
			num2 *= (float)direction;
			Vector2 vector = base.Center - rotation.ToRotationVector2() * num2;
			float num3 = Utils.Remap(fromValue, 0.3f, 0.5f, 0f, 1f) * Utils.Remap(fromValue, 0.45f, 0.5f, 1f, 0f);
			float num4 = Utils.Remap(fromValue, 0.5f, 0.55f, 0f, 1f) * Utils.Remap(fromValue, 0.5f, 1f, 1f, 0f);
			float num5 = num3 * (float)Math.PI * 1f / 60f;
			num5 += num4 * -(float)Math.PI * 8f / 60f;
			rotation += num5 * (float)(-direction);
			rotation = MathHelper.WrapAngle(rotation);
			base.Center = vector + rotation.ToRotationVector2() * num2;
		}
		if (variation == 2)
		{
			float f = ai[1];
			float num6 = Utils.Remap(fromValue, 0f, 0.4f, 1f, 0f);
			float num7 = Utils.Remap(fromValue, 0.3f, 0.4f, 0f, 1f) * Utils.Remap(fromValue, 0.4f, 1f, 1f, 0f);
			float num8 = num6 * 2f + num7 * 8f + 0.01f;
			velocity = f.ToRotationVector2() * num8;
			direction = (spriteDirection = ((velocity.X > 0f) ? 1 : (-1)));
			rotation = velocity.ToRotation();
			if (spriteDirection == -1)
			{
				rotation += (float)Math.PI;
			}
		}
		if (variation == 3)
		{
			float num9 = ai[1];
			velocity = velocity.RotatedBy(num9);
			direction = (spriteDirection = ((velocity.X > 0f) ? 1 : (-1)));
			rotation = velocity.ToRotation();
			if (spriteDirection == -1)
			{
				rotation += (float)Math.PI;
			}
		}
		ai[0] += 1f;
	}

	private void AI_187_ShadowHand_GetVariation(out int variation, out float fakeCounter, out float counterMax)
	{
		fakeCounter = ai[0];
		variation = 0;
		float num = 0f;
		float num2 = (counterMax = 180f);
		if (fakeCounter >= num && fakeCounter < num2)
		{
			variation = 0;
			counterMax = num2;
			return;
		}
		num = num2;
		num2 += 120f;
		if (fakeCounter >= num && fakeCounter < num2)
		{
			variation = 1;
			fakeCounter -= num;
			counterMax = num2 - num;
			return;
		}
		num = num2;
		num2 += 90f;
		if (fakeCounter >= num && fakeCounter < num2)
		{
			variation = 2;
			fakeCounter -= num;
			counterMax = num2 - num;
		}
		num = num2;
		num2 += 90f;
		if (fakeCounter >= num && fakeCounter < num2)
		{
			variation = 3;
			fakeCounter -= num;
			counterMax = num2 - num;
		}
	}

	private void AI_185_LifeDrain()
	{
		if (Main.myPlayer != owner || localAI[0] != 0f)
		{
			return;
		}
		Player player = Main.player[owner];
		bool flag = false;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			NPC nPC = Main.npc[i];
			if (nPC.active && !nPC.townNPC && !nPC.dontTakeDamage && !nPC.friendly && base.Hitbox.Intersects(nPC.Hitbox))
			{
				flag = true;
				break;
			}
		}
		if (!flag)
		{
			for (int j = 0; j < 255; j++)
			{
				Player player2 = Main.player[j];
				if (player2.active && player2.whoAmI != player.whoAmI && player2.hostile && !player2.immune && !player2.dead && player2.team != player.team && base.Hitbox.Intersects(player2.Hitbox))
				{
					flag = true;
					break;
				}
			}
		}
		if (flag)
		{
			player.CheckMana(player.inventory[player.selectedItem].mana, pay: true);
			localAI[0] = 1f;
		}
	}

	private void AI_186_PrincessWeapon()
	{
		float num = 60f;
		ai[0] += 1f;
		if (ai[0] >= num)
		{
			Kill();
			return;
		}
		Opacity = Utils.Remap(ai[0], 0f, num, 1f, 0f);
		float num2 = ai[0] / num;
		float num3 = 1f - (1f - num2) * (1f - num2);
		float num4 = 1f - (1f - num3) * (1f - num3);
		float num5 = Utils.Remap(ai[0], num - 15f, num, 0f, 1f);
		float num6 = num5 * num5;
		float num7 = 1f - num6;
		scale = (0.4f + 0.6f * num4) * num7;
		float num8 = Utils.Remap(ai[0], 20f, num, 0f, 1f);
		float num9 = 1f - (1f - num8) * (1f - num8);
		float num10 = 1f - (1f - num9) * (1f - num9);
		localAI[0] = (0.4f + 0.6f * num10) * num7;
		int num11 = width / 2;
		Color newColor = Main.hslToRgb(0.92f, 1f, 0.5f) * Opacity;
		float num12 = 6f;
		float num13 = 2f;
		if (num2 < 0.9f)
		{
			for (int i = 0; i < 3; i++)
			{
				if (Main.rand.Next(2) == 0)
				{
					Vector2 vector = Vector2.UnitX.RotatedBy(Main.rand.NextFloat() * ((float)Math.PI * 2f));
					Vector2 vector2 = vector * ((float)num11 * scale);
					Vector2 vector3 = base.Center + vector2;
					Vector2 vector4 = vector.RotatedBy(0.7853981852531433);
					vector3 += vector4 * num12;
					int num14 = Dust.NewDust(vector3, 0, 0, 267, 0f, 0f, 0, newColor);
					Main.dust[num14].position = vector3;
					Main.dust[num14].noGravity = true;
					Main.dust[num14].scale = 0.3f;
					Main.dust[num14].fadeIn = Main.rand.NextFloat() * 1.2f * scale;
					Main.dust[num14].velocity = vector4 * scale * (0f - num13);
					Main.dust[num14].scale *= scale;
					Main.dust[num14].velocity += velocity * 0.5f;
					Main.dust[num14].position += Main.dust[num14].velocity * -5f;
					if (num14 != 6000)
					{
						Dust dust = Dust.CloneDust(num14);
						dust.scale /= 2f;
						dust.fadeIn *= 0.85f;
						dust.color = new Color(255, 255, 255, 255);
					}
				}
			}
		}
		if (num2 < 0.9f)
		{
			for (int j = 0; j < 3; j++)
			{
				if (Main.rand.Next(2) == 0)
				{
					Vector2 vector5 = Vector2.UnitX.RotatedBy(Main.rand.NextFloat() * ((float)Math.PI * 2f));
					Vector2 vector6 = vector5 * ((float)num11 * scale);
					Vector2 vector7 = base.Center + vector6;
					Vector2 vector8 = vector5.RotatedBy(0.7853981852531433);
					vector7 += vector8 * (0f - num12);
					int num15 = Dust.NewDust(vector7, 0, 0, 267, 0f, 0f, 0, newColor);
					Main.dust[num15].position = vector7;
					Main.dust[num15].noGravity = true;
					Main.dust[num15].scale = 0.3f;
					Main.dust[num15].fadeIn = Main.rand.NextFloat() * 1.2f * scale;
					Main.dust[num15].velocity = vector8 * scale * num13;
					Main.dust[num15].scale *= scale;
					Main.dust[num15].velocity = velocity * 0.5f;
					if (num15 != 6000)
					{
						Dust dust2 = Dust.CloneDust(num15);
						dust2.scale /= 2f;
						dust2.fadeIn *= 0.85f;
						dust2.color = new Color(255, 255, 255, 255);
					}
				}
			}
		}
		if (num2 < 0.95f)
		{
			for (float num16 = 0f; num16 < 0.8f; num16 += 1f)
			{
				if (Main.rand.Next(4) == 0)
				{
					Vector2 vector9 = Vector2.UnitX.RotatedBy(Main.rand.NextFloat() * ((float)Math.PI * 2f) + (float)Math.PI / 2f) * ((float)num11 * scale);
					Vector2 positionInWorld = base.Center + vector9;
					ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.PrincessWeapon, new ParticleOrchestraSettings
					{
						PositionInWorld = positionInWorld,
						MovementVector = velocity
					}, owner);
				}
			}
		}
		if (ai[0] == num - 10f)
		{
			for (float num17 = 0f; num17 < 1f; num17 += 0.25f)
			{
				Vector2 vector10 = Vector2.UnitX.RotatedBy((float)Math.PI * 2f * num17);
				_ = vector10 * ((float)num11 * scale);
				Vector2 center = base.Center;
				float num18 = 1f;
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.PrincessWeapon, new ParticleOrchestraSettings
				{
					PositionInWorld = center,
					MovementVector = vector10 * num18
				}, owner);
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.PrincessWeapon, new ParticleOrchestraSettings
				{
					PositionInWorld = center,
					MovementVector = vector10 * num18 * 2f
				}, owner);
			}
		}
	}

	private void AI_184_BadTorchLuck()
	{
		owner = 255;
		if (Main.player[Main.myPlayer].unlockedBiomeTorches)
		{
			damage = 0;
		}
		if (localAI[0] == 0f)
		{
			localAI[0] = 1f;
			SoundEngine.PlaySound(SoundID.Item8, base.Center);
		}
		if (ai[1] > 0f)
		{
			ai[1] -= velocity.Length();
		}
		else
		{
			tileCollide = true;
		}
		int num = (int)ai[0];
		float num2 = 4f;
		for (float num3 = 0f; num3 < num2; num3 += 1f)
		{
			int num4 = Dust.NewDust(position + velocity / num2 * num3, 4, 4, num, 0f, 0f, 100);
			if (Main.rand.Next(3) != 0)
			{
				Main.dust[num4].noGravity = true;
			}
			Main.dust[num4].velocity *= 0.3f;
			if (num == 66)
			{
				Main.dust[num4].color = new Color(Main.DiscoR, Main.DiscoG, Main.DiscoB);
				Main.dust[num4].noGravity = true;
			}
		}
	}

	private void AI_121_StardustDragon()
	{
		Player player = Main.player[owner];
		if ((int)Main.timeForVisualEffects % 120 == 0)
		{
			netUpdate = true;
		}
		if (!player.active)
		{
			active = false;
			return;
		}
		bool num = type == 625;
		bool flag = type == 625 || type == 626 || type == 627 || type == 628;
		int num2 = 10;
		if (flag)
		{
			if (player.dead)
			{
				player.stardustDragon = false;
			}
			if (player.stardustDragon)
			{
				timeLeft = 2;
			}
			num2 = 30;
			if (Main.rand.Next(30) == 0)
			{
				int num3 = Dust.NewDust(position, width, height, 135, 0f, 0f, 0, default(Color), 2f);
				Main.dust[num3].noGravity = true;
				Main.dust[num3].fadeIn = 2f;
				Point point = Main.dust[num3].position.ToTileCoordinates();
				if (WorldGen.InWorld(point.X, point.Y, 5) && WorldGen.SolidTile(point.X, point.Y))
				{
					Main.dust[num3].noLight = true;
				}
			}
		}
		if (num)
		{
			Vector2 center = player.Center;
			float num4 = 700f;
			float num5 = 1000f;
			int num6 = -1;
			if (Distance(center) > 2000f)
			{
				base.Center = center;
				netUpdate = true;
			}
			if (true)
			{
				NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
				if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this))
				{
					float num7 = Distance(ownerMinionAttackTargetNPC.Center);
					if (num7 < num4 * 2f)
					{
						num6 = ownerMinionAttackTargetNPC.whoAmI;
						if (ownerMinionAttackTargetNPC.boss)
						{
							_ = ownerMinionAttackTargetNPC.whoAmI;
						}
						else
						{
							_ = ownerMinionAttackTargetNPC.whoAmI;
						}
					}
				}
				if (num6 < 0)
				{
					for (int i = 0; i < Main.maxNPCs; i++)
					{
						NPC nPC = Main.npc[i];
						if (nPC.CanBeChasedBy(this) && player.Distance(nPC.Center) < num5)
						{
							float num8 = Distance(nPC.Center);
							if (num8 < num4)
							{
								num6 = i;
								_ = nPC.boss;
							}
						}
					}
				}
			}
			if (num6 != -1)
			{
				NPC nPC2 = Main.npc[num6];
				Vector2 vector = nPC2.Center - base.Center;
				(vector.X > 0f).ToDirectionInt();
				(vector.Y > 0f).ToDirectionInt();
				float num9 = 0.4f;
				if (vector.Length() < 600f)
				{
					num9 = 0.6f;
				}
				if (vector.Length() < 300f)
				{
					num9 = 0.8f;
				}
				if (vector.Length() > nPC2.Size.Length() * 0.75f)
				{
					velocity += Vector2.Normalize(vector) * num9 * 1.5f;
					if (Vector2.Dot(velocity, vector) < 0.25f)
					{
						velocity *= 0.8f;
					}
				}
				float num10 = 30f;
				if (velocity.Length() > num10)
				{
					velocity = Vector2.Normalize(velocity) * num10;
				}
			}
			else
			{
				float num11 = 0.2f;
				Vector2 vector2 = center - base.Center;
				if (vector2.Length() < 200f)
				{
					num11 = 0.12f;
				}
				if (vector2.Length() < 140f)
				{
					num11 = 0.06f;
				}
				if (vector2.Length() > 100f)
				{
					if (Math.Abs(center.X - base.Center.X) > 20f)
					{
						velocity.X += num11 * (float)Math.Sign(center.X - base.Center.X);
					}
					if (Math.Abs(center.Y - base.Center.Y) > 10f)
					{
						velocity.Y += num11 * (float)Math.Sign(center.Y - base.Center.Y);
					}
				}
				else if (velocity.Length() > 2f)
				{
					velocity *= 0.96f;
				}
				if (Math.Abs(velocity.Y) < 1f)
				{
					velocity.Y -= 0.1f;
				}
				float num12 = 15f;
				if (velocity.Length() > num12)
				{
					velocity = Vector2.Normalize(velocity) * num12;
				}
			}
			rotation = velocity.ToRotation() + (float)Math.PI / 2f;
			int num13 = direction;
			direction = (spriteDirection = ((velocity.X > 0f) ? 1 : (-1)));
			if (num13 != direction)
			{
				netUpdate = true;
			}
			float num14 = MathHelper.Clamp(localAI[0], 0f, 50f);
			position = base.Center;
			scale = 1f + num14 * 0.01f;
			width = (height = (int)((float)num2 * scale));
			base.Center = position;
			if (alpha > 0)
			{
				for (int j = 0; j < 2; j++)
				{
					int num15 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 135, 0f, 0f, 100, default(Color), 2f);
					Main.dust[num15].noGravity = true;
					Main.dust[num15].noLight = true;
				}
				alpha -= 42;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
		}
		else
		{
			bool flag2 = false;
			Vector2 vector3 = Vector2.Zero;
			_ = Vector2.Zero;
			float num16 = 0f;
			float num17 = 0f;
			float num18 = 1f;
			if (ai[1] == 1f)
			{
				ai[1] = 0f;
				netUpdate = true;
			}
			int byUUID = GetByUUID(owner, (int)ai[0]);
			if (Main.projectile.IndexInRange(byUUID))
			{
				Projectile projectile = Main.projectile[byUUID];
				if (flag && projectile.active && (projectile.type == 625 || projectile.type == 626 || projectile.type == 627))
				{
					flag2 = true;
					vector3 = projectile.Center;
					_ = projectile.velocity;
					num16 = projectile.rotation;
					num18 = MathHelper.Clamp(projectile.scale, 0f, 50f);
					num17 = 16f;
					_ = projectile.alpha;
					projectile.localAI[0] = localAI[0] + 1f;
					if (projectile.type != 625)
					{
						projectile.localAI[1] = whoAmI;
					}
					if (owner == Main.myPlayer && type == 628 && projectile.type == 625)
					{
						projectile.Kill();
						Kill();
						return;
					}
				}
			}
			if (!flag2)
			{
				for (int k = 0; k < 1000; k++)
				{
					Projectile projectile2 = Main.projectile[k];
					if (projectile2.active && projectile2.owner == owner && ProjectileID.Sets.StardustDragon[projectile2.type] && projectile2.localAI[1] == ai[0])
					{
						ai[0] = projectile2.projUUID;
						projectile2.localAI[1] = whoAmI;
						netUpdate = true;
					}
				}
				return;
			}
			if (alpha > 0)
			{
				for (int l = 0; l < 2; l++)
				{
					int num19 = Dust.NewDust(position, width, height, 135, 0f, 0f, 100, default(Color), 2f);
					Main.dust[num19].noGravity = true;
					Main.dust[num19].noLight = true;
				}
			}
			alpha -= 42;
			if (alpha < 0)
			{
				alpha = 0;
			}
			velocity = Vector2.Zero;
			Vector2 vector4 = vector3 - base.Center;
			if (num16 != rotation)
			{
				float num20 = MathHelper.WrapAngle(num16 - rotation);
				vector4 = vector4.RotatedBy(num20 * 0.1f);
			}
			rotation = vector4.ToRotation() + (float)Math.PI / 2f;
			position = base.Center;
			scale = num18;
			width = (height = (int)((float)num2 * scale));
			base.Center = position;
			if (vector4 != Vector2.Zero)
			{
				base.Center = vector3 - Vector2.Normalize(vector4) * num17 * num18;
			}
			spriteDirection = ((vector4.X > 0f) ? 1 : (-1));
		}
		position.X = MathHelper.Clamp(position.X, 160f, Main.maxTilesX * 16 - 160);
		position.Y = MathHelper.Clamp(position.Y, 160f, Main.maxTilesY * 16 - 160);
	}

	private Projectile FindStardustDragonHeadOfOwner()
	{
		for (int i = 0; i < 1000; i++)
		{
			Projectile projectile = Main.projectile[i];
			if (projectile.active && projectile.owner == owner && projectile.type == 625)
			{
				return projectile;
			}
		}
		return null;
	}

	private void AI_183_ZoologistStrike()
	{
		velocity.X *= 0.2f;
		velocity.Y = 0f;
		spriteDirection = (direction = 1);
		if (velocity.X < 0f)
		{
			spriteDirection = (direction = -1);
		}
		frame++;
		if (frame >= Main.projFrames[type])
		{
			frame = Main.projFrames[type] - 1;
		}
	}

	private void AI_182_FinalFractal()
	{
		if ((type == 933 || type == 1100) && localAI[1] == 0f)
		{
			localAI[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item169, base.Center);
		}
		Player player = Main.player[owner];
		Vector2 mountedCenter = player.MountedCenter;
		float lerpValue = Utils.GetLerpValue(900f, 0f, velocity.Length() * 2f, clamped: true);
		float num = MathHelper.Lerp(0.7f, 2f, lerpValue);
		localAI[0] += num;
		if (localAI[0] >= 120f)
		{
			Kill();
			return;
		}
		float lerpValue2 = Utils.GetLerpValue(0f, 1f, localAI[0] / 60f, clamped: true);
		float num2 = localAI[0] / 60f;
		float num3 = ai[0];
		float num4 = velocity.ToRotation();
		float num5 = (float)Math.PI;
		float num6 = ((velocity.X > 0f) ? 1 : (-1));
		float num7 = num5 + num6 * lerpValue2 * ((float)Math.PI * 2f);
		float num8 = velocity.Length() + Utils.GetLerpValue(0.5f, 1f, lerpValue2, clamped: true) * 40f;
		float num9 = 60f;
		if (num8 < num9)
		{
			num8 = num9;
		}
		Vector2 vector = mountedCenter + velocity;
		Vector2 spinningpoint = new Vector2(1f, 0f).RotatedBy(num7) * new Vector2(num8, num3 * MathHelper.Lerp(2f, 1f, lerpValue));
		Vector2 vector2 = vector + spinningpoint.RotatedBy(num4);
		Vector2 vector3 = (1f - Utils.GetLerpValue(0f, 0.5f, lerpValue2, clamped: true)) * new Vector2((float)((velocity.X > 0f) ? 1 : (-1)) * (0f - num8) * 0.1f, (0f - ai[0]) * 0.3f);
		float num10 = num7 + num4;
		rotation = num10 + (float)Math.PI / 2f;
		base.Center = vector2 + vector3;
		spriteDirection = (direction = ((velocity.X > 0f) ? 1 : (-1)));
		if (num3 < 0f)
		{
			rotation = num5 + num6 * lerpValue2 * ((float)Math.PI * -2f) + num4;
			rotation += (float)Math.PI / 2f;
			spriteDirection = (direction = ((!(velocity.X > 0f)) ? 1 : (-1)));
		}
		if (num2 < 1f)
		{
			FinalFractalHelper.FinalFractalProfile finalFractalProfile = FinalFractalHelper.GetFinalFractalProfile((int)ai[1]);
			Vector2 vector4 = (rotation - (float)Math.PI / 2f).ToRotationVector2();
			Vector2 center = base.Center;
			int num11 = 1 + (int)(velocity.Length() / 100f);
			num11 = (int)((float)num11 * Utils.GetLerpValue(0f, 0.5f, lerpValue2, clamped: true) * Utils.GetLerpValue(1f, 0.5f, lerpValue2, clamped: true));
			if (num11 < 1)
			{
				num11 = 1;
			}
			for (int i = 0; i < num11; i++)
			{
				finalFractalProfile.dustMethod(center + vector4 * finalFractalProfile.trailWidth * MathHelper.Lerp(0.5f, 1f, Main.rand.NextFloat()), rotation - (float)Math.PI / 2f + (float)Math.PI / 2f * (float)spriteDirection, player.velocity);
			}
			Vector3 vector5 = finalFractalProfile.trailColor.ToVector3();
			Vector3 vector6 = Vector3.Lerp(Vector3.One, vector5, 0.7f);
			Lighting.AddLight(base.Center, vector5 * 0.5f * Opacity);
			Lighting.AddLight(mountedCenter, vector6 * Opacity * 0.15f);
		}
		Opacity = Utils.GetLerpValue(0f, 5f, localAI[0], clamped: true) * Utils.GetLerpValue(120f, 115f, localAI[0], clamped: true);
	}

	private void AI_181_FairyQueenRangedItemShot()
	{
		ai[0] += 1f;
		alpha = (int)MathHelper.Lerp(255f, 0f, Utils.GetLerpValue(0f, 10f, ai[0], clamped: true));
		rotation = velocity.ToRotation();
		if (Main.rand.Next(6) == 0)
		{
			Dust dust = Dust.NewDustPerfect(base.Center, 267);
			dust.fadeIn = 1f;
			dust.noGravity = true;
			dust.alpha = 100;
			dust.color = GetFairyQueenWeaponsColor(1f, Main.rand.NextFloat() * 0.4f);
			dust.noLightEmittence = true;
			dust.scale *= 1.5f;
		}
	}

	private void AI_009_MagicMissiles()
	{
		if (type == 491)
		{
			AI_009_MagicMissiles_Old();
			return;
		}
		int num = 32;
		Player player = Main.player[owner];
		int num2 = Main.maxTilesY * 16;
		int num3 = 0;
		if (ai[0] >= 0f)
		{
			num3 = (int)(ai[1] / (float)num2);
		}
		bool flag = ai[0] == -1f || ai[0] == -2f;
		if (type == 34)
		{
			if (frameCounter++ >= 4)
			{
				frameCounter = 0;
				if (++frame >= Main.projFrames[type])
				{
					frame = 0;
				}
			}
			if (penetrate == 1 && ai[0] >= 0f && num3 == 0)
			{
				ai[1] += num2;
				num3 = 1;
				netUpdate = true;
			}
			if (penetrate == 1 && ai[0] == -1f)
			{
				ai[0] = -2f;
				netUpdate = true;
			}
			if (num3 > 0 || ai[0] == -2f)
			{
				localAI[0] += 1f;
			}
		}
		if (owner == Main.myPlayer)
		{
			if (ai[0] >= 0f)
			{
				if (player.channel && player.HeldItem.shoot == type)
				{
					Vector2 pointPosition = Main.MouseWorld;
					player.LimitPointToPlayerReachableArea(ref pointPosition);
					if (ai[0] != pointPosition.X || ai[1] != pointPosition.Y)
					{
						netUpdate = true;
						ai[0] = pointPosition.X;
						ai[1] = pointPosition.Y + (float)(num2 * num3);
					}
				}
				else
				{
					netUpdate = true;
					ai[0] = -1f;
					ai[1] = -1f;
					int num4 = FindTargetWithLineOfSight();
					if (num4 != -1)
					{
						ai[1] = num4;
					}
					else if (velocity.Length() < 2f)
					{
						velocity = DirectionFrom(player.Center) * num;
					}
					else
					{
						velocity = velocity.SafeNormalize(Vector2.Zero) * num;
					}
				}
			}
			if (flag && ai[1] == -1f)
			{
				int num5 = FindTargetWithLineOfSight();
				if (num5 != -1)
				{
					ai[1] = num5;
					netUpdate = true;
				}
			}
		}
		Vector2? vector = null;
		float amount = 1f;
		if (ai[0] > 0f && ai[1] > 0f)
		{
			vector = new Vector2(ai[0], ai[1] % (float)num2);
		}
		if (flag && ai[1] >= 0f)
		{
			int num6 = (int)ai[1];
			if (Main.npc.IndexInRange(num6))
			{
				NPC nPC = Main.npc[num6];
				if (nPC.CanBeChasedBy(this))
				{
					vector = nPC.Center;
					float t = Distance(vector.Value);
					float num7 = Utils.GetLerpValue(0f, 100f, t, clamped: true) * Utils.GetLerpValue(600f, 400f, t, clamped: true);
					amount = MathHelper.Lerp(0f, 0.2f, Utils.GetLerpValue(200f, 20f, 1f - num7, clamped: true));
				}
				else
				{
					ai[1] = -1f;
					netUpdate = true;
				}
			}
		}
		bool flag2 = false;
		if (flag)
		{
			flag2 = true;
		}
		if (vector.HasValue)
		{
			Vector2 value = vector.Value;
			if (Distance(value) >= 64f)
			{
				flag2 = true;
				Vector2 v = value - base.Center;
				Vector2 vector2 = v.SafeNormalize(Vector2.Zero);
				float num8 = Math.Min(num, v.Length());
				Vector2 value2 = vector2 * num8;
				if (velocity.Length() < 4f)
				{
					velocity += velocity.SafeNormalize(Vector2.Zero).RotatedBy(0.7853981852531433).SafeNormalize(Vector2.Zero) * 4f;
				}
				if (velocity.HasNaNs())
				{
					Kill();
				}
				velocity = Vector2.Lerp(velocity, value2, amount);
			}
			else
			{
				velocity *= 0.3f;
				velocity += (value - base.Center) * 0.3f;
				flag2 = velocity.Length() >= 2f;
			}
			if (timeLeft < 60)
			{
				timeLeft = 60;
			}
		}
		if (flag && ai[1] < 0f)
		{
			if (velocity.Length() != (float)num)
			{
				velocity = velocity.MoveTowards(velocity.SafeNormalize(Vector2.UnitY) * num, 4f);
			}
			if (timeLeft > 300)
			{
				timeLeft = 300;
			}
		}
		if (flag2 && velocity != Vector2.Zero)
		{
			rotation = rotation.AngleTowards(velocity.ToRotation(), (float)Math.PI / 4f);
		}
		else
		{
			rotation = rotation.AngleLerp(0f, 0.2f);
		}
		bool flag3 = velocity.Length() > 0.1f && Vector2.Dot(oldVelocity.SafeNormalize(Vector2.Zero), velocity.SafeNormalize(Vector2.Zero)) < 0.2f;
		if (type == 16)
		{
			if (soundDelay == 0 && Math.Abs(velocity.X) + Math.Abs(velocity.Y) > 2f)
			{
				soundDelay = 10;
				SoundEngine.PlaySound(SoundID.Item9, position);
			}
			if (Main.rand.Next(9) == 0)
			{
				int num9 = Dust.NewDust(position, width, height, 15, 0f, 0f, 100, default(Color), 2f);
				Main.dust[num9].velocity *= 0.3f;
				Main.dust[num9].position.X = position.X + (float)(width / 2) + 4f + (float)Main.rand.Next(-4, 5);
				Main.dust[num9].position.Y = position.Y + (float)(height / 2) + (float)Main.rand.Next(-4, 5);
				Main.dust[num9].noGravity = true;
				Main.dust[num9].velocity += Main.rand.NextVector2Circular(2f, 2f);
			}
			if (flag3)
			{
				int num10 = Main.rand.Next(2, 5);
				for (int i = 0; i < num10; i++)
				{
					Dust dust = Dust.NewDustDirect(position, width, height, 15, 0f, 0f, 100, default(Color), 1.5f);
					dust.velocity *= 0.3f;
					dust.position = base.Center;
					dust.noGravity = true;
					dust.velocity += Main.rand.NextVector2Circular(0.5f, 0.5f);
					dust.fadeIn = 2.2f;
				}
			}
		}
		if (type != 34)
		{
			return;
		}
		float lerpValue = Utils.GetLerpValue(0f, 10f, localAI[0], clamped: true);
		Color newColor = Color.Lerp(Color.Transparent, Color.Crimson, lerpValue);
		if (Main.rand.Next(6) == 0)
		{
			Dust dust2 = Dust.NewDustDirect(base.Center, 0, 0, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, newColor, 3.5f);
			dust2.noGravity = true;
			dust2.velocity *= 1.4f;
			dust2.velocity += Main.rand.NextVector2Circular(1f, 1f);
			dust2.velocity += velocity * 0.15f;
		}
		if (Main.rand.Next(12) == 0)
		{
			Dust dust3 = Dust.NewDustDirect(base.Center, 0, 0, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, newColor, 1.5f);
			dust3.velocity += Main.rand.NextVector2Circular(1f, 1f);
			dust3.velocity += velocity * 0.15f;
		}
		if (flag3)
		{
			int num11 = Main.rand.Next(2, 5 + (int)(lerpValue * 4f));
			for (int j = 0; j < num11; j++)
			{
				Dust dust4 = Dust.NewDustDirect(position, width, height, 6, 0f, 0f, 100, newColor, 1.5f);
				dust4.velocity *= 0.3f;
				dust4.position = base.Center;
				dust4.noGravity = true;
				dust4.velocity += Main.rand.NextVector2Circular(0.5f, 0.5f);
				dust4.fadeIn = 2.2f;
				dust4.position += (dust4.position - base.Center) * lerpValue * 10f;
			}
		}
	}

	private void AI_009_MagicMissiles_Old()
	{
		if (Main.myPlayer == owner && ai[0] <= 0f)
		{
			if (Main.player[owner].channel && Main.player[owner].HeldItem.shoot == type)
			{
				float num = 12f;
				if (type == 16)
				{
					num = 15f;
				}
				if (type == 491)
				{
					num = 20f;
				}
				Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				Vector2 pointPosition = Main.MouseWorld;
				Main.player[owner].LimitPointToPlayerReachableArea(ref pointPosition);
				float num2 = pointPosition.X - vector.X;
				float num3 = pointPosition.Y - vector.Y;
				float num4 = (float)Math.Sqrt(num2 * num2 + num3 * num3);
				if (ai[0] < 0f)
				{
					ai[0] += 1f;
				}
				if (type == 491 && num4 < 100f)
				{
					if (velocity.Length() < num)
					{
						velocity *= 1.1f;
						if (velocity.Length() > num)
						{
							velocity.Normalize();
							velocity *= num;
						}
					}
					if (ai[0] == 0f)
					{
						ai[0] = -10f;
					}
				}
				else if (num4 > num)
				{
					num4 = num / num4;
					num2 *= num4;
					num3 *= num4;
					int num5 = (int)(num2 * 1000f);
					int num6 = (int)(velocity.X * 1000f);
					int num7 = (int)(num3 * 1000f);
					int num8 = (int)(velocity.Y * 1000f);
					if (num5 != num6 || num7 != num8)
					{
						netUpdate = true;
					}
					if (type == 491)
					{
						Vector2 vector2 = new Vector2(num2, num3);
						velocity = (velocity * 4f + vector2) / 5f;
					}
					else
					{
						velocity.X = num2;
						velocity.Y = num3;
					}
				}
				else
				{
					int num9 = (int)(num2 * 1000f);
					int num10 = (int)(velocity.X * 1000f);
					int num11 = (int)(num3 * 1000f);
					int num12 = (int)(velocity.Y * 1000f);
					if (num9 != num10 || num11 != num12)
					{
						netUpdate = true;
					}
					velocity.X = num2;
					velocity.Y = num3;
				}
			}
			else if (ai[0] <= 0f)
			{
				netUpdate = true;
				if (type != 491)
				{
					Vector2 vector3 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num13 = (float)Main.mouseX + Main.screenPosition.X - vector3.X;
					float num14 = (float)Main.mouseY + Main.screenPosition.Y - vector3.Y;
					if (Main.player[owner].gravDir == -1f)
					{
						num14 = Main.screenPosition.Y + (float)Main.screenHeight - (float)Main.mouseY - vector3.Y;
					}
					float num15 = (float)Math.Sqrt(num13 * num13 + num14 * num14);
					if (num15 == 0f || ai[0] < 0f)
					{
						vector3 = new Vector2(Main.player[owner].position.X + (float)(Main.player[owner].width / 2), Main.player[owner].position.Y + (float)(Main.player[owner].height / 2));
						num13 = position.X + (float)width * 0.5f - vector3.X;
						num14 = position.Y + (float)height * 0.5f - vector3.Y;
						num15 = (float)Math.Sqrt(num13 * num13 + num14 * num14);
					}
					num15 = 12f / num15;
					num13 *= num15;
					num14 *= num15;
					velocity.X = num13;
					velocity.Y = num14;
					if (velocity.X == 0f && velocity.Y == 0f)
					{
						Kill();
					}
				}
				ai[0] = 1f;
			}
		}
		bool flag = false;
		if (type == 491)
		{
			localAI[0] += 1f;
			if (ai[0] > 0f && localAI[0] > 15f)
			{
				tileCollide = false;
				Vector2 vector4 = Main.player[owner].Center - base.Center;
				if (vector4.Length() < 20f)
				{
					Kill();
				}
				vector4.Normalize();
				vector4 *= 25f;
				velocity = (velocity * 5f + vector4) / 6f;
			}
			flag = true;
			if (ai[0] < 0f || (velocity.X == 0f && velocity.Y == 0f))
			{
				rotation += 0.3f;
			}
			else if (ai[0] > 0f)
			{
				rotation += 0.3f * (float)direction;
			}
			else
			{
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
			}
			if (Vector2.Distance(base.Center, Main.player[owner].Center) > 2000f)
			{
				Kill();
			}
			if (Main.rand.Next(2) == 0)
			{
				int num16 = Main.rand.Next(3);
				int num17 = Dust.NewDust(position, width, height, num16 switch
				{
					0 => 15, 
					1 => 57, 
					_ => 58, 
				}, velocity.X * 0.25f, velocity.Y * 0.25f, 255, default(Color), 0.7f);
				Main.dust[num17].velocity *= 0.25f;
				Main.dust[num17].position = (Main.dust[num17].position + position) / 2f;
			}
		}
		if (type == 79)
		{
			if (soundDelay == 0 && Math.Abs(velocity.X) + Math.Abs(velocity.Y) > 2f)
			{
				soundDelay = 10;
				SoundEngine.PlaySound(SoundID.Item9, position);
			}
			for (int i = 0; i < 1; i++)
			{
				int num18 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 66, 0f, 0f, 100, new Color(Main.DiscoR, Main.DiscoG, Main.DiscoB), 2.5f);
				Main.dust[num18].velocity *= 0.1f;
				Main.dust[num18].velocity += velocity * 0.2f;
				Main.dust[num18].position.X = position.X + (float)(width / 2) + 4f + (float)Main.rand.Next(-2, 3);
				Main.dust[num18].position.Y = position.Y + (float)(height / 2) + (float)Main.rand.Next(-2, 3);
				Main.dust[num18].noGravity = true;
			}
		}
		if (type == 16)
		{
			if (soundDelay == 0 && Math.Abs(velocity.X) + Math.Abs(velocity.Y) > 2f)
			{
				soundDelay = 10;
				SoundEngine.PlaySound(SoundID.Item9, position);
			}
			if (Main.rand.Next(9) == 0)
			{
				int num19 = Dust.NewDust(position, width, height, 15, 0f, 0f, 100, default(Color), 2f);
				Main.dust[num19].velocity *= 0.3f;
				Main.dust[num19].position.X = position.X + (float)(width / 2) + 4f + (float)Main.rand.Next(-4, 5);
				Main.dust[num19].position.Y = position.Y + (float)(height / 2) + (float)Main.rand.Next(-4, 5);
				Main.dust[num19].noGravity = true;
				Main.dust[num19].velocity += Main.rand.NextVector2Circular(2f, 2f);
			}
			flag = true;
			if (velocity != Vector2.Zero)
			{
				rotation = velocity.ToRotation();
			}
		}
		if (type == 34)
		{
			if (Main.rand.Next(12) == 0)
			{
				Dust dust = Dust.NewDustDirect(base.Center, 0, 0, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 3.5f);
				dust.noGravity = true;
				dust.velocity *= 1.4f;
				dust.velocity += Main.rand.NextVector2Circular(1f, 1f);
				dust.velocity += velocity * 0.15f;
			}
			if (Main.rand.Next(24) == 0)
			{
				Dust dust2 = Dust.NewDustDirect(base.Center, 0, 0, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 1.5f);
				dust2.velocity += Main.rand.NextVector2Circular(1f, 1f);
				dust2.velocity += velocity * 0.15f;
			}
			flag = true;
			if (velocity != Vector2.Zero)
			{
				rotation = velocity.ToRotation();
			}
		}
		if (!flag && velocity != Vector2.Zero)
		{
			rotation = velocity.ToRotation() - (float)Math.PI + (float)Math.PI / 4f;
		}
		if (velocity.Y > 16f)
		{
			velocity.Y = 16f;
		}
	}

	private void AI_015_HandleMovementCollision(ref Vector2 wetVelocity, ref Vector2 lastVelocity)
	{
		int num = 10;
		int num2 = 0;
		Vector2 vector = velocity;
		float num3 = 0.2f;
		if (ai[0] == 1f || ai[0] == 5f)
		{
			num3 = 0.4f;
		}
		if (ai[0] == 6f)
		{
			num3 = 0f;
		}
		if (lastVelocity.X != velocity.X)
		{
			if (Math.Abs(lastVelocity.X) > 4f)
			{
				num2 = 1;
			}
			velocity.X = (0f - lastVelocity.X) * num3;
			localAI[0] += 1f;
		}
		if (lastVelocity.Y != velocity.Y)
		{
			if (Math.Abs(lastVelocity.Y) > 4f)
			{
				num2 = 1;
			}
			velocity.Y = (0f - lastVelocity.Y) * num3;
			localAI[0] += 1f;
		}
		if (ai[0] == 1f)
		{
			ai[0] = 5f;
			localNPCHitCooldown = num;
			netUpdate = true;
			Point scanAreaStart = base.TopLeft.ToTileCoordinates();
			Point scanAreaEnd = base.BottomRight.ToTileCoordinates();
			num2 = 2;
			CreateImpactExplosion(2, base.Center, ref scanAreaStart, ref scanAreaEnd, width, out var causedShockwaves);
			CreateImpactExplosion2_FlailTileCollision(base.Center, causedShockwaves, vector);
			position -= vector;
		}
		if (num2 > 0)
		{
			netUpdate = true;
			for (int i = 0; i < num2; i++)
			{
				Collision.HitTiles(position, vector, width, height);
			}
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
		}
		if (ai[0] != 3f && ai[0] != 0f && ai[0] != 5f && ai[0] != 6f && localAI[0] >= 10f)
		{
			ai[0] = 4f;
			netUpdate = true;
		}
		if (wet)
		{
			wetVelocity = velocity;
		}
	}

	public void ResetLocalNPCHitImmunity()
	{
		Array.Clear(localNPCImmunity, 0, localNPCImmunity.Length);
	}

	private void AI_015_Flails()
	{
		Player player = Main.player[owner];
		if (!player.active || player.dead || player.noItems || player.CCed || Vector2.Distance(base.Center, player.Center) > 900f * (1f / player.meleeSpeed))
		{
			Kill();
			return;
		}
		if (Main.myPlayer == owner && Main.mapFullscreen)
		{
			Kill();
			return;
		}
		if (type == 948 && wet && !lavaWet)
		{
			type = 947;
			netUpdate = true;
		}
		Vector2 mountedCenter = player.MountedCenter;
		bool doFastThrowDust = false;
		bool flag = true;
		bool flag2 = false;
		int num = 10;
		float num2 = 24f;
		float num3 = 800f;
		float num4 = 3f;
		float num5 = 16f;
		float num6 = 6f;
		float num7 = 48f;
		float num8 = 1f;
		float num9 = 14f;
		int num10 = 60;
		int num11 = 10;
		int num12 = 15;
		int num13 = 10;
		int num14 = num + 5;
		int num15 = 30;
		switch (type)
		{
		case 947:
		case 948:
			num = 13;
			num2 = 12f;
			num5 = 8f;
			num7 = 13f;
			break;
		case 25:
			num = 15;
			num2 = 14f;
			num5 = 10f;
			num7 = 15f;
			break;
		case 154:
			num = 15;
			num2 = 15f;
			num5 = 11f;
			num7 = 16f;
			break;
		case 26:
			num = 15;
			num2 = 16f;
			num5 = 13f;
			num7 = 17f;
			num15 = 32;
			break;
		case 35:
			num = 15;
			num2 = 17f;
			num5 = 14f;
			num7 = 18f;
			num15 = 37;
			break;
		case 63:
			num = 13;
			num2 = 21f;
			num5 = 20f;
			num7 = 24f;
			num12 = 12;
			break;
		case 757:
			num = 13;
			num2 = 22f;
			num5 = 22f;
			num7 = 26f;
			num12 = 12;
			num15 = 35;
			break;
		case 247:
			num = 13;
			num2 = 23f;
			num12 = 12;
			num15 = 40;
			break;
		case 1058:
			num = 16;
			num2 = 23f;
			num12 = 10;
			num15 = 45;
			break;
		}
		float meleeSpeed = player.meleeSpeed;
		float num16 = 1f / meleeSpeed;
		num2 *= num16;
		num8 *= num16;
		num9 *= num16;
		num4 *= num16;
		num5 *= num16;
		num6 *= num16;
		num7 *= num16;
		if ((type == 26 || type == 35) && ai[2] == 1f)
		{
			drawLayer = 0;
		}
		float num17 = num2 * (float)num;
		float num18 = num17 + 160f;
		localNPCHitCooldown = num11;
		switch ((int)ai[0])
		{
		case 0:
		{
			flag2 = true;
			if (owner == Main.myPlayer)
			{
				bool flag5 = false;
				if (type == 26 || type == 35)
				{
					Player localPlayer = Main.LocalPlayer;
					if (localPlayer.inventory[localPlayer.selectedItem].shoot != type)
					{
						int num21 = ((type == 26) ? 35 : 26);
						for (int i = 0; i < 1000; i++)
						{
							if (Main.projectile[i].active && Main.projectile[i].type == num21 && Main.projectile[i].owner == owner)
							{
								flag5 = true;
								break;
							}
						}
					}
				}
				Vector2 origin = mountedCenter;
				Vector2 mouseWorld = Main.MouseWorld;
				Vector2 vector5 = origin.DirectionTo(mouseWorld).SafeNormalize(Vector2.UnitX * player.direction);
				if (flag5)
				{
					player.ChangeDir((vector5.X < 0f) ? 1 : (-1));
				}
				else
				{
					player.ChangeDir((vector5.X > 0f) ? 1 : (-1));
				}
				if (!player.channel)
				{
					ai[0] = 1f;
					ai[1] = 0f;
					velocity = vector5 * num2 + player.velocity;
					if (flag5)
					{
						velocity.X *= -1f;
					}
					base.Center = mountedCenter;
					netUpdate = true;
					ResetLocalNPCHitImmunity();
					localNPCHitCooldown = num13;
					break;
				}
			}
			localAI[1] += 1f;
			Vector2 vector6 = new Vector2(player.direction).RotatedBy((float)Math.PI * 10f * (localAI[1] / 60f) * (float)player.direction);
			vector6.Y *= 0.8f;
			if (vector6.Y * player.gravDir > 0f)
			{
				vector6.Y *= 0.5f;
			}
			base.Center = mountedCenter + vector6 * num15;
			velocity = Vector2.Zero;
			localNPCHitCooldown = num12;
			break;
		}
		case 1:
		{
			doFastThrowDust = true;
			bool flag3 = ai[1]++ >= (float)num;
			flag3 |= Distance(mountedCenter) >= num3;
			float num19 = 1.3f;
			if (player.controlUseItem)
			{
				ai[0] = 6f;
				ai[1] = 0f;
				netUpdate = true;
				velocity *= 0.2f;
				Vector2 vector = velocity * num19;
				if (Main.myPlayer == owner && type == 757)
				{
					NewProjectile(GetProjectileSource_FromThis(), base.Center, vector, 928, damage, knockBack, Main.myPlayer);
				}
				break;
			}
			if (flag3)
			{
				ai[0] = 2f;
				ai[1] = 0f;
				netUpdate = true;
				velocity *= 0.3f;
				Vector2 vector2 = velocity * num19;
				if (Main.myPlayer == owner && type == 757)
				{
					NewProjectile(GetProjectileSource_FromThis(), base.Center, vector2, 928, damage, knockBack, Main.myPlayer);
				}
			}
			player.ChangeDir((player.Center.X < base.Center.X) ? 1 : (-1));
			localNPCHitCooldown = num13;
			break;
		}
		case 2:
		{
			Vector2 vector3 = DirectionTo(mountedCenter).SafeNormalize(Vector2.Zero);
			if (Distance(mountedCenter) <= num5)
			{
				Kill();
				return;
			}
			if (player.controlUseItem)
			{
				ai[0] = 6f;
				ai[1] = 0f;
				netUpdate = true;
				velocity *= 0.2f;
			}
			else
			{
				velocity *= 0.98f;
				velocity = velocity.MoveTowards(vector3 * num5, num4);
				player.ChangeDir((player.Center.X < base.Center.X) ? 1 : (-1));
			}
			break;
		}
		case 3:
		{
			if (!player.controlUseItem)
			{
				ai[0] = 4f;
				ai[1] = 0f;
				netUpdate = true;
				break;
			}
			float num20 = Distance(mountedCenter);
			tileCollide = ai[1] == 1f;
			bool flag4 = num20 <= num17;
			if (flag4 != tileCollide)
			{
				tileCollide = flag4;
				ai[1] = (tileCollide ? 1 : 0);
				netUpdate = true;
			}
			if (num20 > (float)num10)
			{
				if (num20 >= num17)
				{
					velocity *= 0.5f;
					velocity = velocity.MoveTowards(DirectionTo(mountedCenter).SafeNormalize(Vector2.Zero) * num9, num9);
				}
				velocity *= 0.98f;
				velocity = velocity.MoveTowards(DirectionTo(mountedCenter).SafeNormalize(Vector2.Zero) * num9, num8);
			}
			else
			{
				if (velocity.Length() < 6f)
				{
					velocity.X *= 0.96f;
					velocity.Y += 0.2f;
				}
				if (player.velocity.X == 0f)
				{
					velocity.X *= 0.96f;
				}
			}
			player.ChangeDir((player.Center.X < base.Center.X) ? 1 : (-1));
			break;
		}
		case 4:
		{
			tileCollide = false;
			Vector2 vector4 = DirectionTo(mountedCenter).SafeNormalize(Vector2.Zero);
			if (Distance(mountedCenter) <= num7)
			{
				Kill();
				return;
			}
			velocity *= 0.98f;
			velocity = velocity.MoveTowards(vector4 * num7, num6);
			Vector2 target = base.Center + velocity;
			Vector2 value = mountedCenter.DirectionFrom(target).SafeNormalize(Vector2.Zero);
			if (Vector2.Dot(vector4, value) < 0f)
			{
				Kill();
				return;
			}
			player.ChangeDir((player.Center.X < base.Center.X) ? 1 : (-1));
			break;
		}
		case 5:
			if (ai[1]++ >= (float)num14)
			{
				ai[0] = 6f;
				ai[1] = 0f;
				netUpdate = true;
			}
			else
			{
				localNPCHitCooldown = num13;
				velocity.Y += 0.6f;
				velocity.X *= 0.95f;
				player.ChangeDir((player.Center.X < base.Center.X) ? 1 : (-1));
			}
			break;
		case 6:
			if (!player.controlUseItem || Distance(mountedCenter) > num18)
			{
				ai[0] = 4f;
				ai[1] = 0f;
				netUpdate = true;
				break;
			}
			if (!shimmerWet)
			{
				velocity.Y += 0.8f;
			}
			velocity.X *= 0.95f;
			player.ChangeDir((player.Center.X < base.Center.X) ? 1 : (-1));
			break;
		}
		switch (type)
		{
		case 1058:
		{
			if (alpha > 0)
			{
				alpha -= 50;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			flag = false;
			Vector2 vector8 = Main.player[owner].Center - base.Center;
			rotation = vector8.ToRotation() - 1.57f;
			if (vector8.X < 0f)
			{
				direction = 1;
			}
			else
			{
				direction = -1;
			}
			Main.player[owner].itemRotation = (vector8 * -1f * direction).ToRotation();
			spriteDirection = direction;
			if (owner == Main.myPlayer)
			{
				float num26 = knockBack;
				int num27 = (int)ai[0];
				int num28 = 4;
				if (num27 == 0)
				{
					num28 = Main.rand.Next(3, 6);
					num26 *= 0.5f;
				}
				if (num27 == 6 || num27 == 3)
				{
					num28 = 6;
				}
				localAI[2] += 1f;
				if ((int)localAI[2] >= num28)
				{
					localAI[2] = 0f;
					Vector2 v = vector8 * -1f;
					v = v.SafeNormalize(Vector2.Zero);
					v *= (float)Main.rand.Next(45, 65) * 0.1f;
					v = v.RotatedBy((Main.rand.NextDouble() - 0.5) * 1.5707963705062866);
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, v.X, v.Y, 405, damage, num26, owner, -10f);
				}
			}
			break;
		}
		case 247:
		{
			flag = false;
			float num22 = (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f;
			rotation += ((velocity.X > 0f) ? num22 : (0f - num22));
			if (ai[0] == 0f)
			{
				rotation += (float)Math.PI * 2f / 15f * (float)player.direction;
			}
			float num23 = 600f;
			NPC nPC = null;
			if (owner != Main.myPlayer)
			{
				break;
			}
			localAI[0] += 1f;
			if (localAI[0] >= 20f)
			{
				localAI[0] = 17f;
				for (int j = 0; j < Main.maxNPCs; j++)
				{
					NPC nPC2 = Main.npc[j];
					if (nPC2.CanBeChasedBy(this))
					{
						float num24 = Distance(nPC2.Center);
						if (!(num24 >= num23) && Collision.CanHit(position, width, height, nPC2.position, nPC2.width, nPC2.height))
						{
							nPC = nPC2;
							num23 = num24;
						}
					}
				}
			}
			if (nPC != null)
			{
				localAI[0] = 0f;
				float num25 = 14f;
				Vector2 center = base.Center;
				Vector2 vector7 = center.DirectionTo(nPC.Center).SafeNormalize(Vector2.Zero) * num25;
				NewProjectile(GetProjectileSource_FromThis(), center, vector7, 248, (int)((double)damage / 1.5), knockBack / 2f, Main.myPlayer);
			}
			break;
		}
		}
		if (type != 1058)
		{
			direction = ((velocity.X > 0f) ? 1 : (-1));
			spriteDirection = direction;
		}
		ownerHitCheck = flag2;
		if (flag)
		{
			if (velocity.Length() > 1f)
			{
				rotation = velocity.ToRotation() + velocity.X * 0.1f;
			}
			else
			{
				rotation += velocity.X * 0.1f;
			}
		}
		timeLeft = 2;
		player.heldProj = whoAmI;
		player.SetDummyItemTime(2);
		player.itemRotation = DirectionFrom(mountedCenter).ToRotation();
		if (base.Center.X < mountedCenter.X)
		{
			player.itemRotation += (float)Math.PI;
		}
		player.itemRotation = MathHelper.WrapAngle(player.itemRotation);
		AI_015_Flails_Dust(doFastThrowDust);
	}

	private void AI_015_HandleMovementCollision_Old(ref Vector2 wetVelocity, ref Vector2 lastVelocity)
	{
		bool flag = false;
		if (lastVelocity.X != velocity.X)
		{
			if (Math.Abs(lastVelocity.X) > 4f)
			{
				flag = true;
			}
			position.X += velocity.X;
			velocity.X = (0f - lastVelocity.X) * 0.2f;
		}
		if (lastVelocity.Y != velocity.Y)
		{
			if (Math.Abs(lastVelocity.Y) > 4f)
			{
				flag = true;
			}
			position.Y += velocity.Y;
			velocity.Y = (0f - lastVelocity.Y) * 0.2f;
		}
		ai[0] = 1f;
		if (flag)
		{
			netUpdate = true;
			Collision.HitTiles(position, velocity, width, height);
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
		}
		if (wet)
		{
			wetVelocity = velocity;
		}
	}

	private void AI_015_Flails_Old()
	{
		AI_015_Flails_Dust(doFastThrowDust: false);
		bool flag = Main.player[owner].dead;
		if (!flag)
		{
			flag = (Main.player[owner].Center - base.Center).Length() > 2000f;
		}
		if (flag)
		{
			Kill();
			return;
		}
		Main.player[owner].SetDummyItemTime(10);
		if (position.X + (float)(width / 2) > Main.player[owner].position.X + (float)(Main.player[owner].width / 2))
		{
			Main.player[owner].ChangeDir(1);
			direction = 1;
		}
		else
		{
			Main.player[owner].ChangeDir(-1);
			direction = -1;
		}
		Vector2 mountedCenter = Main.player[owner].MountedCenter;
		Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
		float num = mountedCenter.X - vector.X;
		float num2 = mountedCenter.Y - vector.Y;
		float num3 = (float)Math.Sqrt(num * num + num2 * num2);
		if (ai[0] == 0f)
		{
			float num4 = 160f;
			if (type == 63)
			{
				num4 *= 1.5f;
			}
			if (type == 247)
			{
				num4 *= 1.5f;
			}
			if (type == 757)
			{
				num4 *= 1.5f;
			}
			tileCollide = true;
			if (num3 > num4)
			{
				ai[0] = 1f;
				netUpdate = true;
			}
			else if (!Main.player[owner].channel)
			{
				if (velocity.Y < 0f)
				{
					velocity.Y *= 0.9f;
				}
				velocity.Y += 1f;
				velocity.X *= 0.9f;
			}
		}
		else if (ai[0] == 1f)
		{
			float meleeSpeed = Main.player[owner].meleeSpeed;
			float num5 = 14f / meleeSpeed;
			float num6 = 0.9f / meleeSpeed;
			float num7 = 300f / meleeSpeed;
			int num8 = 60;
			if (type == 63)
			{
				num7 *= 1.5f;
				num5 *= 1.5f;
				num6 *= 1.5f;
			}
			if (type == 247)
			{
				num7 *= 1.5f;
				num5 = 15.9f;
				num6 *= 2f;
				num8 = 100;
			}
			if (type == 757)
			{
				num7 *= 1.5f;
				num5 = 15.9f;
				num6 *= 2f;
				num8 = 100;
			}
			Math.Abs(num);
			Math.Abs(num2);
			if (ai[1] == 1f)
			{
				tileCollide = false;
			}
			if (!Main.player[owner].channel || num3 > num7 || !tileCollide)
			{
				ai[1] = 1f;
				if (tileCollide)
				{
					netUpdate = true;
				}
				tileCollide = false;
				if (num3 < 20f)
				{
					Kill();
				}
			}
			if (!tileCollide)
			{
				num6 *= 2f;
			}
			if (num3 > (float)num8 || !tileCollide)
			{
				num3 = num5 / num3;
				num *= num3;
				num2 *= num3;
				new Vector2(velocity.X, velocity.Y);
				float num9 = num - velocity.X;
				float num10 = num2 - velocity.Y;
				float num11 = (float)Math.Sqrt(num9 * num9 + num10 * num10);
				num11 = num6 / num11;
				num9 *= num11;
				num10 *= num11;
				velocity.X *= 0.98f;
				velocity.Y *= 0.98f;
				velocity.X += num9;
				velocity.Y += num10;
			}
			else
			{
				if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < 6f)
				{
					velocity.X *= 0.96f;
					velocity.Y += 0.2f;
				}
				if (Main.player[owner].velocity.X == 0f)
				{
					velocity.X *= 0.96f;
				}
			}
		}
		if (type == 247)
		{
			if (velocity.X < 0f)
			{
				rotation -= (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f;
			}
			else
			{
				rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f;
			}
			float num12 = position.X;
			float num13 = position.Y;
			float num14 = 600f;
			bool flag2 = false;
			if (owner == Main.myPlayer)
			{
				localAI[1] += 1f;
				if (localAI[1] > 20f)
				{
					localAI[1] = 20f;
					for (int i = 0; i < Main.maxNPCs; i++)
					{
						if (Main.npc[i].CanBeChasedBy(this))
						{
							float num15 = Main.npc[i].position.X + (float)(Main.npc[i].width / 2);
							float num16 = Main.npc[i].position.Y + (float)(Main.npc[i].height / 2);
							float num17 = Math.Abs(position.X + (float)(width / 2) - num15) + Math.Abs(position.Y + (float)(height / 2) - num16);
							if (num17 < num14 && Collision.CanHit(position, width, height, Main.npc[i].position, Main.npc[i].width, Main.npc[i].height))
							{
								num14 = num17;
								num12 = num15;
								num13 = num16;
								flag2 = true;
							}
						}
					}
				}
			}
			if (flag2)
			{
				localAI[1] = 0f;
				vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				num = num12 - vector.X;
				num2 = num13 - vector.Y;
				num3 = (float)Math.Sqrt(num * num + num2 * num2);
				num3 = 14f / num3;
				num *= num3;
				num2 *= num3;
				NewProjectile(GetProjectileSource_FromThis(), vector.X, vector.Y, num, num2, 248, (int)((double)damage / 1.5), knockBack / 2f, Main.myPlayer);
			}
		}
		else
		{
			rotation = (float)Math.Atan2(num2, num) - velocity.X * 0.1f;
		}
		AI_AdjustPlayerItemRotationToFaceProjectile();
	}

	private void AI_015_Flails_Dust(bool doFastThrowDust)
	{
		if (type == 25)
		{
			int maxValue = 15;
			if (doFastThrowDust)
			{
				maxValue = 1;
			}
			if (Main.rand.Next(maxValue) == 0)
			{
				Dust.NewDust(position, width, height, 14, 0f, 0f, 150, default(Color), 1.3f);
			}
		}
		else if (type == 757)
		{
			int num = 4;
			if (velocity.Length() < 8f)
			{
				num = 10;
			}
			if (doFastThrowDust)
			{
				num /= 2;
			}
			for (int i = 0; i < 2; i++)
			{
				if (Main.rand.Next(num) == 0)
				{
					Dust dust = Dust.NewDustDirect(position, width, height, 5, 0f, 0f, 0, default(Color), 0.8f);
					dust.velocity += velocity / 4f;
					dust.fadeIn = 1.3f;
				}
			}
			num = 40;
			if (doFastThrowDust)
			{
				num /= 2;
			}
			for (float num2 = 0f; num2 < 1f; num2 += 0.1f)
			{
				if (Main.rand.Next(num) == 0)
				{
					Dust.NewDustDirect(Vector2.Lerp(Main.player[owner].Center, base.Center, Main.rand.NextFloat()) + new Vector2(-8f), 16, 16, 5, 0f, 0f, 0, default(Color), 1.3f).velocity += velocity / 4f;
				}
			}
		}
		else if (type == 26)
		{
			int num3 = Dust.NewDust(position, width, height, 172, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 1.5f);
			Main.dust[num3].noGravity = true;
			Main.dust[num3].velocity.X /= 2f;
			Main.dust[num3].velocity.Y /= 2f;
		}
		else if (type == 948 && !wet)
		{
			int num4 = Dust.NewDust(position, width, height, 6, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 1.2f);
			Main.dust[num4].noGravity = true;
			Main.dust[num4].velocity.X *= 4f;
			Main.dust[num4].velocity.Y *= 4f;
			Main.dust[num4].velocity = (Main.dust[num4].velocity + velocity) / 2f;
		}
		else if (type == 35)
		{
			int num5 = Dust.NewDust(position, width, height, 6, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 3f);
			Main.dust[num5].noGravity = true;
			Main.dust[num5].velocity.X *= 2f;
			Main.dust[num5].velocity.Y *= 2f;
		}
		else if (type == 154)
		{
			int num6 = Dust.NewDust(position, width, height, 115, velocity.X * 0.4f, velocity.Y * 0.4f, 140, default(Color), 1.5f);
			Main.dust[num6].noGravity = true;
			Main.dust[num6].velocity *= 0.25f;
		}
	}

	private void AI_100_Medusa()
	{
		Player player = Main.player[owner];
		Vector2 zero = Vector2.Zero;
		if (type == 535)
		{
			zero.X = (float)player.direction * 6f;
			zero.Y = player.gravDir * -14f;
			bool flag = true;
			bool flag2 = ai[0] > 0f;
			if (!player.dead)
			{
				timeLeft = 3;
			}
			if (ai[0] > 0f)
			{
				ai[0] -= 1f;
			}
			if (flag2)
			{
				if (frame < 8)
				{
					frame = 8;
				}
				if (frame >= 12)
				{
					frame = 8;
				}
				frameCounter++;
				if (++frameCounter >= 5)
				{
					frameCounter = 0;
					if (++frame >= 12)
					{
						frame = 8;
					}
				}
			}
			else if (++frameCounter >= 5)
			{
				frameCounter = 0;
				if (++frame >= 8)
				{
					frame = 0;
				}
			}
			Vector2 center = player.Center;
			Vector2 vector = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - center;
			if (player.gravDir == -1f)
			{
				vector.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - center.Y;
			}
			Vector2 vector2 = new Vector2(Math.Sign((vector.X == 0f) ? ((float)player.direction) : vector.X), 0f);
			if (vector2.X != velocity.X || vector2.Y != velocity.Y)
			{
				netUpdate = true;
			}
			velocity = vector2;
			if (flag2 && soundDelay == 0)
			{
				SoundEngine.PlaySound(4, (int)base.position.X, (int)base.position.Y, 17);
			}
			soundDelay = (flag2 ? 4 : 0);
			if (Main.myPlayer == owner)
			{
				Vector2 position = player.Center + new Vector2(player.direction * 4, player.gravDir * 2f);
				if (!player.channel)
				{
					Kill();
					return;
				}
				if (!flag2 || ai[0] % 15f == 0f)
				{
					bool flag3 = false;
					for (int i = 0; i < Main.maxNPCs; i++)
					{
						NPC nPC = Main.npc[i];
						if (nPC.active && Distance(nPC.Center) < 320f && nPC.CanBeChasedBy(this) && Collision.CanHitLine(nPC.position, nPC.width, nPC.height, position, 0, 0))
						{
							flag3 = true;
							break;
						}
					}
					if (flag3)
					{
						bool flag4 = false;
						if (!flag || player.CheckMana(player.inventory[player.selectedItem].mana, pay: true))
						{
							int num = damage;
							position = base.Center;
							int num2 = 0;
							float num3 = 0f;
							_medusaHeadTargetList.Clear();
							for (int j = 0; j < Main.maxNPCs; j++)
							{
								NPC nPC2 = Main.npc[j];
								float num4 = Distance(nPC2.Center);
								if (nPC2.active && num4 < 320f && nPC2.CanBeChasedBy(this) && Collision.CanHitLine(nPC2.position, nPC2.width, nPC2.height, position, 0, 0))
								{
									_medusaHeadTargetList.Add(Tuple.Create(j, num4));
								}
							}
							_medusaHeadTargetList.Sort(_medusaTargetComparer);
							for (int k = 0; k < _medusaHeadTargetList.Count && k < 3; k++)
							{
								Tuple<int, float> tuple = _medusaHeadTargetList[k];
								NPC nPC3 = Main.npc[tuple.Item1];
								Vector2 v = nPC3.Center - position;
								num3 += v.ToRotation();
								num2++;
								int num5 = NewProjectile(GetProjectileSource_FromThis(), position.X, position.Y, v.X, v.Y, 536, 0, 0f, owner, whoAmI);
								Main.projectile[num5].Center = nPC3.Center;
								Main.projectile[num5].damage = num;
								Main.projectile[num5].Damage();
								Main.projectile[num5].damage = 0;
								Main.projectile[num5].Center = position;
								ai[0] = 180f;
							}
							num3 = ((num2 == 0) ? ((player.direction == 1) ? 0f : ((float)Math.PI)) : (num3 / (float)num2));
							for (int l = 0; l < 4; l++)
							{
								Vector2 zero2 = Vector2.Zero;
								zero2 = ((Main.rand.Next(4) == 0) ? (Vector2.UnitX.RotatedByRandom(6.2831854820251465) * new Vector2(200f, 50f) * (Main.rand.NextFloat() * 0.7f + 0.3f)) : (Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(num3) * new Vector2(200f, 50f) * (Main.rand.NextFloat() * 0.7f + 0.3f)));
								NewProjectile(GetProjectileSource_FromThis(), position.X, position.Y, zero2.X, zero2.Y, 536, 0, 0f, owner, whoAmI);
							}
							ai[0] = 60f;
							netUpdate = true;
						}
					}
				}
			}
			Lighting.AddLight(base.Center, 0.9f, 0.75f, 0.1f);
		}
		rotation = ((player.gravDir == 1f) ? 0f : ((float)Math.PI));
		spriteDirection = direction;
		timeLeft = 2;
		Vector2 vector3 = Main.OffsetsPlayerOnhand[player.bodyFrame.Y / 56] * 2f;
		if (player.direction != 1)
		{
			vector3.X = (float)player.bodyFrame.Width - vector3.X;
		}
		if (player.gravDir != 1f)
		{
			vector3.Y = (float)player.bodyFrame.Height - vector3.Y;
		}
		vector3 -= new Vector2(player.bodyFrame.Width - player.width, player.bodyFrame.Height - 42) / 2f;
		base.Center = (player.RotatedRelativePoint(player.MountedCenter - new Vector2(20f, 42f) / 2f + vector3 + zero) - velocity).Floor();
		player.ChangeDir(direction);
		player.heldProj = whoAmI;
		player.SetDummyItemTime(2);
	}

	private void AI_120_StardustGuardian()
	{
		Player player = Main.player[owner];
		if (!player.active)
		{
			active = false;
			return;
		}
		bool flag = type == 623;
		Vector2 vector = player.Center;
		float num = 100f;
		float num2 = 500f;
		float num3 = 500f;
		float num4 = 100f;
		bool flag2 = true;
		if (flag)
		{
			if (player.dead)
			{
				player.stardustGuardian = false;
			}
			if (player.stardustGuardian)
			{
				timeLeft = 2;
			}
			num = 150f;
			vector.X -= (5 + player.width / 2) * player.direction;
			vector.Y -= 25f;
			Lighting.AddLight(base.Center, 0.9f, 0.9f, 0.7f);
			if (ai[0] != 3f && alpha == 255)
			{
				alpha = 0;
				for (int i = 0; i < 30; i++)
				{
					int num5 = Dust.NewDust(position, width, height, 135, 0f, 0f, 200, default(Color), 1.7f);
					Main.dust[num5].noGravity = true;
					Main.dust[num5].velocity *= 3f;
					Main.dust[num5].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
					num5 = Dust.NewDust(position, width, height, 135, 0f, 0f, 100);
					Main.dust[num5].velocity *= 2f;
					Main.dust[num5].noGravity = true;
					Main.dust[num5].fadeIn = 2.5f;
					Main.dust[num5].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
				}
			}
		}
		if (ai[0] != 0f)
		{
			Main.player[owner].tankPet = whoAmI;
			Main.player[owner].tankPetReset = false;
		}
		if (ai[0] == 0f)
		{
			base.Center = Vector2.Lerp(base.Center, vector, 0.05f);
			velocity *= 0.5f;
			direction = (spriteDirection = player.direction);
			if (flag && ++frameCounter >= 9)
			{
				frameCounter = 0;
				if (++frame >= 8)
				{
					frame = 0;
				}
			}
			int targetNPCIndex = -1;
			float distanceToClosestTarget = num2;
			bool flag3 = flag2;
			if (flag && Math.Abs(base.Center.X - vector.X) > num + 20f)
			{
				flag3 = false;
			}
			if (flag3)
			{
				AI_120_StardustGuardian_FindTarget(num2, ref targetNPCIndex, ref distanceToClosestTarget);
			}
			if (targetNPCIndex != -1)
			{
				NPC nPC = Main.npc[targetNPCIndex];
				direction = (spriteDirection = (nPC.Center.X > base.Center.X).ToDirectionInt());
				float num6 = Math.Abs(vector.X - base.Center.X);
				float num7 = Math.Abs(nPC.Center.X - base.Center.X);
				float num8 = Math.Abs(vector.Y - base.Center.Y);
				float num9 = Math.Abs(nPC.Center.Y - base.Bottom.Y);
				float num10 = (nPC.Center.Y > base.Bottom.Y).ToDirectionInt();
				if ((num6 < num || (vector.X - base.Center.X) * (float)direction < 0f) && num7 > 20f && num7 < num - num6 + 100f)
				{
					velocity.X += 0.1f * (float)direction;
				}
				else
				{
					velocity.X *= 0.7f;
				}
				if ((num8 < num4 || (vector.Y - base.Bottom.Y) * num10 < 0f) && num9 > 10f && num9 < num4 - num8 + 10f)
				{
					velocity.Y += 0.1f * num10;
				}
				else
				{
					velocity.Y *= 0.7f;
				}
				if (owner == Main.myPlayer && num7 < num3)
				{
					ai[0] = 2f;
					ai[1] = targetNPCIndex;
					netUpdate = true;
				}
			}
		}
		else if (ai[0] == 1f)
		{
			if (player.HasMinionRestTarget)
			{
				vector = player.MinionRestTargetPoint;
			}
			else
			{
				ai[0] = 0f;
				netUpdate = true;
			}
			int targetNPCIndex2 = -1;
			float distanceToClosestTarget2 = num2;
			bool flag4 = true;
			if (flag && Math.Abs(base.Center.X - vector.X) > num + 20f)
			{
				flag4 = false;
			}
			if (flag4)
			{
				AI_120_StardustGuardian_FindTarget(num2, ref targetNPCIndex2, ref distanceToClosestTarget2);
			}
			if (targetNPCIndex2 != -1)
			{
				NPC nPC2 = Main.npc[targetNPCIndex2];
				direction = (spriteDirection = (nPC2.Center.X > base.Center.X).ToDirectionInt());
				float num11 = Math.Abs(vector.X - base.Center.X);
				float num12 = Math.Abs(nPC2.Center.X - base.Center.X);
				float num13 = Math.Abs(vector.Y - base.Center.Y);
				float num14 = Math.Abs(nPC2.Center.Y - base.Bottom.Y);
				float num15 = (nPC2.Center.Y > base.Bottom.Y).ToDirectionInt();
				if ((num11 < num || (vector.X - base.Center.X) * (float)direction < 0f) && num12 > 20f && num12 < num - num11 + 100f)
				{
					velocity.X += 0.1f * (float)direction;
				}
				else
				{
					velocity.X *= 0.7f;
				}
				if ((num13 < num4 || (vector.Y - base.Bottom.Y) * num15 < 0f) && num14 > 10f && num14 < num4 - num13 + 10f)
				{
					velocity.Y += 0.1f * num15;
				}
				else
				{
					velocity.Y *= 0.7f;
				}
				if (owner == Main.myPlayer && num12 < num3)
				{
					ai[0] = 2f;
					ai[1] = targetNPCIndex2;
					netUpdate = true;
				}
			}
			else
			{
				if (Math.Abs(vector.X - base.Center.X) > num + 40f)
				{
					ai[0] = 3f;
					netUpdate = true;
				}
				else if (Math.Abs(vector.X - base.Center.X) > 20f)
				{
					direction = (spriteDirection = (vector.X > base.Center.X).ToDirectionInt());
					velocity.X += 0.06f * (float)direction;
				}
				else
				{
					velocity.X *= 0.8f;
					direction = (spriteDirection = (player.Center.X < base.Center.X).ToDirectionInt());
				}
				if (Math.Abs(vector.Y - base.Center.Y) > num4)
				{
					ai[0] = 3f;
					netUpdate = true;
				}
				else if (Math.Abs(vector.Y - base.Center.Y) > 10f)
				{
					velocity.Y += 0.06f * (float)Math.Sign(vector.Y - base.Center.Y);
				}
				else
				{
					velocity.Y *= 0.8f;
				}
			}
			if (flag && ++frameCounter >= 9)
			{
				frameCounter = 0;
				if (++frame >= Main.projFrames[type] - 4)
				{
					frame = 0;
				}
			}
		}
		else if (ai[0] == 2f)
		{
			if (flag)
			{
				int num16 = 3;
				if (frame < 12)
				{
					frame = 12;
				}
				if (frame == 12 || frame == 13)
				{
					num16 = 8;
				}
				if (++frameCounter >= num16)
				{
					frameCounter = 0;
					if (++frame >= 19)
					{
						frame = 14;
					}
				}
			}
			bool flag5 = false;
			if (flag2)
			{
				flag5 = Distance(player.Center) < num2;
			}
			NPC nPC3 = null;
			int num17 = (int)ai[1];
			if (Main.npc.IndexInRange(num17))
			{
				nPC3 = Main.npc[num17];
				if (!nPC3.CanBeChasedBy(this) || Distance(nPC3.Center) > num3)
				{
					nPC3 = null;
				}
			}
			if (!flag5 || nPC3 == null)
			{
				ai[1] = 0f;
				ai[0] = 0f;
				netUpdate = true;
				if (frame < 18)
				{
					frame = 18;
				}
			}
			else
			{
				int num18 = (((nPC3.Center - player.Center).X > 1f) ? 1 : (-1));
				Vector2 targetPosition = nPC3.Center + new Vector2((float)(-num18) * ((float)nPC3.width * 0.5f + 70f), -10f) - base.Center;
				float maxAmountAllowedToMove = 6f * Utils.Remap(targetPosition.Length(), 50f, 400f, 1f, 4f);
				int num19 = 32;
				Vector2 targetPosition2 = Vector2.Zero.MoveTowards(targetPosition, maxAmountAllowedToMove);
				velocity = velocity.MoveTowards(targetPosition2, num19);
				direction = (spriteDirection = num18);
				if (localAI[0]++ >= 3f)
				{
					localAI[0] = 0f;
					int targetNPCIndex3 = -1;
					float distanceToClosestTarget3 = -1f;
					AI_120_StardustGuardian_FindTarget(num2, ref targetNPCIndex3, ref distanceToClosestTarget3);
					if (targetNPCIndex3 != -1)
					{
						ai[1] = targetNPCIndex3;
						netUpdate = true;
					}
				}
			}
		}
		else
		{
			_ = ai[0];
			_ = 2f;
		}
		if (ai[0] != 3f)
		{
			return;
		}
		if (player.HasMinionRestTarget)
		{
			vector = player.MinionRestTargetPoint;
		}
		else
		{
			ai[0] = 0f;
			netUpdate = true;
		}
		if (alpha == 0)
		{
			alpha = 255;
			for (int j = 0; j < 30; j++)
			{
				int num20 = Dust.NewDust(position, width, height, 135, 0f, 0f, 200, default(Color), 1.7f);
				Main.dust[num20].noGravity = true;
				Main.dust[num20].velocity *= 3f;
				Main.dust[num20].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
				num20 = Dust.NewDust(position, width, height, 135, 0f, 0f, 100);
				Main.dust[num20].velocity *= 2f;
				Main.dust[num20].noGravity = true;
				Main.dust[num20].fadeIn = 2.5f;
				Main.dust[num20].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
			}
		}
		else
		{
			for (int k = 0; k < 2; k++)
			{
				int num21 = Dust.NewDust(position, width, height, 135, 0f, 0f, 200, default(Color), 1.7f);
				Main.dust[num21].noGravity = true;
				Main.dust[num21].velocity *= 3f;
				Main.dust[num21].noLight = true;
				Main.dust[num21].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
				num21 = Dust.NewDust(position, width, height, 135, 0f, 0f, 100);
				Main.dust[num21].velocity *= 2f;
				Main.dust[num21].noGravity = true;
				Main.dust[num21].fadeIn = 2.5f;
				Main.dust[num21].noLight = true;
				Main.dust[num21].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
			}
		}
		velocity *= 0.7f;
		base.Center = Vector2.Lerp(base.Center, vector, 0.2f);
		if (Distance(vector) < 10f)
		{
			ai[0] = 1f;
			netUpdate = true;
		}
	}

	private void AI_120_StardustGuardian_FindTarget(float lookupRange, ref int targetNPCIndex, ref float distanceToClosestTarget)
	{
		Vector2 center = Main.player[owner].Center;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			NPC nPC = Main.npc[i];
			if (nPC.CanBeChasedBy(this))
			{
				float num = center.Distance(nPC.Center);
				if (num < lookupRange)
				{
					targetNPCIndex = i;
					distanceToClosestTarget = num;
					lookupRange = num;
				}
			}
		}
	}

	private void AI_180_FairyQueenSunDance()
	{
		if (localAI[0] == 0f)
		{
			SoundEngine.PlaySound(SoundID.Item159, base.Center);
		}
		localAI[0] += 1f;
		float num = 180f;
		_ = ai[0] / ((float)Math.PI * 2f);
		float num2 = (float)Math.PI / 9f;
		if (localAI[0] >= num)
		{
			Kill();
			return;
		}
		alpha -= 15;
		if (alpha < 0)
		{
			alpha = 0;
		}
		scale = Utils.GetLerpValue(0f, 20f, localAI[0], clamped: true) * Utils.GetLerpValue(num, num - 60f, localAI[0], clamped: true);
		float lerpValue = Utils.GetLerpValue(50f, num, localAI[0], clamped: true);
		rotation = ai[0] + lerpValue * num2;
		int num3 = (int)ai[1];
		if (Main.npc.IndexInRange(num3))
		{
			NPC nPC = Main.npc[num3];
			if (nPC.active && nPC.type == 636)
			{
				base.Center = nPC.Center;
			}
			velocity = Vector2.Zero;
			Vector2 vector = rotation.ToRotationVector2();
			Vector3 v3_ = Main.hslToRgb((ai[0] / ((float)Math.PI * 2f) + localAI[0] / num) % 1f, 1f, 0.85f).ToVector3() * scale;
			float num4 = 800f * scale;
			DelegateMethods.v3_1 = v3_;
			for (float num5 = 0f; num5 <= 1f; num5 += 1f / 12f)
			{
				Point point = (base.Center + vector * num4 * num5).ToTileCoordinates();
				DelegateMethods.CastLightOpen(point.X, point.Y);
			}
		}
		else
		{
			Kill();
		}
	}

	private void AI_179_FairyQueenLance()
	{
		localAI[0] += 1f;
		if (localAI[0] >= 60f)
		{
			velocity = ai[0].ToRotationVector2() * 40f;
			if (Main.rand.Next(3) == 0)
			{
				Dust dust = Dust.NewDustPerfect(base.Center, 267);
				dust.fadeIn = 1f;
				dust.noGravity = true;
				dust.alpha = 100;
				dust.color = Color.Lerp(AI_171_GetColor(), Color.White, Main.rand.NextFloat() * 0.4f);
				dust.noLightEmittence = true;
				dust.scale *= 1.5f;
			}
		}
		if (localAI[0] >= 360f)
		{
			Kill();
			return;
		}
		alpha = (int)MathHelper.Lerp(255f, 0f, Utils.GetLerpValue(0f, 20f, localAI[0], clamped: true));
		rotation = ai[0];
	}

	private void AI_176_EdgyLightning()
	{
		int num = (int)ai[0] - 1;
		if (num != -1 && (!Main.npc[num].CanBeChasedBy(this) || localNPCImmunity[num] != 0))
		{
			ai[0] = 0f;
			num = -1;
		}
		if (num == -1)
		{
			NPC nPC = FindTargetWithinRange(400f);
			if (nPC != null)
			{
				num = nPC.whoAmI;
				ai[0] = num + 1;
				netUpdate = true;
			}
		}
		if (num != -1)
		{
			NPC nPC2 = Main.npc[num];
			Vector2 vector = DirectionTo(nPC2.Center);
			float num2 = 10f;
			if (!vector.HasNaNs())
			{
				velocity = vector * num2;
				rotation = velocity.ToRotation();
			}
			if (++frameCounter >= 3)
			{
				frameCounter = 0;
				frame = Main.rand.Next(Main.projFrames[type]);
			}
		}
		else
		{
			Kill();
		}
	}

	public NPC FindTargetWithinRange(float maxRange, bool checkCanHit = false)
	{
		NPC result = null;
		float num = maxRange;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			NPC nPC = Main.npc[i];
			if (nPC.CanBeChasedBy(this) && localNPCImmunity[i] == 0 && (!checkCanHit || Collision.CanHitLine(position, width, height, nPC.position, nPC.width, nPC.height)))
			{
				float num2 = Distance(nPC.Center);
				if (!(num <= num2))
				{
					num = num2;
					result = nPC;
				}
			}
		}
		return result;
	}

	private void AI_177_IceWhipSlicer()
	{
		Player player = Main.player[owner];
		if (type == 917 && (!player.active || player.dead))
		{
			player.coolWhipBuff = false;
			Kill();
			return;
		}
		if (type == 917 && player.coolWhipBuff)
		{
			timeLeft = 2;
		}
		if (type == 969)
		{
			if (soundDelay == 0)
			{
				soundDelay = -1;
				localAI[1] = SoundEngine.PlayTrackedSound(SoundID.DD2_BookStaffTwisterLoop, base.Center).ToFloat();
			}
			ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]));
			if (activeSound != null)
			{
				activeSound.Position = base.Center;
				activeSound.Volume = 1f - Math.Max(ai[1] - 555f, 0f) / 15f;
			}
			else
			{
				localAI[1] = SlotId.Invalid.ToFloat();
			}
			ai[1] += 1f;
			if (ai[1] > 560f)
			{
				alpha = (int)MathHelper.Lerp(0f, 250f, (ai[1] - 560f) / 10f);
			}
			if (ai[1] >= 570f)
			{
				Kill();
			}
			float num = 555f;
			for (int i = 0; i < 1000; i++)
			{
				if (i != whoAmI && Main.projectile[i].active && Main.projectile[i].owner == owner && Main.projectile[i].type == type && timeLeft > Main.projectile[i].timeLeft && Main.projectile[i].ai[1] < num)
				{
					Main.projectile[i].ai[1] = num;
					Main.projectile[i].netUpdate = true;
				}
			}
		}
		int num2 = (int)ai[0] - 1;
		if (num2 != -1 && (!Main.npc[num2].CanBeChasedBy(this) || localNPCImmunity[num2] > 0))
		{
			ai[0] = 0f;
			num2 = -1;
		}
		if (num2 == -1)
		{
			bool checkCanHit = false;
			if (type == 969)
			{
				checkCanHit = true;
			}
			NPC nPC = FindTargetWithinRange(400f, checkCanHit);
			if (nPC != null)
			{
				num2 = nPC.whoAmI;
				ai[0] = num2 + 1;
				netUpdate = true;
			}
		}
		float num3 = 18f;
		float amount = 0.1f;
		float num4 = 0f;
		if (type == 969)
		{
			num3 = 8f;
			amount = 0.075f;
			num4 = 25f;
		}
		if (num2 != -1)
		{
			NPC nPC2 = Main.npc[num2];
			float num5 = Distance(nPC2.Center);
			if (num3 > num5)
			{
				num3 = num5;
			}
			Vector2 vector = DirectionTo(nPC2.Center);
			if (!vector.HasNaNs() && num5 >= num4)
			{
				velocity = Vector2.Lerp(velocity, vector * num3, amount);
			}
		}
		else if (type == 969)
		{
			Vector2 vector2 = DirectionTo(base.Center + velocity);
			if (!vector2.HasNaNs())
			{
				velocity = Vector2.Lerp(velocity, vector2 * num3, amount);
			}
		}
		else
		{
			velocity *= 0.92f;
		}
		if (type == 969)
		{
			rotation = velocity.X * 0.0125f;
			if (++frameCounter > 4)
			{
				frameCounter = 0;
				frame++;
				if (frame >= Main.projFrames[type])
				{
					frame = 0;
				}
			}
			if (timeLeft % 3 == 0)
			{
				int num6 = Dust.NewDust(position, width, height, 16, velocity.X, velocity.Y, 120, default(Color), 0.5f);
				Main.dust[num6].noGravity = true;
				Main.dust[num6].fadeIn = 0.9f;
				Main.dust[num6].velocity = Main.rand.NextVector2Circular(2f, 2f) + new Vector2(0f, -2f) + velocity * 0.75f;
				for (int j = 0; j < 2; j++)
				{
					Dust dust = Dust.NewDustDirect(position, width, height, 16, velocity.X, velocity.Y, 60, default(Color), 0.5f);
					dust.noGravity = true;
					dust.fadeIn = 0.7f;
					dust.velocity = Main.rand.NextVector2Circular(2f, 2f) * 0.2f + new Vector2(0f, -0.4f) + velocity * 1.5f;
					dust.position -= velocity * 3f;
				}
			}
		}
		else
		{
			rotation += 0.020943953f + Math.Abs(velocity.X) * 0.2f;
			if (Main.rand.Next(3) == 0)
			{
				Dust dust2 = Dust.NewDustDirect(base.Center, 0, 0, 43, velocity.X, velocity.Y, 254, Color.White, 0.5f);
				Vector2 vector3 = Main.rand.NextVector2Circular(1f, 1f);
				dust2.position = base.Center + vector3 * 10f;
				dust2.velocity = vector3;
			}
		}
	}

	private void AI_178_FireExplosion()
	{
		if (localAI[0] == 0f)
		{
			SoundEngine.PlaySound(SoundID.Item14, position);
			for (int i = 0; i < 4; i++)
			{
				int num = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
			}
			for (int j = 0; j < 30; j++)
			{
				int num2 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 200, default(Color), 3.7f);
				Main.dust[num2].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Main.dust[num2].noGravity = true;
				Main.dust[num2].velocity *= 3f;
				num2 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num2].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Main.dust[num2].velocity *= 2f;
				Main.dust[num2].noGravity = true;
				Main.dust[num2].fadeIn = 2.5f;
			}
			for (int k = 0; k < 10; k++)
			{
				int num3 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 0, default(Color), 2.7f);
				Main.dust[num3].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num3].noGravity = true;
				Main.dust[num3].velocity *= 3f;
			}
			for (int l = 0; l < 10; l++)
			{
				int num4 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
				Main.dust[num4].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num4].noGravity = true;
				Main.dust[num4].velocity *= 3f;
			}
			for (int m = 0; m < 2; m++)
			{
				int num5 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Main.gore[num5].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Main.gore[num5].velocity *= 0.3f;
				Main.gore[num5].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num5].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
		}
		localAI[0] += 1f;
		if (localAI[0] >= 10f)
		{
			Kill();
		}
	}

	private void AI_175_TitaniumStormShards()
	{
		Player player = Main.player[owner];
		if (!player.active || player.dead || !player.hasTitaniumStormBuff)
		{
			Kill();
			return;
		}
		if (frameCounter == 0)
		{
			frameCounter = 1;
			frame = Main.rand.Next(12);
			rotation = Main.rand.NextFloat() * ((float)Math.PI * 2f);
		}
		rotation += (float)Math.PI / 200f;
		AI_GetMyGroupIndexAndFillBlackList(null, out var index, out var totalIndexesInGroup);
		float f = ((float)index / (float)totalIndexesInGroup + player.miscCounterNormalized * 6f) * ((float)Math.PI * 2f);
		float num = 24f + (float)totalIndexesInGroup * 6f;
		Vector2 vector = player.position - player.oldPosition;
		base.Center += vector;
		Vector2 vector2 = f.ToRotationVector2();
		localAI[0] = vector2.Y;
		Vector2 value = player.Center + vector2 * new Vector2(1f, 0.05f) * num;
		base.Center = Vector2.Lerp(base.Center, value, 0.3f);
		drawLayer = ((localAI[0] <= 0f) ? 3 : 4);
	}

	private void AI_174_MultisegmentPet()
	{
		Player player = Main.player[owner];
		if (!player.active)
		{
			active = false;
			return;
		}
		if (type == 883)
		{
			if (player.dead)
			{
				player.petFlagEaterOfWorldsPet = false;
			}
			if (player.petFlagEaterOfWorldsPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 887)
		{
			if (player.dead)
			{
				player.petFlagDestroyerPet = false;
			}
			if (player.petFlagDestroyerPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 893)
		{
			if (player.dead)
			{
				player.petFlagLunaticCultistPet = false;
			}
			if (player.petFlagLunaticCultistPet)
			{
				timeLeft = 2;
			}
		}
		Vector2 center = player.Center;
		if (Distance(center) > 2000f)
		{
			base.Center = center;
			velocity = Vector2.Zero;
			netUpdate = true;
		}
		float num = (center - base.Center).Length();
		float num2 = Math.Min(12f, Math.Max(4f, player.velocity.Length()));
		velocity.Length();
		if (velocity == Vector2.Zero)
		{
			velocity.X = 2f * (float)player.direction;
			Vector2 vector = position;
			for (int i = 0; i < oldPos.Length; i++)
			{
				vector -= velocity;
				oldPos[i] = vector;
			}
		}
		if (!(num < 120f))
		{
			float targetAngle = AngleTo(center);
			float f = velocity.ToRotation().AngleTowards(targetAngle, MathHelper.ToRadians(5f));
			velocity = f.ToRotationVector2() * num2;
		}
		if (velocity.Length() > num2)
		{
			velocity = velocity.SafeNormalize(Vector2.Zero) * num2;
		}
		if (Math.Abs(velocity.Y) < 1f)
		{
			velocity.Y -= 0.1f;
		}
		rotation = velocity.ToRotation() + (float)Math.PI / 2f;
		int num3 = direction;
		direction = (spriteDirection = ((velocity.X > 0f) ? 1 : (-1)));
		if (num3 != direction)
		{
			netUpdate = true;
		}
		position.X = MathHelper.Clamp(position.X, 160f, Main.maxTilesX * 16 - 160);
		position.Y = MathHelper.Clamp(position.Y, 160f, Main.maxTilesY * 16 - 160);
	}

	private void AI_173_HallowBossRainbowTrail()
	{
		Opacity = Utils.GetLerpValue(0f, 60f, timeLeft, clamped: true) * Utils.GetLerpValue(660f, 600f, timeLeft, clamped: true);
		float num = (float)Math.PI / 360f;
		float num2 = 30f;
		velocity = velocity.RotatedBy(ai[0]);
		if (ai[0] < num)
		{
			ai[0] += num / num2;
		}
		rotation = velocity.ToRotation() + (float)Math.PI / 2f;
	}

	public Color AI_173_GetColor()
	{
		if (NPC.ShouldEmpressBeEnraged())
		{
			float lerpValue = Utils.GetLerpValue(0f, 60f, (int)Main.time, clamped: true);
			return Color.Lerp(Color.White, Main.OurFavoriteColor, lerpValue) * Opacity;
		}
		return Main.hslToRgb((ai[1] + 0f) % 1f, 1f, 0.5f) * Opacity;
	}

	private void AI_171_HallowBossRainbowStreak()
	{
		bool flag = false;
		bool flag2 = false;
		float num = 140f;
		float num2 = 30f;
		float num3 = 0.98f;
		float value = 0.05f;
		float value2 = 0.1f;
		float num4 = 30f;
		if (type == 931 || type == 1039)
		{
			num = 180f;
			num2 = 20f;
			num4 = 30f;
			num3 = 0.97f;
			value = 0.075f;
			value2 = 0.125f;
			if (timeLeft == 238)
			{
				int num5 = alpha;
				alpha = 0;
				Color newColor = GetFairyQueenWeaponsColor();
				if (type == 1039)
				{
					newColor = GetConstellationColor();
				}
				alpha = num5;
				for (int i = 0; i < 3; i++)
				{
					Dust dust = Dust.NewDustPerfect(base.Center, 267, Main.rand.NextVector2CircularEdge(3f, 3f) * (Main.rand.NextFloat() * 0.5f + 0.5f), 0, newColor);
					dust.scale *= 1.2f;
					dust.noGravity = true;
				}
			}
		}
		if ((float)timeLeft > num)
		{
			flag = true;
		}
		else if ((float)timeLeft > num2)
		{
			flag2 = true;
		}
		if (flag)
		{
			float num6 = (float)Math.Cos((float)whoAmI % 6f / 6f + position.X / 320f + position.Y / 160f);
			velocity *= num3;
			velocity = velocity.RotatedBy(num6 * ((float)Math.PI * 2f) * 0.125f * 1f / 30f);
		}
		if (friendly)
		{
			int num7 = (int)ai[0];
			if (Main.npc.IndexInRange(num7) && !Main.npc[num7].CanBeChasedBy(this))
			{
				num7 = -1;
				ai[0] = -1f;
				netUpdate = true;
			}
			if (num7 == -1)
			{
				int num8 = FindTargetWithLineOfSight();
				if (num8 != -1)
				{
					num7 = num8;
					ai[0] = num8;
					netUpdate = true;
				}
			}
		}
		if (flag2)
		{
			int num9 = (int)ai[0];
			Vector2 value3 = velocity;
			if (hostile && Main.player.IndexInRange(num9))
			{
				Player player = Main.player[num9];
				value3 = DirectionTo(player.Center) * num4;
			}
			if (friendly)
			{
				if (Main.npc.IndexInRange(num9))
				{
					if (timeLeft < 10)
					{
						timeLeft = 10;
					}
					NPC nPC = Main.npc[num9];
					value3 = DirectionTo(nPC.Center) * num4;
				}
				else
				{
					timeLeft--;
				}
			}
			float amount = MathHelper.Lerp(value, value2, Utils.GetLerpValue(num, 30f, timeLeft, clamped: true));
			velocity = Vector2.SmoothStep(velocity, value3, amount);
			if (type == 931 || type == 1039)
			{
				velocity *= MathHelper.Lerp(0.85f, 1f, Utils.GetLerpValue(0f, 90f, timeLeft, clamped: true));
			}
		}
		Opacity = Utils.GetLerpValue(240f, 220f, timeLeft, clamped: true);
		rotation = velocity.ToRotation() + (float)Math.PI / 2f;
	}

	public Color AI_171_GetColor()
	{
		if (NPC.ShouldEmpressBeEnraged())
		{
			float lerpValue = Utils.GetLerpValue(0f, 60f, (int)Main.time, clamped: true);
			return Color.Lerp(Color.White, Main.OurFavoriteColor, lerpValue) * Opacity;
		}
		return Main.hslToRgb((ai[1] + 0.5f) % 1f, 1f, 0.5f) * Opacity;
	}

	private void AI_172_HallowBossRainbowPelletStorm()
	{
		if (localAI[1] <= 90f)
		{
			localAI[1] += 1f;
			scale = 0.5f;
			Opacity = 0.5f;
			float lerpValue = Utils.GetLerpValue(0f, 90f, localAI[1]);
			scale = MathHelper.Lerp(5f, 1f, lerpValue);
			Opacity = 1f - (1f - lerpValue * lerpValue);
			return;
		}
		scale = 1f;
		Opacity = 1f;
		float num = 150f + 10f * (float)AI_172_GetPelletStormsCount();
		localAI[0] += 1f;
		if (localAI[0] >= num)
		{
			Kill();
			return;
		}
		velocity = Vector2.Zero;
		rotation = 0f;
		int num2 = AI_172_GetPelletStormsCount();
		for (int i = 0; i < num2; i++)
		{
			HallowBossPelletStormInfo hallowBossPelletStormInfo = AI_172_GetPelletStormInfo(i);
			for (int j = 0; j < hallowBossPelletStormInfo.BulletsInStorm; j++)
			{
				if (hallowBossPelletStormInfo.IsValid(j))
				{
					hallowBossPelletStormInfo.GetBulletPosition(j, base.Center);
				}
			}
		}
	}

	public int AI_172_GetPelletStormsCount()
	{
		return 6;
	}

	public HallowBossPelletStormInfo AI_172_GetPelletStormInfo(int stormIndex)
	{
		float num = 0f + (float)stormIndex * 10f;
		float to = 90f + (float)stormIndex * 10f;
		return new HallowBossPelletStormInfo
		{
			StartAngle = (float)stormIndex * ((float)Math.PI / 3f) - (float)Math.PI / 2f + (float)stormIndex * ((float)Math.PI / 5f),
			AnglePerBullet = (float)Math.PI * 2f / 3f,
			BulletsInStorm = 3,
			BulletsProgressInStormStartNormalized = Utils.GetLerpValue(num, to, localAI[0]),
			BulletsProgressInStormBonusByIndexNormalized = 0f,
			StormTotalRange = 500f,
			BulletSize = new Vector2(16f, 16f)
		};
	}

	public int FindTargetWithLineOfSight(float maxRange = 800f)
	{
		float num = maxRange;
		int result = -1;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			NPC nPC = Main.npc[i];
			bool flag = nPC.CanBeChasedBy(this);
			if (localNPCImmunity[i] != 0)
			{
				flag = false;
			}
			if (flag)
			{
				float num2 = Distance(Main.npc[i].Center);
				if (num2 < num && Collision.CanHit(position, width, height, nPC.position, nPC.width, nPC.height))
				{
					num = num2;
					result = i;
				}
			}
		}
		return result;
	}

	private void AI_170_FairyGlowstick()
	{
		Point p = base.Center.ToTileCoordinates();
		Vector2 vector = p.ToVector2();
		int num = 10;
		Vector2 zero = Vector2.Zero;
		int num2 = 0;
		float num3 = 3f;
		if (ai[1] == 1f)
		{
			SoundEngine.PlaySound(SoundID.Item28, position);
			rotation = 0f;
			velocity.X = 0f;
			ai[1] = 2f;
		}
		frameCounter++;
		if (frameCounter > 4)
		{
			frameCounter = 0;
			frame++;
			if (frame >= Main.projFrames[type])
			{
				frame = 0;
			}
		}
		if (velocity.Length() > 1f && timeLeft % 10 == 0)
		{
			for (int i = p.X - num; i < p.X + num + 1; i++)
			{
				for (int j = p.Y - num; j < p.Y + num + 1; j++)
				{
					if (WorldGen.SolidTile(i, j))
					{
						Vector2 v = vector - new Vector2(i, j);
						Vector2 vector2 = v.SafeNormalize(Vector2.Zero) * Math.Max((float)num - v.Length(), 0f);
						vector2 *= num3;
						zero += vector2;
						num2++;
					}
				}
			}
			if (num2 > 0)
			{
				zero /= (float)num2;
			}
			if (zero.Length() > 1f)
			{
				velocity = zero;
			}
		}
		velocity *= 0.95f;
		if (velocity != Vector2.Zero && velocity.Length() < 1f)
		{
			velocity = Vector2.Zero;
			netUpdate = true;
		}
	}

	private void AI_169_Smolstars()
	{
		Player player = Main.player[owner];
		bool num = type == 864;
		Vector2 vector = player.Top + new Vector2(0f, -30f);
		if (num)
		{
			if (player.dead)
			{
				player.smolstar = false;
			}
			if (player.smolstar)
			{
				timeLeft = 2;
			}
			if (ai[0] == 0f)
			{
				AI_GetMyGroupIndexAndFillBlackList(null, out var index, out var totalIndexesInGroup);
				float num2 = (float)Math.PI * 2f / (float)totalIndexesInGroup;
				float num3 = (float)totalIndexesInGroup * 0.66f;
				Vector2 vector2 = new Vector2(30f, 6f) / 5f * (totalIndexesInGroup - 1);
				Vector2 vector3 = Vector2.UnitY.RotatedBy(num2 * (float)index + Main.GlobalTimeWrappedHourly % num3 / num3 * ((float)Math.PI * 2f));
				vector += vector3 * vector2;
				vector.Y += player.gfxOffY;
				vector = vector.Floor();
			}
		}
		if (ai[0] == 0f)
		{
			Vector2 vector4 = vector - base.Center;
			float num4 = 10f;
			float lerpValue = Utils.GetLerpValue(200f, 600f, vector4.Length(), clamped: true);
			num4 += lerpValue * 30f;
			if (vector4.Length() >= 3000f)
			{
				base.Center = vector;
			}
			velocity = vector4;
			if (velocity.Length() > num4)
			{
				velocity *= num4 / velocity.Length();
			}
			int startAttackRange = 800;
			int attackTarget = -1;
			Minion_FindTargetInRange(startAttackRange, ref attackTarget, skipIfCannotHitWithOwnBody: false);
			if (attackTarget != -1)
			{
				ai[0] = 60f;
				ai[1] = attackTarget;
				netUpdate = true;
			}
			float targetAngle = velocity.SafeNormalize(Vector2.UnitY).ToRotation() + (float)Math.PI / 2f;
			if (vector4.Length() < 40f)
			{
				targetAngle = Vector2.UnitY.ToRotation() + (float)Math.PI / 2f;
			}
			rotation = rotation.AngleLerp(targetAngle, 0.2f);
			return;
		}
		if (ai[0] == -1f)
		{
			if (ai[1] == 0f)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int i = 0; i < 2; i++)
				{
					Dust dust = Dust.NewDustDirect(position, width, height, 15, oldVelocity.X * 0.2f, oldVelocity.Y * 0.2f, 0, default(Color), 1.4f);
					if (Main.rand.Next(3) != 0)
					{
						dust.scale *= 1.3f;
						dust.velocity *= 1.1f;
					}
					dust.noGravity = true;
					dust.fadeIn = 0f;
				}
				velocity += Main.rand.NextVector2CircularEdge(4f, 4f);
			}
			ai[1] += 1f;
			rotation += velocity.X * 0.1f + velocity.Y * 0.05f;
			velocity *= 0.92f;
			if (ai[1] >= 9f)
			{
				ai[0] = 0f;
				ai[1] = 0f;
			}
			return;
		}
		NPC nPC = null;
		int num5 = (int)ai[1];
		if (Main.npc.IndexInRange(num5) && Main.npc[num5].CanBeChasedBy(this))
		{
			nPC = Main.npc[num5];
		}
		if (nPC == null)
		{
			ai[0] = -1f;
			ai[1] = 0f;
			netUpdate = true;
		}
		else if (player.Distance(nPC.Center) >= 900f)
		{
			ai[0] = 0f;
			ai[1] = 0f;
			netUpdate = true;
		}
		else
		{
			Vector2 vector5 = nPC.Center - base.Center;
			float num6 = 16f;
			velocity = vector5;
			if (velocity.Length() > num6)
			{
				velocity *= num6 / velocity.Length();
			}
			float targetAngle2 = velocity.SafeNormalize(Vector2.UnitY).ToRotation() + (float)Math.PI / 2f;
			rotation = rotation.AngleLerp(targetAngle2, 0.4f);
		}
		float num7 = 0.1f;
		float num8 = width * 5;
		for (int j = 0; j < 1000; j++)
		{
			if (j != whoAmI && Main.projectile[j].active && Main.projectile[j].owner == owner && Main.projectile[j].type == type && Math.Abs(position.X - Main.projectile[j].position.X) + Math.Abs(position.Y - Main.projectile[j].position.Y) < num8)
			{
				if (position.X < Main.projectile[j].position.X)
				{
					velocity.X -= num7;
				}
				else
				{
					velocity.X += num7;
				}
				if (position.Y < Main.projectile[j].position.Y)
				{
					velocity.Y -= num7;
				}
				else
				{
					velocity.Y += num7;
				}
			}
		}
	}

	private void AI_019_Spears()
	{
		Player player = Main.player[owner];
		Vector2 center = player.RotatedRelativePoint(player.MountedCenter);
		direction = player.direction;
		player.heldProj = whoAmI;
		player.MatchItemTimeToItemAnimation();
		base.Center = center;
		bool flag = Main.player[owner].itemAnimation < Main.player[owner].itemAnimationMax / 3;
		int itemAnimationMax = player.itemAnimationMax;
		int itemAnimation = player.itemAnimation;
		int num = Main.player[owner].itemAnimationMax / 3;
		bool flag2 = false;
		spriteDirection = -direction;
		int num2 = type;
		if ((uint)(num2 - 877) <= 2u)
		{
			alpha -= 40;
			if (alpha < 0)
			{
				alpha = 0;
			}
			flag2 = true;
		}
		position += velocity * AI_019_Spears_GetSpearOffsetRelativeToPlayer(player, itemAnimation, itemAnimationMax);
		switch (type)
		{
		case 47:
			if (Main.player[owner].wet && Main.rand.Next(2) == 0)
			{
				int num5 = Dust.NewDust(Main.player[owner].position, Main.player[owner].width, Main.player[owner].height, 15, 0f, 0f, 100, default(Color), 0.8f);
				Main.dust[num5].velocity *= 0.1f;
			}
			break;
		case 130:
			if ((localAI[0] == 0f || localAI[0] == 4f || localAI[0] == 8f || localAI[0] == 12f || localAI[0] == 16f || localAI[0] == 20f || localAI[0] == 24f) && owner == Main.myPlayer)
			{
				NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, velocity.X, velocity.Y, 131, damage / 3, 0f, owner);
			}
			localAI[0] += 1f;
			break;
		case 730:
			if (localAI[0] == 0f && Main.myPlayer == owner)
			{
				localAI[0] = 1f;
				Vector2 vector2 = velocity * 4f;
				NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector2.X, vector2.Y, 732, (int)((double)damage * 1.6), knockBack * 0.5f, owner);
			}
			break;
		case 342:
			if (flag && localAI[0] == 0f && Main.myPlayer == owner)
			{
				localAI[0] = 1f;
				if (Collision.CanHit(player.position, player.width, player.height, position, width, height))
				{
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, velocity.X * 2.4f, velocity.Y * 2.4f, 343, damage, knockBack * 0.85f, owner);
				}
			}
			break;
		case 222:
			if (flag && localAI[0] == 0f && Main.myPlayer == owner)
			{
				localAI[0] = 1f;
				NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, velocity.X, velocity.Y, 228, damage, knockBack, owner);
			}
			break;
		case 367:
			if (localAI[0] == 0f && Main.myPlayer == owner)
			{
				localAI[0] = 1f;
				int num3 = Main.rand.Next(1, 4);
				for (int i = 0; i < num3; i++)
				{
					Vector2 vector = velocity;
					vector.X *= 0.7f + Main.rand.NextFloat() * 0.6f;
					vector.Y *= 0.7f + Main.rand.NextFloat() * 0.6f;
					vector *= 0.8f + Main.rand.NextFloat() * 0.4f;
					int num4 = NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector.X * 2f, vector.Y * 2f, 1107 + Main.rand.Next(3), (int)((double)damage * 0.5), 0f, owner);
					Main.projectile[num4].timeLeft = Main.rand.Next(30, 150);
				}
			}
			break;
		}
		if (flag2 && player.channel && player.itemAnimation < num)
		{
			player.SetDummyItemTime(num);
		}
		rotation = (float)Math.Atan2(velocity.Y, velocity.X) + (float)Math.PI / 2f + (float)Math.PI / 4f;
		if (spriteDirection == -1)
		{
			rotation -= (float)Math.PI / 2f;
		}
		AI_019_Spears_GetExtensionHitbox(player, out var _);
		if (type == 878 || type == 879)
		{
			float num6 = 6f;
			float num7 = 0.8f;
			float num8 = Vector2.Dot(velocity.SafeNormalize(Vector2.UnitX * player.direction), player.velocity.SafeNormalize(Vector2.UnitX * player.direction));
			float num9 = player.velocity.Length();
			if (num9 > num6 && num8 > num7)
			{
				int num10 = 8;
				if (num9 > num6 + 1f)
				{
					num10 = 5;
				}
				if (num9 > num6 + 2f)
				{
					num10 = 2;
				}
				int num11 = 14;
				int num12 = 27;
				int num13 = 4;
				if (type == 879)
				{
					num11 = 43;
					num12 = 57;
				}
				if (Main.rand.Next(num10 + 3) == 0)
				{
					Dust.NewDust(base.Center - new Vector2(num13, num13), num13 * 2, num13 * 2, num11, 0f, 0f, 150, default(Color), 1.4f);
				}
				if (Main.rand.Next(num10) == 0)
				{
					int num14 = Dust.NewDust(base.Center - new Vector2(num13, num13), num13 * 2, num13 * 2, num12, velocity.X * 0.2f + (float)(direction * 3), velocity.Y * 0.2f, 100, default(Color), 1.2f);
					Main.dust[num14].noGravity = true;
					Main.dust[num14].velocity *= 0.25f;
					num14 = Dust.NewDust(base.Center - new Vector2(num13, num13), num13 * 2, num13 * 2, num12, 0f, 0f, 150, default(Color), 1.4f);
					Main.dust[num14].velocity *= 0.25f;
				}
			}
		}
		else if (type == 46)
		{
			if (Main.rand.Next(5) == 0)
			{
				Dust.NewDust(position, width, height, 14, 0f, 0f, 150, default(Color), 1.4f);
			}
			int num15 = Dust.NewDust(position, width, height, 27, velocity.X * 0.2f + (float)(direction * 3), velocity.Y * 0.2f, 100, default(Color), 1.2f);
			Main.dust[num15].noGravity = true;
			Main.dust[num15].velocity /= 2f;
			num15 = Dust.NewDust(position - velocity * 2f, width, height, 27, 0f, 0f, 150, default(Color), 1.4f);
			Main.dust[num15].velocity /= 5f;
		}
		else if (type == 730)
		{
			if (Main.rand.Next(5) == 0)
			{
				Dust dust = Dust.NewDustDirect(position, width, height, 226, 0f, 0f, 150, default(Color), 0.7f);
				dust.noGravity = true;
				dust.velocity *= 1.4f;
			}
			if (Main.rand.Next(5) == 0)
			{
				Dust.NewDustDirect(position, width, height, 226, 0f, 0f, 150, default(Color), 0.5f).velocity.Y -= 0.5f;
			}
		}
		else if (type == 105)
		{
			if (Main.rand.Next(3) == 0)
			{
				int num16 = Dust.NewDust(position, width, height, 57, velocity.X * 0.2f, velocity.Y * 0.2f, 200, default(Color), 1.2f);
				Main.dust[num16].velocity += velocity * 0.3f;
				Main.dust[num16].velocity *= 0.2f;
			}
			if (Main.rand.Next(4) == 0)
			{
				int num17 = Dust.NewDust(position, width, height, 43, 0f, 0f, 254, default(Color), 0.3f);
				Main.dust[num17].velocity += velocity * 0.5f;
				Main.dust[num17].velocity *= 0.5f;
			}
		}
		else if (type == 153)
		{
			int num18 = Dust.NewDust(position - velocity * 3f, width, height, 115, velocity.X * 0.4f, velocity.Y * 0.4f, 140);
			Main.dust[num18].noGravity = true;
			Main.dust[num18].fadeIn = 1.25f;
			Main.dust[num18].velocity *= 0.25f;
		}
		else if (type == 342)
		{
			Lighting.AddLight(base.Center, 0.65f, 0.9f, 1f);
			if (timeLeft % 2 == 0)
			{
				int num19 = 10;
				int num20 = Dust.NewDust(position - velocity * 3f - new Vector2(num19, num19), width + num19 * 2, height + num19 * 2, 135, velocity.X * 0.4f, velocity.Y * 0.4f, 50, default(Color), 1.2f);
				Main.dust[num20].velocity *= 0.5f;
				Main.dust[num20].velocity += velocity * 0.25f;
			}
		}
		else if (type == 1103 && Main.rand.Next(3) == 0)
		{
			Dust dust2 = Dust.NewDustDirect(position - velocity * 8f, width, height, 4, velocity.X, velocity.Y, 84, new Color(78, 136, 255, 127));
			dust2.scale = 1f + Main.rand.NextFloat() * 0.3f;
			dust2.velocity += velocity * 0.5f;
			if (Main.rand.Next(4) != 0)
			{
				dust2.velocity *= 0.7f;
				dust2.noGravity = true;
				dust2.scale += 0.2f;
			}
			else
			{
				dust2.velocity *= 0.3f;
				dust2.scale -= 0.5f;
			}
		}
		ai[0] += 1f;
		bool flag3 = ai[0] >= (float)itemAnimationMax;
		if (flag2)
		{
			flag3 &= !player.channel;
		}
		if (flag3)
		{
			Kill();
		}
	}

	private float AI_019_Spears_GetSpearOffsetRelativeToPlayer(Player master, int itemAnimation = -1, int itemAnimationMax = -1)
	{
		if (itemAnimation == -1)
		{
			itemAnimation = Math.Max(0, master.itemAnimation);
		}
		if (itemAnimationMax == -1)
		{
			itemAnimationMax = Math.Max(1, master.itemAnimation);
		}
		Vector2 center = master.RotatedRelativePoint(master.MountedCenter);
		direction = master.direction;
		base.Center = center;
		_ = itemAnimationMax / 3;
		int num = itemAnimationMax;
		int num2 = itemAnimation;
		int num3 = itemAnimationMax / 3;
		float num4 = MathHelper.Min(num2, num3);
		float num5 = (float)num2 - num4;
		float num6 = 0f;
		float num7 = 0f;
		float num8 = 0f;
		spriteDirection = -direction;
		switch (type)
		{
		case 46:
			num6 = 3f;
			num8 = 1.6f;
			num7 = 1.4f;
			break;
		case 105:
			num6 = 3f;
			num8 = 2.4f;
			num7 = 2.1f;
			break;
		case 367:
			num6 = 3f;
			num8 = 1.6f;
			num7 = 1.5f;
			break;
		case 368:
			num6 = 3f;
			num8 = 1.5f;
			num7 = 1.4f;
			break;
		case 222:
			num6 = 3f;
			num8 = 2.4f;
			num7 = 2.1f;
			break;
		case 342:
			num6 = 3f;
			num8 = 2.4f;
			num7 = 2.1f;
			break;
		case 47:
			num6 = 4f;
			num8 = 1.2f;
			num7 = 0.9f;
			break;
		case 153:
			num6 = 4f;
			num8 = 1.5f;
			num7 = 1.3f;
			break;
		case 49:
			num6 = 4f;
			num8 = 1.1f;
			num7 = 0.85f;
			break;
		case 730:
			num6 = 8f;
			num8 = 1.5f;
			num7 = 1.2f;
			break;
		case 877:
		case 878:
		case 879:
			num6 = 28f;
			num8 = 0.4f;
			num7 = 0.4f;
			break;
		case 64:
		case 215:
			spriteDirection = -direction;
			num6 = 3f;
			num8 = 1.9f;
			num7 = 1.7f;
			break;
		case 66:
		case 97:
		case 212:
		case 218:
			num6 = 3f;
			num8 = 2.1f;
			num7 = 1.9f;
			break;
		case 130:
			num6 = 3f;
			num8 = 1.3f;
			num7 = 1f;
			break;
		case 1103:
			num6 = 4f;
			num8 = 1.1f;
			num7 = 0.85f;
			break;
		}
		float num9 = (float)(num - num3) - num5;
		float num10 = (float)num3 - num4;
		return num6 + num7 * num9 - num8 * num10;
	}

	public bool AI_019_Spears_GetExtensionHitbox(Player master, out Rectangle extensionBox)
	{
		extensionBox = default(Rectangle);
		if (master.itemAnimation < master.itemAnimationMax / 3)
		{
			return false;
		}
		int itemAnimationMax = master.itemAnimationMax;
		int itemAnimation = master.itemAnimation;
		int num = master.itemAnimationMax / 3;
		float num2 = Utils.Remap(itemAnimation, itemAnimationMax, num, 0f, 1f);
		float num3 = 10f;
		float num4 = 30f;
		float num5 = 10f;
		float num6 = 10f;
		switch (type)
		{
		default:
			return false;
		case 105:
			num4 = 50f;
			num6 = 20f;
			break;
		case 46:
			num4 = 50f;
			num6 = 15f;
			break;
		case 153:
			num4 = 40f;
			num6 = 10f;
			break;
		}
		num4 *= 1f / master.meleeSpeed;
		float num7 = num3 + num4 * num2;
		float num8 = num5 + num6 * num2;
		float f = velocity.ToRotation();
		Vector2 center = base.Center + f.ToRotationVector2() * num7;
		extensionBox = Utils.CenteredRectangle(center, new Vector2(num8, num8));
		return true;
	}

	private void AI_019_Spears_Old()
	{
		Vector2 vector = Main.player[owner].RotatedRelativePoint(Main.player[owner].MountedCenter);
		direction = Main.player[owner].direction;
		Main.player[owner].heldProj = whoAmI;
		Main.player[owner].MatchItemTimeToItemAnimation();
		position.X = vector.X - (float)(width / 2);
		position.Y = vector.Y - (float)(height / 2);
		bool flag = Main.player[owner].itemAnimation < Main.player[owner].itemAnimationMax / 3;
		if (!Main.player[owner].frozen)
		{
			if (type == 46)
			{
				if (ai[0] == 0f)
				{
					ai[0] = 3f;
					netUpdate = true;
				}
				if (flag)
				{
					ai[0] -= 1.6f;
				}
				else
				{
					ai[0] += 1.4f;
				}
			}
			else if (type == 105)
			{
				if (ai[0] == 0f)
				{
					ai[0] = 3f;
					netUpdate = true;
				}
				if (flag)
				{
					ai[0] -= 2.4f;
				}
				else
				{
					ai[0] += 2.1f;
				}
			}
			else if (type == 367)
			{
				spriteDirection = -direction;
				if (ai[0] == 0f)
				{
					ai[0] = 3f;
					netUpdate = true;
				}
				if (flag)
				{
					ai[0] -= 1.6f;
				}
				else
				{
					ai[0] += 1.5f;
				}
			}
			else if (type == 368)
			{
				spriteDirection = -direction;
				if (ai[0] == 0f)
				{
					ai[0] = 3f;
					netUpdate = true;
				}
				if (flag)
				{
					ai[0] -= 1.5f;
				}
				else
				{
					ai[0] += 1.4f;
				}
			}
			else if (type == 222)
			{
				if (ai[0] == 0f)
				{
					ai[0] = 3f;
					netUpdate = true;
				}
				if (flag)
				{
					ai[0] -= 2.4f;
					if (localAI[0] == 0f && Main.myPlayer == owner)
					{
						localAI[0] = 1f;
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X + velocity.X * ai[0], base.Center.Y + velocity.Y * ai[0], velocity.X, velocity.Y, 228, damage, knockBack, owner);
					}
				}
				else
				{
					ai[0] += 2.1f;
				}
			}
			else if (type == 342)
			{
				if (ai[0] == 0f)
				{
					ai[0] = 3f;
					netUpdate = true;
				}
				if (flag)
				{
					ai[0] -= 2.4f;
					if (localAI[0] == 0f && Main.myPlayer == owner)
					{
						localAI[0] = 1f;
						if (Collision.CanHit(Main.player[owner].position, Main.player[owner].width, Main.player[owner].height, new Vector2(base.Center.X + velocity.X * ai[0], base.Center.Y + velocity.Y * ai[0]), width, height))
						{
							NewProjectile(GetProjectileSource_FromThis(), base.Center.X + velocity.X * ai[0], base.Center.Y + velocity.Y * ai[0], velocity.X * 2.4f, velocity.Y * 2.4f, 343, (int)((double)damage * 0.8), knockBack * 0.85f, owner);
						}
					}
				}
				else
				{
					ai[0] += 2.1f;
				}
			}
			else if (type == 47)
			{
				if (ai[0] == 0f)
				{
					ai[0] = 4f;
					netUpdate = true;
				}
				if (flag)
				{
					ai[0] -= 1.2f;
				}
				else
				{
					ai[0] += 0.9f;
				}
			}
			else if (type == 153)
			{
				spriteDirection = -direction;
				if (ai[0] == 0f)
				{
					ai[0] = 4f;
					netUpdate = true;
				}
				if (flag)
				{
					ai[0] -= 1.5f;
				}
				else
				{
					ai[0] += 1.3f;
				}
			}
			else if (type == 49)
			{
				if (ai[0] == 0f)
				{
					ai[0] = 4f;
					netUpdate = true;
				}
				if (flag)
				{
					ai[0] -= 1.1f;
				}
				else
				{
					ai[0] += 0.85f;
				}
			}
			else if (type == 730)
			{
				spriteDirection = -direction;
				if (ai[0] == 0f)
				{
					ai[0] = 8f;
					netUpdate = true;
					if (localAI[0] == 0f && Main.myPlayer == owner)
					{
						localAI[0] = 1f;
						Vector2 vector2 = velocity * 4f;
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X + velocity.X * ai[0], base.Center.Y + velocity.Y * ai[0], vector2.X, vector2.Y, 732, (int)((double)damage * 1.25), knockBack * 0.5f, owner);
					}
				}
				if (flag)
				{
					ai[0] -= 1.5f;
				}
				else
				{
					ai[0] += 1.2f;
				}
			}
			else if (type == 64 || type == 215)
			{
				spriteDirection = -direction;
				if (ai[0] == 0f)
				{
					ai[0] = 3f;
					netUpdate = true;
				}
				if (flag)
				{
					ai[0] -= 1.9f;
				}
				else
				{
					ai[0] += 1.7f;
				}
			}
			else if (type == 66 || type == 97 || type == 212 || type == 218)
			{
				spriteDirection = -direction;
				if (ai[0] == 0f)
				{
					ai[0] = 3f;
					netUpdate = true;
				}
				if (flag)
				{
					ai[0] -= 2.1f;
				}
				else
				{
					ai[0] += 1.9f;
				}
			}
			else if (type == 130)
			{
				spriteDirection = -direction;
				if (ai[0] == 0f)
				{
					ai[0] = 3f;
					netUpdate = true;
				}
				if (flag)
				{
					ai[0] -= 1.3f;
				}
				else
				{
					ai[0] += 1f;
				}
			}
		}
		position += velocity * ai[0];
		if (type == 130)
		{
			if (ai[1] == 0f || ai[1] == 4f || ai[1] == 8f || ai[1] == 12f || ai[1] == 16f || ai[1] == 20f || ai[1] == 24f)
			{
				NewProjectile(GetProjectileSource_FromThis(), position.X + (float)(width / 2), position.Y + (float)(height / 2), velocity.X, velocity.Y, 131, damage / 3, 0f, owner);
			}
			ai[1] += 1f;
		}
		if (Main.player[owner].itemAnimation == 0)
		{
			Kill();
		}
		rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 2.355f;
		if (spriteDirection == -1)
		{
			rotation -= 1.57f;
		}
		if (type == 46)
		{
			if (Main.rand.Next(5) == 0)
			{
				Dust.NewDust(position, width, height, 14, 0f, 0f, 150, default(Color), 1.4f);
			}
			int num = Dust.NewDust(position, width, height, 27, velocity.X * 0.2f + (float)(direction * 3), velocity.Y * 0.2f, 100, default(Color), 1.2f);
			Main.dust[num].noGravity = true;
			Main.dust[num].velocity.X /= 2f;
			Main.dust[num].velocity.Y /= 2f;
			num = Dust.NewDust(position - velocity * 2f, width, height, 27, 0f, 0f, 150, default(Color), 1.4f);
			Main.dust[num].velocity.X /= 5f;
			Main.dust[num].velocity.Y /= 5f;
		}
		if (type == 730)
		{
			if (Main.rand.Next(5) == 0)
			{
				Dust dust = Dust.NewDustDirect(position, width, height, 226, 0f, 0f, 150, default(Color), 0.7f);
				dust.noGravity = true;
				dust.velocity *= 1.4f;
			}
			if (Main.rand.Next(5) == 0)
			{
				Dust.NewDustDirect(position, width, height, 226, 0f, 0f, 150, default(Color), 0.5f).velocity.Y -= 0.5f;
			}
		}
		else if (type == 105)
		{
			if (Main.rand.Next(3) == 0)
			{
				int num2 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 57, velocity.X * 0.2f, velocity.Y * 0.2f, 200, default(Color), 1.2f);
				Main.dust[num2].velocity += velocity * 0.3f;
				Main.dust[num2].velocity *= 0.2f;
			}
			if (Main.rand.Next(4) == 0)
			{
				int num3 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 43, 0f, 0f, 254, default(Color), 0.3f);
				Main.dust[num3].velocity += velocity * 0.5f;
				Main.dust[num3].velocity *= 0.5f;
			}
		}
		else if (type == 153)
		{
			int num4 = Dust.NewDust(position - velocity * 3f, width, height, 115, velocity.X * 0.4f, velocity.Y * 0.4f, 140);
			Main.dust[num4].noGravity = true;
			Main.dust[num4].fadeIn = 1.25f;
			Main.dust[num4].velocity *= 0.25f;
		}
	}

	private void AI_168_FirstFractal()
	{
		float num = 60f;
		if ((localAI[0] += 1f) >= num - 1f)
		{
			Kill();
			return;
		}
		if (frameCounter == 0)
		{
			frameCounter = 1;
			frame = Main.rand.Next(15);
		}
		velocity = velocity.RotatedBy(ai[0]);
		Opacity = Utils.GetLerpValue(0f, 12f, localAI[0], clamped: true) * Utils.GetLerpValue(num, num - 12f, localAI[0], clamped: true);
		direction = ((velocity.X > 0f) ? 1 : (-1));
		spriteDirection = direction;
		rotation = (float)Math.PI / 4f * (float)spriteDirection + velocity.ToRotation();
		if (spriteDirection == -1)
		{
			rotation += (float)Math.PI;
		}
		if (localAI[0] > 7f)
		{
			int num2 = 5;
			_ = base.Center - new Vector2(num2);
			if (Main.rand.Next(15) == 0)
			{
				Dust dust = Dust.NewDustPerfect(base.Center, 278, null, 100, Color.Lerp(GetFirstFractalColor(), Color.White, Main.rand.NextFloat() * 0.3f));
				dust.scale = 0.7f;
				dust.noGravity = true;
				dust.velocity *= 0.5f;
				dust.velocity += velocity * 2f;
			}
		}
	}

	private void AI_167_SparkleGuitar()
	{
		float num = 90f;
		if ((localAI[0] += 1f) >= num - 1f)
		{
			Kill();
			return;
		}
		float num2 = localAI[0] / num;
		Vector2 center = Main.player[owner].Center;
		Vector2 vector = new Vector2(ai[0], ai[1]);
		Vector2 vector2 = -velocity;
		Vector2 value = center + vector2 * 2f;
		Vector2 value2 = vector + vector2 * (1f - num2 * 3f);
		base.Center = Vector2.CatmullRom(value, center, vector, value2, num2);
		int num3 = type;
		if (num3 == 856)
		{
			Lighting.AddLight(base.Center, Color.HotPink.ToVector3() * 0.3f);
			rotation = (float)Math.PI * 2f * num2 * 1f;
		}
	}

	private void AI_164_StormTigerGem()
	{
		Player player = Main.player[owner];
		localAI[1] += 1f;
		if (type == 831)
		{
			if (player.dead)
			{
				player.stormTiger = false;
			}
			if (player.stormTiger)
			{
				timeLeft = 2;
			}
			if (++frameCounter >= 4)
			{
				frameCounter = 0;
				if (++frame >= 6)
				{
					frame = 0;
				}
			}
		}
		if (type == 970)
		{
			if (player.ownedProjectileCounts[type] > 1 && localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlaySound(SoundID.AbigailUpgrade, base.Center);
			}
			if (player.dead)
			{
				player.abigailMinion = false;
			}
			if (player.abigailMinion)
			{
				timeLeft = 2;
			}
			if (++frameCounter >= 4)
			{
				frameCounter = 0;
				if (++frame >= 6)
				{
					frame = 0;
				}
			}
		}
		List<int> ai164_blacklistedTargets = _ai164_blacklistedTargets;
		ai164_blacklistedTargets.Clear();
		AI_GetMyGroupIndexAndFillBlackList(ai164_blacklistedTargets, out var index, out var totalIndexesInGroup);
		Vector2 center = AI_164_GetHomeLocation(player, index, totalIndexesInGroup);
		base.Center = center;
	}

	public static Vector2 AI_164_GetHomeLocation(Player master, int stackedIndex, int totalIndexes)
	{
		int num = master.bodyFrame.Height;
		if (num == 0)
		{
			num = 1;
		}
		Vector2 vector = Main.OffsetsPlayerHeadgear[master.bodyFrame.Y / num];
		vector.Y -= 2f;
		float num2 = master.miscCounterNormalized * 2f;
		int num3 = stackedIndex / 4;
		int num4 = totalIndexes / 4;
		if (totalIndexes % 4 > 0)
		{
			num4++;
		}
		int num5 = (totalIndexes - num3 * 4) % 4;
		if (num5 == 0)
		{
			num5 = 4;
		}
		if (num4 - 1 != num3)
		{
			num5 = 4;
		}
		int num6 = stackedIndex % num5;
		float num7 = (float)num6 / (float)num5;
		num2 += (float)num3 / 8f;
		if (stackedIndex >= (num4 - 1) * 4 && num3 > 0)
		{
			num2 = 0f;
			switch (num5)
			{
			case 1:
				num7 = 0f;
				break;
			case 2:
				num7 = 0.25f + (float)num6 * 0.5f;
				break;
			case 3:
				num7 = (float)(num6 - 1) / 6f;
				break;
			case 4:
				num7 = ((float)num6 - 1.5f) / 6f;
				break;
			}
		}
		Vector2 vector2 = new Vector2(0f, -8 - 12 * num3).RotatedBy((num2 + num7) * ((float)Math.PI * 2f));
		vector += vector2 + new Vector2(0f, master.gravDir * -40f);
		Vector2 mountedCenter = master.MountedCenter;
		_ = master.direction;
		Vector2 vec = mountedCenter + new Vector2(0f, master.gravDir * -21f) + vector;
		vec.Y += master.gfxOffY;
		return vec.Floor();
	}

	private void AI_162_TigerPounce()
	{
		if (ai[0] < 0f)
		{
			Opacity = 0f;
			ai[0] += 1f;
			return;
		}
		bool flag = false;
		flag = true;
		if (frameCounter == 0)
		{
			frameCounter = 1;
			localAI[0] = base.Center.X;
			localAI[1] = base.Center.Y;
			flag = true;
		}
		Vector2 vector = new Vector2(localAI[0], localAI[1]);
		Vector2 vector2 = vector + velocity;
		float y = Vector2.Distance(vector, vector2) * 1.5f;
		float num = 0.1f;
		Vector2 value = Vector2.Lerp(vector, vector2, 0f - num) + new Vector2(0f, y);
		Vector2 value2 = Vector2.Lerp(vector, vector2, 1f + num) + new Vector2(0f, y);
		if (Opacity < 1f)
		{
			Opacity += 0.1f;
		}
		int num2 = Math.Sign(vector2.X - vector.X);
		rotation += (float)num2 * -0.2f;
		spriteDirection = num2;
		if (ai[1] < 1f)
		{
			ai[1] = 60f;
		}
		ai[0] += 1f / ai[1];
		Vector2 vector3 = Vector2.CatmullRom(amount: Utils.Clamp(ai[0], 0f, 1f), value1: value, value2: vector, value3: vector2, value4: value2);
		if (flag)
		{
			for (float num3 = 0f; num3 < 1f; num3 += 0.5f)
			{
				if (Main.rand.Next(19) == 0)
				{
					Vector2 vector4 = base.Center + DirectionTo(vector3).SafeNormalize(Vector2.UnitY) * 100f;
					Dust dust = Dust.NewDustPerfect(base.Center + base.Size * Main.rand.NextVector2Square(0f, 1f), 278, Main.rand.NextVector2Circular(3f, 3f), 100, Color.White * 0.4f);
					dust.velocity.Y += -0.6f;
					dust.velocity += velocity * 0.1f;
					Main.rand.Next(5);
					dust.velocity = (vector4 - base.Center) * 0.05f;
					dust.fadeIn = 0f;
					dust.scale = 0.7f;
					dust.noGravity = true;
				}
			}
			if (Main.rand.Next(2) == 0)
			{
				Dust obj = Main.dust[Dust.NewDust(position, width, height, 269)];
				obj.fadeIn = 0.7f;
				obj.scale = 0.4f;
				obj.velocity += velocity * 0.001f;
				obj.noLight = true;
			}
		}
		base.Center = vector3;
		if (ai[0] >= 1f)
		{
			Kill();
		}
	}

	private void PrepareBombToBlow()
	{
		tileCollide = false;
		ai[1] = 0f;
		alpha = 255;
		if (type == 28 || type == 37 || type == 516 || type == 519)
		{
			Resize(128, 128);
			damage = 100;
			knockBack = 8f;
		}
		else if (type == 773)
		{
			Resize(48, 96);
			damage = 100;
			knockBack = 8f;
		}
		else if (type == 29 || type == 470 || type == 637)
		{
			Resize(250, 250);
			damage = 250;
			knockBack = 10f;
		}
		else if (type == 1086 || type == 1087)
		{
			Resize(280, 280);
			damage = 200;
			knockBack = 9f;
		}
		else if (type == 30 || type == 397 || type == 517 || type == 588)
		{
			Resize(128, 128);
			knockBack = 8f;
		}
		else if (type == 681)
		{
			Resize(80, 80);
			knockBack = 8f;
		}
		else if (type == 102)
		{
			Resize(128, 128);
			damage = 40;
			knockBack = 8f;
		}
		else if (type == 779 || type == 783 || type == 862 || type == 863)
		{
			Resize(48, 48);
			knockBack = 8f;
		}
		else if (type == 133 || type == 134 || type == 135 || type == 136 || type == 137 || type == 138 || type == 338 || type == 339 || type == 930)
		{
			Resize(128, 128);
			knockBack = 8f;
		}
		else if (type == 794 || type == 797 || type == 795 || type == 798 || type == 793 || type == 796 || type == 808 || type == 808)
		{
			Resize(250, 250);
			knockBack = 12f;
		}
		else if (type == 776 || type == 780 || type == 777 || type == 781 || type == 778 || type == 782 || type == 803 || type == 804)
		{
			Resize(128, 128);
			knockBack = 12f;
		}
		else if (type == 784 || type == 785 || type == 786 || type == 805 || type == 903 || type == 787 || type == 788 || type == 789 || type == 806 || type == 904 || type == 790 || type == 791 || type == 792 || type == 807 || type == 905 || type == 799 || type == 800 || type == 801 || type == 810 || type == 906 || type == 910 || type == 911)
		{
			if (type == 903 || type == 904 || type == 905 || type == 906 || type == 910 || type == 911)
			{
				damage = 100;
			}
			Resize(48, 48);
			knockBack = 12f;
		}
		else if (type == 139 || type == 140 || type == 141 || type == 142 || type == 143 || type == 144 || type == 340 || type == 341)
		{
			Resize(200, 200);
			knockBack = 10f;
		}
	}

	private bool AI_016_CanAcornPlant(out Point plantPoint)
	{
		plantPoint = Point.Zero;
		Point point = base.Center.ToTileCoordinates();
		if (!WorldGen.InWorld(point.X, point.Y, 5))
		{
			return false;
		}
		for (int i = 0; i < 2; i++)
		{
			Point point2 = new Point(point.X, point.Y + i);
			if (!WorldGen.InWorld(point.X, point.Y, 5))
			{
				break;
			}
			Tile tile = Main.tile[point2.X, point2.Y];
			if (tile == null || !tile.active() || !tile.nactive() || tile.topSlope() || tile.halfBrick())
			{
				continue;
			}
			Tile tile2 = Main.tile[point2.X, point2.Y - 1];
			if (tile2 == null || (tile2.active() && tile2.type >= 0 && !Main.tileCut[tile2.type]) || !WorldGen.CanCutTile(point2.X, point2.Y - 1, TileCuttingContext.TilePlacement))
			{
				continue;
			}
			Tile tile3 = Main.tile[point2.X, point2.Y - 2];
			if (tile3 != null && (!tile3.active() || tile3.type < 0 || Main.tileCut[tile3.type]) && WorldGen.CanCutTile(point2.X, point2.Y - 2, TileCuttingContext.TilePlacement))
			{
				switch (tile.type)
				{
				case 2:
				case 23:
				case 53:
				case 60:
				case 109:
				case 112:
				case 116:
				case 147:
				case 199:
				case 234:
				case 477:
				case 492:
				case 633:
				case 661:
				case 662:
					plantPoint = new Point(point2.X, point2.Y - 1);
					return true;
				}
			}
		}
		return false;
	}

	private void AI_016_Bombs()
	{
		if (owner == Main.myPlayer)
		{
			if (wet && (type == 799 || type == 800 || type == 801 || type == 810 || type == 906 || type == 784 || type == 785 || type == 786 || type == 805 || type == 903 || type == 787 || type == 788 || type == 789 || type == 806 || type == 904 || type == 790 || type == 791 || type == 792 || type == 807 || type == 905 || (type == 1077 && localAI[0] == 1f)))
			{
				timeLeft = 1;
			}
			if (type == 1077)
			{
				localAI[0] = ((!wet) ? 1 : 0);
			}
		}
		if (SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2])) == null && timeLeft > 1 && ProjectileID.Sets.IsABombWithFuse[type])
		{
			localAI[2] = SoundEngine.PlayTrackedLoopedSound(SoundID.BombFuse, base.Center, new ProjectileAudioTracker(this).IsActiveAndInGame).ToFloat();
			SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2]));
		}
		if (type == 108 || type == 164 || type == 1002)
		{
			ai[0] += 1f;
			if (ai[0] > 3f)
			{
				Kill();
			}
		}
		if (type == 102)
		{
			int num = (int)(base.Center.X / 16f);
			int num2 = (int)(base.Center.Y / 16f);
			if (WorldGen.InWorld(num, num2))
			{
				Tile tile = Main.tile[num, num2];
				if (tile != null && tile.active() && (TileID.Sets.Platforms[tile.type] || tile.type == 380))
				{
					Kill();
					return;
				}
			}
		}
		if (type == 75)
		{
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlaySound(66, (int)position.X, (int)position.Y);
			}
			if (!Main.tenthAnniversaryWorld)
			{
				for (int i = 0; i < 255; i++)
				{
					if (Main.player[i].active && !Main.player[i].dead && !Main.player[i].ghost && (base.Center - Main.player[i].Center).Length() < 40f)
					{
						Kill();
						return;
					}
				}
			}
		}
		bool flag = false;
		if (type == 37 || type == 397 || type == 470 || type == 519 || type == 773 || type == 911 || type == 1087)
		{
			try
			{
				int num3 = (int)(position.X / 16f) - 1;
				int num4 = (int)((position.X + (float)width) / 16f) + 2;
				int num5 = (int)(position.Y / 16f) - 1;
				int num6 = (int)((position.Y + (float)height) / 16f) + 2;
				if (num3 < 0)
				{
					num3 = 0;
				}
				if (num4 > Main.maxTilesX)
				{
					num4 = Main.maxTilesX;
				}
				if (num5 < 0)
				{
					num5 = 0;
				}
				if (num6 > Main.maxTilesY)
				{
					num6 = Main.maxTilesY;
				}
				Vector2 vector = default(Vector2);
				for (int j = num3; j < num4; j++)
				{
					for (int k = num5; k < num6; k++)
					{
						if (Main.tile[j, k] == null || !Main.tile[j, k].nactive() || !Main.tileSolid[Main.tile[j, k].type] || Main.tileSolidTop[Main.tile[j, k].type])
						{
							continue;
						}
						vector.X = j * 16;
						vector.Y = k * 16;
						if (!(position.X + (float)width - 4f > vector.X) || !(position.X + 4f < vector.X + 16f) || !(position.Y + (float)height - 4f > vector.Y) || !(position.Y + 4f < vector.Y + 16f))
						{
							continue;
						}
						if (type == 911 && owner == Main.myPlayer && localAI[0] == 0f)
						{
							float num7 = 12f;
							Vector2 value = vector + new Vector2(8f, 8f);
							if (Vector2.Distance(base.Center, value) < num7)
							{
								base.Center += velocity.SafeNormalize(Vector2.Zero) * -4f;
							}
							localAI[0] = 1f;
							netUpdate = true;
						}
						velocity.X = 0f;
						velocity.Y = -0.2f;
						flag = true;
					}
				}
			}
			catch
			{
			}
		}
		if (flag && type == 911)
		{
			Point p = base.Center.ToTileCoordinates();
			if (WorldGen.SolidOrSlopedTile(Framing.GetTileSafely(p.X, p.Y)))
			{
				Vector2 v = p.ToWorldCoordinates() - base.Center;
				base.Center += v.SafeNormalize(Vector2.Zero) * -4f;
			}
		}
		if (flag && type == 773)
		{
			Player player = Main.player[owner];
			Vector2 v2 = DirectionTo(player.Center).SafeNormalize(Vector2.UnitX * player.direction);
			float num8 = rotation;
			float num9 = v2.ToRotation() + (float)Math.PI / 2f;
			rotation = rotation.AngleLerp(num9, 0.2f);
			rotation = rotation.AngleTowards(num9, 0.05f);
			Vector2 vector2 = (rotation - (float)Math.PI / 2f).ToRotationVector2();
			if (Main.rand.Next(3) == 0)
			{
				Dust dust = Dust.NewDustPerfect(base.Center + vector2 * 10f, 59, vector2 * 2f + Main.rand.NextVector2Circular(0.25f, 0.25f), 0, default(Color), 2f);
				dust.noGravity = true;
				if (Main.rand.Next(3) == 0)
				{
					dust.velocity *= 1.5f;
					dust.noGravity = false;
					dust.scale /= 2f;
				}
			}
			if (Main.rand.Next(3) == 0)
			{
				Point scarabBombDigDirectionSnap = GetScarabBombDigDirectionSnap8();
				Dust.NewDustPerfect(base.Center + vector2 * -10f, 59, scarabBombDigDirectionSnap.ToVector2() * 1.5f, 0, default(Color), 2f).noGravity = true;
			}
			if (Main.rand.Next(15) == 0)
			{
				Dust dust2 = Dust.NewDustPerfect(base.Center + vector2 * 10f, 88, vector2 * 3f + Main.rand.NextVector2Circular(0.25f, 0.25f), 0, default(Color), 2f);
				dust2.noGravity = true;
				if (Main.rand.Next(3) == 0)
				{
					dust2.velocity *= 1.5f;
				}
			}
			bool flag2 = Main.rand.Next(30) == 0;
			if (num8 != rotation && Main.rand.Next(40) == 0)
			{
				flag2 = true;
			}
			if (flag2)
			{
				float num10 = (float)Math.PI * 2f * Main.rand.NextFloat();
				for (float num11 = 0f; num11 < 1f; num11 += 1f / 7f)
				{
					Vector2 spinningpoint = (num11 * ((float)Math.PI * 2f) + num10).ToRotationVector2();
					spinningpoint *= new Vector2(1f, 0.3f);
					spinningpoint = spinningpoint.RotatedBy(num9);
					Dust dust3 = Dust.NewDustPerfect(base.Center + spinningpoint + vector2 * 8f, 59, vector2 * 3f + spinningpoint);
					dust3.noGravity = true;
					dust3.fadeIn = 1.6f;
				}
			}
			if (++frameCounter >= 3)
			{
				frameCounter = 0;
				if (++frame >= 4)
				{
					frame = 0;
				}
			}
		}
		if (type == 519)
		{
			localAI[1] += 1f;
			float num12 = 180f - localAI[1];
			if (num12 < 0f)
			{
				num12 = 0f;
			}
			frameCounter++;
			if (num12 < 15f)
			{
				frameCounter++;
			}
			if ((float)frameCounter >= (num12 / 10f + 6f) / 2f)
			{
				frame++;
				frameCounter = 0;
				if (frame >= Main.projFrames[type])
				{
					frame = 0;
				}
			}
		}
		if (type == 681 && localAI[1] == 0f)
		{
			localAI[1] = 1f;
		}
		int num13 = 6;
		if (type == 776 || type == 780 || type == 803 || type == 804)
		{
			num13 = 228;
		}
		else if (type == 784 || type == 805)
		{
			num13 = ((Main.rand.Next(3) == 0) ? 6 : Dust.dustWater());
		}
		else if (type == 787 || type == 806)
		{
			num13 = ((Main.rand.Next(3) == 0) ? 6 : 35);
		}
		else if (type == 790 || type == 807)
		{
			num13 = ((Main.rand.Next(3) == 0) ? 6 : 152);
		}
		if (type == 102)
		{
			if (velocity.Y > 10f)
			{
				velocity.Y = 10f;
			}
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlaySound(SoundID.Item10, position);
			}
			frameCounter++;
			if (frameCounter > 3)
			{
				frame++;
				frameCounter = 0;
			}
			if (frame > 1)
			{
				frame = 0;
			}
			if (velocity.Y == 0f && timeLeft > 3)
			{
				timeLeft = 3;
			}
		}
		if (type == 303 && timeLeft <= 3 && hostile)
		{
			position.X += width / 2;
			position.Y += height / 2;
			width = 128;
			height = 128;
			position.X -= width / 2;
			position.Y -= height / 2;
		}
		if (owner == Main.myPlayer && type == 1088 && (timeLeft <= 3 || velocity.Length() <= 0.01f))
		{
			Kill();
		}
		else if (owner == Main.myPlayer && timeLeft <= 3)
		{
			PrepareBombToBlow();
		}
		else
		{
			if (Main.getGoodWorld && Main.noTrapsWorld && !Main.tenthAnniversaryWorld)
			{
				timeLeft--;
			}
			if (type != 30 && type != 75 && type != 517 && type != 681 && type != 588 && type != 397 && type != 108 && type != 1002 && type != 133 && type != 134 && type != 135 && type != 136 && type != 137 && type != 138 && type != 139 && type != 140 && type != 141 && type != 142 && type != 143 && type != 144 && type != 164 && type != 303 && type != 338 && type != 339 && type != 340 && type != 341 && (type < 776 || type > 801) && (type < 803 || type > 810) && type != 862 && type != 863 && type != 930 && type != 1088)
			{
				damage = 0;
			}
			if (type == 1086 || type == 1087)
			{
				short num14 = 307;
				Vector2 vector3 = base.Center + new Vector2(0f, -height / 2).RotatedBy(rotation) * 1.1f;
				Vector2 vector4 = (vector3 - base.Center).SafeNormalize(Vector2.Zero) * 5f;
				Dust obj2 = Main.dust[Dust.NewDust(base.Center, 6, 6, num14, velocity.X, velocity.Y, 100, default(Color), 1.6f)];
				obj2.position = vector3;
				obj2.noGravity = true;
				obj2.velocity = velocity + vector4;
			}
			else if (type == 1088)
			{
				if (frameCounter == 0)
				{
					frameCounter = 1;
					frame = Main.rand.Next(2);
				}
			}
			else if (type == 338 || type == 339 || type == 340 || type == 341 || type == 803 || type == 804 || type == 808 || type == 809 || type == 810 || type == 805 || type == 806 || type == 807 || type == 930)
			{
				localAI[1] += 1f;
				if (localAI[1] > 6f)
				{
					alpha = 0;
				}
				else
				{
					alpha = (int)(255f - 42f * localAI[1]) + 100;
					if (alpha > 255)
					{
						alpha = 255;
					}
				}
				for (int l = 0; l < 2; l++)
				{
					float num15 = 0f;
					float num16 = 0f;
					if (l == 1)
					{
						num15 = velocity.X * 0.5f;
						num16 = velocity.Y * 0.5f;
					}
					if (!(localAI[1] > 9f))
					{
						continue;
					}
					if (Main.rand.Next(2) == 0)
					{
						int num17 = Dust.NewDust(new Vector2(position.X + 3f + num15, position.Y + 3f + num16) - velocity * 0.5f, width - 8, height - 8, num13, 0f, 0f, 100);
						Main.dust[num17].scale *= 1.4f + (float)Main.rand.Next(10) * 0.1f;
						Main.dust[num17].velocity *= 0.2f;
						Main.dust[num17].noGravity = true;
						if (Main.dust[num17].type == 152)
						{
							Main.dust[num17].scale *= 0.5f;
							Main.dust[num17].velocity += velocity * 0.1f;
						}
						else if (Main.dust[num17].type == 35)
						{
							Main.dust[num17].scale *= 0.5f;
							Main.dust[num17].velocity += velocity * 0.1f;
						}
						else if (Main.dust[num17].type == Dust.dustWater())
						{
							Main.dust[num17].scale *= 0.65f;
							Main.dust[num17].velocity += velocity * 0.1f;
						}
						if (type == 808 || type == 809)
						{
							Dust dust4 = Main.dust[num17];
							if (dust4.dustIndex != 6000)
							{
								dust4 = Dust.NewDustPerfect(dust4.position, dust4.type, dust4.velocity, dust4.alpha, dust4.color, dust4.scale + 0.5f);
								dust4.velocity = Main.rand.NextVector2Circular(3f, 3f);
								dust4.noGravity = true;
							}
							if (dust4.dustIndex != 6000)
							{
								dust4 = Dust.NewDustPerfect(dust4.position, dust4.type, dust4.velocity, dust4.alpha, dust4.color, dust4.scale + 0.5f);
								dust4.velocity = ((float)Math.PI * 2f * ((float)timeLeft / 20f)).ToRotationVector2() * 3f;
								dust4.noGravity = true;
							}
						}
					}
					if (Main.rand.Next(2) == 0)
					{
						int num18 = Dust.NewDust(new Vector2(position.X + 3f + num15, position.Y + 3f + num16) - velocity * 0.5f, width - 8, height - 8, 31, 0f, 0f, 100, default(Color), 0.5f);
						Main.dust[num18].fadeIn = 0.5f + (float)Main.rand.Next(5) * 0.1f;
						Main.dust[num18].velocity *= 0.05f;
					}
				}
				float x = position.X;
				float y = position.Y;
				float num19 = 600f;
				if (type == 930)
				{
					num19 = 650f;
				}
				bool flag3 = false;
				ai[0] += 1f;
				if (ai[0] > 30f)
				{
					ai[0] = 30f;
					for (int m = 0; m < Main.maxNPCs; m++)
					{
						if (Main.npc[m].CanBeChasedBy(this))
						{
							float num20 = Main.npc[m].position.X + (float)(Main.npc[m].width / 2);
							float num21 = Main.npc[m].position.Y + (float)(Main.npc[m].height / 2);
							float num22 = Math.Abs(position.X + (float)(width / 2) - num20) + Math.Abs(position.Y + (float)(height / 2) - num21);
							if (num22 < num19 && Collision.CanHit(position, width, height, Main.npc[m].position, Main.npc[m].width, Main.npc[m].height))
							{
								num19 = num22;
								x = num20;
								y = num21;
								flag3 = true;
							}
						}
					}
				}
				if (!flag3)
				{
					x = position.X + (float)(width / 2) + velocity.X * 100f;
					y = position.Y + (float)(height / 2) + velocity.Y * 100f;
				}
				float num23 = 16f;
				if (type == 930)
				{
					num23 = 12f;
				}
				Vector2 value2 = (new Vector2(x, y) - base.Center).SafeNormalize(-Vector2.UnitY) * num23;
				velocity = Vector2.Lerp(velocity, value2, 1f / 12f);
			}
			else if (type == 134 || type == 137 || type == 140 || type == 143 || type == 303 || type == 776 || type == 780 || type == 793 || type == 796 || type == 799 || type == 784 || type == 787 || type == 790)
			{
				if (Math.Abs(velocity.X) >= 8f || Math.Abs(velocity.Y) >= 8f)
				{
					for (int n = 0; n < 2; n++)
					{
						float num24 = 0f;
						float num25 = 0f;
						if (n == 1)
						{
							num24 = velocity.X * 0.5f;
							num25 = velocity.Y * 0.5f;
						}
						int num26 = Dust.NewDust(new Vector2(position.X + 3f + num24, position.Y + 3f + num25) - velocity * 0.5f, width - 8, height - 8, num13, 0f, 0f, 100);
						Main.dust[num26].scale *= 2f + (float)Main.rand.Next(10) * 0.1f;
						Main.dust[num26].velocity *= 0.2f;
						Main.dust[num26].noGravity = true;
						if (Main.dust[num26].type == 152)
						{
							Main.dust[num26].scale *= 0.5f;
							Main.dust[num26].velocity += velocity * 0.1f;
						}
						else if (Main.dust[num26].type == 35)
						{
							Main.dust[num26].scale *= 0.5f;
							Main.dust[num26].velocity += velocity * 0.1f;
						}
						else if (Main.dust[num26].type == Dust.dustWater())
						{
							Main.dust[num26].scale *= 0.65f;
							Main.dust[num26].velocity += velocity * 0.1f;
						}
						if (type == 793 || type == 796)
						{
							Dust dust5 = Main.dust[num26];
							if (dust5.dustIndex != 6000)
							{
								dust5 = Dust.NewDustPerfect(dust5.position, dust5.type, dust5.velocity, dust5.alpha, dust5.color, dust5.scale);
								dust5.velocity = Main.rand.NextVector2Circular(3f, 3f);
								dust5.noGravity = true;
							}
							if (dust5.dustIndex != 6000)
							{
								dust5 = Dust.NewDustPerfect(dust5.position, dust5.type, dust5.velocity, dust5.alpha, dust5.color, dust5.scale);
								dust5.velocity = ((float)Math.PI * 2f * ((float)timeLeft / 20f)).ToRotationVector2() * 3f;
								dust5.noGravity = true;
							}
						}
						num26 = Dust.NewDust(new Vector2(position.X + 3f + num24, position.Y + 3f + num25) - velocity * 0.5f, width - 8, height - 8, 31, 0f, 0f, 100, default(Color), 0.5f);
						Main.dust[num26].fadeIn = 1f + (float)Main.rand.Next(5) * 0.1f;
						Main.dust[num26].velocity *= 0.05f;
					}
				}
				if (Math.Abs(velocity.X) < 15f && Math.Abs(velocity.Y) < 15f)
				{
					velocity *= 1.1f;
				}
			}
			else if (type == 133 || type == 136 || type == 139 || type == 142 || type == 777 || type == 781 || type == 794 || type == 797 || type == 800 || type == 785 || type == 788 || type == 791)
			{
				int num27 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100);
				Main.dust[num27].scale *= 1f + (float)Main.rand.Next(10) * 0.1f;
				Main.dust[num27].velocity *= 0.2f;
				Main.dust[num27].noGravity = true;
			}
			else if (type == 135 || type == 138 || type == 141 || type == 144 || type == 778 || type == 782 || type == 795 || type == 798 || type == 801 || type == 786 || type == 789 || type == 792)
			{
				if ((double)velocity.X > -0.2 && (double)velocity.X < 0.2 && (double)velocity.Y > -0.2 && (double)velocity.Y < 0.2)
				{
					alpha += 2;
					if (alpha > 200)
					{
						alpha = 200;
					}
				}
				else
				{
					alpha = 0;
					int num28 = Dust.NewDust(new Vector2(position.X + 3f, position.Y + 3f) - velocity * 0.5f, width - 8, height - 8, 31, 0f, 0f, 100);
					Main.dust[num28].scale *= 1.6f + (float)Main.rand.Next(5) * 0.1f;
					Main.dust[num28].velocity *= 0.05f;
					Main.dust[num28].noGravity = true;
				}
			}
			else if (type == 779 || type == 783 || type == 862 || type == 863)
			{
				if (Main.rand.Next(25) == 0)
				{
					Dust dust6 = Dust.NewDustDirect(position, width, height, 228, (0f - velocity.X) / 10f, (0f - velocity.Y) / 10f, 100);
					dust6.noGravity = true;
					dust6.velocity *= 0f;
					dust6.scale = 1.3f;
				}
				if (Main.rand.Next(5) == 0)
				{
					Dust dust7 = Dust.NewDustDirect(position, width, height, 31, (0f - velocity.X) / 10f, (0f - velocity.Y) / 10f, 100);
					dust7.noGravity = true;
					dust7.velocity *= 0f;
					dust7.scale = 1.3f;
				}
				if (frameCounter == 0)
				{
					frameCounter = 1;
					frame = Main.rand.Next(4);
				}
			}
			else if (type != 30 && type != 517 && type != 681 && type != 397 && type != 519 && type != 588 && type != 779 && type != 783 && type != 862 && type != 863 && Main.rand.Next(2) == 0)
			{
				int num29 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100);
				Main.dust[num29].scale = 0.1f + (float)Main.rand.Next(5) * 0.1f;
				Main.dust[num29].fadeIn = 1.5f + (float)Main.rand.Next(5) * 0.1f;
				Main.dust[num29].noGravity = true;
				Main.dust[num29].position = base.Center + new Vector2(0f, -height / 2).RotatedBy(rotation) * 1.1f;
				int num30 = 6;
				if (type == 773)
				{
					num30 = 59;
				}
				if (type == 903)
				{
					num30 = Dust.dustWater();
				}
				if (type == 904)
				{
					num30 = 35;
				}
				if (type == 905)
				{
					num30 = 152;
				}
				if (type == 1077)
				{
					num30 = 135;
				}
				if (type == 910 || type == 911)
				{
					num30 = 0;
				}
				Dust dust8 = Dust.NewDustDirect(position, width, height, num30, 0f, 0f, 100);
				dust8.scale = 1f + (float)Main.rand.Next(5) * 0.1f;
				dust8.noGravity = true;
				dust8.position = base.Center + new Vector2(0f, -height / 2 - 6).RotatedBy(rotation) * 1.1f;
			}
			else if (type == 681)
			{
				Dust dust9 = Dust.NewDustDirect(position, width, height, 6, 0f, 0f, 100);
				dust9.scale = 1f + (float)Main.rand.Next(5) * 0.1f;
				dust9.noGravity = true;
				dust9.position = base.Center + new Vector2(6 * Math.Sign(velocity.X), -height / 2 - 6).RotatedBy(rotation) * 1.1f;
			}
		}
		ai[0] += 1f;
		if (type == 338 || type == 339 || type == 340 || type == 341 || type == 803 || type == 804 || type == 808 || type == 809 || type == 810 || type == 805 || type == 806 || type == 807 || type == 930)
		{
			if (velocity.X < 0f)
			{
				spriteDirection = -1;
				rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X) - 1.57f;
			}
			else
			{
				spriteDirection = 1;
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
			}
		}
		else if (type == 134 || type == 137 || type == 140 || type == 143 || type == 303 || type == 776 || type == 780 || type == 793 || type == 796 || type == 799 || type == 784 || type == 787 || type == 790)
		{
			if (velocity != Vector2.Zero)
			{
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
			}
		}
		else if (type == 135 || type == 138 || type == 141 || type == 144 || type == 778 || type == 782 || type == 795 || type == 798 || type == 801 || type == 786 || type == 789 || type == 792)
		{
			velocity.Y += 0.2f;
			velocity *= 0.97f;
			if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
			{
				velocity.X = 0f;
			}
			if ((double)velocity.Y > -0.1 && (double)velocity.Y < 0.1)
			{
				velocity.Y = 0f;
			}
		}
		else if (type == 133 || type == 136 || type == 139 || type == 142 || type == 777 || type == 781 || type == 794 || type == 797 || type == 800 || type == 785 || type == 788 || type == 791)
		{
			if (ai[0] > 15f)
			{
				if (velocity.Y == 0f)
				{
					velocity.X *= 0.95f;
				}
				velocity.Y += 0.2f;
			}
		}
		else if (((type == 30 || type == 397 || type == 517 || type == 681 || type == 588 || type == 779 || type == 783 || type == 862 || type == 863 || type == 1088) && ai[0] > 10f) || (type != 30 && type != 397 && type != 517 && type != 588 && type != 779 && type != 783 && type != 862 && type != 863 && type != 1088 && ai[0] > 5f))
		{
			ai[0] = 10f;
			if (velocity.Y == 0f && velocity.X != 0f)
			{
				velocity.X *= 0.97f;
				if (type == 29 || type == 470 || type == 637)
				{
					velocity.X *= 0.99f;
				}
				if (velocity.X > -0.01f && velocity.X < 0.01f)
				{
					velocity.X = 0f;
					netUpdate = true;
				}
			}
			velocity.Y += 0.2f;
			if (type == 911)
			{
				velocity.X = MathHelper.Clamp(velocity.X, -8f, 8f);
				velocity.Y = MathHelper.Clamp(velocity.Y, -8f, 8f);
			}
		}
		if (type == 519)
		{
			rotation += velocity.X * 0.06f;
		}
		else if (type != 134 && type != 137 && type != 140 && type != 143 && type != 303 && (type < 338 || type > 341) && type != 776 && type != 780 && type != 793 && type != 796 && type != 799 && type != 784 && type != 787 && type != 790 && type != 803 && type != 804 && type != 808 && type != 809 && type != 810 && type != 805 && type != 806 && type != 807 && type != 930)
		{
			rotation += velocity.X * 0.1f;
		}
	}

	private void AI_166_Dove()
	{
		bool num = type == 855;
		if (localAI[0] == 0f)
		{
			localAI[0] = 1f;
			frame = Main.rand.Next(4);
		}
		int num2 = 4;
		if (num)
		{
			num2 = 6;
		}
		if (++frameCounter > num2)
		{
			frameCounter = 0;
			if (++frame > 3)
			{
				frame = 0;
			}
		}
		spriteDirection = -1;
		if (velocity.X > 0f)
		{
			spriteDirection = 1;
		}
		if (num)
		{
			float num3 = 1f - (float)alpha / 255f;
			Vector3 rgb = new Vector3(1f, 0.6f, 0.1f) * num3;
			Lighting.AddLight(base.Center, rgb);
			rotation = velocity.X * 0.2f;
			if (velocity.Y < -1f)
			{
				velocity.Y *= 0.99f;
			}
			else
			{
				velocity.Y += (float)Math.Sin((float)(timeLeft % 200) / 200f * ((float)Math.PI * 2f)) * 0.25f;
				if (velocity.Y > 0.5f)
				{
					velocity.Y *= 0.8f;
				}
				velocity.Y = MathHelper.Clamp(velocity.Y, -1.5f, 1.5f);
			}
			float num4 = Main.WindForVisuals;
			if (num4 == 0f)
			{
				num4 = 0.1f;
			}
			velocity.X += 0.0525f * num4;
			velocity.X = MathHelper.Clamp(velocity.X, -2f, 2f);
		}
		else
		{
			rotation = velocity.X * 0.15f;
			velocity.Y -= 0.025f;
			if (velocity.Y < -3f)
			{
				velocity.Y = -3f;
			}
			velocity.X = MathHelper.Clamp(velocity.X, -5f, 5f);
		}
		if (timeLeft < 90)
		{
			alpha += 3;
		}
		if (alpha >= 255)
		{
			Kill();
		}
	}

	private void AI_161_RapierStabs()
	{
		Player player = Main.player[owner];
		rotation = velocity.ToRotation() + (float)Math.PI / 2f;
		ai[0] += 1f;
		float opacity = Utils.GetLerpValue(0f, 7f, ai[0], clamped: true) * Utils.GetLerpValue(16f, 12f, ai[0], clamped: true);
		Opacity = opacity;
		base.Center = player.RotatedRelativePoint(player.MountedCenter) + velocity * (ai[0] - 1f);
		spriteDirection = ((!(Vector2.Dot(velocity, Vector2.UnitX) < 0f)) ? 1 : (-1));
		if (ai[0] >= 16f)
		{
			Kill();
		}
		else
		{
			player.heldProj = whoAmI;
		}
	}

	private void AI_165_Whip()
	{
		if (type == 1035 && localAI[1] == 0f)
		{
			localAI[1] = 1 + Main.rand.Next(3);
		}
		Player player = Main.player[owner];
		rotation = velocity.ToRotation() + (float)Math.PI / 2f;
		ai[0] += 1f;
		float value = ai[1];
		GetWhipSettings(this, out var timeToFlyOut, out var _, out var _);
		base.Center = Main.GetPlayerArmPosition(this, player) + velocity * (ai[0] - 1f);
		spriteDirection = ((!(Vector2.Dot(velocity, Vector2.UnitX) < 0f)) ? 1 : (-1));
		if (ai[0] >= timeToFlyOut)
		{
			Kill();
			return;
		}
		bool flag = true;
		if (type == 1035 && ai[2] >= 10f)
		{
			flag = false;
		}
		if (flag)
		{
			player.heldProj = whoAmI;
			player.MatchItemTimeToItemAnimation();
		}
		else
		{
			drawLayer = 0;
		}
		if (type == 1035 && owner == Main.myPlayer && ai[2] < 10f)
		{
			int num = 3;
			float num2 = ai[0] / timeToFlyOut * (float)num;
			if (ai[2] < num2)
			{
				ai[2] += 1f;
				Vector2 destination = Main.ReverseGravitySupport(Main.MouseScreen) + Main.screenPosition;
				Vector2 vector = player.DirectionTo(destination).SafeNormalize(velocity) * velocity.Length();
				NewProjectile(GetProjectileSource_FromThis(), player.Center.X, player.Center.Y, vector.X, vector.Y, type, damage, knockBack, owner, 0f, Main.rand.NextFloatDirection(), 10f + ai[2]);
			}
		}
		if (ai[0] == (float)(int)(timeToFlyOut / 2f))
		{
			WhipPointsForCollision.Clear();
			FillWhipControlPoints(this, WhipPointsForCollision);
			Vector2 vector2 = WhipPointsForCollision[WhipPointsForCollision.Count - 1];
			if (type == 1029)
			{
				SoundEngine.PlaySound(SoundID.NPCDeath1, vector2, 0f, 0.6f);
			}
			else if (type == 1030)
			{
				SoundEngine.PlaySound(SoundID.NPCHit9, vector2);
			}
			else if (type == 1033)
			{
				SoundEngine.PlaySound(SoundID.Item193, vector2);
			}
			else
			{
				SoundEngine.PlaySound(SoundID.Item153, vector2);
			}
		}
		if (type == 1104 && ai[0] == (float)((int)(timeToFlyOut / 3f) * 2))
		{
			WhipPointsForCollision.Clear();
			FillWhipControlPoints(this, WhipPointsForCollision);
			Vector2 vector3 = WhipPointsForCollision[WhipPointsForCollision.Count - 1];
			if (type == 1104)
			{
				for (int i = 0; i < 15; i++)
				{
					Dust dust = Dust.NewDustPerfect(vector3, 6, Main.rand.NextVector2Circular(4f, 4f));
					dust.scale = 1f + Main.rand.NextFloat();
					if (Main.rand.Next(15) != 0)
					{
						dust.noLightEmittence = true;
					}
					else
					{
						dust.scale *= 0.4f;
					}
					if (Main.rand.Next(2) == 0)
					{
						dust.noGravity = true;
					}
					else
					{
						dust.velocity *= 0.3f;
						dust.scale -= 0.5f;
					}
					dust.velocity += velocity * 0.7f;
					dust.position -= dust.velocity * 2f;
				}
				for (int j = 0; j < 6; j++)
				{
					Dust dust2 = Dust.NewDustPerfect(vector3, 31, Main.rand.NextVector2Circular(4f, 4f));
					dust2.scale = 0.3f + 0.3f * Main.rand.NextFloat();
					if (Main.rand.Next(2) == 0)
					{
						dust2.noGravity = true;
					}
					else
					{
						dust2.velocity = dust2.velocity * 0.3f + velocity * 0.6f;
					}
				}
			}
		}
		switch (type)
		{
		case 848:
		{
			float t15 = ai[0] / timeToFlyOut;
			float num36 = Utils.GetLerpValue(0.1f, 0.7f, t15, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t15, clamped: true);
			if (num36 > 0.1f && Main.rand.NextFloat() < num36 / 2f)
			{
				WhipPointsForCollision.Clear();
				FillWhipControlPoints(this, WhipPointsForCollision);
				Rectangle r17 = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(30f, 30f));
				int num37 = Dust.NewDust(r17.TopLeft(), r17.Width, r17.Height, 172, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num37].noGravity = true;
				Main.dust[num37].velocity.X /= 2f;
				Main.dust[num37].velocity.Y /= 2f;
			}
			break;
		}
		case 847:
		{
			float t11 = ai[0] / timeToFlyOut;
			if (Utils.GetLerpValue(0.1f, 0.7f, t11, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t11, clamped: true) > 0.5f && Main.rand.Next(3) != 0)
			{
				WhipPointsForCollision.Clear();
				FillWhipControlPoints(this, WhipPointsForCollision);
				int num25 = Main.rand.Next(WhipPointsForCollision.Count - 10, WhipPointsForCollision.Count);
				Rectangle r13 = Utils.CenteredRectangle(WhipPointsForCollision[num25], new Vector2(30f, 30f));
				int num26 = 57;
				if (Main.rand.Next(3) == 0)
				{
					num26 = 43;
				}
				Dust dust18 = Dust.NewDustDirect(r13.TopLeft(), r13.Width, r13.Height, num26, 0f, 0f, 100, Color.White);
				dust18.position = WhipPointsForCollision[num25];
				dust18.fadeIn = 0.3f;
				Vector2 spinningpoint2 = WhipPointsForCollision[num25] - WhipPointsForCollision[num25 - 1];
				dust18.noGravity = true;
				dust18.velocity *= 0.5f;
				dust18.velocity += spinningpoint2.RotatedBy((float)player.direction * ((float)Math.PI / 2f));
				dust18.velocity *= 0.5f;
			}
			break;
		}
		case 849:
		{
			float num5 = ai[0] / timeToFlyOut;
			Utils.GetLerpValue(0.1f, 0.7f, num5, clamped: true);
			Utils.GetLerpValue(0.9f, 0.7f, num5, clamped: true);
			if (num5 > 0.4f && Main.rand.Next(9) != 0)
			{
				WhipPointsForCollision.Clear();
				FillWhipControlPoints(this, WhipPointsForCollision);
				Rectangle r2 = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(30f, 30f));
				Vector2 vector5 = WhipPointsForCollision[WhipPointsForCollision.Count - 2].DirectionTo(WhipPointsForCollision[WhipPointsForCollision.Count - 1]).SafeNormalize(Vector2.Zero);
				Dust dust4 = Dust.NewDustDirect(r2.TopLeft(), r2.Width, r2.Height, 191, 0f, 0f, 0, default(Color), 1.3f);
				dust4.noGravity = true;
				dust4.velocity += vector5 * 2f;
				if (Main.rand.Next(2) == 0)
				{
					ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.BlackLightningSmall, new ParticleOrchestraSettings
					{
						MovementVector = vector5,
						PositionInWorld = r2.Center.ToVector2()
					}, owner);
				}
				Lighting.AddLight(r2.Center.ToVector2(), new Vector3(0.2f, 0f, 0.4f));
			}
			break;
		}
		case 915:
		{
			float t6 = ai[0] / timeToFlyOut;
			if (Utils.GetLerpValue(0.1f, 0.7f, t6, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t6, clamped: true) > 0.1f)
			{
				WhipPointsForCollision.Clear();
				FillWhipControlPoints(this, WhipPointsForCollision);
				Rectangle r7 = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(30f, 30f));
				Vector2 vector9 = WhipPointsForCollision[WhipPointsForCollision.Count - 2].DirectionTo(WhipPointsForCollision[WhipPointsForCollision.Count - 1]).SafeNormalize(Vector2.Zero);
				Dust dust9 = Dust.NewDustDirect(r7.TopLeft(), r7.Width, r7.Height, 267, 0f, 0f, 0, Main.hslToRgb(player.miscCounterNormalized * 9f % 1f, 1f, 0.5f), 1.3f);
				dust9.velocity *= Main.rand.NextFloat() * 0.8f;
				dust9.noGravity = true;
				dust9.scale = 0.9f + Main.rand.NextFloat() * 0.9f;
				dust9.fadeIn = Main.rand.NextFloat() * 0.9f;
				dust9.velocity += vector9 * 2f;
				if (dust9.dustIndex != 6000)
				{
					Dust dust10 = Dust.CloneDust(dust9);
					dust10.scale /= 2f;
					dust10.fadeIn *= 0.85f;
					dust10.color = new Color(255, 255, 255, 255);
				}
			}
			break;
		}
		case 914:
		{
			float t4 = ai[0] / timeToFlyOut;
			float num9 = Utils.GetLerpValue(0.1f, 0.7f, t4, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t4, clamped: true);
			if (num9 > 0.1f && Main.rand.NextFloat() < num9 / 2f)
			{
				WhipPointsForCollision.Clear();
				FillWhipControlPoints(this, WhipPointsForCollision);
				Rectangle r5 = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(30f, 30f));
				Vector2 vector7 = WhipPointsForCollision[WhipPointsForCollision.Count - 2].DirectionTo(WhipPointsForCollision[WhipPointsForCollision.Count - 1]).SafeNormalize(Vector2.Zero);
				Dust dust7 = Dust.NewDustDirect(r5.TopLeft(), r5.Width, r5.Height, 39, 0f, 0f, 0, default(Color), 1.2f);
				dust7.noGravity = Main.rand.Next(3) == 0;
				dust7.velocity += vector7 * 2f;
			}
			break;
		}
		case 952:
		{
			float t10 = ai[0] / timeToFlyOut;
			float num24 = Utils.GetLerpValue(0.1f, 0.7f, t10, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t10, clamped: true);
			if (num24 > 0.15f && Main.rand.NextFloat() < num24)
			{
				WhipPointsForCollision.Clear();
				FillWhipControlPoints(this, WhipPointsForCollision);
				Rectangle r12 = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(30f, 30f));
				Vector2 vector15 = WhipPointsForCollision[WhipPointsForCollision.Count - 2].DirectionTo(WhipPointsForCollision[WhipPointsForCollision.Count - 1]).SafeNormalize(Vector2.Zero);
				Dust dust17 = Dust.NewDustDirect(r12.TopLeft(), r12.Width, r12.Height, 26, 0f, 0f, 0, default(Color), 0.7f);
				dust17.noGravity = Main.rand.Next(3) == 0;
				if (dust17.noGravity)
				{
					dust17.scale += 0.4f;
				}
				dust17.velocity += vector15 * 2f;
			}
			break;
		}
		case 1034:
		{
			float t3 = ai[0] / timeToFlyOut;
			if (Utils.GetLerpValue(0.1f, 0.7f, t3, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t3, clamped: true) > 0.5f && Main.rand.Next(3) != 0)
			{
				WhipPointsForCollision.Clear();
				FillWhipControlPoints(this, WhipPointsForCollision);
				int num7 = Main.rand.Next(WhipPointsForCollision.Count - 10, WhipPointsForCollision.Count);
				Rectangle r4 = Utils.CenteredRectangle(WhipPointsForCollision[num7], new Vector2(30f, 30f));
				int num8 = 135;
				Dust dust6 = Dust.NewDustDirect(r4.TopLeft(), r4.Width, r4.Height, num8, 0f, 0f, 100, Color.White, 1.5f);
				dust6.position = WhipPointsForCollision[num7];
				dust6.fadeIn = 0.3f;
				Vector2 spinningpoint = WhipPointsForCollision[num7] - WhipPointsForCollision[num7 - 1];
				dust6.noGravity = true;
				dust6.velocity *= 0.5f;
				dust6.velocity += spinningpoint.RotatedBy((float)player.direction * ((float)Math.PI / 2f) * (float)Math.Sign(value));
				dust6.velocity *= 0.5f;
			}
			break;
		}
		case 1035:
		{
			float t7 = ai[0] / timeToFlyOut;
			if (Utils.GetLerpValue(0.1f, 0.7f, t7, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t7, clamped: true) > 0.5f && Main.rand.Next(3) != 0)
			{
				WhipPointsForCollision.Clear();
				FillWhipControlPoints(this, WhipPointsForCollision);
				int num18 = Main.rand.Next(WhipPointsForCollision.Count - 8, WhipPointsForCollision.Count);
				Rectangle r9 = Utils.CenteredRectangle(WhipPointsForCollision[num18], new Vector2(20f, 20f));
				int num19 = 306;
				Dust dust12 = Dust.NewDustDirect(r9.TopLeft(), r9.Width, r9.Height, num19, 0f, 0f, 100, new Color(147, 255, 220), 1.6f);
				dust12.position = WhipPointsForCollision[num18];
				Vector2 vector12 = WhipPointsForCollision[num18] - WhipPointsForCollision[num18 - 1];
				dust12.noGravity = Main.rand.Next(2) == 0;
				if (!dust12.noGravity)
				{
					dust12.scale *= 0.5f;
				}
				dust12.velocity = velocity.SafeNormalize(velocity) * vector12.Length();
				dust12.velocity *= 0.5f;
				dust12.velocity = dust12.velocity.RotatedBy(Main.rand.NextFloatDirection() * ((float)Math.PI * 2f) * 0.1f);
				Dust dust13 = Dust.NewDustPerfect(WhipPointsForCollision[num18], 229, dust12.velocity);
				dust13.noGravity = true;
				dust13.scale = 0.3f + 1.1f * Main.rand.NextFloat();
				dust13.velocity *= dust13.scale;
				dust13.velocity *= Main.rand.NextFloat();
			}
			break;
		}
		case 1028:
		{
			float t12 = ai[0] / timeToFlyOut;
			float num27 = Utils.GetLerpValue(0.1f, 0.7f, t12, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t12, clamped: true);
			if (num27 > 0.15f && Main.rand.NextFloat() < num27 && Main.rand.Next(2) == 0)
			{
				WhipPointsForCollision.Clear();
				FillWhipControlPoints(this, WhipPointsForCollision);
				Rectangle r14 = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(30f, 30f));
				Vector2 vector16 = WhipPointsForCollision[WhipPointsForCollision.Count - 2].DirectionTo(WhipPointsForCollision[WhipPointsForCollision.Count - 1]).SafeNormalize(Vector2.Zero);
				Dust dust19 = Dust.NewDustDirect(r14.TopLeft(), r14.Width, r14.Height, 30, 0f, 0f, 0, default(Color), 0.7f);
				dust19.noGravity = Main.rand.Next(3) == 0;
				if (dust19.noGravity)
				{
					dust19.scale += 0.3f;
				}
				dust19.velocity += vector16 * 2f;
			}
			break;
		}
		case 912:
		{
			float t14 = ai[0] / timeToFlyOut;
			float num32 = Utils.GetLerpValue(0.1f, 0.7f, t14, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t14, clamped: true);
			if (!(num32 > 0.1f) || !(Main.rand.NextFloat() < num32 / 2f))
			{
				break;
			}
			WhipPointsForCollision.Clear();
			FillWhipControlPoints(this, WhipPointsForCollision);
			Rectangle r16 = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(30f, 30f));
			Vector2 vector18 = WhipPointsForCollision[WhipPointsForCollision.Count - 2].DirectionTo(WhipPointsForCollision[WhipPointsForCollision.Count - 1]).SafeNormalize(Vector2.Zero);
			for (int num33 = 0; num33 < 3; num33++)
			{
				Dust dust21 = Dust.NewDustDirect(r16.TopLeft(), r16.Width, r16.Height, 16, 0f, 0f, 0, default(Color), 1.2f);
				dust21.noGravity = true;
				dust21.velocity += vector18 * 2f;
			}
			for (int num34 = 0; num34 < 1; num34++)
			{
				Dust.NewDustDirect(r16.TopLeft(), r16.Width, r16.Height, 13, 0f, 0f, 0, default(Color), 0.8f).velocity += vector18 * 2f;
			}
			for (int num35 = 0; num35 < 3; num35++)
			{
				if (Main.rand.Next(2) != 0)
				{
					Dust dust22 = Dust.NewDustDirect(r16.TopLeft(), r16.Width, r16.Height, 261, 0f, 0f, 0, Color.Transparent, 0.8f);
					dust22.velocity += vector18 * 2f;
					dust22.velocity *= 0.3f;
					dust22.noGravity = true;
				}
			}
			Lighting.AddLight(r16.Center.ToVector2(), new Vector3(0.1f, 0.1f, 0.2f));
			break;
		}
		case 913:
		{
			float t8 = ai[0] / timeToFlyOut;
			float num20 = Utils.GetLerpValue(0.1f, 0.7f, t8, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t8, clamped: true);
			if (!(num20 > 0.1f) || !(Main.rand.NextFloat() < num20))
			{
				break;
			}
			WhipPointsForCollision.Clear();
			FillWhipControlPoints(this, WhipPointsForCollision);
			Rectangle r10 = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(20f, 20f));
			Vector2 vector13 = WhipPointsForCollision[WhipPointsForCollision.Count - 2].DirectionTo(WhipPointsForCollision[WhipPointsForCollision.Count - 1]).SafeNormalize(Vector2.Zero);
			for (int num21 = 0; num21 < 3; num21++)
			{
				if (Main.rand.Next(3) != 0)
				{
					continue;
				}
				if (Main.rand.Next(7) == 0)
				{
					Dust dust14 = Dust.NewDustDirect(r10.TopLeft(), r10.Width, r10.Height, 31);
					dust14.velocity.X /= 2f;
					dust14.velocity.Y /= 2f;
					dust14.velocity += vector13 * 2f;
					dust14.fadeIn = 1f + Main.rand.NextFloat() * 0.6f;
					dust14.noGravity = true;
					continue;
				}
				Dust dust15 = Dust.NewDustDirect(r10.TopLeft(), r10.Width, r10.Height, 6, 0f, 0f, 0, default(Color), 1.2f);
				dust15.velocity += vector13 * 2f;
				if (Main.rand.Next(3) != 0)
				{
					dust15.fadeIn = 0.7f + Main.rand.NextFloat() * 0.9f;
					dust15.scale = 0.6f;
					dust15.noGravity = true;
				}
			}
			break;
		}
		case 1033:
		{
			float num13 = ai[0] / timeToFlyOut;
			Utils.GetLerpValue(0.1f, 0.7f, num13, clamped: true);
			Utils.GetLerpValue(0.9f, 0.7f, num13, clamped: true);
			WhipPointsForCollision.Clear();
			FillWhipControlPoints(this, WhipPointsForCollision);
			for (int n = 10; n < WhipPointsForCollision.Count - 1; n++)
			{
				Vector2 vector10 = WhipPointsForCollision[n].DirectionTo(WhipPointsForCollision[n + 1]).SafeNormalize(Vector2.Zero);
				Rectangle r8 = Utils.CenteredRectangle(WhipPointsForCollision[n + 1], new Vector2(30f, 30f));
				if (Main.rand.Next(5) != 0 || Main.rand.NextFloat() > num13)
				{
					continue;
				}
				if (Main.rand.Next(3) == 0)
				{
					int num14 = 1;
					for (int num15 = 0; num15 < num14; num15++)
					{
						Vector2 vector11 = ((float)(Main.rand.NextDouble() * 3.1415927410125732) - (float)Math.PI / 2f).ToRotationVector2() * Main.rand.Next(3, 8);
						int num16 = Dust.NewDust(r8.TopLeft(), r8.Width, r8.Height, 217, vector11.X * 2f, vector11.Y * 2f, 100, default(Color), 1.4f);
						Main.dust[num16].noGravity = true;
						Main.dust[num16].noLight = true;
						Main.dust[num16].velocity /= 4f;
						Main.dust[num16].velocity += vector10 * 3f;
					}
				}
				else
				{
					if (Main.rand.Next(4) != 0)
					{
						continue;
					}
					for (int num17 = 0; num17 < 1; num17++)
					{
						Dust dust11 = Dust.NewDustDirect(r8.TopLeft(), r8.Width, r8.Height, 226, 0f, 0f, 0, default(Color), 0.7f);
						dust11.noGravity = Main.rand.Next(3) == 0;
						if (dust11.noGravity)
						{
							dust11.scale += 0.3f;
						}
						dust11.velocity += vector10.RotatedByRandom(0.19634954631328583) * 2f;
					}
				}
			}
			break;
		}
		case 1029:
		{
			float t2 = ai[0] / timeToFlyOut;
			if (!(Utils.GetLerpValue(0.1f, 0.7f, t2, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t2, clamped: true) > 0.6f) || Main.rand.Next(2) != 0)
			{
				break;
			}
			WhipPointsForCollision.Clear();
			FillWhipControlPoints(this, WhipPointsForCollision);
			Rectangle r3 = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(30f, 30f));
			for (int k = 0; k < 2; k++)
			{
				short num6 = (short)((Main.rand.Next(2) == 0) ? 18 : 184);
				Vector2 vector6 = WhipPointsForCollision[WhipPointsForCollision.Count - 2].DirectionTo(WhipPointsForCollision[WhipPointsForCollision.Count - 1]).SafeNormalize(Vector2.Zero);
				Dust dust5 = Dust.NewDustDirect(r3.TopLeft(), r3.Width, r3.Height, num6, 0f, 0f, 0, default(Color), 0.7f);
				dust5.noGravity = num6 == 184 || Main.rand.Next(3) == 0;
				if (dust5.noGravity)
				{
					dust5.scale += 0.3f;
				}
				dust5.velocity += vector6 * 2f;
			}
			break;
		}
		case 1030:
		{
			float t13 = ai[0] / timeToFlyOut;
			if (!(Utils.GetLerpValue(0.1f, 0.7f, t13, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t13, clamped: true) > 0.6f) || Main.rand.Next(4) == 0)
			{
				break;
			}
			WhipPointsForCollision.Clear();
			FillWhipControlPoints(this, WhipPointsForCollision);
			for (int num28 = WhipPointsForCollision.Count / 2; num28 < WhipPointsForCollision.Count; num28++)
			{
				if (Main.rand.Next(6) != 0 && num28 != WhipPointsForCollision.Count - 1)
				{
					continue;
				}
				Rectangle r15 = Utils.CenteredRectangle(WhipPointsForCollision[num28], new Vector2(30f, 30f));
				int num29 = ((num28 != WhipPointsForCollision.Count - 1) ? 1 : 4);
				for (int num30 = 0; num30 < num29; num30++)
				{
					short num31 = (short)((Main.rand.Next(2) == 0) ? 115 : 5);
					Vector2 vector17 = WhipPointsForCollision[num28 - 1].DirectionTo(WhipPointsForCollision[num28]).SafeNormalize(Vector2.Zero);
					Dust dust20 = Dust.NewDustDirect(r15.TopLeft(), r15.Width, r15.Height, num31, 0f, 0f, 0, default(Color), 0.3f + 0.3f * Main.rand.NextFloat());
					dust20.velocity += vector17 * 3f * Main.rand.NextFloat();
					dust20.velocity *= 0.5f;
					dust20.velocity.X += (float)player.direction * 2f;
					dust20.velocity += player.velocity * Main.rand.NextFloat();
					dust20.fadeIn = dust20.scale * 1.1f;
					if (num30 > 0)
					{
						dust20.alpha = Main.rand.Next(0, 200);
					}
				}
			}
			break;
		}
		case 1031:
		{
			float t9 = ai[0] / timeToFlyOut;
			float num22 = Utils.GetLerpValue(0.1f, 0.7f, t9, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t9, clamped: true);
			if (!(num22 > 0.1f) || !(Main.rand.NextFloat() < num22))
			{
				break;
			}
			WhipPointsForCollision.Clear();
			FillWhipControlPoints(this, WhipPointsForCollision);
			Rectangle r11 = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(20f, 20f));
			Vector2 vector14 = WhipPointsForCollision[WhipPointsForCollision.Count - 2].DirectionTo(WhipPointsForCollision[WhipPointsForCollision.Count - 1]).SafeNormalize(Vector2.Zero);
			for (int num23 = 0; num23 < 4; num23++)
			{
				if (Main.rand.Next(3) == 0)
				{
					Dust dust16 = Dust.NewDustDirect(r11.TopLeft(), r11.Width, r11.Height, 6);
					dust16.velocity += vector14 * 1.5f;
					if (Main.rand.Next(3) != 0)
					{
						dust16.velocity += vector14;
						dust16.fadeIn = 0.7f + Main.rand.NextFloat() * 0.9f;
						dust16.scale = 0.7f;
						dust16.noGravity = true;
					}
				}
			}
			break;
		}
		case 1032:
		{
			float t5 = ai[0] / timeToFlyOut;
			float num10 = Utils.GetLerpValue(0.1f, 0.7f, t5, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t5, clamped: true);
			if (!(num10 > 0.6f) || !(Main.rand.NextFloat() < num10) || Main.rand.Next(3) == 0)
			{
				break;
			}
			WhipPointsForCollision.Clear();
			FillWhipControlPoints(this, WhipPointsForCollision);
			for (int l = 0; l < WhipPointsForCollision.Count - 1; l += 2)
			{
				float num11 = (float)l / (float)WhipPointsForCollision.Count;
				if (Main.rand.NextFloat() >= num11 * num11)
				{
					continue;
				}
				Vector2 vector8 = WhipPointsForCollision[l].DirectionTo(WhipPointsForCollision[l + 1]).SafeNormalize(Vector2.Zero);
				Rectangle r6 = Utils.CenteredRectangle(WhipPointsForCollision[l + 1], new Vector2(30f, 30f));
				Dust dust8;
				for (int m = 0; m < 2; m++)
				{
					short num12 = (short)((Main.rand.Next(2) == 0) ? 167 : 166);
					dust8 = Dust.NewDustDirect(r6.TopLeft(), r6.Width, r6.Height, num12);
					dust8.noGravity = Main.rand.Next(3) != 0;
					if (dust8.noGravity)
					{
						dust8.scale += 0.2f;
					}
					dust8.velocity += vector8 * 2f;
				}
				dust8 = Dust.NewDustDirect(r6.TopLeft(), r6.Width, r6.Height, 166);
				dust8.noGravity = Main.rand.Next(3) != 0;
				if (dust8.noGravity)
				{
					dust8.scale += 0.2f;
				}
				dust8.velocity += vector8 * 2f;
				dust8 = Dust.NewDustDirect(r6.TopLeft(), r6.Width, r6.Height, 167);
				dust8.noGravity = Main.rand.Next(3) != 0;
				if (dust8.noGravity)
				{
					dust8.scale += 0.2f;
				}
				dust8.velocity += vector8 * 2f;
			}
			break;
		}
		case 1104:
		{
			float t = ai[0] / timeToFlyOut;
			float num3 = Utils.GetLerpValue(0.1f, 0.7f, t, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t, clamped: true);
			if (!(num3 > 0.15f) || !(Main.rand.NextFloat() < num3) || Main.rand.Next(2) != 0)
			{
				break;
			}
			WhipPointsForCollision.Clear();
			FillWhipControlPoints(this, WhipPointsForCollision);
			for (int num4 = WhipPointsForCollision.Count - 1; num4 >= 1; num4 -= 3)
			{
				if (num4 == WhipPointsForCollision.Count - 1 || Main.rand.Next(20) == 0)
				{
					Rectangle r = Utils.CenteredRectangle(WhipPointsForCollision[num4], new Vector2(30f, 30f));
					Vector2 vector4 = WhipPointsForCollision[num4 - 1].DirectionTo(WhipPointsForCollision[num4]).SafeNormalize(Vector2.Zero);
					Dust dust3 = Dust.NewDustDirect(r.TopLeft(), r.Width, r.Height, 4, 0f, 0f, 84, new Color(78, 136, 255, 127));
					dust3.scale = 1f + Main.rand.NextFloat() * 0.3f;
					dust3.velocity += vector4 * Main.rand.NextFloat() * 5f;
					if (Main.rand.Next(4) == 0)
					{
						dust3.noGravity = true;
					}
					else
					{
						dust3.velocity *= 0.3f;
						dust3.scale -= 0.4f;
						dust3.velocity += velocity * 0.5f;
					}
				}
			}
			break;
		}
		}
	}

	public static float GetWhipAnimationPercent(Projectile proj)
	{
		GetWhipSettings(proj, out var timeToFlyOut, out var _, out var _);
		return proj.ai[0] / timeToFlyOut;
	}

	public static void FillWhipControlPoints(Projectile proj, List<Vector2> controlPoints, Player owner = null, bool getActualCollisionPoints = false)
	{
		if (owner == null)
		{
			owner = Main.player[proj.owner];
		}
		GetWhipSettings(proj, out var timeToFlyOut, out var segments, out var rangeMultiplier);
		float num = proj.ai[0] / timeToFlyOut;
		if (proj.type == 1028)
		{
			num = Utils.Remap(num, 0f, 1f, 0.3f, 0.95f);
		}
		float num2 = 0.5f;
		float num3 = 1f + num2;
		float num4 = (float)Math.PI * 10f * (1f - num * num3) * (float)(-proj.spriteDirection) / (float)segments;
		float num5 = num * num3;
		float num6 = 0f;
		if (num5 > 1f)
		{
			num6 = (num5 - 1f) / num2;
			num5 = MathHelper.Lerp(1f, 0f, num6);
		}
		float num7 = proj.ai[0] - 1f;
		Item heldItem = owner.HeldItem;
		num7 = (float)(ContentSamples.ItemsByType[heldItem.type].useAnimation * 2) * num * owner.whipRangeMultiplier;
		float num8 = proj.velocity.Length() * num7 * num5 * rangeMultiplier / (float)segments;
		float num9 = 1f;
		Vector2 playerArmPosition = Main.GetPlayerArmPosition(proj, owner);
		Vector2 vector = playerArmPosition;
		float num10 = 0f - (float)Math.PI / 2f;
		Vector2 vector2 = vector;
		float num11 = 0f + (float)Math.PI / 2f + (float)Math.PI / 2f * (float)proj.spriteDirection;
		Vector2 vector3 = vector;
		float num12 = 0f + (float)Math.PI / 2f;
		controlPoints.Add(playerArmPosition);
		float num13 = proj.ai[1];
		if (getActualCollisionPoints)
		{
			num13 = 1f;
		}
		for (int i = 0; i < segments; i++)
		{
			float num14 = (float)i / (float)segments;
			float num15 = num4 * num14 * num9 * num13;
			Vector2 vector4 = vector + num10.ToRotationVector2() * num8;
			Vector2 vector5 = vector3 + num12.ToRotationVector2() * (num8 * 2f);
			Vector2 vector6 = vector2 + num11.ToRotationVector2() * (num8 * 2f);
			float num16 = 1f - num5;
			float num17 = 1f - num16 * num16;
			Vector2 value = Vector2.Lerp(vector5, vector4, num17 * 0.9f + 0.1f);
			Vector2 vector7 = Vector2.Lerp(vector6, value, num17 * 0.7f + 0.3f);
			Vector2 spinningpoint = playerArmPosition + (vector7 - playerArmPosition) * new Vector2(1f, num3);
			float num18 = num6;
			num18 *= num18;
			Vector2 item = spinningpoint.RotatedBy(proj.rotation + 4.712389f * num18 * (float)proj.spriteDirection, playerArmPosition);
			controlPoints.Add(item);
			num10 += num15;
			num12 += num15;
			num11 += num15;
			vector = vector4;
			vector3 = vector5;
			vector2 = vector6;
		}
	}

	public static void GetWhipSettings(Projectile proj, out float timeToFlyOut, out int segments, out float rangeMultiplier)
	{
		timeToFlyOut = Main.player[proj.owner].itemAnimationMax * proj.MaxUpdates;
		if (proj.isAPreviewDisplayDoll)
		{
			timeToFlyOut = 60f;
		}
		segments = 20;
		rangeMultiplier = 1f;
		switch (proj.type)
		{
		case 1104:
			segments = 36;
			rangeMultiplier *= 0.75f;
			break;
		case 1028:
			segments = 12;
			rangeMultiplier *= 0.75f;
			break;
		case 841:
			rangeMultiplier *= 0.75f;
			break;
		case 1029:
			rangeMultiplier *= 0.95f;
			break;
		case 1030:
			rangeMultiplier *= 0.85f;
			break;
		case 914:
			rangeMultiplier *= 1f;
			break;
		case 1031:
			rangeMultiplier *= 1.1f;
			break;
		case 952:
			rangeMultiplier *= 0.95f;
			break;
		case 913:
			rangeMultiplier *= 1.4f;
			break;
		case 912:
			rangeMultiplier *= 1.5f;
			break;
		case 847:
			segments = 20;
			rangeMultiplier *= 1.75f;
			break;
		case 1032:
			rangeMultiplier *= 1.8f;
			break;
		case 848:
			segments = 40;
			rangeMultiplier = 1.6f;
			break;
		case 849:
			segments = 30;
			rangeMultiplier = 2.15f;
			break;
		case 1033:
			segments = 45;
			rangeMultiplier = 2f;
			break;
		case 915:
			segments = 40;
			rangeMultiplier = 2.2f;
			break;
		case 1034:
			rangeMultiplier *= 2.2f;
			break;
		case 1035:
			segments = 30;
			rangeMultiplier *= 2.2f;
			if (proj.ai[2] >= 10f)
			{
				timeToFlyOut = 30 * proj.MaxUpdates;
			}
			break;
		}
	}

	private void AI_160_Kites()
	{
		Player player = Main.player[owner];
		player.heldProj = whoAmI;
		timeLeft = 60;
		bool flag = false;
		if (player.CCed || player.noItems)
		{
			flag = true;
		}
		else if (player.inventory[player.selectedItem].shoot != type)
		{
			flag = true;
		}
		else if (player.pulley)
		{
			flag = true;
		}
		else if (player.dead)
		{
			flag = true;
		}
		if (!flag)
		{
			flag = (player.Center - base.Center).Length() > 2000f;
		}
		if (flag)
		{
			Kill();
			return;
		}
		KiteFlyingInfo info = new KiteFlyingInfo
		{
			BobOffset = 0f,
			WindInWorld = Main.WindForVisuals,
			CloudAlpha = Main.cloudAlpha,
			GlobalTime = Main.GlobalTimeWrappedHourly,
			CanReelThroughBlocks = true
		};
		KiteLogic(Main.GetPlayerArmPosition(this, player), info);
		if (Main.myPlayer == owner && localAI[1] < 1f)
		{
			ApplyBuffTo(player, 383, 12);
		}
	}

	public void KiteLogic(Vector2 anchorPoint, KiteFlyingInfo info)
	{
		Player player = Main.player[owner];
		bool flag = owner == 255;
		float num = 4f;
		float num2 = 500f;
		float num3 = num2 / 2f;
		if (owner == Main.myPlayer && extraUpdates == 0)
		{
			float num4 = ai[0];
			if (ai[0] == 0f)
			{
				ai[0] = num3;
			}
			float num5 = ai[0];
			if (player.channel)
			{
				num5 -= 5f;
			}
			if (player.controlUseItem && player.itemAnimation == 0)
			{
				num5 += 5f;
			}
			ai[0] = MathHelper.Clamp(num5, num, num2);
			if (num4 != ai[0])
			{
				netUpdate = true;
			}
		}
		if (localAI[2] == 0f)
		{
			localAI[2] = ai[0];
		}
		else if (localAI[2] != ai[0])
		{
			localAI[2] = ai[0];
			if (soundDelay == 0)
			{
				soundDelay = 30;
				kiteSoundPitch = (localAI[2] - num) / (num2 - num) * -0.12f + 0.06f;
				if (!flag)
				{
					SoundEngine.PlaySound(SoundID.Item192, player.position);
				}
			}
		}
		if (soundDelay > 0)
		{
			soundDelay--;
		}
		if (numUpdates == 1)
		{
			extraUpdates = 0;
		}
		float cloudAlpha = info.CloudAlpha;
		float num6 = 0f;
		if (WorldGen.InAPlaceWithWind(position, width, height))
		{
			num6 = info.WindInWorld;
		}
		_ = localAI[0];
		bool value = Math.Abs(num6) >= 0.2f;
		localAI[0] = Utils.Clamp(localAI[0] - (float)value.ToDirectionInt(), 0f, 300f);
		float num7 = Utils.GetLerpValue(0.2f, 0.5f, Math.Abs(num6), clamped: true) * 0.5f;
		Vector2 center = base.Center;
		Vector2 vector = new Vector2(num6, (float)Math.Sin(info.GlobalTime + info.BobOffset) + cloudAlpha * 5f) * 25f;
		if (cloudAlpha > 0f && Math.Abs(num6) >= cloudAlpha / 2f && vector.Y > 0f)
		{
			vector.Y *= 1f - Math.Abs(num6) * 2f;
		}
		center += vector;
		Vector2 v = center - base.Center;
		v = v.SafeNormalize(Vector2.Zero) * (3f + cloudAlpha * 7f);
		if (num7 == 0f)
		{
			v = Vector2.Zero;
		}
		if (extraUpdates > 0)
		{
			position -= velocity;
			return;
		}
		float num8 = Distance(center);
		float lerpValue = Utils.GetLerpValue(5f, 10f, num8, clamped: true);
		float y = velocity.Y;
		if (num8 > 10f)
		{
			velocity = Vector2.Lerp(velocity, v, 0.075f * lerpValue);
		}
		velocity.Y = y;
		velocity.Y -= num7;
		velocity.Y += 0.02f + num7 * 0.25f;
		velocity.Y = MathHelper.Clamp(velocity.Y, -2f, 2f);
		if (base.Center.Y + velocity.Y < center.Y)
		{
			velocity.Y = MathHelper.Lerp(velocity.Y, velocity.Y + num7 + 0.01f, 0.75f);
		}
		if (Math.Abs(velocity.X) > 0.02f)
		{
			velocity.X *= 0.98f;
		}
		float num9 = Distance(anchorPoint);
		float num10 = ai[0];
		bool flag2 = num9 > num10;
		bool flag3 = num9 > num10 - 2f;
		if (flag2)
		{
			Vector2 vector2 = DirectionTo(anchorPoint);
			float num11 = num9 - num10;
			Vector2 vector3 = vector2 * num11;
			if (info.CanReelThroughBlocks)
			{
				base.Center += vector3;
			}
			else
			{
				velocity += vector3;
			}
			bool flag4 = Vector2.Dot(vector2, Vector2.UnitY) < 0.8f || num7 > 0f;
			if (num7 == 0f && Math.Abs(velocity.X) < 0.05f)
			{
				flag4 = false;
			}
			velocity.Y += vector2.Y * 0.05f;
			if (flag4)
			{
				velocity.Y -= 0.15f;
			}
			velocity.X += vector2.X * 0.2f;
			if (num10 == num && owner == Main.myPlayer)
			{
				player.afkCounter = 0;
				player.afkCounterForKiting = 0;
				Kill();
				return;
			}
		}
		timeLeft = 2;
		Vector2 vector4 = base.Center - anchorPoint;
		int dir = ((vector4.X > 0f) ? 1 : (-1));
		if (Math.Abs(vector4.X) > Math.Abs(vector4.Y) / 2f)
		{
			player.ChangeDir(dir);
		}
		Vector2 vector5 = DirectionTo(anchorPoint).SafeNormalize(Vector2.Zero);
		bool flag5 = num7 == 0f && velocity.Y >= 0.02f && !flag3;
		if (flag5)
		{
			rotation *= 0.95f;
		}
		else
		{
			float num12 = (-vector5).ToRotation() + (float)Math.PI / 4f;
			if (spriteDirection == -1)
			{
				num12 -= (float)Math.PI / 2f * (float)player.direction;
			}
			rotation = num12 + velocity.X * 0.05f;
		}
		localAI[1] = Utils.Clamp(localAI[1] + (float)flag5.ToDirectionInt() * 0.005f, 0f, 1f);
		float num13 = velocity.Length();
		switch (type)
		{
		case 771:
		case 822:
		case 823:
		case 827:
		case 830:
		case 838:
		case 843:
		case 844:
		case 845:
		case 846:
		case 850:
		case 852:
			frame = 0;
			break;
		case 828:
		case 829:
			if (num13 < 6f)
			{
				frame = 1;
			}
			else
			{
				frame = 0;
			}
			break;
		case 826:
			frame = (int)ai[1];
			break;
		case 824:
		case 839:
		case 840:
		case 853:
			if (num7 < 0.15f)
			{
				frame = 0;
				break;
			}
			frameCounter++;
			if ((float)frameCounter > (1f - num7) * 10f)
			{
				frameCounter = 0;
				frame = Main.rand.Next(4);
			}
			break;
		default:
			if (num13 < 3f)
			{
				frame = 0;
			}
			else if (num13 < 5f)
			{
				frame = 1;
			}
			else if (num13 < 7f)
			{
				frame = 2;
			}
			else
			{
				frame = 3;
			}
			break;
		}
		spriteDirection = player.direction;
	}

	private void AI_159_PaperAirplanes()
	{
		if (ai[1] == 0f)
		{
			direction = ((velocity.X > 0f) ? 1 : (-1));
			rotation = velocity.ToRotation();
			ai[1] = 1f;
			ai[0] = -Main.rand.Next(30, 80);
			netUpdate = true;
		}
		if (wet && owner == Main.myPlayer)
		{
			Kill();
		}
		ai[0] += 1f;
		Vector2 vector = rotation.ToRotationVector2() * 8f;
		float y = (float)Math.Sin((float)Math.PI * 2f * (float)(Main.timeForVisualEffects % 90.0 / 90.0)) * (float)direction * Main.WindForVisuals;
		Vector2 v = vector + new Vector2(Main.WindForVisuals, y);
		_ = Vector2.UnitX * direction;
		bool flag = direction == Math.Sign(Main.WindForVisuals) && velocity.Length() > 3f;
		bool num = ai[0] >= 20f && ai[0] <= 69f;
		if (ai[0] == 70f)
		{
			ai[0] = -Main.rand.Next(120, 600);
		}
		bool num2 = num && flag;
		if (num2)
		{
			float lerpValue = Utils.GetLerpValue(0f, 30f, ai[0], clamped: true);
			v = vector.RotatedBy((float)(-direction) * ((float)Math.PI * 2f) * 0.02f * lerpValue);
		}
		velocity = v.SafeNormalize(Vector2.UnitY) * velocity.Length();
		if (!num2)
		{
			float num3 = MathHelper.Lerp(0.15f, 0.05f, Math.Abs(Main.WindForVisuals));
			if (timeLeft % 40 < 20)
			{
				velocity.Y -= num3;
			}
			else
			{
				velocity.Y += num3;
			}
			if (velocity.Y < -2f)
			{
				velocity.Y = -2f;
			}
			if (velocity.Y > 2f)
			{
				velocity.Y = 2f;
			}
			velocity.X = MathHelper.Clamp(velocity.X + Main.WindForVisuals * 0.006f, -6f, 6f);
			if (velocity.X * oldVelocity.X < 0f)
			{
				direction *= -1;
				ai[0] = -Main.rand.Next(120, 300);
				netUpdate = true;
			}
		}
		rotation = velocity.ToRotation();
		spriteDirection = direction;
	}

	private void AI_158_BabyBird()
	{
		Player player = Main.player[owner];
		if (type == 759)
		{
			if (player.dead)
			{
				player.babyBird = false;
			}
			if (player.babyBird)
			{
				timeLeft = 2;
			}
			if (++frameCounter >= 6)
			{
				frameCounter = 0;
				if (++frame >= Main.projFrames[type] - 1)
				{
					frame = 0;
				}
			}
		}
		float num = 6f;
		float num2 = 8f;
		int num3 = 800;
		float num4 = 150f;
		int attackTarget = -1;
		Minion_FindTargetInRange(num3, ref attackTarget, skipIfCannotHitWithOwnBody: false);
		if (attackTarget != -1)
		{
			NPC nPC = Main.npc[attackTarget];
			if (player.Distance(nPC.Center) > (float)num3)
			{
				attackTarget = -1;
			}
		}
		if (attackTarget != -1)
		{
			if (!Collision.SolidCollision(position, width, height))
			{
				tileCollide = true;
			}
			NPC nPC2 = Main.npc[attackTarget];
			float num5 = Distance(nPC2.Center);
			Rectangle rectangle = new Rectangle((int)position.X, (int)position.Y, width, height);
			Rectangle value = new Rectangle((int)nPC2.position.X, (int)nPC2.position.Y, nPC2.width, nPC2.height);
			if (rectangle.Intersects(value))
			{
				tileCollide = false;
				if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < num2)
				{
					velocity *= 1.1f;
				}
				if (velocity.Length() > num2)
				{
					velocity *= num2 / velocity.Length();
				}
			}
			else if (num5 > num4)
			{
				Vector2 vector = DirectionTo(nPC2.Center);
				velocity = Vector2.Lerp(velocity, vector * num, 0.15f);
			}
			else
			{
				tileCollide = false;
				Vector2 vector2 = DirectionTo(nPC2.Center);
				velocity += new Vector2(Math.Sign(vector2.X), Math.Sign(vector2.Y)) * 0.35f;
				if (velocity.Length() > num2)
				{
					velocity *= num2 / velocity.Length();
				}
			}
			float num6 = 0.025f;
			float num7 = width * 3;
			for (int i = 0; i < 1000; i++)
			{
				if (i != whoAmI && Main.projectile[i].active && Main.projectile[i].owner == owner && Main.projectile[i].type == type && Math.Abs(position.X - Main.projectile[i].position.X) + Math.Abs(position.Y - Main.projectile[i].position.Y) < num7)
				{
					if (position.X < Main.projectile[i].position.X)
					{
						velocity.X -= num6;
					}
					else
					{
						velocity.X += num6;
					}
					if (position.Y < Main.projectile[i].position.Y)
					{
						velocity.Y -= num6;
					}
					else
					{
						velocity.Y += num6;
					}
				}
			}
			rotation = velocity.X * 0.1f;
			direction = ((velocity.X > 0f) ? 1 : (-1));
			spriteDirection = ((velocity.X > 0f) ? 1 : (-1));
			return;
		}
		tileCollide = false;
		List<int> ai158_blacklistedTargets = _ai158_blacklistedTargets;
		ai158_blacklistedTargets.Clear();
		AI_GetMyGroupIndexAndFillBlackList(ai158_blacklistedTargets, out var index, out var _);
		localAI[0] = index;
		Vector2 vector3 = AI_158_GetHomeLocation(player, index);
		float num8 = Distance(vector3);
		bool flag = player.gravDir > 0f && player.fullRotation == 0f && player.headRotation == 0f;
		if (num8 > 2000f)
		{
			base.Center = vector3;
			frame = Main.projFrames[type] - 1;
			frameCounter = 0;
			velocity = Vector2.Zero;
			direction = (spriteDirection = player.direction);
			rotation = 0f;
		}
		else if (num8 > 40f)
		{
			float num9 = num + num8 * 0.006f;
			Vector2 vector4 = DirectionTo(vector3);
			vector4 *= MathHelper.Lerp(1f, 5f, Utils.GetLerpValue(40f, 800f, num8, clamped: true));
			velocity = Vector2.Lerp(velocity, vector4 * num9, 0.025f);
			if (velocity.Length() > num9)
			{
				velocity *= num9 / velocity.Length();
			}
			float num10 = 0.05f;
			float num11 = width;
			for (int j = 0; j < 1000; j++)
			{
				if (j != whoAmI && Main.projectile[j].active && Main.projectile[j].owner == owner && Main.projectile[j].type == type && Math.Abs(position.X - Main.projectile[j].position.X) + Math.Abs(position.Y - Main.projectile[j].position.Y) < num11)
				{
					if (position.X < Main.projectile[j].position.X)
					{
						velocity.X -= num10;
					}
					else
					{
						velocity.X += num10;
					}
					if (position.Y < Main.projectile[j].position.Y)
					{
						velocity.Y -= num10;
					}
					else
					{
						velocity.Y += num10;
					}
				}
			}
			rotation = velocity.X * 0.04f;
			direction = ((velocity.X > 0f) ? 1 : (-1));
			spriteDirection = ((velocity.X > 0f) ? 1 : (-1));
		}
		else if (num8 > 8f + player.velocity.Length())
		{
			Vector2 vector5 = DirectionTo(vector3);
			velocity += new Vector2(Math.Sign(vector5.X), Math.Sign(vector5.Y)) * 0.05f;
			if (velocity.Length() > num)
			{
				velocity *= num / velocity.Length();
			}
			rotation = velocity.X * 0.1f;
			direction = ((velocity.X > 0f) ? 1 : (-1));
			spriteDirection = ((velocity.X > 0f) ? 1 : (-1));
		}
		else if (flag)
		{
			base.Center = vector3;
			frame = Main.projFrames[type] - 1;
			frameCounter = 0;
			velocity = Vector2.Zero;
			direction = (spriteDirection = player.direction);
			rotation = 0f;
		}
	}

	public static Vector2 AI_158_GetHomeLocation(Player master, int stackedIndex)
	{
		int num = master.bodyFrame.Height;
		if (num == 0)
		{
			num = 1;
		}
		Vector2 pos = Main.OffsetsPlayerHeadgear[master.bodyFrame.Y / num];
		pos.Y -= 2f;
		if (master.mount.Active)
		{
			switch (master.mount.Type)
			{
			case 52:
				pos.Y += 6f;
				pos.X -= master.direction * 10;
				break;
			case 54:
				master.ApplyHeadOffsetFromMount(ref pos);
				pos.X -= master.direction * 14;
				break;
			case 55:
			case 56:
			case 61:
				master.ApplyHeadOffsetFromMount(ref pos);
				break;
			}
		}
		switch (stackedIndex % 6)
		{
		case 1:
			pos += new Vector2(master.direction * 8, master.gravDir * -2f);
			break;
		case 2:
			pos += new Vector2(master.direction * -10, master.gravDir * -2f);
			break;
		case 4:
			pos += new Vector2(master.direction * 10, master.gravDir * -10f);
			break;
		case 5:
			pos += new Vector2(master.direction * -12, master.gravDir * -10f);
			break;
		case 3:
		{
			Vector2 vector = pos;
			_ = master.direction;
			pos = vector + new Vector2(0f, master.gravDir * -10f);
			break;
		}
		}
		pos += new Vector2(0f, master.gravDir * -16f) * (stackedIndex / 6);
		Vector2 vector2 = master.RotatedRelativePoint(master.MountedCenter);
		_ = master.direction;
		return (vector2 + new Vector2(0f, master.gravDir * -21f) + pos).Floor();
	}

	public void Minion_FindTargetInRange(int startAttackRange, ref int attackTarget, bool skipIfCannotHitWithOwnBody, Func<Entity, int, bool> customEliminationCheck = null, bool respectOwnerTarget = true)
	{
		float num = startAttackRange;
		float num2 = num;
		float num3 = num;
		if (respectOwnerTarget)
		{
			NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
			if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this) && IsInRangeOfMeOrMyOwner(ownerMinionAttackTargetNPC, num, out var _, out var _, out var _))
			{
				attackTarget = ownerMinionAttackTargetNPC.whoAmI;
				return;
			}
		}
		if (attackTarget >= 0)
		{
			return;
		}
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			NPC nPC = Main.npc[i];
			if (nPC.CanBeChasedBy(this) && IsInRangeOfMeOrMyOwner(nPC, num, out var myDistance2, out var playerDistance2, out var closerIsMe2) && (!skipIfCannotHitWithOwnBody || CanHitWithOwnBody(nPC)) && (customEliminationCheck == null || customEliminationCheck(nPC, attackTarget)))
			{
				attackTarget = i;
				num = (closerIsMe2 ? myDistance2 : playerDistance2);
				if (num2 > myDistance2)
				{
					num2 = myDistance2;
				}
				if (num3 > playerDistance2)
				{
					num3 = playerDistance2;
				}
				num = Math.Max(num2, num3);
			}
		}
	}

	private bool AI_067_CustomEliminationCheck_Pirates(Entity otherEntity, int currentTarget)
	{
		return true;
	}

	private bool AI_067_TigerSpecialAttack()
	{
		List<NPC> list = new List<NPC>();
		Vector2 center = Main.player[owner].Center;
		Rectangle value = Utils.CenteredRectangle(center, new Vector2(1600f, 800f));
		int num = Main.player[owner].ownedProjectileCounts[831] + 1;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			NPC nPC = Main.npc[i];
			if (nPC.CanBeChasedBy(this) && nPC.Hitbox.Intersects(value))
			{
				list.Add(nPC);
			}
		}
		if (list.Count == 0)
		{
			return false;
		}
		NPC nPC2 = list[0];
		for (int j = 1; j < list.Count; j++)
		{
			if (Vector2.Distance(nPC2.Center, center) > Vector2.Distance(list[j].Center, center))
			{
				nPC2 = list[j];
			}
		}
		list.Remove(nPC2);
		NPC nPC3 = null;
		if (list.Count > 0)
		{
			nPC3 = list[0];
			for (int k = 1; k < list.Count; k++)
			{
				if (Distance(nPC3.Center) > Distance(list[k].Center))
				{
					nPC3 = list[k];
				}
			}
			list.Remove(nPC3);
		}
		List<Vector2> list2 = new List<Vector2>();
		if (nPC3 != null)
		{
			list2.Add(nPC3.Center);
		}
		int num2 = 0;
		while (list.Count > 0 && list2.Count < num - 1)
		{
			int index = Main.rand.Next(list.Count);
			Vector2 vector = list[index].velocity * 4f * (num2 + 1);
			list2.Add(list[index].Center + vector);
			list.RemoveAt(index);
			num2++;
		}
		if (nPC2 != null)
		{
			list2.Add(nPC2.Center);
		}
		if (list2.Count > 0 && Collision.SolidCollision(list2[list2.Count - 1] - base.Size / 2f, width, height))
		{
			list2.Add(center);
		}
		Vector2 vector2 = base.Center;
		float num3 = Math.Min(20, 30 / list2.Count);
		float num4 = 0f;
		for (int l = 0; l < list2.Count; l++)
		{
			float num5 = 20f;
			Vector2 vector3 = list2[l];
			vector3.X += ((vector2.X < vector3.X) ? num5 : (0f - num5));
			Vector2 vector4 = vector3 - vector2;
			int num6 = (int)Math.Min(num3, 4.0 + Math.Ceiling(vector4.Length() / 50f));
			if (num6 < 5)
			{
				num6 = 5;
			}
			NewProjectile(GetProjectileSource_FromThis(), vector2, vector4, 818, damage, 0f, owner, (0f - num4) * 4f, num6 * 4);
			vector2 = vector3;
			num4 += (float)num6;
		}
		base.Center = vector2;
		ai[0] = 4f;
		ai[1] = num4;
		netUpdate = true;
		return true;
	}

	private void AI_067_FreakingPirates()
	{
		Player player = Main.player[owner];
		bool flag = type == 393 || type == 394 || type == 395;
		bool flag2 = type == 758;
		bool flag3 = type == 833 || type == 834 || type == 835;
		bool flag4 = type == 834 || type == 835;
		bool flag5 = type == 951;
		bool flag6 = type == 1022;
		bool flag7 = type == 1036;
		bool flag8 = type == 1093;
		float num = 0.4f;
		if (flag7)
		{
			if (!player.active || player.dead)
			{
				player.cobWhipBuff = false;
				Kill();
				return;
			}
			if (player.cobWhipBuff)
			{
				timeLeft = 2;
			}
		}
		if (!player.active)
		{
			if (flag7)
			{
				player.coolWhipBuff = false;
			}
			active = false;
			return;
		}
		int num2 = 450;
		float num3 = 500f;
		float num4 = 300f;
		int num5 = 15;
		bool flag9 = player.petting.isPetting && player.petting.proj == whoAmI;
		if (flag8)
		{
			if (player.dead)
			{
				player.palworldCattivaMinion = false;
			}
			if (player.palworldCattivaMinion)
			{
				timeLeft = 2;
			}
			num2 = 800;
			if (--soundDelay == -20)
			{
				SoundEngine.PlaySound(SoundID.PalCattiva, base.Center);
			}
			if (soundDelay == -1)
			{
				SoundEngine.PlaySound(SoundID.PalSummon, base.Center);
			}
			if (flag9 && localAI[0] == 0f)
			{
				localAI[0] = 60f;
				SoundEngine.PlaySound(SoundID.PalCattivaJoy, base.Center);
			}
			if (localAI[0] > (float)(flag9 ? 1 : 0))
			{
				localAI[0] -= 1f;
			}
		}
		if (flag6)
		{
			if (player.dead)
			{
				player.deadCellsMushroomBoiMinion = false;
			}
			if (player.deadCellsMushroomBoiMinion)
			{
				timeLeft = 2;
			}
			num2 = 800;
		}
		if (flag5)
		{
			if (player.dead)
			{
				player.flinxMinion = false;
			}
			if (player.flinxMinion)
			{
				timeLeft = 2;
			}
			num2 = 800;
		}
		if (flag)
		{
			if (player.dead)
			{
				player.pirateMinion = false;
			}
			if (player.pirateMinion)
			{
				timeLeft = 2;
			}
			num2 = 800;
		}
		if (flag3)
		{
			if (player.dead)
			{
				player.stormTiger = false;
			}
			if (player.stormTiger)
			{
				timeLeft = 2;
			}
			num2 = 800;
			if (ai[0] != 4f)
			{
				if (velocity != Vector2.Zero && Main.rand.Next(18) == 0)
				{
					Dust obj = Main.dust[Dust.NewDust(position, width, height, 269)];
					obj.fadeIn = 0.5f;
					obj.scale = 0.3f;
					obj.noLight = true;
					obj.velocity += velocity * 0.005f;
				}
				if (type == 833)
				{
					Lighting.AddLight(base.Center, Vector3.One * 0.5f);
				}
				if (type == 834)
				{
					Lighting.AddLight(base.Center, Vector3.One * 0.8f);
				}
				if (type == 835)
				{
					Lighting.AddLight(base.Center, Color.Lerp(Main.OurFavoriteColor, Color.White, 0.8f).ToVector3() * 1f);
				}
			}
			if (owner == Main.myPlayer)
			{
				if (localAI[0] <= 0f)
				{
					int num6 = type switch
					{
						834 => 300, 
						835 => 240, 
						_ => 360, 
					};
					if (damage != 0)
					{
						bool flag10 = AI_067_TigerSpecialAttack();
						localAI[0] = (flag10 ? num6 : 10);
					}
				}
				else
				{
					localAI[0] -= 1f;
				}
			}
		}
		if (flag2)
		{
			if (player.dead)
			{
				player.vampireFrog = false;
			}
			if (player.vampireFrog)
			{
				timeLeft = 2;
			}
			num2 = 800;
		}
		if (type == 500)
		{
			num3 = 200f;
			if (player.dead)
			{
				player.crimsonHeart = false;
			}
			if (player.crimsonHeart)
			{
				timeLeft = 2;
			}
		}
		if (type == 653)
		{
			num3 = 300f;
			if (player.dead)
			{
				player.companionCube = false;
			}
			if (player.companionCube)
			{
				timeLeft = 2;
			}
		}
		if (type == 1018)
		{
			num3 = 200f;
			if (player.dead)
			{
				player.petFlagDirtiestBlock = false;
			}
			if (player.petFlagDirtiestBlock)
			{
				timeLeft = 2;
			}
		}
		if (type == 1056)
		{
			num3 = 200f;
			if (player.dead)
			{
				player.petFlagBoulderPet = false;
			}
			if (player.petFlagBoulderPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 1090)
		{
			num3 = 200f;
			if (player.dead)
			{
				player.petFlagRainbowBoulderPet = false;
			}
			if (player.petFlagRainbowBoulderPet)
			{
				timeLeft = 2;
			}
		}
		if (flag3 && ai[0] == 4f)
		{
			velocity = Vector2.Zero;
			frame = 9;
			if (flag4)
			{
				frame = 11;
			}
			ai[1] -= 1f;
			if (!(ai[1] <= 0f))
			{
				return;
			}
			ai[0] = 0f;
			ai[1] = 0f;
			netUpdate = true;
		}
		Vector2 vector = player.Center;
		if (flag6)
		{
			vector.X -= (45 + player.width / 2) * player.direction;
			vector.X -= minionPos * 30 * player.direction;
		}
		else if (flag5)
		{
			vector.X -= (45 + player.width / 2) * player.direction;
			vector.X -= minionPos * 30 * player.direction;
		}
		else if (flag)
		{
			vector.X -= (15 + player.width / 2) * player.direction;
			vector.X -= minionPos * 20 * player.direction;
		}
		else if (flag8)
		{
			vector.X -= (30 + player.width / 2) * player.direction;
			vector.X -= minionPos * 20 * player.direction;
		}
		else if (flag3)
		{
			vector.X -= (15 + player.width / 2) * player.direction;
			vector.X -= minionPos * 40 * player.direction;
		}
		else if (flag2)
		{
			vector.X -= (35 + player.width / 2) * player.direction;
			vector.X -= minionPos * 40 * player.direction;
		}
		else if (type == 500)
		{
			vector.X -= (15 + player.width / 2) * player.direction;
			vector.X -= 40 * player.direction;
		}
		else if (type == 1018)
		{
			vector.X = player.Center.X;
		}
		else if (type == 1056)
		{
			vector.X -= (15 + player.width / 2) * player.direction;
		}
		else if (type == 1090)
		{
			vector.X -= (15 + player.width / 2) * player.direction;
		}
		else if (type == 653)
		{
			vector.X = player.Center.X;
		}
		if (type == 500)
		{
			Lighting.AddLight(base.Center, 0.9f, 0.1f, 0.3f);
			int num7 = 6;
			if (frame == 0 || frame == 2)
			{
				num7 = 12;
			}
			if (++frameCounter >= num7)
			{
				frameCounter = 0;
				if (++frame >= Main.projFrames[type])
				{
					frame = 0;
				}
			}
			rotation += velocity.X / 20f;
			Vector2 vector2 = (-Vector2.UnitY).RotatedBy(rotation).RotatedBy((float)direction * 0.2f);
			int num8 = Dust.NewDust(base.Center + vector2 * 10f - new Vector2(4f), 0, 0, 5, vector2.X, vector2.Y, 0, Color.Transparent);
			Main.dust[num8].scale = 1f;
			Main.dust[num8].velocity = vector2.RotatedByRandom(0.7853981852531433) * 3.5f;
			Main.dust[num8].noGravity = true;
			Main.dust[num8].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cLight, Main.player[owner]);
		}
		if (type == 1018)
		{
			rotation += velocity.X / 20f;
		}
		if (type == 1056 || type == 1090)
		{
			rotation += velocity.X / 16f;
		}
		if (type == 653)
		{
			rotation += velocity.X / 20f;
			bool flag11 = owner >= 0 && owner < 255;
			if (flag11)
			{
				_CompanionCubeScreamCooldown[owner] -= 1f;
				if (_CompanionCubeScreamCooldown[owner] < 0f)
				{
					_CompanionCubeScreamCooldown[owner] = 0f;
				}
			}
			Tile tileSafely = Framing.GetTileSafely(base.Center);
			if (tileSafely.liquid > 0 && tileSafely.lava())
			{
				localAI[0] += 1f;
			}
			else
			{
				localAI[0] -= 1f;
			}
			localAI[0] = MathHelper.Clamp(localAI[0], 0f, 20f);
			if (localAI[0] >= 20f)
			{
				if (flag11 && _CompanionCubeScreamCooldown[owner] == 0f)
				{
					_CompanionCubeScreamCooldown[owner] = 3600f;
					SoundEngine.PlaySound((Main.rand.Next(10) == 0) ? SoundID.NPCDeath61 : SoundID.NPCDeath59, position);
				}
				Kill();
			}
			if (flag11 && owner == Main.myPlayer && Main.netMode != 2)
			{
				Vector3 vector3 = Lighting.GetColor((int)base.Center.X / 16, (int)base.Center.Y / 16).ToVector3();
				Vector3 vector4 = Lighting.GetColor((int)player.Center.X / 16, (int)player.Center.Y / 16).ToVector3();
				if (vector3.Length() < 0.15f && vector4.Length() < 0.15f)
				{
					localAI[1] += 1f;
				}
				else if (localAI[1] > 0f)
				{
					localAI[1] -= 1f;
				}
				localAI[1] = MathHelper.Clamp(localAI[1], -3600f, 120f);
				if (localAI[1] > (float)Main.rand.Next(30, 120) && !player.immune && player.velocity == Vector2.Zero)
				{
					if (Main.rand.Next(5) == 0)
					{
						SoundEngine.PlaySound(SoundID.Item16, base.Center);
						localAI[1] = -600f;
					}
					else
					{
						SoundEngine.PlaySound(SoundID.Item1, base.Center);
						player.Hurt(PlayerDeathReason.ByOther(6), 3, 0);
						player.immune = false;
						player.immuneTime = 0;
						localAI[1] = -300 + Main.rand.Next(30) * -10;
					}
				}
			}
		}
		bool flag12 = true;
		if (type == 500 || type == 653 || type == 1018 || type == 1056 || type == 1090)
		{
			flag12 = false;
		}
		shouldFallThrough = player.position.Y + (float)player.height - 12f > position.Y + (float)height;
		friendly = false;
		int num9 = 0;
		int num10 = 15;
		int attackTarget = -1;
		bool flag13 = true;
		bool flag14 = ai[0] == 5f;
		if (flag7)
		{
			num10 = 5;
			num9 = 0;
			flag13 = false;
			friendly = true;
		}
		if (flag6)
		{
			flag13 = false;
			friendly = true;
		}
		if (flag5)
		{
			flag13 = false;
			friendly = true;
		}
		if (flag2)
		{
			friendly = true;
			num10 = 20;
			num9 = 60;
		}
		if (flag3)
		{
			flag13 = false;
			friendly = true;
			originalDamage = player.highestStormTigerGemOriginalDamage;
		}
		if (flag8)
		{
			num10 = 16;
			DoPalAppearEffect(player, ai[0] != 1f);
			AI_067_FreakingPirates_TryAssigningHelp();
		}
		bool flag15 = ai[0] == 0f;
		if (flag3 && flag14)
		{
			flag15 = true;
		}
		if (flag6)
		{
			flag15 = ai[0] == 0f || ai[0] == 1f;
		}
		if (flag15 && flag12)
		{
			bool respectOwnerTarget = true;
			if (flag7)
			{
				respectOwnerTarget = false;
			}
			Minion_FindTargetInRange(num2, ref attackTarget, skipIfCannotHitWithOwnBody: true, AI_067_CustomEliminationCheck_Pirates, respectOwnerTarget);
		}
		if (flag8 && attackTarget >= 0 && ai[0] == 3f && owner == Main.myPlayer)
		{
			ai[0] = 0f;
			ai[1] = 0f;
			localAI[0] = 0f;
			localAI[1] = 0f;
			netUpdate = true;
		}
		if (flag3 && flag14)
		{
			if (attackTarget >= 0)
			{
				float maxDistance = num2;
				NPC nPC = Main.npc[attackTarget];
				vector = nPC.Center;
				if (!IsInRangeOfMeOrMyOwner(nPC, maxDistance, out var _, out var _, out var _))
				{
					ai[0] = 0f;
					ai[1] = 0f;
					return;
				}
				Point point = nPC.Top.ToTileCoordinates();
				int num11 = 0;
				int num12 = point.Y;
				while (num11 < num5)
				{
					Tile tile = Main.tile[point.X, num12];
					if (tile == null || tile.active())
					{
						break;
					}
					num11++;
					num12++;
				}
				int num13 = num5 / 2;
				if (num11 < num13)
				{
					ai[0] = 0f;
					ai[1] = 0f;
					return;
				}
				if (base.Hitbox.Intersects(nPC.Hitbox) && velocity.Y >= 0f)
				{
					velocity.Y = -8f;
					velocity.X = direction * 10;
				}
				float num14 = 20f;
				float maxAmountAllowedToMove = 4f;
				float num15 = 40f;
				float num16 = 40f;
				Vector2 top = nPC.Top;
				float num17 = (float)Math.Cos(Main.timeForVisualEffects / (double)num15 * 6.2831854820251465);
				if (num17 > 0f)
				{
					num17 *= -1f;
				}
				num17 *= num16;
				top.Y += num17;
				Vector2 vector5 = top - base.Center;
				if (vector5.Length() > num14)
				{
					vector5 = vector5.SafeNormalize(Vector2.Zero) * num14;
				}
				velocity = velocity.MoveTowards(vector5, maxAmountAllowedToMove);
				frame = 8;
				if (flag4)
				{
					frame = 10;
				}
				rotation += 0.6f * (float)spriteDirection;
			}
			else
			{
				ai[0] = 0f;
				ai[1] = 0f;
			}
			return;
		}
		if (flag6)
		{
			if (ai[2] > 0f && attackTarget >= 0)
			{
				float maxDistance2 = 60f;
				NPC nPC2 = Main.npc[attackTarget];
				vector = nPC2.Center;
				if (IsInRangeOfMeOrMyOwner(nPC2, maxDistance2, out var _, out var _, out var _))
				{
					ai[2] = -120f;
					if (owner == Main.myPlayer)
					{
						NewProjectile(GetProjectileSource_FromThis(), base.Center, Vector2.Zero, 1044, (int)((float)damage * 1.33f), knockBack * 3f, owner, 0f, 2f);
					}
					_ = base.Center;
					base.Center = player.Center;
					velocity = new Vector2(-2f + Main.rand.NextFloat() * 4f, 1f + Main.rand.NextFloat());
					netUpdate = true;
				}
			}
			if (ai[2] < 0f)
			{
				ai[2] += 1f;
			}
			else if (velocity.Y == 0f)
			{
				ai[2] = 0f;
			}
			else if ((ai[2] -= 1f) < 0f)
			{
				ai[2] = 0f;
			}
		}
		if (ai[0] == 1f)
		{
			if (Main.netMode != 2 && type == 1090 && Main.LocalPlayer.miscCounter % 2 == 0)
			{
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.ShimmerBlock, new ParticleOrchestraSettings
				{
					PositionInWorld = base.Center + Main.rand.NextVector2CircularEdge(width / 2, height / 2),
					MovementVector = velocity * 0.05f,
					UniqueInfoPiece = 500
				});
			}
			tileCollide = false;
			float num18 = 0.2f;
			float num19 = 10f;
			int num20 = 200;
			if (type == 1090)
			{
				num19 = 18f;
			}
			if (num19 < Math.Abs(player.velocity.X) + Math.Abs(player.velocity.Y))
			{
				num19 = Math.Abs(player.velocity.X) + Math.Abs(player.velocity.Y);
			}
			Vector2 spinninpoint = player.Center - base.Center;
			float num21 = spinninpoint.Length();
			if (num21 > 2000f)
			{
				position = player.Center - new Vector2(width, height) / 2f;
			}
			if (num21 < (float)num20 && player.velocity.Y == 0f && position.Y + (float)height <= player.position.Y + (float)player.height && !Collision.SolidCollision(position, width, height))
			{
				ai[0] = 0f;
				netUpdate = true;
				if (velocity.Y < -6f)
				{
					velocity.Y = -6f;
				}
			}
			if (flag8 && num21 < (float)num20 && player.velocity.Y == 0f)
			{
				ai[0] = 0f;
				netUpdate = true;
				base.Center = player.MountedCenter;
			}
			int num22 = 60;
			if (type == 1090)
			{
				num22 = 350;
			}
			if (num21 < (float)num22)
			{
				localAI[0] = 0f;
				if (type == 1090 && velocity.Length() < num19)
				{
					if (velocity == Vector2.Zero)
					{
						velocity = new Vector2(0f, -1f);
					}
					velocity = velocity.SafeNormalize(Vector2.Zero) * num19;
				}
			}
			else
			{
				spinninpoint.Normalize();
				spinninpoint *= num19;
				if (type == 1090)
				{
					velocity = spinninpoint.RotatedByRandom(0.5235987901687622);
					if (localAI[0] == 0f)
					{
						localAI[0] = 1f;
						ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.RainbowBoulderPetBounce, new ParticleOrchestraSettings
						{
							PositionInWorld = base.Center,
							MovementVector = velocity
						});
					}
				}
				else
				{
					if (velocity.X < spinninpoint.X)
					{
						velocity.X += num18;
						if (velocity.X < 0f)
						{
							velocity.X += num18 * 1.5f;
						}
					}
					if (velocity.X > spinninpoint.X)
					{
						velocity.X -= num18;
						if (velocity.X > 0f)
						{
							velocity.X -= num18 * 1.5f;
						}
					}
					if (velocity.Y < spinninpoint.Y)
					{
						velocity.Y += num18;
						if (velocity.Y < 0f)
						{
							velocity.Y += num18 * 1.5f;
						}
					}
					if (velocity.Y > spinninpoint.Y)
					{
						velocity.Y -= num18;
						if (velocity.Y > 0f)
						{
							velocity.Y -= num18 * 1.5f;
						}
					}
				}
			}
			if (velocity.X != 0f)
			{
				spriteDirection = Math.Sign(velocity.X);
			}
			if (flag6)
			{
				frame = 1;
				rotation = velocity.X * 0.1f;
			}
			if (flag5)
			{
				frameCounter++;
				if (frameCounter > 3)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 2 || frame >= Main.projFrames[type])
				{
					frame = 2;
				}
				rotation = rotation.AngleTowards(rotation + 0.25f * (float)spriteDirection, 0.25f);
			}
			if (flag)
			{
				frameCounter++;
				if (frameCounter > 3)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 10 || frame > 13)
				{
					frame = 10;
				}
				rotation = velocity.X * 0.1f;
			}
			if (flag8)
			{
				frame = 1;
				if (player.velocity.Y >= -6f)
				{
					frame = 0;
				}
				if (player.velocity.Y >= 6f)
				{
					frame = 2;
				}
				base.Center = player.MountedCenter + new Vector2(player.direction * -8, -24f);
				position = position.Floor();
				direction = (spriteDirection = player.direction);
				velocity = Vector2.Zero;
				if (player.mount.Active && MountID.Sets.PlayerIsHidden[player.mount.Type])
				{
					alpha = 255;
				}
			}
			if (flag2)
			{
				int num23 = 3;
				if (++frameCounter >= num23 * 4)
				{
					frameCounter = 0;
				}
				frame = 14 + frameCounter / num23;
				rotation = velocity.X * 0.15f;
			}
			if (flag3)
			{
				frame = 8;
				if (flag4)
				{
					frame = 10;
				}
				rotation += 0.6f * (float)spriteDirection;
			}
			if (type == 1056 || type == 1090)
			{
				rotation += 0.5f * (float)spriteDirection;
			}
			if (type == 1018 && Main.LocalPlayer.miscCounter % 3 == 0)
			{
				int num24 = 2;
				Dust obj2 = Main.dust[Dust.NewDust(position + new Vector2(-num24, -num24), 16 + num24 * 2, 16 + num24 * 2, 0, 0f, 0f, 0, default(Color), 0.8f)];
				obj2.velocity = -velocity * 0.25f;
				obj2.velocity = obj2.velocity.RotatedByRandom(0.2617993950843811);
			}
		}
		if (ai[0] == 2f && ai[1] < 0f)
		{
			friendly = false;
			ai[1] += 1f;
			if (num10 >= 0)
			{
				ai[1] = 0f;
				ai[0] = 0f;
				netUpdate = true;
				return;
			}
		}
		else if (ai[0] == 2f)
		{
			spriteDirection = direction;
			rotation = 0f;
			if (flag)
			{
				friendly = true;
				frame = 4 + (int)((float)num10 - ai[1]) / (num10 / 3);
				if (velocity.Y != 0f)
				{
					frame += 3;
				}
			}
			if (flag8)
			{
				friendly = true;
				if (ai[1] == (float)(num10 - 1) && velocity.Y == 0f)
				{
					velocity.X *= 0.3f;
				}
				frame = 3 + (int)((float)num10 - ai[1]) / (num10 / 4);
				if ((int)ai[1] % 4 == 0)
				{
					for (int i = 0; i < 3; i++)
					{
						Dust dust = Dust.NewDustDirect(base.Center + new Vector2(direction * 8, -4f), 8, 8, 16, -direction * 2, 0f, 127);
						dust.velocity *= 0.5f;
						dust.scale *= 0.8f;
						dust.velocity.Y -= 0.2f;
					}
				}
			}
			if (flag2)
			{
				float num25 = ((float)num10 - ai[1]) / (float)num10;
				if ((double)num25 > 0.25 && (double)num25 < 0.75)
				{
					friendly = true;
				}
				int num26 = (int)(num25 * 5f);
				if (num26 > 2)
				{
					num26 = 4 - num26;
				}
				if (velocity.Y != 0f)
				{
					frame = 21 + num26;
				}
				else
				{
					frame = 18 + num26;
				}
				if (velocity.Y == 0f)
				{
					velocity.X *= 0.8f;
				}
			}
			velocity.Y += 0.4f;
			if (velocity.Y > 10f)
			{
				velocity.Y = 10f;
			}
			ai[1] -= 1f;
			if (ai[1] <= 0f)
			{
				if (num9 <= 0)
				{
					ai[1] = 0f;
					ai[0] = 0f;
					netUpdate = true;
					return;
				}
				ai[1] = -num9;
			}
		}
		if (flag6 && attackTarget < 0)
		{
			localAI[2] = 0f;
		}
		if (attackTarget >= 0)
		{
			flag9 = false;
			float maxDistance3 = num2;
			float num27 = 20f;
			if (flag2)
			{
				num27 = 50f;
			}
			NPC nPC3 = Main.npc[attackTarget];
			Vector2 center = nPC3.Center;
			Vector2 targetCenter = center;
			if (flag6)
			{
				center += new Vector2(num27 + 7f, 0f) * direction;
			}
			vector = center;
			if (IsInRangeOfMeOrMyOwner(nPC3, maxDistance3, out var _, out var _, out var _))
			{
				AI_067_FreakingPirates_TryJumpingToTarget(nPC3.velocity, center, targetCenter);
				if (flag13 && Vector2.Distance(base.Center, vector) < num27)
				{
					if (velocity.Length() > 10f)
					{
						velocity /= velocity.Length() / 10f;
					}
					ai[0] = 2f;
					ai[1] = num10;
					netUpdate = true;
					direction = ((center.X - base.Center.X > 0f) ? 1 : (-1));
				}
				if (flag3)
				{
					Point point2 = nPC3.Top.ToTileCoordinates();
					int num28 = 0;
					int num29 = point2.Y;
					while (num28 < num5)
					{
						Tile tile2 = Main.tile[point2.X, num29];
						if (tile2 == null || tile2.active())
						{
							break;
						}
						num28++;
						num29++;
					}
					if (num28 >= num5)
					{
						ai[0] = 5f;
						ai[1] = 0f;
						netUpdate = true;
						return;
					}
					if (base.Hitbox.Intersects(nPC3.Hitbox) && velocity.Y >= 0f)
					{
						velocity.Y = -4f;
						velocity.X = direction * 10;
					}
				}
			}
			if (flag2)
			{
				int num30 = 1;
				if (center.X - base.Center.X < 0f)
				{
					num30 = -1;
				}
				vector.X += 20 * -num30;
			}
		}
		if (ai[0] == 0f && attackTarget < 0 && !flag7)
		{
			bool flag16 = false;
			Vector2 vector6 = player.Center - base.Center;
			if (vector6.Length() > 2000f)
			{
				position = player.Center - new Vector2(width, height) / 2f;
			}
			else if (vector6.Length() > num3 || Math.Abs(vector6.Y) > num4)
			{
				flag16 = true;
				if (velocity.Y > 0f && vector6.Y < 0f)
				{
					velocity.Y = 0f;
				}
				if (velocity.Y < 0f && vector6.Y > 0f)
				{
					velocity.Y = 0f;
				}
			}
			if (flag16)
			{
				ai[0] = 1f;
				netUpdate = true;
				if (type == 1093)
				{
					alpha = 255;
				}
			}
		}
		if (ai[0] == 0f || ai[0] == 3f)
		{
			if (attackTarget < 0)
			{
				if (Distance(player.Center) > 60f && Distance(vector) > 60f && Math.Sign(vector.X - player.Center.X) != Math.Sign(base.Center.X - player.Center.X))
				{
					vector = player.Center;
				}
				if (ai[0] == 3f)
				{
					vector = new Vector2(ai[1] * 16f + 8f, ai[2] * 16f + 8f);
					AI_067_FreakingPirates_TryJumpingToTarget(Vector2.Zero, vector, vector);
					float num31 = Vector2.Distance(base.Hitbox.ClosestPointInRect(vector), vector);
					if (flag13 && num31 < 20f)
					{
						if (velocity.Length() > 10f)
						{
							velocity /= velocity.Length() / 10f;
						}
						ai[0] = 2f;
						ai[1] = num10;
						netUpdate = true;
						direction = ((vector.X - base.Center.X > 0f) ? 1 : (-1));
						AI_067_FreakingPirates_HitIntention(vector);
					}
				}
				Rectangle r = Utils.CenteredRectangle(vector, base.Size);
				for (int j = 0; j < 20; j++)
				{
					if (Collision.SolidCollision(r.TopLeft(), r.Width, r.Height))
					{
						break;
					}
					r.Y += 16;
					vector.Y += 16f;
				}
				Vector2 vector7 = vector - player.Center;
				Vector2 vector8 = Collision.TileCollision(player.Center - base.Size / 2f, vector7, width, height);
				vector = player.Center - base.Size / 2f + vector8 + base.Size / 2f;
				if (Distance(vector) < 32f && ai[0] != 3f)
				{
					float num32 = player.Center.Distance(vector);
					if (player.Center.Distance(base.Center) < num32)
					{
						vector = base.Center;
					}
				}
				Vector2 vector9 = player.Center - vector;
				if (vector9.Length() > num3 || Math.Abs(vector9.Y) > num4)
				{
					Rectangle r2 = Utils.CenteredRectangle(player.Center, base.Size);
					Vector2 vector10 = vector - player.Center;
					Vector2 vector11 = r2.TopLeft();
					for (float num33 = 0f; num33 < 1f; num33 += 0.05f)
					{
						Vector2 vector12 = r2.TopLeft() + vector10 * num33;
						if (Collision.SolidCollision(r2.TopLeft() + vector10 * num33, r.Width, r.Height))
						{
							break;
						}
						vector11 = vector12;
					}
					vector = vector11 + base.Size / 2f;
				}
			}
			tileCollide = true;
			float num34 = 0.5f;
			float num35 = 4f;
			float num36 = 4f;
			float num37 = 0.1f;
			if (flag6 && attackTarget != -1)
			{
				num34 = 0.8f;
				num35 = 6f;
				num36 = 6f;
			}
			if (flag5 && attackTarget != -1)
			{
				num34 = 0.65f;
				num35 = 5.5f;
				num36 = 5.5f;
			}
			if (flag && attackTarget != -1)
			{
				num34 = 1f;
				num35 = 8f;
				num36 = 8f;
			}
			if (flag8 && attackTarget != -1)
			{
				num34 = 0.3f;
				num35 = 6f;
				num36 = 6f;
			}
			if (flag2 && attackTarget != -1)
			{
				num34 = 0.7f;
				num35 = 6f;
				num36 = 6f;
			}
			if (flag3 && attackTarget != -1)
			{
				num34 = 1f;
				num35 = 8f;
				num36 = 8f;
			}
			if (num36 < Math.Abs(player.velocity.X) + Math.Abs(player.velocity.Y))
			{
				num36 = Math.Abs(player.velocity.X) + Math.Abs(player.velocity.Y);
				num34 = 0.7f;
			}
			if (type == 653 || type == 1018)
			{
				float num38 = player.velocity.Length();
				if (num38 < 0.1f)
				{
					num38 = 0f;
				}
				if (num38 != 0f && num38 < num36)
				{
					num36 = num38;
				}
			}
			int num39 = 0;
			bool flag17 = false;
			bool num40 = flag9;
			float num41 = vector.X - base.Center.X;
			Vector2 vector13 = vector - base.Center;
			if (num40)
			{
				num41 = 0f;
			}
			if ((type == 1056 || type == 1090) && Math.Abs(num41) < 50f)
			{
				float num42 = player.velocity.Length();
				if (num42 < 0.1f)
				{
					num42 = 0f;
				}
				if (num42 != 0f && num42 < num36)
				{
					num36 = num42;
				}
				if (velocity.Length() <= 0.3f)
				{
					rotation = MathHelper.WrapAngle(rotation).AngleLerp(0f, 0.1f);
				}
				velocity.X *= 0.9f;
				if (Math.Abs(velocity.X) < 0.1f)
				{
					velocity.X = 0f;
				}
			}
			else if (type == 1018 && Math.Abs(num41) < 50f)
			{
				rotation = rotation.AngleTowards(0f, 0.2f);
				velocity.X *= 0.9f;
				if ((double)Math.Abs(velocity.X) < 0.1)
				{
					velocity.X = 0f;
				}
			}
			else if (type == 653 && Math.Abs(num41) < 150f)
			{
				rotation = rotation.AngleTowards(0f, 0.2f);
				velocity.X *= 0.9f;
				if ((double)Math.Abs(velocity.X) < 0.1)
				{
					velocity.X = 0f;
				}
			}
			else if (Math.Abs(num41) > 5f)
			{
				if (num41 < 0f)
				{
					num39 = -1;
					if (velocity.X > 0f - num35)
					{
						velocity.X -= num34;
					}
					else
					{
						velocity.X -= num37;
					}
				}
				else
				{
					num39 = 1;
					if (velocity.X < num35)
					{
						velocity.X += num34;
					}
					else
					{
						velocity.X += num37;
					}
				}
				bool flag18 = true;
				if (flag6)
				{
					flag18 = false;
				}
				if (flag)
				{
					flag18 = false;
				}
				if (flag8)
				{
					flag18 = false;
				}
				if (type == 653)
				{
					flag18 = false;
				}
				if (type == 1018)
				{
					flag18 = false;
				}
				if ((type == 1056 || type == 1090) && velocity.Length() <= 5f)
				{
					flag18 = false;
				}
				if (type == 1036)
				{
					flag18 = false;
				}
				if (flag2 && attackTarget == -1)
				{
					flag18 = false;
				}
				if (flag3)
				{
					flag18 = vector13.Y < -80f;
				}
				if (flag5)
				{
					flag18 = attackTarget > -1 && Main.npc[attackTarget].Hitbox.Intersects(base.Hitbox);
				}
				if (flag18)
				{
					flag17 = true;
				}
			}
			else
			{
				velocity.X *= 0.9f;
				if (Math.Abs(velocity.X) < num34 * 2f)
				{
					velocity.X = 0f;
				}
			}
			bool flag19 = Math.Abs(vector13.X) >= 64f || (vector13.Y <= -48f && Math.Abs(vector13.X) >= 8f);
			if (num40)
			{
				flag19 = false;
			}
			if (num39 != 0 && flag19)
			{
				int num43 = (int)(position.X + (float)(width / 2)) / 16;
				int num44 = (int)position.Y / 16;
				num43 += num39;
				num43 += (int)velocity.X;
				for (int k = num44; k < num44 + height / 16 + 1; k++)
				{
					if (WorldGen.SolidTile(num43, k))
					{
						flag17 = true;
					}
				}
			}
			if (type == 500 && velocity.X != 0f)
			{
				flag17 = true;
			}
			if (type == 653 && Math.Abs(velocity.X) > 3f)
			{
				flag17 = true;
			}
			if (type == 1018 && Math.Abs(velocity.X) > 3f)
			{
				flag17 = true;
			}
			if ((type == 1056 || type == 1090) && velocity.Length() > 5f)
			{
				flag17 = true;
			}
			if (type == 1036 && velocity.X != 0f)
			{
				flag17 = true;
			}
			Collision.StepUp(ref position, ref velocity, width, height, ref stepSpeed, ref gfxOffY);
			bool flag20 = flag6 && ai[2] != 0f;
			float num45 = Utils.GetLerpValue(0f, 100f, vector13.Y, clamped: true) * Utils.GetLerpValue(-2f, -6f, velocity.Y, clamped: true);
			float num46 = 1f;
			if (flag20)
			{
				num46 = 0f;
			}
			if (velocity.Y == 0f)
			{
				if (flag17)
				{
					for (int l = 0; l < 3; l++)
					{
						int num47 = (int)(position.X + (float)(width / 2)) / 16;
						if (l == 0)
						{
							num47 = (int)position.X / 16;
						}
						if (l == 2)
						{
							num47 = (int)(position.X + (float)width) / 16;
						}
						int num48 = (int)(position.Y + (float)height) / 16;
						if (!WorldGen.SolidTile(num47, num48) && !Main.tile[num47, num48].halfBrick() && Main.tile[num47, num48].slope() <= 0 && (!TileID.Sets.Platforms[Main.tile[num47, num48].type] || !Main.tile[num47, num48].active() || Main.tile[num47, num48].inActive()))
						{
							continue;
						}
						try
						{
							num47 = (int)(position.X + (float)(width / 2)) / 16;
							num48 = (int)(position.Y + (float)(height / 2)) / 16;
							num47 += num39;
							num47 += (int)velocity.X;
							if (!WorldGen.SolidTile(num47, num48 - 1) && !WorldGen.SolidTile(num47, num48 - 2))
							{
								velocity.Y = -5.1f;
							}
							else if (!WorldGen.SolidTile(num47, num48 - 2))
							{
								velocity.Y = -7.1f;
							}
							else if (WorldGen.SolidTile(num47, num48 - 5))
							{
								velocity.Y = -11.1f;
							}
							else if (WorldGen.SolidTile(num47, num48 - 4))
							{
								velocity.Y = -10.1f;
							}
							else
							{
								velocity.Y = -9.1f;
							}
						}
						catch
						{
							velocity.Y = -9.1f;
						}
					}
					if (vector.Y - base.Center.Y < -48f)
					{
						float num49 = vector.Y - base.Center.Y;
						num49 *= -1f;
						if (num49 < 60f)
						{
							velocity.Y = -6f;
						}
						else if (num49 < 80f)
						{
							velocity.Y = -7f;
						}
						else if (num49 < 100f)
						{
							velocity.Y = -8f;
						}
						else if (num49 < 120f)
						{
							velocity.Y = -9f;
						}
						else if (num49 < 140f)
						{
							velocity.Y = -10f;
						}
						else if (num49 < 160f)
						{
							velocity.Y = -11f;
						}
						else if (num49 < 190f)
						{
							velocity.Y = -12f;
						}
						else if (num49 < 210f)
						{
							velocity.Y = -13f;
						}
						else if (num49 < 270f)
						{
							velocity.Y = -14f;
						}
						else if (num49 < 310f)
						{
							velocity.Y = -15f;
						}
						else
						{
							velocity.Y = -16f;
						}
					}
					if (wet && num45 == 0f)
					{
						velocity.Y *= 2f;
					}
				}
				if (type == 1018 && localAI[2] == 0f)
				{
					localAI[2] = 1f;
					for (int m = 0; m < 6; m++)
					{
						Dust obj4 = Main.dust[Dust.NewDust(position + velocity, 16, 16, 0, 0f, 0f, 0, default(Color), 0.8f)];
						obj4.velocity.X = velocity.X * 0.25f;
						obj4.velocity.Y = -2f + Math.Abs(velocity.Y) * 0.25f;
						obj4.velocity = obj4.velocity.RotatedByRandom(0.2617993950843811);
					}
				}
			}
			else if (type == 1018)
			{
				localAI[2] = 0f;
			}
			if (!flag20)
			{
				if (velocity.X > num36)
				{
					velocity.X = num36;
				}
				if (velocity.X < 0f - num36)
				{
					velocity.X = 0f - num36;
				}
			}
			if (ai[0] != 2f)
			{
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				if (velocity.X > 0f)
				{
					direction = 1;
				}
				if (velocity.X == 0f)
				{
					direction = ((player.Center.X > base.Center.X) ? 1 : (-1));
				}
				if (velocity.X > num34 && num39 == 1)
				{
					direction = 1;
				}
				if (velocity.X < 0f - num34 && num39 == -1)
				{
					direction = -1;
				}
			}
			spriteDirection = direction;
			if (flag7)
			{
				spriteDirection = -direction;
				rotation = 0f;
				if (velocity.Y == 0f)
				{
					if (velocity.X == 0f)
					{
						frameCounter = 0;
						frame = 0;
					}
					else
					{
						frameCounter++;
						if (frameCounter > 4)
						{
							frameCounter = 0;
							frame++;
						}
						if (frame >= Main.projFrames[type])
						{
							frame = 0;
						}
					}
				}
				else
				{
					frameCounter = 0;
					frame = 1;
				}
			}
			if (flag6)
			{
				rotation = 0f;
				if (attackTarget != -1)
				{
					if (velocity.Y != 0f)
					{
						frame = 13;
						frameCounter = 0;
					}
					else
					{
						frameCounter++;
						if (frameCounter > 3)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 10 || frame > 15)
						{
							frame = 10;
						}
					}
				}
				else if (velocity.Y == 0f)
				{
					if (velocity.X == 0f)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if (Math.Abs(velocity.X) >= 0.5f)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 10)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 2 || frame > 9)
						{
							frame = 2;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else if (velocity.Y != 0f)
				{
					frame = 1;
					frameCounter = 0;
				}
			}
			if (flag5)
			{
				if (velocity.Y == 0f)
				{
					rotation = rotation.AngleTowards(0f, 0.3f);
					if (velocity.X == 0f)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if (Math.Abs(velocity.X) >= 0.5f)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 10)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 2 || frame >= Main.projFrames[type])
						{
							frame = 2;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else if (velocity.Y != 0f)
				{
					rotation = Math.Min(4f, velocity.Y) * -0.1f;
					if (spriteDirection == -1)
					{
						rotation -= (float)Math.PI * 2f;
					}
					frameCounter = 0;
					frame = 1;
				}
			}
			if (flag)
			{
				rotation = 0f;
				if (velocity.Y == 0f)
				{
					if (velocity.X == 0f)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if (Math.Abs(velocity.X) >= 0.5f)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 10)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame >= 4)
						{
							frame = 0;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else if (velocity.Y != 0f)
				{
					frameCounter = 0;
					frame = 14;
				}
			}
			if (flag8)
			{
				rotation = 0f;
				if (velocity.Y == 0f)
				{
					if (velocity.X == 0f)
					{
						frame = 0;
						frameCounter = 0;
						if (flag9)
						{
							frame = 13;
						}
					}
					else if (Math.Abs(velocity.X) >= 0.5f)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frame < 7)
						{
							frame = 7;
						}
						if (frameCounter > 10)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame >= 13)
						{
							frame = 7;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else if (velocity.Y != 0f)
				{
					frameCounter = 0;
					frame = 1;
					if (velocity.Y > 0f)
					{
						frame = 2;
					}
				}
			}
			if (flag2)
			{
				rotation = 0f;
				if (velocity.Y == 0f)
				{
					if (velocity.X == 0f)
					{
						int num50 = 4;
						if (++frameCounter >= 7 * num50 && Main.rand.Next(50) == 0)
						{
							frameCounter = 0;
						}
						int num51 = frameCounter / num50;
						if (num51 >= 4)
						{
							num51 = 6 - num51;
						}
						if (num51 < 0)
						{
							num51 = 0;
						}
						frame = 1 + num51;
					}
					else if (Math.Abs(velocity.X) >= 0.5f)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						int num52 = 15;
						int num53 = 8;
						if (frameCounter >= num53 * num52)
						{
							frameCounter = 0;
						}
						int num54 = frameCounter / num52;
						frame = num54 + 5;
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else if (velocity.Y != 0f)
				{
					if (velocity.Y < 0f)
					{
						if (frame > 9 || frame < 5)
						{
							frame = 5;
							frameCounter = 0;
						}
						if (++frameCounter >= 1 && frame < 9)
						{
							frame++;
							frameCounter = 0;
						}
					}
					else
					{
						if (frame > 13 || frame < 9)
						{
							frame = 9;
							frameCounter = 0;
						}
						if (++frameCounter >= 2 && frame < 11)
						{
							frame++;
							frameCounter = 0;
						}
					}
				}
			}
			if (flag3)
			{
				int num55 = 8;
				if (flag4)
				{
					num55 = 10;
				}
				rotation = 0f;
				if (velocity.Y == 0f)
				{
					if (velocity.X == 0f)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if (Math.Abs(velocity.X) >= 0.5f)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 10)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame >= num55 || frame < 2)
						{
							frame = 2;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else if (velocity.Y != 0f)
				{
					frameCounter = 0;
					frame = 1;
					if (flag4)
					{
						frame = 9;
					}
				}
			}
			velocity.Y += num + num45 * num46;
			if (velocity.Y > 10f)
			{
				velocity.Y = 10f;
			}
		}
		if (flag)
		{
			localAI[0] += 1f;
			if (velocity.X == 0f)
			{
				localAI[0] += 1f;
			}
			if (localAI[0] >= (float)Main.rand.Next(900, 1200))
			{
				localAI[0] = 0f;
				for (int n = 0; n < 6; n++)
				{
					int num56 = Dust.NewDust(base.Center + Vector2.UnitX * -direction * 8f - Vector2.One * 5f + Vector2.UnitY * 8f, 3, 6, 216, -direction, 1f);
					Main.dust[num56].velocity /= 2f;
					Main.dust[num56].scale = 0.8f;
				}
				int num57 = Gore.NewGore(base.Center + Vector2.UnitX * -direction * 8f, Vector2.Zero, Main.rand.Next(580, 583));
				Main.gore[num57].velocity /= 2f;
				Main.gore[num57].velocity.Y = Math.Abs(Main.gore[num57].velocity.Y);
				Main.gore[num57].velocity.X = (0f - Math.Abs(Main.gore[num57].velocity.X)) * (float)direction;
			}
		}
		if (type != 1090)
		{
			return;
		}
		if (++frameCounter >= 2)
		{
			frameCounter = 0;
			if (++frame >= 100)
			{
				frame = 0;
			}
		}
		float num58 = 0.025f;
		if (ai[0] == 1f)
		{
			localAI[2] += num58;
			if (localAI[2] >= 1f)
			{
				localAI[2] = 1f;
			}
		}
		else
		{
			localAI[2] -= num58;
			if (localAI[2] <= 0f)
			{
				localAI[2] = 0f;
			}
		}
	}

	private void AI_067_FreakingPirates_TryJumpingToTarget(Vector2 targetVelocity, Vector2 toTarget, Vector2 targetCenter)
	{
		bool num = type == 1022;
		shouldFallThrough = targetCenter.Y > base.Bottom.Y;
		bool flag = velocity.Y == 0f;
		if (wet && velocity.Y > 0f && !shouldFallThrough)
		{
			flag = true;
		}
		bool flag2 = false;
		if (num && (toTarget.Y < base.Center.Y - 160f || ai[0] == 1f) && !flag2 && ai[2] == 0f)
		{
			int num2 = 15;
			if (localAI[2] == 0f)
			{
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.DeadCellsMushroomBoiTargetFound, new ParticleOrchestraSettings
				{
					PositionInWorld = base.Top,
					UniqueInfoPiece = whoAmI
				}, owner);
			}
			localAI[2] += 1f;
			if (localAI[2] >= (float)num2)
			{
				int num3 = 32;
				Utils.ChaseResults chaseResults = Utils.GetChaseResults(base.Center, num3, targetCenter, targetVelocity);
				Vector2 vector = -Vector2.UnitY * num3;
				vector = ((!chaseResults.InterceptionHappens || !(chaseResults.InterceptionTime < 120f)) ? (targetCenter.SafeNormalize(-Vector2.UnitY) * num3) : chaseResults.ChaserVelocity);
				velocity = vector;
				ai[2] = 30f;
				localAI[2] = 0f;
				netUpdate = true;
			}
			flag2 = true;
		}
		int num4 = 30;
		if (type == 1093 && ai[0] == 3f)
		{
			num4 = 16;
		}
		if (toTarget.Y < base.Center.Y - (float)num4 && flag && !flag2)
		{
			float num5 = (toTarget.Y - base.Center.Y) * -1f;
			float num6 = 0.4f;
			float num7 = (float)Math.Sqrt(num5 * 2f * num6);
			if (num7 > 26f)
			{
				num7 = 26f;
			}
			velocity.Y = 0f - num7;
		}
	}

	private void AI_067_FreakingPirates_HitIntention(Vector2 idealPosition)
	{
		if (type != 1093)
		{
			return;
		}
		Point pt = idealPosition.ToTileCoordinates();
		Tile tileSafely = Framing.GetTileSafely(pt);
		if (tileSafely == null)
		{
			return;
		}
		int num = 0;
		if (tileSafely.active())
		{
			Player player = Main.player[owner];
			int pickPower = 41;
			player.PickTile_DetermineDamage(pt.X, pt.Y, pickPower, tileSafely, out var _, out var num2);
			if (num2 > 0)
			{
				num++;
				player.PickTile(pt.X, pt.Y, pickPower);
			}
		}
		if (num > 0)
		{
			ParticleOrchestrator.BroadcastOrRequestParticleSpawn(ParticleOrchestraType.CattivaHit, new ParticleOrchestraSettings
			{
				PositionInWorld = idealPosition + Main.rand.NextVector2Circular(4f, 4f),
				MovementVector = Main.rand.NextVector2CircularEdge(4f, 4f)
			});
		}
		else
		{
			ai[0] = 0f;
			ai[1] = 0f;
			ai[2] = 0f;
			netUpdate = true;
		}
	}

	private void AI_067_FreakingPirates_TryAssigningHelp()
	{
		if (owner != Main.myPlayer || ai[0] == 1f || ai[0] == 2f)
		{
			return;
		}
		Player player = Main.player[owner];
		PlayerIntentionGuesser intentionGuesser = player.IntentionGuesser;
		if (ai[0] == 3f && intentionGuesser.Intention == GuessedPlayerIntention.None)
		{
			ai[0] = 0f;
			ai[1] = 0f;
			ai[2] = 0f;
			localAI[0] = 0f;
			localAI[1] = 0f;
			netUpdate = true;
			return;
		}
		SmartCursorHelper.SmartCursorUsageInfo usageProxy = intentionGuesser.UsageProxy;
		int focusedX = -1;
		int focusedY = -1;
		float num = ai[0];
		float num2 = ai[1];
		float num3 = ai[2];
		switch (intentionGuesser.Intention)
		{
		case GuessedPlayerIntention.HarvestTrees:
			intentionGuesser.PrepareUsageProxy(player, 10, 15, 5);
			SmartCursorHelper.Step_Axe(usageProxy, ref focusedX, ref focusedY);
			if (focusedX != -1 && focusedY != -1)
			{
				ai[0] = 3f;
				ai[1] = focusedX;
				ai[2] = focusedY;
			}
			break;
		case GuessedPlayerIntention.HarvestTreasure:
			intentionGuesser.PrepareUsageProxy(player, 1, 15, 15);
			_ = intentionGuesser.UsageProxy.mouse - intentionGuesser.UsageProxy.Center;
			SmartCursorHelper.Step_Pickaxe_MineSolids(player, intentionGuesser.LastPosition, intentionGuesser.LastCenter, intentionGuesser.LastWidth, intentionGuesser.LastDirection, intentionGuesser.UsageProxy, _miningHelperPointsToSkip, ref focusedX, ref focusedY);
			if (focusedX != -1 && focusedY != -1)
			{
				ai[0] = 3f;
				ai[1] = focusedX;
				ai[2] = focusedY;
			}
			break;
		}
		if (num != ai[0] && intentionGuesser.PlayerActiveActionTimeLeft > 0)
		{
			localAI[0] = 60f;
			localAI[1] = 0f;
		}
		if (num2 != (float)focusedX || num3 != (float)focusedY || num != ai[0])
		{
			netUpdate = true;
		}
	}

	private void AI_157_SharpTears()
	{
		int num = 5;
		float num2 = 1f;
		int num3 = 30;
		int num4 = 30;
		int num5 = 2;
		int num6 = 2;
		int num7 = 20;
		int num8 = 30;
		int num9 = 35;
		int maxValue = 6;
		bool flag = true;
		int num10 = 1;
		float num11 = 1f;
		float num12 = 0f;
		float num13 = 0f;
		if (type == 961)
		{
			num = 16;
			num2 = 0.75f;
			num3 = 5;
			num4 = 5;
			num5 = 0;
			num6 = 0;
			num7 = 10;
			num8 = 10;
			num9 = 20;
			maxValue = 5;
		}
		if (type == 1041)
		{
			num = 228;
			num2 = 0.25f;
			num3 = 3;
			num4 = 2;
			num5 = 0;
			num6 = 0;
			num11 = 0.5f;
			num12 = 2f;
			num13 = 60f;
			num7 = 4;
			num9 = 19;
			num8 = num9 - 5;
			maxValue = 8;
			flag = false;
			num10 = 2;
			if (frame == 0)
			{
				num10 = 6;
			}
		}
		bool flag2 = ai[0] < (float)num7 && ai[0] >= 0f;
		bool flag3 = ai[0] >= (float)num8;
		bool flag4 = ai[0] >= (float)num9;
		ai[0] += 1f;
		if (ai[0] < 0f)
		{
			alpha = 255;
			scale = 0.1f * ai[1];
		}
		if (!flag && ai[0] >= 0f && ++frameCounter >= num10)
		{
			frameCounter = 0;
			frame++;
		}
		if (localAI[0] == 0f && ai[0] >= 0f)
		{
			localAI[0] = 1f;
			rotation = velocity.ToRotation();
			if (flag)
			{
				frame = Main.rand.Next(maxValue);
			}
			for (int i = 0; i < num3; i++)
			{
				Dust dust = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(24f, 24f), num, velocity * num2 * MathHelper.Lerp(0.2f, 0.7f, Main.rand.NextFloat()));
				dust.velocity += Main.rand.NextVector2Circular(0.5f, 0.5f) * num11;
				dust.velocity += rotation.ToRotationVector2() * Main.rand.NextFloat() * num12;
				dust.position += rotation.ToRotationVector2() * Main.rand.NextFloat() * num13;
				dust.scale = 0.8f + Main.rand.NextFloat() * 0.5f;
			}
			for (int j = 0; j < num4; j++)
			{
				Dust dust2 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(24f, 24f), num, Main.rand.NextVector2Circular(2f, 2f) + velocity * num2 * MathHelper.Lerp(0.2f, 0.5f, Main.rand.NextFloat()));
				dust2.velocity += Main.rand.NextVector2Circular(0.5f, 0.5f) * num11;
				dust2.scale = 0.8f + Main.rand.NextFloat() * 0.5f;
				dust2.velocity += rotation.ToRotationVector2() * Main.rand.NextFloat() * num12;
				dust2.position += rotation.ToRotationVector2() * Main.rand.NextFloat() * num13;
				dust2.fadeIn = 1f;
			}
			if (type == 961)
			{
				SoundEngine.PlaySound(SoundID.DeerclopsIceAttack, base.Center);
			}
			else if (type == 1041)
			{
				SoundEngine.PlaySound(SoundID.DeadCellsFlintWave, base.Center);
			}
			else
			{
				SoundEngine.PlaySound(SoundID.Item60, base.Center);
			}
		}
		if (flag2)
		{
			Opacity += 0.1f;
			scale = Opacity * ai[1];
			for (int k = 0; k < num5; k++)
			{
				Dust dust3 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(16f, 16f), num, velocity * num2 * MathHelper.Lerp(0.2f, 0.5f, Main.rand.NextFloat()));
				dust3.velocity += Main.rand.NextVector2Circular(0.5f, 0.5f);
				dust3.velocity *= 0.5f;
				dust3.scale = 0.8f + Main.rand.NextFloat() * 0.5f;
			}
		}
		if (flag3)
		{
			Opacity -= 0.2f;
			for (int l = 0; l < num6; l++)
			{
				Dust dust4 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(16f, 16f), num, velocity * num2 * MathHelper.Lerp(0.2f, 0.5f, Main.rand.NextFloat()));
				dust4.velocity += Main.rand.NextVector2Circular(0.5f, 0.5f);
				dust4.velocity *= 0.5f;
				dust4.scale = 0.8f + Main.rand.NextFloat() * 0.5f;
			}
		}
		if (flag4)
		{
			Kill();
		}
		if (type == 756)
		{
			Lighting.AddLight(base.Center, new Vector3(0.5f, 0.1f, 0.1f) * scale);
		}
	}

	public bool IsInRangeOfMeOrMyOwner(Entity entity, float maxDistance, out float myDistance, out float playerDistance, out bool closerIsMe)
	{
		myDistance = Vector2.Distance(entity.Center, base.Center);
		if (myDistance < maxDistance && !CanHitWithOwnBody(entity))
		{
			myDistance = float.PositiveInfinity;
		}
		playerDistance = Vector2.Distance(entity.Center, Main.player[owner].Center);
		if (playerDistance < maxDistance && !CanHitWithMeleeWeapon(entity))
		{
			playerDistance = float.PositiveInfinity;
		}
		closerIsMe = myDistance < playerDistance;
		if (closerIsMe)
		{
			return myDistance <= maxDistance;
		}
		return playerDistance <= maxDistance;
	}

	private void AI_156_BatOfLight()
	{
		List<int> ai156_blacklistedTargets = _ai156_blacklistedTargets;
		Player player = Main.player[owner];
		bool num = type == 755;
		bool flag = type == 946;
		if (num)
		{
			if (player.dead)
			{
				player.batsOfLight = false;
			}
			if (player.batsOfLight)
			{
				timeLeft = 2;
			}
			DelegateMethods.v3_1 = AI_156_GetColor().ToVector3();
			Point point = base.Center.ToTileCoordinates();
			DelegateMethods.CastLightOpen(point.X, point.Y);
			if (++frameCounter >= 6)
			{
				frameCounter = 0;
				if (++frame >= Main.projFrames[type] - 1)
				{
					frame = 0;
				}
			}
			int num2 = player.direction;
			if (velocity.X != 0f)
			{
				num2 = Math.Sign(velocity.X);
			}
			spriteDirection = num2;
		}
		if (flag)
		{
			if (player.dead)
			{
				player.empressBlade = false;
			}
			if (player.empressBlade)
			{
				timeLeft = 2;
			}
			DelegateMethods.v3_1 = AI_156_GetColor().ToVector3();
			Point point2 = base.Center.ToTileCoordinates();
			DelegateMethods.CastLightOpen(point2.X, point2.Y);
		}
		ai156_blacklistedTargets.Clear();
		AI_156_Think(ai156_blacklistedTargets);
	}

	public Color AI_156_GetColor()
	{
		if (aiStyle != 156)
		{
			return Color.Transparent;
		}
		bool num = type == 755;
		_ = type;
		if (num)
		{
			return Color.Crimson;
		}
		return Color.Transparent;
	}

	private void AI_156_Think(List<int> blacklist)
	{
		bool flag = type == 755;
		bool flag2 = type == 946;
		int num = 60;
		int num2 = num - 1;
		int num3 = num + 60;
		int num4 = num3 - 1;
		int num5 = num + 1;
		if (flag)
		{
			num = 66;
		}
		if (flag2)
		{
			num = 40;
			num2 = num - 1;
			num3 = num + 40;
			num4 = num3 - 1;
			num5 = num + 1;
		}
		Player player = Main.player[owner];
		if (player.active && Vector2.Distance(player.Center, base.Center) > 2000f)
		{
			ai[0] = 0f;
			ai[1] = 0f;
			netUpdate = true;
		}
		if (ai[0] == -1f)
		{
			AI_GetMyGroupIndexAndFillBlackList(blacklist, out var index, out var totalIndexesInGroup);
			AI_156_GetIdlePosition(index, totalIndexesInGroup, out var idleSpot, out var idleRotation);
			velocity = Vector2.Zero;
			base.Center = base.Center.MoveTowards(idleSpot, 32f);
			rotation = rotation.AngleLerp(idleRotation, 0.2f);
			if (Distance(idleSpot) < 2f)
			{
				ai[0] = 0f;
				netUpdate = true;
			}
			return;
		}
		if (ai[0] == 0f)
		{
			if (flag)
			{
				AI_GetMyGroupIndexAndFillBlackList(blacklist, out var index2, out var totalIndexesInGroup2);
				AI_156_GetIdlePosition(index2, totalIndexesInGroup2, out var idleSpot2, out var _);
				velocity = Vector2.Zero;
				base.Center = Vector2.SmoothStep(base.Center, idleSpot2, 0.45f);
				if (Main.rand.Next(20) == 0)
				{
					int num6 = AI_156_TryAttackingNPCs(blacklist);
					if (num6 != -1)
					{
						AI_156_StartAttack();
						ai[0] = num;
						ai[1] = num6;
						netUpdate = true;
						return;
					}
				}
			}
			if (!flag2)
			{
				return;
			}
			AI_GetMyGroupIndexAndFillBlackList(blacklist, out var index3, out var totalIndexesInGroup3);
			AI_156_GetIdlePosition(index3, totalIndexesInGroup3, out var idleSpot3, out var idleRotation3);
			velocity = Vector2.Zero;
			base.Center = Vector2.SmoothStep(base.Center, idleSpot3, 0.45f);
			rotation = rotation.AngleLerp(idleRotation3, 0.45f);
			if (Main.rand.Next(20) == 0)
			{
				int num7 = AI_156_TryAttackingNPCs(blacklist);
				if (num7 != -1)
				{
					AI_156_StartAttack();
					ai[0] = Main.rand.NextFromList<int>(num, num3);
					ai[0] = num3;
					ai[1] = num7;
					netUpdate = true;
				}
			}
			return;
		}
		if (flag)
		{
			int num8 = (int)ai[1];
			if (!Main.npc.IndexInRange(num8))
			{
				ai[0] = 0f;
				netUpdate = true;
				return;
			}
			NPC nPC = Main.npc[num8];
			if (!nPC.CanBeChasedBy(this))
			{
				ai[0] = 0f;
				netUpdate = true;
				return;
			}
			ai[0] -= 1f;
			if (ai[0] >= (float)num2)
			{
				velocity *= 0.8f;
				if (ai[0] == (float)num2)
				{
					localAI[0] = base.Center.X;
					localAI[1] = base.Center.Y;
				}
				return;
			}
			float lerpValue = Utils.GetLerpValue(num2, 0f, ai[0], clamped: true);
			Vector2 vector = new Vector2(localAI[0], localAI[1]);
			if (lerpValue >= 0.5f)
			{
				vector = Main.player[owner].Center;
			}
			Vector2 center = nPC.Center;
			float num9 = (center - vector).ToRotation();
			float num10 = ((center.X > vector.X) ? (-(float)Math.PI) : ((float)Math.PI));
			float num11 = num10 + (0f - num10) * lerpValue * 2f;
			Vector2 spinningpoint = num11.ToRotationVector2();
			spinningpoint.Y *= (float)Math.Sin((float)identity * 2.3f) * 0.5f;
			spinningpoint = spinningpoint.RotatedBy(num9);
			float num12 = (center - vector).Length() / 2f;
			Vector2 center2 = Vector2.Lerp(vector, center, 0.5f) + spinningpoint * num12;
			base.Center = center2;
			Vector2 vector2 = MathHelper.WrapAngle(num9 + num11 + 0f).ToRotationVector2() * 10f;
			velocity = vector2;
			position -= velocity;
			if (ai[0] == 0f)
			{
				int num13 = AI_156_TryAttackingNPCs(blacklist);
				if (num13 != -1)
				{
					ai[0] = num;
					ai[1] = num13;
					AI_156_StartAttack();
					netUpdate = true;
					return;
				}
				ai[1] = 0f;
				netUpdate = true;
			}
		}
		if (!flag2)
		{
			return;
		}
		bool skipBodyCheck = true;
		int num14 = 0;
		int num15 = num2;
		int num16 = 0;
		if (ai[0] >= (float)num5)
		{
			num14 = 1;
			num15 = num4;
			num16 = num5;
		}
		int num17 = (int)ai[1];
		if (!Main.npc.IndexInRange(num17))
		{
			int num18 = AI_156_TryAttackingNPCs(blacklist, skipBodyCheck);
			if (num18 != -1)
			{
				ai[0] = Main.rand.NextFromList<int>(num, num3);
				ai[1] = num18;
				AI_156_StartAttack();
				netUpdate = true;
			}
			else
			{
				ai[0] = -1f;
				ai[1] = 0f;
				netUpdate = true;
			}
			return;
		}
		NPC nPC2 = Main.npc[num17];
		if (!nPC2.CanBeChasedBy(this))
		{
			int num19 = AI_156_TryAttackingNPCs(blacklist, skipBodyCheck);
			if (num19 != -1)
			{
				ai[0] = Main.rand.NextFromList<int>(num, num3);
				AI_156_StartAttack();
				ai[1] = num19;
				netUpdate = true;
			}
			else
			{
				ai[0] = -1f;
				ai[1] = 0f;
				netUpdate = true;
			}
			return;
		}
		ai[0] -= 1f;
		if (ai[0] >= (float)num15)
		{
			direction = ((base.Center.X < nPC2.Center.X) ? 1 : (-1));
			if (ai[0] == (float)num15)
			{
				localAI[0] = base.Center.X;
				localAI[1] = base.Center.Y;
			}
		}
		float lerpValue2 = Utils.GetLerpValue(num15, num16, ai[0], clamped: true);
		if (num14 == 0)
		{
			Vector2 vector3 = new Vector2(localAI[0], localAI[1]);
			if (lerpValue2 >= 0.5f)
			{
				vector3 = Vector2.Lerp(nPC2.Center, Main.player[owner].Center, 0.5f);
			}
			Vector2 center3 = nPC2.Center;
			float num20 = (center3 - vector3).ToRotation();
			float num21 = ((direction == 1) ? (-(float)Math.PI) : ((float)Math.PI));
			float num22 = num21 + (0f - num21) * lerpValue2 * 2f;
			Vector2 spinningpoint2 = num22.ToRotationVector2();
			spinningpoint2.Y *= 0.5f;
			spinningpoint2.Y *= 0.8f + (float)Math.Sin((float)identity * 2.3f) * 0.2f;
			spinningpoint2 = spinningpoint2.RotatedBy(num20);
			float num23 = (center3 - vector3).Length() / 2f;
			Vector2 center4 = Vector2.Lerp(vector3, center3, 0.5f) + spinningpoint2 * num23;
			base.Center = center4;
			float num24 = MathHelper.WrapAngle(num20 + num22 + 0f);
			rotation = num24 + (float)Math.PI / 2f;
			Vector2 vector4 = num24.ToRotationVector2() * 10f;
			velocity = vector4;
			position -= velocity;
		}
		if (num14 == 1)
		{
			Vector2 vector5 = new Vector2(localAI[0], localAI[1]);
			vector5 += new Vector2(0f, Utils.GetLerpValue(0f, 0.4f, lerpValue2, clamped: true) * -100f);
			Vector2 v = nPC2.Center - vector5;
			Vector2 vector6 = v.SafeNormalize(Vector2.Zero) * MathHelper.Clamp(v.Length(), 60f, 150f);
			Vector2 value = nPC2.Center + vector6;
			float lerpValue3 = Utils.GetLerpValue(0.4f, 0.6f, lerpValue2, clamped: true);
			float lerpValue4 = Utils.GetLerpValue(0.6f, 1f, lerpValue2, clamped: true);
			float targetAngle = v.SafeNormalize(Vector2.Zero).ToRotation() + (float)Math.PI / 2f;
			rotation = rotation.AngleTowards(targetAngle, (float)Math.PI / 5f);
			base.Center = Vector2.Lerp(vector5, nPC2.Center, lerpValue3);
			if (lerpValue4 > 0f)
			{
				base.Center = Vector2.Lerp(nPC2.Center, value, lerpValue4);
			}
		}
		if (ai[0] == (float)num16)
		{
			int num25 = AI_156_TryAttackingNPCs(blacklist, skipBodyCheck);
			if (num25 != -1)
			{
				ai[0] = Main.rand.NextFromList<int>(num, num3);
				ai[1] = num25;
				AI_156_StartAttack();
				netUpdate = true;
			}
			else
			{
				ai[0] = -1f;
				ai[1] = 0f;
				netUpdate = true;
			}
		}
	}

	private void AI_156_StartAttack()
	{
		ResetLocalNPCHitImmunity();
	}

	private int AI_156_TryAttackingNPCs(List<int> blackListedTargets, bool skipBodyCheck = false)
	{
		Vector2 center = Main.player[owner].Center;
		int result = -1;
		float num = -1f;
		NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
		if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this))
		{
			bool flag = true;
			if (!ownerMinionAttackTargetNPC.boss && blackListedTargets.Contains(ownerMinionAttackTargetNPC.whoAmI))
			{
				flag = false;
			}
			if (ownerMinionAttackTargetNPC.Distance(center) > 1000f)
			{
				flag = false;
			}
			if (!skipBodyCheck && !CanHitWithOwnBody(ownerMinionAttackTargetNPC))
			{
				flag = false;
			}
			if (flag)
			{
				return ownerMinionAttackTargetNPC.whoAmI;
			}
		}
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			NPC nPC = Main.npc[i];
			if (nPC.CanBeChasedBy(this) && (nPC.boss || !blackListedTargets.Contains(i)))
			{
				float num2 = nPC.Distance(center);
				if (!(num2 > 1000f) && (!(num2 > num) || num == -1f) && (skipBodyCheck || CanHitWithOwnBody(nPC)))
				{
					num = num2;
					result = i;
				}
			}
		}
		return result;
	}

	private void AI_GetMyGroupIndexAndFillBlackList(List<int> blackListedTargets, out int index, out int totalIndexesInGroup)
	{
		index = 0;
		totalIndexesInGroup = 0;
		for (int i = 0; i < 1000; i++)
		{
			Projectile projectile = Main.projectile[i];
			if (projectile.active && projectile.owner == owner && projectile.type == type && (projectile.type != 759 || projectile.frame == Main.projFrames[projectile.type] - 1))
			{
				if (whoAmI > i)
				{
					index++;
				}
				totalIndexesInGroup++;
			}
		}
	}

	private void AI_156_GetIdlePosition(int stackedIndex, int totalIndexes, out Vector2 idleSpot, out float idleRotation)
	{
		Player player = Main.player[owner];
		bool num = type == 755;
		bool flag = type == 946;
		idleRotation = 0f;
		idleSpot = Vector2.Zero;
		if (num)
		{
			float num2 = ((float)totalIndexes - 1f) / 2f;
			idleSpot = player.Center + -Vector2.UnitY.RotatedBy(4.3982296f / (float)totalIndexes * ((float)stackedIndex - num2)) * 40f;
			idleRotation = 0f;
		}
		if (flag)
		{
			int num3 = stackedIndex + 1;
			idleRotation = (float)num3 * ((float)Math.PI * 2f) * (1f / 60f) * (float)player.direction + (float)Math.PI / 2f;
			idleRotation = MathHelper.WrapAngle(idleRotation);
			int num4 = num3 % totalIndexes;
			Vector2 vector = new Vector2(0f, 0.5f).RotatedBy((player.miscCounterNormalized * (2f + (float)num4) + (float)num4 * 0.5f + (float)player.direction * 1.3f) * ((float)Math.PI * 2f)) * 4f;
			idleSpot = idleRotation.ToRotationVector2() * 10f + player.MountedCenter + new Vector2(player.direction * (num3 * -6 - 16), player.gravDir * -15f);
			idleSpot += vector;
			idleRotation += (float)Math.PI / 2f;
		}
	}

	private void AI_155_MysticSnakeCoil()
	{
		if (Main.netMode != 1 && !Main.player[owner].active)
		{
			float num = ai[0];
			float y = position.Y;
			Point point = base.Center.ToTileCoordinates();
			Point end = new Point(point.X, (int)y / 16);
			Point start = new Point(point.X, (int)num / 16);
			AI_155_RemoveRope(start, end);
			Kill();
			return;
		}
		int num2 = 100;
		int num3 = 1800;
		if (ai[1] == 0f)
		{
			spriteDirection = ((!(Main.player[owner].Center.X > base.Center.X)) ? 1 : (-1));
			ai[1] = 1f;
			velocity.Y = -5f;
		}
		if (ai[1] == 1f)
		{
			localAI[1] += 1f;
			float num4 = Utils.Remap(localAI[1], 15f, 30f, 0f, 1f);
			int num5 = ((localAI[1] >= 60f) ? 1 : 0);
			velocity.Y = -3f * (1f - num4) + (float)(-32 * num5);
			velocity.Y = (int)velocity.Y;
			if (localAI[1] == 60f)
			{
				for (int i = 0; i < 30; i++)
				{
					Dust dust = Dust.NewDustDirect(base.TopLeft + new Vector2(-6f, 0f), 24, 16, 27, 0f, 0f, 150, Color.Transparent, 0.6f);
					dust.velocity *= 1f;
					dust.velocity.X *= 0.5f;
					dust.velocity.Y = -3f;
					dust.fadeIn = 1.2f;
					dust.noGravity = true;
					dust.position.X += Main.rand.NextFloatDirection() * 8f;
					dust.velocity = new Vector2(0f, -1f).RotatedBy((float)Math.PI / 4f * Main.rand.NextFloatDirection() * 0f) * (Main.rand.NextFloatDirection() * 9f);
					if (dust.velocity.Y < 0f)
					{
						dust.velocity.Y *= 1f + Main.rand.NextFloat() * 3f;
					}
				}
			}
			bool flag = num4 > 0f && num5 <= 0;
			if ((Main.rand.Next(6) == 0 || num5 > 0) && !flag)
			{
				Dust dust2 = Dust.NewDustDirect(base.TopLeft + new Vector2(-6f, 0f), 24, 16, 27, 0f, 0f, 150, Color.Transparent, 0.6f);
				dust2.velocity *= 1f;
				dust2.velocity.X *= 0.5f;
				dust2.velocity.Y = -3f;
				dust2.fadeIn = 1.2f;
				dust2.noGravity = true;
			}
			alpha = Utils.Clamp(alpha - 5, 0, 255);
			if (++frameCounter >= 12)
			{
				frameCounter = 0;
				if (++frame >= 4)
				{
					frame = 0;
				}
			}
			if (Main.myPlayer == owner)
			{
				float num6 = ai[0];
				float y2 = position.Y;
				Point point2 = base.Center.ToTileCoordinates();
				Point point3 = new Point(point2.X, (int)y2 / 16);
				Point point4 = new Point(point2.X, (int)num6 / 16);
				bool flag2 = point4.Y - point3.Y >= num2;
				int x = point4.X;
				if (!WorldGen.InWorld(x, point3.Y, 40) || !WorldGen.InWorld(x, point4.Y, 40))
				{
					flag2 = true;
				}
				if (!flag2)
				{
					for (int num7 = point4.Y; num7 >= point3.Y; num7--)
					{
						if (Main.tile[x, num7].active() && !Main.tileCut[Main.tile[x, num7].type] && Main.tile[x, num7].type != 504)
						{
							flag2 = true;
							break;
						}
					}
				}
				if (flag2)
				{
					int num8 = 0;
					for (int num9 = point4.Y; num9 > point3.Y; num9--)
					{
						if ((WorldGen.TileEmpty(x, num9) || Main.tileCut[Main.tile[x, num9].type]) && WorldGen.PlaceTile(x, num9, 504, mute: false, forced: false, owner))
						{
							num8++;
							if (Main.netMode == 1)
							{
								NetMessage.SendData(17, -1, -1, null, 1, x, num9, 504f);
							}
						}
					}
					timeLeft = num3;
					ai[1] = 2f;
					netUpdate = true;
					base.Top = new Vector2(x * 16 + 8, point3.Y * 16 + 16);
					velocity = Vector2.Zero;
				}
			}
		}
		if (ai[1] != 2f)
		{
			return;
		}
		alpha = 0;
		_ = timeLeft;
		float num10 = ai[0];
		float y3 = position.Y;
		Point point5 = base.Center.ToTileCoordinates();
		Point end2 = new Point(point5.X, (int)y3 / 16);
		Point start2 = new Point(point5.X, (int)num10 / 16);
		int x2 = start2.X;
		if (localAI[0] == 0f)
		{
			localAI[0] = 1f;
			for (int num11 = start2.Y; num11 >= end2.Y; num11--)
			{
				Tile tile = Main.tile[x2, num11];
				if (tile.active() && tile.type == 504)
				{
					AI_155_SpawnRopeIn(x2, num11);
				}
			}
		}
		else
		{
			for (int num12 = start2.Y; num12 >= end2.Y; num12--)
			{
				Tile tile2 = Main.tile[x2, num12];
				if (tile2.active() && tile2.type == 504 && Main.rand.Next(80) == 0)
				{
					Dust dust3 = Dust.NewDustDirect(new Vector2(x2 * 16 - 6, num12 * 16), 28, 16, 27, 0f, 0f, 150, Color.Transparent, 0.6f);
					dust3.velocity *= 1f;
					dust3.velocity.X = 0f;
					dust3.fadeIn = 1.2f;
					dust3.noGravity = true;
				}
			}
		}
		if (timeLeft == 4)
		{
			for (int num13 = start2.Y; num13 >= end2.Y; num13--)
			{
				Tile tile3 = Main.tile[x2, num13];
				if (tile3.active() && tile3.type == 504)
				{
					AI_155_SpawnRopeIn(x2, num13);
				}
			}
		}
		if (timeLeft > 4)
		{
			return;
		}
		if (!WorldGen.InWorld(x2, end2.Y, 20) || !WorldGen.InWorld(x2, start2.Y, 20))
		{
			Kill();
			return;
		}
		if (Main.myPlayer == owner)
		{
			AI_155_RemoveRope(start2, end2);
		}
		Kill();
	}

	private void AI_155_RemoveRope(Point start, Point end)
	{
		int x = start.X;
		for (int num = start.Y; num >= end.Y; num--)
		{
			Tile tile = Main.tile[x, num];
			if (tile.active() && tile.type == 504)
			{
				WorldGen.KillTile(x, num);
				if (Main.netMode != 0)
				{
					NetMessage.SendData(17, -1, -1, null, 0, x, num);
				}
			}
		}
	}

	private void AI_155_SpawnRopeIn(int x, int y)
	{
		Vector2 vector = new Vector2(x * 16 + 8, y * 16 + 8);
		if (Main.rand.Next(4) != 0)
		{
			Gore gore = Gore.NewGoreDirect(vector, Vector2.Zero, Main.rand.Next(61, 64));
			gore.velocity = Main.rand.NextVector2Circular(1.5f, 0.8f);
			gore.velocity.X += 0.1f * (float)((gore.velocity.X > 0f) ? 1 : (-1));
			gore.position = vector - new Vector2(16f, 16f);
			gore.alpha = 170;
		}
		for (int i = 0; i < 5; i++)
		{
			if (Main.rand.Next(8) == 0)
			{
				Dust.NewDustDirect(vector + new Vector2(-8f), 16, 16, 31, 0f, 0f, 100, Color.Transparent).velocity *= 0.4f;
			}
			Dust dust = Dust.NewDustDirect(vector + new Vector2(-8f), 16, 16, 27, 0f, 0f, 100, Color.Transparent, 1.7f);
			dust.velocity *= 2f;
			dust.noGravity = true;
		}
	}

	private void AI_154_VoidLens()
	{
		Main.CurrentFrameFlags.HadAnActiveInteractibleProjectile = true;
		if (owner == Main.myPlayer)
		{
			for (int i = 0; i < 1000; i++)
			{
				if (i == whoAmI)
				{
					continue;
				}
				Projectile projectile = Main.projectile[i];
				if (projectile.active && projectile.owner == owner && projectile.type == type)
				{
					if (timeLeft < Main.projectile[i].timeLeft)
					{
						Kill();
						return;
					}
					Main.projectile[i].Kill();
				}
			}
		}
		velocity *= 0.94f;
		direction = 1;
		if (++frameCounter >= 5)
		{
			frameCounter = 0;
			if (++frame >= Main.projFrames[type])
			{
				frame = 0;
			}
		}
		if (Opacity < 1f)
		{
			Opacity += 0.03f;
			if (Opacity > 1f)
			{
				Opacity = 1f;
			}
		}
		new VoidLensHelper(this).Update();
	}

	private void AI_153_ToiletPop()
	{
		Vector2 center = base.Center;
		float speedY = -2f;
		int num = 0;
		int num2 = 0;
		if (ai[0] == 0f)
		{
			num = 6;
			num2 = 1;
		}
		else
		{
			if (!(ai[0] <= 10f))
			{
				Kill();
				return;
			}
			if (Main.rand.Next(5) == 0)
			{
				num2 = 1;
			}
			num = 2;
		}
		ai[0] += 1f;
		for (int i = 0; i < num; i++)
		{
			Dust dust = Dust.NewDustDirect(center, 3, 6, 216, 0f, speedY);
			dust.velocity.X *= 0.5f;
			dust.velocity.Y = 0f - Math.Abs(dust.velocity.Y);
			dust.position -= dust.velocity;
			dust.scale = 0.8f;
		}
		for (int j = 0; j < num2; j++)
		{
			Gore gore = Gore.NewGoreDirect(center, Vector2.UnitY * -3f + Main.rand.NextVector2Circular(1f, 1f), Main.rand.Next(580, 583));
			gore.velocity.Y = 0f - Math.Abs(gore.velocity.Y);
		}
	}

	private void AI_198_Flint()
	{
		Player player = Main.player[owner];
		if (!player.active)
		{
			Kill();
			return;
		}
		if (!player.channel && ai[0] == 0f)
		{
			bool flag = ai[1] >= 30f;
			ai[0] = 1f;
			ai[1] = 0f;
			netUpdate = true;
			if (owner == Main.myPlayer)
			{
				int num = (int)((float)damage * 1.78f);
				NewProjectile(GetProjectileSource_FromThis(), player.MountedCenter, new Vector2(direction, 0f), 1043, num, knockBack, owner, (float)direction * player.gravDir, 6f, 1f);
				if (flag)
				{
					AI_198_Flint_EmitSpikes(player.MountedCenter, direction);
				}
			}
		}
		if (ai[0] == 1f)
		{
			ai[1] += 1f;
			float num2 = player.HeldItem.useAnimation;
			if (ai[1] >= num2)
			{
				Kill();
				return;
			}
			velocity = Vector2.Zero;
			player.ChangeDir(direction);
			player.heldProj = whoAmI;
			int num3 = (int)Utils.Remap(ai[1], 0f, 5f, player.HeldItem.useAnimation, 0f);
			if (num3 < 2)
			{
				num3 = 2;
			}
			player.SetDummyItemTime(num3);
		}
		if (ai[0] == 0f)
		{
			velocity = Vector2.Zero;
			if (owner == Main.myPlayer)
			{
				direction = (((Main.ReverseGravitySupport(Main.MouseScreen) + Main.screenPosition - player.MountedCenter).X >= 0f) ? 1 : (-1));
				player.ChangeDir(direction);
			}
			direction = player.direction;
			player.heldProj = whoAmI;
			int useAnimation = player.HeldItem.useAnimation;
			int num4 = 3;
			ai[1] += 1f;
			float num5 = ai[1];
			if (num5 > (float)num4)
			{
				num5 = num4;
			}
			int num6 = useAnimation + (int)num5;
			if (num6 < 2)
			{
				num6 = 2;
			}
			if (ai[1] == 30f)
			{
				SoundEngine.PlaySound(SoundID.DeadCellsFlintCharge, player.Center);
			}
			player.itemAnimationMax = useAnimation;
			player.SetDummyItemTime(num6);
			player.itemLocation.Y += Main.rand.Next(2);
			if (Main.rand.Next(10) == 0)
			{
				Dust.NewDustPerfect(player.itemLocation + new Vector2(41 * player.direction, -41f * player.gravDir).RotatedBy(player.itemRotation) + Main.rand.NextVector2Circular(12f, 12f), 228, new Vector2(0f, Main.rand.NextFloat() * -8f - 2f), 127, new Color(255, 180, 0, 0), 1.3f + Main.rand.NextFloat()).noGravity = true;
			}
		}
	}

	private void AI_198_Flint_EmitSpikes(Vector2 startPosition, int direction)
	{
		Player obj = Main.player[owner];
		startPosition += new Vector2(direction * 30, 0f);
		Point p = startPosition.ToTileCoordinates();
		ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.DeadCellsFlint, new ParticleOrchestraSettings
		{
			PositionInWorld = startPosition + new Vector2(16f, 16f) * Main.player[owner].Directions,
			UniqueInfoPiece = 0,
			MovementVector = new Vector2(32f, Main.player[owner].gravDir)
		});
		bool flag = obj.gravDir == -1f;
		int num = 12;
		int num2 = 2;
		int num3 = 0;
		while (num3 <= num)
		{
			if (flag)
			{
				FindBlockCeiling(p.X, ref p.Y, 10, 10);
			}
			else
			{
				FindBlockSurface(p.X, ref p.Y, 10, 10);
			}
			if (WorldGen.ActiveAndWalkableTile(p.X, p.Y))
			{
				Vector2 vector = p.ToWorldCoordinates(8f, 0f);
				Vector2 spinningpoint = new Vector2(direction, -10f);
				float ai = 1f + (float)num3 * 0.04f + Main.rand.NextFloat() * 0.2f;
				if (flag)
				{
					vector += new Vector2(0f, 16f);
					spinningpoint.Y *= -1f;
				}
				NewProjectile(GetProjectileSource_FromThis(), vector, spinningpoint.RotatedBy(Main.rand.NextFloatDirection() * ((float)Math.PI * 2f) * 0.025f), 1041, damage, knockBack, owner, -(num3 * 2), ai);
				num3++;
				p.X += direction * num2;
				continue;
			}
			break;
		}
	}

	private void FindBlockSurface(int x, ref int y, int downMax, int upmax)
	{
		for (int i = 0; i < downMax; i++)
		{
			if (y < 10)
			{
				break;
			}
			if (!WorldGen.SolidTile(x, y))
			{
				break;
			}
			y--;
		}
		for (int j = 0; j < upmax; j++)
		{
			if (y > Main.maxTilesY - 10)
			{
				break;
			}
			if (WorldGen.ActiveAndWalkableTile(x, y))
			{
				break;
			}
			y++;
		}
	}

	private void FindBlockCeiling(int x, ref int y, int upMax, int downMax)
	{
		for (int i = 0; i < upMax; i++)
		{
			if (y > Main.maxTilesY - 10)
			{
				break;
			}
			if (!WorldGen.SolidTile(x, y))
			{
				break;
			}
			y++;
		}
		for (int j = 0; j < downMax; j++)
		{
			if (y < 10)
			{
				break;
			}
			if (WorldGen.ActiveAndWalkableTile(x, y))
			{
				break;
			}
			y--;
		}
	}

	private void AI_150_GolfClubHelper()
	{
		Player player = Main.player[owner];
		if (!player.active)
		{
			Kill();
			return;
		}
		if (player.gravDir == -1f)
		{
			player.SetDummyItemTime(0);
			Kill();
			return;
		}
		bool flag = false;
		Rectangle rectangle = Utils.CenteredRectangle(player.Center, new Vector2(500f, 500f));
		for (int i = 0; i < 1000; i++)
		{
			Projectile projectile = Main.projectile[i];
			if (projectile.active && projectile.owner == Main.myPlayer && ProjectileID.Sets.IsAGolfBall[projectile.type] && rectangle.Contains(projectile.Center.ToPoint()))
			{
				flag = true;
				break;
			}
		}
		if (!flag && owner == Main.myPlayer && ai[0] == 0f)
		{
			player.TryPlacingAGolfBallNearANearbyTee(Main.player[owner].Center);
		}
		if (!player.channel && ai[0] == 0f)
		{
			SoundEngine.PlaySound(SoundID.Item1, player.Center);
			for (int j = 0; j < 1000; j++)
			{
				Projectile projectile2 = Main.projectile[j];
				Vector2 shotVector = Main.MouseWorld - projectile2.Center;
				if (!projectile2.active || !ProjectileID.Sets.IsAGolfBall[projectile2.type] || projectile2.owner != owner || !GolfHelper.ValidateShot(projectile2, player, ref shotVector))
				{
					continue;
				}
				float num = Main.rand.NextFloatDirection();
				for (float num2 = 0f; num2 < 1f; num2 += 0.1f)
				{
					Dust dust = Dust.NewDustPerfect(projectile2.Center, 31, ((float)Math.PI * 2f * num2 + num).ToRotationVector2() * 0.8f, 127);
					dust.fadeIn = 0f;
					if (num2 % 0.2f == 0f)
					{
						dust.velocity *= 0.4f;
					}
				}
				SoundEngine.PlaySound(SoundID.Item126, projectile2.Center);
				if (owner == Main.myPlayer)
				{
					GolfHelper.ShotStrength shotStrength = GolfHelper.CalculateShotStrength(this, projectile2);
					Vector2 vector = Vector2.Normalize(shotVector) * shotStrength.AbsoluteStrength;
					GolfHelper.HitGolfBall(projectile2, vector, shotStrength.RoughLandResistance);
					NetMessage.SendData(27, -1, -1, null, j);
				}
			}
			ai[0] = 1f;
			ai[1] = 0f;
			netUpdate = true;
		}
		if (ai[0] == 1f)
		{
			ai[1] += 1f;
			float num3 = player.HeldItem.useAnimation + 30;
			if (ai[1] >= num3)
			{
				Kill();
				return;
			}
			velocity = Vector2.Zero;
			player.ChangeDir(direction);
			player.heldProj = whoAmI;
			int num4 = player.HeldItem.useAnimation - (int)ai[1];
			if (num4 < 2)
			{
				num4 = 2;
			}
			player.SetDummyItemTime(num4);
		}
		if (ai[0] != 0f)
		{
			return;
		}
		if (owner == Main.myPlayer)
		{
			Vector2 mouseWorld = Main.MouseWorld;
			if (mouseWorld != base.Center)
			{
				netUpdate = true;
				base.Center = mouseWorld;
			}
			if (Main.mouseRight && Main.mouseRightRelease)
			{
				Kill();
				player.mouseInterface = true;
				Main.blockMouse = true;
				player.SetItemTime(0);
				player.itemAnimation = 0;
				player.itemAnimationMax = 0;
				player.reuseDelay = 0;
				return;
			}
		}
		if (position != oldPosition)
		{
			if (base.Center.X - player.Center.X > 0f)
			{
				direction = 1;
			}
			else
			{
				direction = -1;
			}
		}
		velocity = Vector2.Zero;
		player.ChangeDir(direction);
		player.heldProj = whoAmI;
		ai[1] += 1f;
		int num5 = player.HeldItem.useAnimation * 4;
		if (ai[1] > (float)(num5 * 3))
		{
			ai[1] = num5;
		}
		int num6 = player.HeldItem.useAnimation + Math.Min(num5, (int)ai[1]);
		if (num6 < 2)
		{
			num6 = 2;
		}
		player.SetDummyItemTime(num6);
	}

	public Color GetCeleb2Color()
	{
		return (int)ai[0] switch
		{
			0 => Color.Red, 
			1 => Color.DarkOrange, 
			2 => Color.Gold, 
			3 => Color.LimeGreen, 
			4 => Color.RoyalBlue, 
			5 => new Color(80, 20, 180), 
			6 => Color.HotPink, 
			_ => Color.Transparent, 
		};
	}

	private void AI_007_GrapplingHooks()
	{
		if (Main.player[owner].dead || Main.player[owner].stoned || Main.player[owner].webbed || Main.player[owner].frozen)
		{
			Kill();
			return;
		}
		Vector2 mountedCenter = Main.player[owner].MountedCenter;
		Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
		float num = mountedCenter.X - vector.X;
		float num2 = mountedCenter.Y - vector.Y;
		float num3 = (float)Math.Sqrt(num * num + num2 * num2);
		rotation = (float)Math.Atan2(num2, num) - 1.57f;
		if (ai[0] == 2f && type == 865)
		{
			float num4 = (float)Math.PI / 2f;
			int num5 = (int)Math.Round(rotation / num4);
			rotation = (float)num5 * num4;
		}
		if (Main.myPlayer == owner)
		{
			int num6 = (int)(base.Center.X / 16f);
			int num7 = (int)(base.Center.Y / 16f);
			if (num6 > 0 && num7 > 0 && num6 < Main.maxTilesX && num7 < Main.maxTilesY && Main.tile[num6, num7].nactive() && TileID.Sets.CrackedBricks[Main.tile[num6, num7].type] && Main.rand.Next(16) == 0)
			{
				WorldGen.KillTile(num6, num7);
				if (Main.netMode != 0)
				{
					NetMessage.SendData(17, -1, -1, null, 20, num6, num7);
				}
			}
		}
		if (num3 > 2500f)
		{
			Kill();
		}
		if (type == 256)
		{
			rotation = (float)Math.Atan2(num2, num) + 3.9250002f;
		}
		if (type == 446)
		{
			Lighting.AddLight(mountedCenter, 0f, 0.4f, 0.3f);
			localAI[0] += 1f;
			if (localAI[0] >= 28f)
			{
				localAI[0] = 0f;
			}
			DelegateMethods.v3_1 = new Vector3(0f, 0.4f, 0.3f);
			Utils.PlotTileLine(base.Center, mountedCenter, 8f, DelegateMethods.CastLightOpen);
		}
		if (type == 652 && ++frameCounter >= 7)
		{
			frameCounter = 0;
			if (++frame >= Main.projFrames[type])
			{
				frame = 0;
			}
		}
		if (type >= 646 && type <= 649)
		{
			Vector3 vector2 = Vector3.Zero;
			switch (type)
			{
			case 646:
				vector2 = new Vector3(0.7f, 0.5f, 0.1f);
				break;
			case 647:
				vector2 = new Vector3(0f, 0.6f, 0.7f);
				break;
			case 648:
				vector2 = new Vector3(0.6f, 0.2f, 0.6f);
				break;
			case 649:
				vector2 = new Vector3(0.6f, 0.6f, 0.9f);
				break;
			}
			Lighting.AddLight(mountedCenter, vector2);
			Lighting.AddLight(base.Center, vector2);
			DelegateMethods.v3_1 = vector2;
			Utils.PlotTileLine(base.Center, mountedCenter, 8f, DelegateMethods.CastLightOpen);
		}
		if (ai[0] == 0f)
		{
			if ((num3 > 300f && type == 13) || (num3 > 400f && type == 32) || (num3 > 440f && type == 73) || (num3 > 440f && type == 74) || (num3 > 375f && type == 165) || (num3 > 425f && type == 256) || (num3 > 500f && type == 315) || (num3 > 550f && type == 322) || (num3 > 400f && type == 331) || (num3 > 550f && type == 332) || (num3 > 400f && type == 372) || (num3 > 300f && type == 396) || (num3 > 550f && type >= 646 && type <= 649) || (num3 > 600f && type == 652) || (num3 > 300f && type == 865) || (num3 > 500f && type == 935) || (num3 > 480f && type >= 486 && type <= 489) || (num3 > 500f && type == 446))
			{
				ai[0] = 1f;
			}
			else if (type >= 230 && type <= 235)
			{
				int num8 = 300 + (type - 230) * 30;
				if (num3 > (float)num8)
				{
					ai[0] = 1f;
				}
			}
			else if (type == 753)
			{
				int num9 = 420;
				if (num3 > (float)num9)
				{
					ai[0] = 1f;
				}
			}
			Vector2 vector3 = base.Center - new Vector2(5f);
			Vector2 vector4 = base.Center + new Vector2(5f);
			Point point = (vector3 - new Vector2(16f)).ToTileCoordinates();
			Point point2 = (vector4 + new Vector2(32f)).ToTileCoordinates();
			int num10 = point.X;
			int num11 = point2.X;
			int num12 = point.Y;
			int num13 = point2.Y;
			if (num10 < 0)
			{
				num10 = 0;
			}
			if (num11 > Main.maxTilesX)
			{
				num11 = Main.maxTilesX;
			}
			if (num12 < 0)
			{
				num12 = 0;
			}
			if (num13 > Main.maxTilesY)
			{
				num13 = Main.maxTilesY;
			}
			_ = Main.player[owner];
			Vector2 vector5 = default(Vector2);
			for (int i = num10; i < num11; i++)
			{
				for (int j = num12; j < num13; j++)
				{
					if (Main.tile[i, j] == null)
					{
						Main.tile[i, j] = new Tile();
					}
					vector5.X = i * 16;
					vector5.Y = j * 16;
					if (!(vector3.X + 10f > vector5.X) || !(vector3.X < vector5.X + 16f) || !(vector3.Y + 10f > vector5.Y) || !(vector3.Y < vector5.Y + 16f))
					{
						continue;
					}
					Tile theTile = Main.tile[i, j];
					if (!AI_007_GrapplingHooks_CanTileBeLatchedOnTo(theTile) || Main.player[owner].IsBlacklistedForGrappling(new Point(i, j)))
					{
						continue;
					}
					if (Main.player[owner].grapCount < 10)
					{
						Main.player[owner].grappling[Main.player[owner].grapCount] = whoAmI;
						Main.player[owner].grapCount++;
					}
					if (Main.myPlayer != owner)
					{
						continue;
					}
					int num14 = 0;
					int num15 = -1;
					int num16 = 100000;
					int num17 = 3;
					if (type == 165)
					{
						num17 = 8;
					}
					if (type == 256)
					{
						num17 = 2;
					}
					if (type == 372)
					{
						num17 = 2;
					}
					if (type == 652)
					{
						num17 = 1;
					}
					if (type == 73 || type == 74)
					{
						num17 = 1;
					}
					if (type >= 646 && type <= 649)
					{
						num17 = 4;
					}
					for (int k = 0; k < 1000; k++)
					{
						if (Main.projectile[k].active && Main.projectile[k].owner == owner && ((Main.projectile[k].aiStyle == 7 && Main.projectile[k].ai[0] == 2f) || k == whoAmI))
						{
							if (Main.projectile[k].timeLeft < num16)
							{
								num15 = k;
								num16 = Main.projectile[k].timeLeft;
							}
							num14++;
						}
					}
					if (num14 > num17)
					{
						Main.projectile[num15].Kill();
					}
					WorldGen.KillTile(i, j, fail: true, effectOnly: true);
					SoundEngine.PlaySound(0, i * 16, j * 16);
					velocity.X = 0f;
					velocity.Y = 0f;
					ai[0] = 2f;
					position.X = i * 16 + 8 - width / 2;
					position.Y = j * 16 + 8 - height / 2;
					Rectangle? tileVisualHitbox = WorldGen.GetTileVisualHitbox(i, j);
					if (tileVisualHitbox.HasValue)
					{
						base.Center = tileVisualHitbox.Value.Center.ToVector2();
					}
					damage = 0;
					netUpdate = true;
					if (Main.myPlayer == owner)
					{
						Main.player[owner].UpdateBlacklistedTilesForGrappling();
						if (type == 935)
						{
							Main.player[owner].DoQueenSlimeHookTeleport(base.Center);
						}
						NetMessage.SendData(13, -1, -1, null, owner);
					}
					break;
				}
				if (ai[0] == 2f)
				{
					break;
				}
			}
		}
		else if (ai[0] == 1f)
		{
			float num18 = 11f;
			if (type == 32)
			{
				num18 = 15f;
			}
			if (type == 73 || type == 74)
			{
				num18 = 17f;
			}
			if (type == 315)
			{
				num18 = 20f;
			}
			if (type == 322)
			{
				num18 = 22f;
			}
			if (type >= 230 && type <= 235)
			{
				num18 = 11f + (float)(type - 230) * 0.75f;
			}
			if (type == 753)
			{
				num18 = 15f;
			}
			if (type == 446)
			{
				num18 = 20f;
			}
			if (type >= 486 && type <= 489)
			{
				num18 = 18f;
			}
			if (type >= 646 && type <= 649)
			{
				num18 = 24f;
			}
			if (type == 652)
			{
				num18 = 24f;
			}
			if (type == 332)
			{
				num18 = 17f;
			}
			if (num3 < 24f)
			{
				Kill();
			}
			num3 = num18 / num3;
			num *= num3;
			num2 *= num3;
			velocity.X = num;
			velocity.Y = num2;
		}
		else if (ai[0] == 2f)
		{
			Point point3 = base.Center.ToTileCoordinates();
			if (Main.tile[point3.X, point3.Y] == null)
			{
				Main.tile[point3.X, point3.Y] = new Tile();
			}
			bool flag = true;
			if (AI_007_GrapplingHooks_CanTileBeLatchedOnTo(Main.tile[point3.X, point3.Y]))
			{
				flag = false;
			}
			if (flag)
			{
				ai[0] = 1f;
			}
			else if (Main.player[owner].grapCount < 10)
			{
				Main.player[owner].grappling[Main.player[owner].grapCount] = whoAmI;
				Main.player[owner].grapCount++;
			}
		}
	}

	private bool AI_007_GrapplingHooks_CanTileBeLatchedOnTo(Tile theTile)
	{
		if (!theTile.nactive())
		{
			return false;
		}
		if (type == 403 && theTile.type != 314)
		{
			return false;
		}
		return Main.tileSolid[theTile.type] | (theTile.type == 314) | (type == 865 && TileID.Sets.IsATreeTrunk[theTile.type]) | (type == 865 && theTile.type == 323);
	}

	private void AI_147_Celeb2Rocket()
	{
		int num = 0;
		int num2 = 1;
		int num3 = 1;
		localAI[num] += 1f;
		alpha = 0;
		rotation = velocity.ToRotation() + (float)Math.PI / 2f;
		int num4 = (int)ai[0];
		Lighting.AddLight(base.Center, GetCeleb2Color().ToVector3() * 0.5f);
		switch (num4)
		{
		case 0:
			if (localAI[num] >= 20f)
			{
				velocity.Y += 0.12f;
				penetrate = (maxPenetrate = -1);
			}
			if (velocity.Y > 16f)
			{
				velocity.Y = 16f;
			}
			if (localAI[num] > 20f && localAI[num] % 20f == 0f)
			{
				AI_147_Explosion();
			}
			break;
		case 1:
		{
			if (localAI[num] == 10f)
			{
				velocity.Y -= 10f;
			}
			if (localAI[num] >= 10f)
			{
				velocity.Y += 0.25f;
			}
			if (velocity.Y > 16f)
			{
				velocity.Y = 16f;
			}
			if (!(localAI[num] >= 10f))
			{
				break;
			}
			scale += 0.015f;
			if (scale > 2.5f)
			{
				scale = 2.5f;
			}
			if (localAI[num] % 10f != 0f)
			{
				break;
			}
			_ = velocity.Y;
			_ = 0f;
			for (float num5 = 0f; num5 < 1f; num5 += 0.12f)
			{
				Vector2 spinningpoint = Vector2.UnitX * -8f;
				spinningpoint += -Vector2.UnitY.RotatedBy(num5 * ((float)Math.PI * 2f)) * new Vector2(2f, 4f);
				spinningpoint = spinningpoint.RotatedBy(rotation - (float)Math.PI / 2f);
				int num6 = Dust.NewDust(base.Center, 0, 0, 267, 0f, 0f, 0, Color.Lerp(GetCeleb2Color(), Color.White, Main.rand.NextFloat() * 0.3f));
				Main.dust[num6].scale = 0.9f;
				Main.dust[num6].fadeIn = 1.1f;
				Main.dust[num6].noGravity = true;
				Main.dust[num6].position = base.Center + spinningpoint;
				Main.dust[num6].velocity = -velocity * 0.35f + spinningpoint * 0.35f;
				Main.dust[num6].velocity *= scale;
				if (localAI[num] == 10f)
				{
					Main.dust[num6].velocity = spinningpoint.RotatedBy(velocity.ToRotation()) * 0.3f;
				}
			}
			break;
		}
		case 2:
			if (localAI[num] >= 60f)
			{
				velocity.Y += 0.15f;
			}
			if (velocity.Y > 16f)
			{
				velocity.Y = 16f;
			}
			break;
		case 3:
		{
			float num7 = localAI[num2];
			if (num7 == 0f)
			{
				float num8 = velocity.Length();
				localAI[num2] = num8;
				num7 = num8;
			}
			if (localAI[num] >= 25f && ai[num3] == 0f)
			{
				if (localAI[num] >= 20f)
				{
					velocity.Y += 0.15f;
				}
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
			}
			if (!(localAI[num] >= 20f))
			{
				break;
			}
			float num9 = position.X;
			float num10 = position.Y;
			float num11 = 800f;
			bool flag = false;
			int num12 = 0;
			if (ai[num3] == 0f)
			{
				for (int i = 0; i < Main.maxNPCs; i++)
				{
					if (Main.npc[i].CanBeChasedBy(this) && (ai[num3] == 0f || ai[num3] == (float)(i + 1)))
					{
						float num13 = Main.npc[i].position.X + (float)(Main.npc[i].width / 2);
						float num14 = Main.npc[i].position.Y + (float)(Main.npc[i].height / 2);
						float num15 = Math.Abs(position.X + (float)(width / 2) - num13) + Math.Abs(position.Y + (float)(height / 2) - num14);
						if (num15 < num11 && Collision.CanHit(new Vector2(position.X + (float)(width / 2), position.Y + (float)(height / 2)), 1, 1, Main.npc[i].position, Main.npc[i].width, Main.npc[i].height))
						{
							num11 = num15;
							num9 = num13;
							num10 = num14;
							flag = true;
							num12 = i;
						}
					}
				}
				if (flag)
				{
					ai[1] = num12 + 1;
				}
				flag = false;
			}
			if (ai[num3] != 0f)
			{
				int num16 = (int)(ai[num3] - 1f);
				if (Main.npc[num16].active && Main.npc[num16].CanBeChasedBy(this, ignoreDontTakeDamage: true))
				{
					float num17 = Main.npc[num16].position.X + (float)(Main.npc[num16].width / 2);
					float num18 = Main.npc[num16].position.Y + (float)(Main.npc[num16].height / 2);
					if (Math.Abs(position.X + (float)(width / 2) - num17) + Math.Abs(position.Y + (float)(height / 2) - num18) < 1000f)
					{
						flag = true;
						num9 = Main.npc[num16].position.X + (float)(Main.npc[num16].width / 2);
						num10 = Main.npc[num16].position.Y + (float)(Main.npc[num16].height / 2);
					}
				}
			}
			if (!friendly)
			{
				flag = false;
			}
			if (flag)
			{
				float num19 = num7;
				Vector2 vector2 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num20 = num9 - vector2.X;
				float num21 = num10 - vector2.Y;
				float num22 = (float)Math.Sqrt(num20 * num20 + num21 * num21);
				num22 = num19 / num22;
				num20 *= num22;
				num21 *= num22;
				int num23 = 8;
				velocity.X = (velocity.X * (float)(num23 - 1) + num20) / (float)num23;
				velocity.Y = (velocity.Y * (float)(num23 - 1) + num21) / (float)num23;
			}
			break;
		}
		case 4:
		{
			if (localAI[num] == 1f && ai[1] == 1f)
			{
				localAI[num] += 45f;
			}
			float x = velocity.SafeNormalize(Vector2.Zero).RotatedBy(localAI[num] * ((float)Math.PI / 45f)).X;
			Vector2 vector = velocity.SafeNormalize(Vector2.Zero).RotatedBy(1.5707963705062866);
			position += vector * x * 3f;
			scale = 2f;
			if (localAI[num] >= 10f)
			{
				velocity.Y += 0.04f;
			}
			if (velocity.Y > 16f)
			{
				velocity.Y = 16f;
			}
			break;
		}
		case 5:
			if (localAI[num] >= 40f)
			{
				velocity.Y += 0.08f;
			}
			if (velocity.Y > 16f)
			{
				velocity.Y = 16f;
			}
			break;
		case 6:
			if (localAI[num] >= 30f)
			{
				velocity.Y += 0.1f;
			}
			if (velocity.Y > 16f)
			{
				velocity.Y = 16f;
			}
			break;
		}
	}

	private void AI_148_StarSpawner()
	{
		if (Main.dayTime && !Main.remixWorld)
		{
			Kill();
			return;
		}
		ai[0] += Main.dayRate;
		if (localAI[0] == 0f && Main.netMode != 2)
		{
			localAI[0] = 1f;
			if ((double)Main.LocalPlayer.position.Y < Main.worldSurface * 16.0)
			{
				Star.StarFall(position.X);
			}
		}
		if (owner != Main.myPlayer || !(ai[0] >= 180f))
		{
			return;
		}
		if (ai[1] > -1f)
		{
			velocity.X *= 0.35f;
			if (base.Center.X < Main.player[(int)ai[1]].Center.X)
			{
				velocity.X = Math.Abs(velocity.X);
			}
			else
			{
				velocity.X = 0f - Math.Abs(velocity.X);
			}
		}
		NewProjectile(GetProjectileSource_FromThis(), position.X, position.Y, velocity.X, velocity.Y, 12, 1000, 10f, Main.myPlayer);
		Kill();
	}

	private void AI_147_Explosion()
	{
		switch ((int)ai[0])
		{
		case 0:
		{
			for (int k = 0; k < 4; k++)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
			}
			for (int l = 0; l < 20; l++)
			{
				int num5 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 130, 0f, 0f, 200, default(Color), 1.2f);
				Main.dust[num5].noGravity = true;
				Main.dust[num5].velocity *= 3f;
				num5 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 130, 0f, 0f, 200, default(Color), 0.5f);
				Main.dust[num5].velocity *= 1.2f;
				Main.dust[num5].noGravity = true;
			}
			for (int m = 0; m < 1; m++)
			{
				int num6 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Main.gore[num6].velocity *= 0.3f;
				Main.gore[num6].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num6].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
			break;
		}
		case 1:
		{
			Color celeb2Color2 = GetCeleb2Color();
			Vector2 center2 = base.Center;
			Main.rand.NextFloat();
			for (float num7 = 0f; num7 < 1f; num7 += 0.0125f)
			{
				Dust dust4 = Dust.NewDustPerfect(center2, 278, null, 200, Color.Lerp(celeb2Color2, Color.White, Main.rand.NextFloat() * 0.6f));
				dust4.scale = 1.1f;
				dust4.fadeIn = 1.3f;
				dust4.velocity *= Main.rand.NextFloat() * 2f + 2f;
				if (dust4.velocity.Y > 0f)
				{
					dust4.velocity *= 0.3f;
				}
				dust4.velocity *= 2f;
			}
			for (int n = 0; n < 3; n++)
			{
				int num8 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Main.gore[num8].velocity *= 0.3f;
				Main.gore[num8].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num8].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
			int fluff = 20;
			int distFluff = 100;
			int layerStart = 2;
			int layerEnd = 10;
			int layerJump = 2;
			CreateGroundExplosion(40f, fluff, distFluff, layerStart, layerEnd, layerJump);
			break;
		}
		case 2:
		{
			Vector2 center3 = base.Center;
			Color celeb2Color3 = GetCeleb2Color();
			float num9 = 0.05f;
			float num10 = 0.13f;
			bool flag = Main.rand.Next(4) == 0;
			if (flag)
			{
				num9 = 0.1f;
				num10 = 0.1f;
			}
			float num11 = Main.rand.NextFloatDirection();
			for (float num12 = 0f; num12 < 5f; num12 += 1f)
			{
				Vector2 spinningpoint = new Vector2(0f, -100f);
				Vector2 vector4 = center3 + spinningpoint.RotatedBy(num11 + num12 * ((float)Math.PI * 2f / 5f));
				Vector2 vector5 = center3 + spinningpoint.RotatedBy(num11 + (num12 + 1f) * ((float)Math.PI * 2f / 5f));
				Vector2 vector6 = center3 + spinningpoint.RotatedBy(num11 + (num12 + 0.5f) * ((float)Math.PI * 2f / 5f)) * 0.4f;
				for (int num13 = 0; num13 < 2; num13++)
				{
					Vector2 value = vector4;
					Vector2 value2 = vector6;
					if (num13 == 1)
					{
						value = vector6;
						value2 = vector5;
					}
					for (float num14 = 0f; num14 < 1f; num14 += num10)
					{
						Vector2 vector7 = Vector2.Lerp(value, value2, num14);
						Vector2 vector8 = Vector2.Lerp(vector7, center3, 0.9f);
						Vector2 vector9 = (vector7 - vector8).SafeNormalize(Vector2.Zero);
						Dust dust5 = Dust.NewDustPerfect(vector8, 267, Vector2.Zero, 0, celeb2Color3, 0.5f);
						dust5.fadeIn = 1.2f;
						dust5.noGravity = true;
						dust5.velocity = vector9 * Vector2.Distance(vector7, vector8) * num9;
					}
				}
			}
			if (flag)
			{
				for (int num15 = 0; num15 < 4; num15++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				}
				for (int num16 = 0; num16 < 60; num16++)
				{
					int num17 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 228, 0f, 0f, 200, default(Color), 2.5f);
					Main.dust[num17].noGravity = true;
					Main.dust[num17].velocity *= 8f;
					num17 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 228, 0f, 0f, 200, default(Color), 1.5f);
					Main.dust[num17].velocity *= 4.2f;
					Main.dust[num17].noGravity = true;
				}
				for (int num18 = 0; num18 < 1; num18++)
				{
					int num19 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num19].velocity *= 0.3f;
					Main.gore[num19].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num19].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
			}
			else
			{
				for (int num20 = 0; num20 < 4; num20++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				}
				for (int num21 = 0; num21 < 40; num21++)
				{
					int num22 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 228, 0f, 0f, 200, default(Color), 2.5f);
					Main.dust[num22].noGravity = true;
					Main.dust[num22].velocity *= 4f;
					num22 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 228, 0f, 0f, 200, default(Color), 1.5f);
					Main.dust[num22].velocity *= 2.2f;
					Main.dust[num22].noGravity = true;
				}
				for (int num23 = 0; num23 < 1; num23++)
				{
					int num24 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num24].velocity *= 0.3f;
					Main.gore[num24].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num24].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
			}
			break;
		}
		case 3:
		{
			Color celeb2Color5 = GetCeleb2Color();
			Vector2 center4 = base.Center;
			for (int num27 = 0; num27 < 4; num27++)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
			}
			float num28 = Main.rand.NextFloat() * ((float)Math.PI * 2f);
			for (int num29 = 0; num29 < 40; num29++)
			{
				Dust dust6 = Dust.NewDustPerfect(center4, 278, null, 100, Color.Lerp(celeb2Color5, Color.White, Main.rand.NextFloat() * 0.3f));
				dust6.scale = 1.3f * (dust6.velocity.Length() / 2f);
				dust6.fadeIn = 1.5f * (dust6.velocity.Length() / 2f);
				dust6.noGravity = true;
				dust6.velocity *= 6f;
				if (Math.Abs(dust6.velocity.X) > Math.Abs(dust6.velocity.Y))
				{
					dust6.velocity.Y *= 0.1f;
				}
				else
				{
					dust6.velocity.X *= 0.1f;
				}
				dust6.velocity = dust6.velocity.RotatedBy(num28);
			}
			for (int num30 = 0; num30 < 1; num30++)
			{
				int num31 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Main.gore[num31].velocity *= 0.3f;
				Main.gore[num31].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num31].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
			break;
		}
		case 4:
		{
			GetCeleb2Color();
			Vector2 center5 = base.Center;
			Main.rand.NextFloat();
			for (float num32 = 0f; num32 < 1f; num32 += 0.025f)
			{
				Dust dust7 = Dust.NewDustPerfect(center5, 132, null, 200);
				dust7.scale = 1.1f;
				dust7.fadeIn = 1.5f;
				dust7.velocity *= Main.rand.NextFloat() * 2f + 2f;
				if (dust7.velocity.Y > 0f)
				{
					dust7.velocity *= 0.3f;
				}
				dust7.velocity *= 2f;
			}
			for (int num33 = 0; num33 < 3; num33++)
			{
				int num34 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Main.gore[num34].velocity *= 0.3f;
				Main.gore[num34].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num34].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
			break;
		}
		case 5:
		{
			Color celeb2Color4 = GetCeleb2Color();
			_ = base.Center;
			for (int num25 = 0; num25 < 20; num25++)
			{
				int num26 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 278, 0f, 0f, 200, Color.Lerp(celeb2Color4, Color.White, Main.rand.NextFloat() * 0.4f), 2.5f);
				Main.dust[num26].fadeIn = 1.3f;
				Main.dust[num26].scale = 1.1f;
				Main.dust[num26].velocity *= 2f;
				num26 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, 0f, 0f, 200, celeb2Color4, 2.5f);
				Main.dust[num26].velocity *= 1.2f;
				Main.dust[num26].noGravity = true;
			}
			break;
		}
		case 6:
		{
			Color celeb2Color = GetCeleb2Color();
			Vector2 center = base.Center;
			for (int i = 0; i < 4; i++)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
			}
			for (float num = 0f; num < 1f; num += 0.015f)
			{
				Vector2 vector = Vector2.UnitY.RotatedBy(num * ((float)Math.PI * 2f)) * (1f + Main.rand.NextFloatDirection() * 0.1f);
				Dust dust = Dust.NewDustPerfect(center + vector, 134, Vector2.Zero, 0, celeb2Color);
				dust.scale = 1.4f;
				dust.velocity = vector * 5f;
				dust.velocity.Y += -3f;
				dust.velocity *= 2f;
			}
			for (float num2 = 0f; num2 < 1f; num2 += 0.025f)
			{
				Vector2 vector2 = Vector2.UnitY.RotatedBy(num2 * ((float)Math.PI * 2f)) * (1f + Main.rand.NextFloatDirection() * 0.2f);
				Dust dust2 = Dust.NewDustPerfect(center + vector2, 267, Vector2.Zero, 0, celeb2Color);
				dust2.noGravity = true;
				dust2.scale = 0.4f;
				dust2.fadeIn = 1.2f;
				dust2.velocity = vector2 * 4f;
				dust2.velocity.Y += -3f;
				dust2.velocity *= 2f;
			}
			for (float num3 = 0f; num3 < 1f; num3 += 0.07f)
			{
				Vector2 vector3 = Vector2.UnitY.RotatedBy(num3 * ((float)Math.PI * 2f)) * (1f + Main.rand.NextFloatDirection() * 0.3f);
				Dust dust3 = Dust.NewDustPerfect(center + vector3, 267, Vector2.Zero, 0, celeb2Color);
				dust3.noGravity = true;
				dust3.scale = 0.4f;
				dust3.fadeIn = 1.3f;
				dust3.velocity = vector3 * 7f;
				dust3.velocity.Y += -3f;
				dust3.velocity *= 2f;
			}
			for (int j = 0; j < 1; j++)
			{
				int num4 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Main.gore[num4].velocity *= 0.3f;
				Main.gore[num4].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num4].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
			break;
		}
		}
	}

	private void CreateGroundExplosion(float MAX_SPREAD, int fluff, int distFluff, int layerStart, int layerEnd, int layerJump)
	{
		Point point = base.TopLeft.ToTileCoordinates();
		Point point2 = base.BottomRight.ToTileCoordinates();
		point.X -= fluff;
		point.Y -= fluff;
		point2.X += fluff;
		point2.Y += fluff;
		int num = point.X / 2 + point2.X / 2;
		int num2 = width / 2 + distFluff;
		for (int i = layerStart; i < layerEnd; i += layerJump)
		{
			int num3 = i;
			for (int j = point.X; j <= point2.X; j++)
			{
				for (int k = point.Y; k <= point2.Y; k++)
				{
					if (!WorldGen.InWorld(j, k, 10))
					{
						return;
					}
					if (Vector2.Distance(base.Center, new Vector2(j * 16, k * 16)) > (float)num2)
					{
						continue;
					}
					Tile tileSafely = Framing.GetTileSafely(j, k);
					if (!tileSafely.active() || !Main.tileSolid[tileSafely.type] || Main.tileSolidTop[tileSafely.type] || Main.tileFrameImportant[tileSafely.type])
					{
						continue;
					}
					Tile tileSafely2 = Framing.GetTileSafely(j, k - 1);
					if (tileSafely2.active() && Main.tileSolid[tileSafely2.type] && !Main.tileSolidTop[tileSafely2.type])
					{
						continue;
					}
					int num4 = WorldGen.KillTile_GetTileDustAmount(fail: true, tileSafely);
					for (int l = 0; l < num4; l++)
					{
						Dust obj = Main.dust[WorldGen.KillTile_MakeTileDust(j, k, tileSafely)];
						obj.velocity.Y -= 3f + (float)num3 * 1.5f;
						obj.velocity.Y *= Main.rand.NextFloat();
						obj.scale += (float)num3 * 0.03f;
					}
					if (num3 >= 2)
					{
						for (int m = 0; m < num4 - 1; m++)
						{
							Dust obj2 = Main.dust[WorldGen.KillTile_MakeTileDust(j, k, tileSafely)];
							obj2.velocity.Y -= 1f + (float)num3;
							obj2.velocity.Y *= Main.rand.NextFloat();
						}
					}
					if (num4 > 0 && Main.rand.Next(3) != 0)
					{
						float num5 = (float)Math.Abs(num - j) / (MAX_SPREAD / 2f);
						Gore gore = Gore.NewGoreDirect(position, Vector2.Zero, 61 + Main.rand.Next(3), 1f - (float)num3 * 0.15f + num5 * 0.5f);
						gore.velocity.Y -= 0.1f + (float)num3 * 0.5f + num5 * (float)num3 * 1f;
						gore.velocity.Y *= Main.rand.NextFloat();
						gore.position = new Vector2(j * 16 + 20, k * 16 + 20);
					}
				}
			}
		}
	}

	public void CheckUsability(Player player, ref bool currentlyUsable)
	{
		if (aiStyle == 160)
		{
			currentlyUsable = false;
		}
	}

	private void AI_163_Chum()
	{
		float num = 0.05f;
		float num2 = width / 2;
		for (int i = 0; i < 1000; i++)
		{
			if (i != whoAmI && Main.projectile[i].active && Main.projectile[i].type == type && Math.Abs(position.X - Main.projectile[i].position.X) + Math.Abs(position.Y - Main.projectile[i].position.Y) < num2)
			{
				if (position.X < Main.projectile[i].position.X)
				{
					velocity.X -= num;
				}
				else
				{
					velocity.X += num;
				}
				if (position.Y < Main.projectile[i].position.Y)
				{
					velocity.Y -= num;
				}
				else
				{
					velocity.Y += num;
				}
			}
		}
		if (wet)
		{
			velocity.X *= 0.9f;
			int num3 = (int)(base.Center.X + (float)((width / 2 + 8) * direction)) / 16;
			int num4 = (int)(base.Center.Y / 16f);
			_ = position.Y / 16f;
			int num5 = (int)((position.Y + (float)height) / 16f);
			if (Main.tile[num3, num4] == null)
			{
				Main.tile[num3, num4] = new Tile();
			}
			if (Main.tile[num3, num5] == null)
			{
				Main.tile[num3, num5] = new Tile();
			}
			if (velocity.Y > 0f)
			{
				velocity.Y *= 0.5f;
			}
			num3 = (int)(base.Center.X / 16f);
			num4 = (int)(base.Center.Y / 16f);
			float num6 = AI_061_FishingBobber_GetWaterLine(num3, num4);
			if (base.Center.Y > num6)
			{
				velocity.Y -= 0.1f;
				if (velocity.Y < -8f)
				{
					velocity.Y = -8f;
				}
				if (base.Center.Y + velocity.Y < num6)
				{
					velocity.Y = num6 - base.Center.Y;
				}
			}
			else
			{
				velocity.Y = num6 - base.Center.Y;
			}
		}
		else
		{
			if (velocity.Y == 0f)
			{
				velocity.X *= 0.95f;
			}
			velocity.X *= 0.98f;
			velocity.Y += 0.3f;
			if (velocity.Y > 15.9f)
			{
				velocity.Y = 15.9f;
			}
		}
		if (frameCounter == 0)
		{
			frameCounter = 1;
			frame = Main.rand.Next(4);
		}
		if (frameCounter < 10 && wet)
		{
			frameCounter++;
			for (float num7 = 0f; num7 < 1f; num7 += 0.5f)
			{
				Gore gore = Gore.NewGoreDirect(position + Vector2.UnitY * 6f, Vector2.Zero, 1201, scale * 0.7f);
				gore.velocity = Main.rand.NextVector2CircularEdge(10f, 10f);
				if (gore.velocity.Y > 0f)
				{
					gore.velocity.Y *= -1f;
				}
			}
			for (float num8 = 0f; num8 < 2f; num8 += 1f)
			{
				Gore gore2 = Gore.NewGoreDirect(position + Vector2.UnitY * 6f, Vector2.Zero, 1208, scale * 0.7f + Main.rand.NextFloat() * 0.15f);
				gore2.velocity = Main.rand.NextVector2CircularEdge(4f, 4f);
				if (gore2.velocity.Y > 0f)
				{
					gore2.velocity.Y *= -1f;
				}
			}
		}
		scale = Utils.GetLerpValue(0f, 60f, timeLeft, clamped: true);
		rotation += velocity.X * 0.14f;
		bool flag = !wet && velocity.Length() < 0.8f;
		int maxValue = (wet ? 90 : 5);
		if (Main.rand.Next(maxValue) == 0 && !flag)
		{
			Gore gore3 = Gore.NewGoreDirect(position + Vector2.UnitY * 6f, Vector2.Zero, 1201, scale * 0.7f);
			if (wet)
			{
				gore3.velocity = Vector2.UnitX * Main.rand.NextFloatDirection() * 0.75f + Vector2.UnitY * Main.rand.NextFloat();
			}
			else if (gore3.velocity.Y < 0f)
			{
				gore3.velocity.Y = 0f - gore3.velocity.Y;
			}
		}
		Vector2 spot = base.Center + Vector2.UnitY * 16f;
		if (ai[0] >= 10f && timeLeft > 60)
		{
			timeLeft = 60;
			netUpdate = true;
		}
		if (ai[0] < 10f && timeLeft > 60)
		{
			Main.instance.ChumBucketProjectileHelper.AddChumLocation(spot);
		}
	}

	private void ReduceRemainingChumsInPool()
	{
		int x = (int)base.Center.X / 16;
		int num = (int)base.Center.Y / 16;
		List<Tuple<int, Point>> list = new List<Tuple<int, Point>>();
		List<int> list2 = new List<int>();
		for (int i = 0; i < 1000; i++)
		{
			Projectile projectile = Main.projectile[i];
			if (projectile.active && projectile.owner == Main.myPlayer && projectile.timeLeft > 60 && projectile.type == 820)
			{
				list.Add(new Tuple<int, Point>(i, (projectile.Center + Vector2.UnitY * 16f).ToTileCoordinates()));
			}
		}
		if (list.Count == 0)
		{
			return;
		}
		GetFishingPondWidth(x, num, out var minX, out var maxX);
		Point point = default(Point);
		for (int j = minX; j <= maxX; j++)
		{
			point.X = j;
			int num2 = num;
			while (Main.tile[j, num2].liquid > 0 && !WorldGen.SolidTile(j, num2) && num2 < Main.maxTilesY - 10)
			{
				num2 = (point.Y = num2 + 1);
				for (int num3 = list.Count - 1; num3 >= 0; num3--)
				{
					if (list[num3].Item2 == point)
					{
						list2.Add(list[num3].Item1);
						list.RemoveAt(num3);
					}
				}
				if (list.Count == 0)
				{
					break;
				}
			}
			if (list.Count == 0)
			{
				break;
			}
		}
		for (int k = 0; k < list2.Count; k++)
		{
			Projectile obj = Main.projectile[list2[k]];
			obj.ai[0] += 1f;
			obj.netUpdate = true;
		}
	}

	private void AI_061_FishingBobber()
	{
		Player player = Main.player[owner];
		bool flag = type >= 986 && type <= 993;
		timeLeft = 60;
		bool flag2 = false;
		if (player.inventory[player.selectedItem].fishingPole == 0 || player.CCed || player.noItems)
		{
			flag2 = true;
		}
		else if (player.inventory[player.selectedItem].shoot != type && !flag)
		{
			flag2 = true;
		}
		else if (player.pulley)
		{
			flag2 = true;
		}
		else if (player.dead)
		{
			flag2 = true;
		}
		if (flag2)
		{
			Kill();
			return;
		}
		player.afkCounterForKiting = 0;
		if (ai[1] > 0f && localAI[1] != 0f)
		{
			localAI[1] = 0f;
			if (!lavaWet && !honeyWet)
			{
				AI_061_FishingBobber_DoASplash();
			}
		}
		if (ai[0] >= 1f)
		{
			if (ai[0] == 2f)
			{
				ai[0] += 1f;
				SoundEngine.PlaySound(SoundID.Item17, position);
				if (!lavaWet && !honeyWet)
				{
					AI_061_FishingBobber_DoASplash();
				}
			}
			if (localAI[0] < 100f)
			{
				localAI[0] += 1f;
			}
			if (frameCounter == 0)
			{
				frameCounter = 1;
				ReduceRemainingChumsInPool();
			}
			tileCollide = false;
			int num = 10;
			Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num2 = player.position.X + (float)(player.width / 2) - vector.X;
			float num3 = player.position.Y + (float)(player.height / 2) - vector.Y;
			float num4 = (float)Math.Sqrt(num2 * num2 + num3 * num3);
			if (num4 > 3000f)
			{
				Kill();
			}
			num4 = 15.9f / num4;
			num2 *= num4;
			num3 *= num4;
			velocity.X = (velocity.X * (float)(num - 1) + num2) / (float)num;
			velocity.Y = (velocity.Y * (float)(num - 1) + num3) / (float)num;
			rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
			if (Main.myPlayer == owner && base.Hitbox.Intersects(player.Hitbox))
			{
				Kill();
			}
			return;
		}
		bool flag3 = false;
		Vector2 vector2 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
		float num5 = player.position.X + (float)(player.width / 2) - vector2.X;
		float num6 = player.position.Y + (float)(player.height / 2) - vector2.Y;
		rotation = (float)Math.Atan2(num6, num5) + 1.57f;
		if ((float)Math.Sqrt(num5 * num5 + num6 * num6) > 900f)
		{
			ai[0] = 1f;
		}
		if (wet)
		{
			if (shimmerWet)
			{
				if (Main.myPlayer == owner)
				{
					Main.player[owner].AddBuff(353, 60);
				}
				if (localAI[2] == 0f)
				{
					localAI[2] = 1f;
					SoundEngine.PlaySound(19, (int)Main.player[owner].position.X, (int)Main.player[owner].position.Y, 2);
				}
			}
			rotation = 0f;
			velocity.X *= 0.9f;
			int num7 = (int)(base.Center.X + (float)((width / 2 + 8) * direction)) / 16;
			int num8 = (int)(base.Center.Y / 16f);
			_ = position.Y / 16f;
			int num9 = (int)((position.Y + (float)height) / 16f);
			if (Main.tile[num7, num8] == null)
			{
				Main.tile[num7, num8] = new Tile();
			}
			if (Main.tile[num7, num9] == null)
			{
				Main.tile[num7, num9] = new Tile();
			}
			if (velocity.Y > 0f)
			{
				velocity.Y *= 0.5f;
			}
			num7 = (int)(base.Center.X / 16f);
			num8 = (int)(base.Center.Y / 16f);
			float num10 = AI_061_FishingBobber_GetWaterLine(num7, num8);
			if (base.Center.Y > num10)
			{
				velocity.Y -= 0.1f;
				if (velocity.Y < -8f)
				{
					velocity.Y = -8f;
				}
				if (base.Center.Y + velocity.Y < num10)
				{
					velocity.Y = num10 - base.Center.Y;
				}
			}
			else
			{
				velocity.Y = num10 - base.Center.Y;
			}
			if ((double)velocity.Y >= -0.01 && (double)velocity.Y <= 0.01)
			{
				flag3 = true;
			}
		}
		else
		{
			if (velocity.Y == 0f)
			{
				velocity.X *= 0.95f;
			}
			velocity.X *= 0.98f;
			velocity.Y += 0.2f;
			if (velocity.Y > 15.9f)
			{
				velocity.Y = 15.9f;
			}
		}
		if (Main.myPlayer == owner && player.GetFishingConditions().BaitItemType == 2673)
		{
			player.displayedFishingInfo = Language.GetTextValue("GameUI.FishingWarning");
		}
		if (ai[1] != 0f)
		{
			flag3 = true;
		}
		if (!flag3)
		{
			return;
		}
		if (ai[1] == 0f && Main.myPlayer == owner)
		{
			int finalFishingLevel = player.GetFishingConditions().FinalFishingLevel;
			if (Main.rand.Next(300) < finalFishingLevel)
			{
				localAI[1] += Main.rand.Next(1, 3);
			}
			localAI[1] += finalFishingLevel / 30;
			localAI[1] += Main.rand.Next(1, 3);
			if (Main.rand.Next(60) == 0)
			{
				localAI[1] += 60f;
			}
			if (localAI[1] > 660f)
			{
				localAI[1] = 0f;
				FishingCheck();
			}
		}
		else if (ai[1] < 0f)
		{
			if (velocity.Y == 0f || (honeyWet && Math.Abs(velocity.Y) <= 0.01f))
			{
				velocity.Y = (float)Main.rand.Next(100, 500) * 0.015f;
				velocity.X = (float)Main.rand.Next(-100, 101) * 0.015f;
				wet = false;
				lavaWet = false;
				honeyWet = false;
			}
			ai[1] += Main.rand.Next(1, 5);
			if (ai[1] >= 0f)
			{
				ai[1] = 0f;
				localAI[1] = 0f;
				netUpdate = true;
			}
		}
	}

	private float AI_061_FishingBobber_GetWaterLine(int X, int Y)
	{
		float result = position.Y + (float)height;
		if (Main.tile[X, Y - 1] == null)
		{
			Main.tile[X, Y - 1] = new Tile();
		}
		if (Main.tile[X, Y] == null)
		{
			Main.tile[X, Y] = new Tile();
		}
		if (Main.tile[X, Y + 1] == null)
		{
			Main.tile[X, Y + 1] = new Tile();
		}
		if (Main.tile[X, Y - 1].liquid > 0)
		{
			result = Y * 16;
			result -= (float)(Main.tile[X, Y - 1].liquid / 16);
		}
		else if (Main.tile[X, Y].liquid > 0)
		{
			result = (Y + 1) * 16;
			result -= (float)(Main.tile[X, Y].liquid / 16);
		}
		else if (Main.tile[X, Y + 1].liquid > 0)
		{
			result = (Y + 2) * 16;
			result -= (float)(Main.tile[X, Y + 1].liquid / 16);
		}
		return result;
	}

	private void AI_061_FishingBobber_DoASplash()
	{
		for (int i = 0; i < 100; i++)
		{
			int num = Dust.NewDust(new Vector2(position.X - 6f, position.Y - 10f), width + 12, 24, Dust.dustWater());
			Main.dust[num].velocity.Y -= 4f;
			Main.dust[num].velocity.X *= 2.5f;
			Main.dust[num].scale = 0.8f;
			Main.dust[num].alpha = 100;
			Main.dust[num].noGravity = true;
		}
		SoundEngine.PlaySound(19, (int)position.X, (int)position.Y, 0);
	}

	private void AI_061_FishingBobber_GiveItemToPlayer(Player thePlayer, int itemType)
	{
		Item item = new Item();
		item.SetDefaults(itemType);
		if (itemType == 3196)
		{
			int finalFishingLevel = thePlayer.GetFishingConditions().FinalFishingLevel;
			int minValue = (finalFishingLevel / 20 + 3) / 2;
			int num = (finalFishingLevel / 10 + 6) / 2;
			if (Main.rand.Next(50) < finalFishingLevel)
			{
				num++;
			}
			if (Main.rand.Next(100) < finalFishingLevel)
			{
				num++;
			}
			if (Main.rand.Next(150) < finalFishingLevel)
			{
				num++;
			}
			if (Main.rand.Next(200) < finalFishingLevel)
			{
				num++;
			}
			int stack = Main.rand.Next(minValue, num + 1);
			item.stack = stack;
		}
		if (itemType == 3197)
		{
			int finalFishingLevel2 = thePlayer.GetFishingConditions().FinalFishingLevel;
			int minValue2 = (finalFishingLevel2 / 4 + 15) / 2;
			int num2 = (finalFishingLevel2 / 2 + 40) / 2;
			if (Main.rand.Next(50) < finalFishingLevel2)
			{
				num2 += 6;
			}
			if (Main.rand.Next(100) < finalFishingLevel2)
			{
				num2 += 6;
			}
			if (Main.rand.Next(150) < finalFishingLevel2)
			{
				num2 += 6;
			}
			if (Main.rand.Next(200) < finalFishingLevel2)
			{
				num2 += 6;
			}
			int stack2 = Main.rand.Next(minValue2, num2 + 1);
			item.stack = stack2;
		}
		thePlayer.QuickSpawnItem(new EntitySource_FishedOut(this), item);
	}

	private void AI_146_DD2Victory()
	{
	}

	private void BetsySharpnel(int npcIndex)
	{
		if (ai[1] != -1f && owner == Main.myPlayer)
		{
			Vector2 spinningpoint = new Vector2(0f, 6f);
			Vector2 center = base.Center;
			float num = (float)Math.PI / 4f;
			int num2 = 5;
			float num3 = (0f - num * 2f) / (float)(num2 - 1);
			for (int i = 0; i < num2; i++)
			{
				int num4 = NewProjectile(GetProjectileSource_FromThis(), center, spinningpoint.RotatedBy(num + num3 * (float)i), 710, damage, knockBack, owner, 0f, -1f);
				Projectile p = Main.projectile[num4];
				CopyLocalNPCImmunityTo(p);
			}
		}
	}

	private void CopyLocalNPCImmunityTo(Projectile p)
	{
		Array.Copy(localNPCImmunity, p.localNPCImmunity, localNPCImmunity.Length);
	}

	private int AI_048_GetStartPositionSettingDelay()
	{
		switch (type)
		{
		case 260:
		case 290:
			return 3;
		case 255:
			return 4;
		case 294:
			return 9;
		default:
			return 0;
		}
	}

	private void AI_001()
	{
		if (type == 469 && wet && !honeyWet && !shimmerWet)
		{
			Kill();
		}
		if (type == 88)
		{
			if (ai[0] != 0f)
			{
				extraUpdates = (int)ai[0];
			}
			if (scale < 4f)
			{
				scale += 0.053f;
				if (scale > 4f)
				{
					scale = 4f;
				}
				if (Main.myPlayer == owner)
				{
					knockBack *= 1.0045f;
					localAI[0] += 1f;
					if (localAI[0] >= 8f)
					{
						localAI[0] = 0f;
						damage += Main.rand.Next(1, 4);
						penetrate += Main.rand.Next(0, 2);
					}
				}
			}
		}
		if (type == 20 && scale < 3f)
		{
			scale += 0.0189f;
			if (scale > 3f)
			{
				scale = 3f;
			}
			if (Main.myPlayer == owner)
			{
				knockBack *= 1.0025f;
				localAI[0] += 1f;
				if (localAI[0] >= 25f)
				{
					localAI[0] = 0f;
					damage += Main.rand.Next(1, 3);
					penetrate++;
				}
			}
		}
		if (type == 601)
		{
			Color portalColor = PortalHelper.GetPortalColor(owner, (int)ai[0]);
			Vector3 rgb = portalColor.ToVector3();
			rgb *= 0.5f;
			Lighting.AddLight(base.Center + velocity * 3f, rgb);
			if (alpha > 0 && alpha <= 15)
			{
				Color color = portalColor;
				color.A = byte.MaxValue;
				for (int i = 0; i < 4; i++)
				{
					Dust obj = Main.dust[Dust.NewDust(base.Center, 0, 0, 264)];
					obj.position = base.Center;
					obj.velocity = velocity * 2f + Utils.RandomVector2(Main.rand, -1f, 1f);
					obj.color = color;
					obj.scale = 1.2f;
					obj.noLight = true;
					obj.noGravity = true;
					obj.customData = Main.player[owner];
				}
				if (ai[0] != 0f)
				{
					SoundEngine.PlaySound(SoundID.Item114, position);
				}
				else
				{
					SoundEngine.PlaySound(SoundID.Item115, position);
				}
			}
			alpha -= 15;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (++frameCounter >= 4)
			{
				frameCounter = 0;
				if (++frame >= Main.projFrames[type])
				{
					frame = 0;
				}
			}
			if (alpha == 0)
			{
				Color color2 = portalColor;
				color2.A = byte.MaxValue;
				Dust obj2 = Main.dust[Dust.NewDust(base.Center, 0, 0, 263)];
				obj2.position = base.Center;
				obj2.velocity = velocity / 4f;
				obj2.color = color2;
				obj2.noGravity = true;
				obj2.scale = 0.6f;
			}
		}
		if (type == 472)
		{
			int num = Dust.NewDust(position, width, height, 30);
			Main.dust[num].noGravity = true;
			Main.dust[num].velocity *= 0.25f;
			Main.dust[num].velocity += velocity * 0.75f;
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlaySound(SoundID.Item17, position);
				for (int j = 0; j < 20; j++)
				{
					num = Dust.NewDust(position, width, height, 30);
					Main.dust[num].noGravity = true;
					Main.dust[num].velocity *= 0.25f;
					Main.dust[num].velocity += velocity;
					Main.dust[num].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.dust[num].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
				}
			}
		}
		if (type == 323)
		{
			alpha -= 50;
			if (alpha < 0)
			{
				alpha = 0;
			}
		}
		if (type == 436)
		{
			if (ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item12, position);
			}
			alpha -= 40;
			if (alpha < 0)
			{
				alpha = 0;
			}
			spriteDirection = direction;
			frameCounter++;
			if (frameCounter >= 3)
			{
				frame++;
				frameCounter = 0;
				if (frame >= 4)
				{
					frame = 0;
				}
			}
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.3f, 1.1f, 0.5f);
		}
		if (type == 467)
		{
			if (ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item34, position);
			}
			else if (ai[1] == 1f && Main.netMode != 1)
			{
				int num2 = -1;
				float num3 = 2000f;
				for (int k = 0; k < 255; k++)
				{
					if (Main.player[k].active && !Main.player[k].dead)
					{
						Vector2 center = Main.player[k].Center;
						float num4 = Vector2.Distance(center, base.Center);
						if ((num4 < num3 || num2 == -1) && Collision.CanHit(base.Center, 1, 1, center, 1, 1))
						{
							num3 = num4;
							num2 = k;
						}
					}
				}
				if (num3 < 20f)
				{
					Kill();
					return;
				}
				if (num2 != -1)
				{
					ai[1] = 21f;
					ai[0] = num2;
					netUpdate = true;
				}
			}
			else if (ai[1] > 20f && ai[1] < 200f)
			{
				ai[1] += 1f;
				int num5 = (int)ai[0];
				if (!Main.player[num5].active || Main.player[num5].dead)
				{
					ai[1] = 1f;
					ai[0] = 0f;
					netUpdate = true;
				}
				else
				{
					float num6 = velocity.ToRotation();
					Vector2 vector = Main.player[num5].Center - base.Center;
					if (vector.Length() < 20f)
					{
						Kill();
						return;
					}
					float targetAngle = vector.ToRotation();
					if (vector == Vector2.Zero)
					{
						targetAngle = num6;
					}
					float num7 = num6.AngleLerp(targetAngle, 0.008f);
					velocity = new Vector2(velocity.Length(), 0f).RotatedBy(num7);
				}
			}
			if (ai[1] >= 1f && ai[1] < 20f)
			{
				ai[1] += 1f;
				if (ai[1] == 20f)
				{
					ai[1] = 1f;
				}
			}
			alpha -= 40;
			if (alpha < 0)
			{
				alpha = 0;
			}
			spriteDirection = direction;
			frameCounter++;
			if (frameCounter >= 3)
			{
				frame++;
				frameCounter = 0;
				if (frame >= 4)
				{
					frame = 0;
				}
			}
			Lighting.AddLight(base.Center, 1.1f, 0.9f, 0.4f);
			localAI[0] += 1f;
			if (localAI[0] == 12f)
			{
				localAI[0] = 0f;
				for (int l = 0; l < 12; l++)
				{
					Vector2 spinningpoint = Vector2.UnitX * -width / 2f;
					spinningpoint += -Vector2.UnitY.RotatedBy((float)l * (float)Math.PI / 6f) * new Vector2(8f, 16f);
					spinningpoint = spinningpoint.RotatedBy(rotation - (float)Math.PI / 2f);
					int num8 = Dust.NewDust(base.Center, 0, 0, 6, 0f, 0f, 160);
					Main.dust[num8].scale = 1.1f;
					Main.dust[num8].noGravity = true;
					Main.dust[num8].position = base.Center + spinningpoint;
					Main.dust[num8].velocity = velocity * 0.1f;
					Main.dust[num8].velocity = Vector2.Normalize(base.Center - velocity * 3f - Main.dust[num8].position) * 1.25f;
				}
			}
			if (Main.rand.Next(4) == 0)
			{
				for (int m = 0; m < 1; m++)
				{
					Vector2 vector2 = -Vector2.UnitX.RotatedByRandom(0.19634954631328583).RotatedBy(velocity.ToRotation());
					int num9 = Dust.NewDust(position, width, height, 31, 0f, 0f, 100);
					Main.dust[num9].velocity *= 0.1f;
					Main.dust[num9].position = base.Center + vector2 * width / 2f;
					Main.dust[num9].fadeIn = 0.9f;
				}
			}
			if (Main.rand.Next(32) == 0)
			{
				for (int n = 0; n < 1; n++)
				{
					Vector2 vector3 = -Vector2.UnitX.RotatedByRandom(0.39269909262657166).RotatedBy(velocity.ToRotation());
					int num10 = Dust.NewDust(position, width, height, 31, 0f, 0f, 155, default(Color), 0.8f);
					Main.dust[num10].velocity *= 0.3f;
					Main.dust[num10].position = base.Center + vector3 * width / 2f;
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num10].fadeIn = 1.4f;
					}
				}
			}
			if (Main.rand.Next(2) == 0)
			{
				for (int num11 = 0; num11 < 2; num11++)
				{
					Vector2 vector4 = -Vector2.UnitX.RotatedByRandom(0.7853981852531433).RotatedBy(velocity.ToRotation());
					int num12 = Dust.NewDust(position, width, height, 6, 0f, 0f, 0, default(Color), 1.2f);
					Main.dust[num12].velocity *= 0.3f;
					Main.dust[num12].noGravity = true;
					Main.dust[num12].position = base.Center + vector4 * width / 2f;
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num12].fadeIn = 1.4f;
					}
				}
			}
		}
		if (type == 468)
		{
			if (ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item34, position);
			}
			else if (ai[1] == 1f && Main.netMode != 1)
			{
				int num13 = -1;
				float num14 = 2000f;
				for (int num15 = 0; num15 < 255; num15++)
				{
					if (Main.player[num15].active && !Main.player[num15].dead)
					{
						Vector2 center2 = Main.player[num15].Center;
						float num16 = Vector2.Distance(center2, base.Center);
						if ((num16 < num14 || num13 == -1) && Collision.CanHit(base.Center, 1, 1, center2, 1, 1))
						{
							num14 = num16;
							num13 = num15;
						}
					}
				}
				if (num14 < 20f)
				{
					Kill();
					return;
				}
				if (num13 != -1)
				{
					ai[1] = 21f;
					ai[0] = num13;
					netUpdate = true;
				}
			}
			else if (ai[1] > 20f && ai[1] < 200f)
			{
				ai[1] += 1f;
				int num17 = (int)ai[0];
				if (!Main.player[num17].active || Main.player[num17].dead)
				{
					ai[1] = 1f;
					ai[0] = 0f;
					netUpdate = true;
				}
				else
				{
					float num18 = velocity.ToRotation();
					Vector2 vector5 = Main.player[num17].Center - base.Center;
					if (vector5.Length() < 20f)
					{
						Kill();
						return;
					}
					float targetAngle2 = vector5.ToRotation();
					if (vector5 == Vector2.Zero)
					{
						targetAngle2 = num18;
					}
					float num19 = num18.AngleLerp(targetAngle2, 0.01f);
					velocity = new Vector2(velocity.Length(), 0f).RotatedBy(num19);
				}
			}
			if (ai[1] >= 1f && ai[1] < 20f)
			{
				ai[1] += 1f;
				if (ai[1] == 20f)
				{
					ai[1] = 1f;
				}
			}
			alpha -= 40;
			if (alpha < 0)
			{
				alpha = 0;
			}
			spriteDirection = direction;
			frameCounter++;
			if (frameCounter >= 3)
			{
				frame++;
				frameCounter = 0;
				if (frame >= 4)
				{
					frame = 0;
				}
			}
			Lighting.AddLight(base.Center, 0.2f, 0.1f, 0.6f);
			localAI[0] += 1f;
			if (localAI[0] == 12f)
			{
				localAI[0] = 0f;
				for (int num20 = 0; num20 < 12; num20++)
				{
					Vector2 spinningpoint2 = Vector2.UnitX * -width / 2f;
					spinningpoint2 += -Vector2.UnitY.RotatedBy((float)num20 * (float)Math.PI / 6f) * new Vector2(8f, 16f);
					spinningpoint2 = spinningpoint2.RotatedBy(rotation - (float)Math.PI / 2f);
					int num21 = Dust.NewDust(base.Center, 0, 0, 27, 0f, 0f, 160);
					Main.dust[num21].scale = 1.1f;
					Main.dust[num21].noGravity = true;
					Main.dust[num21].position = base.Center + spinningpoint2;
					Main.dust[num21].velocity = velocity * 0.1f;
					Main.dust[num21].velocity = Vector2.Normalize(base.Center - velocity * 3f - Main.dust[num21].position) * 1.25f;
				}
			}
			if (Main.rand.Next(4) == 0)
			{
				for (int num22 = 0; num22 < 1; num22++)
				{
					Vector2 vector6 = -Vector2.UnitX.RotatedByRandom(0.19634954631328583).RotatedBy(velocity.ToRotation());
					int num23 = Dust.NewDust(position, width, height, 31, 0f, 0f, 100);
					Main.dust[num23].velocity *= 0.1f;
					Main.dust[num23].position = base.Center + vector6 * width / 2f;
					Main.dust[num23].fadeIn = 0.9f;
				}
			}
			if (Main.rand.Next(32) == 0)
			{
				for (int num24 = 0; num24 < 1; num24++)
				{
					Vector2 vector7 = -Vector2.UnitX.RotatedByRandom(0.39269909262657166).RotatedBy(velocity.ToRotation());
					int num25 = Dust.NewDust(position, width, height, 31, 0f, 0f, 155, default(Color), 0.8f);
					Main.dust[num25].velocity *= 0.3f;
					Main.dust[num25].position = base.Center + vector7 * width / 2f;
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num25].fadeIn = 1.4f;
					}
				}
			}
			if (Main.rand.Next(2) == 0)
			{
				for (int num26 = 0; num26 < 2; num26++)
				{
					Vector2 vector8 = -Vector2.UnitX.RotatedByRandom(0.7853981852531433).RotatedBy(velocity.ToRotation());
					int num27 = Dust.NewDust(position, width, height, 27, 0f, 0f, 0, default(Color), 1.2f);
					Main.dust[num27].velocity *= 0.3f;
					Main.dust[num27].noGravity = true;
					Main.dust[num27].position = base.Center + vector8 * width / 2f;
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num27].fadeIn = 1.4f;
					}
				}
			}
		}
		if (type == 634 || type == 635)
		{
			float num28 = 5f;
			float num29 = 250f;
			float num30 = 6f;
			Vector2 vector9 = new Vector2(8f, 10f);
			float num31 = 1.2f;
			Vector3 rgb2 = new Vector3(0.7f, 0.1f, 0.5f);
			int num32 = 4 * MaxUpdates;
			int num33 = Utils.SelectRandom<int>(Main.rand, 242, 73, 72, 71, 255);
			int num34 = 255;
			if (type == 635)
			{
				vector9 = new Vector2(10f, 20f);
				num31 = 1f;
				num29 = 500f;
				num34 = 88;
				num32 = 3 * MaxUpdates;
				rgb2 = new Vector3(0.4f, 0.6f, 0.9f);
				num33 = Utils.SelectRandom<int>(Main.rand, 242, 59, 88);
			}
			if (ai[1] == 0f)
			{
				ai[1] = 1f;
				localAI[0] = -Main.rand.Next(48);
				SoundEngine.PlaySound(SoundID.Item34, position);
			}
			else if (ai[1] == 1f && owner == Main.myPlayer)
			{
				int num35 = -1;
				float num36 = num29;
				for (int num37 = 0; num37 < Main.maxNPCs; num37++)
				{
					if (Main.npc[num37].active && Main.npc[num37].CanBeChasedBy(this))
					{
						Vector2 center3 = Main.npc[num37].Center;
						float num38 = Vector2.Distance(center3, base.Center);
						if (num38 < num36 && num35 == -1 && Collision.CanHitLine(base.Center, 1, 1, center3, 1, 1))
						{
							num36 = num38;
							num35 = num37;
						}
					}
				}
				if (num36 < 20f)
				{
					Kill();
					return;
				}
				if (num35 != -1)
				{
					ai[1] = num28 + 1f;
					ai[0] = num35;
					netUpdate = true;
				}
			}
			else if (ai[1] > num28)
			{
				ai[1] += 1f;
				int num39 = (int)ai[0];
				if (!Main.npc[num39].active || !Main.npc[num39].CanBeChasedBy(this))
				{
					ai[1] = 1f;
					ai[0] = 0f;
					netUpdate = true;
				}
				else
				{
					velocity.ToRotation();
					Vector2 vector10 = Main.npc[num39].Center - base.Center;
					if (vector10.Length() < 20f)
					{
						Kill();
						return;
					}
					if (vector10 != Vector2.Zero)
					{
						vector10.Normalize();
						vector10 *= num30;
					}
					float num40 = 30f;
					velocity = (velocity * (num40 - 1f) + vector10) / num40;
				}
			}
			if (ai[1] >= 1f && ai[1] < num28)
			{
				ai[1] += 1f;
				if (ai[1] == num28)
				{
					ai[1] = 1f;
				}
			}
			alpha -= 40;
			if (alpha < 0)
			{
				alpha = 0;
			}
			spriteDirection = direction;
			frameCounter++;
			if (frameCounter >= num32)
			{
				frame++;
				frameCounter = 0;
				if (frame >= 4)
				{
					frame = 0;
				}
			}
			Lighting.AddLight(base.Center, rgb2);
			rotation = velocity.ToRotation();
			localAI[0] += 1f;
			if (localAI[0] == 48f)
			{
				localAI[0] = 0f;
			}
			else if (alpha == 0)
			{
				for (int num41 = 0; num41 < 2; num41++)
				{
					Vector2 vector11 = Vector2.UnitX * -30f;
					vector11 = -Vector2.UnitY.RotatedBy(localAI[0] * ((float)Math.PI / 24f) + (float)num41 * (float)Math.PI) * vector9 - rotation.ToRotationVector2() * 10f;
					int num42 = Dust.NewDust(base.Center, 0, 0, num34, 0f, 0f, 160);
					Main.dust[num42].scale = num31;
					Main.dust[num42].noGravity = true;
					Main.dust[num42].position = base.Center + vector11 + velocity * 2f;
					Main.dust[num42].velocity = Vector2.Normalize(base.Center + velocity * 2f * 8f - Main.dust[num42].position) * 2f + velocity * 2f;
				}
			}
			if (Main.rand.Next(12) == 0)
			{
				for (int num43 = 0; num43 < 1; num43++)
				{
					Vector2 vector12 = -Vector2.UnitX.RotatedByRandom(0.19634954631328583).RotatedBy(velocity.ToRotation());
					int num44 = Dust.NewDust(position, width, height, 31, 0f, 0f, 100);
					Main.dust[num44].velocity *= 0.1f;
					Main.dust[num44].position = base.Center + vector12 * width / 2f + velocity * 2f;
					Main.dust[num44].fadeIn = 0.9f;
				}
			}
			if (Main.rand.Next(64) == 0)
			{
				for (int num45 = 0; num45 < 1; num45++)
				{
					Vector2 vector13 = -Vector2.UnitX.RotatedByRandom(0.39269909262657166).RotatedBy(velocity.ToRotation());
					int num46 = Dust.NewDust(position, width, height, 31, 0f, 0f, 155, default(Color), 0.8f);
					Main.dust[num46].velocity *= 0.3f;
					Main.dust[num46].position = base.Center + vector13 * width / 2f;
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num46].fadeIn = 1.4f;
					}
				}
			}
			if (Main.rand.Next(4) == 0)
			{
				for (int num47 = 0; num47 < 2; num47++)
				{
					Vector2 vector14 = -Vector2.UnitX.RotatedByRandom(0.7853981852531433).RotatedBy(velocity.ToRotation());
					int num48 = Dust.NewDust(position, width, height, num33, 0f, 0f, 0, default(Color), 1.2f);
					Main.dust[num48].velocity *= 0.3f;
					Main.dust[num48].noGravity = true;
					Main.dust[num48].position = base.Center + vector14 * width / 2f;
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num48].fadeIn = 1.4f;
					}
				}
			}
			if (Main.rand.Next(12) == 0 && type == 634)
			{
				Vector2 vector15 = -Vector2.UnitX.RotatedByRandom(0.19634954631328583).RotatedBy(velocity.ToRotation());
				int num49 = Dust.NewDust(position, width, height, num34, 0f, 0f, 100);
				Main.dust[num49].velocity *= 0.3f;
				Main.dust[num49].position = base.Center + vector15 * width / 2f;
				Main.dust[num49].fadeIn = 0.9f;
				Main.dust[num49].noGravity = true;
			}
			if (Main.rand.Next(3) == 0 && type == 635)
			{
				Vector2 vector16 = -Vector2.UnitX.RotatedByRandom(0.19634954631328583).RotatedBy(velocity.ToRotation());
				int num50 = Dust.NewDust(position, width, height, num34, 0f, 0f, 100);
				Main.dust[num50].velocity *= 0.3f;
				Main.dust[num50].position = base.Center + vector16 * width / 2f;
				Main.dust[num50].fadeIn = 1.2f;
				Main.dust[num50].scale = 1.5f;
				Main.dust[num50].noGravity = true;
			}
		}
		if (type == 459)
		{
			alpha -= 30;
			if (alpha < 0)
			{
				alpha = 0;
			}
			spriteDirection = direction;
			frameCounter++;
			if (frameCounter >= 3)
			{
				frame++;
				frameCounter = 0;
				if (frame >= 3)
				{
					frame = 0;
				}
			}
			position = base.Center;
			scale = ai[1];
			width = (height = (int)(22f * scale));
			base.Center = position;
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.4f, 0.85f, 0.9f);
			int num51 = 0;
			if ((double)scale < 0.85)
			{
				num51 = ((Main.rand.Next(3) == 0) ? 1 : 0);
			}
			else
			{
				num51 = 1;
				penetrate = -1;
				maxPenetrate = -1;
			}
			for (int num52 = 0; num52 < num51; num52++)
			{
				int num53 = Dust.NewDust(position, width, height, 226, velocity.X);
				Main.dust[num53].position -= Vector2.One * 3f;
				Main.dust[num53].scale = 0.5f;
				Main.dust[num53].noGravity = true;
				Main.dust[num53].velocity = velocity / 3f;
				Main.dust[num53].alpha = 255 - (int)(255f * scale);
			}
		}
		if (type == 709)
		{
			alpha -= 30;
			if (alpha < 0)
			{
				alpha = 0;
			}
			spriteDirection = direction;
			frameCounter++;
			if (frameCounter >= 3)
			{
				frame++;
				frameCounter = 0;
				if (frame >= 3)
				{
					frame = 0;
				}
			}
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.4f, 0.85f, 0.9f);
			if (ai[1] == 0f)
			{
				SoundEngine.PlayTrackedSound(SoundID.DD2_SkyDragonsFuryShot, base.Center);
			}
			ai[1] += 1f;
			if (ai[1] >= 30f)
			{
				Kill();
				return;
			}
		}
		if (type == 442)
		{
			frame = 0;
			if (alpha != 0)
			{
				localAI[0] += 1f;
				if (localAI[0] >= 4f)
				{
					alpha -= 90;
					if (alpha < 0)
					{
						alpha = 0;
						localAI[0] = 2f;
					}
				}
			}
			if (Vector2.Distance(base.Center, new Vector2(ai[0], ai[1]) * 16f + Vector2.One * 8f) <= 16f)
			{
				Kill();
				return;
			}
			if (alpha == 0)
			{
				localAI[1] += 1f;
				if (localAI[1] >= 120f)
				{
					Kill();
					return;
				}
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.3f, 0.45f, 0.8f);
				localAI[0] += 1f;
				if (localAI[0] == 3f)
				{
					localAI[0] = 0f;
					for (int num54 = 0; num54 < 8; num54++)
					{
						Vector2 spinningpoint3 = Vector2.UnitX * -8f;
						spinningpoint3 += -Vector2.UnitY.RotatedBy((float)num54 * (float)Math.PI / 4f) * new Vector2(2f, 4f);
						spinningpoint3 = spinningpoint3.RotatedBy(rotation - (float)Math.PI / 2f);
						int num55 = Dust.NewDust(base.Center, 0, 0, 135);
						Main.dust[num55].scale = 1.5f;
						Main.dust[num55].noGravity = true;
						Main.dust[num55].position = base.Center + spinningpoint3;
						Main.dust[num55].velocity = velocity * 0.66f;
					}
				}
			}
		}
		if (type == 440 || type == 449 || type == 606)
		{
			if (alpha > 0)
			{
				alpha -= 25;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (type == 440)
			{
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.25f, 0.4f, 0.7f);
			}
			if (type == 449)
			{
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.7f, 0.65f, 0.3f);
			}
			if (type == 606)
			{
				Lighting.AddLight(base.Center, 0.7f, 0.3f, 0.3f);
			}
			float num56 = 100f;
			float num57 = 3f;
			if (type == 606)
			{
				num56 = 150f;
				num57 = 5f;
			}
			if (ai[1] == 0f)
			{
				localAI[0] += num57;
				if (localAI[0] == num57 * 1f && type == 606)
				{
					for (int num58 = 0; num58 < 4; num58++)
					{
						int num59 = Dust.NewDust(base.Center - velocity / 2f, 0, 0, 182, 0f, 0f, 100, default(Color), 1.4f);
						Main.dust[num59].velocity *= 0.2f;
						Main.dust[num59].velocity += velocity / 10f;
						Main.dust[num59].noGravity = true;
					}
				}
				if (localAI[0] > num56)
				{
					localAI[0] = num56;
				}
			}
			else
			{
				localAI[0] -= num57;
				if (localAI[0] <= 0f)
				{
					Kill();
					return;
				}
			}
		}
		if (type == 438)
		{
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.4f, 0.1f, 0.2f);
		}
		if (type == 593)
		{
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.4f, 0.1f, 0.3f);
			if (++frameCounter >= 12)
			{
				if (++frame >= Main.projFrames[type])
				{
					frame = 0;
				}
				frameCounter = 0;
			}
			if (Main.rand.Next(2) == 0)
			{
				Vector2 vector17 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
				Dust obj3 = Main.dust[Dust.NewDust(base.Center - vector17 * 8f, 0, 0, 240)];
				obj3.noGravity = true;
				obj3.position = base.Center - vector17 * 8f * scale;
				obj3.velocity = vector17.RotatedBy(-1.5707963705062866) * 2f;
				obj3.velocity = Vector2.Zero;
				obj3.scale = 0.5f + Main.rand.NextFloat();
				obj3.fadeIn = 0.5f;
			}
		}
		if (type == 592)
		{
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.15f, 0.15f, 0.4f);
		}
		if (type == 462)
		{
			int num60 = Dust.NewDust(base.Center, 0, 0, 229, 0f, 0f, 100);
			Main.dust[num60].noLight = true;
			Main.dust[num60].noGravity = true;
			Main.dust[num60].velocity = velocity;
			Main.dust[num60].position -= Vector2.One * 4f;
			Main.dust[num60].scale = 0.8f;
			if (++frameCounter >= 9)
			{
				frameCounter = 0;
				if (++frame >= 5)
				{
					frame = 0;
				}
			}
		}
		if (type == 437)
		{
			if (ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item12, position);
			}
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				for (int num61 = 0; num61 < 4; num61++)
				{
					int num62 = Dust.NewDust(position, width, height, 226, velocity.X);
					Main.dust[num62].position = Vector2.Lerp(Main.dust[num62].position, base.Center, 0.25f);
					Main.dust[num62].scale = 0.5f;
					Main.dust[num62].noGravity = true;
					Main.dust[num62].velocity /= 2f;
					Main.dust[num62].velocity += velocity * 0.66f;
				}
			}
			if (ai[0] < 16f)
			{
				for (int num63 = 0; num63 < 2; num63++)
				{
					int num64 = Dust.NewDust(position, width, height, 226, velocity.X);
					Main.dust[num64].position = position + new Vector2(((direction == 1) ? 1 : 0) * width, 2 + (height - 4) * num63);
					Main.dust[num64].scale = 0.3f;
					Main.dust[num64].noGravity = true;
					Main.dust[num64].velocity = Vector2.Zero;
				}
			}
		}
		if (type == 435)
		{
			if (ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item12, position);
			}
			alpha -= 40;
			if (alpha < 0)
			{
				alpha = 0;
			}
			spriteDirection = direction;
			frameCounter++;
			if (frameCounter >= 3)
			{
				frame++;
				frameCounter = 0;
				if (frame >= 4)
				{
					frame = 0;
				}
			}
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.3f, 0.8f, 1.1f);
		}
		if (type == 682)
		{
			if (ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.DD2_LightningBugZap, position);
				for (int num65 = 0; num65 < 8; num65++)
				{
					Dust dust = Dust.NewDustDirect(position, width, height, 272);
					dust.velocity *= 1f;
					dust.velocity += velocity * 0.65f;
					dust.scale = 0.6f;
					dust.fadeIn = 0.8f;
					dust.noGravity = true;
					dust.noLight = true;
					dust.position += dust.velocity * 3f;
				}
			}
			alpha -= 40;
			if (alpha < 0)
			{
				alpha = 0;
			}
			spriteDirection = direction;
			frameCounter++;
			if (frameCounter >= 3)
			{
				frame++;
				frameCounter = 0;
				if (frame >= 4)
				{
					frame = 0;
				}
			}
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.5f, 0.2f, 1.1f);
		}
		if (type == 684)
		{
			alpha -= 40;
			if (alpha < 0)
			{
				alpha = 0;
			}
			spriteDirection = direction;
			localAI[0] += 1f;
			for (int num66 = 0; num66 < 1; num66++)
			{
				Vector2 spinningpoint4 = Utils.RandomVector2(Main.rand, -0.5f, 0.5f) * new Vector2(20f, 80f);
				spinningpoint4 = spinningpoint4.RotatedBy(velocity.ToRotation());
				Dust dust2 = Dust.NewDustDirect(base.Center, 0, 0, 60);
				dust2.alpha = 127;
				dust2.fadeIn = 1.5f;
				dust2.scale = 1.3f;
				dust2.velocity *= 0.3f;
				dust2.position = base.Center + spinningpoint4;
				dust2.noGravity = true;
				dust2.noLight = true;
				dust2.color = new Color(255, 255, 255, 0);
			}
			Lighting.AddLight(base.Center, 1.1f, 0.3f, 0.4f);
		}
		if (type == 408)
		{
			alpha -= 40;
			if (alpha < 0)
			{
				alpha = 0;
			}
			spriteDirection = direction;
		}
		if (type == 282)
		{
			int num67 = Dust.NewDust(position, width, height, 171, 0f, 0f, 100);
			Main.dust[num67].scale = (float)Main.rand.Next(1, 10) * 0.1f;
			Main.dust[num67].noGravity = true;
			Main.dust[num67].fadeIn = 1.5f;
			Main.dust[num67].velocity *= 0.25f;
			Main.dust[num67].velocity += velocity * 0.25f;
		}
		if (type == 275 || type == 276)
		{
			frameCounter++;
			if (frameCounter > 1)
			{
				frameCounter = 0;
				frame++;
				if (frame > 1)
				{
					frame = 0;
				}
			}
		}
		if (type == 225 && Main.rand.Next(2) == 0)
		{
			int num68 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 40);
			Main.dust[num68].noGravity = true;
			Main.dust[num68].scale = 1.3f;
			Main.dust[num68].velocity *= 0.5f;
		}
		if (type == 174)
		{
			if (alpha == 0)
			{
				int num69 = Dust.NewDust(oldPosition - velocity * 3f, width, height, 76, 0f, 0f, 50);
				Main.dust[num69].noGravity = true;
				Main.dust[num69].noLight = true;
				Main.dust[num69].velocity *= 0.5f;
			}
			alpha -= 50;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item17, position);
			}
		}
		else if (type == 605 || type == 920 || type == 921 || type == 926 || type == 937)
		{
			if (type == 920 && frameCounter == 0)
			{
				frameCounter = 1;
				frame = Main.rand.Next(3);
			}
			if (type != 920 && type != 921 && alpha == 0 && Main.rand.Next(3) == 0)
			{
				int num70 = 4;
				Color newColor = new Color(78, 136, 255, 150);
				float num71 = 1.2f;
				bool noGravity = true;
				int num72 = 0;
				if (type == 921)
				{
					num70 = 243;
					newColor = default(Color);
				}
				if (type == 926)
				{
					num70 = 4;
					newColor = NPC.AI_121_QueenSlime_GetDustColor();
					newColor.A = 150;
					num71 = 1.2f;
					num72 = 8;
					noGravity = Main.rand.Next(2) == 0;
				}
				if (type == 937)
				{
					num70 = 4;
					newColor = NPC.AI_121_QueenSlime_GetDustColor();
					newColor.A = 150;
				}
				int num73 = Dust.NewDust(position - new Vector2(num72, num72) + velocity, width + num72 * 2, height + num72 * 2, num70, 0f, 0f, 50, newColor, num71);
				Main.dust[num73].velocity *= 0.3f;
				Main.dust[num73].velocity += velocity * 0.3f;
				Main.dust[num73].noGravity = noGravity;
			}
			alpha -= 50;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (type != 937 && ai[1] == 0f)
			{
				ai[1] = 1f;
				if (type == 926)
				{
					SoundEngine.PlaySound(SoundID.Item155, position);
				}
				else
				{
					SoundEngine.PlaySound(SoundID.Item154, position);
				}
			}
		}
		else if (type == 176)
		{
			if (alpha == 0)
			{
				int num74 = Dust.NewDust(oldPosition, width, height, 22, 0f, 0f, 100, default(Color), 0.5f);
				Main.dust[num74].noGravity = true;
				Main.dust[num74].noLight = true;
				Main.dust[num74].velocity *= 0.15f;
				Main.dust[num74].fadeIn = 0.8f;
			}
			alpha -= 50;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item17, position);
			}
		}
		if (type == 350)
		{
			alpha -= 100;
			if (alpha < 0)
			{
				alpha = 0;
			}
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.9f, 0.6f, 0.2f);
			if (alpha == 0)
			{
				int num75 = 2;
				if (Main.rand.Next(3) != 0)
				{
					int num76 = Dust.NewDust(new Vector2(base.Center.X - (float)num75, base.Center.Y - (float)num75 - 2f) - velocity * 0.5f, num75 * 2, num75 * 2, 6, 0f, 0f, 100);
					Main.dust[num76].scale *= 1.3f + (float)Main.rand.Next(10) * 0.05f;
					Main.dust[num76].velocity *= 0.2f;
					Main.dust[num76].noGravity = true;
					Main.dust[num76].noLight = true;
					Main.dust[num76].velocity += velocity * 0.25f;
				}
				if (Main.rand.Next(4) == 0)
				{
					int num77 = (num77 = Dust.NewDust(new Vector2(base.Center.X - (float)num75, base.Center.Y - (float)num75 - 2f) - velocity * 0.5f, num75 * 2, num75 * 2, 31, 0f, 0f, 100, default(Color), 0.5f));
					Main.dust[num77].fadeIn = 0.6f + (float)Main.rand.Next(5) * 0.1f;
					Main.dust[num77].velocity *= 0.05f;
					Main.dust[num77].velocity += velocity * 0.25f;
				}
			}
			if (ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item42, position);
			}
		}
		if (type == 325)
		{
			alpha -= 100;
			if (alpha < 0)
			{
				alpha = 0;
			}
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.9f, 0.6f, 0.2f);
			if (alpha == 0)
			{
				int num78 = 2;
				if (Main.rand.Next(3) != 0)
				{
					int num79 = Dust.NewDust(new Vector2(base.Center.X - (float)num78, base.Center.Y - (float)num78 - 2f) - velocity * 0.5f, num78 * 2, num78 * 2, 6, 0f, 0f, 100);
					Main.dust[num79].scale *= 1.2f + (float)Main.rand.Next(10) * 0.05f;
					Main.dust[num79].velocity *= 0.2f;
					Main.dust[num79].noGravity = true;
					Main.dust[num79].noLight = true;
					Main.dust[num79].velocity += velocity * 0.25f;
				}
				if (Main.rand.Next(4) == 0)
				{
					int num80 = (num80 = Dust.NewDust(new Vector2(base.Center.X - (float)num78, base.Center.Y - (float)num78 - 2f) - velocity * 0.5f, num78 * 2, num78 * 2, 31, 0f, 0f, 100, default(Color), 0.5f));
					Main.dust[num80].fadeIn = 0.5f + (float)Main.rand.Next(5) * 0.05f;
					Main.dust[num80].velocity *= 0.05f;
				}
			}
			if (ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item42, position);
			}
		}
		if (type == 469)
		{
			localAI[1] += 1f;
			if (localAI[1] > 2f)
			{
				alpha -= 50;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
		}
		else if (type == 1023 && ai[1] == 0f)
		{
			ai[1] = 1f;
			Vector2 vector18 = Main.player[owner].velocity;
			float num81 = Utils.Remap(vector18.Length(), 0f, 3f, 0f, 0.5f);
			Vector2 vector19 = base.Center + velocity.SafeNormalize(Vector2.Zero) * 54f;
			vector19 += new Vector2(0f, -4f) * Main.player[owner].Directions;
			for (int num82 = 0; num82 < 25; num82++)
			{
				Dust dust3 = Dust.NewDustDirect(vector19, 16, 8, 31, velocity.X, velocity.Y, 50, default(Color), 1f + Main.rand.NextFloat() * 0.3f);
				dust3.position = vector19;
				dust3.position += new Vector2(0f, Main.rand.NextFloatDirection() * 10f).RotatedBy(velocity.ToRotation());
				dust3.velocity = (velocity * (0.2f + num81)).RotatedByRandom(0.19634954631328583) + vector18 * 0.25f;
				dust3.velocity *= 3f;
				dust3.velocity *= Main.rand.NextFloat();
				dust3.fadeIn = 0.1f;
				dust3.position -= dust3.velocity;
				dust3.noGravity = true;
			}
		}
		else if (type == 83 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item33, position);
		}
		else if (type == 408 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(4, (int)position.X, (int)position.Y, 19);
		}
		else if (type == 259 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item33, position);
		}
		else if (type == 110 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item11, position);
		}
		else if (type == 302 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item11, position);
		}
		else if (type == 438 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item12, position);
		}
		else if (type == 593 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item11, position);
		}
		else if (type == 592 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item12, position);
		}
		else if (type == 462 && ai[1] == 0f)
		{
			ai[1] = 1f;
			if (Main.rand.Next(2) == 0)
			{
				SoundEngine.PlaySound(SoundID.Item124, position);
			}
			else
			{
				SoundEngine.PlaySound(SoundID.Item125, position);
			}
			Vector2 vector20 = Vector2.Normalize(velocity);
			int num83 = Main.rand.Next(5, 10);
			for (int num84 = 0; num84 < num83; num84++)
			{
				int num85 = Dust.NewDust(base.Center, 0, 0, 229, 0f, 0f, 100);
				Main.dust[num85].velocity.Y -= 1f;
				Main.dust[num85].velocity += vector20 * 2f;
				Main.dust[num85].position -= Vector2.One * 4f;
				Main.dust[num85].noGravity = true;
			}
		}
		else if (type == 84 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item12, position);
		}
		else if (type == 389 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item12, position);
		}
		else if (type == 257 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item12, position);
		}
		else if (type == 100 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item33, position);
		}
		else if (type == 98 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item17, position);
		}
		else if (type == 1073 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item17, position);
		}
		else if (type == 184 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item17, position);
		}
		else if (type == 980 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item17, position);
		}
		else if (type == 195 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item17, position);
		}
		else if (type == 1097 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item20, position);
		}
		else if (type == 275 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item17, position);
		}
		else if (type == 276 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item17, position);
		}
		else if ((type == 81 || type == 82) && ai[1] == 0f)
		{
			SoundEngine.PlaySound(SoundID.Item5, position);
			ai[1] = 1f;
		}
		else if (type == 180 && ai[1] == 0f)
		{
			SoundEngine.PlaySound(SoundID.Item11, position);
			ai[1] = 1f;
		}
		else if (type == 248 && ai[1] == 0f)
		{
			SoundEngine.PlaySound(SoundID.Item17, position);
			ai[1] = 1f;
		}
		else if (type == 576 && ai[1] == 0f)
		{
			ai[1] = 1f;
			SoundEngine.PlaySound(SoundID.Item12, position);
		}
		else if (type == 577 && soundDelay == 0)
		{
			soundDelay = -1;
			SoundEngine.PlaySound(SoundID.Item36, position);
			for (int num86 = 0; num86 < 5; num86++)
			{
				Vector2 center4 = base.Center;
				int num87 = ((num86 != 0) ? 3 : 0);
				float num88 = ((num86 == 0) ? (12f + 8f * Main.rand.NextFloat()) : (12f * Main.rand.NextFloat()));
				Vector2 vector21 = velocity.SafeNormalize(Vector2.Zero) * num88 + Main.rand.NextVector2Circular(1f, 1f) * num87;
				Dust obj4 = Main.dust[Dust.NewDust(center4, 8, 8, 229, 0f, 0f, 100, Color.Transparent, 1f + Main.rand.NextFloat() * 0.5f)];
				obj4.noGravity = true;
				obj4.velocity = vector21;
				obj4.position = center4;
			}
		}
		else if (type == 710)
		{
			alpha -= 25;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (Main.rand.Next(4) == 0)
			{
				int num89;
				if (Main.rand.Next(2) == 0)
				{
					num89 = Dust.NewDust(position, width, height, 31, 0f, 0f, 100, default(Color), 1.6f);
					Main.dust[num89].noGravity = true;
				}
				num89 = Dust.NewDust(position, width, height, 6, 0f, 0f, 100, default(Color), 1.2f);
				Main.dust[num89].noGravity = true;
				Main.dust[num89].velocity *= 2f;
				Main.dust[num89].velocity += velocity;
				if (ai[1] == -1f)
				{
					Main.dust[num89].fadeIn = 1.5f;
				}
				else
				{
					Main.dust[num89].fadeIn = 1.22f;
				}
				if (wet)
				{
					Kill();
				}
			}
		}
		else if (type == 639)
		{
			if (localAI[0] == 0f && localAI[1] == 0f)
			{
				localAI[0] = base.Center.X;
				localAI[1] = base.Center.Y;
				ai[0] = velocity.X;
				ai[1] = velocity.Y;
			}
			alpha -= 25;
			if (alpha < 0)
			{
				alpha = 0;
			}
		}
		else if (type == 640)
		{
			alpha -= 25;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (velocity == Vector2.Zero)
			{
				ai[0] = 0f;
				bool flag = true;
				for (int num90 = 1; num90 < oldPos.Length; num90++)
				{
					if (oldPos[num90] != oldPos[0])
					{
						flag = false;
					}
				}
				if (flag)
				{
					Kill();
					return;
				}
				if (Main.rand.Next(extraUpdates) == 0 && (velocity != Vector2.Zero || Main.rand.Next((localAI[1] == 2f) ? 2 : 6) == 0))
				{
					for (int num91 = 0; num91 < 2; num91++)
					{
						float num92 = rotation + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * ((float)Math.PI / 2f);
						float num93 = (float)Main.rand.NextDouble() * 0.8f + 1f;
						Vector2 vector22 = new Vector2((float)Math.Cos(num92) * num93, (float)Math.Sin(num92) * num93);
						int num94 = Dust.NewDust(base.Center, 0, 0, 229, vector22.X, vector22.Y);
						Main.dust[num94].noGravity = true;
						Main.dust[num94].scale = 1.2f;
					}
					if (Main.rand.Next(10) == 0)
					{
						Vector2 vector23 = velocity.RotatedBy(1.5707963705062866) * ((float)Main.rand.NextDouble() - 0.5f) * width;
						int num95 = Dust.NewDust(base.Center + vector23 - Vector2.One * 4f, 8, 8, 31, 0f, 0f, 100, default(Color), 1.5f);
						Main.dust[num95].velocity *= 0.5f;
						Main.dust[num95].velocity.Y = 0f - Math.Abs(Main.dust[num95].velocity.Y);
					}
				}
			}
			else if (numUpdates == 1)
			{
				float num96 = rotation + (float)Math.PI / 2f + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * ((float)Math.PI / 2f);
				float num97 = (float)Main.rand.NextDouble() * 0.25f + 0.25f;
				Vector2 vector24 = new Vector2((float)Math.Cos(num96) * num97, (float)Math.Sin(num96) * num97);
				int num98 = Dust.NewDust(position, 0, 0, 229, vector24.X, vector24.Y);
				Main.dust[num98].noGravity = true;
				Main.dust[num98].scale = 1.2f;
			}
		}
		if (type == 41)
		{
			int num99 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.6f);
			Main.dust[num99].noGravity = true;
			num99 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2f);
			Main.dust[num99].noGravity = true;
		}
		else if (type == 55)
		{
			int num100 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 18, 0f, 0f, 0, default(Color), 0.9f);
			Main.dust[num100].noGravity = true;
		}
		else if (type == 719)
		{
			if (Main.rand.Next(2) == 0)
			{
				Dust.NewDustDirect(position - velocity, width, height, 147, 0f, 0f, 0, default(Color), 0.9f).noGravity = true;
			}
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				for (int num101 = 0; num101 < 20; num101++)
				{
					Dust dust4 = Dust.NewDustDirect(position - velocity, width, height, 147, 0f, 0f, 0, default(Color), 1.3f);
					dust4.noGravity = true;
					dust4.velocity += velocity * 0.75f;
				}
				for (int num102 = 0; num102 < 10; num102++)
				{
					Dust dust5 = Dust.NewDustDirect(position - velocity, width, height, 147, 0f, 0f, 0, default(Color), 1.3f);
					dust5.noGravity = true;
					dust5.velocity *= 2f;
				}
			}
		}
		else if (type == 763)
		{
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				for (int num103 = 0; num103 < 5; num103++)
				{
					Dust dust6 = Dust.NewDustDirect(position - velocity, width, height, 40, 0f, 0f, 0, default(Color), 1.1f);
					dust6.noGravity = true;
					dust6.velocity *= 1.5f;
				}
			}
		}
		else if (type == 772)
		{
			if (Main.rand.Next(7) == 0)
			{
				for (int num104 = 0; num104 < 1; num104++)
				{
					Dust dust7 = Dust.NewDustDirect(position - velocity, width, height, Main.rand.NextFromList<int>(86, 87, 88, 89, 90, 91, 138), 0f, 0f, 0, default(Color), 0.7f);
					dust7.noGravity = true;
					dust7.velocity = velocity * 0.6f;
					dust7.fadeIn = 0.8f;
				}
			}
		}
		else if (type == 374)
		{
			if (localAI[0] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item17, position);
				localAI[0] = 1f;
			}
			if (Main.rand.Next(2) == 0)
			{
				int num105 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 18, 0f, 0f, 0, default(Color), 0.9f);
				Main.dust[num105].noGravity = true;
				Main.dust[num105].velocity *= 0.5f;
			}
		}
		else if (type == 376)
		{
			if (localAI[0] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item20, position);
			}
			localAI[0] += 1f;
			if (localAI[0] > 3f)
			{
				int num106 = 1;
				if (localAI[0] > 5f)
				{
					num106 = 2;
				}
				for (int num107 = 0; num107 < num106; num107++)
				{
					int num108 = Dust.NewDust(new Vector2(position.X, position.Y + 2f), width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
					Main.dust[num108].noGravity = true;
					Main.dust[num108].velocity.X *= 0.3f;
					Main.dust[num108].velocity.Y *= 0.3f;
					Main.dust[num108].noLight = true;
				}
				if (wet && !lavaWet)
				{
					Kill();
					return;
				}
			}
		}
		else if (type == 91 && Main.rand.Next(2) == 0)
		{
			int num109 = Dust.NewDust(Type: (Main.rand.Next(2) != 0) ? 58 : 15, Position: position, Width: width, Height: height, SpeedX: velocity.X * 0.25f, SpeedY: velocity.Y * 0.25f, Alpha: 150, newColor: default(Color), Scale: 0.9f);
			Main.dust[num109].velocity *= 0.25f;
		}
		if (type == 163 || type == 310 || type == 1008 || type == 1010 || type == 1009 || type == 1011)
		{
			if (alpha > 0)
			{
				alpha -= 25;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
		}
		switch (type)
		{
		case 14:
		case 20:
		case 36:
		case 83:
		case 84:
		case 89:
		case 100:
		case 104:
		case 110:
		case 158:
		case 159:
		case 160:
		case 161:
		case 180:
		case 279:
		case 283:
		case 284:
		case 285:
		case 286:
		case 287:
		case 389:
			if (alpha > 0)
			{
				alpha -= 15;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
			break;
		case 576:
		case 577:
			localAI[1] += 1f;
			if (localAI[1] > 2f)
			{
				if (alpha > 0)
				{
					alpha -= 15;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			break;
		}
		if (type == 484)
		{
			int num110 = Dust.NewDust(position, width, height, 78);
			Main.dust[num110].noGravity = true;
			Main.dust[num110].velocity *= 0.1f;
			Main.dust[num110].scale = 0.75f;
			Main.dust[num110].position = (Main.dust[num110].position + base.Center) / 2f;
			Main.dust[num110].position += velocity * Main.rand.Next(0, 101) * 0.01f;
		}
		if (type == 242 || type == 302 || type == 438 || type == 462 || type == 592)
		{
			float num111 = (float)Math.Sqrt(velocity.X * velocity.X + velocity.Y * velocity.Y);
			if (alpha > 0)
			{
				alpha -= (byte)((double)num111 * 0.9);
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
		}
		if (type == 660)
		{
			DelegateMethods.v3_1 = new Vector3(0.6f, 1f, 1f) * 0.2f;
			Utils.PlotTileLine(base.Center, base.Center + velocity * 10f, 8f, DelegateMethods.CastLightOpen);
			if (alpha > 0)
			{
				SoundEngine.PlaySound(SoundID.Item9, base.Center);
				alpha = 0;
				scale = 1.1f;
				frame = Main.rand.Next(14);
				float num112 = 16f;
				for (int num113 = 0; (float)num113 < num112; num113++)
				{
					Vector2 spinningpoint5 = Vector2.UnitX * 0f;
					spinningpoint5 += -Vector2.UnitY.RotatedBy((float)num113 * ((float)Math.PI * 2f / num112)) * new Vector2(1f, 4f);
					spinningpoint5 = spinningpoint5.RotatedBy(velocity.ToRotation());
					int num114 = Dust.NewDust(base.Center, 0, 0, 180);
					Main.dust[num114].scale = 1.5f;
					Main.dust[num114].noGravity = true;
					Main.dust[num114].position = base.Center + spinningpoint5;
					Main.dust[num114].velocity = velocity * 0f + spinningpoint5.SafeNormalize(Vector2.UnitY) * 1f;
				}
			}
		}
		if (type == 712)
		{
			DelegateMethods.v3_1 = new Vector3(0.4f, 0.4f, 0.4f) * 0.7f;
			Utils.PlotTileLine(base.Center, base.Center + velocity * 10f, 8f, DelegateMethods.CastLightOpen);
			if (alpha == 255)
			{
				frame = Main.rand.Next(2) * 4;
			}
			if (++frameCounter >= 4)
			{
				frameCounter = 0;
				frame++;
				if (frame == 4)
				{
					frame = 0;
				}
				if (frame >= 8)
				{
					frame = 4;
				}
			}
			if (alpha > 0)
			{
				alpha = 0;
				scale = 1.1f;
				frame = Main.rand.Next(14);
				float num115 = 4f;
				for (int num116 = 0; (float)num116 < num115; num116++)
				{
					Vector2 spinningpoint6 = Vector2.UnitX * 0f;
					spinningpoint6 += -Vector2.UnitY.RotatedBy((float)num116 * ((float)Math.PI * 2f / num115)) * new Vector2(1f, 4f);
					spinningpoint6 = spinningpoint6.RotatedBy(velocity.ToRotation());
					int num117 = Dust.NewDust(base.Center, 0, 0, 15);
					Main.dust[num117].scale = 1.7f;
					Main.dust[num117].noGravity = true;
					Main.dust[num117].position = base.Center + spinningpoint6 + velocity.SafeNormalize(Vector2.Zero) * 50f;
					Main.dust[num117].velocity = Main.dust[num117].velocity * 2f + spinningpoint6.SafeNormalize(Vector2.UnitY) * 0.3f + velocity.SafeNormalize(Vector2.Zero) * 3f;
					Main.dust[num117].velocity *= 0.7f;
					Main.dust[num117].position += Main.dust[num117].velocity * 5f;
				}
			}
		}
		if (type == 661)
		{
			if (alpha <= 0)
			{
				for (int num118 = 0; num118 < 3; num118++)
				{
					int num119 = Dust.NewDust(position, width, height, 240);
					Main.dust[num119].noGravity = true;
					Main.dust[num119].velocity *= 0.3f;
					Main.dust[num119].noLight = true;
				}
			}
			if (alpha > 0)
			{
				alpha -= 55;
				scale = 1.3f;
				if (alpha < 0)
				{
					alpha = 0;
					float num120 = 16f;
					for (int num121 = 0; (float)num121 < num120; num121++)
					{
						Vector2 spinningpoint7 = Vector2.UnitX * 0f;
						spinningpoint7 += -Vector2.UnitY.RotatedBy((float)num121 * ((float)Math.PI * 2f / num120)) * new Vector2(1f, 4f);
						spinningpoint7 = spinningpoint7.RotatedBy(velocity.ToRotation());
						int num122 = Dust.NewDust(base.Center, 0, 0, 62);
						Main.dust[num122].scale = 1.5f;
						Main.dust[num122].noLight = true;
						Main.dust[num122].noGravity = true;
						Main.dust[num122].position = base.Center + spinningpoint7;
						Main.dust[num122].velocity = Main.dust[num122].velocity * 4f + velocity * 0.3f;
					}
				}
			}
		}
		if (type == 706)
		{
			if (wet)
			{
				Kill();
				return;
			}
			if (localAI[1] == 0f)
			{
				localAI[0] = SoundEngine.PlayTrackedSound(SoundID.DD2_PhantomPhoenixShot, base.Center).ToFloat();
				localAI[1] += 1f;
				for (int num123 = 0; num123 < 15; num123++)
				{
					if (Main.rand.Next(4) != 0)
					{
						Dust dust8 = Dust.NewDustDirect(base.Center - base.Size / 4f, width / 2, height / 2, Utils.SelectRandom<int>(Main.rand, 6, 31, 31));
						dust8.noGravity = true;
						dust8.velocity *= 2.3f;
						dust8.fadeIn = 1.5f;
						dust8.noLight = true;
					}
				}
			}
			ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[0]));
			if (activeSound != null)
			{
				activeSound.Position = base.Center;
			}
			else
			{
				localAI[0] = SlotId.Invalid.ToFloat();
			}
			if (alpha <= 0)
			{
				for (int num124 = 0; num124 < 2; num124++)
				{
					if (Main.rand.Next(4) != 0)
					{
						Dust dust9 = Dust.NewDustDirect(base.Center - base.Size / 4f, width / 2, height / 2, Utils.SelectRandom<int>(Main.rand, 6, 31, 31));
						dust9.noGravity = true;
						dust9.velocity *= 2.3f;
						dust9.fadeIn = 1.5f;
						dust9.noLight = true;
					}
				}
				Vector2 spinningpoint8 = new Vector2(0f, (float)Math.Cos((float)frameCounter * ((float)Math.PI * 2f) / 40f - (float)Math.PI / 2f)) * 16f;
				spinningpoint8 = spinningpoint8.RotatedBy(rotation);
				Vector2 vector25 = velocity.SafeNormalize(Vector2.Zero);
				for (int num125 = 0; num125 < 1; num125++)
				{
					Dust dust10 = Dust.NewDustDirect(base.Center - base.Size / 4f, width / 2, height / 2, 6);
					dust10.noGravity = true;
					dust10.position = base.Center + spinningpoint8;
					dust10.velocity *= 0f;
					dust10.fadeIn = 1.4f;
					dust10.scale = 1.15f;
					dust10.noLight = true;
					dust10.position += velocity * 1.2f;
					dust10.velocity += vector25 * 2f;
					Dust dust11 = Dust.NewDustDirect(base.Center - base.Size / 4f, width / 2, height / 2, 6);
					dust11.noGravity = true;
					dust11.position = base.Center + spinningpoint8;
					dust11.velocity *= 0f;
					dust11.fadeIn = 1.4f;
					dust11.scale = 1.15f;
					dust11.noLight = true;
					dust11.position += velocity * 0.5f;
					dust11.position += velocity * 1.2f;
					dust11.velocity += vector25 * 2f;
				}
			}
			if (++frameCounter >= 40)
			{
				frameCounter = 0;
			}
			frame = frameCounter / 5;
			if (alpha > 0)
			{
				alpha -= 55;
				if (alpha < 0)
				{
					alpha = 0;
					float num126 = 16f;
					for (int num127 = 0; (float)num127 < num126; num127++)
					{
						Vector2 spinningpoint9 = Vector2.UnitX * 0f;
						spinningpoint9 += -Vector2.UnitY.RotatedBy((float)num127 * ((float)Math.PI * 2f / num126)) * new Vector2(1f, 4f);
						spinningpoint9 = spinningpoint9.RotatedBy(velocity.ToRotation());
						int num128 = Dust.NewDust(base.Center, 0, 0, 6);
						Main.dust[num128].scale = 1.5f;
						Main.dust[num128].noLight = true;
						Main.dust[num128].noGravity = true;
						Main.dust[num128].position = base.Center + spinningpoint9;
						Main.dust[num128].velocity = Main.dust[num128].velocity * 4f + velocity * 0.3f;
					}
				}
			}
			DelegateMethods.v3_1 = new Vector3(1f, 0.6f, 0.2f);
			Utils.PlotTileLine(base.Center, base.Center + velocity * 4f, 40f, DelegateMethods.CastLightOpen);
		}
		if (type == 638)
		{
			float num129 = velocity.Length();
			if (alpha > 0)
			{
				alpha -= (byte)((double)num129 * 0.3);
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
			Rectangle hitbox = base.Hitbox;
			hitbox.Offset((int)velocity.X, (int)velocity.Y);
			bool flag2 = false;
			for (int num130 = 0; num130 < Main.maxNPCs; num130++)
			{
				NPC nPC = Main.npc[num130];
				if (nPC.active && !nPC.dontTakeDamage && nPC.immune[owner] == 0 && localNPCImmunity[num130] == 0 && nPC.Hitbox.Intersects(hitbox) && !nPC.friendly)
				{
					flag2 = true;
					break;
				}
			}
			if (flag2)
			{
				int num131 = Main.rand.Next(15, 31);
				for (int num132 = 0; num132 < num131; num132++)
				{
					int num133 = Dust.NewDust(base.Center, 0, 0, 229, 0f, 0f, 100, default(Color), 0.8f);
					Main.dust[num133].velocity *= 1.6f;
					Main.dust[num133].velocity.Y -= 1f;
					Main.dust[num133].velocity += velocity;
					Main.dust[num133].noGravity = true;
				}
			}
		}
		if (type == 257 || type == 593)
		{
			if (alpha > 0)
			{
				alpha -= 10;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
		}
		if (type == 876)
		{
			if (ai[1] == 0f)
			{
				tileCollide = true;
			}
			else
			{
				tileCollide = false;
			}
			if (alpha > 0)
			{
				alpha -= 10;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
		}
		if (type == 88)
		{
			if (alpha > 0)
			{
				alpha -= 10;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
		}
		if (type == 532)
		{
			ai[0] += 1f;
		}
		bool flag3 = true;
		bool flag4 = false;
		switch (type)
		{
		case 5:
		case 14:
		case 20:
		case 36:
		case 38:
		case 55:
		case 83:
		case 84:
		case 88:
		case 89:
		case 98:
		case 100:
		case 104:
		case 110:
		case 158:
		case 159:
		case 160:
		case 161:
		case 180:
		case 184:
		case 242:
		case 248:
		case 257:
		case 259:
		case 265:
		case 270:
		case 279:
		case 283:
		case 284:
		case 285:
		case 286:
		case 287:
		case 299:
		case 302:
		case 323:
		case 325:
		case 348:
		case 349:
		case 350:
		case 355:
		case 374:
		case 376:
		case 389:
		case 435:
		case 436:
		case 438:
		case 440:
		case 442:
		case 449:
		case 459:
		case 462:
		case 467:
		case 468:
		case 469:
		case 472:
		case 483:
		case 484:
		case 485:
		case 498:
		case 576:
		case 577:
		case 585:
		case 592:
		case 593:
		case 601:
		case 606:
		case 616:
		case 634:
		case 635:
		case 638:
		case 639:
		case 660:
		case 661:
		case 682:
		case 684:
		case 706:
		case 709:
		case 710:
		case 712:
		case 876:
		case 980:
		case 981:
		case 1073:
			flag3 = false;
			break;
		case 1006:
			flag4 = true;
			break;
		}
		if (flag3)
		{
			ai[0] += 1f;
		}
		if (type == 1006 && Main.rand.Next(8) == 0)
		{
			Vector2 value = velocity * 1.25f;
			if (wet)
			{
				value *= 0.5f;
			}
			Dust dust12 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(4f, 4f), 306, value, 0, Main.hslToRgb(Main.rand.NextFloat(), 1f, 0.5f), 1f + Main.rand.NextFloat() * 0.4f);
			dust12.noGravity = true;
			dust12.fadeIn = dust12.scale + 0.05f;
			Dust dust13 = Dust.CloneDust(dust12);
			dust13.color = Color.White;
			dust13.scale -= 0.3f;
		}
		if (type == 270)
		{
			int num134 = 0;
			num134 = Player.FindClosest(base.Center, 1, 1);
			ai[1] += 1f;
			if (ai[1] < 110f && ai[1] > 30f)
			{
				float num135 = velocity.Length();
				Vector2 vector26 = Main.player[num134].Center - base.Center;
				vector26.Normalize();
				vector26 *= num135;
				velocity = (velocity * 24f + vector26) / 25f;
				velocity.Normalize();
				velocity *= num135;
			}
			if (velocity.Length() < 18f)
			{
				velocity *= 1.02f;
			}
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlaySound(SoundID.Item8, position);
				for (int num136 = 0; num136 < 10; num136++)
				{
					int num137 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 5, velocity.X, velocity.Y, 0, default(Color), 2f);
					Main.dust[num137].noGravity = true;
					Main.dust[num137].velocity = base.Center - Main.dust[num137].position;
					Main.dust[num137].velocity.Normalize();
					Main.dust[num137].velocity *= -5f;
					Main.dust[num137].velocity += velocity / 2f;
				}
			}
		}
		if (type == 585)
		{
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlaySound(SoundID.Item8, position);
				for (int num138 = 0; num138 < 3; num138++)
				{
					int num139 = Dust.NewDust(position, width, height, 27, velocity.X, velocity.Y, 0, default(Color), 2f);
					Main.dust[num139].noGravity = true;
					Main.dust[num139].velocity = base.Center - Main.dust[num139].position;
					Main.dust[num139].velocity.Normalize();
					Main.dust[num139].velocity *= -5f;
					Main.dust[num139].velocity += velocity / 2f;
					Main.dust[num139].noLight = true;
				}
			}
			if (alpha > 0)
			{
				alpha -= 50;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
			frameCounter++;
			if (frameCounter >= 12)
			{
				frameCounter = 0;
			}
			frame = frameCounter / 2;
			if (frame > 3)
			{
				frame = 6 - frame;
			}
			Vector3 vector27 = NPCID.Sets.MagicAuraColor[54].ToVector3();
			Lighting.AddLight(base.Center, vector27.X, vector27.Y, vector27.Z);
			if (Main.rand.Next(3) == 0)
			{
				int num140 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, 27, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
				Main.dust[num140].position -= velocity * 2f;
				Main.dust[num140].noLight = true;
				Main.dust[num140].noGravity = true;
				Main.dust[num140].velocity.X *= 0.3f;
				Main.dust[num140].velocity.Y *= 0.3f;
			}
		}
		if (type == 594)
		{
			int num141 = (int)(43f - ai[1]) / 13;
			if (num141 < 1)
			{
				num141 = 1;
			}
			int num142 = ((ai[1] < 20f) ? 6 : 31);
			for (int num143 = 0; num143 < num141; num143++)
			{
				int num144 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, num142, velocity.X * 0.2f, velocity.Y * 0.2f, 0, default(Color), 2f);
				Main.dust[num144].position -= velocity * 2f;
				Main.dust[num144].noLight = true;
				Main.dust[num144].noGravity = true;
				Main.dust[num144].velocity.X *= 0.3f;
				Main.dust[num144].velocity.Y *= 0.3f;
				if (num142 == 6)
				{
					Main.dust[num144].fadeIn = Main.rand.NextFloat() * 2f;
				}
			}
			ai[1] += 1f;
			if (ai[1] > (float)(43 * MaxUpdates))
			{
				Kill();
				return;
			}
		}
		if (type == 622)
		{
			int num145 = 229;
			if (Main.rand.Next(3) != 0)
			{
				int num146 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, num145, velocity.X * 0.2f, velocity.Y * 0.2f, 0, default(Color), 1.2f);
				Main.dust[num146].position -= velocity * 2f;
				Main.dust[num146].noLight = true;
				Main.dust[num146].noGravity = true;
				Main.dust[num146].velocity.X *= 0.3f;
				Main.dust[num146].velocity.Y *= 0.3f;
			}
			ai[1] += 1f;
			if (ai[1] > (float)(23 * MaxUpdates))
			{
				Kill();
				return;
			}
		}
		if (type == 587)
		{
			Color newColor2 = Main.hslToRgb(ai[1], 1f, 0.5f);
			newColor2.A = 200;
			localAI[0] += 1f;
			if (!(localAI[0] < 2f))
			{
				if (localAI[0] == 2f)
				{
					SoundEngine.PlaySound(SoundID.Item5, position);
					for (int num147 = 0; num147 < 4; num147++)
					{
						int num148 = Dust.NewDust(position, width, height, 76, velocity.X, velocity.Y, 0, newColor2, 1.1f);
						Main.dust[num148].noGravity = true;
						Main.dust[num148].velocity = base.Center - Main.dust[num148].position;
						Main.dust[num148].velocity.Normalize();
						Main.dust[num148].velocity *= -3f;
						Main.dust[num148].velocity += velocity / 2f;
					}
				}
				else
				{
					frame++;
					if (frame > 2)
					{
						frame = 0;
					}
					for (int num149 = 0; num149 < 1; num149++)
					{
						int num150 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, 76, velocity.X * 0.2f, velocity.Y * 0.2f, 0, newColor2, 0.9f);
						Main.dust[num150].position = base.Center;
						Main.dust[num150].noGravity = true;
						Main.dust[num150].velocity = velocity * 0.5f;
					}
				}
			}
		}
		if (type == 349)
		{
			frame = (int)ai[0];
			velocity.Y += 0.2f;
			if (localAI[0] == 0f || localAI[0] == 2f)
			{
				scale += 0.01f;
				alpha -= 50;
				if (alpha <= 0)
				{
					localAI[0] = 1f;
					alpha = 0;
				}
			}
			else if (localAI[0] == 1f)
			{
				scale -= 0.01f;
				alpha += 50;
				if (alpha >= 255)
				{
					localAI[0] = 2f;
					alpha = 255;
				}
			}
		}
		if (type == 348)
		{
			if (localAI[1] == 0f)
			{
				localAI[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item8, position);
			}
			if (ai[0] == 0f || ai[0] == 2f)
			{
				scale += 0.01f;
				alpha -= 50;
				if (alpha <= 0)
				{
					ai[0] = 1f;
					alpha = 0;
				}
			}
			else if (ai[0] == 1f)
			{
				scale -= 0.01f;
				alpha += 50;
				if (alpha >= 255)
				{
					ai[0] = 2f;
					alpha = 255;
				}
			}
		}
		if (type == 572)
		{
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlaySound(SoundID.Item17, position);
			}
			for (int num151 = 0; num151 < 2; num151++)
			{
				int num152 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 40, velocity.X, velocity.Y, 100);
				Main.dust[num152].velocity *= 0.5f;
				Main.dust[num152].velocity += velocity;
				Main.dust[num152].velocity *= 0.5f;
				Main.dust[num152].noGravity = true;
				Main.dust[num152].scale = 1.2f;
				Main.dust[num152].position = (base.Center + position) / 2f;
			}
		}
		if (type == 577)
		{
			Lighting.AddLight(base.Center, 0.1f, 0.3f, 0.4f);
		}
		else if (type == 576)
		{
			Lighting.AddLight(base.Center, 0.4f, 0.2f, 0.4f);
			for (int num153 = 0; num153 < 5; num153++)
			{
				Dust obj5 = Main.dust[Dust.NewDust(position, width, height, 242, velocity.X, velocity.Y, 100)];
				obj5.velocity = Vector2.Zero;
				obj5.position -= velocity / 5f * num153;
				obj5.noGravity = true;
				obj5.scale = 0.8f;
				obj5.noLight = true;
			}
		}
		else if (type == 581)
		{
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlaySound(SoundID.Item17, base.Center);
			}
			for (int num154 = 0; num154 < 2; num154++)
			{
				int num155 = Utils.SelectRandom<int>(Main.rand, 229, 161, 161);
				Dust obj6 = Main.dust[Dust.NewDust(position, width, height, num155, velocity.X, velocity.Y, 100)];
				obj6.velocity = obj6.velocity / 4f + velocity / 2f;
				obj6.noGravity = true;
				obj6.scale = 1.2f;
				obj6.position = base.Center;
				obj6.noLight = true;
			}
		}
		else if (type == 671)
		{
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				for (int num156 = 0; num156 < 8; num156++)
				{
					int num157 = Utils.SelectRandom<int>(Main.rand, 27, 62);
					Dust obj7 = Main.dust[Dust.NewDust(position, width, height, num157, velocity.X, velocity.Y, 100)];
					obj7.velocity = (Main.rand.NextFloatDirection() * (float)Math.PI).ToRotationVector2() * 2f + velocity.SafeNormalize(Vector2.Zero) * 3f;
					obj7.noGravity = true;
					obj7.scale = 1.5f;
					obj7.fadeIn = 1.2f;
					obj7.position = base.Center;
					obj7.noLight = true;
				}
			}
			alpha -= 20;
			if (alpha < 0)
			{
				alpha = 0;
			}
			for (int num158 = 0; num158 < 2; num158++)
			{
				int num159 = Utils.SelectRandom<int>(Main.rand, 27, 27, 62);
				Dust obj8 = Main.dust[Dust.NewDust(position, width, height, num159, velocity.X, velocity.Y, 100)];
				obj8.velocity = obj8.velocity / 4f + velocity / 2f;
				obj8.noGravity = true;
				obj8.scale = 1.2f;
				obj8.position = base.Center;
				obj8.noLight = true;
			}
		}
		else if (type == 811)
		{
			if (localAI[0] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item17, base.Center);
				localAI[0] = 1f;
				for (int num160 = 0; num160 < 8; num160++)
				{
					Dust obj9 = Main.dust[Dust.NewDust(position, width, height, 5, velocity.X, velocity.Y, 100)];
					obj9.velocity = (Main.rand.NextFloatDirection() * (float)Math.PI).ToRotationVector2() * 2f + velocity.SafeNormalize(Vector2.Zero) * 3f;
					obj9.scale = 1.5f;
					obj9.fadeIn = 1.7f;
					obj9.position = base.Center;
				}
			}
			alpha -= 20;
			if (alpha < 0)
			{
				alpha = 0;
			}
			for (int num161 = 0; num161 < 2; num161++)
			{
				Dust obj10 = Main.dust[Dust.NewDust(position, width, height, 5, velocity.X, velocity.Y, 100)];
				obj10.velocity = obj10.velocity / 4f + velocity / 2f;
				obj10.scale = 1.2f;
				obj10.position = base.Center + Main.rand.NextFloat() * velocity * 2f;
			}
		}
		else if (type == 819)
		{
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				for (int num162 = 0; num162 < 8; num162++)
				{
					Dust obj11 = Main.dust[Dust.NewDust(position, width, height, 5, velocity.X, velocity.Y, 100)];
					obj11.velocity = (Main.rand.NextFloatDirection() * (float)Math.PI).ToRotationVector2() * 2f + velocity.SafeNormalize(Vector2.Zero) * 2f;
					obj11.scale = 0.9f;
					obj11.fadeIn = 1.3f;
					obj11.position = base.Center;
				}
			}
			alpha -= 20;
			if (alpha < 0)
			{
				alpha = 0;
			}
			for (int num163 = 1; num163 < 6; num163++)
			{
				Dust obj12 = Main.dust[Dust.NewDust(position, width, height, 5, 0f, 0f, 100)];
				obj12.velocity = obj12.velocity * 0.5f + velocity * 0.5f;
				obj12.velocity *= 0.25f;
				obj12.scale = 0.9f;
				obj12.position = base.Center - velocity * num163 / 5f;
			}
			if (Main.rand.Next(2) == 0)
			{
				Dust dust14 = Dust.NewDustPerfect(base.Center - velocity * 3f, 267, velocity * 0.5f, 0, Color.Red * (Main.rand.NextFloat() * 0.3f + 0.1f));
				dust14.noGravity = true;
				dust14.scale = 0.7f;
			}
			Lighting.AddLight(base.Center, 0.3f, 0.05f, 0.05f);
		}
		else if (type == 814)
		{
			if (localAI[0] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item171, base.Center);
				localAI[0] = 1f;
				for (int num164 = 0; num164 < 8; num164++)
				{
					Dust obj13 = Main.dust[Dust.NewDust(position, width, height, 5, velocity.X, velocity.Y, 100)];
					obj13.velocity = (Main.rand.NextFloatDirection() * (float)Math.PI).ToRotationVector2() * 2f + velocity.SafeNormalize(Vector2.Zero) * 2f;
					obj13.scale = 0.9f;
					obj13.fadeIn = 1.1f;
					obj13.position = base.Center;
				}
			}
			alpha -= 20;
			if (alpha < 0)
			{
				alpha = 0;
			}
			for (int num165 = 0; num165 < 2; num165++)
			{
				Dust obj14 = Main.dust[Dust.NewDust(position, width, height, 5, velocity.X, velocity.Y, 100)];
				obj14.velocity = obj14.velocity / 4f + velocity / 2f;
				obj14.scale = 1.2f;
				obj14.position = base.Center + Main.rand.NextFloat() * velocity * 2f;
			}
			for (int num166 = 1; num166 < oldPos.Length && !(oldPos[num166] == Vector2.Zero); num166++)
			{
				if (Main.rand.Next(3) == 0)
				{
					Dust obj15 = Main.dust[Dust.NewDust(oldPos[num166], width, height, 5, velocity.X, velocity.Y, 100)];
					obj15.velocity = obj15.velocity / 4f + velocity / 2f;
					obj15.scale = 1.2f;
					obj15.position = oldPos[num166] + base.Size / 2f + Main.rand.NextFloat() * velocity * 2f;
				}
			}
		}
		else if (type == 675)
		{
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlayTrackedSound(SoundID.DD2_DarkMageAttack, base.Center);
			}
			alpha -= 20;
			if (alpha < 0)
			{
				alpha = 0;
			}
		}
		else if (type == 676)
		{
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlaySound(SoundID.Item17, base.Center);
			}
			alpha -= 20;
			if (alpha < 0)
			{
				alpha = 0;
			}
			for (int num167 = 0; num167 < 2; num167++)
			{
				if (Main.rand.Next(5) != 0)
				{
					int num168 = Utils.SelectRandom<int>(Main.rand, 4, 256);
					Dust dust15 = Main.dust[Dust.NewDust(position, width, height, num168, velocity.X, velocity.Y, 100)];
					dust15.velocity = dust15.velocity / 4f + velocity / 2f;
					dust15.scale = 0.8f + Main.rand.NextFloat() * 0.4f;
					dust15.position = base.Center;
					dust15.position += new Vector2(width * 2, 0f).RotatedBy((float)Math.PI * 2f * Main.rand.NextFloat()) * Main.rand.NextFloat();
					dust15.noLight = true;
					if (dust15.type == 4)
					{
						dust15.color = new Color(80, 170, 40, 120);
					}
				}
			}
		}
		else if (type == 686)
		{
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlayTrackedSound(SoundID.DD2_BetsyFireballShot, base.Center);
			}
			if (ai[0] >= 2f)
			{
				alpha -= 25;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			if (Main.rand.Next(4) == 0)
			{
				Dust dust16 = Dust.NewDustDirect(position, width, height, 55, 0f, 0f, 200);
				dust16.scale *= 0.7f;
				dust16.velocity += velocity * 1f;
			}
			if (Main.rand.Next(3) == 0 && oldPos[9] != Vector2.Zero)
			{
				Dust dust17 = Dust.NewDustDirect(oldPos[9], width, height, 55, 0f, 0f, 50);
				dust17.scale *= 0.85f;
				dust17.velocity += velocity * 0.85f;
				dust17.color = Color.Purple;
			}
		}
		else if (type == 1097)
		{
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlayTrackedSound(SoundID.DD2_BetsyFireballShot, base.Center);
				for (int num169 = 0; num169 < 10; num169++)
				{
					Dust dust18 = Dust.NewDustDirect(position, width, height, 6, 0f, 0f, 200);
					dust18.scale *= 0.7f;
					dust18.velocity *= 0.5f;
					dust18.velocity += velocity * Main.rand.NextFloat() * 0.6f;
					dust18.noLightEmittence = true;
					Dust dust19 = Dust.NewDustDirect(position, width, height, 6, 0f, 0f, 50);
					dust19.scale *= 1.25f;
					dust19.velocity += velocity * 0.45f * Main.rand.NextFloat();
					dust19.noLightEmittence = true;
				}
			}
			if (ai[0] >= 2f)
			{
				alpha -= 25;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			if (Main.rand.Next(4) == 0)
			{
				Dust dust20 = Dust.NewDustDirect(position, width, height, 6, 0f, 0f, 200);
				dust20.scale *= 1.3f;
				dust20.velocity += velocity * 0.4f;
				dust20.noLightEmittence = true;
			}
			if (Main.rand.Next(2) == 0)
			{
				Dust dust21 = Dust.NewDustDirect(position, width, height, 30, 0f, 0f, 100);
				dust21.scale *= 0.7f;
				dust21.velocity += velocity * 1f;
			}
			if (Main.rand.Next(3) == 0 && oldPos[9] != Vector2.Zero)
			{
				Dust dust22 = Dust.NewDustDirect(oldPos[9], width, height, 55, 0f, 0f, 50);
				dust22.scale *= 0.85f;
				dust22.velocity += velocity * 0.85f;
				dust22.color = new Color(255, 60, 20);
			}
			scale -= 0.01f;
			if (scale < 0.3f)
			{
				Kill();
				return;
			}
		}
		else if (type == 711)
		{
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				for (int num170 = 0; num170 < 10; num170++)
				{
					Dust dust23 = Dust.NewDustDirect(position, width, height, 55, 0f, 0f, 200);
					dust23.scale *= 0.65f;
					dust23.velocity *= 1.5f;
					dust23.velocity += velocity * 0.3f;
					dust23.fadeIn = 0.7f;
				}
			}
			if (ai[0] >= 2f)
			{
				alpha -= 25;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			if (Main.rand.Next(4) == 0)
			{
				Dust dust24 = Dust.NewDustDirect(position, width, height, 55, 0f, 0f, 200);
				dust24.scale *= 0.7f;
				dust24.velocity += velocity * 1f;
			}
			if (Main.rand.Next(3) == 0 && oldPos[9] != Vector2.Zero)
			{
				Dust dust25 = Dust.NewDustDirect(oldPos[9], width, height, 55, 0f, 0f, 50);
				dust25.scale *= 0.85f;
				dust25.velocity += velocity * 0.85f;
				dust25.color = Color.Purple;
			}
		}
		if (type == 299)
		{
			if (localAI[0] == 6f)
			{
				SoundEngine.PlaySound(SoundID.Item8, position);
				for (int num171 = 0; num171 < 40; num171++)
				{
					int num172 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 181, 0f, 0f, 100);
					Main.dust[num172].velocity *= 3f;
					Main.dust[num172].velocity += velocity * 0.75f;
					Main.dust[num172].scale *= 1.2f;
					Main.dust[num172].noGravity = true;
				}
			}
			localAI[0] += 1f;
			if (localAI[0] > 6f)
			{
				for (int num173 = 0; num173 < 3; num173++)
				{
					int num174 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 181, velocity.X * 0.2f, velocity.Y * 0.2f, 100);
					Main.dust[num174].velocity *= 0.6f;
					Main.dust[num174].scale *= 1.4f;
					Main.dust[num174].noGravity = true;
				}
			}
		}
		else if (type == 270 || type == 837)
		{
			if (type == 270)
			{
				alpha = 0;
			}
			if (alpha > 0)
			{
				alpha -= 50;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
			frame++;
			if (frame > 2)
			{
				frame = 0;
			}
			if (type == 270)
			{
				for (int num175 = 0; num175 < 2; num175++)
				{
					int num176 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, 5, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 1.5f);
					Main.dust[num176].position -= velocity;
					Main.dust[num176].noGravity = true;
					Main.dust[num176].velocity.X *= 0.3f;
					Main.dust[num176].velocity.Y *= 0.3f;
				}
			}
			else
			{
				for (int num177 = 0; num177 < 2; num177++)
				{
					int num178 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
					Main.dust[num178].position -= velocity * 2f;
					Main.dust[num178].noGravity = true;
					Main.dust[num178].velocity.X *= 0.3f;
					Main.dust[num178].velocity.Y *= 0.3f;
				}
			}
		}
		if (type == 259)
		{
			if (alpha > 0)
			{
				alpha -= 10;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
		}
		if (type == 265)
		{
			if (alpha > 0)
			{
				alpha -= 50;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (alpha == 0)
			{
				int num179 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 163, velocity.X, velocity.Y, 100, default(Color), 1.2f);
				Main.dust[num179].noGravity = true;
				Main.dust[num179].velocity *= 0.3f;
				Main.dust[num179].velocity -= velocity * 0.4f;
			}
		}
		if (type == 355)
		{
			if (alpha > 0)
			{
				alpha -= 50;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (alpha == 0)
			{
				int num180 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 205, velocity.X, velocity.Y, 100, default(Color), 1.2f);
				Main.dust[num180].noGravity = true;
				Main.dust[num180].velocity *= 0.3f;
				Main.dust[num180].velocity -= velocity * 0.4f;
			}
		}
		if (type == 981 && Main.rand.Next(6) == 0)
		{
			int num181 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 279, velocity.X, velocity.Y, 100, default(Color), 1.2f);
			Main.dust[num181].noLightEmittence = true;
			Main.dust[num181].noGravity = true;
			Main.dust[num181].velocity *= 0.2f;
		}
		if (type == 357)
		{
			if (alpha < 170)
			{
				for (int num182 = 0; num182 < 10; num182++)
				{
					float x = position.X - velocity.X / 10f * (float)num182;
					float y = position.Y - velocity.Y / 10f * (float)num182;
					int num183 = Dust.NewDust(new Vector2(x, y), 1, 1, 206);
					Main.dust[num183].alpha = alpha;
					Main.dust[num183].position.X = x;
					Main.dust[num183].position.Y = y;
					Main.dust[num183].velocity *= 0f;
					Main.dust[num183].noGravity = true;
				}
			}
			if (alpha > 0)
			{
				alpha -= 25;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
		}
		else if (type == 207 || type == 837)
		{
			if (type == 207 && alpha < 170)
			{
				for (int num184 = 0; num184 < 10; num184++)
				{
					float x2 = position.X - velocity.X / 10f * (float)num184;
					float y2 = position.Y - velocity.Y / 10f * (float)num184;
					int num185 = Dust.NewDust(new Vector2(x2, y2), 1, 1, 75);
					Main.dust[num185].alpha = alpha;
					Main.dust[num185].position.X = x2;
					Main.dust[num185].position.Y = y2;
					Main.dust[num185].velocity *= 0f;
					Main.dust[num185].noGravity = true;
				}
			}
			float num186 = (float)Math.Sqrt(velocity.X * velocity.X + velocity.Y * velocity.Y);
			float num187 = localAI[0];
			if (num187 == 0f)
			{
				localAI[0] = num186;
				num187 = num186;
			}
			if (alpha > 0)
			{
				alpha -= 25;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
			float num188 = position.X;
			float num189 = position.Y;
			float num190 = 300f;
			bool flag5 = false;
			int num191 = 0;
			if (ai[1] == 0f)
			{
				for (int num192 = 0; num192 < Main.maxNPCs; num192++)
				{
					if (Main.npc[num192].CanBeChasedBy(this) && (ai[1] == 0f || ai[1] == (float)(num192 + 1)))
					{
						float num193 = Main.npc[num192].position.X + (float)(Main.npc[num192].width / 2);
						float num194 = Main.npc[num192].position.Y + (float)(Main.npc[num192].height / 2);
						float num195 = Math.Abs(position.X + (float)(width / 2) - num193) + Math.Abs(position.Y + (float)(height / 2) - num194);
						if (num195 < num190 && Collision.CanHit(new Vector2(position.X + (float)(width / 2), position.Y + (float)(height / 2)), 1, 1, Main.npc[num192].position, Main.npc[num192].width, Main.npc[num192].height))
						{
							num190 = num195;
							num188 = num193;
							num189 = num194;
							flag5 = true;
							num191 = num192;
						}
					}
				}
				if (flag5)
				{
					ai[1] = num191 + 1;
				}
				flag5 = false;
			}
			if (ai[1] > 0f)
			{
				int num196 = (int)(ai[1] - 1f);
				if (Main.npc[num196].active && Main.npc[num196].CanBeChasedBy(this, ignoreDontTakeDamage: true) && !Main.npc[num196].dontTakeDamage)
				{
					float num197 = Main.npc[num196].position.X + (float)(Main.npc[num196].width / 2);
					float num198 = Main.npc[num196].position.Y + (float)(Main.npc[num196].height / 2);
					if (Math.Abs(position.X + (float)(width / 2) - num197) + Math.Abs(position.Y + (float)(height / 2) - num198) < 1000f)
					{
						flag5 = true;
						num188 = Main.npc[num196].position.X + (float)(Main.npc[num196].width / 2);
						num189 = Main.npc[num196].position.Y + (float)(Main.npc[num196].height / 2);
					}
				}
				else
				{
					ai[1] = 0f;
				}
			}
			if (!friendly)
			{
				flag5 = false;
			}
			if (flag5)
			{
				float num199 = num187;
				Vector2 vector28 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num200 = num188 - vector28.X;
				float num201 = num189 - vector28.Y;
				float num202 = (float)Math.Sqrt(num200 * num200 + num201 * num201);
				num202 = num199 / num202;
				num200 *= num202;
				num201 *= num202;
				int num203 = 8;
				if (type == 837)
				{
					num203 = 32;
				}
				velocity.X = (velocity.X * (float)(num203 - 1) + num200) / (float)num203;
				velocity.Y = (velocity.Y * (float)(num203 - 1) + num201) / (float)num203;
			}
		}
		else if (type == 81 || type == 91)
		{
			if (ai[0] >= 20f)
			{
				ai[0] = 20f;
				velocity.Y += 0.07f;
			}
		}
		else if (type == 174 || type == 605 || type == 920 || type == 921 || type == 926)
		{
			if (ai[0] >= 5f)
			{
				ai[0] = 5f;
				velocity.Y += 0.15f;
			}
		}
		else if (type == 937)
		{
			if (ai[0] >= 5f)
			{
				ai[0] = 5f;
				velocity.Y += 0.07f;
			}
		}
		else if (type == 962)
		{
			frame = (int)ai[1];
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				rotation = velocity.ToRotation();
				for (int num204 = 0; num204 < 5; num204++)
				{
					Dust dust26 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(24f, 24f), 16, velocity * MathHelper.Lerp(0.2f, 0.7f, Main.rand.NextFloat()));
					dust26.velocity += Main.rand.NextVector2Circular(0.5f, 0.5f);
					dust26.scale = 0.8f + Main.rand.NextFloat() * 0.5f;
				}
				for (int num205 = 0; num205 < 5; num205++)
				{
					Dust dust27 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(24f, 24f), 16, Main.rand.NextVector2Circular(2f, 2f) + velocity * MathHelper.Lerp(0.2f, 0.5f, Main.rand.NextFloat()));
					dust27.velocity += Main.rand.NextVector2Circular(0.5f, 0.5f);
					dust27.scale = 0.8f + Main.rand.NextFloat() * 0.5f;
					dust27.fadeIn = 1f;
				}
			}
			if (ai[0] >= 5f)
			{
				velocity.Y += 0.15f;
			}
		}
		else if (type == 337)
		{
			if (position.Y > Main.player[owner].position.Y - 300f)
			{
				tileCollide = true;
			}
			if ((double)position.Y < Main.worldSurface * 16.0)
			{
				tileCollide = true;
			}
			frame = (int)ai[1];
			if (Main.rand.Next(2) == 0)
			{
				int num206 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 197);
				Main.dust[num206].velocity *= 0.5f;
				Main.dust[num206].noGravity = true;
			}
		}
		else if (type == 645)
		{
			if (ai[1] != -1f && position.Y > ai[1])
			{
				tileCollide = true;
			}
			if (position.HasNaNs())
			{
				Kill();
				return;
			}
			bool num207 = WorldGen.SolidTile(Framing.GetTileSafely((int)position.X / 16, (int)position.Y / 16));
			Dust dust28 = Main.dust[Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229)];
			dust28.position = base.Center;
			dust28.velocity = Vector2.Zero;
			dust28.noGravity = true;
			if (num207)
			{
				dust28.noLight = true;
			}
			if (ai[1] == -1f)
			{
				ai[0] += 1f;
				velocity = Vector2.Zero;
				tileCollide = false;
				penetrate = -1;
				position = base.Center;
				width = (height = 140);
				base.Center = position;
				alpha -= 10;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (++frameCounter >= MaxUpdates * 3)
				{
					frameCounter = 0;
					frame++;
				}
				if (ai[0] >= (float)(Main.projFrames[type] * MaxUpdates * 3))
				{
					Kill();
				}
				return;
			}
			alpha = 255;
			if (numUpdates == 0)
			{
				int num208 = -1;
				float num209 = 60f;
				for (int num210 = 0; num210 < Main.maxNPCs; num210++)
				{
					NPC nPC2 = Main.npc[num210];
					if (nPC2.CanBeChasedBy(this))
					{
						float num211 = Distance(nPC2.Center);
						if (num211 < num209 && Collision.CanHitLine(base.Center, 0, 0, nPC2.Center, 0, 0))
						{
							num209 = num211;
							num208 = num210;
						}
					}
				}
				if (num208 != -1)
				{
					ai[0] = 0f;
					ai[1] = -1f;
					netUpdate = true;
					return;
				}
			}
		}
		else if (type >= 424 && type <= 426)
		{
			if (position.Y > Main.player[owner].position.Y - 300f)
			{
				tileCollide = true;
			}
			if ((double)position.Y < Main.worldSurface * 16.0)
			{
				tileCollide = true;
			}
			scale = ai[1];
			rotation += velocity.X * 2f;
			Vector2 vector29 = base.Center + Vector2.Normalize(velocity) * 10f;
			Dust obj16 = Main.dust[Dust.NewDust(position, width, height, 6)];
			obj16.position = vector29;
			obj16.velocity = velocity.RotatedBy(1.5707963705062866) * 0.33f + velocity / 4f;
			obj16.position += velocity.RotatedBy(1.5707963705062866);
			obj16.fadeIn = 0.5f;
			obj16.noGravity = true;
			Dust obj17 = Main.dust[Dust.NewDust(position, width, height, 6)];
			obj17.position = vector29;
			obj17.velocity = velocity.RotatedBy(-1.5707963705062866) * 0.33f + velocity / 4f;
			obj17.position += velocity.RotatedBy(-1.5707963705062866);
			obj17.fadeIn = 0.5f;
			obj17.noGravity = true;
			for (int num212 = 0; num212 < 1; num212++)
			{
				int num213 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6);
				Main.dust[num213].velocity *= 0.5f;
				Main.dust[num213].scale *= 1.3f;
				Main.dust[num213].fadeIn = 1f;
				Main.dust[num213].noGravity = true;
			}
		}
		else if (type == 344)
		{
			if (WorldGen.SolidTile((int)position.X / 16, (int)(position.Y + velocity.Y) / 16 + 1) || WorldGen.SolidTile((int)(position.X + (float)width) / 16, (int)(position.Y + velocity.Y) / 16 + 1))
			{
				Kill();
				return;
			}
			localAI[1] += 1f;
			if (localAI[1] > 5f)
			{
				alpha -= 50;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			frame = (int)ai[1];
			if (localAI[1] >= 20f)
			{
				velocity.Y += 0.15f;
				velocity.X *= 0.96f;
			}
			if (localAI[1] >= 25f)
			{
				localAI[1] = 20f;
				Vector2 zero = Vector2.Zero;
				float num214 = 0f;
				int num215 = 60;
				for (int num216 = 0; num216 < 1000; num216++)
				{
					Projectile projectile = Main.projectile[num216];
					if (projectile.whoAmI != whoAmI && projectile.active && projectile.type == type)
					{
						Vector2 vector30 = projectile.position - position;
						if (!(vector30.Length() > (float)num215))
						{
							num214 += 1f;
							float num217 = Utils.Remap(vector30.Length(), 0f, num215, 1f, 0f);
							zero.X += (float)(-Math.Sign(vector30.X)) * num217;
						}
					}
				}
				if (num214 > 0f)
				{
					Vector2 vector31 = zero;
					vector31.Y = 0f;
					if (vector31.X == 0f)
					{
						vector31.X = 1f;
					}
					velocity += vector31 * 0.25f;
				}
			}
		}
		else if (type == 336 || type == 345)
		{
			if (type == 345 && localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlaySound(SoundID.Item1, position);
			}
			if (ai[0] >= 50f)
			{
				ai[0] = 50f;
				velocity.Y += 0.5f;
			}
		}
		else if (type == 246)
		{
			alpha -= 20;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (ai[0] >= 60f)
			{
				ai[0] = 60f;
				velocity.Y += 0.15f;
			}
		}
		else if (type == 311)
		{
			if (alpha > 0)
			{
				alpha -= 50;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (ai[0] >= 30f)
			{
				ai[0] = 30f;
				if (ai[1] == 0f)
				{
					ai[1] = 1f;
				}
				velocity.Y += 0.5f;
			}
		}
		else if (type == 1023)
		{
			if (ai[0] >= 6f)
			{
				alpha = 0;
			}
			if (ai[0] >= 20f)
			{
				ai[0] = 30f;
				velocity.Y += 0.25f;
			}
		}
		else if (type == 312)
		{
			if (ai[0] >= 5f)
			{
				alpha = 0;
			}
			if (ai[0] >= 20f)
			{
				ai[0] = 30f;
				velocity.Y += 0.5f;
			}
			Lighting.AddLight(base.Center, 0.6f, 0.4f, 0.3f);
		}
		else if (type != 239 && type != 264)
		{
			if (type == 176)
			{
				if (ai[0] >= 15f)
				{
					ai[0] = 15f;
					velocity.Y += 0.05f;
				}
			}
			else if (type == 275 || type == 276)
			{
				if (alpha > 0)
				{
					alpha -= 30;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (ai[0] >= 35f)
				{
					ai[0] = 35f;
					velocity.Y += 0.025f;
				}
				if (Main.expertMode)
				{
					float num218 = 18f;
					int num219 = Player.FindClosest(base.Center, 1, 1);
					Vector2 vector32 = Main.player[num219].Center - base.Center;
					vector32.Normalize();
					vector32 *= num218;
					int num220 = 70;
					velocity = (velocity * (num220 - 1) + vector32) / num220;
					if (velocity.Length() < 14f)
					{
						velocity.Normalize();
						velocity *= 14f;
					}
					tileCollide = false;
					if (timeLeft > 180)
					{
						timeLeft = 180;
					}
				}
			}
			else if (type == 172)
			{
				if (ai[0] >= 17f)
				{
					ai[0] = 17f;
					velocity.Y += 0.085f;
				}
			}
			else if (type == 117)
			{
				if (ai[0] >= 35f)
				{
					ai[0] = 35f;
					velocity.Y += 0.06f;
				}
			}
			else if (type == 120)
			{
				int num221 = Dust.NewDust(new Vector2(position.X - velocity.X, position.Y - velocity.Y), width, height, 67, velocity.X, velocity.Y, 100, default(Color), 1.2f);
				Main.dust[num221].noGravity = true;
				Main.dust[num221].velocity *= 0.3f;
				if (ai[0] >= 30f)
				{
					ai[0] = 30f;
					velocity.Y += 0.05f;
				}
			}
			else if (type == 195)
			{
				int num222 = 40;
				if (ai[0] >= (float)num222)
				{
					ai[0] = num222;
					velocity.Y += 0.15f;
					tileCollide = true;
				}
				else
				{
					tileCollide = velocity.Y > 0f;
				}
			}
			else if (type == 1097)
			{
				int num223 = 40;
				if (ai[0] >= (float)num223)
				{
					ai[0] = num223;
					velocity.Y += 0.15f;
					tileCollide = true;
				}
				else
				{
					tileCollide = velocity.Y > 0f;
				}
			}
			else if (type == 267 || type == 477 || type == 478 || type == 479)
			{
				localAI[0] += 1f;
				if (localAI[0] > 3f)
				{
					alpha = 0;
				}
				if (ai[0] >= 20f)
				{
					ai[0] = 20f;
					if (type != 477)
					{
						velocity.Y += 0.075f;
					}
				}
				if (type == 479 && Main.myPlayer == owner)
				{
					if (ai[1] >= 0f)
					{
						maxPenetrate = (penetrate = -1);
					}
					else if (penetrate < 0)
					{
						maxPenetrate = (penetrate = 1);
					}
					if (ai[1] >= 0f)
					{
						ai[1] += 1f;
					}
					if (ai[1] > (float)Main.rand.Next(5, 30))
					{
						ai[1] = -1000f;
						float num224 = velocity.Length();
						Vector2 vector33 = velocity;
						vector33.Normalize();
						int num225 = Main.rand.Next(2, 4);
						if (Main.rand.Next(4) == 0)
						{
							num225++;
						}
						for (int num226 = 0; num226 < num225; num226++)
						{
							Vector2 vector34 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
							vector34.Normalize();
							vector34 += vector33 * 2f;
							vector34.Normalize();
							vector34 *= num224;
							NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector34.X, vector34.Y, type, (int)((float)damage * 0.9f), knockBack, owner, 0f, -1000f, 0f, NewProjectileModifiers.IchorDartUpdatePenetrate);
							Vector2 zero2 = Vector2.Zero;
							for (int num227 = 0; num227 < 4; num227++)
							{
								zero2 = vector34 * (0.4f + (float)num227 * 0.075f);
								Main.dust[Dust.NewDust(base.Center + zero2 * 1.5f, 2, 2, 170, zero2.X, zero2.Y)].noGravity = true;
							}
							zero2 = vector34 * 0.2f;
							Main.dust[Dust.NewDust(base.Center, 2, 2, 170, 0f - zero2.X, 0f - zero2.Y)].noGravity = true;
						}
					}
				}
				if (type == 478 && Main.myPlayer == owner)
				{
					ai[1] += 1f;
					if (ai[1] > (float)Main.rand.Next(5, 20))
					{
						if (timeLeft > 40)
						{
							timeLeft -= 20;
						}
						ai[1] = 0f;
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 480, (int)((double)damage * 0.8), knockBack * 0.5f, owner);
					}
				}
			}
			else if (type == 408)
			{
				if (ai[0] >= 45f)
				{
					ai[0] = 45f;
					velocity.Y += 0.05f;
				}
			}
			else if (type == 616)
			{
				if (alpha < 170)
				{
					float num228 = 3f;
					for (int num229 = 0; (float)num229 < num228; num229++)
					{
						int num230 = Dust.NewDust(position, 1, 1, 229);
						Main.dust[num230].position = base.Center - velocity / num228 * num229;
						Main.dust[num230].velocity *= 0f;
						Main.dust[num230].noGravity = true;
						Main.dust[num230].alpha = 200;
						Main.dust[num230].scale = 0.5f;
					}
				}
				float num231 = (float)Math.Sqrt(velocity.X * velocity.X + velocity.Y * velocity.Y);
				float num232 = localAI[0];
				if (num232 == 0f)
				{
					localAI[0] = num231;
					num232 = num231;
				}
				if (alpha > 0)
				{
					alpha -= 25;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				float num233 = position.X;
				float num234 = position.Y;
				float num235 = 800f;
				bool flag6 = false;
				int num236 = 0;
				ai[0] += 1f;
				if (ai[0] > 20f)
				{
					ai[0] -= 1f;
					if (ai[1] == 0f)
					{
						for (int num237 = 0; num237 < Main.maxNPCs; num237++)
						{
							if (Main.npc[num237].CanBeChasedBy(this) && (ai[1] == 0f || ai[1] == (float)(num237 + 1)))
							{
								float num238 = Main.npc[num237].position.X + (float)(Main.npc[num237].width / 2);
								float num239 = Main.npc[num237].position.Y + (float)(Main.npc[num237].height / 2);
								float num240 = Math.Abs(position.X + (float)(width / 2) - num238) + Math.Abs(position.Y + (float)(height / 2) - num239);
								if (num240 < num235 && Collision.CanHit(new Vector2(position.X + (float)(width / 2), position.Y + (float)(height / 2)), 1, 1, Main.npc[num237].position, Main.npc[num237].width, Main.npc[num237].height))
								{
									num235 = num240;
									num233 = num238;
									num234 = num239;
									flag6 = true;
									num236 = num237;
								}
							}
						}
						if (flag6)
						{
							ai[1] = num236 + 1;
						}
						flag6 = false;
					}
					if (ai[1] != 0f)
					{
						int num241 = (int)(ai[1] - 1f);
						if (Main.npc[num241].active && Main.npc[num241].CanBeChasedBy(this, ignoreDontTakeDamage: true))
						{
							float num242 = Main.npc[num241].position.X + (float)(Main.npc[num241].width / 2);
							float num243 = Main.npc[num241].position.Y + (float)(Main.npc[num241].height / 2);
							if (Math.Abs(position.X + (float)(width / 2) - num242) + Math.Abs(position.Y + (float)(height / 2) - num243) < 1000f)
							{
								flag6 = true;
								num233 = Main.npc[num241].position.X + (float)(Main.npc[num241].width / 2);
								num234 = Main.npc[num241].position.Y + (float)(Main.npc[num241].height / 2);
							}
						}
					}
					if (!friendly)
					{
						flag6 = false;
					}
					if (flag6)
					{
						float num244 = num232;
						Vector2 vector35 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
						float num245 = num233 - vector35.X;
						float num246 = num234 - vector35.Y;
						float num247 = (float)Math.Sqrt(num245 * num245 + num246 * num246);
						num247 = num244 / num247;
						num245 *= num247;
						num246 *= num247;
						int num248 = 8;
						velocity.X = (velocity.X * (float)(num248 - 1) + num245) / (float)num248;
						velocity.Y = (velocity.Y * (float)(num248 - 1) + num246) / (float)num248;
					}
				}
			}
			else if (type == 507 || type == 508 || type == 662 || type == 680 || type == 685)
			{
				if (ai[0] > 60f)
				{
					velocity.X *= 0.98f;
					velocity.Y += 0.3f;
				}
			}
			else if (type == 495)
			{
				int num249 = Dust.NewDust(new Vector2(position.X - velocity.X, position.Y - velocity.Y), width, height, 27, velocity.X, velocity.Y, 100, default(Color), 1.2f);
				Main.dust[num249].noGravity = true;
				Main.dust[num249].velocity *= 0.3f;
				if (ai[0] >= 30f)
				{
					ai[0] = 30f;
					velocity.Y += 0.04f;
				}
			}
			else if (type == 498)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] += 1f;
					SoundEngine.PlaySound(SoundID.Item17, position);
				}
				ai[0] += 1f;
				if (ai[0] >= 50f)
				{
					velocity.X *= 0.98f;
					velocity.Y += 0.15f;
					rotation += (float)direction * 0.5f;
				}
				else
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				}
			}
			else if (type == 437)
			{
				if (ai[0] >= 12f)
				{
					if (ai[0] >= 20f)
					{
						Kill();
					}
					alpha += 30;
				}
			}
			else if (type != 442 && type != 634 && type != 635 && type != 675)
			{
				if (type == 686 || type == 711)
				{
					if (ai[0] >= 10f)
					{
						velocity.Y += 0.1f;
					}
					if (ai[0] >= 20f)
					{
						velocity.Y += 0.1f;
					}
					if (ai[0] > 20f)
					{
						ai[0] = 20f;
					}
					velocity.X *= 0.99f;
					if (velocity.Y > 32f)
					{
						velocity.Y = 32f;
					}
				}
				else if (type == 639)
				{
					if (timeLeft <= MaxUpdates * 45 - 14)
					{
						velocity.Y += 0.1f;
					}
				}
				else if (type == 710)
				{
					if (ai[0] >= 0f)
					{
						ai[0] += 1f;
						if (ai[0] >= 20f)
						{
							velocity.Y += 0.2f;
							if (velocity.Y > 0f)
							{
								velocity.X *= 0.98f;
							}
							if (velocity.Y > 12f)
							{
								velocity.Y = 12f;
							}
						}
					}
				}
				else if (ai[0] >= 15f)
				{
					ai[0] = 15f;
					if (flag4)
					{
						velocity.Y -= 0.1f;
					}
					else
					{
						velocity.Y += 0.1f;
					}
				}
			}
		}
		if (type == 921 || type == 926 || type == 937)
		{
			rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.05f;
		}
		else if (type == 248)
		{
			if (velocity.X < 0f)
			{
				rotation -= (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.05f;
			}
			else
			{
				rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.05f;
			}
		}
		else if (type == 270 || type == 585 || type == 601 || type == 706 || type == 837)
		{
			spriteDirection = direction;
			if (direction < 0)
			{
				rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
			}
			else
			{
				rotation = (float)Math.Atan2(velocity.Y, velocity.X);
			}
		}
		else if (type == 311)
		{
			if (ai[1] != 0f)
			{
				rotation += velocity.X * 0.1f + (float)Main.rand.Next(-10, 11) * 0.025f;
			}
			else
			{
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
			}
		}
		else if (type == 1023)
		{
			rotation += MathHelper.Clamp(velocity.X * 0.025f, (float)Math.PI / 16f, (float)Math.PI / 6f);
		}
		else if (type == 312)
		{
			rotation += velocity.X * 0.02f;
		}
		else if (type == 675)
		{
			rotation += velocity.X * 0.03f;
		}
		else if (type != 676)
		{
			if (type == 408)
			{
				rotation = velocity.ToRotation();
				if (direction == -1)
				{
					rotation += (float)Math.PI;
				}
			}
			else if (type == 435 || type == 459 || type == 682 || type == 709)
			{
				rotation = velocity.ToRotation();
				if (direction == -1)
				{
					rotation += (float)Math.PI;
				}
			}
			else if (type == 660)
			{
				rotation = velocity.ToRotation() + (float)Math.PI / 4f;
			}
			else if (type == 662 || type == 685)
			{
				rotation = velocity.ToRotation() - (float)Math.PI - (float)Math.PI / 4f;
			}
			else if (type == 680 || type == 684 || type == 686 || type == 711 || type == 712 || type == 1097)
			{
				rotation = velocity.ToRotation() + (float)Math.PI / 2f;
			}
			else if (type == 436)
			{
				rotation = velocity.ToRotation();
				rotation += (float)Math.PI;
				if (direction == -1)
				{
					rotation += (float)Math.PI;
				}
			}
			else if (type == 469)
			{
				if (velocity.X > 0f)
				{
					spriteDirection = -1;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				}
				else
				{
					spriteDirection = 1;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				}
			}
			else if (type == 477)
			{
				if (localAI[1] < 5f)
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
					localAI[1] += 1f;
				}
				else
				{
					rotation = (rotation * 2f + (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f) / 3f;
				}
			}
			else if (type == 532)
			{
				rotation += 0.2f + Math.Abs(velocity.X) * 0.1f;
			}
			else if (type == 483)
			{
				rotation += velocity.X * 0.05f;
			}
			else if (type == 772)
			{
				rotation += (float)Math.Sign(velocity.X) * (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.05f;
			}
			else if (type == 485)
			{
				Vector2 vector36 = new Vector2(ai[0], ai[1]);
				velocity = (velocity * 39f + vector36) / 40f;
				int num250 = Dust.NewDust(position, width, height, 6);
				Main.dust[num250].noGravity = true;
				Main.dust[num250].velocity *= 0.2f;
				Main.dust[num250].position = (Main.dust[num250].position + base.Center) / 2f;
				frameCounter++;
				if (frameCounter >= 2)
				{
					frameCounter = 0;
					frame++;
					if (frame >= 5)
					{
						frame = 0;
					}
				}
				if (velocity.X < 0f)
				{
					spriteDirection = -1;
					rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
				}
				else
				{
					spriteDirection = 1;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X);
				}
			}
			else if (type == 640)
			{
				if (velocity != Vector2.Zero)
				{
					rotation = velocity.ToRotation() + (float)Math.PI / 2f;
				}
			}
			else if (type == 325)
			{
				rotation = velocity.ToRotation() - (float)Math.PI / 2f;
			}
			else if (type != 344 && type != 498)
			{
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
			}
		}
		bool flag7 = true;
		int num251 = type;
		if (num251 == 577)
		{
			flag7 = false;
		}
		if (flag7)
		{
			if (flag4 && velocity.Y < -16f)
			{
				velocity.Y = -16f;
			}
			if (velocity.Y > 16f)
			{
				velocity.Y = 16f;
			}
		}
	}

	private void AI_010()
	{
		if (type == 31 && ai[0] != 2f)
		{
			if (Main.rand.Next(2) == 0)
			{
				int num = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 32, 0f, velocity.Y / 2f);
				Main.dust[num].velocity.X *= 0.4f;
			}
		}
		else if (type == 39)
		{
			if (Main.rand.Next(2) == 0)
			{
				int num2 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 38, 0f, velocity.Y / 2f);
				Main.dust[num2].velocity.X *= 0.4f;
			}
		}
		else if (type == 1081)
		{
			if (Main.rand.Next(2) == 0)
			{
				int num3 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 38, 0f, velocity.Y / 2f, 0, default(Color), 0.8f);
				Main.dust[num3].velocity *= 0.3f;
				Main.dust[num3].velocity += velocity / 2f;
			}
		}
		else if (type >= 411 && type <= 414)
		{
			if (Main.rand.Next(3) == 0)
			{
				int num4 = 9;
				if (type == 412 || type == 414)
				{
					num4 = 11;
				}
				if (type == 413)
				{
					num4 = 19;
				}
				int num5 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num4, 0f, velocity.Y / 2f);
				Main.dust[num5].noGravity = true;
				Main.dust[num5].velocity -= velocity * 0.5f;
			}
		}
		else if (type == 40)
		{
			if (Main.rand.Next(2) == 0)
			{
				int num6 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 36, 0f, velocity.Y / 2f);
				Main.dust[num6].velocity *= 0.4f;
			}
		}
		else if (type == 42 || type == 31)
		{
			if (Main.rand.Next(2) == 0)
			{
				int num7 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 32);
				Main.dust[num7].velocity.X *= 0.4f;
			}
		}
		else if (type == 56 || type == 65)
		{
			if (Main.rand.Next(2) == 0)
			{
				int num8 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 14);
				Main.dust[num8].velocity.X *= 0.4f;
			}
		}
		else if (type == 67 || type == 68)
		{
			if (Main.rand.Next(2) == 0)
			{
				int num9 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 51);
				Main.dust[num9].velocity.X *= 0.4f;
			}
		}
		else if (type == 71)
		{
			if (Main.rand.Next(2) == 0)
			{
				int num10 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 53);
				Main.dust[num10].velocity.X *= 0.4f;
			}
		}
		else if (type == 179)
		{
			if (Main.rand.Next(2) == 0)
			{
				int num11 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 149);
				Main.dust[num11].velocity.X *= 0.4f;
			}
		}
		else if (type == 241 || type == 354)
		{
			if (Main.rand.Next(2) == 0)
			{
				int num12 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 36);
				Main.dust[num12].velocity.X *= 0.4f;
			}
		}
		else if (type >= 736 && type <= 738)
		{
			if (Main.rand.Next(40) == 0)
			{
				int num13 = Dust.NewDust(position, width, height, type - 736 + 275);
				if (num13 >= 0)
				{
					Main.dust[num13].velocity = Main.dust[num13].velocity * 0.5f + velocity * 0.5f;
				}
			}
		}
		else if (type != 109 && Main.rand.Next(20) == 0)
		{
			Dust.NewDust(new Vector2(position.X, position.Y), width, height, 0);
		}
		if (type >= 736 && type <= 738)
		{
			if (localAI[0] == 0f)
			{
				frame = Main.rand.Next(3);
				scale = 1f - (float)Main.rand.Next(30) * 0.01f;
			}
			localAI[0] += 1f;
		}
		tileCollide = true;
		localAI[1] = 0f;
		if (Main.myPlayer == owner && ai[0] == 0f)
		{
			tileCollide = false;
			if (Main.player[owner].channel && (type < 736 || type > 738) && type != 40)
			{
				localAI[1] = -1f;
				float num14 = 12f;
				Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num15 = (float)Main.mouseX + Main.screenPosition.X - vector.X;
				float num16 = (float)Main.mouseY + Main.screenPosition.Y - vector.Y;
				if (Main.player[owner].gravDir == -1f)
				{
					num16 = Main.screenPosition.Y + (float)Main.screenHeight - (float)Main.mouseY - vector.Y;
				}
				float num17 = (float)Math.Sqrt(num15 * num15 + num16 * num16);
				num17 = (float)Math.Sqrt(num15 * num15 + num16 * num16);
				if (num17 > num14)
				{
					num17 = num14 / num17;
					num15 *= num17;
					num16 *= num17;
					if (num15 != velocity.X || num16 != velocity.Y)
					{
						netUpdate = true;
					}
					velocity.X = num15;
					velocity.Y = num16;
				}
				else
				{
					if (num15 != velocity.X || num16 != velocity.Y)
					{
						netUpdate = true;
					}
					velocity.X = num15;
					velocity.Y = num16;
				}
			}
			else
			{
				ai[0] = 1f;
				netUpdate = true;
			}
		}
		if (type == 1081)
		{
			ai[0] += 1f;
			if (ai[0] >= 20f)
			{
				velocity.Y += 0.3f;
				velocity.X *= 0.98f;
			}
		}
		else if (ai[0] == 1f && type != 109)
		{
			if (type == 42 || type == 65 || type == 68 || type == 354)
			{
				ai[1] += 1f;
				if (ai[1] >= 60f)
				{
					ai[1] = 60f;
					velocity.Y += 0.2f;
				}
			}
			else
			{
				velocity.Y += 0.41f;
			}
		}
		else if (ai[0] == 2f && type != 109)
		{
			velocity.Y += 0.2f;
			if ((double)velocity.X < -0.04)
			{
				velocity.X += 0.04f;
			}
			else if ((double)velocity.X > 0.04)
			{
				velocity.X -= 0.04f;
			}
			else
			{
				velocity.X = 0f;
			}
		}
		if (owner == Main.myPlayer && tileCollide)
		{
			for (int i = (int)(position.X / 16f); i <= (int)((position.X + (float)width) / 16f); i++)
			{
				for (int j = (int)(position.Y / 16f); j <= (int)((position.Y + (float)height) / 16f); j++)
				{
					if (!WorldGen.InWorld(i, j))
					{
						continue;
					}
					Tile tile = Main.tile[i, j];
					if (tile == null || !tile.active())
					{
						continue;
					}
					if ((tile.type >= 185 && tile.type <= 187) || tile.type == 165 || tile.type == 12 || tile.type == 665 || tile.type == 639 || tile.type == 105 || tile.type == 178)
					{
						WorldGen.KillTile(i, j);
						if (Main.netMode != 0)
						{
							NetMessage.SendData(17, -1, -1, null, 0, i, j);
						}
					}
					else if (tile.topSlope() && !TileID.Sets.Platforms[tile.type])
					{
						WorldGen.SlopeTile(i, j);
						if (Main.netMode != 0)
						{
							NetMessage.SendData(17, -1, -1, null, 14, i, j);
						}
						position.Y -= 16f;
					}
				}
			}
		}
		if (type >= 736 && type <= 738)
		{
			if (frame == 0)
			{
				rotation -= 0.1f;
			}
			else if (frame == 1)
			{
				rotation += 0.1f;
			}
			else
			{
				rotation += 0.15f;
			}
			if (velocity.Y > 10f)
			{
				velocity.Y = 10f;
			}
		}
		else
		{
			rotation += 0.1f;
			if (velocity.Y > 10f)
			{
				velocity.Y = 10f;
			}
		}
	}

	private void AI_026()
	{
		if (!Main.player[owner].active)
		{
			active = false;
			return;
		}
		bool flag = false;
		bool flag2 = false;
		bool flag3 = false;
		bool flag4 = false;
		bool flag5 = false;
		int num = 85;
		bool flag6 = type >= 191 && type <= 194;
		bool flag7 = type >= 390 && type <= 392;
		bool flag8 = type == 1094;
		bool flag9 = Main.player[owner].petting.isPetting && Main.player[owner].petting.proj == whoAmI;
		bool flag10 = flag6 || flag8;
		if (type == 324)
		{
			num = 120;
		}
		if (type == 112)
		{
			num = 100;
		}
		if (type == 127)
		{
			num = 50;
		}
		switch (type)
		{
		case 1094:
			if (--soundDelay == -20)
			{
				SoundEngine.PlaySound(SoundID.PalFoxparks, base.Center);
			}
			if (soundDelay == -1)
			{
				SoundEngine.PlaySound(SoundID.PalSummon, base.Center);
			}
			if (flag9 && localAI[2] == 0f)
			{
				localAI[2] = 60f;
				SoundEngine.PlaySound(SoundID.PalFoxparksJoy, base.Center);
			}
			if (localAI[2] > (float)(flag9 ? 1 : 0))
			{
				localAI[2] -= 1f;
			}
			break;
		case 816:
		case 821:
		case 825:
		case 854:
		case 858:
		case 859:
		case 860:
		case 885:
		case 889:
		case 891:
		case 897:
		case 899:
		case 900:
		case 934:
			num = 95;
			break;
		case 884:
		case 890:
			num = 80;
			break;
		case 881:
			num = 95;
			if (Main.player[owner].ownedProjectileCounts[881] > 0)
			{
				num = 120;
			}
			break;
		}
		if (type == 960)
		{
			Main.CurrentFrameFlags.HadAnActiveInteractibleProjectile = true;
			flag = true;
		}
		if (flag10)
		{
			if (lavaWet)
			{
				ai[0] = 1f;
				ai[1] = 0f;
			}
			num = 60 + 30 * minionPos;
		}
		else if (type == 266)
		{
			num = 60 + 30 * minionPos;
		}
		bool flag11 = ai[0] == -1f || ai[0] == -2f;
		bool num2 = ai[0] == -1f;
		bool flag12 = ai[0] == -2f;
		if (type == 1094)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].palworldFoxsparksMinion = false;
			}
			if (Main.player[owner].palworldFoxsparksMinion)
			{
				timeLeft = 2;
			}
			Lighting.AddLight(base.Center, 0.5f, 0.3f, 0.1f);
			DoPalAppearEffect(Main.player[owner], ai[0] != 1f);
		}
		if (type == 111)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].bunny = false;
			}
			if (Main.player[owner].bunny)
			{
				timeLeft = 2;
			}
		}
		if (type == 112)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].penguin = false;
			}
			if (Main.player[owner].penguin)
			{
				timeLeft = 2;
			}
		}
		if (type == 334)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].puppy = false;
			}
			if (Main.player[owner].puppy)
			{
				timeLeft = 2;
			}
		}
		if (type == 353)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].grinch = false;
			}
			if (Main.player[owner].grinch)
			{
				timeLeft = 2;
			}
		}
		if (type == 127)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].turtle = false;
			}
			if (Main.player[owner].turtle)
			{
				timeLeft = 2;
			}
		}
		if (type == 175)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].eater = false;
			}
			if (Main.player[owner].eater)
			{
				timeLeft = 2;
			}
		}
		if (type == 197)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].skeletron = false;
			}
			if (Main.player[owner].skeletron)
			{
				timeLeft = 2;
			}
		}
		if (type == 198)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].hornet = false;
			}
			if (Main.player[owner].hornet)
			{
				timeLeft = 2;
			}
		}
		if (type == 199)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].tiki = false;
			}
			if (Main.player[owner].tiki)
			{
				timeLeft = 2;
			}
		}
		if (type == 200)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].lizard = false;
			}
			if (Main.player[owner].lizard)
			{
				timeLeft = 2;
			}
		}
		if (type == 208)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].parrot = false;
			}
			if (Main.player[owner].parrot)
			{
				timeLeft = 2;
			}
		}
		if (type == 209)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].truffle = false;
			}
			if (Main.player[owner].truffle)
			{
				timeLeft = 2;
			}
		}
		if (type == 210)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].sapling = false;
			}
			if (Main.player[owner].sapling)
			{
				timeLeft = 2;
			}
		}
		if (type == 324)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].cSapling = false;
			}
			if (Main.player[owner].cSapling)
			{
				timeLeft = 2;
			}
		}
		if (type == 313)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].spider = false;
			}
			if (Main.player[owner].spider)
			{
				timeLeft = 2;
			}
		}
		if (type == 314)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].squashling = false;
			}
			if (Main.player[owner].squashling)
			{
				timeLeft = 2;
			}
		}
		if (type == 211)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].wisp = false;
			}
			if (Main.player[owner].wisp)
			{
				timeLeft = 2;
			}
		}
		if (type == 236)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].dino = false;
			}
			if (Main.player[owner].dino)
			{
				timeLeft = 2;
			}
		}
		if (type == 499)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].babyFaceMonster = false;
			}
			if (Main.player[owner].babyFaceMonster)
			{
				timeLeft = 2;
			}
		}
		if (type == 765)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagSugarGlider = false;
			}
			if (Main.player[owner].petFlagSugarGlider)
			{
				timeLeft = 2;
			}
		}
		if (type == 266)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].slime = false;
			}
			if (Main.player[owner].slime)
			{
				timeLeft = 2;
			}
		}
		if (type == 268)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].eyeSpring = false;
			}
			if (Main.player[owner].eyeSpring)
			{
				timeLeft = 2;
			}
		}
		if (type == 269)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].snowman = false;
			}
			if (Main.player[owner].snowman)
			{
				timeLeft = 2;
			}
		}
		if (type == 319)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].blackCat = false;
			}
			if (Main.player[owner].blackCat)
			{
				timeLeft = 2;
			}
		}
		if (type == 380)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].zephyrfish = false;
			}
			if (Main.player[owner].zephyrfish)
			{
				timeLeft = 2;
			}
		}
		if (type == 1095)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagChillet = false;
			}
			if (Main.player[owner].petFlagChillet)
			{
				timeLeft = 2;
			}
		}
		if (type == 1096)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagChilletIgnis = false;
			}
			if (Main.player[owner].petFlagChilletIgnis)
			{
				timeLeft = 2;
			}
		}
		if (type == 774)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagBabyShark = false;
			}
			if (Main.player[owner].petFlagBabyShark)
			{
				timeLeft = 2;
			}
		}
		if (type == 815)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagLilHarpy = false;
			}
			if (Main.player[owner].petFlagLilHarpy)
			{
				timeLeft = 2;
			}
		}
		if (type == 816)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagFennecFox = false;
			}
			if (Main.player[owner].petFlagFennecFox)
			{
				timeLeft = 2;
			}
		}
		if (type == 817)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagGlitteryButterfly = false;
			}
			if (Main.player[owner].petFlagGlitteryButterfly)
			{
				timeLeft = 2;
			}
		}
		if (type == 821)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagBabyImp = false;
			}
			if (Main.player[owner].petFlagBabyImp)
			{
				timeLeft = 2;
			}
		}
		if (type == 825)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagBabyRedPanda = false;
			}
			if (Main.player[owner].petFlagBabyRedPanda)
			{
				timeLeft = 2;
			}
		}
		if (type == 854)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagPlantero = false;
			}
			if (Main.player[owner].petFlagPlantero)
			{
				timeLeft = 2;
			}
		}
		if (type == 858)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagDynamiteKitten = false;
			}
			if (Main.player[owner].petFlagDynamiteKitten)
			{
				timeLeft = 2;
			}
		}
		if (type == 859)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagBabyWerewolf = false;
			}
			if (Main.player[owner].petFlagBabyWerewolf)
			{
				timeLeft = 2;
			}
		}
		if (type == 860)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagShadowMimic = false;
			}
			if (Main.player[owner].petFlagShadowMimic)
			{
				timeLeft = 2;
			}
		}
		if (type == 875)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagVoltBunny = false;
			}
			if (Main.player[owner].petFlagVoltBunny)
			{
				timeLeft = 2;
			}
		}
		if (type == 881)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagKingSlimePet = false;
			}
			if (Main.player[owner].petFlagKingSlimePet)
			{
				timeLeft = 2;
			}
		}
		if (type == 884)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagBrainOfCthulhuPet = false;
			}
			if (Main.player[owner].petFlagBrainOfCthulhuPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 885)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagSkeletronPet = false;
			}
			if (Main.player[owner].petFlagSkeletronPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 886)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagQueenBeePet = false;
			}
			if (Main.player[owner].petFlagQueenBeePet)
			{
				timeLeft = 2;
			}
		}
		if (type == 889)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagSkeletronPrimePet = false;
			}
			if (Main.player[owner].petFlagSkeletronPrimePet)
			{
				timeLeft = 2;
			}
		}
		if (type == 890)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagPlanteraPet = false;
			}
			if (Main.player[owner].petFlagPlanteraPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 891)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagGolemPet = false;
			}
			if (Main.player[owner].petFlagGolemPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 892)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagDukeFishronPet = false;
			}
			if (Main.player[owner].petFlagDukeFishronPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 894)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagMoonLordPet = false;
			}
			if (Main.player[owner].petFlagMoonLordPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 897)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagEverscreamPet = false;
			}
			if (Main.player[owner].petFlagEverscreamPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 899)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagMartianPet = false;
			}
			if (Main.player[owner].petFlagMartianPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 900)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagDD2OgrePet = false;
			}
			if (Main.player[owner].petFlagDD2OgrePet)
			{
				timeLeft = 2;
			}
		}
		if (type == 901)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagDD2BetsyPet = false;
			}
			if (Main.player[owner].petFlagDD2BetsyPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 934)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagQueenSlimePet = false;
			}
			if (Main.player[owner].petFlagQueenSlimePet)
			{
				timeLeft = 2;
			}
		}
		if (type == 956)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagBerniePet = false;
			}
			if (Main.player[owner].petFlagBerniePet)
			{
				timeLeft = 2;
			}
		}
		if (type == 958)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagDeerclopsPet = false;
			}
			if (Main.player[owner].petFlagDeerclopsPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 959)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagPigPet = false;
			}
			if (Main.player[owner].petFlagPigPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 960)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagChesterPet = false;
			}
			if (Main.player[owner].petFlagChesterPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 994)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagJunimoPet = false;
			}
			if (Main.player[owner].petFlagJunimoPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 998)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagBlueChickenPet = false;
			}
			if (Main.player[owner].petFlagBlueChickenPet)
			{
				timeLeft = 2;
			}
		}
		if (type == 1003)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagSpiffo = false;
			}
			if (Main.player[owner].petFlagSpiffo)
			{
				timeLeft = 2;
			}
		}
		if (type == 1004)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagCaveling = false;
			}
			if (Main.player[owner].petFlagCaveling)
			{
				timeLeft = 2;
			}
		}
		if (type == 1027)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagDeadCellsSwarmBiter = false;
			}
			if (Main.player[owner].petFlagDeadCellsSwarmBiter)
			{
				timeLeft = 2;
			}
		}
		if (type == 1046)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].petFlagPufferfish = false;
			}
			if (Main.player[owner].petFlagPufferfish)
			{
				timeLeft = 2;
			}
		}
		if (flag6)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].pygmy = false;
			}
			if (Main.player[owner].pygmy)
			{
				timeLeft = Main.rand.Next(2, 10);
			}
		}
		if (flag7)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].spiderMinion = false;
			}
			if (Main.player[owner].spiderMinion)
			{
				timeLeft = 2;
			}
		}
		if (type == 398)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].miniMinotaur = false;
			}
			if (Main.player[owner].miniMinotaur)
			{
				timeLeft = 2;
			}
		}
		if (flag11)
		{
			timeLeft = 2;
		}
		if (flag10 || type == 266 || flag7)
		{
			num = 10;
			int num3 = 40 * (minionPos + 1) * Main.player[owner].direction;
			if (Main.player[owner].Center.X < base.Center.X - (float)num + (float)num3)
			{
				flag2 = true;
			}
			else if (Main.player[owner].Center.X > base.Center.X + (float)num + (float)num3)
			{
				flag3 = true;
			}
		}
		else if (type == 1027)
		{
			num = 10;
			float num4 = 28 * -Main.player[owner].direction;
			float num5 = Main.player[owner].Center.X + num4;
			if (num5 < base.Center.X - (float)num)
			{
				flag2 = true;
			}
			else if (num5 > base.Center.X + (float)num)
			{
				flag3 = true;
			}
		}
		else if (type == 891)
		{
			num = 30;
			float num6 = -50 * -Main.player[owner].direction;
			float num7 = Main.player[owner].Center.X + num6;
			if (num7 < position.X + (float)(width / 2) - (float)num)
			{
				flag2 = true;
			}
			else if (num7 > position.X + (float)(width / 2) + (float)num)
			{
				flag3 = true;
			}
		}
		else if (type == 960 && !flag11)
		{
			num = 10;
			Player player = Main.player[owner];
			int num8 = ((player.Center.X - base.Center.X > 0f) ? 1 : (-1));
			if (player.velocity.X != 0f)
			{
				num8 = player.direction;
			}
			float num9 = -70 * num8;
			float num10 = player.Center.X + num9;
			if (num10 < base.Center.X - (float)num)
			{
				flag2 = true;
			}
			else if (num10 > base.Center.X + (float)num)
			{
				flag3 = true;
			}
		}
		else if (Main.player[owner].position.X + (float)(Main.player[owner].width / 2) < position.X + (float)(width / 2) - (float)num)
		{
			flag2 = true;
		}
		else if (Main.player[owner].position.X + (float)(Main.player[owner].width / 2) > position.X + (float)(width / 2) + (float)num)
		{
			flag3 = true;
		}
		if (num2)
		{
			flag2 = false;
			flag3 = true;
			num = 30;
		}
		if (flag12)
		{
			flag2 = false;
			flag3 = false;
		}
		if (flag8)
		{
			Player player2 = Main.player[owner];
			if (ai[0] >= 1000f)
			{
				localAI[0] = 0f;
				float num11 = 0f;
				if (spriteDirection == -1)
				{
					num11 = (float)Math.PI;
				}
				int num12 = 4;
				if (ai[0] == 1000f && Main.myPlayer == owner && player2.channel && !player2.noItems && !player2.CCed)
				{
					float num13 = player2.inventory[player2.selectedItem].shootSpeed * scale;
					Vector2 vector = player2.RotatedRelativePoint(player2.MountedCenter);
					Vector2 value = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector;
					if (player2.gravDir == -1f)
					{
						value.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector.Y;
					}
					Vector2 vector2 = Vector2.Normalize(value);
					if (float.IsNaN(vector2.X) || float.IsNaN(vector2.Y))
					{
						vector2 = -Vector2.UnitY;
					}
					vector2 *= num13;
					if (vector2.X != velocity.X || vector2.Y != velocity.Y)
					{
						netUpdate = true;
					}
					velocity = vector2;
				}
				direction = (spriteDirection = ((velocity.X > 0f) ? 1 : (-1)));
				if (velocity.X == 0f)
				{
					direction = (spriteDirection = player2.direction);
				}
				player2.heldProj = type;
				drawLayer = 7;
				position = player2.RotatedRelativePoint(player2.MountedCenter) - base.Size / 2f;
				rotation = velocity.ToRotation() + num11 + (float)Math.PI;
				spriteDirection = -direction;
				timeLeft = 2;
				float num14 = 0f;
				player2.ChangeDir(direction);
				player2.heldProj = whoAmI;
				if (player2.channel)
				{
					player2.SetDummyItemTime(2);
				}
				player2.itemRotation = MathHelper.WrapAngle((float)Math.Atan2(velocity.Y * (float)direction, velocity.X * (float)direction) + num14);
				if (ai[0] == 1000f && Main.myPlayer == owner && player2.channel && !player2.noItems && !player2.CCed)
				{
					int num15 = 1106;
					int num16 = (int)((float)damage * 0.75f);
					float num17 = 5f;
					int num18 = 0;
					for (int i = 0; i < 1; i++)
					{
						Vector2 vector3 = base.Center + new Vector2(Main.rand.Next(-num18, num18 + 1), Main.rand.Next(-num18, num18 + 1));
						Vector2 vector4 = Vector2.Normalize(velocity) * num17;
						if (float.IsNaN(vector4.X) || float.IsNaN(vector4.Y))
						{
							vector4 = -Vector2.UnitY;
						}
						int num19 = NewProjectile(GetProjectileSource_FromThis(), vector3.X, vector3.Y, vector4.X, vector4.Y, num15, num16, knockBack, owner);
						_ = Main.projectile[num19];
					}
				}
				if ((ai[0] += 1f) >= (float)(1000 + num12))
				{
					bool flag13 = player2.channel || Main.myPlayer != owner;
					ai[0] = (flag13 ? 1000 : 0);
					localAI[0] = 30f;
					if (ai[0] == 0f)
					{
						drawLayer = 0;
					}
					netUpdate = true;
				}
				return;
			}
			drawLayer = 0;
		}
		if (type == 175)
		{
			float num20 = 0.1f;
			tileCollide = false;
			int num21 = 300;
			Vector2 vector5 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num22 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector5.X;
			float num23 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector5.Y;
			if (type == 127)
			{
				num23 = Main.player[owner].position.Y - vector5.Y;
			}
			float num24 = (float)Math.Sqrt(num22 * num22 + num23 * num23);
			float num25 = 7f;
			float num26 = 2000f;
			bool num27 = num24 > num26;
			if (num24 < (float)num21 && Main.player[owner].velocity.Y == 0f && position.Y + (float)height <= Main.player[owner].position.Y + (float)Main.player[owner].height && !Collision.SolidCollision(position, width, height))
			{
				ai[0] = 0f;
				if (velocity.Y < -6f)
				{
					velocity.Y = -6f;
				}
			}
			if (num24 < 150f)
			{
				if (Math.Abs(velocity.X) > 2f || Math.Abs(velocity.Y) > 2f)
				{
					velocity *= 0.99f;
				}
				num20 = 0.01f;
				if (num22 < -2f)
				{
					num22 = -2f;
				}
				if (num22 > 2f)
				{
					num22 = 2f;
				}
				if (num23 < -2f)
				{
					num23 = -2f;
				}
				if (num23 > 2f)
				{
					num23 = 2f;
				}
			}
			else
			{
				if (num24 > 300f)
				{
					num20 = 0.2f;
				}
				num24 = num25 / num24;
				num22 *= num24;
				num23 *= num24;
			}
			if (num27)
			{
				int num28 = 17;
				for (int j = 0; j < 12; j++)
				{
					float speedX = 1f - Main.rand.NextFloat() * 2f;
					float speedY = 1f - Main.rand.NextFloat() * 2f;
					int num29 = Dust.NewDust(position, width, height, num28, speedX, speedY);
					Main.dust[num29].noLightEmittence = true;
					Main.dust[num29].noGravity = true;
				}
				base.Center = Main.player[owner].Center;
				velocity = Vector2.Zero;
				if (Main.myPlayer == owner)
				{
					netUpdate = true;
				}
			}
			if (Math.Abs(num22) > Math.Abs(num23) || num20 == 0.05f)
			{
				if (velocity.X < num22)
				{
					velocity.X += num20;
					if (num20 > 0.05f && velocity.X < 0f)
					{
						velocity.X += num20;
					}
				}
				if (velocity.X > num22)
				{
					velocity.X -= num20;
					if (num20 > 0.05f && velocity.X > 0f)
					{
						velocity.X -= num20;
					}
				}
			}
			if (Math.Abs(num22) <= Math.Abs(num23) || num20 == 0.05f)
			{
				if (velocity.Y < num23)
				{
					velocity.Y += num20;
					if (num20 > 0.05f && velocity.Y < 0f)
					{
						velocity.Y += num20;
					}
				}
				if (velocity.Y > num23)
				{
					velocity.Y -= num20;
					if (num20 > 0.05f && velocity.Y > 0f)
					{
						velocity.Y -= num20;
					}
				}
			}
			rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
			frameCounter++;
			if (frameCounter > 6)
			{
				frame++;
				frameCounter = 0;
			}
			if (frame > 1)
			{
				frame = 0;
			}
			return;
		}
		if (type == 197)
		{
			float num30 = 0.1f;
			tileCollide = false;
			int num31 = 300;
			Vector2 vector6 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num32 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector6.X;
			float num33 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector6.Y;
			if (type == 127)
			{
				num33 = Main.player[owner].position.Y - vector6.Y;
			}
			float num34 = (float)Math.Sqrt(num32 * num32 + num33 * num33);
			float num35 = 3f;
			if (num34 > 500f)
			{
				localAI[0] = 10000f;
			}
			if (localAI[0] >= 10000f)
			{
				num35 = 14f;
			}
			float num36 = 2000f;
			bool num37 = num34 > num36;
			if (num34 < (float)num31 && Main.player[owner].velocity.Y == 0f && position.Y + (float)height <= Main.player[owner].position.Y + (float)Main.player[owner].height && !Collision.SolidCollision(position, width, height))
			{
				ai[0] = 0f;
				if (velocity.Y < -6f)
				{
					velocity.Y = -6f;
				}
			}
			if (num34 < 150f)
			{
				if (Math.Abs(velocity.X) > 2f || Math.Abs(velocity.Y) > 2f)
				{
					velocity *= 0.99f;
				}
				num30 = 0.01f;
				if (num32 < -2f)
				{
					num32 = -2f;
				}
				if (num32 > 2f)
				{
					num32 = 2f;
				}
				if (num33 < -2f)
				{
					num33 = -2f;
				}
				if (num33 > 2f)
				{
					num33 = 2f;
				}
			}
			else
			{
				if (num34 > 300f)
				{
					num30 = 0.2f;
				}
				num34 = num35 / num34;
				num32 *= num34;
				num33 *= num34;
			}
			if (num37)
			{
				int num38 = 26;
				for (int k = 0; k < 12; k++)
				{
					float speedX2 = 1f - Main.rand.NextFloat() * 2f;
					float speedY2 = 1f - Main.rand.NextFloat() * 2f;
					int num39 = Dust.NewDust(position, width, height, num38, speedX2, speedY2);
					Main.dust[num39].noLightEmittence = true;
					Main.dust[num39].noGravity = true;
				}
				base.Center = Main.player[owner].Center;
				velocity = Vector2.Zero;
				if (Main.myPlayer == owner)
				{
					netUpdate = true;
				}
			}
			if (velocity.X < num32)
			{
				velocity.X += num30;
				if (num30 > 0.05f && velocity.X < 0f)
				{
					velocity.X += num30;
				}
			}
			if (velocity.X > num32)
			{
				velocity.X -= num30;
				if (num30 > 0.05f && velocity.X > 0f)
				{
					velocity.X -= num30;
				}
			}
			if (velocity.Y < num33)
			{
				velocity.Y += num30;
				if (num30 > 0.05f && velocity.Y < 0f)
				{
					velocity.Y += num30;
				}
			}
			if (velocity.Y > num33)
			{
				velocity.Y -= num30;
				if (num30 > 0.05f && velocity.Y > 0f)
				{
					velocity.Y -= num30;
				}
			}
			localAI[0] += Main.rand.Next(10);
			if (localAI[0] > 10000f)
			{
				if (localAI[1] == 0f)
				{
					if (velocity.X < 0f)
					{
						localAI[1] = -1f;
					}
					else
					{
						localAI[1] = 1f;
					}
				}
				rotation += 0.25f * localAI[1];
				if (localAI[0] > 12000f)
				{
					localAI[0] = 0f;
				}
			}
			else
			{
				localAI[1] = 0f;
				float num40 = velocity.X * 0.1f;
				if (rotation > num40)
				{
					rotation -= (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f;
					if (rotation < num40)
					{
						rotation = num40;
					}
				}
				if (rotation < num40)
				{
					rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f;
					if (rotation > num40)
					{
						rotation = num40;
					}
				}
			}
			if ((double)rotation > 6.28)
			{
				rotation -= 6.28f;
			}
			if ((double)rotation < -6.28)
			{
				rotation += 6.28f;
			}
			return;
		}
		if (type == 198 || type == 380 || type == 774 || type == 815 || type == 817 || type == 886 || type == 892 || type == 894 || type == 901 || type == 1046)
		{
			float num41 = 0.4f;
			if (type == 380)
			{
				num41 = 0.3f;
			}
			if (type == 774 || type == 1046)
			{
				num41 = 0.3f;
			}
			tileCollide = false;
			int num42 = 100;
			float num43 = 50f;
			float num44 = 400f;
			float num45 = num44 / 2f;
			float num46 = 2000f;
			bool flag14 = false;
			Vector2 vector7 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num47 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector7.X;
			float num48 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector7.Y;
			if (type == 774 || type == 1046)
			{
				num43 = 2f;
				float num49 = (float)Math.Sin((float)Math.PI * 2f * ((float)Main.player[owner].miscCounter / 60f));
				float num50 = Utils.GetLerpValue(0.5f, 1f, num49, clamped: true);
				if (new Vector2(num47 - (float)(70 * Main.player[owner].direction), num48 - 60f).Length() > 50f)
				{
					num49 = 0f;
					num50 = 0f;
				}
				num48 += -60f + num50 * -8f + num49 * 8f;
				num47 += (float)(70 * -Main.player[owner].direction);
			}
			else
			{
				if (type != 892 && type != 894)
				{
					num48 += (float)Main.rand.Next(-10, 21);
					num47 += (float)Main.rand.Next(-10, 21);
				}
				num47 += (float)(60 * -Main.player[owner].direction);
				num48 -= 60f;
			}
			Vector2 vector8 = new Vector2(num47, num48);
			if (type == 127)
			{
				num48 = Main.player[owner].position.Y - vector7.Y;
			}
			float num51 = (float)Math.Sqrt(num47 * num47 + num48 * num48);
			float num52 = num51;
			float num53 = 14f;
			if (type == 380)
			{
				num53 = 6f;
			}
			if (type == 815 || type == 817)
			{
				num53 = ((!(num51 < num44)) ? 10f : 6f);
			}
			if (type == 892 || type == 894 || type == 901)
			{
				if (num51 < num45)
				{
					num53 = 6f;
				}
				num53 = ((!(num51 < num44)) ? 12f : 9f);
			}
			if (type == 774)
			{
				num53 = 5f;
			}
			if (type == 1046)
			{
				num53 = 5f;
				if (num51 >= num44)
				{
					num53 = 8f;
				}
			}
			if (num51 < (float)num42 && Main.player[owner].velocity.Y == 0f && position.Y + (float)height <= Main.player[owner].position.Y + (float)Main.player[owner].height && !Collision.SolidCollision(position, width, height))
			{
				ai[0] = 0f;
				if (velocity.Y < -6f)
				{
					velocity.Y = -6f;
				}
			}
			if (num51 < num43)
			{
				if (Math.Abs(velocity.X) > 2f || Math.Abs(velocity.Y) > 2f)
				{
					if (type == 892 || type == 892)
					{
						velocity *= 0.95f;
					}
					else
					{
						velocity *= 0.99f;
					}
				}
				num41 = 0.01f;
			}
			else
			{
				if (type == 892 || type == 894 || type == 901)
				{
					if (num51 < 100f)
					{
						num41 = 0.1f;
					}
					if (num51 > num46)
					{
						flag14 = true;
					}
					else if (num51 > num44)
					{
						num41 = 0.7f;
					}
					else if (num51 > num45)
					{
						num41 = 0.5f;
					}
				}
				else if (type == 815 || type == 817)
				{
					if (num51 < 100f)
					{
						num41 = 0.1f;
					}
					if (num51 > num46)
					{
						flag14 = true;
					}
					else if (type != 815 && num51 > num44)
					{
						num41 = 0.5f;
					}
				}
				else if (type == 380)
				{
					if (num51 < 100f)
					{
						num41 = 0.1f;
					}
					if (num51 > 300f)
					{
						num41 = 0.4f;
					}
					if (num51 > num46)
					{
						flag14 = true;
					}
				}
				else if (type == 198 || type == 886)
				{
					if (num51 < 100f)
					{
						num41 = 0.1f;
					}
					if (num51 > 300f)
					{
						num41 = 0.6f;
					}
					if (num51 > num46)
					{
						flag14 = true;
					}
				}
				else if (type == 774 || type == 1046)
				{
					if (num51 < 40f)
					{
						num41 = 0.1f;
					}
					if (num51 > 300f)
					{
						num41 = 0.6f;
					}
					if (num51 > num46)
					{
						flag14 = true;
					}
				}
				num51 = num53 / num51;
				num47 *= num51;
				num48 *= num51;
			}
			if (velocity.X < num47)
			{
				velocity.X += num41;
				if (num41 > 0.05f && velocity.X < 0f)
				{
					velocity.X += num41;
				}
			}
			if (velocity.X > num47)
			{
				velocity.X -= num41;
				if (num41 > 0.05f && velocity.X > 0f)
				{
					velocity.X -= num41;
				}
			}
			if (velocity.Y < num48)
			{
				velocity.Y += num41;
				if (num41 > 0.05f && velocity.Y < 0f)
				{
					velocity.Y += num41 * 2f;
				}
			}
			if (velocity.Y > num48)
			{
				velocity.Y -= num41;
				if (num41 > 0.05f && velocity.Y > 0f)
				{
					velocity.Y -= num41 * 2f;
				}
			}
			if ((double)velocity.X > 0.25)
			{
				direction = -1;
			}
			else if ((double)velocity.X < -0.25)
			{
				direction = 1;
			}
			spriteDirection = direction;
			rotation = velocity.X * 0.05f;
			if (flag14)
			{
				int num54 = 33;
				if (type == 198 || type == 886)
				{
					num54 = 147;
				}
				if (type == 815)
				{
					num54 = 31;
				}
				if (type == 817)
				{
					num54 = 21;
				}
				for (int l = 0; l < 12; l++)
				{
					float speedX3 = 1f - Main.rand.NextFloat() * 2f;
					float speedY3 = 1f - Main.rand.NextFloat() * 2f;
					int num55 = Dust.NewDust(position, width, height, num54, speedX3, speedY3);
					Main.dust[num55].noLightEmittence = true;
					Main.dust[num55].noGravity = true;
				}
				base.Center = Main.player[owner].Center;
				velocity = Vector2.Zero;
				if (Main.myPlayer == owner)
				{
					netUpdate = true;
				}
			}
			bool flag15 = false;
			int num56 = 3;
			int num57 = 0;
			int num58 = 3;
			if (type == 380)
			{
				num56 = 6;
			}
			if (type == 815)
			{
				num56 = 5;
				num57 = 0;
				num58 = 5;
				if (num52 > num44)
				{
					num57 = 6;
					num58 = 9;
				}
			}
			if (type == 817)
			{
				num56 = 5;
				num57 = 0;
				num58 = 2;
				flag15 = true;
			}
			if (type == 901)
			{
				num56 = 4;
				num57 = 0;
				num58 = 5;
				if (num52 > num44 / 2f)
				{
					num56 = 3;
					num57 = 6;
					num58 = 11;
				}
			}
			if (type == 892)
			{
				num56 = 6;
				num57 = 0;
				num58 = Main.projFrames[type] - 1;
			}
			if (type == 886 || type == 894)
			{
				num56 = 4;
				num57 = 0;
				num58 = Main.projFrames[type] - 1;
			}
			if (type == 774)
			{
				if (Main.player[owner].velocity.Length() < 2f && vector8.Length() < 10f)
				{
					direction = -Main.player[owner].direction;
					spriteDirection = direction;
				}
				num56 = 6;
				if (!wet)
				{
					num57 += 4;
					num58 += 4;
				}
				rotation = velocity.X * 0.05f + Math.Abs(velocity.Y * -0.05f);
			}
			if (type == 1046)
			{
				num57 = 0;
				num58 = 3;
				if (Main.player[owner].velocity.Length() < 2f && vector8.Length() < 10f)
				{
					direction = -Main.player[owner].direction;
					spriteDirection = direction;
				}
				num56 = 7;
				bool num59 = num52 >= num44;
				bool flag16 = !wet;
				if (num59)
				{
					num57 = 4;
					num58 = 5;
					num56 = 6;
				}
				if (flag16)
				{
					num57 += 6;
					num58 += 6;
				}
				rotation = velocity.X * 0.05f + Math.Abs(velocity.Y * -0.05f);
			}
			if (flag15)
			{
				int num60 = num56 * (num58 - num57) * 2;
				frameCounter++;
				if (frameCounter >= num60)
				{
					frameCounter = 0;
				}
				frame = frameCounter / num56;
				if (frame > num58)
				{
					frame = num58 + (num58 - frame);
				}
				frame = (int)MathHelper.Clamp(frame, num57, num58);
			}
			else if (num56 > 0 && ++frameCounter >= num56)
			{
				frameCounter = 0;
				frame++;
				if (frame < num57 || frame > num58)
				{
					frame = num57;
				}
			}
			return;
		}
		if (type == 211)
		{
			float num61 = 0.2f;
			float num62 = 5f;
			tileCollide = false;
			Vector2 vector9 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num63 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector9.X;
			float num64 = Main.player[owner].position.Y + Main.player[owner].gfxOffY + (float)(Main.player[owner].height / 2) - vector9.Y;
			if (Main.player[owner].controlLeft)
			{
				num63 -= 120f;
			}
			else if (Main.player[owner].controlRight)
			{
				num63 += 120f;
			}
			if (Main.player[owner].controlDown)
			{
				num64 += 120f;
			}
			else
			{
				if (Main.player[owner].controlUp)
				{
					num64 -= 120f;
				}
				num64 -= 60f;
			}
			float num65 = (float)Math.Sqrt(num63 * num63 + num64 * num64);
			if (num65 > 1000f)
			{
				position.X += num63;
				position.Y += num64;
			}
			if (localAI[0] == 1f)
			{
				if (num65 < 10f)
				{
					Player player3 = Main.player[owner];
					if (Math.Abs(player3.velocity.X) + Math.Abs(player3.velocity.Y) < num62 && (player3.velocity.Y == 0f || (player3.mount.Active && player3.mount.CanFly(player3))))
					{
						localAI[0] = 0f;
					}
				}
				num62 = 12f;
				if (num65 < num62)
				{
					velocity.X = num63;
					velocity.Y = num64;
				}
				else
				{
					num65 = num62 / num65;
					velocity.X = num63 * num65;
					velocity.Y = num64 * num65;
				}
				if ((double)velocity.X > 0.5)
				{
					direction = -1;
				}
				else if ((double)velocity.X < -0.5)
				{
					direction = 1;
				}
				spriteDirection = direction;
				rotation -= (0.2f + Math.Abs(velocity.X) * 0.025f) * (float)direction;
				frameCounter++;
				if (frameCounter > 3)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 5)
				{
					frame = 5;
				}
				if (frame > 9)
				{
					frame = 5;
				}
				for (int m = 0; m < 2; m++)
				{
					int num66 = Dust.NewDust(new Vector2(position.X + 3f, position.Y + 4f), 14, 14, 156);
					Main.dust[num66].velocity *= 0.2f;
					Main.dust[num66].noGravity = true;
					Main.dust[num66].scale = 1.25f;
					Main.dust[num66].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cLight, Main.player[owner]);
				}
				return;
			}
			if (num65 > 200f)
			{
				localAI[0] = 1f;
			}
			if ((double)velocity.X > 0.5)
			{
				direction = -1;
			}
			else if ((double)velocity.X < -0.5)
			{
				direction = 1;
			}
			spriteDirection = direction;
			if (num65 < 10f)
			{
				velocity.X = num63;
				velocity.Y = num64;
				rotation = velocity.X * 0.05f;
				if (num65 < num62)
				{
					position += velocity;
					velocity *= 0f;
					num61 = 0f;
				}
				direction = -Main.player[owner].direction;
			}
			num65 = num62 / num65;
			num63 *= num65;
			num64 *= num65;
			if (velocity.X < num63)
			{
				velocity.X += num61;
				if (velocity.X < 0f)
				{
					velocity.X *= 0.99f;
				}
			}
			if (velocity.X > num63)
			{
				velocity.X -= num61;
				if (velocity.X > 0f)
				{
					velocity.X *= 0.99f;
				}
			}
			if (velocity.Y < num64)
			{
				velocity.Y += num61;
				if (velocity.Y < 0f)
				{
					velocity.Y *= 0.99f;
				}
			}
			if (velocity.Y > num64)
			{
				velocity.Y -= num61;
				if (velocity.Y > 0f)
				{
					velocity.Y *= 0.99f;
				}
			}
			if (velocity.X != 0f || velocity.Y != 0f)
			{
				rotation = velocity.X * 0.05f;
			}
			frameCounter++;
			if (frameCounter > 3)
			{
				frame++;
				frameCounter = 0;
			}
			if (frame > 4)
			{
				frame = 0;
			}
			return;
		}
		if (type == 199)
		{
			float num67 = 0.1f;
			tileCollide = false;
			int num68 = 200;
			Vector2 vector10 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num69 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector10.X;
			float num70 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector10.Y;
			num70 -= 60f;
			num69 -= 2f;
			if (type == 127)
			{
				num70 = Main.player[owner].position.Y - vector10.Y;
			}
			float num71 = (float)Math.Sqrt(num69 * num69 + num70 * num70);
			float num72 = 4f;
			float num73 = num71;
			float num74 = 2000f;
			bool num75 = num71 > num74;
			if (num71 < (float)num68 && Main.player[owner].velocity.Y == 0f && position.Y + (float)height <= Main.player[owner].position.Y + (float)Main.player[owner].height && !Collision.SolidCollision(position, width, height))
			{
				ai[0] = 0f;
				if (velocity.Y < -6f)
				{
					velocity.Y = -6f;
				}
			}
			if (num71 < 4f)
			{
				velocity.X = num69;
				velocity.Y = num70;
				num67 = 0f;
			}
			else
			{
				if (num71 > 350f)
				{
					num67 = 0.2f;
					num72 = 10f;
				}
				num71 = num72 / num71;
				num69 *= num71;
				num70 *= num71;
			}
			if (num75)
			{
				int num76 = 2;
				for (int n = 0; n < 12; n++)
				{
					float speedX4 = 1f - Main.rand.NextFloat() * 2f;
					float speedY4 = 1f - Main.rand.NextFloat() * 2f;
					int num77 = Dust.NewDust(position, width, height, num76, speedX4, speedY4);
					Main.dust[num77].noLightEmittence = true;
					Main.dust[num77].noGravity = true;
				}
				base.Center = Main.player[owner].Center;
				velocity = Vector2.Zero;
				if (Main.myPlayer == owner)
				{
					netUpdate = true;
				}
			}
			if (velocity.X < num69)
			{
				velocity.X += num67;
				if (velocity.X < 0f)
				{
					velocity.X += num67;
				}
			}
			if (velocity.X > num69)
			{
				velocity.X -= num67;
				if (velocity.X > 0f)
				{
					velocity.X -= num67;
				}
			}
			if (velocity.Y < num70)
			{
				velocity.Y += num67;
				if (velocity.Y < 0f)
				{
					velocity.Y += num67;
				}
			}
			if (velocity.Y > num70)
			{
				velocity.Y -= num67;
				if (velocity.Y > 0f)
				{
					velocity.Y -= num67;
				}
			}
			direction = -Main.player[owner].direction;
			spriteDirection = 1;
			rotation = velocity.Y * 0.05f * (float)(-direction);
			if (num73 >= 50f)
			{
				frameCounter++;
				if (frameCounter <= 6)
				{
					return;
				}
				frameCounter = 0;
				if (velocity.X < 0f)
				{
					if (frame < 2)
					{
						frame++;
					}
					if (frame > 2)
					{
						frame--;
					}
				}
				else
				{
					if (frame < 6)
					{
						frame++;
					}
					if (frame > 6)
					{
						frame--;
					}
				}
			}
			else
			{
				frameCounter++;
				if (frameCounter > 6)
				{
					frame += direction;
					frameCounter = 0;
				}
				if (frame > 7)
				{
					frame = 0;
				}
				if (frame < 0)
				{
					frame = 7;
				}
			}
			return;
		}
		if (type == 885 || type == 889)
		{
			Player player4 = Main.player[owner];
			float num78 = 0.15f;
			tileCollide = false;
			int num79 = 150;
			Vector2 center = base.Center;
			float num80 = player4.Center.X - center.X;
			float num81 = player4.Center.Y - center.Y;
			num81 -= 65f;
			num80 -= (float)(30 * player4.direction);
			float num82 = (float)Math.Sqrt(num80 * num80 + num81 * num81);
			float num83 = 8f;
			float num84 = num82;
			float num85 = 2000f;
			bool num86 = num82 > num85;
			if (num82 < (float)num79 && player4.velocity.Y == 0f && position.Y + (float)height <= player4.position.Y + (float)player4.height && !Collision.SolidCollision(position, width, height) && velocity.Y < -6f)
			{
				velocity.Y = -6f;
			}
			if (num82 < 10f)
			{
				velocity *= 0.9f;
				if (velocity.Length() < 0.5f)
				{
					velocity = Vector2.Zero;
				}
				num78 = 0f;
			}
			else
			{
				if (num82 > (float)num79)
				{
					num78 = 0.2f;
					num83 = 12f;
				}
				num82 = num83 / num82;
				num80 *= num82;
				num81 *= num82;
			}
			if (num86)
			{
				int num87 = 234;
				if (type == 889)
				{
					num87 = 60;
				}
				for (int num88 = 0; num88 < 12; num88++)
				{
					float speedX5 = 1f - Main.rand.NextFloat() * 2f;
					float speedY5 = 1f - Main.rand.NextFloat() * 2f;
					int num89 = Dust.NewDust(position, width, height, num87, speedX5, speedY5);
					Main.dust[num89].noLightEmittence = true;
					Main.dust[num89].noGravity = true;
				}
				base.Center = player4.Center;
				velocity = Vector2.Zero;
				if (Main.myPlayer == owner)
				{
					netUpdate = true;
				}
			}
			if (velocity.X < num80)
			{
				velocity.X += num78;
				if (velocity.X < 0f)
				{
					velocity.X += num78;
				}
			}
			if (velocity.X > num80)
			{
				velocity.X -= num78;
				if (velocity.X > 0f)
				{
					velocity.X -= num78;
				}
			}
			if (velocity.Y < num81)
			{
				velocity.Y += num78;
				if (velocity.Y < 0f)
				{
					velocity.Y += num78;
				}
			}
			if (velocity.Y > num81)
			{
				velocity.Y -= num78;
				if (velocity.Y > 0f)
				{
					velocity.Y -= num78;
				}
			}
			direction = -player4.direction;
			spriteDirection = -direction;
			int num90 = 100;
			if (num84 >= (float)num79)
			{
				rotation += 0.5f;
				if (rotation > (float)Math.PI * 2f)
				{
					rotation -= (float)Math.PI * 2f;
				}
				frame = 6;
				frameCounter = 0;
				if (type == 885)
				{
					localAI[0] = 0f;
				}
				if (type == 889)
				{
					localAI[0] += 3f;
					if (localAI[0] > (float)num90)
					{
						localAI[0] = num90;
					}
				}
				return;
			}
			rotation *= 0.95f;
			if (rotation < 0.05f)
			{
				rotation = 0f;
			}
			frameCounter++;
			if (type == 885)
			{
				switch (frameCounter)
				{
				case 10:
					localAI[0] = 0f;
					break;
				case 20:
					localAI[0] = 1f;
					break;
				case 30:
					localAI[0] = 2f;
					break;
				case 40:
					localAI[0] = 1f;
					break;
				}
			}
			if (type == 889)
			{
				localAI[0] -= 3f;
				if (localAI[0] < 0f)
				{
					localAI[0] = 0f;
				}
			}
			if (frameCounter % 5 == 0)
			{
				frame++;
				if (frame > 5)
				{
					frame = 0;
				}
			}
			if (frameCounter >= 40)
			{
				frameCounter = 0;
			}
			return;
		}
		bool flag17 = ai[1] == 0f;
		if (flag)
		{
			flag17 = true;
		}
		if (flag17)
		{
			int num91 = 500;
			if (type == 127)
			{
				num91 = 200;
			}
			if (type == 208)
			{
				num91 = 300;
			}
			switch (type)
			{
			case 816:
			case 825:
			case 854:
			case 858:
			case 859:
			case 860:
			case 881:
			case 884:
			case 890:
			case 891:
			case 897:
			case 900:
			case 934:
				num91 = 400;
				break;
			case 821:
			case 899:
				num91 = 500;
				break;
			}
			if (flag10 || type == 266 || flag7)
			{
				num91 += 40 * minionPos;
				if (localAI[0] > 0f)
				{
					num91 += 500;
				}
				if (type == 266 && localAI[0] > 0f)
				{
					num91 += 100;
				}
				if (flag7 && localAI[0] > 0f)
				{
					num91 += 400;
				}
			}
			bool flag18 = false;
			Vector2 vector11 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num92 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector11.X;
			float num93 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector11.Y;
			float num94 = (float)Math.Sqrt(num92 * num92 + num93 * num93);
			if (!flag11)
			{
				if (num94 > 2000f)
				{
					position.X = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - (float)(width / 2);
					position.Y = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - (float)(height / 2);
				}
				else if (num94 > (float)num91 || (Math.Abs(num93) > 300f && (!(flag10 || type == 266 || flag7) || !(localAI[0] > 0f))))
				{
					if (type != 324)
					{
						if (num93 > 0f && velocity.Y < 0f)
						{
							velocity.Y = 0f;
						}
						if (num93 < 0f && velocity.Y > 0f)
						{
							velocity.Y = 0f;
						}
					}
					flag18 = true;
				}
			}
			if (flag18)
			{
				if (flag8 && ai[0] != 1f)
				{
					alpha = 255;
				}
				ai[0] = 1f;
			}
		}
		if ((type == 209 || type == 956 || type == 1027) && ai[0] != 0f)
		{
			if (Main.player[owner].velocity.Y == 0f && alpha >= 100)
			{
				position.X = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - (float)(width / 2);
				position.Y = Main.player[owner].position.Y + (float)Main.player[owner].height - (float)height;
				ai[0] = 0f;
			}
			else
			{
				velocity.X = 0f;
				velocity.Y = 0f;
				if (type == 1027 && alpha < 255)
				{
					alpha = 255;
					int num95 = 25;
					float num96 = Main.rand.NextFloat() * ((float)Math.PI * 2f);
					for (int num97 = 0; num97 < num95; num97++)
					{
						bool flag19 = num97 % 2 == 0;
						float num98 = num96 + (float)num97 / (float)num95 * ((float)Math.PI * 2f);
						Vector2 value2 = new Vector2(0f, flag19 ? 2f : 4f).RotatedBy(num98);
						Dust dust = Dust.NewDustPerfect(base.Center, 282, value2);
						dust.scale = (flag19 ? 1.3f : 1.2f);
						dust.noGravity = true;
					}
				}
				if (type == 956 && alpha < 100)
				{
					int num99 = Dust.NewDust(position, width, height, 6, velocity.X, velocity.Y, 0, default(Color), 1.2f);
					Main.dust[num99].velocity.X += Main.rand.NextFloat() - 0.5f;
					Main.dust[num99].velocity.Y += (Main.rand.NextFloat() + 0.5f) * -1f;
					if (Main.rand.Next(3) != 0)
					{
						Main.dust[num99].noGravity = true;
					}
				}
				alpha += 5;
				if (alpha > 255)
				{
					alpha = 255;
				}
			}
		}
		else if (ai[0] != 0f && !flag11)
		{
			float num100 = 0.2f;
			int num101 = 200;
			if (type == 127)
			{
				num101 = 100;
			}
			if (flag10 || type == 816 || type == 821 || type == 825 || type == 854 || type == 858 || type == 859 || type == 860)
			{
				num100 = 0.5f;
				num101 = 100;
			}
			if (type == 875)
			{
				num100 = 2f;
				num101 = 100;
			}
			tileCollide = false;
			Vector2 vector12 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num102 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector12.X;
			if (flag10 || type == 266 || flag7)
			{
				num102 -= (float)(40 * Main.player[owner].direction);
				float num103 = 700f;
				if (flag10)
				{
					num103 += 100f;
				}
				bool flag20 = false;
				int num104 = -1;
				for (int num105 = 0; num105 < Main.maxNPCs; num105++)
				{
					if (!Main.npc[num105].CanBeChasedBy(this))
					{
						continue;
					}
					float num106 = Main.npc[num105].position.X + (float)(Main.npc[num105].width / 2);
					float num107 = Main.npc[num105].position.Y + (float)(Main.npc[num105].height / 2);
					if (Math.Abs(Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - num106) + Math.Abs(Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - num107) < num103)
					{
						if (Collision.CanHit(position, width, height, Main.npc[num105].position, Main.npc[num105].width, Main.npc[num105].height))
						{
							num104 = num105;
						}
						flag20 = true;
						break;
					}
				}
				if (!flag20)
				{
					num102 -= (float)(40 * minionPos * Main.player[owner].direction);
				}
				if (flag20 && num104 >= 0)
				{
					ai[0] = 0f;
				}
			}
			float num108 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector12.Y;
			if (type == 127)
			{
				num108 = Main.player[owner].position.Y - vector12.Y;
			}
			float num109 = (float)Math.Sqrt(num102 * num102 + num108 * num108);
			float num110 = num109;
			float num111 = 10f;
			float num112 = num109;
			if (type == 111)
			{
				num111 = 11f;
			}
			if (type == 127)
			{
				num111 = 9f;
			}
			if (type == 875)
			{
				num100 = 1.8f;
				num111 = 16f;
			}
			if (type == 324)
			{
				num111 = 20f;
			}
			if (flag10 || type == 816 || type == 821 || type == 825 || type == 854 || type == 858 || type == 859 || type == 860 || type == 956 || type == 958 || type == 959 || type == 960 || type == 994 || type == 998 || type == 1003 || type == 1004 || type == 1027 || type == 1095 || type == 1096)
			{
				num100 = 0.4f;
				num111 = 12f;
				if (flag10)
				{
					num100 = 0.8f;
				}
				if (num111 < Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y))
				{
					num111 = Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y);
				}
			}
			if (type == 208 && Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y) > 4f)
			{
				num101 = -1;
			}
			if (num109 < (float)num101 && Main.player[owner].velocity.Y == 0f && position.Y + (float)height <= Main.player[owner].position.Y + (float)Main.player[owner].height && !Collision.SolidCollision(position, width, height))
			{
				ai[0] = 0f;
				if (velocity.Y < -6f)
				{
					velocity.Y = -6f;
				}
			}
			if (num109 < 60f)
			{
				num102 = velocity.X;
				num108 = velocity.Y;
			}
			else
			{
				num109 = num111 / num109;
				num102 *= num109;
				num108 *= num109;
			}
			if (type == 324)
			{
				if (num112 > 1000f)
				{
					if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) < (double)num111 - 1.25)
					{
						velocity *= 1.025f;
					}
					if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) > (double)num111 + 1.25)
					{
						velocity *= 0.975f;
					}
				}
				else if (num112 > 600f)
				{
					if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < num111 - 1f)
					{
						velocity *= 1.05f;
					}
					if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) > num111 + 1f)
					{
						velocity *= 0.95f;
					}
				}
				else if (num112 > 400f)
				{
					if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) < (double)num111 - 0.5)
					{
						velocity *= 1.075f;
					}
					if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) > (double)num111 + 0.5)
					{
						velocity *= 0.925f;
					}
				}
				else
				{
					if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) < (double)num111 - 0.25)
					{
						velocity *= 1.1f;
					}
					if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) > (double)num111 + 0.25)
					{
						velocity *= 0.9f;
					}
				}
				velocity.X = (velocity.X * 34f + num102) / 35f;
				velocity.Y = (velocity.Y * 34f + num108) / 35f;
			}
			else if (type == 875)
			{
				if (num110 < (float)num101)
				{
					if (velocity.X < num102)
					{
						velocity.X += num100;
					}
					else if (velocity.X > num102)
					{
						velocity.X -= num100;
					}
					if (velocity.Y < num108)
					{
						velocity.Y += num100;
					}
					else if (velocity.Y > num108)
					{
						velocity.Y -= num100;
					}
				}
				else
				{
					velocity = Vector2.Lerp(velocity, new Vector2(num102, num108), 0.75f);
				}
			}
			else
			{
				if (velocity.X < num102)
				{
					velocity.X += num100;
					if (velocity.X < 0f)
					{
						velocity.X += num100 * 1.5f;
					}
				}
				if (velocity.X > num102)
				{
					velocity.X -= num100;
					if (velocity.X > 0f)
					{
						velocity.X -= num100 * 1.5f;
					}
				}
				if (velocity.Y < num108)
				{
					velocity.Y += num100;
					if (velocity.Y < 0f)
					{
						velocity.Y += num100 * 1.5f;
					}
				}
				if (velocity.Y > num108)
				{
					velocity.Y -= num100;
					if (velocity.Y > 0f)
					{
						velocity.Y -= num100 * 1.5f;
					}
				}
			}
			if (type == 111)
			{
				frame = 7;
			}
			if (flag6 && frame < 12)
			{
				frame = Main.rand.Next(12, 18);
				frameCounter = 0;
			}
			if (type != 313)
			{
				if ((double)velocity.X > 0.5)
				{
					spriteDirection = -1;
				}
				else if ((double)velocity.X < -0.5)
				{
					spriteDirection = 1;
				}
			}
			if (flag8)
			{
				frame = 0;
				frameCounter = 0;
				base.Center = Main.player[owner].MountedCenter + new Vector2(0f, -10f);
				position = position.Floor();
				rotation = 0f;
				direction = (spriteDirection = Main.player[owner].direction);
				velocity = new Vector2(direction, 0f);
				Player player5 = Main.player[owner];
				if (player5.mount.Active && MountID.Sets.PlayerIsHidden[player5.mount.Type])
				{
					alpha = 255;
				}
			}
			else if (type == 112)
			{
				frameCounter++;
				if (frame < 3)
				{
					frame = 3;
					frameCounter = 0;
				}
				if (frameCounter > 3)
				{
					frameCounter = 0;
					frame++;
					if (frame >= Main.projFrames[type])
					{
						frame = 3;
					}
				}
				rotation = velocity.X * 0.125f;
			}
			else if (type == 900)
			{
				if (velocity.X != 0f)
				{
					spriteDirection = Math.Sign(velocity.X);
				}
				frameCounter++;
				if (frame < 10)
				{
					frame = 10;
					frameCounter = 0;
				}
				if (frameCounter > 3)
				{
					frameCounter = 0;
					frame++;
					if (frame >= Main.projFrames[type])
					{
						frame = 10;
					}
				}
				rotation = velocity.X * 0.125f;
			}
			else if (type == 899)
			{
				if (velocity.X != 0f)
				{
					spriteDirection = Math.Sign(velocity.X);
				}
				frameCounter++;
				if (frame < 10)
				{
					frame = 10;
					frameCounter = 0;
				}
				if (frameCounter > 3)
				{
					frameCounter = 0;
					frame++;
					if (frame >= Main.projFrames[type])
					{
						frame = 10;
					}
				}
				Vector2 v = velocity.SafeNormalize(Vector2.UnitX);
				rotation = v.ToRotation();
				if (velocity.X < 0f)
				{
					rotation += (float)Math.PI;
				}
			}
			else if (type == 897)
			{
				spriteDirection = 1;
				frameCounter++;
				if (frame < 8)
				{
					frame = 8;
					frameCounter = 0;
				}
				if (frameCounter > 3)
				{
					frameCounter = 0;
					frame++;
					if (frame >= Main.projFrames[type])
					{
						frame = 8;
					}
				}
				Vector2 v2 = velocity.SafeNormalize(-Vector2.UnitY);
				rotation = v2.ToRotation() + (float)Math.PI / 2f;
			}
			else if (type == 891)
			{
				spriteDirection = 1;
				frameCounter++;
				if (frame < 9)
				{
					frame = 9;
					frameCounter = 0;
				}
				if (frameCounter > 3)
				{
					frameCounter = 0;
					frame++;
					if (frame >= Main.projFrames[type])
					{
						frame = 9;
					}
				}
				Vector2 v3 = velocity.SafeNormalize(-Vector2.UnitY);
				rotation = v3.ToRotation() + (float)Math.PI / 2f;
			}
			else if (type == 890)
			{
				if (velocity.X != 0f)
				{
					spriteDirection = Math.Sign(velocity.X);
				}
				frameCounter++;
				if (frame < 9)
				{
					frame = 9;
					frameCounter = 0;
				}
				if (frameCounter > 3)
				{
					frameCounter = 0;
					frame++;
					if (frame >= Main.projFrames[type])
					{
						frame = 9;
					}
				}
				rotation = velocity.X * 0.025f;
			}
			else if (type == 884)
			{
				if (velocity.X != 0f)
				{
					spriteDirection = Math.Sign(velocity.X);
				}
				frameCounter++;
				if (frame < 9)
				{
					frame = 9;
					frameCounter = 0;
				}
				if (frameCounter > 3)
				{
					frameCounter = 0;
					frame++;
					if (frame >= Main.projFrames[type])
					{
						frame = 9;
					}
				}
				Vector2 v4 = velocity.SafeNormalize(-Vector2.UnitY);
				rotation = v4.ToRotation() + (float)Math.PI / 2f;
			}
			else if (type == 881 || type == 934)
			{
				int num113 = 1226;
				if (type == 934)
				{
					num113 = 1261;
				}
				if (frame < 6 || frame > 11)
				{
					Gore.NewGore(new Vector2(base.Center.X, position.Y), velocity * 0.5f, num113);
				}
				frameCounter++;
				if (frameCounter > 4)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 6 || frame > 11)
				{
					frame = 6;
				}
				Vector2 v5 = velocity.SafeNormalize(-Vector2.UnitY);
				rotation = v5.ToRotation() + (float)Math.PI / 2f;
			}
			else if (type == 875)
			{
				if (++frameCounter > 4)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 7 || frame > 10)
				{
					frame = 7;
				}
				Vector2 v6 = velocity.SafeNormalize(-Vector2.UnitX * spriteDirection);
				rotation = v6.ToRotation() + ((spriteDirection == -1) ? 0f : ((float)Math.PI));
			}
			else if (type == 825)
			{
				if (++frameCounter > 4)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 21 || frame > 25)
				{
					frame = 21;
				}
				rotation = velocity.X * 0.025f;
			}
			else if (type == 854)
			{
				if (frame < 13)
				{
					Gore.NewGore(new Vector2(base.Center.X, position.Y), velocity * 0.5f, 1269);
				}
				if (++frameCounter > 4)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 13 || frame > 18)
				{
					frame = 13;
				}
				Vector2 v7 = velocity.SafeNormalize(-Vector2.UnitY);
				rotation = v7.ToRotation() + (float)Math.PI / 2f;
			}
			else if (type == 858)
			{
				if (++frameCounter > 4)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 10 || frame > 13)
				{
					frame = 10;
				}
				Vector2 v8 = velocity.SafeNormalize(-Vector2.UnitX * spriteDirection);
				rotation = v8.ToRotation() + ((spriteDirection == -1) ? 0f : ((float)Math.PI));
			}
			else if (type == 859)
			{
				if (++frameCounter > 4)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 18 || frame > 23)
				{
					frame = 18;
				}
				rotation = velocity.X * 0.025f;
			}
			else if (type == 860)
			{
				if (frame < 6)
				{
					frame = 8;
					frameCounter = 0;
				}
				if (++frameCounter > 4)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame > 13)
				{
					frame = 6;
				}
				Vector2 v9 = velocity.SafeNormalize(-Vector2.UnitY);
				rotation = v9.ToRotation() + (float)Math.PI / 2f;
			}
			else if (type == 816)
			{
				if (++frameCounter > 4)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 11 || frame > 16)
				{
					frame = 11;
				}
				rotation = velocity.X * 0.025f;
			}
			else if (type == 821)
			{
				if (++frameCounter > 4)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 19 || frame > 22)
				{
					frame = 19;
				}
				rotation = velocity.X * 0.025f;
			}
			else if (type == 958)
			{
				if (velocity.X != 0f)
				{
					spriteDirection = Math.Sign(velocity.X);
				}
				if (frame < 13)
				{
					frame = 13;
					frameCounter = 0;
				}
				if (++frameCounter > 4)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame > 16)
				{
					frame = 13;
				}
				rotation = MathHelper.Clamp(velocity.X * 0.025f, -0.4f, 0.4f);
			}
			else if (type == 960)
			{
				if (velocity.X != 0f)
				{
					spriteDirection = Math.Sign(velocity.X);
				}
				frame = 4;
				frameCounter = 0;
				Vector2 v10 = velocity.SafeNormalize(-Vector2.UnitY);
				rotation = v10.ToRotation() + (float)Math.PI / 2f;
			}
			else if (type == 959)
			{
				if (velocity.X != 0f)
				{
					spriteDirection = Math.Sign(velocity.X);
				}
				frame = 11;
				frameCounter = 0;
				rotation = MathHelper.Clamp(velocity.X * 0.025f, -0.4f, 0.4f);
				float num114 = Vector2.Dot(velocity.SafeNormalize(Vector2.UnitX), new Vector2(0f, -1f));
				if (num114 > 0f && Main.rand.NextFloat() < 0.3f + num114 * 0.3f)
				{
					Dust dust2 = Dust.NewDustDirect(position, width, height, 16, velocity.X * 0.7f, velocity.Y * 1.2f, 150, default(Color), 0.6f);
					dust2.noGravity = true;
					dust2.fadeIn = 1f;
					dust2.velocity.X = velocity.X * 0.3f;
					dust2.position = base.Top + new Vector2(0f, -10f) + new Vector2(Main.rand.NextFloatDirection() * 30f, Main.rand.NextFloatDirection() * 10f);
					dust2.velocity *= 0.7f;
					dust2.position += dust2.velocity * 2f;
				}
			}
			else if (type == 1095 || type == 1096)
			{
				if (velocity.X != 0f)
				{
					spriteDirection = Math.Sign(velocity.X);
				}
				frame = 11;
				frameCounter = 0;
				rotation = MathHelper.Clamp(velocity.X * 0.025f, -0.4f, 0.4f);
				float num115 = Vector2.Dot(velocity.SafeNormalize(Vector2.UnitX), new Vector2(0f, -1f));
				if (num115 > 0f && Main.rand.NextFloat() < 0.3f + num115 * 0.3f)
				{
					Dust dust3 = Dust.NewDustDirect(position, width, height, 16, velocity.X * 0.7f, velocity.Y * 1.2f, 150, default(Color), 0.6f);
					dust3.noGravity = true;
					dust3.fadeIn = 1f;
					dust3.velocity.X = velocity.X * 0.3f;
					dust3.position = base.Top + new Vector2(0f, -10f) + new Vector2(Main.rand.NextFloatDirection() * 30f, Main.rand.NextFloatDirection() * 10f);
					dust3.velocity *= 0.7f;
					dust3.position += dust3.velocity * 2f;
				}
			}
			else if (type == 994)
			{
				if (velocity.X != 0f)
				{
					spriteDirection = Math.Sign(velocity.X);
				}
				frameCounter++;
				if (frameCounter > 5)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 13 || frame > 15)
				{
					frame = 13;
				}
				rotation = MathHelper.Clamp(velocity.X * 0.025f, -0.4f, 0.4f);
			}
			else if (type == 998)
			{
				if (velocity.X != 0f)
				{
					spriteDirection = -Math.Sign(velocity.X);
				}
				frameCounter++;
				if (frameCounter > 4)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 6 || frame > 9)
				{
					frame = 6;
				}
				rotation = MathHelper.Clamp(velocity.X * 0.025f, -0.4f, 0.4f);
			}
			else if (type == 1003)
			{
				if (velocity.X != 0f)
				{
					spriteDirection = -Math.Sign(velocity.X);
				}
				frameCounter++;
				if (frameCounter > 3)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 12 || frame > 15)
				{
					frame = 12;
				}
				rotation = MathHelper.Clamp(velocity.X * 0.025f, -0.35f, 0.35f);
			}
			else if (type == 1004)
			{
				if (velocity.X != 0f)
				{
					spriteDirection = -Math.Sign(velocity.X);
				}
				frameCounter++;
				if (frameCounter > 3)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 10 || frame > 14)
				{
					frame = 10;
				}
				rotation = MathHelper.Clamp(velocity.X * 0.025f, -0.35f, 0.35f);
			}
			else if (type == 112)
			{
				if (spriteDirection == -1)
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				}
				else
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				}
			}
			else if (flag7)
			{
				int num116 = (int)(base.Center.X / 16f);
				int num117 = (int)(base.Center.Y / 16f);
				if (Main.tile[num116, num117] != null && Main.tile[num116, num117].wall > 0)
				{
					rotation = velocity.ToRotation() + (float)Math.PI / 2f;
					frameCounter += (int)(Math.Abs(velocity.X) + Math.Abs(velocity.Y));
					if (frameCounter > 5)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 7)
					{
						frame = 4;
					}
					if (frame < 4)
					{
						frame = 7;
					}
				}
				else
				{
					frameCounter++;
					if (frameCounter > 2)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 8 || frame > 10)
					{
						frame = 8;
					}
					rotation = velocity.X * 0.1f;
				}
			}
			else if (type == 334)
			{
				frameCounter++;
				if (frameCounter > 1)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 7 || frame > 10)
				{
					frame = 7;
				}
				rotation = velocity.X * 0.1f;
			}
			else if (type == 353)
			{
				frameCounter++;
				if (frameCounter > 6)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 10 || frame > 13)
				{
					frame = 10;
				}
				rotation = velocity.X * 0.05f;
			}
			else if (type == 127)
			{
				frameCounter += 3;
				if (frameCounter > 6)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame <= 5 || frame > 15)
				{
					frame = 6;
				}
				rotation = velocity.X * 0.1f;
			}
			else if (type == 269)
			{
				if (frame == 6)
				{
					frameCounter = 0;
				}
				else if (frame < 4 || frame > 6)
				{
					frameCounter = 0;
					frame = 4;
				}
				else
				{
					frameCounter++;
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
				}
				rotation = velocity.X * 0.05f;
			}
			else if (type == 266)
			{
				frameCounter++;
				if (frameCounter > 5)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 8 || frame >= Main.projFrames[266])
				{
					frame = 8;
				}
				rotation = velocity.X * 0.1f;
			}
			else if (type == 324)
			{
				frameCounter++;
				if (frameCounter > 1)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 6 || frame > 9)
				{
					frame = 6;
				}
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.58f;
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.9f, 0.6f, 0.2f);
				for (int num118 = 0; num118 < 2; num118++)
				{
					int num119 = 4;
					int num120 = Dust.NewDust(new Vector2(base.Center.X - (float)num119, base.Center.Y - (float)num119) - velocity * 0f, num119 * 2, num119 * 2, 6, 0f, 0f, 100);
					Main.dust[num120].scale *= 1.8f + (float)Main.rand.Next(10) * 0.1f;
					Main.dust[num120].velocity *= 0.2f;
					if (num118 == 1)
					{
						Main.dust[num120].position -= velocity * 0.5f;
					}
					Main.dust[num120].noGravity = true;
					num120 = Dust.NewDust(new Vector2(base.Center.X - (float)num119, base.Center.Y - (float)num119) - velocity * 0f, num119 * 2, num119 * 2, 31, 0f, 0f, 100, default(Color), 0.5f);
					Main.dust[num120].fadeIn = 1f + (float)Main.rand.Next(5) * 0.1f;
					Main.dust[num120].velocity *= 0.05f;
					if (num118 == 1)
					{
						Main.dust[num120].position -= velocity * 0.5f;
					}
				}
			}
			else if (type == 268)
			{
				frameCounter++;
				if (frameCounter > 4)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 6 || frame > 7)
				{
					frame = 6;
				}
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.58f;
			}
			else if (type == 200)
			{
				frameCounter += 3;
				if (frameCounter > 6)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame <= 5 || frame > 9)
				{
					frame = 6;
				}
				rotation = velocity.X * 0.1f;
			}
			else if (type == 208)
			{
				rotation = velocity.X * 0.075f;
				frameCounter++;
				if (frameCounter > 6)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame > 4)
				{
					frame = 1;
				}
				if (frame < 1)
				{
					frame = 1;
				}
			}
			else if (type == 236)
			{
				rotation = velocity.Y * 0.05f * (float)direction;
				if (velocity.Y < 0f)
				{
					frameCounter += 2;
				}
				else
				{
					frameCounter++;
				}
				if (frameCounter >= 6)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame > 12)
				{
					frame = 9;
				}
				if (frame < 9)
				{
					frame = 9;
				}
			}
			else if (type == 499)
			{
				rotation = velocity.Y * 0.05f * (float)direction;
				if (velocity.Y < 0f)
				{
					frameCounter += 2;
				}
				else
				{
					frameCounter++;
				}
				if (frameCounter >= 6)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame >= 12)
				{
					frame = 8;
				}
				if (frame < 8)
				{
					frame = 8;
				}
			}
			else if (type == 765)
			{
				rotation = velocity.Y * 0.05f * (float)direction;
				frameCounter++;
				if (frameCounter >= 8)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame >= 10)
				{
					frame = 8;
				}
				if (frame < 6)
				{
					frame = 6;
				}
			}
			else if (type == 314)
			{
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.58f;
				frameCounter++;
				if (frameCounter >= 3)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame > 12)
				{
					frame = 7;
				}
				if (frame < 7)
				{
					frame = 7;
				}
			}
			else if (type == 319)
			{
				rotation = velocity.X * 0.05f;
				frameCounter++;
				if (frameCounter >= 6)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame > 10)
				{
					frame = 6;
				}
				if (frame < 6)
				{
					frame = 6;
				}
			}
			else if (type == 210)
			{
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.58f;
				frameCounter += 3;
				if (frameCounter > 6)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame > 11)
				{
					frame = 7;
				}
				if (frame < 7)
				{
					frame = 7;
				}
			}
			else if (type == 313)
			{
				position.Y += height;
				height = 54;
				position.Y -= height;
				position.X += width / 2;
				width = 54;
				position.X -= width / 2;
				rotation += velocity.X * 0.01f;
				frameCounter = 0;
				frame = 11;
			}
			else if (type == 398)
			{
				if ((double)velocity.X > 0.5)
				{
					spriteDirection = 1;
				}
				else if ((double)velocity.X < -0.5)
				{
					spriteDirection = -1;
				}
				frameCounter++;
				if (frameCounter > 4)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame < 7 || frame > 10)
				{
					frame = 7;
				}
			}
			else if (spriteDirection == -1)
			{
				rotation = (float)Math.Atan2(velocity.Y, velocity.X);
			}
			else
			{
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 3.14f;
			}
			if (!flag10 && type != 499 && type != 765 && type != 816 && type != 821 && type != 825 && type != 859 && type != 881 && type != 884 && type != 890 && type != 891 && type != 900 && type != 934 && type != 958 && type != 959 && type != 960 && type != 994 && type != 998 && type != 1003 && type != 1004 && type != 1027 && type != 1095 && type != 1096)
			{
				if (type == 899)
				{
					int num121 = 6;
					if (Main.rand.Next(4) == 0)
					{
						num121 = 31;
					}
					int num122 = Dust.NewDust(base.Center + new Vector2(-8f, 0f) - velocity * 0.25f, 15, 15, num121, (0f - velocity.X) * 0.5f, velocity.Y * 0.5f, 0, default(Color), 1.3f);
					Main.dust[num122].velocity.X = Main.dust[num122].velocity.X * 0.2f;
					Main.dust[num122].velocity.Y = Main.dust[num122].velocity.Y * 0.2f - 0.2f;
					Main.dust[num122].noGravity = true;
				}
				else if (type == 897)
				{
					int num123 = 6;
					if (Main.rand.Next(4) == 0)
					{
						num123 = 31;
					}
					int num124 = Dust.NewDust(base.Center + new Vector2(-8f, -8f) - velocity * 0.25f, 15, 15, num123, (0f - velocity.X) * 0.5f, velocity.Y * 0.5f, 0, default(Color), 1.3f);
					Main.dust[num124].velocity.X = Main.dust[num124].velocity.X * 0.2f;
					Main.dust[num124].velocity.Y = Main.dust[num124].velocity.Y * 0.2f - 0.2f;
					Main.dust[num124].noGravity = true;
				}
				else if (type == 875)
				{
					if (Main.rand.Next(3) == 0)
					{
						Gore.NewGorePerfect(base.Center + new Vector2(-10f + (float)Main.rand.Next(-20, 20) * 0.5f, -10f + (float)Main.rand.Next(-20, 20) * 0.5f), velocity * 0.1f, 1225, 0.5f + Main.rand.NextFloat() * 1f);
						Vector2 vector13 = Main.rand.NextVector2CircularEdge(2f, 2f) + velocity * -0.5f;
						vector13 *= 0.5f;
						int num125 = Dust.NewDust(base.Center - velocity * 1.5f - new Vector2(7f, 7f), 15, 15, 226, vector13.X, vector13.Y, 0, default(Color), 0.65f);
						Main.dust[num125].noGravity = true;
					}
				}
				else if (type == 860)
				{
					int num126 = Dust.NewDust(new Vector2(position.X + (float)(width / 2) - 4f, position.Y + (float)(height / 2) - 4f) + velocity, 8, 8, 27, (0f - velocity.X) * 0.5f, velocity.Y * 0.5f);
					Main.dust[num126].velocity.X = Main.dust[num126].velocity.X * 0.2f;
					Main.dust[num126].velocity.Y = Main.dust[num126].velocity.Y * 0.2f - 0.2f;
					Main.dust[num126].velocity += new Vector2((float)Main.rand.Next(-10, 10) * 0.4f, (float)Main.rand.Next(-10, 10) * 0.4f) * 0.5f;
					Main.dust[num126].noGravity = true;
				}
				else if (type == 858)
				{
					int num127 = 6;
					if (Main.rand.Next(4) == 0)
					{
						num127 = 31;
					}
					int num128 = Dust.NewDust(new Vector2(position.X + (float)(width / 2) - 4f, position.Y + (float)(height / 2) - 4f) - velocity, 10, 10, num127, (0f - velocity.X) * 0.5f, velocity.Y * 0.5f, 0, default(Color), 1.3f);
					Main.dust[num128].velocity.X = Main.dust[num128].velocity.X * 0.2f;
					Main.dust[num128].velocity.Y = Main.dust[num128].velocity.Y * 0.2f - 0.2f;
					Main.dust[num128].noGravity = true;
				}
				else if (type == 112)
				{
					int num129 = 6;
					if (Main.rand.Next(4) == 0)
					{
						num129 = 31;
					}
					int num130 = Dust.NewDust(base.Center + new Vector2(12 * spriteDirection, 4f).RotatedBy(rotation) + new Vector2(-5f, -5f), 10, 10, num129, (0f - velocity.X) * 0.5f, velocity.Y * 0.5f, 0, default(Color), 1.3f);
					Main.dust[num130].velocity.X = Main.dust[num130].velocity.X * 0.2f;
					Main.dust[num130].velocity.Y = Main.dust[num130].velocity.Y * 0.2f - 0.2f;
					Main.dust[num130].noGravity = true;
				}
				else if (type == 854)
				{
					if (Main.rand.Next(6) == 0)
					{
						Vector2 vector14 = base.Center / 16f;
						int i2 = (int)vector14.X;
						int num131 = (int)vector14.Y;
						Tile tileSafely = Framing.GetTileSafely(i2, num131 + 1);
						if (!WorldGen.SolidTile(tileSafely) && tileSafely.liquid == 0)
						{
							Gore gore = Gore.NewGorePerfect(base.Center + new Vector2((float)Main.rand.Next(-30, 30) * 0.5f, (float)Main.rand.Next(-30, 30) * 0.5f), velocity * -0.2f, 910);
							gore.Frame.CurrentColumn = 0;
							gore.timeLeft = 1;
						}
					}
				}
				else if (type != 398 && type != 390 && type != 391 && type != 392 && type != 127 && type != 200 && type != 208 && type != 210 && type != 236 && type != 266 && type != 268 && type != 269 && type != 313 && type != 314 && type != 319 && type != 324 && type != 334 && type != 353)
				{
					int num132 = Dust.NewDust(new Vector2(position.X + (float)(width / 2) - 4f, position.Y + (float)(height / 2) - 4f) - velocity, 8, 8, 16, (0f - velocity.X) * 0.5f, velocity.Y * 0.5f, 50, default(Color), 1.7f);
					Main.dust[num132].velocity.X = Main.dust[num132].velocity.X * 0.2f;
					Main.dust[num132].velocity.Y = Main.dust[num132].velocity.Y * 0.2f;
					Main.dust[num132].noGravity = true;
				}
			}
		}
		else
		{
			if (flag10)
			{
				float num133 = 40 * minionPos;
				int num134 = 30;
				int num135 = 60;
				if (flag8)
				{
					num134 = 42;
				}
				localAI[0] -= 1f;
				if (localAI[0] < 0f)
				{
					localAI[0] = 0f;
				}
				bool flag21 = false;
				if (flag8)
				{
					flag21 = true;
				}
				if (flag21 && ai[1] > 0f)
				{
					ai[1] -= 1f;
				}
				bool flag22 = ai[1] <= 0f;
				if (flag8 && (alpha > 0 || localAI[0] > 0f))
				{
					flag22 = false;
				}
				if (!flag21 && ai[1] > 0f)
				{
					ai[1] -= 1f;
				}
				if (flag22)
				{
					float num136 = position.X;
					float num137 = position.Y;
					float num138 = 100000f;
					float num139 = num138;
					int num140 = -1;
					float num141 = 20f;
					NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
					if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this))
					{
						float num142 = ownerMinionAttackTargetNPC.position.X + (float)(ownerMinionAttackTargetNPC.width / 2);
						float num143 = ownerMinionAttackTargetNPC.position.Y + (float)(ownerMinionAttackTargetNPC.height / 2);
						float num144 = Math.Abs(position.X + (float)(width / 2) - num142) + Math.Abs(position.Y + (float)(height / 2) - num143);
						if (num144 < num138)
						{
							if (num140 == -1 && num144 <= num139)
							{
								num139 = num144;
								num136 = num142;
								num137 = num143;
							}
							if (Collision.CanHit(position, width, height, ownerMinionAttackTargetNPC.position, ownerMinionAttackTargetNPC.width, ownerMinionAttackTargetNPC.height))
							{
								num138 = num144;
								num136 = num142;
								num137 = num143;
								num140 = ownerMinionAttackTargetNPC.whoAmI;
							}
						}
					}
					if (num140 == -1)
					{
						for (int num145 = 0; num145 < Main.maxNPCs; num145++)
						{
							if (!Main.npc[num145].CanBeChasedBy(this))
							{
								continue;
							}
							float num146 = Main.npc[num145].position.X + (float)(Main.npc[num145].width / 2);
							float num147 = Main.npc[num145].position.Y + (float)(Main.npc[num145].height / 2);
							float num148 = Math.Abs(position.X + (float)(width / 2) - num146) + Math.Abs(position.Y + (float)(height / 2) - num147);
							if (num148 < num138)
							{
								if (num140 == -1 && num148 <= num139)
								{
									num139 = num148;
									num136 = num146 + Main.npc[num145].velocity.X * num141;
									num137 = num147 + Main.npc[num145].velocity.Y * num141;
								}
								if (Collision.CanHit(position, width, height, Main.npc[num145].position, Main.npc[num145].width, Main.npc[num145].height))
								{
									num138 = num148;
									num136 = num146 + Main.npc[num145].velocity.X * num141;
									num137 = num147 + Main.npc[num145].velocity.Y * num141;
									num140 = num145;
								}
							}
						}
					}
					if (num140 == -1 && num139 < num138)
					{
						num138 = num139;
					}
					if (num140 != -1)
					{
						flag9 = false;
					}
					float num149 = 400f;
					if ((double)position.Y > Main.worldSurface * 16.0)
					{
						num149 = 200f;
					}
					if (num138 < num149 + num133 && num140 == -1)
					{
						float num150 = num136 - (position.X + (float)(width / 2));
						if (num150 < -5f)
						{
							flag2 = true;
							flag3 = false;
						}
						else if (num150 > 5f)
						{
							flag3 = true;
							flag2 = false;
						}
					}
					else if (num140 >= 0 && num138 < 800f + num133)
					{
						localAI[0] = num135;
						float num151 = num136 - (position.X + (float)(width / 2));
						if (num151 > 450f || num151 < -450f)
						{
							if (num151 < -50f)
							{
								flag2 = true;
								flag3 = false;
							}
							else if (num151 > 50f)
							{
								flag3 = true;
								flag2 = false;
							}
						}
						else if (owner == Main.myPlayer)
						{
							ai[1] = num134;
							Vector2 vector15 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)(height / 2) - 8f);
							float num152 = num136 - vector15.X + (float)Main.rand.Next(-20, 21);
							float num153 = Math.Abs(num152) * 0.1f;
							num153 = num153 * (float)Main.rand.Next(0, 100) * 0.001f;
							int num154 = 20;
							if (flag8)
							{
								num154 = 0;
							}
							float num155 = num137 - vector15.Y + (float)Main.rand.Next(-num154, num154 + 1) - num153;
							float num156 = (float)Math.Sqrt(num152 * num152 + num155 * num155);
							num156 = 11f / num156;
							num152 *= num156;
							num155 *= num156;
							int num157 = damage;
							short num158 = 195;
							if (flag8)
							{
								if (num152 < 0f)
								{
									direction = -1;
								}
								if (num152 > 0f)
								{
									direction = 1;
								}
								vector15.Y -= 2f;
								num158 = 1097;
								vector15 += new Vector2(num152, num155) * 1f;
								localAI[0] = num134;
							}
							int num159 = NewProjectile(GetProjectileSource_FromThis(), vector15.X, vector15.Y, num152, num155, num158, num157, knockBack, Main.myPlayer);
							Main.projectile[num159].timeLeft = 300;
							if (num152 < 0f)
							{
								direction = -1;
							}
							if (num152 > 0f)
							{
								direction = 1;
							}
							netUpdate = true;
						}
					}
				}
			}
			bool flag23 = false;
			Vector2 vector16 = Vector2.Zero;
			bool flag24 = false;
			if (type == 266 || flag7)
			{
				float num160 = 40 * minionPos;
				int num161 = 60;
				localAI[0] -= 1f;
				if (localAI[0] < 0f)
				{
					localAI[0] = 0f;
				}
				if (ai[1] > 0f)
				{
					ai[1] -= 1f;
				}
				else
				{
					float num162 = position.X;
					float num163 = position.Y;
					float num164 = 100000f;
					float num165 = num164;
					int num166 = -1;
					NPC ownerMinionAttackTargetNPC2 = OwnerMinionAttackTargetNPC;
					if (ownerMinionAttackTargetNPC2 != null && ownerMinionAttackTargetNPC2.CanBeChasedBy(this))
					{
						float x = ownerMinionAttackTargetNPC2.Center.X;
						float y = ownerMinionAttackTargetNPC2.Center.Y;
						float num167 = Math.Abs(position.X + (float)(width / 2) - x) + Math.Abs(position.Y + (float)(height / 2) - y);
						if (num167 < num164)
						{
							if (num166 == -1 && num167 <= num165)
							{
								num165 = num167;
								num162 = x;
								num163 = y;
							}
							if (Collision.CanHit(position, width, height, ownerMinionAttackTargetNPC2.position, ownerMinionAttackTargetNPC2.width, ownerMinionAttackTargetNPC2.height))
							{
								num164 = num167;
								num162 = x;
								num163 = y;
								num166 = ownerMinionAttackTargetNPC2.whoAmI;
							}
						}
					}
					if (num166 == -1)
					{
						for (int num168 = 0; num168 < Main.maxNPCs; num168++)
						{
							if (!Main.npc[num168].CanBeChasedBy(this))
							{
								continue;
							}
							float num169 = Main.npc[num168].position.X + (float)(Main.npc[num168].width / 2);
							float num170 = Main.npc[num168].position.Y + (float)(Main.npc[num168].height / 2);
							float num171 = Math.Abs(position.X + (float)(width / 2) - num169) + Math.Abs(position.Y + (float)(height / 2) - num170);
							if (num171 < num164)
							{
								if (num166 == -1 && num171 <= num165)
								{
									num165 = num171;
									num162 = num169;
									num163 = num170;
								}
								if (Collision.CanHit(position, width, height, Main.npc[num168].position, Main.npc[num168].width, Main.npc[num168].height))
								{
									num164 = num171;
									num162 = num169;
									num163 = num170;
									num166 = num168;
								}
							}
						}
					}
					if (flag7 && !Collision.SolidCollision(position, width, height))
					{
						tileCollide = true;
					}
					if (num166 == -1 && num165 < num164)
					{
						num164 = num165;
					}
					else if (num166 >= 0)
					{
						flag23 = true;
						vector16 = new Vector2(num162, num163) - base.Center;
						if (flag7)
						{
							if (Main.npc[num166].position.Y > position.Y + (float)height)
							{
								int num172 = (int)(base.Center.X / 16f);
								int num173 = (int)((position.Y + (float)height + 1f) / 16f);
								if (Main.tile[num172, num173] != null && Main.tile[num172, num173].active() && TileID.Sets.Platforms[Main.tile[num172, num173].type])
								{
									tileCollide = false;
								}
							}
							Rectangle rectangle = new Rectangle((int)position.X, (int)position.Y, width, height);
							Rectangle value3 = new Rectangle((int)Main.npc[num166].position.X, (int)Main.npc[num166].position.Y, Main.npc[num166].width, Main.npc[num166].height);
							int num174 = 10;
							value3.X -= num174;
							value3.Y -= num174;
							value3.Width += num174 * 2;
							value3.Height += num174 * 2;
							if (rectangle.Intersects(value3))
							{
								flag24 = true;
								Vector2 vector17 = Main.npc[num166].Center - base.Center;
								if (velocity.Y > 0f && vector17.Y < 0f)
								{
									velocity.Y *= 0.5f;
								}
								if (velocity.Y < 0f && vector17.Y > 0f)
								{
									velocity.Y *= 0.5f;
								}
								if (velocity.X > 0f && vector17.X < 0f)
								{
									velocity.X *= 0.5f;
								}
								if (velocity.X < 0f && vector17.X > 0f)
								{
									velocity.X *= 0.5f;
								}
								if (vector17.Length() > 14f)
								{
									vector17.Normalize();
									vector17 *= 14f;
								}
								rotation = (rotation * 5f + vector17.ToRotation() + (float)Math.PI / 2f) / 6f;
								velocity = (velocity * 9f + vector17) / 10f;
								for (int num175 = 0; num175 < 1000; num175++)
								{
									if (whoAmI != num175 && owner == Main.projectile[num175].owner && Main.projectile[num175].type >= 390 && Main.projectile[num175].type <= 392 && (Main.projectile[num175].Center - base.Center).Length() < 15f)
									{
										float num176 = 0.5f;
										if (base.Center.Y > Main.projectile[num175].Center.Y)
										{
											Main.projectile[num175].velocity.Y -= num176;
											velocity.Y += num176;
										}
										else
										{
											Main.projectile[num175].velocity.Y += num176;
											velocity.Y -= num176;
										}
										if (base.Center.X > Main.projectile[num175].Center.X)
										{
											velocity.X += num176;
											Main.projectile[num175].velocity.X -= num176;
										}
										else
										{
											velocity.X -= num176;
											Main.projectile[num175].velocity.Y += num176;
										}
									}
								}
							}
						}
					}
					float num177 = 300f;
					if ((double)position.Y > Main.worldSurface * 16.0)
					{
						num177 = 150f;
					}
					if (flag7)
					{
						num177 = 500f;
						if ((double)position.Y > Main.worldSurface * 16.0)
						{
							num177 = 250f;
						}
					}
					if (num164 < num177 + num160 && num166 == -1)
					{
						float num178 = num162 - (position.X + (float)(width / 2));
						if (num178 < -5f)
						{
							flag2 = true;
							flag3 = false;
						}
						else if (num178 > 5f)
						{
							flag3 = true;
							flag2 = false;
						}
					}
					bool flag25 = false;
					if (flag7 && localAI[1] > 0f)
					{
						flag25 = true;
						localAI[1] -= 1f;
					}
					if (num166 >= 0 && num164 < 800f + num160)
					{
						friendly = true;
						localAI[0] = num161;
						float num179 = num162 - (position.X + (float)(width / 2));
						if (num179 < -10f)
						{
							flag2 = true;
							flag3 = false;
						}
						else if (num179 > 10f)
						{
							flag3 = true;
							flag2 = false;
						}
						if (num163 < base.Center.Y - 100f && num179 > -50f && num179 < 50f && velocity.Y == 0f)
						{
							float num180 = Math.Abs(num163 - base.Center.Y);
							if (num180 < 120f)
							{
								velocity.Y = -10f;
							}
							else if (num180 < 210f)
							{
								velocity.Y = -13f;
							}
							else if (num180 < 270f)
							{
								velocity.Y = -15f;
							}
							else if (num180 < 310f)
							{
								velocity.Y = -17f;
							}
							else if (num180 < 380f)
							{
								velocity.Y = -18f;
							}
						}
						if (flag25)
						{
							friendly = false;
							if (velocity.X < 0f)
							{
								flag2 = true;
							}
							else if (velocity.X > 0f)
							{
								flag3 = true;
							}
						}
					}
					else
					{
						friendly = false;
					}
				}
			}
			if (ai[1] != 0f || flag9)
			{
				flag2 = false;
				flag3 = false;
			}
			else if (flag10 && localAI[0] == 0f)
			{
				direction = Main.player[owner].direction;
			}
			bool flag26 = true;
			if (ai[1] != 0f && flag8)
			{
				flag26 = false;
				if (velocity.Y == 0f)
				{
					velocity.X *= 0.7f;
				}
			}
			if (type == 127)
			{
				if ((double)rotation > -0.1 && (double)rotation < 0.1)
				{
					rotation = 0f;
				}
				else if (rotation < 0f)
				{
					rotation += 0.1f;
				}
				else
				{
					rotation -= 0.1f;
				}
			}
			else if (type != 313 && !flag24)
			{
				rotation = 0f;
			}
			if (!flag7)
			{
				tileCollide = true;
			}
			float num181 = 0.08f;
			float num182 = 6.5f;
			if (type == 127)
			{
				num182 = 2f;
				num181 = 0.04f;
			}
			if (type == 112)
			{
				num182 = 6f;
				num181 = 0.06f;
			}
			if (type == 1094)
			{
				num182 = 6f;
				num181 = 0.03f;
			}
			if (type == 334)
			{
				num182 = 8f;
				num181 = 0.08f;
			}
			if (type == 268)
			{
				num182 = 8f;
				num181 = 0.4f;
			}
			if (type == 324)
			{
				num181 = 0.1f;
				num182 = 3f;
			}
			if (type == 858)
			{
				num181 = 0.3f;
				num182 = 7f;
			}
			if (flag10 || type == 266 || flag7 || type == 816 || type == 821 || type == 825 || type == 859 || type == 860 || type == 881 || type == 884 || type == 890 || type == 891 || type == 897 || type == 899 || type == 900 || type == 934 || type == 956 || type == 958 || type == 959 || type == 960 || type == 994 || type == 998 || type == 1003 || type == 1004 || type == 1027 || type == 1095 || type == 1096)
			{
				num182 = 6f;
				num181 = 0.2f;
				if (num182 < Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y))
				{
					num182 = Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y);
					num181 = 0.3f;
				}
				if (flag10)
				{
					num181 *= 2f;
				}
				if (type == 1027)
				{
					num181 *= 1.5f;
				}
			}
			if (type == 875)
			{
				num182 = 7f;
				num181 = 0.25f;
				if (num182 < Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y))
				{
					num182 = Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y);
					num181 = 0.35f;
				}
			}
			if (flag7)
			{
				num181 *= 2f;
			}
			if (flag11)
			{
				num182 = 6f;
			}
			if (flag2)
			{
				if ((double)velocity.X > -3.5)
				{
					velocity.X -= num181;
				}
				else
				{
					velocity.X -= num181 * 0.25f;
				}
			}
			else if (flag3)
			{
				if ((double)velocity.X < 3.5)
				{
					velocity.X += num181;
				}
				else
				{
					velocity.X += num181 * 0.25f;
				}
			}
			else
			{
				velocity.X *= 0.9f;
				if (velocity.X >= 0f - num181 && velocity.X <= num181)
				{
					velocity.X = 0f;
				}
			}
			if (type == 208)
			{
				velocity.X *= 0.95f;
				if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
				{
					velocity.X = 0f;
				}
				flag2 = false;
				flag3 = false;
			}
			if (flag2 || flag3)
			{
				int num183 = (int)(position.X + (float)(width / 2)) / 16;
				int num184 = (int)(position.Y + (float)(height / 2)) / 16;
				if (type == 236)
				{
					num183 += direction;
				}
				if (flag2)
				{
					num183--;
				}
				if (flag3)
				{
					num183++;
				}
				num183 += (int)velocity.X;
				if (WorldGen.InWorld(num183, num184) && WorldGen.SolidTile(num183, num184) && Main.tile[num183, num184] != null && !TileID.Sets.ForAdvancedCollision.ClosedDoors[Main.tile[num183, num184].type])
				{
					flag5 = true;
				}
			}
			if (Main.player[owner].position.Y + (float)Main.player[owner].height - 8f > position.Y + (float)height)
			{
				flag4 = true;
			}
			if (type == 268 && frameCounter < 10)
			{
				flag5 = false;
			}
			if (type == 860 && velocity.X != 0f)
			{
				flag5 = true;
			}
			if ((type == 881 || type == 934) && velocity.X != 0f)
			{
				flag5 = true;
			}
			Collision.StepUp(ref position, ref velocity, width, height, ref stepSpeed, ref gfxOffY);
			if (velocity.Y == 0f || type == 200)
			{
				if (!flag4 && (velocity.X < 0f || velocity.X > 0f))
				{
					int num185 = (int)(position.X + (float)(width / 2)) / 16;
					int j2 = (int)(position.Y + (float)(height / 2)) / 16 + 1;
					if (flag2)
					{
						num185--;
					}
					if (flag3)
					{
						num185++;
					}
					WorldGen.SolidTile(num185, j2);
				}
				if (flag5)
				{
					int num186 = (int)(position.X + (float)(width / 2)) / 16;
					int num187 = (int)(position.Y + (float)height) / 16;
					if (WorldGen.SolidTileAllowBottomSlope(num186, num187) || Main.tile[num186, num187].halfBrick() || Main.tile[num186, num187].slope() > 0 || type == 200)
					{
						if (type == 200)
						{
							velocity.Y = -3.1f;
						}
						else
						{
							try
							{
								num186 = (int)(position.X + (float)(width / 2)) / 16;
								num187 = (int)(position.Y + (float)(height / 2)) / 16;
								if (flag2)
								{
									num186--;
								}
								if (flag3)
								{
									num186++;
								}
								num186 += (int)velocity.X;
								if (!WorldGen.SolidTile(num186, num187 - 1) && !WorldGen.SolidTile(num186, num187 - 2))
								{
									velocity.Y = -5.1f;
								}
								else if (!WorldGen.SolidTile(num186, num187 - 2))
								{
									velocity.Y = -7.1f;
								}
								else if (WorldGen.SolidTile(num186, num187 - 5))
								{
									velocity.Y = -11.1f;
								}
								else if (WorldGen.SolidTile(num186, num187 - 4))
								{
									velocity.Y = -10.1f;
								}
								else
								{
									velocity.Y = -9.1f;
								}
							}
							catch
							{
								velocity.Y = -9.1f;
							}
						}
						if (type == 127)
						{
							ai[0] = 1f;
						}
					}
				}
				else if (type == 266 && (flag2 || flag3))
				{
					velocity.Y -= 6f;
				}
			}
			if (velocity.X > num182)
			{
				velocity.X = num182;
			}
			if (velocity.X < 0f - num182)
			{
				velocity.X = 0f - num182;
			}
			if (flag26)
			{
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				if (velocity.X > 0f)
				{
					direction = 1;
				}
				if (velocity.X > num181 && flag3)
				{
					direction = 1;
				}
				if (velocity.X < 0f - num181 && flag2)
				{
					direction = -1;
				}
			}
			if (type != 313)
			{
				if (direction == -1)
				{
					spriteDirection = 1;
				}
				if (direction == 1)
				{
					spriteDirection = -1;
				}
			}
			if (type == 398 || type == 958 || type == 960 || type == 956 || type == 959 || type == 994 || type == 1095 || type == 1096 || type == 1094)
			{
				spriteDirection = direction;
			}
			bool flag27 = position.X - oldPosition.X == 0f;
			if (type == 956)
			{
				if (alpha > 0)
				{
					int num188 = Dust.NewDust(position, width, height, 6, velocity.X, velocity.Y, 0, default(Color), 1.2f);
					Main.dust[num188].velocity.X += Main.rand.NextFloat() - 0.5f;
					Main.dust[num188].velocity.Y += (Main.rand.NextFloat() + 0.5f) * -1f;
					if (Main.rand.Next(3) != 0)
					{
						Main.dust[num188].noGravity = true;
					}
					alpha -= 5;
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				if (velocity.Y != 0f)
				{
					frame = 10;
				}
				else if (flag27)
				{
					spriteDirection = 1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = -1;
					}
					frame = 0;
				}
				else
				{
					float num189 = velocity.Length();
					frameCounter += (int)num189;
					if (frameCounter > 7)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 1 || frame > 9)
					{
						frame = 1;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 958)
			{
				if (velocity.Y != 0f)
				{
					localAI[0] = 0f;
					frame = 4;
				}
				else if (flag27)
				{
					spriteDirection = 1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = -1;
					}
					localAI[0] += 1f;
					if (localAI[0] > 200f)
					{
						frame = 1 + (int)(localAI[0] - 200f) / 6;
						if (localAI[0] >= 218f)
						{
							frame = 0;
							localAI[0] = Main.rand.Next(100);
						}
					}
					else
					{
						frame = 0;
					}
				}
				else
				{
					localAI[0] = 0f;
					float num190 = velocity.Length();
					frameCounter += (int)num190;
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 5 || frame > 12)
					{
						frame = 5;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 959)
			{
				if (velocity.Y != 0f)
				{
					frame = ((velocity.Y > 0f) ? 10 : 9);
				}
				else if (flag27)
				{
					spriteDirection = 1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = -1;
					}
					frame = 0;
				}
				else
				{
					float num191 = velocity.Length();
					frameCounter += (int)num191;
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 1 || frame > 8)
					{
						frame = 1;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 998)
			{
				if (velocity.Y != 0f)
				{
					frame = 1;
				}
				else if (flag27)
				{
					spriteDirection = -1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = 1;
					}
					frame = 0;
				}
				else
				{
					float num192 = velocity.Length();
					frameCounter += (int)num192;
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 0 || frame > 5)
					{
						frame = 0;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 1003)
			{
				if (velocity.Y != 0f)
				{
					frame = 1;
				}
				else if (flag27)
				{
					spriteDirection = -1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = 1;
					}
					frame = 0;
				}
				else
				{
					float num193 = velocity.Length();
					frameCounter += (int)num193;
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 2 || frame > 11)
					{
						frame = 2;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 1004)
			{
				if (velocity.Y != 0f)
				{
					frame = 1;
				}
				else if (flag27)
				{
					spriteDirection = -1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = 1;
					}
					frame = 0;
				}
				else
				{
					float num194 = velocity.Length();
					frameCounter += (int)num194;
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 2 || frame > 9)
					{
						frame = 2;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 1027)
			{
				if (alpha > 0)
				{
					alpha = 0;
					int num195 = 25;
					float num196 = Main.rand.NextFloat() * ((float)Math.PI * 2f);
					for (int num197 = 0; num197 < num195; num197++)
					{
						bool flag28 = num197 % 2 == 0;
						float num198 = num196 + (float)num197 / (float)num195 * ((float)Math.PI * 2f);
						Vector2 value4 = new Vector2(0f, flag28 ? 2f : 4f).RotatedBy(num198);
						Dust dust4 = Dust.NewDustPerfect(base.Center, 282, value4);
						dust4.scale = (flag28 ? 1.3f : 1.2f);
						dust4.noGravity = true;
					}
				}
				if (velocity.Y < 0f)
				{
					frame = 2;
				}
				else if (velocity.Y > 0f)
				{
					frame = 4;
				}
				else if (flag27)
				{
					spriteDirection = -1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = 1;
					}
					frame = 0;
				}
				else
				{
					float num199 = velocity.Length() / 2f;
					frameCounter += Math.Max(1, (int)num199);
					if (frameCounter > 5)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 0 || frame > 3)
					{
						frame = 0;
					}
				}
				rotation = 0f;
				if (velocity.Y != 0f)
				{
					rotation = velocity.Y / 10f * ((float)Math.PI / 4f) * (float)(-spriteDirection);
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 1095 || type == 1096)
			{
				if (velocity.Y != 0f)
				{
					frame = ((velocity.Y > 0f) ? 10 : 9);
				}
				else if (flag27)
				{
					spriteDirection = 1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = -1;
					}
					frame = 0;
				}
				else
				{
					float num200 = velocity.Length();
					frameCounter += (int)num200;
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 1 || frame > 8)
					{
						frame = 1;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 994)
			{
				if (velocity.Y != 0f)
				{
					frame = 4;
				}
				else if (flag27)
				{
					spriteDirection = 1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = -1;
					}
					frameCounter++;
					if (frameCounter > 5)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 3)
					{
						frame = 0;
					}
				}
				else
				{
					float num201 = velocity.Length();
					frameCounter += (int)num201;
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 5 || frame > 12)
					{
						frame = 5;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 960)
			{
				_ = Main.player[owner];
				if (velocity.Y != 0f)
				{
					localAI[0] = 0f;
					localAI[1] = 0f;
					frameCounter = 0;
					frame = 4;
				}
				else if (flag27)
				{
					if (!flag11)
					{
						spriteDirection = 1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = -1;
						}
					}
					if (frame >= 5 && frame < 12)
					{
						frameCounter++;
						if (frameCounter > 3)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame >= 12)
						{
							frame = 0;
						}
					}
					else if (Chester_IsAnyPlayerTrackingThisProjectile())
					{
						if (localAI[0] == 0f)
						{
							if (localAI[1] == 0f)
							{
								localAI[1] = 1f;
								frameCounter = 0;
							}
							frame = 13;
							frameCounter++;
							if (frameCounter > 6)
							{
								localAI[0] = 1f;
								frame = 14;
								frameCounter = 0;
							}
						}
						else
						{
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								if (frame > 18)
								{
									frame = 14;
								}
								frameCounter = 0;
							}
						}
					}
					else
					{
						localAI[0] = 0f;
						if (localAI[1] == 1f)
						{
							localAI[1] = 0f;
							frameCounter = 0;
						}
						if (frame >= 12 && frame <= 19)
						{
							frame = 19;
							frameCounter++;
							if (frameCounter > 6)
							{
								frame = 0;
								frameCounter = 0;
							}
						}
						else
						{
							frameCounter++;
							if (frameCounter >= 24)
							{
								frameCounter = 0;
							}
							frame = frameCounter / 6;
						}
					}
				}
				else
				{
					localAI[0] = 0f;
					localAI[1] = 0f;
					float val = velocity.Length();
					frameCounter += (int)Math.Max(2f, val);
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 5 || frame > 12)
					{
						frame = 5;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 816)
			{
				if (velocity.Y != 0f)
				{
					frame = 4;
				}
				else if (flag27)
				{
					spriteDirection = -1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = 1;
					}
					if (++frameCounter > 5)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 0 || frame > 3)
					{
						frame = 0;
					}
				}
				else
				{
					int num202 = 5;
					float num203 = velocity.Length();
					if (num203 > 4f)
					{
						num202 = 3;
					}
					else if (num203 > 2f)
					{
						num202 = 4;
					}
					if (++frameCounter > num202)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 4 || frame > 10)
					{
						frame = 4;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			if (type == 860)
			{
				if (velocity.Y != 0f)
				{
					localAI[0] = 0f;
					if (frame >= 5)
					{
						frame = 5;
						frameCounter = 0;
					}
					else if (++frameCounter > 5)
					{
						frame++;
						frameCounter = 0;
					}
				}
				else if (Math.Abs(velocity.X) < 1f)
				{
					if (localAI[0] > 800f)
					{
						frameCounter++;
						if (frameCounter > 3)
						{
							frameCounter = 0;
							frame++;
							if (frame > 3)
							{
								frame = 3;
							}
						}
						localAI[0] += 1f;
						if (localAI[0] > 850f)
						{
							localAI[0] = 0f;
						}
						if (frame == 3 && localAI[0] == 820f)
						{
							for (int num204 = 0; num204 < 3 + Main.rand.Next(3); num204++)
							{
								int num205 = Gore.NewGore(new Vector2(position.X, base.Center.Y - 10f), Vector2.Zero, 1218);
								Main.gore[num205].velocity = new Vector2((float)Main.rand.Next(1, 10) * 0.3f * (float)(-spriteDirection), 0f - (2f + (float)Main.rand.Next(4) * 0.3f));
							}
						}
					}
					else if (frame == 0)
					{
						localAI[0] += 1f;
						frame = 0;
						frameCounter = 0;
					}
					else
					{
						localAI[0] = 0f;
						if (frame > 5)
						{
							frame = 5;
							frameCounter = 0;
						}
						if (++frameCounter > 4)
						{
							frame--;
							frameCounter = 0;
						}
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			if (type == 859)
			{
				if (velocity.Y != 0f)
				{
					frame = 4;
				}
				else if (flag27)
				{
					spriteDirection = -1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = 1;
					}
					if (frame == 6)
					{
						if (++frameCounter > 5)
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else if (frame > 3)
					{
						frame = 6;
						frameCounter = 0;
					}
					else
					{
						if (++frameCounter > 5)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 0 || frame > 3)
						{
							frame = 0;
						}
					}
				}
				else
				{
					float num206 = velocity.Length();
					int num207 = 8;
					if (num206 < 3f)
					{
						num207 = 4;
					}
					if (num206 < 1f)
					{
						num207 = 2;
					}
					frameCounter += (int)num206;
					if (frameCounter > num207)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 5 || frame > 17)
					{
						frame = 5;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 858)
			{
				if (velocity.Y != 0f)
				{
					frame = 1;
				}
				else if (flag27)
				{
					spriteDirection = -1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = 1;
					}
					frame = 0;
				}
				else
				{
					float num208 = velocity.Length();
					frameCounter += (int)num208;
					if (frameCounter > 3)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 2 || frame > 9)
					{
						frame = 2;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 900)
			{
				spriteDirection = direction;
				if (velocity.Y != 0f)
				{
					frame = 1;
					frameCounter = 0;
				}
				else if (flag27)
				{
					spriteDirection = 1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = -1;
					}
					frame = 0;
					frameCounter = 0;
				}
				else
				{
					frameCounter += 1 + (int)Math.Abs(velocity.X * 0.3f);
					if (frame < 2)
					{
						frame = 2;
						frameCounter = 0;
					}
					if (frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 9)
					{
						frame = 2;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 899)
			{
				spriteDirection = direction;
				if (velocity.Y != 0f)
				{
					frame = 1;
					frameCounter = 0;
				}
				else if (flag27)
				{
					spriteDirection = 1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = -1;
					}
					frame = 0;
					frameCounter = 0;
				}
				else
				{
					frameCounter += 1 + (int)Math.Abs(velocity.X * 0.3f);
					if (frame < 2)
					{
						frame = 2;
						frameCounter = 0;
					}
					if (frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 9)
					{
						frame = 2;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 897)
			{
				spriteDirection = direction;
				if (velocity.Y != 0f)
				{
					frame = 1;
					frameCounter = 0;
				}
				else if (flag27)
				{
					spriteDirection = 1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = -1;
					}
					frame = 0;
					frameCounter = 0;
				}
				else
				{
					frameCounter += 1 + (int)Math.Abs(velocity.X * 0.3f);
					if (frame < 2)
					{
						frame = 2;
						frameCounter = 0;
					}
					if (frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 7)
					{
						frame = 2;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 891)
			{
				spriteDirection = direction;
				if (velocity.Y != 0f)
				{
					frame = 1;
					frameCounter = 0;
				}
				else if (flag27)
				{
					spriteDirection = Main.player[owner].direction;
					frame = 0;
					frameCounter = 0;
				}
				else
				{
					frameCounter += 1 + (int)Math.Abs(velocity.X * 0.3f);
					if (frame < 2)
					{
						frame = 2;
						frameCounter = 0;
					}
					if (frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 8)
					{
						frame = 2;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 890)
			{
				spriteDirection = direction;
				if (velocity.Y != 0f)
				{
					frame = 1;
					frameCounter = 0;
				}
				else if (flag27)
				{
					spriteDirection = 1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = -1;
					}
					frame = 0;
					frameCounter = 0;
				}
				else
				{
					frameCounter += 1 + (int)Math.Abs(velocity.X * 0.3f);
					if (frame < 2)
					{
						frame = 2;
						frameCounter = 0;
					}
					if (frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 7)
					{
						frame = 2;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 884)
			{
				spriteDirection = direction;
				if (velocity.Y != 0f)
				{
					if (velocity.Y < 0f)
					{
						frame = 9;
					}
					else
					{
						frame = 1;
					}
					frameCounter = 0;
				}
				else if (flag27)
				{
					spriteDirection = 1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = -1;
					}
					frame = 0;
					frameCounter = 0;
				}
				else
				{
					frameCounter += 1 + (int)Math.Abs(velocity.X * 0.5f);
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 8)
					{
						frame = 2;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 881 || type == 934)
			{
				spriteDirection = 1;
				if (Main.player[owner].Center.X < base.Center.X)
				{
					spriteDirection = -1;
				}
				if (velocity.Y > 0f)
				{
					frameCounter++;
					if (frameCounter > 2)
					{
						frame++;
						if (frame >= 2)
						{
							frame = 2;
						}
						frameCounter = 0;
					}
				}
				else if (velocity.Y < 0f)
				{
					frameCounter++;
					if (frameCounter > 2)
					{
						frame++;
						if (frame >= 5)
						{
							frame = 0;
						}
						frameCounter = 0;
					}
				}
				else if (frame == 0)
				{
					frame = 0;
				}
				else if (++frameCounter > 3)
				{
					frame++;
					if (frame >= 6)
					{
						frame = 0;
					}
					frameCounter = 0;
				}
				if (wet && Main.player[owner].position.Y + (float)Main.player[owner].height < position.Y + (float)height && localAI[0] == 0f)
				{
					if (velocity.Y > -4f)
					{
						velocity.Y -= 0.2f;
					}
					if (velocity.Y > 0f)
					{
						velocity.Y *= 0.95f;
					}
				}
				else
				{
					velocity.Y += 0.4f;
				}
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 875)
			{
				if (velocity.Y != 0f)
				{
					if (velocity.Y < 0f)
					{
						frame = 3;
					}
					else
					{
						frame = 6;
					}
					frameCounter = 0;
				}
				else if (flag27)
				{
					spriteDirection = -1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = 1;
					}
					frame = 0;
					frameCounter = 0;
				}
				else
				{
					frameCounter += 1 + (int)Math.Abs(velocity.X * 0.75f);
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 6)
					{
						frame = 0;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 854)
			{
				if (velocity.Y != 0f)
				{
					frame = 7;
				}
				else if (flag27)
				{
					spriteDirection = -1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = 1;
					}
					if (++frameCounter > 5)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 0 || frame > 3)
					{
						frame = 0;
					}
				}
				else
				{
					int num209 = 3;
					float num210 = velocity.Length();
					if (num210 > 4f)
					{
						num209 = 1;
					}
					else if (num210 > 2f)
					{
						num209 = 2;
					}
					if (++frameCounter > num209)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 4 || frame > 12)
					{
						frame = 4;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 825)
			{
				if (velocity.Y != 0f)
				{
					localAI[0] = 0f;
					frame = 12;
				}
				else if (flag27)
				{
					spriteDirection = -1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = 1;
					}
					if (frame >= 1 && frame <= 2)
					{
						localAI[0] = 0f;
						if (++frameCounter > 5)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 2)
						{
							frame = 0;
						}
					}
					else if (frame >= 3 && frame <= 11)
					{
						localAI[0] = 0f;
						if (++frameCounter > 5)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 11)
						{
							frame = 0;
						}
					}
					else
					{
						if (frame == 13)
						{
							if (++frameCounter > 8)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame == 14)
							{
								frame = 0;
							}
						}
						if (frame != 0)
						{
							frame = 13;
						}
						else
						{
							frame = 0;
						}
						if (frame == 0)
						{
							localAI[0] += 1f;
							if (localAI[0] > 300f && Main.rand.Next(50) == 0)
							{
								switch (Main.rand.Next(2))
								{
								case 0:
									frame = 1;
									break;
								case 1:
									frame = 3;
									break;
								}
							}
						}
					}
				}
				else
				{
					localAI[0] = 0f;
					int num211 = 3;
					float num212 = velocity.Length();
					if (num212 > 4f)
					{
						num211 = 2;
					}
					else if (num212 > 2f)
					{
						num211 = 1;
					}
					if (++frameCounter > num211)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 13)
					{
						frame = 13;
					}
					if (frame > 19)
					{
						frame = 14;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 821)
			{
				if (velocity.Y != 0f)
				{
					localAI[0] = 0f;
					frame = 12;
				}
				else if (flag27)
				{
					spriteDirection = -1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = 1;
					}
					localAI[0] += 1f;
					if (localAI[0] > 400f)
					{
						int num213 = 7;
						if (frame == 9)
						{
							num213 = 25;
						}
						if (++frameCounter > num213)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 5)
						{
							frame = 5;
						}
						if (frame > 11)
						{
							localAI[0] = 0f;
							frame = 0;
						}
					}
					else
					{
						if (++frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 0 || frame > 4)
						{
							frame = 0;
						}
					}
				}
				else
				{
					localAI[0] = 0f;
					int num214 = 4;
					float num215 = velocity.Length();
					if (num215 > 3f)
					{
						num214 = 3;
					}
					if (num215 > 5f)
					{
						num214 = 2;
					}
					if (++frameCounter > num214)
					{
						frame++;
						if (num214 == 0)
						{
							frame++;
						}
						frameCounter = 0;
					}
					if (frame < 13 || frame > 18)
					{
						frame = 13;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (flag6)
			{
				if (ai[1] > 0f)
				{
					if (localAI[1] == 0f)
					{
						localAI[1] = 1f;
						frame = 1;
					}
					if (frame != 0)
					{
						frameCounter++;
						if (frameCounter > 4)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame >= 4)
						{
							frame = 0;
						}
					}
				}
				else if (velocity.Y == 0f)
				{
					localAI[1] = 0f;
					if (flag27)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 5 || frame >= 11)
						{
							frame = 5;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else if (velocity.Y < 0f)
				{
					frameCounter = 0;
					frame = 4;
				}
				else if (velocity.Y > 0f)
				{
					frameCounter = 0;
					frame = 4;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
				_ = velocity;
			}
			else if (type == 1094)
			{
				if (ai[1] > 0f)
				{
					if (frame < 36 || frame >= 42)
					{
						frameCounter = 0;
						frame = 36;
					}
					if (ai[1] == 40f)
					{
						frameCounter = 0;
					}
					frameCounter++;
					int num216 = frameCounter / 3;
					if (num216 >= 6)
					{
						num216 = 11 - num216;
					}
					if (num216 < 0)
					{
						num216 = 0;
					}
					frame = 36 + num216;
					if (frame != 36 && frameCounter < 10)
					{
						Dust dust5 = Dust.NewDustDirect(base.Bottom + new Vector2(-2 - spriteDirection * 16, -8f), 4, 4, 6, spriteDirection * 2, -0.25f);
						dust5.noGravity = true;
						dust5.scale = 1.4f;
						dust5.velocity *= 4f;
					}
				}
				else if (velocity.Y == 0f)
				{
					localAI[1] = 0f;
					if (flag27 && flag9)
					{
						if (frame < 45 || frame >= 53)
						{
							frame = 45;
						}
						if (++frameCounter >= 4)
						{
							frameCounter = 0;
							if (++frame >= 53)
							{
								frame = 45;
							}
						}
					}
					else if (flag27)
					{
						if (frame < 18 || frame >= 26)
						{
							frame = 18;
						}
						if (++frameCounter >= 4)
						{
							frameCounter = 0;
							if (++frame >= 26)
							{
								frame = 18;
							}
						}
					}
					else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frame < 28 || frame >= 36)
						{
							frame = 28;
						}
						if (frameCounter >= 10)
						{
							frameCounter = 0;
							if (++frame >= 36)
							{
								frame = 28;
							}
						}
					}
					else
					{
						frame = 18;
						frameCounter = 0;
					}
				}
				else if (velocity.Y < 0f)
				{
					frameCounter = 0;
					frame = 27;
				}
				else if (velocity.Y > 0f)
				{
					frameCounter = 0;
					frame = 27;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
				_ = velocity;
			}
			else if (type == 268)
			{
				if (velocity.Y == 0f)
				{
					if (frame > 5)
					{
						frameCounter = 0;
					}
					if (flag27)
					{
						int num217 = 3;
						frameCounter++;
						if (frameCounter < num217)
						{
							frame = 0;
						}
						else if (frameCounter < num217 * 2)
						{
							frame = 1;
						}
						else if (frameCounter < num217 * 3)
						{
							frame = 2;
						}
						else if (frameCounter < num217 * 4)
						{
							frame = 3;
						}
						else
						{
							frameCounter = num217 * 4;
						}
					}
					else
					{
						velocity.X *= 0.8f;
						frameCounter++;
						int num218 = 3;
						if (frameCounter < num218)
						{
							frame = 0;
						}
						else if (frameCounter < num218 * 2)
						{
							frame = 1;
						}
						else if (frameCounter < num218 * 3)
						{
							frame = 2;
						}
						else if (frameCounter < num218 * 4)
						{
							frame = 3;
						}
						else if (flag2 || flag3)
						{
							velocity.X *= 2f;
							frame = 4;
							velocity.Y = -6.1f;
							frameCounter = 0;
							for (int num219 = 0; num219 < 4; num219++)
							{
								int num220 = Dust.NewDust(new Vector2(position.X, position.Y + (float)height - 2f), width, 4, 5);
								Main.dust[num220].velocity += velocity;
								Main.dust[num220].velocity *= 0.4f;
							}
						}
						else
						{
							frameCounter = num218 * 4;
						}
					}
				}
				else if (velocity.Y < 0f)
				{
					frameCounter = 0;
					frame = 5;
				}
				else
				{
					frame = 4;
					frameCounter = 3;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 269)
			{
				if (velocity.Y >= 0f && (double)velocity.Y <= 0.8)
				{
					if (flag27)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
					{
						int num221 = Dust.NewDust(new Vector2(position.X, position.Y + (float)height - 2f), width, 6, 76);
						Main.dust[num221].noGravity = true;
						Main.dust[num221].velocity *= 0.3f;
						Main.dust[num221].noLight = true;
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 3)
						{
							frame = 0;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else
				{
					frameCounter = 0;
					frame = 2;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 313)
			{
				int i3 = (int)(base.Center.X / 16f);
				int num222 = (int)(base.Center.Y / 16f);
				int num223 = 0;
				Tile tileSafely2 = Framing.GetTileSafely(i3, num222);
				Tile tileSafely3 = Framing.GetTileSafely(i3, num222 - 1);
				Tile tileSafely4 = Framing.GetTileSafely(i3, num222 + 1);
				if (tileSafely2.wall > 0)
				{
					num223++;
				}
				if (tileSafely3.wall > 0)
				{
					num223++;
				}
				if (tileSafely4.wall > 0)
				{
					num223++;
				}
				if (num223 > 1)
				{
					position.Y += height;
					height = 34;
					position.Y -= height;
					position.X += width / 2;
					width = 34;
					position.X -= width / 2;
					Vector2 vector18 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num224 = Main.player[owner].Center.X - vector18.X;
					float num225 = Main.player[owner].Center.Y - vector18.Y;
					float num226 = (float)Math.Sqrt(num224 * num224 + num225 * num225);
					float num227 = 4f / num226;
					num224 *= num227;
					num225 *= num227;
					if (num226 < 120f)
					{
						velocity.X *= 0.9f;
						velocity.Y *= 0.9f;
						if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) < 0.1)
						{
							velocity *= 0f;
						}
					}
					else
					{
						velocity.X = (velocity.X * 9f + num224) / 10f;
						velocity.Y = (velocity.Y * 9f + num225) / 10f;
					}
					if (num226 >= 120f)
					{
						spriteDirection = direction;
						rotation = (float)Math.Atan2(velocity.Y * (float)(-direction), velocity.X * (float)(-direction));
					}
					frameCounter += (int)(Math.Abs(velocity.X) + Math.Abs(velocity.Y));
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 10)
					{
						frame = 5;
					}
					if (frame < 5)
					{
						frame = 10;
					}
				}
				else
				{
					rotation = 0f;
					if (direction == -1)
					{
						spriteDirection = 1;
					}
					if (direction == 1)
					{
						spriteDirection = -1;
					}
					position.Y += height;
					height = 30;
					position.Y -= height;
					position.X += width / 2;
					width = 30;
					position.X -= width / 2;
					if (velocity.Y >= 0f && (double)velocity.Y <= 0.8)
					{
						if (flag27)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame > 3)
							{
								frame = 0;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else
					{
						frameCounter = 0;
						frame = 4;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
			}
			else if (flag7)
			{
				int i4 = (int)(base.Center.X / 16f);
				int num228 = (int)(base.Center.Y / 16f);
				int num229 = 0;
				Tile tileSafely5 = Framing.GetTileSafely(i4, num228);
				Tile tileSafely6 = Framing.GetTileSafely(i4, num228 - 1);
				Tile tileSafely7 = Framing.GetTileSafely(i4, num228 + 1);
				if (tileSafely5.wall > 0)
				{
					num229++;
				}
				if (tileSafely6.wall > 0)
				{
					num229++;
				}
				if (tileSafely7.wall > 0)
				{
					num229++;
				}
				if (num229 > 1)
				{
					float num230 = 9f;
					float num231 = 40 * (minionPos + 1);
					Vector2 v11 = Main.player[owner].Center - base.Center;
					if (flag23)
					{
						v11 = vector16;
						num231 = 10f;
					}
					if (v11.Length() < num231)
					{
						velocity *= 0.9f;
						if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) < 0.1)
						{
							velocity *= 0f;
						}
					}
					else if (v11.Length() < 800f || !flag23)
					{
						velocity = (velocity * 9f + v11.SafeNormalize(Vector2.Zero) * num230) / 10f;
					}
					if (v11.Length() >= num231)
					{
						spriteDirection = direction;
						rotation = velocity.ToRotation() + (float)Math.PI / 2f;
					}
					else
					{
						rotation = v11.ToRotation() + (float)Math.PI / 2f;
					}
					frameCounter += (int)(Math.Abs(velocity.X) + Math.Abs(velocity.Y));
					if (frameCounter > 8)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 7)
					{
						frame = 4;
					}
					if (frame < 4)
					{
						frame = 7;
					}
				}
				else
				{
					if (!flag24)
					{
						rotation = 0f;
					}
					spriteDirection = -direction;
					if (!flag24 && frame >= 4 && frame <= 7)
					{
						Vector2 vector19 = Main.player[owner].Center - base.Center;
						if (flag23)
						{
							vector19 = vector16;
						}
						float num232 = 0f - vector19.Y;
						if (!(vector19.Y > 0f))
						{
							if (num232 < 120f)
							{
								velocity.Y = -10f;
							}
							else if (num232 < 210f)
							{
								velocity.Y = -13f;
							}
							else if (num232 < 270f)
							{
								velocity.Y = -15f;
							}
							else if (num232 < 310f)
							{
								velocity.Y = -17f;
							}
							else if (num232 < 380f)
							{
								velocity.Y = -18f;
							}
						}
					}
					if (flag24)
					{
						frameCounter++;
						if (frameCounter > 4)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame >= 8)
						{
							frame = 4;
						}
						if (frame <= 3)
						{
							frame = 7;
						}
					}
					else if (velocity.Y >= 0f && velocity.Y <= 0.8f)
					{
						if (flag27)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if (velocity.X < -0.8f || velocity.X > 0.8f)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 8)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame > 2)
							{
								frame = 0;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else
					{
						frameCounter = 0;
						frame = 3;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
			}
			else if (type == 314)
			{
				if (velocity.Y >= 0f && (double)velocity.Y <= 0.8)
				{
					if (flag27)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 6)
						{
							frame = 1;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else
				{
					frameCounter = 0;
					frame = 7;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 319)
			{
				if (velocity.Y >= 0f && (double)velocity.Y <= 0.8)
				{
					if (flag27)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 8)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 5)
						{
							frame = 2;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else
				{
					frameCounter = 0;
					frame = 1;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 236)
			{
				if (velocity.Y >= 0f && (double)velocity.Y <= 0.8)
				{
					if (flag27)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
					{
						if (frame < 2)
						{
							frame = 2;
						}
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 8)
						{
							frame = 2;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else
				{
					frameCounter = 0;
					frame = 1;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 499)
			{
				if (velocity.Y >= 0f && (double)velocity.Y <= 0.8)
				{
					if (flag27)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
					{
						if (frame < 2)
						{
							frame = 2;
						}
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame >= 8)
						{
							frame = 2;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else
				{
					frameCounter = 0;
					frame = 1;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 765)
			{
				if (velocity.Y >= 0f && (double)velocity.Y <= 0.8)
				{
					if (flag27)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
					{
						if (frame < 1)
						{
							frame = 1;
						}
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame >= 6)
						{
							frame = 1;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else
				{
					frame = 0;
					frameCounter = 0;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 266)
			{
				if (velocity.Y != 0f)
				{
					frameCounter++;
					if (frameCounter > 4)
					{
						frameCounter = 0;
						frame++;
					}
					if (frame == 0 || frame >= 8)
					{
						frame = 1;
					}
				}
				else
				{
					if (flag27)
					{
						spriteDirection = -1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = 1;
						}
					}
					frameCounter++;
					if (frameCounter > 7)
					{
						frameCounter = 0;
						frame++;
						if (frame == 1)
						{
							frame = 5;
						}
					}
					if ((frame >= 1 && frame <= 4) || frame >= 8)
					{
						frame = 0;
					}
				}
				if (wet && Main.player[owner].position.Y + (float)Main.player[owner].height < position.Y + (float)height && localAI[0] == 0f)
				{
					if (velocity.Y > -4f)
					{
						velocity.Y -= 0.2f;
					}
					if (velocity.Y > 0f)
					{
						velocity.Y *= 0.95f;
					}
				}
				else
				{
					velocity.Y += 0.4f;
				}
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 334)
			{
				if (velocity.Y == 0f)
				{
					if (flag27)
					{
						if (frame > 0)
						{
							frameCounter += 2;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame >= 7)
							{
								frame = 0;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
					{
						frameCounter += (int)Math.Abs((double)velocity.X * 0.75);
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame >= 7 || frame < 1)
						{
							frame = 1;
						}
					}
					else if (frame > 0)
					{
						frameCounter += 2;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame >= 7)
						{
							frame = 0;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else if (velocity.Y < 0f)
				{
					frameCounter = 0;
					frame = 2;
				}
				else if (velocity.Y > 0f)
				{
					frameCounter = 0;
					frame = 4;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 353)
			{
				if (velocity.Y == 0f)
				{
					if (flag27)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 9)
						{
							frame = 2;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else if (velocity.Y < 0f)
				{
					frameCounter = 0;
					frame = 1;
				}
				else if (velocity.Y > 0f)
				{
					frameCounter = 0;
					frame = 1;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 111)
			{
				if (velocity.Y == 0f)
				{
					if (flag27)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame >= 7)
						{
							frame = 0;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else if (velocity.Y < 0f)
				{
					frameCounter = 0;
					frame = 4;
				}
				else if (velocity.Y > 0f)
				{
					frameCounter = 0;
					frame = 6;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 112)
			{
				if (velocity.Y == 0f)
				{
					if (flag27)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame >= 3)
						{
							frame = 0;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else if (velocity.Y != 0f)
				{
					frameCounter = 0;
					frame = 1;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 127)
			{
				if (velocity.Y == 0f)
				{
					if (flag27)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if ((double)velocity.X < -0.1 || (double)velocity.X > 0.1)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 5)
						{
							frame = 0;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else
				{
					frame = 0;
					frameCounter = 0;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 200)
			{
				if (velocity.Y == 0f)
				{
					if (flag27)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if ((double)velocity.X < -0.1 || (double)velocity.X > 0.1)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 5)
						{
							frame = 0;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else
				{
					rotation = velocity.X * 0.1f;
					frameCounter++;
					if (velocity.Y < 0f)
					{
						frameCounter += 2;
					}
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 9)
					{
						frame = 6;
					}
					if (frame < 6)
					{
						frame = 6;
					}
				}
				velocity.Y += 0.1f;
				if (velocity.Y > 4f)
				{
					velocity.Y = 4f;
				}
			}
			else if (type == 208)
			{
				if (velocity.Y == 0f && flag27)
				{
					if (Main.player[owner].position.X + (float)(Main.player[owner].width / 2) < position.X + (float)(width / 2))
					{
						direction = -1;
					}
					else if (Main.player[owner].position.X + (float)(Main.player[owner].width / 2) > position.X + (float)(width / 2))
					{
						direction = 1;
					}
					rotation = 0f;
					frame = 0;
				}
				else
				{
					rotation = velocity.X * 0.075f;
					frameCounter++;
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 4)
					{
						frame = 1;
					}
					if (frame < 1)
					{
						frame = 1;
					}
				}
				velocity.Y += 0.1f;
				if (velocity.Y > 4f)
				{
					velocity.Y = 4f;
				}
			}
			else if (type == 209)
			{
				if (alpha > 0)
				{
					alpha -= 5;
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				if (velocity.Y == 0f)
				{
					if (flag27)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if ((double)velocity.X < -0.1 || (double)velocity.X > 0.1)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 11)
						{
							frame = 2;
						}
						if (frame < 2)
						{
							frame = 2;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else
				{
					frame = 1;
					frameCounter = 0;
					rotation = 0f;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 324)
			{
				if (velocity.Y == 0f)
				{
					if ((double)velocity.X < -0.1 || (double)velocity.X > 0.1)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 5)
						{
							frame = 2;
						}
						if (frame < 2)
						{
							frame = 2;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else
				{
					frameCounter = 0;
					frame = 1;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 14f)
				{
					velocity.Y = 14f;
				}
			}
			else if (type == 210)
			{
				if (velocity.Y == 0f)
				{
					if ((double)velocity.X < -0.1 || (double)velocity.X > 0.1)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 6)
						{
							frame = 0;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else
				{
					rotation = velocity.X * 0.05f;
					frameCounter++;
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 11)
					{
						frame = 7;
					}
					if (frame < 7)
					{
						frame = 7;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (type == 398)
			{
				if (velocity.Y == 0f)
				{
					if (flag27)
					{
						frame = 0;
						frameCounter = 0;
					}
					else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
					{
						frameCounter += (int)Math.Abs(velocity.X);
						frameCounter++;
						if (frameCounter > 10)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 6)
						{
							frame = 0;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
				}
				else if (velocity.Y != 0f)
				{
					frameCounter = 0;
					frame = 5;
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
		}
		if (type == 891)
		{
			_ = Main.player[owner];
			DelegateMethods.v3_1 = new Vector3(1f, 0.61f, 0.16f) * 1.5f;
			Utils.PlotTileLine(base.Center, base.Center + velocity * 6f, 20f, DelegateMethods.CastLightOpen);
			Utils.PlotTileLine(base.Left, base.Right, 20f, DelegateMethods.CastLightOpen);
		}
	}

	private bool Chester_IsAnyPlayerTrackingThisProjectile()
	{
		for (int i = 0; i < 255; i++)
		{
			Player player = Main.player[i];
			if (player.active && player.piggyBankProjTracker.IsTracking(this))
			{
				return true;
			}
		}
		return false;
	}

	private void AI_062()
	{
		float num = 0f;
		float num2 = 0f;
		float num3 = 20f;
		float num4 = 40f;
		float num5 = 0.69f;
		if (type == 963)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].abigailMinion = false;
			}
			if (Main.player[owner].abigailMinion)
			{
				timeLeft = 2;
			}
			originalDamage = Main.player[owner].highestAbigailCounterOriginalDamage;
			num2 = Main.player[owner].ownedProjectileCounts[970] - 1;
			num3 = Math.Max(4f, 18f - num2 * 1.75f);
			num = 1.4f;
			num4 = Math.Max(5f, num4 - num2 * 4f);
			num5 = Math.Min(1f, num5 + num2 * 0.03f);
		}
		if (type == 423)
		{
			num4 = 5f;
		}
		if (type == 373)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].hornetMinion = false;
			}
			if (Main.player[owner].hornetMinion)
			{
				timeLeft = 2;
			}
		}
		if (type == 375)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].impMinion = false;
			}
			if (Main.player[owner].impMinion)
			{
				timeLeft = 2;
			}
		}
		if (type == 407)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].sharknadoMinion = false;
			}
			if (Main.player[owner].sharknadoMinion)
			{
				timeLeft = 2;
			}
		}
		if (type == 423)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].UFOMinion = false;
			}
			if (Main.player[owner].UFOMinion)
			{
				timeLeft = 2;
			}
		}
		if (type == 613)
		{
			if (Main.player[owner].dead)
			{
				Main.player[owner].stardustMinion = false;
			}
			if (Main.player[owner].stardustMinion)
			{
				timeLeft = 2;
			}
			Lighting.AddLight(base.Center, 0.2f, 0.6f, 0.7f);
			if (localAI[1] > 0f)
			{
				localAI[1] -= 1f;
			}
		}
		if (type == 423)
		{
			if (ai[0] == 2f)
			{
				ai[1] -= 1f;
				tileCollide = false;
				if (ai[1] > 3f)
				{
					int num6 = Dust.NewDust(base.Center, 0, 0, 220 + Main.rand.Next(2), velocity.X, velocity.Y, 100);
					Main.dust[num6].scale = 0.5f + (float)Main.rand.NextDouble() * 0.3f;
					Main.dust[num6].velocity /= 2.5f;
					Main.dust[num6].noGravity = true;
					Main.dust[num6].noLight = true;
					Main.dust[num6].frame.Y = 80;
				}
				if (ai[1] != 0f)
				{
					return;
				}
				ai[1] = 30f;
				ai[0] = 0f;
				velocity /= 5f;
				velocity.Y = 0f;
				extraUpdates = 0;
				numUpdates = 0;
				netUpdate = true;
				extraUpdates = 0;
				numUpdates = 0;
			}
			if (extraUpdates > 1)
			{
				extraUpdates = 0;
			}
			if (numUpdates > 1)
			{
				numUpdates = 0;
			}
		}
		if (type == 613)
		{
			if (ai[0] == 2f)
			{
				ai[1] -= 1f;
				tileCollide = false;
				if (ai[1] > 3f)
				{
					if (numUpdates < 20)
					{
						for (int i = 0; i < 3; i++)
						{
							Dust obj = Main.dust[Dust.NewDust(position, width, height, 229)];
							obj.noGravity = true;
							obj.position = base.Center;
							obj.velocity *= 3f;
							obj.velocity += velocity * 3f;
							obj.fadeIn = 1f;
						}
					}
					float num7 = 2f - (float)numUpdates / 30f;
					if (scale > 0f)
					{
						float num8 = 2f;
						for (int j = 0; (float)j < num8; j++)
						{
							Dust obj2 = Main.dust[Dust.NewDust(position, width, height, 229)];
							obj2.noGravity = true;
							obj2.position = base.Center + Vector2.UnitY.RotatedBy((float)numUpdates * ((float)Math.PI / 30f) + (float)whoAmI * ((float)Math.PI / 4f) + (float)Math.PI / 2f) * (height / 2) - velocity * ((float)j / num8);
							obj2.velocity = velocity / 3f;
							obj2.fadeIn = num7 / 2f;
							obj2.scale = num7;
						}
					}
				}
				if (ai[1] != 0f)
				{
					return;
				}
				ai[1] = 30f;
				ai[0] = 0f;
				velocity /= 5f;
				velocity.Y = 0f;
				extraUpdates = 0;
				numUpdates = 0;
				netUpdate = true;
				float num9 = 15f;
				for (int k = 0; (float)k < num9; k++)
				{
					Dust dust = Main.dust[Dust.NewDust(position, width, height, 229)];
					dust.noGravity = true;
					dust.position = base.Center - velocity * 5f;
					dust.velocity *= 3f;
					dust.velocity += velocity * 3f;
					dust.fadeIn = 1f;
					if (Main.rand.Next(3) != 0)
					{
						dust.fadeIn = 2f;
						dust.scale = 2f;
						dust.velocity /= 8f;
					}
				}
				for (int l = 0; (float)l < num9; l++)
				{
					Dust dust2 = Main.dust[Dust.NewDust(position, width, height, 229)];
					dust2.noGravity = true;
					dust2.position = base.Center;
					dust2.velocity *= 3f;
					dust2.velocity += velocity * 3f;
					dust2.fadeIn = 1f;
					if (Main.rand.Next(3) != 0)
					{
						dust2.fadeIn = 2f;
						dust2.scale = 2f;
						dust2.velocity /= 8f;
					}
				}
				extraUpdates = 0;
				numUpdates = 0;
			}
			if (extraUpdates > 1)
			{
				extraUpdates = 0;
			}
			if (numUpdates > 1)
			{
				numUpdates = 0;
			}
		}
		if (type == 423 && localAI[0] > 0f)
		{
			localAI[0] -= 1f;
		}
		if (type == 613 && localAI[0] > 0f)
		{
			localAI[0] -= 1f;
		}
		float num10 = 0.05f;
		float num11 = width;
		if (type == 407)
		{
			num10 = 0.1f;
			num11 *= 2f;
		}
		for (int m = 0; m < 1000; m++)
		{
			if (m != whoAmI && Main.projectile[m].active && Main.projectile[m].owner == owner && Main.projectile[m].type == type && Math.Abs(position.X - Main.projectile[m].position.X) + Math.Abs(position.Y - Main.projectile[m].position.Y) < num11)
			{
				if (position.X < Main.projectile[m].position.X)
				{
					velocity.X -= num10;
				}
				else
				{
					velocity.X += num10;
				}
				if (position.Y < Main.projectile[m].position.Y)
				{
					velocity.Y -= num10;
				}
				else
				{
					velocity.Y += num10;
				}
			}
		}
		Vector2 vector = position;
		float num12 = 400f;
		if (type == 423)
		{
			num12 = 300f;
		}
		if (type == 613)
		{
			num12 = 300f;
		}
		num12 = 2000f;
		if (type == 963)
		{
			num12 = 700f;
		}
		bool flag = false;
		int num13 = -1;
		tileCollide = true;
		if (type == 963)
		{
			tileCollide = false;
		}
		if (type == 407)
		{
			tileCollide = false;
			if (Collision.SolidCollision(position, width, height))
			{
				alpha += 20;
				if (alpha > 150)
				{
					alpha = 150;
				}
			}
			else
			{
				alpha -= 50;
				if (alpha < 60)
				{
					alpha = 60;
				}
			}
		}
		if (type == 407 || type == 613 || type == 423)
		{
			Vector2 center = Main.player[owner].Center;
			Vector2 vector2 = new Vector2(0.5f);
			if (type == 423)
			{
				vector2.Y = 0f;
			}
			NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
			if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this))
			{
				Vector2 vector3 = ownerMinionAttackTargetNPC.position + ownerMinionAttackTargetNPC.Size * vector2;
				float num14 = num12 * 3f;
				float num15 = Vector2.Distance(vector3, center);
				if (num15 < num14 && !flag && Collision.CanHitLine(position, width, height, ownerMinionAttackTargetNPC.position, ownerMinionAttackTargetNPC.width, ownerMinionAttackTargetNPC.height))
				{
					num12 = num15;
					vector = vector3;
					flag = true;
					num13 = ownerMinionAttackTargetNPC.whoAmI;
				}
			}
			if (!flag)
			{
				for (int n = 0; n < Main.maxNPCs; n++)
				{
					NPC nPC = Main.npc[n];
					if (nPC.CanBeChasedBy(this))
					{
						Vector2 vector4 = nPC.position + nPC.Size * vector2;
						float num16 = Vector2.Distance(vector4, center);
						if (!(num16 >= num12) && Collision.CanHitLine(position, width, height, nPC.position, nPC.width, nPC.height))
						{
							num12 = num16;
							vector = vector4;
							flag = true;
							num13 = n;
						}
					}
				}
			}
		}
		else
		{
			NPC ownerMinionAttackTargetNPC2 = OwnerMinionAttackTargetNPC;
			if (ownerMinionAttackTargetNPC2 != null && ownerMinionAttackTargetNPC2.CanBeChasedBy(this))
			{
				float num17 = Vector2.Distance(ownerMinionAttackTargetNPC2.Center, base.Center);
				float num18 = num12 * 3f;
				if (num17 < num18 && !flag)
				{
					bool flag2 = false;
					if ((type != 963) ? Collision.CanHitLine(position, width, height, ownerMinionAttackTargetNPC2.position, ownerMinionAttackTargetNPC2.width, ownerMinionAttackTargetNPC2.height) : Collision.CanHit(base.Center, 1, 1, ownerMinionAttackTargetNPC2.Center, 1, 1))
					{
						num12 = num17;
						vector = ownerMinionAttackTargetNPC2.Center;
						flag = true;
						num13 = ownerMinionAttackTargetNPC2.whoAmI;
					}
				}
			}
			if (!flag)
			{
				for (int num19 = 0; num19 < Main.maxNPCs; num19++)
				{
					NPC nPC2 = Main.npc[num19];
					if (!nPC2.CanBeChasedBy(this))
					{
						continue;
					}
					float num20 = Vector2.Distance(nPC2.Center, base.Center);
					if (!(num20 >= num12))
					{
						bool flag3 = false;
						if ((type != 963) ? Collision.CanHitLine(position, width, height, nPC2.position, nPC2.width, nPC2.height) : Collision.CanHit(base.Center, 1, 1, nPC2.Center, 1, 1))
						{
							num12 = num20;
							vector = nPC2.Center;
							flag = true;
							num13 = num19;
						}
					}
				}
			}
		}
		int num21 = 500;
		if (type == 963)
		{
			num21 = 800;
		}
		if (flag)
		{
			num21 = 1000;
		}
		if (flag && type == 423)
		{
			num21 = 1200;
		}
		if (flag && type == 613)
		{
			num21 = 1350;
		}
		Player player = Main.player[owner];
		float num22 = Vector2.Distance(player.Center, base.Center);
		if (ai[0] != 1f && num22 > (float)num21)
		{
			ai[0] = 1f;
			netUpdate = true;
		}
		if (ai[0] == 1f)
		{
			tileCollide = false;
		}
		bool flag4 = false;
		if (type == 963)
		{
			flag4 = true;
		}
		if (flag4)
		{
			if (ai[0] <= 1f && localAI[1] <= 0f)
			{
				localAI[1] = -1f;
			}
			else
			{
				localAI[1] = Utils.Clamp(localAI[1] + 0.05f, 0f, 1f);
				if (localAI[1] == 1f)
				{
					localAI[1] = -1f;
				}
			}
		}
		if (type == 963 && velocity.Length() > 0.1f && Main.rand.Next(1500) == 0)
		{
			SoundEngine.PlaySound(SoundID.AbigailCry, base.Center);
		}
		bool flag5 = false;
		if (type == 423 || type == 407)
		{
			flag5 = true;
		}
		if (ai[0] >= 2f)
		{
			if (ai[0] == 2f && type == 963)
			{
				SoundEngine.PlaySound(SoundID.AbigailAttack, base.Center);
			}
			ai[0] += 1f;
			if (flag4)
			{
				localAI[1] = ai[0] / num4;
			}
			if (!flag)
			{
				ai[0] += 1f;
			}
			if (ai[0] > num4)
			{
				ai[0] = 0f;
				netUpdate = true;
				if (flag && type == 963 && (vector - base.Center).Length() < 50f)
				{
					ai[0] = 2f;
				}
			}
			velocity *= num5;
		}
		else if (flag && (flag5 || ai[0] == 0f))
		{
			Vector2 v = vector - base.Center;
			float num23 = v.Length();
			v = v.SafeNormalize(Vector2.Zero);
			if (type == 423)
			{
				v = vector - Vector2.UnitY * 80f;
				int num24 = (int)v.Y / 16;
				if (num24 < 0)
				{
					num24 = 0;
				}
				Tile tile = Main.tile[(int)v.X / 16, num24];
				if (tile != null && tile.active() && Main.tileSolid[tile.type] && !Main.tileSolidTop[tile.type])
				{
					v += Vector2.UnitY * 16f;
					tile = Main.tile[(int)v.X / 16, (int)v.Y / 16];
					if (tile != null && tile.active() && Main.tileSolid[tile.type] && !Main.tileSolidTop[tile.type])
					{
						v += Vector2.UnitY * 16f;
					}
				}
				v -= base.Center;
				num23 = v.Length();
				v = v.SafeNormalize(Vector2.Zero);
				if (num23 > 300f && num23 <= 800f && localAI[0] == 0f)
				{
					ai[0] = 2f;
					ai[1] = (int)(num23 / 10f);
					extraUpdates = (int)ai[1];
					velocity = v * 10f;
					localAI[0] = 60f;
					return;
				}
			}
			if (type == 613)
			{
				v = vector;
				Vector2 vector5 = base.Center - v;
				if (vector5 == Vector2.Zero)
				{
					vector5 = -Vector2.UnitY;
				}
				vector5 = vector5.SafeNormalize(Vector2.Zero);
				v += vector5 * 60f;
				int num25 = (int)v.Y / 16;
				if (num25 < 0)
				{
					num25 = 0;
				}
				Tile tile2 = Main.tile[(int)v.X / 16, num25];
				if (tile2 != null && tile2.active() && Main.tileSolid[tile2.type] && !Main.tileSolidTop[tile2.type])
				{
					v += Vector2.UnitY * 16f;
					tile2 = Main.tile[(int)v.X / 16, (int)v.Y / 16];
					if (tile2 != null && tile2.active() && Main.tileSolid[tile2.type] && !Main.tileSolidTop[tile2.type])
					{
						v += Vector2.UnitY * 16f;
					}
				}
				v -= base.Center;
				num23 = v.Length();
				v = v.SafeNormalize(Vector2.Zero);
				if (num23 > 400f && num23 <= 800f && localAI[0] == 0f)
				{
					ai[0] = 2f;
					ai[1] = (int)(num23 / 10f);
					extraUpdates = (int)ai[1];
					velocity = v * 10f;
					localAI[0] = 60f;
					return;
				}
			}
			if (type == 407)
			{
				if (num23 > 400f)
				{
					float num26 = 3f;
					v *= num26;
					velocity = (velocity * 20f + v) / 21f;
				}
				else
				{
					velocity *= 0.96f;
				}
			}
			if (num23 > 200f)
			{
				float num27 = 6f + num2 * num;
				v *= num27;
				float num28 = num3 * 2f;
				velocity.X = (velocity.X * num28 + v.X) / (num28 + 1f);
				velocity.Y = (velocity.Y * num28 + v.Y) / (num28 + 1f);
			}
			else if (type == 963)
			{
				if (num23 < 50f)
				{
					velocity *= 0.5f;
					ai[0] = 2f;
					netUpdate = true;
				}
				else
				{
					float num29 = 4f + num2 * num;
					v *= num29;
					velocity = (velocity * num3 + v) / (num3 + 1f);
				}
			}
			else if (type == 423 || type == 613)
			{
				if (num23 > 70f && num23 < 130f)
				{
					float num30 = 7f;
					if (num23 < 100f)
					{
						num30 = -3f;
					}
					v *= num30;
					velocity = (velocity * 20f + v) / 21f;
					if (Math.Abs(v.X) > Math.Abs(v.Y))
					{
						velocity.X = (velocity.X * 10f + v.X) / 11f;
					}
				}
				else
				{
					velocity *= 0.97f;
				}
			}
			else if (type == 375)
			{
				if (num23 < 150f)
				{
					float num31 = 4f;
					v *= 0f - num31;
					velocity.X = (velocity.X * 40f + v.X) / 41f;
					velocity.Y = (velocity.Y * 40f + v.Y) / 41f;
				}
				else
				{
					velocity *= 0.97f;
				}
			}
			else if (velocity.Y > -1f)
			{
				velocity.Y -= 0.1f;
			}
		}
		else
		{
			if (ai[0] != 1f && type != 963 && !Collision.CanHitLine(base.Center, 1, 1, Main.player[owner].Center, 1, 1))
			{
				ai[0] = 1f;
				netUpdate = true;
			}
			float num32 = 6f;
			if (ai[0] == 1f)
			{
				num32 = 15f;
			}
			if (type == 407)
			{
				num32 = 9f;
			}
			if (type == 963)
			{
				num32 *= 0.8f;
			}
			Vector2 center2 = base.Center;
			Vector2 v2 = player.Center - center2 + new Vector2(0f, -60f);
			if (type == 407)
			{
				v2 += new Vector2(0f, 40f);
			}
			if (type == 963)
			{
				v2 += new Vector2(-40 * Main.player[owner].direction, 40f);
			}
			if (type == 375)
			{
				ai[1] = 80f;
				netUpdate = true;
				v2 = player.Center - center2;
				int num33 = 1;
				for (int num34 = 0; num34 < whoAmI; num34++)
				{
					if (Main.projectile[num34].active && Main.projectile[num34].owner == owner && Main.projectile[num34].type == type)
					{
						num33++;
					}
				}
				v2.X -= 10 * Main.player[owner].direction;
				v2.X -= num33 * 40 * Main.player[owner].direction;
				v2.Y -= 10f;
			}
			float num35 = v2.Length();
			if (num35 > 200f && num32 < 9f)
			{
				num32 = 9f;
			}
			if ((type == 423 || type == 407) && num35 > 300f && num32 < 12f)
			{
				num32 = 12f;
			}
			if (type == 375)
			{
				num32 = (int)((double)num32 * 0.75);
			}
			if (num35 < 100f && ai[0] == 1f && !Collision.SolidCollision(position, width, height))
			{
				ai[0] = 0f;
				netUpdate = true;
			}
			if (num35 > 2000f)
			{
				position.X = Main.player[owner].Center.X - (float)(width / 2);
				position.Y = Main.player[owner].Center.Y - (float)(width / 2);
			}
			if (type == 375 || type == 963)
			{
				if (num35 > 10f)
				{
					v2 = v2.SafeNormalize(Vector2.Zero);
					if (num35 < 50f)
					{
						num32 /= 2f;
					}
					v2 *= num32;
					velocity = (velocity * 20f + v2) / 21f;
				}
				else
				{
					direction = Main.player[owner].direction;
					velocity *= 0.9f;
				}
			}
			else if (type == 407)
			{
				if (Math.Abs(v2.X) > 40f || Math.Abs(v2.Y) > 10f)
				{
					v2 = v2.SafeNormalize(Vector2.Zero);
					v2 *= num32;
					v2 *= new Vector2(1.25f, 0.65f);
					velocity = (velocity * 20f + v2) / 21f;
				}
				else
				{
					if (velocity.X == 0f && velocity.Y == 0f)
					{
						velocity.X = -0.15f;
						velocity.Y = -0.05f;
					}
					velocity *= 1.01f;
				}
			}
			else if (num35 > 70f)
			{
				v2 = v2.SafeNormalize(Vector2.Zero);
				v2 *= num32;
				velocity = (velocity * 20f + v2) / 21f;
			}
			else
			{
				if (velocity.X == 0f && velocity.Y == 0f)
				{
					velocity.X = -0.15f;
					velocity.Y = -0.05f;
				}
				velocity *= 1.01f;
			}
			if (num35 > 250f && (type == 423 || type == 407))
			{
				float x = Main.player[owner].velocity.X;
				float y = Main.player[owner].velocity.Y;
				if ((velocity.X < 0f && x >= 0f) || (velocity.X >= 0f && x < 0f))
				{
					velocity.X *= 0.95f;
				}
				else
				{
					velocity.X += x * 0.125f;
				}
				if ((velocity.Y < 0f && y >= 0f) || (velocity.Y >= 0f && y < 0f))
				{
					velocity.Y *= 0.95f;
				}
				else
				{
					velocity.Y += y * 0.125f;
				}
				if (velocity.Length() > num32)
				{
					velocity = velocity.SafeNormalize(Vector2.Zero) * num32;
				}
			}
		}
		rotation = velocity.X * 0.05f;
		frameCounter++;
		if (type == 373)
		{
			if (frameCounter > 1)
			{
				frame++;
				frameCounter = 0;
			}
			if (frame > 2)
			{
				frame = 0;
			}
		}
		if (type == 963)
		{
			if (ai[0] >= 2f)
			{
				int num36 = 12;
				if (frame < 8)
				{
					frameCounter = 0;
				}
				frameCounter++;
				frame = frameCounter / num36;
				if (frame > 6)
				{
					frameCounter = 0;
					frame = 5;
				}
				switch (frame)
				{
				case 0:
				case 1:
				case 2:
					frame = 8 + frame;
					break;
				case 3:
				case 5:
				case 7:
					frame = 11;
					break;
				default:
					frame = 12;
					break;
				}
				if (Main.rand.Next(2) == 0)
				{
					float num37 = 1.1f + Main.rand.NextFloat() * 0.3f;
					float num38 = 1.4f + Main.rand.NextFloat() * 0.4f;
					Vector2 vector6 = Main.rand.NextVector2CircularEdge((float)width * num37, (0f - (float)height) * 0.25f * num37);
					float num39 = vector6.ToRotation() + (float)Math.PI / 2f;
					int num40 = Dust.NewDust(base.Bottom + vector6, 1, 1, 303, 0f, 0f, 50, Color.GhostWhite, num38);
					Main.dust[num40].velocity = vector6 * 0.0125f + new Vector2(1f, 0f).RotatedBy(num39, Vector2.Zero);
					Main.dust[num40].noGravity = true;
				}
			}
			else
			{
				if (frame > 7)
				{
					frame = 0;
					frameCounter = 0;
				}
				if (frameCounter > 6)
				{
					frameCounter = 0;
					frame++;
					if (frame > 7)
					{
						frame = 0;
					}
				}
			}
		}
		if (type == 375)
		{
			int num41 = 5;
			if (frameCounter >= 4 * num41)
			{
				frameCounter = 0;
			}
			frame = frameCounter / num41;
			if (ai[1] > 0f && ai[1] < 24f)
			{
				frame += 4;
			}
			if (Main.rand.Next(7) == 0)
			{
				Dust obj3 = Main.dust[Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 0, default(Color), 2f)];
				obj3.velocity *= 0.3f;
				obj3.noGravity = true;
				obj3.noLight = true;
			}
		}
		if (type == 407)
		{
			int num42 = 2;
			if (frameCounter >= 6 * num42)
			{
				frameCounter = 0;
			}
			frame = frameCounter / num42;
			if (Main.rand.Next(5) == 0)
			{
				int num43 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 217, 0f, 0f, 100, default(Color), 2f);
				Main.dust[num43].velocity *= 0.3f;
				Main.dust[num43].noGravity = true;
				Main.dust[num43].noLight = true;
			}
		}
		if (type == 423 || type == 613)
		{
			int num44 = 3;
			if (frameCounter >= 4 * num44)
			{
				frameCounter = 0;
			}
			frame = frameCounter / num44;
		}
		if (velocity.X > 0f)
		{
			spriteDirection = (direction = -1);
		}
		else if (velocity.X < 0f)
		{
			spriteDirection = (direction = 1);
		}
		if (type == 963)
		{
			spriteDirection = (direction *= -1);
			if (!flag && Math.Abs(velocity.X) < 0.1f)
			{
				spriteDirection = ((Main.player[owner].Center.X > base.Center.X) ? 1 : (-1));
			}
		}
		if (type == 373)
		{
			if (ai[1] > 0f)
			{
				ai[1] += Main.rand.Next(1, 4);
			}
			int num45 = 90;
			if (Main.player[owner].strongBees)
			{
				num45 = 70;
			}
			if (ai[1] > (float)num45)
			{
				ai[1] = 0f;
				netUpdate = true;
			}
		}
		else if (type == 375)
		{
			if (ai[1] > 0f)
			{
				ai[1] += 1f;
				if (Main.rand.Next(3) == 0)
				{
					ai[1] += 1f;
				}
			}
			if (ai[1] > 90f)
			{
				ai[1] = 0f;
				netUpdate = true;
			}
		}
		else if (type == 407)
		{
			if (ai[1] > 0f)
			{
				ai[1] += 1f;
				if (Main.rand.Next(3) != 0)
				{
					ai[1] += 1f;
				}
			}
			if (ai[1] > 50f)
			{
				ai[1] = 0f;
				netUpdate = true;
			}
		}
		else if (type == 423)
		{
			if (ai[1] > 0f)
			{
				ai[1] += 1f;
				if (Main.rand.Next(3) != 0)
				{
					ai[1] += 1f;
				}
			}
			if (ai[1] > 40f)
			{
				ai[1] = 0f;
				netUpdate = true;
			}
		}
		else if (type == 613)
		{
			if (ai[1] > 0f)
			{
				ai[1] += 1f;
				if (Main.rand.Next(3) != 0)
				{
					ai[1] += 1f;
				}
			}
			if (ai[1] > 60f)
			{
				ai[1] = 0f;
				netUpdate = true;
			}
		}
		if (!flag5 && ai[0] != 0f)
		{
			return;
		}
		float num46 = 0f;
		int num47 = 0;
		if (type == 373)
		{
			num46 = 10f;
			num47 = 374;
		}
		else if (type == 375)
		{
			num46 = 11f;
			num47 = 376;
		}
		else if (type == 407)
		{
			num46 = 20f;
			num47 = 408;
		}
		else if (type == 423)
		{
			num46 = 4f;
			num47 = 433;
		}
		else if (type == 613)
		{
			num46 = 14f;
			num47 = 614;
		}
		if (!flag)
		{
			return;
		}
		if (type == 375)
		{
			if ((vector - base.Center).X > 0f)
			{
				spriteDirection = (direction = -1);
			}
			else if ((vector - base.Center).X < 0f)
			{
				spriteDirection = (direction = 1);
			}
		}
		if (type == 407 && Collision.SolidCollision(position, width, height))
		{
			return;
		}
		if (type == 423)
		{
			if (Math.Abs((vector - base.Center).ToRotation() - (float)Math.PI / 2f) > (float)Math.PI / 4f)
			{
				velocity += (vector - base.Center - Vector2.UnitY * 80f).SafeNormalize(Vector2.Zero);
			}
			if (!((vector - base.Center).Length() > 400f) && ai[1] == 0f)
			{
				ai[1] += 1f;
				if (Main.myPlayer == owner)
				{
					Vector2 v3 = vector - base.Center;
					v3 = v3.SafeNormalize(Vector2.Zero);
					v3 *= num46;
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, v3.X, v3.Y, num47, damage, knockBack, Main.myPlayer);
					netUpdate = true;
				}
			}
		}
		else if (ai[1] == 0f && type == 613)
		{
			if ((vector - base.Center).Length() > 500f || ai[1] != 0f)
			{
				return;
			}
			ai[1] += 1f;
			if (Main.myPlayer == owner)
			{
				Vector2 v4 = vector - base.Center;
				v4 = v4.SafeNormalize(Vector2.Zero);
				v4 *= num46;
				int num48 = NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, v4.X, v4.Y, num47, damage, knockBack, Main.myPlayer, 0f, num13);
				Main.projectile[num48].timeLeft = 300;
				Main.projectile[num48].netUpdate = true;
				velocity -= v4 / 3f;
				netUpdate = true;
			}
			for (int num49 = 0; num49 < 5; num49++)
			{
				int num50 = width / 4;
				_ = ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2() * Main.rand.Next(24, 41) / 8f;
				int num51 = Dust.NewDust(base.Center - Vector2.One * num50, num50 * 2, num50 * 2, 88);
				Dust dust3 = Main.dust[num51];
				Vector2 vector7 = (dust3.position - base.Center).SafeNormalize(Vector2.Zero);
				dust3.position = base.Center + vector7 * num50 * scale - new Vector2(4f);
				if (num49 < 30)
				{
					dust3.velocity = vector7 * dust3.velocity.Length() * 2f;
				}
				else
				{
					dust3.velocity = 2f * vector7 * Main.rand.Next(45, 91) / 10f;
				}
				dust3.noGravity = true;
				dust3.scale = 0.7f + Main.rand.NextFloat();
			}
		}
		else if (ai[1] == 0f)
		{
			Vector2 v5 = vector - base.Center;
			ai[1] += 1f;
			if (Main.myPlayer == owner)
			{
				v5 = v5.SafeNormalize(Vector2.Zero);
				v5 *= num46;
				int num52 = NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, v5.X, v5.Y, num47, damage, knockBack, Main.myPlayer);
				Main.projectile[num52].timeLeft = 300;
				Main.projectile[num52].netUpdate = true;
				netUpdate = true;
			}
		}
	}

	private void AI_075()
	{
		Player player = Main.player[owner];
		float num = (float)Math.PI / 2f;
		Vector2 mountedCenter = player.MountedCenter;
		Vector2 vector = player.RotatedRelativePoint(mountedCenter);
		int num2 = 2;
		float num3 = 0f;
		if (type == 611 && player.mount.Active && player.mount.Type >= 0 && MountID.Sets.DontHoldItems[player.mount.Type])
		{
			alpha = 255;
			if (Main.myPlayer == owner)
			{
				Kill();
			}
		}
		if (type == 439)
		{
			ai[0] += 1f;
			int num4 = 0;
			if (ai[0] >= 40f)
			{
				num4++;
			}
			if (ai[0] >= 80f)
			{
				num4++;
			}
			if (ai[0] >= 120f)
			{
				num4++;
			}
			int num5 = 24;
			int num6 = 6;
			ai[1] += 1f;
			bool flag = false;
			if (ai[1] >= (float)(num5 - num6 * num4))
			{
				ai[1] = 0f;
				flag = true;
			}
			frameCounter += 1 + num4;
			if (frameCounter >= 4)
			{
				frameCounter = 0;
				frame++;
				if (frame >= 6)
				{
					frame = 0;
				}
			}
			if (soundDelay <= 0)
			{
				soundDelay = num5 - num6 * num4;
				if (ai[0] != 1f)
				{
					SoundEngine.PlaySound(SoundID.Item91, position);
				}
			}
			if (ai[1] == 1f && ai[0] != 1f)
			{
				Vector2 spinningpoint = Vector2.UnitX * 24f;
				spinningpoint = spinningpoint.RotatedBy(rotation - (float)Math.PI / 2f);
				Vector2 vector2 = base.Center + spinningpoint;
				for (int i = 0; i < 2; i++)
				{
					int num7 = Dust.NewDust(vector2 - Vector2.One * 8f, 16, 16, 135, velocity.X / 2f, velocity.Y / 2f, 100);
					Main.dust[num7].velocity *= 0.66f;
					Main.dust[num7].noGravity = true;
					Main.dust[num7].scale = 1.4f;
				}
			}
			if (flag && Main.myPlayer == owner)
			{
				if (player.channel && player.CheckMana(player.inventory[player.selectedItem].mana, pay: true) && !player.noItems && !player.CCed)
				{
					float num8 = player.inventory[player.selectedItem].shootSpeed * scale;
					Vector2 vector3 = vector;
					Vector2 value = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector3;
					if (player.gravDir == -1f)
					{
						value.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector3.Y;
					}
					Vector2 vector4 = Vector2.Normalize(value);
					if (float.IsNaN(vector4.X) || float.IsNaN(vector4.Y))
					{
						vector4 = -Vector2.UnitY;
					}
					vector4 *= num8;
					if (vector4.X != velocity.X || vector4.Y != velocity.Y)
					{
						netUpdate = true;
					}
					velocity = vector4;
					int num9 = 440;
					float num10 = 14f;
					int num11 = 7;
					for (int j = 0; j < 2; j++)
					{
						vector3 = base.Center + new Vector2(Main.rand.Next(-num11, num11 + 1), Main.rand.Next(-num11, num11 + 1));
						Vector2 spinningpoint2 = Vector2.Normalize(velocity) * num10;
						spinningpoint2 = spinningpoint2.RotatedBy(Main.rand.NextDouble() * 0.19634954631328583 - 0.09817477315664291);
						if (float.IsNaN(spinningpoint2.X) || float.IsNaN(spinningpoint2.Y))
						{
							spinningpoint2 = -Vector2.UnitY;
						}
						NewProjectile(GetProjectileSource_FromThis(), vector3.X, vector3.Y, spinningpoint2.X, spinningpoint2.Y, num9, damage, knockBack, owner);
					}
				}
				else
				{
					Kill();
				}
			}
		}
		if (type == 445)
		{
			if (soundDelay <= 0)
			{
				SoundEngine.PlaySound(SoundID.Item132, position);
				soundDelay = 23;
			}
			localAI[0] += 1f;
			if (localAI[0] >= 60f)
			{
				localAI[0] = 0f;
			}
			if (Vector2.Distance(vector, base.Center) >= 5f)
			{
				float num12 = localAI[0] / 60f;
				if (num12 > 0.5f)
				{
					num12 = 1f - num12;
				}
				Vector3 value2 = new Vector3(0f, 1f, 0.7f);
				Vector3 value3 = new Vector3(0f, 0.7f, 1f);
				Vector3 vector5 = Vector3.Lerp(value2, value3, 1f - num12 * 2f) * 0.5f;
				if (Vector2.Distance(vector, base.Center) >= 30f)
				{
					Vector2 vector6 = base.Center - vector;
					vector6.Normalize();
					vector6 *= Vector2.Distance(vector, base.Center) - 30f;
					DelegateMethods.v3_1 = vector5 * 0.8f;
					Utils.PlotTileLine(base.Center - vector6, base.Center, 8f, DelegateMethods.CastLightOpen);
				}
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, vector5.X, vector5.Y, vector5.Z);
			}
			if (Main.myPlayer == owner)
			{
				if (localAI[1] > 0f)
				{
					localAI[1] -= 1f;
				}
				if (!player.channel || player.noItems || player.CCed)
				{
					Kill();
				}
				else if (localAI[1] == 0f)
				{
					Vector2 vector7 = vector;
					Vector2 value4 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector7;
					if (player.gravDir == -1f)
					{
						value4.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector7.Y;
					}
					if (Main.tile[Player.tileTargetX, Player.tileTargetY].active())
					{
						value4 = new Vector2(Player.tileTargetX, Player.tileTargetY) * 16f + Vector2.One * 8f - vector7;
						localAI[1] = 2f;
					}
					value4 = Vector2.Lerp(value4, velocity, 0.7f);
					if (float.IsNaN(value4.X) || float.IsNaN(value4.Y))
					{
						value4 = -Vector2.UnitY;
					}
					float num13 = 30f;
					if (value4.Length() < num13)
					{
						value4 = Vector2.Normalize(value4) * num13;
					}
					int tileBoost = player.inventory[player.selectedItem].tileBoost;
					int num14 = -Player.tileRangeX - tileBoost + 1;
					int num15 = Player.tileRangeX + tileBoost - 1;
					int num16 = -Player.tileRangeY - tileBoost;
					int num17 = Player.tileRangeY + tileBoost - 1;
					int num18 = 12;
					bool flag2 = false;
					if (value4.X < (float)(num14 * 16 - num18))
					{
						flag2 = true;
					}
					if (value4.Y < (float)(num16 * 16 - num18))
					{
						flag2 = true;
					}
					if (value4.X > (float)(num15 * 16 + num18))
					{
						flag2 = true;
					}
					if (value4.Y > (float)(num17 * 16 + num18))
					{
						flag2 = true;
					}
					if (flag2)
					{
						Vector2 vector8 = Vector2.Normalize(value4);
						float num19 = -1f;
						if (vector8.X < 0f && ((float)(num14 * 16 - num18) / vector8.X < num19 || num19 == -1f))
						{
							num19 = (float)(num14 * 16 - num18) / vector8.X;
						}
						if (vector8.X > 0f && ((float)(num15 * 16 + num18) / vector8.X < num19 || num19 == -1f))
						{
							num19 = (float)(num15 * 16 + num18) / vector8.X;
						}
						if (vector8.Y < 0f && ((float)(num16 * 16 - num18) / vector8.Y < num19 || num19 == -1f))
						{
							num19 = (float)(num16 * 16 - num18) / vector8.Y;
						}
						if (vector8.Y > 0f && ((float)(num17 * 16 + num18) / vector8.Y < num19 || num19 == -1f))
						{
							num19 = (float)(num17 * 16 + num18) / vector8.Y;
						}
						value4 = vector8 * num19;
					}
					if (value4.X != velocity.X || value4.Y != velocity.Y)
					{
						netUpdate = true;
					}
					velocity = value4;
				}
			}
		}
		if (type == 460)
		{
			ai[0] += 1f;
			int num20 = 0;
			if (ai[0] >= 80f)
			{
				num20++;
			}
			if (ai[0] >= 180f)
			{
				num20++;
			}
			bool flag3 = false;
			_ = ai[0];
			if (ai[0] == 80f || ai[0] == 180f || (ai[0] > 180f && ai[0] % 20f == 0f))
			{
				flag3 = true;
			}
			bool flag4 = ai[0] >= 180f;
			int num21 = 5;
			if (!flag4)
			{
				ai[1] += 1f;
			}
			bool flag5 = false;
			if (ai[0] == 1f)
			{
				flag5 = true;
			}
			if (flag4 && ai[0] % 20f == 0f)
			{
				flag5 = true;
			}
			if ((!flag4 && ai[1] >= (float)num21) || (flag4 && ai[0] % 5f == 0f))
			{
				if (!flag4)
				{
					ai[1] = 0f;
				}
				flag5 = true;
				if (Main.myPlayer == owner)
				{
					float num22 = player.inventory[player.selectedItem].shootSpeed * scale;
					Vector2 vector9 = vector;
					Vector2 value5 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector9;
					if (player.gravDir == -1f)
					{
						value5.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector9.Y;
					}
					Vector2 vector10 = Vector2.Normalize(value5);
					if (float.IsNaN(vector10.X) || float.IsNaN(vector10.Y))
					{
						vector10 = -Vector2.UnitY;
					}
					vector10 *= num22;
					if (vector10.X != velocity.X || vector10.Y != velocity.Y)
					{
						netUpdate = true;
					}
					velocity = vector10;
				}
			}
			if (soundDelay <= 0 && !flag4)
			{
				soundDelay = num21 - num20;
				soundDelay *= 2;
				if (ai[0] != 1f)
				{
					SoundEngine.PlaySound(SoundID.Item15, position);
				}
			}
			if (ai[0] > 10f && !flag4)
			{
				Vector2 spinningpoint3 = Vector2.UnitX * 18f;
				spinningpoint3 = spinningpoint3.RotatedBy(rotation - (float)Math.PI / 2f);
				Vector2 vector11 = base.Center + spinningpoint3;
				for (int k = 0; k < num20 + 1; k++)
				{
					int num23 = 226;
					float num24 = 0.4f;
					if (k % 2 == 1)
					{
						num23 = 226;
						num24 = 0.65f;
					}
					Vector2 vector12 = vector11 + ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2() * (12f - (float)(num20 * 2));
					int num25 = Dust.NewDust(vector12 - Vector2.One * 8f, 16, 16, num23, velocity.X / 2f, velocity.Y / 2f);
					Main.dust[num25].velocity = Vector2.Normalize(vector11 - vector12) * 1.5f * (10f - (float)num20 * 2f) / 10f;
					Main.dust[num25].noGravity = true;
					Main.dust[num25].scale = num24;
					Main.dust[num25].customData = player;
				}
			}
			if (flag4)
			{
				Vector2 spinningpoint4 = Vector2.UnitX * 14f;
				spinningpoint4 = spinningpoint4.RotatedBy(rotation - (float)Math.PI / 2f);
				Vector2 vector13 = base.Center + spinningpoint4;
				for (int l = 0; l < 2; l++)
				{
					int num26 = 226;
					float num27 = 0.35f;
					if (l % 2 == 1)
					{
						num26 = 226;
						num27 = 0.45f;
					}
					float num28 = Main.rand.NextFloatDirection();
					Vector2 vector14 = vector13 + (rotation + num28 * ((float)Math.PI / 4f) * 0.8f - (float)Math.PI / 2f).ToRotationVector2() * 6f;
					int num29 = 24;
					int num30 = Dust.NewDust(vector14 - Vector2.One * (num29 / 2), num29, num29, num26, velocity.X / 2f, velocity.Y / 2f);
					Main.dust[num30].velocity = (vector14 - vector13).SafeNormalize(Vector2.Zero) * MathHelper.Lerp(1.5f, 9f, Utils.GetLerpValue(1f, 0f, Math.Abs(num28), clamped: true));
					Main.dust[num30].noGravity = true;
					Main.dust[num30].scale = num27;
					Main.dust[num30].customData = player;
					Main.dust[num30].fadeIn = 0.5f;
				}
			}
			if (flag5 && Main.myPlayer == owner)
			{
				bool flag6 = false;
				flag6 = !flag3 || player.CheckMana(player.inventory[player.selectedItem].mana, pay: true);
				if (player.channel && flag6 && !player.noItems && !player.CCed)
				{
					if (ai[0] == 180f)
					{
						Vector2 center = base.Center;
						Vector2 vector15 = Vector2.Normalize(velocity);
						if (float.IsNaN(vector15.X) || float.IsNaN(vector15.Y))
						{
							vector15 = -Vector2.UnitY;
						}
						int num31 = (int)((float)damage * 1.5f);
						int num32 = NewProjectile(GetProjectileSource_FromThis(), center.X, center.Y, vector15.X, vector15.Y, 461, num31, knockBack, owner, 0f, whoAmI);
						ai[1] = num32;
						netUpdate = true;
					}
					else if (flag4)
					{
						Projectile projectile = Main.projectile[(int)ai[1]];
						if (!projectile.active || projectile.type != 461)
						{
							Kill();
							return;
						}
					}
					else
					{
						bool flag7 = false;
						if (ai[0] == 1f)
						{
							flag7 = true;
						}
						if (ai[0] <= 50f && ai[0] % 10f == 0f)
						{
							flag7 = true;
						}
						if (ai[0] >= 80f && ai[0] < 180f && ai[0] % 30f == 0f)
						{
							flag7 = true;
						}
						if (flag7)
						{
							Vector2 vector16 = vector;
							int num33 = 459;
							float num34 = 10f;
							vector16 = base.Center;
							Vector2 vector17 = Vector2.Normalize(velocity) * num34;
							if (float.IsNaN(vector17.X) || float.IsNaN(vector17.Y))
							{
								vector17 = -Vector2.UnitY;
							}
							float num35 = 0.7f + (float)num20 * 0.3f;
							int num36 = ((num35 < 1f) ? damage : ((int)((float)damage * 2.5f)));
							NewProjectile(GetProjectileSource_FromThis(), vector16.X, vector16.Y, vector17.X, vector17.Y, num33, num36, knockBack, owner, 0f, num35);
						}
					}
				}
				else
				{
					Kill();
				}
			}
		}
		if (type == 633)
		{
			float num37 = 30f;
			if (ai[0] > 90f)
			{
				num37 = 15f;
			}
			if (ai[0] > 120f)
			{
				num37 = 5f;
			}
			damage = (int)((float)player.inventory[player.selectedItem].damage * player.magicDamage);
			ai[0] += 1f;
			ai[1] += 1f;
			bool flag8 = false;
			if (ai[0] % num37 == 0f)
			{
				flag8 = true;
			}
			int num38 = 10;
			bool flag9 = false;
			if (ai[0] % num37 == 0f)
			{
				flag9 = true;
			}
			if (ai[1] >= 1f)
			{
				ai[1] = 0f;
				flag9 = true;
				if (Main.myPlayer == owner)
				{
					float num39 = player.inventory[player.selectedItem].shootSpeed * scale;
					Vector2 vector18 = vector;
					Vector2 value6 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector18;
					if (player.gravDir == -1f)
					{
						value6.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector18.Y;
					}
					Vector2 value7 = Vector2.Normalize(value6);
					if (float.IsNaN(value7.X) || float.IsNaN(value7.Y))
					{
						value7 = -Vector2.UnitY;
					}
					value7 = Vector2.Normalize(Vector2.Lerp(value7, Vector2.Normalize(velocity), 0.92f));
					value7 *= num39;
					if (value7.X != velocity.X || value7.Y != velocity.Y)
					{
						netUpdate = true;
					}
					velocity = value7;
				}
			}
			frameCounter++;
			int num40 = ((!(ai[0] < 120f)) ? 1 : 4);
			if (frameCounter >= num40)
			{
				frameCounter = 0;
				if (++frame >= 5)
				{
					frame = 0;
				}
			}
			if (soundDelay <= 0)
			{
				soundDelay = num38;
				soundDelay *= 2;
				if (ai[0] != 1f)
				{
					SoundEngine.PlaySound(SoundID.Item15, position);
				}
			}
			if (flag9 && Main.myPlayer == owner)
			{
				bool flag10 = false;
				flag10 = !flag8 || player.CheckMana(player.inventory[player.selectedItem].mana, pay: true);
				if (player.channel && flag10 && !player.noItems && !player.CCed)
				{
					if (ai[0] == 1f)
					{
						Vector2 center2 = base.Center;
						Vector2 vector19 = Vector2.Normalize(velocity);
						if (float.IsNaN(vector19.X) || float.IsNaN(vector19.Y))
						{
							vector19 = -Vector2.UnitY;
						}
						int num41 = damage;
						for (int m = 0; m < 6; m++)
						{
							NewProjectile(GetProjectileSource_FromThis(), center2.X, center2.Y, vector19.X, vector19.Y, 632, num41, knockBack, owner, m, whoAmI);
						}
						netUpdate = true;
					}
				}
				else
				{
					Kill();
				}
			}
		}
		if (type == 595)
		{
			num = 0f;
			if (spriteDirection == -1)
			{
				num = (float)Math.PI;
			}
			if (++frame >= Main.projFrames[type])
			{
				frame = 0;
			}
			soundDelay--;
			if (soundDelay <= 0)
			{
				SoundEngine.PlaySound(SoundID.Item1, base.Center);
				soundDelay = 12;
			}
			if (Main.myPlayer == owner)
			{
				if (player.channel && !player.noItems && !player.CCed)
				{
					float num42 = 1f;
					if (player.inventory[player.selectedItem].shoot == type)
					{
						num42 = player.inventory[player.selectedItem].shootSpeed * scale;
					}
					Vector2 vec = Main.MouseWorld - vector;
					vec.Normalize();
					if (vec.HasNaNs())
					{
						vec = Vector2.UnitX * player.direction;
					}
					vec *= num42;
					if (vec.X != velocity.X || vec.Y != velocity.Y)
					{
						netUpdate = true;
					}
					velocity = vec;
				}
				else
				{
					Kill();
				}
			}
			Vector2 vector20 = base.Center + velocity * 3f;
			Lighting.AddLight(vector20, 0.8f, 0.8f, 0.8f);
			if (Main.rand.Next(3) == 0)
			{
				int num43 = Dust.NewDust(vector20 - base.Size / 2f, width, height, 63, velocity.X, velocity.Y, 100, default(Color), 2f);
				Main.dust[num43].noGravity = true;
				Main.dust[num43].position -= velocity;
			}
		}
		if (type == 735)
		{
			num = 0f;
			if (spriteDirection == -1)
			{
				num = (float)Math.PI;
			}
			if (++frame >= Main.projFrames[type])
			{
				frame = 0;
			}
			soundDelay--;
			if (soundDelay <= 0)
			{
				SoundEngine.PlaySound(SoundID.Item1, base.Center);
				soundDelay = 12;
			}
			if (Main.myPlayer == owner)
			{
				if (player.channel && !player.noItems && !player.CCed)
				{
					float num44 = 1f;
					if (player.inventory[player.selectedItem].shoot == type)
					{
						num44 = player.inventory[player.selectedItem].shootSpeed * scale;
					}
					Vector2 vec2 = Main.MouseWorld - vector;
					vec2.Normalize();
					if (vec2.HasNaNs())
					{
						vec2 = Vector2.UnitX * player.direction;
					}
					vec2 *= num44;
					if (vec2.X != velocity.X || vec2.Y != velocity.Y)
					{
						netUpdate = true;
					}
					velocity = vec2;
				}
				else
				{
					Kill();
				}
			}
			Vector2 vector21 = base.Center + velocity * 3f;
			Lighting.AddLight(vector21, 0.8f, 0.8f, 0.8f);
			if (Main.rand.Next(3) == 0)
			{
				int num45 = Dust.NewDust(vector21 - base.Size / 2f, width, height, 302, velocity.X, velocity.Y, 100, default(Color), 2f);
				Main.dust[num45].noGravity = true;
				Main.dust[num45].position -= velocity;
			}
		}
		if (type == 927)
		{
			num = 0f;
			scale = ai[1];
			ai[0] += 1f;
			if (ai[0] >= 8f)
			{
				ai[0] = 0f;
			}
			num2 = 9;
			num3 = Main.rand.NextFloatDirection() * ((float)Math.PI * 2f) * 0.05f;
			soundDelay--;
			if (soundDelay <= 0)
			{
				SoundEngine.PlaySound(SoundID.Item1, base.Center);
				soundDelay = 6;
			}
			if (Main.myPlayer == owner)
			{
				if (player.channel && !player.noItems && !player.CCed)
				{
					float num46 = 1f;
					if (player.inventory[player.selectedItem].shoot == type)
					{
						num46 = player.inventory[player.selectedItem].shootSpeed;
					}
					Vector2 vec3 = Main.MouseWorld - vector;
					vec3.Normalize();
					if (vec3.HasNaNs())
					{
						vec3 = Vector2.UnitX * player.direction;
					}
					vec3 *= num46;
					if (vec3.X != velocity.X || vec3.Y != velocity.Y)
					{
						netUpdate = true;
					}
					velocity = vec3;
				}
				else
				{
					Kill();
				}
			}
			DelegateMethods.v3_1 = new Vector3(0.5f, 0.5f, 0.5f);
			Utils.PlotTileLine(base.Center - velocity, base.Center + velocity.SafeNormalize(Vector2.Zero) * 80f, 16f, DelegateMethods.CastLightOpen);
		}
		if (type == 600)
		{
			_ = ai[0];
			_ = 0f;
			ai[0] += 1f;
			if (Main.myPlayer == owner && ai[0] == 1f)
			{
				float num47 = player.inventory[player.selectedItem].shootSpeed * scale;
				Vector2 vector22 = vector;
				Vector2 value8 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector22;
				if (player.gravDir == -1f)
				{
					value8.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector22.Y;
				}
				Vector2 vector23 = Vector2.Normalize(value8);
				if (float.IsNaN(vector23.X) || float.IsNaN(vector23.Y))
				{
					vector23 = -Vector2.UnitY;
				}
				vector23 *= num47;
				if (vector23.X != velocity.X || vector23.Y != velocity.Y)
				{
					netUpdate = true;
				}
				velocity = vector23;
				int num48 = 601;
				float num49 = 3f;
				vector22 = base.Center;
				Vector2 vector24 = Vector2.Normalize(velocity) * num49;
				if (float.IsNaN(vector24.X) || float.IsNaN(vector24.Y))
				{
					vector24 = -Vector2.UnitY;
				}
				NewProjectile(GetProjectileSource_FromThis(), vector22.X, vector22.Y, vector24.X, vector24.Y, num48, damage, knockBack, owner, ai[1]);
			}
			if (ai[0] >= 30f)
			{
				Kill();
			}
		}
		if (type == 611)
		{
			if (Main.netMode != 2 && localAI[0] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item116, base.Center);
			}
			if (localAI[1] > 0f)
			{
				localAI[1] -= 1f;
			}
			alpha -= 42;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (localAI[0] == 0f)
			{
				localAI[0] = velocity.ToRotation();
			}
			float num50 = ((localAI[0].ToRotationVector2().X >= 0f) ? 1 : (-1));
			if (ai[1] <= 0f)
			{
				num50 *= -1f;
			}
			Vector2 spinningpoint5 = (num50 * (ai[0] / 30f * ((float)Math.PI * 2f) - (float)Math.PI / 2f)).ToRotationVector2();
			spinningpoint5.Y *= (float)Math.Sin(ai[1]);
			if (ai[1] <= 0f)
			{
				spinningpoint5.Y *= -1f;
			}
			spinningpoint5 = spinningpoint5.RotatedBy(localAI[0]);
			ai[0] += 1f;
			if (ai[0] < 30f)
			{
				velocity += 48f * spinningpoint5;
			}
			else
			{
				Kill();
			}
		}
		if (type == 615)
		{
			num = 0f;
			if (spriteDirection == -1)
			{
				num = (float)Math.PI;
			}
			ai[0] += 1f;
			int num51 = 0;
			if (ai[0] >= 40f)
			{
				num51++;
			}
			if (ai[0] >= 80f)
			{
				num51++;
			}
			if (ai[0] >= 120f)
			{
				num51++;
			}
			int num52 = 5;
			int num53 = 0;
			ai[1] -= 1f;
			bool flag11 = false;
			int num54 = -1;
			if (ai[1] <= 0f)
			{
				ai[1] = num52 - num53 * num51;
				flag11 = true;
				if ((int)ai[0] / (num52 - num53 * num51) % 7 == 0)
				{
					num54 = 0;
				}
			}
			frameCounter += 1 + num51;
			if (frameCounter >= 4)
			{
				frameCounter = 0;
				frame++;
				if (frame >= Main.projFrames[type])
				{
					frame = 0;
				}
			}
			if (soundDelay <= 0 && Main.player[owner].controlUseItem)
			{
				soundDelay = num52 - num53 * num51;
				SoundEngine.PlaySound(SoundID.Item36, position);
			}
			if (flag11 && Main.myPlayer == owner)
			{
				bool canShoot = player.channel && player.HasAmmo(player.inventory[player.selectedItem], canUse: true) && !player.noItems && !player.CCed;
				int projToShoot = 14;
				float speed = 14f;
				int Damage = player.GetWeaponDamage(player.inventory[player.selectedItem]);
				float KnockBack = player.inventory[player.selectedItem].knockBack;
				if (canShoot)
				{
					player.PickAmmo(player.inventory[player.selectedItem], ref projToShoot, ref speed, ref canShoot, ref Damage, ref KnockBack, out var usedAmmoItemId);
					IEntitySource projectileSource_Item_WithPotentialAmmo = player.GetProjectileSource_Item_WithPotentialAmmo(player.HeldItem, usedAmmoItemId);
					KnockBack = player.GetWeaponKnockback(player.inventory[player.selectedItem], KnockBack);
					float num55 = player.inventory[player.selectedItem].shootSpeed * scale;
					Vector2 vector25 = vector;
					Vector2 value9 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector25;
					if (player.gravDir == -1f)
					{
						value9.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector25.Y;
					}
					Vector2 spinningpoint6 = Vector2.Normalize(value9);
					if (float.IsNaN(spinningpoint6.X) || float.IsNaN(spinningpoint6.Y))
					{
						spinningpoint6 = -Vector2.UnitY;
					}
					spinningpoint6 *= num55;
					spinningpoint6 = spinningpoint6.RotatedBy(Main.rand.NextDouble() * 0.13089969754219055 - 0.06544984877109528);
					if (spinningpoint6.X != velocity.X || spinningpoint6.Y != velocity.Y)
					{
						netUpdate = true;
					}
					velocity = spinningpoint6;
					for (int n = 0; n < 1; n++)
					{
						Vector2 spinningpoint7 = Vector2.Normalize(velocity) * speed;
						spinningpoint7 = spinningpoint7.RotatedBy(Main.rand.NextDouble() * 0.19634954631328583 - 0.09817477315664291);
						if (float.IsNaN(spinningpoint7.X) || float.IsNaN(spinningpoint7.Y))
						{
							spinningpoint7 = -Vector2.UnitY;
						}
						NewProjectile(projectileSource_Item_WithPotentialAmmo, vector25.X, vector25.Y, spinningpoint7.X, spinningpoint7.Y, projToShoot, Damage, KnockBack, owner);
					}
					if (num54 == 0)
					{
						projToShoot = 616;
						speed = 8f;
						for (int num56 = 0; num56 < 1; num56++)
						{
							Vector2 spinningpoint8 = Vector2.Normalize(velocity) * speed;
							spinningpoint8 = spinningpoint8.RotatedBy(Main.rand.NextDouble() * 0.39269909262657166 - 0.19634954631328583);
							if (float.IsNaN(spinningpoint8.X) || float.IsNaN(spinningpoint8.Y))
							{
								spinningpoint8 = -Vector2.UnitY;
							}
							NewProjectile(projectileSource_Item_WithPotentialAmmo, vector25.X, vector25.Y, spinningpoint8.X, spinningpoint8.Y, projToShoot, Damage + 20, KnockBack * 1.25f, owner);
						}
					}
				}
				else
				{
					Kill();
				}
			}
		}
		if (type == 714)
		{
			num = 0f;
			if (spriteDirection == -1)
			{
				num = (float)Math.PI;
			}
			ai[0] += 1f;
			int num57 = 0;
			int num58 = 8;
			int num59 = 0;
			ai[1] -= 1f;
			bool flag12 = false;
			int num60 = -1;
			if (ai[1] <= 0f)
			{
				ai[1] = num58 - num59 * num57;
				flag12 = true;
				int num61 = (int)ai[0] / (num58 - num59 * num57);
				if (num61 % 7 == 0)
				{
					num60 = 0;
				}
				num60 = num61 % 7;
			}
			_ = rotation;
			Vector2 center3 = base.Center;
			_ = direction;
			Vector2 v = velocity;
			frameCounter += 1 + num57;
			if (frameCounter >= 4)
			{
				frameCounter = 0;
				frame++;
				if (frame >= Main.projFrames[type])
				{
					frame = 0;
				}
			}
			if (soundDelay <= 0 && Main.player[owner].controlUseItem)
			{
				soundDelay = num58 - num59 * num57;
				if (ai[0] != 1f)
				{
					SoundEngine.PlaySound(SoundID.Item156, position);
				}
			}
			if (flag12 && Main.myPlayer == owner)
			{
				bool canShoot2 = player.channel && player.HasAmmo(player.inventory[player.selectedItem], canUse: true) && !player.noItems && !player.CCed;
				int projToShoot2 = 134;
				float speed2 = 8f;
				int Damage2 = player.GetWeaponDamage(player.inventory[player.selectedItem]);
				float KnockBack2 = player.inventory[player.selectedItem].knockBack;
				if (num60 == 3)
				{
					speed2 += 1f;
				}
				if (canShoot2)
				{
					player.PickAmmo(player.inventory[player.selectedItem], ref projToShoot2, ref speed2, ref canShoot2, ref Damage2, ref KnockBack2, out var usedAmmoItemId2);
					KnockBack2 = player.GetWeaponKnockback(player.inventory[player.selectedItem], KnockBack2);
					IEntitySource projectileSource_Item_WithPotentialAmmo2 = player.GetProjectileSource_Item_WithPotentialAmmo(player.HeldItem, usedAmmoItemId2);
					float num62 = player.inventory[player.selectedItem].shootSpeed * scale;
					Vector2 vector26 = vector;
					Vector2 value10 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector26;
					if (player.gravDir == -1f)
					{
						value10.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector26.Y;
					}
					Vector2 spinningpoint9 = Vector2.Normalize(value10);
					if (float.IsNaN(spinningpoint9.X) || float.IsNaN(spinningpoint9.Y))
					{
						spinningpoint9 = -Vector2.UnitY;
					}
					spinningpoint9 *= num62;
					spinningpoint9 = spinningpoint9.RotatedBy((Main.rand.NextDouble() * 0.13089969754219055 - 0.06544984877109528) * 0.5);
					if (spinningpoint9.X != velocity.X || spinningpoint9.Y != velocity.Y)
					{
						netUpdate = true;
					}
					velocity = spinningpoint9;
					for (int num63 = 0; num63 < 1; num63++)
					{
						Vector2 spinningpoint10 = Vector2.Normalize(velocity) * speed2;
						spinningpoint10 = spinningpoint10.RotatedBy(Main.rand.NextDouble() * 0.19634954631328583 - 0.09817477315664291);
						if (float.IsNaN(spinningpoint10.X) || float.IsNaN(spinningpoint10.Y))
						{
							spinningpoint10 = -Vector2.UnitY;
						}
						NewProjectile(projectileSource_Item_WithPotentialAmmo2, vector26.X, vector26.Y, spinningpoint10.X, spinningpoint10.Y, projToShoot2, Damage2, KnockBack2, owner, num60);
						if (num60 == 5)
						{
							for (float num64 = -1f; num64 <= 1f; num64 += 2f)
							{
								Vector2 vector27 = spinningpoint10.RotatedBy((float)Math.PI * 2f * num64 * 1f / 80f);
								if (float.IsNaN(spinningpoint10.X) || float.IsNaN(spinningpoint10.Y))
								{
									vector27 = -Vector2.UnitY;
								}
								NewProjectile(projectileSource_Item_WithPotentialAmmo2, vector26.X, vector26.Y, vector27.X, vector27.Y, projToShoot2, Damage2, KnockBack2, owner, num60);
							}
						}
						if (num60 == 4)
						{
							NewProjectile(projectileSource_Item_WithPotentialAmmo2, vector26.X, vector26.Y, spinningpoint10.X, spinningpoint10.Y, projToShoot2, Damage2, KnockBack2, owner, num60, 1f);
						}
					}
				}
				else
				{
					Kill();
				}
			}
			Vector2 vector28 = base.Center + velocity.ToRotation().ToRotationVector2() * 40f;
			Vector2 vector29 = center3 + v.ToRotation().ToRotationVector2() * 40f;
			Color color = Main.hslToRgb(ai[0] / 90f % 1f, 1f, 0.5f);
			color.A = 120;
			int num65 = 267;
			Dust dust = Dust.NewDustPerfect(vector28, num65, Vector2.Zero);
			dust.color = color;
			dust.scale = 0.6f;
			dust.fadeIn = 0.9f;
			dust.noGravity = true;
			Dust dust2 = Dust.NewDustPerfect(vector28, num65, Vector2.Zero);
			dust2.color = color;
			dust2.scale = 0.6f;
			dust2.fadeIn = 0.7f;
			dust2.noGravity = true;
			dust2.velocity = -velocity.RotatedBy(2.094395160675049) / 10f;
			Dust dust3 = Dust.NewDustPerfect(vector28, num65, Vector2.Zero);
			dust3.color = color;
			dust3.scale = 0.6f;
			dust3.fadeIn = 0.7f;
			dust3.noGravity = true;
			dust3.velocity = -velocity.RotatedBy(-2.094395160675049) / 10f;
			if (vector28 != vector29)
			{
				float num66 = -1f;
				Dust dust4 = Dust.NewDustPerfect(Vector2.Lerp(vector28, vector29, 0.8f), num65, Vector2.Zero);
				dust4.velocity = (vector28 - vector29).SafeNormalize(Vector2.Zero) * 2f;
				dust4.color = color;
				dust4.scale = 0.6f;
				dust4.fadeIn = 0.9f;
				dust4.velocity *= num66;
				dust4.noGravity = true;
				Dust dust5 = Dust.NewDustPerfect(Vector2.Lerp(vector28, vector29, 0.5f), num65, Vector2.Zero);
				dust5.velocity = (vector28 - vector29).SafeNormalize(Vector2.Zero) * 2f;
				dust5.color = color;
				dust5.scale = 0.6f;
				dust5.fadeIn = 0.9f;
				dust5.velocity *= num66;
				dust5.noGravity = true;
				Dust dust6 = Dust.NewDustPerfect(Vector2.Lerp(vector28, vector29, 0.2f), num65, Vector2.Zero);
				dust6.velocity = (vector28 - vector29).SafeNormalize(Vector2.Zero) * 2f;
				dust6.color = color;
				dust6.scale = 0.6f;
				dust6.fadeIn = 0.9f;
				dust6.velocity *= num66;
				dust6.noGravity = true;
			}
		}
		if (type == 630)
		{
			num = 0f;
			if (spriteDirection == -1)
			{
				num = (float)Math.PI;
			}
			ai[0] += 1f;
			int num67 = 0;
			if (ai[0] >= 40f)
			{
				num67++;
			}
			if (ai[0] >= 80f)
			{
				num67++;
			}
			if (ai[0] >= 120f)
			{
				num67++;
			}
			int num68 = 24;
			int num69 = 2;
			ai[1] -= 1f;
			bool flag13 = false;
			if (ai[1] <= 0f)
			{
				ai[1] = num68 - num69 * num67;
				flag13 = true;
				_ = (int)ai[0] / (num68 - num69 * num67);
			}
			bool canShoot3 = player.channel && player.HasAmmo(player.inventory[player.selectedItem], canUse: true) && !player.noItems && !player.CCed;
			if (localAI[0] > 0f)
			{
				localAI[0] -= 1f;
			}
			if (soundDelay <= 0 && canShoot3)
			{
				soundDelay = num68 - num69 * num67;
				if (ai[0] != 1f)
				{
					SoundEngine.PlaySound(SoundID.Item5, position);
				}
				localAI[0] = 12f;
			}
			player.phantasmTime = 2;
			if (flag13 && Main.myPlayer == owner)
			{
				int projToShoot3 = 14;
				float speed3 = 14f;
				int Damage3 = player.GetWeaponDamage(player.inventory[player.selectedItem]);
				float KnockBack3 = player.inventory[player.selectedItem].knockBack;
				if (canShoot3)
				{
					player.PickAmmo(player.inventory[player.selectedItem], ref projToShoot3, ref speed3, ref canShoot3, ref Damage3, ref KnockBack3, out var usedAmmoItemId3);
					IEntitySource projectileSource_Item_WithPotentialAmmo3 = player.GetProjectileSource_Item_WithPotentialAmmo(player.HeldItem, usedAmmoItemId3);
					KnockBack3 = player.GetWeaponKnockback(player.inventory[player.selectedItem], KnockBack3);
					float num70 = player.inventory[player.selectedItem].shootSpeed * scale;
					Vector2 vector30 = vector;
					Vector2 value11 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector30;
					if (player.gravDir == -1f)
					{
						value11.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector30.Y;
					}
					Vector2 vector31 = Vector2.Normalize(value11);
					if (float.IsNaN(vector31.X) || float.IsNaN(vector31.Y))
					{
						vector31 = -Vector2.UnitY;
					}
					vector31 *= num70;
					if (vector31.X != velocity.X || vector31.Y != velocity.Y)
					{
						netUpdate = true;
					}
					velocity = vector31 * 0.55f;
					for (int num71 = 0; num71 < 4; num71++)
					{
						Vector2 vector32 = Vector2.Normalize(velocity) * speed3 * (0.6f + Main.rand.NextFloat() * 0.8f);
						if (float.IsNaN(vector32.X) || float.IsNaN(vector32.Y))
						{
							vector32 = -Vector2.UnitY;
						}
						Vector2 vector33 = vector30 + Utils.RandomVector2(Main.rand, -15f, 15f);
						int num72 = NewProjectile(projectileSource_Item_WithPotentialAmmo3, vector33.X, vector33.Y, vector32.X, vector32.Y, projToShoot3, Damage3, KnockBack3, owner);
						Main.projectile[num72].noDropItem = true;
					}
				}
				else
				{
					Kill();
				}
			}
		}
		if (type == 705)
		{
			num = 0f;
			if (spriteDirection == -1)
			{
				num = (float)Math.PI;
			}
			ai[0] += 1f;
			int itemAnimationMax = player.itemAnimationMax;
			ai[1] -= 1f;
			bool flag14 = false;
			if (ai[1] <= 0f)
			{
				ai[1] = itemAnimationMax;
				flag14 = true;
			}
			bool canShoot4 = player.channel && player.HasAmmo(player.inventory[player.selectedItem], canUse: true) && !player.noItems && !player.CCed;
			if (localAI[0] > 0f)
			{
				localAI[0] -= 1f;
			}
			if (soundDelay <= 0 && canShoot4)
			{
				soundDelay = itemAnimationMax;
				if (ai[0] != 1f)
				{
					SoundEngine.PlaySound(SoundID.Item5, position);
				}
				localAI[0] = 12f;
			}
			if (flag14 && Main.myPlayer == owner)
			{
				int projToShoot4 = 14;
				float speed4 = 12f;
				int Damage4 = player.GetWeaponDamage(player.inventory[player.selectedItem]);
				float KnockBack4 = player.inventory[player.selectedItem].knockBack;
				int num73 = 2;
				float num74 = 1.5f;
				if (canShoot4)
				{
					player.PickAmmo(player.inventory[player.selectedItem], ref projToShoot4, ref speed4, ref canShoot4, ref Damage4, ref KnockBack4, out var usedAmmoItemId4);
					IEntitySource projectileSource_Item_WithPotentialAmmo4 = player.GetProjectileSource_Item_WithPotentialAmmo(player.HeldItem, usedAmmoItemId4);
					KnockBack4 = player.GetWeaponKnockback(player.inventory[player.selectedItem], KnockBack4);
					if (projToShoot4 == 1)
					{
						projToShoot4 = 2;
					}
					if (++player.phantomPhoneixCounter >= 3)
					{
						player.phantomPhoneixCounter = 0;
						num73 = 1;
						Damage4 *= 2;
						num74 = 0f;
						ai[1] *= 1.5f;
						projToShoot4 = 706;
						speed4 = 16f;
					}
					float num75 = player.inventory[player.selectedItem].shootSpeed * scale;
					Vector2 vector34 = vector;
					Vector2 value12 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector34;
					if (player.gravDir == -1f)
					{
						value12.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector34.Y;
					}
					Vector2 vector35 = Vector2.Normalize(value12);
					if (float.IsNaN(vector35.X) || float.IsNaN(vector35.Y))
					{
						vector35 = -Vector2.UnitY;
					}
					vector35 *= num75;
					if (vector35.X != velocity.X || vector35.Y != velocity.Y)
					{
						netUpdate = true;
					}
					velocity = vector35 * 0.55f;
					for (int num76 = 0; num76 < num73; num76++)
					{
						Vector2 vector36 = Vector2.Normalize(velocity) * speed4;
						vector36 += Main.rand.NextVector2Square(0f - num74, num74);
						if (float.IsNaN(vector36.X) || float.IsNaN(vector36.Y))
						{
							vector36 = -Vector2.UnitY;
						}
						Vector2 vector37 = vector34;
						int num77 = NewProjectile(projectileSource_Item_WithPotentialAmmo4, vector37.X, vector37.Y, vector36.X, vector36.Y, projToShoot4, Damage4, KnockBack4, owner);
						Main.projectile[num77].noDropItem = true;
					}
				}
				else
				{
					Kill();
				}
			}
		}
		position = player.RotatedRelativePoint(mountedCenter) - base.Size / 2f;
		rotation = velocity.ToRotation() + num;
		spriteDirection = direction;
		timeLeft = 2;
		player.ChangeDir(direction);
		player.heldProj = whoAmI;
		player.SetDummyItemTime(num2);
		player.itemRotation = MathHelper.WrapAngle((float)Math.Atan2(velocity.Y * (float)direction, velocity.X * (float)direction) + num3);
		if (type == 460 || type == 611)
		{
			base.Center = Main.GetPlayerArmPosition(this, player) - velocity;
		}
		if (type == 615)
		{
			position.Y += player.gravDir * 2f;
		}
		if (type == 714)
		{
			position.Y += player.gravDir * 2f;
		}
		if (type == 611 && alpha == 0)
		{
			for (int num78 = 0; num78 < 2; num78++)
			{
				Dust obj = Main.dust[Dust.NewDust(position + velocity * 2f, width, height, 6, 0f, 0f, 100, Color.Transparent, 2f)];
				obj.noGravity = true;
				obj.velocity *= 2f;
				obj.velocity += localAI[0].ToRotationVector2();
				obj.fadeIn = 1.5f;
			}
			float num79 = 18f;
			for (int num80 = 0; (float)num80 < num79; num80++)
			{
				if (Main.rand.Next(4) == 0)
				{
					Vector2 vector38 = position + velocity + velocity * ((float)num80 / num79);
					Dust obj2 = Main.dust[Dust.NewDust(vector38, width, height, 6, 0f, 0f, 100, Color.Transparent)];
					obj2.noGravity = true;
					obj2.fadeIn = 0.5f;
					obj2.velocity += localAI[0].ToRotationVector2();
					obj2.noLight = true;
				}
			}
		}
		if (type == 927)
		{
			player.itemAnimation = num2 - (int)ai[0];
			localAI[0] = Main.rand.NextFloat() * 2.1474836E+09f - 1f;
		}
	}

	private void AI_099_1_Counterweights()
	{
		timeLeft = 6;
		bool flag = true;
		float num = 250f;
		float num2 = 0.1f;
		float num3 = 15f;
		float num4 = 12f;
		num *= 0.5f;
		num3 *= 0.8f;
		num4 *= 1.5f;
		float num5 = num3;
		if (owner == Main.myPlayer && ai[0] >= 0f)
		{
			bool flag2 = false;
			for (int i = 0; i < 1000; i++)
			{
				if (Main.projectile[i].active && Main.projectile[i].owner == owner && Main.projectile[i].aiStyle == 99 && Main.projectile[i].ai[0] >= -1f && (Main.projectile[i].type < 556 || Main.projectile[i].type > 561) && Main.projectile[i].type != 1079)
				{
					flag2 = true;
				}
			}
			if (!flag2)
			{
				ai[0] = -1f;
				netUpdate = true;
			}
		}
		if (Main.player[owner].yoyoString)
		{
			num += num * 0.25f + 10f;
		}
		rotation += 0.5f;
		if (Main.player[owner].dead)
		{
			Kill();
			return;
		}
		if (!flag)
		{
			Main.player[owner].heldProj = whoAmI;
			Main.player[owner].SetDummyItemTime(2);
			if (position.X + (float)(width / 2) > Main.player[owner].position.X + (float)(Main.player[owner].width / 2))
			{
				Main.player[owner].ChangeDir(1);
				direction = 1;
			}
			else
			{
				Main.player[owner].ChangeDir(-1);
				direction = -1;
			}
		}
		if (ai[0] == 0f || ai[0] == 1f)
		{
			if (ai[0] == 1f)
			{
				num *= 0.75f;
			}
			num4 *= 0.5f;
			bool flag3 = false;
			Vector2 vector = Main.player[owner].Center - base.Center;
			if ((double)vector.Length() > (double)num * 0.9 && ai[0] != -2f)
			{
				flag3 = true;
			}
			if (vector.Length() > num)
			{
				float num6 = vector.Length() - num;
				Vector2 vector2 = default(Vector2);
				vector2.X = vector.Y;
				vector2.Y = vector.X;
				vector.Normalize();
				vector *= num;
				position = Main.player[owner].Center - vector;
				position.X -= width / 2;
				position.Y -= height / 2;
				float num7 = velocity.Length();
				velocity = velocity.SafeNormalize(Vector2.Zero);
				if (num6 > num7 - 1f)
				{
					num6 = num7 - 1f;
				}
				velocity *= num7 - num6;
				num7 = velocity.Length();
				Vector2 vector3 = new Vector2(base.Center.X, base.Center.Y);
				Vector2 vector4 = new Vector2(Main.player[owner].Center.X, Main.player[owner].Center.Y);
				if (vector3.Y < vector4.Y)
				{
					vector2.Y = Math.Abs(vector2.Y);
				}
				else if (vector3.Y > vector4.Y)
				{
					vector2.Y = 0f - Math.Abs(vector2.Y);
				}
				if (vector3.X < vector4.X)
				{
					vector2.X = Math.Abs(vector2.X);
				}
				else if (vector3.X > vector4.X)
				{
					vector2.X = 0f - Math.Abs(vector2.X);
				}
				vector2.Normalize();
				vector2 *= velocity.Length();
				new Vector2(vector2.X, vector2.Y);
				if (Math.Abs(velocity.X) > Math.Abs(velocity.Y))
				{
					Vector2 v = velocity;
					v.Y += vector2.Y;
					v = v.SafeNormalize(Vector2.Zero);
					v *= velocity.Length();
					if ((double)Math.Abs(vector2.X) < 0.1 || (double)Math.Abs(vector2.Y) < 0.1)
					{
						velocity = v;
					}
					else
					{
						velocity = (v + velocity * 2f) / 3f;
					}
				}
				else
				{
					Vector2 v2 = velocity;
					v2.X += vector2.X;
					v2 = v2.SafeNormalize(Vector2.Zero);
					v2 *= velocity.Length();
					if ((double)Math.Abs(vector2.X) < 0.2 || (double)Math.Abs(vector2.Y) < 0.2)
					{
						velocity = v2;
					}
					else
					{
						velocity = (v2 + velocity * 2f) / 3f;
					}
				}
			}
			if (Main.myPlayer == owner)
			{
				if (Main.player[owner].channel)
				{
					Vector2 vector5 = new Vector2(Main.mouseX - Main.lastMouseX, Main.mouseY - Main.lastMouseY);
					if (velocity.X != 0f || velocity.Y != 0f)
					{
						if (flag)
						{
							vector5 *= -1f;
						}
						if (flag3)
						{
							if (base.Center.X < Main.player[owner].Center.X && vector5.X < 0f)
							{
								vector5.X = 0f;
							}
							if (base.Center.X > Main.player[owner].Center.X && vector5.X > 0f)
							{
								vector5.X = 0f;
							}
							if (base.Center.Y < Main.player[owner].Center.Y && vector5.Y < 0f)
							{
								vector5.Y = 0f;
							}
							if (base.Center.Y > Main.player[owner].Center.Y && vector5.Y > 0f)
							{
								vector5.Y = 0f;
							}
						}
						velocity += vector5 * num2;
						netUpdate = true;
					}
				}
				else
				{
					ai[0] = -1f;
					netUpdate = true;
				}
			}
			if (flag || type == 562 || type == 547 || type == 555 || type == 564 || type == 552 || type == 563 || type == 549 || type == 550 || type == 554 || type == 553 || type == 603 || type == 999)
			{
				float num8 = 800f;
				Vector2 v3 = default(Vector2);
				bool flag4 = false;
				if (type == 549)
				{
					num8 = 200f;
				}
				if (type == 554)
				{
					num8 = 400f;
				}
				if (type == 553)
				{
					num8 = 250f;
				}
				if (type == 603)
				{
					num8 = 320f;
				}
				for (int j = 0; j < Main.maxNPCs; j++)
				{
					if (Main.npc[j].CanBeChasedBy(this))
					{
						float num9 = Main.npc[j].position.X + (float)(Main.npc[j].width / 2);
						float num10 = Main.npc[j].position.Y + (float)(Main.npc[j].height / 2);
						float num11 = Math.Abs(position.X + (float)(width / 2) - num9) + Math.Abs(position.Y + (float)(height / 2) - num10);
						if (num11 < num8 && (type != 563 || !(num11 < 200f)) && Collision.CanHit(position, width, height, Main.npc[j].position, Main.npc[j].width, Main.npc[j].height) && (double)(Main.npc[j].Center - Main.player[owner].Center).Length() < (double)num * 0.9)
						{
							num8 = num11;
							v3.X = num9;
							v3.Y = num10;
							flag4 = true;
						}
					}
				}
				if (flag4)
				{
					v3 -= base.Center;
					v3 = v3.SafeNormalize(Vector2.Zero);
					if (type == 563)
					{
						v3 *= 4f;
						velocity = (velocity * 14f + v3) / 15f;
					}
					else if (type == 553)
					{
						v3 *= 5f;
						velocity = (velocity * 12f + v3) / 13f;
					}
					else if (type == 603)
					{
						v3 *= 16f;
						velocity = (velocity * 9f + v3) / 10f;
					}
					else if (type == 554)
					{
						v3 *= 8f;
						velocity = (velocity * 6f + v3) / 7f;
					}
					else
					{
						v3 *= 6f;
						velocity = (velocity * 7f + v3) / 8f;
					}
				}
			}
			if (velocity.Length() > num3)
			{
				velocity.Normalize();
				velocity *= num3;
			}
			if (velocity.Length() < num4)
			{
				velocity = velocity.SafeNormalize(Vector2.Zero);
				velocity *= num4;
			}
		}
		if (ai[0] == -1f && Main.player[owner].magicString)
		{
			ai[0] = -3f;
			if (Main.myPlayer == owner)
			{
				netUpdate = true;
				NewProjectile(GetProjectileSource_FromThis(), base.Center, velocity, type, (int)((double)damage * 0.75), (int)((double)knockBack * 0.75), owner, -2f);
			}
		}
		if (ai[0] == -3f)
		{
			alpha = 255;
			damage = 0;
		}
		if (ai[0] == -2f)
		{
			extraUpdates = 0;
			if (penetrate < 0)
			{
				penetrate = 1;
			}
			velocity.Y += 0.3f;
			if (velocity.Length() > 16f)
			{
				velocity.Normalize();
				velocity *= 16f;
			}
			else
			{
				if (!(velocity.Y <= 3f))
				{
					return;
				}
				if (num5 > 16f)
				{
					num5 = 16f;
				}
				if ((double)Math.Abs(velocity.X) < 0.1)
				{
					if (base.Center.X < Main.player[owner].Center.X)
					{
						velocity.X -= 0.1f;
						direction = -1;
					}
					else
					{
						velocity.X += 0.1f;
						direction = 1;
					}
				}
				else if (velocity.X > 0f && velocity.X < num5)
				{
					velocity.X += 0.1f;
				}
				else if (velocity.X < 0f && velocity.X > 0f - num5)
				{
					velocity.X -= 0.1f;
				}
			}
		}
		else
		{
			if (!(ai[0] < 0f))
			{
				return;
			}
			tileCollide = false;
			Vector2 vector6 = Main.player[owner].Center - base.Center;
			float num12 = vector6.Length();
			if (num12 < 40f || vector6.HasNaNs() || num12 > 2000f)
			{
				Kill();
				return;
			}
			float num13 = num3 * 1.5f;
			if (type == 546)
			{
				num13 *= 1.5f;
			}
			if (type == 554)
			{
				num13 *= 1.25f;
			}
			if (type == 555)
			{
				num13 *= 1.35f;
			}
			if (type == 562)
			{
				num13 *= 1.25f;
			}
			float num14 = 12f;
			vector6.Normalize();
			vector6 *= num13;
			velocity = (velocity * (num14 - 1f) + vector6) / num14;
		}
	}

	private void AI_099_2_Yoyos()
	{
		bool flag = false;
		for (int i = 0; i < whoAmI; i++)
		{
			if (Main.projectile[i].active && Main.projectile[i].owner == owner && Main.projectile[i].type == type && Main.projectile[i].ai[0] >= -1f)
			{
				flag = true;
			}
		}
		if (owner == Main.myPlayer)
		{
			localAI[0] += 1f;
			if (flag)
			{
				localAI[0] += (float)Main.rand.Next(10, 31) * 0.1f;
			}
			float num = localAI[0] / 60f;
			num /= (1f + Main.player[owner].meleeSpeed) / 2f;
			float num2 = ProjectileID.Sets.YoyosLifeTimeMultiplier[type];
			if (Main.player[Main.myPlayer].yoyoString && num2 > 0f)
			{
				num2 *= 1.5f;
			}
			if (ai[0] <= -2f)
			{
				num2 = -1f;
			}
			if (num2 != -1f && num > num2)
			{
				if (owner == Main.myPlayer)
				{
					for (int j = 0; j < 1000; j++)
					{
						if (Main.projectile[j].active && Main.projectile[j].aiStyle == aiStyle && Main.projectile[j].ai[0] >= 0f && Main.projectile[j].owner == owner)
						{
							Main.projectile[j].ai[0] = -1f;
							Main.projectile[j].netUpdate = true;
						}
					}
				}
				ai[0] = -1f;
			}
		}
		if (type == 603 && owner == Main.myPlayer && ai[0] != 3f)
		{
			localAI[1] += 1f;
			if (localAI[1] >= 6f)
			{
				float num3 = 400f;
				Vector2 v = velocity;
				Vector2 vector;
				do
				{
					vector = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
				}
				while (vector == Vector2.Zero);
				vector.Normalize();
				vector *= (float)Main.rand.Next(10, 41) * 0.1f;
				if (Main.rand.Next(3) == 0)
				{
					vector *= 2f;
				}
				v *= 0.25f;
				v += vector;
				for (int k = 0; k < Main.maxNPCs; k++)
				{
					if (Main.npc[k].CanBeChasedBy(this))
					{
						float num4 = Main.npc[k].position.X + (float)(Main.npc[k].width / 2);
						float num5 = Main.npc[k].position.Y + (float)(Main.npc[k].height / 2);
						float num6 = Math.Abs(position.X + (float)(width / 2) - num4) + Math.Abs(position.Y + (float)(height / 2) - num5);
						if (num6 < num3 && Collision.CanHit(position, width, height, Main.npc[k].position, Main.npc[k].width, Main.npc[k].height))
						{
							num3 = num6;
							v.X = num4;
							v.Y = num5;
							v -= base.Center;
							v = v.SafeNormalize(Vector2.Zero);
							v *= 8f;
						}
					}
				}
				v *= 0.8f;
				NewProjectile(GetProjectileSource_FromThis(), base.Center.X - v.X, base.Center.Y - v.Y, v.X, v.Y, 604, damage, knockBack, owner);
				localAI[1] = 0f;
			}
		}
		bool flag2 = false;
		if ((type >= 556 && type <= 561) || type == 1079)
		{
			flag2 = true;
		}
		if (Main.player[owner].dead)
		{
			Kill();
			return;
		}
		if (!flag2 && !flag && ai[0] != -2f)
		{
			Main.player[owner].heldProj = whoAmI;
			Main.player[owner].SetDummyItemTime(2);
			if (base.Center.X > Main.player[owner].Center.X + 2f)
			{
				Main.player[owner].ChangeDir(1);
				direction = 1;
			}
			else if (base.Center.X < Main.player[owner].Center.X - 2f)
			{
				Main.player[owner].ChangeDir(-1);
				direction = -1;
			}
		}
		else
		{
			drawLayer = 0;
		}
		if (velocity.HasNaNs())
		{
			Kill();
		}
		timeLeft = 6;
		float num7 = 10f;
		float num8 = 10f;
		float num9 = 3f;
		float num10 = 200f;
		num10 = ProjectileID.Sets.YoyosMaximumRange[type];
		num8 = ProjectileID.Sets.YoyosTopSpeed[type];
		if (type == 545)
		{
			if (Main.rand.Next(6) == 0)
			{
				int num11 = Dust.NewDust(position, width, height, 6);
				Main.dust[num11].noGravity = true;
			}
		}
		else if (type == 553 && Main.rand.Next(2) == 0)
		{
			int num12 = Dust.NewDust(position, width, height, 6);
			Main.dust[num12].noGravity = true;
			Main.dust[num12].scale = 1.6f;
		}
		if (Main.player[owner].yoyoString)
		{
			num10 = num10 * 1.25f + 30f;
		}
		num10 /= (1f + Main.player[owner].meleeSpeed * 3f) / 4f;
		num8 /= (1f + Main.player[owner].meleeSpeed * 3f) / 4f;
		num7 = 14f - num8 / 2f;
		if (num7 < 1f)
		{
			num7 = 1f;
		}
		num9 = 5f + num8 / 2f;
		if (flag)
		{
			num9 += 20f;
		}
		if (ai[0] >= 0f)
		{
			if (velocity.Length() > num8)
			{
				velocity *= 0.98f;
			}
			bool flag3 = false;
			bool flag4 = false;
			if (ai[0] != -2f)
			{
				Vector2 vector2 = Main.player[owner].Center - base.Center;
				if (vector2.Length() > num10)
				{
					flag3 = true;
					if ((double)vector2.Length() > (double)num10 * 1.3)
					{
						flag4 = true;
					}
				}
			}
			if (owner == Main.myPlayer)
			{
				if (!Main.player[owner].channel || Main.player[owner].stoned || Main.player[owner].frozen)
				{
					ai[0] = -1f;
					ai[1] = 0f;
					netUpdate = true;
				}
				else
				{
					Vector2 vector3 = Main.ReverseGravitySupport(Main.MouseScreen) + Main.screenPosition;
					float x = vector3.X;
					float y = vector3.Y;
					Vector2 vector4 = new Vector2(x, y) - Main.player[owner].Center;
					if (vector4.Length() > num10)
					{
						vector4.Normalize();
						vector4 *= num10;
						vector4 = Main.player[owner].Center + vector4;
						x = vector4.X;
						y = vector4.Y;
					}
					if (ai[0] != x || ai[1] != y)
					{
						Vector2 vector5 = new Vector2(x, y) - Main.player[owner].Center;
						if (vector5.Length() > num10 - 1f)
						{
							vector5.Normalize();
							vector5 *= num10 - 1f;
							Vector2 vector6 = Main.player[owner].Center + vector5;
							x = vector6.X;
							y = vector6.Y;
						}
						ai[0] = x;
						ai[1] = y;
						netUpdate = true;
					}
				}
			}
			if (flag4 && owner == Main.myPlayer)
			{
				ai[0] = -1f;
				netUpdate = true;
			}
			if (ai[0] >= 0f)
			{
				if (flag3)
				{
					num7 /= 2f;
					num8 *= 2f;
					if (base.Center.X > Main.player[owner].Center.X && velocity.X > 0f)
					{
						velocity.X *= 0.5f;
					}
					if (base.Center.Y > Main.player[owner].Center.Y && velocity.Y > 0f)
					{
						velocity.Y *= 0.5f;
					}
					if (base.Center.X < Main.player[owner].Center.X && velocity.X < 0f)
					{
						velocity.X *= 0.5f;
					}
					if (base.Center.Y < Main.player[owner].Center.Y && velocity.Y < 0f)
					{
						velocity.Y *= 0.5f;
					}
				}
				Vector2 vector7 = new Vector2(ai[0], ai[1]) - base.Center;
				if (flag3)
				{
					num7 = 1f;
				}
				velocity.Length();
				float num13 = vector7.Length();
				if (num13 > num9)
				{
					vector7.Normalize();
					float num14 = Math.Min(num13 / 2f, num8);
					if (flag3)
					{
						num14 = Math.Min(num14, num8 / 2f);
					}
					vector7 *= num14;
					velocity = (velocity * (num7 - 1f) + vector7) / num7;
				}
				else if (flag)
				{
					if ((double)velocity.Length() < (double)num8 * 0.6)
					{
						vector7 = velocity;
						vector7 = vector7.SafeNormalize(Vector2.Zero);
						vector7 *= num8 * 0.6f;
						velocity = (velocity * (num7 - 1f) + vector7) / num7;
					}
				}
				else
				{
					velocity *= 0.8f;
				}
				if (flag && !flag3 && (double)velocity.Length() < (double)num8 * 0.6)
				{
					velocity = velocity.SafeNormalize(Vector2.Zero);
					velocity *= num8 * 0.6f;
				}
			}
		}
		if (ai[0] == -1f && Main.player[owner].magicString)
		{
			ai[0] = -3f;
			if (Main.myPlayer == owner)
			{
				netUpdate = true;
				NewProjectile(GetProjectileSource_FromThis(), base.Center, velocity, type, (int)((double)damage * 0.75), (int)((double)knockBack * 0.75), owner, -2f);
			}
		}
		if (ai[0] == -3f)
		{
			alpha = 255;
			damage = 0;
		}
		if (ai[0] == -2f)
		{
			if (penetrate < 0)
			{
				penetrate = Main.rand.Next(3, 7);
			}
			velocity.Y += 0.3f;
			if (velocity.Length() > 16f)
			{
				velocity.Normalize();
				velocity *= 16f;
			}
			else if (velocity.Y <= 3f)
			{
				if (num8 > 16f)
				{
					num8 = 16f;
				}
				if ((double)Math.Abs(velocity.X) < 0.1)
				{
					if (base.Center.X < Main.player[owner].Center.X)
					{
						velocity.X -= 0.1f;
						direction = -1;
					}
					else
					{
						velocity.X += 0.1f;
						direction = 1;
					}
				}
				else if (velocity.X > 0f && velocity.X < num8)
				{
					velocity.X += 0.1f;
				}
				else if (velocity.X < 0f && velocity.X > 0f - num8)
				{
					velocity.X -= 0.1f;
				}
			}
		}
		else if (ai[0] < 0f)
		{
			num7 = (int)((double)num7 * 0.8);
			num8 *= 1.5f;
			tileCollide = false;
			Vector2 vector8 = Main.player[owner].Center - base.Center;
			float num15 = vector8.Length();
			if (num15 < num8 + 10f || num15 == 0f || num15 > 2000f)
			{
				Kill();
			}
			else
			{
				vector8.Normalize();
				vector8 *= num8;
				velocity = (velocity * (num7 - 1f) + vector8) / num7;
			}
		}
		if (ai[0] == -2f)
		{
			rotation += 0.45f * (float)direction;
		}
		else
		{
			rotation += 0.45f;
		}
		AI_AdjustPlayerItemRotationToFaceProjectile();
	}

	private void AI_130_FlameBurstTower()
	{
		float num = 900f;
		float angleRatioMax = 1f;
		Vector2 vector = base.Center;
		int num2 = 664;
		int num3 = 12;
		float num4 = 12f;
		int num5 = 1;
		int num6 = 6;
		int num7 = 4;
		int num8 = 80;
		switch (type)
		{
		case 663:
		{
			Lighting.AddLight(base.Center, new Vector3(0.4f, 0.2f, 0.1f));
			Lighting.AddLight(base.Bottom + new Vector2(0f, -10f), new Vector3(0.4f, 0.2f, 0.1f));
			vector = base.Bottom + new Vector2(direction * 6, -40f);
			if ((localAI[0] += 1f) >= 300f)
			{
				localAI[0] = 0f;
			}
			Rectangle r3 = new Rectangle((int)position.X + width / 4, (int)position.Y + height - 16, width / 4 * 3, 6);
			if (direction == 1)
			{
				r3.X -= width / 4;
			}
			for (int m = 0; m < 1; m++)
			{
				if (Main.rand.Next(2) == 0)
				{
					Dust dust5 = Dust.NewDustDirect(r3.TopLeft() + new Vector2(-2f, -2f), r3.Width + 4, r3.Height + 4, 270, -direction * 2, -2f, 200, new Color(255, 255, 255, 0));
					dust5.fadeIn = 0.6f + Main.rand.NextFloat() * 0.6f;
					dust5.scale = 0.4f;
					dust5.noGravity = true;
					dust5.noLight = true;
					dust5.velocity = Vector2.Zero;
					dust5.velocity.X = (float)(-direction) * Main.rand.NextFloat() * dust5.fadeIn;
				}
			}
			r3 = new Rectangle((int)base.Center.X, (int)base.Bottom.Y, width / 4, 10);
			if (direction == -1)
			{
				r3.X -= r3.Width;
			}
			r3.X += direction * 4;
			r3.Y -= height - 10;
			for (int n = 0; n < 1; n++)
			{
				if (Main.rand.Next(5) == 0)
				{
					Dust dust6 = Dust.NewDustDirect(r3.TopLeft(), r3.Width, r3.Height, 6);
					dust6.fadeIn = 1f;
					dust6.scale = 1f;
					dust6.noGravity = true;
					dust6.noLight = true;
					dust6.velocity *= 2f;
				}
			}
			break;
		}
		case 665:
		{
			Lighting.AddLight(base.Center, new Vector3(0.4f, 0.2f, 0.1f) * 1.2f);
			Lighting.AddLight(base.Bottom + new Vector2(0f, -10f), new Vector3(0.4f, 0.2f, 0.1f) * 1.2f);
			num8 = 70;
			num4 += 3f;
			num6 = 8;
			num2 = 666;
			vector = base.Bottom + new Vector2(direction * 6, -44f);
			if ((localAI[0] += 1f) >= 300f)
			{
				localAI[0] = 0f;
			}
			Rectangle r2 = new Rectangle((int)position.X + width / 4, (int)position.Y + height - 16, width / 4 * 2, 6);
			if (direction == 1)
			{
				r2.X -= width / 4;
			}
			for (int k = 0; k < 1; k++)
			{
				if (Main.rand.Next(2) == 0)
				{
					Dust dust3 = Dust.NewDustDirect(r2.TopLeft() + new Vector2(-2f, -2f), r2.Width + 4, r2.Height + 4, 270, -direction * 2, -2f, 200, new Color(255, 255, 255, 0));
					dust3.fadeIn = 0.6f + Main.rand.NextFloat() * 0.6f;
					dust3.scale = 0.4f;
					dust3.noGravity = true;
					dust3.noLight = true;
					dust3.velocity = Vector2.Zero;
					dust3.velocity.X = (float)(-direction) * Main.rand.NextFloat() * dust3.fadeIn;
				}
			}
			r2 = new Rectangle((int)base.Center.X, (int)base.Bottom.Y, width / 4, 10);
			if (direction == -1)
			{
				r2.X -= r2.Width;
			}
			r2.X += direction * 4;
			r2.Y -= height - 10;
			for (int l = 0; l < 2; l++)
			{
				if (Main.rand.Next(5) == 0)
				{
					Dust dust4 = Dust.NewDustDirect(r2.TopLeft(), r2.Width, r2.Height, 6);
					dust4.fadeIn = 1f;
					dust4.scale = 1f;
					dust4.noGravity = true;
					dust4.noLight = true;
					dust4.velocity *= 2f;
				}
			}
			break;
		}
		case 667:
		{
			Lighting.AddLight(base.Center, new Vector3(0.4f, 0.2f, 0.1f) * 1.5f);
			Lighting.AddLight(base.Bottom + new Vector2(0f, -10f), new Vector3(0.4f, 0.2f, 0.1f) * 1.5f);
			num8 = 60;
			num4 += 6f;
			num6 = 8;
			num2 = 668;
			vector = base.Bottom + new Vector2(direction * 6, -46f);
			if ((localAI[0] += 1f) >= 300f)
			{
				localAI[0] = 0f;
			}
			Rectangle r = new Rectangle((int)position.X + width / 4, (int)position.Y + height - 16, width / 4 * 2, 6);
			if (direction == 1)
			{
				r.X -= width / 4;
			}
			for (int i = 0; i < 1; i++)
			{
				if (Main.rand.Next(2) == 0)
				{
					Dust dust = Dust.NewDustDirect(r.TopLeft() + new Vector2(-2f, -2f), r.Width + 4, r.Height + 4, 270, -direction * 2, -2f, 200, new Color(255, 255, 255, 0));
					dust.fadeIn = 0.6f + Main.rand.NextFloat() * 0.6f;
					dust.scale = 0.4f;
					dust.noGravity = true;
					dust.noLight = true;
					dust.velocity = Vector2.Zero;
					dust.velocity.X = (float)(-direction) * Main.rand.NextFloat() * dust.fadeIn;
				}
			}
			r = new Rectangle((int)base.Center.X, (int)base.Bottom.Y, width / 4, 10);
			if (direction == -1)
			{
				r.X -= r.Width;
			}
			r.X += direction * 4;
			r.Y -= height - 10;
			for (int j = 0; j < 3; j++)
			{
				if (Main.rand.Next(5) == 0)
				{
					Dust dust2 = Dust.NewDustDirect(r.TopLeft(), r.Width, r.Height, 6);
					dust2.fadeIn = 1.1f;
					dust2.scale = 1f;
					dust2.noGravity = true;
					dust2.noLight = true;
					dust2.velocity *= 2.4f;
				}
			}
			break;
		}
		}
		if (Main.player[owner].setApprenticeT2)
		{
			angleRatioMax = 0.1f;
			num *= 1.5f;
			num4 *= 1.4f;
		}
		if (ai[0] == 0f)
		{
			direction = (spriteDirection = Main.player[owner].direction);
			ai[0] = 1f;
			ai[1] = 0f;
			netUpdate = true;
		}
		if (ai[0] == 1f)
		{
			frame = 0;
			bool flag = false;
			if (ai[1] > 0f)
			{
				ai[1] -= 1f;
			}
			else
			{
				flag = true;
			}
			if (flag && owner == Main.myPlayer)
			{
				int num9 = AI_130_FlameBurstTower_FindTarget(num, angleRatioMax, vector);
				if (num9 != -1)
				{
					direction = Math.Sign(DirectionTo(Main.npc[num9].Center).X);
					ai[0] = 2f;
					ai[1] = 0f;
					netUpdate = true;
				}
			}
		}
		else if (ai[0] == 2f)
		{
			frame = num5 + (int)(ai[1] / (float)num7);
			if (ai[1] == (float)num3)
			{
				Vector2 vector2 = new Vector2(direction, 0f);
				int num10 = AI_130_FlameBurstTower_FindTarget(num, angleRatioMax, vector, canChangeDirection: false);
				if (num10 != -1)
				{
					vector2 = (Main.npc[num10].Center - vector).SafeNormalize(Vector2.UnitX * direction);
				}
				Vector2 vector3 = vector2 * num4;
				if (owner == Main.myPlayer)
				{
					NewProjectile(GetProjectileSource_FromThis(), vector, vector3, num2, damage, knockBack, owner);
				}
			}
			if ((ai[1] += 1f) >= (float)(num6 * num7))
			{
				ai[0] = 1f;
				ai[1] = num8;
			}
		}
		spriteDirection = direction;
		tileCollide = true;
		velocity.Y += 0.2f;
	}

	private int AI_130_FlameBurstTower_FindTarget(float shot_range, float angleRatioMax, Vector2 shootingSpot, bool canChangeDirection = true)
	{
		int num = -1;
		NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
		if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this))
		{
			for (int i = 0; i < 1; i++)
			{
				if (!ownerMinionAttackTargetNPC.CanBeChasedBy(this))
				{
					continue;
				}
				float num2 = Vector2.Distance(shootingSpot, ownerMinionAttackTargetNPC.Center);
				if (!(num2 > shot_range))
				{
					Vector2 vector = (ownerMinionAttackTargetNPC.Center - shootingSpot).SafeNormalize(Vector2.UnitY);
					if (!(Math.Abs(vector.X) < Math.Abs(vector.Y) * angleRatioMax) && (canChangeDirection || !((float)direction * vector.X < 0f)) && (num == -1 || num2 < Vector2.Distance(shootingSpot, Main.npc[num].Center)) && Collision.CanHitLine(shootingSpot, 0, 0, ownerMinionAttackTargetNPC.Center, 0, 0))
					{
						num = ownerMinionAttackTargetNPC.whoAmI;
					}
				}
			}
			if (num != -1)
			{
				return num;
			}
		}
		for (int j = 0; j < Main.maxNPCs; j++)
		{
			NPC nPC = Main.npc[j];
			if (!nPC.CanBeChasedBy(this))
			{
				continue;
			}
			float num3 = Vector2.Distance(shootingSpot, nPC.Center);
			if (!(num3 > shot_range))
			{
				Vector2 vector2 = (nPC.Center - shootingSpot).SafeNormalize(Vector2.UnitY);
				if (!(Math.Abs(vector2.X) < Math.Abs(vector2.Y) * angleRatioMax) && (canChangeDirection || !((float)direction * vector2.X < 0f)) && (num == -1 || num3 < Vector2.Distance(shootingSpot, Main.npc[num].Center)) && Collision.CanHitLine(shootingSpot, 0, 0, nPC.Center, 0, 0))
				{
					num = j;
				}
			}
		}
		return num;
	}

	private int AI_134_Ballista_FindTarget(float shot_range, float deadBottomAngle, Vector2 shootingSpot)
	{
		int num = -1;
		NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
		if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this))
		{
			for (int i = 0; i < 1; i++)
			{
				if (!ownerMinionAttackTargetNPC.CanBeChasedBy(this))
				{
					continue;
				}
				float num2 = Vector2.Distance(shootingSpot, ownerMinionAttackTargetNPC.Center);
				if (!(num2 > shot_range))
				{
					Vector2 vector = (ownerMinionAttackTargetNPC.Center - shootingSpot).SafeNormalize(Vector2.UnitY);
					if ((!(Math.Abs(vector.X) < Math.Abs(vector.Y) * deadBottomAngle) || !(vector.Y > 0f)) && (num == -1 || num2 < Vector2.Distance(shootingSpot, Main.npc[num].Center)) && Collision.CanHitLine(shootingSpot, 0, 0, ownerMinionAttackTargetNPC.Center, 0, 0))
					{
						num = ownerMinionAttackTargetNPC.whoAmI;
					}
				}
			}
			if (num != -1)
			{
				return num;
			}
		}
		for (int j = 0; j < Main.maxNPCs; j++)
		{
			NPC nPC = Main.npc[j];
			if (!nPC.CanBeChasedBy(this))
			{
				continue;
			}
			float num3 = Vector2.Distance(shootingSpot, nPC.Center);
			if (!(num3 > shot_range))
			{
				Vector2 vector2 = (nPC.Center - shootingSpot).SafeNormalize(Vector2.UnitY);
				if ((!(Math.Abs(vector2.X) < Math.Abs(vector2.Y) * deadBottomAngle) || !(vector2.Y > 0f)) && (num == -1 || num3 < Vector2.Distance(shootingSpot, Main.npc[num].Center)) && Collision.CanHitLine(shootingSpot, 0, 0, nPC.Center, 0, 0))
				{
					num = j;
				}
			}
		}
		return num;
	}

	private void AI_131_FlameBurstShot()
	{
		if (type != 664 && type != 666 && type != 668)
		{
			return;
		}
		if (localAI[0] == 0f)
		{
			localAI[0] = 1f;
			localAI[1] = SoundEngine.PlayTrackedSound(SoundID.DD2_FlameburstTowerShot, base.Center).ToFloat();
		}
		ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]));
		if (activeSound == null)
		{
			localAI[1] = SlotId.Invalid.ToFloat();
		}
		else
		{
			activeSound.Position = base.Center;
		}
		if (alpha > 0)
		{
			alpha -= 25;
			if (alpha < 0)
			{
				alpha = 0;
			}
		}
		int num = 1;
		if (type == 666)
		{
			num = 2;
		}
		if (type == 668)
		{
			num = 3;
		}
		for (int i = 0; i < num; i++)
		{
			if (Main.rand.Next(2) != 0)
			{
				Dust dust = Dust.NewDustDirect(position, width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
				dust.noGravity = true;
				dust.velocity *= 0.3f;
				if (Main.rand.Next(1) == 0)
				{
					dust.velocity.Y += (float)Math.Sign(dust.velocity.Y) * 1.2f;
					dust.fadeIn += 0.5f;
				}
			}
		}
		rotation = velocity.ToRotation() + (float)Math.PI / 2f;
	}

	private void AI_134_Ballista()
	{
		float shot_range = 900f;
		float deadBottomAngle = 0.75f;
		Vector2 center = base.Center;
		int num = 680;
		int num2 = 12;
		float num3 = 16f;
		int num4 = 1;
		int num5 = 5;
		int num6 = 5;
		if (Main.player[owner].setSquireT2)
		{
			num3 = 21f;
		}
		int ballistraShotDelay = GetBallistraShotDelay(Main.player[owner]);
		num2 = num6;
		int num7 = type;
		if (num7 == 677)
		{
			center.Y -= 4f;
		}
		if (ai[0] == 0f)
		{
			direction = (spriteDirection = Main.player[owner].direction);
			ai[0] = 1f;
			ai[1] = 0f;
			netUpdate = true;
			if (direction == -1)
			{
				rotation = (float)Math.PI;
			}
		}
		if (ai[0] == 1f)
		{
			frame = 0;
			bool flag = false;
			if (Main.player[owner].ballistaPanic && ai[1] > 60f)
			{
				ai[1] = 60f;
			}
			if (Main.player[owner].ballistaPanic && Main.player[owner].setSquireT3 && ai[1] > 30f)
			{
				ai[1] = 30f;
			}
			if (ai[1] > 0f)
			{
				ai[1] -= 1f;
			}
			else
			{
				flag = true;
			}
			int num8 = AI_134_Ballista_FindTarget(shot_range, deadBottomAngle, center);
			if (num8 != -1)
			{
				Vector2 v = (v = (Main.npc[num8].Center - center).SafeNormalize(Vector2.UnitY));
				rotation = rotation.AngleLerp(v.ToRotation(), 0.08f);
				if (rotation > (float)Math.PI / 2f || rotation < -(float)Math.PI / 2f)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
				if (flag && owner == Main.myPlayer)
				{
					direction = Math.Sign(v.X);
					ai[0] = 2f;
					ai[1] = 0f;
					netUpdate = true;
				}
			}
			else
			{
				float targetAngle = 0f;
				if (direction == -1)
				{
					targetAngle = (float)Math.PI;
				}
				rotation = rotation.AngleLerp(targetAngle, 0.05f);
			}
		}
		else if (ai[0] == 2f)
		{
			frame = num4 + (int)(ai[1] / (float)num6);
			if (ai[1] == (float)num2)
			{
				SoundEngine.PlayTrackedSound(SoundID.DD2_BallistaTowerShot, base.Center);
				Vector2 vector = new Vector2(direction, 0f);
				int num9 = AI_134_Ballista_FindTarget(shot_range, deadBottomAngle, center);
				if (num9 != -1)
				{
					vector = (Main.npc[num9].Center - center).SafeNormalize(Vector2.UnitX * direction);
				}
				rotation = vector.ToRotation();
				if (rotation > (float)Math.PI / 2f || rotation < -(float)Math.PI / 2f)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
				Vector2 vector2 = vector * num3;
				if (owner == Main.myPlayer)
				{
					NewProjectile(GetProjectileSource_FromThis(), center, vector2, num, damage, knockBack, owner);
				}
			}
			if ((ai[1] += 1f) >= (float)(num5 * num6))
			{
				ai[0] = 1f;
				ai[1] = ballistraShotDelay;
			}
		}
		spriteDirection = direction;
		tileCollide = true;
		velocity.Y += 0.2f;
	}

	public static int GetBallistraShotDelay(Player player)
	{
		int result = 160;
		if (player.setSquireT3)
		{
			result = 100;
		}
		if (player.ballistaPanic)
		{
			result = 60;
		}
		if (player.ballistaPanic && player.setSquireT3)
		{
			result = 30;
		}
		return result;
	}

	private void AI_135_OgreStomp()
	{
		float num = 40f;
		if (type == 922)
		{
			num = 30f;
		}
		ai[0] += 1f;
		if (ai[0] > 9f)
		{
			Kill();
			return;
		}
		velocity = Vector2.Zero;
		position = base.Center;
		base.Size = new Vector2(16f, 16f) * MathHelper.Lerp(5f, num, Utils.GetLerpValue(0f, 9f, ai[0]));
		base.Center = position;
		Point point = base.TopLeft.ToTileCoordinates();
		Point point2 = base.BottomRight.ToTileCoordinates();
		int num2 = point.X / 2 + point2.X / 2;
		int num3 = width / 2;
		if ((int)ai[0] % 3 != 0)
		{
			return;
		}
		int num4 = (int)ai[0] / 3;
		for (int i = point.X; i <= point2.X; i++)
		{
			for (int j = point.Y; j <= point2.Y; j++)
			{
				if (Vector2.Distance(base.Center, new Vector2(i * 16, j * 16)) > (float)num3)
				{
					continue;
				}
				Tile tileSafely = Framing.GetTileSafely(i, j);
				if (!tileSafely.active() || !Main.tileSolid[tileSafely.type] || Main.tileSolidTop[tileSafely.type] || Main.tileFrameImportant[tileSafely.type])
				{
					continue;
				}
				Tile tileSafely2 = Framing.GetTileSafely(i, j - 1);
				if (tileSafely2.active() && Main.tileSolid[tileSafely2.type] && !Main.tileSolidTop[tileSafely2.type])
				{
					continue;
				}
				int num5 = WorldGen.KillTile_GetTileDustAmount(fail: true, tileSafely);
				for (int k = 0; k < num5; k++)
				{
					Dust obj = Main.dust[WorldGen.KillTile_MakeTileDust(i, j, tileSafely)];
					obj.velocity.Y -= 3f + (float)num4 * 1.5f;
					obj.velocity.Y *= Main.rand.NextFloat();
					obj.velocity.Y *= 0.75f;
					obj.scale += (float)num4 * 0.03f;
				}
				if (num4 >= 2)
				{
					if (type == 922)
					{
						Color newColor = NPC.AI_121_QueenSlime_GetDustColor();
						newColor.A = 150;
						for (int l = 0; l < num5 - 1; l++)
						{
							int num6 = Dust.NewDust(position, 12, 12, 4, 0f, 0f, 50, newColor, 1.5f);
							Main.dust[num6].velocity.Y -= 0.1f + (float)num4 * 0.5f;
							Main.dust[num6].velocity.Y *= Main.rand.NextFloat();
							Main.dust[num6].velocity.X *= Main.rand.NextFloatDirection() * 3f;
							Main.dust[num6].position = new Vector2(i * 16 + Main.rand.Next(16), j * 16 + Main.rand.Next(16));
							if (Main.rand.Next(3) != 0)
							{
								Main.dust[num6].velocity *= 0.5f;
								Main.dust[num6].noGravity = true;
							}
						}
					}
					else
					{
						for (int m = 0; m < num5 - 1; m++)
						{
							Dust obj2 = Main.dust[WorldGen.KillTile_MakeTileDust(i, j, tileSafely)];
							obj2.velocity.Y -= 1f + (float)num4;
							obj2.velocity.Y *= Main.rand.NextFloat();
							obj2.velocity.Y *= 0.75f;
						}
					}
				}
				if (num5 <= 0 || Main.rand.Next(3) == 0)
				{
					continue;
				}
				float num7 = (float)Math.Abs(num2 - i) / (num / 2f);
				if (type == 922)
				{
					Color newColor2 = NPC.AI_121_QueenSlime_GetDustColor();
					newColor2.A = 150;
					for (int n = 0; n < 3; n++)
					{
						int num8 = Dust.NewDust(position, width, height, 31, 0f, 0f, 50, newColor2, 2f - (float)num4 * 0.15f + num7 * 0.5f);
						Main.dust[num8].velocity.Y -= 0.1f + (float)num4 * 0.5f + num7 * (float)num4 * 1f;
						Main.dust[num8].velocity.Y *= Main.rand.NextFloat();
						Main.dust[num8].velocity.X *= Main.rand.NextFloatDirection() * 3f;
						Main.dust[num8].position = new Vector2(i * 16 + 20, j * 16 + 20);
						if (Main.rand.Next(3) != 0)
						{
							Main.dust[num8].velocity *= 0.5f;
							Main.dust[num8].noGravity = true;
						}
					}
				}
				else
				{
					Gore gore = Gore.NewGoreDirect(position, Vector2.Zero, 61 + Main.rand.Next(3), 1f - (float)num4 * 0.15f + num7 * 0.5f);
					gore.velocity.Y -= 0.1f + (float)num4 * 0.5f + num7 * (float)num4 * 1f;
					gore.velocity.Y *= Main.rand.NextFloat();
					gore.position = new Vector2(i * 16 + 20, j * 16 + 20);
				}
			}
		}
	}

	private void AI_136_BetsyBreath()
	{
		if (ai[1] < 0f || ai[1] > (float)Main.maxNPCs)
		{
			Kill();
			return;
		}
		NPC nPC = Main.npc[(int)ai[1]];
		float num = -8f;
		Vector2 center = nPC.Center + new Vector2((110f + num) * (float)nPC.spriteDirection, 30f).RotatedBy(nPC.rotation);
		base.Center = center;
		rotation = nPC.DirectionTo(base.Center).ToRotation();
		DelegateMethods.v3_1 = new Vector3(1.2f, 1f, 0.3f);
		float num2 = ai[0] / 40f;
		if (num2 > 1f)
		{
			num2 = 1f;
		}
		float num3 = (ai[0] - 38f) / 40f;
		if (num3 < 0f)
		{
			num3 = 0f;
		}
		Utils.PlotTileLine(base.Center + rotation.ToRotationVector2() * 400f * num3, base.Center + rotation.ToRotationVector2() * 400f * num2, 16f, DelegateMethods.CastLight);
		Utils.PlotTileLine(base.Center + rotation.ToRotationVector2().RotatedBy(0.19634954631328583) * 400f * num3, base.Center + rotation.ToRotationVector2().RotatedBy(0.19634954631328583) * 400f * num2, 16f, DelegateMethods.CastLight);
		Utils.PlotTileLine(base.Center + rotation.ToRotationVector2().RotatedBy(-0.19634954631328583) * 400f * num3, base.Center + rotation.ToRotationVector2().RotatedBy(-0.19634954631328583) * 400f * num2, 16f, DelegateMethods.CastLight);
		if (num3 == 0f && num2 > 0.1f)
		{
			for (int i = 0; i < 3; i++)
			{
				Dust dust = Dust.NewDustDirect(position, width, height, 6);
				dust.fadeIn = 1.5f;
				dust.velocity = rotation.ToRotationVector2().RotatedBy(Main.rand.NextFloatDirection() * ((float)Math.PI / 12f)) * (0.5f + Main.rand.NextFloat() * 2.5f) * 15f;
				dust.velocity += nPC.velocity * 2f;
				dust.noLight = true;
				dust.noGravity = true;
				dust.alpha = 200;
			}
		}
		if (Main.rand.Next(5) == 0 && ai[0] >= 15f)
		{
			Gore gore = Gore.NewGoreDirect(base.Center + rotation.ToRotationVector2() * 300f - Utils.RandomVector2(Main.rand, -20f, 20f), Vector2.Zero, 61 + Main.rand.Next(3), 0.5f);
			gore.velocity *= 0.3f;
			gore.velocity += rotation.ToRotationVector2() * 4f;
		}
		for (int j = 0; j < 1; j++)
		{
			Dust dust2 = Dust.NewDustDirect(position, width, height, 31);
			dust2.fadeIn = 1.5f;
			dust2.scale = 0.4f;
			dust2.velocity = rotation.ToRotationVector2().RotatedBy(Main.rand.NextFloatDirection() * ((float)Math.PI / 12f)) * (0.5f + Main.rand.NextFloat() * 2.5f) * 15f;
			dust2.velocity += nPC.velocity * 2f;
			dust2.velocity *= 0.3f;
			dust2.noLight = true;
			dust2.noGravity = true;
			float num4 = Main.rand.NextFloat();
			dust2.position = Vector2.Lerp(base.Center + rotation.ToRotationVector2() * 400f * num3, base.Center + rotation.ToRotationVector2() * 400f * num2, num4);
			dust2.position += rotation.ToRotationVector2().RotatedBy(1.5707963705062866) * (20f + 100f * (num4 - 0.5f));
		}
		frameCounter++;
		ai[0] += 1f;
		if (ai[0] >= 78f)
		{
			Kill();
		}
	}

	private void AI_137_LightningAura()
	{
		int num = 10;
		int num2 = 999;
		int num3 = 30;
		int num4 = 40;
		int num5 = 4;
		knockBack = 0f;
		if (Main.player[owner].setMonkT2)
		{
			num3 -= 5;
		}
		if (Main.player[owner].setMonkT3)
		{
			num = 14;
			num5 = 8;
		}
		ai[0] += 1f;
		if (ai[0] >= (float)num3)
		{
			ai[0] = 0f;
		}
		if (ai[0] == 0f)
		{
			bool flag = false;
			for (int i = 0; i < Main.maxNPCs; i++)
			{
				NPC nPC = Main.npc[i];
				if (nPC.CanBeChasedBy(this) && nPC.Hitbox.Distance(base.Center) < (float)(width / 2) && Colliding(base.Hitbox, nPC.Hitbox))
				{
					flag = true;
					break;
				}
			}
			if (flag)
			{
				SoundEngine.PlayTrackedSound(SoundID.DD2_LightningAuraZap, base.Center);
			}
		}
		if (localAI[0] == 0f)
		{
			localAI[0] = 1f;
			velocity = Vector2.Zero;
			Point origin = base.Center.ToTileCoordinates();
			bool flag2 = true;
			if (!WorldUtils.Find(origin, Searches.Chain(new Searches.Down(500), _cachedConditions_notNull, _cachedConditions_solid), out var result))
			{
				flag2 = false;
				position.Y += 16f;
				return;
			}
			if (!WorldUtils.Find(new Point(result.X, result.Y - 1), Searches.Chain(new Searches.Up(num), _cachedConditions_notNull, _cachedConditions_solid), out var result2))
			{
				result2 = new Point(origin.X, origin.Y - num - 1);
			}
			int num6 = 0;
			if (flag2 && Main.tile[result.X, result.Y] != null && Main.tile[result.X, result.Y].blockType() == 1)
			{
				num6 += 8;
			}
			Vector2 center = result.ToWorldCoordinates(8f, num6);
			Vector2 vector = result2.ToWorldCoordinates(8f, 0f);
			base.Size = new Vector2(1f, center.Y - vector.Y);
			if (height > num * 16)
			{
				height = num * 16;
			}
			if (height < num5 * 16)
			{
				height = num5 * 16;
			}
			height *= 2;
			width = (int)((float)height * 1f);
			if (width > num2)
			{
				width = num2;
			}
			base.Center = center;
		}
		if (++frameCounter >= 8)
		{
			frameCounter = 0;
			if (++frame >= Main.projFrames[type])
			{
				frame = 0;
			}
		}
		DelegateMethods.v3_1 = new Vector3(0.2f, 0.7f, 1f);
		Utils.PlotTileLine(base.Center + Vector2.UnitX * -40f, base.Center + Vector2.UnitX * 40f, 80f, DelegateMethods.CastLightOpen);
		Vector2 vector2 = new Vector2(base.Top.X, position.Y + (float)num4);
		for (int j = 0; j < 4; j++)
		{
			if (Main.rand.Next(6) != 0)
			{
				continue;
			}
			Vector2 vector3 = Main.rand.NextVector2Unit();
			if (!(Math.Abs(vector3.X) < 0.12f))
			{
				Vector2 targetPosition = base.Center + vector3 * new Vector2((height - num4) / 2);
				if (!WorldGen.SolidTile((int)targetPosition.X / 16, (int)targetPosition.Y / 16) && AI_137_CanHit(targetPosition))
				{
					Dust dust = Dust.NewDustDirect(targetPosition, 0, 0, 226, 0f, 0f, 100);
					dust.position = targetPosition;
					dust.velocity = (vector2 - dust.position).SafeNormalize(Vector2.Zero);
					dust.scale = 0.7f;
					dust.fadeIn = 1f;
					dust.noGravity = true;
					dust.noLight = true;
				}
			}
		}
		for (int k = 0; k < 0; k++)
		{
			if (Main.rand.Next(10) != 0)
			{
				continue;
			}
			Vector2 vector4 = Main.rand.NextVector2Unit();
			if (!(Math.Abs(vector4.X) < 0.12f))
			{
				Vector2 targetPosition2 = base.Center + vector4 * new Vector2((height - num4) / 2) * Main.rand.NextFloat();
				if (!WorldGen.SolidTile((int)targetPosition2.X / 16, (int)targetPosition2.Y / 16) && AI_137_CanHit(targetPosition2))
				{
					Dust dust2 = Dust.NewDustDirect(targetPosition2, 0, 0, 226, 0f, 0f, 100);
					dust2.velocity *= 0.6f;
					dust2.velocity += Vector2.UnitY * -2f;
					dust2.noGravity = true;
					dust2.noLight = true;
				}
			}
		}
		for (int l = 0; l < 4; l++)
		{
			if (Main.rand.Next(10) == 0)
			{
				Dust dust3 = Dust.NewDustDirect(vector2 - new Vector2(8f, 0f), 16, height / 2 - 40, 226, 0f, 0f, 100);
				dust3.velocity *= 0.6f;
				dust3.velocity += Vector2.UnitY * -2f;
				dust3.scale = 0.7f;
				dust3.noGravity = true;
				dust3.noLight = true;
			}
		}
		tileCollide = true;
		velocity.Y += 0.2f;
	}

	private void AI_138_ExplosiveTrap()
	{
		spriteDirection = (direction = 1);
		int num = 694;
		int num2 = 48;
		int explosiveTrapCooldown = GetExplosiveTrapCooldown(Main.player[owner]);
		switch (type)
		{
		case 692:
			num = 695;
			break;
		case 693:
			num = 696;
			break;
		}
		Lighting.AddLight(base.Center, 0.6f, 0.5f, 0.3f);
		if (++frameCounter >= 12)
		{
			frameCounter = 0;
			if (++frame >= Main.projFrames[type])
			{
				frame = 0;
			}
		}
		if (localAI[0] > 0f)
		{
			localAI[0] -= 1f;
		}
		if (localAI[0] <= 0f && owner == Main.myPlayer)
		{
			localAI[0] = 3f;
			bool flag = false;
			Rectangle rectangle = Utils.CenteredRectangle(base.Center + new Vector2(0f, -num2), new Vector2(num2 * 3));
			for (int i = 0; i < Main.maxNPCs; i++)
			{
				NPC nPC = Main.npc[i];
				if (nPC.CanBeChasedBy(this) && rectangle.Intersects(nPC.Hitbox))
				{
					flag = true;
					break;
				}
			}
			if (flag)
			{
				SoundEngine.PlayTrackedSound(SoundID.DD2_ExplosiveTrapExplode);
				localAI[0] = explosiveTrapCooldown;
				NewProjectile(GetProjectileSource_FromThis(), base.Center + new Vector2(0f, -num2), Vector2.Zero, num, damage, knockBack, owner);
			}
		}
		tileCollide = true;
		velocity.Y += 0.2f;
	}

	public static int GetExplosiveTrapCooldown(Player player)
	{
		int result = 90;
		if (player.setHuntressT2)
		{
			result = 60;
		}
		if (player.setHuntressT3)
		{
			result = 30;
		}
		return result;
	}

	private void AI_139_ExplosiveTrapExplosion()
	{
		int num = Main.projFrames[type];
		int num2 = 3;
		alpha -= 25;
		if (alpha < 0)
		{
			alpha = 0;
		}
		if (localAI[0] == 0f)
		{
			localAI[0] = 1f;
		}
		if (++frameCounter >= num2)
		{
			frameCounter = 0;
			if (++frame >= num)
			{
				Kill();
				return;
			}
		}
		DelegateMethods.v3_1 = new Vector3(1.3f, 0.9f, 0.2f);
		Utils.PlotTileLine(base.Top, base.Bottom, 2f, DelegateMethods.CastLightOpen);
	}

	private void AI_140_MonkStaffT1()
	{
		float num = 50f;
		float num2 = 2f;
		float num3 = 20f;
		Player player = Main.player[owner];
		float num4 = -(float)Math.PI / 4f;
		Vector2 mountedCenter = player.MountedCenter;
		Vector2 vector = player.RotatedRelativePoint(mountedCenter);
		Vector2 vector2 = Vector2.Zero;
		if (player.dead)
		{
			Kill();
			return;
		}
		if (type == 697)
		{
			int num5 = damage * 3;
			int num6 = Math.Sign(velocity.X);
			velocity = new Vector2(num6, 0f);
			if (ai[0] == 0f)
			{
				rotation = new Vector2(num6, 0f - player.gravDir).ToRotation() + num4 + (float)Math.PI;
				if (velocity.X < 0f)
				{
					rotation -= (float)Math.PI / 2f;
				}
			}
			alpha -= 128;
			if (alpha < 0)
			{
				alpha = 0;
			}
			float num7 = ai[0] / num;
			float num8 = 1f;
			ai[0] += num8;
			rotation += (float)Math.PI * 2f * num2 / num * (float)num6;
			bool flag = ai[0] == (float)(int)(num / 2f);
			if (ai[0] >= num || (flag && !player.controlUseItem))
			{
				Kill();
				player.reuseDelay = 10;
			}
			else if (flag)
			{
				Vector2 mouseWorld = Main.MouseWorld;
				int num9 = ((player.DirectionTo(mouseWorld).X > 0f) ? 1 : (-1));
				if ((float)num9 != velocity.X)
				{
					player.ChangeDir(num9);
					velocity = new Vector2(num9, 0f);
					netUpdate = true;
					rotation -= (float)Math.PI;
				}
			}
			float num10 = rotation - (float)Math.PI / 4f * (float)num6;
			vector2 = (num10 + ((num6 == -1) ? ((float)Math.PI) : 0f)).ToRotationVector2() * (ai[0] / num) * num3;
			Vector2 vector3 = base.Center + (num10 + ((num6 == -1) ? ((float)Math.PI) : 0f)).ToRotationVector2() * 30f;
			if (Main.rand.Next(2) == 0)
			{
				Dust dust = Dust.NewDustDirect(vector3 - new Vector2(5f), 10, 10, 31, player.velocity.X, player.velocity.Y, 150);
				dust.velocity = DirectionTo(dust.position) * 0.1f + dust.velocity * 0.1f;
			}
			if (num7 >= 0.75f)
			{
				Dust dust2 = Dust.NewDustDirect(vector3 - new Vector2(5f), 10, 10, 55, player.velocity.X, player.velocity.Y, 50);
				dust2.velocity = DirectionTo(dust2.position) * 0.1f + dust2.velocity * 0.1f;
				dust2.noGravity = true;
				dust2.color = new Color(20, 255, 100, 160);
			}
			if (ai[0] >= num - 8f && ai[0] < num - 2f)
			{
				for (int i = 0; i < 5; i++)
				{
					Dust dust3 = Dust.NewDustDirect(vector3 - new Vector2(5f), 10, 10, 55, player.velocity.X, player.velocity.Y, 50);
					dust3.velocity *= 1.2f;
					dust3.noGravity = true;
					dust3.scale += 0.1f;
					dust3.color = new Color(20, 255, 100, 160);
				}
			}
			if (ai[0] == num - 3f && owner == Main.myPlayer)
			{
				if (localAI[1] == 1f || WorldUtils.Find(vector3.ToTileCoordinates(), Searches.Chain(new Searches.Down(4), _cachedConditions_notNull, _cachedConditions_solid), out var _))
				{
					NewProjectile(GetProjectileSource_FromThis(), vector3 + new Vector2(num6 * 20, -60f), Vector2.Zero, 698, num5, 0f, owner);
					SoundEngine.PlayTrackedSound(SoundID.DD2_MonkStaffGroundImpact, base.Center);
				}
				else
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_MonkStaffGroundMiss, base.Center);
				}
			}
		}
		if (type == 707)
		{
			Lighting.AddLight(player.Center, 0.75f, 0.9f, 1.15f);
			int num11 = Math.Sign(velocity.X);
			velocity = new Vector2(num11, 0f);
			if (ai[0] == 0f)
			{
				rotation = new Vector2(num11, 0f - player.gravDir).ToRotation() + num4 + (float)Math.PI;
				if (velocity.X < 0f)
				{
					rotation -= (float)Math.PI / 2f;
				}
			}
			alpha -= 128;
			if (alpha < 0)
			{
				alpha = 0;
			}
			_ = ai[0] / num;
			float num12 = 1f;
			ai[0] += num12;
			rotation += (float)Math.PI * 2f * num2 / num * (float)num11;
			bool flag2 = ai[0] == (float)(int)(num / 2f);
			if (ai[0] >= num || (flag2 && !player.controlUseItem))
			{
				Kill();
				player.reuseDelay = 2;
			}
			else if (flag2)
			{
				Vector2 mouseWorld2 = Main.MouseWorld;
				int num13 = ((player.DirectionTo(mouseWorld2).X > 0f) ? 1 : (-1));
				if ((float)num13 != velocity.X)
				{
					player.ChangeDir(num13);
					velocity = new Vector2(num13, 0f);
					netUpdate = true;
					rotation -= (float)Math.PI;
				}
			}
			if ((ai[0] == num12 || (ai[0] == (float)(int)(num / 2f) && active)) && owner == Main.myPlayer)
			{
				Vector2 mouseWorld3 = Main.MouseWorld;
				_ = player.DirectionTo(mouseWorld3) * 0f;
			}
			float num14 = rotation - (float)Math.PI / 4f * (float)num11;
			vector2 = (num14 + ((num11 == -1) ? ((float)Math.PI) : 0f)).ToRotationVector2() * (ai[0] / num) * num3;
			Vector2 vector4 = base.Center + (num14 + ((num11 == -1) ? ((float)Math.PI) : 0f)).ToRotationVector2() * 30f;
			Vector2 vector5 = num14.ToRotationVector2();
			Vector2 vector6 = vector5.RotatedBy((float)Math.PI / 2f * (float)spriteDirection);
			if (Main.rand.Next(2) == 0)
			{
				Dust dust4 = Dust.NewDustDirect(vector4 - new Vector2(5f), 10, 10, 31, player.velocity.X, player.velocity.Y, 150);
				dust4.velocity = DirectionTo(dust4.position) * 0.1f + dust4.velocity * 0.1f;
			}
			for (int j = 0; j < 4; j++)
			{
				float num15 = 1f;
				float num16 = 1f;
				switch (j)
				{
				case 1:
					num16 = -1f;
					break;
				case 2:
					num16 = 1.25f;
					num15 = 0.5f;
					break;
				case 3:
					num16 = -1.25f;
					num15 = 0.5f;
					break;
				}
				if (Main.rand.Next(6) != 0)
				{
					Dust dust5 = Dust.NewDustDirect(position, 0, 0, 226, 0f, 0f, 100);
					dust5.position = base.Center + vector5 * (60f + Main.rand.NextFloat() * 20f) * num16;
					dust5.velocity = vector6 * (4f + 4f * Main.rand.NextFloat()) * num16 * num15;
					dust5.noGravity = true;
					dust5.noLight = true;
					dust5.scale = 0.5f;
					dust5.customData = this;
					if (Main.rand.Next(4) == 0)
					{
						dust5.noGravity = false;
					}
				}
			}
		}
		position = vector - base.Size / 2f;
		position += vector2;
		spriteDirection = direction;
		timeLeft = 2;
		player.ChangeDir(direction);
		player.heldProj = whoAmI;
		player.SetDummyItemTime(2);
		player.itemRotation = MathHelper.WrapAngle(rotation);
	}

	private void AI_141_MonkStaffT1Explosion()
	{
		Point scanAreaStart = base.TopLeft.ToTileCoordinates();
		Point scanAreaEnd = base.BottomRight.ToTileCoordinates();
		_ = scanAreaStart.X / 2;
		_ = scanAreaEnd.X / 2;
		int explosionRange = width;
		ai[0] += 1f;
		if (ai[0] > 20f)
		{
			Kill();
		}
		else if (ai[0] == 1f)
		{
			CreateImpactExplosion(6, base.Bottom, ref scanAreaStart, ref scanAreaEnd, explosionRange, out var causedShockwaves);
			CreateImpactExplosion2_SleepyOctopod(base.Bottom, causedShockwaves);
		}
	}

	private void CreateImpactExplosion(int dustAmountMultiplier, Vector2 explosionOrigin, ref Point scanAreaStart, ref Point scanAreaEnd, int explosionRange, out bool causedShockwaves)
	{
		causedShockwaves = false;
		int num = 4;
		for (int i = scanAreaStart.X; i <= scanAreaEnd.X; i++)
		{
			for (int j = scanAreaStart.Y; j <= scanAreaEnd.Y; j++)
			{
				if (Vector2.Distance(explosionOrigin, new Vector2(i * 16, j * 16)) > (float)explosionRange)
				{
					continue;
				}
				Tile tileSafely = Framing.GetTileSafely(i, j);
				if (!tileSafely.active() || !Main.tileSolid[tileSafely.type] || Main.tileSolidTop[tileSafely.type] || Main.tileFrameImportant[tileSafely.type])
				{
					continue;
				}
				Tile tileSafely2 = Framing.GetTileSafely(i, j - 1);
				if (tileSafely2.active() && Main.tileSolid[tileSafely2.type] && !Main.tileSolidTop[tileSafely2.type])
				{
					continue;
				}
				int num2 = WorldGen.KillTile_GetTileDustAmount(fail: true, tileSafely) * dustAmountMultiplier;
				for (int k = 0; k < num2; k++)
				{
					Dust obj = Main.dust[WorldGen.KillTile_MakeTileDust(i, j, tileSafely)];
					obj.velocity.Y -= 3f + (float)num * 1.5f;
					obj.velocity.Y *= Main.rand.NextFloat();
					obj.scale += (float)num * 0.03f;
				}
				if (num >= 2)
				{
					for (int l = 0; l < num2 - 1; l++)
					{
						Dust obj2 = Main.dust[WorldGen.KillTile_MakeTileDust(i, j, tileSafely)];
						obj2.velocity.Y -= 1f + (float)num;
						obj2.velocity.Y *= Main.rand.NextFloat();
					}
				}
				if (num2 > 0)
				{
					causedShockwaves = true;
				}
			}
		}
	}

	private void CreateImpactExplosion2_SleepyOctopod(Vector2 explosionOrigin, bool causedShockwaves)
	{
		Vector2 spinningpoint = new Vector2(7f, 0f);
		Vector2 vector = new Vector2(1f, 0.7f);
		Color color = new Color(20, 255, 100, 200);
		for (float num = 0f; num < 25f; num += 1f)
		{
			Vector2 vector2 = spinningpoint.RotatedBy(num * ((float)Math.PI * 2f) / 25f) * vector;
			Dust dust = Dust.NewDustDirect(position, width, height, 55);
			dust.alpha = 0;
			if (!causedShockwaves)
			{
				dust.alpha = 50;
			}
			dust.color = color;
			dust.position = explosionOrigin + vector2;
			dust.velocity.Y -= 3f;
			dust.velocity.X *= 0.5f;
			dust.fadeIn = 0.5f + Main.rand.NextFloat() * 0.5f;
			dust.noLight = true;
		}
		if (!causedShockwaves)
		{
			for (float num2 = 0f; num2 < 25f; num2 += 1f)
			{
				Vector2 vector3 = spinningpoint.RotatedBy(num2 * ((float)Math.PI * 2f) / 25f) * vector;
				Dust dust2 = Dust.NewDustDirect(position, width, height, 55);
				dust2.alpha = 100;
				dust2.color = color;
				dust2.position = explosionOrigin + vector3;
				dust2.velocity.Y -= 5f;
				dust2.velocity.X *= 0.8f;
				dust2.fadeIn = 0.5f + Main.rand.NextFloat() * 0.5f;
				dust2.noLight = true;
			}
		}
	}

	private void CreateImpactExplosion2_FlailTileCollision(Vector2 explosionOrigin, bool causedShockwaves, Vector2 velocityBeforeCollision)
	{
		Vector2 spinningpoint = new Vector2(7f, 0f);
		Vector2 vector = new Vector2(1f, 0.7f);
		Color color = Color.White * 0.5f;
		Vector2 vector2 = velocityBeforeCollision.SafeNormalize(Vector2.Zero);
		for (float num = 0f; num < 8f; num += 1f)
		{
			Vector2 vector3 = spinningpoint.RotatedBy(num * ((float)Math.PI * 2f) / 8f) * vector;
			Dust dust = Dust.NewDustDirect(position, width, height, 31);
			dust.alpha = 0;
			if (!causedShockwaves)
			{
				dust.alpha = 50;
			}
			dust.color = color;
			dust.position = explosionOrigin + vector3;
			dust.velocity.Y -= 0.8f;
			dust.velocity.X *= 0.8f;
			dust.fadeIn = 0.3f + Main.rand.NextFloat() * 0.4f;
			dust.scale = 0.4f;
			dust.noLight = true;
			dust.velocity += vector2 * 2f;
		}
		if (!causedShockwaves)
		{
			for (float num2 = 0f; num2 < 8f; num2 += 1f)
			{
				Vector2 vector4 = spinningpoint.RotatedBy(num2 * ((float)Math.PI * 2f) / 8f) * vector;
				Dust dust2 = Dust.NewDustDirect(position, width, height, 31);
				dust2.alpha = 100;
				dust2.color = color;
				dust2.position = explosionOrigin + vector4;
				dust2.velocity.Y -= 1f;
				dust2.velocity.X *= 0.4f;
				dust2.fadeIn = 0.3f + Main.rand.NextFloat() * 0.4f;
				dust2.scale = 0.4f;
				dust2.noLight = true;
				dust2.velocity += vector2 * 1.5f;
			}
		}
	}

	private void AI_142_MonkStaffT2And3()
	{
		Player player = Main.player[owner];
		Vector2 vector = player.RotatedRelativePoint(player.MountedCenter);
		direction = player.direction;
		player.heldProj = whoAmI;
		base.Center = vector;
		if (player.dead)
		{
			Kill();
			return;
		}
		if (!player.frozen)
		{
			if (type == 699)
			{
				spriteDirection = (direction = player.direction);
				Vector2 vector2 = vector;
				alpha -= 127;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (localAI[0] > 0f)
				{
					localAI[0] -= 1f;
				}
				float num = (float)player.itemAnimation / (float)player.itemAnimationMax;
				float num2 = 1f - num;
				float num3 = velocity.ToRotation();
				float num4 = velocity.Length();
				float num5 = 22f;
				Vector2 spinningpoint = new Vector2(1f, 0f).RotatedBy((float)Math.PI + num2 * ((float)Math.PI * 2f)) * new Vector2(num4, ai[0]);
				position += spinningpoint.RotatedBy(num3) + new Vector2(num4 + num5, 0f).RotatedBy(num3);
				Vector2 target = vector2 + spinningpoint.RotatedBy(num3) + new Vector2(num4 + num5 + 40f, 0f).RotatedBy(num3);
				rotation = vector2.AngleTo(target) + (float)Math.PI / 4f * (float)player.direction;
				if (spriteDirection == -1)
				{
					rotation += (float)Math.PI;
				}
				vector2.DirectionTo(base.Center);
				Vector2 vector3 = vector2.DirectionTo(target);
				Vector2 vector4 = velocity.SafeNormalize(Vector2.UnitY);
				float num6 = 2f;
				for (int i = 0; (float)i < num6; i++)
				{
					Dust dust = Dust.NewDustDirect(base.Center, 14, 14, 228, 0f, 0f, 110);
					dust.velocity = vector2.DirectionTo(dust.position) * 2f;
					dust.position = base.Center + vector4.RotatedBy(num2 * ((float)Math.PI * 2f) * 2f + (float)i / num6 * ((float)Math.PI * 2f)) * 10f;
					dust.scale = 1f + 0.6f * Main.rand.NextFloat();
					dust.velocity += vector4 * 3f;
					dust.noGravity = true;
				}
				for (int j = 0; j < 1; j++)
				{
					if (Main.rand.Next(3) == 0)
					{
						Dust dust2 = Dust.NewDustDirect(base.Center, 20, 20, 228, 0f, 0f, 110);
						dust2.velocity = vector2.DirectionTo(dust2.position) * 2f;
						dust2.position = base.Center + vector3 * -110f;
						dust2.scale = 0.45f + 0.4f * Main.rand.NextFloat();
						dust2.fadeIn = 0.7f + 0.4f * Main.rand.NextFloat();
						dust2.noGravity = true;
						dust2.noLight = true;
					}
				}
			}
			else if (type == 708)
			{
				Lighting.AddLight(player.Center, 0.75f, 0.9f, 1.15f);
				spriteDirection = (direction = player.direction);
				alpha -= 127;
				if (alpha < 0)
				{
					alpha = 0;
				}
				float num7 = (float)player.itemAnimation / (float)player.itemAnimationMax;
				float num8 = 1f - num7;
				float num9 = velocity.ToRotation();
				float num10 = velocity.Length();
				float num11 = 22f;
				Vector2 spinningpoint2 = new Vector2(1f, 0f).RotatedBy((float)Math.PI + num8 * ((float)Math.PI * 2f)) * new Vector2(num10, ai[0]);
				position += spinningpoint2.RotatedBy(num9) + new Vector2(num10 + num11, 0f).RotatedBy(num9);
				Vector2 vector5 = vector + spinningpoint2.RotatedBy(num9) + new Vector2(num10 + num11 + 40f, 0f).RotatedBy(num9);
				rotation = (vector5 - vector).SafeNormalize(Vector2.UnitX).ToRotation() + (float)Math.PI / 4f * (float)player.direction;
				if (spriteDirection == -1)
				{
					rotation += (float)Math.PI;
				}
				(base.Center - vector).SafeNormalize(Vector2.Zero);
				(vector5 - vector).SafeNormalize(Vector2.Zero);
				Vector2 vector6 = velocity.SafeNormalize(Vector2.UnitY);
				if ((player.itemAnimation == 2 || player.itemAnimation == 6 || player.itemAnimation == 10) && owner == Main.myPlayer)
				{
					Vector2 vector7 = vector6 + Main.rand.NextVector2Square(-0.2f, 0.2f);
					vector7 *= 12f;
					switch (player.itemAnimation)
					{
					case 2:
						vector7 = vector6.RotatedBy(0.3839724659919739);
						break;
					case 6:
						vector7 = vector6.RotatedBy(-0.3839724659919739);
						break;
					case 10:
						vector7 = vector6.RotatedBy(0.0);
						break;
					}
					vector7 *= 10f + (float)Main.rand.Next(4);
					NewProjectile(GetProjectileSource_FromThis(), base.Center, vector7, 709, damage, 0f, owner);
				}
				for (int k = 0; k < 3; k += 2)
				{
					float num12 = 1f;
					float num13 = 1f;
					switch (k)
					{
					case 1:
						num13 = -1f;
						break;
					case 2:
						num13 = 1.25f;
						num12 = 0.5f;
						break;
					case 3:
						num13 = -1.25f;
						num12 = 0.5f;
						break;
					}
					if (Main.rand.Next(6) != 0)
					{
						num13 *= 1.2f;
						Dust dust3 = Dust.NewDustDirect(position, width, height, 226, 0f, 0f, 100);
						dust3.velocity = vector6 * (4f + 4f * Main.rand.NextFloat()) * num13 * num12;
						dust3.noGravity = true;
						dust3.noLight = true;
						dust3.scale = 0.75f;
						dust3.fadeIn = 0.8f;
						dust3.customData = this;
						if (Main.rand.Next(3) == 0)
						{
							dust3.noGravity = false;
							dust3.fadeIn = 0f;
						}
					}
				}
			}
		}
		if (player.whoAmI == Main.myPlayer && player.itemAnimation <= 2)
		{
			Kill();
			player.reuseDelay = 2;
		}
	}

	private void AI_143_MonkStaffT2Ghast()
	{
		if (ai[0] == 0f)
		{
			localAI[1] = SoundEngine.PlayTrackedSound(SoundID.DD2_GhastlyGlaiveImpactGhost, base.Center).ToFloat();
		}
		ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]));
		if (activeSound == null)
		{
			localAI[1] = SlotId.Invalid.ToFloat();
		}
		else
		{
			activeSound.Position = base.Center;
		}
		ai[0] += 1f;
		if (ai[0] > 50f)
		{
			alpha += 25;
			if (alpha > 255)
			{
				alpha = 255;
			}
		}
		else
		{
			alpha -= 25;
			if (alpha < 100)
			{
				alpha = 100;
			}
		}
		velocity *= 0.98f;
		if (++frameCounter >= 5)
		{
			frameCounter = 0;
			if (++frame >= 4)
			{
				frame = 0;
			}
		}
		if (ai[0] >= 60f)
		{
			Kill();
		}
		direction = (spriteDirection = ((velocity.X > 0f) ? 1 : (-1)));
		rotation = velocity.ToRotation();
		if (spriteDirection == -1)
		{
			rotation += (float)Math.PI;
		}
		if (ai[0] >= 10f && ai[0] < 34f)
		{
			Vector2 vector = velocity.SafeNormalize(Vector2.UnitY);
			float num = ai[0] / 60f;
			float num2 = 2f;
			for (int i = 0; (float)i < num2; i++)
			{
				Dust dust = Dust.NewDustDirect(base.Center, 14, 14, 228, 0f, 0f, 110);
				dust.velocity = vector * 2f;
				dust.position = base.Center + vector.RotatedBy(num * ((float)Math.PI * 2f) * 2f + (float)i / num2 * ((float)Math.PI * 2f)) * 7f;
				dust.scale = 1f + 0.6f * Main.rand.NextFloat();
				dust.velocity += vector * 3f;
				dust.noGravity = true;
			}
		}
	}

	private void AI_144_DD2Pet()
	{
		Player player = Main.player[owner];
		float num = 4f;
		int num2 = 6;
		int num3 = 4;
		int num4 = Main.projFrames[type];
		int num5 = 0;
		float num6 = 0.08f;
		bool flag = false;
		float num7 = 0.1f;
		Vector2 vector = new Vector2(player.direction * 30, -20f);
		if (player.dead)
		{
			Kill();
			return;
		}
		bool flag2 = true;
		switch (type)
		{
		case 702:
		{
			if (player.petFlagDD2Ghost)
			{
				timeLeft = 2;
			}
			vector.Y += (float)Math.Cos(localAI[0] * ((float)Math.PI / 60f)) * 2f;
			num3 = 4;
			num2 = 10;
			flag2 = false;
			num = 6f;
			Vector2 vector3 = new Vector2((spriteDirection == -1) ? (-6) : (-2), -26f).RotatedBy(rotation);
			if (Main.rand.Next(24) == 0)
			{
				Dust dust2 = Dust.NewDustDirect(base.Center + vector3, 4, 4, 135, 0f, 0f, 100);
				if (Main.rand.Next(3) != 0)
				{
					dust2.noGravity = true;
					dust2.velocity.Y -= 3f;
					dust2.noLight = true;
				}
				else if (Main.rand.Next(2) != 0)
				{
					dust2.noLight = true;
				}
				dust2.velocity *= 0.5f;
				dust2.velocity.Y -= 0.9f;
				dust2.scale += 0.1f + Main.rand.NextFloat() * 0.6f;
			}
			DelegateMethods.v3_1 = new Vector3(0.3f, 0.5f, 1f);
			Utils.PlotTileLine(base.Center, base.Center + velocity * 6f, 20f, DelegateMethods.CastLightOpen);
			Utils.PlotTileLine(base.Left, base.Right, 20f, DelegateMethods.CastLightOpen);
			Utils.PlotTileLine(player.Center, player.Center + player.velocity * 6f, 40f, DelegateMethods.CastLightOpen);
			Utils.PlotTileLine(player.Left, player.Right, 40f, DelegateMethods.CastLightOpen);
			break;
		}
		case 703:
			if (player.petFlagDD2Gato)
			{
				timeLeft = 2;
			}
			vector.Y += (float)Math.Cos(localAI[0] * ((float)Math.PI / 30f)) * 2f;
			num2 = 4;
			num3 = 2;
			num = 3f;
			num4 = 4;
			break;
		case 701:
			if (player.petFlagDD2Dragon)
			{
				timeLeft = 2;
			}
			break;
		case 764:
		{
			num7 = 0.025f;
			num6 = 0.04f;
			flag = true;
			localAI[0] += 1f;
			if (localAI[0] > 120f)
			{
				localAI[0] = 0f;
			}
			localAI[1] += velocity.X * 0.01f;
			localAI[1] += 1f / 120f;
			if (localAI[1] < (float)Math.PI * -2f)
			{
				localAI[1] += (float)Math.PI * 2f;
			}
			if (localAI[1] > (float)Math.PI * 2f)
			{
				localAI[1] -= (float)Math.PI * 2f;
			}
			if (velocity.Length() < 4f)
			{
				localAI[1] *= 0.9f;
				if (velocity.Length() > 0.1f && Main.rand.Next(30) == 0)
				{
					Dust dust = Dust.NewDustDirect(position - velocity, width, height, 292, velocity.X * 0.5f, velocity.Y * 0.5f, 150);
					dust.velocity *= 0.3f;
					dust.noLightEmittence = true;
				}
			}
			else
			{
				Vector2 vector2 = new Vector2(Main.screenWidth, Main.screenHeight);
				base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector2 / 2f, vector2 + new Vector2(400f)));
				if (Main.rand.Next(15) == 0)
				{
					Dust.NewDustDirect(position - velocity, width, height, 292, velocity.X * 0.5f, velocity.Y * 0.5f, 150, default(Color), 0.9f).noLightEmittence = true;
				}
			}
			float num11 = localAI[0] / 120f * 2f;
			if (num11 > 1f)
			{
				num11 = 2f - num11;
			}
			Opacity = MathHelper.Lerp(0.4f, 0.75f, num11);
			vector.Y += (float)Math.Cos(localAI[0] / 120f * ((float)Math.PI * 2f)) * 2f;
			if (player.petFlagUpbeatStar)
			{
				timeLeft = 2;
			}
			break;
		}
		case 1050:
			if (player.petFlagAxeFairyPet)
			{
				timeLeft = 2;
			}
			num2 = 5;
			num3 = 3;
			num4 = 3;
			vector.X *= -1f;
			num = 3f;
			if (localAI[1] < 0f)
			{
				localAI[1] += 1f;
			}
			if (localAI[1] >= 0f)
			{
				if (Distance(player.MountedCenter) < 320f)
				{
					localAI[2] += 1f;
					int num8 = direction;
					Point point = base.Center.ToTileCoordinates();
					int num9 = 12;
					Point p = point;
					bool flag3 = false;
					while (!flag3 && num9 > 0 && WorldGen.InWorld(p.X, p.Y))
					{
						Tile tile = Main.tile[p.X, p.Y];
						if (tile == null)
						{
							break;
						}
						if (tile.active())
						{
							flag3 = TileID.Sets.IsShakeable[tile.type];
							if (flag3 || WorldGen.SolidTile(p))
							{
								break;
							}
						}
						num9--;
						p.X += num8;
					}
					if (num9 == 0)
					{
						p.X -= num8;
					}
					if (flag3)
					{
						vector = p.ToWorldCoordinates() + new Vector2(-num8 * 30, 0f) - player.MountedCenter;
						num4 = 16;
						num5 = 8;
						num2 = 3;
						if (frameCounter == 0 && (frame == 8 || frame == 12))
						{
							Tile tileCache = Main.tile[p.X, p.Y];
							WorldGen.KillTile_MakeTileDust(p.X, p.Y, tileCache);
							WorldGen.KillTile_PlaySounds(p.X, p.Y, fail: true, tileCache);
							int num10 = 200 + Main.rand.Next(100);
							if (Main.rand.Next(20) == 0)
							{
								num10 /= 8;
							}
							if (Main.netMode != 1 && localAI[2] >= (float)num10 && Main.rand.Next(5) == 0)
							{
								localAI[2] = 0f;
								WorldGen.KillTile_DropItems(p.X, p.Y, tileCache);
							}
						}
					}
				}
				else
				{
					localAI[1] = -300f;
				}
			}
			vector.Y += (float)Math.Cos(localAI[0] * ((float)Math.PI / 30f)) * 2f;
			break;
		}
		if (flag2 && (player.suspiciouslookingTentacle || player.petFlagDD2Ghost))
		{
			vector.X += -player.direction * 64;
		}
		direction = (spriteDirection = player.direction);
		Vector2 vector4 = player.MountedCenter + vector;
		float num12 = Vector2.Distance(base.Center, vector4);
		if (num12 > 1000f)
		{
			base.Center = player.Center + vector;
		}
		Vector2 vector5 = vector4 - base.Center;
		if (num12 < num)
		{
			velocity *= 0.25f;
		}
		if (vector5 != Vector2.Zero)
		{
			if (vector5.Length() < num * 0.5f)
			{
				velocity = vector5;
			}
			else
			{
				velocity = vector5 * num7;
			}
		}
		if (velocity.Length() > 6f)
		{
			float num13 = velocity.X * num6 + velocity.Y * (float)spriteDirection * 0.02f;
			if (Math.Abs(rotation - num13) >= (float)Math.PI)
			{
				if (num13 < rotation)
				{
					rotation -= (float)Math.PI * 2f;
				}
				else
				{
					rotation += (float)Math.PI * 2f;
				}
			}
			float num14 = 12f;
			rotation = (rotation * (num14 - 1f) + num13) / num14;
			if (++frameCounter >= num3)
			{
				frameCounter = 0;
				if (++frame >= num4)
				{
					frame = num5;
				}
			}
		}
		else
		{
			if (rotation > (float)Math.PI)
			{
				rotation -= (float)Math.PI * 2f;
			}
			if (rotation > -0.005f && rotation < 0.005f)
			{
				rotation = 0f;
			}
			else
			{
				rotation *= 0.96f;
			}
			if (++frameCounter >= num2)
			{
				frameCounter = 0;
				if (++frame >= num4)
				{
					frame = num5;
				}
			}
		}
		if (!flag)
		{
			localAI[0] += 1f;
			if (localAI[0] > 120f)
			{
				localAI[0] = 0f;
			}
		}
	}

	private void AI_145_BookStaffStorm()
	{
		float num = 300f;
		if (soundDelay == 0)
		{
			soundDelay = -1;
			localAI[1] = SoundEngine.PlayTrackedSound(SoundID.DD2_BookStaffTwisterLoop, base.Center).ToFloat();
		}
		ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]));
		if (activeSound != null)
		{
			activeSound.Position = base.Center;
			activeSound.Volume = 1f - Math.Max(ai[0] - (num - 15f), 0f) / 15f;
		}
		else
		{
			localAI[1] = SlotId.Invalid.ToFloat();
		}
		if (localAI[0] >= 16f && ai[0] < num - 15f)
		{
			ai[0] = num - 15f;
		}
		ai[0] += 1f;
		if (ai[0] >= num)
		{
			Kill();
		}
		Vector2 top = base.Top;
		Vector2 bottom = base.Bottom;
		Vector2 vector = Vector2.Lerp(top, bottom, 0.5f);
		Vector2 vector2 = new Vector2(0f, bottom.Y - top.Y);
		vector2.X = vector2.Y * 0.2f;
		int num2 = 16;
		int num3 = 160;
		for (int i = 0; i < 1; i++)
		{
			Vector2 vector3 = new Vector2(base.Center.X - (float)(num2 / 2), position.Y + (float)height - (float)num3);
			if (Collision.SolidCollision(vector3, num2, num3) || Collision.WetCollision(vector3, num2, num3))
			{
				if (velocity.Y > 0f)
				{
					velocity.Y = 0f;
				}
				if (velocity.Y > -4f)
				{
					velocity.Y -= 2f;
				}
				else
				{
					velocity.Y -= 4f;
					localAI[0] += 2f;
				}
				if (velocity.Y < -16f)
				{
					velocity.Y = -16f;
				}
				continue;
			}
			localAI[0] -= 1f;
			if (localAI[0] < 0f)
			{
				localAI[0] = 0f;
			}
			if (velocity.Y < 0f)
			{
				velocity.Y = 0f;
			}
			if (velocity.Y < 4f)
			{
				velocity.Y += 2f;
			}
			else
			{
				velocity.Y += 4f;
			}
			if (velocity.Y > 16f)
			{
				velocity.Y = 16f;
			}
		}
		if (ai[0] < num - 30f)
		{
			for (int j = 0; j < 1; j++)
			{
				float value = -1f;
				float value2 = 0.9f;
				float amount = Main.rand.NextFloat();
				Vector2 vector4 = new Vector2(MathHelper.Lerp(0.1f, 1f, Main.rand.NextFloat()), MathHelper.Lerp(value, value2, amount));
				vector4.X *= MathHelper.Lerp(2.2f, 0.6f, amount);
				vector4.X *= -1f;
				Vector2 vector5 = new Vector2(6f, 10f);
				Vector2 vector6 = vector + vector2 * vector4 * 0.5f + vector5;
				Dust dust = Main.dust[Dust.NewDust(vector6, 0, 0, 274)];
				dust.position = vector6;
				dust.fadeIn = 1.3f;
				dust.scale = 0.87f;
				dust.alpha = 211;
				if (vector4.X > -1.2f)
				{
					dust.velocity.X = 1f + Main.rand.NextFloat();
				}
				dust.noGravity = true;
				dust.velocity.Y = Main.rand.NextFloat() * -0.5f - 1.3f;
				dust.velocity.X += velocity.X * 2.1f;
				dust.noLight = true;
			}
		}
		Vector2 vector7 = base.Bottom + new Vector2(-25f, -25f);
		for (int k = 0; k < 4; k++)
		{
			Dust dust2 = Dust.NewDustDirect(vector7, 50, 25, 31, velocity.X, -2f, 100);
			dust2.fadeIn = 1.1f;
			dust2.noGravity = true;
		}
		for (int l = 0; l < 1; l++)
		{
			if (Main.rand.Next(5) == 0)
			{
				Gore gore = Gore.NewGoreDirect(base.TopLeft + Main.rand.NextVector2Square(0f, 1f) * base.Size, new Vector2(velocity.X * 1.5f, (0f - Main.rand.NextFloat()) * 16f), Utils.SelectRandom<int>(Main.rand, 1007, 1008, 1008));
				gore.timeLeft = 60;
				gore.alpha = 50;
				gore.velocity.X += velocity.X;
			}
		}
		for (int m = 0; m < 1; m++)
		{
			if (Main.rand.Next(7) == 0)
			{
				Gore gore2 = Gore.NewGoreDirect(base.TopLeft + Main.rand.NextVector2Square(0f, 1f) * base.Size, new Vector2(velocity.X * 1.5f, (0f - Main.rand.NextFloat()) * 16f), Utils.SelectRandom<int>(Main.rand, 1007, 1008, 1008));
				gore2.timeLeft = 0;
				gore2.alpha = 80;
			}
		}
		for (int n = 0; n < 1; n++)
		{
			if (Main.rand.Next(7) == 0)
			{
				Gore gore3 = Gore.NewGoreDirect(base.TopLeft + Main.rand.NextVector2Square(0f, 1f) * base.Size, new Vector2(velocity.X * 1.5f, (0f - Main.rand.NextFloat()) * 16f), Utils.SelectRandom<int>(Main.rand, 1007, 1008, 1008));
				gore3.timeLeft = 0;
				gore3.alpha = 80;
			}
		}
	}

	public bool AI_137_CanHit(Vector2 targetPosition)
	{
		if (WorldGen.SolidTile((int)targetPosition.X / 16, (int)targetPosition.Y / 16))
		{
			return false;
		}
		Vector2 vector = base.Top + Vector2.UnitY * 20f;
		bool flag = Collision.CanHitLine(vector, 0, 0, targetPosition, 0, 0);
		if (!flag)
		{
			Vector2 v = targetPosition - vector;
			Vector2 spinningpoint = v.SafeNormalize(Vector2.UnitY);
			Vector2 vector2 = Vector2.Lerp(vector, targetPosition, 0.5f);
			Vector2 vector3 = vector2 + spinningpoint.RotatedBy(1.5707963705062866) * v.Length() * 0.2f;
			if (Collision.CanHitLine(vector, 0, 0, vector3, 0, 0) && Collision.CanHitLine(vector3, 0, 0, targetPosition, 0, 0))
			{
				flag = true;
			}
			if (!flag)
			{
				Vector2 vector4 = vector2 + spinningpoint.RotatedBy(-1.5707963705062866) * v.Length() * 0.2f;
				if (Collision.CanHitLine(vector, 0, 0, vector4, 0, 0) && Collision.CanHitLine(vector4, 0, 0, targetPosition, 0, 0))
				{
					flag = true;
				}
			}
		}
		return flag;
	}

	private Point GetScarabBombDigDirectionSnap8()
	{
		Player player = Main.player[owner];
		Vector2 vector = DirectionTo(player.Center);
		Point result = new Point((!(vector.X > 0f)) ? 1 : (-1), (!(vector.Y > 0f)) ? 1 : (-1));
		if (Math.Abs(vector.X) > Math.Abs(vector.Y) * 2f)
		{
			result.Y = 0;
		}
		else if (Math.Abs(vector.Y) > Math.Abs(vector.X) * 2f)
		{
			result.X = 0;
		}
		return result;
	}

	public Color GetFirstFractalColor()
	{
		return Main.hslToRgb(ai[1], 1f, 0.5f);
	}

	public void Kill_DirtAndFluidProjectiles_RunDelegateMethodPushUpForHalfBricks(Point pt, float size, Utils.TileActionAttempt plot)
	{
		Tile tile = Main.tile[pt.X, pt.Y];
		if (tile != null && tile.active() && tile.halfBrick())
		{
			int num = pt.Y - 1;
			if (num >= 0)
			{
				tile = Main.tile[pt.X, num];
				if (!WorldGen.SolidOrSlopedTile(tile))
				{
					pt.Y--;
				}
			}
		}
		DelegateMethods.v2_1 = pt.ToVector2();
		DelegateMethods.f_1 = size;
		Utils.FloodFillTile(pt, size, plot);
	}

	private void LavaBoulderExplosion()
	{
		int num = 4;
		Vector2 value = new Vector2((int)base.Center.X / 16, (int)base.Center.Y / 16);
		for (int i = (int)value.X - num; (float)i <= value.X + (float)num; i++)
		{
			for (int j = (int)value.Y - num; (float)j <= value.Y + (float)num; j++)
			{
				if (Vector2.Distance(value, new Vector2(i, j)) < (float)num && Collision.CanHit(position, width, height, new Vector2(i * 16, j * 16), 16, 16))
				{
					WorldGen.PlaceLiquid(i, j, 1, byte.MaxValue);
				}
			}
		}
	}

	public bool IsAttachedTo(NPC npc)
	{
		if (aiStyle == 113 && ai[0] == 1f && ai[1] == (float)npc.whoAmI)
		{
			return true;
		}
		return false;
	}

	private void BoulderExplosion()
	{
		int num = Main.rand.Next(2, 5);
		for (int i = 0; i < num; i++)
		{
			float num2 = 8f;
			Vector2 vector = new Vector2(Main.rand.NextFloat() - 0.5f, (0f - Main.rand.NextFloat()) / 2f);
			vector.Normalize();
			vector *= num2;
			int num3 = (int)((double)damage * 0.75);
			int num4 = NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector.X, vector.Y, 1005, num3, 0f, Main.myPlayer);
			Main.projectile[num4].timeLeft = 300;
		}
	}

	private void SpawnWebs()
	{
		int num = 6;
		int num2 = (int)(base.Center.X / 16f);
		int num3 = (int)(base.Center.Y / 16f);
		int num4 = num2 - num;
		int num5 = num2 + num;
		int num6 = num3 - num;
		int num7 = num3 + num;
		if (num4 < 1)
		{
			num4 = 1;
		}
		if (num5 > Main.maxTilesX - 1)
		{
			num5 = Main.maxTilesX - 1;
		}
		if (num6 < 1)
		{
			num6 = 1;
		}
		if (num7 > Main.maxTilesY - 1)
		{
			num7 = Main.maxTilesY - 1;
		}
		for (int i = num4; i < num5; i++)
		{
			for (int j = num6; j < num7; j++)
			{
				if (!Main.tile[i, j].active() && Main.rand.Next(5) != 0 && Math.Abs(i - num2) * Math.Abs(i - num2) + Math.Abs(j - num3) * Math.Abs(j - num3) < num * num)
				{
					WorldGen.PlaceTile(i, j, 51);
					if (Main.tile[i, j].active() && Main.netMode == 2)
					{
						NetMessage.SendTileSquare(-1, i, j);
					}
				}
			}
		}
	}

	public void Kill_SpiderBoulder_SpawnSpider()
	{
		if (Main.netMode != 1)
		{
			int x = (int)(base.Center.X - velocity.X * 2f);
			int y = (int)(base.Bottom.Y - velocity.Y * 2f);
			bool num = Main.tile[(int)(base.Center.X / 16f), (int)(base.Bottom.Y / 16f)].wall > 0;
			int num2 = (num ? 36 : 50);
			int num3 = (num ? 36 : 20);
			if (Collision.TryChangingSizeFromBottomCenter(base.Hitbox, num2, num3, out var changedHitbox))
			{
				x = changedHitbox.Left + num2 / 2;
				y = changedHitbox.Top + num3;
			}
			int num4 = -1;
			num4 = ((!num) ? NPC.NewNPC(GetNPCSource_FromThis(), x, y, 164) : NPC.NewNPC(GetNPCSource_FromThis(), x, y, 165));
			if (num4 >= 0)
			{
				Main.npc[num4].netUpdate = true;
				NetMessage.SendData(23, -1, -1, null, num4);
			}
		}
	}

	public void Kill()
	{
		if (!active)
		{
			return;
		}
		Main.projectileIdentity[owner, identity] = -1;
		int num = timeLeft;
		timeLeft = 0;
		bool flag = true;
		if (type >= 0 && type < ProjectileID.Count && ProjectileID.Sets.DontCancelChannelOnKill[type])
		{
			flag = false;
		}
		if (owner == Main.myPlayer && flag)
		{
			Main.player[owner].TryCancelChannel(this);
		}
		if (aiStyle == 16 && ProjectileID.Sets.IsABombWithFuse[type])
		{
			SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2]))?.Stop();
			localAI[2] = 0f;
		}
		if (aiStyle == 16 && Main.netMode != 2)
		{
			PrepareBombToBlow();
			Rectangle projRectangle = Damage_GetHitbox();
			if (hostile)
			{
				Damage_EVP(projRectangle);
			}
			else if (friendly && !npcProj && !ProjectileID.Sets.RocketsSkipDamageForPlayers[type] && (owner == Main.myPlayer || Main.getGoodWorld))
			{
				BombsHurtPlayers(projRectangle);
			}
		}
		if (type == 1054)
		{
			Kill_SpiderBoulder_SpawnSpider();
		}
		if (Main.netMode != 1 && Main.getGoodWorld)
		{
			if (type == 472)
			{
				SpawnWebs();
			}
			if (type == 99)
			{
				BoulderExplosion();
			}
		}
		if (aiStyle == 48)
		{
			bool flag2 = type == 290;
			bool flag3 = owner == Main.myPlayer;
			if (flag2)
			{
				flag3 = Main.netMode != 1 || Main.dedServ;
			}
			if (flag3)
			{
				int num2 = AI_048_GetStartPositionSettingDelay();
				if (localAI[0] >= (float)num2)
				{
					float num3 = localAI[1];
					float num4 = localAI[2];
					ParticleOrchestraType? particleOrchestraType = null;
					switch (type)
					{
					case 433:
						particleOrchestraType = ParticleOrchestraType.UFOLaser;
						break;
					case 255:
						particleOrchestraType = ParticleOrchestraType.MagnetSphereBolt;
						break;
					case 260:
						particleOrchestraType = ParticleOrchestraType.HeatRay;
						break;
					case 290:
						particleOrchestraType = ParticleOrchestraType.ShadowbeamHostile;
						break;
					case 294:
						particleOrchestraType = ParticleOrchestraType.ShadowbeamFriendly;
						break;
					}
					if (num3 > 0f && num4 > 0f && particleOrchestraType.HasValue)
					{
						ParticleOrchestrator.BroadcastOrRequestParticleSpawn(particleOrchestraType.Value, new ParticleOrchestraSettings
						{
							PositionInWorld = base.Center,
							MovementVector = new Vector2(num3, num4),
							UniqueInfoPiece = (int)(velocity.Length() * 1000f)
						});
					}
				}
			}
		}
		if (type == 1098)
		{
			for (int i = 0; i < 50; i++)
			{
				Dust dust = Dust.NewDustDirect(position, width, height, 306, 0f, 0f, 0, new Color(100, 210, 255, 127));
				Dust dust2 = dust;
				dust2.velocity *= 2f;
				dust.velocity.X *= 0.5f;
			}
		}
		if (type == 1091)
		{
			float num5 = ai[2];
			ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.StormLightning, new ParticleOrchestraSettings
			{
				PositionInWorld = base.Center,
				UniqueInfoPiece = (int)AI_203_GetLightningColor().PackedValue,
				MovementVector = new Vector2(num5, 0f)
			});
			LightningGenerator.Bolt bolt = LightningGenerator.StormLightning.GenerateMainBoltPath((uint)num5, base.Center);
			bool flag4 = !bolt.collidedWithTile;
			if (!flag4)
			{
				base.Center = bolt.positions[bolt.positions.Length - 1];
			}
			Tile tileSafely = Framing.GetTileSafely(base.Center);
			localAI[0] = (flag4 ? 1 : 2);
			if (tileSafely.liquid != 0)
			{
				localAI[0] = 3f;
				DoLightningKillLambda();
			}
			maxPenetrate = -1;
			penetrate = -1;
			_lightningLastHitChainPos = null;
			_lightningCollisionBounds = new MultiPointHitbox(new Point(16, 16), bolt.positions);
			Damage();
			_lightningCollisionBounds = null;
			if (owner == Main.myPlayer && WorldGen.IsTileALeafyTreeTop(tileSafely))
			{
				for (int j = Main.rand.Next(2, 6); j > 0; j--)
				{
					int num6 = NewProjectile(GetProjectileSource_FromThis(), base.Center, Main.rand.NextVector2Circular(5f, 3f), 400 + Main.rand.Next(3), 10, 0f, owner);
					Projectile projectile = Main.projectile[num6];
					projectile.timeLeft /= 3;
				}
			}
		}
		else if (type == 1020 || type == 1105)
		{
			if (type == 1020)
			{
				if (position.Y - (float)height <= 640f && owner == Main.myPlayer)
				{
					Main.Achievements.GetCondition("TO_INFINITY_AND_BEYOND", "Do").Complete();
				}
				SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2]))?.Stop();
			}
			SoundEngine.PlaySound(SoundID.Item62, position);
			Color transparent = Color.Transparent;
			for (int k = 0; k < 15; k++)
			{
				Dust dust3 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, transparent, 0.8f);
				dust3.fadeIn = 0f;
				Dust dust2 = dust3;
				dust2.velocity *= 0.5f;
			}
			for (int l = 0; l < 5; l++)
			{
				Dust dust4 = Dust.NewDustDirect(position, width, height, 228, 0f, 0f, 100, transparent, 2.5f);
				dust4.noGravity = true;
				Dust dust2 = dust4;
				dust2.velocity *= 2.5f;
				dust4 = Dust.NewDustDirect(position, width, height, 228, 0f, 0f, 100, transparent, 1.1f);
				dust2 = dust4;
				dust2.velocity *= 2f;
				dust4.noGravity = true;
			}
			for (int m = 0; m < 3; m++)
			{
				Dust dust5 = Dust.NewDustDirect(position, width, height, 226, 0f, 0f, 100, transparent, 1.1f);
				Dust dust2 = dust5;
				dust2.velocity *= 2f;
				dust5.noGravity = true;
			}
			for (int n = -1; n <= 1; n += 2)
			{
				for (int num7 = -1; num7 <= 1; num7 += 2)
				{
					if (Main.rand.Next(5) == 0)
					{
						Gore gore = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
						Gore gore2 = gore;
						gore2.velocity *= 0.2f;
						gore2 = gore;
						gore2.scale *= 0.65f;
						gore2 = gore;
						gore2.velocity += new Vector2(n, num7) * 0.5f;
					}
				}
			}
		}
		else if (type == 1085)
		{
			SoundEngine.PlaySound(SoundID.Item106, base.Center);
			oldVelocity *= 0.2f;
			position -= oldVelocity;
			for (int num8 = 0; num8 < 10; num8++)
			{
				int num9 = Dust.NewDust(position, width, height, 330);
				Dust dust2 = Main.dust[num9];
				dust2.velocity -= oldVelocity;
			}
			Gore.NewGore(base.Center, -oldVelocity, 1394);
			Gore.NewGore(base.Center, -oldVelocity, 1395);
			Gore.NewGore(base.Center, -oldVelocity, 1396);
			Gore.NewGore(base.Center, -oldVelocity, 1397);
			Rectangle rect = getRect();
			int num10 = 150;
			rect.Inflate(num10, num10);
			if (Main.netMode != 2 && Main.player[Main.myPlayer].getRect().Intersects(rect))
			{
				Main.player[Main.myPlayer].brokenMirrorBadLuckTime = 25200;
			}
		}
		else
		{
			if (type == 1080)
			{
				if (Main.netMode != 2 && !Main.player[Main.myPlayer].dead)
				{
					Rectangle value = new Rectangle((int)Main.player[Main.myPlayer].position.X, (int)Main.player[Main.myPlayer].position.Y, Main.player[Main.myPlayer].width, Main.player[Main.myPlayer].height);
					if (getRect().Intersects(value))
					{
						ApplyBuffTo(Main.player[Main.myPlayer], 120, 600);
					}
				}
				SoundEngine.PlaySound(SoundID.Item177, (int)base.Center.X, (int)base.Center.Y);
				for (int num11 = 0; num11 < 30; num11++)
				{
					int num12 = Dust.NewDust(base.Center, 1, 1, 329);
					Dust dust2 = Main.dust[num12];
					dust2.velocity *= 0.8f;
					Main.dust[num12].velocity.Y *= 0.2f;
					Main.dust[num12].velocity.Y -= Main.rand.NextFloat() * 3f;
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num12].noGravity = true;
						Main.dust[num12].scale = Main.rand.NextFloat() * 0.6f + 0.6f;
					}
					else
					{
						Main.dust[num12].scale = Main.rand.NextFloat() * 0.5f + 0.5f;
					}
				}
				active = false;
				return;
			}
			if (type == 1084)
			{
				SoundEngine.PlaySound(SoundID.Item10, base.Center);
				int num13 = TorchID.Dust[(int)ai[0]];
				float num14 = 40f;
				for (float num15 = 0f; num15 < num14; num15++)
				{
					Vector2 vector = position;
					int num16 = Dust.NewDust(vector, 4, 4, num13, 0f, 0f, 100);
					if (Main.rand.Next(3) != 0)
					{
						Main.dust[num16].noGravity = true;
					}
					Dust dust2 = Main.dust[num16];
					dust2.velocity *= 2.5f;
					if (num13 == 66)
					{
						Main.dust[num16].color = new Color(Main.DiscoR, Main.DiscoG, Main.DiscoB);
						Main.dust[num16].noGravity = true;
					}
				}
			}
			else if (type == 949)
			{
				SoundEngine.PlaySound(SoundID.Item10, base.Center);
				int num17 = (int)ai[0];
				float num18 = 20f;
				for (float num19 = 0f; num19 < num18; num19++)
				{
					Vector2 vector2 = position;
					int num20 = Dust.NewDust(vector2, 4, 4, num17, 0f, 0f, 100);
					if (Main.rand.Next(3) != 0)
					{
						Main.dust[num20].noGravity = true;
					}
					Dust dust2 = Main.dust[num20];
					dust2.velocity *= 0.8f;
					if (num17 == 66)
					{
						Main.dust[num20].color = new Color(Main.DiscoR, Main.DiscoG, Main.DiscoB);
						Main.dust[num20].noGravity = true;
					}
				}
			}
			else if (type == 985)
			{
				if (localAI[1] != 1f)
				{
					Color value2 = new Color(64, 220, 96);
					Color value3 = new Color(15, 84, 125);
					for (int num21 = 0; num21 < 20; num21++)
					{
						float num22 = Main.rand.NextFloatDirection();
						float num23 = 1f - Math.Abs(num22);
						float f = rotation + num22 * ((float)Math.PI / 2f) * 0.9f;
						Vector2 vector3 = base.Center + f.ToRotationVector2() * Utils.Remap(Main.rand.NextFloat(), 0f, 1f, 60f, 85f) * scale;
						float num24 = Main.rand.NextFloat();
						vector3 -= rotation.ToRotationVector2() * num24 * 70f * scale;
						Color value4 = Color.Lerp(value3, value2, 1f);
						value4 = Color.Lerp(value4, Color.White, 0.5f);
						Color.Lerp(value4, Color.White, Main.rand.NextFloat() * 0.3f);
						Dust dust6 = Dust.NewDustPerfect(vector3, 107, velocity.RotatedBy(num22 * ((float)Math.PI / 4f)) * 0.2f * Main.rand.NextFloat(), 100, default(Color), 1.4f * num23);
						Dust dust2 = dust6;
						dust2.position -= dust6.velocity * Main.rand.NextFloat() * 3f;
						dust2 = dust6;
						dust2.scale *= 1f - num24;
					}
					for (int num25 = 0; num25 < 10; num25++)
					{
						float num26 = Main.rand.NextFloatDirection();
						float num27 = 1f - Math.Abs(num26);
						float f2 = rotation + num26 * ((float)Math.PI / 2f) * 0.9f;
						Vector2 vector4 = base.Center + f2.ToRotationVector2() * Utils.Remap(Main.rand.NextFloat(), 0f, 1f, 70f, 85f) * scale;
						float num28 = Main.rand.NextFloat() * 0.25f;
						vector4 -= rotation.ToRotationVector2() * (0.2f + num28) * 70f * scale;
						Color value5 = Color.Lerp(value3, value2, 0.66f);
						value5 = Color.Lerp(value5, Color.White, 0.33f);
						Color.Lerp(value5, Color.White, Main.rand.NextFloat() * 0.3f);
						Dust dust7 = Dust.NewDustPerfect(vector4, 107, velocity.RotatedBy(num26 * ((float)Math.PI / 4f)) * 0.2f * Main.rand.NextFloat(), 100, default(Color), 1.4f * num27);
						Dust dust2 = dust7;
						dust2.position -= dust7.velocity * Main.rand.NextFloat() * 3f;
						dust2 = dust7;
						dust2.scale *= 1f - num28;
					}
					for (int num29 = 0; num29 < 10; num29++)
					{
						float num30 = Main.rand.NextFloatDirection();
						float num31 = 1f - Math.Abs(num30);
						float f3 = rotation + num30 * ((float)Math.PI / 2f) * 0.9f;
						Vector2 vector5 = base.Center + f3.ToRotationVector2() * Utils.Remap(Main.rand.NextFloat(), 0f, 1f, 60f, 75f) * scale;
						float num32 = Main.rand.NextFloat() * 0.25f;
						vector5 -= rotation.ToRotationVector2() * (0.5f + num32) * 70f * scale;
						Color value6 = Color.Lerp(value3, value2, 0.33f);
						value6 = Color.Lerp(value6, Color.White, 0.16f);
						Color.Lerp(value6, Color.White, Main.rand.NextFloat() * 0.3f);
						Dust dust8 = Dust.NewDustPerfect(vector5, 107, velocity.RotatedBy(num30 * ((float)Math.PI / 4f)) * 0.2f * Main.rand.NextFloat(), 100, default(Color), 1.4f * num31);
						Dust dust2 = dust8;
						dust2.position -= dust8.velocity * Main.rand.NextFloat() * 3f;
						dust2 = dust8;
						dust2.scale *= 1f - num32;
					}
				}
			}
			else if (type == 1038)
			{
				for (int num33 = 0; num33 < 4; num33++)
				{
					Dust dust9 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(10f, 10f) * scale, 166, Vector2.Zero);
					dust9.scale = 1.5f + Main.rand.NextFloat() * 0.25f;
					dust9.noGravity = true;
				}
			}
			else if (type == 1036)
			{
				for (int num34 = 0; num34 < 3; num34++)
				{
					Dust dust10 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(4f, 4f) * scale, 5, Vector2.Zero);
					dust10.scale = 1.5f;
					dust10.noGravity = true;
				}
			}
			else if (type == 756)
			{
				for (float num35 = 0f; num35 < 1f; num35 += 0.025f)
				{
					Dust dust11 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(16f, 16f) * scale + velocity.SafeNormalize(Vector2.UnitY) * num35 * 200f * scale, 5, Main.rand.NextVector2Circular(3f, 3f));
					dust11.velocity.Y += -0.3f;
					Dust dust2 = dust11;
					dust2.velocity += velocity * 0.2f;
					dust11.scale = 1f;
					dust11.alpha = 100;
				}
			}
			else if (type == 961)
			{
				for (float num36 = 0f; num36 < 1f; num36 += 0.25f)
				{
					Dust dust12 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(16f, 16f) * scale + velocity.SafeNormalize(Vector2.UnitY) * num36 * 200f * scale, 16, Main.rand.NextVector2Circular(3f, 3f));
					dust12.velocity.Y += -0.3f;
					Dust dust2 = dust12;
					dust2.velocity += velocity * 0.2f;
					dust12.scale = 1f;
					dust12.alpha = 100;
				}
			}
			else if (type == 962)
			{
				for (int num37 = 0; num37 < 20; num37++)
				{
					Dust dust13 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(16f, 16f) * scale, 16, Main.rand.NextVector2Circular(2f, 2f));
					Dust dust2 = dust13;
					dust2.velocity += velocity * 0.1f;
					dust13.scale = 1f;
					dust13.alpha = 100;
				}
			}
			else if (type == 932)
			{
				Color fairyQueenWeaponsColor = GetFairyQueenWeaponsColor();
				SoundEngine.PlaySound(SoundID.Item10, base.Center);
				Vector2 target = base.Center;
				Main.rand.NextFloat();
				int num38 = 10;
				for (int num39 = 0; num39 < num38; num39++)
				{
					Vector2 vector6 = position - velocity * num39;
					int num40 = Main.rand.Next(1, 3);
					float num41 = MathHelper.Lerp(0.3f, 1f, Utils.GetLerpValue(num38, 0f, num39, clamped: true));
					if ((float)num39 >= (float)oldPos.Length * 0.3f)
					{
						num40--;
					}
					if ((float)num39 >= (float)oldPos.Length * 0.75f)
					{
						num40 -= 2;
					}
					vector6.DirectionTo(target).SafeNormalize(Vector2.Zero);
					target = vector6;
					for (float num42 = 0f; num42 < (float)num40; num42++)
					{
						int num43 = Dust.NewDust(vector6, width, height, 267, 0f, 0f, 0, fairyQueenWeaponsColor);
						Dust dust2 = Main.dust[num43];
						dust2.velocity *= Main.rand.NextFloat() * 0.8f;
						Main.dust[num43].noGravity = true;
						Main.dust[num43].scale = 0.9f + Main.rand.NextFloat() * 1.2f;
						Main.dust[num43].fadeIn = Main.rand.NextFloat() * 1.2f * num41;
						dust2 = Main.dust[num43];
						dust2.scale *= num41;
						if (num43 != 6000)
						{
							Dust dust14 = Dust.CloneDust(num43);
							dust2 = dust14;
							dust2.scale /= 2f;
							dust2 = dust14;
							dust2.fadeIn *= 0.85f;
							dust14.color = new Color(255, 255, 255, 255);
						}
					}
				}
			}
			else if (type == 931 || type == 1039)
			{
				Color newColor = ((type == 1039) ? GetConstellationColor() : GetFairyQueenWeaponsColor());
				SoundEngine.PlaySound(SoundID.Item10, base.Center);
				Vector2 target2 = base.Center;
				Main.rand.NextFloat();
				for (int num44 = 0; num44 < oldPos.Length; num44++)
				{
					Vector2 vector7 = oldPos[num44];
					if (vector7 == Vector2.Zero)
					{
						break;
					}
					int num45 = Main.rand.Next(1, 3);
					float num46 = MathHelper.Lerp(0.3f, 1f, Utils.GetLerpValue(oldPos.Length, 0f, num44, clamped: true));
					if ((float)num44 >= (float)oldPos.Length * 0.3f)
					{
						num45--;
					}
					if ((float)num44 >= (float)oldPos.Length * 0.75f)
					{
						num45 -= 2;
					}
					vector7.DirectionTo(target2).SafeNormalize(Vector2.Zero);
					target2 = vector7;
					for (float num47 = 0f; num47 < (float)num45; num47++)
					{
						int num48 = Dust.NewDust(vector7, width, height, 267, 0f, 0f, 0, newColor);
						Dust dust2 = Main.dust[num48];
						dust2.velocity *= Main.rand.NextFloat() * 0.8f;
						Main.dust[num48].noGravity = true;
						Main.dust[num48].scale = 0.9f + Main.rand.NextFloat() * 1.2f;
						Main.dust[num48].fadeIn = Main.rand.NextFloat() * 1.2f * num46;
						dust2 = Main.dust[num48];
						dust2.scale *= num46;
						if (num48 != 6000)
						{
							Dust dust15 = Dust.CloneDust(num48);
							dust2 = dust15;
							dust2.scale /= 2f;
							dust2 = dust15;
							dust2.fadeIn *= 0.85f;
							dust15.color = new Color(255, 255, 255, 255);
						}
					}
				}
			}
			else if (type == 1047)
			{
				SoundEngine.PlaySound(SoundID.RainbowBoulder, base.Center);
				Vector2 target3 = base.Center;
				float num49 = Main.rand.NextFloat();
				for (int num50 = 0; num50 < oldPos.Length; num50++)
				{
					Vector2 vector8 = oldPos[num50];
					if (vector8 == Vector2.Zero)
					{
						break;
					}
					Color newColor2 = Main.hslToRgb((num49 + Utils.GetLerpValue(oldPos.Length, 0f, num50, clamped: true)) % 1f, 1f, 0.65f);
					int num51 = Main.rand.Next(1, 4);
					float lerpValue = Utils.GetLerpValue(oldPos.Length, 0f, num50, clamped: true);
					float num52 = MathHelper.Lerp(0.3f, 1f, lerpValue);
					if ((float)num50 >= (float)oldPos.Length * 0.3f)
					{
						num51--;
					}
					if ((float)num50 >= (float)oldPos.Length * 0.65f)
					{
						num51 -= 2;
					}
					if ((float)num50 >= (float)oldPos.Length * 0.85f)
					{
						num51 -= 3;
					}
					Vector2 vector9 = vector8.DirectionTo(target3).SafeNormalize(Vector2.Zero);
					target3 = vector8;
					Vector2 vector10 = base.Size / 2f;
					for (float num53 = 0f; num53 < (float)num51; num53++)
					{
						int num54 = Dust.NewDust(vector8, width, height, 267, 0f, 0f, 0, newColor2);
						Dust dust2 = Main.dust[num54];
						dust2.velocity *= Main.rand.NextFloat() * 0.8f;
						Main.dust[num54].noGravity = true;
						Main.dust[num54].scale = 0.9f + Main.rand.NextFloat() * 1.2f;
						Main.dust[num54].fadeIn = Main.rand.NextFloat() * 1.2f * num52;
						dust2 = Main.dust[num54];
						dust2.velocity += vector9 * 6f;
						dust2 = Main.dust[num54];
						dust2.scale *= num52;
						Main.dust[num54].position = Vector2.Lerp(vector8 + vector10, Main.dust[num54].position, lerpValue);
						if (num54 != 6000)
						{
							Dust dust16 = Dust.CloneDust(num54);
							dust2 = dust16;
							dust2.scale /= 2f;
							dust2 = dust16;
							dust2.fadeIn *= 0.85f;
							dust16.color = new Color(255, 255, 255, 255);
						}
					}
				}
				for (float num55 = 0f; num55 < 0.5f; num55 += 0.25f)
				{
					ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.RainbowRodHit, new ParticleOrchestraSettings
					{
						PositionInWorld = base.Center,
						MovementVector = Vector2.UnitX.RotatedBy(num55 * ((float)Math.PI * 2f)) * 16f
					}, owner);
				}
				for (int num56 = 0; num56 < 14; num56++)
				{
					int num57 = Dust.NewDust(position, width, height, 66, 0f, 0f, 100, Main.hslToRgb(Main.rand.NextFloat(), 1f, 0.5f), 1.7f);
					Main.dust[num57].noGravity = true;
					Dust dust2 = Main.dust[num57];
					dust2.velocity *= 3f;
				}
			}
			else if (type == 79)
			{
				int newWidth = width;
				int newHeight = height;
				Resize(128, 128);
				maxPenetrate = -1;
				penetrate = -1;
				Damage();
				Resize(newWidth, newHeight);
				SoundEngine.PlaySound(SoundID.Item10, base.Center);
				Vector2 target4 = base.Center;
				float num58 = Main.rand.NextFloat();
				for (int num59 = 0; num59 < oldPos.Length; num59++)
				{
					Vector2 vector11 = oldPos[num59];
					if (vector11 == Vector2.Zero)
					{
						break;
					}
					Color newColor3 = Main.hslToRgb((num58 + Utils.GetLerpValue(oldPos.Length, 0f, num59, clamped: true)) % 1f, 1f, 0.65f);
					int num60 = Main.rand.Next(1, 4);
					float lerpValue2 = Utils.GetLerpValue(oldPos.Length, 0f, num59, clamped: true);
					float num61 = MathHelper.Lerp(0.3f, 1f, lerpValue2);
					if ((float)num59 >= (float)oldPos.Length * 0.3f)
					{
						num60--;
					}
					if ((float)num59 >= (float)oldPos.Length * 0.65f)
					{
						num60 -= 2;
					}
					if ((float)num59 >= (float)oldPos.Length * 0.85f)
					{
						num60 -= 3;
					}
					Vector2 vector12 = vector11.DirectionTo(target4).SafeNormalize(Vector2.Zero);
					target4 = vector11;
					Vector2 vector13 = base.Size / 2f;
					for (float num62 = 0f; num62 < (float)num60; num62++)
					{
						int num63 = Dust.NewDust(vector11, width, height, 267, 0f, 0f, 0, newColor3);
						Dust dust2 = Main.dust[num63];
						dust2.velocity *= Main.rand.NextFloat() * 0.8f;
						Main.dust[num63].noGravity = true;
						Main.dust[num63].scale = 0.9f + Main.rand.NextFloat() * 1.2f;
						Main.dust[num63].fadeIn = Main.rand.NextFloat() * 1.2f * num61;
						dust2 = Main.dust[num63];
						dust2.velocity += vector12 * 6f;
						dust2 = Main.dust[num63];
						dust2.scale *= num61;
						Main.dust[num63].position = Vector2.Lerp(vector11 + vector13, Main.dust[num63].position, lerpValue2);
						if (num63 != 6000)
						{
							Dust dust17 = Dust.CloneDust(num63);
							dust2 = dust17;
							dust2.scale /= 2f;
							dust2 = dust17;
							dust2.fadeIn *= 0.85f;
							dust17.color = new Color(255, 255, 255, 255);
						}
					}
				}
				for (float num64 = 0f; num64 < 0.5f; num64 += 0.25f)
				{
					ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.RainbowRodHit, new ParticleOrchestraSettings
					{
						PositionInWorld = base.Center,
						MovementVector = Vector2.UnitX.RotatedBy(num64 * ((float)Math.PI * 2f)) * 16f
					}, owner);
				}
				for (int num65 = 0; num65 < 14; num65++)
				{
					int num66 = Dust.NewDust(position, width, height, 66, 0f, 0f, 100, Main.hslToRgb(Main.rand.NextFloat(), 1f, 0.5f), 1.7f);
					Main.dust[num66].noGravity = true;
					Dust dust2 = Main.dust[num66];
					dust2.velocity *= 3f;
				}
			}
			else if (type == 16)
			{
				int newWidth2 = width;
				int newHeight2 = height;
				Resize(128, 128);
				maxPenetrate = -1;
				penetrate = -1;
				Damage();
				Resize(newWidth2, newHeight2);
				SoundEngine.PlaySound(SoundID.Item10, base.Center);
				Vector2 target5 = base.Center;
				for (int num67 = 0; num67 < oldPos.Length; num67++)
				{
					Vector2 vector14 = oldPos[num67];
					if (vector14 == Vector2.Zero)
					{
						break;
					}
					Color newColor4 = Main.hslToRgb(4f / 9f + Main.rand.NextFloat() * (2f / 9f), 1f, 0.65f);
					int num68 = Main.rand.Next(1, 4);
					float num69 = MathHelper.Lerp(0.3f, 1f, Utils.GetLerpValue(oldPos.Length, 0f, num67, clamped: true));
					if ((float)num67 >= (float)oldPos.Length * 0.3f)
					{
						num68--;
					}
					if ((float)num67 >= (float)oldPos.Length * 0.75f)
					{
						num68 -= 2;
					}
					Vector2 vector15 = vector14.DirectionTo(target5).SafeNormalize(Vector2.Zero);
					target5 = vector14;
					for (float num70 = 0f; num70 < (float)num68; num70++)
					{
						if (Main.rand.Next(3) == 0)
						{
							int num71 = Dust.NewDust(vector14, width, height, 267, 0f, 0f, 0, newColor4);
							Dust dust2 = Main.dust[num71];
							dust2.velocity *= Main.rand.NextFloat() * 0.8f;
							Main.dust[num71].noGravity = true;
							Main.dust[num71].scale = Main.rand.NextFloat() * 0.8f;
							Main.dust[num71].fadeIn = Main.rand.NextFloat() * 1.2f * num69;
							dust2 = Main.dust[num71];
							dust2.velocity += vector15 * 6f;
							dust2 = Main.dust[num71];
							dust2.scale *= num69;
							if (num71 != 6000)
							{
								Dust dust18 = Dust.CloneDust(num71);
								dust2 = dust18;
								dust2.scale /= 2f;
								dust2 = dust18;
								dust2.fadeIn /= 2f;
								dust18.color = new Color(255, 255, 255, 255);
							}
						}
						else
						{
							Dust dust19 = Dust.NewDustDirect(vector14, width, height, 15, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100);
							Main.rand.Next(2);
							dust19.noGravity = true;
							Dust dust2 = dust19;
							dust2.velocity *= 2f;
							dust2 = dust19;
							dust2.velocity += vector15 * 9f;
							dust2 = dust19;
							dust2.scale *= num69;
							dust19.fadeIn = (0.6f + Main.rand.NextFloat() * 0.4f) * num69;
							dust19.noLightEmittence = (dust19.noLight = true);
						}
					}
				}
				for (int num72 = 0; num72 < 20; num72++)
				{
					Dust dust20 = Dust.NewDustDirect(position, width, height, 15);
					dust20.noGravity = true;
					dust20.velocity = Main.rand.NextVector2Circular(1f, 1f) * 1.5f;
					dust20.scale = 1.2f + Main.rand.NextFloat() * 0.5f;
					dust20.noLightEmittence = (dust20.noLight = true);
					Dust dust2 = dust20;
					dust2.velocity += velocity * 0.01f;
					dust2 = dust20;
					dust2.position += dust20.velocity * Main.rand.Next(1, 16);
					dust20 = Dust.NewDustDirect(position, width, height, 15, 0f, 0f, 100);
					dust2 = dust20;
					dust2.velocity *= 1.2f;
					dust20.noLightEmittence = (dust20.noLight = true);
					dust2 = dust20;
					dust2.velocity += velocity * 0.01f;
					dust2 = dust20;
					dust2.scale *= 0.8f + Main.rand.NextFloat() * 0.2f;
					dust2 = dust20;
					dust2.position += dust20.velocity * Main.rand.Next(1, 16);
				}
			}
			else if (type == 34)
			{
				int newWidth3 = width;
				int newHeight3 = height;
				Resize(96, 96);
				maxPenetrate = -1;
				penetrate = -1;
				Damage();
				Resize(newWidth3, newHeight3);
				SoundEngine.PlaySound(SoundID.Item10, position);
				Vector2 target6 = base.Center;
				for (int num73 = 0; num73 < oldPos.Length; num73++)
				{
					Vector2 vector16 = oldPos[num73];
					if (vector16 == Vector2.Zero)
					{
						break;
					}
					Color newColor5 = Main.hslToRgb(Main.rand.NextFloat() * (1f / 9f), 1f, 0.5f);
					int num74 = Main.rand.Next(1, 5);
					float num75 = MathHelper.Lerp(0.3f, 1f, Utils.GetLerpValue(oldPos.Length, 0f, num73, clamped: true));
					if ((float)num73 >= (float)oldPos.Length * 0.3f)
					{
						num74--;
					}
					if ((float)num73 >= (float)oldPos.Length * 0.75f)
					{
						num74 -= 2;
					}
					Vector2 vector17 = vector16.DirectionTo(target6).SafeNormalize(Vector2.Zero);
					target6 = vector16;
					for (float num76 = 0f; num76 < (float)num74; num76++)
					{
						if (Main.rand.Next(3) == 0)
						{
							int num77 = Dust.NewDust(vector16, width, height, 267, 0f, 0f, 0, newColor5);
							Dust dust2 = Main.dust[num77];
							dust2.velocity *= Main.rand.NextFloat() * 0.8f;
							Main.dust[num77].noGravity = true;
							Main.dust[num77].scale = Main.rand.NextFloat() * 1f;
							Main.dust[num77].fadeIn = Main.rand.NextFloat() * 2f;
							dust2 = Main.dust[num77];
							dust2.velocity += vector17 * 8f;
							dust2 = Main.dust[num77];
							dust2.scale *= num75;
							if (num77 != 6000)
							{
								Dust dust21 = Dust.CloneDust(num77);
								dust2 = dust21;
								dust2.scale /= 2f;
								dust2 = dust21;
								dust2.fadeIn /= 2f;
								dust21.color = new Color(255, 255, 255, 255);
							}
						}
						else
						{
							Dust dust22 = Dust.NewDustDirect(vector16, width, height, 6, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100);
							Dust dust2;
							if (Main.rand.Next(2) == 0)
							{
								dust22.noGravity = true;
								dust2 = dust22;
								dust2.scale *= 2.5f;
							}
							dust2 = dust22;
							dust2.velocity *= 2f;
							dust2 = dust22;
							dust2.velocity += vector17 * 6f;
							dust2 = dust22;
							dust2.scale *= num75;
							dust22.noLightEmittence = (dust22.noLight = true);
						}
					}
				}
				for (int num78 = 0; num78 < 20; num78++)
				{
					Dust dust23 = Dust.NewDustDirect(position, width, height, 6, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100);
					dust23.noGravity = true;
					dust23.velocity = Main.rand.NextVector2Circular(1f, 1f) * 6f;
					dust23.scale = 1.6f;
					dust23.fadeIn = 1.3f + Main.rand.NextFloat() * 1f;
					dust23.noLightEmittence = (dust23.noLight = true);
					Dust dust2 = dust23;
					dust2.velocity += velocity * 0.1f;
					dust23 = Dust.NewDustDirect(position, width, height, 6, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100);
					dust2 = dust23;
					dust2.velocity *= 2f;
					dust23.noLightEmittence = (dust23.noLight = true);
					dust2 = dust23;
					dust2.velocity += velocity * 0.1f;
				}
			}
		}
		if (type == 873)
		{
			int num79 = 20;
			float num80 = (float)Math.PI * 2f / (float)num79;
			float num81 = velocity.ToRotation();
			Color value7 = AI_171_GetColor();
			for (int num82 = 0; num82 < num79; num82++)
			{
				Dust dust24 = Dust.NewDustPerfect(base.Center, 267);
				dust24.fadeIn = 1f;
				dust24.noGravity = true;
				dust24.alpha = 100;
				dust24.color = Color.Lerp(value7, Color.White, Main.rand.NextFloat() * 0.4f);
				if (num82 % 4 == 0)
				{
					dust24.velocity = num81.ToRotationVector2() * 3.2f;
					dust24.scale = 2.3f;
				}
				else if (num82 % 2 == 0)
				{
					dust24.velocity = num81.ToRotationVector2() * 1.8f;
					dust24.scale = 1.9f;
				}
				else
				{
					dust24.velocity = num81.ToRotationVector2();
					dust24.scale = 1.6f;
				}
				num81 += num80;
				Dust dust2 = dust24;
				dust2.velocity += velocity * Main.rand.NextFloat() * 0.5f;
			}
		}
		_ = type;
		_ = 857;
		if (type == 1012)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			for (int num83 = 0; num83 < 40; num83++)
			{
				Vector2 vector18 = Vector2.UnitY.RotatedBy((float)num83 * ((float)Math.PI * 2f)) * (2f + Main.rand.NextFloat() * 0.5f);
				vector18 += velocity * Main.rand.NextFloat();
				Color white = Color.White;
				if (Main.rand.Next(3) == 0)
				{
					Dust dust25 = Dust.NewDustDirect(newColor: Main.rand.Next(3) switch
					{
						0 => new Color(226, 116, 56), 
						1 => new Color(243, 175, 93), 
						2 => new Color(254, 210, 146), 
						_ => new Color(176, 64, 36), 
					}, Position: position + Main.rand.NextVector2Circular(18f, 18f) * scale, Width: 2, Height: 2, Type: 284, SpeedX: vector18.X, SpeedY: vector18.Y, Alpha: 0, Scale: Main.rand.NextFloat() * 1f + 1f);
					Dust dust2 = dust25;
					dust2.position -= velocity;
					dust25.fadeIn = 1f;
				}
				else
				{
					vector18 *= 0.3f;
					Dust dust26 = Dust.NewDustDirect(position + Main.rand.NextVector2Circular(18f, 18f) * scale, 2, 2, 138, vector18.X, vector18.Y, 0, default(Color), Main.rand.NextFloat() * 0.3f + 0.6f);
					Dust dust2 = dust26;
					dust2.position -= velocity;
				}
			}
		}
		if (type == 920)
		{
			for (int num84 = 0; num84 < 6; num84++)
			{
				Vector2 vector19 = Vector2.UnitY.RotatedBy((float)num84 * ((float)Math.PI * 2f) + Main.rand.NextFloat() * ((float)Math.PI * 2f) * 0.5f) * (2f + Main.rand.NextFloat() * 0.5f);
				int num85 = Dust.NewDust(position + base.Size * Main.rand.NextVector2Square(0f, 1f), 4, 4, 4, vector19.X, vector19.Y, 80, new Color(78, 136, 255, 150), 1.5f);
				Main.dust[num85].noGravity = true;
			}
		}
		if (type == 921)
		{
			for (int num86 = 0; num86 < 12; num86++)
			{
				Vector2 vector20 = Vector2.UnitY.RotatedBy((float)num86 * ((float)Math.PI * 2f) + Main.rand.NextFloat() * ((float)Math.PI * 2f) * 0.5f) * (3f + Main.rand.NextFloat() * 0.5f);
				int num87 = Dust.NewDust(position + base.Size * Main.rand.NextVector2Square(0f, 1f), 6, 6, 243, vector20.X, vector20.Y, 80, default(Color), 1.5f);
				Main.dust[num87].noGravity = true;
			}
		}
		if (type == 926)
		{
			for (int num88 = 0; num88 < 22; num88++)
			{
				Vector2 vector21 = Vector2.UnitY.RotatedBy((float)num88 * ((float)Math.PI * 2f) + Main.rand.NextFloat() * ((float)Math.PI * 2f) * 0.5f) * (3f + Main.rand.NextFloat() * 0.5f);
				int num89 = Dust.NewDust(position - new Vector2(8f, 8f), width + 16, height + 16, 31, vector21.X, vector21.Y, 40, NPC.AI_121_QueenSlime_GetDustColor(), 1.5f);
				Main.dust[num89].noGravity = true;
			}
		}
		if (type == 937)
		{
			for (int num90 = 0; num90 < 12; num90++)
			{
				Vector2 vector22 = Vector2.UnitY.RotatedBy((float)num90 * ((float)Math.PI * 2f) + Main.rand.NextFloat() * ((float)Math.PI * 2f) * 0.5f) * (3f + Main.rand.NextFloat() * 0.5f);
				int num91 = Dust.NewDust(position - new Vector2(8f, 8f), width + 16, height + 16, 31, vector22.X, vector22.Y, 40, NPC.AI_121_QueenSlime_GetDustColor(), 1.5f);
				Main.dust[num91].noGravity = true;
			}
		}
		if (type == 818)
		{
			for (float num92 = 0f; num92 < 1f; num92 += 0.34f)
			{
				Dust.NewDustPerfect(position + base.Size * Main.rand.NextVector2Square(0f, 1f), 278, Vector2.UnitY.RotatedBy(num92 * ((float)Math.PI * 2f) + Main.rand.NextFloat() * ((float)Math.PI * 2f) * 0.5f) * (2f + Main.rand.NextFloat() * 0.5f), 150, Color.Lerp(Color.White, Color.Gold, Main.rand.NextFloat()), 0.4f).noGravity = true;
			}
			for (float num93 = 0f; num93 < 1f; num93 += 0.34f)
			{
				Dust.NewDustPerfect(position + base.Size * Main.rand.NextVector2Square(0f, 1f), 278, Vector2.UnitY.RotatedBy(num93 * ((float)Math.PI * 2f) + Main.rand.NextFloat() * ((float)Math.PI * 2f) * 0.5f) * (1f + Main.rand.NextFloat() * 0.5f), 150, Color.Lerp(Color.White, Main.OurFavoriteColor, Main.rand.NextFloat()), 0.7f).noGravity = true;
			}
		}
		if (type == 856)
		{
			for (int num94 = 0; num94 < 6; num94++)
			{
				Dust.NewDust(position, width, height, 58, 0f, 0f, 150, default(Color), 0.8f);
			}
			for (float num95 = 0f; num95 < 1f; num95 += 0.34f)
			{
				Dust.NewDustPerfect(base.Center, 278, Vector2.UnitY.RotatedBy(num95 * ((float)Math.PI * 2f) + Main.rand.NextFloat() * ((float)Math.PI * 2f) * 0.5f) * (4f + Main.rand.NextFloat() * 2f), 150, Color.Lerp(Color.White, Color.HotPink, Main.rand.NextFloat() * 0.5f + 0.5f)).noGravity = true;
			}
			for (float num96 = 0f; num96 < 1f; num96 += 0.34f)
			{
				Dust.NewDustPerfect(base.Center, 278, Vector2.UnitY.RotatedBy(num96 * ((float)Math.PI * 2f) + Main.rand.NextFloat() * ((float)Math.PI * 2f) * 0.5f) * (2f + Main.rand.NextFloat() * 1f), 150, Color.Lerp(Color.White, Color.Orange, Main.rand.NextFloat() * 0.5f + 0.5f)).noGravity = true;
			}
			Vector2 vector23 = new Vector2(Main.screenWidth, Main.screenHeight);
			if (base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector23 / 2f, vector23 + new Vector2(400f))))
			{
				for (int num97 = 0; num97 < 1; num97++)
				{
					Gore.NewGore(position, Main.rand.NextVector2CircularEdge(0.5f, 0.5f) * 3f, Utils.SelectRandom<int>(Main.rand, 16));
				}
			}
			ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.StellarTune, new ParticleOrchestraSettings
			{
				PositionInWorld = base.Center
			}, owner);
			position = base.Center;
			width = (height = 128);
			base.Center = position;
			maxPenetrate = -1;
			penetrate = -1;
			Damage();
		}
		if (type == 818)
		{
			Damage();
		}
		if (type == 686)
		{
			SoundEngine.PlayTrackedSound(SoundID.DD2_BetsyFireballImpact, base.Center);
		}
		else if (type == 711)
		{
			SoundEngine.PlayTrackedSound(SoundID.DD2_BetsysWrathImpact, base.Center);
		}
		else if (type == 704)
		{
			ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]));
			if (activeSound != null)
			{
				activeSound.Volume = 0f;
				activeSound.Stop();
			}
		}
		if (type == 710)
		{
			ai[1] = -1f;
			position = base.Center;
			width = (height = 40);
			base.Center = position;
			Damage();
			SoundEngine.PlaySound(SoundID.Item14, position);
			for (int num98 = 0; num98 < 2; num98++)
			{
				int num99 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num99].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
			}
			for (int num100 = 0; num100 < 10; num100++)
			{
				int num101 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 0, default(Color), 2.5f);
				Main.dust[num101].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Main.dust[num101].noGravity = true;
				Dust dust2 = Main.dust[num101];
				dust2.velocity *= 2f;
			}
			for (int num102 = 0; num102 < 5; num102++)
			{
				int num103 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
				Main.dust[num103].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num103].noGravity = true;
				Dust dust2 = Main.dust[num103];
				dust2.velocity *= 2f;
			}
		}
		else if (type == 711)
		{
			Rectangle hitbox = base.Hitbox;
			for (int num104 = 0; num104 < oldPos.Length / 2; num104 += 2)
			{
				hitbox.X = (int)oldPos[num104].X;
				hitbox.Y = (int)oldPos[num104].Y;
				for (int num105 = 0; num105 < 2; num105++)
				{
					int num106 = Utils.SelectRandom<int>(Main.rand, 6, 55, 158);
					int num107 = Dust.NewDust(hitbox.TopLeft(), width, height, num106, direction, -2.5f);
					Main.dust[num107].alpha = 200;
					Dust dust2 = Main.dust[num107];
					dust2.velocity *= 2.4f;
					dust2 = Main.dust[num107];
					dust2.scale += Main.rand.NextFloat();
					dust2 = Main.dust[num107];
					dust2.scale -= 0.5f;
					if (Main.dust[num107].type == 55)
					{
						Main.dust[num107].color = Color.Lerp(new Color(128, 0, 180, 128), Color.Gold, Main.rand.NextFloat());
					}
					Main.dust[num107].noLight = true;
				}
			}
			for (int num108 = 10; num108 < oldPos.Length; num108 += 2)
			{
				hitbox.X = (int)oldPos[num108].X;
				hitbox.Y = (int)oldPos[num108].Y;
				for (int num109 = 0; num109 < 2; num109++)
				{
					if (Main.rand.Next(3) != 0)
					{
						int num110 = Utils.SelectRandom<int>(Main.rand, 55);
						int num111 = Dust.NewDust(hitbox.TopLeft(), width, height, num110, direction, -2.5f);
						Main.dust[num111].alpha = 120;
						Dust dust2 = Main.dust[num111];
						dust2.velocity *= 2.4f;
						dust2 = Main.dust[num111];
						dust2.scale += Main.rand.NextFloat() * 0.7f;
						dust2 = Main.dust[num111];
						dust2.scale -= 0.5f;
						if (Main.dust[num111].type == 55)
						{
							Main.dust[num111].color = Color.Lerp(Color.Purple, Color.Black, Main.rand.NextFloat());
						}
						Main.dust[num111].noLight = true;
					}
				}
			}
			for (int num112 = 5; num112 < oldPos.Length; num112++)
			{
				hitbox.X = (int)oldPos[num112].X;
				hitbox.Y = (int)oldPos[num112].Y;
				for (int num113 = 0; num113 < 1; num113++)
				{
					if (Main.rand.Next(3) != 0)
					{
						int num114 = Utils.SelectRandom<int>(Main.rand, 55);
						int num115 = Dust.NewDust(hitbox.TopLeft(), width, height, num114, direction, -2.5f);
						Main.dust[num115].alpha = 80;
						Dust dust2 = Main.dust[num115];
						dust2.velocity *= 0.3f;
						dust2 = Main.dust[num115];
						dust2.velocity += velocity * 0.5f;
						dust2 = Main.dust[num115];
						dust2.scale += Main.rand.NextFloat() * 0.7f;
						dust2 = Main.dust[num115];
						dust2.scale -= 0.5f;
						if (Main.dust[num115].type == 55)
						{
							Main.dust[num115].color = Color.Lerp(Color.Purple, Color.Black, Main.rand.NextFloat());
						}
						Main.dust[num115].noLight = true;
					}
				}
			}
			for (int num116 = 0; num116 < 20; num116++)
			{
				if (Main.rand.Next(3) != 0)
				{
					int num117 = 228;
					Dust dust27 = Main.dust[Dust.NewDust(position, width, height, num117)];
					dust27.noGravity = true;
					dust27.scale = 1.25f + Main.rand.NextFloat();
					dust27.fadeIn = 1.5f;
					Dust dust2 = dust27;
					dust2.velocity *= 6f;
					dust27.noLight = true;
				}
			}
			for (int num118 = 0; num118 < 20; num118++)
			{
				if (Main.rand.Next(3) != 0)
				{
					int num119 = 55;
					Dust dust28 = Main.dust[Dust.NewDust(position, width, height, num119)];
					dust28.noGravity = true;
					dust28.scale = 1.25f + Main.rand.NextFloat();
					dust28.fadeIn = 1.5f;
					Dust dust2 = dust28;
					dust2.velocity *= 6f;
					dust28.noLight = true;
					dust28.color = new Color(0, 0, 220, 128);
				}
			}
			if (owner == Main.myPlayer)
			{
				position = base.Center;
				base.Size = new Vector2(140f);
				base.Center = position;
				penetrate = -1;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
				Damage();
			}
		}
		else if (type == 662 || type == 685)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			Vector2 vector24 = oldVelocity.SafeNormalize(Vector2.Zero);
			Vector2 vector25 = position + vector24 * 16f;
			for (int num120 = 0; num120 < 16; num120++)
			{
				if (Main.rand.Next(2) == 0)
				{
					vector25 -= vector24 * 8f;
					continue;
				}
				Dust dust29 = Dust.NewDustDirect(vector25, width, height, 11);
				dust29.position = (dust29.position + base.Center) / 2f;
				Dust dust2 = dust29;
				dust2.velocity += oldVelocity * 0.4f;
				dust2 = dust29;
				dust2.velocity *= 0.5f;
				dust29.noGravity = true;
				vector25 -= vector24 * 8f;
			}
		}
		if (type == 680)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			Vector2 vector26 = oldVelocity.SafeNormalize(Vector2.Zero);
			Vector2 vector27 = position + vector26 * 16f;
			for (int num121 = 0; num121 < 16; num121++)
			{
				if (Main.rand.Next(2) == 0)
				{
					vector27 -= vector26 * 8f;
					continue;
				}
				Dust dust30 = Dust.NewDustDirect(vector27, width, height, 11);
				dust30.position = (dust30.position + base.Center) / 2f;
				Dust dust2 = dust30;
				dust2.velocity += oldVelocity * 0.4f;
				dust2 = dust30;
				dust2.velocity *= 0.5f;
				dust30.noGravity = true;
				vector27 -= vector26 * 8f;
			}
			Dust.NewDustDirect(position, width, height, 11, 0f, 0f, 0, Color.Red, 1.6f).noGravity = true;
		}
		if (type == 664 || type == 666 || type == 668 || type == 706)
		{
			int num122 = 4;
			int num123 = 20;
			int num124 = 10;
			int num125 = 20;
			int num126 = 20;
			int num127 = 4;
			float num128 = 1.5f;
			int num129 = 6;
			int num130 = 6;
			if (Main.player[owner].setApprenticeT3)
			{
				num122 += 4;
				num126 += 10;
				num123 += 20;
				num125 += 30;
				num124 /= 2;
				num127 += 4;
				num128 += 0.5f;
				num129 += 7;
				num130 = 270;
			}
			position = base.Center;
			width = (height = 16 * num129);
			base.Center = position;
			Damage();
			SoundEngine.PlaySound(SoundID.Item100, position);
			for (int num131 = 0; num131 < num122; num131++)
			{
				int num132 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num132].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
			}
			for (int num133 = 0; num133 < num123; num133++)
			{
				Dust dust31 = Dust.NewDustDirect(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 200, default(Color), 2.5f);
				dust31.position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 10f;
				Dust dust2 = dust31;
				dust2.velocity *= 16f;
				if (dust31.velocity.Y > -2f)
				{
					dust31.velocity.Y *= -0.4f;
				}
				dust31.noLight = true;
				dust31.noGravity = true;
			}
			for (int num134 = 0; num134 < num125; num134++)
			{
				Dust dust32 = Dust.NewDustDirect(new Vector2(position.X, position.Y), width, height, num130, 0f, 0f, 100, default(Color), 1.5f);
				dust32.position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Dust dust2 = dust32;
				dust2.velocity *= 2f;
				dust32.noGravity = true;
				dust32.fadeIn = num128;
			}
			for (int num135 = 0; num135 < num124; num135++)
			{
				int num136 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 0, default(Color), 2.7f);
				Main.dust[num136].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num136].noGravity = true;
				Dust dust2 = Main.dust[num136];
				dust2.velocity *= 3f;
			}
			for (int num137 = 0; num137 < num126; num137++)
			{
				int num138 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
				Main.dust[num138].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num138].noGravity = true;
				Dust dust2 = Main.dust[num138];
				dust2.velocity *= 3f;
			}
			for (int num139 = 0; num139 < num127; num139++)
			{
				int num140 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Main.gore[num140].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Gore gore2 = Main.gore[num140];
				gore2.position -= Vector2.One * 16f;
				if (Main.rand.Next(2) == 0)
				{
					Main.gore[num140].position.Y -= 30f;
				}
				gore2 = Main.gore[num140];
				gore2.velocity *= 0.3f;
				Main.gore[num140].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num140].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
		}
		else if (type == 681)
		{
			position.X += width / 2;
			position.Y += height / 2;
			SoundEngine.PlaySound(SoundID.DD2_GoblinBomb, position);
			width = 22;
			height = 22;
			position.X -= width / 2;
			position.Y -= height / 2;
			for (int num141 = 0; num141 < 10; num141++)
			{
				int num142 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				Dust dust2 = Main.dust[num142];
				dust2.velocity *= 1.4f;
				num142 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
				dust2 = Main.dust[num142];
				dust2.velocity *= 1.4f;
				Main.dust[num142].noGravity = true;
				Main.dust[num142].fadeIn = 2f;
			}
			for (int num143 = 0; num143 < 10; num143++)
			{
				int num144 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
				Main.dust[num144].noGravity = true;
				Dust dust2 = Main.dust[num144];
				dust2.velocity *= 5f;
				num144 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
				dust2 = Main.dust[num144];
				dust2.velocity *= 3f;
			}
			int num145 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
			Gore gore2 = Main.gore[num145];
			gore2.velocity *= 0.4f;
			Main.gore[num145].velocity.X += 1f;
			Main.gore[num145].velocity.Y += 1f;
			num145 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
			gore2 = Main.gore[num145];
			gore2.velocity *= 0.4f;
			Main.gore[num145].velocity.X -= 1f;
			Main.gore[num145].velocity.Y += 1f;
			num145 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
			gore2 = Main.gore[num145];
			gore2.velocity *= 0.4f;
			Main.gore[num145].velocity.X += 1f;
			Main.gore[num145].velocity.Y -= 1f;
			num145 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
			gore2 = Main.gore[num145];
			gore2.velocity *= 0.4f;
			Main.gore[num145].velocity.X -= 1f;
			Main.gore[num145].velocity.Y -= 1f;
			position.X += width / 2;
			position.Y += height / 2;
			width = 80;
			height = 80;
			position.X -= width / 2;
			position.Y -= height / 2;
			Damage();
		}
		if (type == 669)
		{
			SoundEngine.PlaySound(13, (int)position.X, (int)position.Y);
			Vector2 vector28 = new Vector2(30f, 30f);
			for (int num146 = 0; num146 < 12; num146++)
			{
				Dust dust33 = Dust.NewDustDirect(base.Center - vector28 / 2f, (int)vector28.X, (int)vector28.Y, 4, 0f, 0f, 100, new Color(255, 255, 255, 110), 1.1f);
				Dust dust2 = dust33;
				dust2.velocity *= 1.5f;
			}
			for (int num147 = 0; num147 < 80; num147++)
			{
				Dust dust34 = Dust.NewDustDirect(base.Center - vector28 / 2f, (int)vector28.X, (int)vector28.Y, 4, 0f, 0f, 50, new Color(245, 200, 30, 155), 1.2f);
				dust34.noGravity = true;
				Dust dust2 = dust34;
				dust2.velocity *= (float)Main.rand.Next(10, 71) * 0.1f;
				dust34 = Dust.NewDustDirect(base.Center - vector28 / 2f, (int)vector28.X, (int)vector28.Y, 4, 0f, 0f, 50, new Color(245, 200, 30, 155), 0.8f);
				dust2 = dust34;
				dust2.velocity *= (float)Main.rand.Next(10, 41) * 0.1f;
			}
			int num148 = 144;
			Resize(num148, num148);
			Player player = Main.player[Main.myPlayer];
			if (player.active && !player.dead && player.getRect().Intersects(getRect()))
			{
				player.AddBuff(25, 3659);
			}
			if (Main.netMode != 1)
			{
				for (int num149 = 0; num149 < Main.maxNPCs; num149++)
				{
					if (Main.npc[num149].active && Main.npc[num149].townNPC && getRect().Intersects(Main.npc[num149].getRect()))
					{
						Main.npc[num149].AddBuff(25, 3659);
					}
				}
			}
			Damage();
		}
		if (Main.myPlayer == owner && bobber)
		{
			PopupText.ClearSonarText();
			if (ai[1] > 0f && ai[1] < (float)ItemID.Count)
			{
				AI_061_FishingBobber_GiveItemToPlayer(Main.player[owner], (int)ai[1]);
			}
			ai[1] = 0f;
		}
		if (type == 634 || type == 635)
		{
			int num150 = Utils.SelectRandom<int>(Main.rand, 242, 73, 72, 71, 255);
			int num151 = 255;
			int num152 = 255;
			int num153 = 50;
			float num154 = 1.7f;
			float num155 = 0.8f;
			float num156 = 2f;
			Vector2 vector29 = (rotation - (float)Math.PI / 2f).ToRotationVector2();
			Vector2 vector30 = vector29 * velocity.Length() * MaxUpdates;
			if (type == 635)
			{
				num151 = 88;
				num152 = 88;
				num150 = Utils.SelectRandom<int>(Main.rand, 242, 59, 88);
				num154 = 3.7f;
				num155 = 1.5f;
				num156 = 2.2f;
				vector30 *= 0.5f;
			}
			SoundEngine.PlaySound(SoundID.Item14, position);
			position = base.Center;
			width = (height = num153);
			base.Center = position;
			maxPenetrate = -1;
			penetrate = -1;
			Damage();
			for (int num157 = 0; num157 < 40; num157++)
			{
				num150 = Utils.SelectRandom<int>(Main.rand, 242, 73, 72, 71, 255);
				if (type == 635)
				{
					num150 = Utils.SelectRandom<int>(Main.rand, 242, 59, 88);
				}
				int num158 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num150, 0f, 0f, 200, default(Color), num154);
				Main.dust[num158].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Main.dust[num158].noGravity = true;
				Dust dust2 = Main.dust[num158];
				dust2.velocity *= 3f;
				dust2 = Main.dust[num158];
				dust2.velocity += vector30 * Main.rand.NextFloat();
				num158 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num151, 0f, 0f, 100, default(Color), num155);
				Main.dust[num158].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				dust2 = Main.dust[num158];
				dust2.velocity *= 2f;
				Main.dust[num158].noGravity = true;
				Main.dust[num158].fadeIn = 1f;
				Main.dust[num158].color = Color.Crimson * 0.5f;
				dust2 = Main.dust[num158];
				dust2.velocity += vector30 * Main.rand.NextFloat();
			}
			for (int num159 = 0; num159 < 20; num159++)
			{
				int num160 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num152, 0f, 0f, 0, default(Color), num156);
				Main.dust[num160].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 3f;
				Main.dust[num160].noGravity = true;
				Dust dust2 = Main.dust[num160];
				dust2.velocity *= 0.5f;
				dust2 = Main.dust[num160];
				dust2.velocity += vector30 * (0.6f + 0.6f * Main.rand.NextFloat());
			}
		}
		else if (type == 651)
		{
			if (localAI[0] == 1f && owner == Main.myPlayer)
			{
				Player master = Main.player[owner];
				Point ps = new Vector2(ai[0], ai[1]).ToPoint();
				Point pe = base.Center.ToTileCoordinates();
				if (Main.netMode == 1)
				{
					NetMessage.SendData(109, -1, -1, null, ps.X, ps.Y, pe.X, pe.Y, (int)WiresUI.Settings.ToolMode);
				}
				else
				{
					Wiring.MassWireOperation(ps, pe, master);
				}
			}
		}
		else if (type == 641)
		{
			if (owner == Main.myPlayer)
			{
				for (int num161 = 0; num161 < 1000; num161++)
				{
					if (Main.projectile[num161].active && Main.projectile[num161].owner == owner && Main.projectile[num161].type == 642)
					{
						Main.projectile[num161].Kill();
					}
				}
			}
		}
		else if (type == 643)
		{
			if (owner == Main.myPlayer)
			{
				for (int num162 = 0; num162 < 1000; num162++)
				{
					if (Main.projectile[num162].active && Main.projectile[num162].owner == owner && Main.projectile[num162].type == 644)
					{
						Main.projectile[num162].Kill();
					}
				}
			}
		}
		else if (type == 645)
		{
			bool flag5 = WorldGen.SolidTile(Framing.GetTileSafely((int)position.X / 16, (int)position.Y / 16));
			for (int num163 = 0; num163 < 4; num163++)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
			}
			for (int num164 = 0; num164 < 4; num164++)
			{
				int num165 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229, 0f, 0f, 0, default(Color), 2.5f);
				Main.dust[num165].noGravity = true;
				Dust dust2 = Main.dust[num165];
				dust2.velocity *= 3f;
				if (flag5)
				{
					Main.dust[num165].noLight = true;
				}
				num165 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229, 0f, 0f, 100, default(Color), 1.5f);
				dust2 = Main.dust[num165];
				dust2.velocity *= 2f;
				Main.dust[num165].noGravity = true;
				if (flag5)
				{
					Main.dust[num165].noLight = true;
				}
			}
			for (int num166 = 0; num166 < 1; num166++)
			{
				int num167 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Gore gore2 = Main.gore[num167];
				gore2.velocity *= 0.3f;
				Main.gore[num167].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num167].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
		}
		else if (type == 636)
		{
			Rectangle hitbox2 = base.Hitbox;
			for (int num168 = 0; num168 < 6; num168 += 3)
			{
				hitbox2.X = (int)oldPos[num168].X;
				hitbox2.Y = (int)oldPos[num168].Y;
				for (int num169 = 0; num169 < 5; num169++)
				{
					int num170 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
					int num171 = Dust.NewDust(hitbox2.TopLeft(), width, height, num170, 2.5f * (float)direction, -2.5f);
					Main.dust[num171].alpha = 200;
					Dust dust2 = Main.dust[num171];
					dust2.velocity *= 2.4f;
					dust2 = Main.dust[num171];
					dust2.scale += Main.rand.NextFloat();
				}
			}
			if (Main.myPlayer == owner)
			{
				NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 953, damage, 10f, owner, 0f, 0.85f + Main.rand.NextFloat() * 1.15f);
			}
		}
		else if (type == 614)
		{
			for (int num172 = 0; num172 < 10; num172++)
			{
				Dust dust35 = Main.dust[Dust.NewDust(position, width, height, 229)];
				dust35.noGravity = true;
				Dust dust2 = dust35;
				dust2.velocity *= 3f;
			}
		}
		if (type == 644)
		{
			DoRainbowCrystalStaffExplosion();
			if (Main.myPlayer == owner)
			{
				friendly = true;
				int num173 = width;
				int num174 = height;
				int num175 = penetrate;
				position = base.Center;
				width = (height = 60);
				base.Center = position;
				penetrate = -1;
				maxPenetrate = -1;
				Damage();
				penetrate = num175;
				position = base.Center;
				width = num173;
				height = num174;
				base.Center = position;
			}
		}
		if (type == 608)
		{
			maxPenetrate = -1;
			penetrate = -1;
			Damage();
			SoundEngine.PlaySound(SoundID.Item14, position);
			for (int num176 = 0; num176 < 4; num176++)
			{
				int num177 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num177].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
			}
			for (int num178 = 0; num178 < 30; num178++)
			{
				int num179 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 200, default(Color), 3.7f);
				Main.dust[num179].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Main.dust[num179].noGravity = true;
				Dust dust2 = Main.dust[num179];
				dust2.velocity *= 3f;
				Main.dust[num179].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].ArmorSetDye(), Main.player[owner]);
				num179 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num179].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				dust2 = Main.dust[num179];
				dust2.velocity *= 2f;
				Main.dust[num179].noGravity = true;
				Main.dust[num179].fadeIn = 2.5f;
				Main.dust[num179].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].ArmorSetDye(), Main.player[owner]);
			}
			for (int num180 = 0; num180 < 10; num180++)
			{
				int num181 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 0, default(Color), 2.7f);
				Main.dust[num181].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num181].noGravity = true;
				Dust dust2 = Main.dust[num181];
				dust2.velocity *= 3f;
				Main.dust[num181].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].ArmorSetDye(), Main.player[owner]);
			}
			for (int num182 = 0; num182 < 10; num182++)
			{
				int num183 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
				Main.dust[num183].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num183].noGravity = true;
				Dust dust2 = Main.dust[num183];
				dust2.velocity *= 3f;
			}
			for (int num184 = 0; num184 < 2; num184++)
			{
				int num185 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Main.gore[num185].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Gore gore2 = Main.gore[num185];
				gore2.velocity *= 0.3f;
				Main.gore[num185].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num185].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
		}
		else if (type == 661)
		{
			position = base.Center;
			width = (height = 160);
			base.Center = position;
			maxPenetrate = -1;
			penetrate = -1;
			Damage();
			SoundEngine.PlaySound(SoundID.Item14, position);
			Vector2 vector31 = base.Center + Vector2.One * -20f;
			int num186 = 40;
			int num187 = num186;
			for (int num188 = 0; num188 < 4; num188++)
			{
				int num189 = Dust.NewDust(vector31, num186, num187, 240, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num189].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * num186 / 2f;
			}
			for (int num190 = 0; num190 < 20; num190++)
			{
				int num191 = Dust.NewDust(vector31, num186, num187, 62, 0f, 0f, 200, default(Color), 3.7f);
				Main.dust[num191].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * num186 / 2f;
				Main.dust[num191].noGravity = true;
				Main.dust[num191].noLight = true;
				Dust dust2 = Main.dust[num191];
				dust2.velocity *= 3f;
				dust2 = Main.dust[num191];
				dust2.velocity += DirectionTo(Main.dust[num191].position) * (2f + Main.rand.NextFloat() * 4f);
				num191 = Dust.NewDust(vector31, num186, num187, 62, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num191].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * num186 / 2f;
				dust2 = Main.dust[num191];
				dust2.velocity *= 2f;
				Main.dust[num191].noGravity = true;
				Main.dust[num191].fadeIn = 1f;
				Main.dust[num191].color = Color.Crimson * 0.5f;
				Main.dust[num191].noLight = true;
				dust2 = Main.dust[num191];
				dust2.velocity += DirectionTo(Main.dust[num191].position) * 8f;
			}
			for (int num192 = 0; num192 < 20; num192++)
			{
				int num193 = Dust.NewDust(vector31, num186, num187, 62, 0f, 0f, 0, default(Color), 2.7f);
				Main.dust[num193].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * num186 / 2f;
				Main.dust[num193].noGravity = true;
				Main.dust[num193].noLight = true;
				Dust dust2 = Main.dust[num193];
				dust2.velocity *= 3f;
				dust2 = Main.dust[num193];
				dust2.velocity += DirectionTo(Main.dust[num193].position) * 2f;
			}
			for (int num194 = 0; num194 < 70; num194++)
			{
				int num195 = Dust.NewDust(vector31, num186, num187, 240, 0f, 0f, 0, default(Color), 1.5f);
				Main.dust[num195].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * num186 / 2f;
				Main.dust[num195].noGravity = true;
				Dust dust2 = Main.dust[num195];
				dust2.velocity *= 3f;
				dust2 = Main.dust[num195];
				dust2.velocity += DirectionTo(Main.dust[num195].position) * 3f;
			}
		}
		else if (type == 617)
		{
			position = base.Center;
			width = (height = 176);
			base.Center = position;
			maxPenetrate = -1;
			penetrate = -1;
			Damage();
			SoundEngine.PlaySound(SoundID.Item14, position);
			for (int num196 = 0; num196 < 4; num196++)
			{
				int num197 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 240, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num197].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
			}
			for (int num198 = 0; num198 < 30; num198++)
			{
				int num199 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 62, 0f, 0f, 200, default(Color), 3.7f);
				Main.dust[num199].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Main.dust[num199].noGravity = true;
				Dust dust2 = Main.dust[num199];
				dust2.velocity *= 3f;
				num199 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 90, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num199].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				dust2 = Main.dust[num199];
				dust2.velocity *= 2f;
				Main.dust[num199].noGravity = true;
				Main.dust[num199].fadeIn = 1f;
				Main.dust[num199].color = Color.Crimson * 0.5f;
			}
			for (int num200 = 0; num200 < 10; num200++)
			{
				int num201 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 62, 0f, 0f, 0, default(Color), 2.7f);
				Main.dust[num201].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num201].noGravity = true;
				Dust dust2 = Main.dust[num201];
				dust2.velocity *= 3f;
			}
			for (int num202 = 0; num202 < 10; num202++)
			{
				int num203 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 240, 0f, 0f, 0, default(Color), 1.5f);
				Main.dust[num203].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num203].noGravity = true;
				Dust dust2 = Main.dust[num203];
				dust2.velocity *= 3f;
			}
			for (int num204 = 0; num204 < 2; num204++)
			{
				int num205 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Main.gore[num205].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Gore gore2 = Main.gore[num205];
				gore2.velocity *= 0.3f;
				Main.gore[num205].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num205].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
			if (Main.myPlayer == owner)
			{
				for (int num206 = 0; num206 < 1000; num206++)
				{
					if (Main.projectile[num206].active && Main.projectile[num206].type == 618 && Main.projectile[num206].ai[1] == (float)whoAmI)
					{
						Main.projectile[num206].Kill();
					}
				}
				int num207 = Main.rand.Next(5, 9);
				int num208 = Main.rand.Next(5, 9);
				int num209 = Utils.SelectRandom<int>(Main.rand, 86, 90);
				int num210 = ((num209 == 86) ? 90 : 86);
				for (int num211 = 0; num211 < num207; num211++)
				{
					Vector2 vector32 = base.Center + Utils.RandomVector2(Main.rand, -30f, 30f);
					Vector2 vector33 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
					while (vector33.X == 0f && vector33.Y == 0f)
					{
						vector33 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
					}
					vector33.Normalize();
					if (vector33.Y > 0.2f)
					{
						vector33.Y *= -1f;
					}
					vector33 *= (float)Main.rand.Next(70, 101) * 0.1f;
					NewProjectile(GetProjectileSource_FromThis(), vector32.X, vector32.Y, vector33.X, vector33.Y, 620, (int)((double)damage * 0.65), knockBack * 0.8f, owner, num209);
				}
				for (int num212 = 0; num212 < num208; num212++)
				{
					Vector2 vector34 = base.Center + Utils.RandomVector2(Main.rand, -30f, 30f);
					Vector2 vector35 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
					while (vector35.X == 0f && vector35.Y == 0f)
					{
						vector35 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
					}
					vector35.Normalize();
					if (vector35.Y > 0.4f)
					{
						vector35.Y *= -1f;
					}
					vector35 *= (float)Main.rand.Next(40, 81) * 0.1f;
					NewProjectile(GetProjectileSource_FromThis(), vector34.X, vector34.Y, vector35.X, vector35.Y, 620, (int)((double)damage * 0.65), knockBack * 0.8f, owner, num210);
				}
			}
		}
		else if (type == 658)
		{
			for (int num213 = 0; num213 < 10; num213++)
			{
				int num214 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 269, velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.5f);
				Dust dust2;
				if (Main.rand.Next(3) == 0)
				{
					Main.dust[num214].fadeIn = 0.75f + (float)Main.rand.Next(-10, 11) * 0.01f;
					Main.dust[num214].scale = 0.25f + (float)Main.rand.Next(-10, 11) * 0.005f;
					dust2 = Main.dust[num214];
					dust2.type++;
				}
				else
				{
					Main.dust[num214].scale = 1f + (float)Main.rand.Next(-10, 11) * 0.01f;
				}
				Main.dust[num214].noGravity = true;
				dust2 = Main.dust[num214];
				dust2.velocity *= 1.25f;
				dust2 = Main.dust[num214];
				dust2.velocity -= oldVelocity / 10f;
			}
		}
		else if (type == 620 || type == 618)
		{
			if (type == 618)
			{
				ai[0] = 86f;
			}
			for (int num215 = 0; num215 < 10; num215++)
			{
				int num216 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, (int)ai[0], velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.5f);
				Dust dust2;
				if (Main.rand.Next(3) == 0)
				{
					Main.dust[num216].fadeIn = 0.75f + (float)Main.rand.Next(-10, 11) * 0.01f;
					Main.dust[num216].scale = 0.25f + (float)Main.rand.Next(-10, 11) * 0.005f;
					dust2 = Main.dust[num216];
					dust2.type++;
				}
				else
				{
					Main.dust[num216].scale = 1f + (float)Main.rand.Next(-10, 11) * 0.01f;
				}
				Main.dust[num216].noGravity = true;
				dust2 = Main.dust[num216];
				dust2.velocity *= 1.25f;
				dust2 = Main.dust[num216];
				dust2.velocity -= oldVelocity / 10f;
			}
		}
		else if (type == 619)
		{
			SoundEngine.PlaySound(SoundID.Item50, position);
			for (int num217 = 0; num217 < 20; num217++)
			{
				int num218 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, (int)ai[0], velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.5f);
				Dust dust2;
				if (Main.rand.Next(3) == 0)
				{
					Main.dust[num218].fadeIn = 1.1f + (float)Main.rand.Next(-10, 11) * 0.01f;
					Main.dust[num218].scale = 0.35f + (float)Main.rand.Next(-10, 11) * 0.01f;
					dust2 = Main.dust[num218];
					dust2.type++;
				}
				else
				{
					Main.dust[num218].scale = 1.2f + (float)Main.rand.Next(-10, 11) * 0.01f;
				}
				Main.dust[num218].noGravity = true;
				dust2 = Main.dust[num218];
				dust2.velocity *= 2.5f;
				dust2 = Main.dust[num218];
				dust2.velocity -= oldVelocity / 10f;
			}
			if (Main.myPlayer == owner)
			{
				int num219 = Main.rand.Next(3, 6);
				for (int num220 = 0; num220 < num219; num220++)
				{
					Vector2 vector36 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
					while (vector36.X == 0f && vector36.Y == 0f)
					{
						vector36 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
					}
					vector36.Normalize();
					vector36 *= (float)Main.rand.Next(70, 101) * 0.1f;
					NewProjectile(GetProjectileSource_FromThis(), oldPosition.X + (float)(width / 2), oldPosition.Y + (float)(height / 2), vector36.X, vector36.Y, 620, (int)((double)damage * 0.8), knockBack * 0.8f, owner, ai[0]);
				}
			}
		}
		if (type == 601)
		{
			Color portalColor = PortalHelper.GetPortalColor(owner, (int)ai[0]);
			Color color = portalColor;
			color.A = byte.MaxValue;
			for (int num221 = 0; num221 < 6; num221++)
			{
				Vector2 vector37 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * (3f * Main.rand.NextFloat());
				Dust dust36 = Main.dust[Dust.NewDust(base.Center, 0, 0, 263)];
				dust36.position = base.Center;
				dust36.velocity = vector37 + velocity / 5f;
				dust36.color = color;
				dust36.scale = 2f;
				dust36.noLight = true;
				dust36.noGravity = true;
			}
		}
		if (type == 596)
		{
			position = base.Center;
			width = (height = 60);
			base.Center = position;
			int num222 = 30;
			if (Main.expertMode)
			{
				num222 = 22;
			}
			damage = num222;
			Damage();
			SoundEngine.PlaySound(SoundID.Item14, position);
			for (int num223 = 0; num223 < 4; num223++)
			{
				int num224 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num224].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
			}
			for (int num225 = 0; num225 < 20; num225++)
			{
				int num226 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, 0f, 0f, 0, default(Color), 2.5f);
				Main.dust[num226].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Main.dust[num226].noGravity = true;
				Dust dust2 = Main.dust[num226];
				dust2.velocity *= 2f;
			}
			for (int num227 = 0; num227 < 10; num227++)
			{
				int num228 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
				Main.dust[num228].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num228].noGravity = true;
				Dust dust2 = Main.dust[num228];
				dust2.velocity *= 2f;
			}
		}
		if (type == 659)
		{
			if (ai[0] >= 0f)
			{
				int num229 = 80;
				position = base.Center;
				width = (height = num229);
				base.Center = position;
				Damage();
				SoundEngine.PlaySound(SoundID.Item14, position);
				int num230 = 15;
				int num231 = num230 + 15;
				for (int num232 = 0; num232 < num231; num232++)
				{
					int num233 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, 0f, 0f, 0, default(Color), 2f + Main.rand.NextFloat() * 0.5f);
					Main.dust[num233].noGravity = true;
					if (num232 < num230)
					{
						float num234 = (float)(num232 + 1) / (float)num230 * ((float)Math.PI * 2f);
						Main.dust[num233].fadeIn = 1.5f + Main.rand.NextFloat() * 0.5f;
						Main.dust[num233].position = base.Center;
						Main.dust[num233].velocity = Vector2.UnitY.RotatedBy(num234) * (5f + Main.rand.NextFloat() * 1.5f);
					}
					else
					{
						Main.dust[num233].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * Main.rand.NextFloat() * width / 3f;
						Main.dust[num233].fadeIn = 0.5f + Main.rand.NextFloat() * 0.5f;
						Dust dust2 = Main.dust[num233];
						dust2.velocity *= 2f;
					}
				}
				for (int num235 = 0; num235 < 10; num235++)
				{
					int num236 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num236].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 3f;
					Main.dust[num236].fadeIn = 0.5f + Main.rand.NextFloat() * 0.5f;
					Main.dust[num236].noGravity = true;
					Dust dust2 = Main.dust[num236];
					dust2.velocity *= 1.5f;
				}
			}
		}
		else if (type >= 625 && type <= 628)
		{
			for (int num237 = 0; num237 < 6; num237++)
			{
				int num238 = Dust.NewDust(position, width, height, 135, 0f, 0f, 100, default(Color), 2f);
				Main.dust[num238].noGravity = true;
				Main.dust[num238].noLight = true;
			}
		}
		if (type == 631)
		{
			int num239 = Main.rand.Next(5, 10);
			for (int num240 = 0; num240 < num239; num240++)
			{
				int num241 = Dust.NewDust(base.Center, 0, 0, 229, 0f, 0f, 100);
				Dust dust2 = Main.dust[num241];
				dust2.velocity *= 1.6f;
				Main.dust[num241].velocity.Y -= 1f;
				dust2 = Main.dust[num241];
				dust2.position -= Vector2.One * 4f;
				Main.dust[num241].position = Vector2.Lerp(Main.dust[num241].position, base.Center, 0.5f);
				Main.dust[num241].noGravity = true;
			}
		}
		if (type == 539)
		{
			position = base.Center;
			width = (height = 80);
			base.Center = position;
			Damage();
			SoundEngine.PlaySound(4, (int)position.X, (int)position.Y, 7);
			for (int num242 = 0; num242 < 4; num242++)
			{
				int num243 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num243].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
			}
			for (int num244 = 0; num244 < 20; num244++)
			{
				int num245 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 176, 0f, 0f, 200, default(Color), 3.7f);
				Main.dust[num245].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Main.dust[num245].noGravity = true;
				Dust dust2 = Main.dust[num245];
				dust2.velocity *= 3f;
			}
			for (int num246 = 0; num246 < 20; num246++)
			{
				int num247 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 180, 0f, 0f, 0, default(Color), 2.7f);
				Main.dust[num247].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num247].noGravity = true;
				Dust dust2 = Main.dust[num247];
				dust2.velocity *= 3f;
			}
			for (int num248 = 0; num248 < 10; num248++)
			{
				int num249 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
				Main.dust[num249].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num249].noGravity = true;
				Dust dust2 = Main.dust[num249];
				dust2.velocity *= 3f;
			}
		}
		else if (type == 585)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y, 27);
			for (int num250 = 0; num250 < 20; num250++)
			{
				int num251 = Dust.NewDust(position, width, height, 26, 0f, 0f, 100);
				Main.dust[num251].noGravity = true;
				Dust dust2 = Main.dust[num251];
				dust2.velocity *= 1.2f;
				Main.dust[num251].scale = 1.3f;
				dust2 = Main.dust[num251];
				dust2.velocity -= oldVelocity * 0.3f;
				num251 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, 27, 0f, 0f, 100, default(Color), 2f);
				Main.dust[num251].noGravity = true;
				dust2 = Main.dust[num251];
				dust2.velocity *= 3f;
			}
		}
		else if (type == 590)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y, 27);
			int num252 = 165;
			if (ai[2] == 1f)
			{
				num252 = 31;
			}
			for (int num253 = 0; num253 < 10; num253++)
			{
				int num254 = Dust.NewDust(position, width, height, num252, 0f, 0f, 50, default(Color), 1.5f);
				Dust dust2 = Main.dust[num254];
				dust2.velocity *= 2f;
				Main.dust[num254].noGravity = true;
			}
			float num255 = 0.6f + Main.rand.NextFloat() * 0.4f;
			int num256 = 375;
			if (ai[2] == 1f)
			{
				num256 = 61;
			}
			int num257 = Gore.NewGore(position, Vector2.Zero, num256, num255);
			Gore gore2 = Main.gore[num257];
			gore2.velocity *= 0.3f;
			num257 = Gore.NewGore(position, Vector2.Zero, num256 + 1, num255);
			gore2 = Main.gore[num257];
			gore2.velocity *= 0.3f;
			num257 = Gore.NewGore(position, Vector2.Zero, num256 + 2, num255);
			gore2 = Main.gore[num257];
			gore2.velocity *= 0.3f;
		}
		else if (type == 587)
		{
			Color color2 = Main.hslToRgb(ai[1], 1f, 0.5f);
			color2.A = 200;
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			Rectangle rect2 = getRect();
			rect2.Inflate(10, 10);
			for (int num258 = 0; num258 < Main.maxNPCs; num258++)
			{
				if (Main.npc[num258].active && (Main.npc[num258].type == 1 || Main.npc[num258].type == 16) && rect2.Intersects(Main.npc[num258].getRect()))
				{
					Main.npc[num258].color = Color.Lerp(Main.npc[num258].color, color2, 0.9f);
					Main.npc[num258].color.A = 100;
				}
			}
			for (int num259 = 0; num259 < 10; num259++)
			{
				int num260 = Dust.NewDust(position, width, height, 76, 0f, 0f, 0, color2);
				Main.dust[num260].noGravity = true;
				Dust dust2 = Main.dust[num260];
				dust2.velocity *= 1.2f;
				Main.dust[num260].scale = 0.9f;
				dust2 = Main.dust[num260];
				dust2.velocity -= oldVelocity * 0.3f;
				num260 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, 76, 0f, 0f, 0, color2, 1.1f);
				Main.dust[num260].noGravity = true;
				dust2 = Main.dust[num260];
				dust2.velocity *= 2f;
			}
		}
		else if (type == 572)
		{
			for (int num261 = 0; num261 < 15; num261++)
			{
				int num262 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 40, velocity.X * 0.1f, velocity.Y * 0.1f, 100);
				Dust dust2 = Main.dust[num262];
				dust2.velocity *= 3f;
				Main.dust[num262].noGravity = true;
				Main.dust[num262].scale = 1.25f;
				Main.dust[num262].position = (base.Center + position) / 2f;
			}
		}
		else if (type == 581)
		{
			for (int num263 = 0; num263 < 30; num263++)
			{
				int num264 = Utils.SelectRandom<int>(Main.rand, 229, 229, 161);
				Dust dust37 = Main.dust[Dust.NewDust(position, width, height, num264)];
				dust37.noGravity = true;
				dust37.scale = 1.25f + Main.rand.NextFloat();
				dust37.fadeIn = 0.25f;
				Dust dust2 = dust37;
				dust2.velocity *= 2f;
				dust37.noLight = true;
			}
		}
		else if (type == 671)
		{
			for (int num265 = 0; num265 < 30; num265++)
			{
				int num266 = Utils.SelectRandom<int>(Main.rand, 27, 27, 62);
				Dust dust38 = Main.dust[Dust.NewDust(position, width, height, num266)];
				dust38.noGravity = true;
				dust38.scale = 1.25f + Main.rand.NextFloat();
				dust38.fadeIn = 0.25f;
				Dust dust2 = dust38;
				dust2.velocity *= 2f;
				dust38.noLight = true;
			}
		}
		else if (type == 811 || type == 814)
		{
			for (int num267 = 0; num267 < 30; num267++)
			{
				Dust dust39 = Main.dust[Dust.NewDust(position, width, height, 5)];
				dust39.scale = 1.25f + Main.rand.NextFloat();
				Dust dust2 = dust39;
				dust2.velocity *= 2f;
			}
		}
		else if (type == 819)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			for (int num268 = 0; num268 < 20; num268++)
			{
				Dust dust40 = Main.dust[Dust.NewDust(position, width, height, 5)];
				dust40.scale = 1f + Main.rand.NextFloat() * 0.5f;
				Dust dust2 = dust40;
				dust2.velocity *= 1.5f;
			}
		}
		else if (type == 675)
		{
			for (int num269 = 0; num269 < 40; num269++)
			{
				int num270 = Utils.SelectRandom<int>(Main.rand, 27, 242, 73, 72, 71, 255, 255, 255);
				Dust dust41 = Main.dust[Dust.NewDust(position, width, height, num270)];
				dust41.noGravity = true;
				dust41.scale = 1.25f + Main.rand.NextFloat();
				dust41.fadeIn = 0.25f;
				Dust dust2 = dust41;
				dust2.velocity *= 3f;
				dust41.noLight = true;
			}
		}
		else if (type == 676)
		{
			for (int num271 = 0; num271 < 120; num271++)
			{
				int num272 = Utils.SelectRandom<int>(Main.rand, 4, 256);
				Dust dust42 = Main.dust[Dust.NewDust(position, width, height, num272, 0f, 0f, 100)];
				dust42.scale = 0.8f + Main.rand.NextFloat() * 0.6f;
				dust42.fadeIn = 0.5f;
				Dust dust2 = dust42;
				dust2.velocity *= 4.5f;
				dust42.noLight = true;
				if (dust42.velocity.Y > 0f)
				{
					dust2 = dust42;
					dust2.velocity *= -0.5f;
				}
				if (dust42.type == 4)
				{
					dust42.color = new Color(80, 170, 40, 120);
				}
			}
			for (int num273 = 0; num273 < 10; num273++)
			{
				Gore.NewGoreDirect(base.Center, new Vector2(MathHelper.Lerp(-5f, 5f, Main.rand.NextFloat()), (0f - Main.rand.NextFloat()) * 5f), 1024);
			}
			for (int num274 = 0; num274 < 10; num274++)
			{
				Gore.NewGoreDirect(base.Center, new Vector2(MathHelper.Lerp(-5f, 5f, Main.rand.NextFloat()), (0f - Main.rand.NextFloat()) * 5f), 1025);
			}
			for (int num275 = 0; num275 < 10; num275++)
			{
				Gore.NewGoreDirect(base.Center, new Vector2(MathHelper.Lerp(-5f, 5f, Main.rand.NextFloat()), (0f - Main.rand.NextFloat()) * 5f), 1026);
			}
			for (int num276 = 0; num276 < 20; num276++)
			{
				Gore.NewGoreDirect(base.Center, new Vector2(MathHelper.Lerp(-0.5f, 0.5f, Main.rand.NextFloat()), (0f - Main.rand.NextFloat()) * 2f), 1026);
			}
			if (Main.netMode != 2)
			{
				Player player2 = Main.player[Main.myPlayer];
				if (!player2.dead && player2.active && (player2.Center - base.Center).Length() < 300f && !player2.creativeGodMode)
				{
					player2.AddBuff(197, 900);
				}
			}
		}
		else if (type == 686)
		{
			Rectangle hitbox3 = base.Hitbox;
			for (int num277 = 0; num277 < oldPos.Length / 2; num277 += 2)
			{
				hitbox3.X = (int)oldPos[num277].X;
				hitbox3.Y = (int)oldPos[num277].Y;
				for (int num278 = 0; num278 < 3; num278++)
				{
					int num279 = Utils.SelectRandom<int>(Main.rand, 6, 55, 158);
					int num280 = Dust.NewDust(hitbox3.TopLeft(), width, height, num279, direction, -2.5f);
					Main.dust[num280].alpha = 200;
					Dust dust2 = Main.dust[num280];
					dust2.velocity *= 2.4f;
					dust2 = Main.dust[num280];
					dust2.scale += Main.rand.NextFloat();
					dust2 = Main.dust[num280];
					dust2.scale -= 0.5f;
					if (Main.dust[num280].type == 55)
					{
						Main.dust[num280].color = Color.Lerp(Color.Red, Color.Gold, Main.rand.NextFloat());
					}
					Main.dust[num280].noLight = true;
				}
			}
			for (int num281 = 10; num281 < oldPos.Length; num281 += 2)
			{
				hitbox3.X = (int)oldPos[num281].X;
				hitbox3.Y = (int)oldPos[num281].Y;
				for (int num282 = 0; num282 < 2; num282++)
				{
					int num283 = Utils.SelectRandom<int>(Main.rand, 55);
					int num284 = Dust.NewDust(hitbox3.TopLeft(), width, height, num283, direction, -2.5f);
					Main.dust[num284].alpha = 120;
					Dust dust2 = Main.dust[num284];
					dust2.velocity *= 2.4f;
					dust2 = Main.dust[num284];
					dust2.scale += Main.rand.NextFloat() * 0.7f;
					dust2 = Main.dust[num284];
					dust2.scale -= 0.5f;
					if (Main.dust[num284].type == 55)
					{
						Main.dust[num284].color = Color.Lerp(Color.Purple, Color.Black, Main.rand.NextFloat());
					}
					Main.dust[num284].noLight = true;
				}
			}
			for (int num285 = 5; num285 < oldPos.Length; num285++)
			{
				hitbox3.X = (int)oldPos[num285].X;
				hitbox3.Y = (int)oldPos[num285].Y;
				for (int num286 = 0; num286 < 1; num286++)
				{
					int num287 = Utils.SelectRandom<int>(Main.rand, 55);
					int num288 = Dust.NewDust(hitbox3.TopLeft(), width, height, num287, direction, -2.5f);
					Main.dust[num288].alpha = 80;
					Dust dust2 = Main.dust[num288];
					dust2.velocity *= 0.3f;
					dust2 = Main.dust[num288];
					dust2.velocity += velocity * 0.5f;
					dust2 = Main.dust[num288];
					dust2.scale += Main.rand.NextFloat() * 0.7f;
					dust2 = Main.dust[num288];
					dust2.scale -= 0.5f;
					if (Main.dust[num288].type == 55)
					{
						Main.dust[num288].color = Color.Lerp(Color.Purple, Color.Black, Main.rand.NextFloat());
					}
					Main.dust[num288].noLight = true;
				}
			}
			for (int num289 = 0; num289 < 30; num289++)
			{
				int num290 = 228;
				Dust dust43 = Main.dust[Dust.NewDust(position, width, height, num290)];
				dust43.noGravity = true;
				dust43.scale = 1.25f + Main.rand.NextFloat();
				dust43.fadeIn = 1.5f;
				Dust dust2 = dust43;
				dust2.velocity *= 6f;
				dust43.noLight = true;
			}
		}
		if (type == 405)
		{
			SoundEngine.PlaySound(SoundID.Item54, position);
			_ = base.Center;
			for (int num291 = 0; num291 < 20; num291++)
			{
				int num292 = 10;
				int num293 = Dust.NewDust(base.Center - Vector2.One * num292, num292 * 2, num292 * 2, 212);
				Dust dust44 = Main.dust[num293];
				Vector2 vector38 = Vector2.Normalize(dust44.position - base.Center);
				dust44.position = base.Center + vector38 * num292 * scale;
				if (num291 < 30)
				{
					dust44.velocity = vector38 * dust44.velocity.Length();
				}
				else
				{
					dust44.velocity = vector38 * Main.rand.Next(45, 91) / 10f;
				}
				dust44.color = Main.hslToRgb((float)(0.4000000059604645 + Main.rand.NextDouble() * 0.20000000298023224), 0.9f, 0.5f);
				dust44.color = Color.Lerp(dust44.color, Color.White, 0.3f);
				dust44.noGravity = true;
				dust44.scale = 0.7f;
			}
		}
		if (type == 501)
		{
			SoundEngine.PlaySound(13, (int)position.X, (int)position.Y);
			int num294 = 20;
			position.X -= num294;
			position.Y -= num294;
			width += num294 * 2;
			height += num294 * 2;
			num294 += 20;
			for (int num295 = 0; num295 < 20; num295++)
			{
				int num296 = Dust.NewDust(position, width, height, 188, 0f, 0f, 100, default(Color), 1.5f);
				Dust dust2 = Main.dust[num296];
				dust2.velocity *= 0.5f;
			}
			for (int num297 = 0; num297 < 5; num297++)
			{
				int num298 = Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), default(Vector2), Main.rand.Next(435, 438));
				Gore gore2 = Main.gore[num298];
				gore2.velocity *= 0.5f;
				switch (num297)
				{
				case 0:
					Main.gore[num298].velocity.X += 1f;
					Main.gore[num298].velocity.Y += 1f;
					break;
				case 1:
					Main.gore[num298].velocity.X -= 1f;
					Main.gore[num298].velocity.Y += 1f;
					break;
				case 2:
					Main.gore[num298].velocity.X += 1f;
					Main.gore[num298].velocity.Y -= 1f;
					break;
				default:
					Main.gore[num298].velocity.X -= 1f;
					Main.gore[num298].velocity.Y -= 1f;
					break;
				}
				gore2 = Main.gore[num298];
				gore2.velocity *= 0.5f;
			}
			position.X -= num294;
			position.Y -= num294;
			width += num294 * 2;
			height += num294 * 2;
			Damage();
		}
		if (type == 410)
		{
			SoundEngine.PlaySound(SoundID.Item54, position);
			_ = base.Center;
			for (int num299 = 0; num299 < 10; num299++)
			{
				int num300 = (int)(10f * ai[1]);
				int num301 = Dust.NewDust(base.Center - Vector2.One * num300, num300 * 2, num300 * 2, 212);
				Dust dust45 = Main.dust[num301];
				Vector2 vector39 = Vector2.Normalize(dust45.position - base.Center);
				dust45.position = base.Center + vector39 * num300 * scale;
				if (num299 < 30)
				{
					dust45.velocity = vector39 * dust45.velocity.Length();
				}
				else
				{
					dust45.velocity = vector39 * Main.rand.Next(45, 91) / 10f;
				}
				dust45.color = Main.hslToRgb((float)(0.4000000059604645 + Main.rand.NextDouble() * 0.20000000298023224), 0.9f, 0.5f);
				dust45.color = Color.Lerp(dust45.color, Color.White, 0.3f);
				dust45.noGravity = true;
				dust45.scale = 0.7f;
			}
		}
		if (type == 629 && Main.netMode != 1)
		{
			switch (Main.npc[(int)ai[0]].type)
			{
			case 517:
				if (NPC.ShieldStrengthTowerSolar != 0)
				{
					Main.npc[(int)ai[0]].ai[3] = 1f;
				}
				NPC.ShieldStrengthTowerSolar = (int)MathHelper.Clamp(NPC.ShieldStrengthTowerSolar - 1, 0f, NPC.ShieldStrengthTowerMax);
				break;
			case 422:
				if (NPC.ShieldStrengthTowerVortex != 0)
				{
					Main.npc[(int)ai[0]].ai[3] = 1f;
				}
				NPC.ShieldStrengthTowerVortex = (int)MathHelper.Clamp(NPC.ShieldStrengthTowerVortex - 1, 0f, NPC.ShieldStrengthTowerMax);
				break;
			case 507:
				if (NPC.ShieldStrengthTowerNebula != 0)
				{
					Main.npc[(int)ai[0]].ai[3] = 1f;
				}
				NPC.ShieldStrengthTowerNebula = (int)MathHelper.Clamp(NPC.ShieldStrengthTowerNebula - 1, 0f, NPC.ShieldStrengthTowerMax);
				break;
			case 493:
				if (NPC.ShieldStrengthTowerStardust != 0)
				{
					Main.npc[(int)ai[0]].ai[3] = 1f;
				}
				NPC.ShieldStrengthTowerStardust = (int)MathHelper.Clamp(NPC.ShieldStrengthTowerStardust - 1, 0f, NPC.ShieldStrengthTowerMax);
				break;
			}
			Main.npc[(int)ai[0]].netUpdate = true;
			NetMessage.SendData(101);
		}
		if ((type == 567 || type == 568) && owner == Main.myPlayer && ai[1] == 0f)
		{
			Vector2 vector40 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
			vector40.Normalize();
			vector40 *= 0.3f;
			NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector40.X, vector40.Y, Main.rand.Next(569, 572), damage, 0f, owner);
		}
		if (type == 452)
		{
			SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 103);
			position = base.Center;
			width = (height = 144);
			position.X -= width / 2;
			position.Y -= height / 2;
			for (int num302 = 0; num302 < 4; num302++)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
			}
			for (int num303 = 0; num303 < 40; num303++)
			{
				int num304 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229, 0f, 0f, 0, default(Color), 2.5f);
				Main.dust[num304].noGravity = true;
				Dust dust2 = Main.dust[num304];
				dust2.velocity *= 3f;
				num304 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229, 0f, 0f, 100, default(Color), 1.5f);
				dust2 = Main.dust[num304];
				dust2.velocity *= 2f;
				Main.dust[num304].noGravity = true;
			}
			for (int num305 = 0; num305 < 1; num305++)
			{
				int num306 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Gore gore2 = Main.gore[num306];
				gore2.velocity *= 0.3f;
				Main.gore[num306].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num306].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
			Damage();
		}
		if (type == 454)
		{
			SoundEngine.PlaySound(4, (int)position.X, (int)position.Y, 6);
			position = base.Center;
			width = (height = 208);
			position.X -= width / 2;
			position.Y -= height / 2;
			for (int num307 = 0; num307 < 7; num307++)
			{
				int num308 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num308].position = new Vector2(width / 2, 0f).RotatedBy(6.2831854820251465 * Main.rand.NextDouble()) * (float)Main.rand.NextDouble() + base.Center;
			}
			for (int num309 = 0; num309 < 60; num309++)
			{
				int num310 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229, 0f, 0f, 0, default(Color), 2.5f);
				Main.dust[num310].position = new Vector2(width / 2, 0f).RotatedBy(6.2831854820251465 * Main.rand.NextDouble()) * (float)Main.rand.NextDouble() + base.Center;
				Main.dust[num310].noGravity = true;
				Dust dust2 = Main.dust[num310];
				dust2.velocity *= 1f;
				num310 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num310].position = new Vector2(width / 2, 0f).RotatedBy(6.2831854820251465 * Main.rand.NextDouble()) * (float)Main.rand.NextDouble() + base.Center;
				dust2 = Main.dust[num310];
				dust2.velocity *= 1f;
				Main.dust[num310].noGravity = true;
			}
			for (int num311 = 0; num311 < 3; num311++)
			{
				int num312 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Gore gore2 = Main.gore[num312];
				gore2.velocity *= 0.3f;
				Main.gore[num312].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num312].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
			Damage();
		}
		if (type == 467)
		{
			position = base.Center;
			width = (height = 176);
			base.Center = position;
			Damage();
			SoundEngine.PlaySound(SoundID.Item14, position);
			for (int num313 = 0; num313 < 4; num313++)
			{
				int num314 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num314].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
			}
			for (int num315 = 0; num315 < 30; num315++)
			{
				int num316 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 200, default(Color), 3.7f);
				Main.dust[num316].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Main.dust[num316].noGravity = true;
				Dust dust2 = Main.dust[num316];
				dust2.velocity *= 3f;
				num316 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num316].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				dust2 = Main.dust[num316];
				dust2.velocity *= 2f;
				Main.dust[num316].noGravity = true;
				Main.dust[num316].fadeIn = 2.5f;
			}
			for (int num317 = 0; num317 < 10; num317++)
			{
				int num318 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 0, default(Color), 2.7f);
				Main.dust[num318].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num318].noGravity = true;
				Dust dust2 = Main.dust[num318];
				dust2.velocity *= 3f;
			}
			for (int num319 = 0; num319 < 10; num319++)
			{
				int num320 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
				Main.dust[num320].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num320].noGravity = true;
				Dust dust2 = Main.dust[num320];
				dust2.velocity *= 3f;
			}
			for (int num321 = 0; num321 < 2; num321++)
			{
				int num322 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Main.gore[num322].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Gore gore2 = Main.gore[num322];
				gore2.velocity *= 0.3f;
				Main.gore[num322].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num322].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
		}
		if (type == 468)
		{
			position = base.Center;
			width = (height = 176);
			base.Center = position;
			Damage();
			SoundEngine.PlaySound(SoundID.Item14, position);
			for (int num323 = 0; num323 < 4; num323++)
			{
				int num324 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num324].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
			}
			for (int num325 = 0; num325 < 20; num325++)
			{
				int num326 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, 0f, 0f, 200, default(Color), 3.7f);
				Main.dust[num326].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Main.dust[num326].noGravity = true;
				Dust dust2 = Main.dust[num326];
				dust2.velocity *= 3f;
				num326 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num326].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				dust2 = Main.dust[num326];
				dust2.velocity *= 2f;
				Main.dust[num326].noGravity = true;
				Main.dust[num326].fadeIn = 2.5f;
			}
			for (int num327 = 0; num327 < 10; num327++)
			{
				int num328 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, 0f, 0f, 0, default(Color), 2.7f);
				Main.dust[num328].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num328].noGravity = true;
				Dust dust2 = Main.dust[num328];
				dust2.velocity *= 3f;
			}
			for (int num329 = 0; num329 < 10; num329++)
			{
				int num330 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
				Main.dust[num330].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num330].noGravity = true;
				Dust dust2 = Main.dust[num330];
				dust2.velocity *= 3f;
			}
			for (int num331 = 0; num331 < 2; num331++)
			{
				int num332 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Main.gore[num332].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Gore gore2 = Main.gore[num332];
				gore2.velocity *= 0.3f;
				Main.gore[num332].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num332].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
		}
		if (type == 485)
		{
			for (int num333 = 0; num333 < 15; num333++)
			{
				int num334 = Dust.NewDust(position, width, height, 6);
				Main.dust[num334].noGravity = true;
				Dust dust2 = Main.dust[num334];
				dust2.velocity -= oldVelocity * Main.rand.Next(20, 60) * 0.01f;
			}
		}
		else if (type == 484)
		{
			for (int num335 = 0; num335 < 5; num335++)
			{
				int num336 = Dust.NewDust(position, width, height, 78);
				Main.dust[num336].noGravity = true;
				Dust dust2 = Main.dust[num336];
				dust2.velocity -= oldVelocity / 5f;
				Main.dust[num336].scale = 0.85f;
			}
		}
		else if (type == 483)
		{
			SoundEngine.PlaySound(SoundID.Item14, position);
			if (owner == Main.myPlayer)
			{
				int num337 = Main.rand.Next(4, 8);
				int[] array = new int[num337];
				int num338 = 0;
				for (int num339 = 0; num339 < Main.maxNPCs; num339++)
				{
					if (!Main.npc[num339].CanBeChasedBy(this, ignoreDontTakeDamage: true))
					{
						continue;
					}
					float num340 = Distance(Main.npc[num339].Center);
					if (!(num340 > 2000f) && Collision.CanHitLine(position, width, height, Main.npc[num339].position, Main.npc[num339].width, Main.npc[num339].height))
					{
						array[num338] = num339;
						num338++;
						if (num338 == num337)
						{
							break;
						}
					}
				}
				if (num338 > 1)
				{
					for (int num341 = 0; num341 < 100; num341++)
					{
						int num342 = Main.rand.Next(num338);
						int num343;
						for (num343 = num342; num343 == num342; num343 = Main.rand.Next(num338))
						{
						}
						int num344 = array[num342];
						array[num342] = array[num343];
						array[num343] = num344;
					}
				}
				Vector2 vector41 = new Vector2(-1f, -1f);
				for (int num345 = 0; num345 < num338; num345++)
				{
					Vector2 vector42 = Main.npc[array[num345]].Center - base.Center;
					vector42.Normalize();
					vector41 += vector42;
				}
				vector41.Normalize();
				for (int num346 = 0; num346 < num337; num346++)
				{
					float num347 = Main.rand.Next(8, 15);
					Vector2 vector43 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
					vector43.Normalize();
					if (num338 > 0)
					{
						vector43 += vector41;
						vector43.Normalize();
					}
					vector43 *= num347;
					if (num338 > 0)
					{
						num338--;
						vector43 = Main.npc[array[num338]].Center - base.Center;
						vector43.Normalize();
						vector43 *= num347;
					}
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector43.X, vector43.Y, 484, (int)((double)damage * 0.7), knockBack * 0.7f, owner);
				}
			}
			for (int num348 = 0; num348 < 20; num348++)
			{
				int num349 = Dust.NewDust(position, width, height, 78);
				Main.dust[num349].noGravity = true;
				Dust dust2 = Main.dust[num349];
				dust2.velocity *= 4f;
			}
			for (int num350 = 0; num350 < 7; num350++)
			{
				int num351 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				Dust dust2 = Main.dust[num351];
				dust2.velocity *= 0.9f;
				Main.dust[num351].scale = 0.9f;
			}
			for (int num352 = 0; num352 < 3; num352++)
			{
				int num353 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
				Main.dust[num353].noGravity = true;
				Dust dust2 = Main.dust[num353];
				dust2.velocity *= 3f;
				num353 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
				dust2 = Main.dust[num353];
				dust2.velocity *= 2f;
			}
			int num354 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
			Gore gore2 = Main.gore[num354];
			gore2.velocity *= 0.3f;
			Main.gore[num354].velocity.X += Main.rand.Next(-1, 2);
			Main.gore[num354].velocity.Y += Main.rand.Next(-1, 2);
			if (owner == Main.myPlayer)
			{
				int num355 = 100;
				position.X -= num355 / 2;
				position.Y -= num355 / 2;
				width += num355;
				height++;
				penetrate = -1;
				Damage();
			}
		}
		if (type == 523)
		{
			SoundEngine.PlaySound(SoundID.Item54, position);
			for (int num356 = 0; num356 < 25; num356++)
			{
				int num357 = Dust.NewDust(position, width, height, 256);
				Main.dust[num357].noGravity = true;
				Main.dust[num357].position = (Main.dust[num357].position + position) / 2f;
				Main.dust[num357].velocity = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
				Main.dust[num357].velocity.Normalize();
				Dust dust2 = Main.dust[num357];
				dust2.velocity *= (float)Main.rand.Next(1, 30) * 0.1f;
				Main.dust[num357].alpha = alpha;
			}
		}
		else if (type == 522)
		{
			SoundEngine.PlaySound(SoundID.Item118, position);
			for (int num358 = 0; num358 < 10; num358++)
			{
				int num359 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 254, velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.5f);
				Dust dust2;
				if (Main.rand.Next(3) == 0)
				{
					Main.dust[num359].fadeIn = 0.75f + (float)Main.rand.Next(-10, 11) * 0.01f;
					Main.dust[num359].scale = 0.25f + (float)Main.rand.Next(-10, 11) * 0.005f;
					dust2 = Main.dust[num359];
					dust2.type++;
				}
				else
				{
					Main.dust[num359].scale = 1f + (float)Main.rand.Next(-10, 11) * 0.01f;
				}
				Main.dust[num359].noGravity = true;
				dust2 = Main.dust[num359];
				dust2.velocity *= 1.25f;
				dust2 = Main.dust[num359];
				dust2.velocity -= oldVelocity / 10f;
			}
		}
		else if (type == 521)
		{
			SoundEngine.PlaySound(SoundID.Item110, position);
			for (int num360 = 0; num360 < 20; num360++)
			{
				int num361 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 254, velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.5f);
				Dust dust2;
				if (Main.rand.Next(3) == 0)
				{
					Main.dust[num361].fadeIn = 1.1f + (float)Main.rand.Next(-10, 11) * 0.01f;
					Main.dust[num361].scale = 0.35f + (float)Main.rand.Next(-10, 11) * 0.01f;
					dust2 = Main.dust[num361];
					dust2.type++;
				}
				else
				{
					Main.dust[num361].scale = 1.2f + (float)Main.rand.Next(-10, 11) * 0.01f;
				}
				Main.dust[num361].noGravity = true;
				dust2 = Main.dust[num361];
				dust2.velocity *= 2.5f;
				dust2 = Main.dust[num361];
				dust2.velocity -= oldVelocity / 10f;
			}
			if (Main.myPlayer == owner)
			{
				int num362 = Main.rand.Next(3, 6);
				for (int num363 = 0; num363 < num362; num363++)
				{
					Vector2 vector44 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
					while (vector44.X == 0f && vector44.Y == 0f)
					{
						vector44 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
					}
					vector44.Normalize();
					vector44 *= (float)Main.rand.Next(70, 101) * 0.1f;
					NewProjectile(GetProjectileSource_FromThis(), oldPosition.X + (float)(width / 2), oldPosition.Y + (float)(height / 2), vector44.X, vector44.Y, 522, (int)((double)damage * 0.8), knockBack * 0.8f, owner);
				}
			}
		}
		if (type == 520)
		{
			SoundEngine.PlaySound(SoundID.Item50, position);
			for (int num364 = 0; num364 < 10; num364++)
			{
				int num365 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 252, velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.75f);
				Main.dust[num365].noGravity = true;
				Dust dust2 = Main.dust[num365];
				dust2.velocity -= oldVelocity / 3f;
			}
		}
		if (type == 459 || type == 709)
		{
			int num366 = 3;
			int num367 = 10;
			int num368 = 0;
			if (scale >= 1f)
			{
				position = base.Center;
				width = (height = 144);
				base.Center = position;
				num366 = 7;
				num367 = 30;
				num368 = 2;
				Damage();
			}
			for (int num369 = 0; num369 < num366; num369++)
			{
				int num370 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num370].position = new Vector2(width / 2, 0f).RotatedBy(6.2831854820251465 * Main.rand.NextDouble()) * (float)Main.rand.NextDouble() + base.Center;
			}
			for (int num371 = 0; num371 < num367; num371++)
			{
				int num372 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 226, 0f, 0f, 0, default(Color), 1.5f);
				Main.dust[num372].position = new Vector2(width / 2, 0f).RotatedBy(6.2831854820251465 * Main.rand.NextDouble()) * (float)Main.rand.NextDouble() + base.Center;
				Main.dust[num372].noGravity = true;
				Dust dust2 = Main.dust[num372];
				dust2.velocity *= 1f;
			}
			for (int num373 = 0; num373 < num368; num373++)
			{
				int num374 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Gore gore2 = Main.gore[num374];
				gore2.velocity *= 0.3f;
				Main.gore[num374].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num374].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
			if (type == 709 && Main.myPlayer == owner)
			{
				Rectangle value8 = new Rectangle((int)base.Center.X - 40, (int)base.Center.Y - 40, 80, 80);
				for (int num375 = 0; num375 < 1000; num375++)
				{
					if (num375 != whoAmI && Main.projectile[num375].active && Main.projectile[num375].owner == owner && Main.projectile[num375].type == 1110 && Main.projectile[num375].getRect().Intersects(value8))
					{
						Main.projectile[num375].ai[1] = 1f;
						Main.projectile[num375].velocity = (base.Center - Main.projectile[num375].Center) / 5f;
						Main.projectile[num375].netUpdate = true;
					}
				}
				int num376 = NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 1110, damage, 0f, owner);
				Projectile projectile2 = Main.projectile[num376];
				projectile2.timeLeft = 30 * Main.rand.Next(2, 6);
				projectile2.localAI[0] = SoundEngine.PlayTrackedSound(SoundID.DD2_SkyDragonsFuryCircle, base.Center).ToFloat();
			}
		}
		if (owner != Main.myPlayer && type == 453 && Main.player[owner].mount.AbilityActive)
		{
			Main.player[owner].mount.UseAbility(Main.player[owner], position, toggleOn: false);
		}
		if (type == 441)
		{
			Main.player[owner].mount.StopAbilityCharge();
		}
		if (type == 444)
		{
			SoundEngine.PlaySound(SoundID.Item96, position);
			int num377 = Main.rand.Next(5, 9);
			for (int num378 = 0; num378 < num377; num378++)
			{
				int num379 = Dust.NewDust(base.Center, 0, 0, 171, 0f, 0f, 100, default(Color), 1.4f);
				Dust dust2 = Main.dust[num379];
				dust2.velocity *= 0.8f;
				Main.dust[num379].position = Vector2.Lerp(Main.dust[num379].position, base.Center, 0.5f);
				Main.dust[num379].noGravity = true;
			}
			if (owner == Main.myPlayer)
			{
				Vector2 vector45 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY);
				if (Main.player[owner].gravDir == -1f)
				{
					vector45.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y;
				}
				Vector2 vector46 = Vector2.Normalize(vector45 - base.Center);
				vector46 *= localAI[1];
				NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector46.X, vector46.Y, (int)localAI[0], damage, knockBack, owner);
			}
		}
		if (type == 472)
		{
			for (int num380 = 0; num380 < 20; num380++)
			{
				int num381 = Dust.NewDust(position, width, height, 30);
				Main.dust[num381].noGravity = true;
				Dust dust2 = Main.dust[num381];
				dust2.velocity *= 0.45f;
				dust2 = Main.dust[num381];
				dust2.velocity += velocity * 0.9f;
			}
		}
		if (type == 639 || type == 640)
		{
			int num382 = Main.rand.Next(5, 10);
			for (int num383 = 0; num383 < num382; num383++)
			{
				int num384 = Dust.NewDust(base.Center, 0, 0, 220, 0f, 0f, 100, default(Color), 0.5f);
				Dust dust2 = Main.dust[num384];
				dust2.velocity *= 1.6f;
				Main.dust[num384].velocity.Y -= 1f;
				Main.dust[num384].position = Vector2.Lerp(Main.dust[num384].position, base.Center, 0.5f);
				Main.dust[num384].noGravity = true;
			}
			if (owner == Main.myPlayer && type == 639)
			{
				int num385 = num + 1;
				int nextSlot = GetNextSlot();
				if (Main.ProjectileUpdateLoopIndex < nextSlot && Main.ProjectileUpdateLoopIndex != -1)
				{
					num385++;
				}
				Vector2 vector47 = new Vector2(ai[0], ai[1]);
				NewProjectile(GetProjectileSource_FromThis(), localAI[0], localAI[1], vector47.X, vector47.Y, 640, damage, knockBack, owner, 0f, num385);
			}
		}
		if (type == 684)
		{
			int num386 = Main.rand.Next(15, 25);
			for (int num387 = 0; num387 < num386; num387++)
			{
				int num388 = Dust.NewDust(base.Center, 0, 0, 60, 0f, 0f, 100, new Color(255, 255, 255, 0), 1.3f);
				Dust dust2 = Main.dust[num388];
				dust2.velocity *= 8f * (0.3f + 0.7f * Main.rand.NextFloat());
				Main.dust[num388].fadeIn = 1.3f + Main.rand.NextFloat() * 0.2f;
				Main.dust[num388].noLight = true;
				Main.dust[num388].noGravity = true;
				dust2 = Main.dust[num388];
				dust2.position += Main.dust[num388].velocity * 4f;
			}
		}
		if (type == 435)
		{
			int num389 = Main.rand.Next(5, 10);
			for (int num390 = 0; num390 < num389; num390++)
			{
				int num391 = Dust.NewDust(base.Center, 0, 0, 226, 0f, 0f, 100, default(Color), 0.5f);
				Dust dust2 = Main.dust[num391];
				dust2.velocity *= 1.6f;
				Main.dust[num391].velocity.Y -= 1f;
				Main.dust[num391].position = Vector2.Lerp(Main.dust[num391].position, base.Center, 0.5f);
				Main.dust[num391].noGravity = true;
			}
		}
		if (type == 732)
		{
			int num392 = Main.rand.Next(5, 10);
			for (int num393 = 0; num393 < num392; num393++)
			{
				int num394 = Dust.NewDust(base.Center, 0, 0, 226, 0f, 0f, 100, default(Color), 0.5f);
				Dust dust2 = Main.dust[num394];
				dust2.velocity *= 1.6f;
				Main.dust[num394].velocity.Y -= 1f;
				Main.dust[num394].velocity = Main.dust[num394].velocity * 0.5f + velocity * ((float)num393 / (float)num392) * 0.7f;
				Main.dust[num394].position = Vector2.Lerp(Main.dust[num394].position, base.Center, 0.5f);
				Main.dust[num394].noGravity = true;
			}
		}
		if (type == 682)
		{
			int num395 = 22;
			for (int num396 = 0; num396 < num395; num396++)
			{
				int num397 = Dust.NewDust(base.Center, 0, 0, 272, 0f, 0f, 0, default(Color), 0.5f);
				Dust dust2 = Main.dust[num397];
				dust2.velocity *= 1.6f;
				Main.dust[num397].velocity.Y -= 1f;
				Main.dust[num397].position = Vector2.Lerp(Main.dust[num397].position, base.Center, 0.5f);
			}
		}
		if (type == 436)
		{
			int num398 = Main.rand.Next(5, 10);
			for (int num399 = 0; num399 < num398; num399++)
			{
				int num400 = Dust.NewDust(base.Center, 0, 0, 220, 0f, 0f, 100, default(Color), 0.5f);
				Dust dust2 = Main.dust[num400];
				dust2.velocity *= 1.6f;
				Main.dust[num400].velocity.Y -= 1f;
				Main.dust[num400].position = Vector2.Lerp(Main.dust[num400].position, base.Center, 0.5f);
				Main.dust[num400].noGravity = true;
			}
		}
		if (type == 462)
		{
			int num401 = Main.rand.Next(5, 10);
			for (int num402 = 0; num402 < num401; num402++)
			{
				int num403 = Dust.NewDust(base.Center, 0, 0, 229, 0f, 0f, 100, default(Color), 0.5f);
				Dust dust2 = Main.dust[num403];
				dust2.velocity *= 1.6f;
				Main.dust[num403].velocity.Y -= 1f;
				dust2 = Main.dust[num403];
				dust2.position -= Vector2.One * 4f;
				Main.dust[num403].position = Vector2.Lerp(Main.dust[num403].position, base.Center, 0.5f);
				Main.dust[num403].noGravity = true;
			}
		}
		if (type == 442)
		{
			SoundEngine.PlaySound(SoundID.Item94, position);
			int num404 = Main.rand.Next(3, 7);
			for (int num405 = 0; num405 < num404; num405++)
			{
				int num406 = Dust.NewDust(position, width, height, 135, 0f, 0f, 100, default(Color), 2.1f);
				Dust dust2 = Main.dust[num406];
				dust2.velocity *= 2f;
				Main.dust[num406].noGravity = true;
			}
			if (Main.myPlayer == owner)
			{
				Rectangle value9 = new Rectangle((int)base.Center.X - 40, (int)base.Center.Y - 40, 80, 80);
				for (int num407 = 0; num407 < 1000; num407++)
				{
					if (num407 != whoAmI && Main.projectile[num407].active && Main.projectile[num407].owner == owner && Main.projectile[num407].type == 443 && Main.projectile[num407].getRect().Intersects(value9))
					{
						Main.projectile[num407].ai[1] = 1f;
						Main.projectile[num407].velocity = (base.Center - Main.projectile[num407].Center) / 5f;
						Main.projectile[num407].netUpdate = true;
					}
				}
				NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 443, damage, 0f, owner);
			}
		}
		if (type == 440)
		{
			int num408 = Main.rand.Next(3, 7);
			for (int num409 = 0; num409 < num408; num409++)
			{
				int num410 = Dust.NewDust(base.Center - velocity / 2f, 0, 0, 135, 0f, 0f, 100, default(Color), 2.1f);
				Dust dust2 = Main.dust[num410];
				dust2.velocity *= 2f;
				Main.dust[num410].noGravity = true;
			}
		}
		if (type == 606)
		{
			int num411 = Main.rand.Next(3, 7);
			for (int num412 = 0; num412 < num411; num412++)
			{
				int num413 = Dust.NewDust(base.Center - velocity / 2f, 0, 0, 182, 0f, 0f, 100, default(Color), 1.6f);
				Dust dust2 = Main.dust[num413];
				dust2.velocity *= 1.5f;
				Main.dust[num413].noGravity = true;
			}
		}
		if (type == 449)
		{
			int num414 = Main.rand.Next(3, 7);
			for (int num415 = 0; num415 < num414; num415++)
			{
				int num416 = Dust.NewDust(base.Center - velocity / 2f, 0, 0, 228, 0f, 0f, 100, default(Color), 2.1f);
				Dust dust2 = Main.dust[num416];
				dust2.velocity *= 2f;
				Main.dust[num416].noGravity = true;
			}
		}
		if (type == 495)
		{
			for (int num417 = 0; num417 < 15; num417++)
			{
				int num418 = Dust.NewDust(base.Center, 10, 10, 27);
				Main.dust[num418].noGravity = true;
				Dust dust2 = Main.dust[num418];
				dust2.velocity -= oldVelocity * 0.3f;
			}
		}
		if (type == 497)
		{
			for (int num419 = 0; num419 < 15; num419++)
			{
				int num420 = Dust.NewDust(base.Center, 10, 10, 27);
				Main.dust[num420].noGravity = true;
				Dust dust2 = Main.dust[num420];
				dust2.velocity *= 2f;
				dust2 = Main.dust[num420];
				dust2.velocity -= oldVelocity * 0.3f;
				dust2 = Main.dust[num420];
				dust2.scale += (float)Main.rand.Next(150) * 0.001f;
			}
		}
		if (type == 1088)
		{
			SoundEngine.PlaySound(0, base.Center);
			for (int num421 = 0; num421 < 10; num421++)
			{
				int num422 = Dust.NewDust(base.Center, 10, 10, 2);
				Main.dust[num422].noGravity = true;
				Dust dust2 = Main.dust[num422];
				dust2.velocity *= 2f;
				dust2 = Main.dust[num422];
				dust2.velocity -= oldVelocity * 0.3f;
				dust2 = Main.dust[num422];
				dust2.scale += (float)Main.rand.Next(150) * 0.001f;
			}
			if (Main.myPlayer == owner)
			{
				Point plantPoint = Point.Zero;
				if (AI_016_CanAcornPlant(out plantPoint))
				{
					WorldGen.PlaceTile(plantPoint.X, plantPoint.Y, 20, mute: true, forced: false, owner);
					Tile tile = Main.tile[plantPoint.X, plantPoint.Y];
					if (tile.active() && tile.type == 20 && Main.netMode != 0)
					{
						NetMessage.SendData(17, -1, -1, null, 1, plantPoint.X, plantPoint.Y, 20f);
					}
				}
				else
				{
					int num423 = Item.NewItem(new EntitySource_Loot(this), position, base.Size, 27);
					Main.item[num423].noGrabDelay = 0;
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, num423, 1f);
					}
				}
			}
		}
		if (type == 448)
		{
			SoundEngine.PlaySound(SoundID.Item14, position);
			position = base.Center;
			width = (height = 112);
			position.X -= width / 2;
			position.Y -= height / 2;
			for (int num424 = 0; num424 < 4; num424++)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
			}
			for (int num425 = 0; num425 < 40; num425++)
			{
				int num426 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 228, 0f, 0f, 0, default(Color), 2.5f);
				Main.dust[num426].noGravity = true;
				Dust dust2 = Main.dust[num426];
				dust2.velocity *= 3f;
				num426 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 228, 0f, 0f, 100, default(Color), 1.5f);
				dust2 = Main.dust[num426];
				dust2.velocity *= 2f;
				Main.dust[num426].noGravity = true;
			}
			for (int num427 = 0; num427 < 1; num427++)
			{
				int num428 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Gore gore2 = Main.gore[num428];
				gore2.velocity *= 0.3f;
				Main.gore[num428].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num428].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
			Damage();
		}
		else if (type == 715 || type == 716 || type == 717 || type == 718)
		{
			SoundEngine.PlaySound(SoundID.Item14, position);
			position = base.Center;
			width = (height = 128);
			if (type == 717 || type == 718)
			{
				width = (height = 240);
			}
			position.X -= width / 2;
			position.Y -= height / 2;
			Damage();
			AI_147_Explosion();
		}
		if (type == 616)
		{
			SoundEngine.PlaySound(SoundID.Item14, position);
			position = base.Center;
			width = (height = 80);
			position.X -= width / 2;
			position.Y -= height / 2;
			for (int num429 = 0; num429 < 4; num429++)
			{
				int num430 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
			}
			for (int num431 = 0; num431 < 40; num431++)
			{
				int num432 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229, 0f, 0f, 200, default(Color), 2.5f);
				Main.dust[num432].noGravity = true;
				Dust dust2 = Main.dust[num432];
				dust2.velocity *= 2f;
				num432 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229, 0f, 0f, 200, default(Color), 1.5f);
				dust2 = Main.dust[num432];
				dust2.velocity *= 1.2f;
				Main.dust[num432].noGravity = true;
			}
			for (int num433 = 0; num433 < 1; num433++)
			{
				int num434 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Gore gore2 = Main.gore[num434];
				gore2.velocity *= 0.3f;
				Main.gore[num434].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num434].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
			Damage();
		}
		if (type == 502)
		{
			Vector2 vector48 = new Vector2(width, height) / 2f;
			for (int num435 = 0; num435 < oldPos.Length; num435++)
			{
				if (!(oldPos[num435] == Vector2.Zero))
				{
					int num436 = Dust.NewDust(oldPos[num435] + vector48, 0, 0, 66, 0f, 0f, 150, Color.Transparent, 0.7f);
					Main.dust[num436].color = Main.hslToRgb(Main.rand.NextFloat(), 1f, 0.5f);
					Main.dust[num436].noGravity = true;
				}
			}
		}
		if (type == 510)
		{
			SoundEngine.PlaySound(SoundID.Item107, position);
			Gore.NewGore(base.Center, -oldVelocity * 0.2f, 704);
			Gore.NewGore(base.Center, -oldVelocity * 0.2f, 705);
			if (owner == Main.myPlayer)
			{
				int num437 = Main.rand.Next(20, 31);
				for (int num438 = 0; num438 < num437; num438++)
				{
					Vector2 vector49 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
					vector49.Normalize();
					vector49 *= (float)Main.rand.Next(10, 201) * 0.01f;
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector49.X, vector49.Y, 511 + Main.rand.Next(3), damage, 1f, owner);
				}
			}
		}
		if (type == 868 || type == 869 || type == 996)
		{
			SoundEngine.PlaySound(SoundID.Item107, position);
			for (int num439 = 0; num439 < 15; num439++)
			{
				Dust.NewDust(position, width, height, 13, 0f, -2f, 0, default(Color), 1.5f);
			}
			if (Main.netMode != 1)
			{
				switch (type)
				{
				case 868:
					WorldGen.TreeTops.RandomizeTreeStyleBasedOnWorldPosition(Main.rand, base.Center);
					break;
				case 869:
					WorldGen.RandomizeBackgroundBasedOnPlayer(Main.rand, Main.player[owner]);
					break;
				case 996:
					WorldGen.RandomizeMoonState(Main.rand, garenteeNewStyle: true);
					break;
				}
				NetMessage.SendData(7);
			}
		}
		else if (type == 836)
		{
			for (int num440 = 0; num440 < 3; num440++)
			{
				int num441 = Dust.NewDust(position, width, height, 31, 0f, 0f, 50, Color.White, 0.8f);
				Dust dust2 = Main.dust[num441];
				dust2.velocity *= 0.5f;
				Main.dust[num441].noGravity = true;
			}
		}
		else if (type == 1092)
		{
			for (int num442 = 0; num442 < 6; num442++)
			{
				Dust dust46 = Dust.NewDustDirect(base.Left, width, 4, 269, 0f, 0f, 0, Color.White, 1.2f);
				dust46.noLight = true;
			}
		}
		if (type == 408)
		{
			for (int num443 = 0; num443 < 15; num443++)
			{
				int num444 = Dust.NewDust(base.Center - Vector2.One * 10f, 50, 50, 5, 0f, -2f);
				Dust dust2 = Main.dust[num444];
				dust2.velocity /= 2f;
			}
			int num445 = 0;
			int num446 = 10;
			num445 = Gore.NewGore(base.Center, velocity * 0.8f, 584);
			Gore gore2 = Main.gore[num445];
			gore2.timeLeft /= num446;
			num445 = Gore.NewGore(base.Center, velocity * 0.9f, 585);
			gore2 = Main.gore[num445];
			gore2.timeLeft /= num446;
			num445 = Gore.NewGore(base.Center, velocity * 1f, 586);
			gore2 = Main.gore[num445];
			gore2.timeLeft /= num446;
		}
		if (type == 385)
		{
			SoundEngine.PlaySound(4, (int)base.Center.X, (int)base.Center.Y, 19);
			int num447 = 36;
			for (int num448 = 0; num448 < num447; num448++)
			{
				Vector2 spinningpoint = Vector2.Normalize(velocity) * new Vector2((float)width / 2f, height) * 0.75f;
				spinningpoint = spinningpoint.RotatedBy((float)(num448 - (num447 / 2 - 1)) * ((float)Math.PI * 2f) / (float)num447) + base.Center;
				Vector2 vector50 = spinningpoint - base.Center;
				int num449 = Dust.NewDust(spinningpoint + vector50, 0, 0, 172, vector50.X * 2f, vector50.Y * 2f, 100, default(Color), 1.4f);
				Main.dust[num449].noGravity = true;
				Main.dust[num449].noLight = true;
				Main.dust[num449].velocity = vector50;
			}
			if (owner == Main.myPlayer)
			{
				if (ai[1] < 1f)
				{
					int num450 = (Main.expertMode ? 25 : 40);
					int num451 = NewProjectile(GetProjectileSource_FromThis(), base.Center.X - (float)(direction * 30), base.Center.Y - 4f, (float)(-direction) * 0.01f, 0f, 384, num450, 4f, owner, 16f, 15f);
					Main.projectile[num451].netUpdate = true;
				}
				else
				{
					int num452 = (int)(base.Center.Y / 16f);
					int num453 = (int)(base.Center.X / 16f);
					int num454 = 100;
					if (num453 < 10)
					{
						num453 = 10;
					}
					if (num453 > Main.maxTilesX - 10)
					{
						num453 = Main.maxTilesX - 10;
					}
					if (num452 < 10)
					{
						num452 = 10;
					}
					if (num452 > Main.maxTilesY - num454 - 10)
					{
						num452 = Main.maxTilesY - num454 - 10;
					}
					int num455 = num452 + num454;
					int num456 = num452 + 15;
					for (int num457 = num452; num457 < num455; num457++)
					{
						Tile tile2 = Main.tile[num453, num457];
						if (tile2.active() && (Main.tileSolid[tile2.type] || tile2.liquid != 0))
						{
							num456 = num457;
							break;
						}
					}
					num452 = num456;
					int num458 = (Main.expertMode ? 50 : 80);
					int num459 = NewProjectile(GetProjectileSource_FromThis(), num453 * 16 + 8, num452 * 16 - 24, 0f, 0f, 386, num458, 4f, Main.myPlayer, 16f, 24f);
					Main.projectile[num459].netUpdate = true;
				}
			}
		}
		else if (type >= 424 && type <= 426)
		{
			SoundEngine.PlaySound(SoundID.Item89, position);
			position.X += width / 2;
			position.Y += height / 2;
			width = (int)(128f * scale);
			height = (int)(128f * scale);
			position.X -= width / 2;
			position.Y -= height / 2;
			for (int num460 = 0; num460 < 8; num460++)
			{
				int num461 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
			}
			for (int num462 = 0; num462 < 32; num462++)
			{
				int num463 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
				Main.dust[num463].noGravity = true;
				Dust dust2 = Main.dust[num463];
				dust2.velocity *= 3f;
				num463 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
				dust2 = Main.dust[num463];
				dust2.velocity *= 2f;
				Main.dust[num463].noGravity = true;
			}
			for (int num464 = 0; num464 < 2; num464++)
			{
				int num465 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Gore gore2 = Main.gore[num465];
				gore2.velocity *= 0.3f;
				Main.gore[num465].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num465].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
			if (owner == Main.myPlayer)
			{
				localAI[1] = -1f;
				maxPenetrate = 0;
				Damage();
			}
			for (int num466 = 0; num466 < 5; num466++)
			{
				int num467 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
				int num468 = Dust.NewDust(position, width, height, num467, 2.5f * (float)direction, -2.5f);
				Main.dust[num468].alpha = 200;
				Dust dust2 = Main.dust[num468];
				dust2.velocity *= 2.4f;
				dust2 = Main.dust[num468];
				dust2.scale += Main.rand.NextFloat();
			}
		}
		else if (type == 1037 || type == 1049)
		{
			if (owner == Main.myPlayer && Main.netMode != 0)
			{
				NetMessage.SendData(27, -1, -1, null, whoAmI);
			}
			SoundEngine.PlaySound(SoundID.Item89, position);
			position.X += width / 2;
			position.Y += height / 2;
			width = (int)(192f * scale);
			height = (int)(192f * scale);
			position.X -= width / 2;
			position.Y -= height / 2;
			if (type == 1049)
			{
				Resize(112, 112);
			}
			else
			{
				Resize(64, 64);
			}
			if (owner == Main.myPlayer)
			{
				localAI[1] = -1f;
				maxPenetrate = 0;
				Damage();
			}
			for (int num469 = 0; num469 < 6; num469++)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
			}
			for (int num470 = 0; num470 < 3; num470++)
			{
				int num471 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Main.gore[num471].position = base.Center + Main.rand.NextVector2Circular(25f, 25f) + new Vector2(-20f, -20f);
				Gore gore2 = Main.gore[num471];
				gore2.velocity *= 0.3f;
				Main.gore[num471].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num471].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
			if (!wet)
			{
				for (int num472 = 0; num472 < 24; num472++)
				{
					int num473 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
					Main.dust[num473].noGravity = true;
					Dust dust2 = Main.dust[num473];
					dust2.velocity *= 3f;
					num473 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
					dust2 = Main.dust[num473];
					dust2.velocity *= 2f;
					Main.dust[num473].noGravity = true;
				}
				for (int num474 = 0; num474 < 4; num474++)
				{
					int num475 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
					int num476 = Dust.NewDust(position, width, height, num475, 2.5f * (float)direction, -2.5f);
					Main.dust[num476].alpha = 200;
					Dust dust2 = Main.dust[num476];
					dust2.velocity *= 2.4f;
					dust2 = Main.dust[num476];
					dust2.scale += Main.rand.NextFloat();
				}
			}
		}
		if (type == 399)
		{
			SoundEngine.PlaySound(13, (int)position.X, (int)position.Y);
			Vector2 vector51 = new Vector2(20f, 20f);
			for (int num477 = 0; num477 < 5; num477++)
			{
				Dust.NewDust(base.Center - vector51 / 2f, (int)vector51.X, (int)vector51.Y, 12, 0f, 0f, 0, Color.Red);
			}
			for (int num478 = 0; num478 < 10; num478++)
			{
				int num479 = Dust.NewDust(base.Center - vector51 / 2f, (int)vector51.X, (int)vector51.Y, 31, 0f, 0f, 100, default(Color), 1.5f);
				Dust dust2 = Main.dust[num479];
				dust2.velocity *= 1.4f;
			}
			for (int num480 = 0; num480 < 20; num480++)
			{
				int num481 = Dust.NewDust(base.Center - vector51 / 2f, (int)vector51.X, (int)vector51.Y, 6, 0f, 0f, 100, default(Color), 2.5f);
				Main.dust[num481].noGravity = true;
				Dust dust2 = Main.dust[num481];
				dust2.velocity *= 5f;
				num481 = Dust.NewDust(base.Center - vector51 / 2f, (int)vector51.X, (int)vector51.Y, 6, 0f, 0f, 100, default(Color), 1.5f);
				dust2 = Main.dust[num481];
				dust2.velocity *= 3f;
			}
			if (Main.myPlayer == owner)
			{
				for (int num482 = 0; num482 < 6; num482++)
				{
					float num483 = (0f - velocity.X) * (float)Main.rand.Next(20, 50) * 0.01f + (float)Main.rand.Next(-20, 21) * 0.4f;
					float num484 = (0f - Math.Abs(velocity.Y)) * (float)Main.rand.Next(30, 50) * 0.01f + (float)Main.rand.Next(-20, 5) * 0.4f;
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X + num483, base.Center.Y + num484, num483, num484, 400 + Main.rand.Next(3), (int)((double)damage * 0.5), 0f, owner);
				}
			}
		}
		if (type == 384 || type == 386)
		{
			for (int num485 = 0; num485 < 20; num485++)
			{
				int num486 = Dust.NewDust(position, width, height, 212, direction * 2, 0f, 100, default(Color), 1.4f);
				Dust dust47 = Main.dust[num486];
				dust47.color = Color.CornflowerBlue;
				dust47.color = Color.Lerp(dust47.color, Color.White, 0.3f);
				dust47.noGravity = true;
			}
		}
		if (type == 507 || type == 508)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			Vector2 vector52 = position;
			Vector2 vector53 = oldVelocity;
			vector53.Normalize();
			vector52 += vector53 * 16f;
			for (int num487 = 0; num487 < 20; num487++)
			{
				int num488 = Dust.NewDust(vector52, width, height, 81);
				Main.dust[num488].position = (Main.dust[num488].position + base.Center) / 2f;
				Dust dust2 = Main.dust[num488];
				dust2.velocity += oldVelocity * 0.4f;
				dust2 = Main.dust[num488];
				dust2.velocity *= 0.5f;
				Main.dust[num488].noGravity = true;
				vector52 -= vector53 * 8f;
			}
		}
		if (type == 598)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			Vector2 vector54 = position;
			Vector2 vector55 = (rotation - (float)Math.PI / 2f).ToRotationVector2();
			vector54 += vector55 * 16f;
			for (int num489 = 0; num489 < 20; num489++)
			{
				int num490 = Dust.NewDust(vector54, width, height, 81);
				Main.dust[num490].position = (Main.dust[num490].position + base.Center) / 2f;
				Dust dust2 = Main.dust[num490];
				dust2.velocity += vector55 * 2f;
				dust2 = Main.dust[num490];
				dust2.velocity *= 0.5f;
				Main.dust[num490].noGravity = true;
				vector54 -= vector55 * 8f;
			}
		}
		if (type == 971)
		{
			Vector2 vector56 = position;
			Vector2 vector57 = (rotation - (float)Math.PI / 2f).ToRotationVector2();
			vector56 += vector57 * 8f;
			for (int num491 = 0; num491 < 6; num491++)
			{
				int num492 = Dust.NewDust(vector56, width, height, 4);
				Main.dust[num492].color = new Color(10, 10, 10, 150);
				Main.dust[num492].position = (Main.dust[num492].position + base.Center) / 2f;
				Dust dust2 = Main.dust[num492];
				dust2.velocity += vector57;
				dust2 = Main.dust[num492];
				dust2.velocity *= 0.5f;
				Main.dust[num492].noGravity = true;
				vector56 -= vector57 * 4f;
			}
		}
		if (type == 1 || type == 81 || type == 98 || type == 980 || type == 1073)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			for (int num493 = 0; num493 < 10; num493++)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 7);
			}
		}
		if (type == 336 || type == 345)
		{
			for (int num494 = 0; num494 < 6; num494++)
			{
				int num495 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 196);
				Main.dust[num495].noGravity = true;
				Main.dust[num495].scale = scale;
			}
		}
		if (type == 358)
		{
			velocity = oldVelocity * 0.2f;
			for (int num496 = 0; num496 < 50; num496++)
			{
				int num497 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 211, 0f, 0f, 75, default(Color), 1.2f);
				Dust dust2;
				if (Main.rand.Next(2) == 0)
				{
					dust2 = Main.dust[num497];
					dust2.alpha += 25;
				}
				if (Main.rand.Next(2) == 0)
				{
					dust2 = Main.dust[num497];
					dust2.alpha += 25;
				}
				if (Main.rand.Next(2) == 0)
				{
					dust2 = Main.dust[num497];
					dust2.alpha += 25;
				}
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num497].scale = 0.6f;
				}
				else
				{
					Main.dust[num497].noGravity = true;
				}
				dust2 = Main.dust[num497];
				dust2.velocity *= 0.3f;
				dust2 = Main.dust[num497];
				dust2.velocity += velocity;
				dust2 = Main.dust[num497];
				dust2.velocity *= 1f + (float)Main.rand.Next(-100, 101) * 0.01f;
				Main.dust[num497].velocity.X += (float)Main.rand.Next(-50, 51) * 0.015f;
				Main.dust[num497].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.015f;
				Main.dust[num497].position = base.Center;
			}
		}
		if (type == 406)
		{
			int num498 = 175;
			Color newColor6 = new Color(0, 80, 255, 100);
			velocity = oldVelocity * 0.2f;
			for (int num499 = 0; num499 < 40; num499++)
			{
				int num500 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 4, 0f, 0f, num498, newColor6, 1.6f);
				Dust dust2;
				if (Main.rand.Next(2) == 0)
				{
					dust2 = Main.dust[num500];
					dust2.alpha += 25;
				}
				if (Main.rand.Next(2) == 0)
				{
					dust2 = Main.dust[num500];
					dust2.alpha += 25;
				}
				if (Main.rand.Next(2) == 0)
				{
					dust2 = Main.dust[num500];
					dust2.alpha += 25;
				}
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num500].scale = 0.6f;
				}
				else
				{
					Main.dust[num500].noGravity = true;
				}
				dust2 = Main.dust[num500];
				dust2.velocity *= 0.3f;
				dust2 = Main.dust[num500];
				dust2.velocity += velocity;
				dust2 = Main.dust[num500];
				dust2.velocity *= 1f + (float)Main.rand.Next(-100, 101) * 0.01f;
				Main.dust[num500].velocity.X += (float)Main.rand.Next(-50, 51) * 0.015f;
				Main.dust[num500].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.015f;
				Main.dust[num500].position = base.Center;
			}
		}
		if (type == 1042)
		{
			velocity = oldVelocity * 0.2f;
			for (int num501 = 0; num501 < 50; num501++)
			{
				int num502 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 324, 0f, 0f, 75, default(Color), 1.25f);
				Dust dust2;
				if (Main.rand.Next(2) == 0)
				{
					dust2 = Main.dust[num502];
					dust2.alpha += 25;
				}
				if (Main.rand.Next(2) == 0)
				{
					dust2 = Main.dust[num502];
					dust2.alpha += 25;
				}
				if (Main.rand.Next(2) == 0)
				{
					dust2 = Main.dust[num502];
					dust2.alpha += 25;
				}
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num502].scale = 0.8f;
				}
				else
				{
					Main.dust[num502].noGravity = true;
				}
				dust2 = Main.dust[num502];
				dust2.velocity *= 0.3f;
				dust2 = Main.dust[num502];
				dust2.velocity += velocity * 0.8f;
				dust2 = Main.dust[num502];
				dust2.velocity *= 1f + (float)Main.rand.Next(-100, 101) * 0.01f;
				Main.dust[num502].velocity.X += (float)Main.rand.Next(-50, 51) * 0.015f;
				Main.dust[num502].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.015f;
				Main.dust[num502].position = base.Center;
				switch (Main.rand.Next(6))
				{
				case 0:
					Main.dust[num502].color = new Color(255, 255, 220);
					break;
				case 1:
					Main.dust[num502].color = new Color(230, 255, 255);
					break;
				case 2:
					Main.dust[num502].color = new Color(255, 210, 255);
					break;
				default:
					Main.dust[num502].color = new Color(225, 210, 255);
					break;
				}
			}
		}
		if (type == 344)
		{
			for (int num503 = 0; num503 < 8; num503++)
			{
				int num504 = Dust.NewDust(position, width, height, 197, 0f, 0f, 50);
				Main.dust[num504].noGravity = true;
				Main.dust[num504].velocity.X *= 0.75f;
				Main.dust[num504].velocity.Y *= 0.75f;
				Dust dust2 = Main.dust[num504];
				dust2.velocity -= velocity * 0.025f;
			}
		}
		else if (type == 343)
		{
			SoundEngine.PlaySound(SoundID.Item27, position);
			for (int num505 = 4; num505 < 31; num505++)
			{
				float num506 = oldVelocity.X * (30f / (float)num505);
				float num507 = oldVelocity.Y * (30f / (float)num505);
				int num508 = Dust.NewDust(new Vector2(oldPosition.X - num506, oldPosition.Y - num507), 8, 8, 197, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.2f);
				Main.dust[num508].noGravity = true;
				Dust dust2 = Main.dust[num508];
				dust2.velocity *= 0.5f;
			}
		}
		else if (type == 349)
		{
			SoundEngine.PlaySound(SoundID.Item27, position);
			for (int num509 = 0; num509 < 3; num509++)
			{
				int num510 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 76);
				Main.dust[num510].noGravity = true;
				Main.dust[num510].noLight = true;
				Main.dust[num510].scale = 0.7f;
			}
		}
		if (type == 323)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			for (int num511 = 0; num511 < 20; num511++)
			{
				int num512 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 7);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num512].noGravity = true;
					Main.dust[num512].scale = 1.3f;
					Dust dust2 = Main.dust[num512];
					dust2.velocity *= 1.5f;
					dust2 = Main.dust[num512];
					dust2.velocity -= oldVelocity * 0.5f;
					dust2 = Main.dust[num512];
					dust2.velocity *= 1.5f;
				}
				else
				{
					Dust dust2 = Main.dust[num512];
					dust2.velocity *= 0.75f;
					dust2 = Main.dust[num512];
					dust2.velocity -= oldVelocity * 0.25f;
					Main.dust[num512].scale = 0.8f;
				}
			}
		}
		if (type == 589)
		{
			SoundEngine.PlaySound(SoundID.Item27, position);
			Color newColor7 = Color.Red;
			if (ai[1] == 1f)
			{
				newColor7 = Color.Green;
			}
			if (ai[1] == 2f)
			{
				newColor7 = Color.Purple;
			}
			if (ai[1] == 3f)
			{
				newColor7 = Color.Gold;
			}
			if (ai[1] == 4f)
			{
				newColor7 = Color.White;
			}
			newColor7.A = 100;
			for (int num513 = 0; num513 < 30; num513++)
			{
				int num514 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 11, 0f, 0f, 0, newColor7);
				Dust dust2 = Main.dust[num514];
				dust2.velocity *= 1f + Main.rand.NextFloat() * 1f;
				if (num513 < 10)
				{
					Main.dust[num514].noGravity = true;
					dust2 = Main.dust[num514];
					dust2.velocity *= 0.5f;
				}
			}
		}
		if (type == 346)
		{
			SoundEngine.PlaySound(SoundID.Item27, position);
			for (int num515 = 0; num515 < 20; num515++)
			{
				int num516 = 10;
				if (ai[1] == 1f)
				{
					num516 = 4;
				}
				int num517 = Dust.NewDust(position, width, height, num516);
				Main.dust[num517].noGravity = true;
			}
		}
		if (type == 335)
		{
			SoundEngine.PlaySound(SoundID.Item27, position);
			for (int num518 = 0; num518 < 20; num518++)
			{
				int num519 = 90 - (int)ai[1];
				int num520 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num519);
				Main.dust[num520].noLight = true;
				Main.dust[num520].scale = 0.8f;
			}
		}
		if (type == 318)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			for (int num521 = 0; num521 < 10; num521++)
			{
				int num522 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 30);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num522].noGravity = true;
				}
			}
		}
		if (type == 378)
		{
			for (int num523 = 0; num523 < 10; num523++)
			{
				int num524 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 30);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num524].noGravity = true;
				}
			}
		}
		else if (type == 311)
		{
			for (int num525 = 0; num525 < 5; num525++)
			{
				int num526 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 189);
				Main.dust[num526].scale = 0.85f;
				Main.dust[num526].noGravity = true;
				Dust dust2 = Main.dust[num526];
				dust2.velocity += velocity * 0.5f;
			}
		}
		else if (type == 316)
		{
			for (int num527 = 0; num527 < 5; num527++)
			{
				int num528 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 195);
				Main.dust[num528].scale = 0.85f;
				Main.dust[num528].noGravity = true;
				Dust dust2 = Main.dust[num528];
				dust2.velocity += velocity * 0.5f;
			}
		}
		else if (type == 184 || type == 195)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			for (int num529 = 0; num529 < 5; num529++)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 7);
			}
		}
		else if (type == 1097)
		{
			SoundEngine.PlaySound(SoundID.Item20, (int)position.X, (int)position.Y);
			for (int num530 = 0; num530 < 6; num530++)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6);
			}
		}
		else if (type == 275 || type == 276)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			for (int num531 = 0; num531 < 5; num531++)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 7);
			}
		}
		else if (type == 291)
		{
			if (owner == Main.myPlayer)
			{
				NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 292, damage, knockBack, owner);
			}
		}
		else if (type == 295)
		{
			if (owner == Main.myPlayer)
			{
				NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 296, (int)((double)damage * 0.75), knockBack, owner);
			}
		}
		else if (type == 270 || type == 837)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y, 27);
			if (type == 270)
			{
				for (int num532 = 0; num532 < 20; num532++)
				{
					int num533 = Dust.NewDust(position, width, height, 26, 0f, 0f, 100);
					Main.dust[num533].noGravity = true;
					Dust dust2 = Main.dust[num533];
					dust2.velocity *= 1.2f;
					Main.dust[num533].scale = 1.3f;
					dust2 = Main.dust[num533];
					dust2.velocity -= oldVelocity * 0.3f;
					num533 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, 5, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num533].noGravity = true;
					dust2 = Main.dust[num533];
					dust2.velocity *= 3f;
				}
			}
			else
			{
				for (int num534 = 0; num534 < 20; num534++)
				{
					int num535 = Dust.NewDust(position, width, height, 26, 0f, 0f, 100);
					Main.dust[num535].noGravity = true;
					Dust dust2 = Main.dust[num535];
					dust2.velocity *= 1.2f;
					Main.dust[num535].scale = 1.3f;
					dust2 = Main.dust[num535];
					dust2.velocity -= oldVelocity * 0.3f;
					num535 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, 6, 0f, 0f, 100, default(Color), 2f);
					Main.dust[num535].noGravity = true;
					dust2 = Main.dust[num535];
					dust2.velocity *= 3f;
				}
			}
		}
		else if (type == 265)
		{
			for (int num536 = 0; num536 < 15; num536++)
			{
				int num537 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 163, 0f, 0f, 100, default(Color), 1.2f);
				Main.dust[num537].noGravity = true;
				Dust dust2 = Main.dust[num537];
				dust2.velocity *= 1.2f;
				dust2 = Main.dust[num537];
				dust2.velocity -= oldVelocity * 0.3f;
			}
		}
		else if (type == 355)
		{
			for (int num538 = 0; num538 < 15; num538++)
			{
				int num539 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 205, 0f, 0f, 100, default(Color), 1.2f);
				Main.dust[num539].noGravity = true;
				Dust dust2 = Main.dust[num539];
				dust2.velocity *= 1.2f;
				dust2 = Main.dust[num539];
				dust2.velocity -= oldVelocity * 0.3f;
			}
		}
		else if (type == 304)
		{
			for (int num540 = 0; num540 < 3; num540++)
			{
				int num541 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 182, 0f, 0f, 100, default(Color), 0.8f);
				Main.dust[num541].noGravity = true;
				Dust dust2 = Main.dust[num541];
				dust2.velocity *= 1.2f;
				dust2 = Main.dust[num541];
				dust2.velocity -= oldVelocity * 0.3f;
			}
		}
		else if (type == 263)
		{
			SoundEngine.PlaySound(SoundID.Item27, position);
			for (int num542 = 0; num542 < 15; num542++)
			{
				int num543 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 92, velocity.X, velocity.Y, Main.rand.Next(0, 101), default(Color), 1f + (float)Main.rand.Next(40) * 0.01f);
				Main.dust[num543].noGravity = true;
				Dust dust2 = Main.dust[num543];
				dust2.velocity *= 2f;
			}
		}
		else if (type == 261)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			for (int num544 = 0; num544 < 15; num544++)
			{
				Dust dust48 = Dust.NewDustDirect(new Vector2(position.X, position.Y), width, height, 148);
				Dust dust2 = dust48;
				dust2.velocity *= 2f;
				dust48.velocity.Y -= 0.4f;
			}
			for (int num545 = 0; num545 < 3; num545++)
			{
				Dust dust49 = Dust.NewDustDirect(new Vector2(position.X, position.Y), width, height, 228);
				Dust dust2 = dust49;
				dust2.velocity *= 2f;
				dust49.noLight = true;
				dust2 = dust49;
				dust2.scale *= 0.8f;
				dust49.velocity.Y -= 0.3f;
			}
		}
		else if (type == 928)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			for (int num546 = 0; num546 < 25; num546++)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 5, velocity.X, velocity.Y, 0, Color.White, 1.3f);
			}
		}
		else if (type == 229)
		{
			for (int num547 = 0; num547 < 25; num547++)
			{
				int num548 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 157);
				Main.dust[num548].noGravity = true;
				Dust dust2 = Main.dust[num548];
				dust2.velocity *= 1.5f;
				Main.dust[num548].scale = 1.5f;
			}
		}
		else if (type == 239)
		{
			if (velocity.Y > 0f)
			{
				int num549 = Dust.NewDust(new Vector2(position.X, position.Y + (float)height - 2f), 2, 2, 154);
				Main.dust[num549].position.X -= 2f;
				Main.dust[num549].alpha = 38;
				Dust dust2 = Main.dust[num549];
				dust2.velocity *= 0.1f;
				dust2 = Main.dust[num549];
				dust2.velocity += -oldVelocity * 0.25f;
				Main.dust[num549].scale = 0.95f;
			}
		}
		else if (type == 245)
		{
			if (velocity.Y > 0f)
			{
				int num550 = Dust.NewDust(new Vector2(position.X, position.Y + (float)height - 2f), 2, 2, 114);
				Main.dust[num550].noGravity = true;
				Main.dust[num550].position.X -= 2f;
				Main.dust[num550].alpha = 38;
				Dust dust2 = Main.dust[num550];
				dust2.velocity *= 0.1f;
				dust2 = Main.dust[num550];
				dust2.velocity += -oldVelocity * 0.25f;
				Main.dust[num550].scale = 0.95f;
			}
		}
		else if (type == 264)
		{
			if (velocity.Y > 0f)
			{
				int num551 = Dust.NewDust(new Vector2(position.X, position.Y + (float)height - 2f), 2, 2, 54);
				Main.dust[num551].noGravity = true;
				Main.dust[num551].position.X -= 2f;
				Main.dust[num551].alpha = 38;
				Dust dust2 = Main.dust[num551];
				dust2.velocity *= 0.1f;
				dust2 = Main.dust[num551];
				dust2.velocity += -oldVelocity * 0.25f;
				Main.dust[num551].scale = 0.95f;
			}
		}
		else if (type == 206 || type == 225)
		{
			SoundEngine.PlaySound(6, (int)position.X, (int)position.Y);
			for (int num552 = 0; num552 < 5; num552++)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 40);
			}
		}
		else if (type == 227)
		{
			SoundEngine.PlaySound(6, (int)position.X, (int)position.Y);
			for (int num553 = 0; num553 < 15; num553++)
			{
				int num554 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 157);
				Main.dust[num554].noGravity = true;
				Dust dust2 = Main.dust[num554];
				dust2.velocity += oldVelocity * Main.rand.NextFloat();
				Main.dust[num554].scale = 1.5f;
			}
		}
		else if (type == 237 && owner == Main.myPlayer)
		{
			NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 238, damage, knockBack, owner);
		}
		else if (type == 243 && owner == Main.myPlayer)
		{
			NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 244, damage, knockBack, owner);
		}
		else if (type == 120)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			for (int num555 = 0; num555 < 10; num555++)
			{
				int num556 = Dust.NewDust(new Vector2(position.X - velocity.X, position.Y - velocity.Y), width, height, 67, velocity.X, velocity.Y, 100);
				if (num555 < 5)
				{
					Main.dust[num556].noGravity = true;
				}
				Dust dust2 = Main.dust[num556];
				dust2.velocity *= 0.2f;
			}
		}
		else if (type == 181 || type == 189 || type == 566)
		{
			for (int num557 = 0; num557 < 6; num557++)
			{
				int num558 = Dust.NewDust(position, width, height, 150, velocity.X, velocity.Y, 50);
				Main.dust[num558].noGravity = true;
				Main.dust[num558].scale = 1f;
			}
		}
		else if (type == 178)
		{
			for (int num559 = 0; num559 < 85; num559++)
			{
				int num560 = Main.rand.Next(139, 143);
				int num561 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num560, velocity.X, velocity.Y, 0, default(Color), 1.2f);
				Main.dust[num561].velocity.X += (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.dust[num561].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.dust[num561].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.dust[num561].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.dust[num561].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
				Main.dust[num561].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.05f;
				Dust dust2 = Main.dust[num561];
				dust2.scale *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
			}
			for (int num562 = 0; num562 < 40; num562++)
			{
				int num563 = Main.rand.Next(276, 283);
				int num564 = Gore.NewGore(position, velocity, num563);
				Main.gore[num564].velocity.X += (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.gore[num564].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.gore[num564].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.gore[num564].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
				Gore gore2 = Main.gore[num564];
				gore2.scale *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
				Main.gore[num564].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
				Main.gore[num564].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.05f;
			}
		}
		else if (type == 289)
		{
			for (int num565 = 0; num565 < 30; num565++)
			{
				int num566 = Main.rand.Next(139, 143);
				int num567 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num566, velocity.X, velocity.Y, 0, default(Color), 1.2f);
				Main.dust[num567].velocity.X += (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.dust[num567].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.dust[num567].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.dust[num567].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.dust[num567].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
				Main.dust[num567].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.05f;
				Dust dust2 = Main.dust[num567];
				dust2.scale *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
			}
			for (int num568 = 0; num568 < 15; num568++)
			{
				int num569 = Main.rand.Next(276, 283);
				int num570 = Gore.NewGore(position, velocity, num569);
				Main.gore[num570].velocity.X += (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.gore[num570].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.gore[num570].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
				Main.gore[num570].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
				Gore gore2 = Main.gore[num570];
				gore2.scale *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
				Main.gore[num570].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
				Main.gore[num570].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.05f;
			}
		}
		else if (type == 475 || type == 505 || type == 506)
		{
			if (ai[1] == 0f)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			}
			if (ai[1] < 10f)
			{
				Vector2 vector58 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num571 = 0f - velocity.X;
				float num572 = 0f - velocity.Y;
				float num573 = 1f;
				if (ai[0] <= 17f)
				{
					num573 = ai[0] / 17f;
				}
				int num574 = (int)(30f * num573);
				float num575 = 1f;
				if (ai[0] <= 30f)
				{
					num575 = ai[0] / 30f;
				}
				float num576 = 0.4f * num575;
				float num577 = num576;
				num572 += num577;
				for (int num578 = 0; num578 < num574; num578++)
				{
					float num579 = (float)Math.Sqrt(num571 * num571 + num572 * num572);
					float num580 = 5.6f;
					if (Math.Abs(num571) + Math.Abs(num572) < 1f)
					{
						num580 *= Math.Abs(num571) + Math.Abs(num572) / 1f;
					}
					num579 = num580 / num579;
					num571 *= num579;
					num572 *= num579;
					float num581 = (float)Math.Atan2(num572, num571) - 1.57f;
					int num582 = 3;
					if (type == 506)
					{
						num582 = 30;
					}
					if (type == 505)
					{
						num582 = 239;
					}
					if ((float)num578 > ai[1])
					{
						for (int num583 = 0; num583 < 4; num583++)
						{
							int num584 = Dust.NewDust(vector58, width, height, num582);
							Main.dust[num584].noGravity = true;
							Dust dust2 = Main.dust[num584];
							dust2.velocity *= 0.3f;
						}
					}
					vector58.X += num571;
					vector58.Y += num572;
					num571 = 0f - velocity.X;
					num572 = 0f - velocity.Y;
					num577 += num576;
					num572 += num577;
				}
			}
		}
		else if (type == 171)
		{
			if (ai[1] == 0f)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			}
			if (ai[1] < 10f)
			{
				Vector2 vector59 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num585 = 0f - velocity.X;
				float num586 = 0f - velocity.Y;
				float num587 = 1f;
				if (ai[0] <= 17f)
				{
					num587 = ai[0] / 17f;
				}
				int num588 = (int)(30f * num587);
				float num589 = 1f;
				if (ai[0] <= 30f)
				{
					num589 = ai[0] / 30f;
				}
				float num590 = 0.4f * num589;
				float num591 = num590;
				num586 += num591;
				for (int num592 = 0; num592 < num588; num592++)
				{
					float num593 = (float)Math.Sqrt(num585 * num585 + num586 * num586);
					float num594 = 5.6f;
					if (Math.Abs(num585) + Math.Abs(num586) < 1f)
					{
						num594 *= Math.Abs(num585) + Math.Abs(num586) / 1f;
					}
					num593 = num594 / num593;
					num585 *= num593;
					num586 *= num593;
					float num595 = (float)Math.Atan2(num586, num585) - 1.57f;
					if ((float)num592 > ai[1])
					{
						for (int num596 = 0; num596 < 4; num596++)
						{
							int num597 = Dust.NewDust(vector59, width, height, 129);
							Main.dust[num597].noGravity = true;
							Dust dust2 = Main.dust[num597];
							dust2.velocity *= 0.3f;
						}
					}
					vector59.X += num585;
					vector59.Y += num586;
					num585 = 0f - velocity.X;
					num586 = 0f - velocity.Y;
					num591 += num590;
					num586 += num591;
				}
			}
		}
		else if (type == 117)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			for (int num598 = 0; num598 < 10; num598++)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 26);
			}
		}
		else if (type == 166)
		{
			SoundEngine.PlaySound(SoundID.Item51, position);
			for (int num599 = 0; num599 < 10; num599++)
			{
				int num600 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 76);
				Main.dust[num600].noGravity = true;
				Dust dust2 = Main.dust[num600];
				dust2.velocity -= oldVelocity * 0.25f;
			}
		}
		else if (type == 158)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			for (int num601 = 0; num601 < 10; num601++)
			{
				int num602 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 9);
				Main.dust[num602].noGravity = true;
				Dust dust2 = Main.dust[num602];
				dust2.velocity -= velocity * 0.5f;
			}
		}
		else if (type == 159)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			for (int num603 = 0; num603 < 10; num603++)
			{
				int num604 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 11);
				Main.dust[num604].noGravity = true;
				Dust dust2 = Main.dust[num604];
				dust2.velocity -= velocity * 0.5f;
			}
		}
		else if (type == 160)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			for (int num605 = 0; num605 < 10; num605++)
			{
				int num606 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 19);
				Main.dust[num606].noGravity = true;
				Dust dust2 = Main.dust[num606];
				dust2.velocity -= velocity * 0.5f;
			}
		}
		else if (type == 161)
		{
			SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			for (int num607 = 0; num607 < 10; num607++)
			{
				int num608 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 11);
				Main.dust[num608].noGravity = true;
				Dust dust2 = Main.dust[num608];
				dust2.velocity -= velocity * 0.5f;
			}
		}
		else if (type >= 191 && type <= 194)
		{
			int num609 = Gore.NewGore(new Vector2(position.X - (float)(width / 2), position.Y - (float)(height / 2)), new Vector2(0f, 0f), Main.rand.Next(61, 64), scale);
			Gore gore2 = Main.gore[num609];
			gore2.velocity *= 0.1f;
		}
		else if (!Main.projPet[type])
		{
			if (type == 1024)
			{
				SoundEngine.PlaySound(SoundID.Item8, (int)position.X, (int)position.Y);
				for (int num610 = 0; num610 < 12; num610++)
				{
					Dust dust50 = Dust.NewDustDirect(position, width, height, 306, 0f, 0f, 0, Color.Transparent, 0.8f + Main.rand.NextFloat() * 1.7f);
					dust50.velocity = velocity.SafeNormalize(Vector2.Zero).RotatedBy((float)Math.PI * 2f * (float)num610 / 12f) * 8f * (0.1f + Main.rand.NextFloat() * 1.2f);
					dust50.color = Color.Lerp(Color.White, new Color(140, 234, 180), (float)num610 / 10f);
					dust50.noGravity = true;
				}
			}
			else if (type == 93)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num611 = 0; num611 < 10; num611++)
				{
					int num612 = Dust.NewDust(position, width, height, 57, 0f, 0f, 100);
					Main.dust[num612].noGravity = true;
					Main.dust[num612].fadeIn = 1f;
					Main.dust[num612].velocity.X *= 2f;
					Main.dust[num612].velocity.Y *= 2f;
					Main.dust[num612].velocity.Y -= Main.rand.NextFloat() * 1.5f;
				}
			}
			else if (type == 99 || type == 1013 || type == 727 || type == 1014 || type == 1021 || type == 1048 || type == 1053 || type == 1054 || type == 1055 || type == 1057)
			{
				if (owner == Main.myPlayer && Main.netMode != 0)
				{
					NetMessage.SendData(27, -1, -1, null, whoAmI);
				}
				short num613 = 1;
				num613 = type switch
				{
					1013 => 243, 
					727 => 40, 
					1014 => 12, 
					1021 => 323, 
					1048 => 322, 
					_ => 1, 
				};
				if (type == 1048)
				{
					SoundEngine.PlaySound(SoundID.Item16, (int)position.X, (int)position.Y);
				}
				else if (type == 1053)
				{
					SoundEngine.PlaySound(SoundID.Item14, (int)position.X, (int)position.Y);
				}
				else if (type == 1054)
				{
					SoundEngine.PlaySound(SoundID.NPCHit29, (int)position.X, (int)position.Y);
				}
				else if (type == 1055)
				{
					SoundEngine.PlaySound(SoundID.NPCDeath6, (int)position.X, (int)position.Y);
				}
				else
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				}
				if (type == 1053)
				{
					position.X += width / 2;
					position.Y += height / 2;
					width = 64;
					height = 64;
					position.X -= width / 2;
					position.Y -= height / 2;
					for (int num614 = 0; num614 < 25; num614++)
					{
						int num615 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 2f);
						Dust dust2 = Main.dust[num615];
						dust2.velocity *= 1.4f;
					}
					for (int num616 = 0; num616 < 40; num616++)
					{
						int num617 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 3f);
						Main.dust[num617].noGravity = true;
						Dust dust2 = Main.dust[num617];
						dust2.velocity *= 5f;
						num617 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2f);
						dust2 = Main.dust[num617];
						dust2.velocity *= 3f;
					}
					int num618 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num618].scale = 1.5f;
					Main.gore[num618].velocity.X += 1.5f;
					Main.gore[num618].velocity.Y += 1.5f;
					num618 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num618].scale = 1.5f;
					Main.gore[num618].velocity.X -= 1.5f;
					Main.gore[num618].velocity.Y += 1.5f;
					num618 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num618].scale = 1.5f;
					Main.gore[num618].velocity.X += 1.5f;
					Main.gore[num618].velocity.Y -= 1.5f;
					num618 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num618].scale = 1.5f;
					Main.gore[num618].velocity.X -= 1.5f;
					Main.gore[num618].velocity.Y -= 1.5f;
					position.X += width / 2;
					position.Y += height / 2;
					width = 31;
					height = 31;
					position.X -= width / 2;
					position.Y -= height / 2;
				}
				else if (type == 1054)
				{
					for (int num619 = 0; num619 < 20; num619++)
					{
						Dust.NewDust(position, width, height, 30, 0f, -1f);
					}
				}
				else if (type == 1055)
				{
					for (int num620 = 0; num620 < 50; num620++)
					{
						int num621 = Dust.NewDust(position + new Vector2(4f, 4f), width - 8, height - 8, 192, velocity.X * 0.5f, velocity.Y * 0.5f, 100, new Color(100, 100, 100, 100));
						Dust dust2 = Main.dust[num621];
						dust2.scale *= 1.5f;
						dust2 = Main.dust[num621];
						dust2.velocity *= 2f;
						Main.dust[num621].noGravity = true;
					}
				}
				else if (type != 1057)
				{
					for (int num622 = 0; num622 < 30; num622++)
					{
						int num623 = Dust.NewDust(position, width, height, num613);
						if (Main.rand.Next(2) == 0)
						{
							Dust dust2 = Main.dust[num623];
							dust2.scale *= 1.4f;
						}
						velocity *= 1.9f;
					}
				}
				if (type == 1057 && owner == Main.myPlayer)
				{
					int number = Item.NewItem(new EntitySource_Loot(this), position, base.Size, 5523);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number, 1f);
					}
				}
				if (type == 1014 && owner == Main.myPlayer)
				{
					int number2 = Item.NewItem(new EntitySource_Loot(this), position, base.Size, 29);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number2, 1f);
					}
				}
				if (Main.netMode != 1)
				{
					if (type == 1048)
					{
						Point pt = base.Center.ToTileCoordinates();
						Kill_DirtAndFluidProjectiles_RunDelegateMethodPushUpForHalfBricks(pt, 2f, DelegateMethods.SpreadPoopPyramid);
					}
					if (type == 1053)
					{
						LavaBoulderExplosion();
					}
				}
			}
			else if (type == 1005)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num624 = 0; num624 < 10; num624++)
				{
					int num625 = Dust.NewDust(position, width, height, 1);
					if (Main.rand.Next(2) == 0)
					{
						Dust dust2 = Main.dust[num625];
						dust2.scale *= 1.1f;
					}
					velocity *= 1.6f;
				}
			}
			else if (type == 1078)
			{
				if (Main.netMode != 1 && Main.rand.Next(16) == 0)
				{
					int number3 = Item.NewItem(new EntitySource_Loot(this), position, base.Size, 116, Main.rand.Next(2, 7));
					NetMessage.SendData(21, -1, -1, null, number3, 1f);
				}
				int num626 = Main.rand.Next(1, 4);
				for (int num627 = 0; num627 < num626; num627++)
				{
					SoundEngine.PlayTrackedSound(SoundID.MeteorShower, position);
				}
				position.X += width / 2;
				position.Y += height / 2;
				width = (int)(192f * scale);
				height = (int)(192f * scale);
				position.X -= width / 2;
				position.Y -= height / 2;
				Resize(64, 64);
				if (owner == Main.myPlayer)
				{
					Damage();
				}
				for (int num628 = 0; num628 < 6; num628++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				}
				if (!wet)
				{
					for (int num629 = 0; num629 < 24; num629++)
					{
						int num630 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num630].noGravity = true;
						Dust dust2 = Main.dust[num630];
						dust2.velocity *= 3f;
						num630 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust2 = Main.dust[num630];
						dust2.velocity *= 2f;
						Main.dust[num630].noGravity = true;
					}
					for (int num631 = 0; num631 < 4; num631++)
					{
						int num632 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
						int num633 = Dust.NewDust(position, width, height, num632, 2.5f * (float)direction, -2.5f);
						Main.dust[num633].alpha = 200;
						Dust dust2 = Main.dust[num633];
						dust2.velocity *= 2.4f;
						dust2 = Main.dust[num633];
						dust2.scale += Main.rand.NextFloat();
					}
				}
				for (int num634 = 0; num634 < 3; num634++)
				{
					int num635 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num635].position = base.Center + Main.rand.NextVector2Circular(25f, 25f) + new Vector2(-20f, -20f);
					Gore gore2 = Main.gore[num635];
					gore2.velocity *= 0.3f;
					Main.gore[num635].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num635].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
			}
			else if (type == 772)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num636 = 0; num636 < 6; num636++)
				{
					int num637 = Dust.NewDust(position, width, height, 1);
					velocity *= 1.9f;
				}
				for (int num638 = 0; num638 < 20; num638++)
				{
					Dust dust51 = Dust.NewDustDirect(position, width, height, Main.rand.NextFromList<int>(86, 87, 88, 89, 90), 0f, 0f, 0, default(Color), 0.7f);
					dust51.noGravity = true;
					Dust dust2 = dust51;
					dust2.velocity *= 2.9f;
					dust51.velocity.Y *= 0.8f;
					dust51.fadeIn = 1.1f;
				}
				for (int num639 = 0; num639 < 7; num639++)
				{
					Dust dust52 = Dust.NewDustDirect(position, width, height, Main.rand.NextFromList<int>(86, 87, 88, 89, 90), 0f, 0f, 0, default(Color), 0.7f);
					dust52.noGravity = true;
					Dust dust2 = dust52;
					dust2.velocity *= 2.9f;
					dust52.velocity.Y *= 0.8f;
					dust52.fadeIn = 1.1f;
					dust52.noLight = true;
				}
				if (owner == Main.myPlayer)
				{
					DropGeodeGems();
				}
			}
			else if (type == 763)
			{
				for (int num640 = 0; num640 < 4; num640++)
				{
					int num641 = Dust.NewDust(position, width, height, 40);
					if (Main.rand.Next(2) == 0)
					{
						Dust dust2 = Main.dust[num641];
						dust2.scale *= 0.8f;
					}
					Main.dust[num641].noGravity = true;
					velocity *= 1.9f;
				}
			}
			else if (type == 655)
			{
				SoundEngine.PlaySound(4, (int)position.X, (int)position.Y);
				for (int num642 = 0; num642 < 30; num642++)
				{
					int num643 = Dust.NewDust(position, width, height, 147);
					if (Main.rand.Next(2) == 0)
					{
						Dust dust2 = Main.dust[num643];
						dust2.scale *= 1.4f;
					}
					velocity *= 1.9f;
				}
				if (Main.netMode != 1)
				{
					if (wet)
					{
						int number4 = Item.NewItem(new EntitySource_Loot(this), position, base.Size, 1124, Main.rand.Next(2, 6));
						NetMessage.SendData(21, -1, -1, null, number4);
					}
					else
					{
						int num644 = 2;
						if (Main.rand.Next(3) == 0)
						{
							num644++;
						}
						if (Main.rand.Next(3) == 0)
						{
							num644++;
						}
						if (Main.rand.Next(3) == 0)
						{
							num644++;
						}
						int availableAmountOfNPCsToSpawnUpToSlot = NPC.GetAvailableAmountOfNPCsToSpawnUpToSlot(num644);
						for (int num645 = 0; num645 < availableAmountOfNPCsToSpawnUpToSlot; num645++)
						{
							int num646 = Main.rand.Next(210, 212);
							int num647 = NPC.NewNPC(GetNPCSource_FromThis(), (int)base.Center.X, (int)base.Center.Y, num646, 1);
							Main.npc[num647].velocity.X = (float)Main.rand.Next(-200, 201) * 0.002f;
							Main.npc[num647].velocity.Y = (float)Main.rand.Next(-200, 201) * 0.002f;
							Main.npc[num647].CanBeReplacedByOtherNPCs = true;
							Main.npc[num647].netUpdate = true;
						}
					}
				}
			}
			else if (type == 728)
			{
				SoundEngine.PlaySound(SoundID.Item10, position);
				for (int num648 = 0; num648 < 7; num648++)
				{
					Dust.NewDust(position, width, height, 58, velocity.X * 0.1f, velocity.Y * 0.1f, 150, default(Color), 0.8f);
				}
				for (float num649 = 0f; num649 < 1f; num649 += 0.125f)
				{
					Dust.NewDustPerfect(base.Center, 278, Vector2.UnitY.RotatedBy(num649 * ((float)Math.PI * 2f) + Main.rand.NextFloat() * 0.5f) * (4f + Main.rand.NextFloat() * 4f), 150, Color.CornflowerBlue).noGravity = true;
				}
				for (float num650 = 0f; num650 < 1f; num650 += 0.25f)
				{
					Dust.NewDustPerfect(base.Center, 278, Vector2.UnitY.RotatedBy(num650 * ((float)Math.PI * 2f) + Main.rand.NextFloat() * 0.5f) * (2f + Main.rand.NextFloat() * 3f), 150, Color.Gold).noGravity = true;
				}
				Vector2 vector60 = new Vector2(Main.screenWidth, Main.screenHeight);
				if (base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector60 / 2f, vector60 + new Vector2(400f))))
				{
					for (int num651 = 0; num651 < 7; num651++)
					{
						Gore.NewGore(position, Main.rand.NextVector2CircularEdge(0.5f, 0.5f) * velocity.Length(), Utils.SelectRandom<int>(Main.rand, 16, 17, 17, 17, 17, 17, 17, 17));
					}
				}
			}
			else if (type == 729)
			{
				SoundEngine.PlaySound(SoundID.Item10, position);
				for (int num652 = 0; num652 < 10; num652++)
				{
					Dust dust53 = Dust.NewDustDirect(position, width, height, 279, velocity.X * 0.1f, velocity.Y * 0.1f, 150, default(Color), 1.2f);
					dust53.noGravity = true;
					dust53.velocity.X *= 2f;
				}
			}
			else if (type == 723 || type == 724 || type == 725 || type == 726 || type == 907)
			{
				if (type == 723)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num653 = 0; num653 < 10; num653++)
					{
						Dust dust54 = Dust.NewDustDirect(position, width, height, 88, velocity.X * 0.1f, velocity.Y * 0.1f, 150, default(Color), 1.2f);
						dust54.noGravity = true;
						dust54.velocity.X *= 2f;
					}
					for (int num654 = 0; num654 < 3; num654++)
					{
						Gore gore3 = Gore.NewGoreDirect(position, new Vector2(velocity.X * 0.05f, velocity.Y * 0.05f), Utils.SelectRandom<int>(Main.rand, 16, 17, 17));
						Gore gore2 = gore3;
						gore2.velocity *= 2f;
					}
					if (owner == Main.myPlayer && Main.player[owner].starCloakCooldown == 0)
					{
						Main.player[owner].starCloakCooldown = 60;
						int number5 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 4143);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number5, 1f);
						}
					}
				}
				else
				{
					if (type == 907)
					{
						SoundEngine.PlaySound(SoundID.Item27, position);
					}
					else
					{
						SoundEngine.PlaySound(SoundID.Item10, position);
					}
					for (int num655 = 0; num655 < 10; num655++)
					{
						Dust dust55 = Main.dust[Dust.NewDust(position, width, height, 58, velocity.X * 0.1f, velocity.Y * 0.1f, 150, default(Color), 1.2f)];
						if (type == 907)
						{
							Dust dust2 = dust55;
							dust2.velocity *= 0.75f;
						}
					}
					for (int num656 = 0; num656 < 3; num656++)
					{
						Gore gore4 = Main.gore[Gore.NewGore(position, new Vector2(velocity.X * 0.05f, velocity.Y * 0.05f), Main.rand.Next(16, 18))];
						if (type == 907)
						{
							Gore gore2 = gore4;
							gore2.velocity *= 0.5f;
						}
					}
				}
			}
			else if (type == 91 || type == 92)
			{
				SoundEngine.PlaySound(SoundID.Item10, position);
				for (int num657 = 0; num657 < 10; num657++)
				{
					Dust.NewDust(position, width, height, 58, velocity.X * 0.1f, velocity.Y * 0.1f, 150, default(Color), 1.2f);
				}
				for (int num658 = 0; num658 < 3; num658++)
				{
					Gore.NewGore(position, new Vector2(velocity.X * 0.05f, velocity.Y * 0.05f), Main.rand.Next(16, 18));
				}
				if ((type == 91 || (type == 92 && ai[0] > 0f)) && owner == Main.myPlayer)
				{
					float x = position.X + (float)Main.rand.Next(-400, 400);
					float y = position.Y - (float)Main.rand.Next(600, 900);
					Vector2 vector61 = new Vector2(x, y);
					float num659 = position.X + (float)(width / 2) - vector61.X;
					float num660 = position.Y + (float)(height / 2) - vector61.Y;
					int num661 = 22;
					float num662 = (float)Math.Sqrt(num659 * num659 + num660 * num660);
					num662 = (float)num661 / num662;
					num659 *= num662;
					num660 *= num662;
					int num663 = damage;
					if (type == 91)
					{
						num663 /= 3;
					}
					int num664 = NewProjectile(GetProjectileSource_FromThis(), x, y, num659, num660, 92, num663, knockBack, owner);
					if (type == 91)
					{
						Main.projectile[num664].ai[1] = position.Y;
						Main.projectile[num664].ai[0] = 1f;
					}
					else
					{
						Main.projectile[num664].ai[1] = position.Y;
					}
				}
			}
			else if (type == 89)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num665 = 0; num665 < 5; num665++)
				{
					int num666 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 68);
					Main.dust[num666].noGravity = true;
					Dust dust2 = Main.dust[num666];
					dust2.velocity *= 1.5f;
					dust2 = Main.dust[num666];
					dust2.scale *= 0.9f;
				}
				if (type == 89 && owner == Main.myPlayer)
				{
					for (int num667 = 0; num667 < 2; num667++)
					{
						float num668 = (0f - velocity.X) * (float)Main.rand.Next(40, 70) * 0.01f + (float)Main.rand.Next(-20, 21) * 0.4f;
						float num669 = (0f - velocity.Y) * (float)Main.rand.Next(40, 70) * 0.01f + (float)Main.rand.Next(-20, 21) * 0.4f;
						NewProjectile(GetProjectileSource_FromThis(), position.X + num668, position.Y + num669, num668, num669, 90, (int)((double)damage * 0.5), 0f, owner);
					}
				}
			}
			else if (type == 967)
			{
				SoundEngine.PlaySound(SoundID.Item45, position);
				for (int num670 = 0; num670 < 20; num670++)
				{
					int num671 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 219, velocity.X, velocity.Y, 0, default(Color), 0.5f + (float)Main.rand.Next(-20, 40) * 0.01f);
					Main.dust[num671].noGravity = true;
					Main.dust[num671].velocity = Main.rand.NextVector2Circular(6f, 6f);
				}
			}
			else if (type == 1026)
			{
				SoundEngine.PlaySound(SoundID.Item167, position);
				for (int num672 = 0; num672 < 20; num672++)
				{
					int num673 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 2, velocity.X, velocity.Y, 0, default(Color), 1.2f + (float)Main.rand.Next(-20, 40) * 0.01f);
					Main.dust[num673].alpha = 50;
					Main.dust[num673].fadeIn = 0.5f;
					Main.dust[num673].noGravity = true;
					Main.dust[num673].velocity = Main.rand.NextVector2Circular(5f, 5f);
				}
			}
			else if (type == 969)
			{
				ActiveSound activeSound2 = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]));
				if (activeSound2 != null)
				{
					activeSound2.Volume = 0f;
					activeSound2.Stop();
				}
			}
			else if (type == 177)
			{
				for (int num674 = 0; num674 < 20; num674++)
				{
					int num675 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 137, 0f, 0f, Main.rand.Next(0, 101), default(Color), 1f + (float)Main.rand.Next(-20, 40) * 0.01f);
					Dust dust2 = Main.dust[num675];
					dust2.velocity -= oldVelocity * 0.2f;
					if (Main.rand.Next(3) == 0)
					{
						dust2 = Main.dust[num675];
						dust2.scale *= 0.8f;
						dust2 = Main.dust[num675];
						dust2.velocity *= 0.5f;
					}
					else
					{
						Main.dust[num675].noGravity = true;
					}
				}
			}
			else if (type == 119 || type == 118 || type == 128 || type == 359)
			{
				int num676 = 10;
				if (type == 119 || type == 359)
				{
					num676 = 20;
				}
				SoundEngine.PlaySound(SoundID.Item27, position);
				for (int num677 = 0; num677 < num676; num677++)
				{
					int num678 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 92);
					if (Main.rand.Next(3) != 0)
					{
						Dust dust2 = Main.dust[num678];
						dust2.velocity *= 2f;
						Main.dust[num678].noGravity = true;
						dust2 = Main.dust[num678];
						dust2.scale *= 1.75f;
					}
					else
					{
						Dust dust2 = Main.dust[num678];
						dust2.scale *= 0.5f;
					}
				}
			}
			else if (type == 309)
			{
				int num679 = 10;
				SoundEngine.PlaySound(SoundID.Item27, position);
				for (int num680 = 0; num680 < num679; num680++)
				{
					int num681 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 185);
					if (Main.rand.Next(2) == 0)
					{
						Dust dust2 = Main.dust[num681];
						dust2.velocity *= 2f;
						Main.dust[num681].noGravity = true;
						dust2 = Main.dust[num681];
						dust2.scale *= 1.75f;
					}
				}
			}
			else if (type == 308)
			{
				int num682 = 80;
				SoundEngine.PlaySound(SoundID.Item27, position);
				for (int num683 = 0; num683 < num682; num683++)
				{
					int num684 = Dust.NewDust(new Vector2(position.X, position.Y + 16f), width, height - 16, 185);
					Dust dust2 = Main.dust[num684];
					dust2.velocity *= 2f;
					Main.dust[num684].noGravity = true;
					dust2 = Main.dust[num684];
					dust2.scale *= 1.15f;
				}
			}
			else if (aiStyle == 29 && type <= 126)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				int num685 = type - 121 + 86;
				for (int num686 = 0; num686 < 15; num686++)
				{
					int num687 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num685, oldVelocity.X, oldVelocity.Y, 50, default(Color), 1.2f);
					Main.dust[num687].noGravity = true;
					Dust dust2 = Main.dust[num687];
					dust2.scale *= 1.25f;
					dust2 = Main.dust[num687];
					dust2.velocity *= 0.5f;
				}
			}
			else if (type == 597)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num688 = 0; num688 < 15; num688++)
				{
					int num689 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 262, oldVelocity.X, oldVelocity.Y, 50, default(Color), 1.2f);
					Main.dust[num689].noGravity = true;
					Dust dust2 = Main.dust[num689];
					dust2.scale *= 1.25f;
					dust2 = Main.dust[num689];
					dust2.velocity *= 0.5f;
				}
			}
			else if (type == 731)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num690 = 0; num690 < 15; num690++)
				{
					Dust dust56 = Dust.NewDustDirect(position, width, height, 226, oldVelocity.X * 0.5f, oldVelocity.Y * 0.5f, 50, default(Color), 0.5f);
					if (Main.rand.Next(3) != 0)
					{
						dust56.noGravity = true;
						Dust dust2 = dust56;
						dust2.scale *= 1.5f;
						dust2 = dust56;
						dust2.velocity *= 0.5f;
					}
				}
			}
			else if (type == 337)
			{
				SoundEngine.PlaySound(SoundID.Item27, position);
				for (int num691 = 0; num691 < 10; num691++)
				{
					int num692 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 197);
					Main.dust[num692].noGravity = true;
				}
			}
			else if (type == 379 || type == 377)
			{
				for (int num693 = 0; num693 < 5; num693++)
				{
					int num694 = Dust.NewDust(position, width, height, 171, 0f, 0f, 100);
					Main.dust[num694].scale = (float)Main.rand.Next(1, 10) * 0.1f;
					Main.dust[num694].noGravity = true;
					Main.dust[num694].fadeIn = 1.5f;
					Dust dust2 = Main.dust[num694];
					dust2.velocity *= 0.75f;
				}
			}
			else if (type == 80)
			{
				if (ai[0] >= 0f)
				{
					SoundEngine.PlaySound(SoundID.Item27, position);
					for (int num695 = 0; num695 < 10; num695++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 67);
					}
				}
				int num696 = (int)position.X / 16;
				int num697 = (int)position.Y / 16;
				if (Main.tile[num696, num697] == null)
				{
					Main.tile[num696, num697] = new Tile();
				}
				if (Main.tile[num696, num697].type == 127 && Main.tile[num696, num697].active())
				{
					WorldGen.KillTile(num696, num697);
				}
			}
			else if (type == 76 || type == 77 || type == 78)
			{
				for (int num698 = 0; num698 < 5; num698++)
				{
					int num699 = Dust.NewDust(position, width, height, 27, 0f, 0f, 80, default(Color), 1.5f);
					Main.dust[num699].noGravity = true;
				}
			}
			else if (type == 55 || type == 719)
			{
				for (int num700 = 0; num700 < 5; num700++)
				{
					int num701 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 18, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num701].noGravity = true;
				}
			}
			else if (type == 51 || type == 267)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num702 = 0; num702 < 5; num702++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 0, 0f, 0f, 0, default(Color), 0.7f);
				}
			}
			else if (type == 478)
			{
				if (owner == Main.myPlayer)
				{
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 480, (int)((double)damage * 0.8), knockBack * 0.5f, owner);
				}
			}
			else if (type == 477 || type == 479)
			{
				for (int num703 = 0; num703 < 5; num703++)
				{
				}
				Collision.HitTiles(position, velocity, width, height);
			}
			else if (type == 2 || type == 82)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num704 = 0; num704 < 10; num704++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100);
				}
			}
			else if (type == 474)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num705 = 0; num705 < 20; num705++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 26, 0f, 0f, 0, default(Color), 0.9f);
				}
			}
			else if (type == 172)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num706 = 0; num706 < 20; num706++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 135, 0f, 0f, 100);
				}
			}
			else if (type == 103)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num707 = 0; num707 < 20; num707++)
				{
					int num708 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 75, 0f, 0f, 100);
					if (Main.rand.Next(2) == 0)
					{
						Dust dust2 = Main.dust[num708];
						dust2.scale *= 2.5f;
						Main.dust[num708].noGravity = true;
						dust2 = Main.dust[num708];
						dust2.velocity *= 5f;
					}
				}
			}
			else if (type == 278)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num709 = 0; num709 < 20; num709++)
				{
					int num710 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 169, 0f, 0f, 100);
					if (Main.rand.Next(2) == 0)
					{
						Dust dust2 = Main.dust[num710];
						dust2.scale *= 1.5f;
						Main.dust[num710].noGravity = true;
						dust2 = Main.dust[num710];
						dust2.velocity *= 5f;
					}
				}
			}
			else if (type == 3 || type == 48 || type == 54 || type == 599 || type == 909)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num711 = 0; num711 < 10; num711++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 1, velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.75f);
				}
			}
			else if (type == 330)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num712 = 0; num712 < 10; num712++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 0, velocity.X * 0.4f, velocity.Y * 0.4f, 0, default(Color), 0.75f);
				}
			}
			else if (type == 4)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num713 = 0; num713 < 10; num713++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 14, 0f, 0f, 150, default(Color), 1.1f);
				}
			}
			else if (type == 5)
			{
				SoundEngine.PlaySound(SoundID.Item10, position);
				for (int num714 = 0; num714 < 60; num714++)
				{
					int num715 = Main.rand.Next(3);
					Dust.NewDust(position, width, height, num715 switch
					{
						0 => 15, 
						1 => 57, 
						_ => 58, 
					}, velocity.X * 0.5f, velocity.Y * 0.5f, 150, default(Color), 1.5f);
				}
			}
			else if (type == 9 || type == 12 || type == 503 || type == 955)
			{
				SoundEngine.PlaySound(SoundID.Item10, position);
				if (type == 12 || type == 955)
				{
					Color newColor8 = Color.CornflowerBlue;
					if (Main.tenthAnniversaryWorld && (type == 12 || type == 955))
					{
						newColor8 = Color.HotPink;
						newColor8.A /= 2;
					}
					for (int num716 = 0; num716 < 7; num716++)
					{
						Dust.NewDust(position, width, height, 58, velocity.X * 0.1f, velocity.Y * 0.1f, 150, default(Color), 0.8f);
					}
					for (float num717 = 0f; num717 < 1f; num717 += 0.125f)
					{
						Dust.NewDustPerfect(base.Center, 278, Vector2.UnitY.RotatedBy(num717 * ((float)Math.PI * 2f) + Main.rand.NextFloat() * 0.5f) * (4f + Main.rand.NextFloat() * 4f), 150, newColor8).noGravity = true;
					}
					for (float num718 = 0f; num718 < 1f; num718 += 0.25f)
					{
						Dust.NewDustPerfect(base.Center, 278, Vector2.UnitY.RotatedBy(num718 * ((float)Math.PI * 2f) + Main.rand.NextFloat() * 0.5f) * (2f + Main.rand.NextFloat() * 3f), 150, Color.Gold).noGravity = true;
					}
					Vector2 vector62 = new Vector2(Main.screenWidth, Main.screenHeight);
					if (base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector62 / 2f, vector62 + new Vector2(400f))))
					{
						for (int num719 = 0; num719 < 7; num719++)
						{
							Gore.NewGore(position, Main.rand.NextVector2CircularEdge(0.5f, 0.5f) * velocity.Length(), Utils.SelectRandom<int>(Main.rand, 16, 17, 17, 17, 17, 17, 17, 17));
						}
					}
				}
				else
				{
					int num720 = 10;
					int num721 = 3;
					if (type == 503)
					{
						num720 = 40;
						num721 = 2;
						velocity /= 2f;
					}
					for (int num722 = 0; num722 < num720; num722++)
					{
						Dust.NewDust(position, width, height, 58, velocity.X * 0.1f, velocity.Y * 0.1f, 150, default(Color), 1.2f);
					}
					for (int num723 = 0; num723 < num721; num723++)
					{
						int num724 = Main.rand.Next(16, 18);
						if (type == 503)
						{
							num724 = 16;
						}
						Gore.NewGore(position, new Vector2(velocity.X * 0.05f, velocity.Y * 0.05f), num724);
					}
					if (type == 12 && damage < 100)
					{
						for (int num725 = 0; num725 < 10; num725++)
						{
							Dust.NewDust(position, width, height, 57, velocity.X * 0.1f, velocity.Y * 0.1f, 150, default(Color), 1.2f);
						}
						for (int num726 = 0; num726 < 3; num726++)
						{
							Gore.NewGore(position, new Vector2(velocity.X * 0.05f, velocity.Y * 0.05f), Main.rand.Next(16, 18));
						}
					}
				}
			}
			else if (type == 281)
			{
				if (ai[0] != -3f)
				{
					SoundEngine.PlaySound(4, (int)position.X, (int)position.Y);
					int num727 = Gore.NewGore(position, new Vector2((float)Main.rand.Next(-20, 21) * 0.2f, (float)Main.rand.Next(-20, 21) * 0.2f), 76);
					Gore gore2 = Main.gore[num727];
					gore2.velocity -= velocity * 0.5f;
					num727 = Gore.NewGore(new Vector2(position.X, position.Y), new Vector2((float)Main.rand.Next(-20, 21) * 0.2f, (float)Main.rand.Next(-20, 21) * 0.2f), 77);
					gore2 = Main.gore[num727];
					gore2.velocity -= velocity * 0.5f;
					SoundEngine.PlaySound(SoundID.Item14, position);
					for (int num728 = 0; num728 < 20; num728++)
					{
						int num729 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num729];
						dust2.velocity *= 1.4f;
					}
					for (int num730 = 0; num730 < 10; num730++)
					{
						int num731 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num731].noGravity = true;
						Dust dust2 = Main.dust[num731];
						dust2.velocity *= 5f;
						num731 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust2 = Main.dust[num731];
						dust2.velocity *= 3f;
					}
					num727 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num727];
					gore2.velocity *= 0.4f;
					Main.gore[num727].velocity.X += 1f;
					Main.gore[num727].velocity.Y += 1f;
					num727 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num727];
					gore2.velocity *= 0.4f;
					Main.gore[num727].velocity.X -= 1f;
					Main.gore[num727].velocity.Y += 1f;
					num727 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num727];
					gore2.velocity *= 0.4f;
					Main.gore[num727].velocity.X += 1f;
					Main.gore[num727].velocity.Y -= 1f;
					num727 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num727];
					gore2.velocity *= 0.4f;
					Main.gore[num727].velocity.X -= 1f;
					Main.gore[num727].velocity.Y -= 1f;
					if (damage > 0)
					{
						position.X += width / 2;
						position.Y += height / 2;
						width = 128;
						height = 128;
						position.X -= width / 2;
						position.Y -= height / 2;
						if (ai[0] == -2f)
						{
							hostile = true;
						}
						Damage();
					}
				}
			}
			else if (type == 162)
			{
				SoundEngine.PlaySound(SoundID.Item14, position);
				position.X += width / 2;
				position.Y += height / 2;
				width = 64;
				height = 64;
				position.X -= width / 2;
				position.Y -= height / 2;
				Damage();
				for (int num732 = 0; num732 < 20; num732++)
				{
					int num733 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Dust dust2 = Main.dust[num733];
					dust2.velocity *= 2.5f;
				}
				for (int num734 = 0; num734 < 50; num734++)
				{
					int num735 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
					Main.dust[num735].noGravity = true;
					Dust dust2 = Main.dust[num735];
					dust2.velocity *= (float)Main.rand.Next(50, 151) * 0.1f;
				}
				for (int num736 = 0; num736 < 10; num736++)
				{
					int num737 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
					Dust dust2 = Main.dust[num737];
					dust2.velocity *= 3f;
					Main.dust[num737].velocity.Y -= 1f;
				}
				int num738 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
				Gore gore2 = Main.gore[num738];
				gore2.velocity *= 0.4f;
				Main.gore[num738].velocity.X += 1.5f;
				Main.gore[num738].velocity.Y += 1.5f;
				num738 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
				gore2 = Main.gore[num738];
				gore2.velocity *= 0.4f;
				Main.gore[num738].velocity.X -= 1.5f;
				Main.gore[num738].velocity.Y += 1.5f;
				num738 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
				gore2 = Main.gore[num738];
				gore2.velocity *= 0.4f;
				Main.gore[num738].velocity.X += 1.5f;
				Main.gore[num738].velocity.Y -= 1.5f;
				num738 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
				gore2 = Main.gore[num738];
				gore2.velocity *= 0.4f;
				Main.gore[num738].velocity.X -= 1.5f;
				Main.gore[num738].velocity.Y -= 1.5f;
				position.X += width / 2;
				position.Y += height / 2;
				width = 144;
				height = 144;
				position.X -= width / 2;
				position.Y -= height / 2;
				Damage();
			}
			else if (type == 240)
			{
				SoundEngine.PlaySound(SoundID.Item14, position);
				for (int num739 = 0; num739 < 20; num739++)
				{
					int num740 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Dust dust2 = Main.dust[num740];
					dust2.velocity *= 1.4f;
				}
				for (int num741 = 0; num741 < 10; num741++)
				{
					int num742 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
					Main.dust[num742].noGravity = true;
					Dust dust2 = Main.dust[num742];
					dust2.velocity *= 5f;
					num742 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
					dust2 = Main.dust[num742];
					dust2.velocity *= 3f;
				}
				int num743 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
				Gore gore2 = Main.gore[num743];
				gore2.velocity *= 0.4f;
				Main.gore[num743].velocity.X += 1f;
				Main.gore[num743].velocity.Y += 1f;
				num743 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
				gore2 = Main.gore[num743];
				gore2.velocity *= 0.4f;
				Main.gore[num743].velocity.X -= 1f;
				Main.gore[num743].velocity.Y += 1f;
				num743 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
				gore2 = Main.gore[num743];
				gore2.velocity *= 0.4f;
				Main.gore[num743].velocity.X += 1f;
				Main.gore[num743].velocity.Y -= 1f;
				num743 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
				gore2 = Main.gore[num743];
				gore2.velocity *= 0.4f;
				Main.gore[num743].velocity.X -= 1f;
				Main.gore[num743].velocity.Y -= 1f;
				position.X += width / 2;
				position.Y += height / 2;
				width = 96;
				height = 96;
				position.X -= width / 2;
				position.Y -= height / 2;
				Damage();
			}
			else
			{
				_ = type;
				_ = 162;
				if (type == 283 || type == 282)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num744 = 0; num744 < 10; num744++)
					{
						int num745 = Dust.NewDust(position, width, height, 171, 0f, 0f, 100);
						Main.dust[num745].scale = (float)Main.rand.Next(1, 10) * 0.1f;
						Main.dust[num745].noGravity = true;
						Main.dust[num745].fadeIn = 1.5f;
						Dust dust2 = Main.dust[num745];
						dust2.velocity *= 0.75f;
					}
				}
				else if (type == 284)
				{
					for (int num746 = 0; num746 < 10; num746++)
					{
						int num747 = Main.rand.Next(139, 143);
						int num748 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num747, (0f - velocity.X) * 0.3f, (0f - velocity.Y) * 0.3f, 0, default(Color), 1.2f);
						Main.dust[num748].velocity.X += (float)Main.rand.Next(-50, 51) * 0.01f;
						Main.dust[num748].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.01f;
						Main.dust[num748].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
						Main.dust[num748].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
						Main.dust[num748].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
						Main.dust[num748].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.05f;
						Dust dust2 = Main.dust[num748];
						dust2.scale *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
					}
					for (int num749 = 0; num749 < 5; num749++)
					{
						int num750 = Main.rand.Next(276, 283);
						int num751 = Gore.NewGore(position, -velocity * 0.3f, num750);
						Main.gore[num751].velocity.X += (float)Main.rand.Next(-50, 51) * 0.01f;
						Main.gore[num751].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.01f;
						Main.gore[num751].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
						Main.gore[num751].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
						Gore gore2 = Main.gore[num751];
						gore2.scale *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
						Main.gore[num751].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
						Main.gore[num751].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.05f;
					}
				}
				else if (type == 286)
				{
					SoundEngine.PlaySound(SoundID.Item14, position);
					for (int num752 = 0; num752 < 7; num752++)
					{
						int num753 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					}
					for (int num754 = 0; num754 < 3; num754++)
					{
						int num755 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num755].noGravity = true;
						Dust dust2 = Main.dust[num755];
						dust2.velocity *= 3f;
						num755 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust2 = Main.dust[num755];
						dust2.velocity *= 2f;
					}
					int num756 = Gore.NewGore(new Vector2(position.X - 10f, position.Y - 10f), default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num756];
					gore2.velocity *= 0.3f;
					Main.gore[num756].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num756].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
					if (owner == Main.myPlayer)
					{
						localAI[1] = -1f;
						maxPenetrate = 0;
						position.X += width / 2;
						position.Y += height / 2;
						width = 80;
						height = 80;
						position.X -= width / 2;
						position.Y -= height / 2;
						Damage();
					}
				}
				else if (type == 14 || type == 20 || type == 88 || type == 36 || type == 83 || type == 84 || type == 389 || type == 104 || type == 279 || type == 100 || type == 110 || type == 180 || type == 207 || type == 357 || type == 242 || type == 302 || type == 257 || type == 259 || type == 285 || type == 287 || type == 576 || type == 577 || type == 876 || type == 968)
				{
					Collision.HitTiles(position, velocity, width, height);
					SoundEngine.PlaySound(SoundID.Item10, position);
				}
				else if (type == 981)
				{
					Collision.HitTiles(position, velocity, width, height);
					SoundEngine.PlaySound(SoundID.Item10, position);
					ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.SilverBulletSparkle, new ParticleOrchestraSettings
					{
						PositionInWorld = base.Center,
						MovementVector = Vector2.Zero
					}, owner);
				}
				else if (type == 1006)
				{
					Collision.HitTiles(position, velocity, width, height);
					SoundEngine.PlaySound(0, position);
					float num757 = Main.rand.NextFloat() * ((float)Math.PI * 2f);
					for (float num758 = 0f; num758 < 1f; num758 += 1f)
					{
						float num759 = num757 + (float)Math.PI * 2f * num758;
						Vector2 vector63 = Vector2.UnitX.RotatedBy(num759);
						Vector2 center = base.Center;
						float num760 = 0.4f;
						ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.ShimmerArrow, new ParticleOrchestraSettings
						{
							PositionInWorld = center,
							MovementVector = vector63 * num760
						}, owner);
					}
				}
				else if (type == 660)
				{
					Collision.HitTiles(position, velocity, width, height);
					SoundEngine.PlaySound(SoundID.Item10, position);
					int num761 = Main.rand.Next(4, 10);
					for (int num762 = 0; num762 < num761; num762++)
					{
						int num763 = Dust.NewDust(base.Center, 0, 0, 180, 0f, 0f, 100);
						Dust dust2 = Main.dust[num763];
						dust2.velocity *= 1.6f;
						Main.dust[num763].velocity.Y -= 1f;
						dust2 = Main.dust[num763];
						dust2.velocity += -velocity * (Main.rand.NextFloat() * 2f - 1f) * 0.5f;
						Main.dust[num763].scale = 2f;
						Main.dust[num763].fadeIn = 0.5f;
						Main.dust[num763].noGravity = true;
					}
				}
				else if (type == 761 || type == 762)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					if (owner == Main.myPlayer && !noDropItem)
					{
						int num764 = 4343;
						if (type == 762)
						{
							num764 = 4344;
						}
						int num765 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, num764);
						Main.item[num765].noGrabDelay = 0;
						if (Main.netMode == 1 && num765 >= 0)
						{
							NetMessage.SendData(21, -1, -1, null, num765, 1f);
						}
					}
				}
				else if (type == 712)
				{
					Collision.HitTiles(position, velocity, width, height);
					SoundEngine.PlaySound(SoundID.Item10, position);
					int num766 = Main.rand.Next(6, 12);
					for (int num767 = 0; num767 < num766; num767++)
					{
						int num768 = Dust.NewDust(base.Center, 0, 0, 15, 0f, 0f, 100);
						Dust dust2 = Main.dust[num768];
						dust2.velocity *= 1.6f;
						Main.dust[num768].velocity.Y -= 1f;
						dust2 = Main.dust[num768];
						dust2.velocity += -velocity * (Main.rand.NextFloat() * 2f - 1f) * 0.5f;
						Main.dust[num768].scale = 1f;
						Main.dust[num768].fadeIn = 1.5f;
						Main.dust[num768].noGravity = true;
						Main.dust[num768].color = new Color(255, 255, 255, 0) * 0.3f;
						dust2 = Main.dust[num768];
						dust2.velocity *= 0.7f;
						dust2 = Main.dust[num768];
						dust2.position += Main.dust[num768].velocity * 5f;
					}
					for (int num769 = 0; num769 < 3; num769++)
					{
						Gore gore5 = Gore.NewGoreDirect(position, Vector2.Zero, 1008, 1f + Main.rand.NextFloatDirection() * 0.2f);
						Gore gore2 = gore5;
						gore2.velocity *= 4f;
					}
				}
				else if (type == 638)
				{
					Collision.HitTiles(position, velocity, width, height);
					SoundEngine.PlaySound(SoundID.Item10, position);
					int num770 = Main.rand.Next(2, 5);
					for (int num771 = 0; num771 < num770; num771++)
					{
						int num772 = Dust.NewDust(base.Center, 0, 0, 229, 0f, 0f, 100);
						Dust dust2 = Main.dust[num772];
						dust2.velocity *= 1.6f;
						Main.dust[num772].velocity.Y -= 1f;
						dust2 = Main.dust[num772];
						dust2.position -= Vector2.One * 4f;
						Main.dust[num772].position = Vector2.Lerp(Main.dust[num772].position, base.Center, 0.5f);
						Main.dust[num772].noGravity = true;
					}
				}
				else if (type == 15 || type == 321)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num773 = 0; num773 < 20; num773++)
					{
						int num774 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100, default(Color), 2f);
						Main.dust[num774].noGravity = true;
						Dust dust2 = Main.dust[num774];
						dust2.velocity *= 2f;
						num774 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100);
						dust2 = Main.dust[num774];
						dust2.velocity *= 2f;
					}
				}
				else if (type == 253)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num775 = 0; num775 < 20; num775++)
					{
						int num776 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 135, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100, default(Color), 2f);
						Main.dust[num776].noGravity = true;
						Dust dust2 = Main.dust[num776];
						dust2.velocity *= 2f;
						num776 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 135, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100);
						dust2 = Main.dust[num776];
						dust2.velocity *= 2f;
					}
				}
				else if (type == 95 || type == 96)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num777 = 0; num777 < 20; num777++)
					{
						int num778 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 75, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100, default(Color), 2f * scale);
						Main.dust[num778].noGravity = true;
						Dust dust2 = Main.dust[num778];
						dust2.velocity *= 2f;
						num778 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 75, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100, default(Color), 1f * scale);
						dust2 = Main.dust[num778];
						dust2.velocity *= 2f;
					}
				}
				else if (type == 17)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num779 = 0; num779 < 5; num779++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 0);
					}
				}
				else if (type == 31 || type == 42)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num780 = 0; num780 < 5; num780++)
					{
						int num781 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 32);
						Dust dust2 = Main.dust[num781];
						dust2.velocity *= 0.6f;
					}
				}
				else if (type >= 411 && type <= 414)
				{
					int num782 = 9;
					if (type == 412 || type == 414)
					{
						num782 = 11;
					}
					if (type == 413)
					{
						num782 = 19;
					}
					for (int num783 = 0; num783 < 5; num783++)
					{
						int num784 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num782, 0f, velocity.Y / 2f);
						Main.dust[num784].noGravity = true;
						Dust dust2 = Main.dust[num784];
						dust2.velocity -= velocity * 0.5f;
					}
				}
				else if (type == 109)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num785 = 0; num785 < 5; num785++)
					{
						int num786 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 51, 0f, 0f, 0, default(Color), 0.6f);
						Dust dust2 = Main.dust[num786];
						dust2.velocity *= 0.6f;
					}
				}
				else if (type == 39)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num787 = 0; num787 < 5; num787++)
					{
						int num788 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 38);
						Dust dust2 = Main.dust[num788];
						dust2.velocity *= 0.6f;
					}
				}
				else if (type == 71)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num789 = 0; num789 < 5; num789++)
					{
						int num790 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 53);
						Dust dust2 = Main.dust[num790];
						dust2.velocity *= 0.6f;
					}
				}
				else if (type == 179)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num791 = 0; num791 < 5; num791++)
					{
						int num792 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 149);
						Dust dust2 = Main.dust[num792];
						dust2.velocity *= 0.6f;
					}
				}
				else if (type == 40)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num793 = 0; num793 < 5; num793++)
					{
						int num794 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 36);
						Dust dust2 = Main.dust[num794];
						dust2.velocity *= 0.6f;
					}
				}
				else if (type == 21 || type == 471 || type == 532)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num795 = 0; num795 < 10; num795++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 26, 0f, 0f, 0, default(Color), 0.8f);
					}
				}
				else if (type == 583)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num796 = 0; num796 < 10; num796++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 4, 0f, 0f, 100, new Color(20, 250, 20, 240), 0.8f);
					}
				}
				else if (type == 584)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num797 = 0; num797 < 10; num797++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 4, 0f, 0f, 100, new Color(250, 20, 120, 240), 0.8f);
					}
				}
				else if (type == 24)
				{
					for (int num798 = 0; num798 < 10; num798++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 1, velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.75f);
					}
				}
				else if (type == 27)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num799 = 0; num799 < 30; num799++)
					{
						int num800 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 172, velocity.X * 0.1f, velocity.Y * 0.1f, 100);
						Main.dust[num800].noGravity = true;
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 172, velocity.X * 0.1f, velocity.Y * 0.1f, 100, default(Color), 0.5f);
					}
				}
				else if (type == 38)
				{
					for (int num801 = 0; num801 < 10; num801++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 42, velocity.X * 0.1f, velocity.Y * 0.1f);
					}
				}
				else if (type == 44 || type == 45)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num802 = 0; num802 < 30; num802++)
					{
						int num803 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, velocity.X, velocity.Y, 100, default(Color), 1.7f);
						Main.dust[num803].noGravity = true;
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, velocity.X, velocity.Y, 100);
					}
				}
				else if (type == 41)
				{
					SoundEngine.PlaySound(SoundID.Item14, position);
					for (int num804 = 0; num804 < 10; num804++)
					{
						int num805 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					}
					for (int num806 = 0; num806 < 5; num806++)
					{
						int num807 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num807].noGravity = true;
						Dust dust2 = Main.dust[num807];
						dust2.velocity *= 3f;
						num807 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust2 = Main.dust[num807];
						dust2.velocity *= 2f;
					}
					int num808 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num808];
					gore2.velocity *= 0.4f;
					Main.gore[num808].velocity.X += (float)Main.rand.Next(-10, 11) * 0.1f;
					Main.gore[num808].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.1f;
					num808 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num808];
					gore2.velocity *= 0.4f;
					Main.gore[num808].velocity.X += (float)Main.rand.Next(-10, 11) * 0.1f;
					Main.gore[num808].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.1f;
					if (owner == Main.myPlayer)
					{
						penetrate = -1;
						position.X += width / 2;
						position.Y += height / 2;
						width = 64;
						height = 64;
						position.X -= width / 2;
						position.Y -= height / 2;
						Damage();
					}
				}
				else if (type == 514)
				{
					SoundEngine.PlaySound(SoundID.Item14, position);
					for (int num809 = 0; num809 < 10; num809++)
					{
						int num810 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.3f);
						Dust dust2 = Main.dust[num810];
						dust2.velocity *= 1.4f;
					}
					for (int num811 = 0; num811 < 6; num811++)
					{
						int num812 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.1f);
						Main.dust[num812].noGravity = true;
						Dust dust2 = Main.dust[num812];
						dust2.velocity *= 4.6f;
						num812 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.3f);
						dust2 = Main.dust[num812];
						dust2.velocity *= 3.3f;
						if (Main.rand.Next(2) == 0)
						{
							num812 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.1f);
							dust2 = Main.dust[num812];
							dust2.velocity *= 2.7f;
						}
					}
					if (owner == Main.myPlayer)
					{
						penetrate = -1;
						position.X += width / 2;
						position.Y += height / 2;
						width = 112;
						height = 112;
						position.X -= width / 2;
						position.Y -= height / 2;
						ai[0] = 2f;
						Damage();
					}
				}
				else if (type == 306)
				{
					SoundEngine.PlaySound(3, (int)position.X, (int)position.Y);
					for (int num813 = 0; num813 < 20; num813++)
					{
						int num814 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 184);
						Dust dust2 = Main.dust[num814];
						dust2.scale *= 1.1f;
						Main.dust[num814].noGravity = true;
					}
					for (int num815 = 0; num815 < 30; num815++)
					{
						int num816 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 184);
						Dust dust2 = Main.dust[num816];
						dust2.velocity *= 2.5f;
						dust2 = Main.dust[num816];
						dust2.scale *= 0.8f;
						Main.dust[num816].noGravity = true;
					}
					if (owner == Main.myPlayer)
					{
						int num817 = Main.rand.Next(2, 5);
						if (Main.rand.Next(1, 101) == 100)
						{
							num817 = 15;
						}
						for (int num818 = 0; num818 < num817; num818++)
						{
							float num819 = (float)Main.rand.Next(-35, 36) * 0.02f;
							float num820 = (float)Main.rand.Next(-35, 36) * 0.02f;
							num819 *= 10f;
							num820 *= 10f;
							NewProjectile(GetProjectileSource_FromThis(), position.X, position.Y, num819, num820, 307, (int)((double)damage * 0.75), (int)((double)knockBack * 0.35), Main.myPlayer);
						}
					}
				}
				else if (type == 469)
				{
					if (owner == Main.myPlayer)
					{
						int num821 = 6;
						for (int num822 = 0; num822 < num821; num822++)
						{
							if (num822 % 2 != 1 || Main.rand.Next(3) == 0)
							{
								Vector2 vector64 = position;
								Vector2 vector65 = oldVelocity;
								vector65.Normalize();
								vector65 *= 8f;
								float num823 = (float)Main.rand.Next(-35, 36) * 0.01f;
								float num824 = (float)Main.rand.Next(-35, 36) * 0.01f;
								vector64 -= vector65 * num822;
								num823 += oldVelocity.X / 6f;
								num824 += oldVelocity.Y / 6f;
								int num825 = NewProjectile(GetProjectileSource_FromThis(), vector64.X, vector64.Y, num823, num824, Main.player[owner].beeType(), Main.player[owner].beeDamage(damage / 3), Main.player[owner].beeKB(0f), Main.myPlayer);
								Main.projectile[num825].magic = false;
								Main.projectile[num825].ranged = true;
								Main.projectile[num825].penetrate = 2;
							}
						}
					}
				}
				else if (type == 183)
				{
					SoundEngine.PlaySound(SoundID.Item14, position);
					for (int num826 = 0; num826 < 20; num826++)
					{
						int num827 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num827];
						dust2.velocity *= 1f;
					}
					int num828 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num828].velocity.X += 1f;
					Main.gore[num828].velocity.Y += 1f;
					Gore gore2 = Main.gore[num828];
					gore2.velocity *= 0.3f;
					num828 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num828].velocity.X -= 1f;
					Main.gore[num828].velocity.Y += 1f;
					gore2 = Main.gore[num828];
					gore2.velocity *= 0.3f;
					num828 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num828].velocity.X += 1f;
					Main.gore[num828].velocity.Y -= 1f;
					gore2 = Main.gore[num828];
					gore2.velocity *= 0.3f;
					num828 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num828].velocity.X -= 1f;
					Main.gore[num828].velocity.Y -= 1f;
					gore2 = Main.gore[num828];
					gore2.velocity *= 0.3f;
					if (owner == Main.myPlayer)
					{
						int num829 = Main.rand.Next(15, 25);
						for (int num830 = 0; num830 < num829; num830++)
						{
							float speedX = (float)Main.rand.Next(-35, 36) * 0.02f;
							float speedY = (float)Main.rand.Next(-35, 36) * 0.02f;
							NewProjectile(GetProjectileSource_FromThis(), position.X, position.Y, speedX, speedY, Main.player[owner].beeType(), Main.player[owner].beeDamage(damage), Main.player[owner].beeKB(0f), Main.myPlayer);
						}
					}
				}
				else if (aiStyle == 34)
				{
					if (owner != Main.myPlayer)
					{
						timeLeft = 60;
					}
					SoundEngine.PlaySound(SoundID.Item14, position);
					if (type == 167)
					{
						for (int num831 = 0; num831 < 400; num831++)
						{
							float num832 = 16f;
							if (num831 < 300)
							{
								num832 = 12f;
							}
							if (num831 < 200)
							{
								num832 = 8f;
							}
							if (num831 < 100)
							{
								num832 = 4f;
							}
							int num833 = 130;
							int num834 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num833, 0f, 0f, 100);
							float num835 = Main.dust[num834].velocity.X;
							float y2 = Main.dust[num834].velocity.Y;
							if (num835 == 0f && y2 == 0f)
							{
								num835 = 1f;
							}
							float num836 = (float)Math.Sqrt(num835 * num835 + y2 * y2);
							num836 = num832 / num836;
							num835 *= num836;
							y2 *= num836;
							Dust dust2 = Main.dust[num834];
							dust2.velocity *= 0.5f;
							Main.dust[num834].velocity.X += num835;
							Main.dust[num834].velocity.Y += y2;
							Main.dust[num834].scale = 1.3f;
							Main.dust[num834].noGravity = true;
						}
					}
					if (type == 168)
					{
						for (int num837 = 0; num837 < 400; num837++)
						{
							float num838 = 2f * ((float)num837 / 100f);
							if (num837 > 100)
							{
								num838 = 10f;
							}
							if (num837 > 250)
							{
								num838 = 13f;
							}
							int num839 = 131;
							int num840 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num839, 0f, 0f, 100);
							float num841 = Main.dust[num840].velocity.X;
							float y3 = Main.dust[num840].velocity.Y;
							if (num841 == 0f && y3 == 0f)
							{
								num841 = 1f;
							}
							float num842 = (float)Math.Sqrt(num841 * num841 + y3 * y3);
							num842 = num838 / num842;
							if (num837 <= 200)
							{
								num841 *= num842;
								y3 *= num842;
							}
							else
							{
								num841 = num841 * num842 * 1.25f;
								y3 = y3 * num842 * 0.75f;
							}
							Dust dust2 = Main.dust[num840];
							dust2.velocity *= 0.5f;
							Main.dust[num840].velocity.X += num841;
							Main.dust[num840].velocity.Y += y3;
							if (num837 > 100)
							{
								Main.dust[num840].scale = 1.3f;
								Main.dust[num840].noGravity = true;
							}
						}
					}
					if (type == 169)
					{
						Vector2 vector66 = ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2();
						float num843 = Main.rand.Next(5, 9);
						float num844 = Main.rand.Next(12, 17);
						float value10 = Main.rand.Next(3, 7);
						float num845 = 20f;
						for (float num846 = 0f; num846 < num843; num846++)
						{
							for (int num847 = 0; num847 < 2; num847++)
							{
								Vector2 value11 = vector66.RotatedBy(((num847 == 0) ? 1f : (-1f)) * ((float)Math.PI * 2f) / (num843 * 2f));
								for (float num848 = 0f; num848 < num845; num848++)
								{
									Vector2 vector67 = Vector2.Lerp(vector66, value11, num848 / num845);
									float num849 = MathHelper.Lerp(num844, value10, num848 / num845);
									int num850 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, 133, 0f, 0f, 100, default(Color), 1.3f);
									Dust dust2 = Main.dust[num850];
									dust2.velocity *= 0.1f;
									Main.dust[num850].noGravity = true;
									dust2 = Main.dust[num850];
									dust2.velocity += vector67 * num849;
								}
							}
							vector66 = vector66.RotatedBy((float)Math.PI * 2f / num843);
						}
						for (float num851 = 0f; num851 < num843; num851++)
						{
							for (int num852 = 0; num852 < 2; num852++)
							{
								Vector2 value12 = vector66.RotatedBy(((num852 == 0) ? 1f : (-1f)) * ((float)Math.PI * 2f) / (num843 * 2f));
								for (float num853 = 0f; num853 < num845; num853++)
								{
									Vector2 vector68 = Vector2.Lerp(vector66, value12, num853 / num845);
									float num854 = MathHelper.Lerp(num844, value10, num853 / num845) / 2f;
									int num855 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, 133, 0f, 0f, 100, default(Color), 1.3f);
									Dust dust2 = Main.dust[num855];
									dust2.velocity *= 0.1f;
									Main.dust[num855].noGravity = true;
									dust2 = Main.dust[num855];
									dust2.velocity += vector68 * num854;
								}
							}
							vector66 = vector66.RotatedBy((float)Math.PI * 2f / num843);
						}
						for (int num856 = 0; num856 < 100; num856++)
						{
							float num857 = num844;
							int num858 = 132;
							int num859 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num858, 0f, 0f, 100);
							float num860 = Main.dust[num859].velocity.X;
							float y4 = Main.dust[num859].velocity.Y;
							if (num860 == 0f && y4 == 0f)
							{
								num860 = 1f;
							}
							float num861 = (float)Math.Sqrt(num860 * num860 + y4 * y4);
							num861 = num857 / num861;
							num860 *= num861;
							y4 *= num861;
							Dust dust2 = Main.dust[num859];
							dust2.velocity *= 0.5f;
							Main.dust[num859].velocity.X += num860;
							Main.dust[num859].velocity.Y += y4;
							Main.dust[num859].scale = 1.3f;
							Main.dust[num859].noGravity = true;
						}
					}
					if (type == 170)
					{
						for (int num862 = 0; num862 < 400; num862++)
						{
							int num863 = 133;
							float num864 = 16f;
							if (num862 > 100)
							{
								num864 = 11f;
							}
							if (num862 > 100)
							{
								num863 = 134;
							}
							if (num862 > 200)
							{
								num864 = 8f;
							}
							if (num862 > 200)
							{
								num863 = 133;
							}
							if (num862 > 300)
							{
								num864 = 5f;
							}
							if (num862 > 300)
							{
								num863 = 134;
							}
							int num865 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num863, 0f, 0f, 100);
							float num866 = Main.dust[num865].velocity.X;
							float y5 = Main.dust[num865].velocity.Y;
							if (num866 == 0f && y5 == 0f)
							{
								num866 = 1f;
							}
							float num867 = (float)Math.Sqrt(num866 * num866 + y5 * y5);
							num867 = num864 / num867;
							if (num862 > 300)
							{
								num866 = num866 * num867 * 0.7f;
								y5 *= num867;
							}
							else if (num862 > 200)
							{
								num866 *= num867;
								y5 = y5 * num867 * 0.7f;
							}
							else if (num862 > 100)
							{
								num866 = num866 * num867 * 0.7f;
								y5 *= num867;
							}
							else
							{
								num866 *= num867;
								y5 = y5 * num867 * 0.7f;
							}
							Dust dust2 = Main.dust[num865];
							dust2.velocity *= 0.5f;
							Main.dust[num865].velocity.X += num866;
							Main.dust[num865].velocity.Y += y5;
							if (Main.rand.Next(3) != 0)
							{
								Main.dust[num865].scale = 1.3f;
								Main.dust[num865].noGravity = true;
							}
						}
					}
					if (type == 415)
					{
						Vector2 vector69 = (vector69 = ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2());
						float num868 = Main.rand.Next(5, 9);
						float num869 = (float)Main.rand.Next(10, 15) * 0.66f;
						float num870 = (float)Main.rand.Next(4, 7) / 2f;
						int num871 = 30;
						for (int num872 = 0; (float)num872 < (float)num871 * num868; num872++)
						{
							if (num872 % num871 == 0)
							{
								vector69 = vector69.RotatedBy((float)Math.PI * 2f / num868);
							}
							float num873 = MathHelper.Lerp(num870, num869, (float)(num872 % num871) / (float)num871);
							int num874 = 130;
							int num875 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num874, 0f, 0f, 100);
							Dust dust2 = Main.dust[num875];
							dust2.velocity *= 0.1f;
							dust2 = Main.dust[num875];
							dust2.velocity += vector69 * num873;
							Main.dust[num875].scale = 1.3f;
							Main.dust[num875].noGravity = true;
						}
						for (int num876 = 0; num876 < 100; num876++)
						{
							float num877 = num869;
							if (num876 < 30)
							{
								num877 = (num870 + num869) / 2f;
							}
							int num878 = 130;
							int num879 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num878, 0f, 0f, 100);
							float num880 = Main.dust[num879].velocity.X;
							float y6 = Main.dust[num879].velocity.Y;
							if (num880 == 0f && y6 == 0f)
							{
								num880 = 1f;
							}
							float num881 = (float)Math.Sqrt(num880 * num880 + y6 * y6);
							num881 = num877 / num881;
							num880 *= num881;
							y6 *= num881;
							Dust dust2 = Main.dust[num879];
							dust2.velocity *= 0.5f;
							Main.dust[num879].velocity.X += num880;
							Main.dust[num879].velocity.Y += y6;
							Main.dust[num879].scale = 1.3f;
							Main.dust[num879].noGravity = true;
						}
					}
					if (type == 416)
					{
						Vector2 vector70 = ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2();
						Vector2 vector71 = vector70;
						float num882 = Main.rand.Next(3, 6) * 2;
						int num883 = 20;
						float num884 = ((Main.rand.Next(2) == 0) ? 1f : (-1f));
						bool flag6 = true;
						for (int num885 = 0; (float)num885 < (float)num883 * num882; num885++)
						{
							if (num885 % num883 == 0)
							{
								vector71 = vector71.RotatedBy(num884 * ((float)Math.PI * 2f / num882));
								vector70 = vector71;
								flag6 = !flag6;
							}
							else
							{
								float num886 = (float)Math.PI * 2f / ((float)num883 * num882);
								vector70 = vector70.RotatedBy(num886 * num884 * 3f);
							}
							float num887 = MathHelper.Lerp(1f, 8f, (float)(num885 % num883) / (float)num883);
							int num888 = 131;
							int num889 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num888, 0f, 0f, 100, default(Color), 1.4f);
							Dust dust2 = Main.dust[num889];
							dust2.velocity *= 0.1f;
							dust2 = Main.dust[num889];
							dust2.velocity += vector70 * num887;
							if (flag6)
							{
								Main.dust[num889].scale = 0.9f;
							}
							Main.dust[num889].noGravity = true;
						}
					}
					if (type == 417)
					{
						float num890 = (float)Main.rand.NextDouble() * ((float)Math.PI * 2f);
						float num891 = (float)Main.rand.NextDouble() * ((float)Math.PI * 2f);
						float num892 = 4f + (float)Main.rand.NextDouble() * 3f;
						float num893 = 4f + (float)Main.rand.NextDouble() * 3f;
						float num894 = num892;
						if (num893 > num894)
						{
							num894 = num893;
						}
						for (int num895 = 0; num895 < 150; num895++)
						{
							int num896 = 132;
							float num897 = num894;
							if (num895 > 50)
							{
								num897 = num893;
							}
							if (num895 > 50)
							{
								num896 = 133;
							}
							if (num895 > 100)
							{
								num897 = num892;
							}
							if (num895 > 100)
							{
								num896 = 132;
							}
							int num898 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num896, 0f, 0f, 100);
							Vector2 vector72 = Main.dust[num898].velocity;
							vector72.Normalize();
							vector72 *= num897;
							if (num895 > 100)
							{
								vector72.X *= 0.5f;
								vector72 = vector72.RotatedBy(num890);
							}
							else if (num895 > 50)
							{
								vector72.Y *= 0.5f;
								vector72 = vector72.RotatedBy(num891);
							}
							Dust dust2 = Main.dust[num898];
							dust2.velocity *= 0.2f;
							dust2 = Main.dust[num898];
							dust2.velocity += vector72;
							if (num895 <= 200)
							{
								Main.dust[num898].scale = 1.3f;
								Main.dust[num898].noGravity = true;
							}
						}
					}
					if (type == 418)
					{
						Vector2 vector73 = ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2();
						float num899 = Main.rand.Next(5, 12);
						float num900 = (float)Main.rand.Next(9, 14) * 0.66f;
						float num901 = (float)Main.rand.Next(2, 4) * 0.66f;
						float num902 = 15f;
						for (float num903 = 0f; num903 < num899; num903++)
						{
							for (int num904 = 0; num904 < 2; num904++)
							{
								Vector2 value13 = vector73.RotatedBy(((num904 == 0) ? 1f : (-1f)) * ((float)Math.PI * 2f) / (num899 * 2f));
								for (float num905 = 0f; num905 < num902; num905++)
								{
									Vector2 vector74 = Vector2.SmoothStep(vector73, value13, num905 / num902);
									float num906 = MathHelper.SmoothStep(num900, num901, num905 / num902);
									int num907 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, 134, 0f, 0f, 100, default(Color), 1.3f);
									Dust dust2 = Main.dust[num907];
									dust2.velocity *= 0.1f;
									Main.dust[num907].noGravity = true;
									dust2 = Main.dust[num907];
									dust2.velocity += vector74 * num906;
								}
							}
							vector73 = vector73.RotatedBy((float)Math.PI * 2f / num899);
						}
						for (int num908 = 0; num908 < 120; num908++)
						{
							float num909 = num900;
							int num910 = 133;
							if (num908 < 80)
							{
								num909 = num901 - 0.5f;
							}
							else
							{
								num910 = 131;
							}
							int num911 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num910, 0f, 0f, 100);
							float num912 = Main.dust[num911].velocity.X;
							float y7 = Main.dust[num911].velocity.Y;
							if (num912 == 0f && y7 == 0f)
							{
								num912 = 1f;
							}
							float num913 = (float)Math.Sqrt(num912 * num912 + y7 * y7);
							num913 = num909 / num913;
							num912 *= num913;
							y7 *= num913;
							Dust dust2 = Main.dust[num911];
							dust2.velocity *= 0.2f;
							Main.dust[num911].velocity.X += num912;
							Main.dust[num911].velocity.Y += y7;
							Main.dust[num911].scale = 1.3f;
							Main.dust[num911].noGravity = true;
						}
					}
					position.X += width / 2;
					position.Y += height / 2;
					width = 192;
					height = 192;
					position.X -= width / 2;
					position.Y -= height / 2;
					penetrate = -1;
					Damage();
				}
				else if (type == 1023)
				{
					SoundEngine.PlaySound(SoundID.DeadCellsBarrelLauncherExplode, position);
					position.X += width / 2;
					position.Y += height / 2;
					width = 192;
					height = 192;
					position.X -= width / 2;
					position.Y -= height / 2;
					ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.DeadCellsBarrelExplosion, new ParticleOrchestraSettings
					{
						PositionInWorld = base.Center
					});
					for (int num914 = 0; num914 < 8; num914++)
					{
						Gore gore6 = Gore.NewGoreDirect(base.Center + Main.rand.NextVector2Circular(width, height) * 0.125f, Vector2.Zero, 61 + Main.rand.Next(3));
						gore6.velocity = ((float)Math.PI * 2f * (float)num914 / 8f).ToRotationVector2() * Main.rand.NextFloat() * 8f;
					}
					for (int num915 = 0; num915 < 40; num915++)
					{
						Dust dust57 = Dust.NewDustDirect(position, width, height, 31);
						dust57.velocity = DirectionTo(dust57.position).SafeNormalize(Vector2.Zero) * Main.rand.NextFloat() * 8f;
					}
					Damage();
				}
				else if (type == 312)
				{
					SoundEngine.PlaySound(SoundID.Item14, position);
					position.X += width / 2;
					position.Y += height / 2;
					width = 22;
					height = 22;
					position.X -= width / 2;
					position.Y -= height / 2;
					for (int num916 = 0; num916 < 30; num916++)
					{
						int num917 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num917];
						dust2.velocity *= 1.4f;
					}
					for (int num918 = 0; num918 < 20; num918++)
					{
						int num919 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 3.5f);
						Main.dust[num919].noGravity = true;
						Dust dust2 = Main.dust[num919];
						dust2.velocity *= 7f;
						num919 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust2 = Main.dust[num919];
						dust2.velocity *= 3f;
					}
					for (int num920 = 0; num920 < 2; num920++)
					{
						float num921 = 0.4f;
						if (num920 == 1)
						{
							num921 = 0.8f;
						}
						int num922 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						Gore gore2 = Main.gore[num922];
						gore2.velocity *= num921;
						Main.gore[num922].velocity.X += 1f;
						Main.gore[num922].velocity.Y += 1f;
						num922 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num922];
						gore2.velocity *= num921;
						Main.gore[num922].velocity.X -= 1f;
						Main.gore[num922].velocity.Y += 1f;
						num922 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num922];
						gore2.velocity *= num921;
						Main.gore[num922].velocity.X += 1f;
						Main.gore[num922].velocity.Y -= 1f;
						num922 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num922];
						gore2.velocity *= num921;
						Main.gore[num922].velocity.X -= 1f;
						Main.gore[num922].velocity.Y -= 1f;
					}
					position.X += width / 2;
					position.Y += height / 2;
					width = 128;
					height = 128;
					position.X -= width / 2;
					position.Y -= height / 2;
					Damage();
				}
				else if (type == 1077)
				{
					Resize(22, 22);
					SoundEngine.PlaySound(SoundID.Item14, position);
					position.X += width / 2;
					position.Y += height / 2;
					width = 22;
					height = 22;
					position.X -= width / 2;
					position.Y -= height / 2;
					int num923 = 135;
					for (int num924 = 0; num924 < 20; num924++)
					{
						int num925 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num925];
						dust2.velocity *= 1.4f;
					}
					for (int num926 = 0; num926 < 10; num926++)
					{
						int num927 = Dust.NewDust(position, width, height, num923, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num927].noGravity = true;
						Dust dust2 = Main.dust[num927];
						dust2.velocity *= 5f;
						num927 = Dust.NewDust(position, width, height, num923, 0f, 0f, 100, default(Color), 1.5f);
						dust2 = Main.dust[num927];
						dust2.velocity *= 3f;
					}
					int num928 = Gore.NewGore(position, default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num928];
					gore2.velocity *= 0.4f;
					Main.gore[num928].velocity.X += 1f;
					Main.gore[num928].velocity.Y += 1f;
					num928 = Gore.NewGore(position, default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num928];
					gore2.velocity *= 0.4f;
					Main.gore[num928].velocity.X -= 1f;
					Main.gore[num928].velocity.Y += 1f;
					num928 = Gore.NewGore(position, default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num928];
					gore2.velocity *= 0.4f;
					Main.gore[num928].velocity.X += 1f;
					Main.gore[num928].velocity.Y -= 1f;
					num928 = Gore.NewGore(position, default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num928];
					gore2.velocity *= 0.4f;
					Main.gore[num928].velocity.X -= 1f;
					Main.gore[num928].velocity.Y -= 1f;
					if (Main.netMode != 1)
					{
						Point pt2 = base.Center.ToTileCoordinates();
						Kill_DirtAndFluidProjectiles_RunDelegateMethodPushUpForHalfBricks(pt2, 4.2f, DelegateMethods.SpreadIceBlocksOverWater);
					}
				}
				else if (type == 910 || type == 911)
				{
					Resize(22, 22);
					SoundEngine.PlaySound(SoundID.Item14, position);
					Color transparent2 = Color.Transparent;
					int num929 = 0;
					for (int num930 = 0; num930 < 30; num930++)
					{
						Dust dust58 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, transparent2, 1.5f);
						Dust dust2 = dust58;
						dust2.velocity *= 1.4f;
					}
					for (int num931 = 0; num931 < 80; num931++)
					{
						Dust dust59 = Dust.NewDustDirect(position, width, height, num929, 0f, 0f, 100, transparent2, 2.2f);
						dust59.noGravity = true;
						dust59.velocity.Y -= 1.2f;
						Dust dust2 = dust59;
						dust2.velocity *= 4f;
						dust59 = Dust.NewDustDirect(position, width, height, num929, 0f, 0f, 100, transparent2, 1.3f);
						dust59.velocity.Y -= 1.2f;
						dust2 = dust59;
						dust2.velocity *= 2f;
					}
					for (int num932 = 1; num932 <= 2; num932++)
					{
						for (int num933 = -1; num933 <= 1; num933 += 2)
						{
							for (int num934 = -1; num934 <= 1; num934 += 2)
							{
								Gore gore7 = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
								Gore gore2 = gore7;
								gore2.velocity *= ((num932 == 1) ? 0.4f : 0.8f);
								gore2 = gore7;
								gore2.velocity += new Vector2(num933, num934);
							}
						}
					}
					if (Main.netMode != 1)
					{
						Point pt3 = base.Center.ToTileCoordinates();
						Kill_DirtAndFluidProjectiles_RunDelegateMethodPushUpForHalfBricks(pt3, 4.2f, DelegateMethods.SpreadDirt);
					}
				}
				else if (type == 784 || type == 785 || type == 786 || type == 805 || type == 903)
				{
					Resize(22, 22);
					if (type == 785)
					{
						SoundEngine.PlaySound(SoundID.Item62, position);
					}
					else
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
					}
					Color transparent3 = Color.Transparent;
					int num935 = Dust.dustWater();
					for (int num936 = 0; num936 < 30; num936++)
					{
						Dust dust60 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, transparent3, 1.5f);
						Dust dust2 = dust60;
						dust2.velocity *= 1.4f;
					}
					for (int num937 = 0; num937 < 80; num937++)
					{
						Dust dust61 = Dust.NewDustDirect(position, width, height, num935, 0f, 0f, 100, transparent3, 2.2f);
						dust61.noGravity = true;
						dust61.velocity.Y -= 1.2f;
						Dust dust2 = dust61;
						dust2.velocity *= 7f;
						dust61 = Dust.NewDustDirect(position, width, height, num935, 0f, 0f, 100, transparent3, 1.3f);
						dust61.velocity.Y -= 1.2f;
						dust2 = dust61;
						dust2.velocity *= 4f;
					}
					for (int num938 = 1; num938 <= 2; num938++)
					{
						for (int num939 = -1; num939 <= 1; num939 += 2)
						{
							for (int num940 = -1; num940 <= 1; num940 += 2)
							{
								Gore gore8 = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
								Gore gore2 = gore8;
								gore2.velocity *= ((num938 == 1) ? 0.4f : 0.8f);
								gore2 = gore8;
								gore2.velocity += new Vector2(num939, num940);
							}
						}
					}
					if (Main.netMode != 1)
					{
						Point pt4 = base.Center.ToTileCoordinates();
						Kill_DirtAndFluidProjectiles_RunDelegateMethodPushUpForHalfBricks(pt4, 3f, DelegateMethods.SpreadWater);
					}
				}
				else if (type == 787 || type == 788 || type == 789 || type == 806 || type == 904)
				{
					Resize(22, 22);
					if (type == 788)
					{
						SoundEngine.PlaySound(SoundID.Item62, position);
					}
					else
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
					}
					Color transparent4 = Color.Transparent;
					int num941 = 35;
					for (int num942 = 0; num942 < 30; num942++)
					{
						Dust dust62 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, transparent4, 1.5f);
						Dust dust2 = dust62;
						dust2.velocity *= 1.4f;
					}
					for (int num943 = 0; num943 < 80; num943++)
					{
						Dust dust63 = Dust.NewDustDirect(position, width, height, num941, 0f, 0f, 100, transparent4, 1.2f);
						Dust dust2 = dust63;
						dust2.velocity *= 7f;
						dust63 = Dust.NewDustDirect(position, width, height, num941, 0f, 0f, 100, transparent4, 0.3f);
						dust2 = dust63;
						dust2.velocity *= 4f;
					}
					for (int num944 = 1; num944 <= 2; num944++)
					{
						for (int num945 = -1; num945 <= 1; num945 += 2)
						{
							for (int num946 = -1; num946 <= 1; num946 += 2)
							{
								Gore gore9 = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
								Gore gore2 = gore9;
								gore2.velocity *= ((num944 == 1) ? 0.4f : 0.8f);
								gore2 = gore9;
								gore2.velocity += new Vector2(num945, num946);
							}
						}
					}
					if (Main.netMode != 1)
					{
						Point pt5 = base.Center.ToTileCoordinates();
						Kill_DirtAndFluidProjectiles_RunDelegateMethodPushUpForHalfBricks(pt5, 3f, DelegateMethods.SpreadLava);
					}
				}
				else if (type == 790 || type == 791 || type == 792 || type == 807 || type == 905)
				{
					Resize(22, 22);
					if (type == 791)
					{
						SoundEngine.PlaySound(SoundID.Item62, position);
					}
					else
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
					}
					Color transparent5 = Color.Transparent;
					int num947 = 152;
					for (int num948 = 0; num948 < 30; num948++)
					{
						Dust dust64 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, transparent5, 1.5f);
						Dust dust2 = dust64;
						dust2.velocity *= 1.4f;
					}
					for (int num949 = 0; num949 < 80; num949++)
					{
						Dust dust65 = Dust.NewDustDirect(position, width, height, num947, 0f, 0f, 100, transparent5, 2.2f);
						Dust dust2 = dust65;
						dust2.velocity *= 7f;
						dust65 = Dust.NewDustDirect(position, width, height, num947, 0f, 0f, 100, transparent5, 1.3f);
						dust2 = dust65;
						dust2.velocity *= 4f;
					}
					for (int num950 = 1; num950 <= 2; num950++)
					{
						for (int num951 = -1; num951 <= 1; num951 += 2)
						{
							for (int num952 = -1; num952 <= 1; num952 += 2)
							{
								Gore gore10 = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
								Gore gore2 = gore10;
								gore2.velocity *= ((num950 == 1) ? 0.4f : 0.8f);
								gore2 = gore10;
								gore2.velocity += new Vector2(num951, num952);
							}
						}
					}
					if (Main.netMode != 1)
					{
						Point pt6 = base.Center.ToTileCoordinates();
						Kill_DirtAndFluidProjectiles_RunDelegateMethodPushUpForHalfBricks(pt6, 3f, DelegateMethods.SpreadHoney);
					}
				}
				else if (type == 799 || type == 800 || type == 801 || type == 810 || type == 906)
				{
					Resize(22, 22);
					if (type == 800)
					{
						SoundEngine.PlaySound(SoundID.Item62, position);
					}
					else
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
					}
					Color transparent6 = Color.Transparent;
					int num953 = 31;
					for (int num954 = 0; num954 < 30; num954++)
					{
						Dust dust66 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, transparent6, 1.5f);
						Dust dust2 = dust66;
						dust2.velocity *= 1.4f;
					}
					for (int num955 = 0; num955 < 80; num955++)
					{
						Dust dust67 = Dust.NewDustDirect(position, width, height, num953, 0f, 0f, 100, transparent6, 1.2f);
						Dust dust2 = dust67;
						dust2.velocity *= 7f;
						dust67 = Dust.NewDustDirect(position, width, height, num953, 0f, 0f, 100, transparent6, 0.3f);
						dust2 = dust67;
						dust2.velocity *= 4f;
					}
					for (int num956 = 1; num956 <= 2; num956++)
					{
						for (int num957 = -1; num957 <= 1; num957 += 2)
						{
							for (int num958 = -1; num958 <= 1; num958 += 2)
							{
								Gore gore11 = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
								Gore gore2 = gore11;
								gore2.velocity *= ((num956 == 1) ? 0.4f : 0.8f);
								gore2 = gore11;
								gore2.velocity += new Vector2(num957, num958);
							}
						}
					}
					if (Main.netMode != 1)
					{
						Point pt7 = base.Center.ToTileCoordinates();
						Kill_DirtAndFluidProjectiles_RunDelegateMethodPushUpForHalfBricks(pt7, 3.5f, DelegateMethods.SpreadDry);
					}
				}
				else if (type == 793 || type == 796 || type == 794 || type == 797 || type == 795 || type == 798 || type == 808 || type == 809)
				{
					if (type == 794 || type == 797)
					{
						SoundEngine.PlaySound(SoundID.Item62, base.Center);
					}
					else
					{
						SoundEngine.PlaySound(SoundID.Item14, base.Center);
					}
					Resize(50, 50);
					float num959 = 3f;
					for (int num960 = 0; num960 < 50; num960++)
					{
						Dust dust68 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, default(Color), 2f);
						dust68.velocity = (dust68.position - base.Center).SafeNormalize(Vector2.Zero);
						Dust dust2 = dust68;
						dust2.velocity *= 2f + (float)Main.rand.Next(5) * 0.1f;
						dust68.velocity.Y -= num959 * 0.5f;
						dust68.color = Color.Black * 0.9f;
						if (Main.rand.Next(2) == 0)
						{
							dust68.scale = 0.5f;
							dust68.fadeIn = 1f + (float)Main.rand.Next(10) * 0.1f;
							dust68.color = Color.Black * 0.8f;
						}
					}
					for (int num961 = 0; num961 < 30; num961++)
					{
						Dust dust69 = Dust.NewDustDirect(position, width, height, 6, 0f, 0f, 100);
						dust69.noGravity = true;
						dust69.fadeIn = 1.4f;
						dust69.velocity = (dust69.position - base.Center).SafeNormalize(Vector2.Zero);
						Dust dust2 = dust69;
						dust2.velocity *= 5.5f + (float)Main.rand.Next(61) * 0.1f;
						dust69.velocity.Y -= num959 * 0.5f;
						dust69 = Dust.NewDustDirect(position, width, height, 6, 0f, 0f, 100);
						dust69.velocity = (dust69.position - base.Center).SafeNormalize(Vector2.Zero);
						dust69.velocity.Y -= num959 * 0.25f;
						dust2 = dust69;
						dust2.velocity *= 1.5f + (float)Main.rand.Next(5) * 0.1f;
						dust69.fadeIn = 0f;
						dust69.scale = 0.6f;
						dust69 = Dust.NewDustDirect(position, width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust69.noGravity = num961 % 2 == 0;
						dust69.velocity = (dust69.position - base.Center).SafeNormalize(Vector2.Zero);
						dust2 = dust69;
						dust2.velocity *= 3f + (float)Main.rand.Next(21) * 0.2f;
						dust69.velocity.Y -= num959 * 0.5f;
						dust69.fadeIn = 1.2f;
						if (!dust69.noGravity)
						{
							dust69.scale = 0.4f;
							dust69.fadeIn = 0f;
						}
						else
						{
							dust2 = dust69;
							dust2.velocity *= 2f + (float)Main.rand.Next(5) * 0.2f;
							dust69.velocity.Y -= num959 * 0.5f;
						}
					}
					int num962 = 0;
					for (int num963 = 1; num963 <= 3; num963++)
					{
						float num964 = (float)Math.PI * 2f * Main.rand.NextFloat();
						for (float num965 = 0f; num965 < 1f; num965 += 1f / 11f)
						{
							float f4 = (float)Math.PI * 2f * num965 + num964;
							Vector2 spinningpoint2 = f4.ToRotationVector2();
							spinningpoint2 *= new Vector2(1f, 0.4f);
							spinningpoint2 = spinningpoint2.RotatedBy((float)num962 - (float)Math.PI);
							Vector2 vector75 = ((float)num962 - (float)Math.PI / 2f).ToRotationVector2();
							Vector2 vector76 = base.Center + vector75 * 16f * 0f;
							Dust dust70 = Dust.NewDustPerfect(vector76, 6, spinningpoint2);
							dust70.fadeIn = 1.8f;
							dust70.noGravity = true;
							Dust dust2 = dust70;
							dust2.velocity *= (float)num963 * (Main.rand.NextFloat() * 2f + 0.2f);
							dust2 = dust70;
							dust2.velocity += vector75 * 0.8f * num963;
							dust2 = dust70;
							dust2.velocity *= 2f;
						}
					}
					for (int num966 = 1; num966 <= 3; num966++)
					{
						for (int num967 = -1; num967 <= 1; num967 += 2)
						{
							for (int num968 = -1; num968 <= 1; num968 += 2)
							{
								Gore gore12 = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
								Gore gore2 = gore12;
								gore2.velocity *= (float)num966 / 3f;
								gore2 = gore12;
								gore2.velocity += new Vector2(num967, num968);
							}
						}
					}
					Resize(10, 10);
				}
				else if (type == 779 || type == 783 || type == 862 || type == 863)
				{
					Resize(22, 22);
					SoundEngine.PlaySound(SoundID.Item62, position);
					Color transparent7 = Color.Transparent;
					for (int num969 = 0; num969 < 15; num969++)
					{
						Dust dust71 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, transparent7, 0.8f);
						dust71.fadeIn = 0f;
						Dust dust2 = dust71;
						dust2.velocity *= 0.5f;
					}
					for (int num970 = 0; num970 < 5; num970++)
					{
						Dust dust72 = Dust.NewDustDirect(position, width, height, 228, 0f, 0f, 100, transparent7, 2.5f);
						dust72.noGravity = true;
						Dust dust2 = dust72;
						dust2.velocity *= 2.5f;
						dust72 = Dust.NewDustDirect(position, width, height, 228, 0f, 0f, 100, transparent7, 1.1f);
						dust2 = dust72;
						dust2.velocity *= 2f;
						dust72.noGravity = true;
					}
					for (int num971 = 0; num971 < 3; num971++)
					{
						Dust dust73 = Dust.NewDustDirect(position, width, height, 226, 0f, 0f, 100, transparent7, 1.1f);
						Dust dust2 = dust73;
						dust2.velocity *= 2f;
						dust73.noGravity = true;
					}
					for (int num972 = -1; num972 <= 1; num972 += 2)
					{
						for (int num973 = -1; num973 <= 1; num973 += 2)
						{
							if (Main.rand.Next(5) == 0)
							{
								Gore gore13 = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
								Gore gore2 = gore13;
								gore2.velocity *= 0.2f;
								gore2 = gore13;
								gore2.scale *= 0.65f;
								gore2 = gore13;
								gore2.velocity += new Vector2(num972, num973) * 0.5f;
							}
						}
					}
				}
				else if (type == 776 || type == 780 || type == 777 || type == 781 || type == 778 || type == 782 || type == 803 || type == 804)
				{
					Resize(22, 22);
					if (type == 777 || type == 781)
					{
						SoundEngine.PlaySound(SoundID.Item62, position);
					}
					else
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
					}
					Color transparent8 = Color.Transparent;
					for (int num974 = 0; num974 < 30; num974++)
					{
						Dust dust74 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, transparent8, 1.5f);
						Dust dust2 = dust74;
						dust2.velocity *= 1.4f;
					}
					for (int num975 = 0; num975 < 40; num975++)
					{
						Dust dust75 = Dust.NewDustDirect(position, width, height, 228, 0f, 0f, 100, transparent8, 3.5f);
						dust75.noGravity = true;
						Dust dust2 = dust75;
						dust2.velocity *= 7f;
						dust75 = Dust.NewDustDirect(position, width, height, 228, 0f, 0f, 100, transparent8, 1.3f);
						dust2 = dust75;
						dust2.velocity *= 4f;
						dust75.noGravity = true;
					}
					for (int num976 = 0; num976 < 8; num976++)
					{
						Dust dust76 = Dust.NewDustDirect(position, width, height, 226, 0f, 0f, 100, transparent8, 1.3f);
						Dust dust2 = dust76;
						dust2.velocity *= 4f;
						dust76.noGravity = true;
					}
					for (int num977 = 2; num977 <= 2; num977++)
					{
						for (int num978 = -1; num978 <= 1; num978 += 2)
						{
							for (int num979 = -1; num979 <= 1; num979 += 2)
							{
								Gore gore14 = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
								Gore gore2 = gore14;
								gore2.velocity *= ((num977 == 1) ? 0.4f : 0.8f);
								gore2 = gore14;
								gore2.velocity += new Vector2(num978, num979);
							}
						}
					}
					if (owner == Main.myPlayer)
					{
						int num980 = 779;
						if (type == 780 || type == 781 || type == 782)
						{
							num980 = 783;
						}
						if (type == 803)
						{
							num980 = 862;
						}
						if (type == 804)
						{
							num980 = 863;
						}
						float num981 = Main.rand.NextFloat() * ((float)Math.PI * 2f);
						for (float num982 = 0f; num982 < 1f; num982 += 1f / 6f)
						{
							float f5 = num981 + num982 * ((float)Math.PI * 2f);
							Vector2 vector77 = f5.ToRotationVector2() * (4f + Main.rand.NextFloat() * 2f);
							vector77 += Vector2.UnitY * -1f;
							int num983 = NewProjectile(GetProjectileSource_FromThis(), base.Center, vector77, num980, damage / 2, 0f, owner);
							Projectile projectile3 = Main.projectile[num983];
							Projectile projectile = projectile3;
							projectile.timeLeft -= Main.rand.Next(30);
						}
					}
				}
				else if (type == 133 || type == 134 || type == 135 || type == 136 || type == 137 || type == 138 || type == 303 || type == 338 || type == 339 || type == 930)
				{
					if (type == 30 || type == 133 || type == 136)
					{
						SoundEngine.PlaySound(SoundID.Item62, position);
					}
					else
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
					}
					position.X += width / 2;
					position.Y += height / 2;
					width = 22;
					height = 22;
					position.X -= width / 2;
					position.Y -= height / 2;
					for (int num984 = 0; num984 < 30; num984++)
					{
						int num985 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num985];
						dust2.velocity *= 1.4f;
					}
					for (int num986 = 0; num986 < 20; num986++)
					{
						int num987 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 3.5f);
						Main.dust[num987].noGravity = true;
						Dust dust2 = Main.dust[num987];
						dust2.velocity *= 7f;
						num987 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust2 = Main.dust[num987];
						dust2.velocity *= 3f;
					}
					for (int num988 = 0; num988 < 2; num988++)
					{
						float num989 = 0.4f;
						if (num988 == 1)
						{
							num989 = 0.8f;
						}
						int num990 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						Gore gore2 = Main.gore[num990];
						gore2.velocity *= num989;
						Main.gore[num990].velocity.X += 1f;
						Main.gore[num990].velocity.Y += 1f;
						num990 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num990];
						gore2.velocity *= num989;
						Main.gore[num990].velocity.X -= 1f;
						Main.gore[num990].velocity.Y += 1f;
						num990 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num990];
						gore2.velocity *= num989;
						Main.gore[num990].velocity.X += 1f;
						Main.gore[num990].velocity.Y -= 1f;
						num990 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num990];
						gore2.velocity *= num989;
						Main.gore[num990].velocity.X -= 1f;
						Main.gore[num990].velocity.Y -= 1f;
					}
				}
				else if (type == 139 || type == 140 || type == 141 || type == 142 || type == 143 || type == 144 || type == 340 || type == 341)
				{
					if (type == 139)
					{
						SoundEngine.PlaySound(SoundID.Item62, position);
					}
					else
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
					}
					position.X += width / 2;
					position.Y += height / 2;
					width = 80;
					height = 80;
					position.X -= width / 2;
					position.Y -= height / 2;
					for (int num991 = 0; num991 < 40; num991++)
					{
						int num992 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 2f);
						Dust dust2 = Main.dust[num992];
						dust2.velocity *= 3f;
						if (Main.rand.Next(2) == 0)
						{
							Main.dust[num992].scale = 0.5f;
							Main.dust[num992].fadeIn = 1f + (float)Main.rand.Next(10) * 0.1f;
						}
					}
					for (int num993 = 0; num993 < 70; num993++)
					{
						int num994 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 3f);
						Main.dust[num994].noGravity = true;
						Dust dust2 = Main.dust[num994];
						dust2.velocity *= 5f;
						num994 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2f);
						dust2 = Main.dust[num994];
						dust2.velocity *= 2f;
					}
					for (int num995 = 0; num995 < 3; num995++)
					{
						float num996 = 0.33f;
						if (num995 == 1)
						{
							num996 = 0.66f;
						}
						if (num995 == 2)
						{
							num996 = 1f;
						}
						int num997 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
						Gore gore2 = Main.gore[num997];
						gore2.velocity *= num996;
						Main.gore[num997].velocity.X += 1f;
						Main.gore[num997].velocity.Y += 1f;
						num997 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num997];
						gore2.velocity *= num996;
						Main.gore[num997].velocity.X -= 1f;
						Main.gore[num997].velocity.Y += 1f;
						num997 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num997];
						gore2.velocity *= num996;
						Main.gore[num997].velocity.X += 1f;
						Main.gore[num997].velocity.Y -= 1f;
						num997 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num997];
						gore2.velocity *= num996;
						Main.gore[num997].velocity.X -= 1f;
						Main.gore[num997].velocity.Y -= 1f;
					}
					position.X += width / 2;
					position.Y += height / 2;
					width = 10;
					height = 10;
					position.X -= width / 2;
					position.Y -= height / 2;
				}
				else if (type == 246)
				{
					SoundEngine.PlaySound(SoundID.Item14, position);
					for (int num998 = 0; num998 < 10; num998++)
					{
						int num999 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num999];
						dust2.velocity *= 0.9f;
					}
					for (int num1000 = 0; num1000 < 5; num1000++)
					{
						int num1001 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num1001].noGravity = true;
						Dust dust2 = Main.dust[num1001];
						dust2.velocity *= 3f;
						num1001 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust2 = Main.dust[num1001];
						dust2.velocity *= 2f;
					}
					int num1002 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num1002];
					gore2.velocity *= 0.3f;
					Main.gore[num1002].velocity.X += Main.rand.Next(-1, 2);
					Main.gore[num1002].velocity.Y += Main.rand.Next(-1, 2);
					position.X += width / 2;
					position.Y += height / 2;
					width = 150;
					height = 150;
					position.X -= width / 2;
					position.Y -= height / 2;
					penetrate = -1;
					maxPenetrate = 0;
					Damage();
					if (owner == Main.myPlayer)
					{
						int num1003 = Main.rand.Next(2, 6);
						for (int num1004 = 0; num1004 < num1003; num1004++)
						{
							float num1005 = Main.rand.Next(-100, 101);
							num1005 += 0.01f;
							float num1006 = Main.rand.Next(-100, 101);
							num1005 -= 0.01f;
							float num1007 = (float)Math.Sqrt(num1005 * num1005 + num1006 * num1006);
							num1007 = 8f / num1007;
							num1005 *= num1007;
							num1006 *= num1007;
							int num1008 = NewProjectile(GetProjectileSource_FromThis(), base.Center.X - oldVelocity.X, base.Center.Y - oldVelocity.Y, num1005, num1006, 249, damage, knockBack, owner);
							Main.projectile[num1008].maxPenetrate = 0;
						}
					}
				}
				else if (type == 249)
				{
					SoundEngine.PlaySound(SoundID.Item14, position);
					for (int num1009 = 0; num1009 < 7; num1009++)
					{
						int num1010 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num1010];
						dust2.velocity *= 0.8f;
					}
					for (int num1011 = 0; num1011 < 2; num1011++)
					{
						int num1012 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num1012].noGravity = true;
						Dust dust2 = Main.dust[num1012];
						dust2.velocity *= 2.5f;
						num1012 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust2 = Main.dust[num1012];
						dust2.velocity *= 1.5f;
					}
					int num1013 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num1013];
					gore2.velocity *= 0.2f;
					Main.gore[num1013].velocity.X += Main.rand.Next(-1, 2);
					Main.gore[num1013].velocity.Y += Main.rand.Next(-1, 2);
					position.X += width / 2;
					position.Y += height / 2;
					width = 100;
					height = 100;
					position.X -= width / 2;
					position.Y -= height / 2;
					penetrate = -1;
					Damage();
				}
				else if (type == 588)
				{
					SoundEngine.PlaySound(SoundID.Item14, position);
					position = base.Center;
					width = (height = 22);
					base.Center = position;
					for (int num1014 = 0; num1014 < 8; num1014++)
					{
						int num1015 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 219 + Main.rand.Next(5));
						Dust dust2 = Main.dust[num1015];
						dust2.velocity *= 1.4f;
						Main.dust[num1015].fadeIn = 1f;
						Main.dust[num1015].noGravity = true;
					}
					for (int num1016 = 0; num1016 < 15; num1016++)
					{
						int num1017 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 139 + Main.rand.Next(4), 0f, 0f, 0, default(Color), 1.6f);
						Main.dust[num1017].noGravity = true;
						Dust dust2 = Main.dust[num1017];
						dust2.velocity *= 5f;
						num1017 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 139 + Main.rand.Next(4), 0f, 0f, 0, default(Color), 1.9f);
						dust2 = Main.dust[num1017];
						dust2.velocity *= 3f;
					}
					if (Main.rand.Next(2) == 0)
					{
						int num1018 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(276, 283));
						Gore gore2 = Main.gore[num1018];
						gore2.velocity *= 0.4f;
						Main.gore[num1018].velocity.X += 1f;
						Main.gore[num1018].velocity.Y += 1f;
					}
					if (Main.rand.Next(2) == 0)
					{
						int num1018 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(276, 283));
						Gore gore2 = Main.gore[num1018];
						gore2.velocity *= 0.4f;
						Main.gore[num1018].velocity.X -= 1f;
						Main.gore[num1018].velocity.Y += 1f;
					}
					if (Main.rand.Next(2) == 0)
					{
						int num1018 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(276, 283));
						Gore gore2 = Main.gore[num1018];
						gore2.velocity *= 0.4f;
						Main.gore[num1018].velocity.X += 1f;
						Main.gore[num1018].velocity.Y -= 1f;
					}
					if (Main.rand.Next(2) == 0)
					{
						int num1018 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(276, 283));
						Gore gore2 = Main.gore[num1018];
						gore2.velocity *= 0.4f;
						Main.gore[num1018].velocity.X -= 1f;
						Main.gore[num1018].velocity.Y -= 1f;
					}
				}
				else if (type == 773)
				{
					Player player3 = Main.player[owner];
					Vector2 v = DirectionTo(player3.Center);
					float num1019 = v.ToRotation() + (float)Math.PI / 2f;
					num1019 += (float)Math.PI;
					Point scarabBombDigDirectionSnap = GetScarabBombDigDirectionSnap8();
					num1019 = scarabBombDigDirectionSnap.ToVector2().ToRotation() + (float)Math.PI / 2f;
					if (type == 794 || type == 797)
					{
						SoundEngine.PlaySound(SoundID.Item62, base.Center);
					}
					else
					{
						SoundEngine.PlaySound(SoundID.Item14, base.Center);
					}
					Resize(80, 80);
					for (int num1020 = 0; num1020 < 60; num1020++)
					{
						Dust dust77 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, default(Color), 2f);
						dust77.velocity.Y -= 0.5f;
						Dust dust2 = dust77;
						dust2.velocity *= 1.2f;
						dust77.color = Color.Black * 0.9f;
						if (Main.rand.Next(2) == 0)
						{
							dust77.scale = 0.5f;
							dust77.fadeIn = 1f + (float)Main.rand.Next(10) * 0.1f;
							dust77.color = Color.Black * 0.8f;
						}
					}
					for (int num1021 = 0; num1021 < 30; num1021++)
					{
						Dust dust78 = Dust.NewDustDirect(position, width, height, 59, 0f, 0f, 100);
						dust78.noGravity = true;
						if (Math.Abs(velocity.X) > 0.25f)
						{
							velocity.X *= 0.25f / Math.Abs(velocity.X);
						}
						dust78.velocity.Y -= 0.5f;
						dust78.fadeIn = 1.2f;
						Dust dust2 = dust78;
						dust2.velocity *= 8f;
						dust78.velocity = dust78.velocity.RotatedBy(num1019);
						dust78 = Dust.NewDustDirect(position, width, height, 59, 0f, 0f, 100, default(Color), 1.5f);
						dust2 = dust78;
						dust2.velocity *= 2f;
						dust78.velocity = dust78.velocity.RotatedBy(num1019);
						dust78.velocity.Y -= 1.5f;
						dust78 = Dust.NewDustDirect(position, width, height, 59, 0f, 0f, 100, default(Color), 1.5f);
						dust78.noGravity = true;
						dust78.velocity.Y -= 1f;
						dust78.fadeIn = 2f;
						dust2 = dust78;
						dust2.velocity *= 4f;
						dust78.velocity = dust78.velocity.RotatedBy(num1019);
					}
					bool flag7 = Math.Abs(scarabBombDigDirectionSnap.X) + Math.Abs(scarabBombDigDirectionSnap.Y) == 1;
					for (int num1022 = 1; num1022 <= 3; num1022++)
					{
						float num1023 = (float)Math.PI * 2f * Main.rand.NextFloat();
						for (float num1024 = 0f; num1024 < 1f; num1024 += 1f / 12f)
						{
							float f6 = (float)Math.PI * 2f * num1024 + num1023;
							Vector2 value14 = f6.ToRotationVector2();
							value14 *= new Vector2(0.7f, 0.3f);
							Dust dust79 = Dust.NewDustPerfect(base.Center, 59, value14);
							dust79.fadeIn = 2f;
							dust79.noGravity = true;
							Dust dust2 = dust79;
							dust2.velocity *= (float)num1022 + Main.rand.NextFloat() * 0.6f;
							dust79.velocity.Y -= (float)num1022 * 0.8f;
							dust79.velocity = dust79.velocity.RotatedBy(num1019);
							if (flag7)
							{
								dust2 = dust79;
								dust2.velocity += scarabBombDigDirectionSnap.ToVector2() * (Main.rand.NextFloat() * 11f + 6f);
							}
							else
							{
								dust2 = dust79;
								dust2.velocity += scarabBombDigDirectionSnap.ToVector2() * (Main.rand.NextFloat() * 7f + 5f);
							}
						}
					}
					Vector2 vector78 = (num1019 - (float)Math.PI / 2f).ToRotationVector2();
					for (int num1025 = 1; num1025 <= 1; num1025++)
					{
						for (int num1026 = -1; num1026 <= 1; num1026 += 2)
						{
							for (int num1027 = -1; num1027 <= 1; num1027 += 2)
							{
								Gore gore15 = Gore.NewGoreDirect(base.Center - Vector2.One * 20f, Vector2.Zero, Main.rand.Next(61, 64));
								gore15.velocity = gore15.velocity * 0.5f + vector78 * 3f;
								Gore gore2 = gore15;
								gore2.velocity += new Vector2(num1026, num1027) * 0.2f;
							}
						}
					}
					Resize(10, 10);
					if (owner == Main.myPlayer)
					{
						Point p = base.Center.ToTileCoordinates();
						Vector2 vector79 = p.ToWorldCoordinates();
						bool wallSplode = false;
						int num1028 = 15;
						if (scarabBombDigDirectionSnap.X == 0 || scarabBombDigDirectionSnap.Y == 0)
						{
							num1028 = (int)((double)num1028 * Math.Sqrt(2.0));
						}
						int num1029 = ((scarabBombDigDirectionSnap.Y >= 0) ? 1 : (-1));
						for (int num1030 = 0; num1030 < num1028; num1030++)
						{
							int num1031 = ((scarabBombDigDirectionSnap.Y >= 0) ? num1030 : (num1028 - num1030 - 1));
							Vector2 vec = vector79 + scarabBombDigDirectionSnap.ToVector2() * 16f * num1031 * 1f;
							Point p2 = vec.ToTileCoordinates();
							if (ShouldWallExplode(p2.ToWorldCoordinates(), 9999, p2.X - 1, p2.X + 1, p2.Y - 1, p2.Y + 1))
							{
								wallSplode = true;
								break;
							}
						}
						for (int num1032 = 0; num1032 < num1028; num1032++)
						{
							int num1033 = ((scarabBombDigDirectionSnap.Y >= 0) ? num1032 : (num1028 - num1032 - 1));
							Vector2 vec2 = vector79 + scarabBombDigDirectionSnap.ToVector2() * 16f * num1033 * 1f;
							Point p3 = vec2.ToTileCoordinates();
							ExplodeTiles(p3.ToWorldCoordinates(), 9999, p3.X - 1, p3.X + 1, p3.Y - 1, p3.Y + 1, wallSplode);
						}
					}
				}
				else if (type == 28 || type == 30 || type == 37 || type == 75 || type == 102 || type == 164 || type == 397 || type == 517 || type == 516 || type == 519 || type == 773)
				{
					SoundEngine.PlaySound(SoundID.Item14, position);
					Resize(22, 22);
					int num1034 = 6;
					if (type == 773)
					{
						num1034 = 59;
					}
					for (int num1035 = 0; num1035 < 20; num1035++)
					{
						int num1036 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num1036];
						dust2.velocity *= 1.4f;
					}
					for (int num1037 = 0; num1037 < 10; num1037++)
					{
						int num1038 = Dust.NewDust(position, width, height, num1034, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num1038].noGravity = true;
						Dust dust2 = Main.dust[num1038];
						dust2.velocity *= 5f;
						num1038 = Dust.NewDust(position, width, height, num1034, 0f, 0f, 100, default(Color), 1.5f);
						dust2 = Main.dust[num1038];
						dust2.velocity *= 3f;
					}
					int num1039 = Gore.NewGore(position, default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num1039];
					gore2.velocity *= 0.4f;
					Main.gore[num1039].velocity.X += 1f;
					Main.gore[num1039].velocity.Y += 1f;
					num1039 = Gore.NewGore(position, default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num1039];
					gore2.velocity *= 0.4f;
					Main.gore[num1039].velocity.X -= 1f;
					Main.gore[num1039].velocity.Y += 1f;
					num1039 = Gore.NewGore(position, default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num1039];
					gore2.velocity *= 0.4f;
					Main.gore[num1039].velocity.X += 1f;
					Main.gore[num1039].velocity.Y -= 1f;
					num1039 = Gore.NewGore(position, default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num1039];
					gore2.velocity *= 0.4f;
					Main.gore[num1039].velocity.X -= 1f;
					Main.gore[num1039].velocity.Y -= 1f;
					if (type == 102)
					{
						Vector2 vector80 = position;
						Resize(128, 128);
						damage = 40;
						Damage();
						Resize(22, 22);
					}
					if (type == 75)
					{
						Resize(128, 128);
						damage = 60;
						knockBack = 8f;
						Damage();
						Resize(22, 22);
					}
				}
				else if (type == 29 || type == 108 || type == 470 || type == 637 || type == 1002 || type == 1086 || type == 1087)
				{
					SoundEngine.PlaySound(SoundID.Item14, position);
					if (type == 29)
					{
						position.X += width / 2;
						position.Y += height / 2;
						width = 200;
						height = 200;
						position.X -= width / 2;
						position.Y -= height / 2;
					}
					if (type == 1086 || type == 1087)
					{
						position.X += width / 2;
						position.Y += height / 2;
						width = 240;
						height = 240;
						position.X -= width / 2;
						position.Y -= height / 2;
					}
					for (int num1040 = 0; num1040 < 50; num1040++)
					{
						int num1041 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 2f);
						Dust dust2 = Main.dust[num1041];
						dust2.velocity *= 1.4f;
					}
					for (int num1042 = 0; num1042 < 80; num1042++)
					{
						int num1043 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 3f);
						Main.dust[num1043].noGravity = true;
						Dust dust2 = Main.dust[num1043];
						dust2.velocity *= 5f;
						num1043 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2f);
						dust2 = Main.dust[num1043];
						dust2.velocity *= 3f;
					}
					for (int num1044 = 0; num1044 < 2; num1044++)
					{
						int num1045 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
						Main.gore[num1045].scale = 1.5f;
						Main.gore[num1045].velocity.X += 1.5f;
						Main.gore[num1045].velocity.Y += 1.5f;
						num1045 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
						Main.gore[num1045].scale = 1.5f;
						Main.gore[num1045].velocity.X -= 1.5f;
						Main.gore[num1045].velocity.Y += 1.5f;
						num1045 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
						Main.gore[num1045].scale = 1.5f;
						Main.gore[num1045].velocity.X += 1.5f;
						Main.gore[num1045].velocity.Y -= 1.5f;
						num1045 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
						Main.gore[num1045].scale = 1.5f;
						Main.gore[num1045].velocity.X -= 1.5f;
						Main.gore[num1045].velocity.Y -= 1.5f;
					}
					position.X += width / 2;
					position.Y += height / 2;
					width = 10;
					height = 10;
					if (type == 1086 || type == 1087)
					{
						width = 22;
						height = 22;
					}
					position.X -= width / 2;
					position.Y -= height / 2;
				}
				else if (type == 69)
				{
					SoundEngine.PlaySound(13, (int)position.X, (int)position.Y);
					for (int num1046 = 0; num1046 < 5; num1046++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 13);
					}
					for (int num1047 = 0; num1047 < 30; num1047++)
					{
						int num1048 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 33, 0f, -2f, 0, default(Color), 1.1f);
						Main.dust[num1048].alpha = 100;
						Main.dust[num1048].velocity.X *= 1.5f;
						Dust dust2 = Main.dust[num1048];
						dust2.velocity *= 3f;
					}
				}
				else if (type == 70)
				{
					SoundEngine.PlaySound(13, (int)position.X, (int)position.Y);
					for (int num1049 = 0; num1049 < 5; num1049++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 13);
					}
					for (int num1050 = 0; num1050 < 30; num1050++)
					{
						int num1051 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 52, 0f, -2f, 0, default(Color), 1.1f);
						Main.dust[num1051].alpha = 100;
						Main.dust[num1051].velocity.X *= 1.5f;
						Dust dust2 = Main.dust[num1051];
						dust2.velocity *= 3f;
					}
				}
				else if (type == 621)
				{
					SoundEngine.PlaySound(13, (int)position.X, (int)position.Y);
					for (int num1052 = 0; num1052 < 5; num1052++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 13);
					}
					for (int num1053 = 0; num1053 < 30; num1053++)
					{
						int num1054 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 266, 0f, -2f, 0, default(Color), 1.1f);
						Main.dust[num1054].alpha = 100;
						Main.dust[num1054].velocity.X *= 1.5f;
						Dust dust2 = Main.dust[num1054];
						dust2.velocity *= 3f;
					}
				}
				else if (type == 114 || type == 115)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num1055 = 4; num1055 < 31; num1055++)
					{
						float num1056 = oldVelocity.X * (30f / (float)num1055);
						float num1057 = oldVelocity.Y * (30f / (float)num1055);
						int num1058 = Dust.NewDust(new Vector2(position.X - num1056, position.Y - num1057), 8, 8, 27, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.4f);
						Main.dust[num1058].noGravity = true;
						Dust dust2 = Main.dust[num1058];
						dust2.velocity *= 0.5f;
						num1058 = Dust.NewDust(new Vector2(position.X - num1056, position.Y - num1057), 8, 8, 27, oldVelocity.X, oldVelocity.Y, 100, default(Color), 0.9f);
						dust2 = Main.dust[num1058];
						dust2.velocity *= 0.5f;
					}
				}
				else if (type == 116)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num1059 = 4; num1059 < 31; num1059++)
					{
						float num1060 = oldVelocity.X * (30f / (float)num1059);
						float num1061 = oldVelocity.Y * (30f / (float)num1059);
						int num1062 = Dust.NewDust(new Vector2(position.X - num1060, position.Y - num1061), 8, 8, 64, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.8f);
						Main.dust[num1062].noGravity = true;
						num1062 = Dust.NewDust(new Vector2(position.X - num1060, position.Y - num1061), 8, 8, 64, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.4f);
						Main.dust[num1062].noGravity = true;
					}
				}
				else if (type == 173)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num1063 = 4; num1063 < 24; num1063++)
					{
						float num1064 = oldVelocity.X * (30f / (float)num1063);
						float num1065 = oldVelocity.Y * (30f / (float)num1063);
						int num1066 = Main.rand.Next(3);
						int num1067 = Dust.NewDust(new Vector2(position.X - num1064, position.Y - num1065), 8, 8, num1066 switch
						{
							0 => 15, 
							1 => 57, 
							_ => 58, 
						}, oldVelocity.X * 0.2f, oldVelocity.Y * 0.2f, 100, default(Color), 1.8f);
						Dust dust2 = Main.dust[num1067];
						dust2.velocity *= 1.5f;
						Main.dust[num1067].noGravity = true;
					}
				}
				else if (type == 132)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num1068 = 4; num1068 < 31; num1068++)
					{
						float num1069 = oldVelocity.X * (30f / (float)num1068);
						float num1070 = oldVelocity.Y * (30f / (float)num1068);
						int num1071 = Dust.NewDust(new Vector2(oldPosition.X - num1069, oldPosition.Y - num1070), 8, 8, 107, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.8f);
						Main.dust[num1071].noGravity = true;
						Dust dust2 = Main.dust[num1071];
						dust2.velocity *= 0.5f;
						num1071 = Dust.NewDust(new Vector2(oldPosition.X - num1069, oldPosition.Y - num1070), 8, 8, 107, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.4f);
						dust2 = Main.dust[num1071];
						dust2.velocity *= 0.05f;
					}
				}
				else if (type == 156)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num1072 = 4; num1072 < 31; num1072++)
					{
						float num1073 = oldVelocity.X * (30f / (float)num1072);
						float num1074 = oldVelocity.Y * (30f / (float)num1072);
						int num1075 = Dust.NewDust(new Vector2(oldPosition.X - num1073, oldPosition.Y - num1074), 8, 8, 73, oldVelocity.X, oldVelocity.Y, 255, default(Color), 1.8f);
						Main.dust[num1075].noGravity = true;
						Dust dust2 = Main.dust[num1075];
						dust2.velocity *= 0.5f;
						num1075 = Dust.NewDust(new Vector2(oldPosition.X - num1073, oldPosition.Y - num1074), 8, 8, 73, oldVelocity.X, oldVelocity.Y, 255, default(Color), 1.4f);
						dust2 = Main.dust[num1075];
						dust2.velocity *= 0.05f;
						Main.dust[num1075].noGravity = true;
					}
				}
				else if (type == 157)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num1076 = 4; num1076 < 31; num1076++)
					{
						int num1077 = Dust.NewDust(position, width, height, 107, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.8f);
						Main.dust[num1077].noGravity = true;
						Dust dust2 = Main.dust[num1077];
						dust2.velocity *= 0.5f;
					}
				}
				else if (type == 370)
				{
					SoundEngine.PlaySound(SoundID.Item4, position);
					for (int num1078 = 0; num1078 < 5; num1078++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 13);
					}
					for (int num1079 = 0; num1079 < 30; num1079++)
					{
						Vector2 vector81 = new Vector2(Main.rand.Next(-10, 11), Main.rand.Next(-10, 11));
						vector81.Normalize();
						int num1080 = Gore.NewGore(base.Center + vector81 * 10f, vector81 * Main.rand.Next(4, 9) * 0.66f + Vector2.UnitY * 1.5f, 331, (float)Main.rand.Next(40, 141) * 0.01f);
						Main.gore[num1080].sticky = false;
					}
				}
				else if (type == 371)
				{
					SoundEngine.PlaySound(13, (int)position.X, (int)position.Y);
					SoundEngine.PlaySound(SoundID.Item16, position);
					for (int num1081 = 0; num1081 < 5; num1081++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 13);
					}
					for (int num1082 = 0; num1082 < 30; num1082++)
					{
						Vector2 vector82 = new Vector2(Main.rand.Next(-10, 11), Main.rand.Next(-10, 11));
						vector82.Normalize();
						vector82 *= 0.4f;
						int num1083 = Gore.NewGore(base.Center + vector82 * 10f, vector82 * Main.rand.Next(4, 9) * 0.66f + Vector2.UnitY * 1.5f, Main.rand.Next(435, 438), (float)Main.rand.Next(20, 100) * 0.01f);
						Main.gore[num1083].sticky = false;
					}
				}
				else if (type == 936)
				{
					SoundEngine.PlaySound(SoundID.Item21, position);
					for (int num1084 = 0; num1084 < 20; num1084++)
					{
						Color newColor9 = Main.hslToRgb(0.7f + 0.2f * Main.rand.NextFloat(), 1f, 0.7f);
						newColor9.A /= 2;
						int num1085 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 4, 0f, 0f, 150, newColor9);
						Dust dust2 = Main.dust[num1085];
						dust2.velocity *= 1.5f;
						newColor9 = Main.hslToRgb(0.7f + 0.2f * Main.rand.NextFloat(), 1f, 0.5f);
						newColor9.A /= 2;
						num1085 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 4, 0f, 0f, 150, newColor9, 1.8f);
						dust2 = Main.dust[num1085];
						dust2.velocity *= 3f;
						Main.dust[num1085].noGravity = true;
					}
				}
			}
		}
		if (owner == Main.myPlayer && (type == 370 || type == 371 || type == 936))
		{
			float num1086 = 80f;
			int buffType = 119;
			if (type == 371)
			{
				buffType = 120;
			}
			if (type == 936)
			{
				buffType = 320;
			}
			for (int num1087 = 0; num1087 < 255; num1087++)
			{
				Player player4 = Main.player[num1087];
				if (player4.active && !player4.dead && Vector2.Distance(base.Center, player4.Center) < num1086)
				{
					ApplyBuffTo(player4, buffType, 1800);
				}
			}
			for (int num1088 = 0; num1088 < Main.maxNPCs; num1088++)
			{
				NPC nPC = Main.npc[num1088];
				if (nPC.active && nPC.life > 0 && Vector2.Distance(base.Center, nPC.Center) < num1086)
				{
					nPC.AddBuff(buffType, 1800);
				}
			}
		}
		if (owner == Main.myPlayer)
		{
			if (type == 30 || type == 517 || type == 397 || type == 588)
			{
				int num1089 = 4;
				Vector2 center2 = base.Center;
				int num1090 = (int)(center2.X / 16f - (float)num1089);
				int num1091 = (int)(center2.X / 16f + (float)num1089);
				int num1092 = (int)(center2.Y / 16f - (float)num1089);
				int num1093 = (int)(center2.Y / 16f + (float)num1089);
				if (num1090 < 0)
				{
					num1090 = 0;
				}
				if (num1091 > Main.maxTilesX)
				{
					num1091 = Main.maxTilesX;
				}
				if (num1092 < 0)
				{
					num1092 = 0;
				}
				if (num1093 > Main.maxTilesY)
				{
					num1093 = Main.maxTilesY;
				}
				ExplodeCrackedTiles(center2, num1089, num1090, num1091, num1092, num1093);
			}
			if (type == 28 || type == 29 || type == 37 || type == 108 || type == 136 || type == 137 || type == 138 || type == 142 || type == 143 || type == 144 || type == 339 || type == 341 || type == 470 || type == 516 || type == 519 || type == 637 || type == 716 || type == 718 || type == 780 || type == 781 || type == 782 || type == 804 || type == 783 || type == 863 || type == 796 || type == 797 || type == 798 || type == 809 || (type == 102 && Main.getGoodWorld && !Main.tenthAnniversaryWorld) || type == 1086 || type == 1087)
			{
				int num1094 = 3;
				bool explodeHardmodeOres = false;
				if (type == 102)
				{
					num1094 = 4;
				}
				if (type == 28 || type == 37 || type == 516 || type == 519)
				{
					num1094 = 4;
				}
				if (type == 29 || type == 470 || type == 637 || type == 796 || type == 797 || type == 798 || type == 809)
				{
					num1094 = 7;
				}
				if (type == 1086 || type == 1087)
				{
					num1094 = 9;
					explodeHardmodeOres = true;
				}
				if (type == 142 || type == 143 || type == 144 || type == 341)
				{
					num1094 = 5;
				}
				if (type == 716 || type == 780 || type == 781 || type == 782 || type == 804 || type == 783 || type == 863)
				{
					num1094 = 3;
				}
				if (type == 718)
				{
					num1094 = 5;
				}
				if (type == 108)
				{
					num1094 = 10;
				}
				if (type == 1002)
				{
					num1094 = 10;
				}
				Vector2 center3 = position;
				if (type == 716 || type == 718 || type == 773 || type == 1086 || type == 1087)
				{
					center3 = base.Center;
				}
				int num1095 = num1094;
				int num1096 = num1094;
				int num1097 = (int)(center3.X / 16f - (float)num1095);
				int num1098 = (int)(center3.X / 16f + (float)num1095);
				int num1099 = (int)(center3.Y / 16f - (float)num1096);
				int num1100 = (int)(center3.Y / 16f + (float)num1096);
				if (num1097 < 0)
				{
					num1097 = 0;
				}
				if (num1098 > Main.maxTilesX)
				{
					num1098 = Main.maxTilesX;
				}
				if (num1099 < 0)
				{
					num1099 = 0;
				}
				if (num1100 > Main.maxTilesY)
				{
					num1100 = Main.maxTilesY;
				}
				bool wallSplode2 = ShouldWallExplode(center3, num1094, num1097, num1098, num1099, num1100);
				ExplodeTiles(center3, num1094, num1097, num1098, num1099, num1100, wallSplode2, explodeHardmodeOres);
			}
			if (Main.netMode != 0)
			{
				NetMessage.SendData(29, -1, -1, null, identity, owner);
			}
			if (!noDropItem)
			{
				int num1101 = -1;
				if (type >= 736 && type <= 738)
				{
					SoundEngine.PlaySound(SoundID.Item127, position);
					for (int num1102 = 0; num1102 < 3; num1102++)
					{
						Dust.NewDust(position, 16, 16, type - 736 + 275);
					}
					int num1103 = (int)(base.Center.X / 16f);
					int num1104 = (int)(base.Center.Y / 16f) + 1;
					if (Main.myPlayer == owner && Main.tile[num1103, num1104].active() && TileID.Sets.CrackedBricks[Main.tile[num1103, num1104].type] && Main.rand.Next(2) == 0)
					{
						WorldGen.KillTile(num1103, num1104);
						if (Main.netMode != 0)
						{
							NetMessage.SendData(17, -1, -1, null, 20, num1103, num1104);
						}
					}
				}
				else if (aiStyle == 10)
				{
					int num1105 = (int)(position.X + (float)(width / 2)) / 16;
					int num1106 = (int)(position.Y + (float)(height / 2)) / 16;
					int num1107 = 0;
					int num1108 = 2;
					if (type == 109)
					{
						num1107 = 147;
						num1108 = 0;
					}
					if (type == 31)
					{
						num1107 = 53;
						num1108 = 169;
						if (ai[0] == 2f)
						{
							num1108 = 0;
						}
					}
					if (type == 42)
					{
						num1107 = 53;
						num1108 = 0;
					}
					if (type == 56)
					{
						num1107 = 112;
						num1108 = 370;
					}
					if (type == 65)
					{
						num1107 = 112;
						num1108 = 0;
					}
					if (type == 67)
					{
						num1107 = 116;
						num1108 = 408;
					}
					if (type == 68)
					{
						num1107 = 116;
						num1108 = 0;
					}
					if (type == 71)
					{
						num1107 = 123;
						num1108 = 424;
					}
					if (type == 39)
					{
						num1107 = 59;
						num1108 = 0;
					}
					if (type == 1081)
					{
						num1107 = 59;
						num1108 = 176;
					}
					if (type == 40)
					{
						num1107 = 57;
						num1108 = 0;
					}
					if (type == 179)
					{
						num1107 = 224;
						num1108 = 1103;
					}
					if (type == 241)
					{
						num1107 = 234;
						num1108 = 1246;
					}
					if (type == 354)
					{
						num1107 = 234;
						num1108 = 0;
					}
					if (type == 411)
					{
						num1107 = 330;
						num1108 = 71;
					}
					if (type == 412)
					{
						num1107 = 331;
						num1108 = 72;
					}
					if (type == 413)
					{
						num1107 = 332;
						num1108 = 73;
					}
					if (type == 414)
					{
						num1107 = 333;
						num1108 = 74;
					}
					if (type == 812)
					{
						num1107 = 495;
						num1108 = 4090;
					}
					if (type == 1081 && !WorldGen.SolidTile3(num1105, num1106 + 1))
					{
						if (WorldGen.SolidTile3(num1105 - 1, num1106 + 1) && !Main.tile[num1105 - 1, num1106].active())
						{
							num1105--;
						}
						else if (WorldGen.SolidTile3(num1105 + 1, num1106 + 1) && !Main.tile[num1105 + 1, num1106].active())
						{
							num1105++;
						}
					}
					if (type == 109)
					{
						int num1109 = Player.FindClosest(position, width, height);
						if ((double)(base.Center - Main.player[num1109].Center).Length() > (double)Main.MaxWorldViewSize.X * 0.75)
						{
							num1107 = -1;
							num1108 = 593;
						}
					}
					if (Main.tile[num1105, num1106].nactive() && Main.tile[num1105, num1106].halfBrick() && velocity.Y > 0f && Math.Abs(velocity.Y) > Math.Abs(velocity.X))
					{
						num1106--;
					}
					if (!Main.tile[num1105, num1106].active() && num1107 >= 0)
					{
						bool flag8 = false;
						bool flag9 = false;
						if (num1106 < Main.maxTilesY - 2)
						{
							Tile tile3 = Main.tile[num1105, num1106 + 1];
							if (tile3 != null && tile3.active())
							{
								if (tile3.type == 314)
								{
									flag9 = true;
								}
								if (tile3.type == 421 || tile3.type == 422)
								{
									if (type == 31)
									{
										num1108 = 169;
									}
									flag9 = true;
								}
								if (WorldGen.BlockBelowMakesSandFall(num1105, num1106))
								{
									flag9 = true;
								}
							}
						}
						if (!flag9)
						{
							flag8 = WorldGen.PlaceTile(num1105, num1106, num1107, mute: false, forced: true);
						}
						if (!flag9 && Main.tile[num1105, num1106].active() && Main.tile[num1105, num1106].type == num1107)
						{
							if (Main.tile[num1105, num1106 + 1].halfBrick() || Main.tile[num1105, num1106 + 1].slope() != 0)
							{
								WorldGen.SlopeTile(num1105, num1106 + 1);
								if (Main.netMode != 0)
								{
									NetMessage.SendData(17, -1, -1, null, 14, num1105, num1106 + 1);
								}
							}
							if (Main.netMode != 0)
							{
								NetMessage.SendData(17, -1, -1, null, 1, num1105, num1106, num1107);
							}
						}
						else if (!flag8 && num1108 > 0)
						{
							num1101 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height - 2, num1108);
						}
					}
					else if (num1108 > 0)
					{
						num1101 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, num1108);
					}
				}
				if (type == 171)
				{
					if (ai[1] == 0f)
					{
						num1101 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 985);
						Main.item[num1101].noGrabDelay = 0;
					}
					else if (ai[1] < 10f)
					{
						num1101 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 965, (int)(10f - ai[1]));
						Main.item[num1101].noGrabDelay = 0;
					}
				}
				if (type == 475)
				{
					if (ai[1] == 0f)
					{
						num1101 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 3005);
						Main.item[num1101].noGrabDelay = 0;
					}
					else if (ai[1] < 10f)
					{
						num1101 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 2996, (int)(10f - ai[1]));
						Main.item[num1101].noGrabDelay = 0;
					}
				}
				if (type == 505)
				{
					if (ai[1] == 0f)
					{
						num1101 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 3079);
						Main.item[num1101].noGrabDelay = 0;
					}
					else if (ai[1] < 10f)
					{
						num1101 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 3077, (int)(10f - ai[1]));
						Main.item[num1101].noGrabDelay = 0;
					}
				}
				if (type == 506)
				{
					if (ai[1] == 0f)
					{
						num1101 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 3080);
						Main.item[num1101].noGrabDelay = 0;
					}
					else if (ai[1] < 10f)
					{
						num1101 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 3078, (int)(10f - ai[1]));
						Main.item[num1101].noGrabDelay = 0;
					}
				}
				if (type == 12 && damage > 500 && !Main.remixWorld)
				{
					num1101 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 75);
				}
				if (type == 155)
				{
					num1101 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 859);
				}
				if (type == 861)
				{
					num1101 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y - 2, width, height, 4743, (int)Math.Max(ai[2], 1f));
				}
				if (Main.netMode == 1 && num1101 >= 0)
				{
					NetMessage.SendData(21, -1, -1, null, num1101, 1f);
				}
			}
			if (type == 69 || type == 70 || type == 621)
			{
				int i2 = (int)(position.X + (float)(width / 2)) / 16;
				int j2 = (int)(position.Y + (float)(height / 2)) / 16;
				if (type == 69)
				{
					WorldGen.Convert(i2, j2, 2, 4);
				}
				if (type == 70)
				{
					WorldGen.Convert(i2, j2, 1, 4);
				}
				if (type == 621)
				{
					WorldGen.Convert(i2, j2, 4, 4);
				}
			}
			if (type == 378)
			{
				int num1110 = Main.rand.Next(2, 4);
				if (Main.rand.Next(5) == 0)
				{
					num1110++;
				}
				for (int num1111 = 0; num1111 < num1110; num1111++)
				{
					float x2 = velocity.X;
					float y8 = velocity.Y;
					x2 *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
					y8 *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, x2, y8, 379, damage, knockBack, owner);
				}
			}
		}
		active = false;
	}

	private void DoLightningKillLambda()
	{
		for (int i = 1; i < 20; i++)
		{
			Vector2 vec = base.Center + Vector2.UnitX.RotatedBy((float)Math.PI * (float)i / 20f) * 500f;
			Utils.PlotLine(base.Center.ToTileCoordinates(), vec.ToTileCoordinates(), LightningKillLambda_Step);
		}
	}

	private bool LightningKillLambda_Step(int x, int y)
	{
		if (!WorldGen.InWorld(x, y) || Main.tile[x, y].liquid == 0)
		{
			return false;
		}
		if (Main.rand.Next(4) == 0)
		{
			ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.StormlightningWindup, new ParticleOrchestraSettings
			{
				PositionInWorld = new Point(x, y).ToWorldCoordinates(),
				UniqueInfoPiece = (int)AI_203_GetLightningColor().PackedValue
			});
			Lighting.AddLight(x, y, 1f, 1f, 1f);
		}
		return true;
	}

	private void DropGeodeGems()
	{
		List<int> list = new List<int> { 181, 182, 180, 178, 179, 177, 999 };
		int item = list[Main.rand.Next(list.Count)];
		list.Remove(item);
		int stack = Main.rand.Next(3, 7);
		int item2 = list[Main.rand.Next(list.Count)];
		list.Remove(item2);
		int stack2 = Main.rand.Next(3, 7);
		int num = Item.NewItem(new EntitySource_Loot(this), position, base.Size, item, stack);
		Main.item[num].noGrabDelay = 0;
		if (Main.netMode == 1)
		{
			NetMessage.SendData(21, -1, -1, null, num, 1f);
		}
		num = Item.NewItem(new EntitySource_Loot(this), position, base.Size, item2, stack2);
		Main.item[num].noGrabDelay = 0;
		if (Main.netMode == 1)
		{
			NetMessage.SendData(21, -1, -1, null, num, 1f);
		}
	}

	private void DoRainbowCrystalStaffExplosion()
	{
		Vector2 spinningpoint = new Vector2(0f, -3f).RotatedByRandom(3.1415927410125732);
		float num = Main.rand.Next(7, 13);
		Vector2 vector = new Vector2(2.1f, 2f);
		Color newColor = Main.hslToRgb(ai[0], 1f, 0.5f);
		newColor.A = byte.MaxValue;
		for (float num2 = 0f; num2 < num; num2 += 1f)
		{
			int num3 = Dust.NewDust(base.Center, 0, 0, 267, 0f, 0f, 0, newColor);
			Main.dust[num3].position = base.Center;
			Main.dust[num3].velocity = spinningpoint.RotatedBy((float)Math.PI * 2f * num2 / num) * vector * (0.8f + Main.rand.NextFloat() * 0.4f);
			Main.dust[num3].noGravity = true;
			Main.dust[num3].scale = 2f;
			Main.dust[num3].fadeIn = Main.rand.NextFloat() * 2f;
			if (num3 != 6000)
			{
				Dust dust = Dust.CloneDust(num3);
				dust.scale /= 2f;
				dust.fadeIn /= 2f;
				dust.color = new Color(255, 255, 255, 255);
			}
		}
		for (float num4 = 0f; num4 < num; num4 += 1f)
		{
			int num5 = Dust.NewDust(base.Center, 0, 0, 267, 0f, 0f, 0, newColor);
			Main.dust[num5].position = base.Center;
			Main.dust[num5].velocity = spinningpoint.RotatedBy((float)Math.PI * 2f * num4 / num) * vector * (0.8f + Main.rand.NextFloat() * 0.4f);
			Main.dust[num5].velocity *= Main.rand.NextFloat() * 0.8f;
			Main.dust[num5].noGravity = true;
			Main.dust[num5].scale = Main.rand.NextFloat() * 1f;
			Main.dust[num5].fadeIn = Main.rand.NextFloat() * 2f;
			if (num5 != 6000)
			{
				Dust dust2 = Dust.CloneDust(num5);
				dust2.scale /= 2f;
				dust2.fadeIn /= 2f;
				dust2.color = new Color(255, 255, 255, 255);
			}
		}
	}

	public bool ShouldWallExplode(Vector2 compareSpot, int radius, int minI, int maxI, int minJ, int maxJ)
	{
		bool result = false;
		for (int i = minI; i <= maxI; i++)
		{
			for (int j = minJ; j <= maxJ; j++)
			{
				float num = Math.Abs((float)i - compareSpot.X / 16f);
				float num2 = Math.Abs((float)j - compareSpot.Y / 16f);
				if (Math.Sqrt(num * num + num2 * num2) < (double)radius && Main.tile[i, j] != null && Main.tile[i, j].wall == 0)
				{
					result = true;
					break;
				}
			}
		}
		return result;
	}

	public Color GetFloatingDaggerMinionGlowColor()
	{
		float num = (float)(whoAmI % 6) / 6f;
		return Main.hslToRgb(0.66f + 0.33f * num, 0.7f, 0.6f) * 0.7f;
	}

	public bool CanExplodeTile(int x, int y, bool explodeHardmodeOres = false)
	{
		if (Main.tileDungeon[Main.tile[x, y].type] || TileID.Sets.BasicChest[Main.tile[x, y].type])
		{
			return false;
		}
		if (Main.tile[x, y].wall == 350)
		{
			return false;
		}
		switch (Main.tile[x, y].type)
		{
		case 26:
		case 88:
		case 121:
		case 122:
		case 150:
		case 211:
		case 226:
		case 237:
		case 248:
		case 249:
		case 250:
		case 346:
		case 470:
		case 475:
		case 504:
		case 685:
		case 686:
			return false;
		case 107:
		case 108:
		case 111:
		case 221:
		case 222:
		case 223:
			return explodeHardmodeOres;
		case 37:
		case 58:
			if (!Main.hardMode)
			{
				return false;
			}
			break;
		case 77:
			if (!Main.hardMode && y >= Main.UnderworldLayer)
			{
				return false;
			}
			break;
		case 48:
		case 232:
			if (Main.getGoodWorld)
			{
				return false;
			}
			break;
		case 137:
			if (!NPC.downedGolemBoss)
			{
				int num = Main.tile[x, y].frameY / 18;
				if ((uint)(num - 1) <= 3u)
				{
					return false;
				}
			}
			break;
		}
		return true;
	}

	public void ExplodeTiles(Vector2 compareSpot, int radius, int minI, int maxI, int minJ, int maxJ, bool wallSplode, bool explodeHardmodeOres = false)
	{
		AchievementsHelper.CurrentlyMining = true;
		for (int i = minI; i <= maxI; i++)
		{
			for (int j = minJ; j <= maxJ; j++)
			{
				float num = Math.Abs((float)i - compareSpot.X / 16f);
				float num2 = Math.Abs((float)j - compareSpot.Y / 16f);
				if (!(Math.Sqrt(num * num + num2 * num2) < (double)radius))
				{
					continue;
				}
				Tile tile = Main.tile[i, j];
				bool flag = true;
				if (tile != null && tile.active())
				{
					flag = CanExplodeTile(i, j, explodeHardmodeOres);
					if (flag)
					{
						WorldGen.KillTile(i, j);
						if (!Main.tile[i, j].active() && Main.netMode != 0)
						{
							NetMessage.SendData(17, -1, -1, null, 0, i, j);
						}
					}
				}
				if (!(wallSplode && flag))
				{
					continue;
				}
				for (int k = i - 1; k <= i + 1; k++)
				{
					for (int l = j - 1; l <= j + 1; l++)
					{
						Tile tile2 = Main.tile[k, l];
						if (tile2 != null && tile2.wall != 0 && tile2.wall != 350)
						{
							WorldGen.KillWall(k, l);
							if (tile2.wall == 0 && Main.netMode != 0)
							{
								NetMessage.SendData(17, -1, -1, null, 2, k, l);
							}
						}
					}
				}
			}
		}
		AchievementsHelper.CurrentlyMining = false;
	}

	public void ExplodeCrackedTiles(Vector2 compareSpot, int radius, int minI, int maxI, int minJ, int maxJ)
	{
		AchievementsHelper.CurrentlyMining = true;
		for (int i = minI; i <= maxI; i++)
		{
			for (int j = minJ; j <= maxJ; j++)
			{
				float num = Math.Abs((float)i - compareSpot.X / 16f);
				float num2 = Math.Abs((float)j - compareSpot.Y / 16f);
				if (Math.Sqrt(num * num + num2 * num2) < (double)radius && Main.tile[i, j] != null && Main.tile[i, j].active() && TileID.Sets.CrackedBricks[Main.tile[i, j].type])
				{
					WorldGen.KillTile(i, j);
					if (!Main.tile[i, j].active() && Main.netMode != 0)
					{
						NetMessage.SendData(17, -1, -1, null, 20, i, j);
					}
				}
			}
		}
		AchievementsHelper.CurrentlyMining = false;
	}

	public bool TryGetContainerIndex(out int containerIndex)
	{
		containerIndex = -1;
		if (type == 525 || type == 960)
		{
			containerIndex = -2;
			return true;
		}
		if (type == 734)
		{
			containerIndex = -5;
			return true;
		}
		return false;
	}

	public bool IsInteractible()
	{
		switch (type)
		{
		case 525:
		case 734:
		case 960:
		case 1093:
		case 1094:
		case 1098:
			return true;
		default:
			return false;
		}
	}

	public Color GetAlpha(Color newColor)
	{
		if (ProjectileID.Sets.IsAPhaseblade[type])
		{
			return Color.White;
		}
		if (type == 920 || type == 921 || type == 926)
		{
			return Color.Lerp(newColor, Color.White, 0.4f) * Opacity;
		}
		if (type == 47 && Main.player[owner].wet)
		{
			return Color.White;
		}
		int r;
		int g;
		int b;
		if (type == 1099)
		{
			if (alpha > 0)
			{
				return new Color(0, 0, 0, 0);
			}
			r = Main.rand.Next(255);
			g = Main.rand.Next(255);
			b = Main.rand.Next(255);
			return new Color(r, g, b, 200);
		}
		if (type == 1055)
		{
			return new Color(newColor.R, newColor.G, newColor.B, 255 - (byte)localAI[0]);
		}
		if (type == 1090)
		{
			float num = localAI[2];
			Color color = new Color(255, 255, 255, 255);
			if (num == 0f)
			{
				return newColor;
			}
			if (num == 1f)
			{
				return color;
			}
			return Color.Lerp(newColor, color, num);
		}
		if (type == 937)
		{
			newColor.A = (byte)((float)(int)newColor.A * 0.75f);
		}
		if (type == 880 || type == 929)
		{
			newColor.A /= 2;
		}
		if (type == 963)
		{
			float num2 = 0.85f;
			newColor *= num2;
			newColor.A = (byte)((float)(int)newColor.A * num2);
			if (ai[0] >= 2f)
			{
				newColor.G = (byte)((float)(int)newColor.G * 0.7f);
				newColor.B = (byte)((float)(int)newColor.B * 0.7f);
			}
		}
		if (type == 1021)
		{
			return Color.White;
		}
		if (type == 1006)
		{
			return Color.White;
		}
		if (type == 981)
		{
			return Color.White;
		}
		if (type == 75)
		{
			return Color.Lerp(newColor, Color.White, 0.66f) * Opacity;
		}
		if (type == 969)
		{
			int num3 = 210;
			r = (g = (b = num3));
			if (newColor.R < num3)
			{
				r = newColor.R;
			}
			if (newColor.G < num3)
			{
				g = newColor.G;
			}
			if (newColor.B < num3)
			{
				b = newColor.B;
			}
			return new Color(r, g, b, 185) * Opacity;
		}
		if (type == 967)
		{
			return Color.White * Opacity;
		}
		if (type == 855)
		{
			newColor = Color.Lerp(newColor, new Color(255, 200, 60), 0.5f);
		}
		if (type == 933 || type == 1001 || type == 1100)
		{
			newColor = Color.White * Opacity;
		}
		if (type == 270)
		{
			return new Color(255, 255, 255, (int)Utils.WrappedLerp(0f, 255f, (float)(timeLeft % 40) / 40f));
		}
		if (type == 837)
		{
			if (alpha > 0)
			{
				return Color.Transparent;
			}
			return new Color(255, 255, 255, 200);
		}
		if (type == 180 || type == 345)
		{
			return Color.Lerp(newColor, Color.White, 0.75f);
		}
		if (type == 586)
		{
			if (ai[2] == 1f)
			{
				Color value = new Color(newColor.R / 2, 0, newColor.G);
				float amount = (float)Math.Sin(ai[0] % 120f * ((float)Math.PI * 2f) / 120f) * 0.5f + 0.5f;
				newColor = Color.Lerp(newColor, value, amount);
				return Color.Lerp(newColor, Color.Lerp(Color.White, value, amount), 0.75f);
			}
			return Color.Lerp(newColor, Color.White, 0.75f);
		}
		if (type == 764 || type == 856 || type == 857 || type == 864)
		{
			return Color.White;
		}
		if (type == 873 || type == 872 || type == 931 || type == 913 || type == 34 || type == 1039)
		{
			return Color.White * Opacity;
		}
		if (type == 756 || type == 961)
		{
			return Color.Lerp(newColor, Color.Black, 0.25f);
		}
		if (type == 1041)
		{
			if (alpha == 255)
			{
				return Color.Transparent;
			}
			return Color.White;
		}
		if (type == 895)
		{
			return Color.White * Opacity;
		}
		if (type == 893 || type == 907)
		{
			return new Color(255, 255, 255, 150);
		}
		if (type == 833 || type == 834 || type == 835 || type == 912)
		{
			return Color.Lerp(newColor, Color.White, 0.25f);
		}
		if (type == 351 || type == 350)
		{
			Point point = base.Center.ToTileCoordinates();
			if (WorldGen.InWorld(point.X, point.Y) && !WorldGen.SolidTile(point.X, point.Y))
			{
				return Color.Lerp(newColor, Color.White, 0.15f);
			}
			return Color.Lerp(newColor, Color.White, 0.05f);
		}
		if (type == 346 || type == 347 || type == 325 || type == 755)
		{
			return Color.Lerp(newColor, Color.White, 0.75f);
		}
		if (type == 650)
		{
			r = (int)((double)(int)newColor.R * 1.5);
			g = (int)((double)(int)newColor.G * 1.5);
			b = (int)((double)(int)newColor.B * 1.5);
			if (r > 255)
			{
				r = 255;
			}
			if (g > 255)
			{
				g = 255;
			}
			if (b > 255)
			{
				b = 255;
			}
		}
		else
		{
			if (type == 948)
			{
				return Color.White;
			}
			if (type == 604 || type == 631)
			{
				return new Color(255 - alpha, 255 - alpha, 255 - alpha, 0);
			}
			if (type == 342)
			{
				return Color.Lerp(newColor, Color.White, 0.75f) * Opacity;
			}
			if (type == 636)
			{
				return new Color(255 - alpha, 255 - alpha, 255 - alpha, 64 - alpha / 4);
			}
			if (type == 673 || type == 706)
			{
				return new Color(255 - alpha, 255 - alpha, 255 - alpha, 180 - alpha / 2 - alpha / 4);
			}
			if (type == 603 || type == 633)
			{
				return new Color(255, 255, 255, 200);
			}
			if (type == 623 || (type >= 625 && type <= 628) || type == 710)
			{
				return new Color(255 - alpha, 255 - alpha, 255 - alpha, 255 - alpha);
			}
			if (type == 645 || type == 643)
			{
				return new Color(255 - alpha, 255 - alpha, 255 - alpha, 127 - alpha / 2);
			}
			if (type == 611)
			{
				return new Color(255, 255, 255, 200);
			}
			if (type == 640 || type == 644 || type == 658)
			{
				return new Color(255 - alpha, 255 - alpha, 255 - alpha, 0);
			}
			if (type == 612 || type == 953)
			{
				return new Color(255, 255, 255, 127);
			}
			if (type == 978)
			{
				return new Color(255, 255, 255, 127) * Opacity;
			}
			if (type == 567 || type == 568)
			{
				return new Color(255 - alpha, 255 - alpha, 255 - alpha, 255 - alpha);
			}
			if (type == 554)
			{
				return new Color(200, 200, 200, 200);
			}
			if (type == 601)
			{
				return PortalHelper.GetPortalColor(owner, (int)ai[0]);
			}
			if (type == 602)
			{
				Color portalColor = PortalHelper.GetPortalColor(owner, (int)ai[1]);
				portalColor.A = 227;
				return portalColor;
			}
			if (type == 585)
			{
				byte a = newColor.A;
				newColor = Color.Lerp(newColor, Color.White, 0.5f);
				newColor.A = a;
				return newColor;
			}
			if (type == 714)
			{
				byte a2 = newColor.A;
				newColor = Color.Lerp(newColor, Color.White, 0.8f);
				newColor.A = a2;
				newColor *= (float)(int)a2 / 255f;
				return newColor;
			}
			if (type == 573 || type == 578 || type == 579 || type == 617 || type == 641 || type == 707 || type == 813)
			{
				return new Color(255 - alpha, 255 - alpha, 255 - alpha, 255 - alpha);
			}
			if (type == 490)
			{
				return Color.White;
			}
			if (type == 575 || type == 596 || type == 659)
			{
				if (timeLeft < 30)
				{
					float num4 = (float)timeLeft / 30f;
					alpha = (int)(255f - 255f * num4);
				}
				return new Color(255 - alpha, 255 - alpha, 255 - alpha, 128 - alpha / 2);
			}
			if (type == 546)
			{
				return new Color(255, 200, 255, 200);
			}
			if (type == 553)
			{
				return new Color(255, 255, 200, 200);
			}
			if (type == 540)
			{
				return new Color(255 - alpha, 255 - alpha, 255 - alpha, 0);
			}
			if (type == 498)
			{
				return new Color(255, 100, 20, 200);
			}
			if (type == 538)
			{
				return new Color(255 - alpha, 255 - alpha, 255 - alpha, 255 - alpha);
			}
			if (type == 518)
			{
				float num5 = 1f - (float)alpha / 255f;
				return new Color((int)(200f * num5), (int)(200f * num5), (int)(200f * num5), (int)(100f * num5));
			}
			if (type == 518 || type == 595 || type == 735)
			{
				Color color2 = Color.Lerp(newColor, Color.White, 0.85f);
				color2.A = 128;
				return color2 * (1f - (float)alpha / 255f);
			}
			if (type == 536 || type == 607)
			{
				return new Color(255 - alpha, 255 - alpha, 255 - alpha, 63 - alpha / 4);
			}
			if (type == 591)
			{
				return new Color(255 - alpha, 255 - alpha, 255 - alpha, 63 - alpha / 4);
			}
			if (type == 493 || type == 494)
			{
				return new Color(255 - alpha, 255 - alpha, 255 - alpha, 255 - alpha);
			}
			if (type == 492)
			{
				return new Color(255, 255, 255, 255);
			}
			if (type == 491)
			{
				return new Color(255, 255, 255, 255);
			}
			if (type == 485 || type == 502)
			{
				return new Color(255, 255, 255, 200);
			}
			if (type == 488 || type == 1047)
			{
				return new Color(255, 255, 255, 255);
			}
			if (type == 477 || type == 478 || type == 479)
			{
				if (alpha == 0)
				{
					return new Color(255, 255, 255, 200);
				}
				return new Color(0, 0, 0, 0);
			}
			if (type == 473)
			{
				return new Color(255, 255, 255, 255);
			}
			if (type == 50 || type == 53 || type == 515 || type == 870)
			{
				return new Color(255, 255, 255, 0);
			}
			if (type == 1089)
			{
				return new Color(Main.DiscoR, Main.DiscoG, Main.DiscoB, 70);
			}
			if (type == 1024)
			{
				return new Color(255, 255, 255) * Opacity;
			}
			if (type == 723 || type == 724 || type == 725 || type == 726 || type == 728 || type == 9)
			{
				return new Color(255, 255, 255, 0) * Opacity;
			}
			if (type == 92)
			{
				return new Color(255, 255, 255, 0);
			}
			if (type == 91)
			{
				return new Color(200, 200, 200, 0);
			}
			if (type == 34 || type == 15 || type == 93 || type == 94 || type == 95 || type == 96 || type == 253 || type == 258 || (type == 102 && alpha < 255))
			{
				return new Color(200, 200, 200, 25);
			}
			if (type == 465)
			{
				return new Color(255, 255, 255, 0) * (1f - (float)alpha / 255f);
			}
			if (type == 503)
			{
				Color value2 = Color.Lerp(newColor, Color.White, 0.5f) * (1f - (float)alpha / 255f);
				Color value3 = Color.Lerp(Color.Purple, Color.White, 0.33f);
				float amount2 = 0.25f + (float)Math.Cos(localAI[0]) * 0.25f;
				return Color.Lerp(value2, value3, amount2);
			}
			if (type == 467)
			{
				return new Color(255, 255, 255, 255) * (1f - (float)alpha / 255f);
			}
			if (type == 694 || type == 695 || type == 696)
			{
				return new Color(255, 255, 255, 127) * (1f - (float)alpha / 255f);
			}
			if (type == 634 || type == 635)
			{
				return new Color(255, 255, 255, 127) * Opacity;
			}
			if (type == 671)
			{
				return new Color(255, 255, 255, 255) * Opacity;
			}
			if (type == 664 || type == 666 || type == 668)
			{
				newColor = Color.Lerp(newColor, Color.White, 0.5f);
				return new Color(newColor.R, newColor.G, newColor.B, 200) * Opacity;
			}
			if (type == 451)
			{
				return new Color(255, 255, 255, 200) * ((255f - (float)alpha) / 255f);
			}
			if (type == 684)
			{
				return new Color(255, 255, 255, 200) * ((255f - (float)alpha) / 255f);
			}
			if (type == 454 || type == 452)
			{
				return new Color(255, 255, 255, 255) * (1f - (float)alpha / 255f);
			}
			if (type == 464)
			{
				return new Color(255, 255, 255, 255) * ((255f - (float)alpha) / 255f);
			}
			if (type == 450)
			{
				return new Color(200, 200, 200, 255 - alpha);
			}
			if (type == 459 || type == 709)
			{
				return new Color(255, 255, 255, 200);
			}
			if (type == 447)
			{
				return new Color(255, 255, 255, 200);
			}
			if (type == 446)
			{
				return Color.Lerp(newColor, Color.White, 0.8f) * (1f - (float)alpha / 255f);
			}
			if (type == 691 || type == 692 || type == 693)
			{
				return Color.Lerp(newColor, Color.White, 0.4f) * (1f - (float)alpha / 255f);
			}
			if (type >= 646 && type <= 649)
			{
				return Color.Lerp(newColor, Color.White, 0.8f) * (1f - (float)alpha / 255f);
			}
			if (type == 445)
			{
				return new Color(255, 255, 255, 128) * (1f - (float)alpha / 255f);
			}
			if (type == 440 || type == 449 || type == 606)
			{
				r = 255 - alpha;
				g = 255 - alpha;
				b = 255 - alpha;
			}
			else
			{
				if (type == 444)
				{
					return newColor * (1f - (float)alpha / 255f);
				}
				if (type == 443 || type == 675 || type == 686 || type == 711 || type == 1097 || type == 1110)
				{
					return new Color(255, 255, 255, 128) * (1f - (float)alpha / 255f);
				}
				if (type == 676)
				{
					return newColor * Opacity;
				}
				if (type == 438)
				{
					return new Color(255, 255, 255, 128) * (1f - (float)alpha / 255f);
				}
				if (type == 592)
				{
					return new Color(255, 255, 255, 128) * (1f - (float)alpha / 255f);
				}
				if (type == 437 || type == 700)
				{
					return new Color(255, 255, 255, 0) * (1f - (float)alpha / 255f);
				}
				if (type == 964 || type == 965)
				{
					return new Color(255, 255, 255, 255) * Opacity;
				}
				if (type == 462)
				{
					return new Color(255, 255, 255, 128) * (1f - (float)alpha / 255f);
				}
				if (type == 352)
				{
					Color color3 = Color.Lerp(newColor, Color.White, 0.5f);
					color3.A = (byte)((float)(int)color3.A * ((float)alpha / 255f));
					return new Color(color3.R, color3.G, color3.B, color3.A);
				}
				if (type == 435 || type == 732 || type == 731)
				{
					newColor = Color.Lerp(newColor, Color.White, 0.8f);
					return new Color(newColor.R, newColor.G, newColor.B, 25);
				}
				if (type == 682)
				{
					newColor = Color.Lerp(newColor, Color.White, 0.8f);
					return new Color(newColor.R, newColor.G, newColor.B, 127);
				}
				if (type == 436)
				{
					newColor = Color.Lerp(newColor, Color.White, 0.8f);
					return new Color(newColor.R, newColor.G, newColor.B, 25);
				}
				if (type == 409)
				{
					return new Color(250, 250, 250, 200);
				}
				if (type == 348 || type == 349)
				{
					return new Color(200, 200, 200, alpha);
				}
				if (type == 337)
				{
					return new Color(250, 250, 250, 150);
				}
				if (type >= 424 && type <= 426)
				{
					byte b2 = 150;
					if (newColor.R < b2)
					{
						newColor.R = b2;
					}
					if (newColor.G < b2)
					{
						newColor.G = b2;
					}
					if (newColor.B < b2)
					{
						newColor.B = b2;
					}
					return new Color(newColor.R, newColor.G, newColor.B, 255);
				}
				if (type == 431 || type == 432)
				{
					return new Color(250, 250, 250, 255 - alpha);
				}
				if (type == 343 || type == 344)
				{
					float num6 = 1f - (float)alpha / 255f;
					return new Color((int)(250f * num6), (int)(250f * num6), (int)(250f * num6), (int)(100f * num6));
				}
				if (type == 332)
				{
					return new Color(255, 255, 255, 255);
				}
				if (type == 329)
				{
					return new Color(200, 200, 200, 50);
				}
				if (type >= 326 && type <= 328)
				{
					return Color.Transparent;
				}
				if ((type >= 400 && type <= 402) || (type >= 1107 && type <= 1109))
				{
					return Color.Transparent;
				}
				if (type == 324 && frame >= 6 && frame <= 9)
				{
					return new Color(255, 255, 255, 255);
				}
				if (type == 16)
				{
					return new Color(255, 255, 255, 0);
				}
				if (type == 321)
				{
					return new Color(200, 200, 200, 0);
				}
				if (type == 76 || type == 77 || type == 78)
				{
					return new Color(255, 255, 255, 0);
				}
				if (type == 308)
				{
					return new Color(200, 200, 255, 125);
				}
				if (type == 263)
				{
					if (timeLeft < 255)
					{
						return new Color(255, 255, 255, (byte)timeLeft);
					}
					return new Color(255, 255, 255, 255);
				}
				if (type == 274)
				{
					if (timeLeft < 85)
					{
						byte b3 = (byte)(timeLeft * 3);
						byte a3 = (byte)(100f * ((float)(int)b3 / 255f));
						return new Color(b3, b3, b3, a3);
					}
					return new Color(255, 255, 255, 100);
				}
				if (type == 5)
				{
					return new Color(255, 255, 255, 0);
				}
				if (type == 300)
				{
					return new Color(250, 250, 250, 50);
				}
				if (type == 301)
				{
					if (ai[0] == 1f)
					{
						return newColor;
					}
					return new Color(250, 250, 250, 50);
				}
				if (type == 712)
				{
					return Color.Lerp(newColor, Color.White, 0.4f) * Opacity;
				}
				if (type == 304)
				{
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, (byte)((float)(255 - alpha) / 3f));
				}
				if (type == 116 || type == 132 || type == 156 || type == 157 || type == 157 || type == 173)
				{
					if (localAI[1] >= 15f)
					{
						return new Color(255, 255, 255, alpha);
					}
					if (localAI[1] < 5f)
					{
						return Color.Transparent;
					}
					int num7 = (int)((localAI[1] - 5f) / 10f * 255f);
					return new Color(num7, num7, num7, num7);
				}
				if (type == 254)
				{
					if (timeLeft < 30)
					{
						float num8 = (float)timeLeft / 30f;
						alpha = (int)(255f - 255f * num8);
					}
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 0);
				}
				if (type == 265 || type == 355)
				{
					if (alpha > 0)
					{
						return Color.Transparent;
					}
					return new Color(255, 255, 255, 0);
				}
				if (type == 257)
				{
					if (alpha > 200)
					{
						return Color.Transparent;
					}
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 0);
				}
				if (type == 259)
				{
					if (alpha > 200)
					{
						return Color.Transparent;
					}
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 0);
				}
				if (type >= 150 && type <= 152)
				{
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 255 - alpha);
				}
				if (type == 250)
				{
					return Color.Transparent;
				}
				if (type == 251)
				{
					r = 255 - alpha;
					g = 255 - alpha;
					b = 255 - alpha;
					return new Color(r, g, b, 0);
				}
				if (type == 131)
				{
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 0);
				}
				if (type == 211)
				{
					return new Color(255, 255, 255, 0);
				}
				if (type == 229)
				{
					return new Color(255, 255, 255, 50);
				}
				if (type == 221 || type == 729 || type == 977)
				{
					return new Color(255, 255, 255, 200);
				}
				if (type == 1045)
				{
					return new Color(255, 255, 255, 200) * Opacity;
				}
				if (type == 20)
				{
					if (alpha <= 150)
					{
						return new Color(255, 255, 255, 0);
					}
					return new Color(0, 0, 0, 0);
				}
				if (type == 207)
				{
					r = 255 - alpha;
					g = 255 - alpha;
					b = 255 - alpha;
				}
				else
				{
					if (type == 242)
					{
						if (alpha < 140)
						{
							return new Color(255, 255, 255, 100);
						}
						return Color.Transparent;
					}
					if (type == 638)
					{
						return new Color(255, 255, 255, 100) * Opacity;
					}
					if (type == 660)
					{
						return new Color(150, 255, 255, 0) * Opacity;
					}
					if (type == 209)
					{
						r = newColor.R - alpha;
						g = newColor.G - alpha;
						b = newColor.B - alpha / 2;
					}
					else
					{
						if (type == 130)
						{
							return new Color(255, 255, 255, 175);
						}
						if (type == 182)
						{
							return new Color(255, 255, 255, 200);
						}
						if (type == 226)
						{
							r = 255;
							g = 255;
							b = 255;
							float num9 = (float)(int)Main.mouseTextColor / 200f - 0.3f;
							r = (int)((float)r * num9);
							g = (int)((float)g * num9);
							b = (int)((float)b * num9);
							r += 50;
							if (r > 255)
							{
								r = 255;
							}
							g += 50;
							if (g > 255)
							{
								g = 255;
							}
							b += 50;
							if (b > 255)
							{
								b = 255;
							}
							return new Color(r, g, b, 200);
						}
						if (type == 227)
						{
							r = (g = (b = 255));
							float num10 = (float)(int)Main.mouseTextColor / 100f - 1.6f;
							r = (int)((float)r * num10);
							g = (int)((float)g * num10);
							b = (int)((float)b * num10);
							int a4 = (int)(100f * num10);
							r += 50;
							if (r > 255)
							{
								r = 255;
							}
							g += 50;
							if (g > 255)
							{
								g = 255;
							}
							b += 50;
							if (b > 255)
							{
								b = 255;
							}
							return new Color(r, g, b, a4);
						}
						if (type == 114 || type == 115)
						{
							if (localAI[1] >= 15f)
							{
								return new Color(255, 255, 255, alpha);
							}
							if (localAI[1] < 5f)
							{
								return Color.Transparent;
							}
							int num11 = (int)((localAI[1] - 5f) / 10f * 255f);
							return new Color(num11, num11, num11, num11);
						}
						if (type == 83 || type == 88 || type == 89 || type == 90 || type == 100 || type == 104 || type == 279 || (type >= 283 && type <= 287) || type == 876)
						{
							if (alpha < 200)
							{
								return new Color(255 - alpha, 255 - alpha, 255 - alpha, 0);
							}
							return Color.Transparent;
						}
						if (type == 34 || type == 35 || type == 15 || type == 19 || type == 44 || type == 45)
						{
							return Color.White;
						}
						if (type == 79)
						{
							r = Main.DiscoR;
							g = Main.DiscoG;
							b = Main.DiscoB;
							return default(Color);
						}
						if (type == 9 || type == 15 || type == 34 || type == 50 || type == 53 || type == 76 || type == 77 || type == 78 || type == 92 || type == 91)
						{
							r = newColor.R - alpha / 3;
							g = newColor.G - alpha / 3;
							b = newColor.B - alpha / 3;
						}
						else
						{
							if (type == 18)
							{
								return new Color(255, 255, 255, 130);
							}
							if (type == 16 || type == 44 || type == 45)
							{
								r = newColor.R;
								g = newColor.G;
								b = newColor.B;
							}
							else if (type == 12 || type == 72 || type == 86 || type == 87 || type == 955)
							{
								return new Color(255, 255, 255, newColor.A - alpha);
							}
						}
					}
				}
			}
		}
		if (aiStyle == 99 && Main.player[owner].stringColor == 29 && alpha == 0)
		{
			return Color.White;
		}
		float num12 = (float)(255 - alpha) / 255f;
		r = (int)((float)(int)newColor.R * num12);
		g = (int)((float)(int)newColor.G * num12);
		b = (int)((float)(int)newColor.B * num12);
		int num13 = newColor.A - alpha;
		if (num13 < 0)
		{
			num13 = 0;
		}
		if (num13 > 255)
		{
			num13 = 255;
		}
		return new Color(r, g, b, num13);
	}

	public override string ToString()
	{
		return "type:" + type + ", name:" + Name + ", active:" + active.ToString() + ", whoAmI:" + whoAmI + ", identity:" + identity + ", ai0:" + ai[0] + ", uuid:" + projUUID;
	}
}
