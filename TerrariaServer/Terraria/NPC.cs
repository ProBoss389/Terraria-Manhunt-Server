using System;
using System.Collections.Generic;
using Microsoft.Xna.Framework;
using Microsoft.Xna.Framework.Graphics;
using ReLogic.Content;
using ReLogic.Utilities;
using Terraria.Audio;
using Terraria.Chat;
using Terraria.DataStructures;
using Terraria.Enums;
using Terraria.GameContent;
using Terraria.GameContent.Achievements;
using Terraria.GameContent.Creative;
using Terraria.GameContent.Drawing;
using Terraria.GameContent.Events;
using Terraria.GameContent.Generation.Dungeon;
using Terraria.GameContent.ItemDropRules;
using Terraria.GameContent.Tile_Entities;
using Terraria.GameContent.UI;
using Terraria.Graphics.CameraModifiers;
using Terraria.Graphics.Effects;
using Terraria.ID;
using Terraria.Localization;
using Terraria.Testing;
using Terraria.Utilities;
using Terraria.WorldBuilding;

namespace Terraria;

public class NPC : Entity
{
	internal struct PlayerNetSyncState
	{
		public byte skippedSyncs;

		public byte streamCounter;
	}

	public class Spawner
	{
		public static int spawnSpaceX = 2;

		public static int spawnSpaceY = 3;

		public static bool fairyLog = false;

		public int numberOfActivePlayers;

		public bool reachedInvasionBossCap;

		public int pX;

		public int pY;

		public float luck;

		public bool dayTime;

		public bool raining;

		public int townNPCs;

		public bool skyMob;

		public bool noWorms;

		public bool noGroundWorms;

		public bool invaders;

		public bool spawnFriendly;

		public bool ignoreSafeWalls;

		public bool waterTile;

		public bool nearGranite;

		public bool nearMarble;

		public bool spawnSpider;

		public bool surfaceSpawn;

		public bool spawnUndergroundDesert;

		public bool hardDungeon;

		public bool deeperThanRockLayer;

		public bool underGround;

		public bool isOcean;

		public bool isBeach;

		public bool isSpawningInWindDirection;

		public bool skyBehindPlayer;

		public bool livingTree;

		public bool dualDungeonsSpawnRules;

		public bool inDualDungeon;

		public bool tresspassingDualDungeon;

		public bool inRemixStartingArea;

		public bool offensiveToTim;

		public bool playerHasStartingHealth;

		public bool ZoneCorrupt;

		public bool ZoneCrimson;

		public bool ZoneHallow;

		public bool ZoneJungle;

		public bool ZoneSnow;

		public bool ZoneGlowshroom;

		public bool ZoneMeteor;

		public bool ZoneGraveyard;

		public bool ZoneDungeon;

		public bool ZoneLihzhardTemple;

		public bool ZoneGranite;

		public bool ZoneMarble;

		public bool ZoneSandstorm;

		public bool ZoneTowerSolar;

		public bool ZoneTowerVortex;

		public bool ZoneTowerNebula;

		public bool ZoneTowerStardust;

		public bool ZoneOldOneArmy;

		public bool ZoneWaterCandle;

		public bool ZonePeaceCandle;

		public bool ZoneShadowCandle;

		public int defaultTarget = 255;

		public Spawner()
		{
			numberOfActivePlayers = Main.CurrentFrameFlags.ActivePlayersCount;
			float num = 0f;
			for (int i = 0; i < Main.maxNPCs; i++)
			{
				if (Main.npc[i].active)
				{
					switch (Main.npc[i].type)
					{
					case 315:
					case 325:
					case 327:
					case 328:
					case 344:
					case 345:
					case 346:
						num += Main.npc[i].npcSlots;
						break;
					}
				}
			}
			int num2 = (int)((float)defaultMaxSpawns * (2f + 0.3f * (float)numberOfActivePlayers));
			reachedInvasionBossCap = num >= (float)(numberOfActivePlayers * num2);
		}

		public void SpawnNPC()
		{
			for (int i = 0; i < 255; i++)
			{
                // Manhunt Disable Spawns
                int cIdx = Main.player[i].FindBuffIndex(23);
                int wIdx = Main.player[i].FindBuffIndex(149);

                bool blockCursed = cIdx != -1 && Main.player[i].buffTime[cIdx] <= 12;

                bool blockWebbed = (wIdx != -1);

                if (blockCursed && blockWebbed)
{
                continue;
            }
            // Regular Code
            Player player = Main.player[i];
				if (CanSpawnEnemiesNear(player))
				{
					if (Main.slimeRain)
					{
						SlimeRainSpawns(player);
					}
					if (TrySpawnAnNPC(player))
					{
						break;
					}
				}
			}
		}

		private bool TrySpawnAnNPC(Player player)
		{
			SetSpawnFlags(player);
			GetSpawnRate(player, out var spawnRate, out var maxSpawns);
			if (player.nearbyActiveNPCs >= (float)maxSpawns)
			{
				return false;
			}
			if (Main.rand.Next(spawnRate) != 0)
			{
				return false;
			}
			if (!FindSpawnTile(player, out var spawnTileX, out var spawnTileY, out var xRange))
			{
				return false;
			}
			if (!CheckNotSpawningOnScreen(spawnTileX, spawnTileY))
			{
				return false;
			}
			int spawnTileType = 0;
			int spawnWallType = 0;
			GetProperGroundSpawnTileTypeAndWallType(spawnTileX, spawnTileY, out spawnTileType, out spawnWallType);
			if (!PostCheckChosenSpawnTile(spawnTileX, spawnTileY, spawnTileType, spawnWallType))
			{
				return false;
			}
			SetSpawnFlagsForChosenTile(spawnTileX, spawnTileY, spawnTileType, spawnWallType);
			if (dualDungeonsSpawnRules && ZoneDungeon)
			{
				if (!player.ZoneDungeon)
				{
					ZoneDungeon = false;
				}
				else
				{
					Tile tile = Main.tile[pX, pY];
					if (tile == null || !Main.wallDungeon[tile.wall])
					{
						ZoneDungeon = false;
					}
				}
			}
			SpawnAnNPC(spawnTileX, spawnTileY, spawnTileType, xRange, player.whoAmI);
			if (Main.netMode == 2)
			{
				SyncNewlySpawnedNPCs();
			}
			return true;
		}

		public static bool CanSpawnEnemiesNear(Player player)
		{
			if (!player.active || player.dead)
			{
				return false;
			}
			if (Main.IsJourneyMode)
			{
				CreativePowers.SpawnRateSliderPerPlayerPower power = CreativePowerManager.Instance.GetPower<CreativePowers.SpawnRateSliderPerPlayerPower>();
				if (power != null && power.GetIsUnlocked() && power.GetShouldDisableSpawnsFor(player.whoAmI))
				{
					return false;
				}
			}
			if (player.isNearNPC(398, MoonLordFightingDistance))
			{
				return false;
			}
			return true;
		}

		private void SetSpawnFlags(Player player)
		{
			pX = (int)player.Center.X / 16;
			pY = (int)player.Center.Y / 16;
			luck = player.luck;
			dayTime = Main.dayTime;
			raining = Main.raining;
			skyMob = false;
			spawnFriendly = false;
			ignoreSafeWalls = false;
			waterTile = false;
			nearGranite = false;
			nearMarble = false;
			spawnSpider = false;
			spawnUndergroundDesert = false;
			hardDungeon = downedPlantBoss && Main.hardMode;
			ZoneCorrupt = player.ZoneCorrupt;
			ZoneCrimson = player.ZoneCrimson;
			ZoneHallow = player.ZoneHallow;
			ZoneJungle = player.ZoneJungle;
			ZoneSnow = player.ZoneSnow;
			ZoneGlowshroom = player.ZoneGlowshroom;
			ZoneMeteor = player.ZoneMeteor;
			ZoneGraveyard = player.ZoneGraveyard;
			ZoneDungeon = player.ZoneDungeon;
			ZoneLihzhardTemple = player.ZoneLihzhardTemple;
			ZoneSandstorm = player.ZoneSandstorm;
			ZoneTowerSolar = player.ZoneTowerSolar;
			ZoneTowerVortex = player.ZoneTowerVortex;
			ZoneTowerNebula = player.ZoneTowerNebula;
			ZoneTowerStardust = player.ZoneTowerStardust;
			ZoneOldOneArmy = player.ZoneOldOneArmy;
			ZoneWaterCandle = player.ZoneWaterCandle;
			ZonePeaceCandle = player.ZonePeaceCandle;
			ZoneShadowCandle = player.ZoneShadowCandle;
			dualDungeonsSpawnRules = Main.dualDungeonsSeed;
			inDualDungeon = dualDungeonsSpawnRules && player.insideUnbreakableWalls;
			tresspassingDualDungeon = inDualDungeon && DangerousDungeonCurse.GetProgressPlayerCanSafelyMatch() < DangerousDungeonCurse.GetProgressPlayerNeedsToMatch(player);
			invaders = ShouldSpawnInvasionEnemies(player.position);
			if (ZoneTowerSolar || ZoneTowerNebula || ZoneTowerVortex || ZoneTowerStardust)
			{
				invaders = true;
				ignoreSafeWalls = true;
			}
			townNPCs = player.townNPCs;
			noWorms = WorldGen.InWorld(pX, pY) && Main.wallHouse[Main.tile[pX, pY].wall];
			noGroundWorms = player.afkCounter >= Player.AFKTimeNeededForNoWormSpawns;
			skyBehindPlayer = Main.wallLight[Main.tile[pX, pY].wall] || Main.tile[pX, pY].wall == 73;
			livingTree = Main.tile[pX, pY].wall == 244;
			inRemixStartingArea = Main.remixWorld && (double)(player.Center.X / 16f) > (double)Main.maxTilesX * 0.39 + 50.0 && (double)(player.Center.X / 16f) < (double)Main.maxTilesX * 0.61;
			offensiveToTim = (player.armor[1].type == 4256 || (player.armor[1].type >= 1282 && player.armor[1].type <= 1287)) && player.armor[0].type != 238;
			playerHasStartingHealth = player.statLifeMax <= 100;
			if (ZoneShadowCandle)
			{
				noWorms = false;
				noGroundWorms = false;
				townNPCs = 0;
			}
		}

		private void SetSpawnFlagsForChosenTile_ForDualDungeon(int spawnTileX, int spawnTileY, int spawnTileType, int spawnWallType)
		{
			bool npcSpawnPointIsInDualDungeon = true;
			NPCSpawningFlagsForDualDungeons nPCSpawningFlagsForDualDungeons = default(NPCSpawningFlagsForDualDungeons);
			nPCSpawningFlagsForDualDungeons.ScanZonesFor(scanOnly: false, spawnTileX, spawnTileY, spawnTileType, spawnWallType, npcSpawnPointIsInDualDungeon);
			ZoneDungeon = nPCSpawningFlagsForDualDungeons.ZoneDungeon;
			ZoneSnow = nPCSpawningFlagsForDualDungeons.ZoneSnow;
			ZoneGlowshroom = nPCSpawningFlagsForDualDungeons.ZoneGlowshroom;
			ZoneCorrupt = nPCSpawningFlagsForDualDungeons.ZoneCorrupt;
			ZoneCrimson = nPCSpawningFlagsForDualDungeons.ZoneCrimson;
			ZoneJungle = nPCSpawningFlagsForDualDungeons.ZoneJungle;
			ZoneHallow = nPCSpawningFlagsForDualDungeons.ZoneHallow;
			ZoneLihzhardTemple = nPCSpawningFlagsForDualDungeons.ZoneLihzhardTemple;
			spawnUndergroundDesert = nPCSpawningFlagsForDualDungeons.ZoneUndergroundDesert;
		}

		public static bool ShouldSpawnInvasionEnemies(Vector2 position)
		{
			if (Main.invasionType <= 0 || Main.invasionDelay != 0 || Main.invasionSize <= 0)
			{
				return false;
			}
			if ((double)position.Y < Main.worldSurface * 16.0 + (double)sHeight || (double)Main.spawnTileY > Main.worldSurface)
			{
				int num = 3000;
				if ((double)position.X > Main.invasionX * 16.0 - (double)num && (double)position.X < Main.invasionX * 16.0 + (double)num)
				{
					return true;
				}
				if (Main.invasionX >= (double)(Main.maxTilesX / 2 - 5) && Main.invasionX <= (double)(Main.maxTilesX / 2 + 5))
				{
					for (int i = 0; i < Main.maxNPCs; i++)
					{
						if (Main.npc[i].townNPC && Math.Abs(position.X - Main.npc[i].Center.X) < (float)num)
						{
							if (Main.rand.Next(3) == 0)
							{
								break;
							}
							return true;
						}
					}
				}
			}
			return false;
		}

		private void GetSpawnRate(Player player, out int spawnRate, out int maxSpawns)
		{
			spawnRate = defaultSpawnRate;
			maxSpawns = defaultMaxSpawns;
			if (Main.hardMode)
			{
				spawnRate = (int)((double)defaultSpawnRate * 0.9);
				maxSpawns = defaultMaxSpawns + 1;
			}
			if (player.position.Y > (float)(Main.UnderworldLayer * 16))
			{
				maxSpawns = (int)((float)maxSpawns * 2f);
			}
			else if ((double)player.position.Y > Main.rockLayer * 16.0 + (double)sHeight)
			{
				if (Main.remixWorld)
				{
					if (Main.hardMode)
					{
						spawnRate = (int)((double)spawnRate * 0.45);
						maxSpawns = (int)((float)maxSpawns * 1.8f);
					}
					else
					{
						spawnRate = (int)((double)spawnRate * 0.5);
						maxSpawns = (int)((float)maxSpawns * 1.7f);
					}
				}
				else
				{
					spawnRate = (int)((double)spawnRate * 0.4);
					maxSpawns = (int)((float)maxSpawns * 1.9f);
				}
			}
			else if ((double)player.position.Y > Main.worldSurface * 16.0 + (double)sHeight)
			{
				if (Main.remixWorld)
				{
					spawnRate = (int)((double)spawnRate * 0.4);
					maxSpawns = (int)((float)maxSpawns * 1.9f);
				}
				else if (Main.hardMode)
				{
					spawnRate = (int)((double)spawnRate * 0.45);
					maxSpawns = (int)((float)maxSpawns * 1.8f);
				}
				else
				{
					spawnRate = (int)((double)spawnRate * 0.5);
					maxSpawns = (int)((float)maxSpawns * 1.7f);
				}
			}
			else if (Main.remixWorld)
			{
				if (!Main.dayTime)
				{
					spawnRate = (int)((double)spawnRate * 0.6);
					maxSpawns = (int)((float)maxSpawns * 1.3f);
				}
			}
			else if (!Main.dayTime)
			{
				spawnRate = (int)((double)spawnRate * 0.6);
				maxSpawns = (int)((float)maxSpawns * 1.3f);
				if (Main.bloodMoon)
				{
					spawnRate = (int)((double)spawnRate * 0.3);
					maxSpawns = (int)((float)maxSpawns * 1.8f);
				}
				if ((Main.pumpkinMoon || Main.snowMoon) && (double)player.position.Y < Main.worldSurface * 16.0)
				{
					spawnRate = (int)((double)spawnRate * 0.2);
					maxSpawns *= 2;
				}
			}
			else if (Main.dayTime && Main.eclipse)
			{
				spawnRate = (int)((double)spawnRate * 0.2);
				maxSpawns = (int)((float)maxSpawns * 1.9f);
			}
			if (Main.remixWorld)
			{
				if (!Main.dayTime)
				{
					if (Main.bloodMoon)
					{
						spawnRate = (int)((double)spawnRate * 0.3);
						maxSpawns = (int)((float)maxSpawns * 1.8f);
						if ((double)player.position.Y > Main.rockLayer * 16.0 + (double)sHeight)
						{
							spawnRate = (int)((double)spawnRate * 0.6);
						}
					}
					if (Main.pumpkinMoon || Main.snowMoon)
					{
						spawnRate = (int)((double)spawnRate * 0.2);
						maxSpawns *= 2;
						if ((double)player.position.Y > Main.rockLayer * 16.0 + (double)sHeight)
						{
							spawnRate = (int)((double)spawnRate * 0.6);
						}
					}
				}
				else if (Main.dayTime && Main.eclipse)
				{
					spawnRate = (int)((double)spawnRate * 0.2);
					maxSpawns = (int)((float)maxSpawns * 1.9f);
				}
			}
			if (ZoneSnow && (double)(player.position.Y / 16f) < Main.worldSurface)
			{
				maxSpawns = (int)((float)maxSpawns + (float)maxSpawns * Main.cloudAlpha);
				spawnRate = (int)((float)spawnRate * (1f - Main.cloudAlpha + 1f) / 2f);
			}
			if (Main.drunkWorld && Main.tile[pX, pY].wall == 86)
			{
				spawnRate = (int)((double)spawnRate * 0.3);
				maxSpawns = (int)((float)maxSpawns * 1.8f);
			}
			if (inDualDungeon || ZoneDungeon)
			{
				spawnRate = (int)((double)spawnRate * 0.3);
				maxSpawns = (int)((float)maxSpawns * 1.8f);
			}
			else if (ZoneSandstorm)
			{
				spawnRate = (int)((float)spawnRate * (Main.hardMode ? 0.4f : 0.9f));
				maxSpawns = (int)((float)maxSpawns * (Main.hardMode ? 1.5f : 1.2f));
			}
			else if (player.ZoneUndergroundDesert)
			{
				spawnRate = (int)((float)spawnRate * 0.2f);
				maxSpawns = (int)((float)maxSpawns * 3f);
			}
			else if (ZoneJungle)
			{
				if (townNPCs == 0)
				{
					spawnRate = (int)((double)spawnRate * 0.4);
					maxSpawns = (int)((float)maxSpawns * 1.5f);
				}
				else if (townNPCs == 1)
				{
					spawnRate = (int)((double)spawnRate * 0.55);
					maxSpawns = (int)((double)maxSpawns * 1.4);
				}
				else if (townNPCs == 2)
				{
					spawnRate = (int)((double)spawnRate * 0.7);
					maxSpawns = (int)((float)maxSpawns * 1.3f);
				}
				else
				{
					spawnRate = (int)((double)spawnRate * 0.85);
					maxSpawns = (int)((float)maxSpawns * 1.2f);
				}
			}
			else if (ZoneCorrupt || ZoneCrimson)
			{
				spawnRate = (int)((double)spawnRate * 0.65);
				maxSpawns = (int)((float)maxSpawns * 1.3f);
			}
			else if (ZoneMeteor)
			{
				spawnRate = (int)((double)spawnRate * 0.4);
				maxSpawns = (int)((float)maxSpawns * 1.1f);
			}
			if (ZoneLihzhardTemple)
			{
				spawnRate = (int)((float)spawnRate * 0.8f);
				maxSpawns = (int)((float)maxSpawns * 1.2f);
				if (Main.remixWorld)
				{
					spawnRate = (int)((double)spawnRate * 0.4);
					maxSpawns = (int)((float)maxSpawns * 1.5f);
				}
			}
			if (Main.remixWorld && (ZoneCorrupt || ZoneCrimson) && (double)(player.position.Y / 16f) < Main.worldSurface)
			{
				spawnRate = (int)((double)spawnRate * 0.5);
				maxSpawns *= 2;
			}
			if (ZoneHallow && (double)player.position.Y > Main.rockLayer * 16.0 + (double)sHeight)
			{
				spawnRate = (int)((double)spawnRate * 0.65);
				maxSpawns = (int)((float)maxSpawns * 1.3f);
			}
			if (tresspassingDualDungeon)
			{
				spawnRate = (int)((float)spawnRate * 0.6f);
				maxSpawns = (int)((float)maxSpawns * 1.3f);
			}
			if (Main.wofNPCIndex >= 0 && player.position.Y > (float)(Main.UnderworldLayer * 16))
			{
				maxSpawns = (int)((float)maxSpawns * 0.3f);
				spawnRate *= 3;
			}
			if ((double)player.nearbyActiveNPCs < (double)maxSpawns * 0.2)
			{
				spawnRate = (int)((float)spawnRate * 0.6f);
			}
			else if ((double)player.nearbyActiveNPCs < (double)maxSpawns * 0.4)
			{
				spawnRate = (int)((float)spawnRate * 0.7f);
			}
			else if ((double)player.nearbyActiveNPCs < (double)maxSpawns * 0.6)
			{
				spawnRate = (int)((float)spawnRate * 0.8f);
			}
			else if ((double)player.nearbyActiveNPCs < (double)maxSpawns * 0.8)
			{
				spawnRate = (int)((float)spawnRate * 0.9f);
			}
			if ((double)(player.position.Y / 16f) > (Main.worldSurface + Main.rockLayer) / 2.0 || ZoneCorrupt || ZoneCrimson)
			{
				if ((double)player.nearbyActiveNPCs < (double)maxSpawns * 0.2)
				{
					spawnRate = (int)((float)spawnRate * 0.7f);
				}
				else if ((double)player.nearbyActiveNPCs < (double)maxSpawns * 0.4)
				{
					spawnRate = (int)((float)spawnRate * 0.9f);
				}
			}
			if (Main.remixWorld && (double)(player.position.Y / 16f) < Main.worldSurface && (ZoneCorrupt || ZoneCrimson))
			{
				spawnRate = (int)((double)spawnRate * 0.8);
				maxSpawns *= 2;
			}
			if (player.invis)
			{
				spawnRate = (int)((float)spawnRate * 1.2f);
				maxSpawns = (int)((float)maxSpawns * 0.8f);
			}
			if (player.calmed)
			{
				spawnRate = (int)((float)spawnRate * 1.65f);
				maxSpawns = (int)((float)maxSpawns * 0.6f);
			}
			if (player.sunflower)
			{
				spawnRate = (int)((float)spawnRate * 1.2f);
				maxSpawns = (int)((float)maxSpawns * 0.8f);
			}
			if (player.anglerSetSpawnReduction)
			{
				spawnRate = (int)((float)spawnRate * 1.3f);
				maxSpawns = (int)((float)maxSpawns * 0.7f);
			}
			if (player.enemySpawns)
			{
				spawnRate = (int)((double)spawnRate * 0.5);
				maxSpawns = (int)((float)maxSpawns * 2f);
			}
			if (ZoneWaterCandle)
			{
				if (!ZonePeaceCandle)
				{
					spawnRate = (int)((double)spawnRate * 0.75);
					maxSpawns = (int)((float)maxSpawns * 1.5f);
				}
			}
			else if (ZonePeaceCandle)
			{
				spawnRate = (int)((double)spawnRate * 1.3);
				maxSpawns = (int)((float)maxSpawns * 0.7f);
			}
			if (ZoneWaterCandle && (double)(player.position.Y / 16f) < Main.worldSurface * 0.3499999940395355)
			{
				spawnRate = (int)((double)spawnRate * 0.5);
			}
			if (player.isNearFairy())
			{
				spawnRate = (int)((float)spawnRate * 1.2f);
				maxSpawns = (int)((float)maxSpawns * 0.8f);
			}
			if ((double)spawnRate < (double)defaultSpawnRate * 0.1)
			{
				spawnRate = (int)((double)defaultSpawnRate * 0.1);
			}
			if (maxSpawns > defaultMaxSpawns * 3)
			{
				maxSpawns = defaultMaxSpawns * 3;
			}
			if (Main.getGoodWorld)
			{
				spawnRate = (int)((float)spawnRate * 0.8f);
				maxSpawns = (int)((float)maxSpawns * 1.2f);
			}
			if (Main.IsJourneyMode)
			{
				CreativePowers.SpawnRateSliderPerPlayerPower power = CreativePowerManager.Instance.GetPower<CreativePowers.SpawnRateSliderPerPlayerPower>();
				if (power != null && power.GetIsUnlocked() && power.GetRemappedSliderValueFor(player.whoAmI, out var value))
				{
					spawnRate = (int)((float)spawnRate / value);
					maxSpawns = (int)((float)maxSpawns * value);
				}
			}
			if ((Main.pumpkinMoon || Main.snowMoon) && (Main.remixWorld || (double)player.position.Y < Main.worldSurface * 16.0))
			{
				maxSpawns = (int)((double)defaultMaxSpawns * (2.0 + 0.3 * (double)numberOfActivePlayers));
				spawnRate = 20;
			}
			if (DD2Event.Ongoing && ZoneOldOneArmy)
			{
				maxSpawns = defaultMaxSpawns;
				spawnRate = defaultSpawnRate;
			}
			if (invaders)
			{
				maxSpawns = (int)((double)defaultMaxSpawns * (2.0 + 0.3 * (double)numberOfActivePlayers));
				spawnRate = 20;
			}
			if (ZoneDungeon && !downedBoss3)
			{
				spawnRate = 10;
			}
			if (WorldGen.Skyblock.lowTiles)
			{
				spawnRate /= 2;
			}
			bool flag = ZoneCorrupt || ZoneCrimson;
			if (Main.infectedSeed)
			{
				flag = false;
			}
			if (!invaders && ((!Main.bloodMoon && !Main.pumpkinMoon && !Main.snowMoon) || Main.dayTime) && (!Main.eclipse || !Main.dayTime) && !flag && !ZoneCrimson && !ZoneMeteor && !ZoneOldOneArmy)
			{
				if (player.Center.Y / 16f > (float)Main.UnderworldLayer && !inRemixStartingArea)
				{
					if (townNPCs == 1)
					{
						if (!WorldGen.Skyblock.lowTiles)
						{
							if (Main.rand.Next(2) == 0)
							{
								noWorms = true;
							}
							if (Main.rand.Next(10) == 0)
							{
								spawnFriendly = true;
								maxSpawns = (int)((double)(float)maxSpawns * 0.5);
							}
							else
							{
								spawnRate = (int)((double)(float)spawnRate * 1.25);
							}
						}
					}
					else if (townNPCs == 2)
					{
						if (Main.rand.Next(4) != 0)
						{
							noWorms = true;
						}
						if (Main.rand.Next(5) == 0)
						{
							spawnFriendly = true;
							maxSpawns = (int)((double)(float)maxSpawns * 0.5);
						}
						else
						{
							spawnRate = (int)((double)(float)spawnRate * 1.5);
						}
					}
					else if (townNPCs >= 3)
					{
						if (Main.rand.Next(10) != 0)
						{
							noWorms = true;
						}
						if (Main.rand.Next(3) == 0)
						{
							spawnFriendly = true;
							maxSpawns = (int)((double)(float)maxSpawns * 0.5);
						}
						else
						{
							spawnRate = (int)((float)spawnRate * 2f);
						}
					}
				}
				else if (townNPCs == 1)
				{
					noWorms = true;
					if (!WorldGen.Skyblock.lowTiles)
					{
						if (ZoneGraveyard && (!ZonePeaceCandle || Main.rand.Next(3) == 0))
						{
							spawnRate = (int)((double)(float)spawnRate * 1.66);
							if (Main.rand.Next(9) == 1)
							{
								spawnFriendly = true;
								maxSpawns = (int)((double)(float)maxSpawns * 0.6);
							}
						}
						else if (Main.rand.Next(3) == 1)
						{
							spawnFriendly = true;
							maxSpawns = (int)((double)(float)maxSpawns * 0.6);
						}
						else
						{
							spawnRate = (int)((float)spawnRate * 2f);
						}
					}
				}
				else if (townNPCs == 2)
				{
					noWorms = true;
					if (ZoneGraveyard && (!ZonePeaceCandle || Main.rand.Next(3) == 0))
					{
						spawnRate = (int)((double)(float)spawnRate * 2.33);
						if (Main.rand.Next(6) == 1)
						{
							spawnFriendly = true;
							maxSpawns = (int)((double)(float)maxSpawns * 0.6);
						}
					}
					else if (Main.rand.Next(3) != 0)
					{
						spawnFriendly = true;
						maxSpawns = (int)((double)(float)maxSpawns * 0.6);
					}
					else
					{
						spawnRate = (int)((float)spawnRate * 3f);
					}
				}
				else if (townNPCs >= 3)
				{
					noWorms = true;
					if (ZoneGraveyard && (!ZonePeaceCandle || Main.rand.Next(3) == 0))
					{
						spawnRate = (int)((float)spawnRate * 3f);
						if (Main.rand.Next(3) == 1)
						{
							spawnFriendly = true;
							maxSpawns = (int)((double)(float)maxSpawns * 0.6);
						}
					}
					else
					{
						if (!Main.expertMode || Main.rand.Next(30) != 0)
						{
							spawnFriendly = true;
						}
						maxSpawns = (int)((double)(float)maxSpawns * 0.6);
					}
				}
			}
			if (!spawnFriendly && RollOnlyBadLuckExtreme(50) == 0)
			{
				spawnRate = (int)((float)spawnRate * 0.85f);
				maxSpawns = (int)((float)maxSpawns * 1.15f);
			}
		}

		public static void GetSpawnArea(Player player, out Rectangle spawnArea, out Rectangle safeArea)
		{
			int num = (int)((double)(sWidth / 16) * 0.7);
			int num2 = (int)((double)(sHeight / 16) * 0.7);
			safeRangeX = (int)((double)(sWidth / 16) * 0.52);
			safeRangeY = (int)((double)(sHeight / 16) * 0.52);
			if (player.inventory[player.selectedItem].type == 1254 || player.inventory[player.selectedItem].type == 1299 || player.scope)
			{
				float num3 = 1.5f;
				if (player.inventory[player.selectedItem].type == 1254 && player.scope)
				{
					num3 = 1.25f;
				}
				else if (player.inventory[player.selectedItem].type == 1254)
				{
					num3 = 1.5f;
				}
				else if (player.inventory[player.selectedItem].type == 1299)
				{
					num3 = 1.5f;
				}
				else if (player.scope)
				{
					num3 = 2f;
				}
				num += (int)((double)(sWidth / 16) * 0.5 / (double)num3);
				num2 += (int)((double)(sHeight / 16) * 0.5 / (double)num3);
				safeRangeX += (int)((double)(sWidth / 16) * 0.5 / (double)num3);
				safeRangeY += (int)((double)(sHeight / 16) * 0.5 / (double)num3);
			}
			spawnArea = WorldUtils.ClampToWorld(Utils.CenteredRectangle(player.position.ToTileCoordinates(), new Point(num * 2, num2 * 2)));
			safeArea = Utils.CenteredRectangle(player.position.ToTileCoordinates(), new Point(safeRangeX * 2, safeRangeY * 2));
			if (Main.dualDungeonsSeed && !player.ZoneOverworldHeight && !player.ZoneSkyHeight)
			{
				safeArea = Utils.CenteredRectangle(player.position.ToTileCoordinates(), new Point(safeRangeX, safeRangeY));
			}
		}

		public bool FindSpawnTile(Player player, out int spawnTileX, out int spawnTileY, out bool xRange)
		{
			GetSpawnArea(player, out var spawnArea, out var safeArea);
			for (int i = 0; i < 50; i++)
			{
				int num = Main.rand.Next(spawnArea.Left, spawnArea.Right);
				int j = Main.rand.Next(spawnArea.Top, spawnArea.Bottom);
				if ((Main.tile[num, j].nactive() && Main.tileSolid[Main.tile[num, j].type]) || (!ignoreSafeWalls && Main.wallHouse[Main.tile[num, j].wall]))
				{
					continue;
				}
				if (!invaders && (double)j < Main.worldSurface * 0.3499999940395355 && !spawnFriendly && ((double)num < (double)Main.maxTilesX * 0.45 || (double)num > (double)Main.maxTilesX * 0.55 || Main.hardMode))
				{
					skyMob = true;
				}
				else if (!invaders && (double)j < Main.worldSurface * 0.44999998807907104 && !spawnFriendly && Main.hardMode && Main.rand.Next(10) == 0)
				{
					skyMob = true;
				}
				else
				{
					for (; j < Main.maxTilesY && j < spawnArea.Bottom && (!Main.tile[num, j].nactive() || !Main.tileSolid[Main.tile[num, j].type]); j++)
					{
					}
					if (j >= spawnArea.Bottom)
					{
						continue;
					}
				}
				spawnTileX = num;
				spawnTileY = j;
				if (!safeArea.Contains(spawnTileX, spawnTileY) && HasTileSpawnSpace(spawnTileX, spawnTileY))
				{
					xRange = spawnTileX >= safeArea.Left && spawnTileX < safeArea.Right;
					return true;
				}
			}
			spawnTileX = 0;
			spawnTileY = 0;
			xRange = false;
			return false;
		}

		private bool PostCheckChosenSpawnTile(int spawnTileX, int spawnTileY, int spawnTileType, int spawnWallType)
		{
			if (ZoneDungeon && (!Main.tileDungeon[spawnTileType] || spawnWallType == 0))
			{
				return false;
			}
			if (Main.dualDungeonsSeed && Main.tile[spawnTileX, spawnTileY].type == 48)
			{
				return false;
			}
			if (Main.tile[spawnTileX, spawnTileY - 1].liquid > 0 && Main.tile[spawnTileX, spawnTileY - 2].liquid > 0 && !Main.tile[spawnTileX, spawnTileY - 1].lava())
			{
				if (Main.tile[spawnTileX, spawnTileY - 1].shimmer())
				{
					return false;
				}
				if (Main.tile[spawnTileX, spawnTileY - 1].honey())
				{
					return false;
				}
			}
			if ((spawnTileType == 477 || spawnTileType == 492) && !Main.bloodMoon && !Main.eclipse && Main.invasionType <= 0 && !Main.pumpkinMoon && !Main.snowMoon && !Main.slimeRain && Main.rand.Next(100) < 10)
			{
				return false;
			}
			return true;
		}

		public void SetSpawnFlagsForChosenTile(int spawnTileX, int spawnTileY, int spawnTileType, int spawnWallType)
		{
			if (!skyMob && noGroundWorms)
			{
				noWorms = true;
			}
			Tile tile = Main.tile[spawnTileX, spawnTileY];
			waterTile = Main.tile[spawnTileX, spawnTileY - 1].liquid > 0 && Main.tile[spawnTileX, spawnTileY - 2].liquid > 0 && Main.tile[spawnTileX, spawnTileY - 1].liquidType() == 0;
			if (tile.type == 367)
			{
				nearMarble = true;
			}
			else if (tile.type == 368)
			{
				nearGranite = true;
			}
			else if (Main.tile[pX, pY].type == 367)
			{
				nearMarble = true;
			}
			else if (Main.tile[pX, pY].type == 368)
			{
				nearGranite = true;
			}
			else
			{
				int num = Main.rand.Next(20, 31);
				int num2 = Main.rand.Next(1, 4);
				if (spawnTileX - num < 0)
				{
					num = spawnTileX;
				}
				if (spawnTileY - num < 0)
				{
					num = spawnTileY;
				}
				if (spawnTileX + num >= Main.maxTilesX)
				{
					num = Main.maxTilesX - spawnTileX - 1;
				}
				if (spawnTileY + num >= Main.maxTilesY)
				{
					num = Main.maxTilesY - spawnTileY - 1;
				}
				for (int i = spawnTileX - num; i <= spawnTileX + num; i += num2)
				{
					int num3 = Main.rand.Next(1, 4);
					for (int j = spawnTileY - num; j <= spawnTileY + num; j += num3)
					{
						if (Main.tile[i, j].type == 367)
						{
							nearMarble = true;
						}
						if (Main.tile[i, j].type == 368)
						{
							nearGranite = true;
						}
					}
				}
				num = Main.rand.Next(30, 61);
				num2 = Main.rand.Next(3, 7);
				if (pX - num < 0)
				{
					num = pX;
				}
				if (pY - num < 0)
				{
					num = pY;
				}
				if (pX + num >= Main.maxTilesX)
				{
					num = Main.maxTilesX - pX - 2;
				}
				if (pY + num >= Main.maxTilesY)
				{
					num = Main.maxTilesY - pY - 2;
				}
				for (int k = pX - num; k <= pX + num; k += num2)
				{
					int num4 = Main.rand.Next(3, 7);
					for (int l = pY - num; l <= pY + num; l += num4)
					{
						if (Main.tile[k, l].type == 367)
						{
							nearMarble = true;
						}
						if (Main.tile[k, l].type == 368)
						{
							nearGranite = true;
						}
					}
				}
			}
			underGround = (double)spawnTileY <= Main.rockLayer;
			if (Main.remixWorld)
			{
				underGround = (double)spawnTileY > Main.rockLayer && spawnTileY <= Main.maxTilesY - 190;
			}
			bool flag = (double)spawnTileY > Main.rockLayer && spawnTileY < Main.UnderworldLayer;
			if (Main.dontStarveWorld)
			{
				flag = spawnTileY < Main.UnderworldLayer;
			}
			if (flag && !ZoneDungeon && !invaders)
			{
				if (Main.rand.Next(3) == 0)
				{
					int num5 = Main.rand.Next(5, 15);
					if (spawnTileX - num5 >= 0 && spawnTileX + num5 < Main.maxTilesX)
					{
						for (int m = spawnTileX - num5; m < spawnTileX + num5; m++)
						{
							for (int n = spawnTileY - num5; n < spawnTileY + num5; n++)
							{
								if (Main.tile[m, n].wall == 62)
								{
									spawnSpider = true;
								}
							}
						}
					}
				}
				else if (Main.tile[pX, pY].wall == 62)
				{
					spawnSpider = true;
				}
			}
			if ((double)spawnTileY < Main.rockLayer && spawnTileY > 200 && !ZoneDungeon && !invaders)
			{
				if (Main.rand.Next(3) == 0)
				{
					int num6 = Main.rand.Next(5, 15);
					if (spawnTileX - num6 >= 0 && spawnTileX + num6 < Main.maxTilesX)
					{
						for (int num7 = spawnTileX - num6; num7 < spawnTileX + num6; num7++)
						{
							for (int num8 = spawnTileY - num6; num8 < spawnTileY + num6; num8++)
							{
								if (WallID.Sets.AllowsUndergroundDesertEnemiesToSpawn[Main.tile[num7, num8].wall])
								{
									spawnUndergroundDesert = true;
								}
							}
						}
					}
				}
				else if (WallID.Sets.AllowsUndergroundDesertEnemiesToSpawn[Main.tile[pX, pY].wall])
				{
					spawnUndergroundDesert = true;
				}
			}
			isSpawningInWindDirection = (float)(pX - spawnTileX) * Main.windSpeedTarget > 0f;
			surfaceSpawn = (double)spawnTileY <= Main.worldSurface;
			deeperThanRockLayer = (double)spawnTileY >= Main.rockLayer;
			isOcean = ((spawnTileX < WorldGen.oceanDistance || spawnTileX > Main.maxTilesX - WorldGen.oceanDistance) && Main.tileSand[spawnTileType] && (double)spawnTileY < Main.rockLayer) || (spawnTileType == 53 && WorldGen.oceanDepths(spawnTileX, spawnTileY));
			isBeach = (double)spawnTileY <= Main.worldSurface && (spawnTileX < WorldGen.beachDistance || spawnTileX > Main.maxTilesX - WorldGen.beachDistance);
			if (Main.remixWorld)
			{
				if ((double)spawnTileY > Main.worldSurface && (double)spawnTileY < Main.rockLayer)
				{
					deeperThanRockLayer = true;
				}
				else
				{
					deeperThanRockLayer = false;
				}
				bool num9 = (double)spawnTileY < Main.worldSurface + 5.0;
				bool flag2 = spawnTileY > Main.UnderworldLayer;
				if (num9 || flag2)
				{
					raining = false;
				}
				if (num9)
				{
					dayTime = false;
				}
				if (ZoneCorrupt || ZoneCrimson)
				{
					isOcean = false;
					isBeach = false;
				}
				if ((double)spawnTileX < (double)Main.maxTilesX * 0.43 || (double)spawnTileX > (double)Main.maxTilesX * 0.57)
				{
					if ((double)spawnTileY > Main.rockLayer - 200.0 && spawnTileY < Main.maxTilesY - 200 && Main.rand.Next(2) == 0)
					{
						isOcean = true;
					}
					if ((double)spawnTileY > Main.rockLayer - 200.0 && spawnTileY < Main.maxTilesY - 200 && Main.rand.Next(2) == 0)
					{
						isBeach = true;
					}
				}
				if ((double)spawnTileY > Main.rockLayer - 20.0)
				{
					if (spawnTileY <= Main.maxTilesY - 190 && Main.rand.Next(3) != 0)
					{
						surfaceSpawn = true;
						dayTime = Main.rand.Next(2) == 0;
					}
					else if ((Main.bloodMoon || (Main.eclipse && Main.dayTime)) && (double)spawnTileX > (double)Main.maxTilesX * 0.38 + 50.0 && (double)spawnTileX < (double)Main.maxTilesX * 0.62)
					{
						surfaceSpawn = true;
					}
				}
			}
			if (dualDungeonsSpawnRules && (double)spawnTileY > Main.worldSurface && spawnTileY < Main.UnderworldLayer)
			{
				switch (Main.rand.Next(7))
				{
				case 0:
				case 1:
					surfaceSpawn = true;
					underGround = false;
					deeperThanRockLayer = false;
					break;
				case 2:
					surfaceSpawn = false;
					underGround = true;
					deeperThanRockLayer = false;
					break;
				case 3:
				case 4:
				case 5:
				case 6:
					surfaceSpawn = false;
					underGround = false;
					deeperThanRockLayer = true;
					break;
				}
				if (!tile.active() || tile.type != 48)
				{
					SetSpawnFlagsForChosenTile_ForDualDungeon(spawnTileX, spawnTileY, spawnTileType, spawnWallType);
				}
			}
		}

		public void SpawnAnNPC(int spawnTileX, int spawnTileY, int spawnTileType, bool xRange, int target)
		{
			int num = Main.tile[spawnTileX, spawnTileY - 1].wall;
			if (Main.tile[spawnTileX, spawnTileY - 2].wall == 244 || Main.tile[spawnTileX, spawnTileY].wall == 244)
			{
				num = 244;
			}
			GetZombieSettings(out var zombieStyle, out var spawnArmedZombies, out var torchZombieChance, out var maggotZombieChance);
			int gnomeChance = GetGnomeChance();
			int maxValue = 65;
			if (Main.remixWorld && (double)pY < Main.worldSurface && (ZoneCorrupt || ZoneCrimson))
			{
				maxValue = 25;
			}
			bool tooWindyForButterflies = TooWindyForButterflies;
			bool flag = (double)Main.windSpeedTarget < -0.45 || (double)Main.windSpeedTarget > 0.45;
			int cattailX;
			int cattailY;
			if (ZoneTowerNebula)
			{
				bool flag2 = true;
				int num2 = 0;
				while (flag2)
				{
					num2 = Utils.SelectRandom<int>(Main.rand, 424, 424, 424, 423, 423, 423, 421, 421, 421, 420, 420);
					flag2 = false;
					if (num2 == 424 && CountNPCS(num2) >= 3)
					{
						flag2 = true;
					}
					if (num2 == 423 && CountNPCS(num2) >= 3)
					{
						flag2 = true;
					}
					if (num2 == 420 && CountNPCS(num2) >= 3)
					{
						flag2 = true;
					}
				}
				if (num2 != 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, num2, 1);
				}
			}
			else if (ZoneTowerVortex)
			{
				bool flag3 = true;
				int num3 = 0;
				while (flag3)
				{
					num3 = Utils.SelectRandom<int>(Main.rand, 429, 429, 429, 429, 427, 427, 425, 425, 426);
					flag3 = false;
					if (num3 == 425 && CountNPCS(num3) >= 3)
					{
						flag3 = true;
					}
					if (num3 == 426 && CountNPCS(num3) >= 3)
					{
						flag3 = true;
					}
					if (num3 == 429 && CountNPCS(num3) >= 4)
					{
						flag3 = true;
					}
				}
				if (num3 != 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, num3, 1);
				}
			}
			else if (ZoneTowerStardust)
			{
				int num4 = Utils.SelectRandom<int>(Main.rand, 411, 411, 411, 409, 409, 407, 402, 405);
				if (num4 != 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, num4, 1);
				}
			}
			else if (ZoneTowerSolar)
			{
				bool flag4 = true;
				int num5 = 0;
				while (flag4)
				{
					num5 = Utils.SelectRandom<int>(Main.rand, 518, 419, 418, 412, 417, 416, 415);
					flag4 = false;
					if (num5 == 418 && Main.rand.Next(2) == 0)
					{
						num5 = Utils.SelectRandom<int>(Main.rand, 415, 416, 419, 417);
					}
					if (num5 == 518 && CountNPCS(num5) >= 2)
					{
						flag4 = true;
					}
					if (num5 == 412 && CountNPCS(num5) >= 1)
					{
						flag4 = true;
					}
				}
				if (num5 != 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, num5, 1);
				}
			}
			else if (skyMob)
			{
				int maxValue2 = 8;
				int maxValue3 = 30;
				bool flag5 = (float)Math.Abs(spawnTileX - Main.maxTilesX / 2) / (float)(Main.maxTilesX / 2) > 0.33f && skyBehindPlayer;
				if (flag5 && AnyDanger())
				{
					flag5 = false;
				}
				if (ZoneWaterCandle)
				{
					maxValue2 = 3;
					maxValue3 = 10;
				}
				if (invaders && Main.invasionType == 4)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 388);
				}
				else if (flag5 && Main.hardMode && downedGolemBoss && ((!downedMartians && Main.rand.Next(maxValue2) == 0) || Main.rand.Next(maxValue3) == 0) && !AnyNPCs(399))
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 399);
				}
				else if (flag5 && Main.hardMode && downedGolemBoss && ((!downedMartians && Main.rand.Next(maxValue2) == 0) || Main.rand.Next(maxValue3) == 0) && !AnyNPCs(399) && ZoneWaterCandle)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 399);
				}
				else if (Main.hardMode && !AnyNPCs(87) && !noWorms && Main.rand.Next(10) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 87);
				}
				else if (Main.hardMode && !AnyNPCs(87) && !noWorms && Main.rand.Next(10) == 0 && ZoneWaterCandle)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 87);
				}
				else if (!unlockedSlimePurpleSpawn && RollLuck(25) == 0 && !AnyNPCs(686))
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 686);
				}
				else
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 48);
				}
			}
			else if (invaders)
			{
				if (Main.invasionType == 1)
				{
					if (Main.hardMode && !AnyNPCs(471) && Main.rand.Next(30) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 471);
					}
					else if (Main.rand.Next(9) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 29);
					}
					else if (Main.rand.Next(5) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 26);
					}
					else if (Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 111);
					}
					else if (Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 27);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 28);
					}
				}
				else if (Main.invasionType == 2)
				{
					if (Main.rand.Next(7) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 145);
					}
					else if (Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 143);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 144);
					}
				}
				else if (Main.invasionType == 3)
				{
					if (Main.invasionSize < Main.invasionSizeStart / 2 && Main.rand.Next(20) == 0 && !AnyNPCs(491) && !Collision.SolidTiles(spawnTileX - 20, spawnTileX + 20, spawnTileY - 40, spawnTileY - 10))
					{
						SpawnNPC(spawnTileX * 16 + 8, (spawnTileY - 10) * 16, 491);
					}
					else if (Main.rand.Next(30) == 0 && !AnyNPCs(216))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 216);
					}
					else if (Main.rand.Next(11) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 215);
					}
					else if (Main.rand.Next(9) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 252);
					}
					else if (Main.rand.Next(7) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 214);
					}
					else if (Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 213);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 212);
					}
				}
				else
				{
					if (Main.invasionType != 4)
					{
						return;
					}
					int num6 = 0;
					int num7 = Main.rand.Next(7);
					bool flag6 = (float)(Main.invasionSizeStart - Main.invasionSize) / (float)Main.invasionSizeStart >= 0.3f && !AnyNPCs(395);
					if (Main.rand.Next(45) == 0 && flag6)
					{
						num6 = 395;
					}
					else if (num7 >= 6)
					{
						if (Main.rand.Next(20) == 0 && flag6)
						{
							num6 = 395;
						}
						else
						{
							int num8 = Main.rand.Next(2);
							if (num8 == 0)
							{
								num6 = 390;
							}
							if (num8 == 1)
							{
								num6 = 386;
							}
						}
					}
					else if (num7 >= 4)
					{
						int num9 = Main.rand.Next(5);
						num6 = ((num9 < 2) ? 382 : ((num9 >= 4) ? 388 : 381));
					}
					else
					{
						int num10 = Main.rand.Next(4);
						if (num10 == 3)
						{
							if (!AnyNPCs(520))
							{
								num6 = 520;
							}
							else
							{
								num10 = Main.rand.Next(3);
							}
						}
						if (num10 == 0)
						{
							num6 = 385;
						}
						if (num10 == 1)
						{
							num6 = 389;
						}
						if (num10 == 2)
						{
							num6 = 383;
						}
					}
					if (num6 != 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, num6, 1);
					}
				}
			}
			else if (downedBoss3 && ZoneGraveyard && !noWorms && RollBadLuckExtreme(25) == 0 && !AnyNPCs(690) && IsThisAGoodPlaceForAStatueMimic(spawnTileX, spawnTileY))
			{
				SpawnNPC(spawnTileX * 16 + 2, spawnTileY * 16, 690);
			}
			else if (tresspassingDualDungeon && RollBadLuck(15) == 0)
			{
				if (Main.hardMode)
				{
					SpawnNPC(spawnTileX * 16 + 2, spawnTileY * 16, 82);
				}
				else
				{
					SpawnNPC(spawnTileX * 16 + 2, spawnTileY * 16, 316);
				}
			}
			else if (num == 244 && !Main.remixWorld)
			{
				if (waterTile)
				{
					if (RollLuck(goldCritterChance) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 592);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 55);
					}
				}
				else if ((double)spawnTileY > Main.worldSurface)
				{
					if (Main.rand.Next(3) == 0)
					{
						if (RollLuck(goldCritterChance) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 447);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 300);
						}
					}
					else if (Main.rand.Next(2) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 359);
					}
					else if (RollLuck(goldCritterChance) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 448);
					}
					else if (Main.rand.Next(3) != 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 357);
					}
				}
				else if (RollLuck(1 + gnomeChance / 10) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 624).timeLeft *= 10;
				}
				else if (RollLuck(goldCritterChance) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 443);
				}
				else if (RollLuck(goldCritterChance) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 539);
				}
				else if (Main.halloween && Main.rand.Next(3) != 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 303);
				}
				else if (Main.xMas && Main.rand.Next(3) != 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 337);
				}
				else if (BirthdayParty.PartyIsUp && Main.rand.Next(3) != 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 540);
				}
				else if (Main.rand.Next(3) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Utils.SelectRandom(Main.rand, new short[2] { 299, 538 }));
				}
				else
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 46);
				}
			}
			else if (!savedBartender && DD2Event.ReadyToFindBartender && !AnyNPCs(579) && Main.rand.Next(80) == 0 && !waterTile)
			{
				SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 579);
			}
			else if ((Main.tile[spawnTileX, spawnTileY].wall == 62 || spawnSpider) && CheckToSpawnSpider(spawnTileX, spawnTileY))
			{
				bool flag7 = deeperThanRockLayer && spawnTileY < Main.maxTilesY - 210;
				if (Main.dontStarveWorld)
				{
					flag7 = spawnTileY < Main.maxTilesY - 210;
				}
				if (Main.tile[spawnTileX, spawnTileY].wall == 62 && Main.rand.Next(8) == 0 && !waterTile && flag7 && !savedStylist && !AnyNPCs(354))
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 354);
				}
				else if (Main.hardMode && Main.rand.Next(10) != 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 163);
				}
				else
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 164);
				}
			}
			else if ((SpawnTileOrAboveHasAnyWallInSet(spawnTileX, spawnTileY, WallID.Sets.AllowsUndergroundDesertEnemiesToSpawn) || spawnUndergroundDesert) && WorldGen.checkUnderground(spawnTileX, spawnTileY))
			{
				float num11 = 1.3f;
				if ((double)spawnTileY > (Main.rockLayer * 2.0 + (double)Main.maxTilesY) / 3.0)
				{
					num11 *= 0.5f;
				}
				else if ((double)spawnTileY > Main.rockLayer)
				{
					num11 *= 0.85f;
				}
				if (Main.rand.Next(20) == 0 && !waterTile && !savedGolfer && !AnyNPCs(589))
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 589);
					return;
				}
				if (Main.hardMode && Main.rand.Next((int)(50f * num11)) == 0 && !noWorms && (double)spawnTileY > Main.worldSurface + 100.0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 510);
					return;
				}
				if (Main.rand.Next((int)(50f * num11)) == 0 && !noWorms && (double)spawnTileY > Main.worldSurface + 100.0 && CountNPCS(513) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 513);
					return;
				}
				if (Main.hardMode && Main.rand.Next(5) != 0)
				{
					List<int> list = new List<int>();
					if (ZoneCorrupt)
					{
						list.Add(525);
						list.Add(525);
					}
					if (ZoneCrimson)
					{
						list.Add(526);
						list.Add(526);
					}
					if (ZoneHallow)
					{
						list.Add(527);
						list.Add(527);
					}
					if (list.Count == 0)
					{
						list.Add(524);
						list.Add(524);
					}
					if (ZoneCorrupt || ZoneCrimson)
					{
						list.Add(533);
						list.Add(529);
					}
					else
					{
						list.Add(530);
						list.Add(528);
					}
					list.Add(532);
					int type = Utils.SelectRandom(Main.rand, list.ToArray());
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, type);
					list.Clear();
					return;
				}
				int num12 = Utils.SelectRandom<int>(Main.rand, 69, 580, 580, 580, 581);
				if (Main.rand.Next(15) == 0)
				{
					num12 = 537;
				}
				else if (Main.rand.Next(10) == 0)
				{
					switch (num12)
					{
					case 580:
						num12 = 508;
						break;
					case 581:
						num12 = 509;
						break;
					}
				}
				SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, num12);
			}
			else if (Main.hardMode && waterTile && ZoneJungle && Main.rand.Next(3) != 0)
			{
				SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 157);
			}
			else if (Main.hardMode && waterTile && ZoneCrimson && Main.rand.Next(3) != 0)
			{
				SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 242);
			}
			else if (Main.hardMode && waterTile && ZoneCrimson && Main.rand.Next(3) != 0)
			{
				SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 241);
			}
			else if (!Main.remixWorld && !Main.isThereAWorldSurface && !savedAngler && !AnyNPCs(376) && waterTile && Main.rand.Next(20) == 0)
			{
				int num13 = -1;
				for (int num14 = spawnTileY - 1; num14 > spawnTileY - 50; num14--)
				{
					if (Main.tile[spawnTileX, num14].liquid == 0 && !WorldGen.SolidTile(spawnTileX, num14) && !WorldGen.SolidTile(spawnTileX, num14 + 1) && !WorldGen.SolidTile(spawnTileX, num14 + 2))
					{
						num13 = num14 + 2;
						break;
					}
				}
				if (num13 > spawnTileY)
				{
					num13 = spawnTileY;
				}
				if (num13 > 0 && !xRange)
				{
					SpawnNPC(spawnTileX * 16 + 8, num13 * 16, 376);
				}
			}
			else if ((!spawnFriendly || (!savedAngler && !AnyNPCs(376))) && waterTile && isOcean)
			{
				bool flag8 = false;
				if (!savedAngler && !AnyNPCs(376) && ((double)spawnTileY < Main.worldSurface - 10.0 || Main.remixWorld))
				{
					int num15 = -1;
					for (int num16 = spawnTileY - 1; num16 > spawnTileY - 50; num16--)
					{
						if (Main.tile[spawnTileX, num16].liquid == 0 && !WorldGen.SolidTile(spawnTileX, num16) && !WorldGen.SolidTile(spawnTileX, num16 + 1) && !WorldGen.SolidTile(spawnTileX, num16 + 2))
						{
							num15 = num16 + 2;
							break;
						}
					}
					if (num15 > spawnTileY)
					{
						num15 = spawnTileY;
					}
					if (num15 > 0 && !xRange)
					{
						SpawnNPC(spawnTileX * 16 + 8, num15 * 16, 376);
						flag8 = true;
					}
				}
				if (flag8 || xRange)
				{
					return;
				}
				int num17 = -1;
				int num18 = -1;
				if (((double)spawnTileY < Main.worldSurface || Main.remixWorld) && spawnTileY > 50)
				{
					for (int num19 = spawnTileY - 1; num19 > spawnTileY - 50; num19--)
					{
						if (Main.tile[spawnTileX, num19].liquid == 0 && !WorldGen.SolidTile(spawnTileX, num19) && !WorldGen.SolidTile(spawnTileX, num19 + 1) && !WorldGen.SolidTile(spawnTileX, num19 + 2))
						{
							num17 = num19 + 2;
							if (!WorldGen.SolidTile(spawnTileX, num17 + 1) && !WorldGen.SolidTile(spawnTileX, num17 + 2) && !Main.wallHouse[Main.tile[spawnTileX, num17 + 2].wall])
							{
								num18 = num17 + 2;
							}
							if (Main.wallHouse[Main.tile[spawnTileX, num17].wall])
							{
								num17 = -1;
							}
							break;
						}
					}
					if (num17 > spawnTileY)
					{
						num17 = spawnTileY;
					}
					if (num18 > spawnTileY)
					{
						num18 = spawnTileY;
					}
				}
				if (num17 > 0 && !xRange && Main.rand.Next(10) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, num17 * 16, 602);
				}
				else if (Main.rand.Next(SharkSpawnChance(spawnTileX, spawnTileY)) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 65);
				}
				else if (Main.hardMode && Main.rand.Next(SharkSpawnChance(spawnTileX, spawnTileY)) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 692);
				}
				else if (Main.rand.Next(10) == 0)
				{
					int num20 = Main.rand.Next(4);
					if (num20 == 0 && num17 > 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, num17 * 16, 625);
						return;
					}
					if (num20 == 1 && num18 > 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, num18 * 16, 615);
						return;
					}
					switch (num20)
					{
					case 2:
					{
						int num22 = spawnTileY;
						if (num18 > 0)
						{
							num22 = num18;
						}
						if (RollLuck(goldCritterChance) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, num22 * 16, 627);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, num22 * 16, 626);
						}
						break;
					}
					case 3:
					{
						int num21 = spawnTileY;
						if (num18 > 0)
						{
							num21 = num18;
						}
						SpawnNPC(spawnTileX * 16 + 8, num21 * 16, 688);
						break;
					}
					}
				}
				else if (Main.rand.Next(40) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 220);
				}
				else if (Main.rand.Next(18) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 221);
				}
				else if (Main.rand.Next(3) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 67);
				}
				else
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 64);
				}
			}
			else if (!waterTile && !savedAngler && !AnyNPCs(376) && (spawnTileX < WorldGen.beachDistance || spawnTileX > Main.maxTilesX - WorldGen.beachDistance) && Main.tileSand[spawnTileType] && ((double)spawnTileY < Main.worldSurface || Main.remixWorld))
			{
				SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 376);
			}
			else if (!spawnFriendly && waterTile && ((deeperThanRockLayer && Main.rand.Next(2) == 0) || spawnTileType == 60))
			{
				bool flag9 = false;
				if (spawnTileType == 60 && surfaceSpawn && spawnTileY > 50 && Main.rand.Next(3) == 0 && Main.dayTime)
				{
					int num23 = -1;
					for (int num24 = spawnTileY - 1; num24 > spawnTileY - 50; num24--)
					{
						if (Main.tile[spawnTileX, num24].liquid == 0 && !WorldGen.SolidTile(spawnTileX, num24) && !WorldGen.SolidTile(spawnTileX, num24 + 1) && !WorldGen.SolidTile(spawnTileX, num24 + 2))
						{
							num23 = num24 + 2;
							break;
						}
					}
					if (num23 > spawnTileY)
					{
						num23 = spawnTileY;
					}
					if (num23 > 0 && !xRange)
					{
						flag9 = true;
						if (Main.rand.Next(4) == 0)
						{
							flag9 = true;
							SpawnNPC(spawnTileX * 16 + 8, num23 * 16, 617);
						}
						else if (!flag && !raining)
						{
							flag9 = true;
							int num25 = Main.rand.Next(1, 4);
							for (int i = 0; i < num25; i++)
							{
								if (RollLuck(goldCritterChance) == 0)
								{
									SpawnNPC(spawnTileX * 16 + 8 + Main.rand.Next(-16, 17), num23 * 16 - 16, 613);
								}
								else
								{
									SpawnNPC(spawnTileX * 16 + 8 + Main.rand.Next(-16, 17), num23 * 16 - 16, 612);
								}
							}
						}
					}
				}
				if (!flag9)
				{
					if (Main.hardMode && Main.rand.Next(3) > 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 102);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 58);
					}
				}
			}
			else if (!spawnFriendly && waterTile && (double)spawnTileY > Main.worldSurface && Main.rand.Next(3) == 0)
			{
				if (Main.hardMode && Main.rand.Next(3) > 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 103);
				}
				else
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 63);
				}
			}
			else if (waterTile && Main.rand.Next(4) == 0 && ((spawnTileX > WorldGen.oceanDistance && spawnTileX < Main.maxTilesX - WorldGen.oceanDistance) || (double)spawnTileY > Main.worldSurface + 50.0))
			{
				if (ZoneCorrupt)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 57);
				}
				else if (ZoneCrimson)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 465);
				}
				else if ((double)spawnTileY < Main.worldSurface && spawnTileY > 50 && Main.rand.Next(3) != 0 && Main.dayTime)
				{
					int num26 = -1;
					for (int num27 = spawnTileY - 1; num27 > spawnTileY - 50; num27--)
					{
						if (Main.tile[spawnTileX, num27].liquid == 0 && !WorldGen.SolidTile(spawnTileX, num27) && !WorldGen.SolidTile(spawnTileX, num27 + 1) && !WorldGen.SolidTile(spawnTileX, num27 + 2))
						{
							num26 = num27 + 2;
							break;
						}
					}
					if (num26 > spawnTileY)
					{
						num26 = spawnTileY;
					}
					if (num26 > 0 && !xRange)
					{
						if (Main.rand.Next(5) == 0 && (spawnTileType == 2 || spawnTileType == 477))
						{
							SpawnNPC(spawnTileX * 16 + 8, num26 * 16, 616);
						}
						else if (spawnTileType == 53)
						{
							if (Main.rand.Next(2) == 0 && !flag && !raining)
							{
								int num28 = Main.rand.Next(1, 4);
								for (int j = 0; j < num28; j++)
								{
									if (RollLuck(goldCritterChance) == 0)
									{
										SpawnNPC(spawnTileX * 16 + 8 + Main.rand.Next(-16, 17), num26 * 16 - 16, 613);
									}
									else
									{
										SpawnNPC(spawnTileX * 16 + 8 + Main.rand.Next(-16, 17), num26 * 16 - 16, 612);
									}
								}
							}
							else
							{
								SpawnNPC(spawnTileX * 16 + 8, num26 * 16, 608);
							}
						}
						else if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, num26 * 16, 362);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, num26 * 16, 364);
						}
					}
					else if (spawnTileType == 53 && spawnTileX > WorldGen.beachDistance && spawnTileX < Main.maxTilesX - WorldGen.beachDistance)
					{
						SpawnNPC(spawnTileX * 16 + 8, num26 * 16, 607);
					}
					else if (RollLuck(goldCritterChance) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 592);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 55);
					}
				}
				else if (spawnTileType == 53 && spawnTileX > WorldGen.beachDistance && spawnTileX < Main.maxTilesX - WorldGen.beachDistance)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 607);
				}
				else if (RollLuck(goldCritterChance) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 592);
				}
				else
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 55);
				}
			}
			else if (downedGoblins && RollLuck(20) == 0 && !waterTile && deeperThanRockLayer && spawnTileY < Main.maxTilesY - 210 && !savedGoblin && !AnyNPCs(105))
			{
				SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 105);
			}
			else if (Main.hardMode && RollLuck(20) == 0 && !waterTile && deeperThanRockLayer && spawnTileY < Main.maxTilesY - 210 && !savedWizard && !AnyNPCs(106))
			{
				SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 106);
			}
			else if (downedBoss3 && RollLuck(20) == 0 && !waterTile && deeperThanRockLayer && spawnTileY < Main.maxTilesY - 210 && !unlockedSlimeOldSpawn && !AnyNPCs(685))
			{
				SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 685);
			}
			else if (spawnFriendly)
			{
				if (ZoneGraveyard)
				{
					if (!waterTile)
					{
						if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 606);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 610);
						}
					}
					return;
				}
				if (!xRange && isBeach)
				{
					if (waterTile)
					{
						int num29 = -1;
						int num30 = -1;
						if (((double)spawnTileY < Main.worldSurface || Main.remixWorld) && spawnTileY > 50)
						{
							for (int num31 = spawnTileY - 1; num31 > spawnTileY - 50; num31--)
							{
								if (Main.tile[spawnTileX, num31].liquid == 0 && !WorldGen.SolidTile(spawnTileX, num31) && !WorldGen.SolidTile(spawnTileX, num31 + 1) && !WorldGen.SolidTile(spawnTileX, num31 + 2))
								{
									num29 = num31 + 2;
									if (!WorldGen.SolidTile(spawnTileX, num29 + 1) && !WorldGen.SolidTile(spawnTileX, num29 + 2))
									{
										num30 = num29 + 2;
									}
									break;
								}
							}
							if (num29 > spawnTileY)
							{
								num29 = spawnTileY;
							}
							if (num30 > spawnTileY)
							{
								num30 = spawnTileY;
							}
						}
						if (Main.rand.Next(2) == 0)
						{
							int num32 = Main.rand.Next(4);
							if (num32 == 0 && num29 > 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, num29 * 16, 625);
								return;
							}
							if (num32 == 1 && num30 > 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, num30 * 16, 615);
								return;
							}
							switch (num32)
							{
							case 2:
							{
								int num34 = spawnTileY;
								if (num30 > 0)
								{
									num34 = num30;
								}
								if (RollLuck(goldCritterChance) == 0)
								{
									SpawnNPC(spawnTileX * 16 + 8, num34 * 16, 627);
								}
								else
								{
									SpawnNPC(spawnTileX * 16 + 8, num34 * 16, 626);
								}
								break;
							}
							case 3:
							{
								int num33 = spawnTileY;
								if (num30 > 0)
								{
									num33 = num30;
								}
								SpawnNPC(spawnTileX * 16 + 8, num33 * 16, 688);
								break;
							}
							}
						}
						else if (num29 > 0 && !xRange)
						{
							SpawnNPC(spawnTileX * 16 + 8, num29 * 16, 602);
						}
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 602);
					}
					return;
				}
				if ((spawnTileType == 2 || spawnTileType == 477 || spawnTileType == 53) && !tooWindyForButterflies && raining && Main.dayTime && Main.rand.Next(2) == 0 && ((double)spawnTileY <= Main.worldSurface || Main.remixWorld) && FindCattailTop(spawnTileX, spawnTileY, out cattailX, out cattailY))
				{
					if (RollLuck(goldCritterChance) == 0)
					{
						SpawnNPC(cattailX * 16 + 8, cattailY * 16, 601);
					}
					else
					{
						SpawnNPC(cattailX * 16 + 8, cattailY * 16, RollDragonflyType(spawnTileType));
					}
					if (Main.rand.Next(3) == 0)
					{
						SpawnNPC(cattailX * 16 + 8 - 16, cattailY * 16, RollDragonflyType(spawnTileType));
					}
					if (Main.rand.Next(3) == 0)
					{
						SpawnNPC(cattailX * 16 + 8 + 16, cattailY * 16, RollDragonflyType(spawnTileType));
					}
					return;
				}
				if (waterTile)
				{
					if (surfaceSpawn && spawnTileY > 50 && Main.rand.Next(3) != 0 && Main.dayTime)
					{
						int num35 = -1;
						for (int num36 = spawnTileY - 1; num36 > spawnTileY - 50; num36--)
						{
							if (Main.tile[spawnTileX, num36].liquid == 0 && !WorldGen.SolidTile(spawnTileX, num36) && !WorldGen.SolidTile(spawnTileX, num36 + 1) && !WorldGen.SolidTile(spawnTileX, num36 + 2))
							{
								num35 = num36 + 2;
								break;
							}
						}
						if (num35 > spawnTileY)
						{
							num35 = spawnTileY;
						}
						if (num35 > 0 && !xRange)
						{
							switch (spawnTileType)
							{
							case 60:
								if (Main.rand.Next(3) != 0 && !flag && !raining)
								{
									int num38 = Main.rand.Next(1, 4);
									for (int l = 0; l < num38; l++)
									{
										if (RollLuck(goldCritterChance) == 0)
										{
											SpawnNPC(spawnTileX * 16 + 8 + Main.rand.Next(-16, 17), num35 * 16 - 16, 613);
										}
										else
										{
											SpawnNPC(spawnTileX * 16 + 8 + Main.rand.Next(-16, 17), num35 * 16 - 16, 612);
										}
									}
								}
								else
								{
									SpawnNPC(spawnTileX * 16 + 8, num35 * 16, 617);
								}
								break;
							case 53:
								if (Main.rand.Next(3) != 0 && !flag && !raining)
								{
									int num37 = Main.rand.Next(1, 4);
									for (int k = 0; k < num37; k++)
									{
										if (RollLuck(goldCritterChance) == 0)
										{
											SpawnNPC(spawnTileX * 16 + 8 + Main.rand.Next(-16, 17), num35 * 16 - 16, 613);
										}
										else
										{
											SpawnNPC(spawnTileX * 16 + 8 + Main.rand.Next(-16, 17), num35 * 16 - 16, 612);
										}
									}
								}
								else
								{
									SpawnNPC(spawnTileX * 16 + 8, num35 * 16, 608);
								}
								break;
							default:
								if (Main.rand.Next(5) == 0 && (spawnTileType == 2 || spawnTileType == 477))
								{
									SpawnNPC(spawnTileX * 16 + 8, num35 * 16, 616);
								}
								else if (Main.rand.Next(2) == 0)
								{
									SpawnNPC(spawnTileX * 16 + 8, num35 * 16, 362);
								}
								else
								{
									SpawnNPC(spawnTileX * 16 + 8, num35 * 16, 364);
								}
								break;
							}
						}
						else if (spawnTileType == 53 && spawnTileX > WorldGen.beachDistance && spawnTileX < Main.maxTilesX - WorldGen.beachDistance)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 607);
						}
						else if (RollLuck(goldCritterChance) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 592);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 55);
						}
					}
					else if (spawnTileType == 53 && spawnTileX > WorldGen.beachDistance && spawnTileX < Main.maxTilesX - WorldGen.beachDistance)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 607);
					}
					else if (RollLuck(goldCritterChance) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 592);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 55);
					}
					return;
				}
				switch (spawnTileType)
				{
				case 147:
				case 161:
					if (Main.rand.Next(2) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 148);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 149);
					}
					break;
				case 60:
					if (Main.dayTime && Main.rand.Next(3) != 0)
					{
						switch (Main.rand.Next(5))
						{
						case 0:
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 671);
							break;
						case 1:
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 672);
							break;
						case 2:
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 673);
							break;
						case 3:
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 674);
							break;
						default:
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 675);
							break;
						}
					}
					else
					{
						SpawnFrog(spawnTileX, spawnTileY);
					}
					break;
				case 53:
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(366, 368));
					break;
				default:
					if (!((double)spawnTileY > Main.worldSurface))
					{
						break;
					}
					goto case 2;
				case 2:
				case 109:
				case 477:
				case 492:
				{
					bool flag10 = surfaceSpawn;
					if (raining && spawnTileY <= Main.UnderworldLayer)
					{
						if (deeperThanRockLayer && Main.rand.Next(5) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, GetGemSquirrelToSpawn());
						}
						else if (deeperThanRockLayer && Main.rand.Next(5) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, GetGemBunnyToSpawn());
						}
						else if (RollLuck(goldCritterChance) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 448);
						}
						else if (Main.rand.Next(3) != 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 357);
						}
						else if (RollLuck(goldCritterChance) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 593);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 230);
						}
						break;
					}
					if (!Main.dayTime && Main.numClouds <= 55 && Main.cloudBGActive == 0f && Star.starfallBoost > 3f && flag10 && RollLuck(2) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 484);
						break;
					}
					if (!tooWindyForButterflies && !Main.dayTime && Main.rand.Next(fireFlyFriendly) == 0 && flag10)
					{
						int type2 = 355;
						if (spawnTileType == 109)
						{
							type2 = 358;
						}
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, type2);
						if (Main.rand.Next(fireFlyMultiple) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8 - 16, spawnTileY * 16, type2);
						}
						if (Main.rand.Next(fireFlyMultiple) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8 + 16, spawnTileY * 16, type2);
						}
						if (Main.rand.Next(fireFlyMultiple) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16 - 16, type2);
						}
						if (Main.rand.Next(fireFlyMultiple) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16 + 16, type2);
						}
						break;
					}
					if (!raining && !Main.dayTime && Main.rand.Next(5) == 0 && flag10)
					{
						if (RollBadLuckExtreme(100) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 689);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 611);
						}
						break;
					}
					if (Main.dayTime && Main.time < 18000.0 && Main.rand.Next(3) != 0 && flag10)
					{
						int num39 = Main.rand.Next(4);
						if (RollLuck(goldCritterChance) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 442);
							break;
						}
						switch (num39)
						{
						case 0:
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 297);
							break;
						case 1:
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 298);
							break;
						default:
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 74);
							break;
						}
						break;
					}
					if (!tooWindyForButterflies && !raining && Main.dayTime && Main.rand.Next(stinkBugChance) == 0 && flag10)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 669);
						if (Main.rand.Next(4) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8 - 16, spawnTileY * 16, 669);
						}
						if (Main.rand.Next(4) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8 + 16, spawnTileY * 16, 669);
						}
						break;
					}
					if (!tooWindyForButterflies && !raining && Main.dayTime && Main.rand.Next(butterflyChance) == 0 && flag10)
					{
						if (RollLuck(goldCritterChance) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 444);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 356);
						}
						if (Main.rand.Next(4) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8 - 16, spawnTileY * 16, 356);
						}
						if (Main.rand.Next(4) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8 + 16, spawnTileY * 16, 356);
						}
						break;
					}
					if (tooWindyForButterflies && !raining && Main.dayTime && Main.rand.Next(butterflyChance / 2) == 0 && flag10)
					{
						if (RollLuck(goldCritterChance) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 605);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 604);
						}
						if (Main.rand.Next(3) != 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 604);
						}
						if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 604);
						}
						if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 604);
						}
						if (Main.rand.Next(4) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 604);
						}
						break;
					}
					if (Main.rand.Next(2) == 0 && flag10)
					{
						int num40 = Main.rand.Next(4);
						if (RollLuck(goldCritterChance) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 442);
							break;
						}
						switch (num40)
						{
						case 0:
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 297);
							break;
						case 1:
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 298);
							break;
						default:
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 74);
							break;
						}
						break;
					}
					bool flag11 = (double)spawnTileY >= Main.rockLayer && spawnTileY <= Main.UnderworldLayer;
					if (Main.remixWorld)
					{
						flag11 = (double)spawnTileY > Main.worldSurface && (double)spawnTileY < Main.rockLayer;
					}
					if (spawnTileY > Main.UnderworldLayer)
					{
						if (inRemixStartingArea && Main.rand.Next(2) == 0)
						{
							if (Main.rand.Next(2) == 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, GetGemSquirrelToSpawn());
							}
							else
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, GetGemBunnyToSpawn());
							}
						}
						else
						{
							SpawnLavaBaitCritters(spawnTileX, spawnTileY);
						}
					}
					else if (RollLuck(goldCritterChance) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 443);
					}
					else if (RollLuck(goldCritterChance) == 0 && flag10)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 539);
					}
					else if (!flag11 && Main.halloween && Main.rand.Next(3) != 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 303);
					}
					else if (!flag11 && Main.xMas && Main.rand.Next(3) != 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 337);
					}
					else if (!flag11 && BirthdayParty.PartyIsUp && Main.rand.Next(3) != 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 540);
					}
					else if (Main.rand.Next(3) == 0)
					{
						if (flag11)
						{
							if (Main.rand.Next(5) == 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, GetGemSquirrelToSpawn());
							}
						}
						else if (flag10)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Utils.SelectRandom(Main.rand, new short[2] { 299, 538 }));
						}
					}
					else if (flag11)
					{
						if (Main.rand.Next(5) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, GetGemBunnyToSpawn());
						}
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 46);
					}
					break;
				}
				}
			}
			else if (ZoneDungeon)
			{
				int num41 = 0;
				ushort wall = Main.tile[spawnTileX, spawnTileY].wall;
				ushort wall2 = Main.tile[spawnTileX, spawnTileY - 1].wall;
				if (wall == 94 || wall == 96 || wall == 98 || wall2 == 94 || wall2 == 96 || wall2 == 98)
				{
					num41 = 1;
				}
				if (wall == 95 || wall == 97 || wall == 99 || wall2 == 95 || wall2 == 97 || wall2 == 99)
				{
					num41 = 2;
				}
				if (RollLuck(7) == 0)
				{
					num41 = Main.rand.Next(3);
				}
				bool flag12 = !downedBoss3;
				if ((Main.drunkWorld || !Main.isThereAWorldSurface) && pY < Main.dungeonY + 40)
				{
					flag12 = false;
				}
				if (SpecialSeedFeatures.NoDungeonGuardian)
				{
					flag12 = false;
				}
				if (flag12)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 68);
					return;
				}
				if (downedBoss3 && !savedMech && Main.rand.Next(5) == 0 && !waterTile && !AnyNPCs(123) && (double)spawnTileY > (Main.worldSurface * 4.0 + Main.rockLayer) / 5.0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 123);
					return;
				}
				if (hardDungeon && Main.rand.Next(30) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 287);
					return;
				}
				if (hardDungeon && num41 == 0 && Main.rand.Next(15) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 293);
					return;
				}
				if (hardDungeon && num41 == 1 && Main.rand.Next(15) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 291);
					return;
				}
				if (hardDungeon && num41 == 2 && Main.rand.Next(15) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 292);
					return;
				}
				if (hardDungeon && !AnyNPCs(290) && num41 == 0 && Main.rand.Next(35) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 290);
					return;
				}
				if (hardDungeon && (num41 == 1 || num41 == 2) && Main.rand.Next(30) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 289);
					return;
				}
				if (hardDungeon && Main.rand.Next(20) == 0)
				{
					int num42 = 281;
					if (num41 == 0)
					{
						num42 += 2;
					}
					if (num41 == 2)
					{
						num42 += 4;
					}
					num42 += Main.rand.Next(2);
					if (!AnyNPCs(num42))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, num42);
					}
					return;
				}
				if (hardDungeon && Main.rand.Next(3) != 0)
				{
					int num43 = 269;
					if (num41 == 0)
					{
						num43 += 4;
					}
					if (num41 == 2)
					{
						num43 += 8;
					}
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, num43 + Main.rand.Next(4));
					return;
				}
				if (RollLuck(35) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 71);
					return;
				}
				if (num41 == 1 && Main.rand.Next(3) == 0 && !NearSpikeBall(spawnTileX, spawnTileY))
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 70);
					return;
				}
				if (num41 == 2 && Main.rand.Next(5) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 72);
					return;
				}
				if (num41 == 0 && Main.rand.Next(7) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 34);
					return;
				}
				if (Main.rand.Next(7) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 32);
					return;
				}
				bool flag13 = false;
				if (Main.rand.Next(8) == 0)
				{
					Point bookPosition = Point.Zero;
					if (AI_FindNearbyBook(new Point(spawnTileX - 16, spawnTileY - 16), 32, 32, out bookPosition, closestBook: true, checkPlayerScreenRanges: true))
					{
						SpawnNPC(bookPosition.X * 16 + 8, bookPosition.Y * 16, 694, 0, 0f, 0f, 0f, 3f);
						flag13 = true;
					}
				}
				else if (Main.rand.Next(10) == 0)
				{
					Point bookPosition2 = Point.Zero;
					if (AI_FindNearbyBook(new Point(spawnTileX - 16, spawnTileY - 16), 32, 32, out bookPosition2, closestBook: true, checkPlayerScreenRanges: true))
					{
						SpawnNPC(bookPosition2.X * 16 + 8, bookPosition2.Y * 16, 693);
						flag13 = true;
					}
				}
				int num44 = Main.rand.Next(5);
				if (flag13)
				{
					return;
				}
				switch (num44)
				{
				case 0:
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 294);
					return;
				case 1:
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 295);
					return;
				case 2:
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 296);
					return;
				}
				if (Main.rand.Next(4) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -14);
				}
				else if (Main.rand.Next(5) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -13);
				}
				else
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 31);
				}
			}
			else if (ZoneMeteor)
			{
				SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 23);
			}
			else
			{
				if (DD2Event.Ongoing && ZoneOldOneArmy)
				{
					return;
				}
				if ((Main.remixWorld || (double)spawnTileY <= Main.worldSurface) && !Main.dayTime && Main.snowMoon)
				{
					int waveNumber = NPC.waveNumber;
					if (Main.rand.Next(30) == 0 && CountNPCS(341) < 4)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 341);
						return;
					}
					if (waveNumber >= 20)
					{
						int num45 = Main.rand.Next(3);
						if (!reachedInvasionBossCap)
						{
							switch (num45)
							{
							case 0:
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 345);
								break;
							case 1:
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 346);
								break;
							default:
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 344);
								break;
							}
						}
						return;
					}
					if (waveNumber >= 19)
					{
						if (Main.rand.Next(10) == 0 && CountNPCS(345) < 4)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 345);
						}
						else if (Main.rand.Next(10) == 0 && CountNPCS(346) < 5)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 346);
						}
						else if (Main.rand.Next(10) == 0 && CountNPCS(344) < 7)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 344);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 343);
						}
						return;
					}
					if (waveNumber >= 18)
					{
						if (Main.rand.Next(10) == 0 && CountNPCS(345) < 3)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 345);
						}
						else if (Main.rand.Next(10) == 0 && CountNPCS(346) < 4)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 346);
						}
						else if (Main.rand.Next(10) == 0 && CountNPCS(344) < 6)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 344);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 348);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 351);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 343);
						}
						return;
					}
					if (waveNumber >= 17)
					{
						if (Main.rand.Next(10) == 0 && CountNPCS(345) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 345);
						}
						else if (Main.rand.Next(10) == 0 && CountNPCS(346) < 3)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 346);
						}
						else if (Main.rand.Next(10) == 0 && CountNPCS(344) < 5)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 344);
						}
						else if (Main.rand.Next(4) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 347);
						}
						else if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 351);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 343);
						}
						return;
					}
					if (waveNumber >= 16)
					{
						if (Main.rand.Next(10) == 0 && CountNPCS(345) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 345);
						}
						else if (Main.rand.Next(10) == 0 && CountNPCS(346) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 346);
						}
						else if (Main.rand.Next(10) == 0 && CountNPCS(344) < 4)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 344);
						}
						else if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 352);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 343);
						}
						return;
					}
					if (waveNumber >= 15)
					{
						if (Main.rand.Next(10) == 0 && !AnyNPCs(345))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 345);
						}
						else if (Main.rand.Next(10) == 0 && CountNPCS(346) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 346);
						}
						else if (Main.rand.Next(10) == 0 && CountNPCS(344) < 3)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 344);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 347);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 343);
						}
						return;
					}
					switch (waveNumber)
					{
					case 14:
						if (Main.rand.Next(10) == 0 && !AnyNPCs(345))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 345);
						}
						else if (Main.rand.Next(10) == 0 && !AnyNPCs(346))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 346);
						}
						else if (Main.rand.Next(10) == 0 && !AnyNPCs(344))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 344);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 343);
						}
						break;
					case 13:
						if (Main.rand.Next(10) == 0 && !AnyNPCs(345))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 345);
						}
						else if (Main.rand.Next(10) == 0 && !AnyNPCs(346))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 346);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 352);
						}
						else if (Main.rand.Next(6) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 343);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 342);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 347);
						}
						break;
					case 12:
						if (Main.rand.Next(10) == 0 && !AnyNPCs(345))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 345);
						}
						else if (Main.rand.Next(10) == 0 && !AnyNPCs(344))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 344);
						}
						else if (Main.rand.Next(8) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 343);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 342);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(338, 341));
						}
						break;
					case 11:
						if (Main.rand.Next(10) == 0 && !AnyNPCs(345))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 345);
						}
						else if (Main.rand.Next(6) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 352);
						}
						else if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 342);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(338, 341));
						}
						break;
					case 10:
						if (Main.rand.Next(10) == 0 && !AnyNPCs(346))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 346);
						}
						else if (Main.rand.Next(10) == 0 && CountNPCS(344) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 344);
						}
						else if (Main.rand.Next(6) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 351);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 348);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 347);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(338, 341));
						}
						break;
					case 9:
						if (Main.rand.Next(10) == 0 && !AnyNPCs(346))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 346);
						}
						else if (Main.rand.Next(10) == 0 && !AnyNPCs(344))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 344);
						}
						else if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 348);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 347);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 342);
						}
						break;
					case 8:
						if (Main.rand.Next(10) == 0 && !AnyNPCs(346))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 346);
						}
						else if (Main.rand.Next(8) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 351);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 348);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 347);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 350);
						}
						break;
					case 7:
						if (Main.rand.Next(10) == 0 && !AnyNPCs(346))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 346);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 342);
						}
						else if (Main.rand.Next(4) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 350);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(338, 341));
						}
						break;
					case 6:
						if (Main.rand.Next(10) == 0 && CountNPCS(344) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 344);
						}
						else if (Main.rand.Next(4) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 347);
						}
						else if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 348);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 350);
						}
						break;
					case 5:
						if (Main.rand.Next(10) == 0 && !AnyNPCs(344))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 344);
						}
						else if (Main.rand.Next(4) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 350);
						}
						else if (Main.rand.Next(8) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 348);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(338, 341));
						}
						break;
					case 4:
						if (Main.rand.Next(10) == 0 && !AnyNPCs(344))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 344);
						}
						else if (Main.rand.Next(4) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 350);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 342);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(338, 341));
						}
						break;
					case 3:
						if (Main.rand.Next(8) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 348);
						}
						else if (Main.rand.Next(4) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 350);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 342);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(338, 341));
						}
						break;
					case 2:
						if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 350);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(338, 341));
						}
						break;
					default:
						if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 342);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(338, 341));
						}
						break;
					}
				}
				else if ((Main.remixWorld || (double)spawnTileY <= Main.worldSurface) && !Main.dayTime && Main.pumpkinMoon)
				{
					int waveNumber2 = NPC.waveNumber;
					if (NPC.waveNumber >= 20)
					{
						if (!reachedInvasionBossCap)
						{
							if (Main.rand.Next(2) == 0 && CountNPCS(327) < 2)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 327);
							}
							else if (Main.rand.Next(3) != 0 && CountNPCS(325) < 2)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 325);
							}
							else if (CountNPCS(315) < 3)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 315);
							}
						}
						return;
					}
					switch (waveNumber2)
					{
					case 19:
						if (Main.rand.Next(5) == 0 && CountNPCS(327) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 327);
						}
						else if (Main.rand.Next(5) == 0 && CountNPCS(325) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 325);
						}
						else if (!reachedInvasionBossCap && CountNPCS(315) < 5)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 315);
						}
						break;
					case 18:
						if (Main.rand.Next(7) == 0 && CountNPCS(327) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 327);
						}
						if (Main.rand.Next(7) == 0 && CountNPCS(325) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 325);
						}
						else if (Main.rand.Next(7) == 0 && CountNPCS(315) < 3)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 315);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 330);
						}
						break;
					case 17:
						if (Main.rand.Next(7) == 0 && CountNPCS(327) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 327);
						}
						if (Main.rand.Next(7) == 0 && CountNPCS(325) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 325);
						}
						else if (Main.rand.Next(7) == 0 && CountNPCS(315) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 315);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 330);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 329);
						}
						break;
					case 16:
						if (Main.rand.Next(10) == 0 && CountNPCS(327) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 327);
						}
						else if (Main.rand.Next(10) == 0 && CountNPCS(315) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 315);
						}
						else if (Main.rand.Next(6) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 330);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 329);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 326);
						}
						break;
					case 15:
						if (Main.rand.Next(10) == 0 && !AnyNPCs(327))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 327);
						}
						if (Main.rand.Next(7) == 0 && CountNPCS(325) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 325);
						}
						else if (Main.rand.Next(5) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 330);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 326);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(305, 315));
						}
						break;
					case 14:
						if (Main.rand.Next(10) == 0 && !AnyNPCs(327))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 327);
						}
						if (Main.rand.Next(7) == 0 && CountNPCS(325) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 325);
						}
						else if (Main.rand.Next(10) == 0 && !AnyNPCs(315))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 315);
						}
						else if (Main.rand.Next(10) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 330);
						}
						else if (Main.rand.Next(7) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 329);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 326);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(305, 315));
						}
						break;
					case 13:
						if (Main.rand.Next(7) == 0 && CountNPCS(325) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 325);
						}
						else if (Main.rand.Next(10) == 0 && CountNPCS(315) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 315);
						}
						else if (Main.rand.Next(6) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 330);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 329);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 326);
						}
						break;
					case 12:
						if (Main.rand.Next(5) == 0 && !AnyNPCs(327))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 327);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 330);
						}
						break;
					case 11:
						if (Main.rand.Next(7) == 0 && CountNPCS(325) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 325);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 330);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 326);
						}
						break;
					case 10:
						if (Main.rand.Next(10) == 0 && !AnyNPCs(327))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 327);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 329);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(305, 315));
						}
						break;
					case 9:
						if (Main.rand.Next(10) == 0 && CountNPCS(325) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 325);
						}
						else if (Main.rand.Next(8) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 330);
						}
						else if (Main.rand.Next(5) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 329);
						}
						else if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 326);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(305, 315));
						}
						break;
					case 8:
						if (Main.rand.Next(8) == 0 && CountNPCS(315) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 315);
						}
						else if (Main.rand.Next(4) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 330);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 329);
						}
						break;
					case 7:
						if (Main.rand.Next(7) == 0 && CountNPCS(325) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 325);
						}
						else if (Main.rand.Next(4) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 330);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 329);
						}
						break;
					case 6:
						if (Main.rand.Next(7) == 0 && CountNPCS(325) < 2)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 325);
						}
						else if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 326);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(305, 315));
						}
						break;
					case 5:
						if (Main.rand.Next(10) == 0 && !AnyNPCs(315))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 315);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 329);
						}
						break;
					case 4:
						if (Main.rand.Next(8) == 0 && !AnyNPCs(325))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 330);
						}
						else if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 326);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(305, 315));
						}
						break;
					case 3:
						if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 329);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 326);
						}
						break;
					case 2:
						if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 326);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(305, 315));
						}
						break;
					default:
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(305, 315));
						break;
					}
				}
				else if (((double)spawnTileY <= Main.worldSurface || (Main.remixWorld && (double)spawnTileY > Main.rockLayer)) && Main.dayTime && Main.eclipse)
				{
					bool flag14 = false;
					if (downedMechBoss1 && downedMechBoss2 && downedMechBoss3)
					{
						flag14 = true;
					}
					if (downedPlantBoss && Main.rand.Next(80) == 0 && !AnyNPCs(477))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 477);
					}
					else if (Main.rand.Next(50) == 0 && !AnyNPCs(251))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 251);
					}
					else if (downedPlantBoss && Main.rand.Next(5) == 0 && !AnyNPCs(466))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 466);
					}
					else if (downedPlantBoss && Main.rand.Next(20) == 0 && !AnyNPCs(463))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 463);
					}
					else if (downedPlantBoss && Main.rand.Next(20) == 0 && CountNPCS(467) < 2)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 467);
					}
					else if (Main.rand.Next(15) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 159);
					}
					else if (flag14 && Main.rand.Next(13) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 253);
					}
					else if (Main.rand.Next(8) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 469);
					}
					else if (downedPlantBoss && Main.rand.Next(7) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 468);
					}
					else if (downedPlantBoss && Main.rand.Next(5) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 460);
					}
					else if (Main.rand.Next(4) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 162);
					}
					else if (Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 461);
					}
					else if (Main.rand.Next(2) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 462);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 166);
					}
				}
				else if (CheckToSpawnUndergroundFairy(spawnTileX, spawnTileY))
				{
					int type3 = Main.rand.Next(583, 586);
					if (Main.tenthAnniversaryWorld && !Main.getGoodWorld && Main.rand.Next(4) != 0)
					{
						type3 = 583;
					}
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, type3, 0, 0f, 0f, 2f).TargetClosest();
				}
				else if (!Main.remixWorld && !waterTile && (!Main.dayTime || Main.tile[spawnTileX, spawnTileY].wall > 0) && livingTree && !Main.eclipse && !Main.bloodMoon && RollLuck(gnomeChance * 3) == 0 && CountNPCS(624) <= Main.rand.Next(3))
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 624);
				}
				else if (!ZoneCorrupt && !ZoneCrimson && !waterTile && !Main.eclipse && !Main.bloodMoon && RollLuck(gnomeChance) == 0 && ((!Main.remixWorld && (double)spawnTileY >= Main.worldSurface * 0.800000011920929 && (double)spawnTileY < Main.worldSurface * 1.100000023841858) || (Main.remixWorld && (double)spawnTileY > Main.rockLayer && spawnTileY < Main.maxTilesY - 350)) && CountNPCS(624) <= Main.rand.Next(3) && (!Main.dayTime || Main.tile[spawnTileX, spawnTileY].wall > 0) && (Main.tile[spawnTileX, spawnTileY].wall == 63 || Main.tile[spawnTileX, spawnTileY].wall == 2 || Main.tile[spawnTileX, spawnTileY].wall == 196 || Main.tile[spawnTileX, spawnTileY].wall == 197 || Main.tile[spawnTileX, spawnTileY].wall == 198 || Main.tile[spawnTileX, spawnTileY].wall == 199))
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 624);
				}
				else if (Main.hardMode && spawnTileType == 70 && waterTile)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 256);
				}
				else if (spawnTileType == 70 && (double)spawnTileY <= Main.worldSurface && Main.rand.Next(3) != 0)
				{
					if ((!Main.hardMode && Main.rand.Next(6) == 0) || Main.rand.Next(12) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 360);
					}
					else if (Main.rand.Next(3) == 0)
					{
						if (Main.rand.Next(4) == 0)
						{
							if (Main.hardMode && Main.rand.Next(3) != 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 260, 0, spawnTileX, spawnTileY);
							}
							else
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 259, 0, spawnTileX, spawnTileY);
							}
						}
						else if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 257);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 258);
						}
					}
					else if (Main.rand.Next(2) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 254);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 255);
					}
				}
				else if (spawnTileType == 70 && Main.hardMode && (double)spawnTileY >= Main.worldSurface && Main.rand.Next(3) != 0 && (!Main.remixWorld || Main.getGoodWorld || spawnTileY < Main.maxTilesY - 360))
				{
					if (Main.hardMode && RollLuck(5) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 374);
					}
					else if ((!Main.hardMode && Main.rand.Next(4) == 0) || Main.rand.Next(8) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 360);
					}
					else if (Main.rand.Next(4) == 0)
					{
						if (Main.hardMode && Main.rand.Next(3) != 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 260, 0, spawnTileX, spawnTileY);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 259, 0, spawnTileX, spawnTileY);
						}
					}
					else if (Main.rand.Next(2) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 257);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 258);
					}
				}
				else if (ZoneCorrupt && Main.rand.Next(maxValue) == 0 && !noWorms && CanSpawnDevourer(spawnTileX))
				{
					if (Main.hardMode && Main.rand.Next(4) != 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 98);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 7);
					}
				}
				else if (Main.remixWorld && !Main.hardMode && (double)spawnTileY > Main.worldSurface && RollLuck(100) == 0)
				{
					if (ZoneSnow)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 629);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 85);
					}
				}
				else if (WorldGen.Skyblock.lowTiles && !Main.remixWorld && !Main.hardMode && (double)spawnTileY > Main.rockLayer && RollLuck(100) == 0 && !AnyNPCs(85) && !AnyNPCs(629))
				{
					if (ZoneSnow)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 629);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 85);
					}
				}
				else if (Main.hardMode && (double)spawnTileY > Main.worldSurface && RollLuck(Main.tenthAnniversaryWorld ? 50 : 75) == 0)
				{
					if (Main.rand.Next(2) == 0 && ZoneCorrupt && !AnyNPCs(473))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 473);
					}
					else if (Main.rand.Next(2) == 0 && ZoneCrimson && !AnyNPCs(474))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 474);
					}
					else if (Main.rand.Next(2) == 0 && ZoneHallow && !AnyNPCs(475))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 475);
					}
					else if (Main.tenthAnniversaryWorld && Main.rand.Next(2) == 0 && ZoneJungle && !AnyNPCs(476))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 476);
					}
					else if (ZoneSnow)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 629);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 85);
					}
				}
				else if (Main.hardMode && Main.tile[spawnTileX, spawnTileY].wall == 2 && Main.rand.Next(20) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 85);
				}
				else if (Main.hardMode && surfaceSpawn && !Main.dayTime && (Main.rand.Next(20) == 0 || (Main.rand.Next(5) == 0 && Main.moonPhase == 4)))
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 82);
				}
				else if (spawnTileType == 60 && RollLuck(500) == 0 && !Main.dayTime)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 52);
				}
				else if (spawnTileType == 60 && (double)spawnTileY > Main.worldSurface && Main.rand.Next(60) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 219);
				}
				else if ((double)spawnTileY > Main.worldSurface && spawnTileY < Main.maxTilesY - 210 && !ZoneSnow && !ZoneCrimson && !ZoneCorrupt && !ZoneJungle && !ZoneHallow && Main.rand.Next(8) == 0)
				{
					if (RollLuck(goldCritterChance) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 448);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 357);
					}
				}
				else if ((double)spawnTileY > Main.worldSurface && spawnTileY < Main.maxTilesY - 210 && !ZoneSnow && !ZoneCrimson && !ZoneCorrupt && !ZoneJungle && !ZoneHallow && Main.rand.Next(13) == 0)
				{
					if (RollLuck(goldCritterChance) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 447);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 300);
					}
				}
				else if ((double)spawnTileY > Main.worldSurface && (double)spawnTileY < (Main.rockLayer + (double)Main.maxTilesY) / 2.0 && !ZoneSnow && !ZoneCrimson && !ZoneCorrupt && !ZoneHallow && Main.rand.Next(13) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 359);
				}
				else if (surfaceSpawn && ZoneJungle && !ZoneCrimson && !ZoneCorrupt && Main.rand.Next(7) == 0)
				{
					if (Main.dayTime && Main.time < 43200.00064373016 && Main.rand.Next(3) != 0)
					{
						switch (Main.rand.Next(5))
						{
						case 0:
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 671);
							break;
						case 1:
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 672);
							break;
						case 2:
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 673);
							break;
						case 3:
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 674);
							break;
						default:
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 675);
							break;
						}
					}
					else
					{
						SpawnFrog(spawnTileX, spawnTileY);
					}
				}
				else if (spawnTileType == 225 && Main.rand.Next(2) == 0)
				{
					if (Main.hardMode && Main.rand.Next(4) != 0)
					{
						if (Main.rand.Next(10) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -21);
						}
						else if (Main.rand.Next(10) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -20);
						}
						else if (Main.rand.Next(10) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -19);
						}
						else if (Main.rand.Next(10) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -18);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 176);
						}
					}
					else
					{
						SpawnHornet(spawnTileX, spawnTileY);
					}
				}
				else if (spawnTileType == 60 && Main.hardMode && Main.rand.Next(3) != 0)
				{
					if (surfaceSpawn && !Main.dayTime && Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 152);
					}
					else if (surfaceSpawn && Main.dayTime && Main.rand.Next(4) != 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 177);
					}
					else if ((double)spawnTileY > Main.worldSurface && Main.rand.Next(100) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 205);
					}
					else if ((double)spawnTileY > Main.worldSurface && Main.rand.Next(5) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 236);
					}
					else if ((double)spawnTileY > Main.worldSurface && Main.rand.Next(4) != 0)
					{
						if (Main.rand.Next(10) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -21);
						}
						else if (Main.rand.Next(10) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -20);
						}
						else if (Main.rand.Next(10) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -19);
						}
						else if (Main.rand.Next(10) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -18);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 176);
						}
					}
					else if (Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 175, 0, spawnTileX, spawnTileY);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 153);
					}
				}
				else if (((spawnTileType == 226 || spawnTileType == 232) && ZoneLihzhardTemple) || (Main.remixWorld && ZoneLihzhardTemple))
				{
					if (Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 226);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 198);
					}
				}
				else if (num == 86 && Main.rand.Next(8) != 0)
				{
					SpawnHornet(spawnTileX, spawnTileY);
				}
				else if (spawnTileType == 60 && ((!Main.remixWorld && (double)spawnTileY > (Main.worldSurface + Main.rockLayer) / 2.0) || (Main.remixWorld && ((double)spawnTileY < Main.rockLayer || Main.rand.Next(2) == 0))))
				{
					if (Main.rand.Next(4) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 204);
					}
					else if (Main.rand.Next(4) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 43, 0, spawnTileX, spawnTileY);
					}
					else
					{
						SpawnHornet(spawnTileX, spawnTileY);
					}
				}
				else if (spawnTileType == 60 && Main.rand.Next(4) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 51);
				}
				else if (spawnTileType == 60 && Main.rand.Next(8) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 56, 0, spawnTileX, spawnTileY);
				}
				else if (Sandstorm.Happening && ZoneSandstorm && TileID.Sets.Conversion.Sand[spawnTileType] && Spawning_SandstoneCheck(spawnTileX, spawnTileY))
				{
					if (!downedBoss1 && !Main.hardMode)
					{
						if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 546);
						}
						else if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 61);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 69);
						}
					}
					else if (Main.hardMode && Main.rand.Next(20) == 0 && !AnyNPCs(541))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 541);
					}
					else if (Main.hardMode && !noWorms && Main.rand.Next(3) == 0 && CountNPCS(510) < 4)
					{
						SpawnNPC(spawnTileX * 16 + 8, (spawnTileY + 10) * 16, 510);
					}
					else if (Main.hardMode && !noWorms && Main.rand.Next(2) == 0)
					{
						int type4 = 542;
						if (TileID.Sets.Corrupt[spawnTileType])
						{
							type4 = 543;
						}
						if (TileID.Sets.Crimson[spawnTileType])
						{
							type4 = 544;
						}
						if (TileID.Sets.Hallow[spawnTileType])
						{
							type4 = 545;
						}
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, type4);
					}
					else if (Main.hardMode && spawnTileType == 53 && Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 78);
					}
					else if (Main.hardMode && spawnTileType == 112 && Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 79);
					}
					else if (Main.hardMode && spawnTileType == 234 && Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 630);
					}
					else if (Main.hardMode && spawnTileType == 116 && Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 80);
					}
					else if (Main.rand.Next(2) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 546);
					}
					else if (Main.rand.Next(2) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 580);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 581);
					}
				}
				else if (Main.hardMode && spawnTileType == 53 && Main.rand.Next(3) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 78);
				}
				else if (Main.hardMode && spawnTileType == 112 && Main.rand.Next(2) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 79);
				}
				else if (Main.hardMode && spawnTileType == 234 && Main.rand.Next(2) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 630);
				}
				else if (Main.hardMode && spawnTileType == 116 && Main.rand.Next(2) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 80);
				}
				else if (((Main.hardMode && underGround) || (Main.remixWorld && Main.rand.Next(2) == 0)) && !waterTile && (spawnTileType == 116 || spawnTileType == 117 || spawnTileType == 109 || spawnTileType == 164))
				{
					if (downedPlantBoss && (Main.remixWorld || (!Main.dayTime && Main.time < 16200.0)) && surfaceSpawn && RollLuck(10) == 0 && !AnyNPCs(661))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 661);
					}
					else if (raining && !AnyNPCs(244) && RollLuck(10) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 244);
					}
					else if (!Main.dayTime && Main.rand.Next(2) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 122);
					}
					else if (Main.rand.Next(10) == 0 || (ZoneWaterCandle && Main.rand.Next(10) == 0))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 86);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 75);
					}
				}
				else if (!noWorms && Main.hardMode && Main.rand.Next(50) == 0 && !waterTile && deeperThanRockLayer && (spawnTileType == 116 || spawnTileType == 117 || spawnTileType == 109 || spawnTileType == 164))
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 84);
				}
				else if ((spawnTileType == 204 && ZoneCrimson) || spawnTileType == 199 || spawnTileType == 200 || spawnTileType == 203 || spawnTileType == 234 || spawnTileType == 662 || (Main.remixWorld && spawnTileType == 195))
				{
					bool flag15 = (double)spawnTileY >= Main.rockLayer;
					if (Main.remixWorld)
					{
						flag15 = (double)spawnTileY <= Main.rockLayer;
					}
					if (Main.hardMode && flag15 && Main.rand.Next(40) == 0 && !noWorms)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 179);
					}
					else if (Main.hardMode && flag15 && Main.rand.Next(5) == 0 && !noWorms)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 182);
					}
					else if (Main.hardMode && flag15 && Main.rand.Next(2) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 268);
					}
					else if (Main.hardMode && Main.rand.Next(3) == 0)
					{
						if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -24);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -25);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 183);
						}
					}
					else if (Main.hardMode && (Main.rand.Next(2) == 0 || ((double)spawnTileY > Main.worldSurface && !Main.remixWorld)))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 174);
					}
					else if ((Main.tile[spawnTileX, spawnTileY].wall > 0 && Main.rand.Next(4) != 0) || Main.rand.Next(8) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 239);
					}
					else if (Main.rand.Next(2) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 181);
					}
					else if (Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -22);
					}
					else if (Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -23);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 173);
					}
				}
				else if ((spawnTileType == 22 && ZoneCorrupt) || spawnTileType == 23 || spawnTileType == 25 || spawnTileType == 112 || spawnTileType == 163 || spawnTileType == 661 || (Main.remixWorld && spawnTileType == 474))
				{
					bool flag16 = (double)spawnTileY >= Main.rockLayer;
					if (Main.remixWorld)
					{
						flag16 = (double)spawnTileY <= Main.rockLayer;
					}
					if (Main.hardMode && flag16 && Main.rand.Next(40) == 0 && !noWorms)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 83);
					}
					else if (Main.hardMode && flag16 && Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 101, 0, spawnTileX, spawnTileY);
					}
					else if (Main.hardMode && Main.rand.Next(3) == 0)
					{
						if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 121);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 81);
						}
					}
					else if (Main.hardMode && (Main.rand.Next(2) == 0 || flag16))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 94);
					}
					else if (Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -11);
					}
					else if (Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -12);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 6);
					}
				}
				else if (surfaceSpawn)
				{
					bool flag17 = (float)Math.Abs(spawnTileX - Main.maxTilesX / 2) / (float)(Main.maxTilesX / 2) > 0.33f;
					if (flag17 && AnyDanger())
					{
						flag17 = false;
					}
					if (ZoneGraveyard && !waterTile && (spawnTileType == 2 || spawnTileType == 477) && Main.rand.Next(10) == 0)
					{
						if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 606);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 610);
						}
						return;
					}
					if (ZoneSnow && Main.hardMode && raining && !AnyNPCs(243) && RollLuck(20) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 243);
						return;
					}
					if (!ZoneSnow && Main.hardMode && raining && CountNPCS(250) < 2 && Main.rand.Next(10) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 250);
						return;
					}
					if (flag17 && Main.hardMode && downedGolemBoss && ((!downedMartians && Main.rand.Next(100) == 0) || Main.rand.Next(400) == 0) && !AnyNPCs(399))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 399);
						return;
					}
					if (!ZoneGraveyard && Main.dayTime)
					{
						int num46 = Math.Abs(spawnTileX - Main.spawnTileX);
						if (!waterTile && num46 < Main.maxTilesX / 2 && Main.rand.Next(15) == 0 && (spawnTileType == 2 || spawnTileType == 477 || spawnTileType == 109 || spawnTileType == 492 || spawnTileType == 147 || spawnTileType == 161))
						{
							if (spawnTileType == 147 || spawnTileType == 161)
							{
								if (Main.rand.Next(2) == 0)
								{
									SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 148);
								}
								else
								{
									SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 149);
								}
							}
							else if (!tooWindyForButterflies && !raining && Main.dayTime && Main.rand.Next(stinkBugChance) == 0 && surfaceSpawn)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 669);
								if (Main.rand.Next(4) == 0)
								{
									SpawnNPC(spawnTileX * 16 + 8 - 16, spawnTileY * 16, 669);
								}
								if (Main.rand.Next(4) == 0)
								{
									SpawnNPC(spawnTileX * 16 + 8 + 16, spawnTileY * 16, 669);
								}
							}
							else if (!tooWindyForButterflies && !raining && Main.dayTime && Main.rand.Next(butterflyChance) == 0 && surfaceSpawn)
							{
								if (RollLuck(goldCritterChance) == 0)
								{
									SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 444);
								}
								else
								{
									SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 356);
								}
								if (Main.rand.Next(4) == 0)
								{
									SpawnNPC(spawnTileX * 16 + 8 - 16, spawnTileY * 16, 356);
								}
								if (Main.rand.Next(4) == 0)
								{
									SpawnNPC(spawnTileX * 16 + 8 + 16, spawnTileY * 16, 356);
								}
							}
							else if (tooWindyForButterflies && !raining && Main.dayTime && Main.rand.Next(butterflyChance / 2) == 0 && surfaceSpawn)
							{
								if (RollLuck(goldCritterChance) == 0)
								{
									SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 605);
								}
								else
								{
									SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 604);
								}
								if (Main.rand.Next(3) != 0)
								{
									SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 604);
								}
								if (Main.rand.Next(2) == 0)
								{
									SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 604);
								}
								if (Main.rand.Next(3) == 0)
								{
									SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 604);
								}
								if (Main.rand.Next(4) == 0)
								{
									SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 604);
								}
							}
							else if (RollLuck(goldCritterChance) == 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 443);
							}
							else if (RollLuck(goldCritterChance) == 0 && (double)spawnTileY <= Main.worldSurface)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 539);
							}
							else if (Main.halloween && Main.rand.Next(3) != 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 303);
							}
							else if (Main.xMas && Main.rand.Next(3) != 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 337);
							}
							else if (BirthdayParty.PartyIsUp && Main.rand.Next(3) != 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 540);
							}
							else if (Main.rand.Next(3) == 0 && (double)spawnTileY <= Main.worldSurface)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Utils.SelectRandom(Main.rand, new short[2] { 299, 538 }));
							}
							else
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 46);
							}
						}
						else if (!waterTile && spawnTileX > WorldGen.beachDistance && spawnTileX < Main.maxTilesX - WorldGen.beachDistance && Main.rand.Next(12) == 0 && spawnTileType == 53)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(366, 368));
						}
						else if ((spawnTileType == 2 || spawnTileType == 477 || spawnTileType == 53) && !tooWindyForButterflies && !raining && Main.dayTime && Main.rand.Next(3) != 0 && ((double)spawnTileY <= Main.worldSurface || Main.remixWorld) && FindCattailTop(spawnTileX, spawnTileY, out cattailX, out cattailY))
						{
							if (RollLuck(goldCritterChance) == 0)
							{
								SpawnNPC(cattailX * 16 + 8, cattailY * 16, 601);
							}
							else
							{
								SpawnNPC(cattailX * 16 + 8, cattailY * 16, RollDragonflyType(spawnTileType));
							}
							if (Main.rand.Next(3) == 0)
							{
								SpawnNPC(cattailX * 16 + 8 - 16, cattailY * 16, RollDragonflyType(spawnTileType));
							}
							if (Main.rand.Next(3) == 0)
							{
								SpawnNPC(cattailX * 16 + 8 + 16, cattailY * 16, RollDragonflyType(spawnTileType));
							}
						}
						else if (!waterTile && num46 < Main.maxTilesX / 3 && Main.dayTime && Main.time < 18000.0 && (spawnTileType == 2 || spawnTileType == 477 || spawnTileType == 109 || spawnTileType == 492) && Main.rand.Next(4) == 0 && (double)spawnTileY <= Main.worldSurface && CountNPCS(74) + CountNPCS(297) + CountNPCS(298) < 6)
						{
							int num47 = Main.rand.Next(4);
							if (RollLuck(goldCritterChance) == 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 442);
								return;
							}
							switch (num47)
							{
							case 0:
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 297);
								break;
							case 1:
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 298);
								break;
							default:
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 74);
								break;
							}
						}
						else if (!waterTile && num46 < Main.maxTilesX / 3 && Main.rand.Next(15) == 0 && (spawnTileType == 2 || spawnTileType == 477 || spawnTileType == 109 || spawnTileType == 492 || spawnTileType == 147))
						{
							int num48 = Main.rand.Next(4);
							if (RollLuck(goldCritterChance) == 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 442);
								return;
							}
							switch (num48)
							{
							case 0:
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 297);
								break;
							case 1:
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 298);
								break;
							default:
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 74);
								break;
							}
						}
						else if (!waterTile && num46 > Main.maxTilesX / 3 && spawnTileType == 2 && Main.rand.Next(300) == 0 && !AnyNPCs(50))
						{
							SpawnOnPlayer(target, 50);
						}
						else if (!waterTile && num46 > Main.maxTilesX / 8 && (spawnTileType == 2 || spawnTileType == 147 || spawnTileType == 60 || spawnTileType == 161) && Main.rand.Next(200) == 0 && !AnyNPCs(696) && !AnyNPCs(695))
						{
							short type5 = 695;
							if (RollLuck(100) < 40)
							{
								type5 = 696;
							}
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, type5);
						}
						else if (!xRange && spawnTileType == 53 && (spawnTileX < WorldGen.beachDistance || spawnTileX > Main.maxTilesX - WorldGen.beachDistance))
						{
							if (!waterTile && Main.rand.Next(10) == 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 602);
							}
							else
							{
								if (!waterTile)
								{
									return;
								}
								int num49 = -1;
								int num50 = -1;
								if ((double)spawnTileY < Main.worldSurface && spawnTileY > 50)
								{
									for (int num51 = spawnTileY - 1; num51 > spawnTileY - 50; num51--)
									{
										if (Main.tile[spawnTileX, num51].liquid == 0 && !WorldGen.SolidTile(spawnTileX, num51) && !WorldGen.SolidTile(spawnTileX, num51 + 1) && !WorldGen.SolidTile(spawnTileX, num51 + 2))
										{
											num49 = num51 + 2;
											if (!WorldGen.SolidTile(spawnTileX, num49 + 1) && !WorldGen.SolidTile(spawnTileX, num49 + 2))
											{
												num50 = num49 + 2;
											}
											break;
										}
									}
									if (num49 > spawnTileY)
									{
										num49 = spawnTileY;
									}
									if (num50 > spawnTileY)
									{
										num50 = spawnTileY;
									}
								}
								if (Main.rand.Next(10) != 0)
								{
									return;
								}
								int num52 = Main.rand.Next(4);
								if (num52 == 0 && num49 > 0)
								{
									SpawnNPC(spawnTileX * 16 + 8, num49 * 16, 625);
									return;
								}
								if (num52 == 1 && num50 > 0)
								{
									SpawnNPC(spawnTileX * 16 + 8, num50 * 16, 615);
									return;
								}
								switch (num52)
								{
								case 2:
								{
									int num54 = spawnTileY;
									if (num50 > 0)
									{
										num54 = num50;
									}
									if (RollLuck(goldCritterChance) == 0)
									{
										SpawnNPC(spawnTileX * 16 + 8, num54 * 16, 627);
									}
									else
									{
										SpawnNPC(spawnTileX * 16 + 8, num54 * 16, 626);
									}
									break;
								}
								case 3:
								{
									int num53 = spawnTileY;
									if (num50 > 0)
									{
										num53 = num50;
									}
									SpawnNPC(spawnTileX * 16 + 8, num53 * 16, 688);
									break;
								}
								}
							}
						}
						else if (!waterTile && spawnTileType == 53 && Main.rand.Next(5) == 0 && Spawning_SandstoneCheck(spawnTileX, spawnTileY) && !waterTile)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 69);
						}
						else if (spawnTileType == 53 && !waterTile)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 61);
						}
						else if (!waterTile && (num46 > Main.maxTilesX / 3 || Main.remixWorld) && (Main.rand.Next(15) == 0 || (!downedGoblins && WorldGen.shadowOrbSmashed && Main.rand.Next(7) == 0)))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 73);
						}
						else if (raining && Main.rand.Next(4) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 224);
						}
						else if (!waterTile && raining && Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 225);
						}
						else if (!waterTile && num == 0 && Main.IsItAHappyWindyDay && isSpawningInWindDirection && Main.rand.Next(3) != 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 594);
						}
						else if (!waterTile && num == 0 && (spawnTileType == 2 || spawnTileType == 477) && Main.IsItAHappyWindyDay && isSpawningInWindDirection && Main.rand.Next(10) != 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 628);
						}
						else if (!waterTile)
						{
							int basicSlimeToSpawn = GetBasicSlimeToSpawn(surface: true, spawnTileType, num46);
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, basicSlimeToSpawn);
						}
						return;
					}
					if (ZoneGraveyard)
					{
						defaultTarget = target;
					}
					if (!ZoneGraveyard && !tooWindyForButterflies && (spawnTileType == 2 || spawnTileType == 477 || spawnTileType == 109 || spawnTileType == 492) && !raining && Main.rand.Next(fireFlyChance) == 0 && (double)spawnTileY <= Main.worldSurface)
					{
						int type6 = 355;
						if (spawnTileType == 109)
						{
							type6 = 358;
						}
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, type6);
						if (Main.rand.Next(fireFlyMultiple) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8 - 16, spawnTileY * 16, type6);
						}
						if (Main.rand.Next(fireFlyMultiple) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8 + 16, spawnTileY * 16, type6);
						}
						if (Main.rand.Next(fireFlyMultiple) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16 - 16, type6);
						}
						if (Main.rand.Next(fireFlyMultiple) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16 + 16, type6);
						}
						return;
					}
					if ((Main.halloween || ZoneGraveyard) && Main.rand.Next(12) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 301);
						return;
					}
					if (ZoneGraveyard && Main.rand.Next(30) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 316);
						return;
					}
					if ((Main.halloween || ZoneGraveyard) && Main.hardMode && Main.rand.Next(10) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 304);
						return;
					}
					if (Main.rand.Next(6) == 0 || (Main.moonPhase == 4 && Main.rand.Next(2) == 0))
					{
						if (Main.hardMode && Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 133);
							return;
						}
						if (Main.halloween && Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(317, 319));
							return;
						}
						if (Main.rand.Next(2) == 0)
						{
							if (Main.rand.Next(4) == 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -43);
							}
							else
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 2);
							}
							return;
						}
						switch (Main.rand.Next(5))
						{
						case 0:
							if (Main.rand.Next(3) == 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -38);
							}
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 190);
							break;
						case 1:
							if (Main.rand.Next(3) == 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -39);
							}
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 191);
							break;
						case 2:
							if (Main.rand.Next(3) == 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -40);
							}
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 192);
							break;
						case 3:
							if (Main.rand.Next(3) == 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -41);
							}
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 193);
							break;
						case 4:
							if (Main.rand.Next(3) == 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -42);
							}
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 194);
							break;
						}
						return;
					}
					if (Main.hardMode && Main.rand.Next(50) == 0 && Main.bloodMoon && !AnyNPCs(109))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 109);
						return;
					}
					if (RollOnlyBadLuck(300) == 0 && (Main.bloodMoon || ZoneGraveyard))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 53);
						return;
					}
					if (RollOnlyBadLuck(300) == 0 && (Main.bloodMoon || ZoneGraveyard))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 536);
						return;
					}
					if (!Main.dayTime && Main.moonPhase == 0 && Main.hardMode && Main.rand.Next(3) != 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 104);
						return;
					}
					if (!Main.dayTime && Main.hardMode && Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 140);
						return;
					}
					if (Main.bloodMoon && Main.rand.Next(5) < 2)
					{
						if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 489);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 490);
						}
						return;
					}
					if (TileID.Sets.IcesSnow[spawnTileType] || spawnTileType == 162)
					{
						if (!ZoneGraveyard && Main.hardMode && Main.rand.Next(4) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 169);
						}
						else if (!ZoneGraveyard && Main.hardMode && Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 155);
						}
						else if (spawnArmedZombies && Main.expertMode && Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 431);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 161);
						}
						return;
					}
					if (raining && Main.rand.Next(2) == 0)
					{
						if (Main.rand.Next(3) != 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 223);
						}
						else if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -54);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -55);
						}
						return;
					}
					if (!ZoneGraveyard && !waterTile && WorldGen.Skyblock.lowTiles && !DownedAnyPreHardmodeBoss && Main.rand.Next(3) == 0)
					{
						if (Main.rand.Next(2) == 0)
						{
							if (spawnArmedZombies && Main.expertMode && Main.rand.Next(2) == 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 591);
							}
							else
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 590);
							}
						}
						else
						{
							int spawnDist = Math.Abs(spawnTileX - Main.spawnTileX);
							int basicSlimeToSpawn2 = GetBasicSlimeToSpawn(surface: true, spawnTileType, spawnDist);
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, basicSlimeToSpawn2);
						}
						return;
					}
					if (ZoneGraveyard && RollOnlyBadLuckExtreme(200) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 691);
						return;
					}
					if (ZoneGraveyard && Main.rand.Next(maggotZombieChance) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 632);
						return;
					}
					if (Main.rand.Next(torchZombieChance) == 0)
					{
						if (spawnArmedZombies && Main.expertMode && Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 591);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 590);
						}
						return;
					}
					if (Main.halloween && Main.rand.Next(2) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(319, 322));
						return;
					}
					if (Main.xMas && Main.rand.Next(2) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(331, 333));
						return;
					}
					if (spawnArmedZombies && zombieStyle != 1 && Main.expertMode && Main.rand.Next(3) == 0)
					{
						short type7 = 430;
						switch (zombieStyle)
						{
						case 0:
							type7 = 430;
							break;
						case 2:
							type7 = 432;
							break;
						case 3:
							type7 = 433;
							break;
						case 4:
							type7 = 434;
							break;
						case 5:
							type7 = 435;
							break;
						case 6:
							type7 = 436;
							break;
						}
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, type7);
						return;
					}
					short type8 = 3;
					short num55 = -26;
					short num56 = -27;
					switch (zombieStyle)
					{
					case 0:
						type8 = 3;
						num55 = -26;
						num56 = -27;
						break;
					case 1:
						type8 = 132;
						num55 = -28;
						num56 = -29;
						break;
					case 2:
						type8 = 186;
						num55 = -30;
						num56 = -31;
						break;
					case 3:
						type8 = 187;
						num55 = -32;
						num56 = -33;
						break;
					case 4:
						type8 = 188;
						num55 = -34;
						num56 = -35;
						break;
					case 5:
						type8 = 189;
						num55 = -36;
						num56 = -37;
						break;
					case 6:
						type8 = 200;
						num55 = -44;
						num56 = -45;
						break;
					}
					if (Main.rand.Next(3) == 0)
					{
						type8 = ((Main.rand.Next(2) != 0) ? num56 : num55);
					}
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, type8);
				}
				else if (underGround)
				{
					if (!noWorms && Main.rand.Next(50) == 0 && !ZoneSnow)
					{
						if (Main.hardMode)
						{
							if (Main.rand.Next(3) != 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 95);
							}
							else
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 10);
							}
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 10);
						}
					}
					else if (Main.hardMode && Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 140);
					}
					else if (Main.hardMode && Main.rand.Next(2) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 141);
					}
					else if (Main.remixWorld)
					{
						if (spawnTileType == 147 || spawnTileType == 161 || spawnTileType == 163 || spawnTileType == 164 || spawnTileType == 162 || ZoneSnow)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 147);
						}
						else if (Main.rand.Next(3) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -9);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -8);
						}
					}
					else if (spawnTileType == 147 || spawnTileType == 161 || ZoneSnow)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 147);
					}
					else
					{
						int basicSlimeToSpawn3 = GetBasicSlimeToSpawn(surface: false, spawnTileType, -1);
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, basicSlimeToSpawn3);
					}
				}
				else if (spawnTileY > Main.maxTilesY - 190)
				{
					if (Main.remixWorld && (double)spawnTileX > (double)Main.maxTilesX * 0.38 + 50.0 && (double)spawnTileX < (double)Main.maxTilesX * 0.62)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 59);
					}
					else if (Main.hardMode && !savedTaxCollector && Main.rand.Next(20) == 0 && !AnyNPCs(534))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 534);
					}
					else if (Main.rand.Next(8) == 0)
					{
						SpawnLavaBaitCritters(spawnTileX, spawnTileY);
					}
					else if (Main.rand.Next(40) == 0 && !AnyNPCs(39))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 39);
					}
					else if (Main.rand.Next(14) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 24);
					}
					else if (Main.rand.Next(7) == 0)
					{
						if (Main.rand.Next(10) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 66);
						}
						else if (Main.hardMode && downedMechBossAny && Main.rand.Next(5) != 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 156);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 62);
						}
					}
					else if (Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 59);
					}
					else if (Main.hardMode && downedMechBossAny && Main.rand.Next(5) != 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 151);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 60);
					}
				}
				else if (CheckToSpawnRockGolem(spawnTileX, spawnTileY, spawnTileType))
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 631);
				}
				else if (Main.rand.Next(60) == 0)
				{
					if (ZoneSnow)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 218);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 217);
					}
				}
				else if ((spawnTileType == 116 || spawnTileType == 117 || spawnTileType == 164) && Main.hardMode && !noWorms && Main.rand.Next(8) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 120);
				}
				else if ((spawnTileType == 147 || spawnTileType == 161 || spawnTileType == 162 || spawnTileType == 163 || spawnTileType == 164 || spawnTileType == 200) && !noWorms && Main.hardMode && ZoneCorrupt && Main.rand.Next(30) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 170);
				}
				else if ((spawnTileType == 147 || spawnTileType == 161 || spawnTileType == 162 || spawnTileType == 163 || spawnTileType == 164 || spawnTileType == 200) && !noWorms && Main.hardMode && ZoneHallow && Main.rand.Next(30) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 171);
				}
				else if ((spawnTileType == 147 || spawnTileType == 161 || spawnTileType == 162 || spawnTileType == 163 || spawnTileType == 164 || spawnTileType == 200) && !noWorms && Main.hardMode && ZoneCrimson && Main.rand.Next(30) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 180);
				}
				else if (Main.hardMode && ZoneSnow && Main.rand.Next(10) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 154);
				}
				else if (!noWorms && Main.rand.Next(100) == 0 && !ZoneHallow)
				{
					if (Main.hardMode)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 95);
					}
					else if (ZoneSnow)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 185);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 10);
					}
				}
				else if (ZoneSnow && Main.rand.Next(20) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 185);
				}
				else if ((!Main.hardMode && Main.rand.Next(10) == 0) || (Main.hardMode && Main.rand.Next(20) == 0))
				{
					if (ZoneSnow || spawnTileType == 161 || spawnTileType == 147)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 184);
					}
					else if (Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -6);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 16);
					}
				}
				else if ((!Main.hardMode || WorldGen.Skyblock.lowTiles) && Main.rand.Next(4) == 0)
				{
					if (ZoneJungle)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -10);
					}
					else if (ZoneSnow || spawnTileType == 161 || spawnTileType == 147)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 184);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -6);
					}
				}
				else if (Main.rand.Next(2) == 0)
				{
					if (Main.rand.Next(35) == 0 && !ZoneShadowCandle && !waterTile && CountNPCS(453) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 453);
						return;
					}
					if (Main.rand.Next(80) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 195);
						return;
					}
					if (Main.hardMode && (Main.remixWorld || (double)spawnTileY > (Main.rockLayer + (double)Main.maxTilesY) / 2.0) && Main.rand.Next(200) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 172);
						return;
					}
					if ((Main.remixWorld || (double)spawnTileY > (Main.rockLayer + (double)Main.maxTilesY) / 2.0) && (Main.rand.Next(200) == 0 || (offensiveToTim && Main.rand.Next(50) == 0)))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 45);
						return;
					}
					if (nearMarble && Main.rand.Next(4) != 0)
					{
						if (Main.rand.Next(6) != 0 && !AnyNPCs(480) && Main.hardMode)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 480);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 481);
						}
						return;
					}
					if (nearGranite && Main.rand.Next(5) != 0)
					{
						if (Main.rand.Next(6) != 0 && !AnyNPCs(483))
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 483);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 482);
						}
						return;
					}
					if (Main.hardMode && Main.rand.Next(10) != 0)
					{
						if (Main.rand.Next(2) == 0)
						{
							if (ZoneSnow)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 197);
							}
							else if ((Main.remixWorld || (double)spawnTileY > (Main.rockLayer + (double)Main.maxTilesY) / 2.0) && Main.rand.Next(5) == 0)
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -15);
							}
							else
							{
								SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 77);
							}
						}
						else if (ZoneSnow)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 206);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 110);
						}
						return;
					}
					if (!noWorms && (Main.halloween || ZoneGraveyard) && Main.rand.Next(30) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 316);
						return;
					}
					if (Main.rand.Next(20) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 44);
						return;
					}
					if (spawnTileType == 147 || spawnTileType == 161 || spawnTileType == 162)
					{
						if (Main.rand.Next(15) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 185);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 167);
						}
						return;
					}
					if (ZoneSnow)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 185);
						return;
					}
					if (Main.rand.Next(3) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, cavernMonsterType[Main.rand.Next(2), Main.rand.Next(3)]);
						return;
					}
					if (ZoneGlowshroom && (spawnTileType == 70 || spawnTileType == 190))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 635);
						return;
					}
					if (Main.halloween && Main.rand.Next(2) == 0)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, Main.rand.Next(322, 325));
						return;
					}
					if (Main.expertMode && Main.rand.Next(3) == 0)
					{
						int num57 = Main.rand.Next(4);
						if (num57 == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 449);
						}
						else if (num57 == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 450);
						}
						else if (num57 == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 451);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 452);
						}
						return;
					}
					switch (Main.rand.Next(4))
					{
					case 0:
						if (Main.rand.Next(3) != 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 21);
						}
						else if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -47);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -46);
						}
						break;
					case 1:
						if (Main.rand.Next(3) != 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 201);
						}
						else if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -49);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -48);
						}
						break;
					case 2:
						if (Main.rand.Next(3) != 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 202);
						}
						else if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -51);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -50);
						}
						break;
					case 3:
						if (Main.rand.Next(3) != 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 203);
						}
						else if (Main.rand.Next(2) == 0)
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -53);
						}
						else
						{
							SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -52);
						}
						break;
					}
				}
				else if (Main.hardMode && (ZoneHallow & (Main.rand.Next(2) == 0)))
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 138);
				}
				else if (ZoneJungle)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 51);
				}
				else if (ZoneGlowshroom && (spawnTileType == 70 || spawnTileType == 190))
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 634);
				}
				else if (Main.hardMode && ZoneHallow)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 137);
				}
				else if (Main.hardMode && Main.rand.Next(6) > 0)
				{
					if (Main.rand.Next(3) == 0 && (spawnTileType == 147 || spawnTileType == 161 || spawnTileType == 162))
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 150);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 93);
					}
				}
				else if (spawnTileType == 147 || spawnTileType == 161 || spawnTileType == 162)
				{
					if (Main.hardMode)
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 169);
					}
					else
					{
						SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 150);
					}
				}
				else
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 49);
				}
			}
		}

		public NPC SpawnNPC(int X, int Y, int Type, int Start = 0, float ai0 = 0f, float ai1 = 0f, float ai2 = 0f, float ai3 = 0f, int Target = 255)
		{
			if (NPCID.FromNetId(Type) == 1)
			{
				if (RollLuck(180) == 0)
				{
					Type = -4;
				}
				if (Main.tenthAnniversaryWorld && RollLuck(180) == 0)
				{
					Type = 667;
				}
			}
			if (Target == 255)
			{
				Target = defaultTarget;
			}
			int num = NewNPC(GetSpawnSourceForNaturalSpawn(), X, Y, Type, Start, ai0, ai1, ai2, ai3, Target);
			NPC nPC = Main.npc[num];
			if (Main.dualDungeonsSeed && (double)Y > Main.worldSurface * 16.0 && Y < Main.UnderworldLayer * 16)
			{
				ParticleOrchestrator.BroadcastOrRequestParticleSpawn(ParticleOrchestraType.InScreenDungeonSpawn, new ParticleOrchestraSettings
				{
					PositionInWorld = new Vector2(X, Y),
					MovementVector = new Vector2(nPC.width, nPC.height),
					UniqueInfoPiece = Type
				});
			}
			return nPC;
		}

		private static void SyncNewlySpawnedNPCs()
		{
			for (int i = 0; i < Main.maxNPCs; i++)
			{
				NPC nPC = Main.npc[i];
				if (nPC.active && nPC.spawnNeedsSyncing)
				{
					NetMessage.SendData(23, -1, -1, null, i);
				}
			}
		}

		public NPC SpawnHornet(int spawnTileX, int spawnTileY)
		{
			switch (Main.rand.Next(8))
			{
			case 0:
				if (Main.rand.Next(4) == 0)
				{
					return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -56);
				}
				if (Main.rand.Next(4) == 0)
				{
					return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -57);
				}
				return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 231);
			case 1:
				if (Main.rand.Next(4) == 0)
				{
					return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -58);
				}
				if (Main.rand.Next(4) == 0)
				{
					return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -59);
				}
				return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 232);
			case 2:
				if (Main.rand.Next(4) == 0)
				{
					return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -60);
				}
				if (Main.rand.Next(4) == 0)
				{
					return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -61);
				}
				return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 233);
			case 3:
				if (Main.rand.Next(4) == 0)
				{
					return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -62);
				}
				if (Main.rand.Next(4) == 0)
				{
					return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -63);
				}
				return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 234);
			case 4:
				if (Main.rand.Next(4) == 0)
				{
					return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -64);
				}
				if (Main.rand.Next(4) == 0)
				{
					return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -65);
				}
				return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 235);
			default:
				if (Main.rand.Next(4) == 0)
				{
					return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -16);
				}
				if (Main.rand.Next(4) == 0)
				{
					return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, -17);
				}
				return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 42);
			}
		}

		public int RollLuck(int range)
		{
			return Luck.RollLuck(luck, range);
		}

		public int RollBadLuck(int range)
		{
			return Luck.RollBadLuck(luck, range);
		}

		public int RollOnlyBadLuck(int range)
		{
			return Luck.RollOnlyBadLuck(luck, range);
		}

		public int RollBadLuckExtreme(int range)
		{
			return Luck.RollBadLuckExtreme(luck, range);
		}

		public int RollOnlyBadLuckExtreme(int range)
		{
			return Luck.RollOnlyBadLuckExtreme(luck, range);
		}

		private static int GetGnomeChance()
		{
			int num = 10;
			if (WorldGen.Skyblock.lowTiles)
			{
				num *= 20;
				if (AnyNPCs(624))
				{
					num *= 20;
				}
			}
			if (Main.remixWorld)
			{
				num /= 2;
			}
			return num;
		}

		public static bool HasTileSpawnSpace(int spawnTileX, int spawnTileY)
		{
			Rectangle rectangle = new Rectangle(spawnTileX - spawnSpaceX / 2, spawnTileY - spawnSpaceY, spawnSpaceX, spawnSpaceY);
			if (WorldGen.InWorld(rectangle))
			{
				return CanSpawnInTiles(rectangle);
			}
			return false;
		}

		public static bool CanSpawnInTiles(Rectangle tileRect)
		{
			for (int i = tileRect.Left; i < tileRect.Right; i++)
			{
				for (int j = tileRect.Top; j < tileRect.Bottom; j++)
				{
					if (!CanSpawnInTile(i, j))
					{
						return false;
					}
				}
			}
			return true;
		}

		public static bool CanSpawnInTile(int x, int y)
		{
			if (Main.tile[x, y].nactive() && Main.tileSolid[Main.tile[x, y].type])
			{
				return false;
			}
			if (Main.tile[x, y].anyLava())
			{
				return false;
			}
			return true;
		}

		public static bool CheckNotSpawningOnScreen(int spawnTileX, int spawnTileY)
		{
			Rectangle rectangle = new Rectangle(spawnTileX * 16, spawnTileY * 16, 16, 16);
			int num = sWidth / 2;
			int num2 = sHeight / 2;
			for (int i = 0; i < 255; i++)
			{
				Player player = Main.player[i];
				if (player.active && (!Main.dualDungeonsSeed || !player.insideUnbreakableWalls))
				{
					Rectangle value = new Rectangle((int)(player.Center.X - (float)num - (float)safeRangeX), (int)(player.Center.Y - (float)num2 - (float)safeRangeY), sWidth + safeRangeX * 2, sHeight + safeRangeY * 2);
					if (rectangle.Intersects(value))
					{
						return false;
					}
				}
			}
			return true;
		}

		public static bool Spawning_SandstoneCheck(int x, int y)
		{
			if (!WorldGen.InWorld(x, y, 10))
			{
				return false;
			}
			int num = 0;
			for (int i = 0; i < 8; i++)
			{
				Tile tile = Main.tile[x, y + i];
				if (!tile.active() || !TileID.Sets.Conversion.Sand[tile.type])
				{
					break;
				}
				num++;
				for (int j = 1; j <= 4; j++)
				{
					tile = Main.tile[x + j, y + i];
					if (!tile.active() || !TileID.Sets.Conversion.Sand[tile.type])
					{
						break;
					}
					num++;
				}
				for (int k = 1; k <= 4; k++)
				{
					tile = Main.tile[x - k, y + i];
					if (!tile.active() || !TileID.Sets.Conversion.Sand[tile.type])
					{
						break;
					}
					num++;
				}
			}
			if (Main.remixWorld)
			{
				return num >= 10;
			}
			return num >= 40;
		}

		public static bool Spawning_FlyingAntlionCheck(int x, int y)
		{
			if (!WorldGen.InWorld(x, y, 10))
			{
				return false;
			}
			for (int i = 0; i < 50; i++)
			{
				if (y - i < 10)
				{
					return true;
				}
				Tile tile = Main.tile[x, y - i];
				if (!WallID.Sets.Conversion.HardenedSand[tile.wall] && !WallID.Sets.Conversion.Sandstone[tile.wall] && tile.wall != 223)
				{
					return false;
				}
			}
			return true;
		}

		private static int RollDragonflyType(int tileType = 2)
		{
			if (tileType == 53)
			{
				return Main.rand.NextFromList(new short[3] { 595, 598, 600 });
			}
			return Main.rand.NextFromList(new short[3] { 596, 597, 599 });
		}

		public static bool SpawnTileOrAboveHasAnyWallInSet(int x, int y, bool[] wallTypes)
		{
			if (!WorldGen.InWorld(x, y, 2))
			{
				return false;
			}
			Tile tile = Main.tile[x, y];
			Tile tile2 = Main.tile[x, y - 1];
			if (tile == null || tile2 == null)
			{
				return false;
			}
			if (tile.wall < 0 || tile.wall >= WallID.Count || !wallTypes[tile.wall])
			{
				if (tile2.wall >= 0 && tile2.wall < WallID.Count)
				{
					return wallTypes[tile2.wall];
				}
				return false;
			}
			return true;
		}

		private static int SharkSpawnChance(int x, int y)
		{
			int result = 10;
			int result2 = 2;
			y--;
			while (!WorldGen.SolidTile3(x, y) && Main.tile[x, y].liquid > 0)
			{
				y--;
			}
			y++;
			for (int i = 0; i < 1000; i++)
			{
				if (Main.projectile[i].active && Main.projectile[i].type == 820 && Collision.CanHit(new Vector2(x * 16 + 8, y * 16), 1, 1, Main.projectile[i].position, Main.projectile[i].width, Main.projectile[i].height))
				{
					return result2;
				}
			}
			return result;
		}

		private static bool CanSpawnDevourer(int X)
		{
			if (!Main.infectedSeed)
			{
				return true;
			}
			if (Main.infectedSeed && Main.teamBasedSpawnsSeed)
			{
				return false;
			}
			if ((double)Math.Abs(X - Main.spawnTileX) > (double)Main.maxTilesX * 0.08)
			{
				return true;
			}
			return false;
		}

		public void GetZombieSettings(out int zombieStyle, out bool spawnArmedZombies, out int torchZombieChance, out int maggotZombieChance)
		{
			zombieStyle = 0;
			spawnArmedZombies = true;
			torchZombieChance = 12;
			maggotZombieChance = 20;
			zombieStyle = Main.rand.Next(7);
			if (WorldGen.Skyblock.lowTiles && !DownedAnyPreHardmodeBoss && zombieStyle != 4 && zombieStyle != 5 && Main.rand.Next(3) == 0)
			{
				zombieStyle = ((Main.rand.Next(3) == 0) ? 4 : 5);
			}
			if (playerHasStartingHealth)
			{
				torchZombieChance = 5;
				torchZombieChance -= numberOfActivePlayers / 2;
				if (torchZombieChance < 2)
				{
					torchZombieChance = 2;
				}
			}
			if (WorldGen.Skyblock.lowTiles && !DownedAnyPreHardmodeBoss)
			{
				spawnArmedZombies = false;
			}
		}

		public void SpawnFrog(int spawnTileX, int spawnTileY)
		{
			if (!unlockedSlimeYellowSpawn && RollLuck(30) == 0 && !AnyNPCs(687))
			{
				SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 687);
			}
			else if (RollLuck(goldCritterChance) == 0)
			{
				SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 445);
			}
			else
			{
				SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 361);
			}
		}

		public static int GetBasicSlimeToSpawn(bool surface, int tileType, int spawnDist)
		{
			short result = 1;
			if (!surface)
			{
				result = (short)((Main.rand.Next(5) == 0) ? (-9) : ((Main.rand.Next(2) == 0) ? 1 : (-8)));
			}
			else
			{
				switch (tileType)
				{
				case 60:
					result = -10;
					break;
				case 147:
				case 161:
					result = 147;
					break;
				default:
					if (Main.halloween && GetBasicSlimeToSpawn_ChanceToBeHolidaySlime())
					{
						result = 302;
					}
					else if (Main.xMas && GetBasicSlimeToSpawn_ChanceToBeHolidaySlime())
					{
						result = (short)Main.rand.Next(333, 337);
					}
					else if (Main.rand.Next(3) == 0 || (spawnDist < 200 && !Main.expertMode))
					{
						result = -3;
					}
					else if (Main.rand.Next(10) == 0 && (spawnDist > 400 || Main.expertMode))
					{
						result = -7;
					}
					break;
				}
			}
			return result;
		}

		public static bool GetBasicSlimeToSpawn_ChanceToBeHolidaySlime()
		{
			if (WorldGen.Skyblock.lowTiles)
			{
				return Main.rand.Next(4) == 0;
			}
			return Main.rand.Next(3) != 0;
		}

		public static int GetGemBunnyToSpawn()
		{
			int num = Main.rand.Next(100);
			if (num < 5)
			{
				return 651;
			}
			if (num < 13)
			{
				return 652;
			}
			if (num < 23)
			{
				return 650;
			}
			if (num < 35)
			{
				return 649;
			}
			if (num < 51)
			{
				return 648;
			}
			if (num < 72)
			{
				return 647;
			}
			return 646;
		}

		public static int GetGemSquirrelToSpawn()
		{
			int num = Main.rand.Next(100);
			if (num < 5)
			{
				return 644;
			}
			if (num < 13)
			{
				return 645;
			}
			if (num < 23)
			{
				return 643;
			}
			if (num < 35)
			{
				return 642;
			}
			if (num < 51)
			{
				return 641;
			}
			if (num < 72)
			{
				return 640;
			}
			return 639;
		}

		private static bool CheckToSpawnSpider(int spawnTileX, int spawnTileY)
		{
			if (Main.notTheBeesWorld && Main.getGoodWorld && !Main.tenthAnniversaryWorld)
			{
				if (spawnTileY >= Main.UnderworldLayer)
				{
					return Main.rand.Next(5) == 0;
				}
				return true;
			}
			return true;
		}

		private bool CheckToSpawnRockGolem(int spawnTileX, int spawnTileY, int spawnTileType)
		{
			if (!Main.hardMode || (spawnTileType != 1 && !TileID.Sets.Conversion.Moss[spawnTileType]) || ZoneSnow)
			{
				return false;
			}
			if (Main.rand.Next(50) != 0)
			{
				return false;
			}
			if (WorldGen.SolidTile(spawnTileX - 1, spawnTileY - 4) || WorldGen.SolidTile(spawnTileX, spawnTileY - 4) || WorldGen.SolidTile(spawnTileX + 1, spawnTileY - 4))
			{
				return false;
			}
			return true;
		}

		private bool CheckToSpawnUndergroundFairy(int spawnTileX, int spawnTileY)
		{
			if (!fairyLog)
			{
				return false;
			}
			int num = 500;
			if (Main.tenthAnniversaryWorld && !Main.getGoodWorld)
			{
				num = 250;
			}
			if (Main.hardMode)
			{
				num = (int)((float)num * 1.66f);
			}
			if (RollLuck(num) != 0)
			{
				return false;
			}
			if ((double)spawnTileY < (Main.worldSurface + Main.rockLayer) / 2.0 || spawnTileY >= Main.maxTilesY - 300)
			{
				return false;
			}
			if (AnyHelpfulFairies())
			{
				return false;
			}
			return true;
		}

		private NPC SpawnLavaBaitCritters(int spawnTileX, int spawnTileY)
		{
			if (Main.rand.Next(3) != 0)
			{
				if (Main.dayTime)
				{
					return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 653);
				}
				if (Main.rand.Next(fireFlyMultiple) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8 - 16, spawnTileY * 16, 654);
				}
				if (Main.rand.Next(fireFlyMultiple) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8 + 16, spawnTileY * 16, 654);
				}
				if (Main.rand.Next(fireFlyMultiple) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16 - 16, 654);
				}
				if (Main.rand.Next(fireFlyMultiple) == 0)
				{
					SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16 + 16, 654);
				}
				return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 654);
			}
			return SpawnNPC(spawnTileX * 16 + 8, spawnTileY * 16, 655);
		}

		public static void GetProperGroundSpawnTileTypeAndWallType(int x, int y, out int spawnTileType, out int spawnWallType)
		{
			spawnTileType = Main.tile[x, y].type;
			spawnWallType = ((y > 0) ? Main.tile[x, y - 1].wall : 0);
			if (TileID.Sets.UsesADifferentTileTypeForNPCSpawning[spawnTileType] && WorldGen.InWorld(x, y + 1) && WorldGen.SolidTile3(x, y + 1))
			{
				Tile tile = Main.tile[x, y];
				spawnTileType = Main.tile[x, y + 1].type;
				spawnWallType = tile.wall;
			}
			if (IsValidSpawningGroundTile(x, y))
			{
				return;
			}
			for (int i = y + 1; i < y + 30; i++)
			{
				if (IsValidSpawningGroundTile(x, i))
				{
					Tile tile2 = Main.tile[x, i - 1];
					spawnTileType = Main.tile[x, i].type;
					spawnWallType = tile2.wall;
					break;
				}
			}
		}

		public static bool IsValidSpawningGroundTile(int x, int y)
		{
			Tile tile = Main.tile[x, y];
			if (!tile.nactive())
			{
				return false;
			}
			if (!Main.tileSolid[tile.type] || Main.tileSolidTop[tile.type])
			{
				return false;
			}
			return true;
		}

		public static void SlimeRainSpawns(Player player)
		{
			int y = Main.MaxWorldViewSize.Y;
			int x = Main.MaxWorldViewSize.X;
			float num = 15f;
			if ((double)player.position.Y > Main.worldSurface * 16.0 + (double)(y / 2) || player.nearbyActiveNPCs > num)
			{
				return;
			}
			float num2 = player.nearbyActiveNPCs / num;
			int num3 = 45 + (int)(450f * num2);
			if (Main.expertMode)
			{
				num3 = (int)((double)num3 * 0.85);
			}
			if (Main.IsJourneyMode)
			{
				CreativePowers.SpawnRateSliderPerPlayerPower power = CreativePowerManager.Instance.GetPower<CreativePowers.SpawnRateSliderPerPlayerPower>();
				if (power != null && power.GetIsUnlocked() && power.GetRemappedSliderValueFor(player.whoAmI, out var value))
				{
					num3 = (int)((float)num3 / value);
				}
			}
			if (Main.rand.Next(num3) != 0)
			{
				return;
			}
			int num4 = (int)(player.Center.X - (float)x);
			int maxValue = num4 + x * 2;
			int minValue = (int)((double)player.Center.Y - (double)y * 1.5);
			int maxValue2 = (int)((double)player.Center.Y - (double)y * 0.75);
			int num5 = Main.rand.Next(num4, maxValue);
			int num6 = Main.rand.Next(minValue, maxValue2);
			num5 /= 16;
			num6 /= 16;
			if (num5 < 10 || num5 > Main.maxTilesX + 10 || (double)num6 < Main.worldSurface * 0.3 || (double)num6 > Main.worldSurface || Collision.SolidTiles(num5 - 3, num5 + 3, num6 - 5, num6 + 2) || Main.wallHouse[Main.tile[num5, num6].wall])
			{
				return;
			}
			int type = 1;
			if (Main.rand.Next(200) == 0)
			{
				type = -4;
			}
			else if (Main.expertMode)
			{
				if (Main.rand.Next(7) == 0)
				{
					type = -7;
				}
				else if (Main.rand.Next(3) == 0)
				{
					type = -3;
				}
			}
			else if (Main.rand.Next(10) == 0)
			{
				type = -7;
			}
			else if (Main.rand.Next(5) < 2)
			{
				type = -3;
			}
			NewNPC(GetSpawnSourceForNaturalSpawn(), num5 * 16 + 8, num6 * 16, type);
		}

		public static void SpawnFaelings(Player player)
		{
			if (AnyNPCs(677))
			{
				return;
			}
			int num = Main.rand.Next(2, 6);
			GetSpawnArea(player, out var spawnArea, out var safeArea);
			for (int i = 0; i < num; i++)
			{
				int num2 = 1000;
				for (int j = 0; j < num2; j++)
				{
					int num3 = Main.rand.Next(spawnArea.Left, spawnArea.Right);
					int num4 = Main.rand.Next(spawnArea.Top, spawnArea.Bottom);
					if (Main.tile[num3, num4].liquid <= 0 || !Main.tile[num3, num4].shimmer())
					{
						continue;
					}
					while (Main.tile[num3, num4].liquid > 0)
					{
						if (num4 < 50)
						{
							return;
						}
						num4--;
					}
					if (!safeArea.Contains(num3, num4) && CheckNotSpawningOnScreen(num3, num4))
					{
						int num5 = NewNPC(GetSpawnSourceForNaturalSpawn(), num3 * 16 + 8, num4 * 16, 677);
						if (Main.netMode == 2 && num5 < Main.maxNPCs)
						{
							NetMessage.SendData(23, -1, -1, null, num5);
						}
						break;
					}
				}
			}
		}
	}

	public bool active;

	private const int NPC_TARGETS_START = 300;

	public bool IsABestiaryIconDummy;

	public bool IsAPortraitDummy;

	public bool ForcePartyHatOn;

	public float waterMovementSpeed = 0.5f;

	public float lavaMovementSpeed = 0.5f;

	public float honeyMovementSpeed = 0.25f;

	public float shimmerMovementSpeed = 0.375f;

	public static readonly int[,,,] MoonLordAttacksArray = InitializeMoonLordAttacks();

	public static readonly int[,] MoonLordAttacksArray2 = InitializeMoonLordAttacks2();

	public static int MoonLordFightingDistance = 4500;

	public static int MoonLordCountdown = 0;

	public static int MaxMoonLordCountdown = 3600;

	public const int NaturalMoonlordCountdownTime = 3600;

	public const int ItemMoonlordCountdownTime = 720;

	public int teleportStyle;

	public float teleportTime;

	public static int immuneTime = 20;

	public static int maxAI = 4;

	public static int goldCritterChance = 400;

	public static float totalInvasionPoints = 0f;

	public static float waveKills = 0f;

	public static int waveNumber = 0;

	public const float nameOverIncrement = 0.025f;

	public const float nameOverDistance = 350f;

	public float nameOver;

	public bool SpawnedFromStatue;

	public bool CanBeReplacedByOtherNPCs;

	public bool dripping;

	public bool drippingSlime;

	public bool drippingSparkleSlime;

	public static bool[] ShimmeredTownNPCs = new bool[NPCID.Count];

	public int altTexture;

	public int townNpcVariationIndex;

	public short catchItem;

	public short releaseOwner = 255;

	public int rarity;

	public static bool taxCollector = false;

	public bool[] playerInteraction = new bool[256];

	public int lastInteraction = 255;

	public float takenDamageMultiplier = 1f;

	public static bool freeCake = false;

	public float gfxOffY;

	public float stepSpeed;

	private static float gravity = 0.3f;

	public bool teleporting;

	private static int maxAttack = 20;

	private static int[] attackNPC = new int[maxAttack];

	public bool stairFall;

	public static int fireFlyFriendly = 0;

	public static int fireFlyChance = 0;

	public static int fireFlyMultiple = 0;

	public static int butterflyChance = 0;

	public static int stinkBugChance = 0;

	public Vector2[] oldPos = new Vector2[10];

	public float[] oldRot = new float[10];

	public bool setFrameSize;

	public static int golemBoss = -1;

	public static int plantBoss = -1;

	public static int crimsonBoss = -1;

	public static int deerclopsBoss = -1;

	public bool netUpdate;

	internal bool netUpdatePendingSpamCooldown;

	internal bool netUpdatePendingFullSpamCooldown;

	public readonly int netSpamPacketLimit = 3;

	public readonly int netSpamTicksPerPacket = 30;

	public readonly int netSpamTicksPerPacketForBosses = 5;

	public int netSpam;

	public bool netAlways;

	public bool spawnNeedsSyncing;

	internal int netStream;

	internal PlayerNetSyncState[] playerNetSyncState = new PlayerNetSyncState[255];

	private bool needsUniqueInfoUpdate = true;

	public Vector2 netOffset = Vector2.Zero;

	public int realLife = -1;

	private string _givenName = "";

	public static int safeRangeX = (int)((double)(sWidth / 16) * 0.52);

	public static int safeRangeY = (int)((double)(sHeight / 16) * 0.52);

	private static int activeRangeX = (int)((double)sWidth * 2.1);

	private static int activeRangeY = (int)((double)sHeight * 2.1);

	private static int townRangeX = sWidth;

	private static int townRangeY = sHeight;

	public float npcSlots = 1f;

	private static bool noSpawnCycle = false;

	private static int activeTime = 750;

	private static int defaultSpawnRate = 600;

	private static int defaultMaxSpawns = 5;

	public float shimmerTransparency;

	public bool dontCountMe;

	public static readonly int maxBuffs = 20;

	public int[] buffType = new int[maxBuffs];

	public int[] buffTime = new int[maxBuffs];

	public bool[] buffImmune = new bool[BuffID.Count];

	public bool canDisplayBuffs = true;

	public bool midas;

	public bool ichor;

	public bool brokenArmor;

	public bool onFire;

	public bool onFire2;

	public bool onFire3;

	public bool onFrostBurn;

	public bool onFrostBurn2;

	public bool poisoned;

	public bool venom;

	public bool tipsy;

	public bool bleeding;

	public bool hemorrhage;

	public bool markedByScytheWhip;

	public bool markedByEelWhip;

	public bool shadowFlame;

	public bool soulDrain;

	public bool shimmering;

	public int lifeRegen;

	public int lifeRegenCount;

	public int lifeRegenExpectedLossPerSecond = -1;

	public bool confused;

	public bool loveStruck;

	public bool stinky;

	public bool dryadWard;

	public bool immortal;

	public bool chaseable = true;

	public bool canGhostHeal = true;

	public bool javelined;

	public bool tentacleSpiked;

	public bool bloodButchered;

	public bool celled;

	public bool dryadBane;

	public bool daybreak;

	public bool dontTakeDamageFromHostiles;

	public bool betsysCurse;

	public bool oiled;

	public int electricEelCounter;

	public static bool savedTaxCollector = false;

	public static bool savedGoblin = false;

	public static bool savedWizard = false;

	public static bool savedMech = false;

	public static bool savedAngler = false;

	public static bool savedStylist = false;

	public static bool savedBartender = false;

	public static bool savedGolfer = false;

	public static bool boughtCat = false;

	public static bool boughtDog = false;

	public static bool boughtBunny = false;

	public static bool unlockedSlimeBlueSpawn = false;

	public static bool unlockedSlimeGreenSpawn = false;

	public static bool unlockedSlimeOldSpawn = false;

	public static bool unlockedSlimePurpleSpawn = false;

	public static bool unlockedSlimeRainbowSpawn = false;

	public static bool unlockedSlimeRedSpawn = false;

	public static bool unlockedSlimeYellowSpawn = false;

	public static bool unlockedSlimeCopperSpawn = false;

	public static bool unlockedMerchantSpawn = false;

	public static bool unlockedDemolitionistSpawn = false;

	public static bool unlockedPartyGirlSpawn = false;

	public static bool unlockedDyeTraderSpawn = false;

	public static bool unlockedTruffleSpawn = false;

	public static bool unlockedArmsDealerSpawn = false;

	public static bool unlockedNurseSpawn = false;

	public static bool unlockedPrincessSpawn = false;

	public static bool combatBookWasUsed = false;

	public static bool combatBookVolumeTwoWasUsed = false;

	public static bool peddlersSatchelWasUsed = false;

	public static bool downedBoss1 = false;

	public static bool downedBoss2 = false;

	public static bool downedBoss3 = false;

	public static bool downedQueenBee = false;

	public static bool downedSlimeKing = false;

	public static bool downedGoblins = false;

	public static bool downedFrost = false;

	public static bool downedPirates = false;

	public static bool downedClown = false;

	public static bool downedPlantBoss = false;

	public static bool downedGolemBoss = false;

	public static bool downedMartians = false;

	public static bool downedFishron = false;

	public static bool downedHalloweenTree = false;

	public static bool downedHalloweenKing = false;

	public static bool downedChristmasIceQueen = false;

	public static bool downedChristmasTree = false;

	public static bool downedChristmasSantank = false;

	public static bool downedAncientCultist = false;

	public static bool downedMoonlord = false;

	public static bool downedTowerSolar = false;

	public static bool downedTowerVortex = false;

	public static bool downedTowerNebula = false;

	public static bool downedTowerStardust = false;

	public static bool downedEmpressOfLight = false;

	public static bool downedQueenSlime = false;

	public static bool downedDeerclops = false;

	public static int ShieldStrengthTowerSolar = 0;

	public static int ShieldStrengthTowerVortex = 0;

	public static int ShieldStrengthTowerNebula = 0;

	public static int ShieldStrengthTowerStardust = 0;

	public static int LunarShieldPowerNormal = 100;

	public static int LunarShieldPowerMax = 100;

	public static bool TowerActiveSolar = false;

	public static bool TowerActiveVortex = false;

	public static bool TowerActiveNebula = false;

	public static bool TowerActiveStardust = false;

	public static bool LunarApocalypseIsUp = false;

	public static bool downedMechBossAny = false;

	public static bool downedMechBoss1 = false;

	public static bool downedMechBoss2 = false;

	public static bool downedMechBoss3 = false;

	public static bool[] npcsFoundForCheckActive = new bool[NPCID.Count];

	public static int[] lazyNPCOwnedProjectileSearchArray = new int[InitData.MaxNPCs];

	public static int[] spawnSlotProtected = new int[InitData.MaxNPCs];

	public int soundDelay;

	public static CoinLossRevengeSystem RevengeManager = new CoinLossRevengeSystem();

	public int[] immune = new int[256];

	public int directionY = 1;

	public int type;

	public float[] ai = new float[maxAI];

	public float[] localAI = new float[maxAI];

	public int aiAction;

	public int aiStyle;

	public bool justHit;

	public int timeLeft;

	public int target = -1;

	public int damage;

	public int defense;

	public int defDamage;

	public int defDefense;

	public int defLifeMax;

	public bool coldDamage;

	public bool trapImmune;

	public LegacySoundStyle HitSound;

	public LegacySoundStyle DeathSound;

	public int life;

	public int lifeMax;

	public Rectangle targetRect;

	public double frameCounter;

	public Rectangle frame;

	public Color color;

	public int alpha;

	public bool hide;

	public float scale = 1f;

	public float knockBackResist = 1f;

	public int oldDirectionY;

	public int oldTarget;

	public float rotation;

	public bool noGravity;

	public bool noTileCollide;

	public bool collideX;

	public bool collideY;

	public bool boss;

	public int spriteDirection = -1;

	public bool behindTiles;

	public bool lavaImmune;

	public float value;

	public int extraValue;

	public bool dontTakeDamage;

	private int catchableNPCTempImmunityCounter;

	public int netID;

	public int statsAreScaledForThisManyPlayers;

	public float difficulty = 1f;

	public bool townNPC;

	public ConditionalDialogue nextDialogue;

	public static bool travelNPC = false;

	public bool homeless;

	public bool homelessDespawn;

	public int lookForHomeTimeout;

	public static readonly int KickOutLookForHomeTimeout = 3600;

	public int homeTileX = -1;

	public int homeTileY = -1;

	public int housingCategory;

	public bool oldHomeless;

	public int oldHomeTileX = -1;

	public int oldHomeTileY = -1;

	public bool friendly;

	public bool closeDoor;

	public int doorX;

	public int doorY;

	public int friendlyRegen;

	public int breath;

	public const int breathMax = 200;

	public int breathCounter;

	public bool reflectsProjectiles;

	public int lastPortalColorIndex;

	public bool despawnEncouraged;

	public static int[,] cavernMonsterType = new int[2, 3];

	public static readonly double CommonMasterBossLifeReduction = 0.85;

	public static int mechQueen = -1;

	public static int brainOfGravity = -1;

	private static int kingSlimePointCacheSize = 0;

	private static int kingSlimePointCacheSizeMax = 50;

	private static Point[] kingSlimePointCache = new Point[kingSlimePointCacheSizeMax];

	public static bool empressRageMode = false;

	private static Point[] _nearbyBooks = new Point[20];

	private static readonly int[] _deerclopsAttack1Frames = new int[12]
	{
		12, 13, 14, 13, 14, 13, 14, 13, 14, 15,
		16, 17
	};

	private static readonly int[] _deerclopsAttack2Frames = new int[13]
	{
		12, 15, 16, 17, 17, 17, 17, 13, 18, 18,
		18, 18, 12
	};

	private static readonly int[] _deerclopsAttack3Frames = new int[16]
	{
		19, 20, 21, 22, 21, 22, 21, 22, 23, 24,
		23, 24, 23, 24, 20, 19
	};

	public static int[] MoonEventRequiredPointsPerWaveLookup = new int[21]
	{
		0, 25, 40, 50, 80, 100, 160, 180, 200, 250,
		300, 375, 450, 525, 675, 850, 1025, 1325, 1550, 2000,
		0
	};

	private static bool EoCKilledToday;

	private static bool WoFKilledToday;

	public const int SPAWN_SLOT_PROTECTION_TIME = 2;

	private static int ignorePlayerInteractions = 0;

	public static int ladyBugGoodLuckTime = 43200;

	public static int ladyBugBadLuckTime = -10800;

	private static int ladyBugRainTime = 1800;

	private static int maximumAmountOfTimesLadyBugRainCanStack = 10 * ladyBugRainTime;

	public static int offSetDelayTime = 60;

	public static bool PreventJojaColaDialog = false;

	public static int RerollDryadText = 0;

	public bool CanTalk
	{
		get
		{
			if (isLikeATownNPC && aiStyle == 7 && velocity.Y == 0f)
			{
				return !NPCID.Sets.IsTownPet[type];
			}
			return false;
		}
	}

	public bool CanBeTalkedTo
	{
		get
		{
			if (isLikeATownNPC && aiStyle == 7)
			{
				return velocity.Y == 0f;
			}
			return false;
		}
	}

	public bool HasValidTarget
	{
		get
		{
			if (!HasPlayerTarget || !Main.player[target].active || Main.player[target].dead || Main.player[target].ghost)
			{
				if (SupportsNPCTargets && HasNPCTarget)
				{
					return Main.npc[TranslatedTargetIndex].active;
				}
				return false;
			}
			return true;
		}
	}

	public bool HasPlayerTarget
	{
		get
		{
			if (target >= 0)
			{
				return target < 255;
			}
			return false;
		}
	}

	public bool HasNPCTarget
	{
		get
		{
			if (target >= 300)
			{
				return target < 300 + Main.maxNPCs;
			}
			return false;
		}
	}

	public bool SupportsNPCTargets => NPCID.Sets.UsesNewTargeting[type];

	public int TranslatedTargetIndex
	{
		get
		{
			if (HasNPCTarget)
			{
				return target - 300;
			}
			return target;
		}
	}

	public int WhoAmIToTargettingIndex => whoAmI + 300;

	public bool IsShimmerVariant
	{
		get
		{
			if (townNpcVariationIndex == 1)
			{
				return NPCID.Sets.ShimmerTownTransform[type];
			}
			return false;
		}
	}

	public string TypeName => Lang.GetNPCNameValue(netID);

	public string FullName
	{
		get
		{
			if (!HasGivenName)
			{
				return TypeName;
			}
			return Language.GetTextValue("Game.NPCTitle", _givenName, TypeName);
		}
	}

	public bool HasGivenName => _givenName.Length != 0;

	public string GivenOrTypeName
	{
		get
		{
			if (!HasGivenName)
			{
				return TypeName;
			}
			return _givenName;
		}
	}

	public string GivenName
	{
		get
		{
			return _givenName;
		}
		set
		{
			_givenName = value ?? "";
		}
	}

	public static int sWidth => 1920;

	public static int sHeight => 1200;

	public static bool downedTowers
	{
		get
		{
			if (downedTowerSolar && downedTowerVortex && downedTowerNebula)
			{
				return downedTowerStardust;
			}
			return false;
		}
	}

	public static bool DownedAnyPreHardmodeBoss
	{
		get
		{
			if (!downedSlimeKing && !downedBoss1 && !downedBoss2 && !downedBoss3 && !downedQueenBee && !downedDeerclops)
			{
				return Main.hardMode;
			}
			return true;
		}
	}

	public static int ShieldStrengthTowerMax
	{
		get
		{
			int num = LunarShieldPowerNormal;
			if (downedMoonlord)
			{
				num /= 2;
			}
			return num;
		}
	}

	public static bool TowersDefeated
	{
		get
		{
			if (TowerActiveSolar && TowerActiveVortex && TowerActiveNebula)
			{
				return TowerActiveStardust;
			}
			return false;
		}
	}

	public float Opacity
	{
		get
		{
			return 1f - (float)alpha / 255f;
		}
		set
		{
			alpha = (int)MathHelper.Clamp((1f - value) * 255f, 0f, 255f);
		}
	}

	public bool TreatedAsABossForRainbowBoulders
	{
		get
		{
			if (!boss)
			{
				return NPCID.Sets.ShouldBeCountedAsBossForRainbowBoulders[type];
			}
			return true;
		}
	}

	public bool isLikeATownNPC
	{
		get
		{
			if (type == 453)
			{
				return true;
			}
			return townNPC;
		}
	}

	public static bool IsMechQueenUp
	{
		get
		{
			if (mechQueen >= 0 && mechQueen < Main.maxNPCs)
			{
				if (Main.npc[mechQueen].active && Main.npc[mechQueen].type == 127)
				{
					return true;
				}
				mechQueen = -1;
				return false;
			}
			return false;
		}
	}

	public static bool TooWindyForButterflies => Math.Abs(Main.windSpeedTarget) >= 0.4f;

	public bool CountsAsACritter
	{
		get
		{
			if (lifeMax <= 5 && damage == 0 && type != 594)
			{
				return type != 686;
			}
			return false;
		}
	}

	public Point NetSectionCoordinates => new Point(Netplay.GetSectionX((int)position.X >> 4), Netplay.GetSectionY((int)position.Y >> 4));

	public NPCAimedTarget GetTargetData(bool ignorePlayerTankPets = true)
	{
		if (!HasValidTarget)
		{
			return default(NPCAimedTarget);
		}
		if (SupportsNPCTargets && HasNPCTarget)
		{
			return new NPCAimedTarget(Main.npc[TranslatedTargetIndex]);
		}
		return new NPCAimedTarget(Main.player[target], ignorePlayerTankPets);
	}

	public static int[,,,] InitializeMoonLordAttacks()
	{
		int[,,,] array = null;
		if (MoonLordAttacksArray != null)
		{
			array = MoonLordAttacksArray;
			for (int i = 0; i < array.GetLength(0); i++)
			{
				for (int j = 0; j < array.GetLength(1); j++)
				{
					for (int k = 0; k < array.GetLength(2); k++)
					{
						for (int l = 0; l < array.GetLength(3); l++)
						{
							array[i, j, k, l] = 0;
						}
					}
				}
			}
		}
		else
		{
			array = new int[3, 3, 2, 5];
		}
		array[0, 0, 0, 0] = 0;
		array[0, 0, 1, 0] = 50;
		array[0, 0, 0, 1] = 1;
		array[0, 0, 1, 1] = 70;
		array[0, 0, 0, 2] = 2;
		array[0, 0, 1, 2] = 330;
		array[0, 0, 0, 3] = 0;
		array[0, 0, 1, 3] = 60;
		array[0, 0, 0, 4] = 3;
		array[0, 0, 1, 4] = 90;
		array[0, 1, 0, 0] = 1;
		array[0, 1, 1, 0] = 70;
		array[0, 1, 0, 1] = 0;
		array[0, 1, 1, 1] = 50;
		array[0, 1, 0, 2] = 3;
		array[0, 1, 1, 2] = 90;
		array[0, 1, 0, 3] = 0;
		array[0, 1, 1, 3] = 60;
		array[0, 1, 0, 4] = 2;
		array[0, 1, 1, 4] = 330;
		array[0, 2, 0, 0] = 3;
		array[0, 2, 1, 0] = 180;
		array[0, 2, 0, 1] = 0;
		array[0, 2, 1, 1] = 30;
		array[0, 2, 0, 2] = 2;
		array[0, 2, 1, 2] = 435;
		array[0, 2, 0, 3] = 3;
		array[0, 2, 1, 3] = 180;
		array[0, 2, 0, 4] = 1;
		array[0, 2, 1, 4] = 375;
		array[1, 0, 0, 0] = 0;
		array[1, 0, 1, 0] = 0;
		array[1, 0, 0, 1] = 0;
		array[1, 0, 1, 1] = 0;
		array[1, 0, 0, 2] = 0;
		array[1, 0, 1, 2] = 0;
		array[1, 0, 0, 3] = 0;
		array[1, 0, 1, 3] = 0;
		array[1, 0, 0, 4] = 0;
		array[1, 0, 1, 4] = 0;
		array[1, 1, 0, 0] = 0;
		array[1, 1, 1, 0] = 0;
		array[1, 1, 0, 1] = 0;
		array[1, 1, 1, 1] = 0;
		array[1, 1, 0, 2] = 0;
		array[1, 1, 1, 2] = 0;
		array[1, 1, 0, 3] = 0;
		array[1, 1, 1, 3] = 0;
		array[1, 1, 0, 4] = 0;
		array[1, 1, 1, 4] = 0;
		array[1, 2, 0, 0] = 0;
		array[1, 2, 1, 0] = 0;
		array[1, 2, 0, 1] = 0;
		array[1, 2, 1, 1] = 0;
		array[1, 2, 0, 2] = 0;
		array[1, 2, 1, 2] = 0;
		array[1, 2, 0, 3] = 0;
		array[1, 2, 1, 3] = 0;
		array[1, 2, 0, 4] = 0;
		array[1, 2, 1, 4] = 0;
		array[2, 0, 0, 0] = 0;
		array[2, 0, 1, 0] = 0;
		array[2, 0, 0, 1] = 0;
		array[2, 0, 1, 1] = 0;
		array[2, 0, 0, 2] = 0;
		array[2, 0, 1, 2] = 0;
		array[2, 0, 0, 3] = 0;
		array[2, 0, 1, 3] = 0;
		array[2, 0, 0, 4] = 0;
		array[2, 0, 1, 4] = 0;
		array[2, 1, 0, 0] = 0;
		array[2, 1, 1, 0] = 0;
		array[2, 1, 0, 1] = 0;
		array[2, 1, 1, 1] = 0;
		array[2, 1, 0, 2] = 0;
		array[2, 1, 1, 2] = 0;
		array[2, 1, 0, 3] = 0;
		array[2, 1, 1, 3] = 0;
		array[2, 1, 0, 4] = 0;
		array[2, 1, 1, 4] = 0;
		array[2, 2, 0, 0] = 0;
		array[2, 2, 1, 0] = 0;
		array[2, 2, 0, 1] = 0;
		array[2, 2, 1, 1] = 0;
		array[2, 2, 0, 2] = 0;
		array[2, 2, 1, 2] = 0;
		array[2, 2, 0, 3] = 0;
		array[2, 2, 1, 3] = 0;
		array[2, 2, 0, 4] = 0;
		array[2, 2, 1, 4] = 0;
		InitializeMoonLordAttacks2();
		return array;
	}

	public static int[,] InitializeMoonLordAttacks2()
	{
		int[,] array = null;
		if (MoonLordAttacksArray2 != null)
		{
			array = MoonLordAttacksArray2;
			for (int i = 0; i < array.GetLength(0); i++)
			{
				for (int j = 0; j < array.GetLength(1); j++)
				{
					array[i, j] = 0;
				}
			}
		}
		else
		{
			array = new int[2, 10];
		}
		array[0, 0] = 0;
		array[1, 0] = 90;
		array[0, 1] = 1;
		array[1, 1] = 90;
		array[0, 2] = 0;
		array[1, 2] = 90;
		array[0, 3] = 2;
		array[1, 3] = 135;
		array[0, 4] = 0;
		array[1, 4] = 90;
		array[0, 5] = 3;
		array[1, 5] = 200;
		array[0, 6] = 0;
		array[1, 6] = 90;
		array[0, 7] = 4;
		array[1, 7] = 375;
		array[0, 8] = 0;
		array[1, 8] = 90;
		array[0, 9] = 2;
		array[1, 9] = 135;
		return array;
	}

	public static string GetFullnameByID(int npcID)
	{
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (Main.npc[i].active && Main.npc[i].type == npcID)
			{
				return Main.npc[i].FullName;
			}
		}
		return Lang.GetNPCNameValue(npcID);
	}

	public static bool BusyWithAnyInvasionOfSorts()
	{
		if (Main.slimeRainTime == 0.0 && !Main.bloodMoon && !Main.eclipse && !Main.snowMoon && !Main.pumpkinMoon && Main.invasionType == 0)
		{
			return DD2Event.Ongoing;
		}
		return true;
	}

	public float GetKnockbackMultiplier_ScaledByDifficulty(float normalKnockbackMult)
	{
		return normalKnockbackMult * GameDifficultyData.KnockbackToEnemiesMultiplier.Sample(difficulty);
	}

	public int GetAttackDamage_ScaledByDifficulty(float normalDamage)
	{
		return (int)(normalDamage * GameDifficultyData.EnemyDamageMultiplier.Sample(difficulty));
	}

	public int GetAttackDamage_CappedAtMaster(float normalDamage)
	{
		float num = Math.Min(difficulty, GameDifficultyLevel.Master);
		return (int)(normalDamage * GameDifficultyData.EnemyDamageMultiplier.Sample(num));
	}

	public int GetAttackDamage_LerpBetweenFinalValues(float normalDamage, float expertDamage)
	{
		return (int)Utils.Remap(difficulty, GameDifficultyLevel.Classic, GameDifficultyLevel.Expert, normalDamage, expertDamage);
	}

	public int GetAttackDamage_ForProjectiles(float normalDamage, float expertDamage)
	{
		return (int)Utils.Remap(difficulty, GameDifficultyLevel.Classic, GameDifficultyLevel.Expert, normalDamage, expertDamage);
	}

	public int GetAttackDamage_ForProjectiles_MultiLerp(float normalDamage, float expertDamage, float masterDamage)
	{
		return (int)Utils.MultiLerp(Utils.GetLerpValue(GameDifficultyLevel.Classic, GameDifficultyLevel.Master, difficulty, clamped: true), normalDamage, expertDamage, masterDamage);
	}

	public int GetAttackDamage_ForTownNPC(float normalDamage)
	{
		return (int)(normalDamage * GameDifficultyData.TownNPCDamageMultiplier.Sample(Main.Difficulty));
	}

	public static bool SpawnAllowed_Demolitionist()
	{
		if (unlockedDemolitionistSpawn)
		{
			return true;
		}
		for (int i = 0; i < 255; i++)
		{
			Player player = Main.player[i];
			if (!player.active)
			{
				continue;
			}
			for (int j = 0; j < 58; j++)
			{
				Item item = player.inventory[j];
				if (item != null && item.stack > 0 && ItemID.Sets.ItemsThatCountAsBombsForDemolitionistToSpawn[item.type])
				{
					return true;
				}
			}
		}
		return false;
	}

	public static bool SpawnAllowed_ArmsDealer()
	{
		if (unlockedArmsDealerSpawn)
		{
			return true;
		}
		for (int i = 0; i < 255; i++)
		{
			Player player = Main.player[i];
			if (!player.active)
			{
				continue;
			}
			for (int j = 0; j < 58; j++)
			{
				Item item = player.inventory[j];
				if (item != null && item.stack > 0 && (item.ammo == AmmoID.Bullet || item.useAmmo == AmmoID.Bullet))
				{
					return true;
				}
			}
		}
		return false;
	}

	public static bool SpawnAllowed_DyeTrader()
	{
		if (unlockedDyeTraderSpawn)
		{
			return true;
		}
		for (int i = 0; i < 255; i++)
		{
			Player player = Main.player[i];
			if (!player.active)
			{
				continue;
			}
			for (int j = 0; j < 58; j++)
			{
				Item item = player.inventory[j];
				if (item != null && item.stack > 0 && (item.dye > 0 || (item.type >= 1107 && item.type <= 1120) || (item.type >= 3385 && item.type <= 3388)))
				{
					return true;
				}
			}
			for (int k = 0; k < 10; k++)
			{
				Item item2 = player.dye[k];
				if (item2 != null && item2.stack > 0 && item2.dye > 0)
				{
					return true;
				}
			}
			for (int l = 0; l < 5; l++)
			{
				Item item3 = player.miscDyes[l];
				if (item3 != null && item3.stack > 0 && item3.dye > 0)
				{
					return true;
				}
			}
		}
		return false;
	}

	public static bool SpawnAllowed_Nurse()
	{
		if (unlockedNurseSpawn)
		{
			return true;
		}
		for (int i = 0; i < 255; i++)
		{
			Player player = Main.player[i];
			if (player.active && player.statLifeMax / 20 > 5)
			{
				return true;
			}
		}
		return false;
	}

	public static bool SpawnAllowed_Merchant()
	{
		if (unlockedMerchantSpawn)
		{
			return true;
		}
		double num = 5000.0;
		int num2 = 0;
		for (int i = 0; i < 255; i++)
		{
			Player player = Main.player[i];
			if (!player.active)
			{
				continue;
			}
			for (int j = 0; j < 58; j++)
			{
				Item item = player.inventory[j];
				if (item != null && item.stack > 0)
				{
					if (item.type == 71)
					{
						num2 += item.stack;
					}
					if (item.type == 72)
					{
						num2 += item.stack * 100;
					}
					if (item.type == 73)
					{
						num2 += item.stack * 10000;
					}
					if (item.type == 74)
					{
						num2 += item.stack * 1000000;
					}
					if ((double)num2 >= num)
					{
						return true;
					}
				}
			}
		}
		return false;
	}

	public static void ClearFoundActiveNPCs()
	{
		for (int i = 0; i < npcsFoundForCheckActive.Length; i++)
		{
			npcsFoundForCheckActive[i] = false;
		}
	}

	public static void UpdateFoundActiveNPCs()
	{
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			NPC nPC = Main.npc[i];
			if (nPC.active && nPC.type >= 0 && nPC.type < NPCID.Count)
			{
				npcsFoundForCheckActive[nPC.type] = true;
			}
		}
	}

	public static void ClearFoundNPCTypesForBestiary()
	{
		for (int i = 0; i < npcsFoundForCheckActive.Length; i++)
		{
			npcsFoundForCheckActive[i] = false;
		}
	}

	public void EncourageDespawn(int despawnTime)
	{
		if (timeLeft > despawnTime)
		{
			timeLeft = despawnTime;
		}
		despawnEncouraged = true;
	}

	public void DiscourageDespawn(int despawnTime)
	{
		if (timeLeft < despawnTime)
		{
			timeLeft = despawnTime;
		}
		despawnEncouraged = false;
	}

	public static bool WouldBeEncouragedToDespawn(int aistyle, int type)
	{
		if (aistyle == 4)
		{
			return Main.dayTime;
		}
		return false;
	}

	public static string getNewNPCName(int npcType)
	{
		return getNewNPCNameInner(npcType);
	}

	private static string getNewNPCNameInner(int npcType)
	{
		return npcType switch
		{
			17 => Language.RandomFromCategory("MerchantNames", WorldGen.genRand).Value, 
			18 => Language.RandomFromCategory("NurseNames", WorldGen.genRand).Value, 
			19 => Language.RandomFromCategory("ArmsDealerNames", WorldGen.genRand).Value, 
			20 => Language.RandomFromCategory("DryadNames", WorldGen.genRand).Value, 
			22 => Language.RandomFromCategory("GuideNames", WorldGen.genRand).Value, 
			38 => Language.RandomFromCategory("DemolitionistNames", WorldGen.genRand).Value, 
			54 => Language.RandomFromCategory("ClothierNames", WorldGen.genRand).Value, 
			107 => Language.RandomFromCategory("GoblinTinkererNames", WorldGen.genRand).Value, 
			108 => Language.RandomFromCategory("WizardNames", WorldGen.genRand).Value, 
			124 => Language.RandomFromCategory("MechanicNames", WorldGen.genRand).Value, 
			160 => Language.RandomFromCategory("TruffleNames", WorldGen.genRand).Value, 
			178 => Language.RandomFromCategory("SteampunkerNames", WorldGen.genRand).Value, 
			207 => Language.RandomFromCategory("DyeTraderNames", WorldGen.genRand).Value, 
			208 => Language.RandomFromCategory("PartyGirlNames", WorldGen.genRand).Value, 
			209 => Language.RandomFromCategory("CyborgNames", WorldGen.genRand).Value, 
			227 => Language.RandomFromCategory("PainterNames", WorldGen.genRand).Value, 
			228 => Language.RandomFromCategory("WitchDoctorNames", WorldGen.genRand).Value, 
			229 => Language.RandomFromCategory("PirateNames", WorldGen.genRand).Value, 
			353 => Language.RandomFromCategory("StylistNames", WorldGen.genRand).Value, 
			368 => Language.RandomFromCategory("TravelingMerchantNames", WorldGen.genRand).Value, 
			369 => Language.RandomFromCategory("AnglerNames", WorldGen.genRand).Value, 
			453 => Language.RandomFromCategory("SkeletonMerchantNames", WorldGen.genRand).Value, 
			441 => Language.RandomFromCategory("TaxCollectorNames", WorldGen.genRand).Value, 
			550 => Language.RandomFromCategory("BartenderNames", WorldGen.genRand).Value, 
			588 => Language.RandomFromCategory("GolferNames", WorldGen.genRand).Value, 
			633 => Language.RandomFromCategory("BestiaryGirlNames", WorldGen.genRand).Value, 
			663 => Language.RandomFromCategory("PrincessNames", WorldGen.genRand).Value, 
			637 => Language.RandomFromCategory("CatNames_Siamese", WorldGen.genRand).Value, 
			638 => Language.RandomFromCategory("DogNames_Labrador", WorldGen.genRand).Value, 
			656 => Language.RandomFromCategory("BunnyNames_White", WorldGen.genRand).Value, 
			670 => Language.RandomFromCategory("SlimeNames_Blue", WorldGen.genRand).Value, 
			678 => Language.RandomFromCategory("SlimeNames_Green", WorldGen.genRand).Value, 
			679 => Language.RandomFromCategory("SlimeNames_Old", WorldGen.genRand).Value, 
			680 => Language.RandomFromCategory("SlimeNames_Purple", WorldGen.genRand).Value, 
			681 => Language.RandomFromCategory("SlimeNames_Rainbow", WorldGen.genRand).Value, 
			682 => Language.RandomFromCategory("SlimeNames_Red", WorldGen.genRand).Value, 
			683 => Language.RandomFromCategory("SlimeNames_Yellow", WorldGen.genRand).Value, 
			684 => Language.RandomFromCategory("SlimeNames_Copper", WorldGen.genRand).Value, 
			_ => "", 
		};
	}

	public NetworkText GetTypeNetName()
	{
		return NetworkText.FromKey(Lang.GetNPCName(netID).Key);
	}

	public void GetLifeStats(out int statLife, out int statLifeMax)
	{
		statLife = life;
		statLifeMax = lifeMax;
		if (realLife != -1)
		{
			statLife = Main.npc[realLife].life;
			statLifeMax = Main.npc[realLife].lifeMax;
		}
	}

	public float GetLifePercent()
	{
		GetLifeStats(out var statLife, out var statLifeMax);
		return (float)statLife / (float)statLifeMax;
	}

	public NetworkText GetFullNetName()
	{
		if (!HasGivenName)
		{
			return GetTypeNetName();
		}
		return NetworkText.FromKey("Game.NPCTitle", GetGivenNetName(), GetTypeNetName());
	}

	public NetworkText GetGivenOrTypeNetName()
	{
		if (!HasGivenName)
		{
			return GetTypeNetName();
		}
		return GetGivenNetName();
	}

	public NetworkText GetGivenNetName()
	{
		return NetworkText.FromLiteral(_givenName);
	}

	public static void setNPCName(string newName, int npcType, bool resetExtras = false)
	{
		bool flag = false;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (!Main.npc[i].active || Main.npc[i].type != npcType)
			{
				continue;
			}
			if (flag)
			{
				Main.npc[i].GivenName = getNewNPCName(npcType);
				Main.npc[i].needsUniqueInfoUpdate = true;
				continue;
			}
			Main.npc[i].GivenName = newName;
			if (!resetExtras)
			{
				break;
			}
			flag = true;
		}
	}

	public static string firstNPCName(int npcType)
	{
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (Main.npc[i].active && Main.npc[i].type == npcType)
			{
				return Main.npc[i].GivenOrTypeName;
			}
		}
		return getNewNPCName(npcType);
	}

	public static string GetFirstNPCNameOrNull(int npcType)
	{
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (Main.npc[i].active && Main.npc[i].type == npcType)
			{
				return Main.npc[i].GivenOrTypeName;
			}
		}
		return null;
	}

	public static bool MechSpawn(float x, float y, int type)
	{
		int num = 0;
		int num2 = 0;
		int num3 = 0;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (!Main.npc[i].active)
			{
				continue;
			}
			bool flag = false;
			if (Main.npc[i].type == type)
			{
				flag = true;
			}
			else if (type == 74 || type == 297 || type == 298)
			{
				if (Main.npc[i].type == 74 || Main.npc[i].type == 297 || Main.npc[i].type == 298)
				{
					flag = true;
				}
			}
			else if (type == 46 || type == 540 || type == 303 || type == 337)
			{
				if (Main.npc[i].type == 46 || Main.npc[i].type == 540 || Main.npc[i].type == 303 || Main.npc[i].type == 337)
				{
					flag = true;
				}
			}
			else if (type == 362 || type == 364)
			{
				if (Main.npc[i].type == 362 || Main.npc[i].type == 363 || Main.npc[i].type == 364 || Main.npc[i].type == 365)
				{
					flag = true;
				}
			}
			else if (type == 602)
			{
				if (Main.npc[i].type == 602 || Main.npc[i].type == 603)
				{
					flag = true;
				}
			}
			else if (type == 608)
			{
				if (Main.npc[i].type == 608 || Main.npc[i].type == 609)
				{
					flag = true;
				}
			}
			else if (type == 616 || type == 617)
			{
				if (Main.npc[i].type == 616 || Main.npc[i].type == 617)
				{
					flag = true;
				}
			}
			else if (type == 55 && Main.npc[i].type == 230)
			{
				flag = true;
			}
			else if (NPCID.Sets.IsDragonfly[type] && NPCID.Sets.IsDragonfly[Main.npc[i].type])
			{
				flag = true;
			}
			if (flag)
			{
				num++;
				Vector2 vector = new Vector2(x, y);
				float num4 = Main.npc[i].position.X - vector.X;
				float num5 = Main.npc[i].position.Y - vector.Y;
				float num6 = (float)Math.Sqrt(num4 * num4 + num5 * num5);
				if (num6 < 200f)
				{
					num2++;
				}
				if (num6 < 600f)
				{
					num3++;
				}
			}
		}
		if (num2 >= 3 || num3 >= 6 || num >= 10)
		{
			return false;
		}
		return true;
	}

	public static int TypeToDefaultHeadIndex(int type)
	{
		return type switch
		{
			0 => 0, 
			17 => 2, 
			18 => 3, 
			19 => 6, 
			20 => 5, 
			22 => 1, 
			38 => 4, 
			54 => 7, 
			107 => 9, 
			108 => 10, 
			124 => 8, 
			142 => 11, 
			160 => 12, 
			178 => 13, 
			207 => 14, 
			208 => 15, 
			209 => 16, 
			227 => 17, 
			228 => 18, 
			229 => 19, 
			353 => 20, 
			368 => 21, 
			369 => 22, 
			441 => 23, 
			550 => 24, 
			588 => 25, 
			633 => 26, 
			663 => 45, 
			637 => 27, 
			638 => 33, 
			656 => 39, 
			670 => 46, 
			678 => 47, 
			679 => 48, 
			680 => 49, 
			681 => 50, 
			682 => 51, 
			683 => 52, 
			684 => 53, 
			_ => -1, 
		};
	}

	public int GetBossHeadTextureIndex()
	{
		int result = NPCID.Sets.BossHeadTextures[type];
		switch (type)
		{
		case 4:
			if (ai[0] >= 2f)
			{
				result = 1;
			}
			break;
		case 266:
			if (ai[0] < 0f || localAI[2] > 0f)
			{
				result = -1;
			}
			break;
		case 262:
			if (life <= lifeMax / 2)
			{
				result = 12;
			}
			break;
		case 125:
			if (ai[0] >= 3f)
			{
				result = 16;
			}
			break;
		case 126:
			if (ai[0] >= 3f)
			{
				result = 21;
			}
			break;
		case 439:
			if (ai[0] == 5f && alpha == 255)
			{
				result = -1;
			}
			break;
		case 440:
			if (ai[0] != 5f || alpha == 255)
			{
				result = -1;
			}
			break;
		}
		return result;
	}

	public float GetBossHeadRotation()
	{
		float result = 0f;
		switch (type)
		{
		case 68:
		case 262:
			result = rotation;
			break;
		case 35:
		case 127:
			if (ai[1] == 1f || ai[1] == 2f)
			{
				result = rotation;
			}
			break;
		case 345:
			if (ai[0] == 2f)
			{
				result = rotation;
			}
			break;
		}
		return result;
	}

	public SpriteEffects GetBossHeadSpriteEffects()
	{
		SpriteEffects result = SpriteEffects.None;
		int num = type;
		if (num == 491 && spriteDirection == 1)
		{
			result = SpriteEffects.FlipHorizontally;
		}
		return result;
	}

	public int BannerID()
	{
		if (netID >= -10)
		{
			return netID;
		}
		return type;
	}

	private void SetDefaultsFromNetId(int id, NPCSpawnParams spawnparams = default(NPCSpawnParams))
	{
		bool flag = false;
		int num = NPCID.FromNetId(id);
		SetDefaults(0);
		switch (id)
		{
		case -1:
			SetDefaults_ForNetId(num, spawnparams, 0.6f);
			flag = true;
			damage = 45;
			defense = 10;
			life = 90;
			knockBackResist *= 1.2f;
			value = 100f;
			break;
		case -2:
			SetDefaults_ForNetId(num, spawnparams, 0.9f);
			flag = true;
			damage = 45;
			defense = 20;
			life = 90;
			knockBackResist *= 1.2f;
			value = 100f;
			break;
		case -3:
			SetDefaults_ForNetId(num, spawnparams, 0.9f);
			flag = true;
			damage = 6;
			defense = 0;
			life = 14;
			knockBackResist *= 1.2f;
			color = new Color(0, 220, 40, 100);
			value = 3f;
			break;
		case -4:
			SetDefaults_ForNetId(num, spawnparams, 0.6f);
			flag = true;
			damage = 5;
			defense = 5;
			life = 150;
			knockBackResist *= 1.4f;
			color = new Color(250, 30, 90, 90);
			value = 10000f;
			rarity = 2;
			break;
		case -5:
			SetDefaults_ForNetId(num, spawnparams, 0.9f);
			flag = true;
			damage = 13;
			defense = 4;
			life = 30;
			knockBackResist *= 0.95f;
			alpha = 120;
			color = new Color(0, 0, 0, 50);
			value = 10f;
			break;
		case -6:
			SetDefaults_ForNetId(num, spawnparams, 1.05f);
			flag = true;
			damage = 15;
			defense = 4;
			life = 45;
			color = new Color(0, 0, 0, 50);
			value = 20f;
			break;
		case -7:
			SetDefaults_ForNetId(num, spawnparams, 1.2f);
			flag = true;
			damage = 12;
			defense = 6;
			life = 40;
			knockBackResist *= 0.9f;
			color = new Color(200, 0, 255, 150);
			value = 10f;
			break;
		case -8:
			SetDefaults_ForNetId(num, spawnparams, 1.025f);
			flag = true;
			damage = 12;
			defense = 4;
			life = 35;
			color = new Color(255, 30, 0, 100);
			value = 8f;
			break;
		case -9:
			SetDefaults_ForNetId(num, spawnparams, 1.2f);
			flag = true;
			damage = 15;
			defense = 7;
			life = 45;
			color = new Color(255, 255, 0, 100);
			value = 10f;
			break;
		case -10:
			SetDefaults_ForNetId(num, spawnparams, 1.1f);
			flag = true;
			damage = 18;
			defense = 6;
			life = 60;
			color = new Color(143, 215, 93, 100);
			value = 500f;
			break;
		case -11:
		{
			float num5 = 0.85f;
			if (Main.remixWorld && !IsABestiaryIconDummy)
			{
				num5 *= 1.3f;
			}
			SetDefaults_ForNetId(num, spawnparams, num5);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		}
		case -12:
		{
			float num4 = 1.15f;
			if ((Main.remixWorld || Main.getGoodWorld) && !IsABestiaryIconDummy)
			{
				num4 *= 1.3f;
			}
			SetDefaults_ForNetId(num, spawnparams, num4);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		}
		case -13:
			SetDefaults_ForNetId(num, spawnparams, 0.9f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			break;
		case -14:
			SetDefaults_ForNetId(num, spawnparams, 1.15f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((double)((float)damage * scale) * 1.1);
			life = (int)((double)((float)life * scale) * 1.1);
			value = (int)(value * scale);
			npcSlots = 2f;
			knockBackResist *= 2f - scale;
			break;
		case -15:
			SetDefaults_ForNetId(num, spawnparams, 1.15f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((double)((float)damage * scale) * 1.1);
			life = 400;
			value = (int)(value * scale);
			npcSlots = 2f;
			knockBackResist *= 2f - scale;
			height = 44;
			break;
		case -16:
			SetDefaults_ForNetId(num, spawnparams, 0.85f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -17:
			SetDefaults_ForNetId(num, spawnparams, 1.2f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -18:
			SetDefaults_ForNetId(num, spawnparams, 0.8f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -19:
			SetDefaults_ForNetId(num, spawnparams, 0.9f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -20:
			SetDefaults_ForNetId(num, spawnparams, 1.1f);
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -21:
			SetDefaults_ForNetId(num, spawnparams, 1.2f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -22:
		{
			float num3 = 0.85f;
			if (Main.remixWorld && !IsABestiaryIconDummy)
			{
				num3 *= 1.3f;
			}
			SetDefaults_ForNetId(num, spawnparams, num3);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		}
		case -23:
		{
			float num2 = 1.15f;
			if (Main.remixWorld && !IsABestiaryIconDummy)
			{
				num2 *= 1.3f;
			}
			SetDefaults_ForNetId(num, spawnparams, num2);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		}
		case -24:
			SetDefaults_ForNetId(num, spawnparams, 0.85f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -25:
			SetDefaults_ForNetId(num, spawnparams, 1.15f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -26:
			SetDefaults_ForNetId(num, spawnparams, 0.9f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -27:
			SetDefaults_ForNetId(num, spawnparams, 1.1f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -28:
			SetDefaults_ForNetId(num, spawnparams, 0.85f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -29:
			SetDefaults_ForNetId(num, spawnparams, 1.15f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -30:
			SetDefaults_ForNetId(num, spawnparams, 0.93f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -31:
			SetDefaults_ForNetId(num, spawnparams, 1.13f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -32:
			SetDefaults_ForNetId(num, spawnparams, 0.89f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -33:
			SetDefaults_ForNetId(num, spawnparams, 1.11f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -34:
			SetDefaults_ForNetId(num, spawnparams, 0.87f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -35:
			SetDefaults_ForNetId(num, spawnparams, 1.13f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -36:
			SetDefaults_ForNetId(num, spawnparams, 0.92f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -37:
			SetDefaults_ForNetId(num, spawnparams, 1.08f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -38:
			SetDefaults_ForNetId(num, spawnparams, 1.15f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -39:
			SetDefaults_ForNetId(num, spawnparams, 1.1f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -40:
			SetDefaults_ForNetId(num, spawnparams, 0.9f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -41:
			SetDefaults_ForNetId(num, spawnparams, 0.85f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -42:
			SetDefaults_ForNetId(num, spawnparams, 1.1f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -43:
			SetDefaults_ForNetId(num, spawnparams, 1.15f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -44:
			SetDefaults_ForNetId(num, spawnparams, 0.87f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -45:
			SetDefaults_ForNetId(num, spawnparams, 1.05f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -46:
			SetDefaults_ForNetId(num, spawnparams, 0.9f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -47:
			SetDefaults_ForNetId(num, spawnparams, 1.1f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -48:
			SetDefaults_ForNetId(num, spawnparams, 0.93f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -49:
			SetDefaults_ForNetId(num, spawnparams, 1.07f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -50:
			SetDefaults_ForNetId(num, spawnparams, 0.87f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -51:
			SetDefaults_ForNetId(num, spawnparams, 1.13f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -52:
			SetDefaults_ForNetId(num, spawnparams, 0.85f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -53:
			SetDefaults_ForNetId(num, spawnparams, 1.15f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -54:
			SetDefaults_ForNetId(num, spawnparams, 0.9f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -55:
			SetDefaults_ForNetId(num, spawnparams, 1.1f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -56:
			SetDefaults_ForNetId(num, spawnparams, 0.85f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -57:
			SetDefaults_ForNetId(num, spawnparams, 1.25f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -58:
			SetDefaults_ForNetId(num, spawnparams, 0.8f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -59:
			SetDefaults_ForNetId(num, spawnparams, 1.15f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -60:
			SetDefaults_ForNetId(num, spawnparams, 0.92f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -61:
			SetDefaults_ForNetId(num, spawnparams, 1.1f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -62:
			SetDefaults_ForNetId(num, spawnparams, 0.78f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -63:
			SetDefaults_ForNetId(num, spawnparams, 1.16f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -64:
			SetDefaults_ForNetId(num, spawnparams, 0.87f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		case -65:
			SetDefaults_ForNetId(num, spawnparams, 1.21f);
			flag = false;
			defense = (int)((float)defense * scale);
			damage = (int)((float)damage * scale);
			life = (int)((float)life * scale);
			value = (int)(value * scale);
			npcSlots *= scale;
			knockBackResist *= 2f - scale;
			break;
		default:
			return;
		}
		netID = id;
		lifeMax = life;
		defDamage = damage;
		defDefense = defense;
		defLifeMax = lifeMax;
		if (flag)
		{
			ScaleStats(spawnparams.playerCountForMultiplayerDifficultyOverride, spawnparams.difficultyOverride);
			life = lifeMax;
		}
	}

	public void SetDefaults_ForNetId(int Type, NPCSpawnParams spawnparams, float scaleOverride)
	{
		SetDefaults(Type, spawnparams.WithScale(scaleOverride));
	}

	public void ResetForNewNPC()
	{
		netOffset = Vector2.Zero;
		netStream = 0;
		netSpam = 0;
		Array.Clear(playerNetSyncState, 0, playerNetSyncState.Length);
		velocity = Vector2.Zero;
		direction = 0;
		oldDirection = 0;
		spriteDirection = -1;
		wet = false;
		lavaWet = false;
		honeyWet = false;
		shimmerWet = false;
		SpawnedFromStatue = false;
		extraValue = 0;
		shimmerTransparency = 0f;
		lookForHomeTimeout = 0;
		Array.Clear(buffTime, 0, buffTime.Length);
		Array.Clear(buffType, 0, buffType.Length);
		Array.Clear(playerInteraction, 0, playerInteraction.Length);
		if (whoAmI < Main.maxNPCs)
		{
			PortalHelper.ResetNPCSlotData(whoAmI);
			Projectile.ResetNPCSlotData(whoAmI);
			Player.ResetNPCSlotData(whoAmI);
		}
	}

	public void SetDefaults(int Type, NPCSpawnParams spawnparams = default(NPCSpawnParams))
	{
		if (Main.getGoodWorld && !IsABestiaryIconDummy && spawnparams.sizeScaleOverride.HasValue)
		{
			spawnparams.sizeScaleOverride = (spawnparams.sizeScaleOverride + spawnparams.sizeScaleOverride * spawnparams.sizeScaleOverride) / 2f;
		}
		if (Type < 0)
		{
			SetDefaultsFromNetId(Type, spawnparams);
			return;
		}
		waterMovementSpeed = (lavaMovementSpeed = 0.5f);
		honeyMovementSpeed = 0.25f;
		altTexture = 0;
		townNpcVariationIndex = 0;
		nameOver = 0f;
		takenDamageMultiplier = 1f;
		rarity = 0;
		dontCountMe = false;
		releaseOwner = 255;
		catchItem = 0;
		needsUniqueInfoUpdate = true;
		netID = 0;
		netAlways = false;
		CanBeReplacedByOtherNPCs = false;
		statsAreScaledForThisManyPlayers = 0;
		difficulty = 1f;
		int num = 10;
		if (Type >= 0)
		{
			num = NPCID.Sets.TrailCacheLength[Type];
		}
		if (num != oldPos.Length)
		{
			Array.Resize(ref oldPos, num);
			Array.Resize(ref oldRot, num);
		}
		for (int i = 0; i < oldPos.Length; i++)
		{
			oldRot[i] = 0f;
			oldPos[i].X = 0f;
			oldPos[i].Y = 0f;
		}
		for (int j = 0; j < BuffID.Count; j++)
		{
			buffImmune[j] = false;
		}
		setFrameSize = false;
		spawnNeedsSyncing = false;
		realLife = -1;
		lifeRegen = 0;
		lifeRegenExpectedLossPerSecond = -1;
		lifeRegenCount = 0;
		markedByScytheWhip = false;
		markedByEelWhip = false;
		poisoned = false;
		bleeding = false;
		tipsy = false;
		hemorrhage = false;
		soulDrain = false;
		venom = false;
		shadowFlame = false;
		canDisplayBuffs = true;
		onFire = false;
		midas = false;
		ichor = false;
		brokenArmor = false;
		onFrostBurn = false;
		onFrostBurn2 = false;
		shimmering = false;
		confused = false;
		loveStruck = false;
		dontTakeDamageFromHostiles = false;
		stinky = false;
		dryadWard = false;
		onFire2 = false;
		onFire3 = false;
		justHit = false;
		dontTakeDamage = false;
		catchableNPCTempImmunityCounter = 0;
		electricEelCounter = 0;
		npcSlots = 1f;
		lavaImmune = false;
		wetCount = 0;
		townNPC = false;
		homeless = false;
		homelessDespawn = false;
		homeTileX = -1;
		homeTileY = -1;
		housingCategory = 0;
		friendly = false;
		behindTiles = false;
		boss = false;
		noTileCollide = false;
		rotation = 0f;
		active = Type != 0;
		alpha = 0;
		color = default(Color);
		collideX = false;
		collideY = false;
		frameCounter = 0.0;
		netUpdate = true;
		netUpdatePendingSpamCooldown = false;
		netUpdatePendingFullSpamCooldown = false;
		knockBackResist = 1f;
		GivenName = "";
		noGravity = false;
		scale = 1f;
		HitSound = null;
		DeathSound = null;
		target = 255;
		oldTarget = target;
		targetRect = default(Rectangle);
		timeLeft = activeTime;
		type = Type;
		value = 0f;
		coldDamage = false;
		trapImmune = false;
		hide = false;
		immortal = false;
		chaseable = true;
		breath = 200;
		breathCounter = 0;
		reflectsProjectiles = false;
		canGhostHeal = true;
		javelined = false;
		tentacleSpiked = false;
		bloodButchered = false;
		daybreak = false;
		celled = false;
		dryadBane = false;
		betsysCurse = false;
		oiled = false;
		despawnEncouraged = false;
		damage = 0;
		for (int k = 0; k < maxAI; k++)
		{
			ai[k] = 0f;
		}
		for (int l = 0; l < maxAI; l++)
		{
			localAI[l] = 0f;
		}
		if (type == 1)
		{
			width = 24;
			height = 18;
			aiStyle = 1;
			damage = 7;
			defense = 2;
			lifeMax = 25;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			alpha = 175;
			color = new Color(0, 80, 255, 100);
			value = 25f;
		}
		else if (type == 2)
		{
			width = 30;
			height = 32;
			aiStyle = 2;
			damage = 18;
			defense = 2;
			lifeMax = 60;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath1;
			value = 75f;
		}
		else if (type == 3)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 14;
			defense = 6;
			lifeMax = 45;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 60f;
		}
		else if (type == 430)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 14;
			defense = 6;
			lifeMax = 45;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 60f;
		}
		else if (type == 431)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 16;
			defense = 8;
			lifeMax = 50;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.45f;
			value = 80f;
		}
		else if (type == 432)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 16;
			defense = 8;
			lifeMax = 50;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.45f;
			value = 65f;
		}
		else if (type == 433)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 13;
			defense = 6;
			lifeMax = 40;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.55f;
			value = 55f;
		}
		else if (type == 434)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 13;
			defense = 8;
			lifeMax = 45;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.45f;
			value = 80f;
		}
		else if (type == 435)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 16;
			defense = 4;
			lifeMax = 45;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.55f;
			value = 70f;
		}
		else if (type == 436)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 12;
			defense = 4;
			lifeMax = 38;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.6f;
			value = 65f;
		}
		else if (type == 4)
		{
			width = 100;
			height = 110;
			aiStyle = 4;
			damage = 15;
			defense = 12;
			lifeMax = 2800;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			boss = true;
			value = 30000f;
			npcSlots = 5f;
		}
		else if (type == 5)
		{
			width = 20;
			height = 20;
			aiStyle = 5;
			damage = 12;
			defense = 0;
			lifeMax = 8;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
		}
		else if (type == 6)
		{
			npcSlots = 1f;
			width = 30;
			height = 30;
			aiStyle = 5;
			damage = 22;
			defense = 8;
			lifeMax = 40;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			knockBackResist = 0.5f;
			value = 90f;
			if (Main.remixWorld)
			{
				if (!IsABestiaryIconDummy)
				{
					scale *= 1.3f;
				}
				damage = (int)((float)damage * scale);
				defense = (int)((float)defense * scale);
				lifeMax = (int)((float)lifeMax * scale);
				value = (int)(value * scale);
			}
			else if (Main.getGoodWorld && !IsABestiaryIconDummy)
			{
				scale *= 1.3f;
			}
		}
		else if (type == 7)
		{
			npcSlots = 3.5f;
			width = 22;
			height = 22;
			aiStyle = 6;
			damage = 31;
			defense = 2;
			lifeMax = 100;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 140f;
			netAlways = true;
			if (Main.remixWorld)
			{
				if (!IsABestiaryIconDummy)
				{
					scale *= 1.3f;
				}
				damage = (int)((float)damage * scale);
				defense = (int)((float)defense * scale);
				lifeMax = (int)((float)lifeMax * scale);
				value = (int)(value * scale);
			}
		}
		else if (type == 8)
		{
			width = 22;
			height = 22;
			aiStyle = 6;
			netAlways = true;
			damage = 16;
			defense = 6;
			lifeMax = 100;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 140f;
			dontCountMe = true;
			if (Main.remixWorld)
			{
				if (!IsABestiaryIconDummy)
				{
					scale *= 1.3f;
				}
				damage = (int)((float)damage * scale);
				defense = (int)((float)defense * scale);
				lifeMax = (int)((float)lifeMax * scale);
				value = (int)(value * scale);
			}
		}
		else if (type == 9)
		{
			width = 22;
			height = 22;
			aiStyle = 6;
			netAlways = true;
			damage = 13;
			defense = 10;
			lifeMax = 100;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 140f;
			dontCountMe = true;
			if (Main.remixWorld)
			{
				if (!IsABestiaryIconDummy)
				{
					scale *= 1.3f;
				}
				damage = (int)((float)damage * scale);
				defense = (int)((float)defense * scale);
				lifeMax = (int)((float)lifeMax * scale);
				value = (int)(value * scale);
			}
		}
		else if (type == 10)
		{
			width = 14;
			height = 14;
			aiStyle = 6;
			netAlways = true;
			damage = 8;
			defense = 0;
			lifeMax = 30;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 40f;
		}
		else if (type == 11)
		{
			width = 14;
			height = 14;
			aiStyle = 6;
			netAlways = true;
			damage = 4;
			defense = 4;
			lifeMax = 30;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 40f;
			dontCountMe = true;
		}
		else if (type == 12)
		{
			width = 14;
			height = 14;
			aiStyle = 6;
			netAlways = true;
			damage = 4;
			defense = 6;
			lifeMax = 30;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 40f;
			dontCountMe = true;
		}
		else if (type == 13)
		{
			npcSlots = 5f;
			width = 38;
			height = 38;
			aiStyle = 6;
			netAlways = true;
			damage = 22;
			defense = 2;
			lifeMax = 150;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 800f;
			scale = 1f;
			alpha = 255;
		}
		else if (type == 14)
		{
			width = 38;
			height = 38;
			aiStyle = 6;
			netAlways = true;
			damage = 13;
			defense = 4;
			lifeMax = 150;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 800f;
			scale = 1f;
			dontCountMe = true;
			alpha = 255;
		}
		else if (type == 15)
		{
			width = 38;
			height = 38;
			aiStyle = 6;
			netAlways = true;
			damage = 11;
			defense = 8;
			lifeMax = 150;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 800f;
			scale = 1f;
			dontCountMe = true;
			alpha = 255;
		}
		else if (type == 16)
		{
			npcSlots = 2f;
			width = 36;
			height = 24;
			aiStyle = 1;
			damage = 20;
			defense = 7;
			lifeMax = 90;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			alpha = 120;
			color = new Color(0, 0, 0, 50);
			value = 75f;
			scale = 1.25f;
			knockBackResist = 0.6f;
		}
		else if (type == 17)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 18)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 19)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 20)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 21)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 20;
			defense = 8;
			lifeMax = 60;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 100f;
		}
		else if (type == 22)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 30;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 23)
		{
			width = 22;
			height = 22;
			aiStyle = 5;
			damage = 40;
			defense = 6;
			lifeMax = 26;
			HitSound = SoundID.NPCHit3;
			DeathSound = SoundID.NPCDeath3;
			noGravity = true;
			noTileCollide = true;
			value = 80f;
			knockBackResist = 0.4f;
		}
		else if (type == 24)
		{
			npcSlots = 3f;
			width = 18;
			height = 40;
			aiStyle = 8;
			damage = 30;
			defense = 16;
			lifeMax = 70;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			lavaImmune = true;
			value = 350f;
		}
		else if (type == 25)
		{
			width = 16;
			height = 16;
			aiStyle = 9;
			damage = 30;
			defense = 0;
			lifeMax = 1;
			HitSound = SoundID.NPCHit3;
			DeathSound = SoundID.NPCDeath3;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			alpha = 100;
		}
		else if (type == 31)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 26;
			defense = 8;
			lifeMax = 80;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.8f;
			value = 130f;
		}
		else if (type == 32)
		{
			width = 18;
			height = 40;
			aiStyle = 8;
			damage = 20;
			defense = 2;
			lifeMax = 50;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.6f;
			value = 140f;
			npcSlots = 2f;
		}
		else if (type == 33)
		{
			width = 16;
			height = 16;
			aiStyle = 9;
			damage = 20;
			defense = 0;
			lifeMax = 1;
			HitSound = SoundID.NPCHit3;
			DeathSound = SoundID.NPCDeath3;
			noGravity = true;
			noTileCollide = true;
			alpha = 255;
			knockBackResist = 0f;
		}
		else if (type == 34)
		{
			width = 26;
			height = 28;
			aiStyle = 10;
			damage = 35;
			defense = 6;
			lifeMax = 40;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			noGravity = true;
			noTileCollide = true;
			value = 150f;
			knockBackResist = 0.2f;
			npcSlots = 0.75f;
		}
		else if (type == 35)
		{
			width = 80;
			height = 102;
			aiStyle = 11;
			damage = 32;
			defense = 10;
			lifeMax = 4400;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			noGravity = true;
			noTileCollide = true;
			value = 50000f;
			knockBackResist = 0f;
			boss = true;
			npcSlots = 6f;
		}
		else if (type == 36)
		{
			width = 52;
			height = 52;
			aiStyle = 12;
			damage = 20;
			defense = 14;
			lifeMax = 600;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
		}
		else if (type == 37)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 38)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 39)
		{
			npcSlots = 6f;
			width = 22;
			height = 22;
			aiStyle = 6;
			netAlways = true;
			damage = 36;
			defense = 12;
			lifeMax = 300;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath5;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 1200f;
		}
		else if (type == 40)
		{
			width = 22;
			height = 22;
			aiStyle = 6;
			netAlways = true;
			damage = 20;
			defense = 18;
			lifeMax = 300;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath5;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 1200f;
			dontCountMe = true;
		}
		else if (type == 41)
		{
			width = 22;
			height = 22;
			aiStyle = 6;
			netAlways = true;
			damage = 16;
			defense = 18;
			lifeMax = 300;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath5;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 1200f;
			dontCountMe = true;
		}
		else if (type == 42)
		{
			width = 34;
			height = 32;
			aiStyle = 5;
			damage = 26;
			defense = 12;
			lifeMax = 48;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.5f;
			DeathSound = SoundID.NPCDeath1;
			value = 200f;
			noGravity = true;
		}
		else if (type == 43)
		{
			noGravity = true;
			noTileCollide = true;
			width = 30;
			height = 30;
			aiStyle = 13;
			damage = 34;
			defense = 10;
			lifeMax = 110;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0f;
			DeathSound = SoundID.NPCDeath1;
			value = 350f;
		}
		else if (type == 44)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 22;
			defense = 9;
			lifeMax = 70;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 250f;
			rarity = 1;
		}
		else if (type == 45)
		{
			width = 18;
			height = 40;
			aiStyle = 8;
			damage = 20;
			defense = 4;
			lifeMax = 200;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.6f;
			value = 5000f;
			rarity = 4;
		}
		else if (type == 46 || type == 303 || type == 337 || type == 540)
		{
			width = 18;
			height = 20;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 2019;
		}
		else if (type == 47)
		{
			width = 18;
			height = 20;
			aiStyle = 3;
			damage = 20;
			defense = 4;
			lifeMax = 70;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 500f;
		}
		else if (type == 48)
		{
			width = 24;
			height = 34;
			aiStyle = 14;
			damage = 25;
			defense = 8;
			lifeMax = 100;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.6f;
			DeathSound = SoundID.NPCDeath1;
			value = 300f;
		}
		else if (type == 49)
		{
			npcSlots = 0.5f;
			width = 22;
			height = 18;
			aiStyle = 14;
			damage = 13;
			defense = 2;
			lifeMax = 16;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath4;
			value = 90f;
		}
		else if (type == 50)
		{
			boss = true;
			width = 98;
			height = 92;
			aiStyle = 15;
			damage = 40;
			defense = 10;
			lifeMax = 2000;
			knockBackResist = 0f;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			alpha = 30;
			value = 10000f;
			scale = 1.25f;
			npcSlots = 5f;
		}
		else if (type == 51)
		{
			npcSlots = 0.5f;
			width = 22;
			height = 18;
			aiStyle = 14;
			damage = 20;
			defense = 4;
			lifeMax = 34;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath4;
			value = 80f;
		}
		else if (type == 52)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 20;
			defense = 10;
			lifeMax = 500;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 1000f;
			rarity = 2;
		}
		else if (type == 53)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 14;
			defense = 8;
			lifeMax = 200;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 1000f;
			rarity = 2;
		}
		else if (type == 54)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 55)
		{
			noGravity = true;
			width = 20;
			height = 18;
			aiStyle = 16;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			catchItem = 261;
		}
		else if (type == 56)
		{
			noTileCollide = true;
			noGravity = true;
			width = 30;
			height = 30;
			aiStyle = 13;
			damage = 25;
			defense = 10;
			lifeMax = 60;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0f;
			DeathSound = SoundID.NPCDeath1;
			value = 90f;
		}
		else if (type == 57)
		{
			noGravity = true;
			width = 18;
			height = 20;
			aiStyle = 16;
			damage = 30;
			defense = 6;
			lifeMax = 100;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 500f;
		}
		else if (type == 58)
		{
			npcSlots = 0.5f;
			noGravity = true;
			width = 18;
			height = 20;
			aiStyle = 16;
			damage = 25;
			defense = 2;
			lifeMax = 30;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 50f;
		}
		else if (type == 59)
		{
			width = 24;
			height = 18;
			aiStyle = 1;
			damage = 15;
			defense = 10;
			lifeMax = 50;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			scale = 1.1f;
			alpha = 50;
			lavaImmune = true;
			value = 120f;
			if (Main.remixWorld)
			{
				damage = 7;
				defense = 2;
				lifeMax = 25;
				value = 25f;
			}
		}
		else if (type == 60)
		{
			npcSlots = 0.5f;
			width = 22;
			height = 18;
			aiStyle = 14;
			damage = 35;
			defense = 8;
			lifeMax = 46;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath4;
			value = 120f;
			scale = 1.1f;
			lavaImmune = true;
		}
		else if (type == 61)
		{
			width = 36;
			height = 36;
			aiStyle = 17;
			damage = 15;
			defense = 4;
			lifeMax = 40;
			knockBackResist = 0.8f;
			HitSound = SoundID.NPCHit28;
			DeathSound = SoundID.NPCDeath31;
			value = 60f;
		}
		else if (type == 62)
		{
			npcSlots = 2f;
			width = 28;
			height = 48;
			aiStyle = 14;
			damage = 32;
			defense = 8;
			lifeMax = 120;
			HitSound = SoundID.NPCHit21;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath24;
			value = 300f;
			lavaImmune = true;
		}
		else if (type == 63)
		{
			noGravity = true;
			width = 26;
			height = 26;
			aiStyle = 18;
			damage = 25;
			defense = 4;
			lifeMax = 34;
			HitSound = SoundID.NPCHit25;
			DeathSound = SoundID.NPCDeath28;
			value = 100f;
			alpha = 20;
		}
		else if (type == 64)
		{
			noGravity = true;
			width = 26;
			height = 26;
			aiStyle = 18;
			damage = 30;
			defense = 6;
			lifeMax = 70;
			HitSound = SoundID.NPCHit25;
			DeathSound = SoundID.NPCDeath28;
			value = 100f;
			alpha = 20;
		}
		else if (type == 65)
		{
			noGravity = true;
			width = 100;
			height = 24;
			aiStyle = 16;
			damage = 40;
			defense = 2;
			lifeMax = 300;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 400f;
			knockBackResist = 0.7f;
		}
		else if (type == 66)
		{
			npcSlots = 2f;
			width = 28;
			height = 48;
			aiStyle = 14;
			damage = 32;
			defense = 8;
			lifeMax = 140;
			HitSound = SoundID.NPCHit21;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath24;
			value = 1000f;
			lavaImmune = true;
			rarity = 1;
		}
		else if (type == 67)
		{
			width = 28;
			height = 20;
			aiStyle = 3;
			damage = 20;
			defense = 10;
			lifeMax = 40;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 60f;
		}
		else if (type == 68)
		{
			width = 80;
			height = 102;
			aiStyle = 11;
			damage = 9999;
			defense = 9999;
			lifeMax = 9999;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
		}
		else if (type == 69)
		{
			width = 24;
			height = 24;
			aiStyle = 19;
			damage = 10;
			defense = 6;
			lifeMax = 45;
			HitSound = SoundID.NPCHit31;
			DeathSound = SoundID.NPCDeath34;
			knockBackResist = 0f;
			value = 60f;
			behindTiles = true;
		}
		else if (type == 70)
		{
			npcSlots = 0.3f;
			width = 34;
			height = 34;
			aiStyle = 20;
			damage = 32;
			defense = 100;
			lifeMax = 100;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			dontTakeDamage = true;
			scale = 1.5f;
		}
		else if (type == 71)
		{
			npcSlots = 2f;
			width = 36;
			height = 24;
			aiStyle = 1;
			damage = 30;
			defense = 7;
			lifeMax = 150;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			alpha = 60;
			value = 150f;
			scale = 1.25f;
			knockBackResist = 0.6f;
			rarity = 1;
		}
		else if (type == 72)
		{
			npcSlots = 0.3f;
			width = 34;
			height = 34;
			aiStyle = 21;
			damage = 24;
			defense = 100;
			lifeMax = 100;
			alpha = 100;
			behindTiles = true;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0f;
			noGravity = true;
			dontTakeDamage = true;
			scale = 1.2f;
		}
		else if (type == 73)
		{
			scale = 0.95f;
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 20;
			defense = 6;
			lifeMax = 80;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.7f;
			value = 200f;
			rarity = 1;
		}
		else if (type == 74 || type == 297 || type == 298)
		{
			width = 14;
			height = 14;
			aiStyle = 24;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath1;
			if (type == 74)
			{
				catchItem = 2015;
			}
			if (type == 297)
			{
				catchItem = 2016;
			}
			if (type == 298)
			{
				catchItem = 2017;
			}
			npcSlots = 0.4f;
		}
		else if (type == 75)
		{
			noGravity = true;
			width = 20;
			height = 20;
			aiStyle = 22;
			damage = 55;
			defense = 20;
			lifeMax = 150;
			HitSound = SoundID.NPCHit5;
			knockBackResist = 0.6f;
			DeathSound = SoundID.NPCDeath7;
			value = 350f;
		}
		else if (type == 77)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 40;
			defense = 28;
			lifeMax = 260;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.4f;
			value = 400f;
		}
		else if (type == 78)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 50;
			defense = 16;
			lifeMax = 130;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.6f;
			value = 600f;
		}
		else if (type == 79)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 60;
			defense = 18;
			lifeMax = 180;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.5f;
			value = 700f;
		}
		else if (type == 80)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 55;
			defense = 18;
			lifeMax = 200;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.55f;
			value = 700f;
		}
		else if (type == 81)
		{
			width = 40;
			height = 30;
			aiStyle = 1;
			damage = 55;
			defense = 20;
			lifeMax = 170;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			alpha = 55;
			value = 400f;
			scale = 1.1f;
		}
		else if (type == 82)
		{
			noGravity = true;
			noTileCollide = true;
			width = 24;
			height = 44;
			aiStyle = 22;
			damage = 65;
			defense = 16;
			lifeMax = 160;
			HitSound = SoundID.NPCHit54;
			DeathSound = SoundID.NPCDeath52;
			alpha = 100;
			value = 500f;
			knockBackResist = 0.7f;
			if (Main.remixWorld)
			{
				if (!IsABestiaryIconDummy)
				{
					scale *= 1.2f;
				}
				damage = (int)((float)damage * scale);
				defense = (int)((float)defense * scale);
				lifeMax = (int)((float)lifeMax * scale);
				value = (int)(value * scale);
			}
		}
		else if (type == 83)
		{
			width = 40;
			height = 40;
			aiStyle = 23;
			damage = 80;
			defense = 18;
			lifeMax = 200;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath6;
			value = 1000f;
			knockBackResist = 0.4f;
		}
		else if (type == 84)
		{
			width = 40;
			height = 40;
			aiStyle = 23;
			damage = 80;
			defense = 18;
			lifeMax = 200;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath6;
			value = 1000f;
			knockBackResist = 0.4f;
		}
		else if (type == 85)
		{
			width = 24;
			height = 24;
			aiStyle = 25;
			damage = 80;
			defense = 30;
			lifeMax = 500;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath6;
			value = 100000f;
			knockBackResist = 0.3f;
			rarity = 4;
			if (!Main.hardMode)
			{
				damage = 30;
				defense = 12;
				lifeMax = 300;
				value = Item.buyPrice(0, 2);
			}
		}
		else if (type == 86)
		{
			width = 46;
			height = 42;
			aiStyle = 26;
			damage = 65;
			defense = 30;
			lifeMax = 400;
			HitSound = SoundID.NPCHit12;
			DeathSound = SoundID.NPCDeath18;
			knockBackResist = 0.3f;
			value = 1000f;
		}
		else if (type == 87)
		{
			noTileCollide = true;
			npcSlots = 5f;
			width = 32;
			height = 32;
			aiStyle = 6;
			netAlways = true;
			damage = 80;
			defense = 10;
			lifeMax = 4000;
			HitSound = SoundID.NPCHit7;
			DeathSound = SoundID.NPCDeath8;
			noGravity = true;
			knockBackResist = 0f;
			value = 10000f;
			scale = 1f;
		}
		else if (type == 88)
		{
			noTileCollide = true;
			width = 32;
			height = 32;
			aiStyle = 6;
			netAlways = true;
			damage = 40;
			defense = 20;
			lifeMax = 4000;
			HitSound = SoundID.NPCHit7;
			DeathSound = SoundID.NPCDeath8;
			noGravity = true;
			knockBackResist = 0f;
			value = 10000f;
			scale = 1f;
			dontCountMe = true;
		}
		else if (type == 89)
		{
			noTileCollide = true;
			width = 32;
			height = 32;
			aiStyle = 6;
			netAlways = true;
			damage = 40;
			defense = 20;
			lifeMax = 4000;
			HitSound = SoundID.NPCHit7;
			DeathSound = SoundID.NPCDeath8;
			noGravity = true;
			knockBackResist = 0f;
			value = 2000f;
			scale = 1f;
			dontCountMe = true;
		}
		else if (type == 90)
		{
			noTileCollide = true;
			width = 32;
			height = 32;
			aiStyle = 6;
			netAlways = true;
			damage = 40;
			defense = 20;
			lifeMax = 4000;
			HitSound = SoundID.NPCHit7;
			DeathSound = SoundID.NPCDeath8;
			noGravity = true;
			knockBackResist = 0f;
			value = 10000f;
			scale = 1f;
			dontCountMe = true;
		}
		else if (type == 91)
		{
			noTileCollide = true;
			width = 32;
			height = 32;
			aiStyle = 6;
			netAlways = true;
			damage = 40;
			defense = 20;
			lifeMax = 4000;
			HitSound = SoundID.NPCHit7;
			DeathSound = SoundID.NPCDeath8;
			noGravity = true;
			knockBackResist = 0f;
			value = 10000f;
			scale = 1f;
			dontCountMe = true;
		}
		else if (type == 92)
		{
			noTileCollide = true;
			width = 32;
			height = 32;
			aiStyle = 6;
			netAlways = true;
			damage = 40;
			defense = 20;
			lifeMax = 4000;
			HitSound = SoundID.NPCHit7;
			DeathSound = SoundID.NPCDeath8;
			noGravity = true;
			knockBackResist = 0f;
			value = 10000f;
			scale = 1f;
			dontCountMe = true;
		}
		else if (type == 93)
		{
			npcSlots = 0.5f;
			width = 26;
			height = 20;
			aiStyle = 14;
			damage = 45;
			defense = 16;
			lifeMax = 100;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.75f;
			DeathSound = SoundID.NPCDeath4;
			value = 400f;
		}
		else if (type == 94)
		{
			npcSlots = 1f;
			width = 44;
			height = 44;
			aiStyle = 5;
			damage = 60;
			defense = 32;
			lifeMax = 230;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			knockBackResist = 0.55f;
			value = 500f;
		}
		else if (type == 95)
		{
			width = 22;
			height = 22;
			aiStyle = 6;
			netAlways = true;
			damage = 45;
			defense = 10;
			lifeMax = 200;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			scale = 0.9f;
			value = 300f;
		}
		else if (type == 96)
		{
			width = 22;
			height = 22;
			aiStyle = 6;
			netAlways = true;
			damage = 28;
			defense = 20;
			lifeMax = 200;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			scale = 0.9f;
			value = 300f;
			dontCountMe = true;
		}
		else if (type == 97)
		{
			width = 22;
			height = 22;
			aiStyle = 6;
			netAlways = true;
			damage = 26;
			defense = 30;
			lifeMax = 200;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			scale = 0.9f;
			value = 300f;
			dontCountMe = true;
		}
		else if (type == 98)
		{
			npcSlots = 3.5f;
			width = 22;
			height = 22;
			aiStyle = 6;
			netAlways = true;
			damage = 70;
			defense = 36;
			lifeMax = 500;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 700f;
		}
		else if (type == 99)
		{
			width = 22;
			height = 22;
			aiStyle = 6;
			netAlways = true;
			damage = 55;
			defense = 40;
			lifeMax = 500;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 700f;
			dontCountMe = true;
		}
		else if (type == 100)
		{
			width = 22;
			height = 22;
			aiStyle = 6;
			netAlways = true;
			damage = 40;
			defense = 44;
			lifeMax = 500;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 700f;
			dontCountMe = true;
		}
		else if (type == 101)
		{
			noGravity = true;
			noTileCollide = true;
			behindTiles = true;
			width = 30;
			height = 30;
			aiStyle = 13;
			damage = 70;
			defense = 30;
			lifeMax = 320;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.2f;
			DeathSound = SoundID.NPCDeath1;
			value = 600f;
		}
		else if (type == 102)
		{
			npcSlots = 0.5f;
			noGravity = true;
			width = 18;
			height = 20;
			aiStyle = 16;
			damage = 80;
			defense = 22;
			lifeMax = 90;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 500f;
		}
		else if (type == 103)
		{
			noGravity = true;
			width = 26;
			height = 26;
			aiStyle = 18;
			damage = 80;
			defense = 30;
			lifeMax = 120;
			HitSound = SoundID.NPCHit25;
			DeathSound = SoundID.NPCDeath28;
			value = 800f;
			alpha = 20;
		}
		else if (type == 104)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 70;
			defense = 38;
			lifeMax = 350;
			HitSound = SoundID.NPCHit6;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.4f;
			value = 1000f;
		}
		else if (type == 105)
		{
			friendly = true;
			width = 18;
			height = 34;
			aiStyle = 0;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			rarity = 1;
		}
		else if (type == 106)
		{
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 0;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			rarity = 1;
		}
		else if (type == 107)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 108)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 109)
		{
			width = 34;
			height = 78;
			aiStyle = 3;
			damage = 60;
			defense = 25;
			lifeMax = 800;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.2f;
			value = 10000f;
			rarity = 1;
		}
		else if (type == 110)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 45;
			defense = 14;
			lifeMax = 210;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.55f;
			value = 400f;
		}
		else if (type == 112)
		{
			width = 16;
			height = 16;
			aiStyle = 9;
			damage = 65;
			defense = 0;
			lifeMax = 1;
			HitSound = null;
			DeathSound = SoundID.NPCDeath9;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			scale = 0.9f;
			alpha = 80;
		}
		else if (type == 113)
		{
			npcSlots = 10f;
			width = 100;
			height = 100;
			aiStyle = 27;
			damage = 50;
			defense = 12;
			lifeMax = 8000;
			HitSound = SoundID.NPCHit8;
			DeathSound = SoundID.NPCDeath10;
			noGravity = true;
			noTileCollide = true;
			behindTiles = true;
			knockBackResist = 0f;
			scale = 1.2f;
			boss = true;
			value = 80000f;
		}
		else if (type == 114)
		{
			width = 100;
			height = 100;
			aiStyle = 28;
			damage = 50;
			defense = 0;
			lifeMax = 8000;
			HitSound = SoundID.NPCHit8;
			DeathSound = SoundID.NPCDeath10;
			noGravity = true;
			noTileCollide = true;
			behindTiles = true;
			knockBackResist = 0f;
			scale = 1.2f;
			value = 80000f;
		}
		else if (type == 115)
		{
			width = 30;
			height = 30;
			aiStyle = 29;
			damage = 30;
			defense = 10;
			lifeMax = 240;
			HitSound = SoundID.NPCHit9;
			DeathSound = SoundID.NPCDeath11;
			noGravity = true;
			behindTiles = true;
			noTileCollide = true;
			knockBackResist = 1.1f;
		}
		else if (type == 116)
		{
			width = 30;
			height = 32;
			aiStyle = 2;
			damage = 30;
			defense = 6;
			lifeMax = 80;
			HitSound = SoundID.NPCHit9;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath12;
		}
		else if (type == 117)
		{
			width = 14;
			height = 14;
			aiStyle = 6;
			netAlways = true;
			damage = 26;
			defense = 2;
			lifeMax = 60;
			HitSound = SoundID.NPCHit9;
			DeathSound = SoundID.NPCDeath12;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
		}
		else if (type == 118)
		{
			width = 14;
			height = 14;
			aiStyle = 6;
			netAlways = true;
			damage = 22;
			defense = 6;
			lifeMax = 60;
			HitSound = SoundID.NPCHit9;
			DeathSound = SoundID.NPCDeath12;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
		}
		else if (type == 119)
		{
			width = 14;
			height = 14;
			aiStyle = 6;
			netAlways = true;
			damage = 18;
			defense = 10;
			lifeMax = 60;
			HitSound = SoundID.NPCHit9;
			DeathSound = SoundID.NPCDeath12;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
		}
		else if (type == 120)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 40;
			defense = 30;
			lifeMax = 370;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.4f;
			value = 600f;
		}
		else if (type == 121)
		{
			width = 40;
			height = 30;
			aiStyle = 14;
			damage = 45;
			defense = 20;
			lifeMax = 60;
			HitSound = SoundID.NPCHit1;
			alpha = 55;
			knockBackResist = 0.8f;
			scale = 1.1f;
		}
		else if (type == 122)
		{
			noGravity = true;
			width = 20;
			height = 20;
			aiStyle = 22;
			damage = 60;
			defense = 22;
			lifeMax = 220;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath1;
			value = 600f;
		}
		else if (type == 123)
		{
			friendly = true;
			width = 18;
			height = 34;
			aiStyle = 0;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			scale = 0.9f;
			rarity = 1;
		}
		else if (type == 124)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 125)
		{
			width = 100;
			height = 110;
			aiStyle = 30;
			defense = 10;
			damage = 45;
			lifeMax = 20000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath14;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			boss = true;
			value = 120000f;
			npcSlots = 5f;
		}
		else if (type == 126)
		{
			width = 100;
			height = 110;
			aiStyle = 31;
			defense = 10;
			damage = 50;
			lifeMax = 23000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath14;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			boss = true;
			value = 120000f;
			npcSlots = 5f;
		}
		else if (type == 127)
		{
			width = 80;
			height = 102;
			aiStyle = 32;
			damage = 47;
			defense = 24;
			lifeMax = 28000;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			noGravity = true;
			noTileCollide = true;
			value = 120000f;
			knockBackResist = 0f;
			boss = true;
			npcSlots = 6f;
		}
		else if (type == 128)
		{
			width = 52;
			height = 52;
			aiStyle = 35;
			damage = 30;
			defense = 23;
			lifeMax = 7000;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			netAlways = true;
		}
		else if (type == 129)
		{
			width = 52;
			height = 52;
			aiStyle = 33;
			damage = 56;
			defense = 38;
			lifeMax = 9000;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			netAlways = true;
		}
		else if (type == 130)
		{
			width = 52;
			height = 52;
			aiStyle = 34;
			damage = 52;
			defense = 34;
			lifeMax = 9000;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			netAlways = true;
		}
		else if (type == 131)
		{
			width = 52;
			height = 52;
			aiStyle = 36;
			damage = 29;
			defense = 20;
			lifeMax = 6000;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			netAlways = true;
		}
		else if (type == 132)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 15;
			defense = 5;
			lifeMax = 40;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 65f;
		}
		else if (type == 133)
		{
			width = 30;
			height = 32;
			aiStyle = 2;
			damage = 40;
			defense = 20;
			lifeMax = 300;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath1;
			value = 500f;
		}
		else if (type == 134)
		{
			npcSlots = 5f;
			width = 38;
			height = 38;
			aiStyle = 37;
			defense = 0;
			damage = 70;
			lifeMax = 80000;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 120000f;
			scale = 1.25f;
			boss = true;
			netAlways = true;
			alpha = 255;
		}
		else if (type == 135)
		{
			npcSlots = 5f;
			width = 38;
			height = 38;
			aiStyle = 37;
			damage = 55;
			defense = 30;
			lifeMax = 80000;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			netAlways = true;
			scale = 1.25f;
			dontCountMe = true;
			alpha = 255;
		}
		else if (type == 136)
		{
			npcSlots = 5f;
			width = 38;
			height = 38;
			aiStyle = 37;
			damage = 40;
			defense = 35;
			lifeMax = 80000;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			scale = 1.25f;
			netAlways = true;
			dontCountMe = true;
			alpha = 255;
		}
		else if (type == 139)
		{
			npcSlots = 1f;
			width = 30;
			height = 30;
			aiStyle = 5;
			damage = 50;
			defense = 20;
			lifeMax = 200;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			noGravity = true;
			knockBackResist = 0.8f;
			noTileCollide = true;
		}
		else if (type == 137)
		{
			width = 26;
			height = 20;
			aiStyle = 14;
			damage = 75;
			defense = 30;
			lifeMax = 200;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.75f;
			DeathSound = SoundID.NPCDeath6;
			value = 500f;
		}
		else if (type == 138)
		{
			width = 24;
			height = 18;
			aiStyle = 1;
			damage = 70;
			defense = 30;
			lifeMax = 180;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			alpha = 100;
			value = 400f;
			knockBackResist = 0.85f;
			scale = 1.05f;
		}
		else if (type == 140)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 55;
			defense = 28;
			lifeMax = 260;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.4f;
			value = 400f;
		}
		else if (type == 141)
		{
			width = 34;
			height = 28;
			aiStyle = 1;
			damage = 50;
			defense = 18;
			lifeMax = 150;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			alpha = 55;
			value = 400f;
			scale = 1.1f;
			knockBackResist = 0.8f;
		}
		else if (type == 142)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 143)
		{
			width = 26;
			height = 40;
			aiStyle = 38;
			damage = 50;
			defense = 20;
			lifeMax = 200;
			HitSound = SoundID.NPCHit11;
			DeathSound = SoundID.NPCDeath15;
			knockBackResist = 0.6f;
			value = 400f;
			coldDamage = true;
		}
		else if (type == 144)
		{
			width = 26;
			height = 40;
			aiStyle = 38;
			damage = 65;
			defense = 26;
			lifeMax = 240;
			HitSound = SoundID.NPCHit11;
			DeathSound = SoundID.NPCDeath15;
			knockBackResist = 0.6f;
			value = 400f;
			coldDamage = true;
		}
		else if (type == 145)
		{
			width = 26;
			height = 40;
			aiStyle = 38;
			damage = 55;
			defense = 22;
			lifeMax = 220;
			HitSound = SoundID.NPCHit11;
			DeathSound = SoundID.NPCDeath15;
			knockBackResist = 0.6f;
			value = 400f;
			coldDamage = true;
		}
		else if (type == 147)
		{
			width = 24;
			height = 18;
			aiStyle = 1;
			damage = 8;
			defense = 4;
			lifeMax = 30;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			alpha = 50;
			value = 50f;
			coldDamage = true;
		}
		else if (type == 148)
		{
			width = 16;
			height = 34;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 2205;
		}
		else if (type == 149)
		{
			width = 16;
			height = 34;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 2205;
		}
		else if (type == 150)
		{
			npcSlots = 0.5f;
			width = 22;
			height = 22;
			aiStyle = 14;
			damage = 18;
			defense = 6;
			lifeMax = 30;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath4;
			value = 250f;
			coldDamage = true;
		}
		else if (type == 151)
		{
			npcSlots = 0.5f;
			width = 22;
			height = 22;
			aiStyle = 14;
			damage = 50;
			defense = 16;
			lifeMax = 160;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.6f;
			DeathSound = SoundID.NPCDeath4;
			value = 400f;
			scale = 1.15f;
			lavaImmune = true;
		}
		else if (type == 152)
		{
			npcSlots = 0.5f;
			width = 38;
			height = 34;
			aiStyle = 14;
			damage = 80;
			defense = 24;
			lifeMax = 220;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.65f;
			DeathSound = SoundID.NPCDeath4;
			value = 400f;
		}
		else if (type == 153)
		{
			npcSlots = 2f;
			width = 46;
			height = 32;
			aiStyle = 39;
			damage = 80;
			defense = 30;
			lifeMax = 470;
			HitSound = SoundID.NPCHit24;
			knockBackResist = 0.3f;
			DeathSound = SoundID.NPCDeath27;
			value = 500f;
			noGravity = false;
		}
		else if (type == 154)
		{
			npcSlots = 1.5f;
			width = 46;
			height = 32;
			aiStyle = 39;
			damage = 55;
			defense = 28;
			lifeMax = 400;
			HitSound = SoundID.NPCHit24;
			knockBackResist = 0.3f;
			DeathSound = SoundID.NPCDeath27;
			value = 450f;
			noGravity = false;
			coldDamage = true;
		}
		else if (type == 155)
		{
			width = 46;
			height = 30;
			aiStyle = 26;
			damage = 65;
			defense = 30;
			lifeMax = 300;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.3f;
			value = 1000f;
		}
		else if (type == 156)
		{
			npcSlots = 2f;
			width = 28;
			height = 48;
			aiStyle = 14;
			damage = 50;
			defense = 40;
			lifeMax = 600;
			HitSound = SoundID.NPCHit21;
			knockBackResist = 0.5f;
			DeathSound = SoundID.NPCDeath24;
			value = 1200f;
			lavaImmune = true;
		}
		else if (type == 157)
		{
			npcSlots = 0.5f;
			noGravity = true;
			width = 74;
			height = 20;
			aiStyle = 16;
			damage = 75;
			defense = 30;
			lifeMax = 200;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 500f;
		}
		else if (type == 160)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 161)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 16;
			defense = 8;
			lifeMax = 50;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.45f;
			value = 80f;
		}
		else if (type == 163)
		{
			width = 50;
			height = 20;
			aiStyle = 3;
			damage = 90;
			defense = 40;
			lifeMax = 350;
			HitSound = SoundID.NPCHit29;
			DeathSound = SoundID.NPCDeath32;
			knockBackResist = 0.25f;
			value = 500f;
			npcSlots = 0.5f;
		}
		else if (type == 238)
		{
			noGravity = true;
			width = 36;
			height = 36;
			aiStyle = 40;
			damage = 100;
			defense = 40;
			lifeMax = 350;
			HitSound = SoundID.NPCHit29;
			DeathSound = SoundID.NPCDeath32;
			knockBackResist = 0.25f;
			value = 500f;
			npcSlots = 0.5f;
		}
		else if (type == 164)
		{
			width = 50;
			height = 20;
			aiStyle = 3;
			damage = 30;
			defense = 10;
			lifeMax = 80;
			HitSound = SoundID.NPCHit29;
			DeathSound = SoundID.NPCDeath32;
			knockBackResist = 0.25f;
			value = 100f;
			npcSlots = 0.5f;
		}
		else if (type == 165)
		{
			noGravity = true;
			width = 36;
			height = 36;
			aiStyle = 40;
			damage = 30;
			defense = 10;
			lifeMax = 80;
			HitSound = SoundID.NPCHit29;
			DeathSound = SoundID.NPCDeath32;
			knockBackResist = 0.25f;
			value = 100f;
			npcSlots = 0.5f;
		}
		else if (type == 167)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 24;
			defense = 10;
			lifeMax = 70;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 200f;
		}
		else if (type == 168)
		{
			width = 16;
			height = 34;
			aiStyle = 3;
			damage = 20;
			defense = 4;
			lifeMax = 70;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 500f;
		}
		else if (type == 169)
		{
			noGravity = true;
			width = 18;
			height = 40;
			aiStyle = 22;
			damage = 55;
			defense = 20;
			lifeMax = 200;
			HitSound = SoundID.NPCHit5;
			knockBackResist = 0.6f;
			DeathSound = SoundID.NPCDeath7;
			value = 1500f;
			coldDamage = true;
		}
		else if (type == 170)
		{
			width = 44;
			height = 36;
			aiStyle = 2;
			damage = 70;
			defense = 16;
			lifeMax = 210;
			HitSound = SoundID.NPCHit27;
			DeathSound = SoundID.NPCDeath30;
			knockBackResist = 0.5f;
			value = 2000f;
		}
		else if (type == 171)
		{
			width = 44;
			height = 36;
			aiStyle = 2;
			damage = 70;
			defense = 16;
			lifeMax = 210;
			HitSound = SoundID.NPCHit27;
			DeathSound = SoundID.NPCDeath30;
			knockBackResist = 0.5f;
			value = 2000f;
		}
		else if (type == 172)
		{
			width = 18;
			height = 40;
			aiStyle = 8;
			damage = 200;
			defense = 30;
			lifeMax = 600;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.3f;
			value = 5000f;
			rarity = 4;
		}
		else if (type == 173)
		{
			npcSlots = 1f;
			width = 30;
			height = 30;
			aiStyle = 5;
			damage = 22;
			defense = 8;
			lifeMax = 40;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			knockBackResist = 0.5f;
			value = 90f;
			if (Main.remixWorld)
			{
				if (!IsABestiaryIconDummy)
				{
					scale *= 1.3f;
				}
				damage = (int)((float)damage * scale);
				defense = (int)((float)defense * scale);
				lifeMax = (int)((float)lifeMax * scale);
				value = (int)(value * scale);
			}
		}
		else if (type == 174)
		{
			npcSlots = 1f;
			width = 52;
			height = 26;
			aiStyle = 41;
			damage = 65;
			defense = 26;
			lifeMax = 220;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.3f;
			value = 450f;
		}
		else if (type == 175)
		{
			noGravity = true;
			noTileCollide = true;
			width = 30;
			height = 30;
			aiStyle = 13;
			damage = 100;
			defense = 30;
			lifeMax = 300;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.25f;
			DeathSound = SoundID.NPCDeath1;
			value = 650f;
		}
		else if (type == 176)
		{
			width = 34;
			height = 32;
			aiStyle = 5;
			damage = 70;
			defense = 22;
			lifeMax = 220;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.5f;
			DeathSound = SoundID.NPCDeath1;
			value = 600f;
			noGravity = true;
			npcSlots = 1.5f;
		}
		else if (type == 177)
		{
			npcSlots = 1f;
			width = 58;
			height = 44;
			aiStyle = 41;
			damage = 80;
			defense = 26;
			lifeMax = 300;
			HitSound = SoundID.NPCHit22;
			DeathSound = SoundID.NPCDeath25;
			knockBackResist = 0.5f;
			value = 500f;
		}
		else if (type == 178)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 179)
		{
			width = 40;
			height = 40;
			aiStyle = 23;
			damage = 80;
			defense = 18;
			lifeMax = 200;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath6;
			value = 1000f;
			knockBackResist = 0.4f;
		}
		else if (type == 180)
		{
			width = 44;
			height = 36;
			aiStyle = 2;
			damage = 70;
			defense = 16;
			lifeMax = 210;
			HitSound = SoundID.NPCHit27;
			DeathSound = SoundID.NPCDeath30;
			knockBackResist = 0.5f;
			value = 2000f;
		}
		else if (type == 181)
		{
			width = 18;
			height = 44;
			aiStyle = 3;
			damage = 25;
			defense = 10;
			lifeMax = 70;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.4f;
			value = 200f;
			if (Main.remixWorld)
			{
				if (!IsABestiaryIconDummy)
				{
					scale *= 1.1f;
				}
				damage = (int)((double)((float)damage * scale) * 1.2);
				defense = (int)((double)((float)defense * scale) * 1.2);
				lifeMax = (int)((double)((float)lifeMax * scale) * 1.2);
				value = (int)((double)(value * scale) * 1.2);
			}
		}
		else if (type == 182)
		{
			noGravity = true;
			noTileCollide = true;
			width = 24;
			height = 62;
			aiStyle = 22;
			damage = 65;
			defense = 18;
			lifeMax = 240;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			alpha = 100;
			value = 500f;
			knockBackResist = 0.7f;
		}
		else if (type == 183)
		{
			width = 40;
			height = 30;
			aiStyle = 1;
			damage = 60;
			defense = 26;
			lifeMax = 200;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			alpha = 55;
			value = 400f;
			scale = 1.1f;
		}
		else if (type == 184)
		{
			width = 24;
			height = 18;
			aiStyle = 1;
			damage = 12;
			defense = 8;
			lifeMax = 60;
			scale = 1.1f;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			alpha = 50;
			value = 200f;
			coldDamage = true;
		}
		else if (type == 185)
		{
			width = 28;
			height = 28;
			aiStyle = 3;
			damage = 26;
			defense = 12;
			lifeMax = 70;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 1.1f;
			value = 200f;
			coldDamage = true;
		}
		else if (type == 186)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 16;
			defense = 8;
			lifeMax = 50;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.45f;
			value = 65f;
		}
		else if (type == 187)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 13;
			defense = 6;
			lifeMax = 40;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.55f;
			value = 55f;
		}
		else if (type == 188)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 13;
			defense = 8;
			lifeMax = 45;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.45f;
			value = 80f;
		}
		else if (type == 189)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 16;
			defense = 4;
			lifeMax = 45;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.55f;
			value = 70f;
		}
		else if (type == 190)
		{
			width = 30;
			height = 32;
			aiStyle = 2;
			damage = 18;
			defense = 4;
			lifeMax = 65;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.7f;
			DeathSound = SoundID.NPCDeath1;
			value = 75f;
		}
		else if (type == 191)
		{
			width = 30;
			height = 32;
			aiStyle = 2;
			damage = 16;
			defense = 2;
			lifeMax = 60;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.85f;
			DeathSound = SoundID.NPCDeath1;
			value = 75f;
		}
		else if (type == 192)
		{
			width = 30;
			height = 32;
			aiStyle = 2;
			damage = 18;
			defense = 2;
			lifeMax = 50;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath1;
			value = 75f;
		}
		else if (type == 193)
		{
			width = 30;
			height = 32;
			aiStyle = 2;
			damage = 20;
			defense = 0;
			lifeMax = 60;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath1;
			value = 75f;
		}
		else if (type == 194)
		{
			width = 30;
			height = 32;
			aiStyle = 2;
			damage = 14;
			defense = 4;
			lifeMax = 60;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath1;
			value = 75f;
		}
		else if (type == 195)
		{
			width = 18;
			height = 40;
			aiStyle = 42;
			damage = 10;
			defense = 30;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			rarity = 2;
			value = Item.buyPrice(0, 2);
		}
		else if (type == 196)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 35;
			defense = 16;
			lifeMax = 300;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.4f;
			value = Item.buyPrice(0, 2);
			rarity = 2;
		}
		else if (type == 197)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 50;
			defense = 28;
			lifeMax = 280;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.45f;
			value = 500f;
		}
		else if (type == 198)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 38;
			defense = 20;
			lifeMax = 400;
			HitSound = SoundID.NPCHit26;
			DeathSound = SoundID.NPCDeath29;
			knockBackResist = 0.4f;
			value = 650f;
		}
		else if (type == 199)
		{
			width = 42;
			height = 30;
			aiStyle = 3;
			damage = 60;
			defense = 30;
			lifeMax = 400;
			HitSound = SoundID.NPCHit26;
			DeathSound = SoundID.NPCDeath29;
			knockBackResist = 0f;
			value = 650f;
		}
		else if (type == 200)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 12;
			defense = 4;
			lifeMax = 38;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.6f;
			value = 65f;
		}
		else if (type == 201)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 20;
			defense = 12;
			lifeMax = 55;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 130f;
		}
		else if (type == 202)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 18;
			defense = 8;
			lifeMax = 65;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 120f;
		}
		else if (type == 203)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 22;
			defense = 8;
			lifeMax = 60;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 110f;
		}
		else if (type == 204)
		{
			width = 24;
			height = 18;
			aiStyle = 1;
			damage = 28;
			defense = 8;
			lifeMax = 65;
			scale = 1.15f;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			alpha = 50;
			value = 300f;
		}
		else if (type == 205)
		{
			width = 40;
			height = 40;
			aiStyle = 5;
			damage = 70;
			defense = 28;
			lifeMax = 1000;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.4f;
			DeathSound = SoundID.NPCDeath1;
			value = 600f;
			noGravity = true;
			rarity = 2;
		}
		else if (type == 206)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 60;
			defense = 30;
			lifeMax = 280;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			value = 500f;
			coldDamage = true;
		}
		else if (type == 207)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 208)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 209)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			HitSound = SoundID.NPCHit4;
			lifeMax = 500;
			defense = 30;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.25f;
		}
		else if (type == 210)
		{
			width = 12;
			height = 12;
			aiStyle = 5;
			damage = 20;
			defense = 5;
			lifeMax = 20;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.5f;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
		}
		else if (type == 211)
		{
			width = 8;
			height = 8;
			aiStyle = 5;
			damage = 15;
			defense = 2;
			lifeMax = 10;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.5f;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
		}
		else if (type == 212)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 35;
			defense = 17;
			lifeMax = 300;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.4f;
			value = 700f;
		}
		else if (type == 213)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 50;
			defense = 22;
			lifeMax = 450;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.2f;
			value = 1000f;
		}
		else if (type == 214)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 30;
			defense = 14;
			lifeMax = 225;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.3f;
			value = 1000f;
		}
		else if (type == 215)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 35;
			defense = 20;
			lifeMax = 350;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.35f;
			value = 1500f;
		}
		else if (type == 216)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 70;
			defense = 30;
			lifeMax = 3000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0f;
			value = 50000f;
			rarity = 1;
		}
		else if (type == 217)
		{
			width = 28;
			height = 20;
			aiStyle = 3;
			damage = 20;
			defense = 10;
			lifeMax = 40;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath16;
			value = 60f;
			rarity = 1;
		}
		else if (type == 218)
		{
			width = 28;
			height = 20;
			aiStyle = 3;
			damage = 20;
			defense = 10;
			lifeMax = 40;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath16;
			value = 60f;
			rarity = 1;
		}
		else if (type == 219)
		{
			width = 28;
			height = 20;
			aiStyle = 3;
			damage = 20;
			defense = 10;
			lifeMax = 40;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath16;
			value = 60f;
			rarity = 1;
		}
		else if (type == 220)
		{
			width = 28;
			height = 20;
			aiStyle = 3;
			damage = 20;
			defense = 10;
			lifeMax = 40;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 60f;
			rarity = 2;
		}
		else if (type == 221)
		{
			noGravity = true;
			width = 26;
			height = 26;
			aiStyle = 18;
			damage = 20;
			defense = 2;
			lifeMax = 30;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 100f;
			alpha = 20;
			rarity = 1;
		}
		else if (type == 222)
		{
			width = 66;
			height = 66;
			aiStyle = 43;
			damage = 30;
			defense = 8;
			lifeMax = 3400;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath66;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			boss = true;
			value = 50000f;
			npcSlots = 7f;
		}
		else if (type == 223)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 16;
			defense = 8;
			lifeMax = 50;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.45f;
			value = 70f;
		}
		else if (type == 224)
		{
			width = 32;
			height = 18;
			aiStyle = 44;
			damage = 9;
			defense = 4;
			lifeMax = 20;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath1;
			value = 300f;
		}
		if (type == 225)
		{
			width = 38;
			height = 26;
			aiStyle = 1;
			damage = 10;
			defense = 5;
			lifeMax = 35;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.75f;
			value = 200f;
		}
		else if (type == 226)
		{
			npcSlots = 0.5f;
			width = 34;
			height = 50;
			aiStyle = 14;
			damage = 85;
			defense = 28;
			lifeMax = 260;
			HitSound = SoundID.NPCHit23;
			knockBackResist = 0.65f;
			DeathSound = SoundID.NPCDeath26;
			value = 400f;
		}
		else if (type == 227)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 228)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 229)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 230)
		{
			width = 18;
			height = 20;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 261;
		}
		else if (type == 231)
		{
			width = 34;
			height = 32;
			aiStyle = 5;
			damage = 22;
			defense = 16;
			lifeMax = 50;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.3f;
			DeathSound = SoundID.NPCDeath1;
			value = 200f;
			noGravity = true;
		}
		else if (type == 232)
		{
			width = 34;
			height = 32;
			aiStyle = 5;
			damage = 28;
			defense = 12;
			lifeMax = 42;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.6f;
			DeathSound = SoundID.NPCDeath1;
			value = 200f;
			noGravity = true;
		}
		else if (type == 233)
		{
			width = 34;
			height = 32;
			aiStyle = 5;
			damage = 30;
			defense = 14;
			lifeMax = 38;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.45f;
			DeathSound = SoundID.NPCDeath1;
			value = 200f;
			noGravity = true;
		}
		else if (type == 234)
		{
			width = 34;
			height = 32;
			aiStyle = 5;
			damage = 32;
			defense = 6;
			lifeMax = 42;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.55f;
			DeathSound = SoundID.NPCDeath1;
			value = 200f;
			noGravity = true;
		}
		else if (type == 235)
		{
			width = 34;
			height = 32;
			aiStyle = 5;
			damage = 34;
			defense = 4;
			lifeMax = 38;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.6f;
			DeathSound = SoundID.NPCDeath1;
			value = 200f;
			noGravity = true;
		}
		else if (type == 236)
		{
			width = 50;
			height = 20;
			aiStyle = 3;
			damage = 100;
			defense = 28;
			lifeMax = 400;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.25f;
			value = 1000f;
			npcSlots = 0.75f;
		}
		else if (type == 237)
		{
			noGravity = true;
			width = 36;
			height = 36;
			aiStyle = 40;
			damage = 100;
			defense = 28;
			lifeMax = 400;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.25f;
			value = 1000f;
			npcSlots = 0.75f;
		}
		else if (type == 239)
		{
			width = 50;
			height = 20;
			aiStyle = 3;
			damage = 30;
			defense = 8;
			lifeMax = 60;
			HitSound = SoundID.NPCHit20;
			DeathSound = SoundID.NPCDeath23;
			knockBackResist = 0.5f;
			value = 130f;
		}
		else if (type == 240)
		{
			noGravity = true;
			width = 36;
			height = 36;
			aiStyle = 40;
			damage = 30;
			defense = 8;
			lifeMax = 60;
			HitSound = SoundID.NPCHit20;
			DeathSound = SoundID.NPCDeath23;
			knockBackResist = 0.5f;
			value = 130f;
		}
		else if (type == 241)
		{
			npcSlots = 0.5f;
			noGravity = true;
			width = 18;
			height = 20;
			aiStyle = 16;
			damage = 50;
			defense = 20;
			lifeMax = 150;
			HitSound = SoundID.NPCHit13;
			DeathSound = SoundID.NPCDeath19;
			value = 500f;
		}
		else if (type == 242)
		{
			noGravity = true;
			width = 26;
			height = 26;
			aiStyle = 18;
			damage = 75;
			defense = 20;
			lifeMax = 150;
			HitSound = SoundID.NPCHit13;
			DeathSound = SoundID.NPCDeath19;
			value = 800f;
			alpha = 20;
		}
		else if (type == 243)
		{
			width = 30;
			height = 114;
			aiStyle = 3;
			damage = 60;
			defense = 32;
			lifeMax = 4000;
			HitSound = SoundID.NPCHit5;
			DeathSound = SoundID.NPCDeath7;
			knockBackResist = 0.05f;
			value = Item.buyPrice(0, 1, 50);
			coldDamage = true;
			rarity = 2;
		}
		else if (type == 244)
		{
			width = 60;
			height = 42;
			aiStyle = 1;
			damage = 85;
			defense = 26;
			lifeMax = 400;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			alpha = 175;
			value = Item.buyPrice(0, 0, 20);
			knockBackResist = 0.3f;
			rarity = 1;
		}
		else if (type == 245)
		{
			width = 140;
			height = 140;
			aiStyle = 45;
			damage = 72;
			defense = 26;
			lifeMax = 15000;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			knockBackResist = 0f;
			value = Item.buyPrice(0, 15);
			alpha = 255;
			boss = true;
			npcSlots = 5f;
		}
		else if (type == 246)
		{
			noGravity = true;
			width = 70;
			height = 70;
			aiStyle = 46;
			damage = 64;
			defense = 20;
			lifeMax = 25000;
			HitSound = SoundID.NPCHit4;
			DeathSound = null;
			knockBackResist = 0f;
			alpha = 255;
		}
		else if (type == 247 || type == 248)
		{
			noGravity = true;
			width = 40;
			height = 30;
			aiStyle = 47;
			damage = 59;
			defense = 28;
			lifeMax = 10000;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			alpha = 255;
			knockBackResist = 0f;
		}
		else if (type == 249)
		{
			noGravity = true;
			width = 70;
			height = 70;
			aiStyle = 48;
			damage = 80;
			defense = 32;
			lifeMax = 16000;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			knockBackResist = 0f;
			dontTakeDamage = true;
		}
		else if (type == 250)
		{
			width = 34;
			height = 26;
			aiStyle = 49;
			damage = 50;
			defense = 24;
			lifeMax = 300;
			HitSound = SoundID.NPCHit30;
			DeathSound = SoundID.NPCDeath33;
			knockBackResist = 0.3f;
			value = 300f;
		}
		else if (type == 251)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 50;
			defense = 30;
			lifeMax = 1000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.3f;
			value = Item.buyPrice(0, 0, 50);
			rarity = 2;
		}
		else if (type == 252)
		{
			noGravity = true;
			npcSlots = 0.5f;
			width = 32;
			height = 32;
			aiStyle = 5;
			damage = 80;
			defense = 12;
			lifeMax = 100;
			HitSound = SoundID.NPCHit46;
			knockBackResist = 0.7f;
			DeathSound = SoundID.NPCDeath48;
			value = 500f;
		}
		else if (type == 254)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 40;
			defense = 10;
			lifeMax = 180;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.4f;
			value = 1000f;
		}
		else if (type == 255)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 38;
			defense = 16;
			lifeMax = 220;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.3f;
			value = 1200f;
		}
		else if (type == 256)
		{
			noGravity = true;
			width = 26;
			height = 26;
			aiStyle = 18;
			damage = 90;
			defense = 20;
			lifeMax = 140;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			value = 1200f;
			alpha = 20;
			npcSlots = 0.3f;
		}
		else if (type == 257)
		{
			width = 44;
			height = 34;
			aiStyle = 3;
			damage = 38;
			defense = 24;
			lifeMax = 230;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.3f;
			value = 1300f;
			npcSlots = 0.3f;
		}
		else if (type == 258)
		{
			width = 30;
			height = 24;
			aiStyle = 3;
			damage = 60;
			defense = 16;
			lifeMax = 220;
			HitSound = SoundID.NPCHit45;
			DeathSound = SoundID.NPCDeath47;
			knockBackResist = 0.3f;
			value = 1500f;
			npcSlots = 0.3f;
		}
		else if (type == 259)
		{
			noGravity = true;
			noTileCollide = true;
			width = 20;
			height = 20;
			aiStyle = 13;
			damage = 24;
			defense = 4;
			lifeMax = 90;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0f;
			DeathSound = SoundID.NPCDeath1;
			value = 350f;
			npcSlots = 0.3f;
		}
		else if (type == 260)
		{
			noGravity = true;
			noTileCollide = true;
			width = 36;
			height = 36;
			aiStyle = 13;
			damage = 70;
			defense = 20;
			lifeMax = 300;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0f;
			DeathSound = SoundID.NPCDeath1;
			value = 1250f;
			npcSlots = 0.3f;
		}
		else if (type == 261)
		{
			width = 12;
			height = 12;
			aiStyle = 50;
			damage = 80;
			defense = 0;
			lifeMax = 1;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			npcSlots = 0f;
		}
		else if (type == 262)
		{
			noTileCollide = true;
			width = 86;
			height = 86;
			aiStyle = 51;
			damage = 50;
			defense = 14;
			lifeMax = 30000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0f;
			value = Item.buyPrice(0, 15);
			noGravity = true;
			boss = true;
			npcSlots = 16f;
		}
		else if (type == 263)
		{
			noTileCollide = true;
			noGravity = true;
			width = 40;
			height = 40;
			aiStyle = 52;
			damage = 60;
			defense = 24;
			lifeMax = 4000;
			dontTakeDamage = true;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
		}
		else if (type == 264)
		{
			width = 24;
			height = 24;
			aiStyle = 53;
			damage = 60;
			defense = 20;
			lifeMax = 1000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
		}
		else if (type == 265)
		{
			width = 18;
			height = 18;
			aiStyle = 50;
			damage = 70;
			defense = 0;
			lifeMax = 1;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			npcSlots = 0f;
		}
		else if (type == 266)
		{
			dontTakeDamage = true;
			width = 160;
			height = 110;
			aiStyle = 54;
			damage = 30;
			defense = 14;
			lifeMax = 1250;
			HitSound = SoundID.NPCHit9;
			DeathSound = SoundID.NPCDeath11;
			knockBackResist = 0.45f;
			noGravity = true;
			noTileCollide = true;
			boss = true;
			value = 50000f;
			npcSlots = 6f;
		}
		else if (type == 267)
		{
			width = 30;
			height = 30;
			aiStyle = 55;
			damage = 20;
			defense = 10;
			lifeMax = 100;
			HitSound = SoundID.NPCHit9;
			DeathSound = SoundID.NPCDeath11;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0.8f;
		}
		else if (type == 268)
		{
			noGravity = true;
			width = 28;
			height = 56;
			aiStyle = 22;
			damage = 55;
			defense = 20;
			lifeMax = 340;
			HitSound = SoundID.NPCHit13;
			DeathSound = SoundID.NPCDeath19;
			knockBackResist = 0.6f;
			value = 450f;
		}
		else if (type == 269)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 70;
			defense = 34;
			lifeMax = 550;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.3f;
			value = 1000f;
		}
		else if (type == 270)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 55;
			defense = 50;
			lifeMax = 400;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.2f;
			value = 1000f;
		}
		else if (type == 271)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 70;
			defense = 40;
			lifeMax = 450;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.25f;
			value = 1000f;
		}
		else if (type == 272)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 75;
			defense = 28;
			lifeMax = 400;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.35f;
			value = 1000f;
		}
		else if (type == 273)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 45;
			defense = 50;
			lifeMax = 500;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.15f;
			value = 1000f;
		}
		else if (type == 274)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 65;
			defense = 34;
			lifeMax = 350;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.4f;
			value = 1000f;
		}
		else if (type == 275)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 45;
			defense = 50;
			lifeMax = 550;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.15f;
			value = 1000f;
		}
		else if (type == 276)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 85;
			defense = 54;
			lifeMax = 500;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.2f;
			value = 1000f;
		}
		else if (type == 277)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 70;
			defense = 32;
			lifeMax = 400;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.4f;
			value = 1000f;
		}
		else if (type == 278)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 65;
			defense = 48;
			lifeMax = 450;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.3f;
			value = 1000f;
		}
		else if (type == 279)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 40;
			defense = 54;
			lifeMax = 500;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.2f;
			value = 1000f;
		}
		else if (type == 280)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 75;
			defense = 34;
			lifeMax = 500;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.4f;
			value = 1000f;
		}
		else if (type == 281)
		{
			width = 18;
			height = 40;
			aiStyle = 8;
			damage = 40;
			defense = 20;
			lifeMax = 400;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.6f;
			value = 1500f;
			npcSlots = 2f;
		}
		else if (type == 282)
		{
			width = 18;
			height = 40;
			aiStyle = 8;
			damage = 35;
			defense = 28;
			lifeMax = 450;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 1500f;
			npcSlots = 2f;
		}
		else if (type == 283)
		{
			width = 18;
			height = 40;
			aiStyle = 8;
			damage = 50;
			defense = 18;
			lifeMax = 300;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.55f;
			value = 1500f;
			npcSlots = 2f;
		}
		else if (type == 284)
		{
			width = 18;
			height = 40;
			aiStyle = 8;
			damage = 35;
			defense = 24;
			lifeMax = 450;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 1500f;
			npcSlots = 2f;
		}
		else if (type == 285)
		{
			width = 18;
			height = 40;
			aiStyle = 8;
			damage = 50;
			defense = 12;
			lifeMax = 200;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.7f;
			value = 1500f;
			npcSlots = 2f;
		}
		else if (type == 286)
		{
			width = 18;
			height = 40;
			aiStyle = 8;
			damage = 60;
			defense = 10;
			lifeMax = 250;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.65f;
			value = 1500f;
			npcSlots = 2f;
		}
		else if (type == 287)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 90;
			defense = 42;
			lifeMax = 1000;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.3f;
			value = 2000f;
			rarity = 1;
		}
		else if (type == 288)
		{
			width = 20;
			height = 20;
			aiStyle = 56;
			damage = 70;
			defense = 30;
			lifeMax = 200;
			knockBackResist = 0.2f;
			HitSound = SoundID.NPCHit36;
			DeathSound = SoundID.NPCDeath39;
			value = 500f;
			noTileCollide = true;
			noGravity = true;
		}
		else if (type == 289)
		{
			width = 44;
			height = 44;
			aiStyle = 10;
			damage = 60;
			defense = 20;
			lifeMax = 400;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			noGravity = true;
			noTileCollide = true;
			value = 150f;
			knockBackResist = 0.2f;
			npcSlots = 0.75f;
		}
		else if (type == 290)
		{
			width = 34;
			height = 62;
			aiStyle = 3;
			damage = 100;
			defense = 50;
			lifeMax = 5000;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0f;
			value = 50000f;
			rarity = 2;
		}
		else if (type == 291)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 60;
			defense = 28;
			lifeMax = 400;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.4f;
			value = 1000f;
			rarity = 1;
		}
		else if (type == 292)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 60;
			defense = 28;
			lifeMax = 400;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.4f;
			value = 1000f;
			rarity = 1;
		}
		else if (type == 293)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 60;
			defense = 28;
			lifeMax = 400;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.4f;
			value = 1000f;
			rarity = 1;
		}
		else if (type == 294)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 34;
			defense = 6;
			lifeMax = 70;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.9f;
			value = 130f;
		}
		else if (type == 295)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 28;
			defense = 12;
			lifeMax = 70;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.7f;
			value = 130f;
		}
		else if (type == 296)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 24;
			defense = 14;
			lifeMax = 120;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.6f;
			value = 130f;
		}
		else if (type == 299)
		{
			width = 18;
			height = 20;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 2018;
		}
		else if (type == 300)
		{
			width = 14;
			height = 12;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath4;
			npcSlots = 0.25f;
			catchItem = 2003;
		}
		else if (type == 301)
		{
			width = 36;
			height = 26;
			aiStyle = 17;
			damage = 12;
			defense = 2;
			lifeMax = 35;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.85f;
			DeathSound = SoundID.NPCDeath1;
			value = 50f;
		}
		if (type == 302)
		{
			width = 24;
			height = 18;
			aiStyle = 1;
			damage = 7;
			defense = 2;
			lifeMax = 25;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 25f;
		}
		else if (type == 304)
		{
			width = 34;
			height = 28;
			aiStyle = 1;
			damage = 80;
			defense = 20;
			lifeMax = 175;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 500f;
			scale = 1.1f;
			knockBackResist = 0.5f;
			npcSlots = 0.3f;
		}
		else if (type >= 305 && type <= 314)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			value = 1200f;
			npcSlots = 0.5f;
			if (type == 305 || type == 310)
			{
				damage = 60;
				defense = 18;
				lifeMax = 500;
				knockBackResist = 0.4f;
			}
			else if (type == 306 || type == 311)
			{
				damage = 52;
				defense = 14;
				lifeMax = 400;
				knockBackResist = 0.2f;
				scale = 1.05f;
			}
			else if (type == 307 || type == 312)
			{
				damage = 78;
				defense = 16;
				lifeMax = 600;
				knockBackResist = 0.25f;
				scale = 0.9f;
			}
			else if (type == 308 || type == 313)
			{
				damage = 66;
				defense = 14;
				lifeMax = 650;
				knockBackResist = 0.35f;
				scale = 0.95f;
			}
			else if (type == 309 || type == 314)
			{
				damage = 52;
				defense = 26;
				lifeMax = 450;
				knockBackResist = 0.5f;
				scale = 1.1f;
			}
		}
		else if (type == 315)
		{
			width = 74;
			height = 70;
			aiStyle = 26;
			damage = 130;
			defense = 40;
			lifeMax = 5000;
			HitSound = SoundID.NPCHit12;
			DeathSound = SoundID.NPCDeath18;
			knockBackResist = 0f;
			value = 10000f;
		}
		else if (type == 316)
		{
			noGravity = true;
			noTileCollide = true;
			width = 24;
			height = 44;
			aiStyle = 22;
			damage = 15;
			defense = 4;
			lifeMax = 50;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			alpha = 100;
			value = 90f;
			knockBackResist = 0.5f;
		}
		else if (type == 317)
		{
			width = 30;
			height = 32;
			aiStyle = 2;
			damage = 16;
			defense = 6;
			lifeMax = 75;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.7f;
			DeathSound = SoundID.NPCDeath1;
			value = 100f;
		}
		else if (type == 318)
		{
			width = 30;
			height = 32;
			aiStyle = 2;
			damage = 20;
			defense = 4;
			lifeMax = 60;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.65f;
			DeathSound = SoundID.NPCDeath1;
			value = 100f;
		}
		else if (type == 319)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 20;
			defense = 6;
			lifeMax = 40;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.6f;
			value = 85f;
			scale = 0.9f;
		}
		else if (type == 320)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 15;
			defense = 8;
			lifeMax = 60;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 105f;
			scale = 1.05f;
		}
		else if (type == 321)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 20;
			defense = 14;
			lifeMax = 34;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.3f;
			value = 120f;
			scale = 1.1f;
		}
		else if (type == 322)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 23;
			defense = 0;
			lifeMax = 115;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.65f;
			value = 130f;
		}
		else if (type == 323)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 18;
			defense = 10;
			lifeMax = 65;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 120f;
		}
		else if (type == 324)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 22;
			defense = 10;
			lifeMax = 70;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.4f;
			value = 130f;
			scale = 1.05f;
		}
		else if (type == 325)
		{
			width = 164;
			height = 154;
			aiStyle = 57;
			damage = 120;
			defense = 34;
			lifeMax = 14000;
			HitSound = SoundID.NPCHit7;
			DeathSound = SoundID.NPCDeath5;
			knockBackResist = 0f;
			value = 10000f;
			npcSlots = 3f;
		}
		else if (type == 326)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 100;
			defense = 32;
			lifeMax = 1200;
			HitSound = SoundID.NPCHit7;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.2f;
			value = 2000f;
		}
		else if (type == 327)
		{
			width = 100;
			height = 100;
			aiStyle = 58;
			damage = 50;
			defense = 40;
			lifeMax = 26000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			value = 50000f;
			knockBackResist = 0f;
			npcSlots = 5f;
		}
		else if (type == 328)
		{
			width = 80;
			height = 80;
			aiStyle = 59;
			damage = 65;
			defense = 14;
			lifeMax = 5000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			dontTakeDamage = true;
			npcSlots = 0f;
			dontCountMe = true;
		}
		else if (type == 329)
		{
			width = 46;
			height = 30;
			aiStyle = 26;
			damage = 80;
			defense = 38;
			lifeMax = 1800;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath5;
			knockBackResist = 0.3f;
			value = 3000f;
		}
		else if (type == 330)
		{
			noGravity = true;
			noTileCollide = true;
			width = 24;
			height = 44;
			aiStyle = 22;
			damage = 90;
			defense = 44;
			lifeMax = 1250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			alpha = 100;
			value = 4500f;
			knockBackResist = 0.4f;
		}
		else if (type == 331)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 14;
			defense = 6;
			lifeMax = 45;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 60f;
		}
		else if (type == 332)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 14;
			defense = 6;
			lifeMax = 45;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 60f;
		}
		if (type == 333)
		{
			width = 24;
			height = 18;
			aiStyle = 1;
			damage = 7;
			defense = 2;
			lifeMax = 25;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 25f;
		}
		if (type == 334)
		{
			width = 24;
			height = 18;
			aiStyle = 1;
			damage = 6;
			defense = 2;
			lifeMax = 23;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			scale = 0.9f;
			value = 25f;
		}
		if (type == 335)
		{
			width = 24;
			height = 18;
			aiStyle = 1;
			damage = 8;
			defense = 3;
			lifeMax = 29;
			scale = 1.05f;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 25f;
		}
		if (type == 336)
		{
			width = 24;
			height = 18;
			aiStyle = 1;
			damage = 5;
			defense = 1;
			lifeMax = 22;
			scale = 0.85f;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 25f;
		}
		else if (type >= 338 && type <= 340)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 1200f;
			npcSlots = 0.5f;
			if (type == 338)
			{
				damage = 65;
				defense = 18;
				lifeMax = 600;
				knockBackResist = 0.4f;
			}
			else if (type == 339)
			{
				damage = 52;
				defense = 24;
				lifeMax = 700;
				knockBackResist = 0.2f;
				scale = 1.05f;
			}
			else if (type == 340)
			{
				damage = 78;
				defense = 14;
				lifeMax = 500;
				knockBackResist = 0.25f;
				scale = 0.9f;
			}
		}
		else if (type == 341)
		{
			width = 24;
			height = 24;
			aiStyle = 25;
			damage = 100;
			defense = 32;
			lifeMax = 900;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath6;
			value = Item.buyPrice(0, 0, 20);
			knockBackResist = 0.25f;
		}
		else if (type == 342)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 90;
			defense = 26;
			lifeMax = 750;
			HitSound = SoundID.NPCHit7;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.2f;
			value = 1800f;
		}
		else if (type == 343)
		{
			width = 38;
			height = 78;
			aiStyle = 3;
			damage = 140;
			defense = 50;
			lifeMax = 3500;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0f;
			value = 3000f;
			npcSlots = 2f;
			coldDamage = true;
		}
		else if (type == 344)
		{
			width = 172;
			height = 130;
			aiStyle = 57;
			damage = 110;
			defense = 38;
			lifeMax = 13000;
			HitSound = SoundID.NPCHit7;
			DeathSound = SoundID.NPCDeath5;
			knockBackResist = 0f;
			value = 10000f;
			npcSlots = 3f;
		}
		else if (type == 345)
		{
			width = 130;
			height = 140;
			aiStyle = 60;
			damage = 120;
			defense = 38;
			lifeMax = 34000;
			HitSound = SoundID.NPCHit7;
			DeathSound = SoundID.NPCDeath5;
			knockBackResist = 0f;
			value = 50000f;
			noTileCollide = true;
			noGravity = true;
			npcSlots = 5f;
			coldDamage = true;
		}
		else if (type == 346)
		{
			width = 112;
			height = 140;
			aiStyle = 61;
			damage = 120;
			defense = 56;
			lifeMax = 18000;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			knockBackResist = 0f;
			value = 10000f;
			npcSlots = 4f;
		}
		else if (type == 347)
		{
			width = 50;
			height = 50;
			aiStyle = 62;
			damage = 60;
			defense = 28;
			lifeMax = 1200;
			HitSound = SoundID.NPCHit4;
			knockBackResist = 0.4f;
			DeathSound = SoundID.NPCDeath14;
			value = 1000f;
			noTileCollide = true;
			noGravity = true;
			npcSlots = 1.5f;
		}
		else if (type == 348)
		{
			width = 28;
			height = 76;
			aiStyle = 3;
			damage = 80;
			defense = 26;
			lifeMax = 1800;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.4f;
			value = 1500f;
			npcSlots = 1.5f;
		}
		else if (type == 349)
		{
			width = 28;
			height = 76;
			aiStyle = 3;
			damage = 100;
			defense = 42;
			lifeMax = 1800;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.1f;
			value = 1500f;
			npcSlots = 1.5f;
		}
		else if (type == 350)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 70;
			defense = 30;
			lifeMax = 900;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.45f;
			value = 900f;
		}
		else if (type == 351)
		{
			width = 18;
			height = 90;
			aiStyle = 3;
			damage = 100;
			defense = 40;
			lifeMax = 2500;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.1f;
			value = 3000f;
			npcSlots = 1.75f;
		}
		else if (type == 352)
		{
			width = 54;
			height = 54;
			aiStyle = 63;
			damage = 75;
			defense = 8;
			lifeMax = 450;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			value = 500f;
			knockBackResist = 0.4f;
			noGravity = true;
			noTileCollide = true;
			npcSlots = 2f;
			coldDamage = true;
		}
		else if (type == 353)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 354)
		{
			friendly = true;
			width = 18;
			height = 34;
			aiStyle = 0;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			scale = 0.9f;
			rarity = 1;
		}
		else if (type == 355)
		{
			width = 10;
			height = 10;
			aiStyle = 64;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.2f;
			noGravity = true;
			catchItem = 1992;
		}
		else if (type == 356)
		{
			width = 10;
			height = 10;
			aiStyle = 65;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.25f;
			noGravity = true;
			catchItem = 1994;
		}
		else if (type == 357)
		{
			width = 10;
			height = 4;
			aiStyle = 66;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.1f;
			catchItem = 2002;
			friendly = true;
		}
		else if (type == 358)
		{
			width = 12;
			height = 12;
			aiStyle = 64;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.2f;
			noGravity = true;
			catchItem = 2004;
		}
		else if (type == 359)
		{
			width = 12;
			height = 12;
			aiStyle = 67;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.5f;
			noGravity = true;
			catchItem = 2006;
		}
		else if (type == 360)
		{
			width = 14;
			height = 14;
			aiStyle = 67;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.5f;
			noGravity = true;
			catchItem = 2007;
		}
		else if (type == 361)
		{
			width = 12;
			height = 10;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 2121;
		}
		else if (type == 362)
		{
			width = 22;
			height = 26;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 2122;
		}
		else if (type == 363)
		{
			width = 28;
			height = 22;
			aiStyle = 68;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 2122;
		}
		else if (type == 364)
		{
			width = 22;
			height = 26;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 2123;
		}
		else if (type == 365)
		{
			width = 28;
			height = 22;
			aiStyle = 68;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 2123;
		}
		else if (type == 366 || type == 367)
		{
			width = 26;
			height = 18;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = (short)(2156 + type - 366);
		}
		else if (type == 368)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 369)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.5f;
		}
		else if (type == 370)
		{
			width = 150;
			height = 100;
			aiStyle = 69;
			damage = 100;
			defense = 50;
			lifeMax = 60000;
			knockBackResist = 0f;
			noTileCollide = true;
			noGravity = true;
			npcSlots = 10f;
			HitSound = SoundID.NPCHit14;
			DeathSound = SoundID.NPCDeath20;
			value = 250000f;
			boss = true;
			netAlways = true;
		}
		else if (type == 371)
		{
			width = 36;
			height = 36;
			aiStyle = 70;
			damage = 100;
			defense = 0;
			lifeMax = 1;
			HitSound = SoundID.NPCHit3;
			DeathSound = SoundID.NPCDeath3;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			alpha = 255;
		}
		else if (type == 372)
		{
			noGravity = true;
			width = 120;
			height = 24;
			aiStyle = 71;
			damage = 100;
			defense = 100;
			lifeMax = 100;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0f;
			alpha = 255;
		}
		else if (type == 373)
		{
			noGravity = true;
			width = 100;
			height = 24;
			aiStyle = 71;
			damage = 120;
			defense = 100;
			lifeMax = 100;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0f;
			alpha = 255;
		}
		else if (type == 374)
		{
			width = 20;
			height = 10;
			aiStyle = 66;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.15f;
			catchItem = 2673;
			rarity = 4;
			dontTakeDamageFromHostiles = true;
		}
		else if (type == 375)
		{
			width = 10;
			height = 10;
			aiStyle = 6;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			npcSlots = 0.15f;
			catchItem = 2673;
			rarity = 4;
			dontTakeDamageFromHostiles = true;
		}
		else if (type == 376)
		{
			friendly = true;
			width = 34;
			height = 8;
			aiStyle = 0;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.5f;
			scale = 0.9f;
			rarity = 1;
		}
		else if (type == 377)
		{
			width = 14;
			height = 10;
			aiStyle = 1;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			friendly = true;
			catchItem = 2740;
			npcSlots = 0.1f;
		}
		else if (type == 378)
		{
			npcSlots = 1f;
			width = 20;
			height = 26;
			aiStyle = 41;
			damage = 120;
			defense = 30;
			lifeMax = 200;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			value = 450f;
		}
		else if (type >= 379 && type <= 380)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 45;
			defense = 14;
			lifeMax = 210;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.55f;
			value = 1000f;
			npcSlots = 0f;
			lavaImmune = true;
			netAlways = true;
			chaseable = false;
		}
		else if (type >= 381 && type <= 382)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 50;
			defense = 25;
			lifeMax = 350;
			HitSound = SoundID.NPCHit39;
			DeathSound = SoundID.NPCDeath57;
			knockBackResist = 0.35f;
			value = 1000f;
		}
		else if (type == 383)
		{
			lifeMax = 300;
			defense = 50;
			damage = 75;
			width = 18;
			height = 40;
			aiStyle = 3;
			HitSound = SoundID.NPCHit39;
			DeathSound = SoundID.NPCDeath57;
			value = 1200f;
			knockBackResist = 0.25f;
		}
		else if (type == 384)
		{
			lifeMax = 1000;
			width = 18;
			defense = 20;
			height = 40;
			aiStyle = 72;
			HitSound = SoundID.NPCHit43;
			DeathSound = SoundID.NPCDeath45;
			npcSlots = 0f;
			noTileCollide = true;
			canGhostHeal = false;
		}
		else if (type == 385)
		{
			lifeMax = 750;
			defense = 30;
			damage = 80;
			width = 18;
			height = 40;
			aiStyle = 3;
			HitSound = SoundID.NPCHit39;
			DeathSound = SoundID.NPCDeath57;
			value = 600f;
			knockBackResist = 0f;
			npcSlots = 0.75f;
		}
		else if (type == 386)
		{
			lifeMax = 400;
			defense = 34;
			damage = 40;
			width = 18;
			height = 40;
			aiStyle = 3;
			HitSound = SoundID.NPCHit39;
			DeathSound = SoundID.NPCDeath57;
			value = 1200f;
			knockBackResist = 0.4f;
		}
		else if (type == 387)
		{
			width = 20;
			height = 50;
			aiStyle = 73;
			damage = 10;
			defense = 40;
			lifeMax = 200;
			HitSound = SoundID.NPCHit53;
			DeathSound = SoundID.NPCDeath56;
			knockBackResist = 0f;
			canGhostHeal = false;
		}
		else if (type == 388)
		{
			width = 40;
			height = 30;
			aiStyle = 74;
			damage = 60;
			defense = 16;
			lifeMax = 300;
			HitSound = SoundID.NPCHit42;
			knockBackResist = 0.4f;
			DeathSound = SoundID.NPCDeath44;
			value = 1000f;
			noTileCollide = true;
			noGravity = true;
			npcSlots = 1.5f;
			canGhostHeal = false;
		}
		else if (type == 389)
		{
			lifeMax = 600;
			defense = 38;
			damage = 75;
			width = 18;
			height = 40;
			aiStyle = 3;
			HitSound = SoundID.NPCHit39;
			DeathSound = SoundID.NPCDeath57;
			value = 1200f;
			npcSlots = 0.5f;
			knockBackResist = 0.3f;
		}
		else if (type == 390)
		{
			damage = 65;
			defense = 30;
			lifeMax = 350;
			width = 18;
			height = 40;
			aiStyle = 75;
			HitSound = SoundID.NPCHit39;
			DeathSound = SoundID.NPCDeath57;
			value = 1200f;
			npcSlots = 0.5f;
		}
		else if (type == 391)
		{
			lifeMax = 600;
			defense = 30;
			damage = 85;
			width = 60;
			height = 40;
			aiStyle = 3;
			HitSound = SoundID.NPCHit51;
			DeathSound = SoundID.NPCDeath54;
			value = 1200f;
			npcSlots = 0.5f;
			knockBackResist = 0.1f;
		}
		else if (type == 392)
		{
			lifeMax = 100;
			defense = 100;
			damage = 50;
			width = 150;
			height = 80;
			aiStyle = 75;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			value = 0f;
			npcSlots = 0f;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			dontTakeDamage = true;
			netAlways = true;
		}
		else if (type == 393)
		{
			lifeMax = 5000;
			defense = 20;
			damage = 60;
			width = 40;
			height = 16;
			aiStyle = 75;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			value = 0f;
			npcSlots = 1f;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			netAlways = true;
		}
		else if (type == 394)
		{
			lifeMax = 3500;
			defense = 20;
			damage = 60;
			width = 46;
			height = 36;
			aiStyle = 75;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			value = 0f;
			npcSlots = 1f;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			netAlways = true;
		}
		else if (type == 395)
		{
			lifeMax = 10000;
			defense = 0;
			damage = 80;
			width = 120;
			height = 90;
			aiStyle = 76;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			value = 0f;
			npcSlots = 6f;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			dontTakeDamage = true;
			boss = true;
			netAlways = true;
		}
		else if (type == 399)
		{
			defense = 5;
			damage = 5;
			lifeMax = 500;
			aiStyle = 80;
			width = 42;
			height = 72;
			value = 0f;
			knockBackResist = 0f;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			npcSlots = 0f;
			noGravity = true;
			chaseable = false;
			netAlways = true;
			rarity = 1;
		}
		else if (type == 396)
		{
			lifeMax = 45000;
			defense = 50;
			damage = 0;
			width = 38;
			height = 56;
			aiStyle = 79;
			HitSound = SoundID.NPCHit57;
			DeathSound = SoundID.NPCDeath62;
			value = 0f;
			npcSlots = 6f;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			boss = true;
			hide = true;
			netAlways = true;
		}
		else if (type == 397)
		{
			lifeMax = 25000;
			defense = 40;
			damage = 0;
			width = 46;
			height = 66;
			aiStyle = 78;
			HitSound = SoundID.NPCHit57;
			DeathSound = SoundID.NPCDeath62;
			value = 0f;
			npcSlots = 6f;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			boss = true;
			hide = true;
			netAlways = true;
		}
		else if (type == 398)
		{
			lifeMax = 50000;
			defense = 70;
			damage = 0;
			width = 46;
			height = 66;
			aiStyle = 77;
			HitSound = SoundID.NPCHit57;
			DeathSound = null;
			value = 1000000f;
			npcSlots = 6f;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			dontTakeDamage = true;
			boss = true;
			behindTiles = true;
			hide = true;
			netAlways = true;
		}
		else if (type == 400)
		{
			defense = 0;
			damage = 60;
			lifeMax = 100;
			aiStyle = 81;
			width = 60;
			height = 60;
			value = 0f;
			knockBackResist = 0f;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0f;
			noGravity = true;
			dontTakeDamage = true;
			noTileCollide = true;
			netAlways = true;
		}
		else if (type == 401)
		{
			lifeMax = 400;
			defense = 0;
			damage = 0;
			width = 30;
			height = 30;
			aiStyle = 82;
			HitSound = SoundID.NPCHit57;
			DeathSound = SoundID.NPCDeath62;
			value = 0f;
			npcSlots = 0f;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			hide = true;
		}
		else if (type == 437)
		{
			lifeMax = 400;
			defense = 0;
			damage = 0;
			width = 54;
			height = 54;
			aiStyle = 83;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			value = 0f;
			npcSlots = 0f;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			dontTakeDamage = true;
			netAlways = true;
			chaseable = false;
		}
		else if (type == 438)
		{
			lifeMax = 400;
			defense = 0;
			damage = 0;
			width = 22;
			height = 40;
			aiStyle = 83;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 0f;
			npcSlots = 0f;
			knockBackResist = 0f;
			lavaImmune = true;
			netAlways = true;
			chaseable = false;
		}
		else if (type == 439)
		{
			width = 24;
			height = 50;
			aiStyle = 84;
			damage = 50;
			defense = 42;
			lifeMax = 32000;
			knockBackResist = 0f;
			noTileCollide = true;
			noGravity = true;
			npcSlots = 10f;
			HitSound = SoundID.NPCHit55;
			DeathSound = SoundID.NPCDeath59;
			value = 100000f;
			boss = true;
			netAlways = true;
		}
		else if (type == 440)
		{
			width = 24;
			height = 50;
			aiStyle = 84;
			damage = 0;
			defense = 35;
			lifeMax = 10000;
			knockBackResist = 0f;
			noTileCollide = true;
			noGravity = true;
			npcSlots = 0f;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			netAlways = true;
			chaseable = false;
		}
		else if (type == 442)
		{
			width = 14;
			height = 14;
			aiStyle = 24;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 2889;
			npcSlots = 0.4f;
			rarity = 3;
		}
		else if (type == 443)
		{
			width = 18;
			height = 20;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 2890;
			rarity = 3;
		}
		else if (type == 444)
		{
			width = 10;
			height = 10;
			aiStyle = 65;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.25f;
			noGravity = true;
			catchItem = 2891;
			rarity = 3;
		}
		else if (type == 445)
		{
			width = 12;
			height = 10;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 2892;
			rarity = 3;
		}
		else if (type == 446)
		{
			width = 14;
			height = 10;
			aiStyle = 1;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			friendly = true;
			catchItem = 2893;
			npcSlots = 0.1f;
			rarity = 3;
		}
		else if (type == 447)
		{
			width = 14;
			height = 12;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath4;
			npcSlots = 0.25f;
			catchItem = 2894;
			rarity = 3;
		}
		else if (type == 448)
		{
			width = 10;
			height = 4;
			aiStyle = 66;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.1f;
			catchItem = 2895;
			friendly = true;
			rarity = 3;
		}
		else if (type == 449)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 20;
			defense = 8;
			lifeMax = 60;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 100f;
		}
		else if (type == 450)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 20;
			defense = 12;
			lifeMax = 55;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 130f;
		}
		else if (type == 451)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 18;
			defense = 8;
			lifeMax = 65;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 120f;
		}
		else if (type == 452)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 22;
			defense = 8;
			lifeMax = 60;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 110f;
		}
		else if (type == 453)
		{
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 30;
			lifeMax = 250;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			npcSlots = 7f;
			rarity = 1;
		}
		else if (type == 454)
		{
			noTileCollide = true;
			npcSlots = 5f;
			width = 32;
			height = 32;
			aiStyle = 6;
			netAlways = true;
			damage = 100;
			defense = 15;
			lifeMax = 10000;
			HitSound = SoundID.NPCHit56;
			DeathSound = SoundID.NPCDeath60;
			noGravity = true;
			knockBackResist = 0f;
			value = 0f;
			scale = 1f;
			alpha = 255;
		}
		else if (type == 459)
		{
			noTileCollide = true;
			width = 32;
			height = 32;
			aiStyle = 6;
			netAlways = true;
			damage = 50;
			defense = 30;
			lifeMax = 10000;
			HitSound = SoundID.NPCHit56;
			DeathSound = SoundID.NPCDeath60;
			noGravity = true;
			knockBackResist = 0f;
			value = 0f;
			scale = 1f;
			alpha = 255;
			dontCountMe = true;
		}
		else if (type == 455 || type == 456 || type == 457 || type == 458)
		{
			noTileCollide = true;
			width = 32;
			height = 32;
			aiStyle = 6;
			netAlways = true;
			damage = 50;
			defense = 30;
			lifeMax = 10000;
			HitSound = SoundID.NPCHit56;
			DeathSound = SoundID.NPCDeath60;
			noGravity = true;
			knockBackResist = 0f;
			value = 0f;
			scale = 1f;
			alpha = 255;
			dontCountMe = true;
		}
		else if (type == 464)
		{
			width = 18;
			height = 20;
			aiStyle = 3;
			damage = 21;
			defense = 5;
			lifeMax = 75;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 500f;
		}
		else if (type == 465)
		{
			noGravity = true;
			width = 18;
			height = 20;
			aiStyle = 16;
			damage = 31;
			defense = 7;
			lifeMax = 110;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 500f;
		}
		else if (type == 470)
		{
			width = 16;
			height = 34;
			aiStyle = 3;
			damage = 21;
			defense = 5;
			lifeMax = 75;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 500f;
		}
		else if (type == 473 || type == 474 || type == 475 || type == 476)
		{
			width = 28;
			height = 44;
			aiStyle = 87;
			damage = 90;
			defense = 34;
			lifeMax = 3500;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath6;
			value = 30000f;
			knockBackResist = 0.1f;
			rarity = 5;
		}
		else if (type == 480)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 30;
			defense = 20;
			lifeMax = 400;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.15f;
			value = 1000f;
			rarity = 1;
		}
		else if (type == 481)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 22;
			defense = 10;
			lifeMax = 70;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.4f;
			value = 300f;
		}
		else if (type == 482)
		{
			width = 28;
			height = 48;
			aiStyle = 3;
			damage = 30;
			defense = 18;
			lifeMax = 110;
			HitSound = SoundID.NPCHit41;
			DeathSound = SoundID.NPCDeath43;
			knockBackResist = 0.35f;
			value = 500f;
		}
		else if (type == 483)
		{
			npcSlots = 0.5f;
			width = 20;
			height = 30;
			aiStyle = 91;
			damage = 24;
			defense = 8;
			lifeMax = 40;
			HitSound = SoundID.NPCHit7;
			knockBackResist = 0.6f;
			DeathSound = SoundID.NPCDeath6;
			value = 1000f;
		}
		else if (type >= 484 && type <= 487)
		{
			width = 10;
			height = 4;
			aiStyle = 66;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.1f;
			catchItem = (short)(3191 + type - 484);
			friendly = true;
		}
		else if (type == 488)
		{
			width = 18;
			height = 40;
			aiStyle = 92;
			damage = 0;
			defense = 0;
			lifeMax = 1000;
			HitSound = SoundID.NPCHit15;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0f;
			value = 0f;
			immortal = true;
			netAlways = true;
		}
		else if (type == 489)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 20;
			defense = 8;
			lifeMax = 75;
			HitSound = SoundID.NPCHit18;
			DeathSound = SoundID.NPCDeath21;
			knockBackResist = 0.4f;
			value = 150f;
		}
		else if (type == 490)
		{
			noGravity = true;
			width = 28;
			height = 30;
			aiStyle = 22;
			damage = 28;
			defense = 14;
			lifeMax = 50;
			HitSound = SoundID.NPCHit19;
			knockBackResist = 0.6f;
			DeathSound = SoundID.NPCDeath22;
			value = 150f;
		}
		else if (type == 491)
		{
			noGravity = true;
			width = 350;
			height = 120;
			aiStyle = 93;
			damage = 0;
			defense = 100;
			lifeMax = 50;
			HitSound = SoundID.NPCHit19;
			knockBackResist = 0f;
			DeathSound = SoundID.NPCDeath22;
			value = 0f;
			dontTakeDamage = true;
			netAlways = true;
		}
		else if (type == 492)
		{
			lifeMax = 2000;
			defense = 20;
			damage = 30;
			width = 30;
			height = 30;
			aiStyle = 75;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			value = 0f;
			npcSlots = 1f;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			hide = true;
			netAlways = true;
		}
		else if (type >= 494 && type <= 495)
		{
			width = 28;
			height = 22;
			aiStyle = 3;
			damage = 28;
			defense = 6;
			lifeMax = 50;
			HitSound = SoundID.NPCHit33;
			DeathSound = SoundID.NPCDeath36;
			value = 120f;
		}
		else if (type >= 496 && type <= 497)
		{
			width = 28;
			height = 22;
			aiStyle = 39;
			damage = 16;
			defense = 12;
			lifeMax = 50;
			HitSound = SoundID.NPCHit38;
			DeathSound = SoundID.NPCDeath41;
			knockBackResist = 0.75f;
			value = 120f;
		}
		else if (type >= 498 && type <= 506)
		{
			width = 24;
			height = 44;
			aiStyle = 3;
			damage = 18;
			defense = 10;
			lifeMax = 65;
			HitSound = SoundID.NPCHit50;
			DeathSound = SoundID.NPCDeath53;
			knockBackResist = 0.45f;
			value = 120f;
		}
		else if (type == 441)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 513)
		{
			npcSlots = 4f;
			width = 22;
			height = 22;
			aiStyle = 6;
			damage = 18;
			defense = 0;
			lifeMax = 60;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 130f;
		}
		else if (type == 514)
		{
			width = 22;
			height = 22;
			aiStyle = 6;
			netAlways = true;
			damage = 7;
			defense = 12;
			lifeMax = 60;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 130f;
			dontCountMe = true;
			npcSlots = 0f;
		}
		else if (type == 515)
		{
			width = 22;
			height = 22;
			aiStyle = 6;
			netAlways = true;
			damage = 7;
			defense = 14;
			lifeMax = 60;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 130f;
			dontCountMe = true;
			npcSlots = 0f;
		}
		else if (type == 510)
		{
			npcSlots = 5f;
			width = 34;
			height = 34;
			aiStyle = 6;
			damage = 58;
			defense = 18;
			lifeMax = 500;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 700f;
		}
		else if (type == 511)
		{
			width = 34;
			height = 34;
			aiStyle = 6;
			netAlways = true;
			damage = 54;
			defense = 28;
			lifeMax = 500;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 700f;
			dontCountMe = true;
			npcSlots = 0f;
		}
		else if (type == 512)
		{
			width = 34;
			height = 34;
			aiStyle = 6;
			netAlways = true;
			damage = 50;
			defense = 34;
			lifeMax = 500;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = 700f;
			dontCountMe = true;
			npcSlots = 0f;
		}
		else if (type == 508)
		{
			width = 50;
			height = 31;
			aiStyle = 3;
			damage = 38;
			defense = 16;
			lifeMax = 110;
			HitSound = SoundID.NPCHit31;
			DeathSound = SoundID.NPCDeath34;
			knockBackResist = 0.4f;
			value = 175f;
		}
		else if (type == 509)
		{
			width = 40;
			height = 31;
			aiStyle = 44;
			damage = 34;
			defense = 12;
			lifeMax = 90;
			knockBackResist = 0.3f;
			HitSound = SoundID.NPCHit32;
			DeathSound = SoundID.NPCDeath35;
			value = 195f;
		}
		else if (type == 580)
		{
			width = 26;
			height = 26;
			aiStyle = 3;
			damage = 25;
			defense = 10;
			lifeMax = 80;
			HitSound = SoundID.NPCHit31;
			DeathSound = SoundID.NPCDeath34;
			knockBackResist = 0.5f;
			value = 80f;
			npcSlots = 0.8f;
		}
		else if (type == 581)
		{
			width = 30;
			height = 22;
			aiStyle = 44;
			damage = 29;
			defense = 8;
			lifeMax = 60;
			knockBackResist = 0.5f;
			HitSound = SoundID.NPCHit32;
			DeathSound = SoundID.NPCDeath35;
			value = 90f;
			npcSlots = 0.8f;
		}
		else if (type >= 524 && type <= 527)
		{
			width = 24;
			height = 44;
			aiStyle = 3;
			damage = 50;
			defense = 26;
			lifeMax = 180;
			HitSound = SoundID.NPCHit37;
			DeathSound = SoundID.NPCDeath40;
			knockBackResist = 0.6f;
			value = 500f;
			npcSlots = 0.5f;
			switch (type)
			{
			case 525:
				lifeMax += 70;
				defense += 4;
				damage += 10;
				knockBackResist -= 0.1f;
				value += 150f;
				break;
			case 526:
				lifeMax += 40;
				defense += 6;
				damage += 14;
				knockBackResist -= 0.1f;
				value += 150f;
				break;
			case 527:
				lifeMax += 120;
				defense += 6;
				damage += 4;
				knockBackResist -= 0.2f;
				value += 250f;
				break;
			}
		}
		else if (type >= 528 && type <= 529)
		{
			width = 24;
			height = 44;
			aiStyle = 3;
			damage = 52;
			defense = 28;
			lifeMax = 350;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.35f;
			value = 600f;
		}
		else if (type == 530)
		{
			width = 50;
			height = 20;
			aiStyle = 3;
			damage = 66;
			defense = 24;
			lifeMax = 320;
			HitSound = SoundID.NPCHit13;
			DeathSound = SoundID.NPCDeath19;
			knockBackResist = 0.5f;
			value = 600f;
		}
		else if (type == 531)
		{
			noGravity = true;
			width = 36;
			height = 36;
			aiStyle = 40;
			damage = 66;
			defense = 24;
			lifeMax = 320;
			HitSound = SoundID.NPCHit13;
			DeathSound = SoundID.NPCDeath19;
			knockBackResist = 0.5f;
			value = 600f;
		}
		else if (type == 532)
		{
			width = 32;
			height = 31;
			aiStyle = 3;
			damage = 65;
			defense = 34;
			lifeMax = 270;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.3f;
			value = 800f;
			npcSlots = 0.75f;
		}
		else if (type == 533)
		{
			width = 28;
			height = 62;
			aiStyle = 8;
			damage = 40;
			defense = 20;
			lifeMax = 220;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0f;
			value = 1200f;
			npcSlots = 2f;
		}
		else if (type == 493)
		{
			lifeMax = 20000;
			defense = 20;
			damage = 0;
			width = 130;
			height = 270;
			aiStyle = 94;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 0f;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			npcSlots = 0f;
		}
		else if (type == 402)
		{
			noTileCollide = true;
			npcSlots = 1f;
			width = 32;
			height = 32;
			aiStyle = 6;
			netAlways = true;
			damage = 80;
			defense = 10;
			lifeMax = 1200;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			knockBackResist = 0f;
			value = 0f;
			scale = 1f;
		}
		else if (type == 405)
		{
			width = 44;
			height = 44;
			aiStyle = 85;
			damage = 120;
			defense = 50;
			lifeMax = 300;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.3f;
			noGravity = true;
			npcSlots = 2f;
		}
		else if (type == 406)
		{
			width = 22;
			height = 22;
			aiStyle = 95;
			damage = 70;
			defense = 0;
			lifeMax = 300;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.4f;
			noGravity = true;
		}
		else if (type == 411)
		{
			width = 22;
			height = 56;
			aiStyle = 3;
			damage = 80;
			defense = 34;
			lifeMax = 700;
			HitSound = SoundID.NPCHit6;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.4f;
		}
		else if (type == 409)
		{
			width = 34;
			height = 42;
			aiStyle = 3;
			damage = 70;
			defense = 40;
			lifeMax = 800;
			HitSound = SoundID.NPCHit6;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.4f;
			npcSlots = 3f;
		}
		else if (type == 410)
		{
			width = 22;
			height = 22;
			aiStyle = 26;
			damage = 80;
			defense = 10;
			lifeMax = 200;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath5;
			knockBackResist = 0.3f;
			npcSlots = 0.5f;
		}
		else if (type == 407)
		{
			width = 40;
			height = 60;
			aiStyle = 96;
			damage = 70;
			defense = 38;
			lifeMax = 1500;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			knockBackResist = 0.03f;
			npcSlots = 3f;
		}
		else if (type == 507)
		{
			lifeMax = 20000;
			defense = 20;
			damage = 0;
			width = 130;
			height = 270;
			aiStyle = 94;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 0f;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			npcSlots = 0f;
		}
		else if (type == 423)
		{
			width = 50;
			height = 44;
			aiStyle = 26;
			damage = 90;
			defense = 46;
			lifeMax = 850;
			HitSound = SoundID.NPCHit6;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.2f;
			npcSlots = 1f;
		}
		else if (type == 421)
		{
			width = 44;
			height = 44;
			aiStyle = 85;
			damage = 70;
			defense = 34;
			lifeMax = 330;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			noGravity = true;
			npcSlots = 1f;
		}
		else if (type == 424)
		{
			width = 22;
			height = 56;
			aiStyle = 3;
			damage = 80;
			defense = 30;
			lifeMax = 700;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath5;
			knockBackResist = 0.6f;
			npcSlots = 2f;
		}
		else if (type == 420)
		{
			width = 40;
			height = 40;
			aiStyle = 97;
			damage = 75;
			defense = 20;
			lifeMax = 1300;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			noTileCollide = true;
			noGravity = true;
			npcSlots = 3f;
		}
		else if (type == 422)
		{
			lifeMax = 20000;
			defense = 20;
			damage = 0;
			width = 130;
			height = 270;
			aiStyle = 94;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 0f;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			npcSlots = 0f;
		}
		else if (type == 425)
		{
			width = 30;
			height = 56;
			aiStyle = 3;
			damage = 100;
			defense = 40;
			lifeMax = 800;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.4f;
		}
		else if (type == 429)
		{
			width = 22;
			height = 56;
			aiStyle = 3;
			damage = 90;
			defense = 34;
			lifeMax = 700;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath5;
			knockBackResist = 0.6f;
			npcSlots = 2f;
		}
		else if (type == 428)
		{
			width = 24;
			height = 26;
			aiStyle = 3;
			damage = 50;
			defense = 6;
			lifeMax = 200;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
		}
		else if (type == 427)
		{
			width = 40;
			height = 28;
			aiStyle = 3;
			damage = 75;
			defense = 20;
			lifeMax = 500;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.5f;
			npcSlots = 0.5f;
		}
		else if (type == 426)
		{
			width = 50;
			height = 62;
			aiStyle = 3;
			damage = 100;
			defense = 44;
			lifeMax = 1000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.3f;
		}
		else if (type == 517)
		{
			lifeMax = 20000;
			defense = 20;
			damage = 0;
			width = 130;
			height = 270;
			aiStyle = 94;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 0f;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			npcSlots = 0f;
		}
		else if (type == 412)
		{
			width = 20;
			height = 20;
			aiStyle = 6;
			netAlways = true;
			damage = 120;
			defense = 1000;
			lifeMax = 10000;
			HitSound = SoundID.NPCHit11;
			DeathSound = SoundID.NPCDeath22;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			dontTakeDamage = true;
			npcSlots = 2f;
		}
		else if (type == 413)
		{
			width = 20;
			height = 20;
			aiStyle = 6;
			netAlways = true;
			damage = 80;
			defense = 1000;
			lifeMax = 10000;
			HitSound = SoundID.NPCHit11;
			DeathSound = SoundID.NPCDeath22;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			dontCountMe = true;
			dontTakeDamage = true;
			npcSlots = 0f;
		}
		else if (type == 414)
		{
			width = 20;
			height = 20;
			aiStyle = 6;
			netAlways = true;
			damage = 50;
			defense = 0;
			lifeMax = 10000;
			HitSound = SoundID.NPCHit8;
			DeathSound = SoundID.NPCDeath22;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			dontCountMe = true;
			takenDamageMultiplier = 10f;
			npcSlots = 0f;
		}
		else if (type == 415)
		{
			lifeMax = 800;
			defense = 32;
			damage = 55;
			width = 60;
			height = 40;
			aiStyle = 3;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.2f;
		}
		else if (type == 416)
		{
			damage = 80;
			defense = 28;
			lifeMax = 800;
			width = 18;
			height = 40;
			aiStyle = 75;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.2f;
		}
		else if (type == 518)
		{
			lifeMax = 1000;
			defense = 28;
			damage = 80;
			width = 22;
			height = 56;
			aiStyle = 3;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.4f;
		}
		else if (type == 417)
		{
			npcSlots = 2f;
			width = 46;
			height = 52;
			aiStyle = 39;
			damage = 80;
			defense = 34;
			lifeMax = 700;
			HitSound = SoundID.NPCHit7;
			knockBackResist = 0f;
			DeathSound = SoundID.NPCDeath5;
		}
		else if (type == 418)
		{
			width = 38;
			height = 38;
			aiStyle = 74;
			damage = 70;
			defense = 26;
			lifeMax = 600;
			HitSound = SoundID.NPCHit3;
			DeathSound = SoundID.NPCDeath3;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0.2f;
		}
		else if (type == 419)
		{
			lifeMax = 800;
			defense = 30;
			damage = 90;
			width = 22;
			height = 56;
			aiStyle = 3;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.4f;
		}
		else if (type == 516)
		{
			width = 26;
			height = 26;
			aiStyle = 9;
			damage = 100;
			defense = 0;
			lifeMax = 1;
			HitSound = null;
			DeathSound = null;
			noGravity = true;
			noTileCollide = false;
			alpha = 0;
			knockBackResist = 0f;
		}
		else if (type == 519)
		{
			width = 26;
			height = 26;
			aiStyle = 99;
			damage = 120;
			defense = 0;
			lifeMax = 1;
			HitSound = null;
			DeathSound = null;
			noGravity = true;
			noTileCollide = false;
			alpha = 0;
			knockBackResist = 0f;
		}
		else if (type == 162)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 65;
			defense = 18;
			lifeMax = 350;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.3f;
			value = 600f;
		}
		else if (type == 166)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 70;
			defense = 26;
			lifeMax = 450;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.2f;
			value = 1000f;
		}
		else if (type == 253)
		{
			noGravity = true;
			noTileCollide = true;
			width = 24;
			height = 44;
			aiStyle = 22;
			damage = 80;
			defense = 22;
			lifeMax = 700;
			HitSound = SoundID.NPCHit49;
			DeathSound = SoundID.NPCDeath51;
			alpha = 100;
			value = 1500f;
			knockBackResist = 0.6f;
		}
		else if (type == 158)
		{
			npcSlots = 2f;
			width = 22;
			height = 22;
			aiStyle = 14;
			damage = 60;
			defense = 32;
			lifeMax = 750;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.75f;
			DeathSound = SoundID.NPCDeath6;
			value = 5000f;
		}
		else if (type == 159)
		{
			npcSlots = 2f;
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 80;
			defense = 24;
			lifeMax = 750;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.4f;
			value = 5000f;
		}
		else if (type == 460)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 70;
			defense = 30;
			lifeMax = 700;
			HitSound = SoundID.NPCHit7;
			DeathSound = SoundID.NPCDeath17;
			knockBackResist = 0.25f;
			value = 1000f;
		}
		else if (type == 461)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 60;
			defense = 22;
			lifeMax = 400;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.3f;
			value = 1000f;
		}
		else if (type == 462)
		{
			width = 20;
			height = 24;
			aiStyle = 3;
			damage = 70;
			defense = 14;
			lifeMax = 270;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.7f;
			value = 600f;
			npcSlots = 0.5f;
		}
		else if (type == 463)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 100;
			defense = 34;
			lifeMax = 4000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.1f;
			value = 3000f;
		}
		else if (type == 466)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 70;
			defense = 40;
			lifeMax = 550;
			HitSound = SoundID.NPCHit48;
			DeathSound = SoundID.NPCDeath50;
			knockBackResist = 0.5f;
			value = 1500f;
		}
		else if (type == 467)
		{
			width = 22;
			height = 22;
			aiStyle = 85;
			damage = 100;
			defense = 80;
			lifeMax = 350;
			HitSound = SoundID.NPCHit34;
			DeathSound = SoundID.NPCDeath37;
			value = 900f;
			knockBackResist = 0.7f;
			noGravity = true;
		}
		else if (type == 469)
		{
			width = 38;
			height = 26;
			aiStyle = 3;
			damage = 68;
			defense = 28;
			lifeMax = 600;
			HitSound = SoundID.NPCHit47;
			DeathSound = SoundID.NPCDeath49;
			knockBackResist = 0.35f;
			value = 1300f;
		}
		else if (type == 468)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 65;
			defense = 24;
			lifeMax = 500;
			HitSound = SoundID.NPCHit35;
			DeathSound = SoundID.NPCDeath38;
			knockBackResist = 0.6f;
			value = 1300f;
		}
		else if (type == 477)
		{
			noGravity = true;
			netAlways = true;
			width = 80;
			height = 50;
			aiStyle = 88;
			damage = 80;
			defense = 30;
			lifeMax = 6000;
			HitSound = SoundID.NPCHit44;
			DeathSound = SoundID.NPCDeath46;
			value = 50000f;
			knockBackResist = 0.2f;
			rarity = 1;
		}
		else if (type == 478)
		{
			width = 34;
			height = 34;
			aiStyle = 89;
			damage = 0;
			defense = 30;
			lifeMax = 200;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 0f;
			knockBackResist = 0.7f;
			npcSlots = 0f;
		}
		else if (type == 479)
		{
			width = 46;
			height = 30;
			aiStyle = 90;
			damage = 50;
			defense = 14;
			lifeMax = 700;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.3f;
			value = 0f;
			npcSlots = 0.1f;
		}
		else if (type == 26)
		{
			scale = 0.9f;
			width = 18;
			height = 38;
			aiStyle = 3;
			damage = 12;
			defense = 4;
			lifeMax = 60;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.8f;
			value = 100f;
		}
		else if (type == 27)
		{
			scale = 0.95f;
			width = 18;
			height = 38;
			aiStyle = 3;
			damage = 20;
			defense = 6;
			lifeMax = 80;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.7f;
			value = 200f;
		}
		else if (type == 28)
		{
			scale = 1.1f;
			width = 18;
			height = 38;
			aiStyle = 3;
			damage = 25;
			defense = 8;
			lifeMax = 110;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			value = 150f;
		}
		else if (type == 29)
		{
			width = 18;
			height = 38;
			aiStyle = 8;
			damage = 20;
			defense = 2;
			lifeMax = 40;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.6f;
			value = 200f;
		}
		else if (type == 30)
		{
			width = 16;
			height = 16;
			aiStyle = 9;
			damage = 20;
			defense = 0;
			lifeMax = 1;
			HitSound = SoundID.NPCHit3;
			DeathSound = SoundID.NPCDeath3;
			noGravity = true;
			noTileCollide = true;
			alpha = 100;
			knockBackResist = 0f;
		}
		else if (type == 111)
		{
			scale = 0.95f;
			width = 18;
			height = 38;
			aiStyle = 3;
			damage = 20;
			defense = 6;
			lifeMax = 80;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.7f;
			value = 200f;
		}
		else if (type == 471)
		{
			width = 18;
			height = 38;
			aiStyle = 3;
			damage = 80;
			defense = 26;
			lifeMax = 2000;
			HitSound = SoundID.NPCHit40;
			DeathSound = SoundID.NPCDeath42;
			knockBackResist = 0.15f;
			value = 5000f;
			rarity = 1;
		}
		else if (type == 472)
		{
			width = 40;
			height = 24;
			aiStyle = 86;
			damage = 50;
			defense = 18;
			lifeMax = 180;
			HitSound = SoundID.NPCHit52;
			DeathSound = SoundID.NPCDeath55;
			knockBackResist = 0f;
			value = 0f;
			npcSlots = 0.1f;
		}
		else if (type == 520)
		{
			width = 34;
			height = 110;
			aiStyle = 3;
			damage = 60;
			defense = 40;
			lifeMax = 2000;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath14;
			knockBackResist = 0f;
		}
		else if (type == 521)
		{
			width = 60;
			height = 60;
			aiStyle = 86;
			damage = 90;
			defense = 30;
			lifeMax = 2000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0f;
		}
		else if (type == 522)
		{
			width = 26;
			height = 26;
			aiStyle = 100;
			damage = 120;
			defense = 0;
			lifeMax = 400;
			HitSound = null;
			DeathSound = null;
			noGravity = true;
			noTileCollide = true;
			alpha = 0;
			knockBackResist = 0f;
		}
		else if (type == 523)
		{
			width = 42;
			height = 42;
			aiStyle = 101;
			damage = 30;
			defense = 0;
			lifeMax = 500;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			noGravity = true;
			noTileCollide = true;
			alpha = 0;
			knockBackResist = 0f;
			chaseable = false;
			alpha = 255;
			canGhostHeal = false;
		}
		else if (type == 534)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 14;
			defense = 20;
			lifeMax = 400;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.3f;
			value = 0f;
			lavaImmune = true;
			netAlways = true;
			rarity = 2;
		}
		else if (type == 535)
		{
			width = 24;
			height = 18;
			aiStyle = 1;
			damage = 14;
			defense = 5;
			lifeMax = 50;
			scale = 1.1f;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			alpha = 0;
			value = 40f;
		}
		else if (type == 536)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 14;
			defense = 8;
			lifeMax = 200;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 1000f;
			rarity = 2;
		}
		else if (type == 537)
		{
			npcSlots = 2f;
			width = 30;
			height = 24;
			aiStyle = 1;
			damage = 15;
			defense = 5;
			lifeMax = 50;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			alpha = 50;
			color = new Color(255, 250, 0, 0) * 0.2f;
			value = 75f;
			knockBackResist = 0.7f;
		}
		else if (type == 538)
		{
			width = 18;
			height = 20;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 3563;
		}
		else if (type == 539)
		{
			width = 18;
			height = 20;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 3564;
			rarity = 3;
		}
		else if (type == 541)
		{
			width = 30;
			height = 76;
			aiStyle = 102;
			damage = 40;
			defense = 30;
			lifeMax = 5000;
			HitSound = SoundID.NPCHit23;
			DeathSound = SoundID.NPCDeath39;
			knockBackResist = 0.05f;
			value = Item.buyPrice(0, 1, 50);
			rarity = 2;
		}
		else if (type == 542)
		{
			noGravity = true;
			width = 100;
			height = 24;
			aiStyle = 103;
			damage = 50;
			defense = 20;
			lifeMax = 360;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 400f;
			knockBackResist = 0.9f;
			behindTiles = true;
		}
		else if (type == 543)
		{
			noGravity = true;
			width = 100;
			height = 24;
			aiStyle = 103;
			damage = 60;
			defense = 24;
			lifeMax = 380;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 400f;
			knockBackResist = 0.8f;
			behindTiles = true;
		}
		else if (type == 544)
		{
			noGravity = true;
			width = 100;
			height = 24;
			aiStyle = 103;
			damage = 64;
			defense = 22;
			lifeMax = 400;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 400f;
			knockBackResist = 0.8f;
			behindTiles = true;
		}
		else if (type == 545)
		{
			noGravity = true;
			width = 100;
			height = 24;
			aiStyle = 103;
			damage = 54;
			defense = 26;
			lifeMax = 450;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 400f;
			knockBackResist = 0.7f;
			behindTiles = true;
		}
		else if (type == 546)
		{
			width = 30;
			height = 30;
			aiStyle = 26;
			damage = 30;
			defense = 6;
			lifeMax = 50;
			HitSound = SoundID.NPCHit11;
			DeathSound = SoundID.NPCDeath15;
			knockBackResist = 0.8f;
			value = 100f;
		}
		else if (type == 547)
		{
			width = 16;
			height = 16;
			aiStyle = 104;
			defense = 10;
			lifeMax = 10;
			HitSound = SoundID.NPCHit11;
			DeathSound = SoundID.NPCDeath15;
			knockBackResist = 1f;
			noGravity = true;
			noTileCollide = true;
		}
		else if (type == 548)
		{
			width = 40;
			height = 40;
			aiStyle = 105;
			defense = 14;
			lifeMax = 1000;
			HitSound = SoundID.DD2_CrystalCartImpact;
			DeathSound = SoundID.NPCDeath15;
			knockBackResist = 0f;
			friendly = true;
			npcSlots = 0f;
			hide = true;
			if (Main.hardMode && downedMechBossAny)
			{
				defense = 18;
				lifeMax = 3000;
			}
			if (downedGolemBoss && Main.hardMode)
			{
				defense = 20;
				lifeMax = 5000;
			}
			if (Main.masterMode)
			{
				lifeMax *= 3;
			}
			else if (Main.expertMode)
			{
				lifeMax *= 2;
			}
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 549)
		{
			lifeMax = 5;
			defense = 20;
			damage = 0;
			width = 78;
			height = 130;
			aiStyle = 106;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 0f;
			knockBackResist = 0f;
			noGravity = true;
			noTileCollide = true;
			npcSlots = 0f;
			behindTiles = true;
			dontTakeDamage = true;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 552)
		{
			lifeMax = 30;
			defense = 14;
			damage = 18;
			width = 18;
			height = 40;
			aiStyle = 107;
			HitSound = SoundID.DD2_GoblinHurt;
			DeathSound = SoundID.DD2_GoblinDeath;
			knockBackResist = 0.2f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 553)
		{
			lifeMax = 170;
			defense = 20;
			damage = 46;
			width = 18;
			height = 40;
			aiStyle = 107;
			HitSound = SoundID.DD2_GoblinHurt;
			DeathSound = SoundID.DD2_GoblinDeath;
			knockBackResist = 0.2f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 554)
		{
			lifeMax = 560;
			defense = 28;
			damage = 70;
			width = 18;
			height = 40;
			aiStyle = 107;
			HitSound = SoundID.DD2_GoblinHurt;
			DeathSound = SoundID.DD2_GoblinDeath;
			knockBackResist = 0.15f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 561)
		{
			lifeMax = 60;
			defense = 18;
			damage = 30;
			width = 26;
			height = 52;
			aiStyle = 107;
			HitSound = SoundID.DD2_JavelinThrowersHurt;
			DeathSound = SoundID.DD2_JavelinThrowersDeath;
			knockBackResist = 0.1f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 562)
		{
			lifeMax = 300;
			defense = 28;
			damage = 60;
			width = 26;
			height = 52;
			aiStyle = 107;
			HitSound = SoundID.DD2_JavelinThrowersHurt;
			DeathSound = SoundID.DD2_JavelinThrowersDeath;
			knockBackResist = 0.1f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 563)
		{
			lifeMax = 1000;
			defense = 38;
			damage = 80;
			width = 26;
			height = 52;
			aiStyle = 107;
			HitSound = SoundID.DD2_JavelinThrowersHurt;
			DeathSound = SoundID.DD2_JavelinThrowersDeath;
			knockBackResist = 0.05f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 555)
		{
			lifeMax = 50;
			defense = 16;
			damage = 26;
			width = 18;
			height = 40;
			aiStyle = 107;
			HitSound = SoundID.DD2_GoblinBomberHurt;
			DeathSound = SoundID.DD2_GoblinBomberDeath;
			knockBackResist = 0.2f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 556)
		{
			lifeMax = 200;
			defense = 26;
			damage = 55;
			width = 18;
			height = 40;
			aiStyle = 107;
			HitSound = SoundID.DD2_GoblinBomberHurt;
			DeathSound = SoundID.DD2_GoblinBomberDeath;
			knockBackResist = 0.2f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 557)
		{
			lifeMax = 700;
			defense = 34;
			damage = 75;
			width = 18;
			height = 40;
			aiStyle = 107;
			HitSound = SoundID.DD2_GoblinBomberHurt;
			DeathSound = SoundID.DD2_GoblinBomberDeath;
			knockBackResist = 0.15f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 558)
		{
			width = 38;
			height = 38;
			aiStyle = 108;
			damage = 30;
			defense = 4;
			lifeMax = 60;
			HitSound = SoundID.DD2_WyvernHurt;
			DeathSound = SoundID.DD2_WyvernDeath;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0.2f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 559)
		{
			width = 38;
			height = 38;
			aiStyle = 108;
			damage = 75;
			defense = 16;
			lifeMax = 180;
			HitSound = SoundID.DD2_WyvernHurt;
			DeathSound = SoundID.DD2_WyvernDeath;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0.2f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 560)
		{
			width = 38;
			height = 38;
			aiStyle = 108;
			damage = 100;
			defense = 30;
			lifeMax = 600;
			HitSound = SoundID.DD2_WyvernHurt;
			DeathSound = SoundID.DD2_WyvernDeath;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0.05f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 550)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 576)
		{
			lifeMax = 5000;
			defense = 34;
			damage = 70;
			width = 96;
			height = 124;
			aiStyle = 107;
			HitSound = SoundID.DD2_OgreHurt;
			DeathSound = SoundID.DD2_OgreDeath;
			knockBackResist = 0f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 577)
		{
			lifeMax = 13000;
			defense = 40;
			damage = 90;
			width = 96;
			height = 124;
			aiStyle = 107;
			HitSound = SoundID.DD2_OgreHurt;
			DeathSound = SoundID.DD2_OgreDeath;
			knockBackResist = 0f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 568)
		{
			lifeMax = 500;
			defense = 30;
			damage = 50;
			width = 18;
			height = 40;
			aiStyle = 107;
			HitSound = SoundID.DD2_WitherBeastHurt;
			DeathSound = SoundID.DD2_WitherBeastDeath;
			knockBackResist = 0.15f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 569)
		{
			lifeMax = 1400;
			defense = 40;
			damage = 80;
			width = 18;
			height = 40;
			aiStyle = 107;
			HitSound = SoundID.DD2_WitherBeastHurt;
			DeathSound = SoundID.DD2_WitherBeastDeath;
			knockBackResist = 0.05f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 566)
		{
			lifeMax = 25;
			defense = 12;
			damage = 18;
			width = 18;
			height = 40;
			aiStyle = 107;
			HitSound = SoundID.DD2_SkeletonHurt;
			DeathSound = SoundID.DD2_SkeletonDeath;
			knockBackResist = 0.3f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 567)
		{
			lifeMax = 480;
			defense = 22;
			damage = 70;
			width = 18;
			height = 40;
			aiStyle = 107;
			HitSound = SoundID.DD2_SkeletonHurt;
			DeathSound = SoundID.DD2_SkeletonDeath;
			knockBackResist = 0.2f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 572)
		{
			lifeMax = 260;
			defense = 26;
			damage = 60;
			width = 18;
			height = 40;
			aiStyle = 107;
			HitSound = SoundID.DD2_KoboldHurt;
			DeathSound = SoundID.DD2_KoboldDeath;
			knockBackResist = 0.2f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 573)
		{
			lifeMax = 800;
			defense = 32;
			damage = 80;
			width = 18;
			height = 40;
			aiStyle = 107;
			HitSound = SoundID.DD2_KoboldHurt;
			DeathSound = SoundID.DD2_KoboldDeath;
			knockBackResist = 0.1f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 570)
		{
			lifeMax = 900;
			defense = 30;
			damage = 60;
			width = 42;
			height = 58;
			aiStyle = 107;
			HitSound = SoundID.DD2_DrakinHurt;
			DeathSound = SoundID.DD2_DrakinDeath;
			knockBackResist = 0f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 571)
		{
			lifeMax = 3000;
			defense = 40;
			damage = 90;
			width = 42;
			height = 58;
			aiStyle = 107;
			HitSound = SoundID.DD2_DrakinHurt;
			DeathSound = SoundID.DD2_DrakinDeath;
			knockBackResist = 0f;
			value = 0f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 564)
		{
			lifeMax = 800;
			defense = 18;
			damage = 40;
			width = 34;
			height = 62;
			aiStyle = 109;
			HitSound = SoundID.DD2_DarkMageHurt;
			DeathSound = SoundID.DD2_DarkMageDeath;
			knockBackResist = 0f;
			value = 0f;
			npcSlots = 0f;
			noGravity = true;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 565)
		{
			lifeMax = 4000;
			defense = 38;
			damage = 90;
			width = 34;
			height = 62;
			aiStyle = 109;
			HitSound = SoundID.DD2_DarkMageHurt;
			DeathSound = SoundID.DD2_DarkMageDeath;
			knockBackResist = 0f;
			value = 0f;
			npcSlots = 0f;
			noGravity = true;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 574)
		{
			width = 38;
			height = 38;
			aiStyle = 108;
			damage = 50;
			defense = 16;
			lifeMax = 170;
			HitSound = SoundID.DD2_KoboldFlyerHurt;
			DeathSound = SoundID.DD2_KoboldFlyerDeath;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0.4f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 575)
		{
			width = 38;
			height = 38;
			aiStyle = 108;
			damage = 80;
			defense = 32;
			lifeMax = 580;
			HitSound = SoundID.DD2_KoboldFlyerHurt;
			DeathSound = SoundID.DD2_KoboldFlyerDeath;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0.25f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 551)
		{
			damage = 80;
			defense = 38;
			lifeMax = 50000;
			width = 190;
			height = 90;
			aiStyle = 110;
			HitSound = SoundID.DD2_BetsyHurt;
			DeathSound = SoundID.DD2_BetsyDeath;
			knockBackResist = 0f;
			value = 0f;
			noGravity = true;
			noTileCollide = true;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 578)
		{
			width = 30;
			height = 24;
			aiStyle = 111;
			damage = 80;
			defense = 36;
			lifeMax = 500;
			HitSound = SoundID.DD2_LightningBugHurt;
			DeathSound = SoundID.DD2_LightningBugDeath;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0.8f;
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
		}
		else if (type == 579)
		{
			friendly = true;
			width = 34;
			height = 8;
			aiStyle = 0;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.5f;
			scale = 1f;
			rarity = 1;
		}
		else if (type == 582)
		{
			width = 18;
			height = 18;
			aiStyle = 3;
			damage = 10;
			defense = 2;
			lifeMax = 30;
			HitSound = SoundID.NPCHit31;
			DeathSound = SoundID.NPCDeath34;
			knockBackResist = 0.75f;
			value = 40f;
			npcSlots = 0.4f;
		}
		else if (type == 583 || type == 584 || type == 585)
		{
			width = 18;
			height = 20;
			aiStyle = 112;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			switch (type)
			{
			case 583:
				catchItem = 4068;
				break;
			case 584:
				catchItem = 4069;
				break;
			case 585:
				catchItem = 4070;
				break;
			}
			noGravity = true;
			rarity = 2;
		}
		else if (type == 586)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 40;
			defense = 20;
			lifeMax = 400;
			HitSound = SoundID.NPCHit18;
			DeathSound = SoundID.NPCDeath21;
			knockBackResist = 0f;
			value = 1000f;
			alpha = 255;
			rarity = 1;
		}
		else if (type == 587)
		{
			width = 32;
			height = 18;
			aiStyle = 44;
			damage = 35;
			defense = 18;
			lifeMax = 300;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0f;
			DeathSound = SoundID.NPCDeath1;
			value = 1000f;
			alpha = 255;
			rarity = 1;
		}
		else if (type == 588)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 589)
		{
			friendly = true;
			width = 18;
			height = 34;
			aiStyle = 0;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			rarity = 1;
		}
		else if (type == 590 || type == 591)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 14;
			defense = 6;
			lifeMax = 45;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 60f;
		}
		else if (type == 592)
		{
			noGravity = true;
			width = 20;
			height = 18;
			aiStyle = 16;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			catchItem = 4274;
			rarity = 3;
		}
		else if (type == 593)
		{
			width = 18;
			height = 20;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 4274;
			rarity = 3;
		}
		else if (type == 594)
		{
			width = 20;
			height = 20;
			aiStyle = 113;
			damage = 0;
			defense = 0;
			knockBackResist = 0.3f;
			lifeMax = 1;
			DeathSound = SoundID.NPCDeath63;
			value = 0f;
			noGravity = true;
		}
		else if (type >= 595 && type <= 601)
		{
			timeLeft *= 3;
			width = 10;
			height = 10;
			aiStyle = 114;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.25f;
			noGravity = true;
			int num2 = type;
			if (num2 == 601)
			{
				rarity = 3;
			}
			catchItem = (short)(type - 595 + 4334);
		}
		else if (type == 602)
		{
			width = 22;
			height = 26;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 4359;
		}
		else if (type == 603)
		{
			width = 28;
			height = 22;
			aiStyle = 68;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 4359;
		}
		else if (type == 604 || type == 605)
		{
			width = 10;
			height = 10;
			aiStyle = 115;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.25f;
			noGravity = true;
			int num2 = type;
			if (num2 == 605)
			{
				rarity = 3;
			}
			catchItem = (short)(type - 604 + 4361);
		}
		else if (type == 606)
		{
			width = 10;
			height = 4;
			aiStyle = 66;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.1f;
			catchItem = 4363;
			friendly = true;
		}
		else if (type == 607)
		{
			noGravity = true;
			width = 20;
			height = 18;
			aiStyle = 16;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			catchItem = 4373;
		}
		else if (type == 608)
		{
			width = 22;
			height = 26;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 4374;
		}
		else if (type == 609)
		{
			width = 28;
			height = 22;
			aiStyle = 68;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 4374;
		}
		else if (type == 610)
		{
			width = 14;
			height = 12;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath4;
			npcSlots = 0.25f;
			catchItem = 4375;
		}
		else if (type == 611)
		{
			width = 18;
			height = 34;
			aiStyle = 24;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 4395;
			npcSlots = 0.4f;
		}
		else if (type == 612 || type == 613)
		{
			width = 10;
			height = 10;
			aiStyle = 116;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.25f;
			int num2 = type;
			if (num2 == 613)
			{
				rarity = 3;
			}
			catchItem = (short)(type - 612 + 4418);
			waterMovementSpeed = 1f;
			lavaMovementSpeed = 1f;
			honeyMovementSpeed = 1f;
		}
		else if (type == 614)
		{
			width = 18;
			height = 20;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = null;
			catchItem = 1338;
		}
		else if (type == 615)
		{
			noGravity = true;
			width = 20;
			height = 18;
			aiStyle = 16;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 616 || type == 617)
		{
			width = 22;
			height = 20;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			catchItem = (short)(type - 616 + 4464);
		}
		else if (type == 618)
		{
			noGravity = true;
			width = 100;
			height = 100;
			aiStyle = 117;
			damage = 55;
			defense = 24;
			lifeMax = 7000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0f;
			value = Item.buyPrice(0, 2);
			noTileCollide = true;
			rarity = 1;
		}
		else if (type == 619)
		{
			npcSlots = 1f;
			width = 44;
			height = 44;
			aiStyle = 5;
			damage = 60;
			defense = 16;
			lifeMax = 750;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			knockBackResist = 0f;
			value = 500f;
			alpha = 255;
		}
		else if (type == 620)
		{
			lifeMax = 5000;
			defense = 30;
			damage = 70;
			width = 34;
			height = 58;
			aiStyle = 107;
			HitSound = SoundID.DD2_DrakinHurt;
			DeathSound = SoundID.DD2_DrakinDeath;
			knockBackResist = 0f;
			value = Item.buyPrice(0, 0, 75);
			npcSlots = 0f;
			lavaImmune = true;
			LazySetLiquidMovementDD2();
			netAlways = true;
			alpha = 255;
			rarity = 1;
		}
		else if (type == 621)
		{
			npcSlots = 5f;
			width = 28;
			height = 28;
			aiStyle = 6;
			damage = 90;
			defense = 0;
			lifeMax = 6000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			value = Item.buyPrice(0, 0, 75);
			alpha = 255;
			rarity = 1;
		}
		else if (type == 622)
		{
			width = 28;
			height = 28;
			aiStyle = 6;
			netAlways = true;
			damage = 60;
			defense = 30;
			lifeMax = 6000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			dontCountMe = true;
			npcSlots = 0f;
			alpha = 255;
		}
		else if (type == 623)
		{
			width = 28;
			height = 28;
			aiStyle = 6;
			netAlways = true;
			damage = 50;
			defense = 40;
			lifeMax = 6000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			behindTiles = true;
			dontCountMe = true;
			npcSlots = 0f;
			alpha = 255;
		}
		else if (type == 624)
		{
			width = 14;
			height = 30;
			aiStyle = 3;
			damage = 10;
			defense = 0;
			lifeMax = 25;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 1f;
			rarity = 1;
		}
		else if (type == 625)
		{
			width = 22;
			height = 20;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 626 || type == 627)
		{
			width = 16;
			height = 20;
			aiStyle = 118;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 1f;
			int num2 = type;
			if (num2 == 627)
			{
				rarity = 3;
			}
			catchItem = 4480;
			if (type == 627)
			{
				catchItem = 4482;
			}
		}
		else if (type == 628)
		{
			width = 22;
			height = 40;
			aiStyle = 119;
			damage = 15;
			defense = 0;
			lifeMax = 50;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0f;
			value = 50f;
		}
		else if (type == 629)
		{
			width = 24;
			height = 24;
			aiStyle = 25;
			damage = 80;
			defense = 30;
			lifeMax = 500;
			HitSound = SoundID.NPCHit4;
			DeathSound = SoundID.NPCDeath6;
			value = 100000f;
			knockBackResist = 0.3f;
			rarity = 4;
			coldDamage = true;
			if (!Main.hardMode)
			{
				damage = 30;
				defense = 12;
				lifeMax = 300;
				value = Item.buyPrice(0, 2);
			}
		}
		else if (type == 630)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 60;
			defense = 18;
			lifeMax = 180;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.5f;
			value = 700f;
		}
		else if (type == 631)
		{
			width = 36;
			height = 48;
			scale = 1.1f;
			aiStyle = 3;
			damage = 85;
			defense = 35;
			lifeMax = 1000;
			HitSound = SoundID.NPCHit41;
			DeathSound = SoundID.NPCDeath43;
			knockBackResist = 0.1f;
			value = 25000f;
		}
		else if (type == 632)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 14;
			defense = 6;
			lifeMax = 45;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 60f;
		}
		else if (type == 633)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
		}
		else if (type == 634)
		{
			npcSlots = 0.5f;
			width = 22;
			height = 18;
			aiStyle = 14;
			damage = 13;
			defense = 2;
			lifeMax = 16;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath4;
			value = 90f;
		}
		else if (type == 635)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 20;
			defense = 8;
			lifeMax = 60;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.5f;
			value = 100f;
		}
		else if (type == 636)
		{
			noGravity = true;
			width = 100;
			height = 100;
			aiStyle = 120;
			damage = 80;
			defense = 50;
			lifeMax = 70000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath65;
			knockBackResist = 0f;
			value = 250000f;
			noTileCollide = true;
			boss = true;
			Opacity = 0f;
			dontTakeDamage = true;
			npcSlots = 16f;
		}
		else if (type == 637 || type == 638)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 28;
			if (type == 637)
			{
				height = 20;
			}
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.5f;
			housingCategory = 1;
		}
		else if (type >= 639 && type <= 645)
		{
			width = 18;
			height = 20;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = (short)(4831 + (type - 639));
		}
		else if (type >= 646 && type <= 652)
		{
			width = 18;
			height = 20;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			catchItem = (short)(4838 + (type - 646));
		}
		else if (type == 653)
		{
			width = 10;
			height = 10;
			aiStyle = 65;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.25f;
			noGravity = true;
			lavaImmune = true;
			catchItem = 4845;
		}
		else if (type == 654)
		{
			width = 10;
			height = 10;
			aiStyle = 64;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.2f;
			noGravity = true;
			lavaImmune = true;
			catchItem = 4847;
		}
		else if (type == 655)
		{
			width = 14;
			height = 14;
			aiStyle = 67;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.5f;
			noGravity = true;
			lavaImmune = true;
			catchItem = 4849;
		}
		else if (type == 656)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 20;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.5f;
			housingCategory = 1;
		}
		else if (type == 657)
		{
			width = 114;
			height = 100;
			aiStyle = 121;
			damage = 60;
			defense = 26;
			lifeMax = 18000;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath64;
			lavaImmune = true;
			knockBackResist = 0f;
			value = 60000f;
			boss = true;
			npcSlots = 5f;
		}
		else if (type == 658 || type == 659)
		{
			width = 24;
			height = 18;
			aiStyle = 1;
			damage = 40;
			defense = 35;
			lifeMax = 150;
			scale = 1f;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
		}
		else if (type == 660)
		{
			width = 40;
			height = 30;
			aiStyle = 14;
			damage = 50;
			defense = 30;
			lifeMax = 120;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.8f;
			scale = 1f;
		}
		else if (type == 661)
		{
			width = 10;
			height = 10;
			aiStyle = 65;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.25f;
			noGravity = true;
			lavaImmune = true;
			catchItem = 4961;
			rarity = 4;
		}
		else if (type == 662)
		{
			width = 18;
			height = 40;
			aiStyle = 122;
			damage = 75;
			defense = 22;
			lifeMax = 500;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.2f;
			value = 0f;
			noTileCollide = true;
			lavaImmune = true;
			trapImmune = true;
			noGravity = true;
		}
		else if (type == 663)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 40;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.5f;
		}
		else if (type == 664)
		{
			lifeMax = 20;
			boss = true;
		}
		else if (type == 665)
		{
			width = 16;
			height = 16;
			aiStyle = 9;
			damage = 20;
			defense = 0;
			lifeMax = 1;
			HitSound = SoundID.NPCHit3;
			DeathSound = SoundID.NPCDeath3;
			noGravity = true;
			noTileCollide = true;
			alpha = 100;
			knockBackResist = 0f;
		}
		else if (type == 666)
		{
			width = 16;
			height = 16;
			aiStyle = 9;
			damage = 65;
			defense = 0;
			lifeMax = 1;
			HitSound = null;
			DeathSound = SoundID.NPCDeath9;
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			scale = 0.9f;
			alpha = 80;
		}
		else if (type == 667)
		{
			width = 24;
			height = 18;
			aiStyle = 1;
			damage = 5;
			defense = 5;
			lifeMax = 300;
			knockBackResist *= 1.4f;
			rarity = 2;
			scale = 1f;
			value = Item.buyPrice(0, 15);
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
		}
		else if (type == 668)
		{
			width = 60;
			height = 154;
			aiStyle = 123;
			damage = 20;
			defense = 10;
			lifeMax = 7000;
			HitSound = SoundID.DeerclopsHit;
			DeathSound = SoundID.DeerclopsDeath;
			knockBackResist = 0f;
			boss = true;
			noGravity = true;
			noTileCollide = true;
			value = Item.buyPrice(0, 5);
			npcSlots = 10f;
			coldDamage = true;
		}
		else if (type == 669)
		{
			width = 10;
			height = 10;
			aiStyle = 115;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.25f;
			noGravity = true;
			catchItem = 5132;
		}
		else if (type == 670)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 20;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.5f;
			housingCategory = 1;
		}
		else if (type == 671)
		{
			width = 14;
			height = 14;
			aiStyle = 24;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 5212;
			npcSlots = 1f;
		}
		else if (type == 672)
		{
			width = 14;
			height = 14;
			aiStyle = 24;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 5300;
			npcSlots = 1f;
		}
		else if (type == 673)
		{
			width = 14;
			height = 14;
			aiStyle = 24;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 5311;
			npcSlots = 1f;
		}
		else if (type == 674)
		{
			width = 14;
			height = 14;
			aiStyle = 24;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 5312;
			npcSlots = 1f;
		}
		else if (type == 675)
		{
			width = 14;
			height = 14;
			aiStyle = 24;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath1;
			catchItem = 5313;
			npcSlots = 1f;
		}
		else if (type == 676)
		{
			width = 24;
			height = 18;
			aiStyle = 1;
			damage = 20;
			defense = 5;
			lifeMax = 80;
			scale = 1f;
			value = Item.buyPrice(0, 0, 1, 50);
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
		}
		else if (type == 677)
		{
			width = 10;
			height = 10;
			aiStyle = 64;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.2f;
			noGravity = true;
			catchItem = 5350;
			noTileCollide = true;
		}
		else if (type == 678 || type == 679 || type == 680 || type == 681 || type == 682 || type == 683 || type == 684)
		{
			townNPC = true;
			friendly = true;
			width = 18;
			height = 20;
			aiStyle = 7;
			damage = 10;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			knockBackResist = 0.5f;
			housingCategory = 1;
		}
		else if (type == 685)
		{
			width = 30;
			height = 28;
			aiStyle = 1;
			damage = 0;
			defense = 10;
			knockBackResist = 0.3f;
			lifeMax = 250;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			value = 0f;
			rarity = 2;
			friendly = true;
		}
		else if (type == 686)
		{
			width = 20;
			height = 20;
			aiStyle = 125;
			damage = 0;
			defense = 0;
			knockBackResist = 0.3f;
			lifeMax = 1;
			DeathSound = SoundID.NPCDeath63;
			value = 0f;
			rarity = 2;
			noGravity = true;
			noTileCollide = true;
			dontTakeDamageFromHostiles = true;
		}
		else if (type == 687)
		{
			width = 18;
			height = 20;
			aiStyle = 7;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			rarity = 2;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath6;
			catchItem = 2121;
		}
		else if (type == 688)
		{
			noGravity = true;
			width = 32;
			height = 16;
			aiStyle = 16;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			knockBackResist = 0.5f;
			catchItem = 5511;
		}
		else if (type == 689)
		{
			width = 18;
			height = 34;
			aiStyle = 24;
			damage = 0;
			defense = 0;
			lifeMax = 5;
			HitSound = SoundID.NPCHit1;
			knockBackResist = 0.8f;
			DeathSound = SoundID.NPCDeath1;
			npcSlots = 0.4f;
		}
		else if (type == 690)
		{
			lavaImmune = true;
			immortal = true;
			dontTakeDamage = true;
			width = 28;
			height = 38;
			aiStyle = 126;
			damage = 40;
			defense = 10;
			lifeMax = 400;
			HitSound = SoundID.NPCHit58;
			DeathSound = SoundID.NPCDeath67;
			knockBackResist = 0f;
			npcSlots = 0f;
		}
		else if (type == 691)
		{
			width = 18;
			height = 40;
			aiStyle = 3;
			damage = 18;
			defense = 10;
			lifeMax = 60;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.45f;
			value = 80f;
		}
		else if (type == 692)
		{
			noGravity = true;
			width = 120;
			height = 34;
			aiStyle = 16;
			damage = 50;
			defense = 20;
			lifeMax = 400;
			HitSound = SoundID.NPCHit1;
			DeathSound = SoundID.NPCDeath1;
			value = 10000f;
			knockBackResist = 0.7f;
		}
		else if (type == 693)
		{
			width = 18;
			height = 40;
			aiStyle = 8;
			damage = 18;
			defense = 2;
			lifeMax = 70;
			HitSound = SoundID.NPCHit2;
			DeathSound = SoundID.NPCDeath2;
			knockBackResist = 0.6f;
			value = 160f;
			npcSlots = 2f;
		}
		else if (type == 694)
		{
			width = 44;
			height = 44;
			aiStyle = 10;
			damage = 20;
			defense = 4;
			lifeMax = 60;
			HitSound = SoundID.DD2_BookStaffCast;
			DeathSound = SoundID.NPCDeath52;
			noGravity = true;
			noTileCollide = true;
			value = 150f;
			knockBackResist = 0.2f;
		}
		else if (type == 695)
		{
			friendly = true;
			width = 18;
			height = 18;
			aiStyle = 127;
			damage = 0;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.PalCattivaPain;
			DeathSound = SoundID.PalCattivaPain;
			knockBackResist = 0.5f;
			rarity = 1;
		}
		else if (type == 696)
		{
			friendly = true;
			width = 18;
			height = 18;
			aiStyle = 127;
			damage = 0;
			defense = 15;
			lifeMax = 250;
			HitSound = SoundID.PalFoxparksPain;
			DeathSound = SoundID.PalFoxparksPain;
			knockBackResist = 0.5f;
			rarity = 1;
		}
		if (Main.dedServ)
		{
			frame = default(Rectangle);
		}
		else if (TextureAssets.Npc[type] != null && TextureAssets.Npc[type].IsLoaded)
		{
			frame = new Rectangle(0, 0, TextureAssets.Npc[type].Width(), TextureAssets.Npc[type].Height() / Main.npcFrameCount[type]);
		}
		else
		{
			setFrameSize = true;
		}
		if (spawnparams.sizeScaleOverride.HasValue)
		{
			int num3 = (int)((float)width * scale);
			int num4 = (int)((float)height * scale);
			position.X += num3 / 2;
			position.Y += num4;
			scale = spawnparams.sizeScaleOverride.Value;
			width = (int)((float)width * scale);
			height = (int)((float)height * scale);
			if (height == 16 || height == 32)
			{
				height++;
			}
			position.X -= width / 2;
			position.Y -= height;
		}
		else
		{
			width = (int)((float)width * scale);
			height = (int)((float)height * scale);
		}
		life = lifeMax;
		defDamage = damage;
		defDefense = defense;
		defLifeMax = lifeMax;
		netID = type;
		if (NPCID.Sets.DebuffImmunitySets.TryGetValue(type, out var nPCDebuffImmunityData) && nPCDebuffImmunityData != null)
		{
			nPCDebuffImmunityData.ApplyToNPC(this);
		}
		else
		{
			for (int m = 0; m < buffImmune.Length; m++)
			{
				buffImmune[m] = false;
			}
		}
		if (buffImmune[20])
		{
			buffImmune[30] = true;
			buffImmune[375] = buffImmune[30];
		}
		if (buffImmune[69])
		{
			buffImmune[36] = true;
		}
		buffImmune[353] = NPCID.Sets.ShimmerImmunity[type];
		if (Main.zenithWorld)
		{
			getZenithSeedAdjustmentsBeforeEverything();
		}
		if (Main.getGoodWorld)
		{
			getGoodAdjustments();
		}
		else if (Main.tenthAnniversaryWorld)
		{
			getTenthAnniversaryAdjustments();
		}
		if (type >= 0 && type < NPCID.Count && Main.npcCatchable[type])
		{
			catchableNPCTempImmunityCounter = 90;
			friendly = true;
		}
		ScaleStats(spawnparams.playerCountForMultiplayerDifficultyOverride, spawnparams.difficultyOverride);
		life = lifeMax;
	}

	private void getTenthAnniversaryAdjustments()
	{
		float num = scale;
		float num2 = 0.5f;
		switch (type)
		{
		case 4:
			scale *= num2;
			break;
		case 13:
		case 14:
		case 15:
			scale *= num2;
			break;
		case 266:
		case 267:
			scale *= num2;
			break;
		case 35:
		case 36:
			scale *= num2;
			break;
		case 222:
			scale *= num2;
			break;
		case 113:
		case 114:
		case 115:
		case 116:
			scale *= num2;
			break;
		case 134:
		case 135:
		case 136:
		case 139:
			scale *= num2;
			break;
		case 125:
		case 126:
			scale *= num2;
			break;
		case 127:
		case 128:
		case 129:
		case 130:
		case 131:
			scale *= num2;
			break;
		case 370:
			scale *= num2;
			break;
		case 636:
			scale *= num2;
			break;
		case 422:
		case 493:
		case 507:
		case 517:
			scale *= num2;
			break;
		}
		if (IsABestiaryIconDummy)
		{
			scale = num;
			return;
		}
		width = (int)((float)width * scale);
		height = (int)((float)height * scale);
	}

	private void getZenithSeedAdjustmentsBeforeEverything()
	{
		int num = type;
		if ((uint)(num - 125) <= 6u || num == 139)
		{
			lifeMax = (int)((float)lifeMax * 0.8f);
		}
	}

	private void getGoodAdjustments()
	{
		float num = scale;
		if (type == 13)
		{
			scale *= 1.35f;
			defense += 2;
		}
		else if (type == 14)
		{
			scale *= 1.4f;
			defense += 2;
		}
		else if (type == 15)
		{
			scale *= 1.4f;
			defense += 2;
		}
		else if (type == 40 || type == 39 || type == 41)
		{
			lifeMax += 100;
			defense += 2;
			damage += 4;
			scale = 1.1f;
			if (Main.remixWorld)
			{
				lifeMax += 50;
				scale *= 1.2f;
				defense += 4;
			}
		}
		else if (type == 35)
		{
			scale *= 1.25f;
		}
		else if (type == 36)
		{
			scale *= 1.15f;
		}
		else if (type == 113)
		{
			scale *= 0.65f;
			lifeMax = (int)((double)lifeMax * 1.5);
			defense += 3;
		}
		else if (type == 114)
		{
			scale *= 0.65f;
			lifeMax = (int)((double)lifeMax * 1.5);
			defense += 3;
		}
		else if (type == 115)
		{
			scale *= 1.4f;
		}
		else if (type == 116)
		{
			scale *= 1.4f;
		}
		else if (type == 118)
		{
			damage += 10;
			defense += 14;
			lifeMax *= 3;
		}
		else if (type == 222)
		{
			scale *= 1.2f;
		}
		else if (type == 245)
		{
			canDisplayBuffs = false;
			scale *= 0.5f;
		}
		else if (type == 246)
		{
			canDisplayBuffs = false;
			scale *= 0.5f;
		}
		else if (type == 247 || type == 248)
		{
			canDisplayBuffs = false;
			scale *= 0.5f;
		}
		else if (type == 249)
		{
			scale *= 0.5f;
		}
		else if (type == 262)
		{
			scale *= 1.3f;
		}
		else if (type == 266)
		{
			defense = (int)((double)defense * 1.5);
			damage = (int)((double)damage * 1.2);
			scale *= 1.1f;
		}
		else if (type == 125)
		{
			scale *= 0.8f;
		}
		else if (type == 126)
		{
			scale *= 0.8f;
		}
		else if (type == 127)
		{
			scale *= 1.1f;
		}
		else if (type == 128)
		{
			scale *= 1.1f;
		}
		else if (type == 129)
		{
			scale *= 1.1f;
		}
		else if (type == 130)
		{
			scale *= 1.1f;
		}
		else if (type == 131)
		{
			scale *= 1.1f;
		}
		else if (type == 134)
		{
			scale *= 1.3f;
		}
		else if (type == 135)
		{
			scale *= 1.3f;
		}
		else if (type == 136)
		{
			scale *= 1.3f;
		}
		else
		{
			if (type != 139)
			{
				return;
			}
			scale *= 1.6f;
		}
		if (IsABestiaryIconDummy)
		{
			scale = num;
			return;
		}
		width = (int)((float)width * scale);
		height = (int)((float)height * scale);
	}

	private void LazySetLiquidMovementDD2()
	{
		waterMovementSpeed = 1f;
		lavaMovementSpeed = 1f;
		honeyMovementSpeed = 1f;
		shimmerMovementSpeed = 1f;
	}

	public static void SetWorldSpecificMonstersByWorldID()
	{
		UnifiedRandom unifiedRandom = new UnifiedRandom(Main.worldID);
		int num = unifiedRandom.Next(3);
		int num2 = unifiedRandom.Next(3);
		while (num == num2)
		{
			num = unifiedRandom.Next(3);
		}
		for (int i = 0; i < 2; i++)
		{
			int num3 = num;
			if (i == 1)
			{
				num3 = num2;
			}
			for (int j = 0; j < 3; j++)
			{
				switch (num3)
				{
				case 0:
					cavernMonsterType[i, j] = unifiedRandom.Next(494, 496);
					break;
				case 1:
					cavernMonsterType[i, j] = unifiedRandom.Next(496, 498);
					break;
				default:
					cavernMonsterType[i, j] = unifiedRandom.Next(498, 507);
					break;
				}
			}
		}
	}

	public NPCSpawnParams GetMatchingSpawnParams()
	{
		return new NPCSpawnParams
		{
			sizeScaleOverride = scale,
			playerCountForMultiplayerDifficultyOverride = statsAreScaledForThisManyPlayers,
			difficultyOverride = difficulty
		};
	}

	public void ScaleStats(int? activePlayersCount, float? strengthOverride)
	{
		if (NPCID.Sets.NeedsExpertScaling[type] || (lifeMax > 5 && damage != 0 && !friendly && !townNPC))
		{
			difficulty = (strengthOverride.HasValue ? strengthOverride.Value : Main.Difficulty);
			if (difficulty >= GameDifficultyLevel.Expert && Main.hardMode)
			{
				ScaleStats_ForExpertHardmode();
			}
			ScaleStats_ByDifficulty();
			if (difficulty >= GameDifficultyLevel.Expert)
			{
				ScaleStats_ByPlayerCount(activePlayersCount.HasValue ? activePlayersCount.Value : GetActivePlayerCount());
			}
			if ((type < 0 || !NPCID.Sets.ProjectileNPC[type]) && lifeMax < 6)
			{
				lifeMax = 6;
			}
			life = lifeMax;
			defDamage = damage;
			defDefense = defense;
			defLifeMax = lifeMax;
		}
	}

	public void ScaleStats_ByDifficulty()
	{
		if (type < 0 || !NPCID.Sets.ProjectileNPC[type])
		{
			lifeMax = (int)((float)lifeMax * GameDifficultyData.EnemyMaxLifeMultiplier.Sample(difficulty));
			value = (int)(value * GameDifficultyData.EnemyMoneyDropMultiplier.Sample(difficulty));
		}
		damage = GetAttackDamage_ScaledByDifficulty(damage);
		knockBackResist = GetKnockbackMultiplier_ScaledByDifficulty(knockBackResist);
		ScaleStats_ByDifficulty_Tweaks();
	}

	private void ScaleStats_ByDifficulty_Tweaks()
	{
		double num = 1.0;
		double num2 = 1.0;
		double num3 = 1.0;
		if (Main.getGoodWorld)
		{
			if (type == 6 && AnyNPCs(13))
			{
				num3 *= CommonMasterBossLifeReduction;
				num2 *= 1.5;
				if (difficulty >= GameDifficultyLevel.Expert)
				{
					defense += 2;
				}
			}
			if (type == 32 && AnyNPCs(35))
			{
				num3 *= CommonMasterBossLifeReduction;
				num2 *= 1.5;
				if (difficulty >= GameDifficultyLevel.Expert)
				{
					defense += 6;
				}
			}
			if (type == 24 && AnyNPCs(113))
			{
				num3 *= CommonMasterBossLifeReduction;
				num2 *= 1.5;
				if (difficulty >= GameDifficultyLevel.Expert)
				{
					defense += 10;
				}
			}
		}
		if (type == 210 || type == 211)
		{
			num2 = 0.6000000000000001;
			num = 0.6;
			defense = (int)((float)defense * Utils.Remap(difficulty, GameDifficultyLevel.Classic, GameDifficultyLevel.Expert, 1f, 0.8f));
		}
		else if (type == 5)
		{
			num2 = 0.75;
			num3 *= CommonMasterBossLifeReduction;
		}
		else if (type == 4)
		{
			num2 = 0.65;
			num3 *= CommonMasterBossLifeReduction;
		}
		else if (type >= 13 && type <= 15)
		{
			num2 = 0.7;
			num3 *= CommonMasterBossLifeReduction;
			if (type == 13)
			{
				num *= 1.1;
			}
			if (type == 14)
			{
				num *= 0.8;
			}
			if (type == 15)
			{
				num *= 0.8;
			}
			if (difficulty >= GameDifficultyLevel.Expert)
			{
				scale *= 1.2f;
				defense += 2;
			}
		}
		else if (type == 266 || type == 267)
		{
			num2 = 0.85;
			num3 *= CommonMasterBossLifeReduction;
			num *= 0.9;
			if (difficulty >= GameDifficultyLevel.Expert)
			{
				scale *= 1.05f;
			}
		}
		else if (type == 50)
		{
			num2 = 0.7;
			num3 *= CommonMasterBossLifeReduction;
			num *= 0.8;
		}
		else if (type == 471)
		{
			num2 = 0.85;
		}
		else if (type == 472)
		{
			num2 = 0.85;
			num = 0.8;
		}
		else if (type == 492)
		{
			num2 = 0.85;
		}
		else if (type == 393 || type == 394 || type == 395)
		{
			num2 = 0.85;
		}
		else if (type == 222)
		{
			num2 = 0.7;
			num3 *= CommonMasterBossLifeReduction;
			num = 0.9;
		}
		else if (type == 35)
		{
			num3 *= CommonMasterBossLifeReduction;
			num = 1.1;
		}
		else if (type == 36)
		{
			num2 = 1.3;
			num3 *= CommonMasterBossLifeReduction;
			num = 1.1;
		}
		else if (type == 668)
		{
			num2 = 0.85;
			num3 *= CommonMasterBossLifeReduction;
		}
		else if (type == 113 || type == 114)
		{
			num2 = 0.7;
			num3 *= CommonMasterBossLifeReduction;
			num = 1.5;
			if (difficulty >= GameDifficultyLevel.Expert)
			{
				defense += 6;
			}
		}
		else if (type == 115)
		{
			num2 = 0.7;
			if (difficulty >= GameDifficultyLevel.Expert)
			{
				defense += 6;
			}
		}
		else if (type == 116)
		{
			num2 = 0.7;
		}
		else if (type == 117 || type == 118 || type == 119)
		{
			num2 = 0.8;
		}
		else if (type == 657)
		{
			num2 = 0.8;
			num3 *= CommonMasterBossLifeReduction;
		}
		else if (type >= 658 && type <= 660)
		{
			num2 = 0.75;
			num3 *= CommonMasterBossLifeReduction;
		}
		else if (type >= 134 && type <= 136)
		{
			num2 = 0.75;
			num3 *= CommonMasterBossLifeReduction;
			if (type == 134)
			{
				num *= 2.0;
			}
			if (type == 135)
			{
				num *= 0.85;
			}
			if (type == 136)
			{
				num *= 0.85;
			}
			if (difficulty >= GameDifficultyLevel.Expert)
			{
				scale *= 1.05f;
			}
		}
		else if (type == 139)
		{
			num2 = 0.75;
			num = 0.8;
			if (difficulty >= GameDifficultyLevel.Expert)
			{
				scale *= 1.05f;
			}
		}
		else if (type >= 127 && type <= 131)
		{
			num2 = 0.75;
			num3 *= CommonMasterBossLifeReduction;
			num = 0.85;
		}
		else if (type >= 125 && type <= 126)
		{
			num2 = 0.75;
			num3 *= CommonMasterBossLifeReduction;
			num = 0.85;
		}
		else if (type == 262)
		{
			num2 = 0.7;
			num3 *= CommonMasterBossLifeReduction;
			num = 1.15;
		}
		else if (type == 264)
		{
			num3 *= CommonMasterBossLifeReduction;
			num = 1.15;
		}
		else if (type == 636)
		{
			num2 = 0.7;
			num3 *= CommonMasterBossLifeReduction;
		}
		else if (type >= 245 && type <= 249)
		{
			num2 = 0.75;
			num3 *= CommonMasterBossLifeReduction;
			num = 0.8;
		}
		else if (type == 370)
		{
			num2 = 0.65;
			num3 *= CommonMasterBossLifeReduction;
			num = 0.7;
		}
		else if (type == 371 || type == 372 || type == 373)
		{
			if (type != 371)
			{
				num2 = 0.75;
			}
			num = 0.75;
		}
		else if (type == 439 || type == 440 || (type >= 454 && type <= 459) || type == 522 || type == 523)
		{
			if (type != 522)
			{
				num2 = 0.75;
				num3 *= CommonMasterBossLifeReduction;
			}
			num = 0.75;
		}
		else if (type == 397 || type == 396 || type == 398)
		{
			num2 = 0.75;
			num3 *= CommonMasterBossLifeReduction;
			num = 0.75;
		}
		else if (type == 551)
		{
			num2 = 0.75;
			num3 *= CommonMasterBossLifeReduction;
			num = 0.65;
		}
		else if (NPCID.Sets.BelongsToInvasionOldOnesArmy[type])
		{
			num3 *= CommonMasterBossLifeReduction;
		}
		int nPCInvasionGroup = GetNPCInvasionGroup(type);
		if (nPCInvasionGroup == -2 || nPCInvasionGroup == -1)
		{
			switch (type)
			{
			case 315:
			case 325:
			case 327:
			case 344:
			case 345:
			case 346:
				num2 = 0.65;
				num3 *= CommonMasterBossLifeReduction;
				num = 0.75;
				break;
			default:
				num2 = 0.75;
				num = 0.75;
				break;
			}
		}
		float num4 = 1f;
		num4 *= Utils.Remap(difficulty, GameDifficultyLevel.Classic, GameDifficultyLevel.Expert, 1f, (float)num2);
		num4 *= Utils.Remap(difficulty, GameDifficultyLevel.Expert, GameDifficultyLevel.Master, 1f, (float)num3);
		lifeMax = (int)Math.Round((float)lifeMax * num4);
		float num5 = 1f;
		num5 *= Utils.Remap(difficulty, GameDifficultyLevel.Classic, GameDifficultyLevel.Expert, 1f, (float)num);
		damage = (int)Math.Round((float)damage * num5);
	}

	public static float GetBalance()
	{
		GetStatScalingFactors(GetActivePlayerCount(), out var balance, out var _);
		return balance;
	}

	public float GetMyBalance()
	{
		if (statsAreScaledForThisManyPlayers <= 1)
		{
			return 1f;
		}
		GetStatScalingFactors(statsAreScaledForThisManyPlayers, out var balance, out var _);
		return balance;
	}

	public static int GetActivePlayerCount()
	{
		if (Main.netMode == 0)
		{
			return 1;
		}
		int num = 0;
		for (int i = 0; i < 255; i++)
		{
			if (Main.player[i] != null && Main.player[i].active && !Main.player[i].ghost)
			{
				num++;
			}
		}
		return num;
	}

	private void ScaleStats_ForExpertHardmode()
	{
		bool flag = type >= 0 && NPCID.Sets.ProjectileNPC[type];
		bool flag2 = !NPCID.Sets.DontDoHardmodeScaling[type];
		if (Main.getGoodWorld)
		{
			if ((type == 24 || type == 25) && AnyNPCs(113))
			{
				flag2 = false;
			}
			if ((type == 32 || type == 33) && AnyNPCs(35))
			{
				flag2 = false;
			}
			if (type == 6 && AnyNPCs(13))
			{
				flag2 = false;
			}
		}
		if (boss || lifeMax >= 1000)
		{
			flag2 = false;
		}
		if (!flag2)
		{
			return;
		}
		int num = damage + defense + lifeMax / 4;
		if (num == 0)
		{
			num = 1;
		}
		int num2 = 80;
		if (downedPlantBoss)
		{
			num2 += 20;
		}
		if (num < num2)
		{
			float num3 = num2 / num;
			damage = (int)((float)damage * num3 * 0.9f);
			if (!flag)
			{
				defense = (int)((float)defense * num3);
				lifeMax = (int)((double)((float)lifeMax * num3) * 1.1);
				value = (int)((double)(value * num3) * 0.8);
			}
		}
	}

	private void ScaleStats_ByPlayerCount(int numPlayers)
	{
		statsAreScaledForThisManyPlayers = numPlayers;
		GetStatScalingFactors(numPlayers, out var balance, out var boost);
		double num = 1.0;
		if (type == 4)
		{
			num *= (double)balance;
		}
		if (type >= 13 && type <= 15)
		{
			num *= (double)balance;
		}
		if (type == 266 || type == 267)
		{
			num *= (double)balance;
			for (float num2 = 1f; num2 < balance; num2 += 0.34f)
			{
				if ((double)knockBackResist < 0.1)
				{
					knockBackResist = 0f;
					break;
				}
				knockBackResist *= 0.8f;
			}
		}
		if (type == 50)
		{
			num *= (double)balance;
		}
		if (type == 471)
		{
			num *= Utils.Lerp(1.0, balance, 2.0 / 3.0);
		}
		if (type == 472)
		{
			num *= Utils.Lerp(1.0, balance, 0.5);
		}
		if (type == 222)
		{
			num *= (double)balance;
		}
		if (type == 35)
		{
			num *= (double)balance;
		}
		else if (type == 36)
		{
			num *= (double)balance;
		}
		if (type == 668)
		{
			num *= (double)balance;
		}
		if (type == 113 || type == 114)
		{
			num *= (double)balance;
		}
		else if (type == 115)
		{
			num *= (double)balance;
			if (numPlayers > 4)
			{
				knockBackResist = 0f;
			}
			else if (numPlayers > 1)
			{
				knockBackResist *= 1f - boost;
			}
		}
		else if (type == 116)
		{
			num *= (double)balance;
			if (numPlayers > 4)
			{
				knockBackResist = 0f;
			}
			else if (numPlayers > 1)
			{
				knockBackResist *= 1f - boost;
			}
		}
		if (type == 657)
		{
			num *= (double)balance;
		}
		if (type >= 658 && type <= 660)
		{
			num *= (double)balance;
		}
		if (type >= 134 && type <= 136)
		{
			num *= (double)balance;
		}
		else if (type == 139)
		{
			num *= Utils.Lerp(1.0, balance, 2.0 / 3.0);
		}
		if (type >= 127 && type <= 131)
		{
			num *= (double)balance;
		}
		if (type >= 125 && type <= 126)
		{
			num *= (double)balance;
		}
		if (type == 262)
		{
			num *= (double)balance;
		}
		else if (type == 264)
		{
			num *= (double)balance;
		}
		if (type == 636)
		{
			num *= (double)balance;
		}
		if (type >= 245 && type <= 249)
		{
			num *= (double)balance;
		}
		if (type == 370)
		{
			num *= (double)balance;
		}
		if (type == 439 || type == 440 || (type >= 454 && type <= 459) || type == 523)
		{
			num *= (double)balance;
		}
		if (type == 397 || type == 396 || type == 398)
		{
			num *= (double)balance;
		}
		if (type == 551)
		{
			num *= (double)balance;
		}
		else if (NPCID.Sets.BelongsToInvasionOldOnesArmy[type])
		{
			num *= Utils.Lerp(1.0, balance, 0.8571428656578064);
		}
		int nPCInvasionGroup = GetNPCInvasionGroup(type);
		if (nPCInvasionGroup == -2 || nPCInvasionGroup == -1)
		{
			switch (type)
			{
			default:
				num *= 1.0 + (double)(numPlayers - 1) * 0.2;
				break;
			case 315:
			case 325:
			case 327:
			case 344:
			case 345:
			case 346:
				break;
			}
		}
		lifeMax = (int)Math.Round((double)lifeMax * num);
	}

	public static void GetStatScalingFactors(int numPlayers, out float balance, out float boost)
	{
		balance = 1f;
		boost = 0.35f;
		for (int i = 1; i < numPlayers; i++)
		{
			balance += boost;
			boost += (1f - boost) / 3f;
		}
		if (balance > 8f)
		{
			balance = (balance * 2f + 8f) / 3f;
		}
		if (balance > 1000f)
		{
			balance = 1000f;
		}
	}

	public static bool GetNPCLocation(int i, bool seekHead, bool averageDirection, out int index, out Vector2 pos)
	{
		int num = Main.npc[i].type;
		int num2 = -1;
		int num3 = -1;
		switch (num)
		{
		case 13:
			num3 = 15;
			num2 = 0;
			break;
		case 14:
		case 15:
			num3 = 13;
			num2 = 1;
			break;
		case 134:
			num3 = 136;
			num2 = 0;
			break;
		case 135:
		case 136:
			num3 = 134;
			num2 = 1;
			break;
		case 454:
			num3 = 459;
			num2 = 0;
			break;
		case 455:
		case 456:
		case 457:
		case 458:
		case 459:
			num3 = 454;
			num2 = 1;
			break;
		case 98:
			num3 = 100;
			num2 = 0;
			break;
		case 99:
		case 100:
			num3 = 98;
			num2 = 1;
			break;
		case 39:
			num3 = 41;
			num2 = 0;
			break;
		case 40:
		case 41:
			num3 = 39;
			num2 = 1;
			break;
		case 510:
			num3 = 512;
			num2 = 0;
			break;
		case 511:
		case 512:
			num3 = 510;
			num2 = 1;
			break;
		case 621:
			num3 = 623;
			num2 = 0;
			break;
		case 622:
		case 623:
			num3 = 621;
			num2 = 1;
			break;
		case 513:
			num3 = 515;
			num2 = 0;
			break;
		case 514:
		case 515:
			num3 = 513;
			num2 = 1;
			break;
		case 87:
			num3 = 92;
			num2 = 0;
			break;
		case 88:
		case 89:
		case 90:
		case 91:
		case 92:
			num3 = 87;
			num2 = 1;
			break;
		case 117:
			num3 = 119;
			num2 = 0;
			break;
		case 118:
		case 119:
			num3 = 117;
			num2 = 1;
			break;
		case 7:
			num3 = 9;
			num2 = 0;
			break;
		case 8:
		case 9:
			num3 = 7;
			num2 = 1;
			break;
		case 95:
			num3 = 97;
			num2 = 0;
			break;
		case 96:
		case 97:
			num3 = 95;
			num2 = 1;
			break;
		case 10:
			num3 = 12;
			num2 = 0;
			break;
		case 11:
		case 12:
			num3 = 10;
			num2 = 1;
			break;
		}
		if (num2 != -1)
		{
			if (seekHead && num2 == 1)
			{
				index = -1;
				pos = Vector2.Zero;
				return false;
			}
			Vector2 center = Main.npc[i].Center;
			int num4 = -1;
			float num5 = -1f;
			int num6 = -1;
			Vector2 center2 = Main.player[Main.myPlayer].Center;
			int num7 = (int)Main.npc[i].ai[num2];
			int num8 = 0;
			while (num7 >= 0 && num7 < Main.maxNPCs && ++num8 < Main.maxNPCs / 2 && Main.npc[num7].active)
			{
				if (!averageDirection && (num6 == -1 || Main.npc[num7].Distance(center2) < num5))
				{
					num5 = Main.npc[num7].Distance(center2);
					num6 = num7;
				}
				if (Main.npc[num7].type == num3)
				{
					num4 = num7;
					break;
				}
				num7 = (int)Main.npc[num7].ai[num2];
			}
			if (num4 >= 0)
			{
				if (!averageDirection)
				{
					pos = Main.npc[num6].Center;
					index = num6;
				}
				else
				{
					center += Main.npc[num4].Center;
					pos = center / 2f;
					index = num4;
				}
				return true;
			}
			pos = Vector2.Zero;
			index = -1;
			return false;
		}
		pos = Main.npc[i].Center;
		index = i;
		return true;
	}

	public void PopAllAttachedProjectilesAndTakeDamageForThem()
	{
		bool[] isAnNPCAttachedExplosive = ProjectileID.Sets.IsAnNPCAttachedExplosive;
		for (int i = 0; i < 1000; i++)
		{
			Projectile projectile = Main.projectile[i];
			if (projectile.active && projectile.owner == Main.myPlayer && isAnNPCAttachedExplosive[projectile.type] && projectile.IsAttachedTo(this))
			{
				projectile.Kill();
			}
		}
	}

	public bool AI_AttemptToFindTeleportSpot(ref Vector2 chosenTile, int targetTileX, int targetTileY, int rangeFromTargetTile = 20, int telefragPreventionDistanceInTiles = 5, int solidTileCheckFluff = 1, bool solidTileCheckCentered = false, bool teleportInAir = false)
	{
		int num = (int)base.Center.X / 16;
		int num2 = (int)base.Center.Y / 16;
		int num3 = 0;
		bool flag = false;
		float num4 = 20f;
		if (Math.Abs(num * 16 - targetTileX * 16) + Math.Abs(num2 * 16 - targetTileY * 16) > 2000)
		{
			num3 = 100;
			flag = false;
		}
		while (!flag && num3 < 100)
		{
			num3++;
			int num5 = Main.rand.Next(targetTileX - rangeFromTargetTile, targetTileX + rangeFromTargetTile + 1);
			for (int i = Main.rand.Next(targetTileY - rangeFromTargetTile, targetTileY + rangeFromTargetTile + 1); i < targetTileY + rangeFromTargetTile; i++)
			{
				if ((i >= num2 - 1 && i <= num2 + 1 && num5 >= num - 1 && num5 <= num + 1) || (!teleportInAir && !Main.tile[num5, i].nactive()))
				{
					continue;
				}
				bool flag2 = true;
				if ((type == 32 || (type >= 281 && type <= 286)) && !Main.wallDungeon[Main.tile[num5, i - 1].wall])
				{
					if (!AnyNPCs(35))
					{
						flag2 = false;
					}
				}
				else if (Main.tile[num5, i - 1].lava())
				{
					flag2 = false;
				}
				if (!flag2 || (!teleportInAir && !Main.tileSolid[Main.tile[num5, i].type]))
				{
					continue;
				}
				bool flag3 = false;
				if (!((!solidTileCheckCentered) ? (!Collision.SolidTiles(num5 - solidTileCheckFluff, num5 + solidTileCheckFluff, i - 3 - solidTileCheckFluff, i - 1)) : (!Collision.SolidTiles(num5 - solidTileCheckFluff, num5 + solidTileCheckFluff, i - solidTileCheckFluff, i + solidTileCheckFluff))))
				{
					continue;
				}
				Rectangle rectangle = new Rectangle(num5 * 16, i * 16, 16, 16);
				rectangle.Inflate(telefragPreventionDistanceInTiles * 16, telefragPreventionDistanceInTiles * 16);
				for (int j = 0; j < Main.player.Length; j++)
				{
					Player player = Main.player[j];
					if (player != null && player.active && !player.dead)
					{
						Rectangle value = player.Hitbox;
						Rectangle value2 = value.Modified((int)(player.velocity.X * num4), (int)(player.velocity.Y * num4), 0, 0);
						Rectangle.Union(ref value2, ref value, out value2);
						if (value2.Intersects(rectangle))
						{
							flag2 = false;
							flag = false;
							break;
						}
					}
				}
				if (flag2)
				{
					chosenTile = new Vector2(num5, i);
					flag = true;
				}
				break;
			}
		}
		return flag;
	}

	private bool AI_AttemptToFindTeleportSpotNearBooks(Point targetPosition, int maxRangeInTiles, out Vector2 destination)
	{
		destination = Vector2.Zero;
		int num = (int)base.Center.X / 16;
		int num2 = (int)base.Center.Y / 16;
		int num3 = num - targetPosition.X;
		int num4 = num2 - targetPosition.Y;
		if (Math.Sqrt(num3 * num3 + num4 * num4) > 125.0)
		{
			return false;
		}
		int num5 = Main.rand.Next(2) * 2 - 1;
		for (int i = 0; i < 100; i++)
		{
			int num6 = Main.rand.Next(targetPosition.X - maxRangeInTiles, targetPosition.X + maxRangeInTiles + 1);
			int num7 = Main.rand.Next(targetPosition.Y - maxRangeInTiles, targetPosition.Y + maxRangeInTiles + 1);
			if (!WorldGen.InWorld(new Point(num6, num7)))
			{
				return false;
			}
			Tile tile = Main.tile[num6, num7];
			if (!Main.wallDungeon[tile.wall] || tile.active())
			{
				continue;
			}
			num5 *= -1;
			bool outOfBounds = false;
			bool flag = false;
			int num8 = Math.Max(0, targetPosition.X - maxRangeInTiles);
			int num9 = Math.Min(Main.maxTilesX - 1, targetPosition.X + maxRangeInTiles);
			do
			{
				num6 += num5;
				if (num6 < num8 || num6 > num9)
				{
					outOfBounds = true;
					break;
				}
				tile = Main.tile[num6, num7];
			}
			while (!tile.active() || !Main.tileSolid[tile.type]);
			if (outOfBounds)
			{
				continue;
			}
			num6 -= num5;
			int y = num7;
			while (AI_AttemptToFindTeleportSpotNearBooks_SearchWall(num6, y, downwards: true, out destination, out outOfBounds))
			{
				if (Math.Abs(destination.X - (float)num) <= 1f && Math.Abs(destination.Y - (float)num2) <= 1f)
				{
					y = (int)destination.Y;
					continue;
				}
				destination.X -= num5;
				destination.Y += 1f;
				return true;
			}
			if (outOfBounds)
			{
				continue;
			}
			y = num7;
			while (AI_AttemptToFindTeleportSpotNearBooks_SearchWall(num6, y, downwards: false, out destination, out outOfBounds))
			{
				if (Math.Abs(destination.X - (float)num) <= 1f && Math.Abs(destination.Y - (float)num2) <= 1f)
				{
					y = (int)destination.Y;
					continue;
				}
				destination.X -= num5;
				destination.Y += 1f;
				return true;
			}
		}
		return false;
	}

	private bool AI_AttemptToFindTeleportSpotNearBooks_SearchWall(int x, int y, bool downwards, out Vector2 destination, out bool outOfBounds)
	{
		destination = Vector2.Zero;
		outOfBounds = false;
		int num = (downwards ? 1 : (-1));
		bool flag = false;
		Tile tile;
		do
		{
			y += num;
			if (y < 0 || y >= Main.maxTilesY)
			{
				outOfBounds = true;
				return false;
			}
			tile = Main.tile[x, y];
			bool flag2 = false;
			if (!tile.active() || tile.type != 50)
			{
				continue;
			}
			Rectangle rectangle = new Rectangle(x * 16, y * 16, 16, 16);
			rectangle.Inflate(80, 80);
			for (int i = 0; i < Main.player.Length; i++)
			{
				Player player = Main.player[i];
				if (player != null && player.active && !player.dead)
				{
					Rectangle value = player.Hitbox;
					Rectangle value2 = value.Modified((int)(player.velocity.X * 20f), (int)(player.velocity.Y * 20f), 0, 0);
					Rectangle.Union(ref value2, ref value, out value2);
					if (value2.Intersects(rectangle))
					{
						flag2 = true;
						break;
					}
				}
			}
			if (flag2)
			{
				break;
			}
			destination = new Vector2(x, y);
			return true;
		}
		while (!tile.active() || !Main.tileSolid[tile.type]);
		return false;
	}

	public static void TransformElderSlime(int npcIndex)
	{
		if (Main.netMode == 1)
		{
			NetMessage.SendData(140, -1, -1, null, 2, npcIndex);
		}
		else if (!unlockedSlimeOldSpawn && Main.npc.IndexInRange(npcIndex))
		{
			NPC nPC = Main.npc[npcIndex];
			if (nPC.type == 685)
			{
				unlockedSlimeOldSpawn = true;
				NetMessage.SendData(7);
				nPC.Transform(679);
				ParticleOrchestrator.BroadcastParticleSpawn(ParticleOrchestraType.TownSlimeTransform, new ParticleOrchestraSettings
				{
					PositionInWorld = nPC.Center,
					MovementVector = Vector2.Zero,
					UniqueInfoPiece = 2
				});
			}
		}
	}

	public static void TransformCopperSlime(int npcIndex)
	{
		if (Main.netMode == 1)
		{
			NetMessage.SendData(140, -1, -1, null, 1, npcIndex);
		}
		else if (!unlockedSlimeCopperSpawn && Main.npc.IndexInRange(npcIndex))
		{
			NPC nPC = Main.npc[npcIndex];
			if (nPC.type >= 0 && nPC.type < NPCID.Count && NPCID.Sets.CanConvertIntoCopperSlimeTownNPC[nPC.type])
			{
				unlockedSlimeCopperSpawn = true;
				NetMessage.SendData(7);
				nPC.Transform(684);
				ParticleOrchestrator.BroadcastParticleSpawn(ParticleOrchestraType.TownSlimeTransform, new ParticleOrchestraSettings
				{
					PositionInWorld = nPC.Center,
					MovementVector = Vector2.Zero,
					UniqueInfoPiece = 1
				});
			}
		}
	}

	public static void HaveDryadDoStardewAnimation()
	{
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			NPC nPC = Main.npc[i];
			if (!nPC.active || nPC.type != 20)
			{
				continue;
			}
			nPC.localAI[2] = 480f;
			nPC.ai[0] = 24f;
			nPC.ai[1] = 480f;
			nPC.ai[2] = 0f;
			nPC.localAI[3] = 0f;
			nPC.netUpdate = true;
			nPC.direction = 1;
			nPC.spriteDirection = 1;
			Vector2 vector = nPC.Bottom + new Vector2(100f, 0f);
			Point p = vector.ToTileCoordinates();
			p.Y = Utils.Clamp(p.Y - 10, 10, Main.maxTilesY - 10);
			int y = p.Y;
			int num = 15;
			int num2 = p.Y + num;
			bool flag = false;
			for (int j = p.Y; j < num2; j++)
			{
				Tile tile = Main.tile[p.X, j];
				p.Y = j;
				if (tile.active() && Main.tileSolid[tile.type])
				{
					if (j == y)
					{
						flag = true;
					}
					break;
				}
			}
			Vector2 vector2 = new Vector2(0f, -52f);
			Vector2 vector3 = p.ToWorldCoordinates(8f, 0f);
			if (flag)
			{
				vector3 = vector;
			}
			Projectile.NewProjectile(new EntitySource_DebugCommand(), vector3 + vector2, Vector2.Zero, 995, 0, 0f, Main.myPlayer);
			break;
		}
	}

	private void AI_047_GolemFist()
	{
		float num = GetMyBalance();
		if (Main.getGoodWorld)
		{
			num += 3f;
		}
		if ((!Main.player[target].ZoneLihzhardTemple && !Main.player[target].ZoneJungle) || (double)Main.player[target].Center.Y < Main.worldSurface * 16.0)
		{
			num *= 2f;
		}
		if (golemBoss < 0)
		{
			StrikeNPCNoInteraction(9999, 0f, 0);
			return;
		}
		if (alpha > 0)
		{
			alpha -= 10;
			if (alpha < 0)
			{
				alpha = 0;
			}
			ai[1] = 0f;
		}
		Player player = Main.player[target];
		NPC nPC = Main.npc[golemBoss];
		Vector2 vector = nPC.Center + nPC.velocity + new Vector2(0f, -9f * scale);
		vector.X += (float)((type == 247) ? (-84) : 78) * scale;
		Vector2 vector2 = vector - base.Center;
		float num2 = vector2.Length();
		if (ai[0] == 0f)
		{
			noTileCollide = true;
			float num3 = 14f;
			if (life < lifeMax / 2)
			{
				num3 += 3f;
			}
			if (life < lifeMax / 4)
			{
				num3 += 3f;
			}
			if (Main.npc[golemBoss].life < Main.npc[golemBoss].lifeMax)
			{
				num3 += 8f;
			}
			num3 *= (num + 3f) / 4f;
			if (num3 > 32f)
			{
				num3 = 32f;
			}
			float x = vector2.X;
			float y = vector2.Y;
			float num4 = num2;
			if (num4 < 12f + num3)
			{
				rotation = 0f;
				velocity.X = x;
				velocity.Y = y;
				float num5 = num;
				ai[1] += num5;
				if (life < lifeMax / 2)
				{
					ai[1] += num5;
				}
				if (life < lifeMax / 4)
				{
					ai[1] += num5;
				}
				if (Main.npc[golemBoss].life < Main.npc[golemBoss].lifeMax)
				{
					ai[1] += 10f * num5;
				}
				if (ai[1] >= 60f)
				{
					TargetClosest();
					if ((type == 247 && base.Center.X + 100f > Main.player[target].Center.X) || (type == 248 && base.Center.X - 100f < Main.player[target].Center.X))
					{
						ai[1] = 0f;
						ai[0] = 1f;
					}
					else
					{
						ai[1] = 0f;
					}
				}
			}
			else
			{
				num4 = num3 / num4;
				velocity.X = x * num4;
				velocity.Y = y * num4;
				rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
				if (type == 247)
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X);
				}
			}
		}
		else if (ai[0] == 1f)
		{
			ai[1] += 1f;
			base.Center = vector;
			rotation = 0f;
			velocity = Vector2.Zero;
			if (ai[1] <= 15f)
			{
				for (int i = 0; i < 1; i++)
				{
					Vector2 vector3 = Main.rand.NextVector2Circular(80f, 80f);
					Vector2 vector4 = vector3 * -1f * 0.05f;
					Vector2 vector5 = Main.rand.NextVector2Circular(20f, 20f);
					Dust dust = Dust.NewDustPerfect(base.Center + vector4 + vector3 + vector5, 228, vector4);
					dust.fadeIn = 1.5f;
					dust.scale = 0.5f;
					if (Main.getGoodWorld)
					{
						dust.noLight = true;
					}
					dust.noGravity = true;
				}
			}
			if (ai[1] >= 30f)
			{
				noTileCollide = true;
				collideX = false;
				collideY = false;
				ai[0] = 2f;
				ai[1] = 0f;
				float num6 = 12f;
				if (life < lifeMax / 2)
				{
					num6 += 4f;
				}
				if (life < lifeMax / 4)
				{
					num6 += 4f;
				}
				if (Main.npc[golemBoss].life < Main.npc[golemBoss].lifeMax)
				{
					num6 += 10f;
				}
				num6 *= (num + 3f) / 4f;
				if (num6 > 48f)
				{
					num6 = 48f;
				}
				Vector2 vector6 = new Vector2(base.Center.X, base.Center.Y);
				float num7 = Main.player[target].Center.X - vector6.X;
				float num8 = Main.player[target].Center.Y - vector6.Y;
				float num9 = (float)Math.Sqrt(num7 * num7 + num8 * num8);
				num9 = num6 / num9;
				velocity.X = num7 * num9;
				velocity.Y = num8 * num9;
				rotation = (float)Math.Atan2(velocity.Y, velocity.X);
				if (type == 247)
				{
					rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
				}
			}
		}
		else if (ai[0] == 2f)
		{
			if (Main.netMode != 1 && Main.getGoodWorld)
			{
				for (int j = (int)(position.X / 16f) - 1; (float)j < (position.X + (float)width) / 16f + 1f; j++)
				{
					for (int k = (int)(position.Y / 16f) - 1; (float)k < (position.Y + (float)width) / 16f + 1f; k++)
					{
						Tile tile = Main.tile[j, k];
						if (tile != null && tile.active() && TileID.Sets.Torches[tile.type])
						{
							Main.tile[j, k].active(active: false);
							if (Main.netMode == 2)
							{
								NetMessage.SendTileSquare(-1, j, k);
							}
						}
					}
				}
			}
			ai[1] += 1f;
			if (ai[1] == 1f)
			{
				SoundEngine.PlaySound(SoundID.Item14, position);
			}
			if (Main.rand.Next(2) == 0)
			{
				Vector2 vector7 = velocity * 0.5f;
				Vector2 vector8 = Main.rand.NextVector2Circular(20f, 20f);
				Dust.NewDustPerfect(base.Center + vector7 + vector8, 306, vector7, 0, Main.OurFavoriteColor).scale = 2f;
			}
			if (Math.Abs(velocity.X) > Math.Abs(velocity.Y))
			{
				if (velocity.X > 0f && base.Center.X > player.Center.X)
				{
					noTileCollide = false;
				}
				if (velocity.X < 0f && base.Center.X < player.Center.X)
				{
					noTileCollide = false;
				}
			}
			else
			{
				if (velocity.Y > 0f && base.Center.Y > player.Center.Y)
				{
					noTileCollide = false;
				}
				if (velocity.Y < 0f && base.Center.Y < player.Center.Y)
				{
					noTileCollide = false;
				}
			}
			if (num2 > 700f || collideX || collideY)
			{
				noTileCollide = true;
				ai[0] = 0f;
			}
		}
		else
		{
			if (ai[0] != 3f)
			{
				return;
			}
			noTileCollide = true;
			float num10 = 0.4f;
			Vector2 vector9 = new Vector2(base.Center.X, base.Center.Y);
			float num11 = Main.player[target].Center.X - vector9.X;
			float num12 = Main.player[target].Center.Y - vector9.Y;
			float num13 = (float)Math.Sqrt(num11 * num11 + num12 * num12);
			num13 = 12f / num13;
			num11 *= num13;
			num12 *= num13;
			if (velocity.X < num11)
			{
				velocity.X += num10;
				if (velocity.X < 0f && num11 > 0f)
				{
					velocity.X += num10 * 2f;
				}
			}
			else if (velocity.X > num11)
			{
				velocity.X -= num10;
				if (velocity.X > 0f && num11 < 0f)
				{
					velocity.X -= num10 * 2f;
				}
			}
			if (velocity.Y < num12)
			{
				velocity.Y += num10;
				if (velocity.Y < 0f && num12 > 0f)
				{
					velocity.Y += num10 * 2f;
				}
			}
			else if (velocity.Y > num12)
			{
				velocity.Y -= num10;
				if (velocity.Y > 0f && num12 < 0f)
				{
					velocity.Y -= num10 * 2f;
				}
			}
			rotation = (float)Math.Atan2(velocity.Y, velocity.X);
			if (type == 247)
			{
				rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
			}
		}
	}

	private void AI_045_Golem()
	{
		golemBoss = whoAmI;
		float num = GetMyBalance();
		if (Main.getGoodWorld)
		{
			num += 2f;
		}
		if ((!Main.player[target].ZoneLihzhardTemple && !Main.player[target].ZoneJungle) || (double)Main.player[target].Center.Y < Main.worldSurface * 16.0)
		{
			num *= 2f;
		}
		if (localAI[0] == 0f)
		{
			localAI[0] = 1f;
			if (Main.netMode != 1)
			{
				NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X - 84, (int)base.Center.Y - 9, 247);
				NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X + 78, (int)base.Center.Y - 9, 248);
				NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X - 3, (int)base.Center.Y - 57, 246);
			}
		}
		if (target >= 0 && Main.player[target].dead)
		{
			TargetClosest();
			if (Main.player[target].dead)
			{
				noTileCollide = true;
			}
		}
		if (alpha > 0)
		{
			alpha -= 10;
			if (alpha < 0)
			{
				alpha = 0;
			}
			ai[1] = 0f;
		}
		bool flag = false;
		bool flag2 = false;
		bool flag3 = false;
		dontTakeDamage = false;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			NPC nPC = Main.npc[i];
			if (nPC.active)
			{
				switch (nPC.type)
				{
				case 246:
					flag = true;
					break;
				case 247:
					flag2 = true;
					break;
				case 248:
					flag3 = true;
					break;
				}
			}
		}
		dontTakeDamage = flag;
		if (Main.netMode != 1 && Main.getGoodWorld && velocity.Y > 0f)
		{
			for (int j = (int)(position.X / 16f); (float)j < (position.X + (float)width) / 16f; j++)
			{
				for (int k = (int)(position.Y / 16f); (float)k < (position.Y + (float)width) / 16f; k++)
				{
					Tile tile = Main.tile[j, k];
					if (tile != null && tile.active() && TileID.Sets.Torches[tile.type])
					{
						Main.tile[j, k].active(active: false);
						if (Main.netMode == 2)
						{
							NetMessage.SendTileSquare(-1, j, k);
						}
					}
				}
			}
		}
		position += netOffset;
		if (!Main.getGoodWorld)
		{
			if (!flag2)
			{
				int num2 = Dust.NewDust(new Vector2(base.Center.X - 80f * scale, base.Center.Y - 9f), 8, 8, 31, 0f, 0f, 100);
				Main.dust[num2].alpha += Main.rand.Next(100);
				Main.dust[num2].velocity *= 0.2f;
				Main.dust[num2].velocity.Y -= 0.5f + (float)Main.rand.Next(10) * 0.1f;
				Main.dust[num2].fadeIn = 0.5f + (float)Main.rand.Next(10) * 0.1f;
				if (Main.rand.Next(10) == 0)
				{
					num2 = Dust.NewDust(new Vector2(base.Center.X - 80f * scale, base.Center.Y - 9f), 8, 8, 6);
					if (Main.rand.Next(20) != 0)
					{
						Main.dust[num2].noGravity = true;
						Main.dust[num2].scale *= 1f + (float)Main.rand.Next(10) * 0.1f;
						Main.dust[num2].velocity.Y -= 1f;
					}
				}
			}
			if (!flag3)
			{
				int num3 = Dust.NewDust(new Vector2(base.Center.X + 62f * scale, base.Center.Y - 9f), 8, 8, 31, 0f, 0f, 100);
				Main.dust[num3].alpha += Main.rand.Next(100);
				Main.dust[num3].velocity *= 0.2f;
				Main.dust[num3].velocity.Y -= 0.5f + (float)Main.rand.Next(10) * 0.1f;
				Main.dust[num3].fadeIn = 0.5f + (float)Main.rand.Next(10) * 0.1f;
				if (Main.rand.Next(10) == 0)
				{
					num3 = Dust.NewDust(new Vector2(base.Center.X + 62f * scale, base.Center.Y - 9f), 8, 8, 6);
					if (Main.rand.Next(20) != 0)
					{
						Main.dust[num3].noGravity = true;
						Main.dust[num3].scale *= 1f + (float)Main.rand.Next(10) * 0.1f;
						Main.dust[num3].velocity.Y -= 1f;
					}
				}
			}
		}
		position -= netOffset;
		if (noTileCollide && !Main.player[target].dead)
		{
			if (velocity.Y > 0f && base.Bottom.Y > Main.player[target].Top.Y)
			{
				noTileCollide = false;
			}
			else if (Collision.CanHit(position, width, height, Main.player[target].Center, 1, 1) && !Collision.SolidTiles(position, width, height))
			{
				noTileCollide = false;
			}
		}
		if (ai[0] == 0f)
		{
			if (velocity.Y == 0f)
			{
				velocity.X *= 0.8f;
				float num4 = 1f;
				if (ai[1] > 0f)
				{
					if (!flag2)
					{
						num4 += 2f;
					}
					if (!flag3)
					{
						num4 += 2f;
					}
					if (!flag)
					{
						num4 += 2f;
					}
					if (life < lifeMax)
					{
						num4 += 1f;
					}
					if (life < lifeMax / 2)
					{
						num4 += 4f;
					}
					if (life < lifeMax / 3)
					{
						num4 += 8f;
					}
					num4 *= num;
					if (Main.getGoodWorld)
					{
						num4 += 100f;
					}
				}
				ai[1] += num4;
				if (ai[1] >= 300f)
				{
					ai[1] = -20f;
					frameCounter = 0.0;
				}
				else if (ai[1] == -1f)
				{
					noTileCollide = true;
					TargetClosest();
					velocity.X = 4 * direction;
					if (life < lifeMax)
					{
						velocity.Y = -12.1f * (num + 9f) / 10f;
						if ((double)velocity.Y < -19.1)
						{
							velocity.Y = -19.1f;
						}
					}
					else
					{
						velocity.Y = -12.1f;
					}
					ai[0] = 1f;
					ai[1] = 0f;
				}
			}
		}
		else if (ai[0] == 1f)
		{
			if (velocity.Y == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item14, position);
				ai[0] = 0f;
				for (int l = (int)position.X - 20; l < (int)position.X + width + 40; l += 20)
				{
					for (int m = 0; m < 4; m++)
					{
						int num5 = Dust.NewDust(new Vector2(position.X - 20f, position.Y + (float)height), width + 20, 4, 31, 0f, 0f, 100, default(Color), 1.5f);
						Main.dust[num5].velocity *= 0.2f;
					}
					int num6 = Gore.NewGore(new Vector2(l - 20, position.Y + (float)height - 8f), default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num6].velocity *= 0.4f;
				}
			}
			else
			{
				TargetClosest();
				if (position.X < Main.player[target].position.X && position.X + (float)width > Main.player[target].position.X + (float)Main.player[target].width)
				{
					velocity.X *= 0.9f;
					if (base.Bottom.Y < Main.player[target].position.Y)
					{
						velocity.Y += 0.2f * (num + 1f) / 2f;
					}
				}
				else
				{
					if (direction < 0)
					{
						velocity.X -= 0.2f;
					}
					else if (direction > 0)
					{
						velocity.X += 0.2f;
					}
					float num7 = 3f;
					if (life < lifeMax)
					{
						num7 += 1f;
					}
					if (life < lifeMax / 2)
					{
						num7 += 1f;
					}
					if (life < lifeMax / 4)
					{
						num7 += 1f;
					}
					num7 *= (num + 1f) / 2f;
					if (velocity.X < 0f - num7)
					{
						velocity.X = 0f - num7;
					}
					if (velocity.X > num7)
					{
						velocity.X = num7;
					}
				}
			}
		}
		if (target <= 0 || target == 255 || Main.player[target].dead)
		{
			TargetClosest();
		}
		int num8 = 3000;
		if (Math.Abs(base.Center.X - Main.player[target].Center.X) + Math.Abs(base.Center.Y - Main.player[target].Center.Y) > (float)num8)
		{
			TargetClosest();
			if (Math.Abs(base.Center.X - Main.player[target].Center.X) + Math.Abs(base.Center.Y - Main.player[target].Center.Y) > (float)num8)
			{
				active = false;
			}
		}
	}

	public static bool SpawnMechQueen(int onWhichPlayer)
	{
		if (AnyNPCs(127) || AnyNPCs(134) || AnyNPCs(125) || AnyNPCs(126))
		{
			return false;
		}
		if (!SpecialSeedFeatures.Mechdusa)
		{
			return false;
		}
		if (Main.netMode == 1)
		{
			NetMessage.SendData(61, -1, -1, null, onWhichPlayer, -16f);
		}
		else
		{
			mechQueen = -2;
			SpawnOnPlayer(onWhichPlayer, 127);
			mechQueen = FindFirstNPC(127);
			NewNPC(GetBossSpawnSource(onWhichPlayer), (int)Main.npc[mechQueen].Center.X, (int)Main.npc[mechQueen].Center.Y, 125, 1);
			NewNPC(GetBossSpawnSource(onWhichPlayer), (int)Main.npc[mechQueen].Center.X, (int)Main.npc[mechQueen].Center.Y, 126, 1);
			int num = NewNPC(GetBossSpawnSource(onWhichPlayer), (int)Main.npc[mechQueen].Center.X, (int)Main.npc[mechQueen].Center.Y, 134, 1);
			NewNPC(GetBossSpawnSource(onWhichPlayer), (int)Main.npc[mechQueen].Center.X, (int)Main.npc[mechQueen].Center.Y, 139, 1, 0f, 0f, num, -1f);
			NewNPC(GetBossSpawnSource(onWhichPlayer), (int)Main.npc[mechQueen].Center.X, (int)Main.npc[mechQueen].Center.Y, 139, 1, 0f, 0f, num, 1f);
		}
		return true;
	}

	public bool IsCritterThatIsHostileToPlayers()
	{
		if (type >= 0 && NPCID.Sets.CritterThatCanTurnOnPlayers[type])
		{
			return aiStyle == 3;
		}
		return false;
	}

	public void AI()
	{
		if (aiStyle == 0)
		{
			if (Main.netMode != 1)
			{
				for (int i = 0; i < 255; i++)
				{
					if (Main.player[i].active && Main.player[i].talkNPC == whoAmI)
					{
						if (type == 589)
						{
							AI_000_TransformBoundNPC(i, 588);
						}
						if (type == 105)
						{
							AI_000_TransformBoundNPC(i, 107);
						}
						if (type == 106)
						{
							AI_000_TransformBoundNPC(i, 108);
						}
						if (type == 123)
						{
							AI_000_TransformBoundNPC(i, 124);
						}
						if (type == 354)
						{
							AI_000_TransformBoundNPC(i, 353);
						}
						if (type == 376)
						{
							AI_000_TransformBoundNPC(i, 369);
						}
						if (type == 579)
						{
							AI_000_TransformBoundNPC(i, 550);
						}
					}
				}
			}
			if (type != 376 && type != 579)
			{
				TargetClosest();
				spriteDirection = direction;
			}
			if (type == 376 || type == 579)
			{
				if (wet || Main.tile[(int)(base.Center.X / 16f), (int)(position.Y - 4f) / 16].liquid > 0)
				{
					velocity.Y = -0.4f;
					int num = 1;
					if (base.Center.X / 16f > (float)(Main.maxTilesX / 2))
					{
						num = -1;
					}
					int num2 = 12;
					int num3 = (int)base.Center.X / 16;
					int j = (int)base.Center.Y / 16;
					bool flag = false;
					if (num > 0)
					{
						for (int k = num3; k < num3 + num2; k++)
						{
							if (WorldGen.SolidTile(k, j))
							{
								flag = true;
							}
						}
					}
					else
					{
						for (int l = num3; l > num3 - num2; l--)
						{
							if (WorldGen.SolidTile(l, j))
							{
								flag = true;
							}
						}
					}
					if (type == 579)
					{
						flag = true;
					}
					if (flag)
					{
						velocity.X *= 0.99f;
						if ((double)velocity.X > -0.01 && (double)velocity.X < 0.01)
						{
							velocity.X = 0f;
						}
						return;
					}
					velocity.X += (float)num * 0.01f;
					if (velocity.X > 0.2f)
					{
						velocity.X *= 0.95f;
					}
					if (velocity.X < -0.2f)
					{
						velocity.X *= 0.95f;
					}
				}
				else
				{
					velocity.X *= 0.93f;
					if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
					{
						velocity.X = 0f;
					}
				}
			}
			else
			{
				velocity.X *= 0.93f;
				if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
				{
					velocity.X = 0f;
				}
			}
			return;
		}
		if (aiStyle == 1)
		{
			AI_001_Slimes();
			return;
		}
		if (aiStyle == 2)
		{
			AI_002_FloatingEye();
			return;
		}
		if (aiStyle == 3)
		{
			AI_003_Fighters();
			return;
		}
		if (aiStyle == 4)
		{
			bool flag2 = false;
			if (Main.expertMode && (double)life < (double)lifeMax * 0.12)
			{
				flag2 = true;
			}
			bool flag3 = false;
			if (Main.expertMode && (double)life < (double)lifeMax * 0.04)
			{
				flag3 = true;
			}
			float num4 = 20f;
			if (flag3)
			{
				num4 = 10f;
			}
			if (target < 0 || target == 255 || Main.player[target].dead || !Main.player[target].active)
			{
				TargetClosest();
			}
			bool dead = Main.player[target].dead;
			float num5 = position.X + (float)(width / 2) - Main.player[target].position.X - (float)(Main.player[target].width / 2);
			float num6 = position.Y + (float)height - 59f - Main.player[target].position.Y - (float)(Main.player[target].height / 2);
			float num7 = (float)Math.Atan2(num6, num5) + 1.57f;
			if (num7 < 0f)
			{
				num7 += 6.283f;
			}
			else if ((double)num7 > 6.283)
			{
				num7 -= 6.283f;
			}
			float num8 = 0f;
			if (this.ai[0] == 0f && this.ai[1] == 0f)
			{
				num8 = 0.02f;
			}
			if (this.ai[0] == 0f && this.ai[1] == 2f && this.ai[2] > 40f)
			{
				num8 = 0.05f;
			}
			if (this.ai[0] == 3f && this.ai[1] == 0f)
			{
				num8 = 0.05f;
			}
			if (this.ai[0] == 3f && this.ai[1] == 2f && this.ai[2] > 40f)
			{
				num8 = 0.08f;
			}
			if (this.ai[0] == 3f && this.ai[1] == 4f && this.ai[2] > num4)
			{
				num8 = 0.15f;
			}
			if (this.ai[0] == 3f && this.ai[1] == 5f)
			{
				num8 = 0.05f;
			}
			if (Main.expertMode)
			{
				num8 *= 1.5f;
			}
			if (flag3 && Main.expertMode)
			{
				num8 = 0f;
			}
			if (rotation < num7)
			{
				if ((double)(num7 - rotation) > 3.1415)
				{
					rotation -= num8;
				}
				else
				{
					rotation += num8;
				}
			}
			else if (rotation > num7)
			{
				if ((double)(rotation - num7) > 3.1415)
				{
					rotation += num8;
				}
				else
				{
					rotation -= num8;
				}
			}
			if (rotation > num7 - num8 && rotation < num7 + num8)
			{
				rotation = num7;
			}
			if (rotation < 0f)
			{
				rotation += 6.283f;
			}
			else if ((double)rotation > 6.283)
			{
				rotation -= 6.283f;
			}
			if (rotation > num7 - num8 && rotation < num7 + num8)
			{
				rotation = num7;
			}
			if (Main.rand.Next(5) == 0)
			{
				int num9 = Dust.NewDust(new Vector2(position.X, position.Y + (float)height * 0.25f), width, (int)((float)height * 0.5f), 5, velocity.X, 2f);
				Main.dust[num9].velocity.X *= 0.5f;
				Main.dust[num9].velocity.Y *= 0.1f;
			}
			reflectsProjectiles = false;
			if (Main.IsItDay() || dead)
			{
				velocity.Y -= 0.04f;
				EncourageDespawn(10);
				return;
			}
			if (this.ai[0] == 0f)
			{
				if (this.ai[1] == 0f)
				{
					float num10 = 5f;
					float num11 = 0.04f;
					if (Main.expertMode)
					{
						num11 = 0.15f;
						num10 = 7f;
					}
					if (Main.getGoodWorld)
					{
						num11 += 0.05f;
						num10 += 1f;
					}
					Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num12 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector.X;
					float num13 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - 200f - vector.Y;
					float num14 = (float)Math.Sqrt(num12 * num12 + num13 * num13);
					float num15 = num14;
					num14 = num10 / num14;
					num12 *= num14;
					num13 *= num14;
					if (velocity.X < num12)
					{
						velocity.X += num11;
						if (velocity.X < 0f && num12 > 0f)
						{
							velocity.X += num11;
						}
					}
					else if (velocity.X > num12)
					{
						velocity.X -= num11;
						if (velocity.X > 0f && num12 < 0f)
						{
							velocity.X -= num11;
						}
					}
					if (velocity.Y < num13)
					{
						velocity.Y += num11;
						if (velocity.Y < 0f && num13 > 0f)
						{
							velocity.Y += num11;
						}
					}
					else if (velocity.Y > num13)
					{
						velocity.Y -= num11;
						if (velocity.Y > 0f && num13 < 0f)
						{
							velocity.Y -= num11;
						}
					}
					this.ai[2] += 1f;
					float num16 = 600f;
					if (Main.expertMode)
					{
						num16 *= 0.35f;
					}
					if (this.ai[2] >= num16)
					{
						this.ai[1] = 1f;
						this.ai[2] = 0f;
						this.ai[3] = 0f;
						target = 255;
						netUpdate = true;
					}
					else if ((position.Y + (float)height < Main.player[target].position.Y && num15 < 500f) || (Main.expertMode && num15 < 500f))
					{
						if (!Main.player[target].dead)
						{
							this.ai[3] += 1f;
						}
						float num17 = 110f;
						if (Main.expertMode)
						{
							num17 *= 0.4f;
						}
						if (Main.getGoodWorld)
						{
							num17 *= 0.8f;
						}
						if (this.ai[3] >= num17)
						{
							this.ai[3] = 0f;
							rotation = num7;
							float num18 = 5f;
							if (Main.expertMode)
							{
								num18 = 6f;
							}
							float num19 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector.X;
							float num20 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector.Y;
							float num21 = (float)Math.Sqrt(num19 * num19 + num20 * num20);
							num21 = num18 / num21;
							Vector2 vector2 = vector;
							Vector2 vector3 = default(Vector2);
							vector3.X = num19 * num21;
							vector3.Y = num20 * num21;
							vector2.X += vector3.X * 10f;
							vector2.Y += vector3.Y * 10f;
							if (Main.netMode != 1)
							{
								int num22 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)vector2.X, (int)vector2.Y, 5);
								Main.npc[num22].velocity.X = vector3.X;
								Main.npc[num22].velocity.Y = vector3.Y;
								if (Main.netMode == 2 && num22 < Main.maxNPCs)
								{
									NetMessage.SendData(23, -1, -1, null, num22);
								}
							}
							SoundEngine.PlaySound(3, (int)vector2.X, (int)vector2.Y);
							for (int m = 0; m < 10; m++)
							{
								Dust.NewDust(vector2, 20, 20, 5, vector3.X * 0.4f, vector3.Y * 0.4f);
							}
						}
					}
				}
				else if (this.ai[1] == 1f)
				{
					rotation = num7;
					float num23 = 6f;
					if (Main.expertMode)
					{
						num23 = 7f;
					}
					if (Main.getGoodWorld)
					{
						num23 += 1f;
					}
					Vector2 vector4 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num24 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector4.X;
					float num25 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector4.Y;
					float num26 = (float)Math.Sqrt(num24 * num24 + num25 * num25);
					num26 = num23 / num26;
					velocity.X = num24 * num26;
					velocity.Y = num25 * num26;
					this.ai[1] = 2f;
					NetUpdateIgnoreSpamLimit();
				}
				else if (this.ai[1] == 2f)
				{
					this.ai[2] += 1f;
					if (this.ai[2] >= 40f)
					{
						velocity *= 0.98f;
						if (Main.expertMode)
						{
							velocity *= 0.985f;
						}
						if (Main.getGoodWorld)
						{
							velocity *= 0.99f;
						}
						if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
						{
							velocity.X = 0f;
						}
						if ((double)velocity.Y > -0.1 && (double)velocity.Y < 0.1)
						{
							velocity.Y = 0f;
						}
					}
					else
					{
						rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
					}
					int num27 = 150;
					if (Main.expertMode)
					{
						num27 = 100;
					}
					if (Main.getGoodWorld)
					{
						num27 -= 15;
					}
					if (this.ai[2] >= (float)num27)
					{
						this.ai[3] += 1f;
						this.ai[2] = 0f;
						target = 255;
						rotation = num7;
						if (this.ai[3] >= 3f)
						{
							this.ai[1] = 0f;
							this.ai[3] = 0f;
						}
						else
						{
							this.ai[1] = 1f;
						}
					}
				}
				float num28 = 0.5f;
				if (Main.expertMode)
				{
					num28 = 0.65f;
				}
				if ((float)life < (float)lifeMax * num28)
				{
					this.ai[0] = 1f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					NetUpdateIgnoreSpamLimit();
				}
				return;
			}
			if (this.ai[0] == 1f || this.ai[0] == 2f)
			{
				if (this.ai[0] == 1f || this.ai[3] == 1f)
				{
					this.ai[2] += 0.005f;
					if ((double)this.ai[2] > 0.5)
					{
						this.ai[2] = 0.5f;
					}
				}
				else
				{
					this.ai[2] -= 0.005f;
					if (this.ai[2] < 0f)
					{
						this.ai[2] = 0f;
					}
				}
				rotation += this.ai[2];
				this.ai[1] += 1f;
				if (Main.getGoodWorld)
				{
					reflectsProjectiles = true;
				}
				int num29 = 20;
				if (Main.getGoodWorld && life < lifeMax / 3)
				{
					num29 = 10;
				}
				if (Main.expertMode && this.ai[1] % (float)num29 == 0f)
				{
					float num30 = 5f;
					Vector2 vector5 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num31 = Main.rand.Next(-200, 200);
					float num32 = Main.rand.Next(-200, 200);
					if (Main.getGoodWorld)
					{
						num31 *= 3f;
						num32 *= 3f;
					}
					float num33 = (float)Math.Sqrt(num31 * num31 + num32 * num32);
					num33 = num30 / num33;
					Vector2 vector6 = vector5;
					Vector2 vector7 = default(Vector2);
					vector7.X = num31 * num33;
					vector7.Y = num32 * num33;
					vector6.X += vector7.X * 10f;
					vector6.Y += vector7.Y * 10f;
					if (Main.netMode != 1)
					{
						int num34 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)vector6.X, (int)vector6.Y, 5);
						Main.npc[num34].velocity.X = vector7.X;
						Main.npc[num34].velocity.Y = vector7.Y;
						if (Main.netMode == 2 && num34 < Main.maxNPCs)
						{
							NetMessage.SendData(23, -1, -1, null, num34);
						}
					}
					for (int n = 0; n < 10; n++)
					{
						Dust.NewDust(vector6, 20, 20, 5, vector7.X * 0.4f, vector7.Y * 0.4f);
					}
				}
				if (this.ai[1] >= 100f)
				{
					if (this.ai[3] == 1f)
					{
						this.ai[3] = 0f;
						this.ai[1] = 0f;
					}
					else
					{
						this.ai[0] += 1f;
						this.ai[1] = 0f;
						if (this.ai[0] == 3f)
						{
							this.ai[2] = 0f;
						}
						else
						{
							SoundEngine.PlaySound(3, (int)position.X, (int)position.Y);
							for (int num35 = 0; num35 < 2; num35++)
							{
								Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 8);
								Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 7);
								Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 6);
							}
							for (int num36 = 0; num36 < 20; num36++)
							{
								Dust.NewDust(position, width, height, 5, (float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f);
							}
							SoundEngine.PlaySound(15, (int)position.X, (int)position.Y, 0);
						}
					}
				}
				Dust.NewDust(position, width, height, 5, (float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f);
				velocity.X *= 0.98f;
				velocity.Y *= 0.98f;
				if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
				{
					velocity.X = 0f;
				}
				if ((double)velocity.Y > -0.1 && (double)velocity.Y < 0.1)
				{
					velocity.Y = 0f;
				}
				return;
			}
			defense = 0;
			int num37 = 23;
			int num38 = 18;
			if (Main.expertMode)
			{
				if (flag2)
				{
					defense = -15;
				}
				if (flag3)
				{
					num38 = 20;
					defense = -30;
				}
			}
			damage = GetAttackDamage_LerpBetweenFinalValues(num37, num38);
			damage = GetAttackDamage_CappedAtMaster(damage);
			if (this.ai[1] == 0f && flag2)
			{
				this.ai[1] = 5f;
			}
			if (this.ai[1] == 0f)
			{
				float num39 = 6f;
				float num40 = 0.07f;
				Vector2 vector8 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num41 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector8.X;
				float num42 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - 120f - vector8.Y;
				float num43 = (float)Math.Sqrt(num41 * num41 + num42 * num42);
				if (num43 > 400f && Main.expertMode)
				{
					num39 += 1f;
					num40 += 0.05f;
					if (num43 > 600f)
					{
						num39 += 1f;
						num40 += 0.05f;
						if (num43 > 800f)
						{
							num39 += 1f;
							num40 += 0.05f;
						}
					}
				}
				if (Main.getGoodWorld)
				{
					num39 += 1f;
					num40 += 0.1f;
				}
				num43 = num39 / num43;
				num41 *= num43;
				num42 *= num43;
				if (velocity.X < num41)
				{
					velocity.X += num40;
					if (velocity.X < 0f && num41 > 0f)
					{
						velocity.X += num40;
					}
				}
				else if (velocity.X > num41)
				{
					velocity.X -= num40;
					if (velocity.X > 0f && num41 < 0f)
					{
						velocity.X -= num40;
					}
				}
				if (velocity.Y < num42)
				{
					velocity.Y += num40;
					if (velocity.Y < 0f && num42 > 0f)
					{
						velocity.Y += num40;
					}
				}
				else if (velocity.Y > num42)
				{
					velocity.Y -= num40;
					if (velocity.Y > 0f && num42 < 0f)
					{
						velocity.Y -= num40;
					}
				}
				this.ai[2] += 1f;
				if (this.ai[2] >= 200f)
				{
					this.ai[1] = 1f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					if (Main.expertMode && (double)life < (double)lifeMax * 0.35)
					{
						this.ai[1] = 3f;
					}
					target = 255;
					netUpdate = true;
				}
				if (Main.expertMode && flag3)
				{
					TargetClosest();
					netUpdate = true;
					this.ai[1] = 3f;
					this.ai[2] = 0f;
					this.ai[3] -= 1000f;
				}
			}
			else if (this.ai[1] == 1f)
			{
				SoundEngine.PlaySound(36, (int)position.X, (int)position.Y, 0);
				rotation = num7;
				float num44 = 6.8f;
				if (Main.expertMode && this.ai[3] == 1f)
				{
					num44 *= 1.15f;
				}
				if (Main.expertMode && this.ai[3] == 2f)
				{
					num44 *= 1.3f;
				}
				if (Main.getGoodWorld)
				{
					num44 *= 1.2f;
				}
				Vector2 vector9 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num45 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector9.X;
				float num46 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector9.Y;
				float num47 = (float)Math.Sqrt(num45 * num45 + num46 * num46);
				num47 = num44 / num47;
				velocity.X = num45 * num47;
				velocity.Y = num46 * num47;
				this.ai[1] = 2f;
				NetUpdateIgnoreSpamLimit();
			}
			else if (this.ai[1] == 2f)
			{
				float num48 = 40f;
				this.ai[2] += 1f;
				if (Main.expertMode)
				{
					num48 = 50f;
				}
				if (this.ai[2] >= num48)
				{
					velocity *= 0.97f;
					if (Main.expertMode)
					{
						velocity *= 0.98f;
					}
					if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
					{
						velocity.X = 0f;
					}
					if ((double)velocity.Y > -0.1 && (double)velocity.Y < 0.1)
					{
						velocity.Y = 0f;
					}
				}
				else
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
				}
				int num49 = 130;
				if (Main.expertMode)
				{
					num49 = 90;
				}
				if (this.ai[2] >= (float)num49)
				{
					this.ai[3] += 1f;
					this.ai[2] = 0f;
					target = 255;
					rotation = num7;
					if (this.ai[3] >= 3f)
					{
						this.ai[1] = 0f;
						this.ai[3] = 0f;
						if (Main.expertMode && Main.netMode != 1 && (double)life < (double)lifeMax * 0.5)
						{
							this.ai[1] = 3f;
							this.ai[3] += Main.rand.Next(1, 4);
						}
						NetUpdateIgnoreSpamLimit();
					}
					else
					{
						this.ai[1] = 1f;
					}
				}
			}
			else if (this.ai[1] == 3f)
			{
				if (this.ai[3] == 4f && flag2 && base.Center.Y > Main.player[target].Center.Y)
				{
					TargetClosest();
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					NetUpdateIgnoreSpamLimit();
				}
				else if (Main.netMode != 1)
				{
					TargetClosest();
					float num50 = 20f;
					Vector2 vector10 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num51 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector10.X;
					float num52 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector10.Y;
					float num53 = Math.Abs(Main.player[target].velocity.X) + Math.Abs(Main.player[target].velocity.Y) / 4f;
					num53 += 10f - num53;
					if (num53 < 5f)
					{
						num53 = 5f;
					}
					if (num53 > 15f)
					{
						num53 = 15f;
					}
					if (this.ai[2] == -1f && !flag3)
					{
						num53 *= 4f;
						num50 *= 1.3f;
					}
					if (flag3)
					{
						num53 *= 2f;
					}
					num51 -= Main.player[target].velocity.X * num53;
					num52 -= Main.player[target].velocity.Y * num53 / 4f;
					num51 *= 1f + (float)Main.rand.Next(-10, 11) * 0.01f;
					num52 *= 1f + (float)Main.rand.Next(-10, 11) * 0.01f;
					if (flag3)
					{
						num51 *= 1f + (float)Main.rand.Next(-10, 11) * 0.01f;
						num52 *= 1f + (float)Main.rand.Next(-10, 11) * 0.01f;
					}
					float num54 = (float)Math.Sqrt(num51 * num51 + num52 * num52);
					float num55 = num54;
					num54 = num50 / num54;
					velocity.X = num51 * num54;
					velocity.Y = num52 * num54;
					velocity.X += (float)Main.rand.Next(-20, 21) * 0.1f;
					velocity.Y += (float)Main.rand.Next(-20, 21) * 0.1f;
					if (flag3)
					{
						velocity.X += (float)Main.rand.Next(-50, 51) * 0.1f;
						velocity.Y += (float)Main.rand.Next(-50, 51) * 0.1f;
						float num56 = Math.Abs(velocity.X);
						float num57 = Math.Abs(velocity.Y);
						if (base.Center.X > Main.player[target].Center.X)
						{
							num57 *= -1f;
						}
						if (base.Center.Y > Main.player[target].Center.Y)
						{
							num56 *= -1f;
						}
						velocity.X = num57 + velocity.X;
						velocity.Y = num56 + velocity.Y;
						velocity.Normalize();
						velocity *= num50;
						velocity.X += (float)Main.rand.Next(-20, 21) * 0.1f;
						velocity.Y += (float)Main.rand.Next(-20, 21) * 0.1f;
					}
					else if (num55 < 100f)
					{
						if (Math.Abs(velocity.X) > Math.Abs(velocity.Y))
						{
							float num58 = Math.Abs(velocity.X);
							float num59 = Math.Abs(velocity.Y);
							if (base.Center.X > Main.player[target].Center.X)
							{
								num59 *= -1f;
							}
							if (base.Center.Y > Main.player[target].Center.Y)
							{
								num58 *= -1f;
							}
							velocity.X = num59;
							velocity.Y = num58;
						}
					}
					else if (Math.Abs(velocity.X) > Math.Abs(velocity.Y))
					{
						float num60 = (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) / 2f;
						float num61 = num60;
						if (base.Center.X > Main.player[target].Center.X)
						{
							num61 *= -1f;
						}
						if (base.Center.Y > Main.player[target].Center.Y)
						{
							num60 *= -1f;
						}
						velocity.X = num61;
						velocity.Y = num60;
					}
					this.ai[1] = 4f;
					NetUpdateIgnoreSpamLimit();
				}
			}
			else if (this.ai[1] == 4f)
			{
				if (this.ai[2] == 0f)
				{
					SoundEngine.PlaySound(36, (int)position.X, (int)position.Y, -1);
				}
				float num62 = num4;
				this.ai[2] += 1f;
				if (this.ai[2] == num62 && Vector2.Distance(position, Main.player[target].position) < 200f)
				{
					this.ai[2] -= 1f;
				}
				if (this.ai[2] >= num62)
				{
					velocity *= 0.95f;
					if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
					{
						velocity.X = 0f;
					}
					if ((double)velocity.Y > -0.1 && (double)velocity.Y < 0.1)
					{
						velocity.Y = 0f;
					}
				}
				else
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
				}
				float num63 = num62 + 13f;
				if (this.ai[2] >= num63)
				{
					NetUpdateIgnoreSpamLimit();
					this.ai[3] += 1f;
					this.ai[2] = 0f;
					if (this.ai[3] >= 5f)
					{
						this.ai[1] = 0f;
						this.ai[3] = 0f;
						if (target >= 0 && Main.getGoodWorld && Collision.CanHit(position, width, height, Main.player[target].position, width, height))
						{
							SoundEngine.PlaySound(15, (int)position.X, (int)position.Y, 0);
							this.ai[0] = 2f;
							this.ai[1] = 0f;
							this.ai[2] = 0f;
							this.ai[3] = 1f;
							netUpdate = true;
						}
					}
					else
					{
						this.ai[1] = 3f;
					}
				}
			}
			else if (this.ai[1] == 5f)
			{
				float num64 = 600f;
				float num65 = 9f;
				float num66 = 0.3f;
				Vector2 vector11 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num67 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector11.X;
				float num68 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) + num64 - vector11.Y;
				float num69 = (float)Math.Sqrt(num67 * num67 + num68 * num68);
				num69 = num65 / num69;
				num67 *= num69;
				num68 *= num69;
				if (velocity.X < num67)
				{
					velocity.X += num66;
					if (velocity.X < 0f && num67 > 0f)
					{
						velocity.X += num66;
					}
				}
				else if (velocity.X > num67)
				{
					velocity.X -= num66;
					if (velocity.X > 0f && num67 < 0f)
					{
						velocity.X -= num66;
					}
				}
				if (velocity.Y < num68)
				{
					velocity.Y += num66;
					if (velocity.Y < 0f && num68 > 0f)
					{
						velocity.Y += num66;
					}
				}
				else if (velocity.Y > num68)
				{
					velocity.Y -= num66;
					if (velocity.Y > 0f && num68 < 0f)
					{
						velocity.Y -= num66;
					}
				}
				this.ai[2] += 1f;
				if (this.ai[2] >= 70f)
				{
					TargetClosest();
					this.ai[1] = 3f;
					this.ai[2] = -1f;
					this.ai[3] = Main.rand.Next(-3, 1);
					netUpdate = true;
				}
			}
			if (flag3 && this.ai[1] == 5f)
			{
				this.ai[1] = 3f;
			}
			return;
		}
		if (aiStyle == 5)
		{
			AI_005_EaterOfSouls();
			return;
		}
		if (aiStyle == 6)
		{
			AI_006_Worms();
			return;
		}
		if (aiStyle == 7)
		{
			AI_007_TownEntities();
			return;
		}
		if (aiStyle == 8)
		{
			bool flag4 = RedHatSkeletronAdjustmentsEnabled();
			if (type == 32)
			{
				int num70 = FindFirstNPC(35);
				if (num70 >= 0 && Main.npc[num70].ai[3] == 1f)
				{
					localAI[3] = 1f;
					flag4 = true;
				}
			}
			TargetClosest();
			velocity.X *= 0.93f;
			if (velocity.X > -0.1f && velocity.X < 0.1f)
			{
				velocity.X = 0f;
			}
			if (this.ai[0] == 0f)
			{
				this.ai[0] = 500f;
				if (type == 693)
				{
					localAI[1] = 150f;
				}
			}
			if (type == 172)
			{
				if (alpha < 255)
				{
					alpha++;
				}
				if (justHit)
				{
					alpha = 0;
				}
			}
			if (this.ai[2] != 0f && this.ai[3] != 0f)
			{
				position += netOffset;
				if (type == 172)
				{
					alpha = 255;
				}
				SoundEngine.PlaySound(SoundID.Item8, position);
				for (int num71 = 0; num71 < 50; num71++)
				{
					if (type == 29 || type == 45)
					{
						int num72 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, 0f, 0f, 100, default(Color), Main.rand.Next(1, 3));
						Dust dust = Main.dust[num72];
						dust.velocity *= 3f;
						if (Main.dust[num72].scale > 1f)
						{
							Main.dust[num72].noGravity = true;
						}
					}
					else if (type == 32)
					{
						int num73 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 172, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust = Main.dust[num73];
						dust.velocity *= 3f;
						Main.dust[num73].noGravity = true;
					}
					else if (type == 693)
					{
						Dust dust2 = Dust.NewDustDirect(position, width, height, 269, 0f, 0f, 100, Color.White, 1.5f);
						dust2.noLight = true;
						dust2.noGravity = true;
					}
					else if (type == 283 || type == 284)
					{
						int num74 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 173);
						Dust dust = Main.dust[num74];
						dust.velocity *= 2f;
						Main.dust[num74].scale = 1.4f;
					}
					else if (type == 285 || type == 286)
					{
						int num75 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 174, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust = Main.dust[num75];
						dust.velocity *= 3f;
						Main.dust[num75].noGravity = true;
					}
					else if (type == 281 || type == 282)
					{
						int num76 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 175, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust = Main.dust[num76];
						dust.velocity *= 3f;
						Main.dust[num76].noGravity = true;
					}
					else if (type == 172)
					{
						int num77 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 106, 0f, 0f, 100, default(Color), 2.5f);
						Dust dust = Main.dust[num77];
						dust.velocity *= 3f;
						Main.dust[num77].noGravity = true;
					}
					else if (type == 533)
					{
						int num78 = Dust.NewDust(position, width, height, 27, 0f, 0f, 100, default(Color), 2.5f);
						Dust dust = Main.dust[num78];
						dust.velocity *= 3f;
						Main.dust[num78].noGravity = true;
					}
					else
					{
						int num79 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Dust dust = Main.dust[num79];
						dust.velocity *= 3f;
						Main.dust[num79].noGravity = true;
					}
				}
				position -= netOffset;
				position.X = this.ai[2] * 16f - (float)(width / 2) + 8f;
				position.Y = this.ai[3] * 16f - (float)height;
				netOffset *= 0f;
				velocity.X = 0f;
				velocity.Y = 0f;
				this.ai[2] = 0f;
				this.ai[3] = 0f;
				if (type == 693)
				{
					localAI[0] = 0f;
					localAI[1] = 650f;
					localAI[3] = 0f;
				}
				SoundEngine.PlaySound(SoundID.Item8, position);
				for (int num80 = 0; num80 < 50; num80++)
				{
					if (type == 29 || type == 45)
					{
						int num81 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, 0f, 0f, 100, default(Color), Main.rand.Next(1, 3));
						Dust dust = Main.dust[num81];
						dust.velocity *= 3f;
						if (Main.dust[num81].scale > 1f)
						{
							Main.dust[num81].noGravity = true;
						}
					}
					else if (type == 32)
					{
						int num82 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 172, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust = Main.dust[num82];
						dust.velocity *= 3f;
						Main.dust[num82].noGravity = true;
					}
					else if (type == 693)
					{
						Dust dust3 = Dust.NewDustDirect(position, width, height, 269, 0f, 0f, 100, Color.White, 1.5f);
						dust3.noLight = true;
						dust3.noGravity = true;
					}
					else if (type == 172)
					{
						int num83 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 106, 0f, 0f, 100, default(Color), 2.5f);
						Dust dust = Main.dust[num83];
						dust.velocity *= 3f;
						Main.dust[num83].noGravity = true;
					}
					else if (type == 283 || type == 284)
					{
						int num84 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 173);
						Dust dust = Main.dust[num84];
						dust.velocity *= 2f;
						Main.dust[num84].scale = 1.4f;
					}
					else if (type == 285 || type == 286)
					{
						int num85 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 174, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust = Main.dust[num85];
						dust.velocity *= 3f;
						Main.dust[num85].noGravity = true;
					}
					else if (type == 281 || type == 282)
					{
						int num86 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 175, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust = Main.dust[num86];
						dust.velocity *= 3f;
						Main.dust[num86].noGravity = true;
					}
					else if (type == 533)
					{
						int num87 = Dust.NewDust(position, width, height, 27, 0f, 0f, 100, default(Color), 2.5f);
						Dust dust = Main.dust[num87];
						dust.velocity *= 3f;
						Main.dust[num87].noGravity = true;
					}
					else
					{
						int num88 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Dust dust = Main.dust[num88];
						dust.velocity *= 3f;
						Main.dust[num88].noGravity = true;
					}
				}
			}
			this.ai[0] += 1f;
			if (type == 693)
			{
				localAI[0]++;
				if (localAI[2] > 0f)
				{
					localAI[2]--;
				}
				if (localAI[3] == 0f && localAI[0] > 1f)
				{
					localAI[3] = direction;
				}
			}
			if (type == 283 || type == 284)
			{
				if (this.ai[0] == 100f || this.ai[0] == 150f || this.ai[0] == 200f || this.ai[0] == 250f || this.ai[0] == 300f)
				{
					this.ai[1] = 30f;
					netUpdate = true;
				}
				if (this.ai[0] >= 450f)
				{
					this.ai[0] = 700f;
				}
			}
			else if (type == 172)
			{
				if (this.ai[0] == 75f || this.ai[0] == 150f || this.ai[0] == 225f || this.ai[0] == 300f || this.ai[0] == 375f || this.ai[0] == 450f)
				{
					this.ai[1] = 30f;
					netUpdate = true;
				}
			}
			else if (type == 533)
			{
				if (this.ai[0] == 180f)
				{
					this.ai[1] = 181f;
					netUpdate = true;
				}
			}
			else if (type == 281 || type == 282)
			{
				if (this.ai[0] == 100f || this.ai[0] == 120f || this.ai[0] == 140f || this.ai[0] == 200f || this.ai[0] == 220f || this.ai[0] == 240f || this.ai[0] == 300f || this.ai[0] == 320f || this.ai[0] == 340f)
				{
					this.ai[1] = 30f;
					netUpdate = true;
				}
				if (this.ai[0] >= 540f)
				{
					this.ai[0] = 700f;
				}
			}
			else
			{
				if (Main.getGoodWorld && type == 24 && AnyNPCs(113))
				{
					this.ai[0] += 1f;
					if (this.ai[0] % 2f == 1f)
					{
						this.ai[0] -= 1f;
					}
				}
				if (flag4)
				{
					this.ai[0] += 1f;
					if (this.ai[0] % 2f == 1f)
					{
						this.ai[0] -= 1f;
					}
				}
				if (this.ai[0] == 100f || this.ai[0] == 200f || this.ai[0] == 300f)
				{
					this.ai[1] = 30f;
					netUpdate = true;
				}
			}
			if ((type == 285 || type == 286) && this.ai[0] > 400f)
			{
				this.ai[0] = 650f;
			}
			if (type == 533 && this.ai[0] >= 360f)
			{
				this.ai[0] = 650f;
			}
			if (this.ai[0] >= 650f && Main.netMode != 1)
			{
				this.ai[0] = 1f;
				int num89 = (int)Main.player[target].Center.X / 16;
				int num90 = (int)Main.player[target].Center.Y / 16;
				Vector2 destination = Vector2.Zero;
				int num91 = 20;
				if (type == 24)
				{
					num91 = 5;
				}
				bool flag5 = type == 693 && AI_AttemptToFindTeleportSpotNearBooks(new Point(num89, num90), 30, out destination);
				if (!flag5)
				{
					flag5 = AI_AttemptToFindTeleportSpot(ref destination, num89, num90);
				}
				if (flag5)
				{
					this.ai[1] = num91;
					this.ai[2] = destination.X;
					this.ai[3] = destination.Y;
				}
				netUpdate = true;
			}
			if (this.ai[1] > 0f)
			{
				int num92 = 25;
				this.ai[1] -= 1f;
				if (type == 533)
				{
					if (this.ai[1] % 30f == 0f && this.ai[1] / 30f < 5f)
					{
						SoundEngine.PlaySound(SoundID.Item8, position);
						if (Main.netMode != 1)
						{
							Point point = base.Center.ToTileCoordinates();
							Point point2 = Main.player[target].Center.ToTileCoordinates();
							Vector2 vector12 = Main.player[target].Center - base.Center;
							int num93 = 6;
							int num94 = 6;
							int num95 = 0;
							int num96 = 2;
							int num97 = 0;
							bool flag6 = false;
							if (vector12.Length() > 2000f)
							{
								flag6 = true;
							}
							while (!flag6 && num97 < 50)
							{
								num97++;
								int num98 = Main.rand.Next(point2.X - num93, point2.X + num93 + 1);
								int num99 = Main.rand.Next(point2.Y - num93, point2.Y + num93 + 1);
								if ((num99 < point2.Y - num95 || num99 > point2.Y + num95 || num98 < point2.X - num95 || num98 > point2.X + num95) && (num99 < point.Y - num94 || num99 > point.Y + num94 || num98 < point.X - num94 || num98 > point.X + num94) && !Main.tile[num98, num99].nactive())
								{
									bool flag7 = true;
									if (flag7 && Main.tile[num98, num99].lava())
									{
										flag7 = false;
									}
									if (flag7 && Collision.SolidTiles(num98 - num96, num98 + num96, num99 - num96, num99 + num96))
									{
										flag7 = false;
									}
									if (flag7)
									{
										Projectile.NewProjectile(GetSpawnSource_ForProjectile(), num98 * 16 + 8, num99 * 16 + 8, 0f, 0f, 596, 0, 1f, Main.myPlayer, target);
										flag6 = true;
										break;
									}
								}
							}
						}
					}
				}
				else if (type == 24)
				{
					if (this.ai[1] == 10f)
					{
						SoundEngine.PlaySound(SoundID.Item8, position);
						NewNPC(GetSpawnSourceForProjectileNPC(), (int)position.X + width / 2 + direction * 8, (int)position.Y + 20, 25);
					}
				}
				else if (this.ai[1] == (float)num92)
				{
					if (type >= 281 && type <= 286)
					{
						if (Main.netMode != 1)
						{
							float num100 = 6f;
							if (type == 285 || type == 286)
							{
								num100 = 8f;
							}
							if (type == 281 || type == 282)
							{
								num100 = 4f;
							}
							Vector2 vector13 = new Vector2(position.X + (float)width * 0.5f, position.Y);
							float num101 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector13.X;
							float num102 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector13.Y;
							if (type == 283 || type == 284)
							{
								num101 += (float)Main.rand.Next(-30, 31);
								num102 += (float)Main.rand.Next(-30, 31);
								num101 -= Main.player[target].velocity.X * 10f;
								num102 -= Main.player[target].velocity.Y * 10f;
							}
							float num103 = (float)Math.Sqrt(num101 * num101 + num102 * num102);
							num103 = num100 / num103;
							num101 *= num103;
							num102 *= num103;
							int num104 = 30;
							int num105 = 290;
							if (type == 285 || type == 286)
							{
								num105 = 291;
								num104 = 40;
							}
							if (type == 281 || type == 282)
							{
								num105 = 293;
								num104 = 40;
							}
							num104 = GetAttackDamage_ForProjectiles(num104, (float)num104 * 0.8f);
							int num106 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector13.X, vector13.Y, num101, num102, num105, num104, 0f, Main.myPlayer);
							Main.projectile[num106].timeLeft = 300;
							if (num105 == 291)
							{
								Main.projectile[num106].ai[0] = Main.player[target].Center.X;
								Main.projectile[num106].ai[1] = Main.player[target].Center.Y;
								Main.projectile[num106].netUpdate = true;
							}
							localAI[0] = 0f;
						}
					}
					else
					{
						if (type != 172)
						{
							SoundEngine.PlaySound(SoundID.Item8, position);
						}
						if (Main.netMode != 1)
						{
							if (type == 29)
							{
								NewNPC(GetSpawnSourceForProjectileNPC(), (int)position.X + width / 2, (int)position.Y - 8, 30);
							}
							else if (type == 45)
							{
								NewNPC(GetSpawnSourceForProjectileNPC(), (int)position.X + width / 2, (int)position.Y - 8, 665);
							}
							else if (type == 32)
							{
								NewNPC(GetSpawnSourceForProjectileNPC(), (int)position.X + width / 2, (int)position.Y - 8, 33, 0, 0f, 0f, 0f, flag4 ? 1 : 0);
							}
							else if (type == 693)
							{
								Vector2 vec = base.Center;
								Point searchPosition = vec.ToTileCoordinates();
								searchPosition.X -= 10;
								searchPosition.Y -= 20;
								if (AI_FindNearbyBook(searchPosition, 20, 30, out var bookPosition))
								{
									vec = bookPosition.ToWorldCoordinates();
								}
								else
								{
									vec += Main.rand.NextVector2Circular(30f, 15f);
								}
								Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vec.X, vec.Y, 0f, 0f, 1092, 13, 0f, Main.myPlayer, 0f, 45f, target);
							}
							else if (type == 172)
							{
								float num107 = 10f;
								Vector2 vector14 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
								float num108 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector14.X + (float)Main.rand.Next(-10, 11);
								float num109 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector14.Y + (float)Main.rand.Next(-10, 11);
								float num110 = (float)Math.Sqrt(num108 * num108 + num109 * num109);
								num110 = num107 / num110;
								num108 *= num110;
								num109 *= num110;
								int num111 = 40;
								int num112 = 129;
								int num113 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector14.X, vector14.Y, num108, num109, num112, num111, 0f, Main.myPlayer);
								Main.projectile[num113].timeLeft = 300;
								localAI[0] = 0f;
							}
						}
					}
				}
			}
			position += netOffset;
			if (type == 29 || type == 45)
			{
				if (Main.rand.Next(5) == 0)
				{
					int num114 = Dust.NewDust(new Vector2(position.X, position.Y + 2f), width, height, 27, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 1.5f);
					Main.dust[num114].noGravity = true;
					Main.dust[num114].velocity.X *= 0.5f;
					Main.dust[num114].velocity.Y = -2f;
				}
			}
			else if (type == 32)
			{
				if (Main.rand.Next(3) != 0)
				{
					int num115 = Dust.NewDust(new Vector2(position.X, position.Y + 2f), width, height, 172, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 0.9f);
					Main.dust[num115].noGravity = true;
					Main.dust[num115].velocity.X *= 0.3f;
					Main.dust[num115].velocity.Y *= 0.2f;
					Main.dust[num115].velocity.Y -= 1f;
				}
			}
			else if (type == 693)
			{
				float num116 = Utils.Remap(this.ai[0], 0f, 60f, 0f, 1f);
				num116 *= num116;
				if (num116 > 0f)
				{
					Lighting.AddLight(base.Top, num116 * 0.91f, num116 * 0.82f, num116 * 0.57f);
				}
			}
			else if (type == 172)
			{
				int num117 = 1;
				if (alpha == 255)
				{
					num117 = 2;
				}
				for (int num118 = 0; num118 < num117; num118++)
				{
					if (Main.rand.Next(255) > 255 - alpha)
					{
						int num119 = Dust.NewDust(new Vector2(position.X, position.Y + 2f), width, height, 106, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 1.2f);
						Main.dust[num119].noGravity = true;
						Main.dust[num119].velocity.X *= 0.1f + (float)Main.rand.Next(30) * 0.01f;
						Main.dust[num119].velocity.Y *= 0.1f + (float)Main.rand.Next(30) * 0.01f;
						Dust dust = Main.dust[num119];
						dust.scale *= 1f + (float)Main.rand.Next(6) * 0.1f;
					}
				}
			}
			else if (type == 283 || type == 284)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num120 = Dust.NewDust(new Vector2(position.X, position.Y + 2f), width, height, 173);
					Main.dust[num120].velocity.X *= 0.5f;
					Main.dust[num120].velocity.Y *= 0.5f;
				}
			}
			else if (type == 285 || type == 286)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num121 = Dust.NewDust(new Vector2(position.X, position.Y + 2f), width, height, 174, velocity.X * 0.2f, velocity.Y * 0.2f, 100);
					Main.dust[num121].noGravity = true;
					Dust dust = Main.dust[num121];
					dust.velocity *= 0.4f;
					Main.dust[num121].velocity.Y -= 0.7f;
				}
			}
			else if (type == 281 || type == 282)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num122 = Dust.NewDust(new Vector2(position.X, position.Y + 2f), width, height, 175, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 0.1f);
					Main.dust[num122].noGravity = true;
					Dust dust = Main.dust[num122];
					dust.velocity *= 0.5f;
					Main.dust[num122].fadeIn = 1.2f;
				}
			}
			else if (type == 533)
			{
				Lighting.AddLight(base.Top, 0.6f, 0.6f, 0.3f);
			}
			else
			{
				float num123 = 0.6f;
				Lighting.AddLight(base.Center, num123, num123 * 0.65f, num123 * 0.4f);
				if (Main.rand.Next(6) == 0)
				{
					int num124 = Dust.NewDust(new Vector2(position.X, position.Y + 2f), width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 1.65f);
					Main.dust[num124].noGravity = true;
					Main.dust[num124].velocity.X *= 1f;
					Main.dust[num124].velocity.Y *= 1f;
				}
			}
			position -= netOffset;
			return;
		}
		if (aiStyle == 9)
		{
			bool flag8 = RedHatSkeletronAdjustmentsEnabled();
			if (type == 516)
			{
				if (alpha < 220)
				{
					alpha += 40;
				}
				if (this.ai[0] == 0f)
				{
					this.ai[0] = 1f;
					Vector2 vector15 = Main.player[target].Center - base.Center;
					vector15.Normalize();
					if (vector15.HasNaNs())
					{
						vector15 = -Vector2.UnitY;
					}
					vector15 = vector15.RotatedByRandom(1.5707963705062866).RotatedBy(-0.7853981852531433);
					if (vector15.Y > 0.2f)
					{
						vector15.Y = 0.2f;
					}
					velocity = vector15 * (6f + Main.rand.NextFloat() * 4f);
				}
				if (collideX || collideY || Distance(Main.player[target].Center) < 20f)
				{
					StrikeNPCNoInteraction(9999, 0f, direction);
				}
			}
			if (target == 255)
			{
				TargetClosest();
				int num125 = 6;
				if (type == 25)
				{
					num125 = 5;
				}
				if (type == 112 || type == 666)
				{
					num125 = 7;
				}
				if (Main.getGoodWorld)
				{
					if (type == 33 && AnyNPCs(35))
					{
						num125 = 10;
						if (flag8)
						{
							num125 = 8;
						}
					}
					if (type == 25 && AnyNPCs(113))
					{
						num125 = 14;
					}
					if (type == 666)
					{
						num125 = 10;
					}
				}
				Vector2 center = base.Center;
				float num126 = Main.player[target].Center.X - center.X;
				float num127 = Main.player[target].Center.Y - center.Y;
				float num128 = (float)Math.Sqrt(num126 * num126 + num127 * num127);
				if (num128 <= 0f)
				{
					num128 = 1f;
				}
				num128 = (float)num125 / num128;
				velocity.X = num126 * num128;
				velocity.Y = num127 * num128;
			}
			if (Main.getGoodWorld && !dontTakeDamage)
			{
				if (type == 33 && AnyNPCs(35))
				{
					dontTakeDamage = true;
				}
				else if (type == 25 && AnyNPCs(113))
				{
					dontTakeDamage = true;
				}
				else if (type == 666 && (double)(base.Center.Y / 16f) < Main.worldSurface)
				{
					dontTakeDamage = true;
				}
			}
			if (type == 112 || type == 666)
			{
				damage = defDamage;
				if (type == 666)
				{
					damage = GetAttackDamage_CappedAtMaster(32f);
				}
				this.ai[0] += 1f;
				if (this.ai[0] > 3f)
				{
					this.ai[0] = 3f;
				}
				if (this.ai[0] == 2f)
				{
					position += velocity;
					SoundEngine.PlaySound(4, (int)position.X, (int)position.Y, 9);
					for (int num129 = 0; num129 < 20; num129++)
					{
						int num130 = Dust.NewDust(new Vector2(position.X, position.Y + 2f) + netOffset, width, height, 18, 0f, 0f, 100, default(Color), 1.8f);
						Dust dust = Main.dust[num130];
						dust.velocity *= 1.3f;
						dust = Main.dust[num130];
						dust.velocity += velocity;
						Main.dust[num130].noGravity = true;
					}
				}
			}
			if ((type == 112 || type == 666) && Collision.SolidCollision(position, width, height))
			{
				_ = Main.netMode;
				_ = 1;
				StrikeNPCNoInteraction(9999, 0f, 0);
			}
			EncourageDespawn(100);
			if (type == 516)
			{
				rotation += 0.1f * (float)direction;
				float num131 = 15f;
				float num132 = 1f / 12f;
				Vector2 center2 = base.Center;
				Vector2 center3 = Main.player[target].Center;
				Vector2 vector16 = center3 - center2;
				vector16.Normalize();
				if (vector16.HasNaNs())
				{
					vector16 = new Vector2(direction, 0f);
				}
				velocity = (velocity * (num131 - 1f) + vector16 * (velocity.Length() + num132)) / num131;
				if (velocity.Length() < 6f)
				{
					velocity *= 1.05f;
				}
				return;
			}
			position += netOffset;
			for (int num133 = 0; num133 < 2; num133++)
			{
				if (type == 30 || type == 665)
				{
					alpha = 255;
					for (int num134 = 0; num134 < 2; num134++)
					{
						int num135 = Dust.NewDust(new Vector2(position.X, position.Y + 2f), width, height, 27, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 1.3f);
						Main.dust[num135].noGravity = true;
						Dust dust = Main.dust[num135];
						dust.velocity *= 0.3f;
						Main.dust[num135].velocity.X -= velocity.X * 0.2f;
						Main.dust[num135].velocity.Y -= velocity.Y * 0.2f;
					}
				}
				else if (type == 33)
				{
					for (int num136 = 0; num136 < 3; num136++)
					{
						float num137 = velocity.X / 3f * (float)num133;
						float num138 = velocity.Y / 3f * (float)num133;
						int num139 = 2;
						int num140 = Dust.NewDust(new Vector2(position.X + (float)num139, position.Y + (float)num139), width - num139 * 2, height - num139 * 2, 172, 0f, 0f, 100, default(Color), 1.2f);
						Main.dust[num140].noGravity = true;
						Dust dust = Main.dust[num140];
						dust.velocity *= 0.1f;
						dust = Main.dust[num140];
						dust.velocity += velocity * 0.5f;
						Main.dust[num140].position.X -= num137;
						Main.dust[num140].position.Y -= num138;
					}
					if (Main.rand.Next(5) == 0)
					{
						int num141 = 2;
						int num142 = Dust.NewDust(new Vector2(position.X + (float)num141, position.Y + (float)num141), width - num141 * 2, height - num141 * 2, 172, 0f, 0f, 100, default(Color), 0.6f);
						Dust dust = Main.dust[num142];
						dust.velocity *= 0.25f;
						dust = Main.dust[num142];
						dust.velocity += velocity * 0.5f;
					}
				}
				else if (type == 112 || type == 666)
				{
					int num143 = Dust.NewDust(new Vector2(position.X, position.Y + 2f), width, height, 18, velocity.X * 0.1f, velocity.Y * 0.1f, 80, default(Color), 1.3f);
					Dust dust = Main.dust[num143];
					dust.velocity *= 0.3f;
					Main.dust[num143].noGravity = true;
				}
				else
				{
					Lighting.AddLight((int)((position.X + (float)(width / 2)) / 16f), (int)((position.Y + (float)(height / 2)) / 16f), 1f, 0.3f, 0.1f);
					int num144 = Dust.NewDust(new Vector2(position.X, position.Y + 2f), width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
					Main.dust[num144].noGravity = true;
					Main.dust[num144].velocity.X *= 0.3f;
					Main.dust[num144].velocity.Y *= 0.3f;
				}
			}
			rotation += 0.4f * (float)direction;
			position -= netOffset;
			return;
		}
		if (aiStyle == 10)
		{
			bool flag9 = type == 694;
			bool flag10 = flag9;
			bool flag11 = !flag9;
			bool flag12 = flag9;
			float num145 = 1f;
			float num146 = 0.011f;
			int num147 = 600;
			int num148 = num147 + 50;
			int num149 = 80;
			if (flag11 || !Main.player[target].active || Main.player[target].dead)
			{
				TargetClosest();
			}
			Vector2 center4 = base.Center;
			float num150 = Main.player[target].Center.X - center4.X;
			float num151 = Main.player[target].Center.Y - center4.Y;
			float num152 = (float)Math.Sqrt(num150 * num150 + num151 * num151);
			float num153 = num152;
			if (this.ai[3] != 3f)
			{
				this.ai[1]++;
			}
			bool flag13 = this.ai[2] >= 0f && this.ai[3] == 2f;
			bool flag14 = this.ai[2] >= 0f && this.ai[3] == 1f;
			bool flag15 = this.ai[1] > (float)num147;
			bool flag16 = this.ai[1] < -30f;
			bool flag17 = flag10 && !flag13 && !flag14 && !flag15 && flag16;
			if (this.ai[3] == 3f)
			{
				spriteDirection = 1;
				rotation = 0f;
				velocity = Vector2.Zero;
				knockBackResist = 0f;
				if (justHit)
				{
					this.ai[3] = 4f;
					netUpdate = true;
				}
				return;
			}
			if (this.ai[3] == 4f)
			{
				spriteDirection = 1;
				rotation = 0f;
				velocity = Vector2.Zero;
				knockBackResist = 1f;
				if (this.ai[1] > (float)num149)
				{
					this.ai[1] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
				return;
			}
			if (flag9)
			{
				knockBackResist = 0.2f;
				dontTakeDamage = this.ai[3] == 4f;
			}
			if (!flag13)
			{
				if (flag15)
				{
					num146 *= 8f;
					num145 = 4f;
					if (this.ai[1] > (float)num148)
					{
						this.ai[1] = 0f;
					}
					netUpdate = true;
				}
				else if (flag10 && num153 < 100f && this.ai[1] >= 0f)
				{
					if (this.ai[1] != -59f)
					{
						netUpdate = true;
					}
					this.ai[1] = -60f;
				}
				else if (num153 < 250f)
				{
					this.ai[0] += 0.9f;
					if (this.ai[0] > 0f)
					{
						velocity.Y += 0.019f;
					}
					else
					{
						velocity.Y -= 0.019f;
					}
					if (this.ai[0] < -100f || this.ai[0] > 100f)
					{
						velocity.X += 0.019f;
					}
					else
					{
						velocity.X -= 0.019f;
					}
					if (this.ai[0] > 200f)
					{
						this.ai[0] = -200f;
						netUpdate = true;
					}
				}
			}
			if (flag17)
			{
				num145 = 8f;
				num146 = 0.25f;
			}
			else if (num153 > 350f)
			{
				num145 = 5f;
				num146 = 0.3f;
			}
			else if (num153 > 300f)
			{
				num145 = 3f;
				num146 = 0.2f;
			}
			else if (num153 > 250f)
			{
				num145 = 1.5f;
				num146 = 0.1f;
			}
			num152 = num145 / num152;
			num150 *= num152;
			num151 *= num152;
			float num154 = num150;
			float num155 = num151;
			if (flag17)
			{
				num150 *= -1f;
				num151 *= -1f;
			}
			if (!Main.player[target].active || Main.player[target].dead)
			{
				num150 = (float)direction * num145 / 2f;
				num151 = (0f - num145) / 2f;
			}
			if (flag13)
			{
				float num156 = this.ai[2];
				if (num156 < 10f)
				{
					velocity *= 0.5f;
					if (num156 >= 18f)
					{
						velocity = Vector2.Zero;
					}
				}
				else
				{
					num146 = 14f;
					Vector2 v = ((velocity.Length() < 0.1f) ? (Main.player[target].Center - center4) : velocity);
					v = v.SafeNormalize(Vector2.UnitY) * num146;
					velocity = v;
				}
			}
			else
			{
				if (velocity.X < num150)
				{
					velocity.X += num146;
				}
				else if (velocity.X > num150)
				{
					velocity.X -= num146;
				}
				if (velocity.Y < num151)
				{
					velocity.Y += num146;
				}
				else if (velocity.Y > num151)
				{
					velocity.Y -= num146;
				}
			}
			if (!flag13)
			{
				if (num154 > 0f)
				{
					spriteDirection = -1;
					rotation = (float)Math.Atan2(num155, num154);
				}
				if (num154 < 0f)
				{
					spriteDirection = 1;
					rotation = (float)Math.Atan2(num155, num154) + (float)Math.PI;
				}
				if (flag12)
				{
					spriteDirection *= -1;
				}
			}
			if (type == 289)
			{
				if (justHit)
				{
					this.ai[2] = 0f;
					this.ai[3] = 0f;
				}
				center4 = base.Center;
				num150 = Main.player[target].Center.X - center4.X;
				num151 = Main.player[target].Center.Y - center4.Y;
				num152 = (float)Math.Sqrt(num150 * num150 + num151 * num151);
				int num157 = 500;
				int num158 = 120;
				int num159 = 40;
				int num160 = 20;
				if (num152 <= (float)num157)
				{
					this.ai[2]++;
					if (this.ai[3] == 0f)
					{
						if (this.ai[2] > (float)num158)
						{
							this.ai[2] = 0f;
							this.ai[3] = 1f;
							netUpdate = true;
						}
					}
					else
					{
						if (this.ai[2] > (float)num159)
						{
							if (this.ai[3] != 0f)
							{
								netUpdate = true;
							}
							this.ai[3] = 0f;
						}
						if (Main.netMode != 1 && this.ai[2] == (float)num160)
						{
							int num161 = 6;
							int num162 = 25;
							short num163 = 299;
							num152 = (float)num161 / num152;
							num150 *= num152;
							num151 *= num152;
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), center4.X, center4.Y, num150, num151, num163, num162, 0f, Main.myPlayer);
						}
					}
				}
				else
				{
					if (this.ai[2] != 0f || this.ai[3] != 0f)
					{
						netUpdate = true;
					}
					this.ai[2] = 0f;
					this.ai[3] = 0f;
				}
			}
			if (type != 694)
			{
				return;
			}
			if (justHit)
			{
				this.ai[2] = 0f;
				this.ai[3] = 0f;
			}
			center4 = base.Center + new Vector2(0f, 10f);
			num150 = Main.player[target].Center.X - center4.X;
			num151 = Main.player[target].Center.Y - center4.Y;
			num152 = (float)Math.Sqrt(num150 * num150 + num151 * num151);
			int num164 = 500;
			int num165 = 100;
			int num166 = 300;
			int num167 = 120;
			int num168 = 30;
			int num169 = 60;
			int num170 = 17;
			int num171 = 300;
			bool flag18 = num152 >= (float)num165 && num152 <= (float)num166 && this.ai[2] >= 0f && (this.ai[3] == 0f || this.ai[3] == 2f);
			bool flag19 = num152 <= (float)num164 && this.ai[2] >= 0f && (this.ai[3] == 0f || this.ai[3] == 1f);
			if (Main.netMode == 1)
			{
				return;
			}
			if (flag18 && (!flag19 || Main.rand.Next(3) == 0))
			{
				this.ai[2]++;
				if (this.ai[3] == 0f)
				{
					if (this.ai[2] > (float)num167)
					{
						this.ai[2] = 0f;
						this.ai[3] = 2f;
						netUpdate = true;
					}
				}
				else if (this.ai[3] == 2f && this.ai[2] > (float)num169)
				{
					this.ai[2] = -num171;
					this.ai[3] = 0f;
					netUpdate = true;
				}
			}
			else if (flag19)
			{
				this.ai[2]++;
				if (this.ai[3] == 0f)
				{
					if (this.ai[2] > (float)num167)
					{
						this.ai[2] = 0f;
						this.ai[3] = 1f;
						netUpdate = true;
					}
				}
				else
				{
					if (this.ai[3] != 1f)
					{
						return;
					}
					if (this.ai[2] > (float)num168)
					{
						this.ai[2] = 0f;
						this.ai[3] = 0f;
						netUpdate = true;
					}
					if (this.ai[2] == (float)num170)
					{
						SoundEngine.PlaySound(SoundID.Item8, position);
						if (Main.netMode != 1)
						{
							NewNPC(GetSpawnSourceForProjectileNPC(), (int)center4.X, (int)center4.Y, 33);
						}
					}
				}
			}
			else
			{
				this.ai[2]++;
				if (this.ai[2] > 0f)
				{
					this.ai[2] = 0f;
				}
				if (this.ai[3] != 0f)
				{
					netUpdate = true;
				}
				this.ai[3] = 0f;
			}
			return;
		}
		if (aiStyle == 11)
		{
			bool flag20 = RedHatSkeletronAdjustmentsEnabled();
			reflectsProjectiles = false;
			defense = defDefense;
			if (this.ai[0] == 0f && Main.netMode != 1)
			{
				TargetClosest();
				this.ai[0] = 1f;
				if (type != 68)
				{
					int num172 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)position.Y + height / 2, 36, whoAmI);
					Main.npc[num172].ai[0] = -1f;
					Main.npc[num172].ai[1] = whoAmI;
					Main.npc[num172].target = target;
					Main.npc[num172].netUpdate = true;
					num172 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)position.Y + height / 2, 36, whoAmI);
					Main.npc[num172].ai[0] = 1f;
					Main.npc[num172].ai[1] = whoAmI;
					Main.npc[num172].ai[3] = 150f;
					Main.npc[num172].target = target;
					Main.npc[num172].netUpdate = true;
				}
			}
			if ((type == 68 || Main.netMode == 1) && localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlaySound(15, (int)position.X, (int)position.Y, 0);
			}
			Player player = Main.player[target];
			if (player.dead || Math.Abs(position.X - player.position.X) > 2000f || Math.Abs(position.Y - player.position.Y) > 2000f)
			{
				TargetClosest();
				player = Main.player[target];
				if (player.dead || Math.Abs(position.X - player.position.X) > 2000f || Math.Abs(position.Y - player.position.Y) > 2000f)
				{
					this.ai[1] = 3f;
				}
			}
			if ((type == 68 || Main.IsItDay()) && this.ai[1] != 3f && this.ai[1] != 2f)
			{
				this.ai[1] = 2f;
				SoundEngine.PlaySound(15, (int)position.X, (int)position.Y, 0);
			}
			int num173 = 0;
			if (Main.expertMode)
			{
				for (int num174 = 0; num174 < Main.maxNPCs; num174++)
				{
					if (Main.npc[num174].active && Main.npc[num174].type == type + 1)
					{
						num173++;
					}
				}
				defense += num173 * 25;
				if ((num173 < 2 || (double)life < (double)lifeMax * 0.75) && this.ai[1] == 0f)
				{
					float num175 = 80f;
					if (num173 == 0)
					{
						num175 /= 2f;
					}
					if (Main.getGoodWorld)
					{
						num175 *= 0.8f;
					}
					if (Main.netMode != 1 && this.ai[2] % num175 == 0f)
					{
						Vector2 center5 = base.Center;
						if (Collision.CanHit(center5, 1, 1, player.position, player.width, player.height))
						{
							float num176 = 3f;
							if (num173 == 0)
							{
								num176 += 2f;
							}
							float num177 = player.Center.X - center5.X + (float)Main.rand.Next(-20, 21);
							float num178 = player.Center.Y - center5.Y + (float)Main.rand.Next(-20, 21);
							float num179 = (float)Math.Sqrt(num177 * num177 + num178 * num178);
							if (num179 <= 0f)
							{
								num179 = 1f;
							}
							num179 = num176 / num179;
							num177 *= num179;
							num178 *= num179;
							Vector2 vector17 = new Vector2(num177 * 1f + (float)Main.rand.Next(-50, 51) * 0.01f, num178 * 1f + (float)Main.rand.Next(-50, 51) * 0.01f);
							vector17.Normalize();
							vector17 *= num176;
							vector17 += velocity;
							num177 = vector17.X;
							num178 = vector17.Y;
							int attackDamage_ForProjectiles = GetAttackDamage_ForProjectiles(17f, 17f);
							int num180 = 270;
							center5 += vector17 * 5f;
							int num181 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), center5.X, center5.Y, num177, num178, num180, attackDamage_ForProjectiles, 0f, Main.myPlayer, -1f);
							Main.projectile[num181].timeLeft = 300;
						}
					}
				}
			}
			if (this.ai[1] == 0f)
			{
				damage = defDamage;
				if (flag20)
				{
					damage = (int)((double)damage * 1.3);
				}
				this.ai[2] += 1f;
				if (flag20)
				{
					this.ai[2] += 0.5f;
				}
				if (this.ai[2] >= 800f)
				{
					this.ai[2] = 0f;
					this.ai[1] = 1f;
					TargetClosest();
					netUpdate = true;
					if (flag20)
					{
						int num182 = Main.rand.Next(2, 6);
						if (Main.netMode == 0)
						{
							Main.NewText(Language.GetTextValue("SkeletronText.Taunt" + num182), byte.MaxValue, 0, 0);
						}
						else if (Main.netMode == 2)
						{
							ChatHelper.BroadcastChatMessage(NetworkText.FromKey("SkeletronText.Taunt" + num182), new Color(255, 0, 0));
						}
					}
				}
				rotation = velocity.X / 15f;
				float num183 = 0.02f;
				float num184 = 2f;
				float num185 = 0.05f;
				float num186 = 8f;
				if (Main.expertMode)
				{
					num183 = 0.03f;
					num184 = 4f;
					num185 = 0.07f;
					num186 = 9.5f;
				}
				if (flag20)
				{
					float num187 = 1.35f;
					num183 *= num187;
					num184 *= num187;
					num185 *= num187;
					num186 *= num187;
				}
				else if (Main.getGoodWorld)
				{
					num183 += 0.01f;
					num184 += 1f;
					num185 += 0.05f;
					num186 += 2f;
				}
				if (position.Y > player.position.Y - 250f)
				{
					if (velocity.Y > 0f)
					{
						velocity.Y *= 0.98f;
					}
					velocity.Y -= num183;
					if (velocity.Y > num184)
					{
						velocity.Y = num184;
					}
				}
				else if (position.Y < player.position.Y - 250f)
				{
					if (velocity.Y < 0f)
					{
						velocity.Y *= 0.98f;
					}
					velocity.Y += num183;
					if (velocity.Y < 0f - num184)
					{
						velocity.Y = 0f - num184;
					}
				}
				if (base.Center.X > player.Center.X)
				{
					if (velocity.X > 0f)
					{
						velocity.X *= 0.98f;
					}
					velocity.X -= num185;
					if (velocity.X > num186)
					{
						velocity.X = num186;
					}
				}
				if (base.Center.X < player.Center.X)
				{
					if (velocity.X < 0f)
					{
						velocity.X *= 0.98f;
					}
					velocity.X += num185;
					if (velocity.X < 0f - num186)
					{
						velocity.X = 0f - num186;
					}
				}
			}
			else if (this.ai[1] == 1f)
			{
				if (Main.getGoodWorld || flag20)
				{
					if (num173 > 0)
					{
						reflectsProjectiles = true;
					}
					if (Main.netMode != 1 && (num173 == 0 || flag20))
					{
						int num188 = 200;
						int num189 = 6;
						if (flag20)
						{
							num189 = 4;
						}
						if (this.ai[2] % (float)num188 == 0f && CountNPCS(32) < num189)
						{
							int num190 = 1;
							for (int num191 = 0; num191 < num190; num191++)
							{
								int num192 = 1000;
								for (int num193 = 0; num193 < num192; num193++)
								{
									int num194 = (int)(base.Center.X / 16f) + Main.rand.Next(-50, 51);
									int num195 = (int)(base.Center.Y / 16f) + Main.rand.Next(-50, 51);
									if (!WorldGen.InWorld(num194, num195))
									{
										continue;
									}
									for (; num195 < Main.maxTilesY - 10 && !WorldGen.SolidTile(num194, num195); num195++)
									{
									}
									num195--;
									if (!WorldGen.SolidTile(num194, num195))
									{
										int num196 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), num194 * 16 + 8, num195 * 16, 32);
										if (Main.netMode == 2 && num196 < Main.maxNPCs)
										{
											NetMessage.SendData(23, -1, -1, null, num196);
										}
										break;
									}
								}
							}
						}
					}
				}
				defense -= 10;
				this.ai[2] += 1f;
				if (this.ai[2] == 2f)
				{
					SoundEngine.PlaySound(15, (int)position.X, (int)position.Y, 0);
				}
				if (this.ai[2] >= 400f)
				{
					this.ai[2] = 0f;
					this.ai[1] = 0f;
				}
				rotation += (float)direction * 0.3f;
				Vector2 center6 = base.Center;
				float num197 = player.Center.X - center6.X;
				float num198 = player.Center.Y - center6.Y;
				float num199 = (float)Math.Sqrt(num197 * num197 + num198 * num198);
				if (num199 <= 0f)
				{
					num199 = 1f;
				}
				float num200 = 1.5f;
				damage = GetAttackDamage_LerpBetweenFinalValues(defDamage, (float)defDamage * 1.3f);
				if (flag20)
				{
					damage = (int)((double)damage * 1.3);
				}
				if (Main.expertMode)
				{
					num200 = 3.5f;
					if (num199 > 150f)
					{
						num200 *= 1.05f;
					}
					if (num199 > 200f)
					{
						num200 *= 1.1f;
					}
					if (num199 > 250f)
					{
						num200 *= 1.1f;
					}
					if (num199 > 300f)
					{
						num200 *= 1.1f;
					}
					if (num199 > 350f)
					{
						num200 *= 1.1f;
					}
					if (num199 > 400f)
					{
						num200 *= 1.1f;
					}
					if (num199 > 450f)
					{
						num200 *= 1.1f;
					}
					if (num199 > 500f)
					{
						num200 *= 1.1f;
					}
					if (num199 > 550f)
					{
						num200 *= 1.1f;
					}
					if (num199 > 600f)
					{
						num200 *= 1.1f;
					}
					switch (num173)
					{
					case 0:
						num200 *= 1.1f;
						break;
					case 1:
						num200 *= 1.05f;
						break;
					}
				}
				if (flag20)
				{
					num200 *= 1.4f;
				}
				else if (Main.getGoodWorld)
				{
					num200 *= 1.3f;
				}
				num199 = num200 / num199;
				velocity.X = num197 * num199;
				velocity.Y = num198 * num199;
			}
			else if (this.ai[1] == 2f)
			{
				damage = 9999;
				defense = 9999;
				rotation += (float)direction * 0.3f;
				Vector2 center7 = base.Center;
				float num201 = player.Center.X - center7.X;
				float num202 = player.Center.Y - center7.Y;
				float num203 = (float)Math.Sqrt(num201 * num201 + num202 * num202);
				if (num203 <= 0f)
				{
					num203 = 1f;
				}
				num203 = 8f / num203;
				velocity.X = num201 * num203;
				velocity.Y = num202 * num203;
			}
			else if (this.ai[1] == 3f)
			{
				velocity.Y += 0.1f;
				if (velocity.Y < 0f)
				{
					velocity.Y *= 0.95f;
				}
				velocity.X *= 0.95f;
				EncourageDespawn(50);
			}
			if (this.ai[1] != 2f && this.ai[1] != 3f && type != 68 && (num173 != 0 || !Main.expertMode))
			{
				int num204 = Dust.NewDust(new Vector2(position.X + (float)(width / 2) - 15f - velocity.X * 5f, position.Y + (float)height - 2f), 30, 10, 5, (0f - velocity.X) * 0.2f, 3f, 0, default(Color), 2f);
				Main.dust[num204].noGravity = true;
				Main.dust[num204].velocity.X *= 1.3f;
				Main.dust[num204].velocity.X += velocity.X * 0.4f;
				Main.dust[num204].velocity.Y += 2f + velocity.Y;
				for (int num205 = 0; num205 < 2; num205++)
				{
					num204 = Dust.NewDust(new Vector2(position.X, position.Y + 120f), width, 60, 5, velocity.X, velocity.Y, 0, default(Color), 2f);
					Main.dust[num204].noGravity = true;
					Dust dust = Main.dust[num204];
					dust.velocity -= velocity;
					Main.dust[num204].velocity.Y += 5f;
				}
			}
			return;
		}
		if (aiStyle == 12)
		{
			spriteDirection = -(int)this.ai[0];
			if (!Main.npc[(int)this.ai[1]].active || Main.npc[(int)this.ai[1]].aiStyle != 11)
			{
				this.ai[2] += 10f;
				if (this.ai[2] > 50f || Main.netMode != 2)
				{
					life = -1;
					HitEffect();
					active = false;
				}
			}
			else
			{
				localAI[3] = Main.npc[(int)this.ai[1]].ai[3];
			}
			bool flag21 = RedHatSkeletronAdjustmentsEnabled();
			if (flag21)
			{
				damage = (int)((float)defDamage * 1.3f);
			}
			if (this.ai[2] == 0f || this.ai[2] == 3f)
			{
				if (Main.npc[(int)this.ai[1]].ai[1] == 3f)
				{
					EncourageDespawn(10);
				}
				if (Main.npc[(int)this.ai[1]].ai[1] != 0f && !flag21)
				{
					if (position.Y > Main.npc[(int)this.ai[1]].position.Y - 100f)
					{
						if (velocity.Y > 0f)
						{
							velocity.Y *= 0.96f;
						}
						velocity.Y -= 0.07f;
						if (velocity.Y > 6f)
						{
							velocity.Y = 6f;
						}
					}
					else if (position.Y < Main.npc[(int)this.ai[1]].position.Y - 100f)
					{
						if (velocity.Y < 0f)
						{
							velocity.Y *= 0.96f;
						}
						velocity.Y += 0.07f;
						if (velocity.Y < -6f)
						{
							velocity.Y = -6f;
						}
					}
					if (position.X + (float)(width / 2) > Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 120f * this.ai[0])
					{
						if (velocity.X > 0f)
						{
							velocity.X *= 0.96f;
						}
						velocity.X -= 0.1f;
						if (velocity.X > 8f)
						{
							velocity.X = 8f;
						}
					}
					if (position.X + (float)(width / 2) < Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 120f * this.ai[0])
					{
						if (velocity.X < 0f)
						{
							velocity.X *= 0.96f;
						}
						velocity.X += 0.1f;
						if (velocity.X < -8f)
						{
							velocity.X = -8f;
						}
					}
				}
				else
				{
					this.ai[3] += 1f;
					if (flag21)
					{
						this.ai[3] += 1f;
					}
					if (Main.expertMode)
					{
						this.ai[3] += 0.5f;
					}
					if (this.ai[3] >= 300f)
					{
						this.ai[2] += 1f;
						this.ai[3] = 0f;
						netUpdate = true;
					}
					if (Main.expertMode)
					{
						if (position.Y > Main.npc[(int)this.ai[1]].position.Y + 230f)
						{
							if (velocity.Y > 0f)
							{
								velocity.Y *= 0.96f;
							}
							velocity.Y -= 0.04f;
							if (velocity.Y > 3f)
							{
								velocity.Y = 3f;
							}
						}
						else if (position.Y < Main.npc[(int)this.ai[1]].position.Y + 230f)
						{
							if (velocity.Y < 0f)
							{
								velocity.Y *= 0.96f;
							}
							velocity.Y += 0.04f;
							if (velocity.Y < -3f)
							{
								velocity.Y = -3f;
							}
						}
						if (position.X + (float)(width / 2) > Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 200f * this.ai[0])
						{
							if (velocity.X > 0f)
							{
								velocity.X *= 0.96f;
							}
							velocity.X -= 0.07f;
							if (velocity.X > 8f)
							{
								velocity.X = 8f;
							}
						}
						if (position.X + (float)(width / 2) < Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 200f * this.ai[0])
						{
							if (velocity.X < 0f)
							{
								velocity.X *= 0.96f;
							}
							velocity.X += 0.07f;
							if (velocity.X < -8f)
							{
								velocity.X = -8f;
							}
						}
					}
					if (position.Y > Main.npc[(int)this.ai[1]].position.Y + 230f)
					{
						if (velocity.Y > 0f)
						{
							velocity.Y *= 0.96f;
						}
						velocity.Y -= 0.04f;
						if (velocity.Y > 3f)
						{
							velocity.Y = 3f;
						}
					}
					else if (position.Y < Main.npc[(int)this.ai[1]].position.Y + 230f)
					{
						if (velocity.Y < 0f)
						{
							velocity.Y *= 0.96f;
						}
						velocity.Y += 0.04f;
						if (velocity.Y < -3f)
						{
							velocity.Y = -3f;
						}
					}
					if (position.X + (float)(width / 2) > Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 200f * this.ai[0])
					{
						if (velocity.X > 0f)
						{
							velocity.X *= 0.96f;
						}
						velocity.X -= 0.07f;
						if (velocity.X > 8f)
						{
							velocity.X = 8f;
						}
					}
					if (position.X + (float)(width / 2) < Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 200f * this.ai[0])
					{
						if (velocity.X < 0f)
						{
							velocity.X *= 0.96f;
						}
						velocity.X += 0.07f;
						if (velocity.X < -8f)
						{
							velocity.X = -8f;
						}
					}
				}
				Vector2 vector18 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num206 = Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 200f * this.ai[0] - vector18.X;
				float num207 = Main.npc[(int)this.ai[1]].position.Y + 230f - vector18.Y;
				float num208 = Math.Max(0.01f, (float)Math.Sqrt(num206 * num206 + num207 * num207));
				rotation = (float)Math.Atan2(num207, num206) + 1.57f;
			}
			else if (this.ai[2] == 1f)
			{
				Vector2 vector19 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num209 = Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 200f * this.ai[0] - vector19.X;
				float num210 = Main.npc[(int)this.ai[1]].position.Y + 230f - vector19.Y;
				float num211 = Math.Max(0.01f, (float)Math.Sqrt(num209 * num209 + num210 * num210));
				rotation = (float)Math.Atan2(num210, num209) + 1.57f;
				velocity.X *= 0.95f;
				velocity.Y -= 0.1f;
				if (flag21)
				{
					float num212 = 15f;
					velocity.Y -= 0.09f;
					if (velocity.Y < 0f - num212)
					{
						velocity.Y = 0f - num212;
					}
				}
				else if (Main.expertMode)
				{
					velocity.Y -= 0.06f;
					if (velocity.Y < -13f)
					{
						velocity.Y = -13f;
					}
				}
				else if (velocity.Y < -8f)
				{
					velocity.Y = -8f;
				}
				if (position.Y < Main.npc[(int)this.ai[1]].position.Y - 200f)
				{
					TargetClosest();
					this.ai[2] = 2f;
					vector19 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					num209 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector19.X;
					num210 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector19.Y;
					num211 = Math.Max(0.01f, (float)Math.Sqrt(num209 * num209 + num210 * num210));
					num211 = (flag21 ? (24f / num211) : ((!Main.expertMode) ? (18f / num211) : (21f / num211)));
					velocity.X = num209 * num211;
					velocity.Y = num210 * num211;
					netUpdate = true;
				}
			}
			else if (this.ai[2] == 2f)
			{
				if (position.Y > Main.player[target].position.Y || Vector2.Dot(velocity, Main.player[target].Center - base.Center) <= 0f || Distance(Main.player[target].position) > 2000f || velocity.Y < 0f)
				{
					this.ai[2] = 3f;
				}
			}
			else if (this.ai[2] == 4f)
			{
				Vector2 vector20 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num213 = Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 200f * this.ai[0] - vector20.X;
				float num214 = Main.npc[(int)this.ai[1]].position.Y + 230f - vector20.Y;
				float num215 = Math.Max(0.01f, (float)Math.Sqrt(num213 * num213 + num214 * num214));
				rotation = (float)Math.Atan2(num214, num213) + 1.57f;
				velocity.Y *= 0.95f;
				velocity.X += 0.1f * (0f - this.ai[0]);
				if (flag21)
				{
					float num216 = 15f;
					velocity.X += 0.1f * (0f - this.ai[0]);
					if (velocity.X < 0f - num216)
					{
						velocity.X = 0f - num216;
					}
					else if (velocity.X > num216)
					{
						velocity.X = num216;
					}
				}
				else if (Main.expertMode)
				{
					velocity.X += 0.07f * (0f - this.ai[0]);
					if (velocity.X < -12f)
					{
						velocity.X = -12f;
					}
					else if (velocity.X > 12f)
					{
						velocity.X = 12f;
					}
				}
				else if (velocity.X < -8f)
				{
					velocity.X = -8f;
				}
				else if (velocity.X > 8f)
				{
					velocity.X = 8f;
				}
				if (position.X + (float)(width / 2) < Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 500f || position.X + (float)(width / 2) > Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) + 500f)
				{
					TargetClosest();
					this.ai[2] = 5f;
					vector20 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					num213 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector20.X;
					num214 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector20.Y;
					num215 = Math.Max(0.01f, (float)Math.Sqrt(num213 * num213 + num214 * num214));
					num215 = (flag21 ? (25f / num215) : ((!Main.expertMode) ? (17f / num215) : (22f / num215)));
					velocity.X = num213 * num215;
					velocity.Y = num214 * num215;
					netUpdate = true;
				}
			}
			else if (this.ai[2] == 5f && ((velocity.X > 0f && position.X + (float)(width / 2) > Main.player[target].position.X + (float)(Main.player[target].width / 2)) || (velocity.X < 0f && position.X + (float)(width / 2) < Main.player[target].position.X + (float)(Main.player[target].width / 2)) || Vector2.Dot(velocity, Main.player[target].Center - base.Center) <= 0f || Distance(Main.player[target].position) > 2000f))
			{
				this.ai[2] = 0f;
			}
			return;
		}
		if (aiStyle == 13)
		{
			if (this.ai[0] < 0f || this.ai[0] >= (float)Main.maxTilesX || this.ai[1] < 0f || this.ai[1] >= (float)Main.maxTilesX)
			{
				return;
			}
			if (Main.tile[(int)this.ai[0], (int)this.ai[1]] == null)
			{
				Main.tile[(int)this.ai[0], (int)this.ai[1]] = new Tile();
			}
			if (!Main.tile[(int)this.ai[0], (int)this.ai[1]].active())
			{
				life = -1;
				HitEffect();
				active = false;
				return;
			}
			FixExploitManEaters.ProtectSpot((int)this.ai[0], (int)this.ai[1]);
			TargetClosest();
			float num217 = 0.035f;
			float num218 = 150f;
			if (type == 43)
			{
				num218 = ((!Main.getGoodWorld) ? 250f : 350f);
			}
			if (type == 101)
			{
				num218 = 175f;
			}
			if (type == 259)
			{
				num218 = 100f;
			}
			if (type == 175)
			{
				num218 = 500f;
				num217 = 0.05f;
			}
			if (type == 260)
			{
				num218 = 350f;
				num217 = 0.15f;
			}
			this.ai[2] += 1f;
			if (this.ai[2] > 300f)
			{
				num218 = (int)((double)num218 * 1.3);
				if (this.ai[2] > 450f)
				{
					this.ai[2] = 0f;
				}
			}
			Vector2 vector21 = new Vector2(this.ai[0] * 16f + 8f, this.ai[1] * 16f + 8f);
			float num219 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - (float)(width / 2) - vector21.X;
			float num220 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - (float)(height / 2) - vector21.Y;
			float num221 = (float)Math.Sqrt(num219 * num219 + num220 * num220);
			if (num221 > num218)
			{
				num221 = num218 / num221;
				num219 *= num221;
				num220 *= num221;
			}
			if (position.X < this.ai[0] * 16f + 8f + num219)
			{
				velocity.X += num217;
				if (velocity.X < 0f && num219 > 0f)
				{
					velocity.X += num217 * 1.5f;
				}
			}
			else if (position.X > this.ai[0] * 16f + 8f + num219)
			{
				velocity.X -= num217;
				if (velocity.X > 0f && num219 < 0f)
				{
					velocity.X -= num217 * 1.5f;
				}
			}
			if (position.Y < this.ai[1] * 16f + 8f + num220)
			{
				velocity.Y += num217;
				if (velocity.Y < 0f && num220 > 0f)
				{
					velocity.Y += num217 * 1.5f;
				}
			}
			else if (position.Y > this.ai[1] * 16f + 8f + num220)
			{
				velocity.Y -= num217;
				if (velocity.Y > 0f && num220 < 0f)
				{
					velocity.Y -= num217 * 1.5f;
				}
			}
			if (type == 43)
			{
				if (Main.getGoodWorld)
				{
					if ((double)velocity.X > 3.5)
					{
						velocity.X = 3.5f;
					}
					if ((double)velocity.X < -3.5)
					{
						velocity.X = -3.5f;
					}
					if ((double)velocity.Y > 3.5)
					{
						velocity.Y = 3.5f;
					}
					if ((double)velocity.Y < -3.5)
					{
						velocity.Y = -3.5f;
					}
				}
				else
				{
					if (velocity.X > 3f)
					{
						velocity.X = 3f;
					}
					if (velocity.X < -3f)
					{
						velocity.X = -3f;
					}
					if (velocity.Y > 3f)
					{
						velocity.Y = 3f;
					}
					if (velocity.Y < -3f)
					{
						velocity.Y = -3f;
					}
				}
			}
			else if (type == 175)
			{
				if (velocity.X > 4f)
				{
					velocity.X = 4f;
				}
				if (velocity.X < -4f)
				{
					velocity.X = -4f;
				}
				if (velocity.Y > 4f)
				{
					velocity.Y = 4f;
				}
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
			}
			else
			{
				if (velocity.X > 2f)
				{
					velocity.X = 2f;
				}
				if (velocity.X < -2f)
				{
					velocity.X = -2f;
				}
				if (velocity.Y > 2f)
				{
					velocity.Y = 2f;
				}
				if (velocity.Y < -2f)
				{
					velocity.Y = -2f;
				}
			}
			if (type == 259 || type == 260)
			{
				rotation = (float)Math.Atan2(num220, num219) + 1.57f;
			}
			else
			{
				if (num219 > 0f)
				{
					spriteDirection = 1;
					rotation = (float)Math.Atan2(num220, num219);
				}
				if (num219 < 0f)
				{
					spriteDirection = -1;
					rotation = (float)Math.Atan2(num220, num219) + 3.14f;
				}
			}
			if (collideX)
			{
				netUpdate = true;
				velocity.X = oldVelocity.X * -0.7f;
				if (velocity.X > 0f && velocity.X < 2f)
				{
					velocity.X = 2f;
				}
				if (velocity.X < 0f && velocity.X > -2f)
				{
					velocity.X = -2f;
				}
			}
			if (collideY)
			{
				netUpdate = true;
				velocity.Y = oldVelocity.Y * -0.7f;
				if (velocity.Y > 0f && velocity.Y < 2f)
				{
					velocity.Y = 2f;
				}
				if (velocity.Y < 0f && velocity.Y > -2f)
				{
					velocity.Y = -2f;
				}
			}
			if (Main.netMode == 1)
			{
				return;
			}
			if (type == 101 && !Main.player[target].dead)
			{
				if (justHit)
				{
					localAI[0] = 0f;
				}
				localAI[0] += 1f;
				if (localAI[0] >= 120f)
				{
					if (!Collision.SolidCollision(position, width, height) && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
					{
						float num222 = 10f;
						vector21 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
						num219 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector21.X + (float)Main.rand.Next(-10, 11);
						num220 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector21.Y + (float)Main.rand.Next(-10, 11);
						num221 = (float)Math.Sqrt(num219 * num219 + num220 * num220);
						num221 = num222 / num221;
						num219 *= num221;
						num220 *= num221;
						int attackDamage_ForProjectiles2 = GetAttackDamage_ForProjectiles(22f, 17.6f);
						int num223 = 96;
						int num224 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector21.X, vector21.Y, num219, num220, num223, attackDamage_ForProjectiles2, 0f, Main.myPlayer);
						Main.projectile[num224].timeLeft = 300;
						localAI[0] = 0f;
					}
					else
					{
						localAI[0] = 100f;
					}
				}
			}
			if (type != 260 || Main.player[target].dead)
			{
				return;
			}
			if (justHit)
			{
				localAI[0] = 0f;
			}
			localAI[0] += 1f;
			if (!(localAI[0] >= 150f))
			{
				return;
			}
			if (!Collision.SolidCollision(position, width, height) && Collision.CanHit(this, Main.player[target]))
			{
				float num225 = 14f;
				vector21 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				num219 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector21.X + (float)Main.rand.Next(-10, 11);
				float num226 = Math.Abs(num219 * 0.1f);
				if (num220 > 0f)
				{
					num226 = 0f;
				}
				num220 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector21.Y + (float)Main.rand.Next(-10, 11) - num226;
				num221 = (float)Math.Sqrt(num219 * num219 + num220 * num220);
				num221 = num225 / num221;
				num219 *= num221;
				num220 *= num221;
				int num227 = NewNPC(GetSpawnSourceForProjectileNPC(), (int)base.Center.X, (int)base.Center.Y, 261);
				Main.npc[num227].velocity.X = num219;
				Main.npc[num227].velocity.Y = num220;
				Main.npc[num227].netUpdate = true;
				localAI[0] = 0f;
			}
			else
			{
				localAI[0] = 250f;
			}
			return;
		}
		if (aiStyle == 14)
		{
			noGravity = true;
			if (collideX)
			{
				velocity.X = oldVelocity.X * -0.5f;
				if (direction == -1 && velocity.X > 0f && velocity.X < 2f)
				{
					velocity.X = 2f;
				}
				if (direction == 1 && velocity.X < 0f && velocity.X > -2f)
				{
					velocity.X = -2f;
				}
			}
			if (collideY)
			{
				velocity.Y = oldVelocity.Y * -0.5f;
				if (velocity.Y > 0f && velocity.Y < 1f)
				{
					velocity.Y = 1f;
				}
				if (velocity.Y < 0f && velocity.Y > -1f)
				{
					velocity.Y = -1f;
				}
			}
			if (type == 226)
			{
				int num228 = 1;
				int num229 = 1;
				if (velocity.X < 0f)
				{
					num228 = -1;
				}
				if (velocity.Y < 0f)
				{
					num229 = -1;
				}
				TargetClosest();
				if (!Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
				{
					direction = num228;
					directionY = num229;
				}
			}
			else
			{
				TargetClosest();
			}
			if (type == 158)
			{
				if ((double)position.Y < Main.worldSurface * 16.0 && Main.IsItDay() && !Main.eclipse)
				{
					directionY = -1;
					direction *= -1;
				}
				if (direction == -1 && velocity.X > -7f)
				{
					velocity.X -= 0.2f;
					if (velocity.X > 4f)
					{
						velocity.X -= 0.1f;
					}
					else if (velocity.X > 0f)
					{
						velocity.X += 0.05f;
					}
					if (velocity.X < -7f)
					{
						velocity.X = -7f;
					}
				}
				else if (direction == 1 && velocity.X < 7f)
				{
					velocity.X += 0.2f;
					if (velocity.X < -4f)
					{
						velocity.X += 0.1f;
					}
					else if (velocity.X < 0f)
					{
						velocity.X -= 0.05f;
					}
					if (velocity.X > 7f)
					{
						velocity.X = 7f;
					}
				}
				if (directionY == -1 && velocity.Y > -7f)
				{
					velocity.Y -= 0.2f;
					if (velocity.Y > 4f)
					{
						velocity.Y -= 0.1f;
					}
					else if (velocity.Y > 0f)
					{
						velocity.Y += 0.05f;
					}
					if (velocity.Y < -7f)
					{
						velocity.Y = -7f;
					}
				}
				else if (directionY == 1 && velocity.Y < 7f)
				{
					velocity.Y += 0.2f;
					if (velocity.Y < -4f)
					{
						velocity.Y += 0.1f;
					}
					else if (velocity.Y < 0f)
					{
						velocity.Y -= 0.05f;
					}
					if (velocity.Y > 7f)
					{
						velocity.Y = 7f;
					}
				}
			}
			else if (type == 226)
			{
				if (direction == -1 && velocity.X > -4f)
				{
					velocity.X -= 0.2f;
					if (velocity.X > 4f)
					{
						velocity.X -= 0.1f;
					}
					else if (velocity.X > 0f)
					{
						velocity.X += 0.05f;
					}
					if (velocity.X < -4f)
					{
						velocity.X = -4f;
					}
				}
				else if (direction == 1 && velocity.X < 4f)
				{
					velocity.X += 0.2f;
					if (velocity.X < -4f)
					{
						velocity.X += 0.1f;
					}
					else if (velocity.X < 0f)
					{
						velocity.X -= 0.05f;
					}
					if (velocity.X > 4f)
					{
						velocity.X = 4f;
					}
				}
				if (directionY == -1 && (double)velocity.Y > -2.5)
				{
					velocity.Y -= 0.1f;
					if ((double)velocity.Y > 2.5)
					{
						velocity.Y -= 0.05f;
					}
					else if (velocity.Y > 0f)
					{
						velocity.Y += 0.03f;
					}
					if ((double)velocity.Y < -2.5)
					{
						velocity.Y = -2.5f;
					}
				}
				else if (directionY == 1 && (double)velocity.Y < 2.5)
				{
					velocity.Y += 0.1f;
					if ((double)velocity.Y < -2.5)
					{
						velocity.Y += 0.05f;
					}
					else if (velocity.Y < 0f)
					{
						velocity.Y -= 0.03f;
					}
					if ((double)velocity.Y > 2.5)
					{
						velocity.Y = 2.5f;
					}
				}
			}
			else if (type == 660)
			{
				float num230 = 0.1f;
				float num231 = 0.04f;
				float num232 = 4f;
				float num233 = 1.5f;
				int num234 = type;
				if (num234 == 660)
				{
					num230 = 0.35f;
					num231 = 0.3f;
					num232 = 6f;
					num233 = 5f;
				}
				if (direction == -1 && velocity.X > 0f - num232)
				{
					velocity.X -= num230;
					if (velocity.X > num232)
					{
						velocity.X -= num230;
					}
					else if (velocity.X > 0f)
					{
						velocity.X += num230 * 0.5f;
					}
					if (velocity.X < 0f - num232)
					{
						velocity.X = 0f - num232;
					}
				}
				else if (direction == 1 && velocity.X < num232)
				{
					velocity.X += num230;
					if (velocity.X < 0f - num232)
					{
						velocity.X += num230;
					}
					else if (velocity.X < 0f)
					{
						velocity.X -= num230 * 0.5f;
					}
					if (velocity.X > num232)
					{
						velocity.X = num232;
					}
				}
				if (directionY == -1 && velocity.Y > 0f - num233)
				{
					velocity.Y -= num231;
					if (velocity.Y > num233)
					{
						velocity.Y -= num231;
					}
					else if (velocity.Y > 0f)
					{
						velocity.Y += num231 * 0.75f;
					}
					if (velocity.Y < 0f - num233)
					{
						velocity.Y = 0f - num233;
					}
				}
				else if (directionY == 1 && velocity.Y < num233)
				{
					velocity.Y += num231;
					if (velocity.Y < 0f - num233)
					{
						velocity.Y += num231;
					}
					else if (velocity.Y < 0f)
					{
						velocity.Y -= num231 * 0.75f;
					}
					if (velocity.Y > num233)
					{
						velocity.Y = num233;
					}
				}
			}
			else
			{
				if (direction == -1 && velocity.X > -4f)
				{
					velocity.X -= 0.1f;
					if (velocity.X > 4f)
					{
						velocity.X -= 0.1f;
					}
					else if (velocity.X > 0f)
					{
						velocity.X += 0.05f;
					}
					if (velocity.X < -4f)
					{
						velocity.X = -4f;
					}
				}
				else if (direction == 1 && velocity.X < 4f)
				{
					velocity.X += 0.1f;
					if (velocity.X < -4f)
					{
						velocity.X += 0.1f;
					}
					else if (velocity.X < 0f)
					{
						velocity.X -= 0.05f;
					}
					if (velocity.X > 4f)
					{
						velocity.X = 4f;
					}
				}
				if (directionY == -1 && (double)velocity.Y > -1.5)
				{
					velocity.Y -= 0.04f;
					if ((double)velocity.Y > 1.5)
					{
						velocity.Y -= 0.05f;
					}
					else if (velocity.Y > 0f)
					{
						velocity.Y += 0.03f;
					}
					if ((double)velocity.Y < -1.5)
					{
						velocity.Y = -1.5f;
					}
				}
				else if (directionY == 1 && (double)velocity.Y < 1.5)
				{
					velocity.Y += 0.04f;
					if ((double)velocity.Y < -1.5)
					{
						velocity.Y += 0.05f;
					}
					else if (velocity.Y < 0f)
					{
						velocity.Y -= 0.03f;
					}
					if ((double)velocity.Y > 1.5)
					{
						velocity.Y = 1.5f;
					}
				}
			}
			if (type == 49 || type == 51 || type == 60 || type == 62 || type == 66 || type == 93 || type == 137 || type == 150 || type == 151 || type == 152 || type == 634)
			{
				if (wet)
				{
					if (velocity.Y > 0f)
					{
						velocity.Y *= 0.95f;
					}
					velocity.Y -= 0.5f;
					if (velocity.Y < -4f)
					{
						velocity.Y = -4f;
					}
					TargetClosest();
				}
				if (type == 60)
				{
					if (direction == -1 && velocity.X > -4f)
					{
						velocity.X -= 0.1f;
						if (velocity.X > 4f)
						{
							velocity.X -= 0.07f;
						}
						else if (velocity.X > 0f)
						{
							velocity.X += 0.03f;
						}
						if (velocity.X < -4f)
						{
							velocity.X = -4f;
						}
					}
					else if (direction == 1 && velocity.X < 4f)
					{
						velocity.X += 0.1f;
						if (velocity.X < -4f)
						{
							velocity.X += 0.07f;
						}
						else if (velocity.X < 0f)
						{
							velocity.X -= 0.03f;
						}
						if (velocity.X > 4f)
						{
							velocity.X = 4f;
						}
					}
					if (directionY == -1 && (double)velocity.Y > -1.5)
					{
						velocity.Y -= 0.04f;
						if ((double)velocity.Y > 1.5)
						{
							velocity.Y -= 0.03f;
						}
						else if (velocity.Y > 0f)
						{
							velocity.Y += 0.02f;
						}
						if ((double)velocity.Y < -1.5)
						{
							velocity.Y = -1.5f;
						}
					}
					else if (directionY == 1 && (double)velocity.Y < 1.5)
					{
						velocity.Y += 0.04f;
						if ((double)velocity.Y < -1.5)
						{
							velocity.Y += 0.03f;
						}
						else if (velocity.Y < 0f)
						{
							velocity.Y -= 0.02f;
						}
						if ((double)velocity.Y > 1.5)
						{
							velocity.Y = 1.5f;
						}
					}
				}
				else
				{
					if (direction == -1 && velocity.X > -4f)
					{
						velocity.X -= 0.1f;
						if (velocity.X > 4f)
						{
							velocity.X -= 0.1f;
						}
						else if (velocity.X > 0f)
						{
							velocity.X += 0.05f;
						}
						if (velocity.X < -4f)
						{
							velocity.X = -4f;
						}
					}
					else if (direction == 1 && velocity.X < 4f)
					{
						velocity.X += 0.1f;
						if (velocity.X < -4f)
						{
							velocity.X += 0.1f;
						}
						else if (velocity.X < 0f)
						{
							velocity.X -= 0.05f;
						}
						if (velocity.X > 4f)
						{
							velocity.X = 4f;
						}
					}
					if (directionY == -1 && (double)velocity.Y > -1.5)
					{
						velocity.Y -= 0.04f;
						if ((double)velocity.Y > 1.5)
						{
							velocity.Y -= 0.05f;
						}
						else if (velocity.Y > 0f)
						{
							velocity.Y += 0.03f;
						}
						if ((double)velocity.Y < -1.5)
						{
							velocity.Y = -1.5f;
						}
					}
					else if (directionY == 1 && (double)velocity.Y < 1.5)
					{
						velocity.Y += 0.04f;
						if ((double)velocity.Y < -1.5)
						{
							velocity.Y += 0.05f;
						}
						else if (velocity.Y < 0f)
						{
							velocity.Y -= 0.03f;
						}
						if ((double)velocity.Y > 1.5)
						{
							velocity.Y = 1.5f;
						}
					}
				}
			}
			if (type == 48 && wet)
			{
				if (velocity.Y > 0f)
				{
					velocity.Y *= 0.95f;
				}
				velocity.Y -= 0.5f;
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
				TargetClosest();
			}
			if (type == 158 && Main.netMode != 1)
			{
				Vector2 vector22 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num235 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector22.X;
				float num236 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector22.Y;
				float num237 = (float)Math.Sqrt(num235 * num235 + num236 * num236);
				if (num237 < 200f && position.Y + (float)height < Main.player[target].position.Y + (float)Main.player[target].height && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
				{
					Transform(159);
				}
			}
			this.ai[1] += 1f;
			if (type == 158)
			{
				this.ai[1] += 1f;
			}
			if (this.ai[1] > 200f)
			{
				if (!Main.player[target].wet && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
				{
					this.ai[1] = 0f;
				}
				float num238 = 0.2f;
				float num239 = 0.1f;
				float num240 = 4f;
				float num241 = 1.5f;
				if (type == 48 || type == 62 || type == 66)
				{
					num238 = 0.12f;
					num239 = 0.07f;
					num240 = 3f;
					num241 = 1.25f;
				}
				if (this.ai[1] > 1000f)
				{
					this.ai[1] = 0f;
				}
				this.ai[2] += 1f;
				if (this.ai[2] > 0f)
				{
					if (velocity.Y < num241)
					{
						velocity.Y += num239;
					}
				}
				else if (velocity.Y > 0f - num241)
				{
					velocity.Y -= num239;
				}
				if (this.ai[2] < -150f || this.ai[2] > 150f)
				{
					if (velocity.X < num240)
					{
						velocity.X += num238;
					}
				}
				else if (velocity.X > 0f - num240)
				{
					velocity.X -= num238;
				}
				if (this.ai[2] > 300f)
				{
					this.ai[2] = -300f;
				}
			}
			if (Main.netMode == 1)
			{
				return;
			}
			if (type == 48)
			{
				this.ai[0] += 1f;
				if (this.ai[0] == 30f || this.ai[0] == 60f || this.ai[0] == 90f)
				{
					if (Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
					{
						float num242 = 6f;
						Vector2 vector23 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
						float num243 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector23.X + (float)Main.rand.Next(-100, 101);
						float num244 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector23.Y + (float)Main.rand.Next(-100, 101);
						float num245 = (float)Math.Sqrt(num243 * num243 + num244 * num244);
						num245 = num242 / num245;
						num243 *= num245;
						num244 *= num245;
						int num246 = 15;
						int num247 = 38;
						int num248 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector23.X, vector23.Y, num243, num244, num247, num246, 0f, Main.myPlayer);
						Main.projectile[num248].timeLeft = 300;
					}
				}
				else if (this.ai[0] >= (float)(400 + Main.rand.Next(400)))
				{
					this.ai[0] = 0f;
				}
			}
			if (type == 62 || type == 66)
			{
				this.ai[0] += 1f;
				if (this.ai[0] == 20f || this.ai[0] == 40f || this.ai[0] == 60f || this.ai[0] == 80f)
				{
					if (Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
					{
						float num249 = 0.2f;
						Vector2 vector24 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
						float num250 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector24.X + (float)Main.rand.Next(-100, 101);
						float num251 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector24.Y + (float)Main.rand.Next(-100, 101);
						float num252 = (float)Math.Sqrt(num250 * num250 + num251 * num251);
						num252 = num249 / num252;
						num250 *= num252;
						num251 *= num252;
						int num253 = 21;
						int num254 = 44;
						int num255 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector24.X, vector24.Y, num250, num251, num254, num253, 0f, Main.myPlayer);
						Main.projectile[num255].timeLeft = 300;
					}
				}
				else if (this.ai[0] >= (float)(300 + Main.rand.Next(300)))
				{
					this.ai[0] = 0f;
				}
			}
			if (type != 156)
			{
				return;
			}
			this.ai[0] += 1f;
			if (this.ai[0] == 20f || this.ai[0] == 40f || this.ai[0] == 60f || this.ai[0] == 80f || this.ai[0] == 100f)
			{
				if (Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
				{
					float num256 = 0.2f;
					Vector2 vector25 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num257 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector25.X + (float)Main.rand.Next(-50, 51);
					float num258 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector25.Y + (float)Main.rand.Next(-50, 51);
					float num259 = (float)Math.Sqrt(num257 * num257 + num258 * num258);
					num259 = num256 / num259;
					num257 *= num259;
					num258 *= num259;
					int num260 = 80;
					int num261 = 115;
					vector25 += velocity * 5f;
					int num262 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector25.X + num257 * 100f, vector25.Y + num258 * 100f, num257, num258, num261, num260, 0f, Main.myPlayer);
					Main.projectile[num262].timeLeft = 300;
				}
			}
			else if (this.ai[0] >= (float)(250 + Main.rand.Next(250)))
			{
				this.ai[0] = 0f;
			}
			return;
		}
		if (aiStyle == 15)
		{
			AI_015_KingSlime();
			return;
		}
		if (aiStyle == 16)
		{
			if (direction == 0)
			{
				TargetClosest();
			}
			if (type == 688)
			{
				if (Main.netMode != 1)
				{
					if (justHit && this.ai[2] == 0f)
					{
						this.ai[2] = 1f;
						localAI[0] = 180f;
						netUpdate = true;
					}
					else
					{
						localAI[0]--;
						if (localAI[0] <= 0f)
						{
							localAI[0] = 120f;
							if (this.ai[2] == 1f)
							{
								this.ai[2] = 0f;
							}
							if (justHit)
							{
								this.ai[2] = 1f;
							}
							netUpdate = true;
						}
					}
				}
				if (this.ai[2] == 1f)
				{
					velocity *= 0.98f;
					if (Collision.GetWaterLine(base.Top.ToTileCoordinates(), out var waterLineHeight))
					{
						float num263 = base.Top.Y - 5f;
						if (base.Center.Y > waterLineHeight)
						{
							velocity.Y -= 0.4f;
							if (velocity.Y < -2f)
							{
								velocity.Y = -2f;
							}
							if (num263 + velocity.Y < waterLineHeight)
							{
								velocity.Y = waterLineHeight - num263;
							}
						}
						else
						{
							velocity.Y = MathHelper.Min(velocity.Y, waterLineHeight - num263);
							if (Math.Abs(num263 - waterLineHeight) < 2f)
							{
								velocity.Y = 0f;
							}
						}
					}
					else if (wet)
					{
						velocity.Y -= 0.3f;
						if (velocity.Y < -10f)
						{
							velocity.Y = -10f;
						}
					}
					else
					{
						velocity.Y += 0.3f;
						if (velocity.Y > 10f)
						{
							velocity.Y = 10f;
						}
					}
					return;
				}
			}
			if (type == 615)
			{
				if (this.ai[2] == 0f)
				{
					int num264 = Main.rand.Next(300, 1200);
					if ((this.ai[3] += 1f) >= (float)num264)
					{
						this.ai[2] = Main.rand.Next(1, 3);
						if (this.ai[2] == 1f && !Collision.CanHitLine(position, width, height, new Vector2(position.X, position.Y - 128f), width, height))
						{
							this.ai[2] = 2f;
						}
						if (this.ai[2] == 2f)
						{
							TargetClosest();
						}
						this.ai[3] = 0f;
						netUpdate = true;
					}
				}
				if (this.ai[2] == 1f)
				{
					if (collideY || collideX)
					{
						this.ai[2] = 0f;
						this.ai[3] = 0f;
						netUpdate = true;
					}
					else if (wet)
					{
						velocity.Y -= 0.4f;
						if (velocity.Y < -6f)
						{
							velocity.Y = -6f;
						}
						rotation = velocity.Y * (float)direction * 0.3f;
						if (rotation < (float)Math.PI * -2f / 5f)
						{
							rotation = (float)Math.PI * -2f / 5f;
						}
						if (rotation > (float)Math.PI * 2f / 5f)
						{
							rotation = (float)Math.PI * 2f / 5f;
						}
						if (this.ai[3] == 1f)
						{
							this.ai[2] = 0f;
							this.ai[3] = 0f;
							netUpdate = true;
						}
					}
					else
					{
						rotation += (float)direction * 0.2f;
						this.ai[3] = 1f;
						velocity.Y += 0.3f;
						if (velocity.Y > 10f)
						{
							velocity.Y = 10f;
						}
					}
					return;
				}
				if (this.ai[2] == 2f)
				{
					if (collideY || collideX)
					{
						this.ai[2] = 0f;
						this.ai[3] = 0f;
						netUpdate = true;
					}
					else if (wet)
					{
						velocity.Y -= 0.4f;
						if (velocity.Y < -6f)
						{
							velocity.Y = -6f;
						}
						rotation = velocity.Y * (float)direction * 0.3f;
						if (rotation < (float)Math.PI * -2f / 5f)
						{
							rotation = (float)Math.PI * -2f / 5f;
						}
						if (rotation > (float)Math.PI * 2f / 5f)
						{
							rotation = (float)Math.PI * 2f / 5f;
						}
						if (Collision.GetWaterLine(base.Top.ToTileCoordinates(), out var waterLineHeight2))
						{
							float y = waterLineHeight2 + 0f - position.Y;
							velocity.Y = y;
							velocity.Y = MathHelper.Clamp(velocity.Y, -2f, 0.5f);
							rotation = -(float)Math.PI / 5f * (float)direction;
							velocity.X *= 0.95f;
							if (this.ai[3] == 0f)
							{
								netUpdate = true;
							}
							this.ai[3]++;
							if (this.ai[3] >= 300f)
							{
								this.ai[2] = 0f;
								this.ai[3] = 0f;
								netUpdate = true;
								velocity.Y = 4f;
							}
							if (this.ai[3] == 60f && Main.rand.Next(2) == 0)
							{
								SoundEngine.PlaySound(45, (int)position.X, (int)position.Y);
							}
						}
					}
					else
					{
						this.ai[2] = 0f;
						this.ai[3] = 0f;
						netUpdate = true;
						velocity.Y += 0.3f;
						if (velocity.Y > 10f)
						{
							velocity.Y = 10f;
						}
					}
					return;
				}
			}
			if (wet)
			{
				bool flag22 = false;
				if (type != 55 && type != 592 && type != 607 && type != 615 && type != 688)
				{
					TargetClosest(faceTarget: false);
					if (Main.player[target].wet && !Main.player[target].dead && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
					{
						flag22 = true;
					}
				}
				int num265 = (int)base.Center.X / 16;
				int num266 = (int)(position.Y + (float)height) / 16;
				if (Main.tile[num265, num266].topSlope())
				{
					if (Main.tile[num265, num266].leftSlope())
					{
						direction = -1;
						velocity.X = Math.Abs(velocity.X) * -1f;
					}
					else
					{
						direction = 1;
						velocity.X = Math.Abs(velocity.X);
					}
				}
				else if (Main.tile[num265, num266 + 1].topSlope())
				{
					if (Main.tile[num265, num266 + 1].leftSlope())
					{
						direction = -1;
						velocity.X = Math.Abs(velocity.X) * -1f;
					}
					else
					{
						direction = 1;
						velocity.X = Math.Abs(velocity.X);
					}
				}
				if (!flag22)
				{
					if (collideX)
					{
						velocity.X *= -1f;
						direction *= -1;
						netUpdate = true;
					}
					if (collideY)
					{
						netUpdate = true;
						if (velocity.Y > 0f)
						{
							velocity.Y = Math.Abs(velocity.Y) * -1f;
							directionY = -1;
							this.ai[0] = -1f;
						}
						else if (velocity.Y < 0f)
						{
							velocity.Y = Math.Abs(velocity.Y);
							directionY = 1;
							this.ai[0] = 1f;
						}
					}
				}
				if (type == 102)
				{
					Lighting.AddLight((int)(position.X + (float)(width / 2) + (float)(direction * (width + 8))) / 16, (int)(position.Y + 2f) / 16, 0.07f, 0.04f, 0.025f);
				}
				if (flag22)
				{
					if (this.ai[0] != 0f)
					{
						this.ai[0] = 0f;
						netUpdate = true;
					}
					TargetClosest();
					if (type == 157)
					{
						if (velocity.X > 0f && direction < 0)
						{
							velocity.X *= 0.95f;
						}
						if (velocity.X < 0f && direction > 0)
						{
							velocity.X *= 0.95f;
						}
						velocity.X += (float)direction * 0.25f;
						velocity.Y += (float)directionY * 0.2f;
						if (velocity.X > 8f)
						{
							velocity.X = 7f;
						}
						if (velocity.X < -8f)
						{
							velocity.X = -7f;
						}
						if (velocity.Y > 5f)
						{
							velocity.Y = 4f;
						}
						if (velocity.Y < -5f)
						{
							velocity.Y = -4f;
						}
					}
					else if (type == 65 || type == 102 || type == 692)
					{
						velocity.X += (float)direction * 0.15f;
						velocity.Y += (float)directionY * 0.15f;
						if (velocity.X > 5f)
						{
							velocity.X = 5f;
						}
						if (velocity.X < -5f)
						{
							velocity.X = -5f;
						}
						if (velocity.Y > 3f)
						{
							velocity.Y = 3f;
						}
						if (velocity.Y < -3f)
						{
							velocity.Y = -3f;
						}
					}
					else
					{
						velocity.X += (float)direction * 0.1f;
						velocity.Y += (float)directionY * 0.1f;
						if (velocity.X > 3f)
						{
							velocity.X = 3f;
						}
						if (velocity.X < -3f)
						{
							velocity.X = -3f;
						}
						if (velocity.Y > 2f)
						{
							velocity.Y = 2f;
						}
						if (velocity.Y < -2f)
						{
							velocity.Y = -2f;
						}
					}
				}
				else
				{
					if (this.ai[0] == 0f)
					{
						this.ai[0] = 1f;
						netUpdate = true;
					}
					if (type == 157)
					{
						if (Main.player[target].position.Y > position.Y)
						{
							directionY = 1;
						}
						else
						{
							directionY = -1;
						}
						velocity.X += (float)direction * 0.2f;
						if (velocity.X < -2f || velocity.X > 2f)
						{
							velocity.X *= 0.95f;
						}
						if (this.ai[0] == -1f)
						{
							float num267 = -0.6f;
							if (directionY < 0)
							{
								num267 = -1f;
							}
							if (directionY > 0)
							{
								num267 = -0.2f;
							}
							velocity.Y -= 0.02f;
							if (velocity.Y < num267)
							{
								this.ai[0] = 1f;
							}
						}
						else
						{
							float num268 = 0.6f;
							if (directionY < 0)
							{
								num268 = 0.2f;
							}
							if (directionY > 0)
							{
								num268 = 1f;
							}
							velocity.Y += 0.02f;
							if (velocity.Y > num268)
							{
								this.ai[0] = -1f;
							}
						}
					}
					else
					{
						velocity.X += (float)direction * 0.1f;
						float num269 = 1f;
						if (type == 615)
						{
							num269 = 3f;
						}
						if (velocity.X < 0f - num269 || velocity.X > num269)
						{
							velocity.X *= 0.95f;
						}
						if (this.ai[0] == -1f)
						{
							velocity.Y -= 0.01f;
							if (velocity.Y < -0.3f)
							{
								this.ai[0] = 1f;
							}
						}
						else
						{
							velocity.Y += 0.01f;
							if (velocity.Y > 0.3f)
							{
								this.ai[0] = -1f;
							}
						}
					}
					int num270 = (int)(position.X + (float)(width / 2)) / 16;
					int num271 = (int)(position.Y + (float)(height / 2)) / 16;
					if (Main.tile[num270, num271 - 1] == null)
					{
						Main.tile[num270, num271 - 1] = new Tile();
					}
					if (Main.tile[num270, num271 + 1] == null)
					{
						Main.tile[num270, num271 + 1] = new Tile();
					}
					if (Main.tile[num270, num271 + 2] == null)
					{
						Main.tile[num270, num271 + 2] = new Tile();
					}
					if (Main.tile[num270, num271 - 1].liquid > 128)
					{
						if (Main.tile[num270, num271 + 1].active())
						{
							this.ai[0] = -1f;
						}
						else if (Main.tile[num270, num271 + 2].active())
						{
							this.ai[0] = -1f;
						}
					}
					if (type != 157 && (velocity.Y > 0.4f || velocity.Y < -0.4f))
					{
						velocity.Y *= 0.95f;
					}
				}
			}
			else
			{
				if (velocity.Y == 0f)
				{
					if (type == 65 || type == 692)
					{
						velocity.X *= 0.94f;
						if (velocity.X > -0.2f && velocity.X < 0.2f)
						{
							velocity.X = 0f;
						}
					}
					else if (Main.netMode != 1)
					{
						velocity.Y = (float)Main.rand.Next(-50, -20) * 0.1f;
						velocity.X = (float)Main.rand.Next(-20, 20) * 0.1f;
						direction = ((Main.rand.Next(2) == 0) ? 1 : (-1));
						NetUpdateIgnoreSpamLimit();
					}
				}
				velocity.Y += 0.3f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
				this.ai[0] = 1f;
			}
			if (type == 692 && this.ai[0] == 0f)
			{
				Player player2 = Main.player[target];
				rotation = (base.Center - player2.Center).SafeNormalize(Vector2.Zero).ToRotation();
				if (spriteDirection == -1)
				{
					rotation += (float)Math.PI;
				}
				rotation = MathHelper.WrapAngle(rotation);
				if (rotation < -0.3f)
				{
					rotation = -0.3f;
				}
				if (rotation > 0.3f)
				{
					rotation = 0.3f;
				}
			}
			else
			{
				rotation = velocity.Y * (float)direction * 0.1f;
				if (rotation < -0.2f)
				{
					rotation = -0.2f;
				}
				if (rotation > 0.2f)
				{
					rotation = 0.2f;
				}
			}
			return;
		}
		if (aiStyle == 17)
		{
			noGravity = true;
			if (this.ai[0] == 0f)
			{
				noGravity = false;
				TargetClosest();
				if (Main.netMode != 1)
				{
					if (velocity.X != 0f || velocity.Y < 0f || (double)velocity.Y > 0.3)
					{
						this.ai[0] = 1f;
						netUpdate = true;
					}
					else
					{
						Rectangle rectangle = new Rectangle((int)Main.player[target].position.X, (int)Main.player[target].position.Y, Main.player[target].width, Main.player[target].height);
						if (new Rectangle((int)position.X - 100, (int)position.Y - 100, width + 200, height + 200).Intersects(rectangle) || life < lifeMax)
						{
							this.ai[0] = 1f;
							velocity.Y -= 6f;
							netUpdate = true;
						}
					}
				}
			}
			else if (!Main.player[target].dead)
			{
				if (collideX)
				{
					velocity.X = oldVelocity.X * -0.5f;
					if (direction == -1 && velocity.X > 0f && velocity.X < 2f)
					{
						velocity.X = 2f;
					}
					if (direction == 1 && velocity.X < 0f && velocity.X > -2f)
					{
						velocity.X = -2f;
					}
				}
				if (collideY)
				{
					velocity.Y = oldVelocity.Y * -0.5f;
					if (velocity.Y > 0f && velocity.Y < 1f)
					{
						velocity.Y = 1f;
					}
					if (velocity.Y < 0f && velocity.Y > -1f)
					{
						velocity.Y = -1f;
					}
				}
				TargetClosest();
				if (direction == -1 && velocity.X > -3f)
				{
					velocity.X -= 0.1f;
					if (velocity.X > 3f)
					{
						velocity.X -= 0.1f;
					}
					else if (velocity.X > 0f)
					{
						velocity.X -= 0.05f;
					}
					if (velocity.X < -3f)
					{
						velocity.X = -3f;
					}
				}
				else if (direction == 1 && velocity.X < 3f)
				{
					velocity.X += 0.1f;
					if (velocity.X < -3f)
					{
						velocity.X += 0.1f;
					}
					else if (velocity.X < 0f)
					{
						velocity.X += 0.05f;
					}
					if (velocity.X > 3f)
					{
						velocity.X = 3f;
					}
				}
				float num272 = Math.Abs(position.X + (float)(width / 2) - (Main.player[target].position.X + (float)(Main.player[target].width / 2)));
				float num273 = Main.player[target].position.Y - (float)(height / 2);
				if (num272 > 50f)
				{
					num273 -= 100f;
				}
				if (position.Y < num273)
				{
					velocity.Y += 0.05f;
					if (velocity.Y < 0f)
					{
						velocity.Y += 0.01f;
					}
				}
				else
				{
					velocity.Y -= 0.05f;
					if (velocity.Y > 0f)
					{
						velocity.Y -= 0.01f;
					}
				}
				if (velocity.Y < -3f)
				{
					velocity.Y = -3f;
				}
				if (velocity.Y > 3f)
				{
					velocity.Y = 3f;
				}
			}
			if (wet)
			{
				if (velocity.Y > 0f)
				{
					velocity.Y *= 0.95f;
				}
				velocity.Y -= 0.5f;
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
				TargetClosest();
			}
			return;
		}
		if (aiStyle == 18)
		{
			bool flag23 = false;
			if (wet && this.ai[1] == 1f)
			{
				flag23 = true;
			}
			else
			{
				dontTakeDamage = false;
			}
			if (Main.expertMode && (type == 63 || type == 64 || type == 103 || type == 242))
			{
				if (wet)
				{
					if (target >= 0 && Main.player[target].wet && !Main.player[target].dead && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height) && (Main.player[target].Center - base.Center).Length() < 150f)
					{
						if (this.ai[1] == 0f)
						{
							this.ai[2] += 2f;
						}
						else
						{
							this.ai[2] -= 0.25f;
						}
					}
					if (flag23)
					{
						dontTakeDamage = true;
						this.ai[2] += 1f;
						if (this.ai[2] >= 120f)
						{
							this.ai[1] = 0f;
						}
					}
					else
					{
						this.ai[2] += 1f;
						if (this.ai[2] >= 420f)
						{
							this.ai[1] = 1f;
							this.ai[2] = 0f;
						}
					}
				}
				else
				{
					this.ai[1] = 0f;
					this.ai[2] = 0f;
				}
			}
			float num274 = 1f;
			if (flag23)
			{
				num274 += 0.5f;
			}
			if (type == 63)
			{
				Lighting.AddLight((int)(position.X + (float)(height / 2)) / 16, (int)(position.Y + (float)(height / 2)) / 16, 0.05f * num274, 0.15f * num274, 0.4f * num274);
			}
			else if (type == 103)
			{
				Lighting.AddLight((int)(position.X + (float)(height / 2)) / 16, (int)(position.Y + (float)(height / 2)) / 16, 0.05f * num274, 0.45f * num274, 0.1f * num274);
			}
			else if (type != 221 && type != 242)
			{
				Lighting.AddLight((int)(position.X + (float)(height / 2)) / 16, (int)(position.Y + (float)(height / 2)) / 16, 0.35f * num274, 0.05f * num274, 0.2f * num274);
			}
			if (direction == 0)
			{
				TargetClosest();
			}
			if (flag23)
			{
				return;
			}
			if (wet)
			{
				int num275 = (int)base.Center.X / 16;
				int num276 = (int)(position.Y + (float)height) / 16;
				if (Main.tile[num275, num276].topSlope())
				{
					if (Main.tile[num275, num276].leftSlope())
					{
						direction = -1;
						velocity.X = Math.Abs(velocity.X) * -1f;
					}
					else
					{
						direction = 1;
						velocity.X = Math.Abs(velocity.X);
					}
				}
				else if (Main.tile[num275, num276 + 1].topSlope())
				{
					if (Main.tile[num275, num276 + 1].leftSlope())
					{
						direction = -1;
						velocity.X = Math.Abs(velocity.X) * -1f;
					}
					else
					{
						direction = 1;
						velocity.X = Math.Abs(velocity.X);
					}
				}
				if (collideX)
				{
					velocity.X *= -1f;
					direction *= -1;
				}
				if (collideY)
				{
					if (velocity.Y > 0f)
					{
						velocity.Y = Math.Abs(velocity.Y) * -1f;
						directionY = -1;
						this.ai[0] = -1f;
					}
					else if (velocity.Y < 0f)
					{
						velocity.Y = Math.Abs(velocity.Y);
						directionY = 1;
						this.ai[0] = 1f;
					}
				}
				bool flag24 = false;
				if (!friendly)
				{
					TargetClosest(faceTarget: false);
					if (Main.player[target].wet && !Main.player[target].dead && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
					{
						flag24 = true;
					}
				}
				if (flag24)
				{
					localAI[2] = 1f;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
					velocity *= 0.98f;
					float num277 = 0.2f;
					if (type == 103)
					{
						velocity *= 0.98f;
						num277 = 0.6f;
					}
					if (type == 221)
					{
						velocity *= 0.99f;
						num277 = 1f;
					}
					if (type == 242)
					{
						velocity *= 0.995f;
						num277 = 3f;
					}
					if (velocity.X > 0f - num277 && velocity.X < num277 && velocity.Y > 0f - num277 && velocity.Y < num277)
					{
						if (type == 221)
						{
							localAI[0] = 1f;
						}
						TargetClosest();
						float num278 = 7f;
						if (type == 103)
						{
							num278 = 9f;
						}
						Vector2 vector26 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
						float num279 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector26.X;
						float num280 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector26.Y;
						float num281 = (float)Math.Sqrt(num279 * num279 + num280 * num280);
						num281 = num278 / num281;
						num279 *= num281;
						num280 *= num281;
						velocity.X = num279;
						velocity.Y = num280;
					}
					return;
				}
				localAI[2] = 0f;
				velocity.X += (float)direction * 0.02f;
				rotation = velocity.X * 0.4f;
				if (velocity.X < -1f || velocity.X > 1f)
				{
					velocity.X *= 0.95f;
				}
				if (this.ai[0] == -1f)
				{
					velocity.Y -= 0.01f;
					if (velocity.Y < -1f)
					{
						this.ai[0] = 1f;
					}
				}
				else
				{
					velocity.Y += 0.01f;
					if (velocity.Y > 1f)
					{
						this.ai[0] = -1f;
					}
				}
				int num282 = (int)(position.X + (float)(width / 2)) / 16;
				int num283 = (int)(position.Y + (float)(height / 2)) / 16;
				if (Main.tile[num282, num283 - 1] == null)
				{
					Main.tile[num282, num283 - 1] = new Tile();
				}
				if (Main.tile[num282, num283 + 1] == null)
				{
					Main.tile[num282, num283 + 1] = new Tile();
				}
				if (Main.tile[num282, num283 + 2] == null)
				{
					Main.tile[num282, num283 + 2] = new Tile();
				}
				if (Main.tile[num282, num283 - 1].liquid > 128)
				{
					if (Main.tile[num282, num283 + 1].active())
					{
						this.ai[0] = -1f;
					}
					else if (Main.tile[num282, num283 + 2].active())
					{
						this.ai[0] = -1f;
					}
				}
				else
				{
					this.ai[0] = 1f;
				}
				if ((double)velocity.Y > 1.2 || (double)velocity.Y < -1.2)
				{
					velocity.Y *= 0.99f;
				}
				return;
			}
			rotation += velocity.X * 0.1f;
			if (velocity.Y == 0f)
			{
				velocity.X *= 0.98f;
				if ((double)velocity.X > -0.01 && (double)velocity.X < 0.01)
				{
					velocity.X = 0f;
				}
			}
			velocity.Y += 0.2f;
			if (velocity.Y > 10f)
			{
				velocity.Y = 10f;
			}
			this.ai[0] = 1f;
			return;
		}
		if (aiStyle == 19)
		{
			TargetClosest();
			float num284 = 12f;
			Vector2 vector27 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num285 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector27.X;
			float num286 = Main.player[target].position.Y - vector27.Y;
			float num287 = (float)Math.Sqrt(num285 * num285 + num286 * num286);
			num287 = num284 / num287;
			num285 *= num287;
			num286 *= num287;
			bool flag25 = false;
			if (directionY < 0)
			{
				rotation = (float)(Math.Atan2(num286, num285) + 1.57);
				flag25 = ((!((double)rotation < -1.2) && !((double)rotation > 1.2)) ? true : false);
				if ((double)rotation < -0.8)
				{
					rotation = -0.8f;
				}
				else if ((double)rotation > 0.8)
				{
					rotation = 0.8f;
				}
				if (velocity.X != 0f)
				{
					velocity.X *= 0.9f;
					if ((double)velocity.X > -0.1 || (double)velocity.X < 0.1)
					{
						netUpdate = true;
						velocity.X = 0f;
					}
				}
			}
			if (this.ai[0] > 0f)
			{
				if (this.ai[0] == 200f)
				{
					SoundEngine.PlaySound(SoundID.Item5, position);
				}
				this.ai[0] -= 1f;
			}
			if (Main.netMode != 1 && this.ai[0] == 0f)
			{
				int num288 = (int)(base.Center.X / 16f);
				int num289 = (int)((base.Bottom.Y + 8f) / 16f);
				if (flag25)
				{
					if (Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
					{
						this.ai[0] = 200f;
						int num290 = 10;
						int num291 = 31;
						int num292 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector27.X, vector27.Y, num285, num286, num291, num290, 0f, Main.myPlayer);
						Main.projectile[num292].ai[0] = 2f;
						Main.projectile[num292].timeLeft = 300;
						Main.projectile[num292].friendly = false;
						NetMessage.SendData(27, -1, -1, null, num292);
						netUpdate = true;
					}
				}
				else if (WorldGen.InWorld(num288, num289) && (Main.tile[num288, num289].type == 421 || Main.tile[num288, num289].type == 422))
				{
					float num293 = rotation - 1.57f;
					Vector2 vector28 = new Vector2((float)Math.Cos(num293), (float)Math.Sin(num293));
					num285 = vector28.X * num284;
					num286 = vector28.Y * num284;
					this.ai[0] = 200f;
					int num294 = 10;
					int num295 = 31;
					int num296 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector27.X, vector27.Y, num285, num286, num295, num294, 0f, Main.myPlayer);
					Main.projectile[num296].ai[0] = 2f;
					Main.projectile[num296].timeLeft = 300;
					Main.projectile[num296].friendly = false;
					NetMessage.SendData(27, -1, -1, null, num296);
					netUpdate = true;
				}
			}
			try
			{
				int num297 = (int)position.X / 16;
				int num298 = (int)(position.X + (float)(width / 2)) / 16;
				int num299 = (int)(position.X + (float)width) / 16;
				int num300 = (int)(position.Y + (float)height) / 16;
				bool flag26 = false;
				if (Main.tile[num297, num300] == null)
				{
					Main.tile[num297, num300] = new Tile();
				}
				if (Main.tile[num298, num300] == null)
				{
					Main.tile[num297, num300] = new Tile();
				}
				if (Main.tile[num299, num300] == null)
				{
					Main.tile[num297, num300] = new Tile();
				}
				if ((Main.tile[num297, num300].nactive() && Main.tileSolid[Main.tile[num297, num300].type]) || (Main.tile[num298, num300].nactive() && Main.tileSolid[Main.tile[num298, num300].type]) || (Main.tile[num299, num300].nactive() && Main.tileSolid[Main.tile[num299, num300].type]))
				{
					flag26 = true;
				}
				if (flag26)
				{
					noGravity = true;
					noTileCollide = true;
					velocity.Y = -0.2f;
					return;
				}
				noGravity = false;
				noTileCollide = false;
				if (Main.rand.Next(2) == 0)
				{
					position += netOffset;
					int num301 = Dust.NewDust(new Vector2(position.X - 4f, position.Y + (float)height - 8f), width + 8, 24, 32, 0f, velocity.Y / 2f);
					Main.dust[num301].velocity.X *= 0.4f;
					Main.dust[num301].velocity.Y *= -1f;
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num301].noGravity = true;
						Dust dust = Main.dust[num301];
						dust.scale += 0.2f;
					}
					position -= netOffset;
				}
				return;
			}
			catch
			{
				return;
			}
		}
		if (aiStyle == 20)
		{
			if (this.ai[0] == 0f)
			{
				if (Main.netMode != 1)
				{
					TargetClosest();
					direction *= -1;
					directionY *= -1;
					position.Y += height / 2 + 8;
					this.ai[1] = position.X + (float)(width / 2);
					this.ai[2] = position.Y + (float)(height / 2);
					if (direction == 0)
					{
						direction = 1;
					}
					if (directionY == 0)
					{
						directionY = 1;
					}
					this.ai[3] = 1f + (float)Main.rand.Next(15) * 0.1f;
					velocity.Y = (float)(directionY * 6) * this.ai[3];
					this.ai[0] += 1f;
					netUpdate = true;
				}
				else
				{
					this.ai[1] = position.X + (float)(width / 2);
					this.ai[2] = position.Y + (float)(height / 2);
				}
				return;
			}
			float num302 = 6f * this.ai[3];
			float num303 = 0.2f * this.ai[3];
			float num304 = num302 / num303 / 2f;
			if (this.ai[0] >= 1f && this.ai[0] < (float)(int)num304)
			{
				velocity.Y = (float)directionY * num302;
				this.ai[0] += 1f;
				return;
			}
			if (this.ai[0] >= (float)(int)num304)
			{
				velocity.Y = 0f;
				directionY *= -1;
				velocity.X = num302 * (float)direction;
				this.ai[0] = -1f;
				return;
			}
			if (directionY > 0)
			{
				if (velocity.Y >= num302)
				{
					directionY *= -1;
					velocity.Y = num302;
				}
			}
			else if (directionY < 0 && velocity.Y <= 0f - num302)
			{
				directionY *= -1;
				velocity.Y = 0f - num302;
			}
			if (direction > 0)
			{
				if (velocity.X >= num302)
				{
					direction *= -1;
					velocity.X = num302;
				}
			}
			else if (direction < 0 && velocity.X <= 0f - num302)
			{
				direction *= -1;
				velocity.X = 0f - num302;
			}
			velocity.X += num303 * (float)direction;
			velocity.Y += num303 * (float)directionY;
		}
		else if (aiStyle == 21)
		{
			if (this.ai[0] == 0f)
			{
				TargetClosest();
				directionY = 1;
				this.ai[0] = 1f;
			}
			int num305 = 6;
			if (this.ai[1] == 0f)
			{
				rotation += (float)(direction * directionY) * 0.13f;
				if (collideY)
				{
					this.ai[0] = 2f;
				}
				if (!collideY && this.ai[0] == 2f)
				{
					direction = -direction;
					this.ai[1] = 1f;
					this.ai[0] = 1f;
				}
				if (collideX)
				{
					directionY = -directionY;
					this.ai[1] = 1f;
				}
			}
			else
			{
				rotation -= (float)(direction * directionY) * 0.13f;
				if (collideX)
				{
					this.ai[0] = 2f;
				}
				if (!collideX && this.ai[0] == 2f)
				{
					directionY = -directionY;
					this.ai[1] = 0f;
					this.ai[0] = 1f;
				}
				if (collideY)
				{
					direction = -direction;
					this.ai[1] = 0f;
				}
			}
			velocity.X = num305 * direction;
			velocity.Y = num305 * directionY;
			float num306 = (float)(270 - Main.mouseTextColor) / 400f;
			Lighting.AddLight((int)(position.X + (float)(width / 2)) / 16, (int)(position.Y + (float)(height / 2)) / 16, 0.9f, 0.3f + num306, 0.2f);
		}
		else if (aiStyle == 22)
		{
			bool flag27 = false;
			bool flag28 = false;
			if (type == 330 && !Main.pumpkinMoon)
			{
				flag28 = true;
			}
			if (type == 253 && !Main.eclipse)
			{
				flag28 = true;
			}
			if (type == 490 && Main.dayTime)
			{
				flag28 = true;
			}
			if (justHit)
			{
				this.ai[2] = 0f;
			}
			if (type == 316 && (Main.player[target].dead || Vector2.Distance(base.Center, Main.player[target].Center) > 3000f))
			{
				if (this.ai[3] == 1f)
				{
					if (localAI[3] == 0f)
					{
						localAI[3] = 1f;
						SoundEngine.PlaySound(SoundID.NPCDeath55, (int)base.Center.X, (int)base.Center.Y);
					}
					flag28 = true;
					Opacity -= 0.025f;
					if (Opacity <= 0f)
					{
						active = false;
						netUpdate = true;
					}
				}
				else
				{
					TargetClosest();
					if (Main.player[target].dead || Vector2.Distance(base.Center, Main.player[target].Center) > 3000f)
					{
						EncourageDespawn(10);
						flag27 = true;
						flag28 = true;
					}
				}
			}
			if (flag28)
			{
				if (velocity.X == 0f)
				{
					velocity.X = (float)Main.rand.Next(-1, 2) * 1.5f;
					netUpdate = true;
				}
			}
			else if (this.ai[2] >= 0f)
			{
				int num307 = 16;
				bool flag29 = false;
				bool flag30 = false;
				if (position.X > this.ai[0] - (float)num307 && position.X < this.ai[0] + (float)num307)
				{
					flag29 = true;
				}
				else if ((velocity.X < 0f && direction > 0) || (velocity.X > 0f && direction < 0))
				{
					flag29 = true;
				}
				num307 += 24;
				if (position.Y > this.ai[1] - (float)num307 && position.Y < this.ai[1] + (float)num307)
				{
					flag30 = true;
				}
				if (flag29 && flag30)
				{
					this.ai[2]++;
					if (this.ai[2] >= 30f && num307 == 16)
					{
						flag27 = true;
					}
					if (this.ai[2] >= 60f)
					{
						this.ai[2] = -200f;
						direction *= -1;
						velocity.X *= -1f;
						collideX = false;
						netUpdate = true;
					}
				}
				else
				{
					this.ai[0] = position.X;
					this.ai[1] = position.Y;
					this.ai[2] = 0f;
					netUpdate = true;
				}
				TargetClosest();
			}
			else if (type == 253)
			{
				TargetClosest();
				this.ai[2] += 2f;
			}
			else
			{
				if (type == 330)
				{
					this.ai[2] += 0.1f;
				}
				else
				{
					this.ai[2]++;
				}
				if (Main.player[target].Center.X > base.Center.X)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
			}
			int num308 = (int)(base.Center.X / 16f) + direction * 2;
			int num309 = (int)(base.Bottom.Y / 16f);
			bool flag31 = true;
			bool flag32 = false;
			int num310 = 3;
			if (type == 122)
			{
				position += netOffset;
				if (type == 122)
				{
					Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.4f, 0f, 0.25f);
				}
				position -= netOffset;
				if (justHit)
				{
					this.ai[3] = 0f;
					localAI[1] = 0f;
				}
				if (Main.netMode != 1 && this.ai[3] == 32f && !Main.player[target].npcTypeNoAggro[type])
				{
					float num311 = 7f;
					Vector2 vector29 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num312 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector29.X;
					float num313 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector29.Y;
					float num314 = (float)Math.Sqrt(num312 * num312 + num313 * num313);
					float num315 = num314;
					num314 = num311 / num314;
					num312 *= num314;
					num313 *= num314;
					float num316 = 0.0125f;
					Vector2 vector30 = new Vector2(num312, num313).RotatedByRandom(num316 * ((float)Math.PI * 2f));
					num312 = vector30.X;
					num313 = vector30.Y;
					int num317 = 25;
					int num318 = 84;
					int num319 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector29.X, vector29.Y, num312, num313, num318, num317, 0f, Main.myPlayer);
				}
				num310 = 8;
				if (this.ai[3] > 0f)
				{
					this.ai[3]++;
					if (this.ai[3] >= 64f)
					{
						this.ai[3] = 0f;
					}
				}
				if (Main.netMode != 1 && this.ai[3] == 0f)
				{
					localAI[1]++;
					if (localAI[1] > 120f && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height) && !Main.player[target].npcTypeNoAggro[type])
					{
						localAI[1] = 0f;
						this.ai[3] = 1f;
						netUpdate = true;
					}
				}
			}
			else if (type == 75)
			{
				num310 = 4;
				position += netOffset;
				if (Main.rand.Next(6) == 0)
				{
					int num320 = Dust.NewDust(position, width, height, 55, 0f, 0f, 200, this.color);
					Dust dust = Main.dust[num320];
					dust.velocity *= 0.3f;
				}
				if (Main.rand.Next(40) == 0)
				{
					SoundEngine.PlaySound(27, (int)position.X, (int)position.Y);
				}
				position -= netOffset;
			}
			else if (type == 169)
			{
				position += netOffset;
				Lighting.AddLight((int)((position.X + (float)(width / 2)) / 16f), (int)((position.Y + (float)(height / 2)) / 16f), 0f, 0.6f, 0.75f);
				alpha = 30;
				if (Main.rand.Next(3) == 0)
				{
					int num321 = Dust.NewDust(position, width, height, 92, 0f, 0f, 200);
					Dust dust = Main.dust[num321];
					dust.velocity *= 0.3f;
					Main.dust[num321].noGravity = true;
				}
				position -= netOffset;
				if (justHit)
				{
					this.ai[3] = 0f;
					localAI[1] = 0f;
				}
				float num322 = 5f;
				Vector2 vector31 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num323 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector31.X;
				float num324 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector31.Y;
				float num325 = (float)Math.Sqrt(num323 * num323 + num324 * num324);
				float num326 = num325;
				num325 = num322 / num325;
				num323 *= num325;
				num324 *= num325;
				if (num323 > 0f)
				{
					direction = 1;
				}
				else
				{
					direction = -1;
				}
				spriteDirection = direction;
				if (direction < 0)
				{
					rotation = (float)Math.Atan2(0f - num324, 0f - num323);
				}
				else
				{
					rotation = (float)Math.Atan2(num324, num323);
				}
				if (Main.netMode != 1 && this.ai[3] == 16f)
				{
					int num327 = 45;
					int num328 = 128;
					int num329 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector31.X, vector31.Y, num323, num324, num328, num327, 0f, Main.myPlayer);
				}
				num310 = 10;
				if (this.ai[3] > 0f)
				{
					this.ai[3]++;
					if (this.ai[3] >= 64f)
					{
						this.ai[3] = 0f;
					}
				}
				if (Main.netMode != 1 && this.ai[3] == 0f)
				{
					localAI[1] += 1f;
					if (localAI[1] > 120f && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
					{
						localAI[1] = 0f;
						this.ai[3] = 1f;
						netUpdate = true;
					}
				}
			}
			else if (type == 268)
			{
				rotation = velocity.X * 0.1f;
				num310 = ((!(Main.player[target].Center.Y < base.Center.Y)) ? 6 : 12);
				if (Main.netMode != 1 && !confused)
				{
					this.ai[3]++;
					if (justHit)
					{
						this.ai[3] = -45f;
						localAI[1] = 0f;
					}
					if (Main.netMode != 1 && this.ai[3] >= (float)(60 + Main.rand.Next(60)))
					{
						this.ai[3] = 0f;
						if (Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
						{
							float num330 = 10f;
							Vector2 vector32 = new Vector2(position.X + (float)width * 0.5f - 4f, position.Y + (float)height * 0.7f);
							float num331 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector32.X;
							float num332 = Math.Abs(num331) * 0.1f;
							float num333 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector32.Y - num332;
							num331 += (float)Main.rand.Next(-10, 11);
							num333 += (float)Main.rand.Next(-30, 21);
							float num334 = (float)Math.Sqrt(num331 * num331 + num333 * num333);
							float num335 = num334;
							num334 = num330 / num334;
							num331 *= num334;
							num333 *= num334;
							int num336 = 40;
							int num337 = 288;
							int num338 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector32.X, vector32.Y, num331, num333, num337, num336, 0f, Main.myPlayer);
						}
					}
				}
			}
			if (type == 490)
			{
				num310 = 4;
				if (target >= 0)
				{
					float num339 = (Main.player[target].Center - base.Center).Length();
					num339 /= 70f;
					if (num339 > 8f)
					{
						num339 = 8f;
					}
					num310 += (int)num339;
				}
			}
			if (base.Bottom.Y > Main.player[target].Top.Y)
			{
				if (type == 330)
				{
					flag31 = false;
				}
				else
				{
					for (int num340 = num309; num340 < num309 + num310; num340++)
					{
						if (Main.tile[num308, num340] == null)
						{
							Main.tile[num308, num340] = new Tile();
						}
						if ((Main.tile[num308, num340].nactive() && Main.tileSolid[Main.tile[num308, num340].type]) || Main.tile[num308, num340].liquid > 0)
						{
							if (num340 <= num309 + 1)
							{
								flag32 = true;
							}
							flag31 = false;
							break;
						}
					}
				}
			}
			if (Main.player[target].npcTypeNoAggro[type])
			{
				bool flag33 = false;
				for (int num341 = num309; num341 < num309 + num310 - 2; num341++)
				{
					if (Main.tile[num308, num341] == null)
					{
						Main.tile[num308, num341] = new Tile();
					}
					if ((Main.tile[num308, num341].nactive() && Main.tileSolid[Main.tile[num308, num341].type]) || Main.tile[num308, num341].liquid > 0)
					{
						flag33 = true;
						break;
					}
				}
				directionY = (!flag33).ToDirectionInt();
			}
			if (type == 169 || type == 268)
			{
				for (int num342 = num309 - 3; num342 < num309; num342++)
				{
					if (Main.tile[num308, num342] == null)
					{
						Main.tile[num308, num342] = new Tile();
					}
					if ((Main.tile[num308, num342].nactive() && Main.tileSolid[Main.tile[num308, num342].type] && !TileID.Sets.Platforms[Main.tile[num308, num342].type]) || Main.tile[num308, num342].liquid > 0)
					{
						flag32 = false;
						flag27 = true;
						break;
					}
				}
			}
			if (flag27)
			{
				flag32 = false;
				flag31 = true;
				if (type == 268)
				{
					velocity.Y += 2f;
				}
			}
			if (flag31)
			{
				if (type == 75 || type == 169)
				{
					velocity.Y += 0.2f;
					if (velocity.Y > 2f)
					{
						velocity.Y = 2f;
					}
				}
				else if (type == 490)
				{
					velocity.Y += 0.03f;
					if (velocity.Y > 0.75f)
					{
						velocity.Y = 0.75f;
					}
				}
				else
				{
					velocity.Y += 0.1f;
					if (type == 316 && flag28)
					{
						velocity.Y -= 0.05f;
						if (velocity.Y > 6f)
						{
							velocity.Y = 6f;
						}
					}
					else if (velocity.Y > 3f)
					{
						velocity.Y = 3f;
					}
				}
			}
			else
			{
				if (type == 75 || type == 169)
				{
					if ((directionY < 0 && velocity.Y > 0f) || flag32)
					{
						velocity.Y -= 0.2f;
					}
				}
				else if (type == 490)
				{
					if ((directionY < 0 && velocity.Y > 0f) || flag32)
					{
						velocity.Y -= 0.075f;
					}
					if (velocity.Y < -0.75f)
					{
						velocity.Y = -0.75f;
					}
				}
				else if (directionY < 0 && velocity.Y > 0f)
				{
					velocity.Y -= 0.1f;
				}
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
			}
			if (type == 75 && wet)
			{
				velocity.Y -= 0.2f;
				if (velocity.Y < -2f)
				{
					velocity.Y = -2f;
				}
			}
			if (collideX)
			{
				velocity.X = oldVelocity.X * -0.4f;
				if (direction == -1 && velocity.X > 0f && velocity.X < 1f)
				{
					velocity.X = 1f;
				}
				if (direction == 1 && velocity.X < 0f && velocity.X > -1f)
				{
					velocity.X = -1f;
				}
			}
			if (collideY)
			{
				velocity.Y = oldVelocity.Y * -0.25f;
				if (velocity.Y > 0f && velocity.Y < 1f)
				{
					velocity.Y = 1f;
				}
				if (velocity.Y < 0f && velocity.Y > -1f)
				{
					velocity.Y = -1f;
				}
			}
			float num343 = 2f;
			if (type == 75)
			{
				num343 = 3f;
			}
			if (type == 253)
			{
				num343 = 4f;
			}
			if (type == 490)
			{
				num343 = 1.5f;
			}
			if (type == 330)
			{
				alpha = 0;
				num343 = 4f;
				if (!flag28)
				{
					TargetClosest();
				}
				else
				{
					EncourageDespawn(10);
				}
				if (direction < 0 && velocity.X > 0f)
				{
					velocity.X *= 0.9f;
				}
				if (direction > 0 && velocity.X < 0f)
				{
					velocity.X *= 0.9f;
				}
			}
			if (direction == -1 && velocity.X > 0f - num343)
			{
				velocity.X -= 0.1f;
				if (velocity.X > num343)
				{
					velocity.X -= 0.1f;
				}
				else if (velocity.X > 0f)
				{
					velocity.X += 0.05f;
				}
				if (velocity.X < 0f - num343)
				{
					velocity.X = 0f - num343;
				}
			}
			else if (direction == 1 && velocity.X < num343)
			{
				velocity.X += 0.1f;
				if (velocity.X < 0f - num343)
				{
					velocity.X += 0.1f;
				}
				else if (velocity.X < 0f)
				{
					velocity.X -= 0.05f;
				}
				if (velocity.X > num343)
				{
					velocity.X = num343;
				}
			}
			num343 = ((type != 490) ? 1.5f : 1f);
			if (directionY == -1 && velocity.Y > 0f - num343)
			{
				velocity.Y -= 0.04f;
				if (velocity.Y > num343)
				{
					velocity.Y -= 0.05f;
				}
				else if (velocity.Y > 0f)
				{
					velocity.Y += 0.03f;
				}
				if (velocity.Y < 0f - num343)
				{
					velocity.Y = 0f - num343;
				}
			}
			else if (directionY == 1 && velocity.Y < num343)
			{
				velocity.Y += 0.04f;
				if (velocity.Y < 0f - num343)
				{
					velocity.Y += 0.05f;
				}
				else if (velocity.Y < 0f)
				{
					velocity.Y -= 0.03f;
				}
				if (velocity.Y > num343)
				{
					velocity.Y = num343;
				}
			}
		}
		else if (aiStyle == 23)
		{
			noGravity = true;
			noTileCollide = true;
			if (type == 83)
			{
				Lighting.AddLight((int)((position.X + (float)(width / 2)) / 16f), (int)((position.Y + (float)(height / 2)) / 16f), 0.2f, 0.05f, 0.3f);
			}
			else if (type == 179)
			{
				Lighting.AddLight((int)((position.X + (float)(width / 2)) / 16f), (int)((position.Y + (float)(height / 2)) / 16f), 0.3f, 0.15f, 0.05f);
			}
			else
			{
				Lighting.AddLight((int)((position.X + (float)(width / 2)) / 16f), (int)((position.Y + (float)(height / 2)) / 16f), 0.05f, 0.2f, 0.3f);
			}
			if (target < 0 || target == 255 || Main.player[target].dead)
			{
				TargetClosest();
			}
			if (this.ai[0] == 0f)
			{
				float num344 = 9f;
				Vector2 vector33 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num345 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector33.X;
				float num346 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector33.Y;
				float num347 = (float)Math.Sqrt(num345 * num345 + num346 * num346);
				float num348 = num347;
				num347 = num344 / num347;
				num345 *= num347;
				num346 *= num347;
				velocity.X = num345;
				velocity.Y = num346;
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 0.785f;
				this.ai[0] = 1f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			else if (this.ai[0] == 1f)
			{
				if (justHit)
				{
					this.ai[0] = 2f;
					this.ai[1] = 0f;
				}
				velocity *= 0.99f;
				this.ai[1] += 1f;
				if (this.ai[1] >= 100f)
				{
					netUpdate = true;
					this.ai[0] = 2f;
					this.ai[1] = 0f;
					velocity.X = 0f;
					velocity.Y = 0f;
				}
				else
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 0.785f;
				}
			}
			else
			{
				if (justHit)
				{
					this.ai[0] = 2f;
					this.ai[1] = 0f;
				}
				velocity *= 0.96f;
				this.ai[1] += 1f;
				float num349 = this.ai[1] / 120f;
				num349 = 0.1f + num349 * 0.4f;
				rotation += num349 * (float)direction;
				if (this.ai[1] >= 120f)
				{
					netUpdate = true;
					this.ai[0] = 0f;
					this.ai[1] = 0f;
				}
			}
		}
		else if (aiStyle == 24)
		{
			if (Main.netMode != 1 && this.ai[0] == 1f && NPCID.Sets.BirdThatCanPoop[type] && localAI[3] == 0f)
			{
				int num350 = Player.FindClosest(position, width, height);
				float x = base.Center.X;
				if (x >= Main.player[num350].Left.X && x <= Main.player[num350].Right.X && Main.player[num350].Top.Y > base.Bottom.Y && Collision.CanHit(this, Main.player[num350]) && (Main.player[num350].RollOnlyBadLuckExtreme(50) == 0 || Main.player[num350].IsThisCenx()))
				{
					localAI[3] = 1f;
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), Main.player[num350].Center.X, base.Center.Y, 0f, 0f, 1080, 0, 0f);
				}
			}
			noGravity = true;
			if (type == 611 || type == 689)
			{
				if (type == 689 && Main.netMode != 1 && !Main.dayTime)
				{
					int num351 = Player.FindClosest(position, width, height);
					if (Vector2.Distance(base.Center, Main.player[num351].Center) < 80f && Collision.CanHit(position, width, height, Main.player[num351].position, Main.player[num351].width, Main.player[num351].height))
					{
						Transform(317);
					}
				}
				if (localAI[0] == 0f)
				{
					TargetClosest();
					this.ai[0] = 1f;
					localAI[0] = 1f;
					netUpdate = true;
				}
				else if (this.ai[0] == 1f && Main.cloudAlpha == 0f && !Main.dayTime)
				{
					for (int num352 = 0; num352 < Main.maxNPCs; num352++)
					{
						if (num352 == whoAmI || !Main.npc[num352].active)
						{
							continue;
						}
						if (Main.npc[num352].townNPC)
						{
							if (Math.Abs(base.Center.X - Main.npc[num352].Center.X) < 96f)
							{
								float num353 = Main.npc[num352].Center.Y - base.Center.Y;
								if (num353 > 32f && num353 < 320f && !Collision.CanHit(this, Main.npc[num352]))
								{
									this.ai[0] = 2f;
								}
							}
						}
						else if (Main.npc[num352].type == type && Main.npc[num352].ai[0] != 1f && Math.Abs(base.Center.X - Main.npc[num352].Center.X) < 320f)
						{
							this.ai[0] = 1f;
							break;
						}
					}
				}
			}
			if (this.ai[0] == 0f)
			{
				noGravity = false;
				if ((type == 611 || type == 689) && (Main.cloudAlpha > 0f || Main.dayTime))
				{
					this.ai[0] = 1f;
				}
				TargetClosest();
				if (Main.netMode != 1)
				{
					if (releaseOwner != 255 || velocity.X != 0f || velocity.Y < 0f || (double)velocity.Y > 0.3)
					{
						this.ai[0] = 1f;
						netUpdate = true;
						direction = -direction;
					}
					else if (type != 611 && type != 689)
					{
						Rectangle rectangle2 = new Rectangle((int)Main.player[target].position.X, (int)Main.player[target].position.Y, Main.player[target].width, Main.player[target].height);
						if (new Rectangle((int)position.X - 100, (int)position.Y - 100, width + 200, height + 200).Intersects(rectangle2) || life < lifeMax)
						{
							this.ai[0] = 1f;
							velocity.Y -= 6f;
							netUpdate = true;
							direction = -direction;
						}
					}
				}
			}
			else if (this.ai[0] == 2f)
			{
				velocity.X *= 0.98f;
				if (velocity.Y == 0f)
				{
					this.ai[0] = 0f;
					velocity.X = 0f;
				}
				velocity.Y += 0.05f;
				if (velocity.Y > 2f)
				{
					velocity.Y = 2f;
				}
			}
			else if (!Main.player[target].dead)
			{
				float num354 = 3f;
				if (type == 671 || type == 672 || type == 673 || type == 674 || type == 675)
				{
					num354 = 4f;
				}
				if (collideX)
				{
					direction *= -1;
					velocity.X = oldVelocity.X * -0.5f;
					if (direction == -1 && velocity.X > 0f && velocity.X < num354 - 1f)
					{
						velocity.X = num354 - 1f;
					}
					if (direction == 1 && velocity.X < 0f && velocity.X > 0f - num354 + 1f)
					{
						velocity.X = 0f - num354 + 1f;
					}
				}
				if (collideY)
				{
					velocity.Y = oldVelocity.Y * -0.5f;
					if (velocity.Y > 0f && velocity.Y < 1f)
					{
						velocity.Y = 1f;
					}
					if (velocity.Y < 0f && velocity.Y > -1f)
					{
						velocity.Y = -1f;
					}
				}
				if (direction == -1 && velocity.X > 0f - num354)
				{
					velocity.X -= 0.1f;
					if (velocity.X > num354)
					{
						velocity.X -= 0.1f;
					}
					else if (velocity.X > 0f)
					{
						velocity.X -= 0.05f;
					}
					if (velocity.X < 0f - num354)
					{
						velocity.X = 0f - num354;
					}
				}
				else if (direction == 1 && velocity.X < num354)
				{
					velocity.X += 0.1f;
					if (velocity.X < 0f - num354)
					{
						velocity.X += 0.1f;
					}
					else if (velocity.X < 0f)
					{
						velocity.X += 0.05f;
					}
					if (velocity.X > num354)
					{
						velocity.X = num354;
					}
				}
				int num355 = (int)((position.X + (float)(width / 2)) / 16f) + direction;
				int num356 = (int)((position.Y + (float)height) / 16f);
				bool flag34 = true;
				int num357 = 15;
				bool flag35 = false;
				for (int num358 = num356; num358 < num356 + num357; num358++)
				{
					if (!WorldGen.InWorld(num355, num358))
					{
						continue;
					}
					if (Main.tile[num355, num358] == null)
					{
						Main.tile[num355, num358] = new Tile();
					}
					if ((Main.tile[num355, num358].nactive() && Main.tileSolid[Main.tile[num355, num358].type]) || Main.tile[num355, num358].liquid > 0)
					{
						if (num358 < num356 + 5)
						{
							flag35 = true;
						}
						flag34 = false;
						break;
					}
				}
				if (flag34)
				{
					velocity.Y += 0.05f;
				}
				else
				{
					velocity.Y -= 0.1f;
				}
				if (flag35)
				{
					velocity.Y -= 0.2f;
				}
				if (velocity.Y > 2f)
				{
					velocity.Y = 2f;
				}
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
			}
			if (wet)
			{
				this.ai[1] = 0f;
				if (velocity.Y > 0f)
				{
					velocity.Y *= 0.95f;
				}
				velocity.Y -= 0.5f;
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
				TargetClosest();
			}
		}
		else if (aiStyle == 25)
		{
			bool flag36 = type == 341 && !Main.snowMoon;
			if (this.ai[3] == 0f)
			{
				position.X += 8f;
				if (position.Y / 16f > (float)Main.UnderworldLayer)
				{
					this.ai[3] = 3f;
				}
				else if ((double)(position.Y / 16f) > Main.worldSurface)
				{
					TargetClosest();
					this.ai[3] = 2f;
				}
				else
				{
					this.ai[3] = 1f;
				}
			}
			if (type == 341 || type == 629)
			{
				this.ai[3] = 1f;
			}
			if (this.ai[0] == 0f)
			{
				if (!flag36)
				{
					TargetClosest();
				}
				if (Main.netMode == 1)
				{
					return;
				}
				if (velocity.X != 0f || velocity.Y < 0f || (double)velocity.Y > 0.3)
				{
					this.ai[0] = 1f;
					netUpdate = true;
					return;
				}
				Rectangle rectangle3 = new Rectangle((int)Main.player[target].position.X, (int)Main.player[target].position.Y, Main.player[target].width, Main.player[target].height);
				if (new Rectangle((int)position.X - 100, (int)position.Y - 100, width + 200, height + 200).Intersects(rectangle3) || life < lifeMax)
				{
					this.ai[0] = 1f;
					netUpdate = true;
				}
			}
			else if (velocity.Y == 0f)
			{
				this.ai[2] += 1f;
				int num359 = 20;
				if (this.ai[1] == 0f)
				{
					num359 = 12;
				}
				if (this.ai[2] < (float)num359)
				{
					velocity.X *= 0.9f;
					return;
				}
				this.ai[2] = 0f;
				if (!flag36)
				{
					TargetClosest();
				}
				if (direction == 0)
				{
					direction = -1;
				}
				spriteDirection = direction;
				this.ai[1] += 1f;
				if (this.ai[1] == 2f)
				{
					velocity.X = (float)direction * 2.5f;
					velocity.Y = -8f;
					this.ai[1] = 0f;
				}
				else
				{
					velocity.X = (float)direction * 3.5f;
					velocity.Y = -4f;
				}
				netUpdate = true;
			}
			else if (direction == 1 && velocity.X < 1f)
			{
				velocity.X += 0.1f;
			}
			else if (direction == -1 && velocity.X > -1f)
			{
				velocity.X -= 0.1f;
			}
		}
		else if (aiStyle == 26)
		{
			AI_026_Unicorns();
		}
		else if (aiStyle == 27)
		{
			if (position.X < 160f || position.X > (float)((Main.maxTilesX - 10) * 16))
			{
				active = false;
			}
			NetUpdateLowPriority();
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				Main.wofDrawAreaBottom = -1;
				Main.wofDrawAreaTop = -1;
			}
			if (Main.getGoodWorld && Main.netMode != 1 && Main.rand.Next(180) == 0 && CountNPCS(24) < 4)
			{
				int num360 = 1;
				for (int num361 = 0; num361 < num360; num361++)
				{
					int num362 = 1000;
					for (int num363 = 0; num363 < num362; num363++)
					{
						int num364 = (int)(base.Center.X / 16f);
						int num365 = (int)(base.Center.Y / 16f);
						if (target >= 0)
						{
							num364 = (int)(Main.player[target].Center.X / 16f);
							num365 = (int)(Main.player[target].Center.Y / 16f);
						}
						num364 += Main.rand.Next(-50, 51);
						for (num365 += Main.rand.Next(-50, 51); num365 < Main.maxTilesY - 10 && !WorldGen.SolidTile(num364, num365); num365++)
						{
						}
						num365--;
						if (!WorldGen.SolidTile(num364, num365))
						{
							int num366 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), num364 * 16 + 8, num365 * 16, 24);
							if (Main.netMode == 2 && num366 < Main.maxNPCs)
							{
								NetMessage.SendData(23, -1, -1, null, num366);
							}
							break;
						}
					}
				}
			}
			this.ai[1] += 1f;
			if (this.ai[2] == 0f)
			{
				if ((double)life < (double)lifeMax * 0.5)
				{
					this.ai[1] += 1f;
				}
				if ((double)life < (double)lifeMax * 0.2)
				{
					this.ai[1] += 1f;
				}
				if (this.ai[1] > 2700f)
				{
					this.ai[2] = 1f;
				}
			}
			int num367 = 60;
			if (this.ai[2] > 0f && this.ai[1] > (float)num367)
			{
				int num368 = 3;
				if ((double)life < (double)lifeMax * 0.3)
				{
					num368++;
				}
				this.ai[2] += 1f;
				this.ai[1] = 0f;
				if (this.ai[2] > (float)num368)
				{
					this.ai[2] = 0f;
				}
				if (Main.netMode != 1 && CountNPCS(117) < 10)
				{
					int num369 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)(position.Y + (float)(height / 2) + 20f), 117, 1);
					Main.npc[num369].velocity.X = direction * 8;
				}
			}
			localAI[3] += 1f;
			if (localAI[3] >= (float)(600 + Main.rand.Next(1000)))
			{
				localAI[3] = -Main.rand.Next(200);
				SoundEngine.PlaySound(4, (int)position.X, (int)position.Y, 10);
			}
			int num370 = Main.UnderworldLayer + 10;
			int num371 = num370 + 70;
			Main.wofNPCIndex = whoAmI;
			int num372 = (int)(position.X / 16f);
			int num373 = (int)((position.X + (float)width) / 16f);
			int num374 = (int)((position.Y + (float)(height / 2)) / 16f);
			int num375 = 0;
			int num376 = num374 + 7;
			while (num375 < 15 && num376 > Main.UnderworldLayer)
			{
				num376++;
				if (num376 > Main.maxTilesY - 10)
				{
					num376 = Main.maxTilesY - 10;
					break;
				}
				if (num376 < num370)
				{
					continue;
				}
				for (int num377 = num372; num377 <= num373; num377++)
				{
					try
					{
						if (WorldGen.InWorld(num377, num376, 2) && (WorldGen.SolidTile(num377, num376) || Main.tile[num377, num376].liquid > 0))
						{
							num375++;
						}
					}
					catch
					{
						num375 += 15;
					}
				}
			}
			num376 += 4;
			if (Main.wofDrawAreaBottom == -1)
			{
				Main.wofDrawAreaBottom = num376 * 16;
			}
			else if (Main.wofDrawAreaBottom > num376 * 16)
			{
				Main.wofDrawAreaBottom--;
				if (Main.wofDrawAreaBottom < num376 * 16)
				{
					Main.wofDrawAreaBottom = num376 * 16;
				}
			}
			else if (Main.wofDrawAreaBottom < num376 * 16)
			{
				Main.wofDrawAreaBottom++;
				if (Main.wofDrawAreaBottom > num376 * 16)
				{
					Main.wofDrawAreaBottom = num376 * 16;
				}
			}
			num375 = 0;
			num376 = num374 - 7;
			while (num375 < 15 && num376 < Main.maxTilesY - 10)
			{
				num376--;
				if (num376 <= 10)
				{
					num376 = 10;
					break;
				}
				if (num376 > num371)
				{
					continue;
				}
				if (num376 < num370)
				{
					num376 = num370;
					break;
				}
				for (int num378 = num372; num378 <= num373; num378++)
				{
					try
					{
						if (WorldGen.InWorld(num378, num376, 2) && (WorldGen.SolidTile(num378, num376) || Main.tile[num378, num376].liquid > 0))
						{
							num375++;
						}
					}
					catch
					{
						num375 += 15;
					}
				}
			}
			num376 -= 4;
			if (Main.wofDrawAreaTop == -1)
			{
				Main.wofDrawAreaTop = num376 * 16;
			}
			else if (Main.wofDrawAreaTop > num376 * 16)
			{
				Main.wofDrawAreaTop--;
				if (Main.wofDrawAreaTop < num376 * 16)
				{
					Main.wofDrawAreaTop = num376 * 16;
				}
			}
			else if (Main.wofDrawAreaTop < num376 * 16)
			{
				Main.wofDrawAreaTop++;
				if (Main.wofDrawAreaTop > num376 * 16)
				{
					Main.wofDrawAreaTop = num376 * 16;
				}
			}
			Main.wofDrawAreaTop = (int)MathHelper.Clamp(Main.wofDrawAreaTop, (float)num370 * 16f, (float)num371 * 16f);
			Main.wofDrawAreaBottom = (int)MathHelper.Clamp(Main.wofDrawAreaBottom, (float)num370 * 16f, (float)num371 * 16f);
			if (Main.wofDrawAreaTop > Main.wofDrawAreaBottom - 160)
			{
				Main.wofDrawAreaTop = Main.wofDrawAreaBottom - 160;
			}
			else if (Main.wofDrawAreaBottom < Main.wofDrawAreaTop + 160)
			{
				Main.wofDrawAreaBottom = Main.wofDrawAreaTop + 160;
			}
			float num379 = (Main.wofDrawAreaBottom + Main.wofDrawAreaTop) / 2 - height / 2;
			if (position.Y > num379 + 1f)
			{
				velocity.Y = -1f;
			}
			else if (position.Y < num379 - 1f)
			{
				velocity.Y = 1f;
			}
			velocity.Y = 0f;
			position.Y = num379;
			float num380 = 1.5f;
			if ((double)life < (double)lifeMax * 0.75)
			{
				num380 += 0.25f;
			}
			if ((double)life < (double)lifeMax * 0.5)
			{
				num380 += 0.4f;
			}
			if ((double)life < (double)lifeMax * 0.25)
			{
				num380 += 0.5f;
			}
			if ((double)life < (double)lifeMax * 0.1)
			{
				num380 += 0.6f;
			}
			if ((double)life < (double)lifeMax * 0.66 && Main.expertMode)
			{
				num380 += 0.3f;
			}
			if ((double)life < (double)lifeMax * 0.33 && Main.expertMode)
			{
				num380 += 0.3f;
			}
			if ((double)life < (double)lifeMax * 0.05 && Main.expertMode)
			{
				num380 += 0.6f;
			}
			if ((double)life < (double)lifeMax * 0.035 && Main.expertMode)
			{
				num380 += 0.6f;
			}
			if ((double)life < (double)lifeMax * 0.025 && Main.expertMode)
			{
				num380 += 0.6f;
			}
			if (Main.expertMode)
			{
				num380 *= 1.35f;
				num380 += 0.35f;
			}
			if (Main.getGoodWorld)
			{
				num380 *= 1.1f;
				num380 += 0.2f;
			}
			if (velocity.X == 0f)
			{
				TargetClosest();
				if (Main.player[target].dead)
				{
					float num381 = float.PositiveInfinity;
					int num382 = 0;
					for (int num383 = 0; num383 < 255; num383++)
					{
						Player player3 = Main.player[target];
						if (player3.active)
						{
							float num384 = Distance(player3.Center);
							if (num381 > num384)
							{
								num381 = num384;
								num382 = ((base.Center.X < player3.Center.X) ? 1 : (-1));
							}
						}
					}
					direction = num382;
				}
				velocity.X = direction;
			}
			if (velocity.X < 0f)
			{
				velocity.X = 0f - num380;
				direction = -1;
			}
			else
			{
				velocity.X = num380;
				direction = 1;
			}
			if (Main.player[target].dead || !Main.player[target].gross)
			{
				TargetClosest_WOF();
			}
			if (Main.player[target].dead)
			{
				localAI[1] += 1f / 180f;
				if (localAI[1] >= 1f)
				{
					SoundEngine.PlaySound(4, (int)position.X, (int)position.Y, 10);
					life = 0;
					active = false;
					if (Main.netMode != 1)
					{
						NetMessage.SendData(28, -1, -1, null, whoAmI, -1f);
					}
					return;
				}
			}
			else
			{
				localAI[1] = MathHelper.Clamp(localAI[1] - 1f / 30f, 0f, 1f);
			}
			spriteDirection = direction;
			Vector2 vector34 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num385 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector34.X;
			float num386 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector34.Y;
			float num387 = (float)Math.Sqrt(num385 * num385 + num386 * num386);
			float num388 = num387;
			num385 *= num387;
			num386 *= num387;
			if (direction > 0)
			{
				if (Main.player[target].position.X + (float)(Main.player[target].width / 2) > position.X + (float)(width / 2))
				{
					rotation = (float)Math.Atan2(0f - num386, 0f - num385) + 3.14f;
				}
				else
				{
					rotation = 0f;
				}
			}
			else if (Main.player[target].position.X + (float)(Main.player[target].width / 2) < position.X + (float)(width / 2))
			{
				rotation = (float)Math.Atan2(num386, num385) + 3.14f;
			}
			else
			{
				rotation = 0f;
			}
			if (Main.expertMode && Main.netMode != 1)
			{
				int num389 = (int)(1f + (float)life / (float)lifeMax * 10f);
				num389 *= num389;
				if (num389 < 400)
				{
					num389 = (num389 * 19 + 400) / 20;
				}
				if (num389 < 60)
				{
					num389 = (num389 * 3 + 60) / 4;
				}
				if (num389 < 20)
				{
					num389 = (num389 + 20) / 2;
				}
				num389 = (int)((double)num389 * 0.7);
				if (Main.rand.Next(num389) == 0)
				{
					int num390 = 0;
					float[] array = new float[10];
					for (int num391 = 0; num391 < Main.maxNPCs; num391++)
					{
						if (num390 < 10 && Main.npc[num391].active && Main.npc[num391].type == 115)
						{
							array[num390] = Main.npc[num391].ai[0];
							num390++;
						}
					}
					int maxValue = 1 + num390 * 2;
					if (num390 < 10 && Main.rand.Next(maxValue) <= 1)
					{
						int num392 = -1;
						for (int num393 = 0; num393 < 1000; num393++)
						{
							int num394 = Main.rand.Next(10);
							float num395 = (float)num394 * 0.1f - 0.05f;
							bool flag37 = true;
							for (int num396 = 0; num396 < num390; num396++)
							{
								if (num395 == array[num396])
								{
									flag37 = false;
									break;
								}
							}
							if (flag37)
							{
								num392 = num394;
								break;
							}
						}
						if (num392 >= 0)
						{
							NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)position.X, (int)num379, 115, whoAmI, (float)num392 * 0.1f - 0.05f);
						}
					}
				}
			}
			if (Main.netMode != 1 && localAI[0] == 1f)
			{
				localAI[0] = 2f;
				float num397 = (base.Center.Y + (float)Main.wofDrawAreaTop) / 2f;
				int num398 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)position.X, (int)num397, 114, whoAmI, 1f);
				float num399 = (base.Center.Y + (float)Main.wofDrawAreaBottom) / 2f;
				num398 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)position.X, (int)num399, 114, whoAmI, -1f);
				float num400 = (base.Center.Y + (float)Main.wofDrawAreaBottom) / 2f;
				for (int num401 = 0; num401 < 11; num401++)
				{
					num398 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)position.X, (int)num400, 115, whoAmI, (float)num401 * 0.1f - 0.05f);
				}
			}
		}
		else if (aiStyle == 28)
		{
			if (Main.wofNPCIndex < 0)
			{
				active = false;
				return;
			}
			realLife = Main.wofNPCIndex;
			if (Main.npc[Main.wofNPCIndex].life > 0)
			{
				life = Main.npc[Main.wofNPCIndex].life;
			}
			TargetClosest();
			position.X = Main.npc[Main.wofNPCIndex].position.X;
			direction = Main.npc[Main.wofNPCIndex].direction;
			spriteDirection = direction;
			float num402 = (Main.wofDrawAreaBottom + Main.wofDrawAreaTop) / 2;
			num402 = ((!(this.ai[0] > 0f)) ? ((num402 + (float)Main.wofDrawAreaBottom) / 2f) : ((num402 + (float)Main.wofDrawAreaTop) / 2f));
			num402 -= (float)(height / 2);
			if (position.Y > num402 + 1f)
			{
				velocity.Y = -1f;
			}
			else if (position.Y < num402 - 1f)
			{
				velocity.Y = 1f;
			}
			else
			{
				velocity.Y = 0f;
				position.Y = num402;
			}
			if (velocity.Y > 5f)
			{
				velocity.Y = 5f;
			}
			if (velocity.Y < -5f)
			{
				velocity.Y = -5f;
			}
			Vector2 vector35 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num403 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector35.X;
			float num404 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector35.Y;
			float num405 = (float)Math.Sqrt(num403 * num403 + num404 * num404);
			float num406 = num405;
			num403 *= num405;
			num404 *= num405;
			bool flag38 = true;
			if (direction > 0)
			{
				if (Main.player[target].position.X + (float)(Main.player[target].width / 2) > position.X + (float)(width / 2))
				{
					rotation = (float)Math.Atan2(0f - num404, 0f - num403) + 3.14f;
				}
				else
				{
					rotation = 0f;
					flag38 = false;
				}
			}
			else if (Main.player[target].position.X + (float)(Main.player[target].width / 2) < position.X + (float)(width / 2))
			{
				rotation = (float)Math.Atan2(num404, num403) + 3.14f;
			}
			else
			{
				rotation = 0f;
				flag38 = false;
			}
			if (Main.netMode == 1)
			{
				return;
			}
			int num407 = 4;
			localAI[1] += 1f;
			if ((double)Main.npc[Main.wofNPCIndex].life < (double)Main.npc[Main.wofNPCIndex].lifeMax * 0.75)
			{
				localAI[1] += 1f;
				num407++;
			}
			if ((double)Main.npc[Main.wofNPCIndex].life < (double)Main.npc[Main.wofNPCIndex].lifeMax * 0.5)
			{
				localAI[1] += 1f;
				num407++;
			}
			if ((double)Main.npc[Main.wofNPCIndex].life < (double)Main.npc[Main.wofNPCIndex].lifeMax * 0.25)
			{
				localAI[1] += 1f;
				num407 += 2;
			}
			if ((double)Main.npc[Main.wofNPCIndex].life < (double)Main.npc[Main.wofNPCIndex].lifeMax * 0.1)
			{
				localAI[1] += 2f;
				num407 += 3;
			}
			if (Main.expertMode)
			{
				localAI[1] += 0.5f;
				num407++;
				if ((double)Main.npc[Main.wofNPCIndex].life < (double)Main.npc[Main.wofNPCIndex].lifeMax * 0.1)
				{
					localAI[1] += 2f;
					num407 += 3;
				}
			}
			if (localAI[2] == 0f)
			{
				if (localAI[1] > 600f)
				{
					localAI[2] = 1f;
					localAI[1] = 0f;
				}
			}
			else
			{
				if (!(localAI[1] > 45f) || !Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
				{
					return;
				}
				localAI[1] = 0f;
				localAI[2] += 1f;
				if (localAI[2] >= (float)num407)
				{
					localAI[2] = 0f;
				}
				if (flag38)
				{
					float num408 = 9f;
					int num409 = 11;
					int num410 = 83;
					if ((double)Main.npc[Main.wofNPCIndex].life < (double)Main.npc[Main.wofNPCIndex].lifeMax * 0.5)
					{
						num409++;
						num408 += 1f;
					}
					if ((double)Main.npc[Main.wofNPCIndex].life < (double)Main.npc[Main.wofNPCIndex].lifeMax * 0.25)
					{
						num409++;
						num408 += 1f;
					}
					if ((double)Main.npc[Main.wofNPCIndex].life < (double)Main.npc[Main.wofNPCIndex].lifeMax * 0.1)
					{
						num409 += 2;
						num408 += 2f;
					}
					vector35 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					num403 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector35.X;
					num404 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector35.Y;
					num405 = (float)Math.Sqrt(num403 * num403 + num404 * num404);
					num405 = num408 / num405;
					num403 *= num405;
					num404 *= num405;
					vector35.X += num403;
					vector35.Y += num404;
					int num411 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector35.X, vector35.Y, num403, num404, num410, num409, 0f, Main.myPlayer);
				}
			}
		}
		else if (aiStyle == 29)
		{
			if (justHit)
			{
				this.ai[1] = 10f;
			}
			if (Main.wofNPCIndex < 0)
			{
				active = false;
				return;
			}
			TargetClosest();
			float num412 = 0.1f;
			float num413 = 300f;
			damage = defDamage;
			int num414 = 0;
			if ((double)Main.npc[Main.wofNPCIndex].life < (double)Main.npc[Main.wofNPCIndex].lifeMax * 0.5)
			{
				num414 = 60;
				defense = 30;
				if (!Main.expertMode)
				{
					num413 = 700f;
				}
				else
				{
					num412 += 0.066f;
				}
			}
			else if ((double)Main.npc[Main.wofNPCIndex].life < (double)Main.npc[Main.wofNPCIndex].lifeMax * 0.75)
			{
				num414 = 45;
				defense = 20;
				if (!Main.expertMode)
				{
					num413 = 500f;
				}
				else
				{
					num412 += 0.033f;
				}
			}
			if (num414 > 0)
			{
				damage = GetAttackDamage_ScaledByDifficulty(num414);
			}
			if (Main.expertMode)
			{
				defense = defDefense;
				if (whoAmI % 4 == 0)
				{
					num413 *= 1.75f;
				}
				if (whoAmI % 4 == 1)
				{
					num413 *= 1.5f;
				}
				if (whoAmI % 4 == 2)
				{
					num413 *= 1.25f;
				}
				if (whoAmI % 3 == 0)
				{
					num413 *= 1.5f;
				}
				if (whoAmI % 3 == 1)
				{
					num413 *= 1.25f;
				}
				num413 *= 0.75f;
			}
			float num415 = Main.npc[Main.wofNPCIndex].position.X + (float)(Main.npc[Main.wofNPCIndex].width / 2);
			float y2 = Main.npc[Main.wofNPCIndex].position.Y;
			float num416 = Main.wofDrawAreaBottom - Main.wofDrawAreaTop;
			y2 = (float)Main.wofDrawAreaTop + num416 * this.ai[0];
			this.ai[2] += 1f;
			if (this.ai[2] > 100f)
			{
				num413 = (int)(num413 * 1.3f);
				if (this.ai[2] > 200f)
				{
					this.ai[2] = 0f;
				}
			}
			Vector2 vector36 = new Vector2(num415, y2);
			float num417 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - (float)(width / 2) - vector36.X;
			float num418 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - (float)(height / 2) - vector36.Y;
			float num419 = (float)Math.Sqrt(num417 * num417 + num418 * num418);
			if (this.ai[1] == 0f)
			{
				if (num419 > num413)
				{
					num419 = num413 / num419;
					num417 *= num419;
					num418 *= num419;
				}
				if (position.X < num415 + num417)
				{
					velocity.X += num412;
					if (velocity.X < 0f && num417 > 0f)
					{
						velocity.X += num412 * 2.5f;
					}
				}
				else if (position.X > num415 + num417)
				{
					velocity.X -= num412;
					if (velocity.X > 0f && num417 < 0f)
					{
						velocity.X -= num412 * 2.5f;
					}
				}
				if (position.Y < y2 + num418)
				{
					velocity.Y += num412;
					if (velocity.Y < 0f && num418 > 0f)
					{
						velocity.Y += num412 * 2.5f;
					}
				}
				else if (position.Y > y2 + num418)
				{
					velocity.Y -= num412;
					if (velocity.Y > 0f && num418 < 0f)
					{
						velocity.Y -= num412 * 2.5f;
					}
				}
				float num420 = 4f;
				if (Main.expertMode && Main.wofNPCIndex >= 0)
				{
					float num421 = 1.5f;
					float num422 = Main.npc[Main.wofNPCIndex].life / Main.npc[Main.wofNPCIndex].lifeMax;
					if ((double)num422 < 0.75)
					{
						num421 += 0.7f;
					}
					if ((double)num422 < 0.5)
					{
						num421 += 0.7f;
					}
					if ((double)num422 < 0.25)
					{
						num421 += 0.9f;
					}
					if ((double)num422 < 0.1)
					{
						num421 += 0.9f;
					}
					num421 *= 1.25f;
					num421 += 0.3f;
					num420 += num421 * 0.35f;
					if (base.Center.X < Main.npc[Main.wofNPCIndex].Center.X && Main.npc[Main.wofNPCIndex].velocity.X > 0f)
					{
						num420 += 6f;
					}
					if (base.Center.X > Main.npc[Main.wofNPCIndex].Center.X && Main.npc[Main.wofNPCIndex].velocity.X < 0f)
					{
						num420 += 6f;
					}
				}
				if (velocity.X > num420)
				{
					velocity.X = num420;
				}
				if (velocity.X < 0f - num420)
				{
					velocity.X = 0f - num420;
				}
				if (velocity.Y > num420)
				{
					velocity.Y = num420;
				}
				if (velocity.Y < 0f - num420)
				{
					velocity.Y = 0f - num420;
				}
			}
			else if (this.ai[1] > 0f)
			{
				this.ai[1] -= 1f;
			}
			else
			{
				this.ai[1] = 0f;
			}
			if (num417 > 0f)
			{
				spriteDirection = 1;
				rotation = (float)Math.Atan2(num418, num417);
			}
			if (num417 < 0f)
			{
				spriteDirection = -1;
				rotation = (float)Math.Atan2(num418, num417) + 3.14f;
			}
			Lighting.AddLight((int)(position.X + (float)(width / 2)) / 16, (int)(position.Y + (float)(height / 2)) / 16, 0.3f, 0.2f, 0.1f);
		}
		else if (aiStyle == 30)
		{
			if (target < 0 || target == 255 || Main.player[target].dead || !Main.player[target].active)
			{
				TargetClosest();
			}
			bool dead2 = Main.player[target].dead;
			float num423 = position.X + (float)(width / 2) - Main.player[target].position.X - (float)(Main.player[target].width / 2);
			float num424 = position.Y + (float)height - 59f - Main.player[target].position.Y - (float)(Main.player[target].height / 2);
			float num425 = (float)Math.Atan2(num424, num423) + 1.57f;
			if (num425 < 0f)
			{
				num425 += 6.283f;
			}
			else if ((double)num425 > 6.283)
			{
				num425 -= 6.283f;
			}
			float num426 = 0.1f;
			if (rotation < num425)
			{
				if ((double)(num425 - rotation) > 3.1415)
				{
					rotation -= num426;
				}
				else
				{
					rotation += num426;
				}
			}
			else if (rotation > num425)
			{
				if ((double)(rotation - num425) > 3.1415)
				{
					rotation += num426;
				}
				else
				{
					rotation -= num426;
				}
			}
			if (rotation > num425 - num426 && rotation < num425 + num426)
			{
				rotation = num425;
			}
			if (rotation < 0f)
			{
				rotation += 6.283f;
			}
			else if ((double)rotation > 6.283)
			{
				rotation -= 6.283f;
			}
			if (rotation > num425 - num426 && rotation < num425 + num426)
			{
				rotation = num425;
			}
			if (Main.rand.Next(5) == 0)
			{
				int num427 = Dust.NewDust(new Vector2(position.X, position.Y + (float)height * 0.25f), width, (int)((float)height * 0.5f), 5, velocity.X, 2f);
				Main.dust[num427].velocity.X *= 0.5f;
				Main.dust[num427].velocity.Y *= 0.1f;
			}
			if (Main.netMode != 1 && !Main.IsItDay() && !dead2 && timeLeft < 10)
			{
				for (int num428 = 0; num428 < Main.maxNPCs; num428++)
				{
					if (num428 != whoAmI && Main.npc[num428].active && (Main.npc[num428].type == 125 || Main.npc[num428].type == 126))
					{
						DiscourageDespawn(Main.npc[num428].timeLeft - 1);
					}
				}
			}
			Vector2 vector37 = Vector2.Zero;
			if (IsMechQueenUp)
			{
				NPC nPC = Main.npc[mechQueen];
				Vector2 mechQueenCenter = nPC.GetMechQueenCenter();
				Vector2 vector38 = new Vector2(-150f, -250f);
				vector38 *= 0.75f;
				float num429 = nPC.velocity.X * 0.025f;
				vector37 = mechQueenCenter + vector38;
				vector37 = vector37.RotatedBy(num429, mechQueenCenter);
			}
			reflectsProjectiles = false;
			if (Main.IsItDay() || dead2)
			{
				velocity.Y -= 0.04f;
				EncourageDespawn(10);
				return;
			}
			if (this.ai[0] == 0f)
			{
				if (this.ai[1] == 0f)
				{
					float num430 = 7f;
					float num431 = 0.1f;
					if (Main.expertMode)
					{
						num430 = 8.25f;
						num431 = 0.115f;
					}
					if (Main.getGoodWorld)
					{
						num430 *= 1.15f;
						num431 *= 1.15f;
					}
					int num432 = 1;
					if (position.X + (float)(width / 2) < Main.player[target].position.X + (float)Main.player[target].width)
					{
						num432 = -1;
					}
					Vector2 vector39 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num433 = Main.player[target].position.X + (float)(Main.player[target].width / 2) + (float)(num432 * 300) - vector39.X;
					float num434 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - 300f - vector39.Y;
					if (IsMechQueenUp)
					{
						num430 = 14f;
						num433 = vector37.X;
						num434 = vector37.Y;
						num433 -= vector39.X;
						num434 -= vector39.Y;
					}
					float num435 = (float)Math.Sqrt(num433 * num433 + num434 * num434);
					float num436 = num435;
					if (IsMechQueenUp)
					{
						if (num435 > num430)
						{
							num435 = num430 / num435;
							num433 *= num435;
							num434 *= num435;
						}
						float num437 = 60f;
						velocity.X = (velocity.X * (num437 - 1f) + num433) / num437;
						velocity.Y = (velocity.Y * (num437 - 1f) + num434) / num437;
					}
					else
					{
						num435 = num430 / num435;
						num433 *= num435;
						num434 *= num435;
						if (velocity.X < num433)
						{
							velocity.X += num431;
							if (velocity.X < 0f && num433 > 0f)
							{
								velocity.X += num431;
							}
						}
						else if (velocity.X > num433)
						{
							velocity.X -= num431;
							if (velocity.X > 0f && num433 < 0f)
							{
								velocity.X -= num431;
							}
						}
						if (velocity.Y < num434)
						{
							velocity.Y += num431;
							if (velocity.Y < 0f && num434 > 0f)
							{
								velocity.Y += num431;
							}
						}
						else if (velocity.Y > num434)
						{
							velocity.Y -= num431;
							if (velocity.Y > 0f && num434 < 0f)
							{
								velocity.Y -= num431;
							}
						}
					}
					int num438 = 600;
					int num439 = 60;
					if (IsMechQueenUp)
					{
						num438 = 1200;
						num439 = ((!npcsFoundForCheckActive[135]) ? 90 : 120);
					}
					this.ai[2] += 1f;
					if (this.ai[2] >= (float)num438)
					{
						this.ai[1] = 1f;
						this.ai[2] = 0f;
						this.ai[3] = 0f;
						target = 255;
						netUpdate = true;
					}
					else if (position.Y + (float)height < Main.player[target].position.Y && num436 < 400f)
					{
						if (!Main.player[target].dead)
						{
							this.ai[3] += 1f;
							if (Main.expertMode && (double)life < (double)lifeMax * 0.9)
							{
								this.ai[3] += 0.3f;
							}
							if (Main.expertMode && (double)life < (double)lifeMax * 0.8)
							{
								this.ai[3] += 0.3f;
							}
							if (Main.expertMode && (double)life < (double)lifeMax * 0.7)
							{
								this.ai[3] += 0.3f;
							}
							if (Main.expertMode && (double)life < (double)lifeMax * 0.6)
							{
								this.ai[3] += 0.3f;
							}
							if (Main.getGoodWorld)
							{
								this.ai[3] += 0.5f;
							}
						}
						if (this.ai[3] >= (float)num439)
						{
							this.ai[3] = 0f;
							vector39 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
							num433 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector39.X;
							num434 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector39.Y;
							if (Main.netMode != 1)
							{
								float num440 = 9f;
								int attackDamage_ForProjectiles3 = GetAttackDamage_ForProjectiles(20f, 19f);
								int num441 = 83;
								if (Main.expertMode)
								{
									num440 = 10.5f;
								}
								num435 = (float)Math.Sqrt(num433 * num433 + num434 * num434);
								num435 = num440 / num435;
								num433 *= num435;
								num434 *= num435;
								num433 += (float)Main.rand.Next(-40, 41) * 0.08f;
								num434 += (float)Main.rand.Next(-40, 41) * 0.08f;
								vector39.X += num433 * 15f;
								vector39.Y += num434 * 15f;
								int num442 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector39.X, vector39.Y, num433, num434, num441, attackDamage_ForProjectiles3, 0f, Main.myPlayer);
							}
						}
					}
				}
				else if (this.ai[1] == 1f)
				{
					rotation = num425;
					float num443 = 12f;
					if (Main.expertMode)
					{
						num443 = 15f;
					}
					if (Main.getGoodWorld)
					{
						num443 += 2f;
					}
					Vector2 vector40 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num444 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector40.X;
					float num445 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector40.Y;
					float num446 = (float)Math.Sqrt(num444 * num444 + num445 * num445);
					num446 = num443 / num446;
					velocity.X = num444 * num446;
					velocity.Y = num445 * num446;
					this.ai[1] = 2f;
				}
				else if (this.ai[1] == 2f)
				{
					this.ai[2] += 1f;
					if (this.ai[2] >= 25f)
					{
						velocity.X *= 0.96f;
						velocity.Y *= 0.96f;
						if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
						{
							velocity.X = 0f;
						}
						if ((double)velocity.Y > -0.1 && (double)velocity.Y < 0.1)
						{
							velocity.Y = 0f;
						}
					}
					else
					{
						rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
					}
					if (this.ai[2] >= 70f)
					{
						this.ai[3] += 1f;
						this.ai[2] = 0f;
						target = 255;
						rotation = num425;
						if (this.ai[3] >= 4f)
						{
							this.ai[1] = 0f;
							this.ai[3] = 0f;
						}
						else
						{
							this.ai[1] = 1f;
						}
					}
				}
				if ((double)life < (double)lifeMax * 0.4)
				{
					this.ai[0] = 1f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
				return;
			}
			if (this.ai[0] == 1f || this.ai[0] == 2f)
			{
				if (IsMechQueenUp)
				{
					reflectsProjectiles = true;
				}
				if (this.ai[0] == 1f)
				{
					this.ai[2] += 0.005f;
					if ((double)this.ai[2] > 0.5)
					{
						this.ai[2] = 0.5f;
					}
				}
				else
				{
					this.ai[2] -= 0.005f;
					if (this.ai[2] < 0f)
					{
						this.ai[2] = 0f;
					}
				}
				rotation += this.ai[2];
				this.ai[1] += 1f;
				if (this.ai[1] >= 100f)
				{
					this.ai[0] += 1f;
					this.ai[1] = 0f;
					if (this.ai[0] == 3f)
					{
						this.ai[2] = 0f;
					}
					else
					{
						SoundEngine.PlaySound(3, (int)position.X, (int)position.Y);
						for (int num447 = 0; num447 < 2; num447++)
						{
							Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 143);
							Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 7);
							Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 6);
						}
						for (int num448 = 0; num448 < 20; num448++)
						{
							Dust.NewDust(position, width, height, 5, (float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f);
						}
						SoundEngine.PlaySound(15, (int)position.X, (int)position.Y, 0);
					}
				}
				Dust.NewDust(position, width, height, 5, (float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f);
				velocity.X *= 0.98f;
				velocity.Y *= 0.98f;
				if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
				{
					velocity.X = 0f;
				}
				if ((double)velocity.Y > -0.1 && (double)velocity.Y < 0.1)
				{
					velocity.Y = 0f;
				}
				return;
			}
			damage = (int)((double)defDamage * 1.5);
			defense = defDefense + 10;
			HitSound = SoundID.NPCHit4;
			if (this.ai[1] == 0f)
			{
				float num449 = 8f;
				float num450 = 0.15f;
				if (Main.expertMode)
				{
					num449 = 9.5f;
					num450 = 0.175f;
				}
				if (Main.getGoodWorld)
				{
					num449 *= 1.15f;
					num450 *= 1.15f;
				}
				Vector2 vector41 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num451 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector41.X;
				float num452 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - 300f - vector41.Y;
				if (IsMechQueenUp)
				{
					num449 = 14f;
					num451 = vector37.X;
					num452 = vector37.Y;
					num451 -= vector41.X;
					num452 -= vector41.Y;
				}
				float num453 = (float)Math.Sqrt(num451 * num451 + num452 * num452);
				if (IsMechQueenUp)
				{
					if (num453 > num449)
					{
						num453 = num449 / num453;
						num451 *= num453;
						num452 *= num453;
					}
					velocity.X = (velocity.X * 4f + num451) / 5f;
					velocity.Y = (velocity.Y * 4f + num452) / 5f;
				}
				else
				{
					num453 = num449 / num453;
					num451 *= num453;
					num452 *= num453;
					if (velocity.X < num451)
					{
						velocity.X += num450;
						if (velocity.X < 0f && num451 > 0f)
						{
							velocity.X += num450;
						}
					}
					else if (velocity.X > num451)
					{
						velocity.X -= num450;
						if (velocity.X > 0f && num451 < 0f)
						{
							velocity.X -= num450;
						}
					}
					if (velocity.Y < num452)
					{
						velocity.Y += num450;
						if (velocity.Y < 0f && num452 > 0f)
						{
							velocity.Y += num450;
						}
					}
					else if (velocity.Y > num452)
					{
						velocity.Y -= num450;
						if (velocity.Y > 0f && num452 < 0f)
						{
							velocity.Y -= num450;
						}
					}
				}
				int num454 = 300;
				if (IsMechQueenUp)
				{
					num454 = 1200;
				}
				this.ai[2] += 1f;
				if (this.ai[2] >= (float)num454)
				{
					this.ai[1] = 1f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					TargetClosest();
					netUpdate = true;
				}
				vector41 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				num451 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector41.X;
				num452 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector41.Y;
				rotation = (float)Math.Atan2(num452, num451) - 1.57f;
				if (Main.netMode == 1)
				{
					return;
				}
				localAI[1] += 1f;
				if ((double)life < (double)lifeMax * 0.75)
				{
					localAI[1] += 1f;
				}
				if ((double)life < (double)lifeMax * 0.5)
				{
					localAI[1] += 1f;
				}
				if ((double)life < (double)lifeMax * 0.25)
				{
					localAI[1] += 1f;
				}
				if ((double)life < (double)lifeMax * 0.1)
				{
					localAI[1] += 2f;
				}
				if (localAI[1] > 180f && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
				{
					localAI[1] = 0f;
					float num455 = 8.5f;
					int attackDamage_ForProjectiles4 = GetAttackDamage_ForProjectiles(25f, 23f);
					int num456 = 100;
					if (Main.expertMode)
					{
						num455 = 10f;
					}
					num453 = (float)Math.Sqrt(num451 * num451 + num452 * num452);
					num453 = num455 / num453;
					num451 *= num453;
					num452 *= num453;
					vector41.X += num451 * 15f;
					vector41.Y += num452 * 15f;
					int num457 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector41.X, vector41.Y, num451, num452, num456, attackDamage_ForProjectiles4, 0f, Main.myPlayer);
				}
				return;
			}
			int num458 = 1;
			if (position.X + (float)(width / 2) < Main.player[target].position.X + (float)Main.player[target].width)
			{
				num458 = -1;
			}
			float num459 = 8f;
			float num460 = 0.2f;
			if (Main.expertMode)
			{
				num459 = 9.5f;
				num460 = 0.25f;
			}
			if (Main.getGoodWorld)
			{
				num459 *= 1.15f;
				num460 *= 1.15f;
			}
			Vector2 vector42 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num461 = Main.player[target].position.X + (float)(Main.player[target].width / 2) + (float)(num458 * 340) - vector42.X;
			float num462 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector42.Y;
			float num463 = (float)Math.Sqrt(num461 * num461 + num462 * num462);
			num463 = num459 / num463;
			num461 *= num463;
			num462 *= num463;
			if (velocity.X < num461)
			{
				velocity.X += num460;
				if (velocity.X < 0f && num461 > 0f)
				{
					velocity.X += num460;
				}
			}
			else if (velocity.X > num461)
			{
				velocity.X -= num460;
				if (velocity.X > 0f && num461 < 0f)
				{
					velocity.X -= num460;
				}
			}
			if (velocity.Y < num462)
			{
				velocity.Y += num460;
				if (velocity.Y < 0f && num462 > 0f)
				{
					velocity.Y += num460;
				}
			}
			else if (velocity.Y > num462)
			{
				velocity.Y -= num460;
				if (velocity.Y > 0f && num462 < 0f)
				{
					velocity.Y -= num460;
				}
			}
			vector42 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			num461 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector42.X;
			num462 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector42.Y;
			rotation = (float)Math.Atan2(num462, num461) - 1.57f;
			if (Main.netMode != 1)
			{
				localAI[1] += 1f;
				if ((double)life < (double)lifeMax * 0.75)
				{
					localAI[1] += 0.5f;
				}
				if ((double)life < (double)lifeMax * 0.5)
				{
					localAI[1] += 0.75f;
				}
				if ((double)life < (double)lifeMax * 0.25)
				{
					localAI[1] += 1f;
				}
				if ((double)life < (double)lifeMax * 0.1)
				{
					localAI[1] += 1.5f;
				}
				if (Main.expertMode)
				{
					localAI[1] += 1.5f;
				}
				if (localAI[1] > 60f && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
				{
					localAI[1] = 0f;
					float num464 = 9f;
					int attackDamage_ForProjectiles5 = GetAttackDamage_ForProjectiles(18f, 17f);
					int num465 = 100;
					num463 = (float)Math.Sqrt(num461 * num461 + num462 * num462);
					num463 = num464 / num463;
					num461 *= num463;
					num462 *= num463;
					vector42.X += num461 * 15f;
					vector42.Y += num462 * 15f;
					int num466 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector42.X, vector42.Y, num461, num462, num465, attackDamage_ForProjectiles5, 0f, Main.myPlayer);
				}
			}
			this.ai[2] += 1f;
			if (this.ai[2] >= 180f)
			{
				this.ai[1] = 0f;
				this.ai[2] = 0f;
				this.ai[3] = 0f;
				TargetClosest();
				netUpdate = true;
			}
		}
		else if (aiStyle == 31)
		{
			if (target < 0 || target == 255 || Main.player[target].dead || !Main.player[target].active)
			{
				TargetClosest();
			}
			bool dead3 = Main.player[target].dead;
			float num467 = position.X + (float)(width / 2) - Main.player[target].position.X - (float)(Main.player[target].width / 2);
			float num468 = position.Y + (float)height - 59f - Main.player[target].position.Y - (float)(Main.player[target].height / 2);
			float num469 = (float)Math.Atan2(num468, num467) + 1.57f;
			if (num469 < 0f)
			{
				num469 += 6.283f;
			}
			else if ((double)num469 > 6.283)
			{
				num469 -= 6.283f;
			}
			float num470 = 0.15f;
			if (IsMechQueenUp && this.ai[0] == 3f && this.ai[1] == 0f)
			{
				num470 *= 0.25f;
			}
			if (rotation < num469)
			{
				if ((double)(num469 - rotation) > 3.1415)
				{
					rotation -= num470;
				}
				else
				{
					rotation += num470;
				}
			}
			else if (rotation > num469)
			{
				if ((double)(rotation - num469) > 3.1415)
				{
					rotation += num470;
				}
				else
				{
					rotation -= num470;
				}
			}
			if (rotation > num469 - num470 && rotation < num469 + num470)
			{
				rotation = num469;
			}
			if (rotation < 0f)
			{
				rotation += 6.283f;
			}
			else if ((double)rotation > 6.283)
			{
				rotation -= 6.283f;
			}
			if (rotation > num469 - num470 && rotation < num469 + num470)
			{
				rotation = num469;
			}
			if (Main.rand.Next(5) == 0)
			{
				int num471 = Dust.NewDust(new Vector2(position.X, position.Y + (float)height * 0.25f), width, (int)((float)height * 0.5f), 5, velocity.X, 2f);
				Main.dust[num471].velocity.X *= 0.5f;
				Main.dust[num471].velocity.Y *= 0.1f;
			}
			if (Main.netMode != 1 && !Main.IsItDay() && !dead3 && timeLeft < 10)
			{
				for (int num472 = 0; num472 < Main.maxNPCs; num472++)
				{
					if (num472 != whoAmI && Main.npc[num472].active && (Main.npc[num472].type == 125 || Main.npc[num472].type == 126))
					{
						DiscourageDespawn(Main.npc[num472].timeLeft - 1);
					}
				}
			}
			Vector2 vector43 = Vector2.Zero;
			if (IsMechQueenUp)
			{
				NPC nPC2 = Main.npc[mechQueen];
				Vector2 mechQueenCenter2 = nPC2.GetMechQueenCenter();
				Vector2 vector44 = new Vector2(150f, -250f);
				vector44 *= 0.75f;
				float num473 = nPC2.velocity.X * 0.025f;
				vector43 = mechQueenCenter2 + vector44;
				vector43 = vector43.RotatedBy(num473, mechQueenCenter2);
			}
			reflectsProjectiles = false;
			if (Main.IsItDay() || dead3)
			{
				velocity.Y -= 0.04f;
				EncourageDespawn(10);
				return;
			}
			if (this.ai[0] == 0f)
			{
				if (this.ai[1] == 0f)
				{
					TargetClosest();
					float num474 = 12f;
					float num475 = 0.4f;
					if (Main.getGoodWorld)
					{
						num474 *= 1.15f;
						num475 *= 1.15f;
					}
					int num476 = 1;
					if (position.X + (float)(width / 2) < Main.player[target].position.X + (float)Main.player[target].width)
					{
						num476 = -1;
					}
					Vector2 vector45 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num477 = Main.player[target].position.X + (float)(Main.player[target].width / 2) + (float)(num476 * 400) - vector45.X;
					float num478 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector45.Y;
					if (IsMechQueenUp)
					{
						num474 = 14f;
						num477 = vector43.X;
						num478 = vector43.Y;
						num477 -= vector45.X;
						num478 -= vector45.Y;
					}
					float num479 = (float)Math.Sqrt(num477 * num477 + num478 * num478);
					float num480 = num479;
					if (IsMechQueenUp)
					{
						if (num479 > num474)
						{
							num479 = num474 / num479;
							num477 *= num479;
							num478 *= num479;
						}
						velocity.X = (velocity.X * 4f + num477) / 5f;
						velocity.Y = (velocity.Y * 4f + num478) / 5f;
					}
					else
					{
						num479 = num474 / num479;
						num477 *= num479;
						num478 *= num479;
						if (velocity.X < num477)
						{
							velocity.X += num475;
							if (velocity.X < 0f && num477 > 0f)
							{
								velocity.X += num475;
							}
						}
						else if (velocity.X > num477)
						{
							velocity.X -= num475;
							if (velocity.X > 0f && num477 < 0f)
							{
								velocity.X -= num475;
							}
						}
						if (velocity.Y < num478)
						{
							velocity.Y += num475;
							if (velocity.Y < 0f && num478 > 0f)
							{
								velocity.Y += num475;
							}
						}
						else if (velocity.Y > num478)
						{
							velocity.Y -= num475;
							if (velocity.Y > 0f && num478 < 0f)
							{
								velocity.Y -= num475;
							}
						}
					}
					int num481 = 600;
					if (IsMechQueenUp)
					{
						num481 = 1200;
					}
					this.ai[2] += 1f;
					if (this.ai[2] >= (float)num481)
					{
						this.ai[1] = 1f;
						this.ai[2] = 0f;
						this.ai[3] = 0f;
						target = 255;
						netUpdate = true;
					}
					else
					{
						if (!Main.player[target].dead)
						{
							this.ai[3] += 1f;
							if (Main.expertMode && (double)life < (double)lifeMax * 0.8)
							{
								this.ai[3] += 0.6f;
							}
							if (Main.getGoodWorld)
							{
								this.ai[3] += 0.4f;
							}
						}
						if (this.ai[3] >= 60f)
						{
							this.ai[3] = 0f;
							vector45 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
							num477 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector45.X;
							num478 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector45.Y;
							if (Main.netMode != 1)
							{
								float num482 = 12f;
								int attackDamage_ForProjectiles6 = GetAttackDamage_ForProjectiles(25f, 22f);
								int num483 = 96;
								if (Main.expertMode)
								{
									num482 = 14f;
								}
								num479 = (float)Math.Sqrt(num477 * num477 + num478 * num478);
								num479 = num482 / num479;
								num477 *= num479;
								num478 *= num479;
								num477 += (float)Main.rand.Next(-40, 41) * 0.05f;
								num478 += (float)Main.rand.Next(-40, 41) * 0.05f;
								vector45.X += num477 * 4f;
								vector45.Y += num478 * 4f;
								int num484 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector45.X, vector45.Y, num477, num478, num483, attackDamage_ForProjectiles6, 0f, Main.myPlayer);
							}
						}
					}
				}
				else if (this.ai[1] == 1f)
				{
					rotation = num469;
					float num485 = 13f;
					if (Main.expertMode)
					{
						if ((double)life < (double)lifeMax * 0.9)
						{
							num485 += 0.5f;
						}
						if ((double)life < (double)lifeMax * 0.8)
						{
							num485 += 0.5f;
						}
						if ((double)life < (double)lifeMax * 0.7)
						{
							num485 += 0.55f;
						}
						if ((double)life < (double)lifeMax * 0.6)
						{
							num485 += 0.6f;
						}
						if ((double)life < (double)lifeMax * 0.5)
						{
							num485 += 0.65f;
						}
					}
					if (Main.getGoodWorld)
					{
						num485 *= 1.2f;
					}
					Vector2 vector46 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num486 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector46.X;
					float num487 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector46.Y;
					float num488 = (float)Math.Sqrt(num486 * num486 + num487 * num487);
					num488 = num485 / num488;
					velocity.X = num486 * num488;
					velocity.Y = num487 * num488;
					this.ai[1] = 2f;
				}
				else if (this.ai[1] == 2f)
				{
					this.ai[2] += 1f;
					if (this.ai[2] >= 8f)
					{
						velocity.X *= 0.9f;
						velocity.Y *= 0.9f;
						if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
						{
							velocity.X = 0f;
						}
						if ((double)velocity.Y > -0.1 && (double)velocity.Y < 0.1)
						{
							velocity.Y = 0f;
						}
					}
					else
					{
						rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
					}
					if (this.ai[2] >= 42f)
					{
						this.ai[3] += 1f;
						this.ai[2] = 0f;
						target = 255;
						rotation = num469;
						if (this.ai[3] >= 10f)
						{
							this.ai[1] = 0f;
							this.ai[3] = 0f;
						}
						else
						{
							this.ai[1] = 1f;
						}
					}
				}
				if ((double)life < (double)lifeMax * 0.4)
				{
					this.ai[0] = 1f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
				return;
			}
			if (this.ai[0] == 1f || this.ai[0] == 2f)
			{
				if (IsMechQueenUp)
				{
					reflectsProjectiles = true;
				}
				if (this.ai[0] == 1f)
				{
					this.ai[2] += 0.005f;
					if ((double)this.ai[2] > 0.5)
					{
						this.ai[2] = 0.5f;
					}
				}
				else
				{
					this.ai[2] -= 0.005f;
					if (this.ai[2] < 0f)
					{
						this.ai[2] = 0f;
					}
				}
				rotation += this.ai[2];
				this.ai[1] += 1f;
				if (this.ai[1] >= 100f)
				{
					this.ai[0] += 1f;
					this.ai[1] = 0f;
					if (this.ai[0] == 3f)
					{
						this.ai[2] = 0f;
					}
					else
					{
						SoundEngine.PlaySound(3, (int)position.X, (int)position.Y);
						for (int num489 = 0; num489 < 2; num489++)
						{
							Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 144);
							Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 7);
							Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 6);
						}
						for (int num490 = 0; num490 < 20; num490++)
						{
							Dust.NewDust(position, width, height, 5, (float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f);
						}
						SoundEngine.PlaySound(15, (int)position.X, (int)position.Y, 0);
					}
				}
				Dust.NewDust(position, width, height, 5, (float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f);
				velocity.X *= 0.98f;
				velocity.Y *= 0.98f;
				if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
				{
					velocity.X = 0f;
				}
				if ((double)velocity.Y > -0.1 && (double)velocity.Y < 0.1)
				{
					velocity.Y = 0f;
				}
				return;
			}
			HitSound = SoundID.NPCHit4;
			damage = (int)((double)defDamage * 1.5);
			defense = defDefense + 18;
			if (this.ai[1] == 0f)
			{
				float num491 = 4f;
				float num492 = 0.1f;
				int num493 = 1;
				if (position.X + (float)(width / 2) < Main.player[target].position.X + (float)Main.player[target].width)
				{
					num493 = -1;
				}
				Vector2 vector47 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num494 = Main.player[target].position.X + (float)(Main.player[target].width / 2) + (float)(num493 * 180) - vector47.X;
				float num495 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector47.Y;
				float num496 = (float)Math.Sqrt(num494 * num494 + num495 * num495);
				if (!IsMechQueenUp)
				{
					if (Main.expertMode)
					{
						if (num496 > 300f)
						{
							num491 += 0.5f;
						}
						if (num496 > 400f)
						{
							num491 += 0.5f;
						}
						if (num496 > 500f)
						{
							num491 += 0.55f;
						}
						if (num496 > 600f)
						{
							num491 += 0.55f;
						}
						if (num496 > 700f)
						{
							num491 += 0.6f;
						}
						if (num496 > 800f)
						{
							num491 += 0.6f;
						}
					}
					if (Main.getGoodWorld)
					{
						num491 *= 1.15f;
						num492 *= 1.15f;
					}
					num496 = num491 / num496;
					num494 *= num496;
					num495 *= num496;
					if (velocity.X < num494)
					{
						velocity.X += num492;
						if (velocity.X < 0f && num494 > 0f)
						{
							velocity.X += num492;
						}
					}
					else if (velocity.X > num494)
					{
						velocity.X -= num492;
						if (velocity.X > 0f && num494 < 0f)
						{
							velocity.X -= num492;
						}
					}
					if (velocity.Y < num495)
					{
						velocity.Y += num492;
						if (velocity.Y < 0f && num495 > 0f)
						{
							velocity.Y += num492;
						}
					}
					else if (velocity.Y > num495)
					{
						velocity.Y -= num492;
						if (velocity.Y > 0f && num495 < 0f)
						{
							velocity.Y -= num492;
						}
					}
				}
				int num497 = 400;
				if (IsMechQueenUp)
				{
					num497 = 1200;
				}
				this.ai[2] += 1f;
				if (this.ai[2] >= (float)num497)
				{
					this.ai[1] = 1f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					target = 255;
					netUpdate = true;
				}
				if (Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
				{
					localAI[2] += 1f;
					if (localAI[2] > 22f)
					{
						localAI[2] = 0f;
						SoundEngine.PlaySound(SoundID.Item34, position);
					}
					if (Main.netMode != 1)
					{
						localAI[1] += 1f;
						if ((double)life < (double)lifeMax * 0.75)
						{
							localAI[1] += 1f;
						}
						if ((double)life < (double)lifeMax * 0.5)
						{
							localAI[1] += 1f;
						}
						if ((double)life < (double)lifeMax * 0.25)
						{
							localAI[1] += 1f;
						}
						if ((double)life < (double)lifeMax * 0.1)
						{
							localAI[1] += 2f;
						}
						if (localAI[1] > 8f)
						{
							localAI[1] = 0f;
							float num498 = 6f;
							int attackDamage_ForProjectiles7 = GetAttackDamage_ForProjectiles(30f, 27f);
							int num499 = 101;
							vector47 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
							num494 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector47.X;
							num495 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector47.Y;
							num496 = (float)Math.Sqrt(num494 * num494 + num495 * num495);
							num496 = num498 / num496;
							num494 *= num496;
							num495 *= num496;
							num495 += (float)Main.rand.Next(-40, 41) * 0.01f;
							num494 += (float)Main.rand.Next(-40, 41) * 0.01f;
							num495 += velocity.Y * 0.5f;
							num494 += velocity.X * 0.5f;
							vector47.X -= num494 * 1f;
							vector47.Y -= num495 * 1f;
							if (IsMechQueenUp)
							{
								Vector2 vector48 = (rotation + (float)Math.PI / 2f).ToRotationVector2() * num498 + velocity * 0.5f;
								num494 = vector48.X;
								num495 = vector48.Y;
								vector47 = base.Center - vector48 * 3f;
							}
							int num500 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector47.X, vector47.Y, num494, num495, num499, attackDamage_ForProjectiles7, 0f, Main.myPlayer);
						}
					}
				}
				if (IsMechQueenUp)
				{
					num491 = 14f;
					num494 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector47.X;
					num495 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - 300f - vector47.Y;
					num494 = vector43.X;
					num495 = vector43.Y;
					num494 -= vector47.X;
					num495 -= vector47.Y;
					num496 = (float)Math.Sqrt(num494 * num494 + num495 * num495);
					if (num496 > num491)
					{
						num496 = num491 / num496;
						num494 *= num496;
						num495 *= num496;
					}
					int num501 = 60;
					velocity.X = (velocity.X * (float)(num501 - 1) + num494) / (float)num501;
					velocity.Y = (velocity.Y * (float)(num501 - 1) + num495) / (float)num501;
				}
			}
			else if (this.ai[1] == 1f)
			{
				SoundEngine.PlaySound(15, (int)position.X, (int)position.Y, 0);
				rotation = num469;
				float num502 = 14f;
				if (Main.expertMode)
				{
					num502 += 2.5f;
				}
				Vector2 vector49 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num503 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector49.X;
				float num504 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector49.Y;
				float num505 = (float)Math.Sqrt(num503 * num503 + num504 * num504);
				num505 = num502 / num505;
				velocity.X = num503 * num505;
				velocity.Y = num504 * num505;
				this.ai[1] = 2f;
			}
			else
			{
				if (this.ai[1] != 2f)
				{
					return;
				}
				this.ai[2] += 1f;
				if (Main.expertMode)
				{
					this.ai[2] += 0.5f;
				}
				if (this.ai[2] >= 50f)
				{
					velocity.X *= 0.93f;
					velocity.Y *= 0.93f;
					if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
					{
						velocity.X = 0f;
					}
					if ((double)velocity.Y > -0.1 && (double)velocity.Y < 0.1)
					{
						velocity.Y = 0f;
					}
				}
				else
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
				}
				if (this.ai[2] >= 80f)
				{
					this.ai[3] += 1f;
					this.ai[2] = 0f;
					target = 255;
					rotation = num469;
					if (this.ai[3] >= 6f)
					{
						this.ai[1] = 0f;
						this.ai[3] = 0f;
					}
					else
					{
						this.ai[1] = 1f;
					}
				}
			}
		}
		else if (aiStyle == 32)
		{
			damage = defDamage;
			defense = defDefense;
			if (this.ai[3] != 0f)
			{
				mechQueen = whoAmI;
			}
			reflectsProjectiles = false;
			if (this.ai[0] == 0f && Main.netMode != 1)
			{
				TargetClosest();
				this.ai[0] = 1f;
				int num506 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)position.Y + height / 2, 128, whoAmI);
				Main.npc[num506].ai[0] = -1f;
				Main.npc[num506].ai[1] = whoAmI;
				Main.npc[num506].target = target;
				Main.npc[num506].netUpdate = true;
				num506 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)position.Y + height / 2, 129, whoAmI);
				Main.npc[num506].ai[0] = 1f;
				Main.npc[num506].ai[1] = whoAmI;
				Main.npc[num506].target = target;
				Main.npc[num506].netUpdate = true;
				num506 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)position.Y + height / 2, 130, whoAmI);
				Main.npc[num506].ai[0] = -1f;
				Main.npc[num506].ai[1] = whoAmI;
				Main.npc[num506].target = target;
				Main.npc[num506].ai[3] = 150f;
				Main.npc[num506].netUpdate = true;
				num506 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)position.Y + height / 2, 131, whoAmI);
				Main.npc[num506].ai[0] = 1f;
				Main.npc[num506].ai[1] = whoAmI;
				Main.npc[num506].target = target;
				Main.npc[num506].netUpdate = true;
				Main.npc[num506].ai[3] = 150f;
			}
			Player player4 = Main.player[target];
			if (player4.dead || Math.Abs(position.X - player4.position.X) > 6000f || Math.Abs(position.Y - player4.position.Y) > 6000f)
			{
				TargetClosest();
				player4 = Main.player[target];
				if (player4.dead || Math.Abs(position.X - player4.position.X) > 6000f || Math.Abs(position.Y - player4.position.Y) > 6000f)
				{
					this.ai[1] = 3f;
				}
			}
			if (Main.IsItDay() && this.ai[1] != 3f && this.ai[1] != 2f)
			{
				this.ai[1] = 2f;
				SoundEngine.PlaySound(15, (int)position.X, (int)position.Y, 0);
			}
			if (this.ai[1] == 0f)
			{
				this.ai[2] += 1f;
				if (this.ai[2] >= 600f)
				{
					this.ai[2] = 0f;
					this.ai[1] = 1f;
					TargetClosest();
					netUpdate = true;
				}
				if (IsMechQueenUp)
				{
					rotation = rotation.AngleLerp(velocity.X / 15f * 0.5f, 0.75f);
				}
				else
				{
					rotation = velocity.X / 15f;
				}
				float num507 = 0.1f;
				float num508 = 2f;
				float num509 = 0.1f;
				float num510 = 8f;
				int num511 = 200;
				int num512 = 500;
				float num513 = 0f;
				int num514 = ((!(player4.Center.X < base.Center.X)) ? 1 : (-1));
				if (IsMechQueenUp)
				{
					num513 = -450f * (float)num514;
					num511 = 300;
					num512 = 350;
				}
				if (Main.expertMode)
				{
					num507 = 0.03f;
					num508 = 4f;
					num509 = 0.07f;
					num510 = 9.5f;
				}
				if (position.Y > player4.position.Y - (float)num511)
				{
					if (velocity.Y > 0f)
					{
						velocity.Y *= 0.98f;
					}
					velocity.Y -= num507;
					if (velocity.Y > num508)
					{
						velocity.Y = num508;
					}
				}
				else if (position.Y < player4.position.Y - (float)num512)
				{
					if (velocity.Y < 0f)
					{
						velocity.Y *= 0.98f;
					}
					velocity.Y += num507;
					if (velocity.Y < 0f - num508)
					{
						velocity.Y = 0f - num508;
					}
				}
				if (base.Center.X > player4.Center.X + 100f + num513)
				{
					if (velocity.X > 0f)
					{
						velocity.X *= 0.98f;
					}
					velocity.X -= num509;
					if (velocity.X > num510)
					{
						velocity.X = num510;
					}
				}
				if (base.Center.X < player4.Center.X - 100f + num513)
				{
					if (velocity.X < 0f)
					{
						velocity.X *= 0.98f;
					}
					velocity.X += num509;
					if (velocity.X < 0f - num510)
					{
						velocity.X = 0f - num510;
					}
				}
			}
			else if (this.ai[1] == 1f)
			{
				defense *= 2;
				damage *= 2;
				this.ai[2] += 1f;
				if (this.ai[2] == 2f)
				{
					SoundEngine.PlaySound(15, (int)position.X, (int)position.Y, 0);
				}
				if (this.ai[2] >= 400f)
				{
					this.ai[2] = 0f;
					this.ai[1] = 0f;
				}
				if (IsMechQueenUp)
				{
					rotation = rotation.AngleLerp(velocity.X / 15f * 0.5f, 0.75f);
				}
				else
				{
					rotation += (float)direction * 0.3f;
				}
				Vector2 center8 = base.Center;
				float num515 = player4.Center.X - center8.X;
				float num516 = player4.Center.Y - center8.Y;
				float num517 = (float)Math.Sqrt(num515 * num515 + num516 * num516);
				if (num517 <= 0f)
				{
					num517 = 1f;
				}
				float num518 = 2f;
				if (Main.expertMode)
				{
					num518 = 6f;
					if (num517 > 150f)
					{
						num518 *= 1.05f;
					}
					if (num517 > 200f)
					{
						num518 *= 1.1f;
					}
					if (num517 > 250f)
					{
						num518 *= 1.1f;
					}
					if (num517 > 300f)
					{
						num518 *= 1.1f;
					}
					if (num517 > 350f)
					{
						num518 *= 1.1f;
					}
					if (num517 > 400f)
					{
						num518 *= 1.1f;
					}
					if (num517 > 450f)
					{
						num518 *= 1.1f;
					}
					if (num517 > 500f)
					{
						num518 *= 1.1f;
					}
					if (num517 > 550f)
					{
						num518 *= 1.1f;
					}
					if (num517 > 600f)
					{
						num518 *= 1.1f;
					}
				}
				if (IsMechQueenUp)
				{
					float num519 = (npcsFoundForCheckActive[135] ? 0.6f : 0.75f);
					num518 *= num519;
				}
				num517 = num518 / num517;
				velocity.X = num515 * num517;
				velocity.Y = num516 * num517;
				if (IsMechQueenUp)
				{
					float num520 = Vector2.Distance(base.Center, player4.Center);
					if (num520 < 0.1f)
					{
						num520 = 0f;
					}
					if (num520 < num518)
					{
						velocity = velocity.SafeNormalize(Vector2.Zero) * num520;
					}
				}
			}
			else if (this.ai[1] == 2f)
			{
				damage = 9999;
				defense = 9999;
				if (IsMechQueenUp)
				{
					rotation = rotation.AngleLerp(velocity.X / 15f * 0.5f, 0.75f);
				}
				else
				{
					rotation += (float)direction * 0.3f;
				}
				Vector2 center9 = base.Center;
				float num521 = player4.Center.X - center9.X;
				float num522 = player4.Center.Y - center9.Y;
				float num523 = (float)Math.Sqrt(num521 * num521 + num522 * num522);
				if (num523 <= 0f)
				{
					num523 = 1f;
				}
				float num524 = 10f;
				num524 += num523 / 100f;
				if (num524 < 8f)
				{
					num524 = 8f;
				}
				if (num524 > 32f)
				{
					num524 = 32f;
				}
				num523 = num524 / num523;
				velocity.X = num521 * num523;
				velocity.Y = num522 * num523;
			}
			else
			{
				if (this.ai[1] != 3f)
				{
					return;
				}
				if (IsMechQueenUp)
				{
					int num525 = FindFirstNPC(125);
					if (num525 >= 0)
					{
						Main.npc[num525].EncourageDespawn(5);
					}
					num525 = FindFirstNPC(126);
					if (num525 >= 0)
					{
						Main.npc[num525].EncourageDespawn(5);
					}
					if (!AnyNPCs(125) && !AnyNPCs(126))
					{
						num525 = FindFirstNPC(134);
						if (num525 >= 0)
						{
							Main.npc[num525].Transform(136);
						}
						EncourageDespawn(5);
					}
					velocity.Y += 0.1f;
					if (velocity.Y < 0f)
					{
						velocity.Y *= 0.95f;
					}
					velocity.X *= 0.95f;
					if (velocity.Y > 13f)
					{
						velocity.Y = 13f;
					}
				}
				else
				{
					EncourageDespawn(500);
					velocity.Y += 0.1f;
					if (velocity.Y < 0f)
					{
						velocity.Y *= 0.95f;
					}
					velocity.X *= 0.95f;
				}
			}
		}
		else if (aiStyle == 33)
		{
			Vector2 vector50 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num526 = Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 200f * this.ai[0] - vector50.X;
			float num527 = Main.npc[(int)this.ai[1]].position.Y + 230f - vector50.Y;
			float num528 = (float)Math.Sqrt(num526 * num526 + num527 * num527);
			if (this.ai[2] != 99f)
			{
				if (num528 > 800f)
				{
					this.ai[2] = 99f;
				}
			}
			else if (num528 < 400f)
			{
				this.ai[2] = 0f;
			}
			spriteDirection = -(int)this.ai[0];
			if (!Main.npc[(int)this.ai[1]].active || Main.npc[(int)this.ai[1]].aiStyle != 32)
			{
				this.ai[2] += 10f;
				if (this.ai[2] > 50f || Main.netMode != 2)
				{
					life = -1;
					HitEffect();
					active = false;
				}
			}
			if (this.ai[2] == 99f)
			{
				if (position.Y > Main.npc[(int)this.ai[1]].position.Y)
				{
					if (velocity.Y > 0f)
					{
						velocity.Y *= 0.96f;
					}
					velocity.Y -= 0.1f;
					if (velocity.Y > 8f)
					{
						velocity.Y = 8f;
					}
				}
				else if (position.Y < Main.npc[(int)this.ai[1]].position.Y)
				{
					if (velocity.Y < 0f)
					{
						velocity.Y *= 0.96f;
					}
					velocity.Y += 0.1f;
					if (velocity.Y < -8f)
					{
						velocity.Y = -8f;
					}
				}
				if (position.X + (float)(width / 2) > Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2))
				{
					if (velocity.X > 0f)
					{
						velocity.X *= 0.96f;
					}
					velocity.X -= 0.5f;
					if (velocity.X > 12f)
					{
						velocity.X = 12f;
					}
				}
				if (position.X + (float)(width / 2) < Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2))
				{
					if (velocity.X < 0f)
					{
						velocity.X *= 0.96f;
					}
					velocity.X += 0.5f;
					if (velocity.X < -12f)
					{
						velocity.X = -12f;
					}
				}
			}
			else if (this.ai[2] == 0f || this.ai[2] == 3f)
			{
				if (Main.npc[(int)this.ai[1]].ai[1] == 3f)
				{
					EncourageDespawn(10);
				}
				if (Main.npc[(int)this.ai[1]].ai[1] != 0f)
				{
					TargetClosest();
					if (Main.player[target].dead)
					{
						velocity.Y += 0.1f;
						if (velocity.Y > 16f)
						{
							velocity.Y = 16f;
						}
					}
					else
					{
						Vector2 vector51 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
						float num529 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector51.X;
						float num530 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector51.Y;
						float num531 = (float)Math.Sqrt(num529 * num529 + num530 * num530);
						num531 = 7f / num531;
						num529 *= num531;
						num530 *= num531;
						rotation = (float)Math.Atan2(num530, num529) - 1.57f;
						if (velocity.X > num529)
						{
							if (velocity.X > 0f)
							{
								velocity.X *= 0.97f;
							}
							velocity.X -= 0.05f;
						}
						if (velocity.X < num529)
						{
							if (velocity.X < 0f)
							{
								velocity.X *= 0.97f;
							}
							velocity.X += 0.05f;
						}
						if (velocity.Y > num530)
						{
							if (velocity.Y > 0f)
							{
								velocity.Y *= 0.97f;
							}
							velocity.Y -= 0.05f;
						}
						if (velocity.Y < num530)
						{
							if (velocity.Y < 0f)
							{
								velocity.Y *= 0.97f;
							}
							velocity.Y += 0.05f;
						}
					}
					this.ai[3] += 1f;
					if (this.ai[3] >= 600f)
					{
						this.ai[2] = 0f;
						this.ai[3] = 0f;
						netUpdate = true;
					}
				}
				else
				{
					this.ai[3] += 1f;
					if (this.ai[3] >= 300f)
					{
						this.ai[2] += 1f;
						this.ai[3] = 0f;
						netUpdate = true;
					}
					if (position.Y > Main.npc[(int)this.ai[1]].position.Y + 320f)
					{
						if (velocity.Y > 0f)
						{
							velocity.Y *= 0.96f;
						}
						velocity.Y -= 0.04f;
						if (velocity.Y > 3f)
						{
							velocity.Y = 3f;
						}
					}
					else if (position.Y < Main.npc[(int)this.ai[1]].position.Y + 260f)
					{
						if (velocity.Y < 0f)
						{
							velocity.Y *= 0.96f;
						}
						velocity.Y += 0.04f;
						if (velocity.Y < -3f)
						{
							velocity.Y = -3f;
						}
					}
					if (position.X + (float)(width / 2) > Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2))
					{
						if (velocity.X > 0f)
						{
							velocity.X *= 0.96f;
						}
						velocity.X -= 0.3f;
						if (velocity.X > 12f)
						{
							velocity.X = 12f;
						}
					}
					if (position.X + (float)(width / 2) < Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 250f)
					{
						if (velocity.X < 0f)
						{
							velocity.X *= 0.96f;
						}
						velocity.X += 0.3f;
						if (velocity.X < -12f)
						{
							velocity.X = -12f;
						}
					}
				}
				Vector2 vector52 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num532 = Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 200f * this.ai[0] - vector52.X;
				float num533 = Main.npc[(int)this.ai[1]].position.Y + 230f - vector52.Y;
				float num534 = (float)Math.Sqrt(num532 * num532 + num533 * num533);
				rotation = (float)Math.Atan2(num533, num532) + 1.57f;
			}
			else if (this.ai[2] == 1f)
			{
				Vector2 vector53 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num535 = Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 200f * this.ai[0] - vector53.X;
				float num536 = Main.npc[(int)this.ai[1]].position.Y + 230f - vector53.Y;
				float num537 = (float)Math.Sqrt(num535 * num535 + num536 * num536);
				rotation = (float)Math.Atan2(num536, num535) + 1.57f;
				velocity.X *= 0.95f;
				velocity.Y -= 0.1f;
				if (velocity.Y < -8f)
				{
					velocity.Y = -8f;
				}
				if (position.Y < Main.npc[(int)this.ai[1]].position.Y - 200f)
				{
					TargetClosest();
					this.ai[2] = 2f;
					vector53 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					num535 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector53.X;
					num536 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector53.Y;
					num537 = (float)Math.Sqrt(num535 * num535 + num536 * num536);
					num537 = 22f / num537;
					velocity.X = num535 * num537;
					velocity.Y = num536 * num537;
					netUpdate = true;
				}
			}
			else if (this.ai[2] == 2f)
			{
				if (position.Y > Main.player[target].position.Y || velocity.Y < 0f)
				{
					this.ai[2] = 3f;
				}
			}
			else if (this.ai[2] == 4f)
			{
				TargetClosest();
				Vector2 vector54 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num538 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector54.X;
				float num539 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector54.Y;
				float num540 = (float)Math.Sqrt(num538 * num538 + num539 * num539);
				num540 = 7f / num540;
				num538 *= num540;
				num539 *= num540;
				if (velocity.X > num538)
				{
					if (velocity.X > 0f)
					{
						velocity.X *= 0.97f;
					}
					velocity.X -= 0.05f;
				}
				if (velocity.X < num538)
				{
					if (velocity.X < 0f)
					{
						velocity.X *= 0.97f;
					}
					velocity.X += 0.05f;
				}
				if (velocity.Y > num539)
				{
					if (velocity.Y > 0f)
					{
						velocity.Y *= 0.97f;
					}
					velocity.Y -= 0.05f;
				}
				if (velocity.Y < num539)
				{
					if (velocity.Y < 0f)
					{
						velocity.Y *= 0.97f;
					}
					velocity.Y += 0.05f;
				}
				this.ai[3] += 1f;
				if (this.ai[3] >= 600f)
				{
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
				vector54 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				num538 = Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 200f * this.ai[0] - vector54.X;
				num539 = Main.npc[(int)this.ai[1]].position.Y + 230f - vector54.Y;
				num540 = (float)Math.Sqrt(num538 * num538 + num539 * num539);
				rotation = (float)Math.Atan2(num539, num538) + 1.57f;
			}
			else if (this.ai[2] == 5f && ((velocity.X > 0f && position.X + (float)(width / 2) > Main.player[target].position.X + (float)(Main.player[target].width / 2)) || (velocity.X < 0f && position.X + (float)(width / 2) < Main.player[target].position.X + (float)(Main.player[target].width / 2))))
			{
				this.ai[2] = 0f;
			}
		}
		else if (aiStyle == 34)
		{
			spriteDirection = -(int)this.ai[0];
			Vector2 vector55 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num541 = Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 200f * this.ai[0] - vector55.X;
			float num542 = Main.npc[(int)this.ai[1]].position.Y + 230f - vector55.Y;
			float num543 = (float)Math.Sqrt(num541 * num541 + num542 * num542);
			if (this.ai[2] != 99f)
			{
				if (num543 > 800f)
				{
					this.ai[2] = 99f;
				}
			}
			else if (num543 < 400f)
			{
				this.ai[2] = 0f;
			}
			if (!Main.npc[(int)this.ai[1]].active || Main.npc[(int)this.ai[1]].aiStyle != 32)
			{
				this.ai[2] += 10f;
				if (this.ai[2] > 50f || Main.netMode != 2)
				{
					life = -1;
					HitEffect();
					active = false;
				}
			}
			if (this.ai[2] == 99f)
			{
				if (position.Y > Main.npc[(int)this.ai[1]].position.Y)
				{
					if (velocity.Y > 0f)
					{
						velocity.Y *= 0.96f;
					}
					velocity.Y -= 0.1f;
					if (velocity.Y > 8f)
					{
						velocity.Y = 8f;
					}
				}
				else if (position.Y < Main.npc[(int)this.ai[1]].position.Y)
				{
					if (velocity.Y < 0f)
					{
						velocity.Y *= 0.96f;
					}
					velocity.Y += 0.1f;
					if (velocity.Y < -8f)
					{
						velocity.Y = -8f;
					}
				}
				if (position.X + (float)(width / 2) > Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2))
				{
					if (velocity.X > 0f)
					{
						velocity.X *= 0.96f;
					}
					velocity.X -= 0.5f;
					if (velocity.X > 12f)
					{
						velocity.X = 12f;
					}
				}
				if (position.X + (float)(width / 2) < Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2))
				{
					if (velocity.X < 0f)
					{
						velocity.X *= 0.96f;
					}
					velocity.X += 0.5f;
					if (velocity.X < -12f)
					{
						velocity.X = -12f;
					}
				}
			}
			else if (this.ai[2] == 0f || this.ai[2] == 3f)
			{
				if (Main.npc[(int)this.ai[1]].ai[1] == 3f)
				{
					EncourageDespawn(10);
				}
				if (Main.npc[(int)this.ai[1]].ai[1] != 0f)
				{
					TargetClosest();
					TargetClosest();
					if (Main.player[target].dead)
					{
						velocity.Y += 0.1f;
						if (velocity.Y > 16f)
						{
							velocity.Y = 16f;
						}
					}
					else
					{
						Vector2 vector56 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
						float num544 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector56.X;
						float num545 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector56.Y;
						float num546 = (float)Math.Sqrt(num544 * num544 + num545 * num545);
						num546 = 12f / num546;
						num544 *= num546;
						num545 *= num546;
						rotation = (float)Math.Atan2(num545, num544) - 1.57f;
						if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < 2f)
						{
							rotation = (float)Math.Atan2(num545, num544) - 1.57f;
							velocity.X = num544;
							velocity.Y = num545;
							netUpdate = true;
						}
						else
						{
							velocity *= 0.97f;
						}
						this.ai[3] += 1f;
						if (this.ai[3] >= 600f)
						{
							this.ai[2] = 0f;
							this.ai[3] = 0f;
							netUpdate = true;
						}
					}
				}
				else
				{
					this.ai[3] += 1f;
					if (this.ai[3] >= 600f)
					{
						this.ai[2] += 1f;
						this.ai[3] = 0f;
						netUpdate = true;
					}
					if (position.Y > Main.npc[(int)this.ai[1]].position.Y + 300f)
					{
						if (velocity.Y > 0f)
						{
							velocity.Y *= 0.96f;
						}
						velocity.Y -= 0.1f;
						if (velocity.Y > 3f)
						{
							velocity.Y = 3f;
						}
					}
					else if (position.Y < Main.npc[(int)this.ai[1]].position.Y + 230f)
					{
						if (velocity.Y < 0f)
						{
							velocity.Y *= 0.96f;
						}
						velocity.Y += 0.1f;
						if (velocity.Y < -3f)
						{
							velocity.Y = -3f;
						}
					}
					if (position.X + (float)(width / 2) > Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) + 250f)
					{
						if (velocity.X > 0f)
						{
							velocity.X *= 0.94f;
						}
						velocity.X -= 0.3f;
						if (velocity.X > 9f)
						{
							velocity.X = 9f;
						}
					}
					if (position.X + (float)(width / 2) < Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2))
					{
						if (velocity.X < 0f)
						{
							velocity.X *= 0.94f;
						}
						velocity.X += 0.2f;
						if (velocity.X < -8f)
						{
							velocity.X = -8f;
						}
					}
				}
				Vector2 vector57 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num547 = Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 200f * this.ai[0] - vector57.X;
				float num548 = Main.npc[(int)this.ai[1]].position.Y + 230f - vector57.Y;
				float num549 = (float)Math.Sqrt(num547 * num547 + num548 * num548);
				rotation = (float)Math.Atan2(num548, num547) + 1.57f;
			}
			else if (this.ai[2] == 1f)
			{
				if (velocity.Y > 0f)
				{
					velocity.Y *= 0.9f;
				}
				Vector2 vector58 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num550 = Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 280f * this.ai[0] - vector58.X;
				float num551 = Main.npc[(int)this.ai[1]].position.Y + 230f - vector58.Y;
				float num552 = (float)Math.Sqrt(num550 * num550 + num551 * num551);
				rotation = (float)Math.Atan2(num551, num550) + 1.57f;
				velocity.X = (velocity.X * 5f + Main.npc[(int)this.ai[1]].velocity.X) / 6f;
				velocity.X += 0.5f;
				velocity.Y -= 0.5f;
				if (velocity.Y < -9f)
				{
					velocity.Y = -9f;
				}
				if (position.Y < Main.npc[(int)this.ai[1]].position.Y - 280f)
				{
					TargetClosest();
					this.ai[2] = 2f;
					vector58 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					num550 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector58.X;
					num551 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector58.Y;
					num552 = (float)Math.Sqrt(num550 * num550 + num551 * num551);
					num552 = 20f / num552;
					velocity.X = num550 * num552;
					velocity.Y = num551 * num552;
					netUpdate = true;
				}
			}
			else if (this.ai[2] == 2f)
			{
				if (position.Y > Main.player[target].position.Y || velocity.Y < 0f)
				{
					if (this.ai[3] >= 4f)
					{
						this.ai[2] = 3f;
						this.ai[3] = 0f;
					}
					else
					{
						this.ai[2] = 1f;
						this.ai[3] += 1f;
					}
				}
			}
			else if (this.ai[2] == 4f)
			{
				Vector2 vector59 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num553 = Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 200f * this.ai[0] - vector59.X;
				float num554 = Main.npc[(int)this.ai[1]].position.Y + 230f - vector59.Y;
				float num555 = (float)Math.Sqrt(num553 * num553 + num554 * num554);
				rotation = (float)Math.Atan2(num554, num553) + 1.57f;
				velocity.Y = (velocity.Y * 5f + Main.npc[(int)this.ai[1]].velocity.Y) / 6f;
				velocity.X += 0.5f;
				if (velocity.X > 12f)
				{
					velocity.X = 12f;
				}
				if (position.X + (float)(width / 2) < Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 500f || position.X + (float)(width / 2) > Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) + 500f)
				{
					TargetClosest();
					this.ai[2] = 5f;
					vector59 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					num553 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector59.X;
					num554 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector59.Y;
					num555 = (float)Math.Sqrt(num553 * num553 + num554 * num554);
					num555 = 17f / num555;
					velocity.X = num553 * num555;
					velocity.Y = num554 * num555;
					netUpdate = true;
				}
			}
			else if (this.ai[2] == 5f && position.X + (float)(width / 2) < Main.player[target].position.X + (float)(Main.player[target].width / 2) - 100f)
			{
				if (this.ai[3] >= 4f)
				{
					this.ai[2] = 0f;
					this.ai[3] = 0f;
				}
				else
				{
					this.ai[2] = 4f;
					this.ai[3] += 1f;
				}
			}
		}
		else if (aiStyle == 35)
		{
			spriteDirection = -(int)this.ai[0];
			if (!Main.npc[(int)this.ai[1]].active || Main.npc[(int)this.ai[1]].aiStyle != 32)
			{
				this.ai[2] += 10f;
				if (this.ai[2] > 50f || Main.netMode != 2)
				{
					life = -1;
					HitEffect();
					active = false;
				}
			}
			if (this.ai[2] == 0f)
			{
				if (Main.npc[(int)this.ai[1]].ai[1] == 3f)
				{
					EncourageDespawn(10);
				}
				if (Main.npc[(int)this.ai[1]].ai[1] != 0f)
				{
					localAI[0] += 2f;
					if (position.Y > Main.npc[(int)this.ai[1]].position.Y - 100f)
					{
						if (velocity.Y > 0f)
						{
							velocity.Y *= 0.96f;
						}
						velocity.Y -= 0.07f;
						if (velocity.Y > 6f)
						{
							velocity.Y = 6f;
						}
					}
					else if (position.Y < Main.npc[(int)this.ai[1]].position.Y - 100f)
					{
						if (velocity.Y < 0f)
						{
							velocity.Y *= 0.96f;
						}
						velocity.Y += 0.07f;
						if (velocity.Y < -6f)
						{
							velocity.Y = -6f;
						}
					}
					if (position.X + (float)(width / 2) > Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 120f * this.ai[0])
					{
						if (velocity.X > 0f)
						{
							velocity.X *= 0.96f;
						}
						velocity.X -= 0.1f;
						if (velocity.X > 8f)
						{
							velocity.X = 8f;
						}
					}
					if (position.X + (float)(width / 2) < Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 120f * this.ai[0])
					{
						if (velocity.X < 0f)
						{
							velocity.X *= 0.96f;
						}
						velocity.X += 0.1f;
						if (velocity.X < -8f)
						{
							velocity.X = -8f;
						}
					}
				}
				else
				{
					this.ai[3] += 1f;
					if (this.ai[3] >= 1100f)
					{
						localAI[0] = 0f;
						this.ai[2] = 1f;
						this.ai[3] = 0f;
						netUpdate = true;
					}
					if (position.Y > Main.npc[(int)this.ai[1]].position.Y - 150f)
					{
						if (velocity.Y > 0f)
						{
							velocity.Y *= 0.96f;
						}
						velocity.Y -= 0.04f;
						if (velocity.Y > 3f)
						{
							velocity.Y = 3f;
						}
					}
					else if (position.Y < Main.npc[(int)this.ai[1]].position.Y - 150f)
					{
						if (velocity.Y < 0f)
						{
							velocity.Y *= 0.96f;
						}
						velocity.Y += 0.04f;
						if (velocity.Y < -3f)
						{
							velocity.Y = -3f;
						}
					}
					if (position.X + (float)(width / 2) > Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) + 200f)
					{
						if (velocity.X > 0f)
						{
							velocity.X *= 0.96f;
						}
						velocity.X -= 0.2f;
						if (velocity.X > 8f)
						{
							velocity.X = 8f;
						}
					}
					if (position.X + (float)(width / 2) < Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) + 160f)
					{
						if (velocity.X < 0f)
						{
							velocity.X *= 0.96f;
						}
						velocity.X += 0.2f;
						if (velocity.X < -8f)
						{
							velocity.X = -8f;
						}
					}
				}
				Vector2 vector60 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num556 = Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 200f * this.ai[0] - vector60.X;
				float num557 = Main.npc[(int)this.ai[1]].position.Y + 230f - vector60.Y;
				float num558 = (float)Math.Sqrt(num556 * num556 + num557 * num557);
				rotation = (float)Math.Atan2(num557, num556) + 1.57f;
				if (Main.netMode != 1)
				{
					localAI[0] += 1f;
					if (localAI[0] > 140f)
					{
						localAI[0] = 0f;
						float num559 = 12f;
						int num560 = 0;
						int num561 = 102;
						num558 = num559 / num558;
						num556 = (0f - num556) * num558;
						num557 = (0f - num557) * num558;
						num556 += (float)Main.rand.Next(-40, 41) * 0.01f;
						num557 += (float)Main.rand.Next(-40, 41) * 0.01f;
						vector60.X += num556 * 4f;
						vector60.Y += num557 * 4f;
						int num562 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector60.X, vector60.Y, num556, num557, num561, num560, 0f, Main.myPlayer);
					}
				}
			}
			else
			{
				if (this.ai[2] != 1f)
				{
					return;
				}
				this.ai[3] += 1f;
				if (this.ai[3] >= 300f)
				{
					localAI[0] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
				Vector2 vector61 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num563 = Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - vector61.X;
				float num564 = Main.npc[(int)this.ai[1]].position.Y - vector61.Y;
				num564 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - 80f - vector61.Y;
				float num565 = (float)Math.Sqrt(num563 * num563 + num564 * num564);
				num565 = 6f / num565;
				num563 *= num565;
				num564 *= num565;
				if (velocity.X > num563)
				{
					if (velocity.X > 0f)
					{
						velocity.X *= 0.9f;
					}
					velocity.X -= 0.04f;
				}
				if (velocity.X < num563)
				{
					if (velocity.X < 0f)
					{
						velocity.X *= 0.9f;
					}
					velocity.X += 0.04f;
				}
				if (velocity.Y > num564)
				{
					if (velocity.Y > 0f)
					{
						velocity.Y *= 0.9f;
					}
					velocity.Y -= 0.08f;
				}
				if (velocity.Y < num564)
				{
					if (velocity.Y < 0f)
					{
						velocity.Y *= 0.9f;
					}
					velocity.Y += 0.08f;
				}
				TargetClosest();
				vector61 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				num563 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector61.X;
				num564 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector61.Y;
				num565 = (float)Math.Sqrt(num563 * num563 + num564 * num564);
				rotation = (float)Math.Atan2(num564, num563) - 1.57f;
				if (Main.netMode != 1)
				{
					localAI[0] += 1f;
					if (localAI[0] > 40f)
					{
						localAI[0] = 0f;
						float num566 = 10f;
						int num567 = 0;
						int num568 = 102;
						num565 = num566 / num565;
						num563 *= num565;
						num564 *= num565;
						num563 += (float)Main.rand.Next(-40, 41) * 0.01f;
						num564 += (float)Main.rand.Next(-40, 41) * 0.01f;
						vector61.X += num563 * 4f;
						vector61.Y += num564 * 4f;
						int num569 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector61.X, vector61.Y, num563, num564, num568, num567, 0f, Main.myPlayer);
					}
				}
			}
		}
		else if (aiStyle == 36)
		{
			spriteDirection = -(int)this.ai[0];
			if (!Main.npc[(int)this.ai[1]].active || Main.npc[(int)this.ai[1]].aiStyle != 32)
			{
				this.ai[2] += 10f;
				if (this.ai[2] > 50f || Main.netMode != 2)
				{
					life = -1;
					HitEffect();
					active = false;
				}
			}
			if (this.ai[2] == 0f || this.ai[2] == 3f)
			{
				if (Main.npc[(int)this.ai[1]].ai[1] == 3f)
				{
					EncourageDespawn(10);
				}
				if (Main.npc[(int)this.ai[1]].ai[1] != 0f)
				{
					localAI[0] += 3f;
					if (position.Y > Main.npc[(int)this.ai[1]].position.Y - 100f)
					{
						if (velocity.Y > 0f)
						{
							velocity.Y *= 0.96f;
						}
						velocity.Y -= 0.07f;
						if (velocity.Y > 6f)
						{
							velocity.Y = 6f;
						}
					}
					else if (position.Y < Main.npc[(int)this.ai[1]].position.Y - 100f)
					{
						if (velocity.Y < 0f)
						{
							velocity.Y *= 0.96f;
						}
						velocity.Y += 0.07f;
						if (velocity.Y < -6f)
						{
							velocity.Y = -6f;
						}
					}
					if (position.X + (float)(width / 2) > Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 120f * this.ai[0])
					{
						if (velocity.X > 0f)
						{
							velocity.X *= 0.96f;
						}
						velocity.X -= 0.1f;
						if (velocity.X > 8f)
						{
							velocity.X = 8f;
						}
					}
					if (position.X + (float)(width / 2) < Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 120f * this.ai[0])
					{
						if (velocity.X < 0f)
						{
							velocity.X *= 0.96f;
						}
						velocity.X += 0.1f;
						if (velocity.X < -8f)
						{
							velocity.X = -8f;
						}
					}
				}
				else
				{
					this.ai[3] += 1f;
					if (this.ai[3] >= 800f)
					{
						this.ai[2] += 1f;
						this.ai[3] = 0f;
						netUpdate = true;
					}
					if (position.Y > Main.npc[(int)this.ai[1]].position.Y - 100f)
					{
						if (velocity.Y > 0f)
						{
							velocity.Y *= 0.96f;
						}
						velocity.Y -= 0.1f;
						if (velocity.Y > 3f)
						{
							velocity.Y = 3f;
						}
					}
					else if (position.Y < Main.npc[(int)this.ai[1]].position.Y - 100f)
					{
						if (velocity.Y < 0f)
						{
							velocity.Y *= 0.96f;
						}
						velocity.Y += 0.1f;
						if (velocity.Y < -3f)
						{
							velocity.Y = -3f;
						}
					}
					if (position.X + (float)(width / 2) > Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 180f * this.ai[0])
					{
						if (velocity.X > 0f)
						{
							velocity.X *= 0.96f;
						}
						velocity.X -= 0.14f;
						if (velocity.X > 8f)
						{
							velocity.X = 8f;
						}
					}
					if (position.X + (float)(width / 2) < Main.npc[(int)this.ai[1]].position.X + (float)(Main.npc[(int)this.ai[1]].width / 2) - 180f * this.ai[0])
					{
						if (velocity.X < 0f)
						{
							velocity.X *= 0.96f;
						}
						velocity.X += 0.14f;
						if (velocity.X < -8f)
						{
							velocity.X = -8f;
						}
					}
				}
				TargetClosest();
				Vector2 vector62 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num570 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector62.X;
				float num571 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector62.Y;
				float num572 = (float)Math.Sqrt(num570 * num570 + num571 * num571);
				rotation = (float)Math.Atan2(num571, num570) - 1.57f;
				if (Main.netMode != 1)
				{
					localAI[0] += 1f;
					if (localAI[0] > 200f)
					{
						localAI[0] = 0f;
						float num573 = 8f;
						int num574 = 25;
						int num575 = 100;
						num572 = num573 / num572;
						num570 *= num572;
						num571 *= num572;
						num570 += (float)Main.rand.Next(-40, 41) * 0.05f;
						num571 += (float)Main.rand.Next(-40, 41) * 0.05f;
						vector62.X += num570 * 8f;
						vector62.Y += num571 * 8f;
						int num576 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector62.X, vector62.Y, num570, num571, num575, num574, 0f, Main.myPlayer);
					}
				}
			}
			else
			{
				if (this.ai[2] != 1f)
				{
					return;
				}
				this.ai[3] += 1f;
				if (this.ai[3] >= 200f)
				{
					localAI[0] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
				Vector2 vector63 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num577 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - 350f - vector63.X;
				float num578 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - 20f - vector63.Y;
				float num579 = (float)Math.Sqrt(num577 * num577 + num578 * num578);
				num579 = 7f / num579;
				num577 *= num579;
				num578 *= num579;
				if (velocity.X > num577)
				{
					if (velocity.X > 0f)
					{
						velocity.X *= 0.9f;
					}
					velocity.X -= 0.1f;
				}
				if (velocity.X < num577)
				{
					if (velocity.X < 0f)
					{
						velocity.X *= 0.9f;
					}
					velocity.X += 0.1f;
				}
				if (velocity.Y > num578)
				{
					if (velocity.Y > 0f)
					{
						velocity.Y *= 0.9f;
					}
					velocity.Y -= 0.03f;
				}
				if (velocity.Y < num578)
				{
					if (velocity.Y < 0f)
					{
						velocity.Y *= 0.9f;
					}
					velocity.Y += 0.03f;
				}
				TargetClosest();
				vector63 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				num577 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector63.X;
				num578 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector63.Y;
				num579 = (float)Math.Sqrt(num577 * num577 + num578 * num578);
				rotation = (float)Math.Atan2(num578, num577) - 1.57f;
				if (Main.netMode != 1)
				{
					localAI[0] += 1f;
					if (localAI[0] > 80f)
					{
						localAI[0] = 0f;
						float num580 = 10f;
						int num581 = 25;
						int num582 = 100;
						num579 = num580 / num579;
						num577 *= num579;
						num578 *= num579;
						num577 += (float)Main.rand.Next(-40, 41) * 0.05f;
						num578 += (float)Main.rand.Next(-40, 41) * 0.05f;
						vector63.X += num577 * 8f;
						vector63.Y += num578 * 8f;
						int num583 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector63.X, vector63.Y, num577, num578, num582, num581, 0f, Main.myPlayer);
					}
				}
			}
		}
		else if (aiStyle == 37)
		{
			AI_037_Destroyer();
		}
		else if (aiStyle == 38)
		{
			float num584 = 4f;
			float num585 = 1f;
			if (type == 143)
			{
				num584 = 3f;
				num585 = 0.7f;
			}
			if (type == 145)
			{
				num584 = 3.5f;
				num585 = 0.8f;
			}
			if (type == 143)
			{
				this.ai[2] += 1f;
				if (this.ai[2] >= 120f)
				{
					this.ai[2] = 0f;
					if (Main.netMode != 1)
					{
						Vector2 vector64 = new Vector2(position.X + (float)width * 0.5f - (float)(direction * 12), position.Y + (float)height * 0.5f);
						float speedX = 12 * spriteDirection;
						float speedY = 0f;
						if (Main.netMode != 1)
						{
							int num586 = 25;
							int num587 = 110;
							int num588 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector64.X, vector64.Y, speedX, speedY, num587, num586, 0f, Main.myPlayer);
							Main.projectile[num588].ai[0] = 2f;
							Main.projectile[num588].timeLeft = 300;
							Main.projectile[num588].friendly = false;
							NetMessage.SendData(27, -1, -1, null, num588);
							netUpdate = true;
						}
					}
				}
			}
			if (type == 144 && this.ai[1] >= 3f)
			{
				TargetClosest();
				spriteDirection = direction;
				if (velocity.Y == 0f)
				{
					velocity.X *= 0.9f;
					this.ai[2] += 1f;
					if ((double)velocity.X > -0.3 && (double)velocity.X < 0.3)
					{
						velocity.X = 0f;
					}
					if (this.ai[2] >= 200f)
					{
						this.ai[2] = 0f;
						this.ai[1] = 0f;
					}
				}
			}
			else if (type == 145 && this.ai[1] >= 3f)
			{
				TargetClosest();
				if (velocity.Y == 0f)
				{
					velocity.X *= 0.9f;
					this.ai[2] += 1f;
					if ((double)velocity.X > -0.3 && (double)velocity.X < 0.3)
					{
						velocity.X = 0f;
					}
					if (this.ai[2] >= 16f)
					{
						this.ai[2] = 0f;
						this.ai[1] = 0f;
					}
				}
				if (velocity.X == 0f && velocity.Y == 0f && this.ai[2] == 8f)
				{
					float num589 = 10f;
					Vector2 vector65 = new Vector2(position.X + (float)width * 0.5f - (float)(direction * 12), position.Y + (float)height * 0.25f);
					float num590 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector65.X;
					float num591 = Main.player[target].position.Y - vector65.Y;
					float num592 = (float)Math.Sqrt(num590 * num590 + num591 * num591);
					num592 = num589 / num592;
					num590 *= num592;
					num591 *= num592;
					if (Main.netMode != 1)
					{
						int num593 = 35;
						int num594 = 109;
						int num595 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector65.X, vector65.Y, num590, num591, num594, num593, 0f, Main.myPlayer);
						Main.projectile[num595].ai[0] = 2f;
						Main.projectile[num595].timeLeft = 300;
						Main.projectile[num595].friendly = false;
						NetMessage.SendData(27, -1, -1, null, num595);
						netUpdate = true;
					}
				}
			}
			else
			{
				if (velocity.Y == 0f)
				{
					if (localAI[2] == position.X)
					{
						direction *= -1;
						this.ai[3] = 60f;
					}
					localAI[2] = position.X;
					if (this.ai[3] == 0f)
					{
						TargetClosest();
					}
					this.ai[0] += 1f;
					if (this.ai[0] > 2f)
					{
						this.ai[0] = 0f;
						this.ai[1] += 1f;
						velocity.Y = -8.2f;
						velocity.X += (float)direction * num585 * 1.1f;
					}
					else
					{
						velocity.Y = -6f;
						velocity.X += (float)direction * num585 * 0.9f;
					}
					spriteDirection = direction;
				}
				velocity.X += (float)direction * num585 * 0.01f;
			}
			if (this.ai[3] > 0f)
			{
				this.ai[3] -= 1f;
			}
			if (velocity.X > num584 && direction > 0)
			{
				velocity.X = num584;
			}
			if (velocity.X < 0f - num584 && direction < 0)
			{
				velocity.X = 0f - num584;
			}
		}
		else if (aiStyle == 39)
		{
			if (target < 0 || Main.player[target].dead || direction == 0)
			{
				TargetClosest();
			}
			bool flag39 = true;
			int num596 = 0;
			if (velocity.X < 0f)
			{
				num596 = -1;
			}
			if (velocity.X > 0f)
			{
				num596 = 1;
			}
			Vector2 vector66 = position;
			vector66.X += velocity.X;
			int num597 = (int)((vector66.X + (float)(width / 2) + (float)((width / 2 + 1) * num596)) / 16f);
			int num598 = (int)((vector66.Y + (float)height - 1f) / 16f);
			if ((float)(num597 * 16) < vector66.X + (float)width && (float)(num597 * 16 + 16) > vector66.X)
			{
				Tile tileSafely = Framing.GetTileSafely(num597, num598 - 4);
				Tile tileSafely2 = Framing.GetTileSafely(num597 - num596, num598 - 3);
				Tile tileSafely3 = Framing.GetTileSafely(num597, num598 - 3);
				Tile tileSafely4 = Framing.GetTileSafely(num597, num598 - 2);
				Tile tileSafely5 = Framing.GetTileSafely(num597, num598 - 1);
				Tile tileSafely6 = Framing.GetTileSafely(num597, num598);
				if (((tileSafely6.nactive() && !tileSafely6.topSlope() && !tileSafely5.topSlope() && ((Main.tileSolid[tileSafely6.type] && !Main.tileSolidTop[tileSafely6.type]) || (flag39 && Main.tileSolidTop[tileSafely6.type] && (!Main.tileSolid[tileSafely5.type] || !tileSafely5.nactive()) && tileSafely6.type != 16 && tileSafely6.type != 18 && tileSafely6.type != 134))) || (tileSafely5.halfBrick() && tileSafely5.nactive())) && (!tileSafely5.nactive() || !Main.tileSolid[tileSafely5.type] || Main.tileSolidTop[tileSafely5.type] || (tileSafely5.halfBrick() && (!tileSafely.nactive() || !Main.tileSolid[tileSafely.type] || Main.tileSolidTop[tileSafely.type]))) && (!tileSafely4.nactive() || !Main.tileSolid[tileSafely4.type] || Main.tileSolidTop[tileSafely4.type]) && (!tileSafely3.nactive() || !Main.tileSolid[tileSafely3.type] || Main.tileSolidTop[tileSafely3.type]) && (!tileSafely2.nactive() || !Main.tileSolid[tileSafely2.type] || Main.tileSolidTop[tileSafely2.type]))
				{
					float num599 = num598 * 16;
					if (tileSafely6.halfBrick())
					{
						num599 += 8f;
					}
					if (tileSafely5.halfBrick())
					{
						num599 -= 8f;
					}
					if (num599 < vector66.Y + (float)height)
					{
						float num600 = vector66.Y + (float)height - num599;
						if ((double)num600 <= 16.1)
						{
							gfxOffY += position.Y + (float)height - num599;
							position.Y = num599 - (float)height;
							if (num600 < 9f)
							{
								stepSpeed = 0.75f;
							}
							else
							{
								stepSpeed = 1.5f;
							}
						}
					}
				}
			}
			if (justHit && type != 417)
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				TargetClosest();
			}
			if (type == 154)
			{
				position += netOffset;
				if (Main.rand.Next(10) == 0)
				{
					int num601 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 67, velocity.X * 0.5f, velocity.Y * 0.5f, 90, default(Color), 1.5f);
					Main.dust[num601].noGravity = true;
					Dust dust = Main.dust[num601];
					dust.velocity *= 0.2f;
				}
				position -= netOffset;
			}
			if (this.ai[0] == 0f)
			{
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else if (velocity.X > 0f)
				{
					direction = 1;
				}
				spriteDirection = direction;
				Vector2 vector67 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num602 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector67.X;
				float num603 = Main.player[target].position.Y - vector67.Y;
				float num604 = (float)Math.Sqrt(num602 * num602 + num603 * num603);
				bool flag40 = Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height);
				if (type >= 496 && type <= 497)
				{
					if (num604 > 200f && flag40)
					{
						this.ai[1] += 2f;
					}
					if (num604 > 600f && (flag40 || position.Y + (float)height > Main.player[target].position.Y - 200f))
					{
						this.ai[1] += 4f;
					}
				}
				else
				{
					if (num604 > 200f && flag40)
					{
						this.ai[1] += 4f;
					}
					if (num604 > 600f && (flag40 || position.Y + (float)height > Main.player[target].position.Y - 200f))
					{
						this.ai[1] += 10f;
					}
					if (wet)
					{
						this.ai[1] = 1000f;
					}
				}
				defense = defDefense;
				damage = defDamage;
				if (type >= 496 && type <= 497)
				{
					knockBackResist = GetKnockbackMultiplier_ScaledByDifficulty(0.75f);
				}
				else
				{
					knockBackResist = GetKnockbackMultiplier_ScaledByDifficulty(0.3f);
				}
				this.ai[1] += 1f;
				if (this.ai[1] >= 400f)
				{
					this.ai[1] = 0f;
					this.ai[0] = 1f;
				}
				if (!justHit && velocity.X != oldVelocity.X)
				{
					direction *= -1;
				}
				if (velocity.Y == 0f && Main.player[target].position.Y < position.Y + (float)height)
				{
					int num605;
					int num606;
					if (direction > 0)
					{
						num605 = (int)(((double)position.X + (double)width * 0.5) / 16.0);
						num606 = num605 + 3;
					}
					else
					{
						num606 = (int)(((double)position.X + (double)width * 0.5) / 16.0);
						num605 = num606 - 3;
					}
					int num607 = (int)((position.Y + (float)height + 2f) / 16f) - 1;
					int num608 = num607 + 4;
					bool flag41 = false;
					for (int num609 = num605; num609 <= num606; num609++)
					{
						for (int num610 = num607; num610 <= num608; num610++)
						{
							if (Main.tile[num609, num610] != null && Main.tile[num609, num610].nactive() && Main.tileSolid[Main.tile[num609, num610].type])
							{
								flag41 = true;
							}
						}
					}
					if (!flag41)
					{
						direction *= -1;
						velocity.X = 0.1f * (float)direction;
					}
				}
				if (type >= 496 && type <= 497)
				{
					float num611 = 0.5f;
					if (velocity.X < 0f - num611 || velocity.X > num611)
					{
						if (velocity.Y == 0f)
						{
							velocity *= 0.8f;
						}
					}
					else if (velocity.X < num611 && direction == 1)
					{
						velocity.X += 0.07f;
						if (velocity.X > num611)
						{
							velocity.X = num611;
						}
					}
					else if (velocity.X > 0f - num611 && direction == -1)
					{
						velocity.X -= 0.07f;
						if (velocity.X < 0f - num611)
						{
							velocity.X = 0f - num611;
						}
					}
					return;
				}
				float num612 = 1f;
				if (num604 < 400f)
				{
					if (velocity.X < 0f - num612 || velocity.X > num612)
					{
						if (velocity.Y == 0f)
						{
							velocity *= 0.8f;
						}
					}
					else if (velocity.X < num612 && direction == 1)
					{
						velocity.X += 0.07f;
						if (velocity.X > num612)
						{
							velocity.X = num612;
						}
					}
					else if (velocity.X > 0f - num612 && direction == -1)
					{
						velocity.X -= 0.07f;
						if (velocity.X < 0f - num612)
						{
							velocity.X = 0f - num612;
						}
					}
				}
				else if (velocity.X < -1.5f || velocity.X > 1.5f)
				{
					if (velocity.Y == 0f)
					{
						velocity *= 0.8f;
					}
				}
				else if (velocity.X < 1.5f && direction == 1)
				{
					velocity.X += 0.07f;
					if (velocity.X > 1.5f)
					{
						velocity.X = 1.5f;
					}
				}
				else if (velocity.X > -1.5f && direction == -1)
				{
					velocity.X -= 0.07f;
					if (velocity.X < -1.5f)
					{
						velocity.X = -1.5f;
					}
				}
			}
			else if (this.ai[0] == 1f)
			{
				velocity.X *= 0.5f;
				if (type >= 496 && type <= 497)
				{
					this.ai[1] += 0.5f;
				}
				else
				{
					this.ai[1] += 1f;
				}
				if (this.ai[1] >= 30f)
				{
					netUpdate = true;
					TargetClosest();
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[0] = 3f;
					if (type == 417)
					{
						position.Y += height;
						height = 32;
						position.Y -= height;
						this.ai[0] = 6f;
						this.ai[2] = Main.rand.Next(2, 5);
					}
				}
			}
			else if (this.ai[0] == 3f)
			{
				if (type == 154 && Main.rand.Next(3) < 2)
				{
					position += netOffset;
					int num613 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 67, velocity.X * 0.5f, velocity.Y * 0.5f, 90, default(Color), 1.5f);
					Main.dust[num613].noGravity = true;
					Dust dust = Main.dust[num613];
					dust.velocity *= 0.2f;
					position -= netOffset;
				}
				float num614 = 2f;
				if (type >= 496 && type <= 497)
				{
					num614 = 1.5f;
				}
				damage = GetAttackDamage_LerpBetweenFinalValues((float)defDamage * num614, (float)defDamage * num614 * 0.9f);
				defense = defDefense * 2;
				this.ai[1] += 1f;
				if (this.ai[1] == 1f)
				{
					netUpdate = true;
					TargetClosest();
					this.ai[2] += 0.3f;
					rotation += this.ai[2] * (float)direction;
					this.ai[1] += 1f;
					bool flag42 = Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height);
					float num615 = 10f;
					if (!flag42)
					{
						num615 = 6f;
					}
					if (type >= 496 && type <= 497)
					{
						num615 *= 0.75f;
					}
					Vector2 vector68 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num616 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector68.X;
					float num617 = Math.Abs(num616) * 0.2f;
					if (directionY > 0)
					{
						num617 = 0f;
					}
					float num618 = Main.player[target].position.Y - vector68.Y - num617;
					float num619 = (float)Math.Sqrt(num616 * num616 + num618 * num618);
					netUpdate = true;
					num619 = num615 / num619;
					num616 *= num619;
					num618 *= num619;
					if (!flag42)
					{
						num618 = -10f;
					}
					velocity.X = num616;
					velocity.Y = num618;
					this.ai[3] = velocity.X;
				}
				else
				{
					if (position.X + (float)width > Main.player[target].position.X && position.X < Main.player[target].position.X + (float)Main.player[target].width && position.Y < Main.player[target].position.Y + (float)Main.player[target].height)
					{
						velocity.X *= 0.8f;
						this.ai[3] = 0f;
						if (velocity.Y < 0f)
						{
							velocity.Y += 0.2f;
						}
					}
					if (this.ai[3] != 0f)
					{
						velocity.X = this.ai[3];
						velocity.Y -= 0.22f;
					}
					if (this.ai[1] >= 90f)
					{
						noGravity = false;
						this.ai[1] = 0f;
						this.ai[0] = 4f;
					}
				}
				if (wet && directionY < 0)
				{
					velocity.Y -= 0.3f;
				}
				rotation += this.ai[2] * (float)direction;
			}
			else if (this.ai[0] == 4f)
			{
				if (wet && directionY < 0)
				{
					velocity.Y -= 0.3f;
				}
				velocity.X *= 0.96f;
				if (this.ai[2] > 0f)
				{
					this.ai[2] -= 0.01f;
					rotation += this.ai[2] * (float)direction;
				}
				else if (velocity.Y >= 0f)
				{
					rotation = 0f;
				}
				if (this.ai[2] <= 0f && (velocity.Y == 0f || wet))
				{
					netUpdate = true;
					rotation = 0f;
					this.ai[2] = 0f;
					this.ai[1] = 0f;
					this.ai[0] = 5f;
				}
			}
			else if (this.ai[0] == 6f)
			{
				damage = GetAttackDamage_LerpBetweenFinalValues((float)defDamage * 1.8f, (float)defDamage * 1.4f);
				defense = defDefense * 2;
				knockBackResist = 0f;
				if (Main.rand.Next(3) < 2)
				{
					position += netOffset;
					int num620 = Dust.NewDust(base.Center - new Vector2(30f), 60, 60, 6, velocity.X * 0.5f, velocity.Y * 0.5f, 90, default(Color), 1.5f);
					Main.dust[num620].noGravity = true;
					Dust dust = Main.dust[num620];
					dust.velocity *= 0.2f;
					Main.dust[num620].fadeIn = 1f;
					position -= netOffset;
				}
				this.ai[1] += 1f;
				if (this.ai[3] > 0f)
				{
					position += netOffset;
					if (this.ai[3] == 1f)
					{
						Vector2 vector69 = base.Center - new Vector2(50f);
						for (int num621 = 0; num621 < 32; num621++)
						{
							int num622 = Dust.NewDust(vector69, 100, 100, 6, 0f, 0f, 100, default(Color), 2.5f);
							Main.dust[num622].noGravity = true;
							Dust dust = Main.dust[num622];
							dust.velocity *= 3f;
							num622 = Dust.NewDust(vector69, 100, 100, 6, 0f, 0f, 100, default(Color), 1.5f);
							dust = Main.dust[num622];
							dust.velocity *= 2f;
							Main.dust[num622].noGravity = true;
						}
						for (int num623 = 0; num623 < 4; num623++)
						{
							int num624 = Gore.NewGore(vector69 + new Vector2((float)(50 * Main.rand.Next(100)) / 100f, (float)(50 * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
							Gore gore = Main.gore[num624];
							gore.velocity *= 0.3f;
							Main.gore[num624].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
							Main.gore[num624].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
						}
					}
					for (int num625 = 0; num625 < 5; num625++)
					{
						int num626 = Dust.NewDust(position, width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Main.dust[num626].velocity = Main.dust[num626].velocity * Main.rand.NextFloat();
					}
					this.ai[3]++;
					if (this.ai[3] >= 10f)
					{
						this.ai[3] = 0f;
					}
					position -= netOffset;
				}
				if (this.ai[1] == 1f)
				{
					netUpdate = true;
					TargetClosest();
					bool flag43 = Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height);
					float num627 = 16f;
					if (!flag43)
					{
						num627 = 10f;
					}
					Vector2 vector70 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num628 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector70.X;
					float num629 = Math.Abs(num628) * 0.2f;
					if (directionY > 0)
					{
						num629 = 0f;
					}
					float num630 = Main.player[target].position.Y - vector70.Y - num629;
					float num631 = (float)Math.Sqrt(num628 * num628 + num630 * num630);
					netUpdate = true;
					num631 = num627 / num631;
					num628 *= num631;
					num630 *= num631;
					if (!flag43)
					{
						num630 = -12f;
					}
					velocity.X = num628;
					velocity.Y = num630;
				}
				else
				{
					if (position.X + (float)width > Main.player[target].position.X && position.X < Main.player[target].position.X + (float)Main.player[target].width && position.Y < Main.player[target].position.Y + (float)Main.player[target].height)
					{
						velocity.X *= 0.9f;
						if (velocity.Y < 0f)
						{
							velocity.Y += 0.2f;
						}
					}
					if (this.ai[2] == 0f || this.ai[1] >= 1200f)
					{
						this.ai[1] = 0f;
						this.ai[0] = 5f;
					}
				}
				if (wet && directionY < 0)
				{
					velocity.Y -= 0.3f;
				}
				rotation += MathHelper.Clamp(velocity.X / 10f * (float)direction, -(float)Math.PI / 10f, (float)Math.PI / 10f);
			}
			else if (this.ai[0] == 5f)
			{
				if (type == 417)
				{
					position.Y += height;
					height = 52;
					position.Y -= height;
				}
				rotation = 0f;
				velocity.X = 0f;
				if (type >= 496 && type <= 497)
				{
					this.ai[1] += 0.5f;
				}
				else
				{
					this.ai[1] += 1f;
				}
				if (this.ai[1] >= 30f)
				{
					TargetClosest();
					netUpdate = true;
					this.ai[1] = 0f;
					this.ai[0] = 0f;
				}
				if (wet)
				{
					this.ai[0] = 3f;
					this.ai[1] = 0f;
				}
			}
		}
		else if (aiStyle == 40)
		{
			if (target < 0 || target == 255 || Main.player[target].dead)
			{
				TargetClosest();
			}
			float num632 = 2f;
			float num633 = 0.08f;
			if (type == 237)
			{
				num632 = 3f;
				num633 = 0.12f;
			}
			if (type == 531)
			{
				num632 = 4f;
				num633 = 0.16f;
			}
			Vector2 vector71 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num634 = Main.player[target].position.X + (float)(Main.player[target].width / 2);
			float num635 = Main.player[target].position.Y + (float)(Main.player[target].height / 2);
			num634 = (int)(num634 / 8f) * 8;
			num635 = (int)(num635 / 8f) * 8;
			vector71.X = (int)(vector71.X / 8f) * 8;
			vector71.Y = (int)(vector71.Y / 8f) * 8;
			num634 -= vector71.X;
			num635 -= vector71.Y;
			if (confused)
			{
				num634 *= -2f;
				num635 *= -2f;
			}
			float num636 = (float)Math.Sqrt(num634 * num634 + num635 * num635);
			float num637 = num636;
			if (num636 == 0f)
			{
				num634 = velocity.X;
				num635 = velocity.Y;
			}
			else
			{
				num636 = num632 / num636;
				num634 *= num636;
				num635 *= num636;
			}
			if (Main.player[target].dead)
			{
				num634 = (float)direction * num632 / 2f;
				num635 = (0f - num632) / 2f;
			}
			spriteDirection = -1;
			if (!Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
			{
				this.ai[0] += 1f;
				if (this.ai[0] > 0f)
				{
					velocity.Y += 0.023f;
				}
				else
				{
					velocity.Y -= 0.023f;
				}
				if (this.ai[0] < -100f || this.ai[0] > 100f)
				{
					velocity.X += 0.023f;
				}
				else
				{
					velocity.X -= 0.023f;
				}
				if (this.ai[0] > 200f)
				{
					this.ai[0] = -200f;
				}
				velocity.X += num634 * 0.007f;
				velocity.Y += num635 * 0.007f;
				rotation = (float)Math.Atan2(velocity.Y, velocity.X);
				if ((double)velocity.X > 1.5)
				{
					velocity.X *= 0.9f;
				}
				if ((double)velocity.X < -1.5)
				{
					velocity.X *= 0.9f;
				}
				if ((double)velocity.Y > 1.5)
				{
					velocity.Y *= 0.9f;
				}
				if ((double)velocity.Y < -1.5)
				{
					velocity.Y *= 0.9f;
				}
				if (velocity.X > 3f)
				{
					velocity.X = 3f;
				}
				if (velocity.X < -3f)
				{
					velocity.X = -3f;
				}
				if (velocity.Y > 3f)
				{
					velocity.Y = 3f;
				}
				if (velocity.Y < -3f)
				{
					velocity.Y = -3f;
				}
			}
			else
			{
				if (velocity.X < num634)
				{
					velocity.X += num633;
					if (velocity.X < 0f && num634 > 0f)
					{
						velocity.X += num633;
					}
				}
				else if (velocity.X > num634)
				{
					velocity.X -= num633;
					if (velocity.X > 0f && num634 < 0f)
					{
						velocity.X -= num633;
					}
				}
				if (velocity.Y < num635)
				{
					velocity.Y += num633;
					if (velocity.Y < 0f && num635 > 0f)
					{
						velocity.Y += num633;
					}
				}
				else if (velocity.Y > num635)
				{
					velocity.Y -= num633;
					if (velocity.Y > 0f && num635 < 0f)
					{
						velocity.Y -= num633;
					}
				}
				rotation = (float)Math.Atan2(num635, num634);
			}
			if (type == 531)
			{
				rotation += (float)Math.PI / 2f;
			}
			float num638 = 0.5f;
			if (collideX)
			{
				netUpdate = true;
				velocity.X = oldVelocity.X * (0f - num638);
				if (direction == -1 && velocity.X > 0f && velocity.X < 2f)
				{
					velocity.X = 2f;
				}
				if (direction == 1 && velocity.X < 0f && velocity.X > -2f)
				{
					velocity.X = -2f;
				}
			}
			if (collideY)
			{
				netUpdate = true;
				velocity.Y = oldVelocity.Y * (0f - num638);
				if (velocity.Y > 0f && (double)velocity.Y < 1.5)
				{
					velocity.Y = 2f;
				}
				if (velocity.Y < 0f && (double)velocity.Y > -1.5)
				{
					velocity.Y = -2f;
				}
			}
			if (((velocity.X > 0f && oldVelocity.X < 0f) || (velocity.X < 0f && oldVelocity.X > 0f) || (velocity.Y > 0f && oldVelocity.Y < 0f) || (velocity.Y < 0f && oldVelocity.Y > 0f)) && !justHit)
			{
				netUpdate = true;
			}
			if (Main.netMode == 1)
			{
				return;
			}
			if (Main.netMode != 1 && Main.expertMode && target >= 0 && !Main.player[target].dead && (type == 163 || type == 238 || type == 236 || type == 237) && Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
			{
				localAI[0] += 1f;
				if (justHit)
				{
					localAI[0] -= Main.rand.Next(20, 60);
					if (localAI[0] < 0f)
					{
						localAI[0] = 0f;
					}
				}
				if (localAI[0] > (float)Main.rand.Next(180, 900))
				{
					localAI[0] = 0f;
					Vector2 vector72 = Main.player[target].Center - base.Center;
					vector72.Normalize();
					vector72 *= 8f;
					int attackDamage_ForProjectiles8 = GetAttackDamage_ForProjectiles(18f, 18f);
					int num639 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, vector72.X, vector72.Y, 472, attackDamage_ForProjectiles8, 0f, Main.myPlayer);
				}
			}
			if (!NPCCanStickToWalls())
			{
				int num640 = type;
				switch (type)
				{
				case 165:
					num640 = 164;
					break;
				case 237:
					num640 = 236;
					break;
				case 238:
					num640 = 163;
					break;
				case 240:
					num640 = 239;
					break;
				case 531:
					num640 = 530;
					break;
				}
				if (TryMoveToTransformableSpaceInto(num640))
				{
					Transform(num640, 0f, 0f, 0f, 0f, withReposition: false);
				}
			}
		}
		else if (aiStyle == 41)
		{
			if (this.ai[2] > 1f)
			{
				this.ai[2] -= 1f;
			}
			if (this.ai[2] == 0f)
			{
				this.ai[0] = -100f;
				this.ai[2] = 1f;
				TargetClosest();
				spriteDirection = direction;
			}
			if (type == 378)
			{
				Vector2 vector73 = new Vector2(-6f, -10f);
				vector73.X *= spriteDirection;
				if (this.ai[1] != 5f && Main.rand.Next(3) == 0)
				{
					position += netOffset;
					int num641 = Dust.NewDust(base.Center + vector73 - Vector2.One * 5f, 4, 4, 6);
					Main.dust[num641].scale = 1.5f;
					Main.dust[num641].noGravity = true;
					Main.dust[num641].velocity = Main.dust[num641].velocity * 0.25f + Vector2.Normalize(vector73) * 1f;
					Main.dust[num641].velocity = Main.dust[num641].velocity.RotatedBy(-(float)Math.PI / 2f * (float)direction);
					position -= netOffset;
				}
				if (this.ai[1] == 5f)
				{
					velocity = Vector2.Zero;
					position.X += width / 2;
					position.Y += height / 2;
					width = 160;
					height = 160;
					position.X -= width / 2;
					position.Y -= height / 2;
					dontTakeDamage = true;
					position += netOffset;
					if (this.ai[2] > 7f)
					{
						for (int num642 = 0; num642 < 8; num642++)
						{
							int num643 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						}
						for (int num644 = 0; num644 < 32; num644++)
						{
							int num645 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
							Main.dust[num645].noGravity = true;
							Dust dust = Main.dust[num645];
							dust.velocity *= 3f;
							num645 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
							dust = Main.dust[num645];
							dust.velocity *= 2f;
							Main.dust[num645].noGravity = true;
						}
						for (int num646 = 0; num646 < 2; num646++)
						{
							int num647 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
							Gore gore = Main.gore[num647];
							gore.velocity *= 0.3f;
							Main.gore[num647].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
							Main.gore[num647].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
						}
						if (this.ai[2] == 9f)
						{
							SoundEngine.PlaySound(SoundID.Item14, position);
						}
					}
					if (this.ai[2] == 1f)
					{
						life = -1;
						HitEffect();
						active = false;
					}
					position -= netOffset;
					return;
				}
			}
			if (type == 378 && this.ai[1] != 5f)
			{
				if (wet || Vector2.Distance(base.Center, Main.player[target].Center) < 64f)
				{
					this.ai[1] = 5f;
					this.ai[2] = 10f;
					netUpdate = true;
					return;
				}
			}
			else if (wet && type != 177)
			{
				if (collideX)
				{
					direction *= -direction;
					spriteDirection = direction;
				}
				if (collideY)
				{
					TargetClosest();
					if (oldVelocity.Y < 0f)
					{
						velocity.Y = 5f;
					}
					else
					{
						velocity.Y -= 2f;
					}
					spriteDirection = direction;
				}
				if (velocity.Y > 4f)
				{
					velocity.Y *= 0.95f;
				}
				velocity.Y -= 0.3f;
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
			}
			if (velocity.Y == 0f)
			{
				if (this.ai[3] == position.X)
				{
					direction *= -1;
					this.ai[2] = 300f;
				}
				this.ai[3] = 0f;
				velocity.X *= 0.8f;
				if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
				{
					velocity.X = 0f;
				}
				if (type == 177)
				{
					this.ai[0] += 2f;
				}
				else
				{
					this.ai[0] += 5f;
				}
				Vector2 vector74 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num648 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector74.X;
				float num649 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector74.Y;
				float num650 = (float)Math.Sqrt(num648 * num648 + num649 * num649);
				float num651 = 400f / num650;
				num651 = ((type != 177) ? (num651 * 10f) : (num651 * 5f));
				if (num651 > 30f)
				{
					num651 = 30f;
				}
				this.ai[0] += (int)num651;
				if (this.ai[0] >= 0f)
				{
					netUpdate = true;
					if (this.ai[2] == 1f)
					{
						TargetClosest();
					}
					if (type == 177)
					{
						if (this.ai[1] == 2f)
						{
							velocity.Y = -11.5f;
							velocity.X += 2f * (float)direction;
							if (num650 < 350f && num650 > 200f)
							{
								velocity.X += direction;
							}
							this.ai[0] = -200f;
							this.ai[1] = 0f;
							this.ai[3] = position.X;
						}
						else
						{
							velocity.Y = -7.5f;
							velocity.X += 4 * direction;
							if (num650 < 350f && num650 > 200f)
							{
								velocity.X += direction;
							}
							this.ai[0] = -120f;
							this.ai[1] += 1f;
						}
					}
					else
					{
						if (type == 378)
						{
							SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 124);
						}
						if (this.ai[1] == 3f)
						{
							velocity.Y = -9f;
							velocity.X += 3 * direction;
							if (num650 < 350f && num650 > 200f)
							{
								velocity.X += direction;
							}
							this.ai[0] = -200f;
							this.ai[1] = 0f;
							this.ai[3] = position.X;
						}
						else
						{
							velocity.Y = -5f;
							velocity.X += 5 * direction;
							if (num650 < 350f && num650 > 200f)
							{
								velocity.X += direction;
							}
							this.ai[0] = -120f;
							this.ai[1] += 1f;
						}
					}
				}
				else if (this.ai[0] >= -30f)
				{
					aiAction = 1;
				}
				spriteDirection = direction;
			}
			else
			{
				if (target >= 255)
				{
					return;
				}
				if (type == 177)
				{
					bool flag44 = false;
					if (position.Y + (float)height < Main.player[target].position.Y && position.X + (float)width > Main.player[target].position.X && position.X < Main.player[target].position.X + (float)Main.player[target].width)
					{
						flag44 = true;
						velocity.X *= 0.92f;
						if (velocity.Y < 0f)
						{
							velocity.Y *= 0.9f;
							velocity.Y += 0.1f;
						}
					}
					if (!flag44 && ((direction == 1 && velocity.X < 4f) || (direction == -1 && velocity.X > -4f)))
					{
						if ((direction == -1 && (double)velocity.X < 0.1) || (direction == 1 && (double)velocity.X > -0.1))
						{
							velocity.X += 0.2f * (float)direction;
						}
						else
						{
							velocity.X *= 0.93f;
						}
					}
				}
				else if ((direction == 1 && velocity.X < 3f) || (direction == -1 && velocity.X > -3f))
				{
					if ((direction == -1 && (double)velocity.X < 0.1) || (direction == 1 && (double)velocity.X > -0.1))
					{
						velocity.X += 0.2f * (float)direction;
					}
					else
					{
						velocity.X *= 0.93f;
					}
				}
			}
		}
		else if (aiStyle == 42)
		{
			TargetClosest();
			if (this.ai[0] == 0f)
			{
				if (target >= 0)
				{
					Vector2 vector75 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num652 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector75.X;
					float num653 = Main.player[target].position.Y - vector75.Y;
					float num654 = (float)Math.Sqrt(num652 * num652 + num653 * num653);
					if (num654 < 200f && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
					{
						this.ai[0] = 1f;
					}
				}
				if (velocity.X != 0f || velocity.Y < 0f || velocity.Y > 2f || life != lifeMax)
				{
					this.ai[0] = 1f;
				}
			}
			else
			{
				this.ai[0] += 1f;
				if (this.ai[0] >= 21f)
				{
					this.ai[0] = 21f;
					Transform(196);
				}
			}
		}
		else if (aiStyle == 43)
		{
			if (Main.expertMode)
			{
				int num655 = (int)(20f * (1f - (float)life / (float)lifeMax));
				defense = defDefense + num655;
			}
			if (target < 0 || target == 255 || Main.player[target].dead || !Main.player[target].active)
			{
				TargetClosest();
			}
			bool dead4 = Main.player[target].dead;
			float num656 = 0f;
			if ((double)(position.Y / 16f) < Main.worldSurface)
			{
				num656 += 1f;
			}
			if (!Main.player[target].ZoneJungle)
			{
				num656 += 1f;
			}
			if (Main.getGoodWorld)
			{
				num656 += 0.5f;
			}
			float num657 = Vector2.Distance(base.Center, Main.player[target].Center);
			if (this.ai[0] != 5f)
			{
				if (timeLeft < 60)
				{
					timeLeft = 60;
				}
				if (num657 > 3000f)
				{
					this.ai[0] = 4f;
					netUpdate = true;
				}
			}
			if (dead4)
			{
				this.ai[0] = 5f;
				netUpdate = true;
			}
			if (this.ai[0] == 5f)
			{
				velocity.Y *= 0.98f;
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
				spriteDirection = direction;
				if (position.X < (float)(Main.maxTilesX * 8))
				{
					if (velocity.X > 0f)
					{
						velocity.X *= 0.98f;
					}
					else
					{
						localAI[0] = 1f;
					}
					velocity.X -= 0.08f;
				}
				else
				{
					if (velocity.X < 0f)
					{
						velocity.X *= 0.98f;
					}
					else
					{
						localAI[0] = 1f;
					}
					velocity.X += 0.08f;
				}
				EncourageDespawn(10);
			}
			else if (this.ai[0] == -1f)
			{
				if (Main.netMode == 1)
				{
					return;
				}
				float num658 = this.ai[1];
				int num659;
				do
				{
					num659 = Main.rand.Next(3);
					switch (num659)
					{
					case 1:
						num659 = 2;
						break;
					case 2:
						num659 = 3;
						break;
					}
				}
				while ((float)num659 == num658);
				this.ai[0] = num659;
				this.ai[1] = 0f;
				this.ai[2] = 0f;
				netUpdate = true;
			}
			else if (this.ai[0] == 0f)
			{
				int num660 = 2;
				if (Main.expertMode)
				{
					if (life < lifeMax / 2)
					{
						num660++;
					}
					if (life < lifeMax / 3)
					{
						num660++;
					}
					if (life < lifeMax / 5)
					{
						num660++;
					}
				}
				num660 += (int)(1f * num656);
				if (this.ai[1] > (float)(2 * num660) && this.ai[1] % 2f == 0f)
				{
					this.ai[0] = -1f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					netUpdate = true;
					return;
				}
				if (this.ai[1] % 2f == 0f)
				{
					TargetClosest();
					float num661 = 20f;
					num661 += 20f * num656;
					if (Math.Abs(base.Center.Y - Main.player[target].Center.Y) < num661)
					{
						localAI[0] = 1f;
						this.ai[1] += 1f;
						this.ai[2] = 0f;
						netUpdate = true;
						float num662 = 12f;
						if (Main.expertMode)
						{
							num662 = 16f;
							if ((double)life < (double)lifeMax * 0.75)
							{
								num662 += 2f;
							}
							if ((double)life < (double)lifeMax * 0.5)
							{
								num662 += 2f;
							}
							if ((double)life < (double)lifeMax * 0.25)
							{
								num662 += 2f;
							}
							if ((double)life < (double)lifeMax * 0.1)
							{
								num662 += 2f;
							}
						}
						num662 += 7f * num656;
						Vector2 vector76 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
						float num663 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector76.X;
						float num664 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector76.Y;
						float num665 = (float)Math.Sqrt(num663 * num663 + num664 * num664);
						num665 = num662 / num665;
						velocity.X = num663 * num665;
						velocity.Y = num664 * num665;
						spriteDirection = direction;
						SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 125);
						return;
					}
					localAI[0] = 0f;
					float num666 = 12f;
					float num667 = 0.15f;
					if (Main.expertMode)
					{
						if ((double)life < (double)lifeMax * 0.75)
						{
							num666 += 1f;
							num667 += 0.05f;
						}
						if ((double)life < (double)lifeMax * 0.5)
						{
							num666 += 1f;
							num667 += 0.05f;
						}
						if ((double)life < (double)lifeMax * 0.25)
						{
							num666 += 2f;
							num667 += 0.05f;
						}
						if ((double)life < (double)lifeMax * 0.1)
						{
							num666 += 2f;
							num667 += 0.1f;
						}
					}
					num666 += 3f * num656;
					num667 += 0.5f * num656;
					if (position.Y + (float)(height / 2) < Main.player[target].position.Y + (float)(Main.player[target].height / 2))
					{
						velocity.Y += num667;
					}
					else
					{
						velocity.Y -= num667;
					}
					if (velocity.Y < 0f - num666)
					{
						velocity.Y = 0f - num666;
					}
					if (velocity.Y > num666)
					{
						velocity.Y = num666;
					}
					if (Math.Abs(position.X + (float)(width / 2) - (Main.player[target].position.X + (float)(Main.player[target].width / 2))) > 600f)
					{
						velocity.X += 0.15f * (float)direction;
					}
					else if (Math.Abs(position.X + (float)(width / 2) - (Main.player[target].position.X + (float)(Main.player[target].width / 2))) < 300f)
					{
						velocity.X -= 0.15f * (float)direction;
					}
					else
					{
						velocity.X *= 0.8f;
					}
					if (velocity.X < -16f)
					{
						velocity.X = -16f;
					}
					if (velocity.X > 16f)
					{
						velocity.X = 16f;
					}
					spriteDirection = direction;
					return;
				}
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
				spriteDirection = direction;
				int num668 = 600;
				if (Main.expertMode)
				{
					if ((double)life < (double)lifeMax * 0.1)
					{
						num668 = 300;
					}
					else if ((double)life < (double)lifeMax * 0.25)
					{
						num668 = 450;
					}
					else if ((double)life < (double)lifeMax * 0.5)
					{
						num668 = 500;
					}
					else if ((double)life < (double)lifeMax * 0.75)
					{
						num668 = 550;
					}
				}
				int num669 = 1;
				if (position.X + (float)(width / 2) < Main.player[target].position.X + (float)(Main.player[target].width / 2))
				{
					num669 = -1;
				}
				num668 -= (int)(100f * num656);
				bool flag45 = false;
				if (direction == num669 && Math.Abs(base.Center.X - Main.player[target].Center.X) > (float)num668)
				{
					this.ai[2] = 1f;
					flag45 = true;
				}
				if (Math.Abs(base.Center.Y - Main.player[target].Center.Y) > (float)num668 * 1.5f)
				{
					this.ai[2] = 1f;
					flag45 = true;
				}
				if (num656 > 0f && flag45)
				{
					velocity *= 0.5f;
				}
				if (this.ai[2] == 1f)
				{
					TargetClosest();
					spriteDirection = direction;
					localAI[0] = 0f;
					velocity *= 0.9f;
					float num670 = 0.1f;
					if (Main.expertMode)
					{
						if (life < lifeMax / 2)
						{
							velocity *= 0.9f;
							num670 += 0.05f;
						}
						if (life < lifeMax / 3)
						{
							velocity *= 0.9f;
							num670 += 0.05f;
						}
						if (life < lifeMax / 5)
						{
							velocity *= 0.9f;
							num670 += 0.05f;
						}
					}
					if (num656 > 0f)
					{
						velocity *= 0.7f;
					}
					if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < num670)
					{
						this.ai[2] = 0f;
						this.ai[1] += 1f;
						netUpdate = true;
					}
				}
				else
				{
					localAI[0] = 1f;
				}
			}
			else if (this.ai[0] == 2f)
			{
				TargetClosest();
				spriteDirection = direction;
				float num671 = 12f;
				float num672 = 0.07f;
				if (Main.expertMode)
				{
					num672 = 0.1f;
				}
				Vector2 vector77 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num673 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector77.X;
				float num674 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - 200f - vector77.Y;
				float num675 = (float)Math.Sqrt(num673 * num673 + num674 * num674);
				if (num675 < 200f)
				{
					this.ai[0] = 1f;
					this.ai[1] = 0f;
					netUpdate = true;
					return;
				}
				num675 = num671 / num675;
				if (velocity.X < num673)
				{
					velocity.X += num672;
					if (velocity.X < 0f && num673 > 0f)
					{
						velocity.X += num672;
					}
				}
				else if (velocity.X > num673)
				{
					velocity.X -= num672;
					if (velocity.X > 0f && num673 < 0f)
					{
						velocity.X -= num672;
					}
				}
				if (velocity.Y < num674)
				{
					velocity.Y += num672;
					if (velocity.Y < 0f && num674 > 0f)
					{
						velocity.Y += num672;
					}
				}
				else if (velocity.Y > num674)
				{
					velocity.Y -= num672;
					if (velocity.Y > 0f && num674 < 0f)
					{
						velocity.Y -= num672;
					}
				}
			}
			else if (this.ai[0] == 1f)
			{
				localAI[0] = 0f;
				TargetClosest();
				Vector2 vector78 = new Vector2(position.X + (float)(width / 2) + (float)(Main.rand.Next(20) * direction), position.Y + (float)height * 0.8f);
				Vector2 vector79 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num676 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector79.X;
				float num677 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector79.Y;
				float num678 = (float)Math.Sqrt(num676 * num676 + num677 * num677);
				this.ai[1] += 1f;
				if (Main.expertMode)
				{
					int num679 = 0;
					for (int num680 = 0; num680 < 255; num680++)
					{
						if (Main.player[num680].active && !Main.player[num680].dead && (base.Center - Main.player[num680].Center).Length() < 1000f)
						{
							num679++;
						}
					}
					this.ai[1] += num679 / 2;
					if ((double)life < (double)lifeMax * 0.75)
					{
						this.ai[1] += 0.25f;
					}
					if ((double)life < (double)lifeMax * 0.5)
					{
						this.ai[1] += 0.25f;
					}
					if ((double)life < (double)lifeMax * 0.25)
					{
						this.ai[1] += 0.25f;
					}
					if ((double)life < (double)lifeMax * 0.1)
					{
						this.ai[1] += 0.25f;
					}
				}
				bool flag46 = false;
				int num681 = (int)(40f - 18f * num656);
				if (this.ai[1] > (float)num681)
				{
					this.ai[1] = 0f;
					this.ai[2]++;
					flag46 = true;
				}
				if (Collision.CanHit(vector78, 1, 1, Main.player[target].position, Main.player[target].width, Main.player[target].height) && flag46)
				{
					SoundEngine.PlaySound(3, (int)position.X, (int)position.Y);
					if (Main.netMode != 1)
					{
						int num682 = Main.rand.Next(210, 212);
						int num683 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)vector78.X, (int)vector78.Y, num682);
						Main.npc[num683].velocity = Main.player[target].Center - base.Center;
						Main.npc[num683].velocity.Normalize();
						NPC nPC3 = Main.npc[num683];
						nPC3.velocity *= 5f;
						Main.npc[num683].CanBeReplacedByOtherNPCs = true;
						Main.npc[num683].localAI[0] = 60f;
						Main.npc[num683].netUpdate = true;
					}
				}
				if (num678 > 400f || !Collision.CanHit(new Vector2(vector78.X, vector78.Y - 30f), 1, 1, Main.player[target].position, Main.player[target].width, Main.player[target].height))
				{
					float num684 = 14f;
					float num685 = 0.1f;
					vector79 = vector78;
					num676 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector79.X;
					num677 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector79.Y;
					num678 = (float)Math.Sqrt(num676 * num676 + num677 * num677);
					num678 = num684 / num678;
					if (velocity.X < num676)
					{
						velocity.X += num685;
						if (velocity.X < 0f && num676 > 0f)
						{
							velocity.X += num685;
						}
					}
					else if (velocity.X > num676)
					{
						velocity.X -= num685;
						if (velocity.X > 0f && num676 < 0f)
						{
							velocity.X -= num685;
						}
					}
					if (velocity.Y < num677)
					{
						velocity.Y += num685;
						if (velocity.Y < 0f && num677 > 0f)
						{
							velocity.Y += num685;
						}
					}
					else if (velocity.Y > num677)
					{
						velocity.Y -= num685;
						if (velocity.Y > 0f && num677 < 0f)
						{
							velocity.Y -= num685;
						}
					}
				}
				else
				{
					velocity *= 0.9f;
				}
				spriteDirection = direction;
				if (this.ai[2] > 5f)
				{
					this.ai[0] = -1f;
					this.ai[1] = 1f;
					netUpdate = true;
				}
			}
			else if (this.ai[0] == 3f)
			{
				float num686 = 4f;
				float num687 = 0.05f;
				if (Main.expertMode)
				{
					num687 = 0.075f;
					num686 = 6f;
				}
				num687 += 0.2f * num656;
				num686 += 6f * num656;
				Vector2 vector80 = new Vector2(position.X + (float)(width / 2) + (float)(Main.rand.Next(20) * direction), position.Y + (float)height * 0.8f);
				Vector2 vector81 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num688 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector81.X;
				float num689 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - 300f - vector81.Y;
				float num690 = (float)Math.Sqrt(num688 * num688 + num689 * num689);
				this.ai[1] += 1f;
				bool flag47 = false;
				int num691 = 40;
				if (Main.expertMode)
				{
					num691 = (((double)life < (double)lifeMax * 0.1) ? 15 : ((life < lifeMax / 3) ? 25 : ((life >= lifeMax / 2) ? 35 : 30)));
				}
				num691 -= (int)(5f * num656);
				if (this.ai[1] % (float)num691 == (float)(num691 - 1) && position.Y + (float)height < Main.player[target].position.Y && Collision.CanHit(vector80, 1, 1, Main.player[target].position, Main.player[target].width, Main.player[target].height))
				{
					SoundEngine.PlaySound(SoundID.Item17, position);
					if (Main.netMode != 1)
					{
						float num692 = 8f;
						if (Main.expertMode)
						{
							num692 += 2f;
						}
						if (Main.expertMode && (double)life < (double)lifeMax * 0.1)
						{
							num692 += 3f;
						}
						num692 += 7f * num656;
						int num693 = (int)(80f - 39f * num656);
						int num694 = (int)(40f - 19f * num656);
						if (num693 < 1)
						{
							num693 = 1;
						}
						if (num694 < 1)
						{
							num694 = 1;
						}
						float num695 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector80.X + (float)Main.rand.Next(-num693, num693 + 1);
						float num696 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector80.Y + (float)Main.rand.Next(-num694, num694 + 1);
						float num697 = (float)Math.Sqrt(num695 * num695 + num696 * num696);
						num697 = num692 / num697;
						num695 *= num697;
						num696 *= num697;
						int num698 = 11;
						int num699 = 719;
						int num700 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector80.X, vector80.Y, num695, num696, num699, num698, 0f, Main.myPlayer);
						Main.projectile[num700].timeLeft = 300;
					}
				}
				if (!Collision.CanHit(new Vector2(vector80.X, vector80.Y - 30f), 1, 1, Main.player[target].position, Main.player[target].width, Main.player[target].height))
				{
					num686 = 14f;
					num687 = 0.1f;
					if (num656 > 0f)
					{
						num687 = 0.5f;
					}
					vector81 = vector80;
					num688 = Main.player[target].position.X + (float)(Main.player[target].width / 2) - vector81.X;
					num689 = Main.player[target].position.Y + (float)(Main.player[target].height / 2) - vector81.Y;
					num690 = (float)Math.Sqrt(num688 * num688 + num689 * num689);
					num690 = num686 / num690;
					if (velocity.X < num688)
					{
						velocity.X += num687;
						if (velocity.X < 0f && num688 > 0f)
						{
							velocity.X += num687;
						}
					}
					else if (velocity.X > num688)
					{
						velocity.X -= num687;
						if (velocity.X > 0f && num688 < 0f)
						{
							velocity.X -= num687;
						}
					}
					if (velocity.Y < num689)
					{
						velocity.Y += num687;
						if (velocity.Y < 0f && num689 > 0f)
						{
							velocity.Y += num687;
						}
					}
					else if (velocity.Y > num689)
					{
						velocity.Y -= num687;
						if (velocity.Y > 0f && num689 < 0f)
						{
							velocity.Y -= num687;
						}
					}
				}
				else if (num690 > 100f)
				{
					TargetClosest();
					spriteDirection = direction;
					num690 = num686 / num690;
					if (velocity.X < num688)
					{
						velocity.X += num687;
						if (velocity.X < 0f && num688 > 0f)
						{
							velocity.X += num687 * 2f;
						}
					}
					else if (velocity.X > num688)
					{
						velocity.X -= num687;
						if (velocity.X > 0f && num688 < 0f)
						{
							velocity.X -= num687 * 2f;
						}
					}
					if (velocity.Y < num689)
					{
						velocity.Y += num687;
						if (velocity.Y < 0f && num689 > 0f)
						{
							velocity.Y += num687 * 2f;
						}
					}
					else if (velocity.Y > num689)
					{
						velocity.Y -= num687;
						if (velocity.Y > 0f && num689 < 0f)
						{
							velocity.Y -= num687 * 2f;
						}
					}
				}
				float num701 = 20f;
				num701 -= 5f * num656;
				if (this.ai[1] > (float)num691 * num701)
				{
					this.ai[0] = -1f;
					this.ai[1] = 3f;
					netUpdate = true;
				}
			}
			else if (this.ai[0] == 4f)
			{
				localAI[0] = 1f;
				float num702 = 14f;
				float num703 = 14f;
				Vector2 vector82 = Main.player[target].Center - base.Center;
				vector82.Normalize();
				vector82 *= num702;
				velocity = (velocity * num703 + vector82) / (num703 + 1f);
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
				spriteDirection = direction;
				if (num657 < 2000f)
				{
					this.ai[0] = -1f;
					localAI[0] = 0f;
				}
			}
		}
		else if (aiStyle == 44)
		{
			noGravity = true;
			if (collideX)
			{
				if (oldVelocity.X > 0f)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
				velocity.X = direction;
			}
			if (collideY)
			{
				if (oldVelocity.Y > 0f)
				{
					directionY = -1;
				}
				else
				{
					directionY = 1;
				}
				velocity.Y = directionY;
			}
			if (type == 587)
			{
				position += netOffset;
				if (alpha == 255)
				{
					velocity.Y = -6f;
					netUpdate = true;
					for (int num704 = 0; num704 < 15; num704++)
					{
						Dust dust4 = Dust.NewDustDirect(position, width, height, 5);
						Dust dust = dust4;
						dust.velocity *= 0.5f;
						dust4.scale = 1f + Main.rand.NextFloat() * 0.5f;
						dust4.fadeIn = 1.5f + Main.rand.NextFloat() * 0.5f;
						dust = dust4;
						dust.velocity += velocity * 0.5f;
					}
				}
				alpha -= 15;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (alpha != 0)
				{
					for (int num705 = 0; num705 < 2; num705++)
					{
						Dust dust5 = Dust.NewDustDirect(position, width, height, 5);
						Dust dust = dust5;
						dust.velocity *= 1f;
						dust5.scale = 1f + Main.rand.NextFloat() * 0.5f;
						dust5.fadeIn = 1.5f + Main.rand.NextFloat() * 0.5f;
						dust = dust5;
						dust.velocity += velocity * 0.3f;
					}
				}
				if (Main.rand.Next(3) == 0)
				{
					Dust dust6 = Dust.NewDustDirect(position, width, height, 5);
					Dust dust = dust6;
					dust.velocity *= 0f;
					dust6.alpha = 120;
					dust6.scale = 0.7f + Main.rand.NextFloat() * 0.5f;
					dust = dust6;
					dust.velocity += velocity * 0.3f;
				}
				position -= netOffset;
			}
			int num706 = target;
			int num707 = direction;
			if (target == 255 || (type != 587 && Main.player[target].wet) || Main.player[target].dead || Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
			{
				this.ai[0] = 90f;
				TargetClosest();
			}
			else if (this.ai[0] > 0f)
			{
				this.ai[0] -= 1f;
				TargetClosest();
			}
			if (netUpdate && num706 == target && num707 == direction)
			{
				netUpdate = false;
			}
			float num708 = 0.05f;
			float num709 = 0.01f;
			float num710 = 3f;
			float num711 = 1f;
			float num712 = 30f;
			float num713 = 100f;
			float num714 = Math.Abs(position.X + (float)(width / 2) - (Main.player[target].position.X + (float)(Main.player[target].width / 2)));
			float num715 = Main.player[target].position.Y - (float)(height / 2);
			if (type == 509)
			{
				num708 = 0.08f;
				num709 = 0.03f;
				num710 = 4.5f;
				num711 = 2f;
				num712 = 40f;
				num713 = 150f;
				num715 = Main.player[target].Center.Y - (float)(height / 2);
				rotation = velocity.X * 0.1f;
				for (int num716 = 0; num716 < Main.maxNPCs; num716++)
				{
					if (num716 != whoAmI && Main.npc[num716].active && Main.npc[num716].type == type && Math.Abs(position.X - Main.npc[num716].position.X) + Math.Abs(position.Y - Main.npc[num716].position.Y) < (float)width)
					{
						if (position.X < Main.npc[num716].position.X)
						{
							velocity.X -= 0.05f;
						}
						else
						{
							velocity.X += 0.05f;
						}
						if (position.Y < Main.npc[num716].position.Y)
						{
							velocity.Y -= 0.05f;
						}
						else
						{
							velocity.Y += 0.05f;
						}
					}
				}
			}
			else if (type == 581)
			{
				num708 = 0.06f;
				num709 = 0.02f;
				num710 = 4f;
				num711 = 2f;
				num712 = 40f;
				num713 = 150f;
				num715 = Main.player[target].Center.Y - (float)(height / 2);
				rotation = velocity.X * 0.1f;
				for (int num717 = 0; num717 < Main.maxNPCs; num717++)
				{
					if (num717 != whoAmI && Main.npc[num717].active && Main.npc[num717].type == type && Math.Abs(position.X - Main.npc[num717].position.X) + Math.Abs(position.Y - Main.npc[num717].position.Y) < (float)width)
					{
						if (position.X < Main.npc[num717].position.X)
						{
							velocity.X -= 0.05f;
						}
						else
						{
							velocity.X += 0.05f;
						}
						if (position.Y < Main.npc[num717].position.Y)
						{
							velocity.Y -= 0.05f;
						}
						else
						{
							velocity.Y += 0.05f;
						}
					}
				}
			}
			else if (type == 587)
			{
				num708 = 0.13f;
				num709 = 0.09f;
				num710 = 6.5f;
				num711 = 3.5f;
				num712 = 0f;
				num713 = 250f;
				num715 = Main.player[target].position.Y;
				if (Main.dayTime)
				{
					num715 = 0f;
					direction *= -1;
				}
			}
			if (this.ai[0] <= 0f)
			{
				num710 *= 0.8f;
				num708 *= 0.7f;
				num715 = base.Center.Y + (float)(directionY * 1000);
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else if (velocity.X > 0f || direction == 0)
				{
					direction = 1;
				}
			}
			if (num714 > num712)
			{
				if (direction == -1 && velocity.X > 0f - num710)
				{
					velocity.X -= num708;
					if (velocity.X > num710)
					{
						velocity.X -= num708;
					}
					else if (velocity.X > 0f)
					{
						velocity.X -= num708 / 2f;
					}
					if (velocity.X < 0f - num710)
					{
						velocity.X = 0f - num710;
					}
				}
				else if (direction == 1 && velocity.X < num710)
				{
					velocity.X += num708;
					if (velocity.X < 0f - num710)
					{
						velocity.X += num708;
					}
					else if (velocity.X < 0f)
					{
						velocity.X += num708 / 2f;
					}
					if (velocity.X > num710)
					{
						velocity.X = num710;
					}
				}
			}
			if (num714 > num713)
			{
				num715 -= num713 / 2f;
			}
			if (position.Y < num715)
			{
				velocity.Y += num709;
				if (velocity.Y < 0f)
				{
					velocity.Y += num709;
				}
			}
			else
			{
				velocity.Y -= num709;
				if (velocity.Y > 0f)
				{
					velocity.Y -= num709;
				}
			}
			if (velocity.Y < 0f - num711)
			{
				velocity.Y = 0f - num711;
			}
			if (velocity.Y > num711)
			{
				velocity.Y = num711;
			}
			if (type != 587 && wet)
			{
				if (velocity.Y > 0f)
				{
					velocity.Y *= 0.95f;
				}
				velocity.Y -= 0.5f;
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
			}
		}
		else if (aiStyle == 45)
		{
			AI_045_Golem();
		}
		else if (aiStyle == 46)
		{
			float num718 = GetMyBalance();
			if (Main.getGoodWorld)
			{
				num718 += 3f;
			}
			if ((!Main.player[target].ZoneLihzhardTemple && !Main.player[target].ZoneJungle) || (double)Main.player[target].Center.Y < Main.worldSurface * 16.0)
			{
				num718 *= 2f;
			}
			noTileCollide = true;
			if (golemBoss < 0)
			{
				StrikeNPCNoInteraction(9999, 0f, 0);
				return;
			}
			float num719 = 100f;
			Vector2 vector83 = new Vector2(base.Center.X, base.Center.Y);
			float num720 = Main.npc[golemBoss].Center.X - vector83.X;
			float num721 = Main.npc[golemBoss].Center.Y - vector83.Y;
			num721 -= 57f * scale;
			num720 -= 3f * scale;
			float num722 = (float)Math.Sqrt(num720 * num720 + num721 * num721);
			if (num722 < num719)
			{
				rotation = 0f;
				velocity.X = num720;
				velocity.Y = num721;
			}
			else
			{
				num722 = num719 / num722;
				velocity.X = num720 * num722;
				velocity.Y = num721 * num722;
				rotation = velocity.X * 0.1f;
			}
			if (alpha > 0)
			{
				alpha -= 10;
				if (alpha < 0)
				{
					alpha = 0;
				}
				this.ai[1] = 30f;
			}
			if (this.ai[0] == 0f)
			{
				this.ai[1] += 1f;
				int num723 = 300;
				if (this.ai[1] < 20f || this.ai[1] > (float)(num723 - 20))
				{
					this.ai[1] += 2f * (num718 - 1f) / 3f;
					localAI[0] = 1f;
				}
				else
				{
					this.ai[1] += 1f * (num718 - 1f) / 2f;
					localAI[0] = 0f;
				}
				if (this.ai[1] >= (float)num723)
				{
					TargetClosest();
					this.ai[1] = 0f;
					Vector2 vector84 = new Vector2(base.Center.X, base.Center.Y + 10f * scale);
					float num724 = 8f;
					float num725 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector84.X;
					float num726 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector84.Y;
					float num727 = (float)Math.Sqrt(num725 * num725 + num726 * num726);
					num727 = num724 / num727;
					num725 *= num727;
					num726 *= num727;
					int num728 = 18;
					int num729 = 258;
					if (Main.netMode != 1)
					{
						int num730 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector84.X, vector84.Y, num725, num726, num729, num728, 0f, Main.myPlayer);
					}
				}
			}
			else if (this.ai[0] == 1f)
			{
				TargetClosest();
				Vector2 vector85 = new Vector2(base.Center.X, base.Center.Y + 10f * scale);
				if (Main.player[target].Center.X < base.Center.X - (float)width)
				{
					localAI[1] = -1f;
					vector85.X -= 40f * scale;
				}
				else if (Main.player[target].Center.X > base.Center.X + (float)width)
				{
					localAI[1] = 1f;
					vector85.X += 40f * scale;
				}
				else
				{
					localAI[1] = 0f;
				}
				float num731 = (num718 + 3f) / 4f;
				this.ai[1] += num731;
				if ((double)life < (double)lifeMax * 0.4)
				{
					this.ai[1] += num731;
				}
				if ((double)life < (double)lifeMax * 0.2)
				{
					this.ai[1] += num731;
				}
				int num732 = 300;
				if (this.ai[1] < 20f || this.ai[1] > (float)(num732 - 20))
				{
					localAI[0] = 1f;
				}
				else
				{
					localAI[0] = 0f;
				}
				if (this.ai[1] >= (float)num732)
				{
					TargetClosest();
					this.ai[1] = 0f;
					float num733 = 8f;
					float num734 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector85.X;
					float num735 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector85.Y;
					float num736 = (float)Math.Sqrt(num734 * num734 + num735 * num735);
					num736 = num733 / num736;
					num734 *= num736;
					num735 *= num736;
					int num737 = 24;
					int num738 = 258;
					if (Main.netMode != 1)
					{
						int num739 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector85.X, vector85.Y, num734, num735, num738, num737, 0f, Main.myPlayer);
					}
				}
				this.ai[2] += num731;
				if (life < lifeMax / 3)
				{
					this.ai[2] += num731;
				}
				if (life < lifeMax / 4)
				{
					this.ai[2] += num731;
				}
				if (life < lifeMax / 5)
				{
					this.ai[2] += num731;
				}
				if (!Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
				{
					this.ai[2] += 4f;
				}
				if (this.ai[2] > (float)(60 + Main.rand.Next(600)))
				{
					this.ai[2] = 0f;
					int num740 = 28;
					int num741 = 259;
					if (localAI[1] == 0f)
					{
						for (int num742 = 0; num742 < 2; num742++)
						{
							vector85 = new Vector2(base.Center.X, base.Center.Y - 22f * scale);
							if (num742 == 0)
							{
								vector85.X -= 18f * scale;
							}
							else
							{
								vector85.X += 18f * scale;
							}
							float num743 = 11f;
							float num744 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector85.X;
							float num745 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector85.Y;
							float num746 = (float)Math.Sqrt(num744 * num744 + num745 * num745);
							num746 = num743 / num746;
							num744 *= num746;
							num745 *= num746;
							vector85.X += num744 * 3f;
							vector85.Y += num745 * 3f;
							if (Main.netMode != 1)
							{
								int num747 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector85.X, vector85.Y, num744, num745, num741, num740, 0f, Main.myPlayer);
								Main.projectile[num747].timeLeft = 300;
							}
						}
					}
					else if (localAI[1] != 0f)
					{
						vector85 = new Vector2(base.Center.X, base.Center.Y - 22f * scale);
						if (localAI[1] == -1f)
						{
							vector85.X -= 30f * scale;
						}
						else if (localAI[1] == 1f)
						{
							vector85.X += 30f * scale;
						}
						float num748 = 12f;
						float num749 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector85.X;
						float num750 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector85.Y;
						float num751 = (float)Math.Sqrt(num749 * num749 + num750 * num750);
						num751 = num748 / num751;
						num749 *= num751;
						num750 *= num751;
						vector85.X += num749 * 3f;
						vector85.Y += num750 * 3f;
						if (Main.netMode != 1)
						{
							int num752 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector85.X, vector85.Y, num749, num750, num741, num740, 0f, Main.myPlayer);
							Main.projectile[num752].timeLeft = 300;
						}
					}
				}
			}
			if (life < lifeMax / 2)
			{
				this.ai[0] = 1f;
			}
			else
			{
				this.ai[0] = 0f;
			}
		}
		else if (aiStyle == 47)
		{
			AI_047_GolemFist();
		}
		else if (aiStyle == 48)
		{
			bool flag48 = false;
			float num753 = GetMyBalance();
			if (Main.getGoodWorld)
			{
				num753 += 3f;
			}
			if ((!Main.player[target].ZoneLihzhardTemple && !Main.player[target].ZoneJungle) || (double)Main.player[target].Center.Y < Main.worldSurface * 16.0)
			{
				num753 *= 2f;
			}
			if (!Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
			{
				noTileCollide = true;
				flag48 = true;
			}
			else if (noTileCollide && Collision.SolidTiles(position, width, height))
			{
				noTileCollide = false;
			}
			if (golemBoss < 0)
			{
				StrikeNPCNoInteraction(9999, 0f, 0);
				return;
			}
			TargetClosest();
			float num754 = 7f;
			float num755 = 0.05f;
			Vector2 vector86 = new Vector2(base.Center.X, base.Center.Y);
			float num756 = Main.player[target].Center.X - vector86.X;
			float num757 = Main.player[target].Center.Y - vector86.Y - 300f;
			float num758 = (float)Math.Sqrt(num756 * num756 + num757 * num757);
			num758 = num754 / num758;
			num756 *= num758;
			num757 *= num758;
			if (velocity.X < num756)
			{
				velocity.X += num755;
				if (velocity.X < 0f && num756 > 0f)
				{
					velocity.X += num755;
				}
			}
			else if (velocity.X > num756)
			{
				velocity.X -= num755;
				if (velocity.X > 0f && num756 < 0f)
				{
					velocity.X -= num755;
				}
			}
			if (velocity.Y < num757)
			{
				velocity.Y += num755;
				if (velocity.Y < 0f && num757 > 0f)
				{
					velocity.Y += num755;
				}
			}
			else if (velocity.Y > num757)
			{
				velocity.Y -= num755;
				if (velocity.Y > 0f && num757 < 0f)
				{
					velocity.Y -= num755;
				}
			}
			float num759 = (num753 + 4f) / 5f;
			this.ai[1] += num759;
			if ((double)Main.npc[golemBoss].life < (double)Main.npc[golemBoss].lifeMax * 0.8)
			{
				this.ai[1] += num759;
			}
			if ((double)Main.npc[golemBoss].life < (double)Main.npc[golemBoss].lifeMax * 0.6)
			{
				this.ai[1] += num759;
			}
			if ((double)Main.npc[golemBoss].life < (double)Main.npc[golemBoss].lifeMax * 0.2)
			{
				this.ai[1] += num759;
			}
			if ((double)Main.npc[golemBoss].life < (double)Main.npc[golemBoss].lifeMax * 0.1)
			{
				this.ai[1] += num759;
			}
			int num760 = 300;
			if (this.ai[1] < 20f || this.ai[1] > (float)(num760 - 20))
			{
				localAI[0] = 1f;
			}
			else
			{
				localAI[0] = 0f;
			}
			if (flag48)
			{
				this.ai[1] = 20f;
			}
			if (this.ai[1] >= (float)num760)
			{
				TargetClosest();
				this.ai[1] = 0f;
				Vector2 vector87 = new Vector2(base.Center.X, base.Center.Y - 10f * scale);
				float num761 = 8f;
				int num762 = 20;
				int num763 = 258;
				float num764 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector87.X;
				float num765 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector87.Y;
				float num766 = (float)Math.Sqrt(num764 * num764 + num765 * num765);
				num766 = num761 / num766;
				num764 *= num766;
				num765 *= num766;
				if (Main.netMode != 1)
				{
					int num767 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector87.X, vector87.Y, num764, num765, num763, num762, 0f, Main.myPlayer);
				}
			}
			float num768 = num753;
			this.ai[2] += num768;
			if ((double)Main.npc[golemBoss].life < (double)Main.npc[golemBoss].lifeMax / 1.25)
			{
				this.ai[2] += num768;
			}
			if ((double)Main.npc[golemBoss].life < (double)Main.npc[golemBoss].lifeMax / 1.5)
			{
				this.ai[2] += num768;
			}
			if (Main.npc[golemBoss].life < Main.npc[golemBoss].lifeMax / 2)
			{
				this.ai[2] += num768;
			}
			if (Main.npc[golemBoss].life < Main.npc[golemBoss].lifeMax / 3)
			{
				this.ai[2] += num768;
			}
			if (Main.npc[golemBoss].life < Main.npc[golemBoss].lifeMax / 4)
			{
				this.ai[2] += num768;
			}
			if (Main.npc[golemBoss].life < Main.npc[golemBoss].lifeMax / 5)
			{
				this.ai[2] += num768;
			}
			if (Main.npc[golemBoss].life < Main.npc[golemBoss].lifeMax / 6)
			{
				this.ai[2] += num768;
			}
			bool flag49 = false;
			if (!Collision.CanHit(Main.npc[golemBoss].Center, 1, 1, Main.player[target].Center, 1, 1))
			{
				flag49 = true;
			}
			if (flag49)
			{
				this.ai[2] += num768 * 10f;
			}
			if (this.ai[2] > (float)(100 + Main.rand.Next(4800)))
			{
				this.ai[2] = 0f;
				for (int num769 = 0; num769 < 2; num769++)
				{
					Vector2 vector88 = new Vector2(base.Center.X, base.Center.Y - 50f * scale);
					switch (num769)
					{
					case 0:
						vector88.X -= 14f * scale;
						break;
					case 1:
						vector88.X += 14f * scale;
						break;
					}
					float num770 = 11f;
					int num771 = 24;
					int num772 = 259;
					if ((double)Main.npc[golemBoss].life < (double)Main.npc[golemBoss].lifeMax * 0.5)
					{
						num771++;
						num770 += 0.25f;
					}
					if ((double)Main.npc[golemBoss].life < (double)Main.npc[golemBoss].lifeMax * 0.4)
					{
						num771++;
						num770 += 0.25f;
					}
					if ((double)Main.npc[golemBoss].life < (double)Main.npc[golemBoss].lifeMax * 0.3)
					{
						num771++;
						num770 += 0.25f;
					}
					if ((double)Main.npc[golemBoss].life < (double)Main.npc[golemBoss].lifeMax * 0.2)
					{
						num771++;
						num770 += 0.25f;
					}
					if ((double)Main.npc[golemBoss].life < (double)Main.npc[golemBoss].lifeMax * 0.1)
					{
						num771++;
						num770 += 0.25f;
					}
					float num773 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f;
					float num774 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f;
					if (flag49)
					{
						num771 = (int)((double)num771 * 1.5);
						num770 *= 2.5f;
						num773 += Main.player[target].velocity.X * Main.rand.NextFloat() * 50f;
						num774 += Main.player[target].velocity.Y * Main.rand.NextFloat() * 50f;
					}
					num773 -= vector88.X;
					num774 -= vector88.Y;
					float num775 = (float)Math.Sqrt(num773 * num773 + num774 * num774);
					num775 = num770 / num775;
					num773 *= num775;
					num774 *= num775;
					vector88.X += num773 * 3f;
					vector88.Y += num774 * 3f;
					if (Main.netMode != 1)
					{
						int num776 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector88.X, vector88.Y, num773, num774, num772, num771, 0f, Main.myPlayer);
						Main.projectile[num776].timeLeft = 300;
					}
				}
			}
			if (!Main.getGoodWorld)
			{
				position += netOffset;
				int num777 = Main.rand.Next(2) * 2 - 1;
				Vector2 vector89 = base.Bottom + new Vector2((float)(num777 * 22) * scale, -22f * scale);
				Dust dust7 = Dust.NewDustPerfect(vector89, 228, ((float)Math.PI / 2f + -(float)Math.PI / 2f * (float)num777 + Main.rand.NextFloatDirection() * ((float)Math.PI / 4f)).ToRotationVector2() * (2f + Main.rand.NextFloat()));
				Dust dust = dust7;
				dust.velocity += velocity;
				dust7.noGravity = true;
				dust7 = Dust.NewDustPerfect(base.Bottom + new Vector2(Main.rand.NextFloatDirection() * 6f * scale, (Main.rand.NextFloat() * -4f - 8f) * scale), 228, Vector2.UnitY * (2f + Main.rand.NextFloat()));
				dust7.fadeIn = 0f;
				dust7.scale = 0.7f + Main.rand.NextFloat() * 0.5f;
				dust7.noGravity = true;
				dust = dust7;
				dust.velocity += velocity;
				position -= netOffset;
			}
		}
		else if (aiStyle == 49)
		{
			noGravity = true;
			TargetClosest();
			float num778 = 4f;
			float num779 = 0.25f;
			Vector2 vector90 = new Vector2(base.Center.X, base.Center.Y);
			float num780 = Main.player[target].Center.X - vector90.X;
			float num781 = Main.player[target].Center.Y - vector90.Y - 200f;
			float num782 = (float)Math.Sqrt(num780 * num780 + num781 * num781);
			if (num782 < 20f)
			{
				num780 = velocity.X;
				num781 = velocity.Y;
			}
			else
			{
				num782 = num778 / num782;
				num780 *= num782;
				num781 *= num782;
			}
			if (velocity.X < num780)
			{
				velocity.X += num779;
				if (velocity.X < 0f && num780 > 0f)
				{
					velocity.X += num779 * 2f;
				}
			}
			else if (velocity.X > num780)
			{
				velocity.X -= num779;
				if (velocity.X > 0f && num780 < 0f)
				{
					velocity.X -= num779 * 2f;
				}
			}
			if (velocity.Y < num781)
			{
				velocity.Y += num779;
				if (velocity.Y < 0f && num781 > 0f)
				{
					velocity.Y += num779 * 2f;
				}
			}
			else if (velocity.Y > num781)
			{
				velocity.Y -= num779;
				if (velocity.Y > 0f && num781 < 0f)
				{
					velocity.Y -= num779 * 2f;
				}
			}
			if (position.X + (float)width > Main.player[target].position.X && position.X < Main.player[target].position.X + (float)Main.player[target].width && position.Y + (float)height < Main.player[target].position.Y && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height) && Main.netMode != 1)
			{
				this.ai[0] += 1f;
				if (this.ai[0] > 8f)
				{
					this.ai[0] = 0f;
					int num783 = (int)(position.X + 10f + (float)Main.rand.Next(width - 20));
					int num784 = (int)(position.Y + (float)height + 4f);
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), num783, num784, 0f, 5f, 264, 20, 0f, Main.myPlayer);
				}
			}
		}
		else if (aiStyle == 50)
		{
			EncourageDespawn(5);
			if (type == 261)
			{
				noTileCollide = false;
				if (collideX || collideY)
				{
					life = 0;
					HitEffect(0, 100.0);
					checkDead();
					return;
				}
			}
			else
			{
				noTileCollide = true;
			}
			velocity.Y += 0.02f;
			TargetClosest();
			if (velocity.Y < 0f && Main.player[target].position.Y > position.Y + 100f)
			{
				velocity.Y *= 0.95f;
			}
			if (velocity.Y > 1f)
			{
				velocity.Y = 1f;
			}
			if (position.X + (float)width < Main.player[target].position.X)
			{
				if (velocity.X < 0f)
				{
					velocity.X *= 0.98f;
				}
				if (Main.expertMode && velocity.X < 0f)
				{
					velocity.X *= 0.98f;
				}
				velocity.X += 0.1f;
				if (Main.expertMode)
				{
					velocity.X += 0.1f;
				}
			}
			else if (position.X > Main.player[target].position.X + (float)Main.player[target].width)
			{
				if (velocity.X > 0f)
				{
					velocity.X *= 0.98f;
				}
				if (Main.expertMode && velocity.X > 0f)
				{
					velocity.X *= 0.98f;
				}
				velocity.X -= 0.1f;
				if (Main.expertMode)
				{
					velocity.X -= 0.1f;
				}
			}
			if (velocity.X > 5f || velocity.X < -5f)
			{
				velocity.X *= 0.97f;
			}
			rotation = velocity.X * 0.2f;
		}
		else if (aiStyle == 51)
		{
			bool flag50 = false;
			bool flag51 = false;
			TargetClosest();
			if (Main.player[target].dead)
			{
				flag51 = true;
				flag50 = true;
			}
			else if (Main.netMode != 1 && target >= 0 && target < 255)
			{
				int num785 = 4800;
				if (timeLeft < activeTime && Vector2.Distance(base.Center, Main.player[target].Center) < (float)num785)
				{
					timeLeft = activeTime;
				}
			}
			plantBoss = whoAmI;
			if (localAI[0] == 0f && Main.netMode != 1)
			{
				localAI[0] = 1f;
				int num786 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y, 263, whoAmI);
				num786 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y, 263, whoAmI);
				num786 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y, 263, whoAmI);
			}
			int[] array2 = new int[3];
			float num787 = 0f;
			float num788 = 0f;
			int num789 = 0;
			for (int num790 = 0; num790 < Main.maxNPCs; num790++)
			{
				if (Main.npc[num790].active && Main.npc[num790].aiStyle == 52)
				{
					num787 += Main.npc[num790].Center.X;
					num788 += Main.npc[num790].Center.Y;
					array2[num789] = num790;
					num789++;
					if (num789 > 2)
					{
						break;
					}
				}
			}
			num787 /= (float)num789;
			num788 /= (float)num789;
			float num791 = 2.5f;
			float num792 = 0.025f;
			if (life < lifeMax / 2)
			{
				num791 = 5f;
				num792 = 0.05f;
			}
			if (life < lifeMax / 4)
			{
				num791 = 7f;
			}
			if (!Main.player[target].ZoneJungle || (double)Main.player[target].position.Y < Main.worldSurface * 16.0 || Main.player[target].position.Y > (float)(Main.UnderworldLayer * 16))
			{
				flag50 = true;
				num791 += 8f;
				num792 = 0.15f;
			}
			if (Main.expertMode)
			{
				num791 += 1f;
				num791 *= 1.1f;
				num792 += 0.01f;
				num792 *= 1.1f;
			}
			if (Main.getGoodWorld)
			{
				num791 *= 1.15f;
				num792 *= 1.15f;
			}
			Vector2 vector91 = new Vector2(num787, num788);
			float num793 = Main.player[target].Center.X - vector91.X;
			float num794 = Main.player[target].Center.Y - vector91.Y;
			if (flag51)
			{
				num794 *= -1f;
				num793 *= -1f;
				num791 += 8f;
			}
			float num795 = (float)Math.Sqrt(num793 * num793 + num794 * num794);
			int num796 = 500;
			if (flag50)
			{
				num796 += 350;
			}
			if (Main.expertMode)
			{
				num796 += 150;
			}
			if (num795 >= (float)num796)
			{
				num795 = (float)num796 / num795;
				num793 *= num795;
				num794 *= num795;
			}
			num787 += num793;
			num788 += num794;
			vector91 = new Vector2(base.Center.X, base.Center.Y);
			num793 = num787 - vector91.X;
			num794 = num788 - vector91.Y;
			num795 = (float)Math.Sqrt(num793 * num793 + num794 * num794);
			if (num795 < num791)
			{
				num793 = velocity.X;
				num794 = velocity.Y;
			}
			else
			{
				num795 = num791 / num795;
				num793 *= num795;
				num794 *= num795;
			}
			if (velocity.X < num793)
			{
				velocity.X += num792;
				if (velocity.X < 0f && num793 > 0f)
				{
					velocity.X += num792 * 2f;
				}
			}
			else if (velocity.X > num793)
			{
				velocity.X -= num792;
				if (velocity.X > 0f && num793 < 0f)
				{
					velocity.X -= num792 * 2f;
				}
			}
			if (velocity.Y < num794)
			{
				velocity.Y += num792;
				if (velocity.Y < 0f && num794 > 0f)
				{
					velocity.Y += num792 * 2f;
				}
			}
			else if (velocity.Y > num794)
			{
				velocity.Y -= num792;
				if (velocity.Y > 0f && num794 < 0f)
				{
					velocity.Y -= num792 * 2f;
				}
			}
			Vector2 vector92 = new Vector2(base.Center.X, base.Center.Y);
			float num797 = Main.player[target].Center.X - vector92.X;
			float num798 = Main.player[target].Center.Y - vector92.Y;
			rotation = (float)Math.Atan2(num798, num797) + 1.57f;
			if (life > lifeMax / 2)
			{
				defense = 36;
				int num799 = 50;
				if (flag50)
				{
					defense *= 2;
					num799 *= 2;
				}
				damage = GetAttackDamage_ScaledByDifficulty(num799);
				if (Main.netMode == 1)
				{
					return;
				}
				localAI[1] += 1f;
				if ((double)life < (double)lifeMax * 0.9)
				{
					localAI[1] += 1f;
				}
				if ((double)life < (double)lifeMax * 0.8)
				{
					localAI[1] += 1f;
				}
				if ((double)life < (double)lifeMax * 0.7)
				{
					localAI[1] += 1f;
				}
				if ((double)life < (double)lifeMax * 0.6)
				{
					localAI[1] += 1f;
				}
				if (flag50)
				{
					localAI[1] += 3f;
				}
				if (Main.expertMode)
				{
					localAI[1] += 1f;
				}
				if (Main.expertMode && justHit && Main.rand.Next(2) == 0)
				{
					localAI[3] = 1f;
				}
				if (Main.getGoodWorld)
				{
					localAI[1] += 1f;
				}
				if (!(localAI[1] > 80f))
				{
					return;
				}
				localAI[1] = 0f;
				bool flag52 = Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height);
				if (localAI[3] > 0f)
				{
					flag52 = true;
					localAI[3] = 0f;
				}
				if (flag52)
				{
					Vector2 vector93 = new Vector2(base.Center.X, base.Center.Y);
					float num800 = 15f;
					if (Main.expertMode)
					{
						num800 = 17f;
					}
					float num801 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector93.X;
					float num802 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector93.Y;
					float num803 = (float)Math.Sqrt(num801 * num801 + num802 * num802);
					num803 = num800 / num803;
					num801 *= num803;
					num802 *= num803;
					int num804 = 22;
					int num805 = 275;
					int maxValue2 = 4;
					int maxValue3 = 8;
					if (Main.expertMode)
					{
						maxValue2 = 2;
						maxValue3 = 6;
					}
					if ((double)life < (double)lifeMax * 0.8 && Main.rand.Next(maxValue2) == 0)
					{
						num804 = 27;
						localAI[1] = -30f;
						num805 = 276;
					}
					else if ((double)life < (double)lifeMax * 0.8 && Main.rand.Next(maxValue3) == 0)
					{
						num804 = 31;
						localAI[1] = -120f;
						num805 = 277;
					}
					if (flag50)
					{
						num804 *= 2;
					}
					num804 = GetAttackDamage_ForProjectiles(num804, (float)num804 * 0.9f);
					vector93.X += num801 * 3f;
					vector93.Y += num802 * 3f;
					int num806 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector93.X, vector93.Y, num801, num802, num805, num804, 0f, Main.myPlayer);
					if (num805 != 277)
					{
						Main.projectile[num806].timeLeft = 300;
					}
				}
				return;
			}
			defense = 10;
			int num807 = 70;
			if (flag50)
			{
				defense *= 4;
				num807 *= 2;
			}
			damage = GetAttackDamage_ScaledByDifficulty(num807);
			if (Main.netMode != 1)
			{
				if (localAI[0] == 1f)
				{
					localAI[0] = 2f;
					int num808 = 8;
					if (Main.getGoodWorld)
					{
						num808 += 6;
					}
					for (int num809 = 0; num809 < num808; num809++)
					{
						int num810 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y, 264, whoAmI);
					}
					if (Main.expertMode)
					{
						for (int num811 = 0; num811 < Main.maxNPCs; num811++)
						{
							if (Main.npc[num811].active && Main.npc[num811].aiStyle == 52)
							{
								for (int num812 = 0; num812 < num808 / 2 - 1; num812++)
								{
									int num813 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y, 264, whoAmI);
									Main.npc[num813].ai[3] = num811 + 1;
								}
							}
						}
					}
				}
				else if (Main.expertMode && Main.rand.Next(60) == 0)
				{
					int num814 = 0;
					for (int num815 = 0; num815 < Main.maxNPCs; num815++)
					{
						if (Main.npc[num815].active && Main.npc[num815].type == 264 && Main.npc[num815].ai[3] == 0f)
						{
							num814++;
						}
					}
					if (num814 < 8 && Main.rand.Next((num814 + 1) * 10) <= 1)
					{
						int num816 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y, 264, whoAmI);
					}
				}
			}
			if (localAI[2] == 0f)
			{
				Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 378, scale);
				Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 379, scale);
				Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 380, scale);
				localAI[2] = 1f;
			}
			if (Main.netMode == 1)
			{
				return;
			}
			localAI[1] += 1f;
			if ((double)life < (double)lifeMax * 0.4)
			{
				localAI[1] += 1f;
			}
			if ((double)life < (double)lifeMax * 0.3)
			{
				localAI[1] += 1f;
			}
			if ((double)life < (double)lifeMax * 0.2)
			{
				localAI[1] += 1f;
			}
			if ((double)life < (double)lifeMax * 0.1)
			{
				localAI[1] += 1f;
			}
			if (localAI[1] >= 350f)
			{
				float num817 = 8f;
				Vector2 vector94 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num818 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector94.X + (float)Main.rand.Next(-10, 11);
				float num819 = Math.Abs(num818 * 0.2f);
				float num820 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector94.Y + (float)Main.rand.Next(-10, 11);
				if (num820 > 0f)
				{
					num819 = 0f;
				}
				num820 -= num819;
				float num821 = (float)Math.Sqrt(num818 * num818 + num820 * num820);
				num821 = num817 / num821;
				num818 *= num821;
				num820 *= num821;
				int num822 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y, 265);
				Main.npc[num822].velocity.X = num818;
				Main.npc[num822].velocity.Y = num820;
				Main.npc[num822].netUpdate = true;
				localAI[1] = 0f;
			}
		}
		else if (aiStyle == 52)
		{
			bool flag53 = false;
			bool flag54 = false;
			if (plantBoss < 0)
			{
				StrikeNPCNoInteraction(9999, 0f, 0);
				netUpdate = true;
				return;
			}
			if (Main.player[Main.npc[plantBoss].target].dead)
			{
				flag54 = true;
			}
			if ((plantBoss != -1 && !Main.player[Main.npc[plantBoss].target].ZoneJungle) || (double)Main.player[Main.npc[plantBoss].target].position.Y < Main.worldSurface * 16.0 || Main.player[Main.npc[plantBoss].target].position.Y > (float)(Main.UnderworldLayer * 16) || flag54)
			{
				localAI[0] -= 4f;
				flag53 = true;
			}
			if (Main.netMode == 1)
			{
				if (this.ai[0] == 0f)
				{
					this.ai[0] = (int)(base.Center.X / 16f);
				}
				if (this.ai[1] == 0f)
				{
					this.ai[1] = (int)(base.Center.X / 16f);
				}
			}
			if (Main.netMode != 1)
			{
				if (this.ai[0] == 0f || this.ai[1] == 0f)
				{
					localAI[0] = 0f;
				}
				localAI[0] -= 1f;
				if (Main.npc[plantBoss].life < Main.npc[plantBoss].lifeMax / 2)
				{
					localAI[0] -= 2f;
				}
				if (Main.npc[plantBoss].life < Main.npc[plantBoss].lifeMax / 4)
				{
					localAI[0] -= 2f;
				}
				if (flag53)
				{
					localAI[0] -= 6f;
				}
				if (!flag54 && localAI[0] <= 0f && this.ai[0] != 0f)
				{
					for (int num823 = 0; num823 < Main.maxNPCs; num823++)
					{
						if (num823 != whoAmI && Main.npc[num823].active && Main.npc[num823].type == type && (Main.npc[num823].velocity.X != 0f || Main.npc[num823].velocity.Y != 0f))
						{
							localAI[0] = Main.rand.Next(60, 300);
						}
					}
				}
				if (localAI[0] <= 0f)
				{
					localAI[0] = Main.rand.Next(300, 600);
					bool flag55 = false;
					int num824 = 0;
					while (!flag55 && num824 <= 1000)
					{
						num824++;
						int num825 = (int)(Main.player[Main.npc[plantBoss].target].Center.X / 16f);
						int num826 = (int)(Main.player[Main.npc[plantBoss].target].Center.Y / 16f);
						if (this.ai[0] == 0f)
						{
							num825 = (int)((Main.player[Main.npc[plantBoss].target].Center.X + Main.npc[plantBoss].Center.X) / 32f);
							num826 = (int)((Main.player[Main.npc[plantBoss].target].Center.Y + Main.npc[plantBoss].Center.Y) / 32f);
						}
						if (flag54)
						{
							num825 = (int)Main.npc[plantBoss].position.X / 16;
							num826 = (int)(Main.npc[plantBoss].position.Y + 400f) / 16;
						}
						int num827 = 20;
						num827 += (int)(100f * ((float)num824 / 1000f));
						int num828 = num825 + Main.rand.Next(-num827, num827 + 1);
						int num829 = num826 + Main.rand.Next(-num827, num827 + 1);
						if (Main.npc[plantBoss].life < Main.npc[plantBoss].lifeMax / 2 && Main.rand.Next(6) == 0)
						{
							TargetClosest();
							int num830 = (int)(Main.player[target].Center.X / 16f);
							int num831 = (int)(Main.player[target].Center.Y / 16f);
							if (Main.tile[num830, num831].wall > 0)
							{
								num828 = num830;
								num829 = num831;
							}
						}
						try
						{
							if (WorldGen.InWorld(num828, num829) && (WorldGen.SolidTile(num828, num829) || (Main.tile[num828, num829].wall > 0 && (num824 > 500 || Main.npc[plantBoss].life < Main.npc[plantBoss].lifeMax / 2))))
							{
								flag55 = true;
								this.ai[0] = num828;
								this.ai[1] = num829;
								netUpdate = true;
							}
						}
						catch
						{
						}
					}
				}
			}
			if (!(this.ai[0] > 0f) || !(this.ai[1] > 0f))
			{
				return;
			}
			float num832 = 6f;
			if (Main.npc[plantBoss].life < Main.npc[plantBoss].lifeMax / 2)
			{
				num832 = 8f;
			}
			if (Main.npc[plantBoss].life < Main.npc[plantBoss].lifeMax / 4)
			{
				num832 = 10f;
			}
			if (Main.expertMode)
			{
				num832 += 1f;
			}
			if (Main.expertMode && Main.npc[plantBoss].life < Main.npc[plantBoss].lifeMax / 2)
			{
				num832 += 1f;
			}
			if (flag53)
			{
				num832 *= 2f;
			}
			if (flag54)
			{
				num832 *= 2f;
			}
			Vector2 vector95 = new Vector2(base.Center.X, base.Center.Y);
			float num833 = this.ai[0] * 16f - 8f - vector95.X;
			float num834 = this.ai[1] * 16f - 8f - vector95.Y;
			float num835 = (float)Math.Sqrt(num833 * num833 + num834 * num834);
			if (num835 < 12f + num832)
			{
				if (Main.netMode != 1 && Main.getGoodWorld && localAI[3] == 1f)
				{
					localAI[3] = 0f;
					WorldGen.SpawnPlanteraThorns(base.Center);
				}
				velocity.X = num833;
				velocity.Y = num834;
			}
			else
			{
				if (Main.netMode != 1 && Main.getGoodWorld)
				{
					localAI[3] = 1f;
				}
				num835 = num832 / num835;
				velocity.X = num833 * num835;
				velocity.Y = num834 * num835;
			}
			Vector2 vector96 = new Vector2(base.Center.X, base.Center.Y);
			float num836 = Main.npc[plantBoss].Center.X - vector96.X;
			float num837 = Main.npc[plantBoss].Center.Y - vector96.Y;
			rotation = (float)Math.Atan2(num837, num836) - 1.57f;
		}
		else if (aiStyle == 53)
		{
			if (Main.getGoodWorld)
			{
				if (Main.rand.Next(10) == 0)
				{
					reflectsProjectiles = true;
				}
				else
				{
					reflectsProjectiles = false;
				}
			}
			if (plantBoss < 0)
			{
				StrikeNPCNoInteraction(9999, 0f, 0);
				netUpdate = true;
				return;
			}
			int num838 = plantBoss;
			if (this.ai[3] > 0f)
			{
				num838 = (int)this.ai[3] - 1;
			}
			if (Main.netMode != 1)
			{
				localAI[0] -= 1f;
				if (localAI[0] <= 0f)
				{
					localAI[0] = Main.rand.Next(120, 480);
					this.ai[0] = Main.rand.Next(-100, 101);
					this.ai[1] = Main.rand.Next(-100, 101);
					netUpdate = true;
				}
			}
			TargetClosest();
			float num839 = 0.2f;
			float num840 = 200f;
			if ((double)Main.npc[plantBoss].life < (double)Main.npc[plantBoss].lifeMax * 0.25)
			{
				num840 += 100f;
			}
			if ((double)Main.npc[plantBoss].life < (double)Main.npc[plantBoss].lifeMax * 0.1)
			{
				num840 += 100f;
			}
			if (Main.expertMode)
			{
				float num841 = 1f - (float)life / (float)lifeMax;
				num840 += num841 * 300f;
				num839 += 0.3f;
			}
			if (Main.getGoodWorld)
			{
				num839 += 4f;
			}
			if (!Main.npc[num838].active || plantBoss < 0)
			{
				active = false;
				return;
			}
			float num842 = Main.npc[num838].position.X + (float)(Main.npc[num838].width / 2);
			float num843 = Main.npc[num838].position.Y + (float)(Main.npc[num838].height / 2);
			Vector2 vector97 = new Vector2(num842, num843);
			float num844 = num842 + this.ai[0];
			float num845 = num843 + this.ai[1];
			float num846 = num844 - vector97.X;
			float num847 = num845 - vector97.Y;
			float num848 = (float)Math.Sqrt(num846 * num846 + num847 * num847);
			num848 = num840 / num848;
			num846 *= num848;
			num847 *= num848;
			if (position.X < num842 + num846)
			{
				velocity.X += num839;
				if (velocity.X < 0f && num846 > 0f)
				{
					velocity.X *= 0.9f;
				}
			}
			else if (position.X > num842 + num846)
			{
				velocity.X -= num839;
				if (velocity.X > 0f && num846 < 0f)
				{
					velocity.X *= 0.9f;
				}
			}
			if (position.Y < num843 + num847)
			{
				velocity.Y += num839;
				if (velocity.Y < 0f && num847 > 0f)
				{
					velocity.Y *= 0.9f;
				}
			}
			else if (position.Y > num843 + num847)
			{
				velocity.Y -= num839;
				if (velocity.Y > 0f && num847 < 0f)
				{
					velocity.Y *= 0.9f;
				}
			}
			if (velocity.X > 8f)
			{
				velocity.X = 8f;
			}
			if (velocity.X < -8f)
			{
				velocity.X = -8f;
			}
			if (velocity.Y > 8f)
			{
				velocity.Y = 8f;
			}
			if (velocity.Y < -8f)
			{
				velocity.Y = -8f;
			}
			if (num846 > 0f)
			{
				spriteDirection = 1;
				rotation = (float)Math.Atan2(num847, num846);
			}
			if (num846 < 0f)
			{
				spriteDirection = -1;
				rotation = (float)Math.Atan2(num847, num846) + 3.14f;
			}
		}
		else if (aiStyle == 54)
		{
			crimsonBoss = whoAmI;
			if (Main.netMode != 1 && localAI[0] == 0f)
			{
				localAI[0] = 1f;
				int brainOfCthuluCreepersCount = GetBrainOfCthuluCreepersCount();
				for (int num849 = 0; num849 < brainOfCthuluCreepersCount; num849++)
				{
					float x2 = base.Center.X;
					float y3 = base.Center.Y;
					x2 += (float)Main.rand.Next(-width, width);
					y3 += (float)Main.rand.Next(-height, height);
					int num850 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)x2, (int)y3, 267);
					Main.npc[num850].velocity = new Vector2((float)Main.rand.Next(-30, 31) * 0.1f, (float)Main.rand.Next(-30, 31) * 0.1f);
					Main.npc[num850].netUpdate = true;
				}
			}
			if (Main.netMode != 1)
			{
				TargetClosest();
				int num851 = 6000;
				if (Math.Abs(base.Center.X - Main.player[target].Center.X) + Math.Abs(base.Center.Y - Main.player[target].Center.Y) > (float)num851)
				{
					active = false;
					life = 0;
					if (Main.netMode == 2)
					{
						NetMessage.SendData(23, -1, -1, null, whoAmI);
					}
				}
			}
			if (this.ai[0] < 0f)
			{
				if (Main.getGoodWorld)
				{
					brainOfGravity = whoAmI;
				}
				if (localAI[2] == 0f)
				{
					SoundEngine.PlaySound(3, (int)position.X, (int)position.Y);
					localAI[2] = 1f;
					Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 392);
					Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 393);
					Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 394);
					Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 395);
					for (int num852 = 0; num852 < 20; num852++)
					{
						Dust.NewDust(position, width, height, 5, (float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f);
					}
					SoundEngine.PlaySound(15, (int)position.X, (int)position.Y, 0);
				}
				dontTakeDamage = false;
				TargetClosest();
				Vector2 vector98 = new Vector2(base.Center.X, base.Center.Y);
				float num853 = Main.player[target].Center.X - vector98.X;
				float num854 = Main.player[target].Center.Y - vector98.Y;
				float num855 = (float)Math.Sqrt(num853 * num853 + num854 * num854);
				float num856 = 8f;
				num855 = num856 / num855;
				num853 *= num855;
				num854 *= num855;
				velocity.X = (velocity.X * 50f + num853) / 51f;
				velocity.Y = (velocity.Y * 50f + num854) / 51f;
				if (this.ai[0] == -1f)
				{
					if (Main.netMode != 1)
					{
						localAI[1] += 1f;
						if (justHit)
						{
							localAI[1] -= Main.rand.Next(5);
						}
						int num857 = 60 + Main.rand.Next(120);
						if (Main.netMode != 0)
						{
							num857 += Main.rand.Next(30, 90);
						}
						if (localAI[1] >= (float)num857)
						{
							localAI[1] = 0f;
							TargetClosest();
							int num858 = 0;
							Player player5 = Main.player[target];
							do
							{
								num858++;
								int num859 = (int)player5.Center.X / 16;
								int num860 = (int)player5.Center.Y / 16;
								int minValue = 10;
								int num861 = 12;
								float num862 = 16f;
								int num863 = Main.rand.Next(minValue, num861 + 1);
								int num864 = Main.rand.Next(minValue, num861 + 1);
								if (Main.rand.Next(2) == 0)
								{
									num863 *= -1;
								}
								if (Main.rand.Next(2) == 0)
								{
									num864 *= -1;
								}
								Vector2 v2 = new Vector2(num863 * 16, num864 * 16);
								if (Vector2.Dot(player5.velocity.SafeNormalize(Vector2.UnitY), v2.SafeNormalize(Vector2.UnitY)) > 0f)
								{
									v2 += v2.SafeNormalize(Vector2.Zero) * num862 * player5.velocity.Length();
								}
								num859 += (int)(v2.X / 16f);
								num860 += (int)(v2.Y / 16f);
								if (num858 > 100 || !WorldGen.SolidTile(num859, num860))
								{
									this.ai[3] = 0f;
									this.ai[0] = -2f;
									this.ai[1] = num859;
									this.ai[2] = num860;
									NetUpdateIgnoreSpamLimit();
									break;
								}
							}
							while (num858 <= 100);
						}
					}
				}
				else if (this.ai[0] == -2f)
				{
					velocity *= 0.9f;
					if (Main.netMode != 0)
					{
						this.ai[3] += 15f;
					}
					else
					{
						this.ai[3] += 25f;
					}
					if (this.ai[3] >= 255f)
					{
						this.ai[3] = 255f;
						position.X = this.ai[1] * 16f - (float)(width / 2);
						position.Y = this.ai[2] * 16f - (float)(height / 2);
						SoundEngine.PlaySound(SoundID.Item8, base.Center);
						this.ai[0] = -3f;
						NetUpdateIgnoreSpamLimit();
					}
					alpha = (int)this.ai[3];
				}
				else if (this.ai[0] == -3f)
				{
					if (Main.netMode != 0)
					{
						this.ai[3] -= 15f;
					}
					else
					{
						this.ai[3] -= 25f;
					}
					if (this.ai[3] <= 0f)
					{
						this.ai[3] = 0f;
						this.ai[0] = -1f;
						NetUpdateIgnoreSpamLimit();
					}
					alpha = (int)this.ai[3];
				}
			}
			else
			{
				TargetClosest();
				Vector2 vector99 = new Vector2(base.Center.X, base.Center.Y);
				float num865 = Main.player[target].Center.X - vector99.X;
				float num866 = Main.player[target].Center.Y - vector99.Y;
				float num867 = (float)Math.Sqrt(num865 * num865 + num866 * num866);
				float num868 = 1f;
				if (Main.getGoodWorld)
				{
					num868 *= 3f;
				}
				if (num867 < num868)
				{
					velocity.X = num865;
					velocity.Y = num866;
				}
				else
				{
					num867 = num868 / num867;
					velocity.X = num865 * num867;
					velocity.Y = num866 * num867;
				}
				if (this.ai[0] == 0f)
				{
					if (Main.netMode != 1)
					{
						int num869 = 0;
						for (int num870 = 0; num870 < Main.maxNPCs; num870++)
						{
							if (Main.npc[num870].active && Main.npc[num870].type == 267)
							{
								num869++;
							}
						}
						if (num869 == 0)
						{
							this.ai[0] = -1f;
							localAI[1] = 0f;
							alpha = 0;
							netUpdate = true;
						}
						localAI[1] += 1f;
						if (localAI[1] >= (float)(120 + Main.rand.Next(300)))
						{
							localAI[1] = 0f;
							TargetClosest();
							int num871 = 0;
							Player player6 = Main.player[target];
							do
							{
								num871++;
								int num872 = (int)player6.Center.X / 16;
								int num873 = (int)player6.Center.Y / 16;
								int minValue2 = 12;
								int num874 = 40;
								float num875 = 16f;
								int num876 = Main.rand.Next(minValue2, num874 + 1);
								int num877 = Main.rand.Next(minValue2, num874 + 1);
								if (Main.rand.Next(2) == 0)
								{
									num876 *= -1;
								}
								if (Main.rand.Next(2) == 0)
								{
									num877 *= -1;
								}
								Vector2 v3 = new Vector2(num876 * 16, num877 * 16);
								if (Vector2.Dot(player6.velocity.SafeNormalize(Vector2.UnitY), v3.SafeNormalize(Vector2.UnitY)) > 0f)
								{
									v3 += v3.SafeNormalize(Vector2.Zero) * num875 * player6.velocity.Length();
								}
								num872 += (int)(v3.X / 16f);
								num873 += (int)(v3.Y / 16f);
								if (num871 > 100 || (!WorldGen.SolidTile(num872, num873) && (num871 > 75 || Collision.CanHit(new Vector2(num872 * 16, num873 * 16), 1, 1, Main.player[target].position, Main.player[target].width, Main.player[target].height))))
								{
									this.ai[0] = 1f;
									this.ai[1] = num872;
									this.ai[2] = num873;
									netUpdate = true;
									break;
								}
							}
							while (num871 <= 100);
						}
					}
				}
				else if (this.ai[0] == 1f)
				{
					alpha += 5;
					if (alpha >= 255)
					{
						SoundEngine.PlaySound(SoundID.Item8, base.Center);
						alpha = 255;
						position.X = this.ai[1] * 16f - (float)(width / 2);
						position.Y = this.ai[2] * 16f - (float)(height / 2);
						this.ai[0] = 2f;
					}
				}
				else if (this.ai[0] == 2f)
				{
					alpha -= 5;
					if (alpha <= 0)
					{
						alpha = 0;
						this.ai[0] = 0f;
					}
				}
			}
			if (Main.player[target].dead || !Main.player[target].ZoneCrimson)
			{
				if (localAI[3] < 120f)
				{
					localAI[3]++;
				}
				if (localAI[3] > 60f)
				{
					velocity.Y += (localAI[3] - 60f) * 0.25f;
				}
				this.ai[0] = 2f;
				alpha = 10;
			}
			else if (localAI[3] > 0f)
			{
				localAI[3]--;
			}
		}
		else if (aiStyle == 55)
		{
			if (crimsonBoss < 0)
			{
				active = false;
				netUpdate = true;
				return;
			}
			if (this.ai[0] == 0f)
			{
				this.ai[1] = 0f;
				Vector2 vector100 = new Vector2(base.Center.X, base.Center.Y);
				float num878 = Main.npc[crimsonBoss].Center.X - vector100.X;
				float num879 = Main.npc[crimsonBoss].Center.Y - vector100.Y;
				float num880 = (float)Math.Sqrt(num878 * num878 + num879 * num879);
				if (num880 > 90f)
				{
					num880 = 8f / num880;
					num878 *= num880;
					num879 *= num880;
					velocity.X = (velocity.X * 15f + num878) / 16f;
					velocity.Y = (velocity.Y * 15f + num879) / 16f;
					return;
				}
				if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < 8f)
				{
					velocity.Y *= 1.05f;
					velocity.X *= 1.05f;
				}
				if (Main.netMode != 1 && ((Main.expertMode && Main.rand.Next(100) == 0) || Main.rand.Next(200) == 0))
				{
					TargetClosest();
					vector100 = new Vector2(base.Center.X, base.Center.Y);
					num878 = Main.player[target].Center.X - vector100.X;
					num879 = Main.player[target].Center.Y - vector100.Y;
					num880 = (float)Math.Sqrt(num878 * num878 + num879 * num879);
					num880 = 8f / num880;
					velocity.X = num878 * num880;
					velocity.Y = num879 * num880;
					this.ai[0] = 1f;
					netUpdate = true;
				}
				return;
			}
			if (Main.expertMode)
			{
				Vector2 vector101 = Main.player[target].Center - base.Center;
				vector101.Normalize();
				if (Main.getGoodWorld)
				{
					vector101 *= 12f;
					velocity = (velocity * 49f + vector101) / 50f;
				}
				else
				{
					vector101 *= 9f;
					velocity = (velocity * 99f + vector101) / 100f;
				}
			}
			Vector2 vector102 = new Vector2(base.Center.X, base.Center.Y);
			float num881 = Main.npc[crimsonBoss].Center.X - vector102.X;
			float num882 = Main.npc[crimsonBoss].Center.Y - vector102.Y;
			float num883 = (float)Math.Sqrt(num881 * num881 + num882 * num882);
			if (num883 > 700f)
			{
				this.ai[0] = 0f;
			}
			else
			{
				if (!justHit)
				{
					return;
				}
				if (knockBackResist == 0f)
				{
					this.ai[1] += 1f;
					if (this.ai[1] > 5f)
					{
						this.ai[0] = 0f;
					}
				}
				else
				{
					this.ai[0] = 0f;
				}
			}
		}
		else if (aiStyle == 56)
		{
			TargetClosest();
			Vector2 vector103 = new Vector2(base.Center.X, base.Center.Y);
			float num884 = Main.player[target].Center.X - vector103.X;
			float num885 = Main.player[target].Center.Y - vector103.Y;
			float num886 = (float)Math.Sqrt(num884 * num884 + num885 * num885);
			float num887 = 12f;
			num886 = num887 / num886;
			num884 *= num886;
			num885 *= num886;
			velocity.X = (velocity.X * 100f + num884) / 101f;
			velocity.Y = (velocity.Y * 100f + num885) / 101f;
			rotation = (float)Math.Atan2(num885, num884) - 1.57f;
			position += netOffset;
			int num888 = Dust.NewDust(position, width, height, 180);
			Dust dust = Main.dust[num888];
			dust.velocity *= 0.1f;
			Main.dust[num888].scale = 1.3f;
			Main.dust[num888].noGravity = true;
			position -= netOffset;
		}
		else if (aiStyle == 57)
		{
			float num889 = 2f;
			noGravity = true;
			noTileCollide = true;
			if (!Main.dayTime)
			{
				TargetClosest();
			}
			bool flag56 = false;
			if ((double)life < (double)lifeMax * 0.75)
			{
				num889 = 3f;
			}
			if ((double)life < (double)lifeMax * 0.5)
			{
				num889 = 4f;
			}
			if (type == 344)
			{
				Lighting.AddLight(base.Bottom + new Vector2(0f, -30f), 0.3f, 0.16f, 0.125f);
			}
			if (type == 325)
			{
				Lighting.AddLight(base.Bottom + new Vector2(0f, -30f), 0.3f, 0.125f, 0.06f);
			}
			if (Main.dayTime)
			{
				EncourageDespawn(10);
				num889 = 8f;
			}
			else if (this.ai[0] == 0f)
			{
				this.ai[1] += 1f;
				if ((double)life < (double)lifeMax * 0.5)
				{
					this.ai[1] += 1f;
				}
				if ((double)life < (double)lifeMax * 0.25)
				{
					this.ai[1] += 1f;
				}
				if (this.ai[1] >= 300f && Main.netMode != 1)
				{
					this.ai[1] = 0f;
					if ((double)life < (double)lifeMax * 0.25 && type != 344)
					{
						this.ai[0] = Main.rand.Next(3, 5);
					}
					else
					{
						this.ai[0] = Main.rand.Next(1, 3);
					}
					netUpdate = true;
				}
			}
			else if (this.ai[0] == 1f)
			{
				if (type == 344)
				{
					if (Main.rand.Next(5) == 0)
					{
						int num890 = Dust.NewDust(position + Main.rand.NextVector2Square(0f, 1f) * base.Size - new Vector2(1f, 2f), 10, 14, 245, 0f, 0f, 254, Color.Transparent, 0.25f);
						Dust dust = Main.dust[num890];
						dust.velocity *= 0.2f;
					}
					flag56 = true;
					this.ai[1] += 1f;
					if (this.ai[1] % 5f == 0f)
					{
						Vector2 vector104 = new Vector2(position.X + 20f + (float)Main.rand.Next(width - 40), position.Y + 20f + (float)Main.rand.Next(height - 40));
						float num891 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector104.X;
						float num892 = Main.player[target].position.Y - vector104.Y;
						num891 += (float)Main.rand.Next(-50, 51);
						num892 += (float)Main.rand.Next(-50, 51);
						num892 -= Math.Abs(num891) * ((float)Main.rand.Next(0, 21) * 0.01f);
						float num893 = (float)Math.Sqrt(num891 * num891 + num892 * num892);
						float num894 = 12.5f;
						num893 = num894 / num893;
						num891 *= num893;
						num892 *= num893;
						num891 *= 1f + (float)Main.rand.Next(-20, 21) * 0.02f;
						num892 *= 1f + (float)Main.rand.Next(-20, 21) * 0.02f;
						int num895 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector104.X, vector104.Y, num891, num892, 345, 43, 0f, Main.myPlayer, Main.rand.Next(0, 31));
					}
					if (this.ai[1] >= 180f)
					{
						this.ai[1] = 0f;
						this.ai[0] = 0f;
					}
				}
				else
				{
					flag56 = true;
					this.ai[1] += 1f;
					if (this.ai[1] % 15f == 0f)
					{
						Vector2 vector105 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f + 30f);
						float num896 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector105.X;
						float num897 = Main.player[target].position.Y - vector105.Y;
						float num898 = (float)Math.Sqrt(num896 * num896 + num897 * num897);
						float num899 = 10f;
						num898 = num899 / num898;
						num896 *= num898;
						num897 *= num898;
						num896 *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
						num897 *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
						int num900 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector105.X, vector105.Y, num896, num897, 325, 50, 0f, Main.myPlayer);
					}
					if (this.ai[1] >= 120f)
					{
						this.ai[1] = 0f;
						this.ai[0] = 0f;
					}
				}
			}
			else if (this.ai[0] == 2f)
			{
				if (type == 344)
				{
					flag56 = true;
					this.ai[1] += 1f;
					if (this.ai[1] > 60f && this.ai[1] < 240f && this.ai[1] % 15f == 0f)
					{
						float num901 = 4.5f;
						Vector2 vector106 = new Vector2(position.X + 20f + (float)Main.rand.Next(width - 40), position.Y + 60f + (float)Main.rand.Next(height - 80));
						float num902 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector106.X;
						float num903 = Main.player[target].position.Y - vector106.Y;
						num903 -= Math.Abs(num902) * 0.3f;
						num901 += Math.Abs(num902) * 0.004f;
						num902 += (float)Main.rand.Next(-50, 51);
						num903 -= (float)Main.rand.Next(50, 201);
						float num904 = (float)Math.Sqrt(num902 * num902 + num903 * num903);
						num904 = num901 / num904;
						num902 *= num904;
						num903 *= num904;
						num902 *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
						num903 *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
						int num905 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector106.X, vector106.Y, num902, num903, 346, 57, 0f, Main.myPlayer, 0f, Main.rand.Next(2));
					}
					if (this.ai[1] >= 300f)
					{
						this.ai[1] = 0f;
						this.ai[0] = 0f;
					}
				}
				else
				{
					flag56 = true;
					this.ai[1] += 1f;
					if (this.ai[1] > 60f && this.ai[1] < 240f && this.ai[1] % 8f == 0f)
					{
						float num906 = 10f;
						Vector2 vector107 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f + 30f);
						float num907 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector107.X;
						float num908 = Main.player[target].position.Y - vector107.Y;
						num908 -= Math.Abs(num907) * 0.3f;
						num906 += Math.Abs(num907) * 0.004f;
						if (num906 > 14f)
						{
							num906 = 14f;
						}
						num907 += (float)Main.rand.Next(-50, 51);
						num908 -= (float)Main.rand.Next(50, 201);
						float num909 = (float)Math.Sqrt(num907 * num907 + num908 * num908);
						num909 = num906 / num909;
						num907 *= num909;
						num908 *= num909;
						num907 *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
						num908 *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
						int num910 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector107.X, vector107.Y, num907, num908, Main.rand.Next(326, 329), 40, 0f, Main.myPlayer);
					}
					if (this.ai[1] >= 300f)
					{
						this.ai[1] = 0f;
						this.ai[0] = 0f;
					}
				}
			}
			else if (this.ai[0] == 3f)
			{
				num889 = 4f;
				this.ai[1] += 1f;
				if (this.ai[1] % 30f == 0f)
				{
					Vector2 vector108 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f + 30f);
					float num911 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector108.X;
					float num912 = Main.player[target].position.Y - vector108.Y;
					float num913 = (float)Math.Sqrt(num911 * num911 + num912 * num912);
					float num914 = 16f;
					num913 = num914 / num913;
					num911 *= num913;
					num912 *= num913;
					num911 *= 1f + (float)Main.rand.Next(-20, 21) * 0.001f;
					num912 *= 1f + (float)Main.rand.Next(-20, 21) * 0.001f;
					int num915 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector108.X, vector108.Y, num911, num912, 325, 75, 0f, Main.myPlayer);
				}
				if (this.ai[1] >= 120f)
				{
					this.ai[1] = 0f;
					this.ai[0] = 0f;
				}
			}
			else if (this.ai[0] == 4f)
			{
				num889 = 4f;
				this.ai[1] += 1f;
				if (this.ai[1] % 10f == 0f)
				{
					float num916 = 12f;
					Vector2 vector109 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f + 30f);
					float num917 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector109.X;
					float num918 = Main.player[target].position.Y - vector109.Y;
					num918 -= Math.Abs(num917) * 0.2f;
					num916 += Math.Abs(num917) * 0.002f;
					if (num916 > 16f)
					{
						num916 = 16f;
					}
					num917 += (float)Main.rand.Next(-50, 51);
					num918 -= (float)Main.rand.Next(50, 201);
					float num919 = (float)Math.Sqrt(num917 * num917 + num918 * num918);
					num919 = num916 / num919;
					num917 *= num919;
					num918 *= num919;
					num917 *= 1f + (float)Main.rand.Next(-30, 31) * 0.005f;
					num918 *= 1f + (float)Main.rand.Next(-30, 31) * 0.005f;
					int num920 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector109.X, vector109.Y, num917, num918, Main.rand.Next(326, 329), 50, 0f, Main.myPlayer);
				}
				if (this.ai[1] >= 240f)
				{
					this.ai[1] = 0f;
					this.ai[0] = 0f;
				}
			}
			if (Math.Abs(base.Center.X - Main.player[target].Center.X) < 50f)
			{
				flag56 = true;
			}
			if (flag56)
			{
				velocity.X *= 0.9f;
				if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
				{
					velocity.X = 0f;
				}
			}
			else
			{
				if (direction > 0)
				{
					velocity.X = (velocity.X * 20f + num889) / 21f;
				}
				if (direction < 0)
				{
					velocity.X = (velocity.X * 20f - num889) / 21f;
				}
			}
			int num921 = 80;
			int num922 = 20;
			Vector2 vector110 = new Vector2(base.Center.X - (float)(num921 / 2), position.Y + (float)height - (float)num922);
			bool flag57 = false;
			if (position.X < Main.player[target].position.X && position.X + (float)width > Main.player[target].position.X + (float)Main.player[target].width && position.Y + (float)height < Main.player[target].position.Y + (float)Main.player[target].height - 16f)
			{
				flag57 = true;
			}
			if (flag57)
			{
				velocity.Y += 0.5f;
			}
			else if (Collision.SolidCollision(vector110, num921, num922))
			{
				if (velocity.Y > 0f)
				{
					velocity.Y = 0f;
				}
				if ((double)velocity.Y > -0.2)
				{
					velocity.Y -= 0.025f;
				}
				else
				{
					velocity.Y -= 0.2f;
				}
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
			}
			else
			{
				if (velocity.Y < 0f)
				{
					velocity.Y = 0f;
				}
				if ((double)velocity.Y < 0.1)
				{
					velocity.Y += 0.025f;
				}
				else
				{
					velocity.Y += 0.5f;
				}
			}
			if (velocity.Y > 10f)
			{
				velocity.Y = 10f;
			}
		}
		else if (aiStyle == 58)
		{
			localAI[0]++;
			if (localAI[0] > 6f)
			{
				localAI[0] = 0f;
				localAI[1]++;
				if (localAI[1] > 4f)
				{
					localAI[1] = 0f;
				}
			}
			Player player7 = Main.player[target];
			if (type == 327)
			{
				Lighting.AddLight(base.Center, 0.4f, 0.4f, 0.2f);
			}
			if (Main.netMode != 1)
			{
				localAI[2]++;
				if (localAI[2] > 300f)
				{
					localAI[2] = 0f;
					this.ai[3] = Main.rand.Next(3);
					netUpdate = true;
				}
				else if (this.ai[3] == 0f && localAI[2] % 30f == 0f && localAI[2] > 30f)
				{
					int num923 = 5;
					Vector2 vector111 = new Vector2(base.Center.X, base.Center.Y + 30f);
					if (!WorldGen.SolidTile((int)vector111.X / 16, (int)vector111.Y / 16))
					{
						float num924 = player7.Center.X - vector111.X;
						float num925 = player7.Top.Y - vector111.Y;
						num924 += (float)Main.rand.Next(-50, 51);
						num925 += (float)Main.rand.Next(50, 201);
						num925 *= 0.2f;
						float num926 = (float)Math.Sqrt(num924 * num924 + num925 * num925);
						num926 = (float)num923 / num926;
						num924 *= num926;
						num925 *= num926;
						num924 *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
						num925 *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector111.X, vector111.Y, num924, num925, Main.rand.Next(326, 329), 40, 0f, Main.myPlayer);
					}
				}
			}
			if (this.ai[0] == 0f && Main.netMode != 1)
			{
				TargetClosest();
				player7 = Main.player[target];
				this.ai[0] = 1f;
				netUpdate = true;
				int num927 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y, 328, whoAmI);
				Main.npc[num927].ai[0] = -1f;
				Main.npc[num927].ai[1] = whoAmI;
				Main.npc[num927].target = target;
				Main.npc[num927].netUpdate = true;
				num927 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y, 328, whoAmI);
				Main.npc[num927].ai[0] = 1f;
				Main.npc[num927].ai[1] = whoAmI;
				Main.npc[num927].ai[3] = 150f;
				Main.npc[num927].target = target;
				Main.npc[num927].netUpdate = true;
			}
			if (Main.player[target].dead || Math.Abs(position.X - Main.player[target].position.X) > 2000f || Math.Abs(position.Y - Main.player[target].position.Y) > 2000f)
			{
				TargetClosest();
				player7 = Main.player[target];
				if (Main.player[target].dead || Math.Abs(position.X - Main.player[target].position.X) > 2000f || Math.Abs(position.Y - Main.player[target].position.Y) > 2000f)
				{
					if (this.ai[1] != 2f)
					{
						netUpdate = true;
					}
					this.ai[1] = 2f;
				}
			}
			if (Main.dayTime)
			{
				velocity.Y += 0.3f;
				velocity.X *= 0.9f;
			}
			else if (this.ai[1] == 0f)
			{
				this.ai[2]++;
				if (this.ai[2] >= 300f)
				{
					if (this.ai[3] != 1f)
					{
						this.ai[1] = 0f;
						this.ai[2] = 0f;
						netUpdate = true;
					}
					else
					{
						this.ai[1] = 1f;
						this.ai[2] = 0f;
						TargetClosest();
						player7 = Main.player[target];
						netUpdate = true;
					}
				}
				Vector2 center10 = base.Center;
				float num928 = player7.Center.X - center10.X;
				float num929 = player7.Center.Y - 200f - center10.Y;
				float num930 = (float)Math.Sqrt(num928 * num928 + num929 * num929);
				int num931 = 6;
				if (this.ai[3] == 1f)
				{
					if (num930 > 900f)
					{
						num931 = 12;
					}
					else if (num930 > 600f)
					{
						num931 = 10;
					}
					else if (num930 > 300f)
					{
						num931 = 8;
					}
				}
				if (num930 > 50f)
				{
					num930 = (float)num931 / num930;
					velocity.X = (velocity.X * 14f + num928 * num930) / 15f;
					velocity.Y = (velocity.Y * 14f + num929 * num930) / 15f;
				}
			}
			else if (this.ai[1] == 1f)
			{
				this.ai[2] += 1f;
				if (this.ai[2] >= 600f || this.ai[3] != 1f)
				{
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					netUpdate = true;
				}
				Vector2 center11 = base.Center;
				float num932 = player7.Center.X - center11.X;
				float num933 = player7.Center.Y - center11.Y;
				float num934 = (float)Math.Sqrt(num932 * num932 + num933 * num933);
				num934 = 16f / num934;
				velocity.X = (velocity.X * 49f + num932 * num934) / 50f;
				velocity.Y = (velocity.Y * 49f + num933 * num934) / 50f;
			}
			else if (this.ai[1] == 2f)
			{
				velocity.Y += 0.1f;
				if (velocity.Y < 0f)
				{
					velocity.Y *= 0.95f;
				}
				velocity.X *= 0.95f;
				EncourageDespawn(500);
			}
			rotation = velocity.X * -0.02f;
		}
		else if (aiStyle == 59)
		{
			int num935 = (int)this.ai[0];
			NPC nPC4 = Main.npc[(int)this.ai[1]];
			spriteDirection = -num935;
			if (!nPC4.active || nPC4.aiStyle != 58)
			{
				this.ai[2] += 10f;
				if (this.ai[2] > 50f || Main.netMode != 2)
				{
					life = -1;
					HitEffect();
					active = false;
					netUpdate = true;
				}
			}
			if (Main.netMode != 1 && nPC4.ai[3] == 2f)
			{
				localAI[1]++;
				if (localAI[1] > 90f)
				{
					localAI[1] = 0f;
					float num936 = 0.01f;
					Vector2 vector112 = new Vector2(base.Center.X, base.Center.Y + 30f);
					float num937 = Main.player[target].Center.X - vector112.X;
					float num938 = Main.player[target].Top.Y - vector112.Y;
					float num939 = Math.Max(1f, (float)Math.Sqrt(num937 * num937 + num938 * num938));
					num939 = num936 / num939;
					num937 *= num939;
					num938 *= num939;
					int num940 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, num937, num938, 329, 60, 0f, Main.myPlayer, rotation, spriteDirection);
				}
			}
			if (Main.dayTime)
			{
				velocity.Y += 0.3f;
				velocity.X *= 0.9f;
			}
			else if (this.ai[2] == 0f || this.ai[2] == 3f)
			{
				if (nPC4.ai[1] == 2f)
				{
					EncourageDespawn(10);
				}
				this.ai[3]++;
				if (this.ai[3] >= 180f)
				{
					this.ai[2]++;
					this.ai[3] = 0f;
					netUpdate = true;
				}
				Vector2 center12 = base.Center;
				float num941 = (Main.player[target].Center.X + nPC4.Center.X) / 2f;
				float num942 = (Main.player[target].Center.Y + nPC4.Center.Y) / 2f;
				num941 += (float)(-170 * num935) - center12.X;
				num942 += 90f - center12.Y;
				float num943 = Math.Abs(Main.player[target].Center.X - nPC4.Center.X) + Math.Abs(Main.player[target].Center.Y - nPC4.Center.Y);
				if (num943 > 700f)
				{
					num941 = nPC4.Center.X - (float)(170 * num935) - center12.X;
					num942 = nPC4.Center.Y + 90f - center12.Y;
				}
				float num944 = Math.Max(1f, (float)Math.Sqrt(num941 * num941 + num942 * num942));
				int num945 = 6;
				if (num944 > 1000f)
				{
					num945 = 21;
				}
				else if (num944 > 800f)
				{
					num945 = 18;
				}
				else if (num944 > 600f)
				{
					num945 = 15;
				}
				else if (num944 > 400f)
				{
					num945 = 12;
				}
				else if (num944 > 200f)
				{
					num945 = 9;
				}
				if (num935 < 0 && base.Center.X > nPC4.Center.X)
				{
					num941 -= 4f;
				}
				if (num935 > 0 && base.Center.X < nPC4.Center.X)
				{
					num941 += 4f;
				}
				num944 = (float)num945 / num944;
				velocity.X = (velocity.X * 14f + num941 * num944) / 15f;
				velocity.Y = (velocity.Y * 14f + num942 * num944) / 15f;
				num944 = Math.Max(1f, (float)Math.Sqrt(num941 * num941 + num942 * num942));
				if (num944 > 20f)
				{
					rotation = (float)Math.Atan2(num942, num941) + 1.57f;
				}
			}
			else if (this.ai[2] == 1f)
			{
				Vector2 center13 = base.Center;
				float num946 = nPC4.Center.X - (float)(200 * num935) - center13.X;
				float num947 = nPC4.Top.Y + 230f - center13.Y;
				float num948 = Math.Max(1f, (float)Math.Sqrt(num946 * num946 + num947 * num947));
				rotation = (float)Math.Atan2(num947, num946) + 1.57f;
				velocity.X *= 0.95f;
				velocity.Y -= 0.3f;
				if (velocity.Y < -14f)
				{
					velocity.Y = -14f;
				}
				if (position.Y < nPC4.Top.Y - 200f)
				{
					TargetClosest();
					this.ai[2] = 2f;
					center13 = base.Center;
					num946 = Main.player[target].Center.X - center13.X;
					num947 = Main.player[target].Center.Y - center13.Y;
					num948 = Math.Max(1f, (float)Math.Sqrt(num946 * num946 + num947 * num947));
					num948 = 18f / num948;
					velocity.X = num946 * num948;
					velocity.Y = num947 * num948;
					netUpdate = true;
				}
			}
			else if (this.ai[2] == 2f)
			{
				float num949 = Math.Abs(base.Center.X - nPC4.Center.X) + Math.Abs(base.Center.Y - nPC4.Center.Y);
				if (position.Y > Main.player[target].position.Y || velocity.Y < 0f || num949 > 800f)
				{
					this.ai[2] = 3f;
					netUpdate = true;
				}
			}
			else if (this.ai[2] == 4f)
			{
				Vector2 center14 = base.Center;
				float num950 = nPC4.Center.X - (float)(200 * num935) - center14.X;
				float num951 = nPC4.Top.Y + 230f - center14.Y;
				float num952 = Math.Max(1f, (float)Math.Sqrt(num950 * num950 + num951 * num951));
				rotation = (float)Math.Atan2(num951, num950) + 1.57f;
				velocity.Y *= 0.95f;
				velocity.X += 0.3f * (float)(-num935);
				if (velocity.X < -14f)
				{
					velocity.X = -14f;
				}
				if (velocity.X > 14f)
				{
					velocity.X = 14f;
				}
				if (base.Center.X < nPC4.Center.X - 500f || base.Center.X > nPC4.Center.X + 500f)
				{
					TargetClosest();
					this.ai[2] = 5f;
					center14 = base.Center;
					num950 = Main.player[target].Center.X - center14.X;
					num951 = Main.player[target].Center.Y - center14.Y;
					num952 = Math.Max(1f, (float)Math.Sqrt(num950 * num950 + num951 * num951));
					num952 = 17f / num952;
					velocity.X = num950 * num952;
					velocity.Y = num951 * num952;
					netUpdate = true;
				}
			}
			else if (this.ai[2] == 5f)
			{
				float num953 = Math.Abs(base.Center.X - nPC4.Center.X) + Math.Abs(base.Center.Y - nPC4.Center.Y);
				if ((velocity.X > 0f && base.Center.X > Main.player[target].Center.X) || (velocity.X < 0f && base.Center.X < Main.player[target].Center.X) || num953 > 800f)
				{
					this.ai[2] = 0f;
					netUpdate = true;
				}
			}
		}
		else if (aiStyle == 60)
		{
			if (Main.dayTime)
			{
				if (velocity.X > 0f)
				{
					velocity.X += 0.25f;
				}
				else
				{
					velocity.X -= 0.25f;
				}
				velocity.Y -= 0.1f;
				rotation = velocity.X * 0.05f;
			}
			else if (this.ai[0] == 0f)
			{
				if (this.ai[2] == 0f)
				{
					TargetClosest();
					if (base.Center.X < Main.player[target].Center.X)
					{
						this.ai[2] = 1f;
					}
					else
					{
						this.ai[2] = -1f;
					}
				}
				TargetClosest();
				int num954 = 800;
				float num955 = Math.Abs(base.Center.X - Main.player[target].Center.X);
				if (base.Center.X < Main.player[target].Center.X && this.ai[2] < 0f && num955 > (float)num954)
				{
					this.ai[2] = 0f;
				}
				if (base.Center.X > Main.player[target].Center.X && this.ai[2] > 0f && num955 > (float)num954)
				{
					this.ai[2] = 0f;
				}
				float num956 = 0.45f;
				float num957 = 7f;
				if ((double)life < (double)lifeMax * 0.75)
				{
					num956 = 0.55f;
					num957 = 8f;
				}
				if ((double)life < (double)lifeMax * 0.5)
				{
					num956 = 0.7f;
					num957 = 10f;
				}
				if ((double)life < (double)lifeMax * 0.25)
				{
					num956 = 0.8f;
					num957 = 11f;
				}
				velocity.X += this.ai[2] * num956;
				if (velocity.X > num957)
				{
					velocity.X = num957;
				}
				if (velocity.X < 0f - num957)
				{
					velocity.X = 0f - num957;
				}
				float num958 = Main.player[target].position.Y - (position.Y + (float)height);
				if (num958 < 150f)
				{
					velocity.Y -= 0.2f;
				}
				if (num958 > 200f)
				{
					velocity.Y += 0.2f;
				}
				if (velocity.Y > 8f)
				{
					velocity.Y = 8f;
				}
				if (velocity.Y < -8f)
				{
					velocity.Y = -8f;
				}
				rotation = velocity.X * 0.05f;
				if ((num955 < 500f || this.ai[3] < 0f) && position.Y < Main.player[target].position.Y)
				{
					this.ai[3] += 1f;
					int num959 = 13;
					if ((double)life < (double)lifeMax * 0.75)
					{
						num959 = 12;
					}
					if ((double)life < (double)lifeMax * 0.5)
					{
						num959 = 11;
					}
					if ((double)life < (double)lifeMax * 0.25)
					{
						num959 = 10;
					}
					num959++;
					if (this.ai[3] > (float)num959)
					{
						this.ai[3] = -num959;
					}
					if (this.ai[3] == 0f && Main.netMode != 1)
					{
						Vector2 vector113 = new Vector2(base.Center.X, base.Center.Y);
						vector113.X += velocity.X * 7f;
						float num960 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector113.X;
						float num961 = Main.player[target].Center.Y - vector113.Y;
						float num962 = (float)Math.Sqrt(num960 * num960 + num961 * num961);
						float num963 = 6f;
						if ((double)life < (double)lifeMax * 0.75)
						{
							num963 = 7f;
						}
						if ((double)life < (double)lifeMax * 0.5)
						{
							num963 = 8f;
						}
						if ((double)life < (double)lifeMax * 0.25)
						{
							num963 = 9f;
						}
						num962 = num963 / num962;
						num960 *= num962;
						num961 *= num962;
						int num964 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector113.X, vector113.Y, num960, num961, 348, 42, 0f, Main.myPlayer);
					}
				}
				else if (this.ai[3] < 0f)
				{
					this.ai[3] += 1f;
				}
				if (Main.netMode != 1)
				{
					this.ai[1] += Main.rand.Next(1, 4);
					if (this.ai[1] > 800f && num955 < 600f)
					{
						this.ai[0] = -1f;
					}
				}
			}
			else if (this.ai[0] == 1f)
			{
				TargetClosest();
				float num965 = 0.15f;
				float num966 = 7f;
				if ((double)life < (double)lifeMax * 0.75)
				{
					num965 = 0.17f;
					num966 = 8f;
				}
				if ((double)life < (double)lifeMax * 0.5)
				{
					num965 = 0.2f;
					num966 = 9f;
				}
				if ((double)life < (double)lifeMax * 0.25)
				{
					num965 = 0.25f;
					num966 = 10f;
				}
				num965 -= 0.05f;
				num966 -= 1f;
				if (base.Center.X < Main.player[target].Center.X)
				{
					velocity.X += num965;
					if (velocity.X < 0f)
					{
						velocity.X *= 0.98f;
					}
				}
				if (base.Center.X > Main.player[target].Center.X)
				{
					velocity.X -= num965;
					if (velocity.X > 0f)
					{
						velocity.X *= 0.98f;
					}
				}
				if (velocity.X > num966 || velocity.X < 0f - num966)
				{
					velocity.X *= 0.95f;
				}
				float num967 = Main.player[target].position.Y - (position.Y + (float)height);
				if (num967 < 180f)
				{
					velocity.Y -= 0.1f;
				}
				if (num967 > 200f)
				{
					velocity.Y += 0.1f;
				}
				if (velocity.Y > 6f)
				{
					velocity.Y = 6f;
				}
				if (velocity.Y < -6f)
				{
					velocity.Y = -6f;
				}
				rotation = velocity.X * 0.01f;
				if (Main.netMode != 1)
				{
					this.ai[3] += 1f;
					int num968 = 15;
					if ((double)life < (double)lifeMax * 0.75)
					{
						num968 = 14;
					}
					if ((double)life < (double)lifeMax * 0.5)
					{
						num968 = 12;
					}
					if ((double)life < (double)lifeMax * 0.25)
					{
						num968 = 10;
					}
					if ((double)life < (double)lifeMax * 0.1)
					{
						num968 = 8;
					}
					num968 += 3;
					if (this.ai[3] >= (float)num968)
					{
						this.ai[3] = 0f;
						Vector2 vector114 = new Vector2(base.Center.X, position.Y + (float)height - 14f);
						int i2 = (int)(vector114.X / 16f);
						int j2 = (int)(vector114.Y / 16f);
						if (!WorldGen.SolidTile(i2, j2))
						{
							float num969 = velocity.Y;
							if (num969 < 0f)
							{
								num969 = 0f;
							}
							num969 += 3f;
							float speedX2 = velocity.X * 0.25f;
							int num970 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector114.X, vector114.Y, speedX2, num969, 349, 37, 0f, Main.myPlayer, Main.rand.Next(5));
						}
					}
				}
				if (Main.netMode != 1)
				{
					this.ai[1] += Main.rand.Next(1, 4);
					if (this.ai[1] > 600f)
					{
						this.ai[0] = -1f;
					}
				}
			}
			else if (this.ai[0] == 2f)
			{
				TargetClosest();
				Vector2 vector115 = new Vector2(base.Center.X, base.Center.Y - 20f);
				float num971 = Main.rand.Next(-1000, 1001);
				float num972 = Main.rand.Next(-1000, 1001);
				float num973 = (float)Math.Sqrt(num971 * num971 + num972 * num972);
				float num974 = 15f;
				velocity *= 0.95f;
				num973 = num974 / num973;
				num971 *= num973;
				num972 *= num973;
				rotation += 0.2f;
				vector115.X += num971 * 4f;
				vector115.Y += num972 * 4f;
				this.ai[3] += 1f;
				int num975 = 7;
				if ((double)life < (double)lifeMax * 0.75)
				{
					num975--;
				}
				if ((double)life < (double)lifeMax * 0.5)
				{
					num975 -= 2;
				}
				if ((double)life < (double)lifeMax * 0.25)
				{
					num975 -= 3;
				}
				if ((double)life < (double)lifeMax * 0.1)
				{
					num975 -= 4;
				}
				if (this.ai[3] > (float)num975)
				{
					this.ai[3] = 0f;
					int num976 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector115.X, vector115.Y, num971, num972, 349, 35, 0f, Main.myPlayer);
				}
				if (Main.netMode != 1)
				{
					this.ai[1] += Main.rand.Next(1, 4);
					if (this.ai[1] > 500f)
					{
						this.ai[0] = -1f;
					}
				}
			}
			if (this.ai[0] == -1f)
			{
				int num977 = Main.rand.Next(3);
				TargetClosest();
				if (Math.Abs(base.Center.X - Main.player[target].Center.X) > 1000f)
				{
					num977 = 0;
				}
				this.ai[0] = num977;
				this.ai[1] = 0f;
				this.ai[2] = 0f;
				this.ai[3] = 0f;
			}
		}
		else if (aiStyle == 61)
		{
			float num978 = 2f;
			noGravity = true;
			noTileCollide = true;
			if (!Main.dayTime)
			{
				TargetClosest();
			}
			bool flag58 = false;
			if ((double)life < (double)lifeMax * 0.75)
			{
				num978 = 3f;
			}
			if ((double)life < (double)lifeMax * 0.5)
			{
				num978 = 4f;
			}
			if ((double)life < (double)lifeMax * 0.25)
			{
				num978 = 5f;
			}
			Vector2 center15 = base.Center;
			Point point3 = center15.ToTileCoordinates();
			if (WorldGen.InWorld(point3.X, point3.Y) && !WorldGen.SolidTile(point3.X, point3.Y))
			{
				Lighting.AddLight(center15, 0.3f, 0.26f, 0.05f);
			}
			if (Main.dayTime)
			{
				EncourageDespawn(10);
				num978 = 8f;
				if (velocity.X == 0f)
				{
					velocity.X = 0.1f;
				}
			}
			else if (this.ai[0] == 0f)
			{
				this.ai[1] += 1f;
				if (this.ai[1] >= 300f && Main.netMode != 1)
				{
					TargetClosest();
					this.ai[1] = 0f;
					this.ai[0] = 1f;
					netUpdate = true;
				}
			}
			else if (this.ai[0] == 1f)
			{
				this.ai[1] += 1f;
				flag58 = true;
				int num979 = 16;
				if ((double)life < (double)lifeMax * 0.25)
				{
					num979 = 8;
				}
				else if ((double)life < (double)lifeMax * 0.5)
				{
					num979 = 11;
				}
				else if ((double)life < (double)lifeMax * 0.75)
				{
					num979 = 14;
				}
				if (this.ai[1] % (float)num979 == 0f)
				{
					Vector2 vector116 = new Vector2(base.Center.X + (float)(direction * 50), base.Center.Y + (float)Main.rand.Next(15, 36));
					float num980 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector116.X;
					float num981 = Main.player[target].Center.Y - vector116.Y;
					num980 += (float)Main.rand.Next(-40, 41);
					num981 += (float)Main.rand.Next(-40, 41);
					float num982 = (float)Math.Sqrt(num980 * num980 + num981 * num981);
					float num983 = 15f;
					num982 = num983 / num982;
					num980 *= num982;
					num981 *= num982;
					num980 *= 1f + (float)Main.rand.Next(-20, 21) * 0.015f;
					num981 *= 1f + (float)Main.rand.Next(-20, 21) * 0.015f;
					int num984 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector116.X, vector116.Y, num980, num981, 180, 36, 0f, Main.myPlayer);
				}
				if (this.ai[1] > 240f)
				{
					this.ai[0] = 0f;
					this.ai[1] = 0f;
				}
			}
			if (Main.netMode != 1)
			{
				int num985 = 600;
				int num986 = 1200;
				int num987 = 2700;
				if ((double)life < (double)lifeMax * 0.25)
				{
					num985 = (int)((double)num985 * 0.5);
					num986 = (int)((double)num986 * 0.5);
					num987 = (int)((double)num987 * 0.5);
				}
				else if ((double)life < (double)lifeMax * 0.5)
				{
					num985 = (int)((double)num985 * 0.75);
					num986 = (int)((double)num986 * 0.75);
					num987 = (int)((double)num987 * 0.75);
				}
				else if ((double)life < (double)lifeMax * 0.75)
				{
					num985 = (int)((double)num985 * 0.9);
					num986 = (int)((double)num986 * 0.9);
					num987 = (int)((double)num987 * 0.9);
				}
				if (Main.rand.Next(num985) == 0)
				{
					Vector2 vector117 = new Vector2(base.Center.X - (float)(direction * 24), base.Center.Y - 64f);
					float num988 = Main.rand.Next(1, 100) * direction;
					float num989 = 1f;
					float num990 = (float)Math.Sqrt(num988 * num988 + num989 * num989);
					float num991 = 1f;
					num990 = num991 / num990;
					num988 *= num990;
					num989 *= num990;
					int num992 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector117.X, vector117.Y, num988, num989, 352, 80, 0f, Main.myPlayer);
				}
				if (Main.rand.Next(num986) == 0)
				{
					localAI[1] = 1f;
				}
				if (localAI[1] >= 1f)
				{
					localAI[1] += 1f;
					int num993 = 12;
					if (localAI[1] % (float)num993 == 0f)
					{
						Vector2 vector118 = new Vector2(base.Center.X - (float)(direction * 24), base.Center.Y - 64f);
						float num994 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector118.X;
						float num995 = Main.player[target].Center.Y - vector118.Y;
						num994 += (float)Main.rand.Next(-50, 51);
						num995 += (float)Main.rand.Next(-50, 51);
						float num996 = (float)Math.Sqrt(num994 * num994 + num995 * num995);
						float num997 = 12.5f;
						num996 = num997 / num996;
						num994 *= num996;
						num995 *= num996;
						num994 *= 1f + (float)Main.rand.Next(-20, 21) * 0.015f;
						num995 *= 1f + (float)Main.rand.Next(-20, 21) * 0.015f;
						int num998 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector118.X, vector118.Y, num994, num995, 350, 42, 0f, Main.myPlayer);
					}
					if (localAI[1] >= 100f)
					{
						localAI[1] = 0f;
					}
				}
				if (Main.rand.Next(num987) == 0)
				{
					localAI[2] = 2f;
				}
				if (localAI[2] > 0f)
				{
					localAI[2] += 1f;
					int num999 = 9;
					if (localAI[2] % (float)num999 == 0f)
					{
						Vector2 vector119 = new Vector2(base.Center.X - (float)(direction * 24), base.Center.Y - 64f);
						float num1000 = Main.rand.Next(-100, 101);
						float num1001 = -300f;
						float num1002 = (float)Math.Sqrt(num1000 * num1000 + num1001 * num1001);
						float num1003 = 11f;
						num1002 = num1003 / num1002;
						num1000 *= num1002;
						num1001 *= num1002;
						num1000 *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
						num1001 *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
						int num1004 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector119.X, vector119.Y, num1000, num1001, 351, 50, 0f, Main.myPlayer);
					}
					if (localAI[2] >= 100f)
					{
						localAI[2] = 0f;
					}
				}
			}
			if (Math.Abs(base.Center.X - Main.player[target].Center.X) < 50f)
			{
				flag58 = true;
			}
			if (flag58)
			{
				velocity.X *= 0.9f;
				if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
				{
					velocity.X = 0f;
				}
			}
			else
			{
				if (direction > 0)
				{
					velocity.X = (velocity.X * 20f + num978) / 21f;
				}
				if (direction < 0)
				{
					velocity.X = (velocity.X * 20f - num978) / 21f;
				}
			}
			int num1005 = 80;
			int num1006 = 20;
			Vector2 vector120 = new Vector2(base.Center.X - (float)(num1005 / 2), position.Y + (float)height - (float)num1006);
			bool flag59 = false;
			if (position.X < Main.player[target].position.X && position.X + (float)width > Main.player[target].position.X + (float)Main.player[target].width && position.Y + (float)height < Main.player[target].position.Y + (float)Main.player[target].height - 16f)
			{
				flag59 = true;
			}
			if (flag59)
			{
				velocity.Y += 0.5f;
			}
			else if (Collision.SolidCollision(vector120, num1005, num1006))
			{
				if (velocity.Y > 0f)
				{
					velocity.Y = 0f;
				}
				if ((double)velocity.Y > -0.2)
				{
					velocity.Y -= 0.025f;
				}
				else
				{
					velocity.Y -= 0.2f;
				}
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
			}
			else
			{
				if (velocity.Y < 0f)
				{
					velocity.Y = 0f;
				}
				if ((double)velocity.Y < 0.1)
				{
					velocity.Y += 0.025f;
				}
				else
				{
					velocity.Y += 0.5f;
				}
			}
			if (velocity.Y > 10f)
			{
				velocity.Y = 10f;
			}
		}
		else if (aiStyle == 62)
		{
			TargetClosest();
			rotation = Math.Abs(velocity.X) * (float)direction * 0.1f;
			spriteDirection = direction;
			float num1007 = 7f;
			Vector2 vector121 = new Vector2(base.Center.X + (float)(direction * 20), base.Center.Y + 6f);
			float num1008 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector121.X;
			float num1009 = Main.player[target].position.Y - vector121.Y;
			float num1010 = (float)Math.Sqrt(num1008 * num1008 + num1009 * num1009);
			float num1011 = num1007 / num1010;
			num1008 *= num1011;
			num1009 *= num1011;
			bool flag60 = Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1);
			if (Main.dayTime)
			{
				int num1012 = 60;
				velocity.X = (velocity.X * (float)(num1012 - 1) - num1008) / (float)num1012;
				velocity.Y = (velocity.Y * (float)(num1012 - 1) - num1009) / (float)num1012;
				EncourageDespawn(10);
				return;
			}
			if (num1010 > 600f || !flag60)
			{
				int num1013 = 60;
				velocity.X = (velocity.X * (float)(num1013 - 1) + num1008) / (float)num1013;
				velocity.Y = (velocity.Y * (float)(num1013 - 1) + num1009) / (float)num1013;
				return;
			}
			velocity *= 0.98f;
			if (Math.Abs(velocity.X) < 1f && Math.Abs(velocity.Y) < 1f && Main.netMode != 1)
			{
				localAI[0] += 1f;
				if (localAI[0] >= 15f)
				{
					localAI[0] = 0f;
					num1008 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector121.X;
					num1009 = Main.player[target].Center.Y - vector121.Y;
					num1008 += (float)Main.rand.Next(-35, 36);
					num1009 += (float)Main.rand.Next(-35, 36);
					num1008 *= 1f + (float)Main.rand.Next(-20, 21) * 0.015f;
					num1009 *= 1f + (float)Main.rand.Next(-20, 21) * 0.015f;
					num1010 = (float)Math.Sqrt(num1008 * num1008 + num1009 * num1009);
					num1007 = 10f;
					num1011 = num1007 / num1010;
					num1008 *= num1011;
					num1009 *= num1011;
					num1008 *= 1f + (float)Main.rand.Next(-20, 21) * 0.0125f;
					num1009 *= 1f + (float)Main.rand.Next(-20, 21) * 0.0125f;
					int num1014 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector121.X, vector121.Y, num1008, num1009, 180, 32, 0f, Main.myPlayer);
				}
			}
		}
		else if (aiStyle == 63)
		{
			TargetClosest();
			float num1015 = 11f;
			Vector2 vector122 = new Vector2(base.Center.X + (float)(direction * 20), base.Center.Y + 6f);
			float num1016 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector122.X;
			float num1017 = Main.player[target].Center.Y - vector122.Y;
			float num1018 = (float)Math.Sqrt(num1016 * num1016 + num1017 * num1017);
			float num1019 = num1015 / num1018;
			num1016 *= num1019;
			num1017 *= num1019;
			if (Main.dayTime)
			{
				num1016 = 0f - num1016;
				num1017 = 0f - num1017;
			}
			this.ai[0] -= 1f;
			if (num1018 < 200f || this.ai[0] > 0f)
			{
				if (num1018 < 200f)
				{
					this.ai[0] = 20f;
				}
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
				rotation += (float)direction * 0.3f;
				return;
			}
			velocity.X = (velocity.X * 50f + num1016) / 51f;
			velocity.Y = (velocity.Y * 50f + num1017) / 51f;
			if (num1018 < 350f)
			{
				velocity.X = (velocity.X * 10f + num1016) / 11f;
				velocity.Y = (velocity.Y * 10f + num1017) / 11f;
			}
			if (num1018 < 300f)
			{
				velocity.X = (velocity.X * 7f + num1016) / 8f;
				velocity.Y = (velocity.Y * 7f + num1017) / 8f;
			}
			rotation = velocity.X * 0.15f;
		}
		else if (aiStyle == 64)
		{
			float num1020 = this.ai[0];
			float num1021 = this.ai[1];
			if (Main.netMode != 1)
			{
				localAI[0] -= 1f;
				if (this.ai[3] == 0f)
				{
					this.ai[3] = (float)Main.rand.Next(75, 111) * 0.01f;
				}
				if (localAI[0] <= 0f)
				{
					TargetClosest();
					localAI[0] = Main.rand.Next(60, 180);
					float num1022 = Math.Abs(base.Center.X - Main.player[target].Center.X);
					if (num1022 > 700f && localAI[3] == 0f)
					{
						float num1023 = (float)Main.rand.Next(50, 151) * 0.01f;
						if (num1022 > 1000f)
						{
							num1023 = (float)Main.rand.Next(150, 201) * 0.01f;
						}
						else if (num1022 > 850f)
						{
							num1023 = (float)Main.rand.Next(100, 151) * 0.01f;
						}
						int num1024 = direction * Main.rand.Next(100, 251);
						int num1025 = Main.rand.Next(-50, 51);
						if (position.Y > Main.player[target].position.Y - 100f)
						{
							num1025 -= Main.rand.Next(100, 251);
						}
						float num1026 = num1023 / (float)Math.Sqrt(num1024 * num1024 + num1025 * num1025);
						num1020 = (float)num1024 * num1026;
						num1021 = (float)num1025 * num1026;
					}
					else
					{
						localAI[3] = 1f;
						float num1027 = (float)Main.rand.Next(5, 151) * 0.01f;
						int num1028 = Main.rand.Next(-100, 101);
						int num1029 = Main.rand.Next(-100, 101);
						float num1030 = num1027 / (float)Math.Sqrt(num1028 * num1028 + num1029 * num1029);
						num1020 = (float)num1028 * num1030;
						num1021 = (float)num1029 * num1030;
					}
					netUpdate = true;
				}
			}
			scale = this.ai[3];
			if (type == 677)
			{
				bool flag61 = true;
				Point point4 = base.Center.ToTileCoordinates();
				int num1031 = 40;
				if (point4.X < num1031)
				{
					num1020 += 0.5f;
					if (num1020 > 3f)
					{
						num1020 = 3f;
					}
					flag61 = false;
				}
				else if (point4.X > Main.maxTilesX - num1031)
				{
					num1020 -= 0.5f;
					if (num1020 < -3f)
					{
						num1020 = -3f;
					}
					flag61 = false;
				}
				if (point4.Y < num1031)
				{
					num1021 += 0.5f;
					if (num1021 > 3f)
					{
						velocity.Y = 3f;
					}
					flag61 = false;
				}
				else if (point4.Y > Main.maxTilesY - num1031)
				{
					num1021 -= 0.5f;
					if (num1021 < -3f)
					{
						num1021 = -3f;
					}
					flag61 = false;
				}
				if (localAI[1] > 0f)
				{
					localAI[1]--;
				}
				else if (flag61)
				{
					localAI[1] = 15f;
					float num1032 = 0f;
					Vector2 zero = Vector2.Zero;
					for (int num1033 = 0; num1033 < Main.maxNPCs; num1033++)
					{
						NPC nPC5 = Main.npc[num1033];
						if (nPC5.active && nPC5.damage > 0 && !nPC5.friendly && nPC5.Hitbox.Distance(base.Center) <= 100f)
						{
							num1032++;
							zero += DirectionFrom(nPC5.Center);
						}
					}
					for (int num1034 = 0; num1034 < 255; num1034++)
					{
						Player player8 = Main.player[num1034];
						if (player8.active && player8.Hitbox.Distance(base.Center) <= 150f)
						{
							num1032++;
							zero += DirectionFrom(player8.Center);
						}
					}
					if (num1032 > 0f)
					{
						float num1035 = 2f;
						zero /= num1032;
						zero *= num1035;
						velocity += zero;
						if (velocity.Length() > 8f)
						{
							velocity = velocity.SafeNormalize(Vector2.Zero) * 8f;
						}
						Vector2 vector123 = base.Center + zero * 10f;
						localAI[0] = 10f;
						netUpdate = true;
					}
				}
			}
			else if (localAI[2] > 0f)
			{
				int i3 = (int)base.Center.X / 16;
				int j3 = (int)base.Center.Y / 16;
				if (localAI[2] > 3f)
				{
					if (type == 358)
					{
						Lighting.AddLight(i3, j3, 0.10124999f * scale, 0.21374999f * scale, 0.225f * scale);
					}
					else if (type == 654)
					{
						Lighting.AddLight(i3, j3, 0.225f * scale, 0.105000004f * scale, 0.060000002f * scale);
					}
					else
					{
						Lighting.AddLight(i3, j3, 0.109500006f * scale, 0.15f * scale, 0.0615f * scale);
					}
				}
				localAI[2] -= 1f;
			}
			else if (localAI[1] > 0f)
			{
				localAI[1] -= 1f;
			}
			else
			{
				localAI[1] = Main.rand.Next(30, 180);
				if (!Main.dayTime || (double)(position.Y / 16f) > Main.worldSurface + 10.0)
				{
					localAI[2] = Main.rand.Next(10, 30);
				}
			}
			int num1036 = 80;
			velocity.X = (velocity.X * (float)(num1036 - 1) + num1020) / (float)num1036;
			velocity.Y = (velocity.Y * (float)(num1036 - 1) + num1021) / (float)num1036;
			if (velocity.Y > 0f)
			{
				int num1037 = 4;
				int num1038 = (int)base.Center.X / 16;
				int num1039 = (int)base.Center.Y / 16;
				for (int num1040 = num1039; num1040 < num1039 + num1037; num1040++)
				{
					if (WorldGen.InWorld(num1038, num1040, 2) && Main.tile[num1038, num1040] != null && ((Main.tile[num1038, num1040].nactive() && Main.tileSolid[Main.tile[num1038, num1040].type]) || Main.tile[num1038, num1040].liquid > 0))
					{
						num1021 *= -1f;
						if (velocity.Y > 0f)
						{
							velocity.Y *= 0.9f;
						}
					}
				}
			}
			if (velocity.Y < 0f)
			{
				int num1041 = 30;
				bool flag62 = false;
				int num1042 = (int)base.Center.X / 16;
				int num1043 = (int)base.Center.Y / 16;
				for (int num1044 = num1043; num1044 < num1043 + num1041; num1044++)
				{
					if (WorldGen.InWorld(num1042, num1044, 2) && Main.tile[num1042, num1044] != null && Main.tile[num1042, num1044].nactive() && Main.tileSolid[Main.tile[num1042, num1044].type])
					{
						flag62 = true;
					}
				}
				if (!flag62)
				{
					num1021 *= -1f;
					if (velocity.Y < 0f)
					{
						velocity.Y *= 0.9f;
					}
				}
			}
			if (collideX)
			{
				num1020 = ((!(velocity.X < 0f)) ? (0f - Math.Abs(num1020)) : Math.Abs(num1020));
				velocity.X *= -0.2f;
			}
			if (type == 677)
			{
				rotation = velocity.X * 0.3f;
			}
			if (velocity.X < 0f)
			{
				direction = -1;
			}
			if (velocity.X > 0f)
			{
				direction = 1;
			}
			this.ai[0] = num1020;
			this.ai[1] = num1021;
		}
		else if (aiStyle == 65)
		{
			AI_065_Butterflies();
		}
		else if (aiStyle == 66)
		{
			if (type == 484)
			{
				float num1045 = (float)Main.rand.Next(90, 111) * 0.01f;
				num1045 *= (Main.essScale + 0.5f) / 2f;
				Lighting.AddLight((int)((position.X + (float)(width / 2)) / 16f), (int)((position.Y + (float)(height / 2)) / 16f), 0.3f * num1045, 0.1f * num1045, 0.25f * num1045);
			}
			if (velocity.Y == 0f)
			{
				if (this.ai[0] == 1f)
				{
					if (direction == 0)
					{
						TargetClosest();
					}
					if (collideX)
					{
						direction *= -1;
					}
					float num1046 = 0.2f;
					if (type == 485)
					{
						num1046 = 0.25f;
					}
					if (type == 486)
					{
						num1046 = 0.325f;
					}
					if (type == 487)
					{
						num1046 = 0.4f;
					}
					velocity.X = num1046 * (float)direction;
					if (type == 374)
					{
						velocity.X *= 3f;
					}
				}
				else
				{
					velocity.X = 0f;
				}
				if (Main.netMode != 1)
				{
					localAI[1] -= 1f;
					if (localAI[1] <= 0f)
					{
						if (this.ai[0] == 1f)
						{
							this.ai[0] = 0f;
							localAI[1] = Main.rand.Next(300, 900);
						}
						else
						{
							this.ai[0] = 1f;
							localAI[1] = Main.rand.Next(600, 1800);
						}
						netUpdate = true;
					}
				}
			}
			else if (direction == 0)
			{
				direction = 1;
				if (velocity.X < 0f)
				{
					direction = -1;
				}
			}
			if (type != 374)
			{
				return;
			}
			spriteDirection = direction;
			bool flag63 = false;
			for (int num1047 = 0; num1047 < 255; num1047++)
			{
				Player player9 = Main.player[num1047];
				if (player9.active && !player9.dead && !(Vector2.Distance(player9.Center, base.Center) > 160f))
				{
					flag63 = true;
					break;
				}
			}
			int num1048 = 90;
			if (flag63 && this.ai[1] < (float)num1048)
			{
				this.ai[1]++;
			}
			if (this.ai[1] == (float)num1048 && Main.netMode != 1)
			{
				position.Y += 16f;
				Transform(375);
			}
		}
		else if (aiStyle == 67)
		{
			if (Main.netMode != 1)
			{
				int num1049 = (int)MathHelper.Clamp((int)(base.Center.X / 16f), 0f, Main.maxTilesX);
				int num1050 = (int)MathHelper.Clamp((int)(base.Center.Y / 16f), 0f, Main.maxTilesY);
				Tile tile = Main.tile[num1049, num1050];
				if (tile != null && tile.shimmer() && tile.liquid > 30)
				{
					GetShimmered();
					return;
				}
			}
			if (type == 359)
			{
				if (this.ai[3] != 0f)
				{
					scale = this.ai[3];
					int num1051 = (int)(12f * scale);
					int num1052 = (int)(12f * scale);
					if (num1051 != width)
					{
						position.X = position.X + (float)(width / 2) - (float)num1051 - 2f;
						width = num1051;
					}
					if (num1052 != height)
					{
						position.Y = position.Y + (float)height - (float)num1052;
						height = num1052;
					}
				}
				if (this.ai[3] == 0f && Main.netMode != 1)
				{
					this.ai[3] = (float)Main.rand.Next(80, 111) * 0.01f;
					netUpdate = true;
				}
			}
			if (type == 360)
			{
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.1f, 0.2f, 0.7f);
			}
			if (type == 655)
			{
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.6f, 0.3f, 0.1f);
			}
			float num1053 = 0.3f;
			if (type == 360 || type == 655)
			{
				num1053 = 0.6f;
			}
			if (this.ai[0] == 0f)
			{
				TargetClosest();
				directionY = 1;
				this.ai[0] = 1f;
				if (direction > 0)
				{
					spriteDirection = 1;
				}
			}
			bool flag64 = false;
			if (Main.netMode != 1)
			{
				if (this.ai[2] == 0f && Main.rand.Next(7200) == 0)
				{
					this.ai[2] = 2f;
					netUpdate = true;
				}
				if (!collideX && !collideY)
				{
					localAI[3] += 1f;
					if (localAI[3] > 5f)
					{
						this.ai[2] = 2f;
						netUpdate = true;
					}
				}
				else
				{
					localAI[3] = 0f;
				}
			}
			if (this.ai[2] > 0f)
			{
				this.ai[1] = 0f;
				this.ai[0] = 1f;
				directionY = 1;
				if (velocity.Y > num1053)
				{
					rotation += (float)direction * 0.1f;
				}
				else
				{
					rotation = 0f;
				}
				spriteDirection = direction;
				velocity.X = num1053 * (float)direction;
				noGravity = false;
				int num1054 = (int)(base.Center.X + (float)(width / 2 * -direction)) / 16;
				int num1055 = (int)(position.Y + (float)height + 8f) / 16;
				if (Main.tile[num1054, num1055] != null && !Main.tile[num1054, num1055].topSlope() && collideY)
				{
					this.ai[2] -= 1f;
				}
				num1055 = (int)(position.Y + (float)height - 4f) / 16;
				num1054 = (int)(base.Center.X + (float)(width / 2 * direction)) / 16;
				if (Main.tile[num1054, num1055] != null && Main.tile[num1054, num1055].bottomSlope())
				{
					direction *= -1;
				}
				if (collideX && velocity.Y == 0f)
				{
					flag64 = true;
					this.ai[2] = 0f;
					directionY = -1;
					this.ai[1] = 1f;
				}
				if (velocity.Y == 0f)
				{
					if (localAI[1] == position.X)
					{
						localAI[2] += 1f;
						if (localAI[2] > 10f)
						{
							direction = 1;
							velocity.X = (float)direction * num1053;
							localAI[2] = 0f;
						}
					}
					else
					{
						localAI[2] = 0f;
						localAI[1] = position.X;
					}
				}
			}
			if (this.ai[2] != 0f)
			{
				return;
			}
			noGravity = true;
			if (this.ai[1] == 0f)
			{
				if (collideY)
				{
					this.ai[0] = 2f;
				}
				if (!collideY && this.ai[0] == 2f)
				{
					direction = -direction;
					this.ai[1] = 1f;
					this.ai[0] = 1f;
				}
				if (collideX)
				{
					directionY = -directionY;
					this.ai[1] = 1f;
				}
			}
			else
			{
				if (collideX)
				{
					this.ai[0] = 2f;
				}
				if (!collideX && this.ai[0] == 2f)
				{
					directionY = -directionY;
					this.ai[1] = 0f;
					this.ai[0] = 1f;
				}
				if (collideY)
				{
					direction = -direction;
					this.ai[1] = 0f;
				}
			}
			if (!flag64)
			{
				float num1056 = rotation;
				if (directionY < 0)
				{
					if (direction < 0)
					{
						if (collideX)
						{
							rotation = 1.57f;
							spriteDirection = -1;
						}
						else if (collideY)
						{
							rotation = 3.14f;
							spriteDirection = 1;
						}
					}
					else if (collideY)
					{
						rotation = 3.14f;
						spriteDirection = -1;
					}
					else if (collideX)
					{
						rotation = 4.71f;
						spriteDirection = 1;
					}
				}
				else if (direction < 0)
				{
					if (collideY)
					{
						rotation = 0f;
						spriteDirection = -1;
					}
					else if (collideX)
					{
						rotation = 1.57f;
						spriteDirection = 1;
					}
				}
				else if (collideX)
				{
					rotation = 4.71f;
					spriteDirection = -1;
				}
				else if (collideY)
				{
					rotation = 0f;
					spriteDirection = 1;
				}
				float num1057 = rotation;
				rotation = num1056;
				if ((double)rotation > 6.28)
				{
					rotation -= 6.28f;
				}
				if (rotation < 0f)
				{
					rotation += 6.28f;
				}
				float num1058 = Math.Abs(rotation - num1057);
				float num1059 = 0.1f;
				if (rotation > num1057)
				{
					if ((double)num1058 > 3.14)
					{
						rotation += num1059;
					}
					else
					{
						rotation -= num1059;
						if (rotation < num1057)
						{
							rotation = num1057;
						}
					}
				}
				if (rotation < num1057)
				{
					if ((double)num1058 > 3.14)
					{
						rotation -= num1059;
					}
					else
					{
						rotation += num1059;
						if (rotation > num1057)
						{
							rotation = num1057;
						}
					}
				}
			}
			velocity.X = num1053 * (float)direction;
			velocity.Y = num1053 * (float)directionY;
		}
		else if (aiStyle == 68)
		{
			if (Main.netMode != 1 && this.ai[0] == 1f && NPCID.Sets.BirdThatCanPoop[type] && localAI[3] == 0f)
			{
				int num1060 = Player.FindClosest(position, width, height);
				float x3 = base.Center.X;
				if (x3 >= Main.player[num1060].Left.X && x3 <= Main.player[num1060].Right.X && Main.player[num1060].Top.Y > base.Bottom.Y && Collision.CanHit(this, Main.player[num1060]) && (Main.player[num1060].RollOnlyBadLuckExtreme(50) == 0 || Main.player[num1060].IsThisCenx()))
				{
					localAI[3] = 1f;
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), Main.player[num1060].Center.X, base.Center.Y, 0f, 0f, 1080, 0, 0f);
				}
			}
			noGravity = true;
			if (this.ai[0] == 0f)
			{
				noGravity = false;
				int num1061 = direction;
				int num1062 = target;
				TargetClosest();
				if (num1062 >= 0 && num1061 != 0)
				{
					direction = num1061;
				}
				if (wet && WorldGen.InWorld((int)(base.Center.X + (float)((width / 2 + 8) * direction)) / 16, (int)(base.Center.Y / 16f), 5))
				{
					float num1063 = 2f;
					velocity.X = (velocity.X * 19f + num1063 * (float)direction) / 20f;
					int num1064 = (int)(base.Center.X + (float)((width / 2 + 8) * direction)) / 16;
					int num1065 = (int)(base.Center.Y / 16f);
					int j4 = (int)(position.Y / 16f);
					int num1066 = (int)((position.Y + (float)height) / 16f);
					if (Main.tile[num1064, num1065] == null)
					{
						Main.tile[num1064, num1065] = new Tile();
					}
					if (Main.tile[num1064, num1066] == null)
					{
						Main.tile[num1064, num1066] = new Tile();
					}
					if (num1064 < 5 || num1064 > Main.maxTilesX - 5 || WorldGen.SolidTile(num1064, num1065) || WorldGen.SolidTile(num1064, j4) || WorldGen.SolidTile(num1064, num1066) || Main.tile[num1064, num1066].liquid == 0)
					{
						direction *= -1;
					}
					spriteDirection = direction;
					if (velocity.Y > 0f)
					{
						velocity.Y *= 0.5f;
					}
					noGravity = true;
					num1064 = (int)(base.Center.X / 16f);
					num1065 = (int)(base.Center.Y / 16f);
					float num1067 = position.Y + (float)height;
					if (Main.tile[num1064, num1065 - 1] == null)
					{
						Main.tile[num1064, num1065 - 1] = new Tile();
					}
					if (Main.tile[num1064, num1065] == null)
					{
						Main.tile[num1064, num1065] = new Tile();
					}
					if (Main.tile[num1064, num1065 + 1] == null)
					{
						Main.tile[num1064, num1065 + 1] = new Tile();
					}
					if (Main.tile[num1064, num1065 - 1].liquid > 0)
					{
						num1067 = num1065 * 16;
						num1067 -= (float)(Main.tile[num1064, num1065 - 1].liquid / 16);
					}
					else if (Main.tile[num1064, num1065].liquid > 0)
					{
						num1067 = (num1065 + 1) * 16;
						num1067 -= (float)(Main.tile[num1064, num1065].liquid / 16);
					}
					else if (Main.tile[num1064, num1065 + 1].liquid > 0)
					{
						num1067 = (num1065 + 2) * 16;
						num1067 -= (float)(Main.tile[num1064, num1065 + 1].liquid / 16);
					}
					num1067 -= 6f;
					if (base.Center.Y > num1067)
					{
						velocity.Y -= 0.1f;
						if (velocity.Y < -8f)
						{
							velocity.Y = -8f;
						}
						if (base.Center.Y + velocity.Y < num1067)
						{
							velocity.Y = num1067 - base.Center.Y;
						}
					}
					else
					{
						velocity.Y = num1067 - base.Center.Y;
					}
				}
				if (Main.netMode == 1)
				{
					return;
				}
				if (!wet)
				{
					this.ai[0] = 1f;
					netUpdate = true;
					direction = -direction;
					return;
				}
				Rectangle rectangle4 = new Rectangle((int)Main.player[target].position.X, (int)Main.player[target].position.Y, Main.player[target].width, Main.player[target].height);
				if (new Rectangle((int)position.X - 100, (int)position.Y - 100, width + 200, height + 200).Intersects(rectangle4) || life < lifeMax)
				{
					this.ai[0] = 1f;
					velocity.Y -= 6f;
					netUpdate = true;
					direction = -direction;
				}
			}
			else
			{
				if (Main.player[target].dead)
				{
					return;
				}
				bool flag65 = false;
				this.ai[1] += 1f;
				if (this.ai[1] >= 300f)
				{
					flag65 = true;
				}
				if (flag65)
				{
					if (velocity.Y == 0f || collideY || wet)
					{
						velocity.X = 0f;
						velocity.Y = 0f;
						this.ai[0] = 0f;
						this.ai[1] = 0f;
						if (Main.netMode != 1)
						{
							if ((type == 363 || type == 365 || type == 603 || type == 609) && !wet)
							{
								Transform(type - 1, 0f, 200 + Main.rand.Next(200));
							}
							netUpdate = true;
						}
					}
					else
					{
						velocity.X *= 0.98f;
						velocity.Y += 0.1f;
						if (velocity.Y > 2f)
						{
							velocity.Y = 2f;
						}
					}
					return;
				}
				if (collideX)
				{
					direction *= -1;
					velocity.X = oldVelocity.X * -0.5f;
					if (direction == -1 && velocity.X > 0f && velocity.X < 2f)
					{
						velocity.X = 2f;
					}
					if (direction == 1 && velocity.X < 0f && velocity.X > -2f)
					{
						velocity.X = -2f;
					}
				}
				if (collideY)
				{
					velocity.Y = oldVelocity.Y * -0.5f;
					if (velocity.Y > 0f && velocity.Y < 1f)
					{
						velocity.Y = 1f;
					}
					if (velocity.Y < 0f && velocity.Y > -1f)
					{
						velocity.Y = -1f;
					}
				}
				if (direction == -1 && velocity.X > -3f)
				{
					velocity.X -= 0.1f;
					if (velocity.X > 3f)
					{
						velocity.X -= 0.1f;
					}
					else if (velocity.X > 0f)
					{
						velocity.X -= 0.05f;
					}
					if (velocity.X < -3f)
					{
						velocity.X = -3f;
					}
				}
				else if (direction == 1 && velocity.X < 3f)
				{
					velocity.X += 0.1f;
					if (velocity.X < -3f)
					{
						velocity.X += 0.1f;
					}
					else if (velocity.X < 0f)
					{
						velocity.X += 0.05f;
					}
					if (velocity.X > 3f)
					{
						velocity.X = 3f;
					}
				}
				int num1068 = (int)((position.X + (float)(width / 2)) / 16f) + direction;
				int num1069 = (int)((position.Y + (float)height) / 16f);
				bool flag66 = true;
				int num1070 = 15;
				bool flag67 = false;
				for (int num1071 = num1069; num1071 < num1069 + num1070; num1071++)
				{
					if (Main.tile[num1068, num1071] == null)
					{
						Main.tile[num1068, num1071] = new Tile();
					}
					if ((Main.tile[num1068, num1071].nactive() && Main.tileSolid[Main.tile[num1068, num1071].type]) || Main.tile[num1068, num1071].liquid > 0)
					{
						if (num1071 < num1069 + 5)
						{
							flag67 = true;
						}
						flag66 = false;
						break;
					}
				}
				if (flag66)
				{
					velocity.Y += 0.1f;
				}
				else
				{
					velocity.Y -= 0.1f;
				}
				if (flag67)
				{
					velocity.Y -= 0.2f;
				}
				if (velocity.Y > 3f)
				{
					velocity.Y = 3f;
				}
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
			}
		}
		else if (aiStyle == 69)
		{
			AI_069_DukeFishron();
		}
		else if (aiStyle == 70)
		{
			if (target == 255)
			{
				TargetClosest();
				this.ai[3] = (float)Main.rand.Next(80, 121) / 100f;
				float num1072 = (float)Main.rand.Next(165, 265) / 15f;
				velocity = Vector2.Normalize(Main.player[target].Center - base.Center + new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101))) * num1072;
				netUpdate = true;
			}
			Vector2 vector124 = Vector2.Normalize(Main.player[target].Center - base.Center);
			velocity = (velocity * 40f + vector124 * 20f) / 41f;
			scale = this.ai[3];
			alpha -= 30;
			if (alpha < 50)
			{
				alpha = 50;
			}
			alpha = 50;
			velocity.X = (velocity.X * 50f + Main.windSpeedCurrent * 2f + (float)Main.rand.Next(-10, 11) * 0.1f) / 51f;
			velocity.Y = (velocity.Y * 50f + -0.25f + (float)Main.rand.Next(-10, 11) * 0.2f) / 51f;
			if (velocity.Y > 0f)
			{
				velocity.Y -= 0.04f;
			}
			if (this.ai[0] == 0f)
			{
				int num1073 = 40;
				Rectangle rect = getRect();
				rect.X -= num1073 + width / 2;
				rect.Y -= num1073 + height / 2;
				rect.Width += num1073 * 2;
				rect.Height += num1073 * 2;
				for (int num1074 = 0; num1074 < 255; num1074++)
				{
					Player player10 = Main.player[num1074];
					if (player10.active && !player10.dead && rect.Intersects(player10.getRect()))
					{
						this.ai[0] = 1f;
						this.ai[1] = 4f;
						netUpdate = true;
						break;
					}
				}
			}
			if (this.ai[0] == 0f)
			{
				this.ai[1]++;
				if (this.ai[1] >= 150f)
				{
					this.ai[0] = 1f;
					this.ai[1] = 4f;
				}
			}
			if (this.ai[0] == 1f)
			{
				this.ai[1]--;
				if (this.ai[1] <= 0f)
				{
					life = 0;
					HitEffect();
					active = false;
					return;
				}
			}
			if (justHit || this.ai[0] == 1f)
			{
				dontTakeDamage = true;
				position = base.Center;
				width = (height = 100);
				position = new Vector2(position.X - (float)(width / 2), position.Y - (float)(height / 2));
				EncourageDespawn(3);
			}
		}
		else if (aiStyle == 71)
		{
			noTileCollide = true;
			int num1075 = 90;
			if (target < 0 || target == 255 || Main.player[target].dead)
			{
				TargetClosest(faceTarget: false);
				direction = 1;
				netUpdate = true;
			}
			if (this.ai[0] == 0f)
			{
				this.ai[1]++;
				_ = type;
				_ = 372;
				noGravity = true;
				dontTakeDamage = true;
				velocity.Y = this.ai[3];
				if (type == 373)
				{
					float num1076 = (float)Math.PI / 30f;
					float num1077 = this.ai[2];
					float num1078 = (float)(Math.Cos(num1076 * localAI[1]) - 0.5) * num1077;
					position.X -= num1078 * (float)(-direction);
					localAI[1]++;
					num1078 = (float)(Math.Cos(num1076 * localAI[1]) - 0.5) * num1077;
					position.X += num1078 * (float)(-direction);
					if (Math.Abs(Math.Cos(num1076 * localAI[1]) - 0.5) > 0.25)
					{
						spriteDirection = ((!(Math.Cos(num1076 * localAI[1]) - 0.5 >= 0.0)) ? 1 : (-1));
					}
					rotation = velocity.Y * (float)spriteDirection * 0.1f;
					if ((double)rotation < -0.2)
					{
						rotation = -0.2f;
					}
					if ((double)rotation > 0.2)
					{
						rotation = 0.2f;
					}
					alpha -= 6;
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				if (this.ai[1] >= (float)num1075)
				{
					this.ai[0] = 1f;
					this.ai[1] = 0f;
					if (!Collision.SolidCollision(position, width, height))
					{
						this.ai[1] = 1f;
					}
					SoundEngine.PlaySound(4, (int)base.Center.X, (int)base.Center.Y, 19);
					TargetClosest();
					spriteDirection = direction;
					Vector2 vector125 = Main.player[target].Center - base.Center;
					vector125.Normalize();
					velocity = vector125 * 16f;
					rotation = velocity.ToRotation();
					if (direction == -1)
					{
						rotation += (float)Math.PI;
					}
					netUpdate = true;
				}
			}
			else
			{
				if (this.ai[0] != 1f)
				{
					return;
				}
				noGravity = true;
				if (!Collision.SolidCollision(position, width, height))
				{
					if (this.ai[1] < 1f)
					{
						this.ai[1] = 1f;
					}
				}
				else
				{
					alpha -= 15;
					if (alpha < 150)
					{
						alpha = 150;
					}
				}
				if (this.ai[1] >= 1f)
				{
					alpha -= 60;
					if (alpha < 0)
					{
						alpha = 0;
					}
					dontTakeDamage = false;
					this.ai[1]++;
					if (Collision.SolidCollision(position, width, height))
					{
						if (DeathSound != null)
						{
							SoundEngine.PlaySound(DeathSound, position);
						}
						life = 0;
						HitEffect();
						active = false;
						return;
					}
				}
				if (this.ai[1] >= 60f)
				{
					noGravity = false;
				}
				rotation = velocity.ToRotation();
				if (direction == -1)
				{
					rotation += (float)Math.PI;
				}
			}
		}
		else if (aiStyle == 72)
		{
			if (type == 384)
			{
				int num1079 = (int)this.ai[0];
				if (Main.npc[num1079].active && Main.npc[num1079].type == 383)
				{
					velocity = Vector2.Zero;
					position = Main.npc[num1079].Center;
					position.X -= width / 2;
					position.Y -= height / 2;
					gfxOffY = Main.npc[num1079].gfxOffY;
					Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.1f, 0.5f, 0.7f);
				}
				else
				{
					life = 0;
					HitEffect();
					active = false;
				}
			}
		}
		else if (aiStyle == 73)
		{
			TargetClosest(faceTarget: false);
			spriteDirection = direction;
			velocity.X *= 0.93f;
			if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
			{
				velocity.X = 0f;
			}
			if (type == 387)
			{
				float num1080 = 120f;
				float num1081 = 60f;
				if (this.ai[1] < num1080)
				{
					this.ai[1]++;
					if (this.ai[1] > 60f)
					{
						float num1082 = (this.ai[1] - num1081) / (num1080 - num1081);
						alpha = (int)((1f - num1082) * 255f);
					}
					else
					{
						alpha = 255;
					}
					dontTakeDamage = true;
					frameCounter = 0.0;
					frame.Y = 0;
					float num1083 = this.ai[1] / num1081;
					Vector2 spinningpoint = new Vector2(0f, -30f);
					spinningpoint = spinningpoint.RotatedBy(num1083 * 1.5f * ((float)Math.PI * 2f)) * new Vector2(1f, 0.4f);
					for (int num1084 = 0; num1084 < 4; num1084++)
					{
						Vector2 vector126 = Vector2.Zero;
						float num1085 = 1f;
						if (num1084 == 0)
						{
							vector126 = Vector2.UnitY * -15f;
							num1085 = 0.15f;
						}
						if (num1084 == 1)
						{
							vector126 = Vector2.UnitY * -5f;
							num1085 = 0.3f;
						}
						if (num1084 == 2)
						{
							vector126 = Vector2.UnitY * 5f;
							num1085 = 0.6f;
						}
						if (num1084 == 3)
						{
							vector126 = Vector2.UnitY * 20f;
							num1085 = 0.45f;
						}
						int num1086 = Dust.NewDust(base.Center, 0, 0, 226, 0f, 0f, 100, default(Color), 0.5f);
						Main.dust[num1086].noGravity = true;
						Main.dust[num1086].position = base.Center + spinningpoint * num1085 + vector126;
						Main.dust[num1086].velocity = Vector2.Zero;
						spinningpoint *= -1f;
						num1086 = Dust.NewDust(base.Center, 0, 0, 226, 0f, 0f, 100, default(Color), 0.5f);
						Main.dust[num1086].noGravity = true;
						Main.dust[num1086].position = base.Center + spinningpoint * num1085 + vector126;
						Main.dust[num1086].velocity = Vector2.Zero;
					}
					Lighting.AddLight((int)base.Center.X / 16, (int)(base.Center.Y - 10f) / 16, 0.1f * num1083, 0.5f * num1083, 0.7f * num1083);
					return;
				}
				if (this.ai[1] == num1080)
				{
					this.ai[1]++;
					netUpdate = true;
				}
				Lighting.AddLight((int)base.Center.X / 16, (int)(base.Center.Y - 10f) / 16, 0.1f, 0.5f, 0.7f);
				dontTakeDamage = false;
			}
			if (this.ai[0] < 60f)
			{
				this.ai[0]++;
			}
			if (justHit)
			{
				this.ai[0] = -30f;
				netUpdate = true;
			}
			if (this.ai[0] == 60f && Main.netMode != 1)
			{
				this.ai[0] = -120f;
				netUpdate = true;
				Vector2 center16 = Main.player[target].Center;
				Vector2 vector127 = base.Center - Vector2.UnitY * 10f;
				Vector2 vector128 = center16 - vector127;
				vector128.X += Main.rand.Next(-100, 101);
				vector128.Y += Main.rand.Next(-100, 101);
				vector128.X *= (float)Main.rand.Next(70, 131) * 0.01f;
				vector128.Y *= (float)Main.rand.Next(70, 131) * 0.01f;
				vector128.Normalize();
				if (float.IsNaN(vector128.X) || float.IsNaN(vector128.Y))
				{
					vector128 = -Vector2.UnitY;
				}
				vector128 *= 14f;
				int num1087 = 35;
				float num1088 = 1f;
				if (type >= 381 && type <= 392)
				{
					num1088 = 0.8f;
				}
				num1087 = GetAttackDamage_ForProjectiles(num1087, (float)num1087 * num1088);
				Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector127.X, vector127.Y, vector128.X, vector128.Y, 435, num1087, 0f, Main.myPlayer);
			}
		}
		else if (aiStyle == 74)
		{
			TargetClosest(faceTarget: false);
			rotation = velocity.ToRotation();
			if (rotation < -(float)Math.PI / 2f)
			{
				rotation += (float)Math.PI;
			}
			if (rotation > (float)Math.PI / 2f)
			{
				rotation -= (float)Math.PI;
			}
			if (Math.Sign(velocity.X) != 0)
			{
				spriteDirection = -Math.Sign(velocity.X);
			}
			if (type == 418)
			{
				spriteDirection = Math.Sign(velocity.X);
			}
			float normalKnockbackMult = 0.4f;
			float num1089 = 10f;
			float num1090 = 200f;
			float num1091 = 0f;
			float num1092 = 750f;
			float num1093 = 0f;
			float num1094 = 30f;
			float num1095 = 30f;
			float num1096 = 0.95f;
			int num1097 = 50;
			float num1098 = 14f;
			float num1099 = 30f;
			float num1100 = 100f;
			float num1101 = 20f;
			float num1102 = 0f;
			float num1103 = 7f;
			bool flag68 = true;
			if (type == 418)
			{
				normalKnockbackMult = 0.3f;
				num1089 = 8f;
				num1090 = 175f;
				num1091 = 175f;
				num1092 = 600f;
				num1093 = 80f;
				num1094 = 60f;
				num1095 = 20f;
				num1096 = 0.75f;
				num1097 = 0;
				num1098 = 9f;
				num1099 = 30f;
				num1100 = 150f;
				num1101 = 60f;
				num1102 = 4f / 15f;
				num1103 = 7f;
				flag68 = false;
			}
			num1102 *= num1101;
			if (type == 388 && this.ai[0] != 3f)
			{
				position += netOffset;
				int num1104 = Dust.NewDust(position, width, height, 226, 0f, 0f, 100, default(Color), 0.5f);
				Main.dust[num1104].noGravity = true;
				Main.dust[num1104].velocity = velocity / 5f;
				Vector2 spinningpoint2 = new Vector2(-10f, 10f);
				if (spriteDirection == 1)
				{
					spinningpoint2.X *= -1f;
				}
				spinningpoint2 = spinningpoint2.RotatedBy(rotation);
				Main.dust[num1104].position = base.Center + spinningpoint2;
				position -= netOffset;
			}
			if (type == 418)
			{
				int num1105 = ((this.ai[0] != 2f) ? 1 : 2);
				int num1106 = ((this.ai[0] == 2f) ? 30 : 20);
				for (int num1107 = 0; num1107 < 2; num1107++)
				{
					if (Main.rand.Next(3) < num1105)
					{
						position += netOffset;
						int num1108 = Dust.NewDust(base.Center - new Vector2(num1106), num1106 * 2, num1106 * 2, 6, velocity.X * 0.5f, velocity.Y * 0.5f, 90, default(Color), 1.5f);
						Main.dust[num1108].noGravity = true;
						Dust dust = Main.dust[num1108];
						dust.velocity *= 0.2f;
						Main.dust[num1108].fadeIn = 1f;
						position -= netOffset;
					}
				}
			}
			if (this.ai[0] == 0f)
			{
				knockBackResist = GetKnockbackMultiplier_ScaledByDifficulty(normalKnockbackMult);
				float num1109 = num1089;
				Vector2 center17 = base.Center;
				Vector2 center18 = Main.player[target].Center;
				Vector2 vector129 = center18 - center17;
				Vector2 vector130 = vector129 - Vector2.UnitY * num1090;
				vector130 += Vector2.UnitX * ((vector129.X < 0f) ? num1091 : (0f - num1091));
				float num1110 = vector129.Length();
				vector129 = Vector2.Normalize(vector129) * num1109;
				vector130 = Vector2.Normalize(vector130) * num1109;
				bool flag69 = Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1);
				if (this.ai[3] >= 120f)
				{
					flag69 = true;
				}
				float num1111 = 8f;
				flag69 = flag69 && vector129.ToRotation() > (float)Math.PI / num1111 && vector129.ToRotation() < (float)Math.PI - (float)Math.PI / num1111;
				bool flag70 = num1110 < num1093;
				bool flag71 = num1110 > num1092;
				if (flag70 || flag71 || !flag69)
				{
					velocity.X = (velocity.X * (num1094 - 1f) + vector130.X) / num1094;
					velocity.Y = (velocity.Y * (num1094 - 1f) + vector130.Y) / num1094;
					if (!flag69)
					{
						if (!flag70 && !flag71)
						{
							this.ai[3]++;
						}
						if (this.ai[3] == 120f)
						{
							netUpdate = true;
						}
					}
					else
					{
						this.ai[3] = 0f;
					}
				}
				else
				{
					this.ai[0] = 1f;
					this.ai[2] = vector129.X;
					this.ai[3] = vector129.Y;
					netUpdate = true;
				}
			}
			else if (this.ai[0] == 1f)
			{
				knockBackResist = 0f;
				bool flag72 = true;
				if (type == 418)
				{
					flag72 = velocity.Length() > 2f;
					if (!flag72 && target >= 0 && !Main.player[target].dead)
					{
						Vector2 value = (Main.player[target].Center - base.Center).SafeNormalize(Vector2.Zero) * 0.1f;
						velocity = Vector2.Lerp(velocity, value, 0.25f);
					}
				}
				if (flag72)
				{
					velocity *= num1096;
				}
				this.ai[1]++;
				if (this.ai[1] >= num1095)
				{
					this.ai[0] = 2f;
					this.ai[1] = 0f;
					netUpdate = true;
					Vector2 vector131 = new Vector2(this.ai[2], this.ai[3]) + new Vector2(Main.rand.Next(-num1097, num1097 + 1), Main.rand.Next(-num1097, num1097 + 1)) * 0.04f;
					vector131.Normalize();
					vector131 *= num1098;
					velocity = vector131;
				}
				if (type == 388 && Main.rand.Next(4) == 0)
				{
					position += netOffset;
					int num1112 = Dust.NewDust(position, width, height, 226, 0f, 0f, 100, default(Color), 0.5f);
					Main.dust[num1112].noGravity = true;
					Dust dust = Main.dust[num1112];
					dust.velocity *= 2f;
					Main.dust[num1112].velocity = Main.dust[num1112].velocity / 2f + Vector2.Normalize(Main.dust[num1112].position - base.Center);
					position -= netOffset;
				}
			}
			else if (this.ai[0] == 2f)
			{
				knockBackResist = 0f;
				float num1113 = num1099;
				this.ai[1]++;
				bool flag73 = Vector2.Distance(base.Center, Main.player[target].Center) > num1100 && base.Center.Y > Main.player[target].Center.Y;
				if ((this.ai[1] >= num1113 && flag73) || velocity.Length() < num1103)
				{
					this.ai[0] = 0f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					velocity /= 2f;
					netUpdate = true;
					if (type == 418)
					{
						this.ai[1] = 45f;
						this.ai[0] = 4f;
					}
				}
				else
				{
					Vector2 center19 = base.Center;
					Vector2 center20 = Main.player[target].Center;
					Vector2 vector132 = center20 - center19;
					vector132.Normalize();
					if (vector132.HasNaNs())
					{
						vector132 = new Vector2(direction, 0f);
					}
					velocity = (velocity * (num1101 - 1f) + vector132 * (velocity.Length() + num1102)) / num1101;
				}
				if (flag68 && Collision.SolidCollision(position, width, height))
				{
					this.ai[0] = 3f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
			}
			else if (this.ai[0] == 4f)
			{
				this.ai[1] -= 3f;
				if (this.ai[1] <= 0f)
				{
					this.ai[0] = 0f;
					this.ai[1] = 0f;
					netUpdate = true;
				}
				velocity *= 0.95f;
			}
			if (flag68 && this.ai[0] != 3f && Vector2.Distance(base.Center, Main.player[target].Center) < 64f)
			{
				this.ai[0] = 3f;
				this.ai[1] = 0f;
				this.ai[2] = 0f;
				this.ai[3] = 0f;
				netUpdate = true;
			}
			if (this.ai[0] != 3f)
			{
				return;
			}
			position = base.Center;
			width = (height = 192);
			position.X -= width / 2;
			position.Y -= height / 2;
			velocity = Vector2.Zero;
			damage = GetAttackDamage_ScaledByDifficulty(80f);
			alpha = 255;
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.2f, 0.7f, 1.1f);
			for (int num1114 = 0; num1114 < 10; num1114++)
			{
				int num1115 = Dust.NewDust(position, width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				Dust dust = Main.dust[num1115];
				dust.velocity *= 1.4f;
				Main.dust[num1115].position = ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2() * ((float)Main.rand.NextDouble() * 96f) + base.Center;
			}
			for (int num1116 = 0; num1116 < 40; num1116++)
			{
				int num1117 = Dust.NewDust(position, width, height, 226, 0f, 0f, 100, default(Color), 0.5f);
				Main.dust[num1117].noGravity = true;
				Dust dust = Main.dust[num1117];
				dust.velocity *= 2f;
				Main.dust[num1117].position = ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2() * ((float)Main.rand.NextDouble() * 96f) + base.Center;
				Main.dust[num1117].velocity = Main.dust[num1117].velocity / 2f + Vector2.Normalize(Main.dust[num1117].position - base.Center);
				if (Main.rand.Next(2) == 0)
				{
					num1117 = Dust.NewDust(position, width, height, 226, 0f, 0f, 100, default(Color), 0.9f);
					Main.dust[num1117].noGravity = true;
					dust = Main.dust[num1117];
					dust.velocity *= 1.2f;
					Main.dust[num1117].position = ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2() * ((float)Main.rand.NextDouble() * 96f) + base.Center;
					Main.dust[num1117].velocity = Main.dust[num1117].velocity / 2f + Vector2.Normalize(Main.dust[num1117].position - base.Center);
				}
				if (Main.rand.Next(4) == 0)
				{
					num1117 = Dust.NewDust(position, width, height, 226, 0f, 0f, 100, default(Color), 0.7f);
					dust = Main.dust[num1117];
					dust.velocity *= 1.2f;
					Main.dust[num1117].position = ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2() * ((float)Main.rand.NextDouble() * 96f) + base.Center;
					Main.dust[num1117].velocity = Main.dust[num1117].velocity / 2f + Vector2.Normalize(Main.dust[num1117].position - base.Center);
				}
			}
			this.ai[1]++;
			if (this.ai[1] >= 3f)
			{
				SoundEngine.PlaySound(SoundID.Item14, position);
				life = 0;
				HitEffect();
				active = false;
			}
		}
		else if (aiStyle == 75)
		{
			int num1118 = -1;
			Vector2 vector133 = Vector2.Zero;
			int num1119 = 0;
			if (type == 390)
			{
				if (localAI[0] == 0f && Main.netMode != 1)
				{
					localAI[0] = 1f;
					int num1120 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y, 391, whoAmI);
					this.ai[0] = num1120;
					netUpdate = true;
				}
				int num1121 = (int)this.ai[0];
				if (Main.npc[num1121].active && Main.npc[num1121].type == 391)
				{
					DiscourageDespawn(60);
					num1118 = num1121;
					vector133 = Vector2.UnitY * -14f;
				}
			}
			if (type == 416)
			{
				if (localAI[0] == 0f && Main.netMode != 1)
				{
					localAI[0] = 1f;
					int num1122 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y, 415, whoAmI);
					this.ai[0] = num1122;
					netUpdate = true;
				}
				int num1123 = (int)this.ai[0];
				if (Main.npc[num1123].active && Main.npc[num1123].type == 415)
				{
					DiscourageDespawn(60);
					num1118 = num1123;
					vector133 = new Vector2(-Main.npc[num1123].spriteDirection * 10, -30f);
				}
			}
			else if (type == 392)
			{
				int num1124 = (int)this.ai[0];
				if (Main.npc[num1124].active && Main.npc[num1124].type == 395)
				{
					DiscourageDespawn(60);
					num1118 = num1124;
					vector133 = Vector2.UnitY * 2f;
					vector133 *= Main.npc[num1124].scale;
					float num1125 = Main.npc[num1124].rotation;
					vector133 = vector133.RotatedBy(num1125);
					rotation = num1125;
					if (Main.netMode != 1)
					{
						bool flag74 = true;
						if (Main.npc[num1124].ai[0] >= 1f || Main.npc[num1124].ai[0] < 0f)
						{
							flag74 = false;
						}
						if (flag74)
						{
							for (int num1126 = 0; num1126 < 2; num1126++)
							{
								if (Main.npc[(int)localAI[num1126]].active && Main.npc[(int)localAI[num1126]].type == 393)
								{
									flag74 = false;
								}
							}
							for (int num1127 = 2; num1127 < 4; num1127++)
							{
								if (Main.npc[(int)localAI[num1127]].active && Main.npc[(int)localAI[num1127]].type == 394)
								{
									flag74 = false;
								}
							}
						}
						if (Main.npc[num1124].ai[3] % 200f == 0f && Main.npc[num1124].ai[0] != 1f)
						{
							for (int num1128 = 0; num1128 < 2; num1128++)
							{
								if (Main.npc[(int)localAI[num1128]].active && Main.npc[(int)localAI[num1128]].type == 393)
								{
									Main.npc[(int)localAI[num1128]].netUpdate = true;
								}
							}
							for (int num1129 = 2; num1129 < 4; num1129++)
							{
								if (Main.npc[(int)localAI[num1129]].active && Main.npc[(int)localAI[num1129]].type == 394)
								{
									Main.npc[(int)localAI[num1129]].netUpdate = true;
								}
							}
							netUpdate = true;
						}
						if (flag74)
						{
							if (!Main.expertMode)
							{
								Main.npc[num1124].ai[0] = 3f;
								Main.npc[num1124].ai[1] = 0f;
								Main.npc[num1124].ai[2] = 0f;
								Main.npc[num1124].ai[3] = 0f;
								Main.npc[num1124].netUpdate = true;
							}
							else
							{
								Main.npc[num1124].ai[0] = 1f;
								Main.npc[num1124].ai[1] = 0f;
								Main.npc[num1124].ai[2] = 0f;
								Main.npc[num1124].ai[3] = 0f;
								Main.npc[num1124].netUpdate = true;
							}
						}
					}
				}
			}
			else if (type == 393)
			{
				int num1130 = (int)this.ai[0];
				if (Main.npc[num1130].active && Main.npc[num1130].type == 395)
				{
					DiscourageDespawn(60);
					num1118 = num1130;
					vector133 = Vector2.UnitY * 29f + ((this.ai[1] == 1f) ? Vector2.UnitX : (-Vector2.UnitX)) * 60f;
					vector133 *= Main.npc[num1130].scale;
					float num1131 = Main.npc[num1130].rotation;
					vector133 = vector133.RotatedBy(num1131);
					rotation = num1131;
				}
			}
			else if (type == 394)
			{
				int num1132 = (int)this.ai[0];
				if (Main.npc[num1132].active && Main.npc[num1132].type == 395)
				{
					DiscourageDespawn(60);
					num1118 = num1132;
					vector133 = Vector2.UnitY * -13f + ((this.ai[1] == 1f) ? Vector2.UnitX : (-Vector2.UnitX)) * 49f;
					vector133 *= Main.npc[num1132].scale;
					float num1133 = Main.npc[num1132].rotation;
					vector133 = vector133.RotatedBy(num1133);
					rotation = num1133;
					num1119 = ((this.ai[1] == 1f) ? 1 : (-1));
				}
			}
			else if (type == 492)
			{
				int num1134 = (int)this.ai[0];
				if (Main.npc[num1134].active && Main.npc[num1134].type == 491)
				{
					DiscourageDespawn(60);
					num1118 = num1134;
					vector133 = new Vector2((-122f + 68f * this.ai[1]) * (float)((Main.npc[num1134].spriteDirection != 1) ? 1 : (-1)), -6f);
					vector133 *= Main.npc[num1134].scale;
					float num1135 = Main.npc[num1134].rotation;
					vector133 = vector133.RotatedBy(num1135);
					rotation = num1135;
				}
			}
			if (num1118 != -1)
			{
				NPC nPC6 = Main.npc[num1118];
				velocity = Vector2.Zero;
				position = nPC6.Center;
				position.X -= width / 2;
				position.Y -= height / 2;
				position += vector133;
				gfxOffY = nPC6.gfxOffY;
				direction = nPC6.direction;
				if (num1119 == 0)
				{
					spriteDirection = nPC6.spriteDirection;
				}
				else
				{
					spriteDirection = num1119;
				}
				if (type == 390)
				{
					timeLeft = nPC6.timeLeft;
					velocity = nPC6.velocity;
					target = nPC6.target;
					if (this.ai[1] < 60f)
					{
						this.ai[1]++;
					}
					if (justHit)
					{
						this.ai[1] = -30f;
					}
					int num1136 = 438;
					int num1137 = 30;
					float num1138 = 7f;
					if (Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
					{
						Vector2 vector134 = Main.player[target].Center - base.Center;
						Vector2 vector135 = Vector2.Normalize(vector134);
						float num1139 = vector134.Length();
						float num1140 = 700f;
						if (type == 214)
						{
							num1140 = 550f;
						}
						if (type == 215)
						{
							num1140 = 800f;
						}
						if (num1139 < num1140)
						{
							if (this.ai[1] == 60f && Math.Sign(vector134.X) == direction)
							{
								this.ai[1] = -60f;
								Vector2 center21 = Main.player[target].Center;
								Vector2 vector136 = base.Center - Vector2.UnitY * 4f;
								Vector2 vector137 = center21 - vector136;
								vector137.X += Main.rand.Next(-50, 51);
								vector137.Y += Main.rand.Next(-50, 51);
								vector137.X *= (float)Main.rand.Next(80, 121) * 0.01f;
								vector137.Y *= (float)Main.rand.Next(80, 121) * 0.01f;
								vector137.Normalize();
								if (float.IsNaN(vector137.X) || float.IsNaN(vector137.Y))
								{
									vector137 = -Vector2.UnitY;
								}
								vector137 *= num1138;
								Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector136.X, vector136.Y, vector137.X, vector137.Y, num1136, num1137, 0f, Main.myPlayer);
								netUpdate = true;
							}
							else
							{
								float num1141 = this.ai[2];
								velocity.X *= 0.5f;
								this.ai[2] = 3f;
								if (Math.Abs(vector135.Y) > Math.Abs(vector135.X) * 2f)
								{
									if (vector135.Y > 0f)
									{
										this.ai[2] = 1f;
									}
									else
									{
										this.ai[2] = 5f;
									}
								}
								else if (Math.Abs(vector135.X) > Math.Abs(vector135.Y) * 2f)
								{
									this.ai[2] = 3f;
								}
								else if (vector135.Y > 0f)
								{
									this.ai[2] = 2f;
								}
								else
								{
									this.ai[2] = 4f;
								}
								if (this.ai[2] != num1141)
								{
									netUpdate = true;
								}
							}
						}
					}
				}
				if (type == 492)
				{
					timeLeft = nPC6.timeLeft;
					velocity = nPC6.velocity;
					if (this.ai[3] < 240f)
					{
						this.ai[3]++;
					}
					if (this.ai[3] == 2f)
					{
						TargetClosest(faceTarget: false);
					}
					if (Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
					{
						Vector2 vector138 = Main.player[target].Center - base.Center;
						Vector2 vector139 = Vector2.Normalize(vector138);
						if (this.ai[3] >= 240f)
						{
							this.ai[3] = 0f;
							Vector2 center22 = Main.player[target].Center;
							Vector2 center23 = base.Center;
							Vector2 vector140 = Vector2.Normalize(center22 - center23);
							if (float.IsNaN(vector140.X) || float.IsNaN(vector140.Y))
							{
								vector140 = Vector2.UnitY;
							}
							vector140 *= 14f;
							vector140 += Vector2.UnitY * -5f;
							if (Main.netMode != 1)
							{
								Projectile.NewProjectile(GetSpawnSource_ForProjectile(), center23.X, center23.Y, vector140.X, vector140.Y, 240, 30, 0f, Main.myPlayer);
							}
							netUpdate = true;
						}
						else
						{
							float num1142 = this.ai[2];
							float[] array3 = new float[8];
							for (int num1143 = 0; num1143 < array3.Length; num1143++)
							{
								array3[num1143] = Vector2.Distance(base.Center + Vector2.UnitY.RotatedBy((float)num1143 * (-(float)Math.PI / 4f)) * 50f, Main.player[target].Center);
							}
							int num1144 = 0;
							for (int num1145 = 1; num1145 < array3.Length; num1145++)
							{
								if (array3[num1144] > array3[num1145])
								{
									num1144 = num1145;
								}
							}
							this.ai[2] = num1144 + 1;
							if (spriteDirection == 1)
							{
								this.ai[2] = 9f - this.ai[2];
							}
							if (this.ai[2] != num1142)
							{
								netUpdate = true;
							}
						}
					}
					else
					{
						if (this.ai[2] != 0f)
						{
							netUpdate = true;
						}
						this.ai[2] = 0f;
					}
				}
				if (type == 394)
				{
					timeLeft = nPC6.timeLeft;
					int attackDamage_ForProjectiles9 = GetAttackDamage_ForProjectiles(50f, 37f);
					this.ai[3] = nPC6.ai[3];
					float num1146 = 440f;
					float num1147 = 140f;
					if (this.ai[3] >= num1146 && this.ai[3] < num1146 + num1147)
					{
						float num1148 = this.ai[3] - num1146;
						if (num1148 % 20f == 0f)
						{
							if (Main.netMode != 1)
							{
								Vector2 spinningpoint3 = num1119 * Vector2.UnitX;
								spinningpoint3 = spinningpoint3.RotatedBy((Main.rand.NextDouble() - 0.5) * 0.7853981852531433);
								spinningpoint3 *= 8f;
								Vector2 vector141 = num1119 * Vector2.UnitX * 36f + base.Center + Vector2.UnitY * 8f;
								Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector141.X, vector141.Y, spinningpoint3.X, spinningpoint3.Y, 448, attackDamage_ForProjectiles9, 0f, Main.myPlayer, 0f, 20f);
							}
							SoundEngine.PlaySound(SoundID.Item39, base.Center);
						}
					}
				}
				if (type == 393)
				{
					timeLeft = nPC6.timeLeft;
					int attackDamage_ForProjectiles10 = GetAttackDamage_ForProjectiles(35f, 30f);
					this.ai[3] = nPC6.ai[3];
					float num1149 = 280f;
					float num1150 = 140f;
					bool flag75 = this.ai[3] >= num1149 && this.ai[3] < num1149 + num1150;
					if (!flag75)
					{
						TargetClosest(faceTarget: false);
						Player player11 = Main.player[target];
						Vector2 v4 = player11.Center - base.Center;
						if (v4.Y < 0f)
						{
							v4.Y = 0f;
						}
						v4.Normalize();
						if (float.IsNaN(v4.X) || float.IsNaN(v4.Y))
						{
							v4 = Vector2.UnitY;
						}
						this.ai[2] = v4.ToRotation();
					}
					if (flag75)
					{
						float num1151 = this.ai[3] - num1149;
						if (num1151 % 6f == 0f)
						{
							if (Main.netMode != 1)
							{
								Vector2 spinningpoint4 = this.ai[2].ToRotationVector2();
								spinningpoint4 = spinningpoint4.RotatedBy((Main.rand.NextDouble() - 0.5) * 0.7853981852531433 / 3.0);
								spinningpoint4 *= 16f;
								Vector2 vector142 = base.Center + spinningpoint4 * 1f;
								Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector142.X, vector142.Y, spinningpoint4.X, spinningpoint4.Y, 449, attackDamage_ForProjectiles10, 0f, Main.myPlayer);
							}
							SoundEngine.PlaySound(SoundID.Item12, base.Center);
						}
					}
				}
				if (type != 392)
				{
					return;
				}
				timeLeft = nPC6.timeLeft;
				int attackDamage_ForProjectiles11 = GetAttackDamage_ForProjectiles(50f, 50f);
				this.ai[3] = nPC6.ai[3];
				float num1152 = 20f;
				float num1153 = 240f;
				if (this.ai[3] >= num1152 && this.ai[3] < num1152 + num1153 && nPC6.ai[0] == 0f)
				{
					float num1154 = this.ai[3] - num1152;
					if (num1154 == 0f)
					{
						if (Main.netMode != 1)
						{
							Vector2 center24 = base.Center;
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), center24.X, center24.Y, 0f, 0f, 447, attackDamage_ForProjectiles11, 0f, Main.myPlayer, whoAmI + 1);
						}
						SoundEngine.PlaySound(SoundID.Item12, base.Center);
					}
				}
				bool flag76 = false;
				int maxValue4 = 1000;
				int maxValue5 = 1000;
				int num1155 = 450;
				int attackDamage_ForProjectiles12 = GetAttackDamage_ForProjectiles(30f, 25f);
				if (nPC6.ai[0] == 2f)
				{
					flag76 = true;
					maxValue5 = 120;
					maxValue4 = 120;
				}
				if (!flag76)
				{
					num1152 = 280f;
					num1153 = 120f;
					flag76 = flag76 || (this.ai[3] >= num1152 && this.ai[3] < num1152 + num1153);
					if (flag76)
					{
						maxValue5 = 90;
						maxValue4 = 60;
					}
				}
				if (!flag76)
				{
					num1152 = 440f;
					num1153 = 140f;
					flag76 = flag76 || (this.ai[3] >= num1152 && this.ai[3] < num1152 + num1153);
					if (flag76)
					{
						maxValue5 = 60;
						maxValue4 = 90;
					}
				}
				bool flag77 = true;
				bool flag78 = true;
				bool flag79 = true;
				bool flag80 = true;
				if (Main.npc[(int)localAI[0]].active && Main.npc[(int)localAI[0]].type == 393)
				{
					flag77 = false;
				}
				if (Main.npc[(int)localAI[1]].active && Main.npc[(int)localAI[1]].type == 393)
				{
					flag78 = false;
				}
				if (Main.npc[(int)localAI[2]].active && Main.npc[(int)localAI[2]].type == 394)
				{
					flag79 = false;
				}
				if (Main.npc[(int)localAI[3]].active && Main.npc[(int)localAI[3]].type == 394)
				{
					flag80 = false;
				}
				if (flag76)
				{
					bool flag81 = true;
					if (flag77 && Main.rand.Next(maxValue4) == 0)
					{
						if (Main.netMode != 1)
						{
							Vector2 spinningpoint5 = new Vector2(-1f * (float)Main.rand.NextDouble() * 3f, 1f);
							spinningpoint5 = spinningpoint5.RotatedBy((Main.rand.NextDouble() - 0.5) * 0.7853981852531433);
							spinningpoint5 *= 3f;
							Vector2 vector143 = -1f * Vector2.UnitX * Main.rand.Next(50, 70) + base.Center + Vector2.UnitY * Main.rand.Next(30, 45);
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector143.X, vector143.Y, spinningpoint5.X, spinningpoint5.Y, num1155, attackDamage_ForProjectiles12, 0f, Main.myPlayer);
						}
						SoundEngine.PlaySound(SoundID.Item39, base.Center);
					}
					if (flag78 && Main.rand.Next(maxValue4) == 0)
					{
						if (Main.netMode != 1)
						{
							Vector2 spinningpoint6 = new Vector2(1f * (float)Main.rand.NextDouble() * 3f, 1f);
							spinningpoint6 = spinningpoint6.RotatedBy((Main.rand.NextDouble() - 0.5) * 0.7853981852531433);
							spinningpoint6 *= 3f;
							Vector2 vector144 = 1f * Vector2.UnitX * Main.rand.Next(50, 70) + base.Center + Vector2.UnitY * Main.rand.Next(30, 45);
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector144.X, vector144.Y, spinningpoint6.X, spinningpoint6.Y, num1155, attackDamage_ForProjectiles12, 0f, Main.myPlayer);
						}
						SoundEngine.PlaySound(SoundID.Item39, base.Center);
					}
				}
				if (flag76)
				{
					bool flag82 = true;
					if (flag79 && Main.rand.Next(maxValue5) == 0)
					{
						if (Main.netMode != 1)
						{
							Vector2 spinningpoint7 = new Vector2(-1f * (float)Main.rand.NextDouble() * 2f, -1f);
							spinningpoint7 = spinningpoint7.RotatedBy((Main.rand.NextDouble() - 0.5) * 0.7853981852531433);
							spinningpoint7 *= 3f;
							Vector2 vector145 = -1f * Vector2.UnitX * Main.rand.Next(30, 60) + base.Center + Vector2.UnitY * Main.rand.Next(-30, -10);
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector145.X, vector145.Y, spinningpoint7.X, spinningpoint7.Y, num1155, attackDamage_ForProjectiles12, 0f, Main.myPlayer);
						}
						SoundEngine.PlaySound(SoundID.Item39, base.Center);
					}
					if (flag80 && Main.rand.Next(maxValue5) == 0)
					{
						if (Main.netMode != 1)
						{
							Vector2 spinningpoint8 = new Vector2(1f * (float)Main.rand.NextDouble() * 2f, -1f);
							spinningpoint8 = spinningpoint8.RotatedBy((Main.rand.NextDouble() - 0.5) * 0.7853981852531433);
							spinningpoint8 *= 3f;
							Vector2 vector146 = 1f * Vector2.UnitX * Main.rand.Next(30, 60) + base.Center + Vector2.UnitY * Main.rand.Next(-30, -10);
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector146.X, vector146.Y, spinningpoint8.X, spinningpoint8.Y, num1155, attackDamage_ForProjectiles12, 0f, Main.myPlayer);
						}
						SoundEngine.PlaySound(SoundID.Item39, base.Center);
					}
				}
				if (flag77 && Main.rand.Next(8) == 0)
				{
					int num1156 = Dust.NewDust(-1f * Vector2.UnitX * Main.rand.Next(50, 70) + base.Center + Vector2.UnitY * Main.rand.Next(15, 30), 4, 16, (Main.rand.Next(4) != 0) ? 31 : 228, 0f, 0f, 100, default(Color), 1.2f);
					Main.dust[num1156].velocity = new Vector2(-1f * (float)Main.rand.NextDouble() * 3f, 1f).RotatedBy((Main.rand.NextDouble() - 0.5) * 0.7853981852531433);
					Dust dust = Main.dust[num1156];
					dust.velocity *= 0.5f;
					Main.dust[num1156].velocity.Y = 0f - Math.Abs(Main.dust[num1156].velocity.Y);
				}
				if (flag78 && Main.rand.Next(8) == 0)
				{
					int num1157 = Dust.NewDust(Vector2.UnitX * Main.rand.Next(50, 70) + base.Center + Vector2.UnitY * Main.rand.Next(15, 30), 4, 16, (Main.rand.Next(4) != 0) ? 31 : 228, 0f, 0f, 100, default(Color), 1.2f);
					Main.dust[num1157].velocity = new Vector2((float)Main.rand.NextDouble() * 3f, 1f).RotatedBy((Main.rand.NextDouble() - 0.5) * 0.7853981852531433);
					Dust dust = Main.dust[num1157];
					dust.velocity *= 0.5f;
					Main.dust[num1157].velocity.Y = 0f - Math.Abs(Main.dust[num1157].velocity.Y);
				}
				if (flag79 && Main.rand.Next(8) == 0)
				{
					int num1158 = Dust.NewDust(-1f * Vector2.UnitX * Main.rand.Next(30, 60) + base.Center + Vector2.UnitY * Main.rand.Next(-30, -10), 4, 16, (Main.rand.Next(4) != 0) ? 31 : 228, 0f, 0f, 100, default(Color), 1.2f);
					Main.dust[num1158].velocity = new Vector2(-1f * (float)Main.rand.NextDouble() * 2f, 1f).RotatedBy((Main.rand.NextDouble() - 0.5) * 0.7853981852531433);
					Dust dust = Main.dust[num1158];
					dust.velocity *= 0.5f;
					Main.dust[num1158].velocity.Y = 0f - Math.Abs(Main.dust[num1158].velocity.Y);
				}
				if (flag80 && Main.rand.Next(8) == 0)
				{
					int num1159 = Dust.NewDust(Vector2.UnitX * Main.rand.Next(30, 60) + base.Center + Vector2.UnitY * Main.rand.Next(-30, -10), 4, 16, (Main.rand.Next(4) != 0) ? 31 : 228, 0f, 0f, 100, default(Color), 1.2f);
					Main.dust[num1159].velocity = new Vector2((float)Main.rand.NextDouble() * 2f, 1f).RotatedBy((Main.rand.NextDouble() - 0.5) * 0.7853981852531433);
					Dust dust = Main.dust[num1159];
					dust.velocity *= 0.5f;
					Main.dust[num1159].velocity.Y = 0f - Math.Abs(Main.dust[num1159].velocity.Y);
				}
			}
			else if (type == 390)
			{
				Transform(382);
			}
			else if (type == 416)
			{
				Transform(518);
			}
			else
			{
				life = 0;
				HitEffect();
				active = false;
			}
		}
		else if (aiStyle == 76)
		{
			if (localAI[3] == 0f && Main.netMode != 1 && type == 395)
			{
				localAI[3] = 1f;
				int[] array4 = new int[4];
				int num1160 = 0;
				for (int num1161 = 0; num1161 < 2; num1161++)
				{
					int num1162 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X + num1161 * 300 - 150, (int)base.Center.Y, 393, whoAmI);
					Main.npc[num1162].ai[1] = num1161;
					Main.npc[num1162].netUpdate = true;
					array4[num1160++] = num1162;
				}
				for (int num1163 = 0; num1163 < 2; num1163++)
				{
					int num1164 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X + num1163 * 300 - 150, (int)base.Center.Y, 394, whoAmI);
					Main.npc[num1164].ai[1] = num1163;
					Main.npc[num1164].netUpdate = true;
					array4[num1160++] = num1164;
				}
				int num1165 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y, 392, whoAmI);
				Main.npc[num1165].ai[0] = whoAmI;
				Main.npc[num1165].netUpdate = true;
				for (int num1166 = 0; num1166 < 4; num1166++)
				{
					Main.npc[array4[num1166]].ai[0] = whoAmI;
				}
				for (int num1167 = 0; num1167 < 4; num1167++)
				{
					Main.npc[num1165].localAI[num1167] = array4[num1167];
				}
			}
			if (this.ai[0] == 3f)
			{
				StrikeNPCNoInteraction(9999, 0f, 0);
				return;
			}
			Vector2 center25 = base.Center;
			Player player12 = Main.player[target];
			float num1168 = 5600f;
			if (target < 0 || target == 255 || player12.dead || !player12.active || Vector2.Distance(player12.Center, center25) > num1168)
			{
				TargetClosest();
				player12 = Main.player[target];
				netUpdate = true;
			}
			if ((player12.dead || !player12.active || Vector2.Distance(player12.Center, center25) > num1168) && this.ai[0] != 1f)
			{
				if (this.ai[0] == 0f)
				{
					this.ai[0] = -1f;
				}
				if (this.ai[0] == 2f)
				{
					this.ai[0] = -2f;
				}
				netUpdate = true;
			}
			if (this.ai[0] == -1f || this.ai[0] == -2f)
			{
				velocity.Y -= 0.4f;
				EncourageDespawn(10);
				if (!player12.dead)
				{
					timeLeft = 300;
					if (this.ai[0] == -2f)
					{
						this.ai[0] = 2f;
					}
					if (this.ai[0] == 0f)
					{
						this.ai[0] = 0f;
					}
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
			}
			else if (this.ai[0] == 0f)
			{
				int num1169 = 0;
				int num1170 = 0;
				if (this.ai[3] >= 580f)
				{
					num1169 = 0;
				}
				else if (this.ai[3] >= 440f)
				{
					num1169 = 5;
				}
				else if (this.ai[3] >= 420f)
				{
					num1169 = 4;
				}
				else if (this.ai[3] >= 280f)
				{
					num1169 = 3;
				}
				else if (this.ai[3] >= 260f)
				{
					num1169 = 2;
				}
				else if (this.ai[3] >= 20f)
				{
					num1169 = 1;
				}
				this.ai[3]++;
				if (this.ai[3] >= 600f)
				{
					this.ai[3] = 0f;
				}
				num1170 = num1169;
				if (this.ai[3] >= 580f)
				{
					num1169 = 0;
				}
				else if (this.ai[3] >= 440f)
				{
					num1169 = 5;
				}
				else if (this.ai[3] >= 420f)
				{
					num1169 = 4;
				}
				else if (this.ai[3] >= 280f)
				{
					num1169 = 3;
				}
				else if (this.ai[3] >= 260f)
				{
					num1169 = 2;
				}
				else if (this.ai[3] >= 20f)
				{
					num1169 = 1;
				}
				if (num1169 != num1170)
				{
					if (num1169 == 0)
					{
						this.ai[2] = 0f;
					}
					if (num1169 == 1)
					{
						this.ai[2] = ((Math.Sign((player12.Center - center25).X) == 1) ? 1 : (-1));
					}
					if (num1169 == 2)
					{
						this.ai[2] = 0f;
					}
					netUpdate = true;
				}
				if (num1169 == 0)
				{
					if (this.ai[2] == 0f)
					{
						this.ai[2] = -600 * Math.Sign((center25 - player12.Center).X);
					}
					Vector2 vector147 = player12.Center + new Vector2(this.ai[2], -250f) - center25;
					if (vector147.Length() < 50f)
					{
						this.ai[3] = 19f;
					}
					else
					{
						vector147.Normalize();
						velocity = Vector2.Lerp(velocity, vector147 * 16f, 0.1f);
					}
				}
				if (num1169 == 1)
				{
					int num1171 = (int)base.Center.X / 16;
					int num1172 = (int)(position.Y + (float)height) / 16;
					int num1173 = 0;
					if (Main.tile[num1171, num1172].nactive() && Main.tileSolid[Main.tile[num1171, num1172].type] && !Main.tileSolidTop[Main.tile[num1171, num1172].type])
					{
						num1173 = 1;
					}
					else
					{
						for (; num1173 < 150 && num1172 + num1173 < Main.maxTilesY; num1173++)
						{
							int num1174 = num1172 + num1173;
							if (Main.tile[num1171, num1174].nactive() && Main.tileSolid[Main.tile[num1171, num1174].type] && !Main.tileSolidTop[Main.tile[num1171, num1174].type])
							{
								num1173--;
								break;
							}
						}
					}
					float num1175 = num1173 * 16;
					float num1176 = 250f;
					if (num1175 < num1176)
					{
						float num1177 = -4f;
						if (0f - num1177 > num1175)
						{
							num1177 = 0f - num1175;
						}
						velocity.Y = MathHelper.Lerp(velocity.Y, num1177, 0.05f);
					}
					else
					{
						velocity.Y *= 0.95f;
					}
					velocity.X = 3.5f * this.ai[2];
				}
				switch (num1169)
				{
				case 2:
				{
					if (this.ai[2] == 0f)
					{
						this.ai[2] = 300 * Math.Sign((center25 - player12.Center).X);
					}
					Vector2 vector148 = player12.Center + new Vector2(this.ai[2], -170f) - center25;
					int num1186 = (int)base.Center.X / 16;
					int num1187 = (int)(position.Y + (float)height) / 16;
					int num1188 = 0;
					if (Main.tile[num1186, num1187].nactive() && Main.tileSolid[Main.tile[num1186, num1187].type] && !Main.tileSolidTop[Main.tile[num1186, num1187].type])
					{
						num1188 = 1;
					}
					else
					{
						for (; num1188 < 150 && num1187 + num1188 < Main.maxTilesY; num1188++)
						{
							int num1189 = num1187 + num1188;
							if (Main.tile[num1186, num1189].nactive() && Main.tileSolid[Main.tile[num1186, num1189].type] && !Main.tileSolidTop[Main.tile[num1186, num1189].type])
							{
								num1188--;
								break;
							}
						}
					}
					float num1190 = num1188 * 16;
					float num1191 = 170f;
					if (num1190 < num1191)
					{
						vector148.Y -= num1191 - num1190;
					}
					if (vector148.Length() < 70f)
					{
						this.ai[3] = 279f;
						break;
					}
					vector148.Normalize();
					velocity = Vector2.Lerp(velocity, vector148 * 20f, 0.1f);
					break;
				}
				case 3:
				{
					float num1178 = 0.85f;
					int num1179 = (int)base.Center.X / 16;
					int num1180 = (int)(position.Y + (float)height) / 16;
					int num1181 = 0;
					if (Main.tile[num1179, num1180].nactive() && Main.tileSolid[Main.tile[num1179, num1180].type] && !Main.tileSolidTop[Main.tile[num1179, num1180].type])
					{
						num1181 = 1;
					}
					else
					{
						for (; num1181 < 150 && num1180 + num1181 < Main.maxTilesY; num1181++)
						{
							int num1182 = num1180 + num1181;
							if (Main.tile[num1179, num1182].nactive() && Main.tileSolid[Main.tile[num1179, num1182].type] && !Main.tileSolidTop[Main.tile[num1179, num1182].type])
							{
								num1181--;
								break;
							}
						}
					}
					float num1183 = num1181 * 16;
					float num1184 = 170f;
					if (num1183 < num1184)
					{
						float num1185 = -4f;
						if (0f - num1185 > num1183)
						{
							num1185 = 0f - num1183;
						}
						velocity.Y = MathHelper.Lerp(velocity.Y, num1185, 0.05f);
					}
					else
					{
						velocity.Y *= num1178;
					}
					velocity.X *= num1178;
					break;
				}
				}
				switch (num1169)
				{
				case 4:
				{
					Vector2 vector149 = player12.Center + new Vector2(0f, -250f) - center25;
					if (vector149.Length() < 50f)
					{
						this.ai[3] = 439f;
						break;
					}
					vector149.Normalize();
					velocity = Vector2.Lerp(velocity, vector149 * 16f, 0.1f);
					break;
				}
				case 5:
					velocity *= 0.85f;
					break;
				}
			}
			else if (this.ai[0] == 1f)
			{
				dontTakeDamage = false;
				velocity *= 0.96f;
				float num1192 = 150f;
				this.ai[1]++;
				if (this.ai[1] >= num1192)
				{
					this.ai[0] = 2f;
					this.ai[1] = 0f;
					rotation = 0f;
					netUpdate = true;
				}
				else if (this.ai[1] < 40f)
				{
					rotation = Vector2.UnitY.RotatedBy(this.ai[1] / 40f * ((float)Math.PI * 2f)).Y * 0.2f;
				}
				else if (this.ai[1] < 80f)
				{
					rotation = Vector2.UnitY.RotatedBy(this.ai[1] / 20f * ((float)Math.PI * 2f)).Y * 0.3f;
				}
				else if (this.ai[1] < 120f)
				{
					rotation = Vector2.UnitY.RotatedBy(this.ai[1] / 10f * ((float)Math.PI * 2f)).Y * 0.4f;
				}
				else
				{
					rotation = (this.ai[1] - 120f) / 30f * ((float)Math.PI * 2f);
				}
			}
			else if (this.ai[0] == 2f)
			{
				int num1193 = 80;
				float num1194 = 3600f;
				float num1195 = 120f;
				float num1196 = 60f;
				int num1197 = 0;
				if (this.ai[3] % num1195 >= num1196)
				{
					num1197 = 1;
				}
				int num1198 = num1197;
				num1197 = 0;
				this.ai[3]++;
				if (this.ai[3] % num1195 >= num1196)
				{
					num1197 = 1;
				}
				if (num1197 != num1198)
				{
					if (num1197 == 1)
					{
						this.ai[2] = ((Math.Sign((player12.Center - center25).X) == 1) ? 1 : (-1));
						if (Main.netMode != 1)
						{
							Vector2 center26 = base.Center;
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), center26.X, center26.Y, 0f, 0f, 447, num1193, 0f, Main.myPlayer, whoAmI + 1);
						}
						SoundEngine.PlaySound(SoundID.Item12, base.Center);
					}
					netUpdate = true;
				}
				if (this.ai[3] >= num1194)
				{
					this.ai[0] = 2f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
				else if (num1197 == 0)
				{
					Vector2 vector150 = player12.Center + new Vector2(this.ai[2] * 350f, -250f) - center25;
					vector150.Normalize();
					velocity = Vector2.Lerp(velocity, vector150 * 16f, 0.1f);
				}
				else
				{
					int num1199 = (int)base.Center.X / 16;
					int num1200 = (int)(position.Y + (float)height) / 16;
					int num1201 = 0;
					if (Main.tile[num1199, num1200].nactive() && Main.tileSolid[Main.tile[num1199, num1200].type] && !Main.tileSolidTop[Main.tile[num1199, num1200].type])
					{
						num1201 = 1;
					}
					else
					{
						for (; num1201 < 150 && num1200 + num1201 < Main.maxTilesY; num1201++)
						{
							int num1202 = num1200 + num1201;
							if (Main.tile[num1199, num1202].nactive() && Main.tileSolid[Main.tile[num1199, num1202].type] && !Main.tileSolidTop[Main.tile[num1199, num1202].type])
							{
								num1201--;
								break;
							}
						}
					}
					float num1203 = num1201 * 16;
					float num1204 = 250f;
					if (num1203 < num1204)
					{
						float num1205 = -4f;
						if (0f - num1205 > num1203)
						{
							num1205 = 0f - num1203;
						}
						velocity.Y = MathHelper.Lerp(velocity.Y, num1205, 0.05f);
					}
					else
					{
						velocity.Y *= 0.95f;
					}
					velocity.X = 8f * this.ai[2];
				}
				rotation = 0f;
			}
			bool flag83 = false;
			if (position.Y < -100f)
			{
				flag83 = true;
			}
			if (position.X < -100f)
			{
				flag83 = true;
			}
			if (position.Y > (float)(Main.maxTilesY * 16 + 100))
			{
				flag83 = true;
			}
			if (position.X > (float)(Main.maxTilesX * 16 + 100))
			{
				flag83 = true;
			}
			if (flag83)
			{
				position = Vector2.Clamp(position, new Vector2(-100f), new Vector2(100f) + new Vector2(Main.maxTilesX, Main.maxTilesY) * 16f);
				active = false;
				netUpdate = true;
			}
		}
		else if (aiStyle == 77)
		{
			if (this.ai[0] != -1f && this.ai[0] != 2f && Main.rand.Next(200) == 0)
			{
				SoundEngine.PlaySound(29, (int)base.Center.X, (int)base.Center.Y, Main.rand.Next(93, 100));
			}
			if (localAI[3] == 0f)
			{
				netUpdate = true;
				localAI[3] = 1f;
				this.ai[0] = -1f;
			}
			if (this.ai[0] == -2f)
			{
				dontTakeDamage = true;
				this.ai[1]++;
				if (this.ai[1] == 30f)
				{
					SoundEngine.PlaySound(29, (int)base.Center.X, (int)base.Center.Y, 92);
				}
				if (this.ai[1] < 60f)
				{
					MoonlordDeathDrama.RequestLight(this.ai[1] / 30f, base.Center);
				}
				if (this.ai[1] == 60f)
				{
					this.ai[1] = 0f;
					this.ai[0] = 0f;
					if (Main.netMode != 1 && type == 398)
					{
						this.ai[2] = Main.rand.Next(3);
						this.ai[2] = 0f;
						netUpdate = true;
					}
				}
			}
			if (this.ai[0] == -1f)
			{
				dontTakeDamage = true;
				this.ai[1]++;
				if (this.ai[1] == 30f)
				{
					SoundEngine.PlaySound(29, (int)base.Center.X, (int)base.Center.Y, 92);
				}
				if (this.ai[1] < 60f)
				{
					MoonlordDeathDrama.RequestLight(this.ai[1] / 30f, base.Center);
				}
				if (this.ai[1] == 60f)
				{
					this.ai[1] = 0f;
					this.ai[0] = 0f;
					if (Main.netMode != 1 && type == 398)
					{
						this.ai[2] = Main.rand.Next(3);
						this.ai[2] = 0f;
						netUpdate = true;
						int[] array5 = new int[3];
						int num1206 = 0;
						for (int num1207 = 0; num1207 < 2; num1207++)
						{
							int num1208 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X + num1207 * 800 - 400, (int)base.Center.Y - 100, 397, whoAmI);
							Main.npc[num1208].ai[2] = num1207;
							Main.npc[num1208].netUpdate = true;
							array5[num1206++] = num1208;
						}
						int num1209 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y - 400, 396, whoAmI);
						Main.npc[num1209].netUpdate = true;
						array5[num1206++] = num1209;
						for (int num1210 = 0; num1210 < 3; num1210++)
						{
							Main.npc[array5[num1210]].ai[3] = whoAmI;
						}
						for (int num1211 = 0; num1211 < 3; num1211++)
						{
							localAI[num1211] = array5[num1211];
						}
					}
				}
			}
			if (this.ai[0] == 0f)
			{
				dontTakeDamage = true;
				TargetClosest(faceTarget: false);
				Vector2 vector151 = Main.player[target].Center - base.Center + new Vector2(0f, 130f);
				if (vector151.Length() > 20f)
				{
					Vector2 desiredVelocity = Vector2.Normalize(vector151 - velocity) * 8f;
					Vector2 value2 = velocity;
					SimpleFlyMovement(desiredVelocity, 0.5f);
					velocity = Vector2.Lerp(velocity, value2, 0.5f);
				}
				if (Main.netMode != 1)
				{
					bool flag84 = false;
					if (localAI[0] < 0f || localAI[1] < 0f || localAI[2] < 0f)
					{
						flag84 = true;
					}
					else if (!Main.npc[(int)localAI[0]].active || Main.npc[(int)localAI[0]].type != 397)
					{
						flag84 = true;
					}
					else if (!Main.npc[(int)localAI[1]].active || Main.npc[(int)localAI[1]].type != 397)
					{
						flag84 = true;
					}
					else if (!Main.npc[(int)localAI[2]].active || Main.npc[(int)localAI[2]].type != 396)
					{
						flag84 = true;
					}
					if (flag84)
					{
						life = 0;
						HitEffect();
						active = false;
					}
					bool flag85 = true;
					if (Main.npc[(int)localAI[0]].ai[0] != -2f)
					{
						flag85 = false;
					}
					if (Main.npc[(int)localAI[1]].ai[0] != -2f)
					{
						flag85 = false;
					}
					if (Main.npc[(int)localAI[2]].ai[0] != -2f)
					{
						flag85 = false;
					}
					if (flag85)
					{
						this.ai[0] = 1f;
						dontTakeDamage = false;
						netUpdate = true;
					}
				}
			}
			else if (this.ai[0] == 1f)
			{
				dontTakeDamage = false;
				TargetClosest(faceTarget: false);
				Vector2 vector152 = Main.player[target].Center - base.Center + new Vector2(0f, 130f);
				if (vector152.Length() > 20f)
				{
					Vector2 desiredVelocity2 = Vector2.Normalize(vector152 - velocity) * 8f;
					Vector2 value3 = velocity;
					SimpleFlyMovement(desiredVelocity2, 0.5f);
					velocity = Vector2.Lerp(velocity, value3, 0.5f);
				}
			}
			else if (this.ai[0] == 2f)
			{
				dontTakeDamage = true;
				velocity = Vector2.Lerp(value2: new Vector2(0f, -0.5f), value1: velocity, amount: 0.98f);
				this.ai[1]++;
				if (this.ai[1] < 60f)
				{
					MoonlordDeathDrama.RequestLight(this.ai[1] / 60f, base.Center);
				}
				if (this.ai[1] == 60f)
				{
					for (int num1212 = 0; num1212 < 1000; num1212++)
					{
						Projectile projectile = Main.projectile[num1212];
						if (projectile.active && (projectile.type == 456 || projectile.type == 462 || projectile.type == 455 || projectile.type == 452 || projectile.type == 454))
						{
							projectile.Kill();
						}
					}
					for (int num1213 = 0; num1213 < Main.maxNPCs; num1213++)
					{
						NPC nPC7 = Main.npc[num1213];
						if (nPC7.active && nPC7.type == 400)
						{
							nPC7.HitEffect(0, 9999.0);
							nPC7.active = false;
						}
					}
				}
				if (this.ai[1] % 3f == 0f && this.ai[1] < 580f && this.ai[1] > 60f)
				{
					Vector2 vector153 = Utils.RandomVector2(Main.rand, -1f, 1f);
					if (vector153 != Vector2.Zero)
					{
						vector153.Normalize();
					}
					vector153 *= 20f + Main.rand.NextFloat() * 400f;
					bool flag86 = true;
					Vector2 vector154 = base.Center + vector153;
					Point point5 = vector154.ToTileCoordinates();
					if (!WorldGen.InWorld(point5.X, point5.Y))
					{
						flag86 = false;
					}
					if (flag86 && WorldGen.SolidTile(point5.X, point5.Y))
					{
						flag86 = false;
					}
					float num1214 = Main.rand.Next(6, 19);
					float num1215 = (float)Math.PI * 2f / num1214;
					float num1216 = (float)Math.PI * 2f * Main.rand.NextFloat();
					float num1217 = 1f + Main.rand.NextFloat() * 2f;
					float num1218 = 1f + Main.rand.NextFloat();
					float fadeIn = 0.4f + Main.rand.NextFloat();
					int num1219 = Utils.SelectRandom<int>(Main.rand, 31, 229);
					if (flag86 && !Main.dedServ)
					{
						MoonlordDeathDrama.AddExplosion(vector154);
						for (float num1220 = 0f; num1220 < num1214 * 2f; num1220++)
						{
							Dust dust8 = Main.dust[Dust.NewDust(vector154, 0, 0, 229)];
							dust8.noGravity = true;
							dust8.position = vector154;
							dust8.velocity = Vector2.UnitY.RotatedBy(num1216 + num1215 * num1220) * num1217 * (Main.rand.NextFloat() * 1.6f + 1.6f);
							dust8.fadeIn = fadeIn;
							dust8.scale = num1218;
						}
					}
					for (float num1221 = 0f; num1221 < this.ai[1] / 60f; num1221++)
					{
						Vector2 vector155 = Utils.RandomVector2(Main.rand, -1f, 1f);
						if (vector155 != Vector2.Zero)
						{
							vector155.Normalize();
						}
						vector155 *= 20f + Main.rand.NextFloat() * 800f;
						Vector2 vec2 = base.Center + vector155;
						Point point6 = vec2.ToTileCoordinates();
						bool flag87 = true;
						if (!WorldGen.InWorld(point6.X, point6.Y))
						{
							flag87 = false;
						}
						if (flag87 && WorldGen.SolidTile(point6.X, point6.Y))
						{
							flag87 = false;
						}
						if (flag87)
						{
							Dust dust9 = Main.dust[Dust.NewDust(vec2, 0, 0, num1219)];
							dust9.noGravity = true;
							dust9.position = vec2;
							dust9.velocity = -Vector2.UnitY * num1217 * (Main.rand.NextFloat() * 0.9f + 1.6f);
							dust9.fadeIn = fadeIn;
							dust9.scale = num1218;
						}
					}
				}
				if (this.ai[1] % 15f == 0f && this.ai[1] < 480f && this.ai[1] >= 90f && Main.netMode != 1)
				{
					Vector2 vector156 = Utils.RandomVector2(Main.rand, -1f, 1f);
					if (vector156 != Vector2.Zero)
					{
						vector156.Normalize();
					}
					vector156 *= 20f + Main.rand.NextFloat() * 400f;
					bool flag88 = true;
					Vector2 vec3 = base.Center + vector156;
					Point point7 = vec3.ToTileCoordinates();
					if (!WorldGen.InWorld(point7.X, point7.Y))
					{
						flag88 = false;
					}
					if (flag88 && WorldGen.SolidTile(point7.X, point7.Y))
					{
						flag88 = false;
					}
					if (flag88)
					{
						float num1222 = (float)(Main.rand.Next(4) < 2).ToDirectionInt() * ((float)Math.PI / 8f + (float)Math.PI / 4f * Main.rand.NextFloat());
						Vector2 vector157 = new Vector2(0f, (0f - Main.rand.NextFloat()) * 0.5f - 0.5f).RotatedBy(num1222) * 6f;
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vec3.X, vec3.Y, vector157.X, vector157.Y, 622, 0, 0f, Main.myPlayer);
					}
				}
				if (this.ai[1] == 1f)
				{
					SoundEngine.PlaySound(SoundID.NPCDeath61, base.Center);
				}
				if (this.ai[1] >= 480f)
				{
					MoonlordDeathDrama.RequestLight((this.ai[1] - 480f) / 120f, base.Center);
				}
				if (this.ai[1] >= 600f)
				{
					life = 0;
					HitEffect(0, 1337.0);
					checkDead();
					return;
				}
			}
			else if (this.ai[0] == 3f)
			{
				dontTakeDamage = true;
				velocity = Vector2.Lerp(value2: new Vector2(direction, -0.5f), value1: velocity, amount: 0.98f);
				this.ai[1]++;
				if (this.ai[1] < 60f)
				{
					MoonlordDeathDrama.RequestLight(this.ai[1] / 40f, base.Center);
				}
				if (this.ai[1] == 40f)
				{
					for (int num1223 = 0; num1223 < 1000; num1223++)
					{
						Projectile projectile2 = Main.projectile[num1223];
						if (projectile2.active && (projectile2.type == 456 || projectile2.type == 462 || projectile2.type == 455 || projectile2.type == 452 || projectile2.type == 454))
						{
							projectile2.active = false;
							if (Main.netMode != 1)
							{
								NetMessage.SendData(27, -1, -1, null, num1223);
							}
						}
					}
					for (int num1224 = 0; num1224 < Main.maxNPCs; num1224++)
					{
						NPC nPC8 = Main.npc[num1224];
						if (nPC8.active && nPC8.type == 400)
						{
							nPC8.active = false;
							if (Main.netMode != 1)
							{
								NetMessage.SendData(23, -1, -1, null, nPC8.whoAmI);
							}
						}
					}
					for (int num1225 = 0; num1225 < 600; num1225++)
					{
						Gore gore2 = Main.gore[num1225];
						if (gore2.active && gore2.type >= 619 && gore2.type <= 622)
						{
							gore2.active = false;
						}
					}
				}
				if (this.ai[1] >= 60f)
				{
					for (int num1226 = 0; num1226 < Main.maxNPCs; num1226++)
					{
						NPC nPC9 = Main.npc[num1226];
						if (nPC9.active && (nPC9.type == 400 || nPC9.type == 397 || nPC9.type == 396))
						{
							nPC9.active = false;
							if (Main.netMode != 1)
							{
								NetMessage.SendData(23, -1, -1, null, nPC9.whoAmI);
							}
						}
					}
					active = false;
					if (Main.netMode != 1)
					{
						NetMessage.SendData(23, -1, -1, null, whoAmI);
					}
					LunarApocalypseIsUp = false;
					if (Main.netMode == 2)
					{
						NetMessage.SendData(7);
					}
					return;
				}
			}
			bool flag89 = false;
			if (this.ai[0] == -2f || this.ai[0] == -1f || this.ai[0] == 2f || this.ai[0] == 3f)
			{
				flag89 = true;
			}
			if (Main.player[target].active && !Main.player[target].dead)
			{
				flag89 = true;
			}
			if (!flag89)
			{
				for (int num1227 = 0; num1227 < 255; num1227++)
				{
					if (Main.player[num1227].active && !Main.player[num1227].dead)
					{
						flag89 = true;
						break;
					}
				}
			}
			if (!flag89)
			{
				this.ai[0] = 3f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			if (!(this.ai[0] >= 0f) || !(this.ai[0] < 2f) || Main.netMode == 1 || !(Distance(Main.player[target].Center) > 2400f))
			{
				return;
			}
			this.ai[0] = -2f;
			netUpdate = true;
			Vector2 vector158 = Main.player[target].Center - Vector2.UnitY * 150f - base.Center;
			position += vector158;
			if (Main.npc[(int)localAI[0]].active)
			{
				NPC nPC3 = Main.npc[(int)localAI[0]];
				nPC3.position += vector158;
				Main.npc[(int)localAI[0]].netUpdate = true;
			}
			if (Main.npc[(int)localAI[1]].active)
			{
				NPC nPC3 = Main.npc[(int)localAI[1]];
				nPC3.position += vector158;
				Main.npc[(int)localAI[1]].netUpdate = true;
			}
			if (Main.npc[(int)localAI[2]].active)
			{
				NPC nPC3 = Main.npc[(int)localAI[2]];
				nPC3.position += vector158;
				Main.npc[(int)localAI[2]].netUpdate = true;
			}
			for (int num1228 = 0; num1228 < Main.maxNPCs; num1228++)
			{
				NPC nPC10 = Main.npc[num1228];
				if (nPC10.active && nPC10.type == 400)
				{
					NPC nPC3 = nPC10;
					nPC3.position += vector158;
					nPC10.netUpdate = true;
				}
			}
		}
		else if (aiStyle == 78)
		{
			InitializeMoonLordAttacks();
			if (!Main.npc[(int)this.ai[3]].active || Main.npc[(int)this.ai[3]].type != 398)
			{
				life = 0;
				HitEffect();
				active = false;
			}
			bool flag90 = this.ai[2] == 0f;
			float num1229 = -flag90.ToDirectionInt();
			spriteDirection = (int)num1229;
			if (frameCounter == 19.0 && !dontTakeDamage)
			{
				PopAllAttachedProjectilesAndTakeDamageForThem();
			}
			dontTakeDamage = frameCounter >= 21.0;
			Vector2 vector159 = new Vector2(30f, 66f);
			float num1230 = 0f;
			float num1231 = 0f;
			bool flag91 = true;
			int num1232 = 0;
			if (this.ai[0] != -2f)
			{
				float num1233 = this.ai[0];
				this.ai[1]++;
				int num1234 = (int)Main.npc[(int)this.ai[3]].ai[2];
				int num1235 = ((!flag90) ? 1 : 0);
				int num1236 = 0;
				int num1237 = 0;
				for (; num1236 < 5; num1236++)
				{
					num1231 = MoonLordAttacksArray[num1234, num1235, 1, num1236];
					if (!(num1231 + (float)num1237 <= this.ai[1]))
					{
						break;
					}
					num1237 += (int)num1231;
				}
				if (num1236 == 5)
				{
					num1236 = 0;
					this.ai[1] = 0f;
					num1231 = MoonLordAttacksArray[num1234, num1235, 1, num1236];
					num1237 = 0;
				}
				this.ai[0] = MoonLordAttacksArray[num1234, num1235, 0, num1236];
				num1230 = (int)this.ai[1] - num1237;
				if (this.ai[0] != num1233)
				{
					netUpdate = true;
				}
			}
			if (this.ai[0] == -2f)
			{
				damage = 80;
				num1232 = 0;
				dontTakeDamage = true;
				this.ai[1]++;
				if (this.ai[1] >= 32f)
				{
					this.ai[1] = 0f;
				}
				if (this.ai[1] < 0f)
				{
					this.ai[1] = 0f;
				}
				Vector2 center27 = Main.npc[(int)this.ai[3]].Center;
				Vector2 vector160 = center27 + new Vector2(350f * num1229, -100f);
				Vector2 vector161 = vector160 - base.Center;
				if (vector161.Length() > 20f)
				{
					vector161.Normalize();
					vector161 *= 6f;
					Vector2 value4 = velocity;
					if (vector161 != Vector2.Zero)
					{
						SimpleFlyMovement(vector161, 0.3f);
					}
					velocity = Vector2.Lerp(value4, velocity, 0.5f);
				}
			}
			else if (this.ai[0] == 0f)
			{
				num1232 = 3;
				localAI[1] -= 0.05f;
				if (localAI[1] < 0f)
				{
					localAI[1] = 0f;
				}
				Vector2 center28 = Main.npc[(int)this.ai[3]].Center;
				Vector2 vector162 = center28 + new Vector2(350f * num1229, -100f);
				Vector2 vector163 = vector162 - base.Center;
				if (vector163.Length() > 20f)
				{
					vector163.Normalize();
					vector163 *= 6f;
					Vector2 value5 = velocity;
					if (vector163 != Vector2.Zero)
					{
						SimpleFlyMovement(vector163, 0.3f);
					}
					velocity = Vector2.Lerp(value5, velocity, 0.5f);
				}
			}
			else if (this.ai[0] == 1f)
			{
				num1232 = 0;
				int num1238 = 7;
				int num1239 = 4;
				if (num1230 >= (float)(num1238 * num1239 * 2))
				{
					localAI[1] -= 0.07f;
					if (localAI[1] < 0f)
					{
						localAI[1] = 0f;
					}
				}
				else if (num1230 >= (float)(num1238 * num1239))
				{
					localAI[1] += 0.05f;
					if (localAI[1] > 0.75f)
					{
						localAI[1] = 0.75f;
					}
					float num1240 = (float)Math.PI * 2f * (num1230 % (float)(num1238 * num1239)) / (float)(num1238 * num1239) - (float)Math.PI / 2f;
					localAI[0] = new Vector2((float)Math.Cos(num1240) * vector159.X, (float)Math.Sin(num1240) * vector159.Y).ToRotation();
					if (num1230 % (float)num1239 == 0f)
					{
						Vector2 vector164 = new Vector2(1f * (0f - num1229), 3f);
						Vector2 vector165 = Utils.Vector2FromElipse(localAI[0].ToRotationVector2(), vector159 * localAI[1]);
						Vector2 vector166 = base.Center + Vector2.Normalize(vector165) * vector159.Length() * 0.4f + vector164;
						Vector2 vector167 = Vector2.Normalize(vector165) * 8f;
						float ai = ((float)Math.PI * 2f * (float)Main.rand.NextDouble() - (float)Math.PI) / 30f + (float)Math.PI / 180f * num1229;
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector166.X, vector166.Y, vector167.X, vector167.Y, 452, 30, 0f, Main.myPlayer, 0f, ai);
					}
				}
				else
				{
					localAI[1] += 0.02f;
					if (localAI[1] > 0.75f)
					{
						localAI[1] = 0.75f;
					}
					float num1241 = (float)Math.PI * 2f * (num1230 % (float)(num1238 * num1239)) / (float)(num1238 * num1239) - (float)Math.PI / 2f;
					localAI[0] = new Vector2((float)Math.Cos(num1241) * vector159.X, (float)Math.Sin(num1241) * vector159.Y).ToRotation();
				}
			}
			else if (this.ai[0] == 2f)
			{
				localAI[1] -= 0.05f;
				if (localAI[1] < 0f)
				{
					localAI[1] = 0f;
				}
				Vector2 center29 = Main.npc[(int)this.ai[3]].Center;
				Vector2 vector168 = new Vector2(220f * num1229, -60f) + center29;
				vector168 += new Vector2(num1229 * 100f, -50f);
				Vector2 vector169 = new Vector2(400f * num1229, -60f);
				if (num1230 < 30f)
				{
					Vector2 vector170 = vector168 - base.Center;
					if (vector170 != Vector2.Zero)
					{
						Vector2 vector171 = vector170;
						vector171.Normalize();
						velocity = Vector2.SmoothStep(velocity, vector171 * Math.Min(8f, vector170.Length()), 0.2f);
					}
				}
				else if (num1230 < 210f)
				{
					num1232 = 1;
					int num1242 = (int)num1230 - 30;
					if (num1242 % 30 == 0 && Main.netMode != 1)
					{
						Vector2 vector172 = new Vector2(5f * num1229, -8f);
						int num1243 = num1242 / 30;
						vector172.X += ((float)num1243 - 3.5f) * num1229 * 3f;
						vector172.Y += ((float)num1243 - 4.5f) * 1f;
						vector172 *= 1.2f;
						int num1244 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, vector172.X, vector172.Y, 454, 40, 1f, Main.myPlayer, 0f, whoAmI);
					}
					Vector2 vector173 = Vector2.SmoothStep(vector168, vector168 + vector169, (num1230 - 30f) / 180f) - base.Center;
					if (vector173 != Vector2.Zero)
					{
						Vector2 vector174 = vector173;
						vector174.Normalize();
						velocity = Vector2.Lerp(velocity, vector174 * Math.Min(20f, vector173.Length()), 0.5f);
					}
				}
				else if (num1230 < 282f)
				{
					num1232 = 0;
					velocity *= 0.9f;
				}
				else if (num1230 < 287f)
				{
					num1232 = 1;
					velocity *= 0.9f;
				}
				else if (num1230 < 292f)
				{
					num1232 = 2;
					velocity *= 0.9f;
				}
				else if (num1230 < 300f)
				{
					num1232 = 3;
					if (num1230 == 292f && Main.netMode != 1)
					{
						int num1245 = Player.FindClosest(position, width, height);
						Vector2 vector175 = Vector2.Normalize(Main.player[num1245].Center - (base.Center + Vector2.UnitY * -350f));
						if (float.IsNaN(vector175.X) || float.IsNaN(vector175.Y))
						{
							vector175 = Vector2.UnitY;
						}
						vector175 *= 12f;
						for (int num1246 = 0; num1246 < 1000; num1246++)
						{
							Projectile projectile3 = Main.projectile[num1246];
							if (projectile3.active && projectile3.type == 454 && projectile3.ai[1] == (float)whoAmI && projectile3.ai[0] != -1f)
							{
								projectile3.ai[0] = -1f;
								projectile3.velocity = vector175;
								projectile3.netUpdate = true;
								NetMessage.SendData(27, -1, -1, null, num1246);
							}
						}
					}
					Vector2 vector176 = Vector2.SmoothStep(vector168, vector168 + vector169, 1f - (num1230 - 270f) / 30f) - base.Center;
					if (vector176 != Vector2.Zero)
					{
						Vector2 vector177 = vector176;
						vector177.Normalize();
						velocity = Vector2.Lerp(velocity, vector177 * Math.Min(14f, vector176.Length()), 0.1f);
					}
				}
				else
				{
					num1232 = 3;
					Vector2 vector178 = vector168 - base.Center;
					if (vector178 != Vector2.Zero)
					{
						Vector2 vector179 = vector178;
						vector179.Normalize();
						velocity = Vector2.SmoothStep(velocity, vector179 * Math.Min(8f, vector178.Length()), 0.2f);
					}
				}
			}
			else if (this.ai[0] == 3f)
			{
				if (num1230 == 0f)
				{
					TargetClosest(faceTarget: false);
					netUpdate = true;
				}
				Vector2 v5 = Main.player[target].Center + Main.player[target].velocity * 20f - base.Center;
				localAI[0] = localAI[0].AngleLerp(v5.ToRotation(), 0.5f);
				localAI[1] += 0.05f;
				if (localAI[1] > 1f)
				{
					localAI[1] = 1f;
				}
				if (num1230 == num1231 - 35f)
				{
					SoundEngine.PlaySound(4, (int)position.X, (int)position.Y, 6);
				}
				if ((num1230 == num1231 - 14f || num1230 == num1231 - 7f || num1230 == num1231) && Main.netMode != 1)
				{
					Vector2 vector180 = Utils.Vector2FromElipse(localAI[0].ToRotationVector2(), vector159 * localAI[1]);
					Vector2 vector181 = Vector2.Normalize(v5) * 8f;
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X + vector180.X, base.Center.Y + vector180.Y, vector181.X, vector181.Y, 462, 30, 0f, Main.myPlayer);
				}
			}
			if (flag91)
			{
				Vector2 center30 = Main.npc[(int)this.ai[3]].Center;
				Vector2 vector182 = new Vector2(220f * num1229, -60f) + center30;
				Vector2 vector183 = vector182 + new Vector2(num1229 * 110f, -150f);
				Vector2 max = vector183 + new Vector2(num1229 * 370f, 150f);
				if (vector183.X > max.X)
				{
					Utils.Swap(ref vector183.X, ref max.X);
				}
				if (vector183.Y > max.Y)
				{
					Utils.Swap(ref vector183.Y, ref max.Y);
				}
				Vector2 vector184 = Vector2.Clamp(base.Center + velocity, vector183, max);
				if (vector184 != base.Center + velocity)
				{
					base.Center = vector184 - velocity;
				}
			}
			int num1247 = num1232 * 7;
			if ((double)num1247 > frameCounter)
			{
				frameCounter++;
			}
			if ((double)num1247 < frameCounter)
			{
				frameCounter--;
			}
			if (frameCounter < 0.0)
			{
				frameCounter = 0.0;
			}
			if (frameCounter > 21.0)
			{
				frameCounter = 21.0;
			}
			int num1248 = 0;
			if (flag90)
			{
				num1248 = 0;
			}
			switch (num1248)
			{
			case 1:
				if (this.ai[0] == 0f)
				{
					if ((this.ai[1] += 1f) >= 20f)
					{
						this.ai[1] = 0f;
						this.ai[0] = 1f;
						netUpdate = true;
					}
					velocity = Vector2.UnitX * 4f;
				}
				else if (this.ai[0] == 1f)
				{
					if ((this.ai[1] += 1f) >= 20f)
					{
						this.ai[1] = 0f;
						this.ai[0] = 2f;
						netUpdate = true;
					}
					velocity = Vector2.UnitX * -4f;
				}
				else if (this.ai[0] == 2f || this.ai[0] == 4f)
				{
					if ((this.ai[1] += 1f) >= 20f)
					{
						this.ai[1] = 0f;
						this.ai[0]++;
						netUpdate = true;
					}
					velocity = Vector2.UnitY * -4f * (flag90 ? 1 : (-1));
				}
				else
				{
					if (this.ai[0] != 3f && this.ai[0] != 5f)
					{
						break;
					}
					if ((this.ai[1] += 1f) >= 20f)
					{
						this.ai[1] = 0f;
						this.ai[0]++;
						if (this.ai[0] == 6f)
						{
							this.ai[0] = 0f;
						}
						netUpdate = true;
					}
					velocity = Vector2.UnitY * 4f * (flag90 ? 1 : (-1));
				}
				break;
			case 2:
			{
				Vector2 vector185 = new Vector2(30f, 66f);
				TargetClosest(faceTarget: false);
				Vector2 v6 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - base.Center;
				float num1249 = v6.Length() / 200f;
				if (num1249 > 1f)
				{
					num1249 = 1f;
				}
				num1249 = 1f - num1249;
				num1249 *= 2f;
				if (num1249 > 1f)
				{
					num1249 = 1f;
				}
				localAI[0] = v6.ToRotation();
				localAI[1] = num1249;
				localAI[1] = 1f;
				break;
			}
			case 3:
			{
				int num1255 = 7;
				int num1256 = 4;
				this.ai[1]++;
				if (this.ai[1] >= (float)(num1255 * num1256 * 10))
				{
					this.ai[1] = 0f;
					break;
				}
				if (this.ai[1] >= (float)(num1255 * num1256))
				{
					localAI[1] -= 0.07f;
					if (localAI[1] < 0f)
					{
						localAI[1] = 0f;
					}
					break;
				}
				localAI[1] += 0.05f;
				if (localAI[1] > 0.75f)
				{
					localAI[1] = 0.75f;
				}
				float num1257 = (float)Math.PI * 2f * (this.ai[1] % (float)(num1255 * num1256)) / (float)(num1255 * num1256) - (float)Math.PI / 2f;
				localAI[0] = new Vector2((float)Math.Cos(num1257) * vector159.X, (float)Math.Sin(num1257) * vector159.Y).ToRotation();
				if (this.ai[1] % (float)num1256 == 0f)
				{
					Vector2 vector196 = new Vector2(1f * (0f - num1229), 3f);
					Vector2 vector197 = Utils.Vector2FromElipse(localAI[0].ToRotationVector2(), vector159 * localAI[1]);
					Vector2 vector198 = base.Center + Vector2.Normalize(vector197) * vector159.Length() * 0.4f + vector196;
					Vector2 vector199 = Vector2.Normalize(vector197) * 8f;
					float ai2 = ((float)Math.PI * 2f * (float)Main.rand.NextDouble() - (float)Math.PI) / 30f + (float)Math.PI / 180f * num1229;
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector198.X, vector198.Y, vector199.X, vector199.Y, 452, 5, 0f, Main.myPlayer, 0f, ai2);
				}
				break;
			}
			case 4:
			{
				Vector2 center31 = Main.npc[(int)this.ai[3]].Center;
				Vector2 vector186 = new Vector2(220f * num1229, -60f) + center31;
				vector186 += new Vector2(num1229 * 100f, -50f);
				Vector2 vector187 = new Vector2(400f * num1229, -60f);
				this.ai[1]++;
				if (this.ai[1] < 30f)
				{
					Vector2 vector188 = vector186 - base.Center;
					if (vector188 != Vector2.Zero)
					{
						Vector2 vector189 = vector188;
						vector189.Normalize();
						velocity = Vector2.SmoothStep(velocity, vector189 * Math.Min(8f, vector188.Length()), 0.2f);
					}
				}
				else if (this.ai[1] < 210f)
				{
					int num1250 = (int)this.ai[1] - 30;
					if (num1250 % 30 == 0 && Main.netMode != 1)
					{
						Vector2 vector190 = new Vector2(5f * num1229, -8f);
						int num1251 = num1250 / 30;
						vector190.X += ((float)num1251 - 3.5f) * num1229 * 3f;
						vector190.Y += ((float)num1251 - 4.5f) * 1f;
						vector190 *= 1.2f;
						int num1252 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, vector190.X, vector190.Y, 454, 1, 1f, Main.myPlayer, 0f, whoAmI);
					}
					Vector2 vector191 = Vector2.SmoothStep(vector186, vector186 + vector187, (this.ai[1] - 30f) / 180f) - base.Center;
					if (vector191 != Vector2.Zero)
					{
						Vector2 vector192 = vector191;
						vector192.Normalize();
						velocity = Vector2.Lerp(velocity, vector192 * Math.Min(4f, vector191.Length()), 0.1f);
					}
				}
				else if (this.ai[1] < 270f)
				{
					velocity *= 0.9f;
				}
				else if (this.ai[1] < 300f)
				{
					if (this.ai[1] == 270f && Main.netMode != 1)
					{
						int num1253 = Player.FindClosest(position, width, height);
						Vector2 vector193 = Vector2.Normalize(Main.player[num1253].Center - (base.Center + Vector2.UnitY * -350f));
						if (float.IsNaN(vector193.X) || float.IsNaN(vector193.Y))
						{
							vector193 = Vector2.UnitY;
						}
						vector193 *= 12f;
						for (int num1254 = 0; num1254 < 1000; num1254++)
						{
							Projectile projectile4 = Main.projectile[num1254];
							if (projectile4.active && projectile4.type == 454 && projectile4.ai[1] == (float)whoAmI && projectile4.ai[0] != -1f)
							{
								projectile4.ai[0] = -1f;
								projectile4.velocity = vector193;
								projectile4.netUpdate = true;
							}
						}
					}
					Vector2 vector194 = Vector2.SmoothStep(vector186, vector186 + vector187, 1f - (this.ai[1] - 270f) / 30f) - base.Center;
					if (vector194 != Vector2.Zero)
					{
						Vector2 vector195 = vector194;
						vector195.Normalize();
						velocity = Vector2.Lerp(velocity, vector195 * Math.Min(14f, vector194.Length()), 0.1f);
					}
				}
				else
				{
					this.ai[1] = 0f;
				}
				break;
			}
			case 5:
				dontTakeDamage = true;
				this.ai[1]++;
				if (this.ai[1] >= 40f)
				{
					this.ai[1] = 0f;
				}
				break;
			}
		}
		else if (aiStyle == 79)
		{
			if (!Main.npc[(int)this.ai[3]].active || Main.npc[(int)this.ai[3]].type != 398)
			{
				life = 0;
				HitEffect();
				active = false;
			}
			if (localAI[3] == 13f && !dontTakeDamage)
			{
				PopAllAttachedProjectilesAndTakeDamageForThem();
			}
			dontTakeDamage = localAI[3] >= 15f;
			velocity = Vector2.Zero;
			base.Center = Main.npc[(int)this.ai[3]].Center + new Vector2(0f, -400f);
			Vector2 vector200 = new Vector2(27f, 59f);
			float num1258 = 0f;
			float num1259 = 0f;
			int num1260 = 0;
			int num1261 = 0;
			if (this.ai[0] >= 0f)
			{
				float num1262 = this.ai[0];
				this.ai[1]++;
				int num1263 = (int)Main.npc[(int)this.ai[3]].ai[2];
				int num1264 = 2;
				int num1265 = 0;
				int num1266 = 0;
				for (; num1265 < 5; num1265++)
				{
					num1259 = MoonLordAttacksArray[num1263, num1264, 1, num1265];
					if (!(num1259 + (float)num1266 <= this.ai[1]))
					{
						break;
					}
					num1266 += (int)num1259;
				}
				if (num1265 == 5)
				{
					num1265 = 0;
					this.ai[1] = 0f;
					num1259 = MoonLordAttacksArray[num1263, num1264, 1, num1265];
					num1266 = 0;
				}
				this.ai[0] = MoonLordAttacksArray[num1263, num1264, 0, num1265];
				num1258 = (int)this.ai[1] - num1266;
				if (this.ai[0] != num1262)
				{
					netUpdate = true;
				}
			}
			if (this.ai[0] == -3f)
			{
				damage = 0;
				dontTakeDamage = true;
				rotation = MathHelper.Lerp(rotation, (float)Math.PI / 12f, 0.07f);
				this.ai[1]++;
				if (this.ai[1] >= 32f)
				{
					this.ai[1] = 0f;
				}
				if (this.ai[1] < 0f)
				{
					this.ai[1] = 0f;
				}
				if (localAI[2] < 14f)
				{
					localAI[2]++;
				}
			}
			else if (this.ai[0] == -2f)
			{
				if (Main.npc[(int)this.ai[3]].ai[0] == 2f)
				{
					this.ai[0] = -3f;
					return;
				}
				damage = 80;
				dontTakeDamage = true;
				this.ai[1]++;
				if (this.ai[1] >= 32f)
				{
					this.ai[1] = 0f;
				}
				if (this.ai[1] < 0f)
				{
					this.ai[1] = 0f;
				}
				this.ai[2]++;
				if (this.ai[2] >= 555f)
				{
					this.ai[2] = 0f;
				}
				if (this.ai[2] >= 120f)
				{
					num1258 = this.ai[2] - 120f;
					num1259 = 555f;
					num1260 = 2;
					Vector2 vector201 = new Vector2(0f, 216f);
					if (num1258 == 0f && Main.netMode != 1)
					{
						Vector2 vector202 = base.Center + vector201;
						for (int num1267 = 0; num1267 < 255; num1267++)
						{
							Player player13 = Main.player[num1267];
							if (player13.active && !player13.dead && Vector2.Distance(player13.Center, vector202) <= 3000f)
							{
								Vector2 vector203 = Main.player[target].Center - vector202;
								if (vector203 != Vector2.Zero)
								{
									vector203.Normalize();
								}
								Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector202.X, vector202.Y, vector203.X, vector203.Y, 456, 0, 0f, Main.myPlayer, whoAmI + 1, num1267);
							}
						}
					}
					if ((num1258 == 120f || num1258 == 180f || num1258 == 240f) && Main.netMode != 1)
					{
						for (int num1268 = 0; num1268 < 1000; num1268++)
						{
							Projectile projectile5 = Main.projectile[num1268];
							if (projectile5.active && projectile5.type == 456 && Main.player[(int)projectile5.ai[1]].FindBuffIndex(145) != -1)
							{
								Vector2 center32 = Main.player[target].Center;
								int num1269 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)center32.X, (int)center32.Y, 401);
								Main.npc[num1269].netUpdate = true;
								Main.npc[num1269].ai[0] = whoAmI + 1;
								Main.npc[num1269].ai[1] = num1268;
							}
						}
					}
				}
			}
			else if (this.ai[0] == 0f)
			{
				num1261 = 3;
				TargetClosest(faceTarget: false);
				Vector2 v7 = Main.player[target].Center - base.Center - new Vector2(0f, -22f);
				float num1270 = v7.Length() / 500f;
				if (num1270 > 1f)
				{
					num1270 = 1f;
				}
				num1270 = 1f - num1270;
				num1270 *= 2f;
				if (num1270 > 1f)
				{
					num1270 = 1f;
				}
				localAI[0] = v7.ToRotation();
				localAI[1] = num1270;
				localAI[2] = MathHelper.Lerp(localAI[2], 1f, 0.2f);
			}
			if (this.ai[0] == 1f)
			{
				if (num1258 < 180f)
				{
					localAI[1] -= 0.05f;
					if (localAI[1] < 0f)
					{
						localAI[1] = 0f;
					}
					if (num1258 >= 60f)
					{
						Vector2 center33 = base.Center;
						int num1271 = 0;
						if (num1258 >= 120f)
						{
							num1271 = 1;
						}
						for (int num1272 = 0; num1272 < 1 + num1271; num1272++)
						{
							int num1273 = 229;
							float num1274 = 0.8f;
							if (num1272 % 2 == 1)
							{
								num1273 = 229;
								num1274 = 1.65f;
							}
							Vector2 vector204 = center33 + ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2() * vector200 / 2f;
							int num1275 = Dust.NewDust(vector204 - Vector2.One * 8f, 16, 16, num1273, velocity.X / 2f, velocity.Y / 2f);
							Main.dust[num1275].velocity = Vector2.Normalize(center33 - vector204) * 3.5f * (10f - (float)num1271 * 2f) / 10f;
							Main.dust[num1275].noGravity = true;
							Main.dust[num1275].scale = num1274;
							Main.dust[num1275].customData = this;
						}
					}
				}
				else if (num1258 < num1259 - 15f)
				{
					if (num1258 == 180f && Main.netMode != 1)
					{
						TargetClosest(faceTarget: false);
						Vector2 spinningpoint9 = Main.player[target].Center - base.Center;
						spinningpoint9.Normalize();
						float num1276 = -1f;
						if (spinningpoint9.X < 0f)
						{
							num1276 = 1f;
						}
						spinningpoint9 = spinningpoint9.RotatedBy((0f - num1276) * ((float)Math.PI * 2f) / 6f);
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, spinningpoint9.X, spinningpoint9.Y, 455, 75, 0f, Main.myPlayer, num1276 * ((float)Math.PI * 2f) / 540f, whoAmI);
						this.ai[2] = (spinningpoint9.ToRotation() + (float)Math.PI * 3f) * num1276;
						netUpdate = true;
					}
					localAI[1] += 0.05f;
					if (localAI[1] > 1f)
					{
						localAI[1] = 1f;
					}
					float num1277 = (this.ai[2] >= 0f).ToDirectionInt();
					float num1278 = this.ai[2];
					if (num1278 < 0f)
					{
						num1278 *= -1f;
					}
					num1278 += (float)Math.PI * -3f;
					num1278 += num1277 * ((float)Math.PI * 2f) / 540f;
					localAI[0] = num1278;
					this.ai[2] = (num1278 + (float)Math.PI * 3f) * num1277;
				}
				else
				{
					localAI[1] -= 0.07f;
					if (localAI[1] < 0f)
					{
						localAI[1] = 0f;
						if (Main.netMode != 1 && Main.getGoodWorld)
						{
							for (int num1279 = 0; num1279 < 30; num1279++)
							{
								if (!WorldGen.SolidTile((int)(base.Center.X / 16f), (int)(base.Center.Y / 16f)))
								{
									Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, (float)Main.rand.Next(-1599, 1600) * 0.01f, (float)Main.rand.Next(-1599, 1) * 0.01f, 1021, 70, 10f);
								}
							}
						}
					}
					num1261 = 3;
				}
			}
			else if (this.ai[0] == 2f)
			{
				num1260 = 2;
				num1261 = 3;
				Vector2 vector205 = new Vector2(0f, 216f);
				if (num1258 == 0f && Main.netMode != 1)
				{
					Vector2 vector206 = base.Center + vector205;
					for (int num1280 = 0; num1280 < 255; num1280++)
					{
						Player player14 = Main.player[num1280];
						if (player14.active && !player14.dead && Vector2.Distance(player14.Center, vector206) <= 3000f)
						{
							Vector2 vector207 = Main.player[target].Center - vector206;
							if (vector207 != Vector2.Zero)
							{
								vector207.Normalize();
							}
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector206.X, vector206.Y, vector207.X, vector207.Y, 456, 0, 0f, Main.myPlayer, whoAmI + 1, num1280);
						}
					}
				}
				if ((num1258 == 120f || num1258 == 180f || num1258 == 240f) && Main.netMode != 1)
				{
					for (int num1281 = 0; num1281 < 1000; num1281++)
					{
						Projectile projectile6 = Main.projectile[num1281];
						if (projectile6.active && projectile6.type == 456 && Main.player[(int)projectile6.ai[1]].FindBuffIndex(145) != -1)
						{
							Vector2 center34 = Main.player[target].Center;
							int num1282 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)center34.X, (int)center34.Y, 401);
							Main.npc[num1282].netUpdate = true;
							Main.npc[num1282].ai[0] = whoAmI + 1;
							Main.npc[num1282].ai[1] = num1281;
						}
					}
				}
			}
			else if (this.ai[0] == 3f)
			{
				if ((double)num1258 == 1.0)
				{
					TargetClosest(faceTarget: false);
					netUpdate = true;
				}
				Vector2 v8 = Main.player[target].Center + Main.player[target].velocity * 20f - base.Center;
				localAI[0] = localAI[0].AngleLerp(v8.ToRotation(), 0.5f);
				localAI[1] += 0.05f;
				if (localAI[1] > 1f)
				{
					localAI[1] = 1f;
				}
				if (num1258 == num1259 - 35f)
				{
					SoundEngine.PlaySound(4, (int)position.X, (int)position.Y, 6);
				}
				if ((num1258 == num1259 - 14f || num1258 == num1259 - 7f || num1258 == num1259) && Main.netMode != 1)
				{
					Vector2 vector208 = Utils.Vector2FromElipse(localAI[0].ToRotationVector2(), vector200 * localAI[1]);
					Vector2 vector209 = Vector2.Normalize(v8) * 8f;
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X + vector208.X, base.Center.Y + vector208.Y, vector209.X, vector209.Y, 462, 30, 0f, Main.myPlayer);
				}
			}
			int num1283 = num1260 * 7;
			if ((float)num1283 > localAI[2])
			{
				localAI[2]++;
			}
			if ((float)num1283 < localAI[2])
			{
				localAI[2]--;
			}
			if (localAI[2] < 0f)
			{
				localAI[2] = 0f;
			}
			if (localAI[2] > 14f)
			{
				localAI[2] = 14f;
			}
			int num1284 = num1261 * 5;
			if ((float)num1284 > localAI[3])
			{
				localAI[3]++;
			}
			if ((float)num1284 < localAI[3])
			{
				localAI[3]--;
			}
			if (localAI[3] < 0f)
			{
				localAI[2] = 0f;
			}
			if (localAI[3] > 15f)
			{
				localAI[2] = 15f;
			}
			int num1285 = 0;
			if (num1285 == 1)
			{
				Vector2 vector210 = new Vector2(27f, 59f);
				TargetClosest(faceTarget: false);
				Vector2 v9 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - base.Center;
				float num1286 = v9.Length() / 200f;
				if (num1286 > 1f)
				{
					num1286 = 1f;
				}
				num1286 = 1f - num1286;
				num1286 *= 2f;
				if (num1286 > 1f)
				{
					num1286 = 1f;
				}
				localAI[0] = v9.ToRotation();
				localAI[1] = num1286;
				localAI[1] = 1f;
			}
			if (num1285 == 2)
			{
				Vector2 vector211 = new Vector2(27f, 59f);
				float num1287 = (float)Math.PI * 2f * ((float)Main.timeForVisualEffects % 600f) / 600f;
				localAI[0] = new Vector2((float)Math.Cos(num1287) * vector211.X, (float)Math.Sin(num1287) * vector211.Y).ToRotation();
				localAI[1] = 0.75f;
				if (this.ai[1] == 0f)
				{
					Vector2 vector212 = num1287.ToRotationVector2();
					vector212 = Vector2.One;
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, vector212.X, vector212.Y, 455, 1, 0f, Main.myPlayer, (float)Math.PI / 300f, whoAmI);
				}
				this.ai[1]++;
				if (this.ai[1] >= 600f)
				{
					this.ai[1] = 0f;
				}
			}
			if (num1285 == 3)
			{
				Vector2 vector213 = new Vector2(0f, 216f);
				if (this.ai[1] == 0f)
				{
					TargetClosest(faceTarget: false);
					Vector2 vector214 = Main.player[target].Center - base.Center;
					vector214.Normalize();
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X + vector213.X, base.Center.Y + vector213.Y, vector214.X, vector214.Y, 456, 0, 0f, Main.myPlayer, whoAmI + 1, target);
				}
				this.ai[1]++;
				if (this.ai[1] >= 600f)
				{
					this.ai[1] = 0f;
				}
			}
			if (num1285 == 4)
			{
				Vector2 vector215 = new Vector2(27f, 59f);
				TargetClosest(faceTarget: false);
				Vector2 v10 = Main.player[target].Center + Main.player[target].velocity * 20f - base.Center;
				localAI[0] = localAI[0].AngleLerp(v10.ToRotation(), 0.5f);
				localAI[1] = 1f;
				this.ai[1]++;
				if (this.ai[1] == 55f)
				{
					SoundEngine.PlaySound(4, (int)position.X, (int)position.Y, 6);
				}
				if (this.ai[1] == 76f || this.ai[1] == 83f || this.ai[1] == 90f)
				{
					Vector2 vector216 = Utils.Vector2FromElipse(elipseSizes: new Vector2(27f, 59f) * localAI[1], angleVector: localAI[0].ToRotationVector2());
					Vector2 vector217 = Vector2.Normalize(v10) * 8f;
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X + vector216.X, base.Center.Y + vector216.Y, vector217.X, vector217.Y, 462, 5, 0f, Main.myPlayer);
				}
				if (this.ai[1] >= 90f)
				{
					this.ai[1] = 0f;
				}
			}
		}
		else if (aiStyle == 80)
		{
			if (this.ai[0] == 0f)
			{
				if (direction == 0)
				{
					TargetClosest();
					netUpdate = true;
				}
				if (collideX)
				{
					direction = -direction;
					netUpdate = true;
				}
				velocity.X = 3f * (float)direction;
				Vector2 center35 = base.Center;
				Point point8 = center35.ToTileCoordinates();
				int num1288 = 30;
				if (WorldGen.InWorld(point8.X, point8.Y, 30))
				{
					for (int num1289 = 0; num1289 < 30; num1289++)
					{
						if (WorldGen.SolidTile(point8.X, point8.Y + num1289))
						{
							num1288 = num1289;
							break;
						}
					}
				}
				if (num1288 < 15)
				{
					velocity.Y = Math.Max(velocity.Y - 0.05f, -3.5f);
				}
				else if (num1288 < 20)
				{
					velocity.Y *= 0.95f;
				}
				else
				{
					velocity.Y = Math.Min(velocity.Y + 0.05f, 1.5f);
				}
				float distanceToPlayer;
				int num1290 = FindClosestPlayer(out distanceToPlayer);
				if (num1290 == -1 || Main.player[num1290].dead)
				{
					return;
				}
				if (distanceToPlayer < 352f && Main.player[num1290].Center.Y > base.Center.Y)
				{
					this.ai[0] = 1f;
					this.ai[1] = 0f;
					netUpdate = true;
				}
			}
			else if (this.ai[0] == 1f)
			{
				this.ai[1]++;
				velocity *= 0.95f;
				if (this.ai[1] >= 60f)
				{
					this.ai[1] = 0f;
					this.ai[0] = 2f;
					int num1291 = FindClosestPlayer();
					if (num1291 != -1)
					{
						this.ai[3] = ((Main.player[num1291].Center.X > base.Center.X) ? (-1f) : 1f);
					}
					else
					{
						this.ai[3] = 1f;
					}
					netUpdate = true;
				}
			}
			else if (this.ai[0] == 2f)
			{
				noTileCollide = true;
				this.ai[1]++;
				velocity.Y = Math.Max(velocity.Y - 0.1f, -10f);
				velocity.X = Math.Min(velocity.X + this.ai[3] * 0.05f, 4f);
				if ((position.Y < (float)(-height) || this.ai[1] >= 180f) && Main.netMode != 1)
				{
					Main.StartInvasion(4);
					active = false;
					netUpdate = true;
				}
			}
			Vector3 rgb = Color.SkyBlue.ToVector3();
			if (this.ai[0] == 2f)
			{
				rgb = Color.Red.ToVector3();
			}
			rgb *= 0.65f;
			Lighting.AddLight(base.Center, rgb);
		}
		else if (aiStyle == 81)
		{
			if (Main.rand.Next(420) == 0)
			{
				SoundEngine.PlaySound(29, (int)base.Center.X, (int)base.Center.Y, Main.rand.Next(100, 101));
			}
			Vector2 vector218 = new Vector2(30f);
			if (!Main.npc[(int)this.ai[3]].active || Main.npc[(int)this.ai[3]].type != 398)
			{
				life = 0;
				HitEffect();
				active = false;
			}
			float num1292 = 0f;
			float num1293 = 0f;
			float num1294 = this.ai[0];
			this.ai[1]++;
			int num1295 = 0;
			int num1296 = 0;
			for (; num1295 < 10; num1295++)
			{
				num1293 = MoonLordAttacksArray2[1, num1295];
				if (!(num1293 + (float)num1296 <= this.ai[1]))
				{
					break;
				}
				num1296 += (int)num1293;
			}
			if (num1295 == 10)
			{
				num1295 = 0;
				this.ai[1] = 0f;
				num1293 = MoonLordAttacksArray2[1, num1295];
				num1296 = 0;
			}
			this.ai[0] = MoonLordAttacksArray2[0, num1295];
			num1292 = (int)this.ai[1] - num1296;
			if (this.ai[0] != num1294)
			{
				netUpdate = true;
			}
			if (this.ai[0] == -1f)
			{
				this.ai[1]++;
				if (this.ai[1] > 180f)
				{
					this.ai[1] = 0f;
				}
				float num1297 = 1f;
				if (this.ai[1] < 60f)
				{
					num1297 = 0.75f;
					localAI[0] = 0f;
					localAI[1] = (float)Math.Sin(this.ai[1] * ((float)Math.PI * 2f) / 15f) * 0.35f;
					if (localAI[1] < 0f)
					{
						localAI[0] = (float)Math.PI;
					}
				}
				else if (this.ai[1] < 120f)
				{
					num1297 = 1f;
					if (localAI[1] < 0.5f)
					{
						localAI[1] += 0.025f;
					}
					localAI[0] += (float)Math.PI / 15f;
				}
				else
				{
					num1297 = 1.15f;
					localAI[1] -= 0.05f;
					if (localAI[1] < 0f)
					{
						localAI[1] = 0f;
					}
				}
				localAI[2] = MathHelper.Lerp(localAI[2], num1297, 0.3f);
			}
			if (this.ai[0] == 0f)
			{
				TargetClosest(faceTarget: false);
				Vector2 v11 = Main.player[target].Center + Main.player[target].velocity * 20f - base.Center;
				localAI[0] = localAI[0].AngleLerp(v11.ToRotation(), 0.5f);
				localAI[1] += 0.05f;
				if (localAI[1] > 0.7f)
				{
					localAI[1] = 0.7f;
				}
				localAI[2] = MathHelper.Lerp(localAI[2], 1f, 0.2f);
				float num1298 = 24f;
				Vector2 center36 = base.Center;
				Vector2 center37 = Main.player[target].Center;
				Vector2 vector219 = center37 - center36;
				Vector2 vector220 = vector219 - Vector2.UnitY * 200f;
				vector220 = Vector2.Normalize(vector220) * num1298;
				int num1299 = 30;
				velocity.X = (velocity.X * (float)(num1299 - 1) + vector220.X) / (float)num1299;
				velocity.Y = (velocity.Y * (float)(num1299 - 1) + vector220.Y) / (float)num1299;
				float num1300 = 0.25f;
				for (int num1301 = 0; num1301 < Main.maxNPCs; num1301++)
				{
					if (num1301 != whoAmI && Main.npc[num1301].active && Main.npc[num1301].type == 400 && Vector2.Distance(base.Center, Main.npc[num1301].Center) < 150f)
					{
						if (position.X < Main.npc[num1301].position.X)
						{
							velocity.X -= num1300;
						}
						else
						{
							velocity.X += num1300;
						}
						if (position.Y < Main.npc[num1301].position.Y)
						{
							velocity.Y -= num1300;
						}
						else
						{
							velocity.Y += num1300;
						}
					}
				}
			}
			else if (this.ai[0] == 1f)
			{
				if (num1292 == 0f)
				{
					TargetClosest(faceTarget: false);
					netUpdate = true;
				}
				velocity *= 0.95f;
				if (velocity.Length() < 1f)
				{
					velocity = Vector2.Zero;
				}
				Vector2 v12 = Main.player[target].Center + Main.player[target].velocity * 20f - base.Center;
				localAI[0] = localAI[0].AngleLerp(v12.ToRotation(), 0.5f);
				localAI[1] += 0.05f;
				if (localAI[1] > 1f)
				{
					localAI[1] = 1f;
				}
				if (num1292 < 20f)
				{
					localAI[2] = MathHelper.Lerp(localAI[2], 1.1f, 0.2f);
				}
				else
				{
					localAI[2] = MathHelper.Lerp(localAI[2], 0.4f, 0.2f);
				}
				if (num1292 == num1293 - 35f)
				{
					SoundEngine.PlaySound(4, (int)position.X, (int)position.Y, 6);
				}
				if ((num1292 == num1293 - 14f || num1292 == num1293 - 7f || num1292 == num1293) && Main.netMode != 1)
				{
					Vector2 vector221 = Utils.Vector2FromElipse(localAI[0].ToRotationVector2(), vector218 * localAI[1]);
					Vector2 vector222 = Vector2.Normalize(v12) * 8f;
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X + vector221.X, base.Center.Y + vector221.Y, vector222.X, vector222.Y, 462, 35, 0f, Main.myPlayer);
				}
			}
			else if (this.ai[0] == 2f)
			{
				if (num1292 < 15f)
				{
					localAI[1] -= 0.07f;
					if (localAI[1] < 0f)
					{
						localAI[1] = 0f;
					}
					localAI[2] = MathHelper.Lerp(localAI[2], 0.4f, 0.2f);
					velocity *= 0.8f;
					if (velocity.Length() < 1f)
					{
						velocity = Vector2.Zero;
					}
				}
				else if (num1292 < 75f)
				{
					float num1302 = (num1292 - 15f) / 10f;
					int num1303 = 0;
					int num1304 = 0;
					switch ((int)num1302)
					{
					case 0:
						num1303 = 0;
						num1304 = 2;
						break;
					case 1:
						num1303 = 2;
						num1304 = 5;
						break;
					case 2:
						num1303 = 5;
						num1304 = 3;
						break;
					case 3:
						num1303 = 3;
						num1304 = 1;
						break;
					case 4:
						num1303 = 1;
						num1304 = 4;
						break;
					case 5:
						num1303 = 4;
						num1304 = 0;
						break;
					}
					Vector2 spinningpoint10 = Vector2.UnitY * -30f;
					Vector2 value6 = spinningpoint10.RotatedBy((float)num1303 * ((float)Math.PI * 2f) / 6f);
					Vector2 value7 = spinningpoint10.RotatedBy((float)num1304 * ((float)Math.PI * 2f) / 6f);
					Vector2 vector223 = Vector2.Lerp(value6, value7, num1302 - (float)(int)num1302);
					float value8 = vector223.Length() / 30f;
					localAI[0] = vector223.ToRotation();
					localAI[1] = MathHelper.Lerp(localAI[1], value8, 0.5f);
					for (int num1305 = 0; num1305 < 2; num1305++)
					{
						int num1306 = Dust.NewDust(base.Center + vector223 - Vector2.One * 4f, 0, 0, 229);
						Dust dust = Main.dust[num1306];
						dust.velocity += vector223 / 15f;
						Main.dust[num1306].noGravity = true;
					}
					if ((num1292 - 15f) % 10f == 0f && Main.netMode != 1)
					{
						Vector2 vec4 = Vector2.Normalize(vector223);
						if (vec4.HasNaNs())
						{
							vec4 = Vector2.UnitY * -1f;
						}
						vec4 *= 4f;
						int num1307 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X + vector223.X, base.Center.Y + vector223.Y, vec4.X, vec4.Y, 454, 40, 0f, Main.myPlayer, 30f, whoAmI);
					}
				}
				else if (num1292 < 105f)
				{
					localAI[0] = localAI[0].AngleLerp(this.ai[2] - (float)Math.PI / 2f, 0.2f);
					localAI[2] = MathHelper.Lerp(localAI[2], 0.75f, 0.2f);
					if (num1292 == 75f)
					{
						TargetClosest(faceTarget: false);
						netUpdate = true;
						velocity = Vector2.UnitY * -7f;
						for (int num1308 = 0; num1308 < 1000; num1308++)
						{
							Projectile projectile7 = Main.projectile[num1308];
							if (projectile7.active && projectile7.type == 454 && projectile7.ai[1] == (float)whoAmI && projectile7.ai[0] != -1f)
							{
								Projectile projectile8 = projectile7;
								projectile8.velocity += velocity;
								projectile7.netUpdate = true;
							}
						}
					}
					velocity.Y *= 0.96f;
					this.ai[2] = (Main.player[target].Center - base.Center).ToRotation() + (float)Math.PI / 2f;
					rotation = rotation.AngleTowards(this.ai[2], (float)Math.PI / 30f);
				}
				else if (num1292 < 120f)
				{
					SoundEngine.PlaySound(29, (int)base.Center.X, (int)base.Center.Y, 102);
					if (num1292 == 105f)
					{
						netUpdate = true;
					}
					Vector2 vector224 = (this.ai[2] - (float)Math.PI / 2f).ToRotationVector2() * 12f;
					velocity = vector224 * 2f;
					for (int num1309 = 0; num1309 < 1000; num1309++)
					{
						Projectile projectile9 = Main.projectile[num1309];
						if (projectile9.active && projectile9.type == 454 && projectile9.ai[1] == (float)whoAmI && projectile9.ai[0] != -1f)
						{
							projectile9.ai[0] = -1f;
							projectile9.velocity = vector224;
							projectile9.netUpdate = true;
						}
					}
				}
				else
				{
					velocity *= 0.92f;
					rotation = rotation.AngleLerp(0f, 0.2f);
				}
			}
			else if (this.ai[0] == 3f)
			{
				if (num1292 < 15f)
				{
					localAI[1] -= 0.07f;
					if (localAI[1] < 0f)
					{
						localAI[1] = 0f;
					}
					localAI[2] = MathHelper.Lerp(localAI[2], 0.4f, 0.2f);
					velocity *= 0.9f;
					if (velocity.Length() < 1f)
					{
						velocity = Vector2.Zero;
					}
				}
				else if (num1292 < 45f)
				{
					localAI[0] = 0f;
					localAI[1] = (float)Math.Sin((num1292 - 15f) * ((float)Math.PI * 2f) / 15f) * 0.5f;
					if (localAI[1] < 0f)
					{
						localAI[0] = (float)Math.PI;
					}
				}
				else if (num1292 < 185f)
				{
					if (num1292 == 45f)
					{
						this.ai[2] = (float)(Main.rand.Next(2) == 0).ToDirectionInt() * ((float)Math.PI * 2f) / 40f;
						netUpdate = true;
					}
					if ((num1292 - 15f - 30f) % 40f == 0f)
					{
						this.ai[2] *= 0.95f;
					}
					localAI[0] += this.ai[2];
					localAI[1] += 0.05f;
					if (localAI[1] > 1f)
					{
						localAI[1] = 1f;
					}
					Vector2 vector225 = localAI[0].ToRotationVector2() * vector218 * localAI[1];
					float num1310 = MathHelper.Lerp(8f, 20f, (num1292 - 15f - 30f) / 140f);
					velocity = Vector2.Normalize(vector225) * num1310;
					rotation = rotation.AngleLerp(velocity.ToRotation() + (float)Math.PI / 2f, 0.2f);
					if ((num1292 - 15f - 30f) % 10f == 0f && Main.netMode != 1)
					{
						Vector2 vector226 = base.Center + Vector2.Normalize(vector225) * vector218.Length() * 0.4f;
						Vector2 vector227 = Vector2.Normalize(vector225) * 8f;
						float ai3 = ((float)Math.PI * 2f * (float)Main.rand.NextDouble() - (float)Math.PI) / 30f + (float)Math.PI / 180f * this.ai[2];
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector226.X, vector226.Y, vector227.X, vector227.Y, 452, 35, 0f, Main.myPlayer, 0f, ai3);
					}
				}
				else
				{
					velocity *= 0.88f;
					rotation = rotation.AngleLerp(0f, 0.2f);
					localAI[1] -= 0.07f;
					if (localAI[1] < 0f)
					{
						localAI[1] = 0f;
					}
					localAI[2] = MathHelper.Lerp(localAI[2], 1f, 0.2f);
				}
			}
			else
			{
				if (this.ai[0] != 4f)
				{
					return;
				}
				if (num1292 == 0f)
				{
					TargetClosest(faceTarget: false);
					netUpdate = true;
				}
				if (num1292 < 180f)
				{
					localAI[2] = MathHelper.Lerp(localAI[2], 1f, 0.2f);
					localAI[1] -= 0.05f;
					if (localAI[1] < 0f)
					{
						localAI[1] = 0f;
					}
					velocity *= 0.95f;
					if (velocity.Length() < 1f)
					{
						velocity = Vector2.Zero;
					}
					if (!(num1292 >= 60f))
					{
						return;
					}
					Vector2 center38 = base.Center;
					int num1311 = 0;
					if (num1292 >= 120f)
					{
						num1311 = 1;
					}
					for (int num1312 = 0; num1312 < 1 + num1311; num1312++)
					{
						int num1313 = 229;
						float num1314 = 0.8f;
						if (num1312 % 2 == 1)
						{
							num1313 = 229;
							num1314 = 1.65f;
						}
						Vector2 vector228 = center38 + ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2() * vector218 / 2f;
						int num1315 = Dust.NewDust(vector228 - Vector2.One * 8f, 16, 16, num1313, velocity.X / 2f, velocity.Y / 2f);
						Main.dust[num1315].velocity = Vector2.Normalize(center38 - vector228) * 3.5f * (10f - (float)num1311 * 2f) / 10f;
						Main.dust[num1315].noGravity = true;
						Main.dust[num1315].scale = num1314;
						Main.dust[num1315].customData = this;
					}
				}
				else if (num1292 < num1293 - 15f)
				{
					if (num1292 == 180f && Main.netMode != 1)
					{
						TargetClosest(faceTarget: false);
						Vector2 spinningpoint11 = Main.player[target].Center - base.Center;
						spinningpoint11.Normalize();
						float num1316 = -1f;
						if (spinningpoint11.X < 0f)
						{
							num1316 = 1f;
						}
						spinningpoint11 = spinningpoint11.RotatedBy((0f - num1316) * ((float)Math.PI * 2f) / 6f);
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, spinningpoint11.X, spinningpoint11.Y, 455, 50, 0f, Main.myPlayer, num1316 * ((float)Math.PI * 2f) / 540f, whoAmI);
						this.ai[2] = (spinningpoint11.ToRotation() + (float)Math.PI * 3f) * num1316;
						netUpdate = true;
					}
					localAI[1] += 0.05f;
					if (localAI[1] > 1f)
					{
						localAI[1] = 1f;
					}
					float num1317 = (this.ai[2] >= 0f).ToDirectionInt();
					float num1318 = this.ai[2];
					if (num1318 < 0f)
					{
						num1318 *= -1f;
					}
					num1318 += (float)Math.PI * -3f;
					num1318 += num1317 * ((float)Math.PI * 2f) / 540f;
					localAI[0] = num1318;
					this.ai[2] = (num1318 + (float)Math.PI * 3f) * num1317;
				}
				else
				{
					localAI[1] -= 0.07f;
					if (localAI[1] < 0f)
					{
						localAI[1] = 0f;
					}
				}
			}
		}
		else if (aiStyle == 82)
		{
			float num1319 = 90f;
			Vector2 vector229 = new Vector2(0f, 216f);
			int num1320 = (int)Math.Abs(this.ai[0]) - 1;
			int num1321 = (int)this.ai[1];
			if (!Main.npc[num1320].active || Main.npc[num1320].type != 396)
			{
				life = 0;
				HitEffect();
				active = false;
				return;
			}
			this.ai[2]++;
			if (this.ai[2] >= num1319)
			{
				if (Main.netMode != 1)
				{
					int num1322 = (int)Main.npc[num1320].ai[3];
					int num1323 = -1;
					int num1324 = -1;
					int num1325 = num1320;
					for (int num1326 = 0; num1326 < Main.maxNPCs; num1326++)
					{
						if (Main.npc[num1326].active && Main.npc[num1326].ai[3] == (float)num1322)
						{
							if (num1323 == -1 && Main.npc[num1326].type == 397 && Main.npc[num1326].ai[2] == 0f)
							{
								num1323 = num1326;
							}
							if (num1324 == -1 && Main.npc[num1326].type == 397 && Main.npc[num1326].ai[2] == 1f)
							{
								num1324 = num1326;
							}
							if (num1323 != -1 && num1324 != -1 && num1325 != -1)
							{
								break;
							}
						}
					}
					int num1327 = 1000;
					int num1328 = Main.npc[num1322].lifeMax - Main.npc[num1322].life;
					int num1329 = Main.npc[num1323].lifeMax - Main.npc[num1323].life;
					int num1330 = Main.npc[num1324].lifeMax - Main.npc[num1324].life;
					int num1331 = Main.npc[num1325].lifeMax - Main.npc[num1325].life;
					if (num1331 > 0 && num1327 > 0)
					{
						int num1332 = num1331 - num1327;
						if (num1332 > 0)
						{
							num1332 = 0;
						}
						int num1333 = num1327 + num1332;
						num1327 -= num1333;
						NPC nPC3 = Main.npc[num1325];
						nPC3.life += num1333;
						HealEffect(Utils.CenteredRectangle(Main.npc[num1325].Center, new Vector2(50f)), num1333);
					}
					if (num1328 > 0 && num1327 > 0)
					{
						int num1334 = num1328 - num1327;
						if (num1334 > 0)
						{
							num1334 = 0;
						}
						int num1335 = num1327 + num1334;
						num1327 -= num1335;
						NPC nPC3 = Main.npc[num1322];
						nPC3.life += num1335;
						HealEffect(Utils.CenteredRectangle(Main.npc[num1322].Center, new Vector2(50f)), num1335);
					}
					if (num1329 > 0 && num1327 > 0)
					{
						int num1336 = num1329 - num1327;
						if (num1336 > 0)
						{
							num1336 = 0;
						}
						int num1337 = num1327 + num1336;
						num1327 -= num1337;
						NPC nPC3 = Main.npc[num1323];
						nPC3.life += num1337;
						HealEffect(Utils.CenteredRectangle(Main.npc[num1323].Center, new Vector2(50f)), num1337);
					}
					if (num1330 > 0 && num1327 > 0)
					{
						int num1338 = num1330 - num1327;
						if (num1338 > 0)
						{
							num1338 = 0;
						}
						int num1339 = num1327 + num1338;
						num1327 -= num1339;
						NPC nPC3 = Main.npc[num1324];
						nPC3.life += num1339;
						HealEffect(Utils.CenteredRectangle(Main.npc[num1324].Center, new Vector2(50f)), num1339);
					}
				}
				life = 0;
				HitEffect();
				active = false;
			}
			else
			{
				velocity = Vector2.Zero;
				base.Center = Vector2.Lerp(Main.projectile[num1321].Center, Main.npc[(int)Math.Abs(this.ai[0]) - 1].Center + vector229, this.ai[2] / num1319);
				Vector2 spinningpoint12 = Vector2.UnitY * -height / 2f;
				for (int num1340 = 0; num1340 < 6; num1340++)
				{
					int num1341 = Dust.NewDust(base.Center - Vector2.One * 4f + spinningpoint12.RotatedBy((float)num1340 * ((float)Math.PI * 2f) / 6f), 0, 0, 229);
					Main.dust[num1341].velocity = -Vector2.UnitY;
					Main.dust[num1341].noGravity = true;
					Main.dust[num1341].scale = 0.7f;
					Main.dust[num1341].customData = this;
				}
				spinningpoint12 = Vector2.UnitY * -height / 6f;
				for (int num1342 = 0; num1342 < 3; num1342++)
				{
					int num1343 = Dust.NewDust(base.Center - Vector2.One * 4f + spinningpoint12.RotatedBy((float)num1342 * ((float)Math.PI * 2f) / 6f), 0, 0, 229, 0f, -2f);
					Main.dust[num1343].noGravity = true;
					Main.dust[num1343].scale = 1.5f;
					Main.dust[num1343].customData = this;
				}
			}
		}
		else if (aiStyle == 83)
		{
			if (type == 437)
			{
				if (localAI[3] == 0f && Main.netMode != 1)
				{
					localAI[3] = 1f;
					netUpdate = true;
					Point[] spawnPoints = null;
					if (!CultistRitual.CheckFloor(base.Center, out spawnPoints))
					{
						life = 0;
						HitEffect();
						active = false;
						return;
					}
					int num1344 = 0;
					int num1345 = 1;
					for (int num1346 = 0; num1346 < 4; num1346++)
					{
						int num1347 = 0;
						bool flag92 = num1346 == 1 || num1346 == 2;
						num1347 = ((!flag92) ? 379 : 438);
						int num1348 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), spawnPoints[num1346].X * 16 + 8, spawnPoints[num1346].Y * 16 - 48, num1347);
						if (flag92)
						{
							localAI[num1345++] = num1348 + 1;
							Main.npc[num1348].ai[3] = -(whoAmI + 1);
						}
						else
						{
							this.ai[num1344++] = num1348 + 1;
							Main.npc[num1348].ai[3] = -(whoAmI + 1);
						}
						Main.npc[num1348].netUpdate = true;
					}
				}
				if (localAI[0] == 1f && Main.netMode != 1)
				{
					localAI[0] = 2f;
					for (int num1349 = 0; num1349 < 2; num1349++)
					{
						Main.npc[(int)localAI[num1349 + 1] - 1].ai[1] = 1f;
						Main.npc[(int)localAI[num1349 + 1] - 1].netUpdate = true;
						Main.npc[(int)this.ai[num1349] - 1].ai[3] = 0f;
						Main.npc[(int)this.ai[num1349] - 1].TargetClosest();
						Main.npc[(int)this.ai[num1349] - 1].netUpdate = true;
					}
				}
				if (this.ai[0] != -1f && Main.netMode != 1)
				{
					bool flag93 = true;
					for (int num1350 = 0; num1350 < 2; num1350++)
					{
						if (Main.npc[(int)localAI[num1350 + 1] - 1].active && Main.npc[(int)localAI[num1350 + 1] - 1].type == 438)
						{
							flag93 = false;
						}
						if (Main.npc[(int)this.ai[num1350] - 1].active && Main.npc[(int)this.ai[num1350] - 1].type == 379)
						{
							flag93 = false;
						}
					}
					if (flag93)
					{
						this.ai[0] = -1f;
						this.ai[1] = 0f;
						this.ai[3] = 0f;
						int num1351 = (int)base.Center.X / 16 + 11 * (Main.rand.Next(2) == 0).ToDirectionInt();
						int num1352 = 0;
						for (int num1353 = -5; num1353 < 12; num1353++)
						{
							int num1354 = num1351;
							int num1355 = (int)base.Center.Y / 16 + num1353;
							if (WorldGen.SolidTile(num1354, num1355) && !Collision.SolidTiles(num1354 - 1, num1354 + 1, num1355 - 3, num1355 - 1))
							{
								num1352 = num1355;
								break;
							}
							if (num1353 == 11)
							{
								num1352 = num1355;
							}
						}
						int num1356 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), num1351 * 16 + 10, num1352 * 16 - 2, 439);
						Main.npc[num1356].direction = (Main.npc[num1356].spriteDirection = Math.Sign(base.Center.X - (float)(num1351 * 16) - 10f));
						this.ai[2] = num1356;
						netUpdate = true;
						CultistRitual.TabletDestroyed();
					}
				}
				if (this.ai[0] == -1f)
				{
					this.ai[3]++;
					if (this.ai[3] > 300f)
					{
						life = 0;
						HitEffect(0, 9999.0);
						active = false;
						if (Main.netMode != 1)
						{
							for (int num1357 = 0; num1357 < 6; num1357++)
							{
								float num1358 = 3f + Main.rand.NextFloat() * 6f;
								Vector2 vector230 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
								Vector2 center39 = base.Center;
								center39 += vector230 * 30f;
								Projectile.NewProjectile(GetSpawnSource_ForProjectile(), center39.X, center39.Y, vector230.X * num1358, vector230.Y * num1358, 526, 0, 0f, Main.myPlayer, Main.npc[(int)this.ai[2]].Center.X, Main.npc[(int)this.ai[2]].Center.Y);
							}
							for (int num1359 = 0; num1359 < 20; num1359++)
							{
								if (Main.rand.Next(2) != 0)
								{
									float num1360 = 3f + Main.rand.NextFloat() * 6f;
									Vector2 vector231 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
									Vector2 center40 = base.Center;
									center40 += vector231 * 30f;
									Vector2 vector232 = base.Center + vector231 * (Main.rand.NextFloat() * 45f + 45f) + Vector2.UnitY * 20f;
									Projectile.NewProjectile(GetSpawnSource_ForProjectile(), center40.X, center40.Y, vector231.X * num1360, -20f, 526, 0, 0f, Main.myPlayer, vector232.X, vector232.Y);
								}
							}
						}
					}
					else if (this.ai[3] % 10f == 1f && this.ai[3] > 120f && Main.netMode != 1)
					{
						float num1361 = 3f + Main.rand.NextFloat() * 6f;
						Vector2 vector233 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Vector2 center41 = base.Center;
						center41 += vector233 * 25f;
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), center41.X, center41.Y, vector233.X * num1361, vector233.Y * num1361, 526, 0, 0f, Main.myPlayer, Main.npc[(int)this.ai[2]].Center.X, Main.npc[(int)this.ai[2]].Center.Y);
					}
				}
			}
			if (type == 438)
			{
				velocity.X *= 0.93f;
				if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
				{
					velocity.X = 0f;
				}
				int num1362 = (int)(0f - this.ai[3] - 1f);
				if (num1362 == -1)
				{
					life = 0;
					HitEffect();
					active = false;
					return;
				}
				int num1363 = Math.Sign(Main.npc[num1362].Center.X - base.Center.X);
				if (num1363 != direction)
				{
					velocity.X = 0f;
					direction = (spriteDirection = num1363);
					netUpdate = true;
				}
				if (justHit && Main.netMode != 1 && Main.npc[num1362].localAI[0] == 0f)
				{
					Main.npc[num1362].localAI[0] = 1f;
				}
				if ((this.ai[0] += 1f) >= 300f)
				{
					this.ai[0] = 0f;
					netUpdate = true;
				}
			}
			if (type == 437)
			{
				Lighting.AddLight(base.Center, 0.8f, 0.75f, 0.55f);
			}
		}
		else if (aiStyle == 84)
		{
			AI_084_LunaticCultist();
		}
		else if (aiStyle == 85)
		{
			noTileCollide = false;
			if (this.ai[0] == 0f)
			{
				TargetClosest();
				if (Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
				{
					this.ai[0] = 1f;
				}
				else
				{
					Vector2 vector234 = Main.player[target].Center - base.Center;
					vector234.Y -= Main.player[target].height / 4;
					float num1364 = vector234.Length();
					if (num1364 > 800f)
					{
						this.ai[0] = 2f;
					}
					else
					{
						Vector2 center42 = base.Center;
						center42.X = Main.player[target].Center.X;
						Vector2 vector235 = center42 - base.Center;
						if (vector235.Length() > 8f && Collision.CanHit(base.Center, 1, 1, center42, 1, 1))
						{
							this.ai[0] = 3f;
							this.ai[1] = center42.X;
							this.ai[2] = center42.Y;
							Vector2 center43 = base.Center;
							center43.Y = Main.player[target].Center.Y;
							if (vector235.Length() > 8f && Collision.CanHit(base.Center, 1, 1, center43, 1, 1) && Collision.CanHit(center43, 1, 1, Main.player[target].position, 1, 1))
							{
								this.ai[0] = 3f;
								this.ai[1] = center43.X;
								this.ai[2] = center43.Y;
							}
						}
						else
						{
							center42 = base.Center;
							center42.Y = Main.player[target].Center.Y;
							if ((center42 - base.Center).Length() > 8f && Collision.CanHit(base.Center, 1, 1, center42, 1, 1))
							{
								this.ai[0] = 3f;
								this.ai[1] = center42.X;
								this.ai[2] = center42.Y;
							}
						}
						if (this.ai[0] == 0f)
						{
							localAI[0] = 0f;
							vector234.Normalize();
							vector234 *= 0.5f;
							velocity += vector234;
							this.ai[0] = 4f;
							this.ai[1] = 0f;
						}
					}
				}
			}
			else if (this.ai[0] == 1f)
			{
				rotation += (float)direction * 0.3f;
				Vector2 vector236 = Main.player[target].Center - base.Center;
				if (type == 421)
				{
					vector236 = Main.player[target].Top - base.Center;
				}
				float num1365 = vector236.Length();
				float num1366 = 5.5f;
				if (type == 405)
				{
					num1366 = 8f;
				}
				num1366 += num1365 / 100f;
				int num1367 = 50;
				vector236.Normalize();
				vector236 *= num1366;
				velocity = (velocity * (num1367 - 1) + vector236) / num1367;
				if (!Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
				{
					this.ai[0] = 0f;
					this.ai[1] = 0f;
				}
				if (type == 421 && num1365 < 40f && Main.player[target].active && !Main.player[target].dead)
				{
					bool flag94 = true;
					for (int num1368 = 0; num1368 < Main.maxNPCs; num1368++)
					{
						NPC nPC11 = Main.npc[num1368];
						if (nPC11.active && nPC11.type == type && nPC11.ai[0] == 5f && nPC11.target == target)
						{
							flag94 = false;
							break;
						}
					}
					if (flag94)
					{
						base.Center = Main.player[target].Top;
						velocity = Vector2.Zero;
						this.ai[0] = 5f;
						this.ai[1] = 0f;
						netUpdate = true;
					}
				}
			}
			else if (this.ai[0] == 2f)
			{
				rotation = velocity.X * 0.1f;
				noTileCollide = true;
				Vector2 vector237 = Main.player[target].Center - base.Center;
				float num1369 = vector237.Length();
				float num1370 = 3f;
				if (type == 405)
				{
					num1370 = 6f;
				}
				int num1371 = 3;
				vector237.Normalize();
				vector237 *= num1370;
				velocity = (velocity * (num1371 - 1) + vector237) / num1371;
				if (num1369 < 600f && !Collision.SolidCollision(position, width, height))
				{
					this.ai[0] = 0f;
				}
			}
			else if (this.ai[0] == 3f)
			{
				rotation = velocity.X * 0.1f;
				Vector2 vector238 = new Vector2(this.ai[1], this.ai[2]);
				Vector2 vector239 = vector238 - base.Center;
				float num1372 = vector239.Length();
				float num1373 = 2f;
				if (type == 405)
				{
					num1373 = 3f;
				}
				float num1374 = 3f;
				vector239.Normalize();
				vector239 *= num1373;
				velocity = (velocity * (num1374 - 1f) + vector239) / num1374;
				if (collideX || collideY)
				{
					this.ai[0] = 4f;
					this.ai[1] = 0f;
				}
				if (num1372 < num1373 || num1372 > 800f || Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
				{
					this.ai[0] = 0f;
				}
			}
			else if (this.ai[0] == 4f)
			{
				rotation = velocity.X * 0.1f;
				if (collideX)
				{
					velocity.X *= -0.8f;
				}
				if (collideY)
				{
					velocity.Y *= -0.8f;
				}
				Vector2 vector240;
				if (velocity.X == 0f && velocity.Y == 0f)
				{
					vector240 = Main.player[target].Center - base.Center;
					vector240.Y -= Main.player[target].height / 4;
					vector240.Normalize();
					velocity = vector240 * 0.1f;
				}
				float num1375 = 2f;
				if (type == 405)
				{
					num1375 = 3f;
				}
				float num1376 = 20f;
				vector240 = velocity;
				vector240.Normalize();
				vector240 *= num1375;
				velocity = (velocity * (num1376 - 1f) + vector240) / num1376;
				this.ai[1] += 1f;
				if (this.ai[1] > 180f)
				{
					this.ai[0] = 0f;
					this.ai[1] = 0f;
				}
				if (Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
				{
					this.ai[0] = 0f;
				}
				localAI[0] += 1f;
				if (localAI[0] >= 5f && !Collision.SolidCollision(position - new Vector2(10f, 10f), width + 20, height + 20))
				{
					localAI[0] = 0f;
					Vector2 center44 = base.Center;
					center44.X = Main.player[target].Center.X;
					if (Collision.CanHit(base.Center, 1, 1, center44, 1, 1) && Collision.CanHit(base.Center, 1, 1, center44, 1, 1) && Collision.CanHit(Main.player[target].Center, 1, 1, center44, 1, 1))
					{
						this.ai[0] = 3f;
						this.ai[1] = center44.X;
						this.ai[2] = center44.Y;
					}
					else
					{
						center44 = base.Center;
						center44.Y = Main.player[target].Center.Y;
						if (Collision.CanHit(base.Center, 1, 1, center44, 1, 1) && Collision.CanHit(Main.player[target].Center, 1, 1, center44, 1, 1))
						{
							this.ai[0] = 3f;
							this.ai[1] = center44.X;
							this.ai[2] = center44.Y;
						}
					}
				}
			}
			else if (this.ai[0] == 5f)
			{
				Player player15 = Main.player[target];
				if (!player15.active || player15.dead)
				{
					this.ai[0] = 0f;
					this.ai[1] = 0f;
					netUpdate = true;
				}
				else
				{
					base.Center = ((player15.gravDir == 1f) ? player15.Top : player15.Bottom) + new Vector2(player15.direction * 4, 0f);
					gfxOffY = player15.gfxOffY;
					velocity = Vector2.Zero;
					if (!player15.creativeGodMode)
					{
						player15.AddBuff(163, 59);
					}
				}
			}
			if (type == 405)
			{
				rotation = 0f;
				for (int num1377 = 0; num1377 < Main.maxNPCs; num1377++)
				{
					if (num1377 != whoAmI && Main.npc[num1377].active && Main.npc[num1377].type == type && Math.Abs(position.X - Main.npc[num1377].position.X) + Math.Abs(position.Y - Main.npc[num1377].position.Y) < (float)width)
					{
						if (position.X < Main.npc[num1377].position.X)
						{
							velocity.X -= 0.05f;
						}
						else
						{
							velocity.X += 0.05f;
						}
						if (position.Y < Main.npc[num1377].position.Y)
						{
							velocity.Y -= 0.05f;
						}
						else
						{
							velocity.Y += 0.05f;
						}
					}
				}
			}
			else
			{
				if (type != 421)
				{
					return;
				}
				hide = this.ai[0] == 5f;
				rotation = velocity.X * 0.1f;
				for (int num1378 = 0; num1378 < Main.maxNPCs; num1378++)
				{
					if (num1378 != whoAmI && Main.npc[num1378].active && Main.npc[num1378].type == type && Math.Abs(position.X - Main.npc[num1378].position.X) + Math.Abs(position.Y - Main.npc[num1378].position.Y) < (float)width)
					{
						if (position.X < Main.npc[num1378].position.X)
						{
							velocity.X -= 0.05f;
						}
						else
						{
							velocity.X += 0.05f;
						}
						if (position.Y < Main.npc[num1378].position.Y)
						{
							velocity.Y -= 0.05f;
						}
						else
						{
							velocity.Y += 0.05f;
						}
					}
				}
			}
		}
		else if (aiStyle == 86)
		{
			if (alpha > 0)
			{
				alpha -= 30;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			noGravity = true;
			noTileCollide = true;
			knockBackResist = 0f;
			for (int num1379 = 0; num1379 < Main.maxNPCs; num1379++)
			{
				if (num1379 == whoAmI || !Main.npc[num1379].active || Main.npc[num1379].type != type)
				{
					continue;
				}
				Vector2 vector241 = Main.npc[num1379].Center - base.Center;
				if (!(vector241.Length() < 50f))
				{
					continue;
				}
				vector241.Normalize();
				if (vector241.X == 0f && vector241.Y == 0f)
				{
					if (num1379 > whoAmI)
					{
						vector241.X = 1f;
					}
					else
					{
						vector241.X = -1f;
					}
				}
				vector241 *= 0.4f;
				velocity -= vector241;
				NPC nPC3 = Main.npc[num1379];
				nPC3.velocity += vector241;
			}
			if (type == 472)
			{
				float num1380 = 120f;
				if (localAI[0] < num1380)
				{
					if (localAI[0] == 0f)
					{
						SoundEngine.PlaySound(SoundID.Item8, base.Center);
						TargetClosest();
						if (direction > 0)
						{
							velocity.X += 2f;
						}
						else
						{
							velocity.X -= 2f;
						}
						position += netOffset;
						for (int num1381 = 0; num1381 < 20; num1381++)
						{
							Vector2 center45 = base.Center;
							center45.Y -= 18f;
							Vector2 vector242 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
							vector242.Normalize();
							vector242 *= (float)Main.rand.Next(0, 100) * 0.1f;
							center45 += vector242;
							vector242.Normalize();
							vector242 *= (float)Main.rand.Next(50, 90) * 0.2f;
							int num1382 = Dust.NewDust(center45, 1, 1, 27);
							Main.dust[num1382].velocity = -vector242 * 0.3f;
							Main.dust[num1382].alpha = 100;
							if (Main.rand.Next(2) == 0)
							{
								Main.dust[num1382].noGravity = true;
								Dust dust = Main.dust[num1382];
								dust.scale += 0.3f;
							}
						}
						position -= netOffset;
					}
					localAI[0] += 1f;
					float num1383 = 1f - localAI[0] / num1380;
					float num1384 = num1383 * 20f;
					for (int num1385 = 0; (float)num1385 < num1384; num1385++)
					{
						if (Main.rand.Next(5) == 0)
						{
							position += netOffset;
							int num1386 = Dust.NewDust(position, width, height, 27);
							Main.dust[num1386].alpha = 100;
							Dust dust = Main.dust[num1386];
							dust.velocity *= 0.3f;
							dust = Main.dust[num1386];
							dust.velocity += velocity * 0.75f;
							Main.dust[num1386].noGravity = true;
							position -= netOffset;
						}
					}
				}
			}
			if (type == 521)
			{
				float num1387 = 120f;
				if (localAI[0] < num1387)
				{
					if (localAI[0] == 0f)
					{
						SoundEngine.PlaySound(SoundID.Item8, base.Center);
						TargetClosest();
						if (direction > 0)
						{
							velocity.X += 2f;
						}
						else
						{
							velocity.X -= 2f;
						}
					}
					localAI[0] += 1f;
					int num1388 = 10;
					for (int num1389 = 0; num1389 < 2; num1389++)
					{
						position += netOffset;
						int num1390 = Dust.NewDust(position - new Vector2(num1388), width + num1388 * 2, height + num1388 * 2, 228, 0f, 0f, 100, default(Color), 2f);
						Main.dust[num1390].noGravity = true;
						Main.dust[num1390].noLight = true;
						position -= netOffset;
					}
				}
			}
			if (this.ai[0] == 0f)
			{
				TargetClosest();
				this.ai[0] = 1f;
				this.ai[1] = direction;
			}
			else if (this.ai[0] == 1f)
			{
				TargetClosest();
				float num1391 = 0.3f;
				float num1392 = 7f;
				float num1393 = 4f;
				float num1394 = 660f;
				float num1395 = 4f;
				if (type == 521)
				{
					num1391 = 0.7f;
					num1392 = 14f;
					num1394 = 500f;
					num1393 = 6f;
					num1395 = 3f;
				}
				velocity.X += this.ai[1] * num1391;
				if (velocity.X > num1392)
				{
					velocity.X = num1392;
				}
				if (velocity.X < 0f - num1392)
				{
					velocity.X = 0f - num1392;
				}
				float num1396 = Main.player[target].Center.Y - base.Center.Y;
				if (Math.Abs(num1396) > num1393)
				{
					num1395 = 15f;
				}
				if (num1396 > num1393)
				{
					num1396 = num1393;
				}
				else if (num1396 < 0f - num1393)
				{
					num1396 = 0f - num1393;
				}
				velocity.Y = (velocity.Y * (num1395 - 1f) + num1396) / num1395;
				if ((this.ai[1] > 0f && Main.player[target].Center.X - base.Center.X < 0f - num1394) || (this.ai[1] < 0f && Main.player[target].Center.X - base.Center.X > num1394))
				{
					this.ai[0] = 2f;
					this.ai[1] = 0f;
					if (base.Center.Y + 20f > Main.player[target].Center.Y)
					{
						this.ai[1] = -1f;
					}
					else
					{
						this.ai[1] = 1f;
					}
				}
			}
			else if (this.ai[0] == 2f)
			{
				float num1397 = 0.4f;
				float num1398 = 0.95f;
				float num1399 = 5f;
				if (type == 521)
				{
					num1397 = 0.3f;
					num1399 = 7f;
					num1398 = 0.9f;
				}
				velocity.Y += this.ai[1] * num1397;
				if (velocity.Length() > num1399)
				{
					velocity *= num1398;
				}
				if (velocity.X > -1f && velocity.X < 1f)
				{
					TargetClosest();
					this.ai[0] = 3f;
					this.ai[1] = direction;
				}
			}
			else if (this.ai[0] == 3f)
			{
				float num1400 = 0.4f;
				float num1401 = 0.2f;
				float num1402 = 5f;
				float num1403 = 0.95f;
				if (type == 521)
				{
					num1400 = 0.6f;
					num1401 = 0.3f;
					num1402 = 7f;
					num1403 = 0.9f;
				}
				velocity.X += this.ai[1] * num1400;
				if (base.Center.Y > Main.player[target].Center.Y)
				{
					velocity.Y -= num1401;
				}
				else
				{
					velocity.Y += num1401;
				}
				if (velocity.Length() > num1402)
				{
					velocity *= num1403;
				}
				if (velocity.Y > -1f && velocity.Y < 1f)
				{
					TargetClosest();
					this.ai[0] = 0f;
					this.ai[1] = direction;
				}
			}
			if (type == 521)
			{
				int num1404 = 10;
				position += netOffset;
				for (int num1405 = 0; num1405 < 1; num1405++)
				{
					int num1406 = Dust.NewDust(position - new Vector2(num1404), width + num1404 * 2, height + num1404 * 2, 228, 0f, 0f, 100, default(Color), 2f);
					Main.dust[num1406].noGravity = true;
					Main.dust[num1406].noLight = true;
				}
				position -= netOffset;
			}
		}
		else if (aiStyle == 87)
		{
			knockBackResist = GetKnockbackMultiplier_ScaledByDifficulty(0.2f);
			dontTakeDamage = false;
			noTileCollide = false;
			noGravity = false;
			reflectsProjectiles = false;
			if (this.ai[0] != 7f && Main.player[target].dead)
			{
				TargetClosest();
				if (Main.player[target].dead)
				{
					this.ai[0] = 7f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
			}
			if (this.ai[0] == 0f)
			{
				TargetClosest();
				Vector2 vector243 = Main.player[target].Center - base.Center;
				if (Main.netMode != 1 && (velocity.X != 0f || velocity.Y > 100f || justHit || vector243.Length() < 80f))
				{
					this.ai[0] = 1f;
					this.ai[1] = 0f;
					netUpdate = true;
				}
			}
			else if (this.ai[0] == 1f)
			{
				this.ai[1] += 1f;
				if (Main.netMode != 1 && this.ai[1] > 36f)
				{
					this.ai[0] = 2f;
					this.ai[1] = 0f;
					netUpdate = true;
				}
			}
			else if (this.ai[0] == 2f)
			{
				Vector2 vector244 = Main.player[target].Center - base.Center;
				if (Main.netMode != 1 && vector244.Length() > 600f)
				{
					this.ai[0] = 5f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
				if (velocity.Y == 0f)
				{
					TargetClosest();
					velocity.X *= 0.85f;
					this.ai[1] += 1f;
					float num1407 = 15f + 30f * ((float)life / (float)lifeMax);
					float num1408 = 3f + 4f * (1f - (float)life / (float)lifeMax);
					float num1409 = 4f;
					if (!Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
					{
						num1409 += 2f;
					}
					if (Main.netMode != 1 && this.ai[1] > num1407)
					{
						this.ai[3] += 1f;
						if (this.ai[3] >= 3f)
						{
							this.ai[3] = 0f;
							num1409 *= 2f;
							num1408 /= 2f;
						}
						this.ai[1] = 0f;
						velocity.Y -= num1409;
						velocity.X = num1408 * (float)direction;
						netUpdate = true;
					}
				}
				else
				{
					knockBackResist = 0f;
					velocity.X *= 0.99f;
					if (direction < 0 && velocity.X > -1f)
					{
						velocity.X = -1f;
					}
					if (direction > 0 && velocity.X < 1f)
					{
						velocity.X = 1f;
					}
				}
				this.ai[2] += 1f;
				if ((double)this.ai[2] > 210.0 && velocity.Y == 0f && Main.netMode != 1)
				{
					switch (Main.rand.Next(3))
					{
					case 0:
						this.ai[0] = 3f;
						break;
					case 1:
						this.ai[0] = 4f;
						noTileCollide = true;
						velocity.Y = -8f;
						break;
					case 2:
						this.ai[0] = 6f;
						break;
					default:
						this.ai[0] = 2f;
						break;
					}
					if (Main.tenthAnniversaryWorld && type == 476 && this.ai[0] == 3f && Main.rand.Next(2) == 0)
					{
						this.ai[0] = 8f;
					}
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
			}
			else if (this.ai[0] == 3f)
			{
				velocity.X *= 0.85f;
				dontTakeDamage = true;
				this.ai[1] += 1f;
				if (Main.netMode != 1 && this.ai[1] >= 180f)
				{
					this.ai[0] = 2f;
					this.ai[1] = 0f;
					netUpdate = true;
				}
				if (Main.expertMode)
				{
					ReflectProjectiles(base.Hitbox);
					reflectsProjectiles = true;
				}
			}
			else if (this.ai[0] == 4f)
			{
				noTileCollide = true;
				noGravity = true;
				knockBackResist = 0f;
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
				spriteDirection = direction;
				TargetClosest();
				Vector2 center46 = Main.player[target].Center;
				center46.Y -= 350f;
				Vector2 vector245 = center46 - base.Center;
				if (this.ai[2] == 1f)
				{
					this.ai[1] += 1f;
					vector245 = Main.player[target].Center - base.Center;
					vector245.Normalize();
					vector245 *= 8f;
					velocity = (velocity * 4f + vector245) / 5f;
					if (Main.netMode != 1 && this.ai[1] > 6f)
					{
						this.ai[1] = 0f;
						this.ai[0] = 4.1f;
						this.ai[2] = 0f;
						velocity = vector245;
						netUpdate = true;
					}
				}
				else if (Math.Abs(base.Center.X - Main.player[target].Center.X) < 40f && base.Center.Y < Main.player[target].Center.Y - 300f)
				{
					if (Main.netMode != 1)
					{
						this.ai[1] = 0f;
						this.ai[2] = 1f;
						netUpdate = true;
					}
				}
				else
				{
					vector245.Normalize();
					vector245 *= 12f;
					velocity = (velocity * 5f + vector245) / 6f;
				}
			}
			else if (this.ai[0] == 4.1f)
			{
				knockBackResist = 0f;
				if (this.ai[2] == 0f && Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1) && !Collision.SolidCollision(position, width, height))
				{
					this.ai[2] = 1f;
				}
				if (position.Y + (float)height >= Main.player[target].position.Y || velocity.Y <= 0f)
				{
					this.ai[1] += 1f;
					if (Main.netMode != 1 && this.ai[1] > 10f)
					{
						this.ai[0] = 2f;
						this.ai[1] = 0f;
						this.ai[2] = 0f;
						this.ai[3] = 0f;
						netUpdate = true;
						if (Collision.SolidCollision(position, width, height))
						{
							this.ai[0] = 5f;
						}
					}
				}
				else if (this.ai[2] == 0f)
				{
					noTileCollide = true;
					noGravity = true;
					knockBackResist = 0f;
				}
				velocity.Y += 0.2f;
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
			}
			else if (this.ai[0] == 5f)
			{
				if (velocity.X > 0f)
				{
					direction = 1;
				}
				else
				{
					direction = -1;
				}
				spriteDirection = direction;
				noTileCollide = true;
				noGravity = true;
				knockBackResist = 0f;
				Vector2 vector246 = Main.player[target].Center - base.Center;
				vector246.Y -= 4f;
				if (Main.netMode != 1 && vector246.Length() < 200f && !Collision.SolidCollision(position, width, height))
				{
					this.ai[0] = 2f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
				if (vector246.Length() > 10f)
				{
					vector246.Normalize();
					vector246 *= 10f;
				}
				velocity = (velocity * 4f + vector246) / 5f;
			}
			else if (this.ai[0] == 6f)
			{
				knockBackResist = 0f;
				if (velocity.Y == 0f)
				{
					TargetClosest();
					velocity.X *= 0.8f;
					this.ai[1] += 1f;
					if (this.ai[1] > 5f)
					{
						this.ai[1] = 0f;
						velocity.Y -= 4f;
						if (Main.player[target].position.Y + (float)Main.player[target].height < base.Center.Y)
						{
							velocity.Y -= 1.25f;
						}
						if (Main.player[target].position.Y + (float)Main.player[target].height < base.Center.Y - 40f)
						{
							velocity.Y -= 1.5f;
						}
						if (Main.player[target].position.Y + (float)Main.player[target].height < base.Center.Y - 80f)
						{
							velocity.Y -= 1.75f;
						}
						if (Main.player[target].position.Y + (float)Main.player[target].height < base.Center.Y - 120f)
						{
							velocity.Y -= 2f;
						}
						if (Main.player[target].position.Y + (float)Main.player[target].height < base.Center.Y - 160f)
						{
							velocity.Y -= 2.25f;
						}
						if (Main.player[target].position.Y + (float)Main.player[target].height < base.Center.Y - 200f)
						{
							velocity.Y -= 2.5f;
						}
						if (!Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
						{
							velocity.Y -= 2f;
						}
						velocity.X = 12 * direction;
						this.ai[2] += 1f;
						netUpdate = true;
					}
				}
				else
				{
					velocity.X *= 0.98f;
					if (direction < 0 && velocity.X > -8f)
					{
						velocity.X = -8f;
					}
					if (direction > 0 && velocity.X < 8f)
					{
						velocity.X = 8f;
					}
				}
				if (Main.netMode != 1 && this.ai[2] >= 3f && velocity.Y == 0f)
				{
					this.ai[0] = 2f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
			}
			else if (this.ai[0] == 7f)
			{
				damage = 0;
				life = lifeMax;
				defense = 9999;
				noTileCollide = true;
				alpha += 7;
				if (alpha > 255)
				{
					alpha = 255;
				}
				velocity.X *= 0.98f;
			}
			else
			{
				if (this.ai[0] != 8f)
				{
					return;
				}
				velocity.X *= 0.85f;
				this.ai[1] += 1f;
				if (Main.netMode != 1)
				{
					if (!Main.tenthAnniversaryWorld || this.ai[1] >= 180f)
					{
						this.ai[0] = 2f;
						this.ai[1] = 0f;
						netUpdate = true;
					}
					else if (this.ai[1] % 20f == 0f)
					{
						AI_87_BigMimic_FireStuffCannonBurst();
					}
				}
			}
		}
		else if (aiStyle == 88)
		{
			int num1410 = 7;
			noTileCollide = false;
			noGravity = true;
			knockBackResist = GetKnockbackMultiplier_ScaledByDifficulty(0.2f);
			damage = defDamage;
			if (!Main.eclipse && Main.netMode != 1)
			{
				if (this.ai[0] != -1f)
				{
					netUpdate = true;
				}
				this.ai[0] = -1f;
			}
			else if (target < 0 || Main.player[target].dead || !Main.player[target].active)
			{
				TargetClosest();
				Vector2 vector247 = Main.player[target].Center - base.Center;
				if (Main.netMode != 1 && (Main.player[target].dead || vector247.Length() > 3000f))
				{
					if (this.ai[0] != -1f)
					{
						netUpdate = true;
					}
					this.ai[0] = -1f;
				}
			}
			else
			{
				Vector2 vector248 = Main.player[target].Center - base.Center;
				if (Main.netMode != 1 && this.ai[0] > 1f && vector248.Length() > 1000f)
				{
					if (this.ai[0] != 1f)
					{
						netUpdate = true;
					}
					this.ai[0] = 1f;
				}
			}
			if (this.ai[0] == -1f)
			{
				Vector2 vector249 = new Vector2(0f, -8f);
				velocity = (velocity * 9f + vector249) / 10f;
				noTileCollide = true;
				dontTakeDamage = true;
			}
			else if (this.ai[0] == 0f)
			{
				TargetClosest();
				if (base.Center.X < Main.player[target].Center.X - 2f)
				{
					direction = 1;
				}
				if (base.Center.X > Main.player[target].Center.X + 2f)
				{
					direction = -1;
				}
				spriteDirection = direction;
				rotation = (rotation * 9f + velocity.X * 0.1f) / 10f;
				if (collideX)
				{
					velocity.X *= (0f - oldVelocity.X) * 0.5f;
					if (velocity.X > 4f)
					{
						velocity.X = 4f;
					}
					if (velocity.X < -4f)
					{
						velocity.X = -4f;
					}
				}
				if (collideY)
				{
					velocity.Y *= (0f - oldVelocity.Y) * 0.5f;
					if (velocity.Y > 4f)
					{
						velocity.Y = 4f;
					}
					if (velocity.Y < -4f)
					{
						velocity.Y = -4f;
					}
				}
				Vector2 vector250 = Main.player[target].Center - base.Center;
				vector250.Y -= 200f;
				if (vector250.Length() > 800f)
				{
					this.ai[0] = 1f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
				else if (vector250.Length() > 80f)
				{
					float num1411 = 6f;
					float num1412 = 30f;
					vector250.Normalize();
					vector250 *= num1411;
					velocity = (velocity * (num1412 - 1f) + vector250) / num1412;
				}
				else if (velocity.Length() > 2f)
				{
					velocity *= 0.95f;
				}
				else if (velocity.Length() < 1f)
				{
					velocity *= 1.05f;
				}
				if (Main.netMode == 1)
				{
					return;
				}
				this.ai[1] += 1f;
				if (justHit)
				{
					this.ai[1] += Main.rand.Next(10, 30);
				}
				if (!(this.ai[1] >= 180f))
				{
					return;
				}
				this.ai[1] = 0f;
				this.ai[2] = 0f;
				this.ai[3] = 0f;
				netUpdate = true;
				while (this.ai[0] == 0f)
				{
					int num1413 = Main.rand.Next(3);
					if (num1413 == 0 && Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
					{
						this.ai[0] = 2f;
						continue;
					}
					switch (num1413)
					{
					case 1:
						this.ai[0] = 3f;
						break;
					case 2:
						if (CountNPCS(478) + CountNPCS(479) < num1410)
						{
							this.ai[0] = 4f;
						}
						break;
					}
				}
			}
			else if (this.ai[0] == 1f)
			{
				collideX = false;
				collideY = false;
				noTileCollide = true;
				knockBackResist = 0f;
				if (target < 0 || !Main.player[target].active || Main.player[target].dead)
				{
					TargetClosest();
				}
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else if (velocity.X > 0f)
				{
					direction = 1;
				}
				spriteDirection = direction;
				rotation = (rotation * 9f + velocity.X * 0.08f) / 10f;
				Vector2 vector251 = Main.player[target].Center - base.Center;
				if (Main.netMode != 1 && vector251.Length() < 300f && !Collision.SolidCollision(position, width, height))
				{
					this.ai[0] = 0f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
				float num1414 = 7f + vector251.Length() / 100f;
				float num1415 = 25f;
				vector251.Normalize();
				vector251 *= num1414;
				velocity = (velocity * (num1415 - 1f) + vector251) / num1415;
			}
			else if (this.ai[0] == 2f)
			{
				damage = (int)((double)defDamage * 0.5);
				knockBackResist = 0f;
				if (target < 0 || !Main.player[target].active || Main.player[target].dead)
				{
					TargetClosest();
					this.ai[0] = 0f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
					netUpdate = true;
				}
				if (Main.player[target].Center.X - 10f < base.Center.X)
				{
					direction = -1;
				}
				else if (Main.player[target].Center.X + 10f > base.Center.X)
				{
					direction = 1;
				}
				spriteDirection = direction;
				rotation = (rotation * 4f + velocity.X * 0.1f) / 5f;
				if (collideX)
				{
					velocity.X *= (0f - oldVelocity.X) * 0.5f;
					if (velocity.X > 4f)
					{
						velocity.X = 4f;
					}
					if (velocity.X < -4f)
					{
						velocity.X = -4f;
					}
				}
				if (collideY)
				{
					velocity.Y *= (0f - oldVelocity.Y) * 0.5f;
					if (velocity.Y > 4f)
					{
						velocity.Y = 4f;
					}
					if (velocity.Y < -4f)
					{
						velocity.Y = -4f;
					}
				}
				Vector2 vector252 = Main.player[target].Center - base.Center;
				vector252.Y -= 20f;
				this.ai[2] += 1f / 45f;
				if (Main.expertMode)
				{
					this.ai[2] += 1f / 60f;
				}
				float num1416 = 4f + this.ai[2] + vector252.Length() / 120f;
				float num1417 = 20f;
				vector252.Normalize();
				vector252 *= num1416;
				velocity = (velocity * (num1417 - 1f) + vector252) / num1417;
				if (Main.netMode != 1)
				{
					this.ai[1] += 1f;
					if (this.ai[1] > 240f || !Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
					{
						this.ai[0] = 0f;
						this.ai[1] = 0f;
						this.ai[2] = 0f;
						this.ai[3] = 0f;
						netUpdate = true;
					}
				}
			}
			else if (this.ai[0] == 3f)
			{
				knockBackResist = 0f;
				noTileCollide = true;
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
				spriteDirection = direction;
				rotation = (rotation * 4f + velocity.X * 0.07f) / 5f;
				Vector2 vector253 = Main.player[target].Center - base.Center;
				vector253.Y -= 12f;
				if (base.Center.X > Main.player[target].Center.X)
				{
					vector253.X += 400f;
				}
				else
				{
					vector253.X -= 400f;
				}
				if (Main.netMode != 1 && Math.Abs(base.Center.X - Main.player[target].Center.X) > 350f && Math.Abs(base.Center.Y - Main.player[target].Center.Y) < 20f)
				{
					this.ai[0] = 3.1f;
					this.ai[1] = 0f;
					netUpdate = true;
				}
				this.ai[1] += 1f / 30f;
				float num1418 = 8f + this.ai[1];
				float num1419 = 4f;
				vector253.Normalize();
				vector253 *= num1418;
				velocity = (velocity * (num1419 - 1f) + vector253) / num1419;
			}
			else if (this.ai[0] == 3.1f)
			{
				knockBackResist = 0f;
				noTileCollide = true;
				rotation = (rotation * 4f + velocity.X * 0.07f) / 5f;
				Vector2 vector254 = Main.player[target].Center - base.Center;
				vector254.Y -= 12f;
				float num1420 = 16f;
				float num1421 = 8f;
				vector254.Normalize();
				vector254 *= num1420;
				velocity = (velocity * (num1421 - 1f) + vector254) / num1421;
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
				spriteDirection = direction;
				this.ai[1] += 1f;
				if (Main.netMode != 1 && this.ai[1] > 10f)
				{
					velocity = vector254;
					if (velocity.X < 0f)
					{
						direction = -1;
					}
					else
					{
						direction = 1;
					}
					this.ai[0] = 3.2f;
					this.ai[1] = 0f;
					this.ai[1] = direction;
					netUpdate = true;
				}
			}
			else if (this.ai[0] == 3.2f)
			{
				damage = (int)((double)defDamage * 1.3);
				collideX = false;
				collideY = false;
				knockBackResist = 0f;
				noTileCollide = true;
				this.ai[2] += 1f / 30f;
				velocity.X = (16f + this.ai[2]) * this.ai[1];
				if ((this.ai[1] > 0f && base.Center.X > Main.player[target].Center.X + 260f) || (this.ai[1] < 0f && base.Center.X < Main.player[target].Center.X - 260f))
				{
					if (Main.netMode != 1 && !Collision.SolidCollision(position, width, height))
					{
						this.ai[0] = 0f;
						this.ai[1] = 0f;
						this.ai[2] = 0f;
						this.ai[3] = 0f;
						netUpdate = true;
					}
					else if (Main.netMode != 1 && Math.Abs(base.Center.X - Main.player[target].Center.X) > 800f)
					{
						this.ai[0] = 1f;
						this.ai[1] = 0f;
						this.ai[2] = 0f;
						this.ai[3] = 0f;
						netUpdate = true;
					}
				}
				rotation = (rotation * 4f + velocity.X * 0.07f) / 5f;
			}
			else if (this.ai[0] == 4f)
			{
				bool flag95 = (double)(base.Center.Y / 16f) < Main.worldSurface;
				TargetClosest();
				if (Main.netMode != 1)
				{
					this.ai[0] = 0f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					for (int num1422 = 0; num1422 < 1000; num1422++)
					{
						int num1423 = (int)Main.player[target].Center.X / 16;
						int num1424 = (int)Main.player[target].Center.Y / 16;
						int num1425 = 30 + num1422 / 50;
						int num1426 = 20 + num1422 / 75;
						num1423 += Main.rand.Next(-num1425, num1425 + 1);
						num1424 += Main.rand.Next(-num1426, num1426 + 1);
						if (WorldGen.SolidTile(num1423, num1424))
						{
							continue;
						}
						bool flag96 = false;
						int num1427 = 50;
						while (num1427 > 0)
						{
							num1427--;
							if (!WorldGen.InWorld(num1423, num1424, 5))
							{
								flag96 = true;
								break;
							}
							Tile tile2 = Main.tile[num1423, num1424];
							if (tile2 == null)
							{
								flag96 = true;
								break;
							}
							if (tile2.liquid > 0 && tile2.lava())
							{
								flag96 = true;
								break;
							}
							Tile tile3 = Main.tile[num1423, num1424 - 1];
							if (tile3 == null)
							{
								flag96 = true;
								break;
							}
							if (tile3.liquid > 0 && tile3.lava())
							{
								flag96 = true;
								break;
							}
							if (WorldGen.SolidTile(num1423, num1424) || (flag95 && (double)num1424 > Main.worldSurface))
							{
								break;
							}
							num1424++;
						}
						if (!(num1427 <= 0 || flag96) && (new Vector2(num1423 * 16 + 8, num1424 * 16 + 8) - Main.player[target].Center).Length() < 600f)
						{
							this.ai[0] = 4.1f;
							this.ai[1] = num1423;
							this.ai[2] = num1424;
							break;
						}
					}
				}
				netUpdate = true;
			}
			else if (this.ai[0] == 4.1f)
			{
				if (velocity.X < -2f)
				{
					direction = -1;
				}
				else if (velocity.X > 2f)
				{
					direction = 1;
				}
				spriteDirection = direction;
				rotation = (rotation * 9f + velocity.X * 0.1f) / 10f;
				noTileCollide = true;
				int num1428 = (int)this.ai[1];
				int num1429 = (int)this.ai[2];
				float x4 = num1428 * 16 + 8;
				float y4 = num1429 * 16 - 20;
				Vector2 v13 = new Vector2(x4, y4);
				v13 -= base.Center;
				float num1430 = 6f + v13.Length() / 150f;
				if (num1430 > 10f)
				{
					num1430 = 10f;
				}
				float num1431 = 10f;
				if (v13.Length() < 10f)
				{
					this.ai[0] = 4.2f;
					netUpdate = true;
				}
				v13 = v13.SafeNormalize(Vector2.Zero);
				v13 *= num1430;
				velocity = (velocity * (num1431 - 1f) + v13) / num1431;
				if (velocity.Length() > num1430)
				{
					velocity.Normalize();
					velocity *= num1430;
				}
			}
			else
			{
				if (this.ai[0] != 4.2f)
				{
					return;
				}
				rotation = (rotation * 9f + velocity.X * 0.1f) / 10f;
				knockBackResist = 0f;
				noTileCollide = true;
				int num1432 = (int)this.ai[1];
				int num1433 = (int)this.ai[2];
				float x5 = num1432 * 16 + 8;
				float y5 = num1433 * 16 - 20;
				Vector2 vector255 = new Vector2(x5, y5);
				vector255 -= base.Center;
				float num1434 = 4f;
				float num1435 = 2f;
				if (Main.netMode != 1 && vector255.Length() < 4f)
				{
					int num1436 = 70;
					if (Main.expertMode)
					{
						num1436 = (int)((double)num1436 * 0.75);
					}
					this.ai[3] += 1f;
					if (this.ai[3] == (float)num1436)
					{
						int num1437 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), num1432 * 16 + 8, num1433 * 16, 478, whoAmI);
						Main.npc[num1437].netUpdate = true;
					}
					else if (this.ai[3] == (float)(num1436 * 2))
					{
						this.ai[0] = 0f;
						this.ai[1] = 0f;
						this.ai[2] = 0f;
						this.ai[3] = 0f;
						netUpdate = true;
						if (CountNPCS(478) + CountNPCS(479) < num1410 && Main.rand.Next(3) != 0)
						{
							this.ai[0] = 4f;
						}
						else if (Collision.SolidCollision(position, width, height))
						{
							this.ai[0] = 1f;
						}
					}
				}
				if (vector255.Length() > num1434)
				{
					vector255.Normalize();
					vector255 *= num1434;
				}
				velocity = (velocity * (num1435 - 1f) + vector255) / num1435;
				if (velocity.Length() > num1434)
				{
					velocity.Normalize();
					velocity *= num1434;
				}
			}
		}
		else if (aiStyle == 89)
		{
			if (velocity.Y == 0f)
			{
				velocity.X *= 0.9f;
				rotation += velocity.X * 0.02f;
			}
			else
			{
				velocity.X *= 0.99f;
				rotation += velocity.X * 0.04f;
			}
			int num1438 = 900;
			if (Main.expertMode)
			{
				num1438 = 600;
			}
			if (justHit)
			{
				this.ai[0] -= Main.rand.Next(10, 21);
				if (!Main.expertMode)
				{
					this.ai[0] -= Main.rand.Next(10, 21);
				}
			}
			this.ai[0] += 1f;
			if (this.ai[0] >= (float)num1438)
			{
				Transform(479);
			}
			if (Main.netMode != 1 && velocity.Y == 0f && (double)Math.Abs(velocity.X) < 0.2 && (double)this.ai[0] >= (double)num1438 * 0.75)
			{
				float num1439 = this.ai[0] - (float)num1438 * 0.75f;
				num1439 /= (float)num1438 * 0.25f;
				if ((float)Main.rand.Next(-10, 120) < num1439 * 100f)
				{
					velocity.Y -= (float)Main.rand.Next(20, 40) * 0.025f;
					velocity.X += (float)Main.rand.Next(-20, 20) * 0.025f;
					velocity *= 1f + num1439 * 2f;
					netUpdate = true;
				}
			}
		}
		else if (aiStyle == 90)
		{
			noTileCollide = false;
			knockBackResist = GetKnockbackMultiplier_ScaledByDifficulty(0.4f);
			noGravity = true;
			rotation = (rotation * 9f + velocity.X * 0.1f) / 10f;
			if (!Main.eclipse)
			{
				EncourageDespawn(5);
				velocity.Y -= 0.2f;
				if (velocity.Y < -8f)
				{
					velocity.Y = -8f;
				}
				noTileCollide = true;
				return;
			}
			if (this.ai[0] == 0f || this.ai[0] == 1f)
			{
				for (int num1440 = 0; num1440 < Main.maxNPCs; num1440++)
				{
					if (num1440 != whoAmI && Main.npc[num1440].active && Main.npc[num1440].type == type)
					{
						Vector2 vector256 = Main.npc[num1440].Center - base.Center;
						if (vector256.Length() < (float)(width + height))
						{
							vector256.Normalize();
							vector256 *= -0.1f;
							velocity += vector256;
							NPC nPC3 = Main.npc[num1440];
							nPC3.velocity -= vector256;
						}
					}
				}
			}
			if (target < 0 || Main.player[target].dead || !Main.player[target].active)
			{
				TargetClosest();
				Vector2 vector257 = Main.player[target].Center - base.Center;
				if (Main.player[target].dead || vector257.Length() > 3000f)
				{
					this.ai[0] = -1f;
				}
			}
			else
			{
				Vector2 vector258 = Main.player[target].Center - base.Center;
				if (this.ai[0] > 1f && vector258.Length() > 1000f)
				{
					this.ai[0] = 1f;
				}
			}
			if (this.ai[0] == -1f)
			{
				Vector2 vector259 = new Vector2(0f, -8f);
				velocity = (velocity * 9f + vector259) / 10f;
				noTileCollide = true;
				dontTakeDamage = true;
			}
			else if (this.ai[0] == 0f)
			{
				TargetClosest();
				spriteDirection = direction;
				if (collideX)
				{
					velocity.X *= (0f - oldVelocity.X) * 0.5f;
					if (velocity.X > 4f)
					{
						velocity.X = 4f;
					}
					if (velocity.X < -4f)
					{
						velocity.X = -4f;
					}
				}
				if (collideY)
				{
					velocity.Y *= (0f - oldVelocity.Y) * 0.5f;
					if (velocity.Y > 4f)
					{
						velocity.Y = 4f;
					}
					if (velocity.Y < -4f)
					{
						velocity.Y = -4f;
					}
				}
				Vector2 vector260 = Main.player[target].Center - base.Center;
				if (vector260.Length() > 800f)
				{
					this.ai[0] = 1f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
				}
				else if (vector260.Length() > 200f)
				{
					float num1441 = 5.5f + vector260.Length() / 100f + this.ai[1] / 15f;
					float num1442 = 40f;
					vector260.Normalize();
					vector260 *= num1441;
					velocity = (velocity * (num1442 - 1f) + vector260) / num1442;
				}
				else if (velocity.Length() > 2f)
				{
					velocity *= 0.95f;
				}
				else if (velocity.Length() < 1f)
				{
					velocity *= 1.05f;
				}
				this.ai[1] += 1f;
				if (this.ai[1] >= 90f)
				{
					this.ai[1] = 0f;
					this.ai[0] = 2f;
				}
			}
			else if (this.ai[0] == 1f)
			{
				collideX = false;
				collideY = false;
				noTileCollide = true;
				knockBackResist = 0f;
				if (target < 0 || !Main.player[target].active || Main.player[target].dead)
				{
					TargetClosest();
				}
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else if (velocity.X > 0f)
				{
					direction = 1;
				}
				spriteDirection = direction;
				rotation = (rotation * 9f + velocity.X * 0.08f) / 10f;
				Vector2 vector261 = Main.player[target].Center - base.Center;
				if (vector261.Length() < 300f && !Collision.SolidCollision(position, width, height))
				{
					this.ai[0] = 0f;
					this.ai[1] = 0f;
					this.ai[2] = 0f;
					this.ai[3] = 0f;
				}
				this.ai[2] += 1f / 60f;
				float num1443 = 5.5f + this.ai[2] + vector261.Length() / 150f;
				float num1444 = 35f;
				vector261.Normalize();
				vector261 *= num1443;
				velocity = (velocity * (num1444 - 1f) + vector261) / num1444;
			}
			else if (this.ai[0] == 2f)
			{
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else if (velocity.X > 0f)
				{
					direction = 1;
				}
				spriteDirection = direction;
				rotation = (rotation * 7f + velocity.X * 0.1f) / 8f;
				knockBackResist = 0f;
				noTileCollide = true;
				Vector2 vector262 = Main.player[target].Center - base.Center;
				vector262.Y -= 8f;
				float num1445 = 9f;
				float num1446 = 8f;
				vector262.Normalize();
				vector262 *= num1445;
				velocity = (velocity * (num1446 - 1f) + vector262) / num1446;
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
				spriteDirection = direction;
				this.ai[1] += 1f;
				if (this.ai[1] > 10f)
				{
					velocity = vector262;
					if (velocity.X < 0f)
					{
						direction = -1;
					}
					else
					{
						direction = 1;
					}
					this.ai[0] = 2.1f;
					this.ai[1] = 0f;
				}
			}
			else
			{
				if (this.ai[0] != 2.1f)
				{
					return;
				}
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else if (velocity.X > 0f)
				{
					direction = 1;
				}
				spriteDirection = direction;
				velocity *= 1.01f;
				knockBackResist = 0f;
				noTileCollide = true;
				this.ai[1] += 1f;
				int num1447 = 45;
				if (this.ai[1] > (float)num1447)
				{
					if (!Collision.SolidCollision(position, width, height))
					{
						this.ai[0] = 0f;
						this.ai[1] = 0f;
						this.ai[2] = 0f;
					}
					else if (this.ai[1] > (float)(num1447 * 2))
					{
						this.ai[0] = 1f;
						this.ai[1] = 0f;
						this.ai[2] = 0f;
					}
				}
			}
		}
		else if (aiStyle == 91)
		{
			noGravity = true;
			noTileCollide = false;
			dontTakeDamage = false;
			if (justHit && Main.netMode != 1 && Main.expertMode && Main.rand.Next(6) == 0)
			{
				netUpdate = true;
				this.ai[0] = -1f;
				this.ai[1] = 0f;
			}
			if (this.ai[0] == -1f)
			{
				dontTakeDamage = true;
				noGravity = false;
				velocity.X *= 0.98f;
				this.ai[1] += 1f;
				if (this.ai[1] >= 120f)
				{
					this.ai[0] = (this.ai[1] = (this.ai[2] = (this.ai[3] = 0f)));
				}
			}
			else if (this.ai[0] == 0f)
			{
				TargetClosest();
				if (Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
				{
					this.ai[0] = 1f;
					return;
				}
				Vector2 vector263 = Main.player[target].Center - base.Center;
				vector263.Y -= Main.player[target].height / 4;
				float num1448 = vector263.Length();
				Vector2 center47 = base.Center;
				center47.X = Main.player[target].Center.X;
				Vector2 vector264 = center47 - base.Center;
				if (vector264.Length() > 8f && Collision.CanHit(base.Center, 1, 1, center47, 1, 1))
				{
					this.ai[0] = 3f;
					this.ai[1] = center47.X;
					this.ai[2] = center47.Y;
					Vector2 center48 = base.Center;
					center48.Y = Main.player[target].Center.Y;
					if (vector264.Length() > 8f && Collision.CanHit(base.Center, 1, 1, center48, 1, 1) && Collision.CanHit(center48, 1, 1, Main.player[target].position, 1, 1))
					{
						this.ai[0] = 3f;
						this.ai[1] = center48.X;
						this.ai[2] = center48.Y;
					}
				}
				else
				{
					center47 = base.Center;
					center47.Y = Main.player[target].Center.Y;
					if ((center47 - base.Center).Length() > 8f && Collision.CanHit(base.Center, 1, 1, center47, 1, 1))
					{
						this.ai[0] = 3f;
						this.ai[1] = center47.X;
						this.ai[2] = center47.Y;
					}
				}
				if (this.ai[0] == 0f)
				{
					localAI[0] = 0f;
					vector263.Normalize();
					vector263 *= 0.5f;
					velocity += vector263;
					this.ai[0] = 4f;
					this.ai[1] = 0f;
				}
			}
			else if (this.ai[0] == 1f)
			{
				Vector2 vector265 = Main.player[target].Center - base.Center;
				float num1449 = vector265.Length();
				float num1450 = 2f;
				num1450 += num1449 / 200f;
				int num1451 = 50;
				vector265.Normalize();
				vector265 *= num1450;
				velocity = (velocity * (num1451 - 1) + vector265) / num1451;
				if (!Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
				{
					this.ai[0] = 0f;
					this.ai[1] = 0f;
				}
			}
			else if (this.ai[0] == 2f)
			{
				noTileCollide = true;
				Vector2 vector266 = Main.player[target].Center - base.Center;
				float num1452 = vector266.Length();
				float num1453 = 2f;
				int num1454 = 4;
				vector266.Normalize();
				vector266 *= num1453;
				velocity = (velocity * (num1454 - 1) + vector266) / num1454;
				if (num1452 < 600f && !Collision.SolidCollision(position, width, height))
				{
					this.ai[0] = 0f;
				}
			}
			else if (this.ai[0] == 3f)
			{
				Vector2 vector267 = new Vector2(this.ai[1], this.ai[2]);
				Vector2 vector268 = vector267 - base.Center;
				float num1455 = vector268.Length();
				float num1456 = 1f;
				float num1457 = 3f;
				vector268.Normalize();
				vector268 *= num1456;
				velocity = (velocity * (num1457 - 1f) + vector268) / num1457;
				if (collideX || collideY)
				{
					this.ai[0] = 4f;
					this.ai[1] = 0f;
				}
				if (num1455 < num1456 || num1455 > 800f || Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
				{
					this.ai[0] = 0f;
				}
			}
			else
			{
				if (this.ai[0] != 4f)
				{
					return;
				}
				if (collideX)
				{
					velocity.X *= -0.8f;
				}
				if (collideY)
				{
					velocity.Y *= -0.8f;
				}
				Vector2 vector269;
				if (velocity.X == 0f && velocity.Y == 0f)
				{
					vector269 = Main.player[target].Center - base.Center;
					vector269.Y -= Main.player[target].height / 4;
					vector269.Normalize();
					velocity = vector269 * 0.1f;
				}
				float num1458 = 1.5f;
				float num1459 = 20f;
				vector269 = velocity;
				vector269.Normalize();
				vector269 *= num1458;
				velocity = (velocity * (num1459 - 1f) + vector269) / num1459;
				this.ai[1] += 1f;
				if (this.ai[1] > 180f)
				{
					this.ai[0] = 0f;
					this.ai[1] = 0f;
				}
				if (Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
				{
					this.ai[0] = 0f;
				}
				localAI[0] += 1f;
				if (!(localAI[0] >= 5f) || Collision.SolidCollision(position - new Vector2(10f, 10f), width + 20, height + 20))
				{
					return;
				}
				localAI[0] = 0f;
				Vector2 center49 = base.Center;
				center49.X = Main.player[target].Center.X;
				if (Collision.CanHit(base.Center, 1, 1, center49, 1, 1) && Collision.CanHit(base.Center, 1, 1, center49, 1, 1) && Collision.CanHit(Main.player[target].Center, 1, 1, center49, 1, 1))
				{
					this.ai[0] = 3f;
					this.ai[1] = center49.X;
					this.ai[2] = center49.Y;
					return;
				}
				center49 = base.Center;
				center49.Y = Main.player[target].Center.Y;
				if (Collision.CanHit(base.Center, 1, 1, center49, 1, 1) && Collision.CanHit(Main.player[target].Center, 1, 1, center49, 1, 1))
				{
					this.ai[0] = 3f;
					this.ai[1] = center49.X;
					this.ai[2] = center49.Y;
				}
			}
		}
		else if (aiStyle == 92)
		{
			if (Main.rand.Next(20) == 0)
			{
				switch (Main.rand.Next(15, 18))
				{
				case 15:
					HitSound = SoundID.NPCHit15;
					break;
				case 16:
					HitSound = SoundID.NPCHit16;
					break;
				case 17:
					HitSound = SoundID.NPCHit17;
					break;
				}
			}
			if (Main.netMode == 1)
			{
				return;
			}
			bool flag97 = false;
			int num1460 = (int)this.ai[0];
			int num1461 = (int)this.ai[1];
			if (!flag97 && (!Main.tile[num1460, num1461].active() || Main.tile[num1460, num1461].type != 378))
			{
				flag97 = true;
			}
			if (!flag97 && (target == 255 || Main.player[target].dead || Vector2.Distance(base.Center, Main.player[target].Center) > 4800f))
			{
				TargetClosest(faceTarget: false);
				if (target == 255 || Main.player[target].dead || Vector2.Distance(base.Center, Main.player[target].Center) > 4800f)
				{
					flag97 = true;
				}
			}
			if (flag97)
			{
				life = 0;
				HitEffect();
				active = false;
				if (TileEntity.TryGetAt<TETrainingDummy>((int)this.ai[0], (int)this.ai[1], out var result))
				{
					result.Deactivate();
				}
			}
		}
		else if (aiStyle == 93)
		{
			if (Main.netMode != 1 && localAI[0] == 0f)
			{
				localAI[0] = 1f;
				for (int num1462 = 0; num1462 < 4; num1462++)
				{
					int num1463 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X + num1462 * 40 - 150, (int)base.Center.Y, 492, whoAmI, whoAmI, num1462, 0f, 60 * num1462);
					Main.npc[num1463].TargetClosest(faceTarget: false);
					Main.npc[num1463].timeLeft = 600;
					Main.npc[num1463].netUpdate = true;
					this.ai[num1462] = num1463;
				}
				netUpdate = true;
			}
			bool flag98 = true;
			for (int num1464 = 0; num1464 < 4; num1464++)
			{
				if (this.ai[num1464] >= 0f && (!Main.npc[(int)this.ai[num1464]].active || Main.npc[(int)this.ai[num1464]].type != 492))
				{
					this.ai[num1464] = -1f;
					netUpdate = true;
				}
				else if (this.ai[num1464] >= 0f)
				{
					flag98 = false;
				}
			}
			if (flag98)
			{
				StrikeNPCNoInteraction(9999, 0f, 0);
				return;
			}
			if (Main.netMode != 1 && Main.rand.Next(300) == 0)
			{
				Vector2 vector270 = new Vector2((Main.rand.NextFloat() - 0.5f) * (float)(width - 70), (Main.rand.NextFloat() - 0.5f) * 20f - (float)(height / 2) - 20f).RotatedBy(rotation);
				vector270 += base.Center;
				int num1465 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)vector270.X, (int)vector270.Y, Utils.SelectRandom<int>(Main.rand, 213, 215, 214, 212));
				Main.npc[num1465].velocity = new Vector2((Main.rand.NextFloat() - 0.5f) * 5f, -8.01f) + velocity;
				Main.npc[num1465].netUpdate = true;
				Main.npc[num1465].timeLeft = 600;
			}
			if ((localAI[3] += 1f) >= 64f)
			{
				localAI[3] = 0f;
			}
			TargetClosest();
			int num1466 = (int)base.Center.X / 16 + Math.Sign(velocity.X) * 10;
			int num1467 = (int)(position.Y + (float)height) / 16;
			int num1468 = 0;
			if (Main.tile[num1466, num1467] != null && Main.tile[num1466, num1467].nactive() && Main.tileSolid[Main.tile[num1466, num1467].type] && !Main.tileSolidTop[Main.tile[num1466, num1467].type])
			{
				num1468 = 1;
			}
			else
			{
				for (; num1468 < 150 && num1467 + num1468 < Main.maxTilesY; num1468++)
				{
					int num1469 = num1467 + num1468;
					if (Main.tile[num1466, num1469] != null && Main.tile[num1466, num1469].nactive() && Main.tileSolid[Main.tile[num1466, num1469].type] && !Main.tileSolidTop[Main.tile[num1466, num1469].type])
					{
						num1468--;
						break;
					}
				}
			}
			float num1470 = num1468 * 16;
			if (num1470 < 350f)
			{
				float num1471 = num1470 - 350f;
				if (num1471 < -4f)
				{
					num1471 = -4f;
				}
				velocity.Y = MathHelper.Lerp(velocity.Y, num1471, 0.05f);
			}
			else if (num1470 > 450f)
			{
				float num1472 = num1470 - 350f;
				if (num1472 > 4f)
				{
					num1472 = 4f;
				}
				velocity.Y = MathHelper.Lerp(velocity.Y, num1472, 0.05f);
			}
			else
			{
				velocity.Y *= 0.95f;
			}
			float num1473 = Main.player[target].Center.X - base.Center.X;
			if (Math.Abs(num1473) >= 300f && (Math.Abs(velocity.X) < 6f || Math.Sign(velocity.X) != direction))
			{
				velocity.X += (float)direction * 0.06f;
			}
			rotation = velocity.X * 0.025f;
			spriteDirection = -Math.Sign(velocity.X);
			for (int num1474 = 0; num1474 < 2; num1474++)
			{
				if (Main.rand.Next(2) != 0)
				{
					Vector2 vector271 = new Vector2((Main.rand.NextFloat() - 0.5f) * (float)(width - 70), (Main.rand.NextFloat() - 0.5f) * 20f + (float)(height / 2) + 10f).RotatedBy(rotation);
					Dust dust10 = Main.dust[Dust.NewDust(base.Center, 0, 0, 228)];
					dust10.position = base.Center + vector271;
					dust10.velocity = Vector2.Zero;
					dust10.noGravity = true;
					dust10.noLight = true;
					dust10.fadeIn = 1.5f;
					dust10.scale = 0.5f;
				}
			}
		}
		else if (aiStyle == 94)
		{
			if (this.ai[2] == 1f)
			{
				velocity = Vector2.UnitY * velocity.Length();
				if (velocity.Y < 0.25f)
				{
					velocity.Y += 0.02f;
				}
				if (velocity.Y > 0.25f)
				{
					velocity.Y -= 0.02f;
				}
				dontTakeDamage = true;
				this.ai[1]++;
				if (this.ai[1] > 120f)
				{
					Opacity = 1f - (this.ai[1] - 120f) / 60f;
				}
				int num1475 = 6;
				switch (type)
				{
				case 517:
					num1475 = 127;
					break;
				case 422:
					num1475 = 229;
					break;
				case 507:
					num1475 = 242;
					break;
				case 493:
					num1475 = 135;
					break;
				}
				if (Main.rand.Next(5) == 0 && this.ai[1] < 120f)
				{
					for (int num1476 = 0; num1476 < 3; num1476++)
					{
						Dust dust11 = Main.dust[Dust.NewDust(base.Left, width, height / 2, num1475)];
						dust11.position = base.Center + Vector2.UnitY.RotatedByRandom(4.188790321350098) * new Vector2((float)width * 1.5f, (float)height * 1.1f) * 0.8f * (0.8f + Main.rand.NextFloat() * 0.2f);
						dust11.velocity.X = 0f;
						dust11.velocity.Y = (0f - Math.Abs(dust11.velocity.Y - (float)num1476 + velocity.Y - 4f)) * 3f;
						dust11.noGravity = true;
						dust11.fadeIn = 1f;
						dust11.scale = 1f + Main.rand.NextFloat() + (float)num1476 * 0.3f;
					}
				}
				if (this.ai[1] < 150f)
				{
					for (int num1477 = 0; num1477 < 3; num1477++)
					{
						if (Main.rand.Next(4) == 0)
						{
							Dust dust12 = Main.dust[Dust.NewDust(base.Top + new Vector2((float)(-width) * (0.33f - 0.11f * (float)num1477), -20f), (int)((float)width * (0.66f - 0.22f * (float)num1477)), 20, num1475)];
							dust12.velocity.X = 0f;
							dust12.velocity.Y = (0f - Math.Abs(dust12.velocity.Y - (float)num1477 + velocity.Y - 4f)) * (1f + this.ai[1] / 180f * 0.5f);
							dust12.noGravity = true;
							dust12.fadeIn = 1f;
							dust12.scale = 1f + Main.rand.NextFloat() + (float)num1477 * 0.3f;
						}
					}
				}
				if (Main.rand.Next(5) == 0 && this.ai[1] < 150f)
				{
					for (int num1478 = 0; num1478 < 3; num1478++)
					{
						Vector2 vector272 = base.Center + Vector2.UnitY.RotatedByRandom(4.188790321350098) * new Vector2(width, height) * 0.7f * Main.rand.NextFloat();
						float num1479 = 1f + Main.rand.NextFloat() * 2f + this.ai[1] / 180f * 4f;
						for (int num1480 = 0; num1480 < 6; num1480++)
						{
							Dust dust13 = Main.dust[Dust.NewDust(vector272, 4, 4, num1475)];
							dust13.position = vector272;
							dust13.velocity.X *= num1479;
							dust13.velocity.Y = (0f - Math.Abs(dust13.velocity.Y)) * num1479;
							dust13.noGravity = true;
							dust13.fadeIn = 1f;
							dust13.scale = 1.5f + Main.rand.NextFloat() + (float)num1480 * 0.13f;
						}
						SoundEngine.PlaySound(3, vector272, Utils.SelectRandom<int>(Main.rand, 1, 18));
					}
				}
				if (Main.rand.Next(3) != 0 && this.ai[1] < 150f)
				{
					Dust dust14 = Main.dust[Dust.NewDust(base.Left, width, height / 2, 241)];
					dust14.position = base.Center + Vector2.UnitY.RotatedByRandom(4.188790321350098) * new Vector2(width / 2, height / 2) * (0.8f + Main.rand.NextFloat() * 0.2f);
					dust14.velocity.X = 0f;
					dust14.velocity.Y = Math.Abs(dust14.velocity.Y) * 0.25f;
				}
				if (this.ai[1] % 60f == 1f)
				{
					SoundEngine.PlaySound(4, base.Center, 22);
				}
				if (this.ai[1] >= 180f)
				{
					life = 0;
					HitEffect(0, 1337.0);
					checkDead();
				}
				return;
			}
			if (this.ai[3] > 0f)
			{
				bool flag99 = dontTakeDamage;
				switch (type)
				{
				case 517:
					flag99 = ShieldStrengthTowerSolar != 0;
					break;
				case 422:
					flag99 = ShieldStrengthTowerVortex != 0;
					break;
				case 507:
					flag99 = ShieldStrengthTowerNebula != 0;
					break;
				case 493:
					flag99 = ShieldStrengthTowerStardust != 0;
					break;
				}
				if (flag99 != dontTakeDamage)
				{
					SoundEngine.PlaySound(SoundID.NPCDeath58, position);
				}
				else if (this.ai[3] == 1f)
				{
					SoundEngine.PlaySound(SoundID.NPCDeath3, position);
				}
				this.ai[3]++;
				if (this.ai[3] > 120f)
				{
					this.ai[3] = 0f;
				}
			}
			switch (type)
			{
			case 517:
				dontTakeDamage = ShieldStrengthTowerSolar != 0;
				break;
			case 422:
				dontTakeDamage = ShieldStrengthTowerVortex != 0;
				break;
			case 507:
				dontTakeDamage = ShieldStrengthTowerNebula != 0;
				break;
			case 493:
				dontTakeDamage = ShieldStrengthTowerStardust != 0;
				break;
			}
			TargetClosest(faceTarget: false);
			if (Main.player[target].Distance(base.Center) > 2000f)
			{
				localAI[0]++;
			}
			if (localAI[0] >= 60f && Main.netMode != 1)
			{
				localAI[0] = 0f;
				netUpdate = true;
				life = (int)MathHelper.Clamp(life + 200, 0f, lifeMax);
			}
			else
			{
				localAI[0] = 0f;
			}
			velocity = new Vector2(0f, (float)Math.Sin((float)Math.PI * 2f * this.ai[0] / 300f) * 0.5f);
			Point origin = base.Bottom.ToTileCoordinates();
			int maxDistance = 10;
			int num1481 = 20;
			int num1482 = 30;
			if (WorldGen.InWorld(origin.X, origin.Y, 20) && Main.tile[origin.X, origin.Y] != null)
			{
				if (WorldUtils.Find(origin, Searches.Chain(new Searches.Down(maxDistance), new Terraria.WorldBuilding.Conditions.IsSolid()), out var result2))
				{
					float num1483 = 1f - (float)Math.Abs(origin.Y - result2.Y) / 10f;
					position.Y -= 1.5f * num1483;
				}
				else if (!WorldUtils.Find(origin, Searches.Chain(new Searches.Down(num1481), new Terraria.WorldBuilding.Conditions.IsSolid()), out result2))
				{
					float num1484 = 1f;
					if (WorldUtils.Find(origin, Searches.Chain(new Searches.Down(num1482), new Terraria.WorldBuilding.Conditions.IsSolid()), out result2))
					{
						num1484 = Utils.GetLerpValue(num1481, num1482, Math.Abs(origin.Y - result2.Y), clamped: true);
					}
					position.Y += 1.5f * num1484;
				}
			}
			if (!Main.isThereAWorldSurface)
			{
				if (position.Y < 640f)
				{
					position.Y = (float)Main.rockLayer * 16f;
					netUpdate = true;
				}
			}
			else if (!Main.remixWorld && !Main.getGoodWorld && (double)base.Bottom.Y > Main.worldSurface * 16.0 - 100.0)
			{
				position.Y = (float)Main.worldSurface * 16f - (float)height - 100f;
			}
			this.ai[0]++;
			if (this.ai[0] >= 300f)
			{
				this.ai[0] = 0f;
				netUpdate = true;
			}
			if (type == 493)
			{
				if (Main.rand.Next(5) == 0)
				{
					Dust dust15 = Main.dust[Dust.NewDust(base.Left, width, height / 2, 241)];
					dust15.position = base.Center + Vector2.UnitY.RotatedByRandom(2.094395160675049) * new Vector2(width / 2, height / 2) * (0.8f + Main.rand.NextFloat() * 0.2f);
					dust15.velocity.X = 0f;
					dust15.velocity.Y = Math.Abs(dust15.velocity.Y) * 0.25f;
				}
				for (int num1485 = 0; num1485 < 3; num1485++)
				{
					if (Main.rand.Next(5) == 0)
					{
						Dust dust16 = Main.dust[Dust.NewDust(base.Top + new Vector2((float)(-width) * (0.33f - 0.11f * (float)num1485), -20f), (int)((float)width * (0.66f - 0.22f * (float)num1485)), 20, 135)];
						dust16.velocity.X = 0f;
						dust16.velocity.Y = (0f - Math.Abs(dust16.velocity.Y - (float)num1485 + velocity.Y - 4f)) * 1f;
						dust16.noGravity = true;
						dust16.fadeIn = 1f;
						dust16.scale = 1f + Main.rand.NextFloat() + (float)num1485 * 0.3f;
					}
				}
				if (this.ai[1] > 0f)
				{
					this.ai[1]--;
				}
				if (Main.netMode != 1 && this.ai[1] <= 0f && Main.player[target].active && !Main.player[target].dead && Distance(Main.player[target].Center) < 1080f && Main.player[target].position.Y - position.Y < 400f)
				{
					SpawnStardustMark_StardustTower();
				}
			}
			if (type == 507)
			{
				if (Main.rand.Next(5) == 0)
				{
					Dust dust17 = Main.dust[Dust.NewDust(base.Left, width, height / 2, 241)];
					dust17.position = base.Center + Vector2.UnitY.RotatedByRandom(2.094395160675049) * new Vector2(width / 2, height / 2) * (0.8f + Main.rand.NextFloat() * 0.2f);
					dust17.velocity.X = 0f;
					dust17.velocity.Y = Math.Abs(dust17.velocity.Y) * 0.25f;
				}
				for (int num1486 = 0; num1486 < 3; num1486++)
				{
					if (Main.rand.Next(5) == 0)
					{
						Dust dust18 = Main.dust[Dust.NewDust(base.Top + new Vector2((float)(-width) * (0.33f - 0.11f * (float)num1486), -20f), (int)((float)width * (0.66f - 0.22f * (float)num1486)), 20, 242)];
						dust18.velocity.X = 0f;
						dust18.velocity.Y = (0f - Math.Abs(dust18.velocity.Y - (float)num1486 + velocity.Y - 4f)) * 1f;
						dust18.noGravity = true;
						dust18.fadeIn = 1f;
						dust18.color = Color.Black;
						dust18.scale = 1f + Main.rand.NextFloat() + (float)num1486 * 0.3f;
					}
				}
			}
			if (type == 422)
			{
				if (Main.rand.Next(5) == 0)
				{
					Dust dust19 = Main.dust[Dust.NewDust(base.Left, width, height / 2, 241)];
					dust19.position = base.Center + Vector2.UnitY.RotatedByRandom(2.094395160675049) * new Vector2(width / 2, height / 2) * (0.8f + Main.rand.NextFloat() * 0.2f);
					dust19.velocity.X = 0f;
					dust19.velocity.Y = Math.Abs(dust19.velocity.Y) * 0.25f;
				}
				for (int num1487 = 0; num1487 < 3; num1487++)
				{
					if (Main.rand.Next(5) == 0)
					{
						Dust dust20 = Main.dust[Dust.NewDust(base.Top + new Vector2((float)(-width) * (0.33f - 0.11f * (float)num1487), -20f), (int)((float)width * (0.66f - 0.22f * (float)num1487)), 20, 229)];
						dust20.velocity.X = 0f;
						dust20.velocity.Y = (0f - Math.Abs(dust20.velocity.Y - (float)num1487 + velocity.Y - 4f)) * 1f;
						dust20.noGravity = true;
						dust20.fadeIn = 1f;
						dust20.color = Color.Black;
						dust20.scale = 1f + Main.rand.NextFloat() + (float)num1487 * 0.3f;
					}
				}
				if (this.ai[1] > 0f)
				{
					this.ai[1]--;
				}
				if (Main.netMode != 1 && this.ai[1] <= 0f && Main.player[target].active && !Main.player[target].dead && Distance(Main.player[target].Center) < 3240f && !Collision.CanHitLine(base.Center, 0, 0, Main.player[target].Center, 0, 0))
				{
					this.ai[1] = 60 + Main.rand.Next(120);
					Point point9 = Main.player[target].Top.ToTileCoordinates();
					bool flag100 = CountNPCS(428) + CountNPCS(427) + CountNPCS(426) < 14;
					for (int num1488 = 0; num1488 < 10; num1488++)
					{
						if (WorldGen.SolidTile(point9.X, point9.Y))
						{
							break;
						}
						if (point9.Y <= 10)
						{
							break;
						}
						point9.Y--;
					}
					if (flag100)
					{
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), point9.X * 16 + 8, point9.Y * 16 + 24, 0f, 0f, 579, 0, 0f, Main.myPlayer);
					}
					else
					{
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), point9.X * 16 + 8, point9.Y * 16 + 17, 0f, 0f, 578, 0, 1f, Main.myPlayer);
					}
				}
				if (Main.netMode != 1 && this.ai[1] <= 0f && Main.player[target].active && !Main.player[target].dead && Distance(Main.player[target].Center) < 1080f && Main.player[target].position.Y - position.Y < 400f && CountNPCS(427) + CountNPCS(426) * 3 + CountNPCS(428) < 20)
				{
					this.ai[1] = 420 + Main.rand.Next(360);
					Point point10 = base.Center.ToTileCoordinates();
					Point point11 = Main.player[target].Center.ToTileCoordinates();
					Vector2 vector273 = Main.player[target].Center - base.Center;
					int num1489 = 20;
					int num1490 = 3;
					int num1491 = 8;
					int num1492 = 2;
					int num1493 = 0;
					bool flag101 = false;
					if (vector273.Length() > 2000f)
					{
						flag101 = true;
					}
					while (!flag101 && num1493 < 100)
					{
						num1493++;
						int num1494 = Main.rand.Next(point11.X - num1489, point11.X + num1489 + 1);
						int num1495 = Main.rand.Next(point11.Y - num1489, point11.Y + num1489 + 1);
						if ((num1495 < point11.Y - num1491 || num1495 > point11.Y + num1491 || num1494 < point11.X - num1491 || num1494 > point11.X + num1491) && (num1495 < point10.Y - num1490 || num1495 > point10.Y + num1490 || num1494 < point10.X - num1490 || num1494 > point10.X + num1490) && !Main.tile[num1494, num1495].nactive())
						{
							bool flag102 = true;
							if (flag102 && Main.tile[num1494, num1495].lava())
							{
								flag102 = false;
							}
							if (flag102 && Collision.SolidTiles(num1494 - num1492, num1494 + num1492, num1495 - num1492, num1495 + num1492))
							{
								flag102 = false;
							}
							if (flag102 && !Collision.CanHitLine(base.Center, 0, 0, Main.player[target].Center, 0, 0))
							{
								flag102 = false;
							}
							if (flag102)
							{
								Projectile.NewProjectile(GetSpawnSource_ForProjectile(), num1494 * 16 + 8, num1495 * 16 + 8, 0f, 0f, 579, 0, 0f, Main.myPlayer);
								flag101 = true;
								break;
							}
						}
					}
				}
			}
			if (type != 517)
			{
				return;
			}
			if (Main.rand.Next(5) == 0)
			{
				Dust dust21 = Main.dust[Dust.NewDust(base.Left, width, height / 2, 241)];
				dust21.position = base.Center + Vector2.UnitY.RotatedByRandom(2.094395160675049) * new Vector2(width / 2, height / 2) * (0.8f + Main.rand.NextFloat() * 0.2f);
				dust21.velocity.X = 0f;
				dust21.velocity.Y = Math.Abs(dust21.velocity.Y) * 0.25f;
			}
			for (int num1496 = 0; num1496 < 3; num1496++)
			{
				if (Main.rand.Next(5) == 0)
				{
					Dust dust22 = Main.dust[Dust.NewDust(base.Top + new Vector2((float)(-width) * (0.33f - 0.11f * (float)num1496), -20f), (int)((float)width * (0.66f - 0.22f * (float)num1496)), 20, 6)];
					dust22.velocity.X = 0f;
					dust22.velocity.Y = (0f - Math.Abs(dust22.velocity.Y - (float)num1496 + velocity.Y - 4f)) * 1f;
					dust22.noGravity = true;
					dust22.fadeIn = 1f;
					dust22.scale = 1f + Main.rand.NextFloat() + (float)num1496 * 0.3f;
				}
			}
			if (this.ai[1] > 0f)
			{
				this.ai[1]--;
			}
			if (Main.netMode != 1 && this.ai[1] <= 0f && Main.player[target].active && !Main.player[target].dead && Distance(Main.player[target].Center) < 1080f && Main.player[target].position.Y - position.Y < 700f)
			{
				Vector2 vector274 = base.Top + new Vector2((float)(-width) * 0.33f, -20f) + new Vector2((float)width * 0.66f, 20f) * Utils.RandomVector2(Main.rand, 0f, 1f);
				Vector2 vector275 = -Vector2.UnitY.RotatedByRandom(0.7853981852531433) * (7f + Main.rand.NextFloat() * 5f);
				int num1497 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)vector274.X, (int)vector274.Y, 519, whoAmI);
				Main.npc[num1497].velocity = vector275;
				Main.npc[num1497].netUpdate = true;
				this.ai[1] = 60f;
			}
		}
		else if (aiStyle == 95)
		{
			float num1498 = 300f;
			if (velocity.Length() > 4f)
			{
				velocity *= 0.95f;
			}
			velocity *= 0.99f;
			this.ai[0]++;
			float num1499 = MathHelper.Clamp(this.ai[0] / num1498, 0f, 1f);
			scale = 1f + 0.3f * num1499;
			if (this.ai[0] >= num1498)
			{
				if (Main.netMode != 1)
				{
					Transform(405);
				}
				return;
			}
			rotation += velocity.X * 0.1f;
			if (!(this.ai[0] > 20f))
			{
				return;
			}
			Vector2 center50 = base.Center;
			int num1500 = (int)(this.ai[0] / (num1498 / 2f));
			for (int num1501 = 0; num1501 < num1500 + 1; num1501++)
			{
				if (Main.rand.Next(2) != 0)
				{
					int num1502 = 226;
					float num1503 = 0.4f;
					if (num1501 % 2 == 1)
					{
						num1502 = 226;
						num1503 = 0.65f;
					}
					Vector2 vector276 = center50 + ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2() * (12f - (float)(num1500 * 2));
					int num1504 = Dust.NewDust(vector276 - Vector2.One * 12f, 24, 24, num1502, velocity.X / 2f, velocity.Y / 2f);
					Dust dust = Main.dust[num1504];
					dust.position -= new Vector2(2f);
					Main.dust[num1504].velocity = Vector2.Normalize(center50 - vector276) * 1.5f * (10f - (float)num1500 * 2f) / 10f;
					Main.dust[num1504].noGravity = true;
					Main.dust[num1504].scale = num1503;
					Main.dust[num1504].customData = this;
				}
			}
		}
		else if (aiStyle == 96)
		{
			float num1505 = 5f;
			float moveSpeed = 0.15f;
			TargetClosest();
			Vector2 desiredVelocity3 = Main.player[target].Center - base.Center + new Vector2(0f, -250f);
			float num1506 = desiredVelocity3.Length();
			if (num1506 < 20f)
			{
				desiredVelocity3 = velocity;
			}
			else if (num1506 < 40f)
			{
				desiredVelocity3.Normalize();
				desiredVelocity3 *= num1505 * 0.35f;
			}
			else if (num1506 < 80f)
			{
				desiredVelocity3.Normalize();
				desiredVelocity3 *= num1505 * 0.65f;
			}
			else
			{
				desiredVelocity3.Normalize();
				desiredVelocity3 *= num1505;
			}
			SimpleFlyMovement(desiredVelocity3, moveSpeed);
			rotation = velocity.X * 0.1f;
			if (!((this.ai[0] += 1f) >= 70f))
			{
				return;
			}
			this.ai[0] = 0f;
			if (Main.netMode != 1)
			{
				Vector2 vector277 = Vector2.Zero;
				while (Math.Abs(vector277.X) < 1.5f)
				{
					vector277 = Vector2.UnitY.RotatedByRandom(1.5707963705062866) * new Vector2(5f, 3f);
				}
				Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, vector277.X, vector277.Y, 539, 60, 0f, Main.myPlayer, 0f, whoAmI);
			}
		}
		else if (aiStyle == 97)
		{
			float num1507 = 7f;
			int num1508 = 480;
			int num1509 = 30;
			int maxValue6 = 6;
			if (localAI[2] < 180f)
			{
				localAI[2]++;
				if (Main.netMode != 1 && localAI[2] % 60f == 0f)
				{
					Vector2 vector278 = Vector2.Zero;
					while (Math.Abs(vector278.X) < 1.5f)
					{
						vector278 = Vector2.UnitY.RotatedByRandom(1.5707963705062866) * new Vector2(4f, 2.5f);
					}
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, vector278.X, vector278.Y, 574, 0, 0f, Main.myPlayer, 0f, whoAmI);
				}
			}
			if (localAI[1] == 1f)
			{
				localAI[1] = 0f;
				if (Main.rand.Next(maxValue6) == 0)
				{
					this.ai[0] = num1508;
				}
			}
			TargetClosest();
			if (Main.netMode != 1 && (!Main.player[target].active || Main.player[target].dead))
			{
				this.ai[0] = 0f;
				this.ai[1] = 1f;
				this.ai[2] = 0f;
				this.ai[3] = 0f;
				netUpdate = true;
			}
			rotation = Math.Abs(velocity.X) * (float)direction * 0.1f;
			spriteDirection = -direction;
			Vector2 vector279 = base.Center + new Vector2(direction * 20, 6f);
			Vector2 vector280 = Main.player[target].Center - vector279;
			bool flag103 = Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1);
			bool flag104 = false;
			if (this.ai[1] == 1f)
			{
				if (localAI[3] == 0f)
				{
					localAI[3] = 1f;
					this.ai[3] = 3f;
					SoundEngine.PlaySound(SoundID.Item8, base.Center);
					for (int num1510 = 0; num1510 < 20; num1510++)
					{
						int num1511 = Dust.NewDust(position, width, height, 242);
						Dust dust = Main.dust[num1511];
						dust.velocity *= 3f;
						Main.dust[num1511].noGravity = true;
						Main.dust[num1511].scale = 2.5f;
					}
				}
				this.ai[3]--;
				if (this.ai[3] <= 0f)
				{
					active = false;
					netUpdate = true;
				}
				return;
			}
			if (vector280.Length() > 400f || !flag103)
			{
				Vector2 vector281 = vector280;
				if (vector281.Length() > num1507)
				{
					vector281.Normalize();
					vector281 *= num1507;
				}
				int num1512 = 30;
				velocity = (velocity * (num1512 - 1) + vector281) / num1512;
			}
			else
			{
				velocity *= 0.98f;
				flag104 = true;
			}
			if (this.ai[2] != 0f && this.ai[3] != 0f)
			{
				SoundEngine.PlaySound(SoundID.Item8, base.Center);
				for (int num1513 = 0; num1513 < 20; num1513++)
				{
					int num1514 = Dust.NewDust(position, width, height, 242);
					Dust dust = Main.dust[num1514];
					dust.velocity *= 3f;
					Main.dust[num1514].noGravity = true;
					Main.dust[num1514].scale = 2.5f;
				}
				base.Center = new Vector2(this.ai[2] * 16f, this.ai[3] * 16f);
				velocity = Vector2.Zero;
				this.ai[2] = 0f;
				this.ai[3] = 0f;
				SoundEngine.PlaySound(SoundID.Item8, base.Center);
				for (int num1515 = 0; num1515 < 20; num1515++)
				{
					int num1516 = Dust.NewDust(position, width, height, 242);
					Dust dust = Main.dust[num1516];
					dust.velocity *= 3f;
					Main.dust[num1516].noGravity = true;
					Main.dust[num1516].scale = 2.5f;
				}
			}
			this.ai[0]++;
			if (this.ai[0] >= (float)num1508 && Main.netMode != 1)
			{
				this.ai[0] = 0f;
				Point point12 = base.Center.ToTileCoordinates();
				Point point13 = Main.player[target].Center.ToTileCoordinates();
				Vector2 chosenTile = Vector2.Zero;
				if (AI_AttemptToFindTeleportSpot(ref chosenTile, point13.X, point13.Y, 20, 12, 1, solidTileCheckCentered: true, teleportInAir: true))
				{
					this.ai[1] = 20f;
					this.ai[2] = chosenTile.X;
					this.ai[3] = chosenTile.Y;
					bool flag105 = true;
					for (int num1517 = 0; num1517 < 1000; num1517++)
					{
						Projectile projectile10 = Main.projectile[num1517];
						if (projectile10.active && projectile10.type == 574 && projectile10.ai[1] == (float)whoAmI && !(projectile10.ai[0] >= 0f))
						{
							flag105 = false;
							break;
						}
					}
					if (flag105)
					{
						for (int num1518 = 0; num1518 < 1000; num1518++)
						{
							Projectile projectile11 = Main.projectile[num1518];
							if (projectile11.active && projectile11.type == 574 && projectile11.ai[1] == (float)whoAmI)
							{
								projectile11.ai[0] -= num1509;
							}
						}
					}
				}
				netUpdate = true;
			}
			if (flag104 && velocity.Length() < 2f && Main.netMode != 1)
			{
				localAI[0] += 1f;
				_ = localAI[0];
				_ = 13f;
			}
		}
		else if (aiStyle == 98)
		{
			noTileCollide = false;
			if (this.ai[0] == 0f)
			{
				TargetClosest();
				this.ai[0] = 1f;
				this.ai[1] = 0f;
				this.ai[2] = 0f;
				this.ai[3] = 0f;
			}
			bool flag106 = Collision.CanHit(base.Center, 1, 1, Main.player[target].position, 1, 1);
			bool flag107 = true;
			if (!flag106 || Main.player[target].dead)
			{
				flag107 = false;
			}
			else
			{
				int num1519 = (int)(Main.player[target].Center.X / 16f);
				int num1520 = (int)(Main.player[target].Center.Y / 16f);
				for (int num1521 = num1519 - 2; num1521 <= num1519 + 2; num1521++)
				{
					for (int num1522 = num1520; num1522 <= num1520 + 25; num1522++)
					{
						if (WorldGen.SolidTile2(num1521, num1522))
						{
							flag107 = false;
						}
					}
				}
			}
			if (this.ai[0] < 0f)
			{
				Vector2 vector282 = Main.player[target].Center - base.Center;
				float num1523 = vector282.Length();
				if (this.ai[0] == -1f)
				{
					vector282.Normalize();
					if (vector282.HasNaNs())
					{
						vector282 = new Vector2(direction, 0f);
					}
					float num1524 = 8f + num1523 / 100f;
					float num1525 = 12f;
					if (Main.player[target].velocity.Length() > num1525)
					{
						num1525 = Main.player[target].velocity.Length();
					}
					if (num1524 > num1525)
					{
						num1524 = num1525;
					}
					vector282 *= num1524;
					float num1526 = 10f;
					velocity = (velocity * (num1526 - 1f) + vector282) / num1526;
					for (int num1527 = 0; num1527 < Main.maxNPCs; num1527++)
					{
						if (Main.npc[num1527].active && Main.npc[num1527].type == type && num1527 != whoAmI)
						{
							Vector2 vector283 = Main.npc[num1527].Center - base.Center;
							if (vector283.Length() < 40f)
							{
								vector283.Normalize();
								vector283 *= 1f;
								velocity -= vector283;
							}
						}
					}
					rotation += velocity.X * 0.03f;
					if ((double)rotation < -6.2831)
					{
						rotation += 6.2831f;
					}
					if ((double)rotation > 6.2831)
					{
						rotation -= 6.2831f;
					}
					if (velocity.X > 0f)
					{
						direction = 1;
					}
					else if (velocity.X < 0f)
					{
						direction = -1;
					}
					spriteDirection = direction;
				}
				this.ai[1] += 1f;
				if (this.ai[1] >= 60f && !flag107)
				{
					this.ai[0] = 0f;
				}
			}
			else if (this.ai[0] == 2f)
			{
				rotation *= 0.92f;
				if ((double)Math.Abs(rotation) < 0.02)
				{
					rotation = 0f;
				}
				int num1528 = 300;
				float num1529 = Math.Abs(base.Center.X - Main.player[target].Center.X);
				if (num1529 < (float)num1528 && Collision.CanHit(base.Center, 1, 1, Main.player[target].position, 1, 1))
				{
					velocity.X *= 0.96f;
					velocity.Y *= 0.96f;
					this.ai[1] += 1f;
					if (this.ai[1] == 20f)
					{
						if (Main.netMode != 1)
						{
							int num1530 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y + 26, 516, 0, 0f, 0f, 0f, 0f, target);
						}
					}
					else if (this.ai[1] >= 30f)
					{
						this.ai[1] = 0f;
					}
					for (int num1531 = 0; num1531 < Main.maxNPCs; num1531++)
					{
						if (Main.npc[num1531].active && Main.npc[num1531].type == type && num1531 != whoAmI)
						{
							Vector2 vector284 = Main.npc[num1531].Center - base.Center;
							if (vector284.Length() < 100f)
							{
								vector284.Normalize();
								vector284 *= 0.1f;
								velocity -= vector284;
							}
						}
					}
				}
				else
				{
					this.ai[0] = 0f;
				}
				if (Main.player[target].Center.X < base.Center.X)
				{
					direction = -1;
				}
				else if (Main.player[target].Center.X > base.Center.X)
				{
					direction = 1;
				}
				spriteDirection = direction;
			}
			if (this.ai[0] != 1f)
			{
				return;
			}
			rotation *= 0.92f;
			if ((double)Math.Abs(rotation) < 0.02)
			{
				rotation = 0f;
			}
			if (flag107)
			{
				this.ai[0] = -1f;
				this.ai[1] = 0f;
				this.ai[2] = 0f;
				this.ai[3] = 0f;
			}
			int num1532 = 300;
			for (int num1533 = 0; num1533 < Main.maxNPCs; num1533++)
			{
				if (Main.npc[num1533].active && Main.npc[num1533].type == type && num1533 != whoAmI)
				{
					Vector2 vector285 = Main.npc[num1533].Center - base.Center;
					if (vector285.Length() < 50f)
					{
						vector285.Normalize();
						vector285 *= 0.1f;
						velocity -= vector285;
						velocity.X -= vector285.X * 1f;
					}
				}
			}
			int num1534 = 800;
			float num1535 = Math.Abs(base.Center.X - Main.player[target].Center.X);
			if (num1535 < (float)num1532 && flag106)
			{
				this.ai[0] = 2f;
				this.ai[1] = 0f;
			}
			else
			{
				if (collideX)
				{
					velocity.X *= -0.5f;
					this.ai[1] = 60f;
					direction *= -1;
				}
				if (this.ai[1] > 0f)
				{
					this.ai[1] -= 1f;
				}
				else if (flag106)
				{
					if (base.Center.X > Main.player[target].Center.X)
					{
						direction = -1;
					}
					else
					{
						direction = 1;
					}
				}
				else if (num1535 > (float)num1534)
				{
					if (base.Center.X > Main.player[target].Center.X)
					{
						direction = -1;
					}
					else
					{
						direction = 1;
					}
				}
				float num1536 = 2f;
				float num1537 = 0.1f;
				if (velocity.X > num1536 || velocity.X < 0f - num1536)
				{
					if (Math.Abs(velocity.X) < num1536 + num1537 * 2f)
					{
						if (velocity.X < 0f)
						{
							velocity.X = 0f - num1536;
						}
						else
						{
							velocity.X = num1536;
						}
					}
					else
					{
						velocity.X *= 0.99f;
					}
				}
				else
				{
					velocity.X += (float)direction * num1537;
				}
				spriteDirection = direction;
			}
			if (collideY)
			{
				this.ai[2] = 60f;
				directionY *= -1;
				velocity.Y *= -0.5f;
			}
			if (this.ai[2] > 0f)
			{
				this.ai[2] -= 1f;
			}
			else
			{
				int num1538 = (int)(base.Center.Y / 16f);
				int num1539 = (int)((base.Center.X - 8f) / 16f);
				int num1540 = 30;
				int num1541 = 15;
				int num1542 = 0;
				for (int num1543 = num1538; num1543 < num1538 + num1540; num1543++)
				{
					for (int num1544 = num1539; num1544 <= num1539 + 1; num1544++)
					{
						if (WorldGen.SolidTile(num1544, num1543) || Main.tile[num1544, num1543].liquid > 0)
						{
							num1542 = num1543 - num1538;
							break;
						}
					}
					if (num1542 != 0)
					{
						break;
					}
				}
				if (num1542 == 0)
				{
					directionY = 1;
				}
				else if (num1542 < num1541)
				{
					directionY = -1;
				}
			}
			float num1545 = 2f;
			float num1546 = 0.1f;
			if (velocity.Y > num1545 || velocity.Y < 0f - num1545)
			{
				if (Math.Abs(velocity.Y) < num1545 + num1546 * 2f)
				{
					if (velocity.Y < 0f)
					{
						velocity.Y = 0f - num1545;
					}
					else
					{
						velocity.Y = num1545;
					}
				}
				else
				{
					velocity.Y *= 0.99f;
				}
			}
			else
			{
				velocity.Y += (float)directionY * num1546;
			}
		}
		else if (aiStyle == 99)
		{
			if (velocity.Y == 0f && this.ai[0] == 0f)
			{
				this.ai[0] = 1f;
				this.ai[1] = 0f;
				netUpdate = true;
				return;
			}
			if (this.ai[0] == 1f)
			{
				velocity = Vector2.Zero;
				position = oldPosition;
				this.ai[1]++;
				if (this.ai[1] >= 5f)
				{
					HitEffect(0, 9999.0);
					active = false;
				}
				return;
			}
			velocity.Y += 0.2f;
			if (velocity.Y > 12f)
			{
				velocity.Y = 12f;
			}
			rotation = velocity.ToRotation() - (float)Math.PI / 2f;
			if (type != 519)
			{
				return;
			}
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				for (int num1547 = 0; num1547 < 13; num1547++)
				{
					int num1548 = Dust.NewDust(position, width, height, 6, velocity.X * 0.5f, velocity.Y * 0.5f, 90, default(Color), 2.5f);
					Main.dust[num1548].noGravity = true;
					Main.dust[num1548].fadeIn = 1f;
					Dust dust = Main.dust[num1548];
					dust.velocity *= 4f;
					Main.dust[num1548].noLight = true;
				}
			}
			for (int num1549 = 0; num1549 < 3; num1549++)
			{
				if (Main.rand.Next(3) < 2)
				{
					int num1550 = Dust.NewDust(position, width, height, 6, velocity.X * 0.5f, velocity.Y * 0.5f, 90, default(Color), 2.5f);
					Main.dust[num1550].noGravity = true;
					Dust dust = Main.dust[num1550];
					dust.velocity *= 0.2f;
					Main.dust[num1550].fadeIn = 1f;
					if (Main.rand.Next(6) == 0)
					{
						dust = Main.dust[num1550];
						dust.velocity *= 30f;
						Main.dust[num1550].noGravity = false;
						Main.dust[num1550].noLight = true;
					}
					else
					{
						Main.dust[num1550].velocity = DirectionFrom(Main.dust[num1550].position) * Main.dust[num1550].velocity.Length();
					}
				}
			}
		}
		else if (aiStyle == 100)
		{
			if (velocity.Y == 0f && this.ai[0] >= 0f)
			{
				this.ai[0] = -1f;
				this.ai[1] = 0f;
				netUpdate = true;
				return;
			}
			if (this.ai[0] == -1f)
			{
				velocity = Vector2.Zero;
				position = oldPosition;
				this.ai[1]++;
				if (this.ai[1] >= 5f)
				{
					HitEffect(0, 9999.0);
					active = false;
				}
				return;
			}
			rotation = velocity.ToRotation() - (float)Math.PI / 2f;
			if (type != 522)
			{
				return;
			}
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				velocity.X = this.ai[2];
				velocity.Y = this.ai[3];
				for (int num1551 = 0; num1551 < 13; num1551++)
				{
					int num1552 = Dust.NewDust(position, width, height, 261, velocity.X * 0.5f, velocity.Y * 0.5f, 90, default(Color), 2.5f);
					Main.dust[num1552].noGravity = true;
					Main.dust[num1552].fadeIn = 1f;
					Dust dust = Main.dust[num1552];
					dust.velocity *= 4f;
					Main.dust[num1552].noLight = true;
				}
			}
			for (int num1553 = 0; num1553 < 2; num1553++)
			{
				if (Main.rand.Next(10 - (int)Math.Min(7f, velocity.Length())) < 1)
				{
					int num1554 = Dust.NewDust(position, width, height, 261, velocity.X * 0.5f, velocity.Y * 0.5f, 90, default(Color), 2.5f);
					Main.dust[num1554].noGravity = true;
					Dust dust = Main.dust[num1554];
					dust.velocity *= 0.2f;
					Main.dust[num1554].fadeIn = 0.4f;
					if (Main.rand.Next(6) == 0)
					{
						dust = Main.dust[num1554];
						dust.velocity *= 5f;
						Main.dust[num1554].noLight = true;
					}
					else
					{
						Main.dust[num1554].velocity = DirectionFrom(Main.dust[num1554].position) * Main.dust[num1554].velocity.Length();
					}
				}
			}
			if (this.ai[0] >= 0f)
			{
				this.ai[0]++;
				if (this.ai[0] > 60f)
				{
					velocity = velocity.RotatedBy(this.ai[1]);
				}
				if (this.ai[0] > 120f)
				{
					velocity *= 0.98f;
				}
				if (velocity.Length() < 0.2f)
				{
					velocity = Vector2.Zero;
				}
			}
		}
		else if (aiStyle == 101)
		{
			float num1555 = 420f;
			float num1556 = 120f;
			int num1557 = 1;
			float value9 = 0f;
			float value10 = 1f;
			float num1558 = 4f;
			bool flag108 = !(this.ai[1] >= 0f) || !Main.npc[(int)this.ai[0]].active;
			if (Main.npc[(int)this.ai[0]].type == 439)
			{
				if (Main.npc[(int)this.ai[0]].life < Main.npc[(int)this.ai[0]].lifeMax / 2)
				{
					num1557 = 2;
				}
				if (Main.npc[(int)this.ai[0]].life < Main.npc[(int)this.ai[0]].lifeMax / 4)
				{
					num1557 = 3;
				}
			}
			else
			{
				flag108 = true;
			}
			this.ai[1] += num1557;
			float num1559 = this.ai[1] / num1556;
			num1559 = MathHelper.Clamp(num1559, 0f, 1f);
			position = base.Center;
			scale = MathHelper.Lerp(value9, value10, num1559);
			base.Center = position;
			alpha = (int)(255f - num1559 * 255f);
			if (Main.rand.Next(6) == 0)
			{
				Vector2 vector286 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
				Dust dust23 = Main.dust[Dust.NewDust(base.Center - vector286 * 20f, 0, 0, 27)];
				dust23.noGravity = true;
				dust23.position = base.Center - vector286 * Main.rand.Next(10, 21) * scale;
				dust23.velocity = vector286.RotatedBy(1.5707963705062866) * 4f;
				dust23.scale = 0.5f + Main.rand.NextFloat();
				dust23.fadeIn = 0.5f;
			}
			if (Main.rand.Next(6) == 0)
			{
				Vector2 vector287 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
				Dust dust24 = Main.dust[Dust.NewDust(base.Center - vector287 * 30f, 0, 0, 240)];
				dust24.noGravity = true;
				dust24.position = base.Center - vector287 * 20f * scale;
				dust24.velocity = vector287.RotatedBy(-1.5707963705062866) * 2f;
				dust24.scale = 0.5f + Main.rand.NextFloat();
				dust24.fadeIn = 0.5f;
			}
			if (Main.rand.Next(6) == 0)
			{
				Vector2 vector288 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
				Dust dust25 = Main.dust[Dust.NewDust(base.Center - vector288 * 30f, 0, 0, 240)];
				dust25.position = base.Center - vector288 * 20f * scale;
				dust25.velocity = Vector2.Zero;
				dust25.scale = 0.5f + Main.rand.NextFloat();
				dust25.fadeIn = 0.5f;
				dust25.noLight = true;
			}
			localAI[0] += (float)Math.PI / 60f;
			localAI[1] = 0.25f + Vector2.UnitY.RotatedBy(this.ai[1] * ((float)Math.PI * 2f) / 60f).Y * 0.25f;
			if (this.ai[1] >= num1555)
			{
				flag108 = true;
				if (Main.netMode != 1)
				{
					for (int num1560 = 0; num1560 < 4; num1560++)
					{
						Vector2 vector289 = new Vector2(0f, 0f - num1558).RotatedBy((float)Math.PI / 2f * (float)num1560);
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, vector289.X, vector289.Y, 593, damage, 0f, Main.myPlayer);
					}
				}
			}
			if (flag108)
			{
				HitEffect(0, 9999.0);
				active = false;
			}
		}
		else if (aiStyle == 102)
		{
			bool flag109 = false;
			bool flag110 = false;
			bool flag111 = true;
			bool flag112 = false;
			int num1561 = 4;
			int num1562 = 3;
			int num1563 = 0;
			float num1564 = 0.2f;
			float num1565 = 2f;
			float num1566 = -0.2f;
			float num1567 = -4f;
			bool flag113 = true;
			float num1568 = 2f;
			float num1569 = 0.1f;
			float num1570 = 1f;
			float num1571 = 0.04f;
			bool flag114 = false;
			float num1572 = 0.96f;
			bool flag115 = true;
			if (type == 541)
			{
				flag113 = false;
				rotation = velocity.X * 0.04f;
				spriteDirection = ((direction > 0) ? 1 : (-1));
				num1563 = 3;
				num1566 = -0.1f;
				num1564 = 0.1f;
				float num1573 = (float)life / (float)lifeMax;
				num1568 += (1f - num1573) * 2f;
				num1569 += (1f - num1573) * 0.02f;
				if (num1573 < 0.5f)
				{
					knockBackResist = 0f;
				}
				position += netOffset;
				Vector2 vector290 = base.BottomLeft + new Vector2(0f, -12f);
				Vector2 bottomRight = base.BottomRight;
				Vector2 vector291 = new Vector2(-spriteDirection * 10, -4f);
				Color color = new Color(222, 108, 48) * 0.7f;
				float num1574 = -0.3f + MathHelper.Max(velocity.Y * 2f, 0f);
				for (int num1575 = 0; num1575 < 2; num1575++)
				{
					if (Main.rand.Next(2) != 0)
					{
						Dust dust26 = Main.dust[Dust.NewDust(base.Bottom, 0, 0, 268)];
						dust26.position = new Vector2(MathHelper.Lerp(vector290.X, bottomRight.X, Main.rand.NextFloat()), MathHelper.Lerp(vector290.Y, bottomRight.Y, Main.rand.NextFloat())) + vector291;
						if (num1575 == 1)
						{
							dust26.position = base.Bottom + Utils.RandomVector2(Main.rand, -6f, 6f);
						}
						dust26.color = color;
						dust26.scale = 0.8f;
						dust26.velocity.Y += num1574;
						dust26.velocity.X += (float)spriteDirection * 0.2f;
					}
				}
				position -= netOffset;
				localAI[2] = 0f;
				if (this.ai[0] < 0f)
				{
					this.ai[0] = MathHelper.Min(this.ai[0] + 1f, 0f);
				}
				if (this.ai[0] > 0f)
				{
					flag115 = false;
					flag114 = true;
					this.ai[0]++;
					if (this.ai[0] >= 135f)
					{
						this.ai[0] = -300f;
						netUpdate = true;
					}
					Vector2 vector292 = base.Center + Vector2.UnitX * direction * 200f;
					Vector2 vector293 = base.Center + Vector2.UnitX * direction * 50f - Vector2.UnitY * 6f;
					if (this.ai[0] == 54f && Main.netMode != 1)
					{
						List<Point> list = new List<Point>();
						Vector2 vector294 = Main.player[target].Center + new Vector2(Main.player[target].velocity.X * 30f, 0f);
						if (Distance(vector294) < 2000f)
						{
							Point point14 = vector294.ToTileCoordinates();
							for (int num1576 = 0; num1576 < 1000; num1576++)
							{
								if (list.Count >= 3)
								{
									break;
								}
								bool flag116 = false;
								int num1577 = Main.rand.Next(point14.X - 30, point14.X + 30 + 1);
								foreach (Point item in list)
								{
									if (Math.Abs(item.X - num1577) < 10)
									{
										flag116 = true;
										break;
									}
								}
								if (!flag116)
								{
									int startY = point14.Y - 20;
									Collision.ExpandVertically(num1577, startY, out var _, out var bottomY, 1, 51);
									if (StrayMethods.CanSpawnSandstormHostile(new Vector2(num1577, bottomY - 15) * 16f, 15, 15))
									{
										list.Add(new Point(num1577, bottomY - 15));
									}
								}
							}
							foreach (Point item2 in list)
							{
								Projectile.NewProjectile(GetSpawnSource_ForProjectile(), item2.X * 16, item2.Y * 16, 0f, 0f, 658, 0, 0f, Main.myPlayer);
							}
						}
						else
						{
							this.ai[0] = -200f;
							netUpdate = true;
						}
					}
					Vector2 vector295 = new Vector2(0.9f, 2f);
					if (this.ai[0] < 114f && this.ai[0] > 0f)
					{
						List<Vector2> list2 = new List<Vector2>();
						for (int num1578 = 0; num1578 < 1000; num1578++)
						{
							Projectile projectile12 = Main.projectile[num1578];
							if (projectile12.active && projectile12.type == 658)
							{
								list2.Add(projectile12.Center);
							}
						}
						Vector2 vector296 = new Vector2(0f, 1500f);
						float num1579 = (this.ai[0] - 54f) / 30f;
						if (num1579 < 0.95f && num1579 >= 0f)
						{
							foreach (Vector2 item3 in list2)
							{
								Vector2 value11 = Vector2.CatmullRom(vector293 + vector296, vector293, item3, item3 + vector296, num1579);
								Vector2 value12 = Vector2.CatmullRom(vector293 + vector296, vector293, item3, item3 + vector296, num1579 + 0.05f);
								float num1580 = num1579;
								if (num1580 > 0.5f)
								{
									num1580 = 1f - num1580;
								}
								float num1581 = 2f;
								if (Vector2.Distance(value11, value12) > 5f)
								{
									num1581 = 3f;
								}
								if (Vector2.Distance(value11, value12) > 10f)
								{
									num1581 = 4f;
								}
								for (float num1582 = 0f; num1582 < num1581; num1582++)
								{
									Dust dust27 = Main.dust[Dust.NewDust(vector293, 0, 0, 269)];
									dust27.position = Vector2.Lerp(value11, value12, num1582 / num1581) + Utils.RandomVector2(Main.rand, -2f, 2f);
									dust27.noLight = true;
									dust27.scale = 0.3f + num1579;
								}
							}
						}
					}
					_ = this.ai[0];
					_ = 100f;
				}
				if (this.ai[0] == 0f)
				{
					this.ai[0] = 1f;
					netUpdate = true;
					flag114 = true;
				}
			}
			if (justHit)
			{
				localAI[2] = 0f;
			}
			if (!flag110)
			{
				if (localAI[2] >= 0f)
				{
					float num1583 = 16f;
					bool flag117 = false;
					bool flag118 = false;
					if (position.X > localAI[0] - num1583 && position.X < localAI[0] + num1583)
					{
						flag117 = true;
					}
					else if ((velocity.X < 0f && direction > 0) || (velocity.X > 0f && direction < 0))
					{
						flag117 = true;
						num1583 += 24f;
					}
					if (position.Y > localAI[1] - num1583 && position.Y < localAI[1] + num1583)
					{
						flag118 = true;
					}
					if (flag117 && flag118)
					{
						localAI[2] += 1f;
						if (localAI[2] >= 30f && num1583 == 16f)
						{
							flag109 = true;
						}
						if (localAI[2] >= 60f)
						{
							localAI[2] = -180f;
							direction *= -1;
							velocity.X *= -1f;
							collideX = false;
						}
					}
					else
					{
						localAI[0] = position.X;
						localAI[1] = position.Y;
						localAI[2] = 0f;
					}
					if (flag115)
					{
						TargetClosest();
					}
				}
				else
				{
					localAI[2] += 1f;
					direction = ((Main.player[target].Center.X > base.Center.X) ? 1 : (-1));
				}
			}
			int num1584 = (int)((position.X + (float)(width / 2)) / 16f) + direction * 2;
			int num1585 = (int)((position.Y + (float)height) / 16f);
			int num1586 = (int)base.Bottom.Y / 16;
			int num1587 = (int)base.Bottom.X / 16;
			if (flag114)
			{
				velocity *= num1572;
				return;
			}
			for (int num1588 = num1585; num1588 < num1585 + num1561; num1588++)
			{
				if (Main.tile[num1584, num1588] == null)
				{
					Main.tile[num1584, num1588] = new Tile();
				}
				if ((Main.tile[num1584, num1588].nactive() && Main.tileSolid[Main.tile[num1584, num1588].type]) || Main.tile[num1584, num1588].liquid > 0)
				{
					if (num1588 <= num1585 + 1)
					{
						flag112 = true;
					}
					flag111 = false;
					break;
				}
			}
			for (int num1589 = num1586; num1589 < num1586 + num1563; num1589++)
			{
				if (Main.tile[num1587, num1589] == null)
				{
					Main.tile[num1587, num1589] = new Tile();
				}
				if ((Main.tile[num1587, num1589].nactive() && Main.tileSolid[Main.tile[num1587, num1589].type]) || Main.tile[num1587, num1589].liquid > 0)
				{
					flag112 = true;
					flag111 = false;
					break;
				}
			}
			if (flag113)
			{
				for (int num1590 = num1585 - num1562; num1590 < num1585; num1590++)
				{
					if (Main.tile[num1584, num1590] == null)
					{
						Main.tile[num1584, num1590] = new Tile();
					}
					if ((Main.tile[num1584, num1590].nactive() && Main.tileSolid[Main.tile[num1584, num1590].type]) || Main.tile[num1584, num1590].liquid > 0)
					{
						flag112 = false;
						flag109 = true;
						break;
					}
				}
			}
			if (flag109)
			{
				flag112 = false;
				flag111 = true;
			}
			if (flag111)
			{
				velocity.Y += num1564;
				if (velocity.Y > num1565)
				{
					velocity.Y = num1565;
				}
			}
			else
			{
				if ((directionY < 0 && velocity.Y > 0f) || flag112)
				{
					velocity.Y += num1566;
				}
				if (velocity.Y < num1567)
				{
					velocity.Y = num1567;
				}
			}
			if (collideX)
			{
				velocity.X = oldVelocity.X * -0.4f;
				if (direction == -1 && velocity.X > 0f && velocity.X < 1f)
				{
					velocity.X = 1f;
				}
				if (direction == 1 && velocity.X < 0f && velocity.X > -1f)
				{
					velocity.X = -1f;
				}
			}
			if (collideY)
			{
				velocity.Y = oldVelocity.Y * -0.25f;
				if (velocity.Y > 0f && velocity.Y < 1f)
				{
					velocity.Y = 1f;
				}
				if (velocity.Y < 0f && velocity.Y > -1f)
				{
					velocity.Y = -1f;
				}
			}
			if (direction == -1 && velocity.X > 0f - num1568)
			{
				velocity.X -= num1569;
				if (velocity.X > num1568)
				{
					velocity.X -= num1569;
				}
				else if (velocity.X > 0f)
				{
					velocity.X += num1569 / 2f;
				}
				if (velocity.X < 0f - num1568)
				{
					velocity.X = 0f - num1568;
				}
			}
			else if (direction == 1 && velocity.X < num1568)
			{
				velocity.X += num1569;
				if (velocity.X < 0f - num1568)
				{
					velocity.X += num1569;
				}
				else if (velocity.X < 0f)
				{
					velocity.X -= num1569 / 2f;
				}
				if (velocity.X > num1568)
				{
					velocity.X = num1568;
				}
			}
			if (directionY == -1 && velocity.Y > 0f - num1570)
			{
				velocity.Y -= num1571;
				if (velocity.Y > num1570)
				{
					velocity.Y -= num1571 * 1.25f;
				}
				else if (velocity.Y > 0f)
				{
					velocity.Y += num1571 * 0.75f;
				}
				if (velocity.Y < 0f - num1570)
				{
					velocity.Y = 0f - num1568;
				}
			}
			else if (directionY == 1 && velocity.Y < num1570)
			{
				velocity.Y += num1571;
				if (velocity.Y < 0f - num1570)
				{
					velocity.Y += num1571 * 1.25f;
				}
				else if (velocity.Y < 0f)
				{
					velocity.Y -= num1571 * 0.75f;
				}
				if (velocity.Y > num1570)
				{
					velocity.Y = num1570;
				}
			}
		}
		else if (aiStyle == 103)
		{
			if (direction == 0)
			{
				TargetClosest();
			}
			bool flag119 = true;
			Point pt = base.Center.ToTileCoordinates();
			Tile tileSafely7 = Framing.GetTileSafely(pt);
			flag119 = tileSafely7.nactive() && (TileID.Sets.Conversion.Sand[tileSafely7.type] || TileID.Sets.Conversion.Sandstone[tileSafely7.type] || TileID.Sets.Conversion.HardenedSand[tileSafely7.type]);
			flag119 |= wet;
			bool flag120 = false;
			TargetClosest(faceTarget: false);
			Vector2 vector297 = targetRect.Center.ToVector2();
			if (Main.player[target].velocity.Y > -0.1f && !Main.player[target].dead && Distance(vector297) > 150f)
			{
				flag120 = true;
			}
			if (localAI[0] == -1f && !flag119)
			{
				localAI[0] = 20f;
			}
			if (localAI[0] > 0f)
			{
				localAI[0]--;
			}
			if (flag119)
			{
				if (soundDelay == 0)
				{
					float num1591 = Distance(vector297) / 40f;
					if (num1591 < 10f)
					{
						num1591 = 10f;
					}
					if (num1591 > 20f)
					{
						num1591 = 20f;
					}
					soundDelay = (int)num1591;
					SoundEngine.PlaySound(15, base.Center, 4);
				}
				float num1592 = this.ai[1];
				bool flag121 = false;
				pt = (base.Center + new Vector2(0f, 24f)).ToTileCoordinates();
				tileSafely7 = Framing.GetTileSafely(pt.X, pt.Y - 2);
				if (tileSafely7.nactive() && (TileID.Sets.Conversion.Sand[tileSafely7.type] || TileID.Sets.Conversion.Sandstone[tileSafely7.type] || TileID.Sets.Conversion.HardenedSand[tileSafely7.type]))
				{
					flag121 = true;
				}
				this.ai[1] = flag121.ToInt();
				if (this.ai[2] < 30f)
				{
					this.ai[2]++;
				}
				if (flag120)
				{
					TargetClosest();
					velocity.X += (float)direction * 0.15f;
					velocity.Y += (float)directionY * 0.15f;
					if (velocity.X > 5f)
					{
						velocity.X = 5f;
					}
					if (velocity.X < -5f)
					{
						velocity.X = -5f;
					}
					if (velocity.Y > 3f)
					{
						velocity.Y = 3f;
					}
					if (velocity.Y < -3f)
					{
						velocity.Y = -3f;
					}
					Vector2 vec5 = base.Center + velocity.SafeNormalize(Vector2.Zero) * base.Size.Length() / 2f + velocity;
					pt = vec5.ToTileCoordinates();
					tileSafely7 = Framing.GetTileSafely(pt);
					bool flag122 = tileSafely7.nactive() && (TileID.Sets.Conversion.Sand[tileSafely7.type] || TileID.Sets.Conversion.Sandstone[tileSafely7.type] || TileID.Sets.Conversion.HardenedSand[tileSafely7.type]);
					if (!flag122 && wet)
					{
						flag122 = tileSafely7.liquid > 0;
					}
					int num1593 = 400;
					if (Main.remixWorld)
					{
						num1593 = 700;
					}
					if (!flag122 && Math.Sign(velocity.X) == direction && Distance(vector297) < (float)num1593 && (this.ai[2] >= 30f || this.ai[2] < 0f))
					{
						if (localAI[0] == 0f)
						{
							SoundEngine.PlaySound(14, base.Center, 542);
							localAI[0] = -1f;
						}
						this.ai[2] = -30f;
						Vector2 vector298 = DirectionTo(vector297 + new Vector2(0f, -80f));
						velocity = vector298 * 12f;
					}
				}
				else
				{
					if (collideX)
					{
						velocity.X *= -1f;
						direction *= -1;
						netUpdate = true;
					}
					if (collideY)
					{
						netUpdate = true;
						velocity.Y *= -1f;
						directionY = Math.Sign(velocity.Y);
						this.ai[0] = directionY;
					}
					float num1594 = 6f;
					velocity.X += (float)direction * 0.1f;
					if (velocity.X < 0f - num1594 || velocity.X > num1594)
					{
						velocity.X *= 0.95f;
					}
					if (flag121)
					{
						this.ai[0] = -1f;
					}
					else
					{
						this.ai[0] = 1f;
					}
					float num1595 = 0.06f;
					float num1596 = 0.01f;
					if (this.ai[0] == -1f)
					{
						velocity.Y -= num1596;
						if (velocity.Y < 0f - num1595)
						{
							this.ai[0] = 1f;
						}
					}
					else
					{
						velocity.Y += num1596;
						if (velocity.Y > num1595)
						{
							this.ai[0] = -1f;
						}
					}
					if (velocity.Y > 0.4f || velocity.Y < -0.4f)
					{
						velocity.Y *= 0.95f;
					}
				}
			}
			else
			{
				if (velocity.Y == 0f)
				{
					if (flag120)
					{
						TargetClosest();
					}
					float num1597 = 1f;
					velocity.X += (float)direction * 0.1f;
					if (velocity.X < 0f - num1597 || velocity.X > num1597)
					{
						velocity.X *= 0.95f;
					}
				}
				velocity.Y += 0.3f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
				this.ai[0] = 1f;
			}
			rotation = velocity.Y * (float)direction * 0.1f;
			if (rotation < -0.2f)
			{
				rotation = -0.2f;
			}
			if (rotation > 0.2f)
			{
				rotation = 0.2f;
			}
		}
		else if (aiStyle == 104)
		{
			active = false;
		}
		else if (aiStyle == 105)
		{
			if (alpha == 0)
			{
				Lighting.AddLight(base.Center, 1.3f, 0.5f, 1.5f);
			}
			if (this.ai[1] == 0f)
			{
				if (this.ai[0] > 0f)
				{
					this.ai[0]--;
				}
				if (this.ai[0] != 0f)
				{
					return;
				}
				this.ai[0] = 180f;
				netUpdate = true;
				if (localAI[0] == 0f)
				{
					StrayMethods.CheckArenaScore(base.Bottom, out var xLeftEnd, out var xRightEnd);
					localAI[0] = 1f;
					xLeftEnd.X += 2;
					xRightEnd.X -= 2;
					int num1598 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), xLeftEnd.X, xLeftEnd.Y, 549);
					Main.npc[num1598].Bottom = xLeftEnd.ToWorldCoordinates(8f, 16f);
					num1598 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), xRightEnd.X, xRightEnd.Y, 549, 0, 0f, 0f, 1f);
					Main.npc[num1598].Bottom = xRightEnd.ToWorldCoordinates(8f, 16f);
					if (Main.netMode != 1)
					{
						DD2Event.FindArenaHitbox();
					}
				}
			}
			else if (this.ai[1] == 2f)
			{
				dontTakeDamageFromHostiles = true;
				life = lifeMax;
				if (this.ai[0] == 3f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_WinScene, base.Center);
					for (int num1599 = 0; num1599 < Main.maxNPCs; num1599++)
					{
						NPC nPC12 = Main.npc[num1599];
						if (nPC12.active && nPC12.type == 549)
						{
							nPC12.ai[1] = 1f;
							nPC12.ai[0] = 0f;
							nPC12.netUpdate = true;
						}
					}
					if (Main.netMode != 1)
					{
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center - Vector2.UnitY * 40f, Vector2.Zero, 713, 0, 0f, Main.myPlayer);
					}
				}
				this.ai[0]++;
				noGravity = true;
				if (this.ai[0] <= 120f)
				{
					float num1600 = this.ai[0] / 120f;
					velocity.Y = (float)Math.Cos(num1600 * ((float)Math.PI * 2f)) * 0.25f - 0.25f;
				}
				else
				{
					velocity.Y = 0f;
				}
				float lerpValue = Utils.GetLerpValue(480f, 570f, this.ai[0], clamped: true);
				if (lerpValue != 0f)
				{
					MoonlordDeathDrama.RequestLight(lerpValue, base.Center);
				}
				if (this.ai[0] >= 600f)
				{
					DD2Event.StopInvasion(win: true);
					dontTakeDamage = false;
					life = 0;
					checkDead();
					netUpdate = true;
				}
				if (true)
				{
					Vector2 vector299 = base.Center + new Vector2(0f, -20f);
					float num1601 = 0.99f;
					if (this.ai[0] >= 60f)
					{
						num1601 = 0.79f;
					}
					if (this.ai[0] >= 120f)
					{
						num1601 = 0.58f;
					}
					if (this.ai[0] >= 180f)
					{
						num1601 = 0.43f;
					}
					if (this.ai[0] >= 240f)
					{
						num1601 = 0.33f;
					}
					if (this.ai[0] >= 540f)
					{
						num1601 = 1f;
					}
					for (int num1602 = 0; num1602 < 9; num1602++)
					{
						if (!(Main.rand.NextFloat() < num1601))
						{
							float num1603 = Main.rand.NextFloat() * ((float)Math.PI * 2f);
							float num1604 = Main.rand.NextFloat();
							Vector2 vector300 = vector299 + num1603.ToRotationVector2() * (110f + 600f * num1604);
							Vector2 vector301 = (num1603 - (float)Math.PI).ToRotationVector2() * (14f + 0f * Main.rand.NextFloat() + 8f * num1604);
							Dust dust28 = Dust.NewDustPerfect(vector300, 264, vector301);
							dust28.scale = 0.9f;
							dust28.fadeIn = 1.15f + num1604 * 0.3f;
							dust28.color = new Color(1f, 1f, 1f, num1601) * (1f - num1601);
							dust28.noGravity = true;
							dust28.noLight = true;
						}
					}
				}
				if (this.ai[0] == 100f || this.ai[0] == 160f || this.ai[0] == 220f || this.ai[0] == 280f || this.ai[0] == 340f || this.ai[0] == 370f || this.ai[0] == 400f || this.ai[0] == 430f || this.ai[0] == 460f || this.ai[0] == 500f || this.ai[0] == 520f || this.ai[0] == 540f)
				{
					float num1605 = Main.rand.NextFloat() * ((float)Math.PI * 2f);
					float num1606 = 120f;
					for (int num1607 = 0; (float)num1607 < num1606; num1607++)
					{
						float num1608 = (float)num1607 / num1606 * ((float)Math.PI * 2f);
						float num1609 = Main.rand.NextFloat();
						Vector2 vector302 = base.Center + new Vector2(0f, -20f) + num1608.ToRotationVector2() * (810f - this.ai[0]);
						Vector2 vector303 = (num1608 - (float)Math.PI).ToRotationVector2() * (14f + 5f * (this.ai[0] / 600f) + 8f * num1609);
						Dust dust29 = Dust.NewDustPerfect(vector302, 264, vector303);
						dust29.scale = 0.9f;
						dust29.fadeIn = 1.15f + num1609 * 0.3f;
						dust29.color = new Color(1f, 1f, 1f, 0f);
						dust29.noGravity = true;
						dust29.noLight = true;
					}
				}
			}
			else
			{
				if (this.ai[1] != 1f)
				{
					return;
				}
				dontTakeDamageFromHostiles = true;
				life = lifeMax;
				if (this.ai[0] == 0f)
				{
					for (int num1610 = 0; num1610 < Main.maxNPCs; num1610++)
					{
						NPC nPC13 = Main.npc[num1610];
						if (nPC13.active && nPC13.type == 549)
						{
							nPC13.ai[1] = 1f;
							nPC13.ai[0] = 0f;
							nPC13.netUpdate = true;
						}
					}
					if (Main.netMode != 1)
					{
						DD2Event.ReportLoss();
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center - Vector2.UnitY * 40f, Vector2.Zero, 672, 0, 0f, Main.myPlayer);
					}
				}
				this.ai[0]++;
				float lerpValue2 = Utils.GetLerpValue(480f, 600f, this.ai[0], clamped: true);
				if (lerpValue2 != 0f)
				{
					MoonlordDeathDrama.RequestLight(lerpValue2, base.Center);
				}
				float num1611 = 96f;
				if (this.ai[0] < num1611)
				{
					velocity.Y = MathHelper.Lerp(0f, -1f, this.ai[0] / num1611);
				}
				if (this.ai[0] >= num1611)
				{
					alpha += 50;
					if (alpha > 255)
					{
						alpha = 255;
					}
				}
				if (true)
				{
					Vector2 vector304 = base.Center + new Vector2(0f, MathHelper.Lerp(0f, -70f, Utils.GetLerpValue(0f, 300f, this.ai[0], clamped: true)));
					float num1612 = 0.99f;
					if (this.ai[0] >= 60f)
					{
						num1612 = 0.79f;
					}
					if (this.ai[0] >= 120f)
					{
						num1612 = 0.58f;
					}
					if (this.ai[0] >= 180f)
					{
						num1612 = 0.23f;
					}
					if (this.ai[0] >= 240f)
					{
						num1612 = 0.35f;
					}
					if (this.ai[0] >= 300f)
					{
						num1612 = 0.6f;
					}
					if (this.ai[0] >= 360f)
					{
						num1612 = 0.98f;
					}
					if (this.ai[0] >= 420f)
					{
						num1612 = 0.995f;
					}
					if (this.ai[0] >= 450f)
					{
						num1612 = 1f;
					}
					for (int num1613 = 0; num1613 < 12; num1613++)
					{
						if (!(Main.rand.NextFloat() < num1612))
						{
							float num1614 = Main.rand.NextFloat() * ((float)Math.PI * 2f);
							float num1615 = Main.rand.NextFloat();
							Vector2 vector305 = vector304 + num1614.ToRotationVector2() * (70f + 600f * num1615);
							Vector2 vector306 = (num1614 - (float)Math.PI / 2f - (float)Math.PI / 8f).ToRotationVector2() * (12f + 9f * Main.rand.NextFloat() + 4f * num1615);
							Dust dust30 = Dust.NewDustPerfect(vector305, 240, vector306);
							dust30.scale = 0.8f;
							dust30.fadeIn = 0.95f + num1615 * 0.3f;
							dust30.noGravity = true;
						}
					}
				}
				if (this.ai[0] >= 600f)
				{
					DD2Event.StopInvasion();
					if (!Main.dedServ)
					{
						Filters.Scene.Deactivate("CrystalDestructionVortex");
						Filters.Scene.Deactivate("CrystalDestructionColor");
						Filters.Scene.Deactivate("CrystalWin");
					}
					dontTakeDamage = false;
					life = 0;
					checkDead();
					netUpdate = true;
				}
			}
		}
		else if (aiStyle == 106)
		{
			bool leftGate = this.ai[2] == 0f;
			if (alpha == 0)
			{
				Lighting.AddLight(base.Center, 0.5f, 0.1f, 0.3f);
			}
			if (this.ai[1] == 0f)
			{
				if (localAI[0] == 0f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_EtherianPortalOpen, base.Center);
					localAI[3] = SlotId.Invalid.ToFloat();
				}
				if (localAI[0] > 150f)
				{
					ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[3]));
					if (activeSound == null)
					{
						localAI[3] = SoundEngine.PlayTrackedSound(SoundID.DD2_EtherianPortalIdleLoop, base.Center).ToFloat();
					}
				}
				if (!DD2Event.EnemySpawningIsOnHold)
				{
					this.ai[0]++;
				}
				if (this.ai[0] >= (float)DD2Event.LaneSpawnRate)
				{
					if (this.ai[0] >= (float)(DD2Event.LaneSpawnRate * 3))
					{
						this.ai[0] = 0f;
					}
					netUpdate = true;
					if (Main.netMode != 1 && (int)this.ai[0] % DD2Event.LaneSpawnRate == 0)
					{
						DD2Event.SpawnMonsterFromGate(base.Bottom, leftGate);
						if (DD2Event.EnemySpawningIsOnHold)
						{
							this.ai[0]++;
						}
					}
				}
				localAI[0]++;
				if (localAI[0] > 180f)
				{
					localAI[0] = 180f;
				}
				if (Main.netMode != 1 && localAI[0] >= 180f)
				{
					if (AnyNPCs(548))
					{
						dontTakeDamage = true;
						return;
					}
					this.ai[1] = 1f;
					this.ai[0] = 0f;
					dontTakeDamage = true;
				}
			}
			else if (this.ai[1] == 1f)
			{
				this.ai[0]++;
				scale = MathHelper.Lerp(1f, 0.05f, Utils.GetLerpValue(500f, 600f, this.ai[0], clamped: true));
				ActiveSound activeSound2 = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[3]));
				if (activeSound2 == null)
				{
					localAI[3] = SoundEngine.PlayTrackedSound(SoundID.DD2_EtherianPortalIdleLoop, base.Center).ToFloat();
				}
				activeSound2 = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[3]));
				if (activeSound2 != null)
				{
					activeSound2.Volume = scale;
				}
				if (this.ai[0] >= 550f)
				{
					dontTakeDamage = false;
					life = 0;
					checkDead();
					netUpdate = true;
					activeSound2?.Stop();
				}
			}
		}
		else if (aiStyle == 107)
		{
			AI_107_ImprovedWalkers();
		}
		else if (aiStyle == 108)
		{
			AI_108_DivingFlyer();
		}
		else if (aiStyle == 109)
		{
			AI_109_DarkMage();
		}
		else if (aiStyle == 110)
		{
			AI_110_Betsy();
		}
		else if (aiStyle == 111)
		{
			AI_111_DD2LightningBug();
		}
		else if (aiStyle == 112)
		{
			AI_112_FairyCritter();
		}
		else if (aiStyle == 113)
		{
			AI_113_WindyBalloon();
		}
		else if (aiStyle == 114)
		{
			AI_114_Dragonflies();
		}
		else if (aiStyle == 115)
		{
			AI_115_LadyBugs();
		}
		else if (aiStyle == 116)
		{
			AI_116_WaterStriders();
		}
		else if (aiStyle == 117)
		{
			AI_117_BloodNautilus();
		}
		else if (aiStyle == 118)
		{
			AI_118_Seahorses();
		}
		else if (aiStyle == 119)
		{
			AI_119_Dandelion();
		}
		else if (aiStyle == 120)
		{
			AI_120_HallowBoss();
		}
		else if (aiStyle == 121)
		{
			AI_121_QueenSlime();
		}
		else if (aiStyle == 122)
		{
			AI_122_PirateGhost();
		}
		else if (aiStyle == 123)
		{
			AI_123_Deerclops();
		}
		else if (aiStyle == 124)
		{
			AI_124_ElderSlimeChest();
		}
		else if (aiStyle == 125)
		{
			AI_125_ClumsySlimeBalloon();
		}
		else if (aiStyle == 126)
		{
			AI_126_StatueMimic();
		}
		else if (aiStyle == 127)
		{
			AI_127_Pal();
		}
	}

	private void AI_127_Pal()
	{
		TargetClosest();
		spriteDirection = -direction;
		if (Main.netMode != 1)
		{
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				Point[] spawnPoints = null;
				if (!CultistRitual.CheckFloor2(base.Center, out spawnPoints))
				{
					life = 0;
					HitEffect();
					active = false;
					return;
				}
				for (int i = 0; i < 2; i++)
				{
					int num = 0;
					num = 111;
					int num2 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), spawnPoints[i].X * 16 + 8, spawnPoints[i].Y * 16 - 48, num);
					ai[1 + i] = num2 + 1;
					Main.npc[num2].ai[3] = -(whoAmI + 1);
					Main.npc[num2].netUpdate = true;
				}
				netUpdate = true;
			}
			if (ai[0] == 0f)
			{
				NPC nPC = AI_127_Pal_TryUnpackNPC(ai[1]);
				NPC nPC2 = AI_127_Pal_TryUnpackNPC(ai[2]);
				if (nPC == null && nPC2 == null)
				{
					ai[0] = 1f;
					netUpdate = true;
				}
				else
				{
					timeLeft = activeTime;
				}
			}
			if (ai[0] == 1f)
			{
				Player player = Main.player[target];
				if (Distance(player.Center) < 100f)
				{
					ai[0] = 2f;
					ai[1] = 0f;
					ai[2] = 0f;
					netUpdate = true;
				}
			}
		}
		if (ai[0] == 0f && soundDelay == 0)
		{
			soundDelay = Main.rand.Next(600, 1800);
			if (type == 695)
			{
				SoundEngine.PlaySound(SoundID.PalCattivaPain, base.Center);
			}
			if (type == 696)
			{
				SoundEngine.PlaySound(SoundID.PalFoxparksPain, base.Center);
			}
		}
		if (ai[0] == 2f)
		{
			if (soundDelay != -2)
			{
				soundDelay = -2;
				if (type == 695)
				{
					SoundEngine.PlaySound(SoundID.PalCattivaJoy, base.Center);
				}
				if (type == 696)
				{
					SoundEngine.PlaySound(SoundID.PalFoxparksJoy, base.Center);
				}
			}
			if ((ai[1] += 1f) >= 120f)
			{
				if (Main.netMode != 1)
				{
					AI_127_Pal_GiveRewerd();
				}
				life = 0;
				active = false;
				return;
			}
		}
		if (type == 696)
		{
			Lighting.AddLight(base.Center, 0.5f, 0.3f, 0.1f);
		}
		velocity.X *= 0.93f;
		if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
		{
			velocity.X = 0f;
		}
	}

	private void AI_127_Pal_GiveRewerd()
	{
		short num = 5663;
		if (type == 696)
		{
			num = 5664;
		}
		Item.NewItem(GetItemSource_Loot(), position, base.Size, num, 1, noBroadcast: false, -1);
	}

	private int AI_127_Pal_SummonAttacker(int side)
	{
		return 0;
	}

	private NPC AI_127_Pal_TryUnpackNPC(float aiValue)
	{
		int num = (int)aiValue - 1;
		if (num < 0 || num >= Main.maxNPCs)
		{
			return null;
		}
		NPC nPC = Main.npc[num];
		if (!nPC.active)
		{
			return null;
		}
		return nPC;
	}

	private void AddKingSlimeTeleportCacheTiles(int x0, int x1, int y0, int y1)
	{
		for (int i = x0; i <= x1; i++)
		{
			for (int j = y0; j <= y1; j++)
			{
				Tile tile = Main.tile[i, j];
				if (tile.nactive() && kingSlimePointCacheSize < kingSlimePointCacheSizeMax && ((Main.tileSolid[tile.type] && !Main.tileSolidTop[tile.type]) || TileID.Sets.Platforms[tile.type]) && !WorldGen.SolidTile(Main.tile[i, j - 1]))
				{
					Vector2 position = new Vector2(i * 16 + 8, j * 16 - height / 2);
					if (!tile.lava() && Collision.CanHitLine(position, 0, 0, Main.player[target].Center, 0, 0))
					{
						kingSlimePointCache[kingSlimePointCacheSize].X = i;
						kingSlimePointCache[kingSlimePointCacheSize].Y = j;
						kingSlimePointCacheSize++;
					}
				}
			}
		}
	}

	private bool BuildKingSlimeTeleportCache(int tileTargetX, int tileTargetY, int outerRange, int innerRange)
	{
		kingSlimePointCacheSize = 0;
		AddKingSlimeTeleportCacheTiles(tileTargetX - outerRange, tileTargetX - innerRange, tileTargetY - outerRange, tileTargetY + outerRange);
		AddKingSlimeTeleportCacheTiles(tileTargetX + innerRange, tileTargetX + outerRange, tileTargetY - outerRange, tileTargetY + outerRange);
		AddKingSlimeTeleportCacheTiles(tileTargetX - innerRange, tileTargetX + innerRange, tileTargetY - outerRange, tileTargetY - innerRange);
		AddKingSlimeTeleportCacheTiles(tileTargetX - innerRange, tileTargetX + innerRange, tileTargetY + innerRange, tileTargetY + outerRange);
		return kingSlimePointCacheSize > 0;
	}

	private bool AI_015_KingSlime_FindTeleportSpot(bool antiCheese, ref float teleportSpotX, ref float teleportSpotY)
	{
		if (antiCheese)
		{
			int num = Player.FindClosest(position, width, height);
			teleportSpotX = Main.player[num].Bottom.X;
			teleportSpotY = Main.player[num].Bottom.Y;
			return false;
		}
		Point point = Main.player[target].Center.ToTileCoordinates();
		if (BuildKingSlimeTeleportCache(point.X, point.Y, 10, 7))
		{
			int num2 = Main.rand.Next(0, kingSlimePointCacheSize);
			int x = kingSlimePointCache[num2].X;
			int y = kingSlimePointCache[num2].Y;
			teleportSpotX = x * 16 + 8;
			teleportSpotY = y * 16;
			return true;
		}
		if (BuildKingSlimeTeleportCache(point.X, point.Y, 6, 2))
		{
			int num3 = Main.rand.Next(0, kingSlimePointCacheSize);
			int x2 = kingSlimePointCache[num3].X;
			int y2 = kingSlimePointCache[num3].Y;
			teleportSpotX = x2 * 16 + 8;
			teleportSpotY = y2 * 16;
			return true;
		}
		int num4 = Player.FindClosest(position, width, height);
		teleportSpotX = Main.player[num4].Bottom.X;
		teleportSpotY = Main.player[num4].Bottom.Y;
		return false;
	}

	private void AI_015_KingSlime()
	{
		float num = 1f;
		float num2 = 1f;
		bool flag = false;
		bool flag2 = false;
		bool flag3 = false;
		float num3 = 2f;
		if (Main.getGoodWorld)
		{
			num3 -= 1f - (float)life / (float)lifeMax;
			num2 *= num3;
		}
		aiAction = 0;
		if (ai[3] == 0f && life > 0)
		{
			ai[3] = lifeMax;
		}
		if (localAI[3] == 0f)
		{
			localAI[3] = 1f;
			flag = true;
			if (Main.netMode != 1)
			{
				ai[0] = -100f;
				TargetClosest();
				netUpdate = true;
			}
		}
		int num4 = 3000;
		if (Main.player[target].dead || Vector2.Distance(base.Center, Main.player[target].Center) > (float)num4)
		{
			TargetClosest();
			if (Main.player[target].dead || Vector2.Distance(base.Center, Main.player[target].Center) > (float)num4)
			{
				EncourageDespawn(10);
				if (Main.player[target].Center.X < base.Center.X)
				{
					direction = 1;
				}
				else
				{
					direction = -1;
				}
				if (Main.netMode != 1 && ai[1] != 5f)
				{
					netUpdate = true;
					ai[2] = 0f;
					ai[0] = 0f;
					ai[1] = 5f;
					localAI[1] = Main.maxTilesX * 16;
					localAI[2] = Main.maxTilesY * 16;
				}
			}
		}
		if (!Main.player[target].dead && timeLeft > 10 && ai[2] >= 300f && ai[1] < 5f && velocity.Y == 0f)
		{
			ai[2] = 0f;
			ai[0] = 0f;
			ai[1] = 5f;
			if (Main.netMode != 1)
			{
				TargetClosest(faceTarget: false);
				base.Center.ToTileCoordinates();
				Main.player[target].Center.ToTileCoordinates();
				Vector2 vector = Main.player[target].Center - base.Center;
				bool antiCheese = false;
				if (localAI[0] >= 360f || vector.Length() > 2000f)
				{
					if (localAI[0] >= 360f)
					{
						localAI[0] = 360f;
					}
					antiCheese = true;
				}
				AI_015_KingSlime_FindTeleportSpot(antiCheese, ref localAI[1], ref localAI[2]);
			}
		}
		if (!Collision.CanHitLine(base.Center, 0, 0, Main.player[target].Center, 0, 0) || Math.Abs(base.Top.Y - Main.player[target].Bottom.Y) > 160f)
		{
			ai[2] += 1f;
			if (Main.netMode != 1)
			{
				localAI[0] += 1f;
			}
		}
		else if (Main.netMode != 1)
		{
			localAI[0] -= 1f;
			if (localAI[0] < 0f)
			{
				localAI[0] = 0f;
			}
		}
		if (timeLeft < 10 && (ai[0] != 0f || ai[1] != 0f))
		{
			ai[0] = 0f;
			ai[1] = 0f;
			netUpdate = true;
			flag2 = false;
		}
		if (ai[1] == 5f)
		{
			flag2 = true;
			aiAction = 1;
			ai[0] += 1f;
			num = MathHelper.Clamp((60f - ai[0]) / 60f, 0f, 1f);
			num = 0.5f + num * 0.5f;
			if (ai[0] >= 60f)
			{
				flag3 = true;
			}
			if (ai[0] == 60f)
			{
				Gore.NewGore(base.Center + new Vector2(-40f, -height / 2), velocity, 734);
			}
			if (ai[0] >= 60f && Main.netMode != 1)
			{
				base.Bottom = new Vector2(localAI[1], localAI[2]);
				ai[1] = 6f;
				ai[0] = 0f;
				netUpdate = true;
			}
			if (Main.netMode == 1 && ai[0] >= 120f)
			{
				ai[1] = 6f;
				ai[0] = 0f;
			}
			if (!flag3)
			{
				for (int i = 0; i < 10; i++)
				{
					int num5 = Dust.NewDust(position + Vector2.UnitX * -20f, width + 40, height, 4, velocity.X, velocity.Y, 150, new Color(78, 136, 255, 80), 2f);
					Main.dust[num5].noGravity = true;
					Main.dust[num5].velocity *= 0.5f;
				}
			}
		}
		else if (ai[1] == 6f)
		{
			flag2 = true;
			aiAction = 0;
			ai[0] += 1f;
			num = MathHelper.Clamp(ai[0] / 30f, 0f, 1f);
			num = 0.5f + num * 0.5f;
			if (ai[0] >= 30f && Main.netMode != 1)
			{
				ai[1] = 0f;
				ai[0] = 0f;
				netUpdate = true;
				TargetClosest();
			}
			if (Main.netMode == 1 && ai[0] >= 60f)
			{
				ai[1] = 0f;
				ai[0] = 0f;
				TargetClosest();
			}
			for (int j = 0; j < 10; j++)
			{
				int num6 = Dust.NewDust(position + Vector2.UnitX * -20f, width + 40, height, 4, velocity.X, velocity.Y, 150, new Color(78, 136, 255, 80), 2f);
				Main.dust[num6].noGravity = true;
				Main.dust[num6].velocity *= 2f;
			}
		}
		dontTakeDamage = (hide = flag3);
		if (velocity.Y == 0f)
		{
			velocity.X *= 0.8f;
			if (velocity.X > -0.1f && velocity.X < 0.1f)
			{
				velocity.X = 0f;
			}
			if (!flag2)
			{
				ai[0] += 2f;
				if ((float)life < (float)lifeMax * 0.8f)
				{
					ai[0] += 1f;
				}
				if ((float)life < (float)lifeMax * 0.6f)
				{
					ai[0] += 1f;
				}
				if ((float)life < (float)lifeMax * 0.4f)
				{
					ai[0] += 2f;
				}
				if ((float)life < (float)lifeMax * 0.2f)
				{
					ai[0] += 3f;
				}
				if ((float)life < (float)lifeMax * 0.1f)
				{
					ai[0] += 4f;
				}
				if (ai[0] >= 0f)
				{
					netUpdate = true;
					TargetClosest();
					if (ai[1] == 3f)
					{
						velocity.Y = -13f;
						velocity.X += 3.5f * (float)direction;
						ai[0] = -200f;
						ai[1] = 0f;
					}
					else if (ai[1] == 2f)
					{
						velocity.Y = -6f;
						velocity.X += 4.5f * (float)direction;
						ai[0] = -120f;
						ai[1] += 1f;
					}
					else
					{
						velocity.Y = -8f;
						velocity.X += 4f * (float)direction;
						ai[0] = -120f;
						ai[1] += 1f;
					}
				}
				else if (ai[0] >= -30f)
				{
					aiAction = 1;
				}
			}
		}
		else if (target < 255)
		{
			float num7 = 3f;
			if (Main.getGoodWorld)
			{
				num7 = 6f;
			}
			if ((direction == 1 && velocity.X < num7) || (direction == -1 && velocity.X > 0f - num7))
			{
				if ((direction == -1 && velocity.X < 0.1f) || (direction == 1 && velocity.X > -0.1f))
				{
					velocity.X += 0.2f * (float)direction;
				}
				else
				{
					velocity.X *= 0.93f;
				}
			}
		}
		int num8 = Dust.NewDust(position, width, height, 4, velocity.X, velocity.Y, 255, new Color(0, 80, 255, 80), scale * 1.2f);
		Main.dust[num8].noGravity = true;
		Main.dust[num8].velocity *= 0.5f;
		if (life <= 0)
		{
			return;
		}
		float num9 = (float)life / (float)lifeMax;
		num9 = num9 * 0.5f + 0.75f;
		num9 *= num;
		num9 *= num2;
		if (num9 != scale || flag)
		{
			position.X += width / 2;
			position.Y += height;
			scale = num9;
			width = (int)(98f * scale);
			height = (int)(92f * scale);
			position.X -= width / 2;
			position.Y -= height;
		}
		if (Main.netMode == 1)
		{
			return;
		}
		int num10 = (int)((float)lifeMax * 0.05f);
		if (!((float)(life + num10) < ai[3]))
		{
			return;
		}
		ai[3] = life;
		int num11 = Main.rand.Next(1, 4);
		for (int k = 0; k < num11; k++)
		{
			int x = (int)(position.X + (float)Main.rand.Next(width - 32));
			int y = (int)(position.Y + (float)Main.rand.Next(height - 32));
			int num12 = 1;
			if (Main.expertMode && Main.rand.Next(4) == 0)
			{
				num12 = 535;
			}
			int num13 = NewNPC(GetSpawnSourceForProjectileNPC(), x, y, num12);
			Main.npc[num13].SetDefaults(num12);
			Main.npc[num13].velocity.X = (float)Main.rand.Next(-15, 16) * 0.1f;
			Main.npc[num13].velocity.Y = (float)Main.rand.Next(-30, 1) * 0.1f;
			Main.npc[num13].ai[0] = -1000 * Main.rand.Next(3);
			Main.npc[num13].ai[1] = 0f;
			if (Main.netMode == 2 && num13 < Main.maxNPCs)
			{
				NetMessage.SendData(23, -1, -1, null, num13);
			}
		}
	}

	public static bool CanAnyPlayerSeeThisTile(int x, int y)
	{
		int num = 32;
		Rectangle rectangle = new Rectangle(x * 16 - sWidth / 2 - num / 2, y * 16 - sHeight / 2 - num / 2, sWidth + num, sHeight + num);
		for (int i = 0; i < 255; i++)
		{
			if (Main.player[i].active && Main.player[i].getRect().Intersects(rectangle))
			{
				return true;
			}
		}
		return false;
	}

	public static bool IsThisAGoodPlaceForAStatueMimic(int x, int y)
	{
		if (WorldGen.SolidTile2(x, y) && WorldGen.SolidTile2(x + 1, y) && !Main.tile[x, y - 1].active() && !Main.tile[x, y - 2].active() && !Main.tile[x, y - 3].active() && !Main.tile[x + 1, y - 1].active() && !Main.tile[x + 1, y - 2].active() && !Main.tile[x + 1, y - 3].active())
		{
			return true;
		}
		return false;
	}

	private void AI_126_StatueMimic()
	{
		if (noTileCollide)
		{
			wet = false;
		}
		if (ai[0] == 0f)
		{
			timeLeft = 60;
			TargetClosest();
			direction = oldDirection;
			if (Main.netMode == 1)
			{
				return;
			}
			if (localAI[1] == 0f)
			{
				localAI[1] = 1f;
				ai[1] = WorldGen.GetRandomStatueStyleForStatueMimics();
				netUpdate = true;
			}
			localAI[0] += 1f;
			Vector2 vector = base.Center - Main.player[target].Center;
			if (!Main.player[target].dead && vector.Length() < 96f)
			{
				if (Collision.CanHit(this, Main.player[target]))
				{
					ai[0] = 1f;
					netUpdate = true;
				}
			}
			else
			{
				if (!(localAI[0] >= 10f))
				{
					return;
				}
				localAI[0] = 0f;
				if (CanAnyPlayerSeeThisTile((int)base.Center.X / 16, (int)base.Bottom.Y / 16))
				{
					return;
				}
				int num = 0;
				int num2 = -1;
				int num3 = -1;
				if (Math.Abs(Main.player[target].Center.X - base.Center.X) < (float)(sWidth / 2))
				{
					num2 = (int)((Main.player[target].Center.X - (float)(sWidth / 2) - (float)num) / 16f);
					num3 = (int)((Main.player[target].Center.X + (float)(sWidth / 2) + (float)num) / 16f);
				}
				else if (Main.player[target].Center.X < base.Center.X)
				{
					num2 = (int)((Main.player[target].Center.X + (float)(sWidth / 2) + (float)num) / 16f);
					num3 = (int)(base.Center.X / 16f);
				}
				else
				{
					num2 = (int)(base.Center.X / 16f);
					num3 = (int)((Main.player[target].Center.X - (float)(sWidth / 2) - (float)num) / 16f);
				}
				int num4 = -1;
				int num5 = -1;
				if (Math.Abs(Main.player[target].Center.Y - base.Center.Y) < (float)(sHeight / 2))
				{
					num4 = (int)((Main.player[target].Center.Y - (float)(sHeight / 2) - (float)num) / 16f);
					num5 = (int)((Main.player[target].Center.Y + (float)(sHeight / 2) + (float)num) / 16f);
				}
				else if (Main.player[target].Center.Y < base.Center.Y)
				{
					num4 = (int)((Main.player[target].Center.Y + (float)(sHeight / 2) + (float)num) / 16f);
					num5 = (int)(base.Center.Y / 16f);
				}
				else
				{
					num4 = (int)(base.Center.Y / 16f);
					num5 = (int)((Main.player[target].Center.Y - (float)(sHeight / 2) - (float)num) / 16f);
				}
				for (int num6 = 10; num6 > 0; num6--)
				{
					int num7 = Main.rand.Next(num2, num3);
					int num8 = Main.rand.Next(num4, num5);
					bool flag = false;
					for (int i = 0; i < 10; i++)
					{
						if (WorldGen.SolidTile2(num7, num8) && WorldGen.SolidTile2(num7 + 1, num8))
						{
							if (!CanAnyPlayerSeeThisTile(num7 + 1, num8))
							{
								flag = true;
							}
							break;
						}
						num8++;
					}
					if (flag && IsThisAGoodPlaceForAStatueMimic(num7, num8))
					{
						Vector2 vector2 = new Vector2(num7 * 16 + 16 - width / 2, num8 * 16 - height);
						Vector2 vector3 = position - Main.player[target].position;
						if ((vector2 - Main.player[target].position).Length() < vector3.Length())
						{
							if (vector2.X < position.X)
							{
								direction = -1;
							}
							else if (vector2.X > position.X)
							{
								direction = 1;
							}
							position = vector2;
							netUpdate = true;
							break;
						}
					}
				}
			}
			return;
		}
		immortal = false;
		dontTakeDamage = false;
		bool flag2 = false;
		if (localAI[2] == 0f)
		{
			localAI[2] = 1f;
			SoundEngine.PlaySound(SoundID.StatueMimicScare, base.Center);
		}
		if (velocity.Y > 0f && base.Top.Y > Main.player[target].Bottom.Y)
		{
			if (Collision.SolidCollision(position, width, height))
			{
				flag2 = true;
				SoundEngine.PlaySound(SoundID.StatueMimicJump, base.Center);
				if (!((base.Center - Main.player[target].Center).Length() > 480f))
				{
				}
			}
		}
		else if (velocity.Y == 0f)
		{
			int num9 = 20;
			if (ai[2] == (float)num9)
			{
				SoundEngine.PlaySound(SoundID.StatueMimicJump, base.Center);
			}
			velocity.X = 0f;
			ai[2] -= 1f;
			if (ai[2] <= 0f)
			{
				ai[2] = num9;
				flag2 = true;
				netUpdate = true;
			}
		}
		bool flag3 = false;
		if (base.Right.X >= Main.player[target].Left.X && base.Left.X <= Main.player[target].Right.X)
		{
			if (base.Bottom.Y < Main.player[target].Top.Y)
			{
				velocity.X *= 0.75f;
				if (velocity.Y < 0f)
				{
					velocity.Y *= 0.75f;
				}
			}
			flag3 = true;
		}
		if (Main.player[target].dead)
		{
			if (ai[3] == 0f)
			{
				SoundEngine.PlaySound(SoundID.StatueMimicLaugh, base.Center);
				ai[3] = 300f;
			}
			if (ai[3] > 200f)
			{
				flag3 = true;
				ai[3] -= 1f;
			}
		}
		else if (ai[3] > 0f)
		{
			ai[3] -= 1f;
		}
		if (flag2)
		{
			noTileCollide = true;
			TargetClosest();
			float num10 = (base.Bottom.Y - Main.player[target].Bottom.Y) / 40f;
			num10 = ((!Main.player[target].dead) ? Utils.Clamp(num10, 0f, 10f) : 0f);
			velocity.Y = -9.01f - num10;
			float num11 = Math.Abs(base.Center.X - Main.player[target].Center.X) / 50f;
			if (num11 > 12f)
			{
				num11 = 12f;
			}
			velocity.X = (4f + num11) * (float)direction;
			netUpdate = true;
		}
		else
		{
			if (velocity.Y == 0f)
			{
				return;
			}
			if (Main.player[target].dead && flag3 && base.Bottom.Y < Main.player[target].Bottom.Y)
			{
				velocity.Y = 16f;
			}
			else if (flag3 && base.Bottom.Y < Main.player[target].Top.Y)
			{
				velocity.Y = 16f;
			}
			else
			{
				if (velocity.Y > 0f)
				{
					velocity.Y += gravity;
				}
				if (!Main.player[target].dead)
				{
					if (direction > 0 && base.Center.X > Main.player[target].Center.X)
					{
						velocity *= 0.96f;
					}
					if (direction < 0 && base.Center.X < Main.player[target].Center.X)
					{
						velocity *= 0.96f;
					}
				}
			}
			if (velocity.Y < 0f)
			{
				noTileCollide = true;
			}
			else if (flag3 && base.Bottom.Y < Main.player[target].Top.Y)
			{
				noTileCollide = true;
			}
			else if (!Collision.SolidCollision(position, width, height))
			{
				noTileCollide = false;
			}
		}
	}

	private void AI_124_ElderSlimeChest()
	{
		velocity.Y += 0.2f;
	}

	private void AI_125_ClumsySlimeBalloon()
	{
		if (localAI[0] == 0f && Main.netMode != 1)
		{
			TargetClosest();
			localAI[0] = 1f;
			netUpdate = true;
		}
		spriteDirection = direction;
		rotation = velocity.X * 0.05f;
		NPCAimedTarget targetData = GetTargetData();
		float num = float.PositiveInfinity;
		int num2 = 0;
		Vector2 zero = Vector2.Zero;
		if (!targetData.Invalid)
		{
			zero = targetData.Center - base.Bottom;
			if (zero.Y < 0f)
			{
				num2 = (int)zero.Y / -16;
			}
			num = zero.Length();
			if (direction != Math.Sign(zero.X))
			{
				num2 = 0;
			}
		}
		if (wet || collideX || (collideY && oldVelocity.Y < 0f))
		{
			float num3 = oldVelocity.X + (float)(direction * 8);
			position.X -= num3;
			TargetClosest(faceTarget: false);
			direction *= -1;
			velocity.X = direction * 2;
			life = -1;
			HitEffect();
			active = false;
			netUpdate = true;
			SoundEngine.PlaySound(DeathSound, position);
			return;
		}
		if (collideY)
		{
			velocity.Y = ((oldVelocity.Y > 0f) ? 1 : (-1));
			TargetClosest(faceTarget: false);
		}
		float num4 = 3f + Math.Abs(Main.windSpeedTarget) * 2f;
		if (Math.Sign(velocity.X) != direction || Math.Abs(velocity.X) < num4)
		{
			velocity.X += (float)direction * 0.04f;
			if (velocity.X * (float)direction < 0f)
			{
				if (Math.Abs(velocity.X) > num4)
				{
					velocity.X += (float)direction * 0.15f;
				}
				else
				{
					velocity.X += (float)direction * 0.1f;
				}
			}
			else if (Math.Abs(velocity.X) > num4)
			{
				velocity.X = (float)direction * num4;
			}
		}
		int num5 = (int)((position.X + (float)(width / 2)) / 16f) + direction;
		int num6 = (int)((position.Y + (float)height) / 16f);
		bool flag = true;
		int num7 = 8 + num2;
		bool flag2 = false;
		for (int i = num6; i < num6 + num7; i++)
		{
			if (Main.tile[num5, i] == null)
			{
				Main.tile[num5, i] = new Tile();
			}
			if ((Main.tile[num5, i].nactive() && Main.tileSolid[Main.tile[num5, i].type]) || Main.tile[num5, i].liquid > 0)
			{
				if (i < num6 + 5 + num2)
				{
					flag2 = true;
				}
				flag = false;
				break;
			}
		}
		if (num < 400f && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
		{
			float num8 = 2f;
			float num9 = 0.035f;
			if (base.Center.Y + (float)(height / 4) > Main.player[target].position.Y + (float)(Main.player[target].height / 4) && velocity.Y > 0f - num8)
			{
				velocity.Y -= num9;
				if (velocity.Y > 0f)
				{
					velocity.Y -= num9;
				}
			}
			else if (base.Center.Y + (float)(height / 4) < Main.player[target].position.Y + (float)(Main.player[target].height / 4) && velocity.Y < num8)
			{
				velocity.Y += num9;
				if (velocity.Y < 0f)
				{
					velocity.Y += num9;
				}
			}
		}
		else
		{
			if (flag)
			{
				velocity.Y += 0.05f;
			}
			else
			{
				velocity.Y -= 0.1f;
			}
			if (flag2)
			{
				velocity.Y -= 0.2f;
			}
			if (velocity.Y > 2f)
			{
				velocity.Y = 2f;
			}
			if (velocity.Y < -4f)
			{
				velocity.Y = -4f;
			}
		}
	}

	private void SpawnStardustMark_StardustTower()
	{
		List<int> list = new List<int>();
		if (CountNPCS(405) + CountNPCS(406) < 2)
		{
			list.Add(405);
		}
		if (CountNPCS(402) < 2)
		{
			list.Add(402);
		}
		if (CountNPCS(407) < 1)
		{
			list.Add(407);
		}
		if (list.Count > 0)
		{
			int num = Utils.SelectRandom(Main.rand, list.ToArray());
			ai[1] = 30 * Main.rand.Next(5, 16);
			int num2 = Main.rand.Next(3, 6);
			int num3 = Main.rand.Next(0, 4);
			int num4 = 0;
			List<Tuple<Vector2, int, int>> list2 = new List<Tuple<Vector2, int, int>>();
			List<Vector2> list3 = new List<Vector2>();
			list2.Add(Tuple.Create(base.Top - Vector2.UnitY * 120f, num2, 0));
			int num5 = 0;
			int num6 = list2.Count;
			while (list2.Count > 0)
			{
				Vector2 item = list2[0].Item1;
				int num7 = 1;
				int num8 = 1;
				if (num5 > 0 && num3 > 0 && (Main.rand.Next(3) != 0 || num5 == 1))
				{
					num8 = Main.rand.Next(Math.Max(1, list2[0].Item2));
					num7++;
					num3--;
				}
				for (int i = 0; i < num7; i++)
				{
					int num9 = list2[0].Item3;
					if (num5 == 0)
					{
						num9 = Utils.SelectRandom<int>(Main.rand, -1, 1);
					}
					else if (i == 1)
					{
						num9 *= -1;
					}
					float num10 = ((num5 % 2 == 0) ? 0f : ((float)Math.PI)) + (0.5f - Main.rand.NextFloat()) * ((float)Math.PI / 4f) + (float)num9 * ((float)Math.PI / 4f) * (float)(num5 % 2 == 0).ToDirectionInt();
					float num11 = 100f + 50f * Main.rand.NextFloat();
					int num12 = list2[0].Item2;
					if (i != 0)
					{
						num12 = num8;
					}
					if (num5 == 0)
					{
						num10 = (0.5f - Main.rand.NextFloat()) * ((float)Math.PI / 4f);
						num11 = 100f + 100f * Main.rand.NextFloat();
					}
					Vector2 vector = (-Vector2.UnitY).RotatedBy(num10) * num11;
					if (num12 - 1 < 0)
					{
						vector = Vector2.Zero;
					}
					num4 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), item.X, item.Y, vector.X, vector.Y, 540, 0, 0f, Main.myPlayer, (float)(-num5) * 10f, 0.5f + Main.rand.NextFloat() * 0.5f);
					list3.Add(item + vector);
					if (num5 < num2 && list2[0].Item2 > 0)
					{
						list2.Add(Tuple.Create(item + vector, num12 - 1, num9));
					}
				}
				list2.Remove(list2[0]);
				if (--num6 == 0)
				{
					num6 = list2.Count;
					num5++;
				}
			}
			Main.projectile[num4].localAI[0] = num;
		}
		else
		{
			ai[1] = 30f;
		}
	}

	private void SpawnStardustMark_StardustWorm()
	{
		List<int> list = new List<int>();
		if (CountNPCS(405) + CountNPCS(406) < 2)
		{
			list.Add(405);
		}
		if (CountNPCS(402) < 3)
		{
			list.Add(402);
		}
		if (CountNPCS(407) < 1)
		{
			list.Add(407);
		}
		if (list.Count <= 0)
		{
			return;
		}
		int num = Utils.SelectRandom(Main.rand, list.ToArray());
		int num2 = Main.rand.Next(3, 6);
		int num3 = Main.rand.Next(0, 4);
		int num4 = 0;
		List<Tuple<Vector2, int, int>> list2 = new List<Tuple<Vector2, int, int>>();
		List<Vector2> list3 = new List<Vector2>();
		list2.Add(Tuple.Create(base.Center, num2, 0));
		int num5 = 0;
		int num6 = list2.Count;
		while (list2.Count > 0)
		{
			Vector2 item = list2[0].Item1;
			int num7 = 1;
			int num8 = 1;
			if (num5 > 0 && num3 > 0 && (Main.rand.Next(3) != 0 || num5 == 1))
			{
				num8 = Main.rand.Next(Math.Max(1, list2[0].Item2));
				num7++;
				num3--;
			}
			for (int i = 0; i < num7; i++)
			{
				int num9 = list2[0].Item3;
				if (num5 == 0)
				{
					num9 = Utils.SelectRandom<int>(Main.rand, -1, 1);
				}
				else if (i == 1)
				{
					num9 *= -1;
				}
				float num10 = ((num5 % 2 == 0) ? 0f : ((float)Math.PI)) + (0.5f - Main.rand.NextFloat()) * ((float)Math.PI / 4f) + (float)num9 * ((float)Math.PI / 4f) * (float)(num5 % 2 == 0).ToDirectionInt();
				float num11 = 100f + 50f * Main.rand.NextFloat();
				int num12 = list2[0].Item2;
				if (i != 0)
				{
					num12 = num8;
				}
				if (num5 == 0)
				{
					num10 = (0.5f - Main.rand.NextFloat()) * ((float)Math.PI / 4f);
					num11 = 100f + 100f * Main.rand.NextFloat();
				}
				Vector2 vector = (-Vector2.UnitY).RotatedBy(num10) * num11;
				if (num12 - 1 < 0)
				{
					vector = Vector2.Zero;
				}
				num4 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), item.X, item.Y, vector.X, vector.Y, 540, 0, 0f, Main.myPlayer, (float)(-num5) * 10f, 0.5f + Main.rand.NextFloat() * 0.5f);
				list3.Add(item + vector);
				if (num5 < num2 && list2[0].Item2 > 0)
				{
					list2.Add(Tuple.Create(item + vector, num12 - 1, num9));
				}
			}
			list2.Remove(list2[0]);
			if (--num6 == 0)
			{
				num6 = list2.Count;
				num5++;
			}
		}
		Main.projectile[num4].localAI[0] = num;
	}

	public static bool IsDeerclopsHostile()
	{
		if (deerclopsBoss == -1)
		{
			return false;
		}
		NPC nPC = Main.npc[deerclopsBoss];
		if (!nPC.active || nPC.type != 668)
		{
			return false;
		}
		int num = (int)nPC.ai[0];
		if (num == 6 || num == 7 || num == 8)
		{
			Rectangle rectangle = new Rectangle((int)Main.screenPosition.X, (int)Main.screenPosition.Y, Main.screenWidth, Main.screenHeight);
			rectangle.Inflate(960, 960);
			if (!nPC.Hitbox.Intersects(rectangle))
			{
				return false;
			}
		}
		return true;
	}

	private void AI_123_Deerclops()
	{
		deerclopsBoss = whoAmI;
		int num = 15;
		NPCAimedTarget targetData = GetTargetData();
		bool haltMovement = false;
		bool goHome = false;
		bool flag = Distance(targetData.Center) >= 450f;
		localAI[3] = MathHelper.Clamp(localAI[3] + (float)flag.ToDirectionInt(), 0f, 30f);
		dontTakeDamage = localAI[3] >= 30f;
		float lifePercent = (float)life / (float)lifeMax;
		bool expertMode = Main.expertMode;
		int shadowHandDamage = 10;
		float num2 = Utils.Remap(localAI[3], 0f, 30f, 0f, 1f);
		if (num2 > 0f)
		{
			float num3 = Main.rand.NextFloat() * num2 * 3f;
			while (num3 > 0f)
			{
				num3 -= 1f;
				Dust.NewDustDirect(position, width, height, 109, 0f, -3f, 0, default(Color), 1.4f).noGravity = true;
			}
		}
		if (homeTileX == -1 && homeTileY == -1)
		{
			Point point = base.Bottom.ToTileCoordinates();
			homeTileX = point.X;
			homeTileY = point.Y;
			this.ai[2] = homeTileX;
			this.ai[3] = homeTileY;
			netUpdate = true;
			timeLeft = 86400;
		}
		timeLeft -= Main.dayRate;
		if (timeLeft < 0)
		{
			timeLeft = 0;
		}
		homeTileX = (int)this.ai[2];
		homeTileY = (int)this.ai[3];
		if (!expertMode)
		{
			localAI[2] = 0f;
		}
		if (expertMode && Main.netMode != 1)
		{
			SpawnPassiveShadowHands(lifePercent, shadowHandDamage);
		}
		switch ((int)this.ai[0])
		{
		case -1:
			localAI[3] = -10f;
			break;
		case 6:
		{
			TargetClosest(faceTarget: false);
			targetData = GetTargetData();
			if (Main.netMode != 1)
			{
				if (!ShouldRunAway(ref targetData, isChasing: false))
				{
					this.ai[0] = 0f;
					this.ai[1] = 0f;
					localAI[1] = 0f;
					netUpdate = true;
					break;
				}
				if (timeLeft <= 0)
				{
					this.ai[0] = 8f;
					this.ai[1] = 0f;
					localAI[1] = 0f;
					netUpdate = true;
					break;
				}
			}
			if (direction != oldDirection)
			{
				netUpdate = true;
			}
			goHome = true;
			this.ai[1] += 1f;
			Vector2 other = new Vector2(homeTileX * 16, homeTileY * 16);
			bool flag2 = base.Top.Y > other.Y + 1600f;
			bool num4 = Distance(other) < 1020f;
			Distance(targetData.Center);
			float num5 = this.ai[1] % 600f;
			if (num4 && num5 < 420f)
			{
				haltMovement = true;
			}
			bool flag3 = false;
			int num6 = 300;
			if (flag2 && this.ai[1] >= (float)num6)
			{
				flag3 = true;
			}
			int num7 = 1500;
			if (!num4 && this.ai[1] >= (float)num7)
			{
				flag3 = true;
			}
			if (flag3)
			{
				this.ai[0] = 7f;
				this.ai[1] = 0f;
				localAI[1] = 0f;
				netUpdate = true;
			}
			break;
		}
		case 0:
		{
			TargetClosest();
			targetData = GetTargetData();
			if (ShouldRunAway(ref targetData, isChasing: true))
			{
				this.ai[0] = 6f;
				this.ai[1] = 0f;
				localAI[1] = 0f;
				netUpdate = true;
				break;
			}
			this.ai[1] += 1f;
			Vector2 vector = base.Bottom + new Vector2(0f, -32f);
			Vector2 vector2 = targetData.Hitbox.ClosestPointInRect(vector);
			Vector2 vector3 = vector2 - vector;
			(vector2 - base.Center).Length();
			float num15 = 0.6f;
			bool flag4 = Math.Abs(vector3.X) >= Math.Abs(vector3.Y) * num15 || vector3.Length() < 48f;
			bool flag5 = vector3.Y <= (float)(100 + targetData.Height) && vector3.Y >= -200f;
			if (Math.Abs(vector3.X) < 120f && flag5 && velocity.Y == 0f && localAI[1] >= 2f)
			{
				velocity.X = 0f;
				this.ai[0] = 4f;
				this.ai[1] = 0f;
				localAI[1] = 0f;
				netUpdate = true;
				break;
			}
			if (Math.Abs(vector3.X) < 120f && flag5 && velocity.Y == 0f && flag4)
			{
				velocity.X = 0f;
				this.ai[0] = 1f;
				this.ai[1] = 0f;
				localAI[1] += 1f;
				netUpdate = true;
				break;
			}
			bool flag6 = this.ai[1] >= 240f;
			if (velocity.Y == 0f && velocity.X != 0f && flag6)
			{
				velocity.X = 0f;
				this.ai[0] = 2f;
				this.ai[1] = 0f;
				localAI[1] = 0f;
				netUpdate = true;
				break;
			}
			bool flag7 = this.ai[1] >= 90f;
			if (velocity.Y == 0f && velocity.X == 0f && flag7)
			{
				velocity.X = 0f;
				this.ai[0] = 5f;
				this.ai[1] = 0f;
				localAI[1] = 0f;
				netUpdate = true;
				break;
			}
			bool flag8 = this.ai[1] >= 120f;
			int num16 = 32;
			bool flag9 = targetData.Type == NPCTargetType.Player && !Main.player[target].buffImmune[num16] && Main.player[target].FindBuffIndex(num16) == -1;
			if (velocity.Y == 0f && flag8 && flag9 && Math.Abs(vector3.X) > 100f)
			{
				velocity.X = 0f;
				this.ai[0] = 3f;
				this.ai[1] = 0f;
				localAI[1] = 0f;
				netUpdate = true;
			}
			break;
		}
		case 1:
			this.ai[1] += 1f;
			haltMovement = true;
			AI_123_Deerclops_MakeSpikesForward(1, targetData);
			if (this.ai[1] >= 80f)
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			break;
		case 4:
			this.ai[1] += 1f;
			haltMovement = true;
			TargetClosest();
			AI_123_Deerclops_MakeSpikesBothSides(1, targetData);
			if (this.ai[1] >= 90f)
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			break;
		case 2:
		{
			int num8 = 4;
			int num9 = 8 * num8;
			this.ai[1] += 1f;
			if (this.ai[1] == (float)(num9 - 20))
			{
				SoundEngine.PlaySound(SoundID.DeerclopsScream, base.Center);
			}
			if (this.ai[1] == (float)num9)
			{
				SoundEngine.PlaySound(SoundID.DeerclopsRubbleAttack, base.Center);
			}
			haltMovement = true;
			if (Main.netMode != 1 && this.ai[1] >= (float)num9)
			{
				Point sourceTileCoords = base.Top.ToTileCoordinates();
				int num10 = 20;
				int distancedByThisManyTiles = 1;
				float upBiasPerSpike = 200f;
				sourceTileCoords.X += direction * 3;
				sourceTileCoords.Y -= 10;
				int num11 = (int)this.ai[1] - num9;
				if (num11 == 0)
				{
					PunchCameraModifier modifier4 = new PunchCameraModifier(base.Center, new Vector2(0f, -1f), 20f, 6f, 30, 1000f, "Deerclops");
					Main.instance.CameraModifiers.Add(modifier4);
				}
				int num12 = 1;
				int num13 = num11 / num12 * num12;
				int num14 = num13 + num12;
				if (num11 % num12 != 0)
				{
					num14 = num13;
				}
				for (int j = num13; j < num14 && j < num10; j++)
				{
					AI_123_Deerclops_ShootRubbleUp(ref targetData, ref sourceTileCoords, num10, distancedByThisManyTiles, upBiasPerSpike, j);
				}
			}
			if (this.ai[1] >= 60f)
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			break;
		}
		case 3:
			if (this.ai[1] == 30f)
			{
				SoundEngine.PlaySound(SoundID.DeerclopsScream, base.Center);
			}
			this.ai[1] += 1f;
			haltMovement = true;
			if ((int)this.ai[1] % 4 == 0 && this.ai[1] >= 28f)
			{
				PunchCameraModifier modifier5 = new PunchCameraModifier(base.Center, (Main.rand.NextFloat() * ((float)Math.PI * 2f)).ToRotationVector2(), 20f, 6f, 20, 1000f, "Deerclops");
				Main.instance.CameraModifiers.Add(modifier5);
				if (Main.netMode != 2)
				{
					Player player = Main.player[Main.myPlayer];
					_ = Main.myPlayer;
					int num17 = 32;
					int time = 720;
					if (!player.dead && player.active && player.FindBuffIndex(num17) == -1 && (player.Center - base.Center).Length() < 800f && !player.creativeGodMode)
					{
						player.AddBuff(num17, time);
					}
				}
			}
			if (this.ai[1] == 30f)
			{
				TargetClosest();
			}
			if (this.ai[1] >= 60f)
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			break;
		case 7:
			if (this.ai[1] == 30f)
			{
				SoundEngine.PlaySound(SoundID.DeerclopsScream, base.Center);
			}
			this.ai[1] += 1f;
			haltMovement = true;
			if ((int)this.ai[1] % 4 == 0 && this.ai[1] >= 28f)
			{
				PunchCameraModifier modifier3 = new PunchCameraModifier(base.Center, (Main.rand.NextFloat() * ((float)Math.PI * 2f)).ToRotationVector2(), 20f, 6f, 20, 1000f, "Deerclops");
				Main.instance.CameraModifiers.Add(modifier3);
			}
			if (this.ai[1] == 40f)
			{
				TargetClosest();
				if (Main.netMode != 1)
				{
					netUpdate = true;
					base.Bottom = new Vector2(homeTileX * 16, homeTileY * 16);
				}
			}
			if (this.ai[1] >= 60f)
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			break;
		case 8:
			if (this.ai[1] == 30f)
			{
				SoundEngine.PlaySound(SoundID.DeerclopsScream, base.Center);
			}
			this.ai[1] += 1f;
			haltMovement = true;
			if ((int)this.ai[1] % 4 == 0 && this.ai[1] >= 28f)
			{
				PunchCameraModifier modifier2 = new PunchCameraModifier(base.Center, (Main.rand.NextFloat() * ((float)Math.PI * 2f)).ToRotationVector2(), 20f, 6f, 20, 1000f, "Deerclops");
				Main.instance.CameraModifiers.Add(modifier2);
			}
			if (this.ai[1] >= 40f)
			{
				life = -1;
				HitEffect();
				active = false;
				if (Main.netMode != 1)
				{
					NetMessage.SendData(28, -1, -1, null, whoAmI, -1f);
				}
				return;
			}
			break;
		case 5:
			if (this.ai[1] == 30f)
			{
				SoundEngine.PlaySound(SoundID.DeerclopsScream, base.Center);
			}
			this.ai[1] += 1f;
			haltMovement = true;
			if ((int)this.ai[1] % 4 == 0 && this.ai[1] >= 28f)
			{
				PunchCameraModifier modifier = new PunchCameraModifier(base.Center, (Main.rand.NextFloat() * ((float)Math.PI * 2f)).ToRotationVector2(), 20f, 6f, 20, 1000f, "Deerclops");
				Main.instance.CameraModifiers.Add(modifier);
			}
			if (this.ai[1] == 30f)
			{
				TargetClosest();
				if (Main.netMode != 1)
				{
					for (int i = 0; i < 6; i++)
					{
						Projectile.RandomizeInsanityShadowFor(Main.player[target], isHostile: true, out var spawnposition, out var spawnvelocity, out var ai, out var ai2);
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), spawnposition, spawnvelocity, 965, num, 0f, Main.myPlayer, ai, ai2);
					}
				}
			}
			if (this.ai[1] >= 60f)
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			break;
		}
		AI_123_Deerclops_Movement(haltMovement, goHome);
	}

	private bool ShouldRunAway(ref NPCAimedTarget targetData, bool isChasing)
	{
		if (targetData.Type == NPCTargetType.Player)
		{
			Player player = Main.player[target];
			bool zoneSnow = player.ZoneSnow;
			Vector2 other = new Vector2(homeTileX * 16, homeTileY * 16);
			int num = 480;
			zoneSnow |= player.Distance(other) <= (float)num;
			return (player.dead || (!isChasing && !zoneSnow)) | (Distance(player.Center) >= 2400f);
		}
		if (targetData.Type == NPCTargetType.None)
		{
			return true;
		}
		return false;
	}

	private void SpawnPassiveShadowHands(float lifePercent, int shadowHandDamage)
	{
		int num = (int)Utils.Remap(lifePercent, 1f, 0f, 80f, 40f);
		localAI[2] += 1f;
		int num2 = (int)localAI[2];
		if (num2 % num != 0)
		{
			return;
		}
		int num3 = num2 / num;
		if (num2 / num >= 3)
		{
			localAI[2] = 0f;
		}
		for (int i = 0; i < 255; i++)
		{
			if (Boss_CanShootExtraAt(i, num3 % 3, 3, 1200f, alwaysSkipMainTarget: false))
			{
				Projectile.RandomizeInsanityShadowFor(Main.player[i], isHostile: true, out var spawnposition, out var spawnvelocity, out var ai, out var ai2);
				Projectile.NewProjectile(GetSpawnSource_ForProjectile(), spawnposition, spawnvelocity, 965, shadowHandDamage, 0f, Main.myPlayer, ai, ai2);
			}
		}
	}

	private void AI_123_Deerclops_ShootRubbleUp(ref NPCAimedTarget targetData, ref Point sourceTileCoords, int howMany, int distancedByThisManyTiles, float upBiasPerSpike, int whichOne)
	{
		int num = 18;
		int num2 = whichOne * distancedByThisManyTiles;
		for (int i = 0; i < 35; i++)
		{
			int num3 = sourceTileCoords.X + num2 * direction;
			int num4 = sourceTileCoords.Y + i;
			if (WorldGen.SolidTile(num3, num4))
			{
				Vector2 vector = targetData.Center + new Vector2(num2 * direction * 20, (0f - upBiasPerSpike) * (float)howMany + (float)num2 * upBiasPerSpike / (float)distancedByThisManyTiles);
				Vector2 vector2 = new Vector2(num3 * 16 + 8, num4 * 16 + 8);
				Vector2 vector3 = (vector - vector2).SafeNormalize(-Vector2.UnitY);
				vector3 = new Vector2(0f, -1f).RotatedBy((float)(whichOne * direction) * 0.7f * ((float)Math.PI / 4f / (float)howMany));
				int num5 = Main.rand.Next(Main.projFrames[962] * 4);
				num5 = 6 + Main.rand.Next(6);
				Projectile.NewProjectile(GetSpawnSource_ForProjectile(), new Vector2(num3 * 16 + 8, num4 * 16 - 8), vector3 * (8f + Main.rand.NextFloat() * 8f), 962, num, 0f, Main.myPlayer, 0f, num5);
				break;
			}
		}
	}

	private void AI_123_Deerclops_MakeSpikesForward(int AISLOT_PhaseCounter, NPCAimedTarget targetData)
	{
		int num = 9;
		int num2 = 4;
		if (Main.netMode == 1)
		{
			return;
		}
		int num3 = num * num2;
		if (!(ai[AISLOT_PhaseCounter] < (float)num3))
		{
			Point sourceTileCoords = base.Bottom.ToTileCoordinates();
			int num4 = 20;
			int num5 = 1;
			sourceTileCoords.X += direction * 3;
			int num6 = (int)ai[AISLOT_PhaseCounter] - num3;
			if (num6 == 0)
			{
				PunchCameraModifier modifier = new PunchCameraModifier(base.Center, new Vector2(0f, 1f), 20f, 6f, 30, 1000f, "Deerclops");
				Main.instance.CameraModifiers.Add(modifier);
			}
			int num7 = 4;
			int num8 = num6 / num7 * num7;
			int num9 = num8 + num7;
			if (num6 % num7 != 0)
			{
				num9 = num8;
			}
			for (int i = num8; i < num9 && i < num4; i++)
			{
				int xOffset = i * num5;
				AI_123_Deerclops_TryMakingSpike(ref sourceTileCoords, direction, num4, i, xOffset);
			}
		}
	}

	private void AI_123_Deerclops_MakeSpikesBothSides(int AISLOT_PhaseCounter, NPCAimedTarget targetData)
	{
		if (Main.netMode == 1)
		{
			return;
		}
		int num = 56;
		if (!(ai[AISLOT_PhaseCounter] < (float)num))
		{
			Point sourceTileCoords = base.Bottom.ToTileCoordinates();
			int num2 = 15;
			int num3 = 1;
			int num4 = (int)ai[AISLOT_PhaseCounter] - num;
			if (num4 == 0)
			{
				PunchCameraModifier modifier = new PunchCameraModifier(base.Center, new Vector2(0f, 1f), 20f, 6f, 30, 1000f, "Deerclops");
				Main.instance.CameraModifiers.Add(modifier);
			}
			int num5 = 2;
			int num6 = num4 / num5 * num5;
			int num7 = num6 + num5;
			if (num4 % num5 != 0)
			{
				num7 = num6;
			}
			for (int i = num6; i >= 0 && i < num7 && i < num2; i++)
			{
				int xOffset = i * num3;
				AI_123_Deerclops_TryMakingSpike(ref sourceTileCoords, direction, num2, -i, xOffset);
				AI_123_Deerclops_TryMakingSpike(ref sourceTileCoords, -direction, num2, -i, xOffset);
			}
		}
	}

	public static bool IsADeerclopsNearScreen()
	{
		return npcsFoundForCheckActive[668];
	}

	private void AI_123_Deerclops_FindSpotToSpawnSpike(int howMany, int whichOne, ref int x, ref int y)
	{
		if (WorldGen.ActiveAndWalkableTile(x, y))
		{
			return;
		}
		Rectangle rectangle = targetRect;
		int num = rectangle.Center.X / 16;
		int num2 = (rectangle.Bottom - 16) / 16;
		int num3 = ((num2 - y > 0) ? 1 : (-1));
		int num4 = y;
		for (int i = 1; i <= 10; i++)
		{
			int num5 = y + num3 * i;
			if (num5 >= 20 && num5 <= Main.maxTilesY - 20 && WorldGen.ActiveAndWalkableTile(x, num5))
			{
				num4 = num5;
			}
		}
		if (num4 != y)
		{
			y = num4;
			return;
		}
		y = (int)MathHelper.Lerp(num2, y, (float)Math.Abs(num - x) * 0.1f);
		for (int j = 0; j < 4; j++)
		{
			int num6 = y + j;
			if (num6 >= 20 && num6 <= Main.maxTilesY - 20 && WorldGen.ActiveAndWalkableTile(x, num6))
			{
				y = num6;
				break;
			}
		}
	}

	private void AI_123_Deerclops_TryMakingSpike(ref Point sourceTileCoords, int dir, int howMany, int whichOne, int xOffset)
	{
		int num = 13;
		int num2 = sourceTileCoords.X + xOffset * dir;
		int num3 = AI_123_Deerclops_TryMakingSpike_FindBestY(ref sourceTileCoords, num2);
		if (WorldGen.ActiveAndWalkableTile(num2, num3))
		{
			Vector2 vector = new Vector2(num2 * 16 + 8, num3 * 16 - 8);
			Vector2 vector2 = new Vector2(0f, -1f).RotatedBy((float)(whichOne * dir) * 0.7f * ((float)Math.PI / 4f / (float)howMany));
			Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector, vector2, 961, num, 0f, Main.myPlayer, 0f, 0.1f + Main.rand.NextFloat() * 0.1f + (float)xOffset * 1.1f / (float)howMany);
		}
	}

	private int AI_123_Deerclops_TryMakingSpike_FindBestY(ref Point sourceTileCoords, int x)
	{
		int num = sourceTileCoords.Y;
		NPCAimedTarget targetData = GetTargetData();
		if (!targetData.Invalid)
		{
			Rectangle hitbox = targetData.Hitbox;
			Vector2 vector = new Vector2(hitbox.Center.X, hitbox.Bottom);
			int num2 = (int)(vector.Y / 16f);
			int num3 = Math.Sign(num2 - num);
			int num4 = num2 + num3 * 15;
			int? num5 = null;
			float num6 = float.PositiveInfinity;
			for (int i = num; i != num4; i += num3)
			{
				if (WorldGen.ActiveAndWalkableTile(x, i))
				{
					float num7 = new Point(x, i).ToWorldCoordinates().Distance(vector);
					if (!num5.HasValue || !(num7 >= num6))
					{
						num5 = i;
						num6 = num7;
					}
				}
			}
			if (num5.HasValue)
			{
				num = num5.Value;
			}
		}
		for (int j = 0; j < 20; j++)
		{
			if (num < 10)
			{
				break;
			}
			if (!WorldGen.SolidTile(x, num))
			{
				break;
			}
			num--;
		}
		for (int k = 0; k < 20; k++)
		{
			if (num > Main.maxTilesY - 10)
			{
				break;
			}
			if (WorldGen.ActiveAndWalkableTile(x, num))
			{
				break;
			}
			num++;
		}
		return num;
	}

	private void AI_123_Deerclops_Movement(bool haltMovement, bool goHome)
	{
		float num = (float)life / (float)lifeMax;
		float num2 = 1f - num;
		float num3 = 3.5f + 1f * num2;
		float num4 = 4f;
		float num5 = -0.4f;
		float min = -8f;
		float num6 = 0.4f;
		Rectangle rectangle = GetTargetData().Hitbox;
		if (goHome)
		{
			rectangle = new Rectangle(homeTileX * 16, homeTileY * 16, 16, 16);
			if (Distance(rectangle.Center.ToVector2()) < 240f)
			{
				rectangle.X = (int)(base.Center.X + (float)(160 * direction));
			}
		}
		float num7 = (float)rectangle.Center.X - base.Center.X;
		float num8 = Math.Abs(num7);
		if (goHome && num7 != 0f)
		{
			direction = (spriteDirection = Math.Sign(num7));
		}
		bool flag = num8 < 80f;
		bool flag2 = flag || haltMovement;
		if (ai[0] == -1f)
		{
			num7 = 5f;
			num3 = 5.35f;
			flag2 = false;
		}
		if (flag2)
		{
			velocity.X *= 0.9f;
			if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
			{
				velocity.X = 0f;
			}
		}
		else
		{
			int num9 = Math.Sign(num7);
			velocity.X = MathHelper.Lerp(velocity.X, (float)num9 * num3, 1f / num4);
		}
		int num10 = 40;
		int num11 = 20;
		int num12 = 0;
		Vector2 vector = new Vector2(base.Center.X - (float)(num10 / 2), position.Y + (float)height - (float)num11 + (float)num12);
		bool num13 = vector.X < (float)rectangle.X && vector.X + (float)width > (float)(rectangle.X + rectangle.Width);
		bool flag3 = vector.Y + (float)num11 < (float)(rectangle.Y + rectangle.Height - 16);
		bool flag4 = ai[0] == 7f;
		bool acceptTopSurfaces = base.Bottom.Y >= (float)rectangle.Top && !flag4;
		bool flag5 = Collision.SolidCollision(vector, num10, num11, acceptTopSurfaces);
		bool flag6 = Collision.SolidCollision(vector, num10, num11 - 4, acceptTopSurfaces);
		bool flag7 = !Collision.SolidCollision(vector + new Vector2(num10 * direction, 0f), 16, 80, acceptTopSurfaces);
		float num14 = 8f;
		if (flag5 || flag6)
		{
			localAI[0] = 0f;
		}
		if (flag4)
		{
			velocity.Y = -0.1f;
		}
		if ((num13 || flag) && flag3)
		{
			velocity.Y = MathHelper.Clamp(velocity.Y + num6 * 2f, 0.001f, 16f);
		}
		else if (flag5 && !flag6)
		{
			velocity.Y = 0f;
		}
		else if (flag5)
		{
			velocity.Y = MathHelper.Clamp(velocity.Y + num5, min, 0f);
		}
		else if (velocity.Y == 0f && flag7)
		{
			velocity.Y = 0f - num14;
			localAI[0] = 1f;
		}
		else
		{
			velocity.Y = MathHelper.Clamp(velocity.Y + num6, 0f - num14, 16f);
		}
	}

	private void AI_124_DeerclopsLeg()
	{
		int num = (int)ai[0];
		if (num < 0 || num > Main.maxNPCs)
		{
			active = false;
			if (Main.netMode != 1)
			{
				NetMessage.SendData(23, -1, -1, null, whoAmI);
			}
			return;
		}
		NPC nPC = Main.npc[num];
		if (!nPC.active || nPC.type != 668)
		{
			active = false;
			if (Main.netMode != 1)
			{
				NetMessage.SendData(23, -1, -1, null, whoAmI);
			}
			return;
		}
		NPCAimedTarget targetData = nPC.GetTargetData();
		Vector2 vector = targetData.Center - base.Center;
		float num2 = targetData.Center.X - (float)(width / 2);
		int num3 = Math.Sign(num2 - position.X);
		float val = Math.Abs(num2 - position.X);
		float num4 = Math.Min(50f, val);
		float num5 = num2 + (float)(-num3) * num4;
		Math.Abs(vector.X);
		if (Math.Abs(num5 - base.Center.X) >= 30f && localAI[0] == 0f)
		{
			localAI[0] = 1f;
		}
		float num6 = 4f;
		float num7 = 30f;
		if (localAI[0] < 0f)
		{
			localAI[0] += 1f;
		}
		if (localAI[0] > 0f)
		{
			localAI[0] += 1f;
			if (localAI[0] >= num7)
			{
				localAI[0] = 0f - num6;
			}
		}
		int num8 = ((ai[1] != 0f) ? 1 : (-1));
		if (localAI[0] > 0f)
		{
			Vector2 vector2 = new Vector2(num8 * 14, -20f);
			Vector2 searchStartPositionInWorld = nPC.Bottom + vector2 + new Vector2(0f, 30f);
			int searchRange = 16;
			int tilesTraveled = 0;
			float? num9 = TryFindingFloor(searchStartPositionInWorld, searchRange, out tilesTraveled);
			float amount = 1f / 3f;
			Vector2 value = new Vector2(searchStartPositionInWorld.X, searchStartPositionInWorld.Y + 100f);
			float num10 = localAI[0] / num7;
			if (num9.HasValue && tilesTraveled > 2)
			{
				new Vector2(searchStartPositionInWorld.X, num9.Value * 16f);
				value = new Vector2(searchStartPositionInWorld.X, num9.Value * 16f);
				amount = num10;
			}
			value.Y -= (1f - num10) * 30f;
			Vector2 bottom = Vector2.Lerp(base.Bottom, value, amount);
			base.Bottom = bottom;
		}
		int num11 = num8;
		if (Math.Abs(vector.X) > 30f)
		{
			num11 = Math.Sign(vector.X);
		}
		spriteDirection = -num11;
	}

	private static float? TryFindingFloor(Vector2 searchStartPositionInWorld, int searchRange, out int tilesTraveled)
	{
		Point point = searchStartPositionInWorld.ToTileCoordinates();
		int x = point.X;
		for (int i = point.Y; i < point.Y + searchRange; i++)
		{
			if (Main.tile[x, i] == null)
			{
				Main.tile[x, i] = new Tile();
			}
			if (Main.tile[x, i].nactive() && Main.tileSolid[Main.tile[x, i].type])
			{
				tilesTraveled = i - point.Y;
				return i;
			}
		}
		tilesTraveled = 0;
		return null;
	}

	private void AI_87_BigMimic_FireStuffCannonBurst()
	{
		int num = 10;
		for (int i = 0; i < num; i++)
		{
			int itemID = ItemID.Sets.ItemsForStuffCannon[Main.rand.Next(ItemID.Sets.ItemsForStuffCannon.Length)];
			AI_87_BigMimic_ShootItem(itemID);
		}
	}

	private void AI_87_BigMimic_ShootItem(int itemID)
	{
		int num = Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, itemID, 1, noBroadcast: false, -1, noGrabDelay: true);
		float num2 = Main.rand.Next(10, 26);
		Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
		Vector2 vector2 = Main.player[target].Center - new Vector2(0f, 120f);
		float num3 = vector2.X - vector.X;
		float num4 = vector2.Y - vector.Y;
		num3 += (float)Main.rand.Next(-50, 51) * 0.1f;
		num4 += (float)Main.rand.Next(-50, 51) * 0.1f;
		float num5 = (float)Math.Sqrt(num3 * num3 + num4 * num4);
		num5 = num2 / num5;
		num3 *= num5;
		num4 *= num5;
		num3 += (float)Main.rand.Next(-50, 51) * 0.1f;
		num4 += (float)Main.rand.Next(-50, 51) * 0.1f;
		Main.item[num].velocity.X = num3;
		Main.item[num].velocity.Y = num4;
		Main.item[num].noGrabDelay = 100;
		if (Main.netMode != 0)
		{
			NetMessage.SendData(21, -1, -1, null, num);
		}
	}

	public void AI_122_PirateGhost()
	{
		if (localAI[0] == 0f)
		{
			localAI[0] = 1f;
			SoundEngine.PlaySound(SoundID.NPCHit6, position);
		}
		NPCAimedTarget targetData = GetTargetData();
		if (targetData.Invalid)
		{
			TargetClosest();
			targetData = GetTargetData();
		}
		if (targetData.Invalid)
		{
			velocity *= 0.9f;
			alpha = Utils.Clamp(alpha + 5, 0, 255);
			if (alpha >= 255)
			{
				StrikeNPCNoInteraction(9999, 0f, 0);
			}
			return;
		}
		alpha = Utils.Clamp(alpha - 5, 0, 255);
		Vector2 targetPosition = Vector2.Zero.MoveTowards(targetData.Center - base.Center, 4f);
		velocity = velocity.MoveTowards(targetPosition, 2f / 15f);
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (Main.npc[i].active && Main.npc[i].type == type && i != whoAmI)
			{
				Vector2 vector = Main.npc[i].Center - base.Center;
				if (vector.Length() < 50f)
				{
					vector.Normalize();
					vector *= 0.1f;
					velocity -= vector;
					velocity.X -= vector.X * 1f;
				}
			}
		}
	}

	public void AI_000_TransformBoundNPC(int playerID, int npcType)
	{
		Transform(npcType);
		AI_007_TownEntities_UpdateSavedStates();
		Main.BestiaryTracker.Chats.RegisterChatStartWith(this);
		Main.player[playerID].SetTalkNPC(whoAmI);
		if (Main.netMode == 2)
		{
			NetMessage.SendData(40, -1, -1, null, playerID);
		}
	}

	private void AI_065_Butterflies()
	{
		float num = ai[0];
		float num2 = ai[1];
		if (type == 661)
		{
			Vector3 rgb = Main.hslToRgb(Main.GlobalTimeWrappedHourly * 0.33f % 1f, 1f, 0.5f).ToVector3() * 0.3f;
			rgb += Vector3.One * 0.1f;
			Lighting.AddLight(base.Center, rgb);
			int num3 = 60;
			bool flag = false;
			int num4 = 50;
			NPCAimedTarget targetData = GetTargetData();
			if (targetData.Invalid || targetData.Center.Distance(base.Center) >= 300f)
			{
				flag = true;
			}
			if (!Main.remixWorld && !targetData.Invalid && targetData.Type == NPCTargetType.Player && !Main.player[target].ZoneHallow)
			{
				num4 = num3;
				flag = true;
			}
			ai[2] = MathHelper.Clamp(ai[2] + (float)flag.ToDirectionInt(), 0f, num4);
			if (ai[2] >= (float)num3)
			{
				active = false;
				if (Main.netMode != 1)
				{
					NetMessage.SendData(23, -1, -1, null, whoAmI);
				}
				return;
			}
			Opacity = Utils.GetLerpValue(num3, (float)num4 / 2f, ai[2], clamped: true);
			if (ai[2] > 0f)
			{
				int num5 = 1;
				for (int i = 0; i < num5; i++)
				{
					if (Main.rand.Next(5) == 0)
					{
						float num6 = MathHelper.Lerp(0.9f, 0.6f, Opacity);
						Color newColor = Main.hslToRgb(Main.GlobalTimeWrappedHourly * 0.3f % 1f, 1f, 0.5f) * 0.5f;
						int num7 = Dust.NewDust(position, width, height, 267, 0f, 0f, 0, newColor);
						Main.dust[num7].position = base.Center + Main.rand.NextVector2Circular(width, height);
						Main.dust[num7].velocity *= Main.rand.NextFloat() * 0.8f;
						Main.dust[num7].velocity += velocity * 0.6f;
						Main.dust[num7].noGravity = true;
						Main.dust[num7].fadeIn = 0.6f + Main.rand.NextFloat() * 0.7f * num6;
						Main.dust[num7].scale = 0.35f;
						if (num7 != 6000)
						{
							Dust dust = Dust.CloneDust(num7);
							dust.scale /= 2f;
							dust.fadeIn *= 0.85f;
							dust.color = new Color(255, 255, 255, 255) * 0.5f;
						}
					}
				}
			}
			dontTakeDamage = ai[2] >= (float)(num4 / 2);
		}
		if (Main.netMode != 1)
		{
			if (ai[2] == 0f && type != 661)
			{
				int num8 = 0;
				int num9 = 4;
				int num10 = 6;
				int num11 = 3;
				int num12 = 7;
				int num13 = 2;
				int num14 = 1;
				int num15 = 5;
				int num16 = Main.rand.Next(100);
				num16 = ((num16 == 0) ? num15 : ((num16 < 3) ? num14 : ((num16 < 9) ? num13 : ((num16 < 19) ? num12 : ((num16 < 34) ? num11 : ((num16 < 53) ? num10 : ((num16 >= 75) ? num8 : num9)))))));
				ai[2] = 1 + num16;
			}
			if (ai[3] == 0f)
			{
				ai[3] = (float)Main.rand.Next(75, 111) * 0.01f;
			}
			localAI[0] -= 1f;
			if (localAI[0] <= 0f)
			{
				localAI[0] = Main.rand.Next(90, 240);
				TargetClosest();
				float num17 = Math.Abs(base.Center.X - Main.player[target].Center.X);
				if (num17 > 700f && localAI[3] == 0f)
				{
					float num18 = (float)Main.rand.Next(50, 151) * 0.01f;
					if (num17 > 1000f)
					{
						num18 = (float)Main.rand.Next(150, 201) * 0.01f;
					}
					else if (num17 > 850f)
					{
						num18 = (float)Main.rand.Next(100, 151) * 0.01f;
					}
					int num19 = direction * Main.rand.Next(100, 251);
					int num20 = Main.rand.Next(-50, 51);
					if (position.Y > Main.player[target].position.Y - 100f)
					{
						num20 -= Main.rand.Next(100, 251);
					}
					float num21 = num18 / (float)Math.Sqrt(num19 * num19 + num20 * num20);
					num = (float)num19 * num21;
					num2 = (float)num20 * num21;
				}
				else
				{
					localAI[3] = 1f;
					float num22 = (float)Main.rand.Next(26, 301) * 0.01f;
					int num23 = Main.rand.Next(-100, 101);
					int num24 = Main.rand.Next(-100, 101);
					float num25 = num22 / (float)Math.Sqrt(num23 * num23 + num24 * num24);
					num = (float)num23 * num25;
					num2 = (float)num24 * num25;
				}
				netUpdate = true;
			}
		}
		scale = ai[3];
		int num26 = 60;
		velocity.X = (velocity.X * (float)(num26 - 1) + num) / (float)num26;
		velocity.Y = (velocity.Y * (float)(num26 - 1) + num2) / (float)num26;
		if (velocity.Y > 0f)
		{
			int num27 = 3;
			int num28 = (int)base.Center.X / 16;
			int num29 = (int)base.Center.Y / 16;
			for (int j = num29; j < num29 + num27; j++)
			{
				if (Main.tile[num28, j] != null && ((Main.tile[num28, j].nactive() && Main.tileSolid[Main.tile[num28, j].type]) || Main.tile[num28, j].liquid > 0))
				{
					num2 *= -1f;
					if (velocity.Y > 0f)
					{
						velocity.Y *= 0.9f;
					}
				}
			}
		}
		if (velocity.Y < 0f)
		{
			int num30 = 30;
			bool flag2 = false;
			int num31 = (int)base.Center.X / 16;
			int num32 = (int)base.Center.Y / 16;
			for (int k = num32; k < num32 + num30; k++)
			{
				if (Main.tile[num31, k] != null && Main.tile[num31, k].nactive() && Main.tileSolid[Main.tile[num31, k].type])
				{
					flag2 = true;
				}
			}
			if (!flag2)
			{
				num2 *= -1f;
				if (velocity.Y < 0f)
				{
					velocity.Y *= 0.9f;
				}
			}
		}
		if (localAI[1] > 0f)
		{
			localAI[1] -= 1f;
		}
		else
		{
			localAI[1] = 15f;
			if (type == 661)
			{
				localAI[1] = 10f;
			}
			float num33 = 0f;
			Vector2 zero = Vector2.Zero;
			for (int l = 0; l < Main.maxNPCs; l++)
			{
				NPC nPC = Main.npc[l];
				if (nPC.active && nPC.damage > 0 && !nPC.friendly && nPC.Hitbox.Distance(base.Center) <= 100f)
				{
					num33 += 1f;
					zero += DirectionFrom(nPC.Center);
				}
			}
			if (num33 > 0f)
			{
				zero /= num33;
				zero *= 2f;
				velocity += zero;
				if (velocity.Length() > 16f)
				{
					velocity = velocity.SafeNormalize(Vector2.Zero) * 16f;
				}
			}
		}
		if (collideX)
		{
			num = ((!(velocity.X < 0f)) ? (0f - Math.Abs(num)) : Math.Abs(num));
			velocity.X *= -0.2f;
		}
		if (velocity.X < 0f)
		{
			direction = -1;
		}
		if (velocity.X > 0f)
		{
			direction = 1;
		}
		ai[0] = num;
		ai[1] = num2;
		if (type == 356)
		{
			catchItem = (short)(1994f + ai[2] - 1f);
		}
		if (type == 653)
		{
			position += netOffset;
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.6f, 0.3f, 0.1f);
			if (Main.rand.Next(60) == 0)
			{
				int num34 = Dust.NewDust(position, width, height, 6, 0f, 0f, 254);
				Main.dust[num34].velocity *= 0f;
			}
			position -= netOffset;
		}
	}

	public static Color AI_121_QueenSlime_GetDustColor()
	{
		Color value = new Color(0, 160, 255);
		Color value2 = Color.Lerp(value2: new Color(255, 80, 255), value1: new Color(200, 200, 200), amount: Main.rand.NextFloat());
		return Color.Lerp(value, value2, Main.rand.NextFloat());
	}

	private void AI_121_QueenSlime_FlyMovement()
	{
		noTileCollide = true;
		noGravity = true;
		float num = 12f;
		float num2 = 0.085f;
		float num3 = 250f;
		TargetClosest();
		Vector2 desiredVelocity = base.Center;
		if (timeLeft > 10)
		{
			if (!Collision.CanHit(this, Main.player[target]))
			{
				bool flag = false;
				Vector2 center = Main.player[target].Center;
				for (int i = 0; i < 16; i++)
				{
					float num4 = 16 * i;
					Point point = (center + new Vector2(0f, 0f - num4)).ToTileCoordinates();
					if (WorldGen.SolidOrSlopedTile(point.X, point.Y))
					{
						desiredVelocity = center + new Vector2(0f, 0f - num4 + 16f) - base.Center;
						flag = true;
						break;
					}
				}
				if (!flag)
				{
					desiredVelocity = center - base.Center;
				}
			}
			else
			{
				desiredVelocity = Main.player[target].Center + new Vector2(0f, 0f - num3) - base.Center;
			}
		}
		else
		{
			desiredVelocity = base.Center + new Vector2(500f * (float)direction, 0f - num3) - base.Center;
		}
		float num5 = desiredVelocity.Length();
		if (Math.Abs(desiredVelocity.X) < 40f)
		{
			desiredVelocity.X = velocity.X;
		}
		float num6 = num - 2f;
		if (num5 > 100f && ((velocity.X < 0f - num6 && desiredVelocity.X > 0f) || (velocity.X > num6 && desiredVelocity.X < 0f)))
		{
			num2 *= 2f;
		}
		if (num5 < 40f)
		{
			desiredVelocity = velocity;
		}
		else if (num5 < 80f)
		{
			desiredVelocity.Normalize();
			desiredVelocity *= num * 0.65f;
		}
		else
		{
			desiredVelocity.Normalize();
			desiredVelocity *= num;
		}
		SimpleFlyMovement(desiredVelocity, num2);
		rotation = velocity.X * 0.1f;
		if (rotation > 0.5f)
		{
			rotation = 0.5f;
		}
		if (rotation < -0.5f)
		{
			rotation = -0.5f;
		}
	}

	private void AI_121_QueenSlime()
	{
		int num = 30;
		int num2 = 40;
		_ = Main.expertMode;
		float num3 = 1f;
		bool flag = false;
		bool flag2 = life <= lifeMax / 2;
		if (localAI[0] == 0f)
		{
			ai[1] = -100f;
			localAI[0] = lifeMax;
			TargetClosest();
			netUpdate = true;
		}
		Lighting.AddLight(base.Center, 1f, 0.7f, 0.9f);
		int num4 = 500;
		if (Main.player[target].dead || Math.Abs(base.Center.X - Main.player[target].Center.X) / 16f > (float)num4)
		{
			TargetClosest();
			if (Main.player[target].dead || Math.Abs(base.Center.X - Main.player[target].Center.X) / 16f > (float)num4)
			{
				EncourageDespawn(10);
				if (Main.player[target].Center.X < base.Center.X)
				{
					direction = 1;
				}
				else
				{
					direction = -1;
				}
			}
		}
		if (!Main.player[target].dead && timeLeft > 10 && !flag2 && ai[3] >= 300f && ai[0] == 0f && velocity.Y == 0f)
		{
			ai[0] = 2f;
			ai[1] = 0f;
			if (Main.netMode != 1)
			{
				netUpdate = true;
				TargetClosest(faceTarget: false);
				base.Center.ToTileCoordinates();
				Main.player[target].Center.ToTileCoordinates();
				Vector2 vector = Main.player[target].Center - base.Center;
				bool antiCheese = false;
				if (ai[3] >= 360f || vector.Length() > 2000f)
				{
					if (ai[3] >= 360f)
					{
						ai[3] = 360f;
					}
					antiCheese = true;
				}
				if (!AI_015_KingSlime_FindTeleportSpot(antiCheese, ref localAI[1], ref localAI[2]))
				{
					ai[3] = 0f;
				}
			}
		}
		if (!flag2 && (!Collision.CanHitLine(base.Center, 0, 0, Main.player[target].Center, 0, 0) || Math.Abs(base.Top.Y - Main.player[target].Bottom.Y) > 320f))
		{
			ai[3] += 1.5f;
		}
		else
		{
			float num5 = ai[3];
			ai[3] -= 1f;
			if (ai[3] < 0f)
			{
				if (Main.netMode != 1 && num5 > 0f)
				{
					netUpdate = true;
				}
				ai[3] = 0f;
			}
		}
		if (timeLeft <= 10 && ((flag2 && ai[0] != 0f) || (!flag2 && ai[0] != 3f)))
		{
			if (flag2)
			{
				ai[0] = 0f;
			}
			else
			{
				ai[0] = 3f;
			}
			ai[1] = 0f;
			ai[2] = 0f;
			ai[3] = 0f;
			netUpdate = true;
		}
		noTileCollide = false;
		noGravity = false;
		if (flag2)
		{
			localAI[3] += 1f;
			if (localAI[3] >= 24f)
			{
				localAI[3] = 0f;
			}
			if (ai[0] == 4f && ai[2] == 1f)
			{
				localAI[3] = 6f;
			}
			if (ai[0] == 5f && ai[2] != 1f)
			{
				localAI[3] = 7f;
			}
		}
		switch ((int)ai[0])
		{
		case 0:
		{
			if (flag2)
			{
				AI_121_QueenSlime_FlyMovement();
			}
			else
			{
				noTileCollide = false;
				noGravity = false;
				if (velocity.Y == 0f)
				{
					velocity.X *= 0.8f;
					if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
					{
						velocity.X = 0f;
					}
				}
			}
			if (timeLeft <= 10 || (!flag2 && velocity.Y != 0f))
			{
				break;
			}
			ai[1] += 1f;
			int num10 = 60;
			if (flag2)
			{
				num10 = 120;
			}
			if (!(ai[1] > (float)num10))
			{
				break;
			}
			ai[1] = 0f;
			if (flag2)
			{
				Player player = Main.player[target];
				int num11 = Main.rand.Next(2);
				if (num11 != 1)
				{
					ai[0] = 4f;
				}
				else
				{
					ai[0] = 5f;
				}
				if (ai[0] == 4f)
				{
					ai[2] = 1f;
					if (player != null && player.active && !player.dead && (player.Bottom.Y < base.Bottom.Y || Math.Abs(player.Center.X - base.Center.X) > 250f))
					{
						ai[0] = 5f;
						ai[2] = 0f;
					}
				}
			}
			else
			{
				switch (Main.rand.Next(3))
				{
				default:
					ai[0] = 3f;
					break;
				case 1:
					ai[0] = 4f;
					break;
				case 2:
					ai[0] = 5f;
					break;
				}
			}
			netUpdate = true;
			break;
		}
		case 1:
		{
			rotation = 0f;
			ai[1] += 1f;
			num3 = MathHelper.Clamp(ai[1] / 30f, 0f, 1f);
			num3 = 0.5f + num3 * 0.5f;
			if (ai[1] >= 30f && Main.netMode != 1)
			{
				ai[0] = 0f;
				ai[1] = 0f;
				netUpdate = true;
				TargetClosest();
			}
			if (Main.netMode == 1 && ai[1] >= 60f)
			{
				ai[0] = 0f;
				ai[1] = 0f;
				TargetClosest();
			}
			Color newColor2 = AI_121_QueenSlime_GetDustColor();
			newColor2.A = 150;
			for (int n = 0; n < 10; n++)
			{
				int num19 = Dust.NewDust(position + Vector2.UnitX * -20f, width + 40, height, 4, velocity.X, velocity.Y, 50, newColor2, 1.5f);
				Main.dust[num19].noGravity = true;
				Main.dust[num19].velocity *= 2f;
			}
			break;
		}
		case 2:
			rotation = 0f;
			ai[1] += 1f;
			num3 = MathHelper.Clamp((60f - ai[1]) / 60f, 0f, 1f);
			num3 = 0.5f + num3 * 0.5f;
			if (ai[1] >= 60f)
			{
				flag = true;
			}
			if (ai[1] == 60f)
			{
				Gore.NewGore(base.Center + new Vector2(-40f, -height / 2), velocity, 1258);
			}
			if (ai[1] >= 60f && Main.netMode != 1)
			{
				base.Bottom = new Vector2(localAI[1], localAI[2]);
				ai[0] = 1f;
				ai[1] = 0f;
				netUpdate = true;
			}
			if (Main.netMode == 1 && ai[1] >= 120f)
			{
				ai[0] = 1f;
				ai[1] = 0f;
			}
			if (!flag)
			{
				Color newColor = AI_121_QueenSlime_GetDustColor();
				newColor.A = 150;
				for (int m = 0; m < 10; m++)
				{
					int num18 = Dust.NewDust(position + Vector2.UnitX * -20f, width + 40, height, 4, velocity.X, velocity.Y, 50, newColor, 1.5f);
					Main.dust[num18].noGravity = true;
					Main.dust[num18].velocity *= 0.5f;
				}
			}
			break;
		case 3:
			rotation = 0f;
			if (velocity.Y == 0f)
			{
				velocity.X *= 0.8f;
				if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
				{
					velocity.X = 0f;
				}
				ai[1] += 4f;
				if ((double)life < (double)lifeMax * 0.66)
				{
					ai[1] += 4f;
				}
				if ((double)life < (double)lifeMax * 0.33)
				{
					ai[1] += 4f;
				}
				if (!(ai[1] >= 0f))
				{
					break;
				}
				netUpdate = true;
				TargetClosest();
				if (ai[2] == 3f)
				{
					velocity.Y = -13f;
					velocity.X += 3.5f * (float)direction;
					ai[1] = 0f;
					ai[2] = 0f;
					if (timeLeft > 10)
					{
						ai[0] = 0f;
					}
					else
					{
						ai[1] = -60f;
					}
				}
				else if (ai[2] == 2f)
				{
					velocity.Y = -6f;
					velocity.X += 4.5f * (float)direction;
					ai[1] = -40f;
					ai[2] += 1f;
				}
				else
				{
					velocity.Y = -8f;
					velocity.X += 4f * (float)direction;
					ai[1] = -40f;
					ai[2] += 1f;
				}
			}
			else
			{
				if (target >= 255)
				{
					break;
				}
				float num12 = 3f;
				if (Main.getGoodWorld)
				{
					num12 = 7f;
				}
				if ((direction == 1 && velocity.X < num12) || (direction == -1 && velocity.X > 0f - num12))
				{
					if ((direction == -1 && (double)velocity.X < 0.1) || (direction == 1 && (double)velocity.X > -0.1))
					{
						velocity.X += 0.2f * (float)direction;
					}
					else
					{
						velocity.X *= 0.93f;
					}
				}
			}
			break;
		case 4:
		{
			rotation *= 0.9f;
			noTileCollide = true;
			noGravity = true;
			if (ai[2] == 1f)
			{
				noTileCollide = false;
				noGravity = false;
				int num13 = 30;
				if (flag2)
				{
					num13 = 10;
				}
				if (Main.getGoodWorld)
				{
					num13 = 0;
				}
				Player player2 = Main.player[target];
				_ = base.Center;
				if (!player2.dead && player2.active && Math.Abs(base.Center.X - player2.Center.X) / 16f <= (float)num4)
				{
					_ = player2.Center;
				}
				if (velocity.Y == 0f)
				{
					ai[0] = 0f;
					ai[1] = 0f;
					ai[2] = 0f;
					netUpdate = true;
					SoundEngine.PlaySound(SoundID.Item167, base.Center);
					if (Main.netMode != 1)
					{
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Bottom, Vector2.Zero, 922, num2, 0f, Main.myPlayer);
					}
					for (int k = 0; k < 20; k++)
					{
						int num14 = Dust.NewDust(base.Bottom - new Vector2(width / 2, 30f), width, 30, 31, velocity.X, velocity.Y, 40, AI_121_QueenSlime_GetDustColor());
						Main.dust[num14].noGravity = true;
						Main.dust[num14].velocity.Y = -5f + Main.rand.NextFloat() * -3f;
						Main.dust[num14].velocity.X *= 7f;
					}
				}
				else if (ai[1] >= (float)num13)
				{
					for (int l = 0; l < 4; l++)
					{
						Vector2 vector3 = base.Bottom - new Vector2(Main.rand.NextFloatDirection() * 16f, Main.rand.Next(8));
						int num15 = Dust.NewDust(vector3, 2, 2, 31, velocity.X, velocity.Y, 40, AI_121_QueenSlime_GetDustColor(), 1.4f);
						Main.dust[num15].position = vector3;
						Main.dust[num15].noGravity = true;
						Main.dust[num15].velocity.Y = velocity.Y * 0.9f;
						Main.dust[num15].velocity.X = ((Main.rand.Next(2) == 0) ? (-10f) : 10f) + Main.rand.NextFloatDirection() * 3f;
					}
				}
				velocity.X *= 0.8f;
				float num16 = ai[1];
				ai[1] += 1f;
				if (ai[1] >= (float)num13)
				{
					if (num16 < (float)num13)
					{
						netUpdate = true;
					}
					if (flag2 && ai[1] > (float)(num13 + 120))
					{
						ai[0] = 0f;
						ai[1] = 0f;
						ai[2] = 0f;
						velocity.Y *= 0.8f;
						netUpdate = true;
						break;
					}
					velocity.Y += 1f;
					float num17 = 14f;
					if (Main.getGoodWorld)
					{
						velocity.Y += 1f;
						num17 = 15.99f;
					}
					if (velocity.Y == 0f)
					{
						velocity.Y = 0.01f;
					}
					if (velocity.Y >= num17)
					{
						velocity.Y = num17;
					}
				}
				else
				{
					velocity.Y *= 0.8f;
				}
				break;
			}
			if (Main.netMode != 1 && ai[1] == 0f)
			{
				TargetClosest();
				netUpdate = true;
			}
			ai[1] += 1f;
			if (!(ai[1] >= 30f))
			{
				break;
			}
			if (ai[1] >= 60f)
			{
				ai[1] = 60f;
				if (Main.netMode != 1)
				{
					ai[1] = 0f;
					ai[2] = 1f;
					velocity.Y = -3f;
					netUpdate = true;
				}
			}
			Player player3 = Main.player[target];
			Vector2 center = base.Center;
			if (!player3.dead && player3.active && Math.Abs(base.Center.X - player3.Center.X) / 16f <= (float)num4)
			{
				center = player3.Center;
			}
			center.Y -= 384f;
			if (velocity.Y == 0f)
			{
				velocity = center - base.Center;
				velocity = velocity.SafeNormalize(Vector2.Zero);
				velocity *= 20f;
			}
			else
			{
				velocity.Y *= 0.95f;
			}
			break;
		}
		case 5:
		{
			rotation *= 0.9f;
			noTileCollide = true;
			noGravity = true;
			if (flag2)
			{
				ai[3] = 0f;
			}
			if (ai[2] == 1f)
			{
				ai[1] += 1f;
				if (!(ai[1] >= 10f))
				{
					break;
				}
				if (Main.netMode != 1)
				{
					int num6 = 10;
					if (Main.getGoodWorld)
					{
						num6 = 15;
					}
					int num7 = num6;
					if (!flag2)
					{
						num7 = 6;
					}
					for (int i = 0; i < num7; i++)
					{
						Vector2 spinningpoint = new Vector2(9f, 0f);
						spinningpoint = spinningpoint.RotatedBy((float)(-i) * ((float)Math.PI * 2f) / (float)num6, Vector2.Zero);
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, spinningpoint.X, spinningpoint.Y, 926, num, 0f, Main.myPlayer);
					}
				}
				ai[0] = 0f;
				ai[1] = 0f;
				ai[2] = 0f;
				netUpdate = true;
				break;
			}
			if (Main.netMode != 1 && ai[1] == 0f)
			{
				TargetClosest();
				netUpdate = true;
			}
			ai[1] += 1f;
			if (ai[1] >= 50f)
			{
				ai[1] = 50f;
				if (Main.netMode != 1)
				{
					ai[1] = 0f;
					ai[2] = 1f;
					netUpdate = true;
				}
			}
			float num8 = 100f;
			for (int j = 0; j < 4; j++)
			{
				Vector2 vector2 = base.Center + Main.rand.NextVector2CircularEdge(num8, num8);
				if (!flag2)
				{
					vector2 += new Vector2(0f, 20f);
				}
				Vector2 v = vector2 - base.Center;
				v = v.SafeNormalize(Vector2.Zero) * -8f;
				int num9 = Dust.NewDust(vector2, 2, 2, 31, v.X, v.Y, 40, AI_121_QueenSlime_GetDustColor(), 1.8f);
				Main.dust[num9].position = vector2;
				Main.dust[num9].noGravity = true;
				Main.dust[num9].alpha = 250;
				Main.dust[num9].velocity = v;
				Main.dust[num9].customData = this;
			}
			if (flag2)
			{
				AI_121_QueenSlime_FlyMovement();
			}
			break;
		}
		}
		dontTakeDamage = (hide = flag);
		if (num3 != scale)
		{
			position.X += width / 2;
			position.Y += height;
			scale = num3;
			width = (int)(114f * scale);
			height = (int)(100f * scale);
			position.X -= width / 2;
			position.Y -= height;
		}
		if (life <= 0)
		{
			return;
		}
		if (Main.rand.Next(360) == 0)
		{
			SoundEngine.PlaySound(65, position);
		}
		if (Main.netMode == 1)
		{
			return;
		}
		if (localAI[0] >= (float)(lifeMax / 2) && life < lifeMax / 2)
		{
			localAI[0] = life;
			ai[0] = 0f;
			ai[1] = 0f;
			ai[2] = 0f;
			netUpdate = true;
		}
		int num20 = (int)((float)lifeMax * 0.02f);
		if (flag2)
		{
			num20 = (int)((float)lifeMax * 0.015f);
		}
		if (!((float)(life + num20) < localAI[0]))
		{
			return;
		}
		localAI[0] = life;
		int num21 = Main.rand.Next(1, 3);
		for (int num22 = 0; num22 < num21; num22++)
		{
			int x = (int)(position.X + (float)Main.rand.Next(width - 32));
			int y = (int)(position.Y + (float)Main.rand.Next(height - 32));
			int num23 = 658;
			switch (Main.rand.Next(3))
			{
			case 0:
				num23 = 658;
				break;
			case 1:
				num23 = 659;
				break;
			case 2:
				num23 = 660;
				break;
			}
			int num24 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), x, y, num23);
			Main.npc[num24].SetDefaults(num23);
			Main.npc[num24].velocity.X = (float)Main.rand.Next(-15, 16) * 0.1f;
			Main.npc[num24].velocity.Y = (float)Main.rand.Next(-30, 1) * 0.1f;
			Main.npc[num24].ai[0] = -500 * Main.rand.Next(3);
			Main.npc[num24].ai[1] = 0f;
			if (Main.netMode == 2 && num24 < Main.maxNPCs)
			{
				NetMessage.SendData(23, -1, -1, null, num24);
			}
		}
	}

	public bool AI_120_HallowBoss_IsInPhase2()
	{
		if (ai[3] != 1f)
		{
			return ai[3] == 3f;
		}
		return true;
	}

	public bool AI_120_HallowBoss_IsGenuinelyEnraged()
	{
		if (ai[3] != 2f)
		{
			return ai[3] == 3f;
		}
		return true;
	}

	private void AI_120_HallowBoss_DoMagicEffect(Vector2 spot, int effectType, float progress)
	{
		float num = 4f;
		float num2 = 1f;
		float fadeIn = 0f;
		float num3 = 0.5f;
		int num4 = 2;
		int num5 = 267;
		switch (effectType)
		{
		case 1:
			num2 = 0.5f;
			fadeIn = 2f;
			num3 = 0f;
			break;
		case 2:
		case 4:
			num = 50f;
			num2 = 0.5f;
			fadeIn = 0f;
			num3 = 0f;
			num4 = 4;
			break;
		case 3:
			num = 30f;
			num2 = 0.1f;
			fadeIn = 2.5f;
			num3 = 0f;
			break;
		case 5:
			if (progress == 0f)
			{
				num4 = 0;
			}
			else
			{
				num4 = 5;
				num5 = Main.rand.Next(86, 92);
			}
			if (progress >= 1f)
			{
				num4 = 0;
			}
			break;
		}
		for (int i = 0; i < num4; i++)
		{
			Dust dust = Dust.NewDustPerfect(spot, num5, Main.rand.NextVector2CircularEdge(num, num) * (Main.rand.NextFloat() * (1f - num3) + num3), 0, Main.hslToRgb(Main.rand.NextFloat(), 1f, 0.5f), (Main.rand.NextFloat() * 2f + 2f) * num2);
			dust.fadeIn = fadeIn;
			dust.noGravity = true;
			switch (effectType)
			{
			case 2:
			case 4:
			{
				dust.velocity *= 0.005f;
				dust.scale = 3f * Utils.GetLerpValue(0.7f, 0f, progress, clamped: true) * Utils.GetLerpValue(0f, 0.3f, progress, clamped: true);
				dust.velocity = ((float)Math.PI * 2f * ((float)i / 4f) + (float)Math.PI / 4f).ToRotationVector2() * 8f * Utils.GetLerpValue(1f, 0f, progress, clamped: true);
				dust.velocity += velocity * 0.3f;
				float num6 = 0f;
				if (effectType == 4)
				{
					num6 = 0.5f;
				}
				dust.color = Main.hslToRgb(((float)i / 5f + num6 + progress * 0.5f) % 1f, 1f, 0.5f);
				dust.color.A /= 2;
				dust.alpha = 127;
				break;
			}
			case 5:
				if (progress == 0f)
				{
					dust.customData = this;
					dust.scale = 1.5f;
					dust.fadeIn = 0f;
					dust.velocity = new Vector2(0f, -1f) + Main.rand.NextVector2Circular(1f, 1f);
					dust.color = new Color(255, 255, 255, 80) * 0.3f;
				}
				else
				{
					dust.color = Main.hslToRgb(progress * 2f % 1f, 1f, 0.5f);
					dust.alpha = 0;
					dust.scale = 1f;
					dust.fadeIn = 1.3f;
					dust.velocity *= 3f;
					dust.velocity.X *= 0.1f;
					dust.velocity += velocity * 1f;
				}
				break;
			}
		}
	}

	public static bool ShouldEmpressBeEnraged()
	{
		if (Main.remixWorld)
		{
			if (empressRageMode)
			{
				return true;
			}
			int num = -1;
			for (int i = 0; i < Main.maxNPCs; i++)
			{
				if (Main.npc[i].type == 636)
				{
					num = i;
					break;
				}
			}
			if (num >= 0 && (double)Main.npc[num].Center.Y < Main.worldSurface * 16.0)
			{
				empressRageMode = true;
				return true;
			}
			empressRageMode = false;
			return false;
		}
		return Main.dayTime;
	}

	private void AI_120_HallowBoss()
	{
		Vector2 vector = new Vector2(-150f, -250f);
		Vector2 vector2 = new Vector2(150f, -250f);
		Vector2 vector3 = new Vector2(0f, -350f);
		Vector2 vector4 = new Vector2(0f, -350f);
		Vector2 vector5 = new Vector2(-80f, -500f);
		float num = 0.5f;
		float num2 = 12f;
		float num3 = 40f;
		float num4 = 6400f;
		int num5 = 40;
		int num6 = 50;
		int num7 = 70;
		int num8 = 45;
		int num9 = 45;
		int num10 = 50;
		bool flag = AI_120_HallowBoss_IsInPhase2();
		bool flag2 = Main.expertMode;
		bool flag3 = flag && flag2;
		bool flag4 = ShouldEmpressBeEnraged();
		if (life == lifeMax && flag4 && !AI_120_HallowBoss_IsGenuinelyEnraged())
		{
			this.ai[3] += 2f;
		}
		bool flag5 = true;
		int num11 = 30;
		int num12 = 30;
		int num13 = 30;
		int num14 = 35;
		int num15 = 65;
		if (flag)
		{
			num6 = 60;
			num8 = 50;
			num9 = 50;
			num10 = 60;
			num7 = 65;
			num11 = 35;
			num12 = 35;
			num13 = 35;
			num14 = 40;
			num15 = 30;
		}
		num6 = GetAttackDamage_ForProjectiles(num6, num11);
		num8 = GetAttackDamage_ForProjectiles(num8, num12);
		num9 = GetAttackDamage_ForProjectiles(num9, num13);
		num10 = GetAttackDamage_ForProjectiles(num10, num14);
		num7 = GetAttackDamage_ForProjectiles(num7, num15);
		if (flag4)
		{
			num6 = 9999;
			num8 = 9999;
			num9 = 9999;
			num10 = 9999;
			num7 = 9999;
			flag2 = true;
		}
		float num16 = 1f;
		bool flag6 = true;
		int num17 = 0;
		if (flag)
		{
			num17 += 15;
		}
		if (flag2)
		{
			num17 += 5;
		}
		switch ((int)this.ai[0])
		{
		case 0:
			if (this.ai[1] == 0f)
			{
				velocity = new Vector2(0f, 5f);
				if (Main.netMode != 1)
				{
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center + new Vector2(0f, -80f), Vector2.Zero, 874, 0, 0f, Main.myPlayer);
				}
			}
			if (this.ai[1] == 10f)
			{
				SoundEngine.PlaySound(SoundID.Item161, base.Center);
			}
			velocity *= 0.95f;
			if (this.ai[1] > 10f && this.ai[1] < 150f)
			{
				int num67 = 2;
				for (int m = 0; m < num67; m++)
				{
					float num68 = MathHelper.Lerp(1.3f, 0.7f, Opacity) * Utils.GetLerpValue(0f, 120f, this.ai[1], clamped: true);
					Color newColor2 = Main.hslToRgb(this.ai[1] / 180f, 1f, 0.5f);
					int num69 = Dust.NewDust(position, width, height, 267, 0f, 0f, 0, newColor2);
					Main.dust[num69].position = base.Center + Main.rand.NextVector2Circular((float)width * 3f, (float)height * 3f) + new Vector2(0f, -150f);
					Main.dust[num69].velocity *= Main.rand.NextFloat() * 0.8f;
					Main.dust[num69].noGravity = true;
					Main.dust[num69].fadeIn = 0.6f + Main.rand.NextFloat() * 0.7f * num68;
					Main.dust[num69].velocity += Vector2.UnitY * 3f;
					Main.dust[num69].scale = 0.35f;
					if (num69 != 6000)
					{
						Dust dust2 = Dust.CloneDust(num69);
						dust2.scale /= 2f;
						dust2.fadeIn *= 0.85f;
						dust2.color = new Color(255, 255, 255, 255);
					}
				}
			}
			this.ai[1] += 1f;
			flag5 = false;
			flag6 = false;
			Opacity = MathHelper.Clamp(this.ai[1] / 180f, 0f, 1f);
			if (this.ai[1] >= 180f)
			{
				if (flag4 && !AI_120_HallowBoss_IsGenuinelyEnraged())
				{
					this.ai[3] += 2f;
				}
				this.ai[0] = 1f;
				this.ai[1] = 0f;
				netUpdate = true;
				TargetClosest();
			}
			break;
		case 1:
		{
			float num34 = (flag ? 20f : 45f);
			if (Main.getGoodWorld)
			{
				num34 /= 2f;
			}
			if (this.ai[1] <= 10f)
			{
				if (this.ai[1] == 0f)
				{
					TargetClosest();
				}
				NPCAimedTarget targetData4 = GetTargetData();
				if (targetData4.Invalid)
				{
					this.ai[0] = 13f;
					this.ai[1] = 0f;
					this.ai[2] += 1f;
					velocity /= 4f;
					netUpdate = true;
					break;
				}
				Vector2 center = targetData4.Center;
				AI_120_HallowBoss_DashTo(center);
				netUpdate = true;
			}
			if (velocity.Length() > 16f && this.ai[1] > 10f)
			{
				velocity /= 2f;
			}
			velocity *= 0.92f;
			this.ai[1] += 1f;
			if (!(this.ai[1] >= num34))
			{
				break;
			}
			int num35 = (int)this.ai[2];
			int num36 = 2;
			int num37 = 0;
			if (!flag)
			{
				int num38 = num37++;
				int num39 = num37++;
				int num40 = num37++;
				int num41 = num37++;
				int num42 = num37++;
				int num43 = num37++;
				int num44 = num37++;
				int num45 = num37++;
				int num46 = num37++;
				int num47 = num37++;
				if (num35 % num37 == num38)
				{
					num36 = 2;
				}
				if (num35 % num37 == num39)
				{
					num36 = 8;
				}
				if (num35 % num37 == num40)
				{
					num36 = 6;
				}
				if (num35 % num37 == num41)
				{
					num36 = 8;
				}
				if (num35 % num37 == num42)
				{
					num36 = 5;
				}
				if (num35 % num37 == num43)
				{
					num36 = 2;
				}
				if (num35 % num37 == num44)
				{
					num36 = 8;
				}
				if (num35 % num37 == num45)
				{
					num36 = 4;
				}
				if (num35 % num37 == num46)
				{
					num36 = 8;
				}
				if (num35 % num37 == num47)
				{
					num36 = 5;
				}
				if ((float)life / (float)lifeMax <= 0.5f)
				{
					num36 = 10;
				}
			}
			if (flag)
			{
				int num48 = num37++;
				int num49 = num37++;
				int num50 = num37++;
				int num51 = -1;
				if (flag2)
				{
					num51 = num37++;
				}
				int num52 = num37++;
				int num53 = num37++;
				int num54 = num37++;
				int num55 = num37++;
				int num56 = num37++;
				int num57 = num37++;
				if (num35 % num37 == num48)
				{
					num36 = 7;
				}
				if (num35 % num37 == num49)
				{
					num36 = 2;
				}
				if (num35 % num37 == num50)
				{
					num36 = 8;
				}
				if (num35 % num37 == num52)
				{
					num36 = 5;
				}
				if (num35 % num37 == num53)
				{
					num36 = 2;
				}
				if (num35 % num37 == num54)
				{
					num36 = 6;
				}
				if (num35 % num37 == num54)
				{
					num36 = 6;
				}
				if (num35 % num37 == num55)
				{
					num36 = 4;
				}
				if (num35 % num37 == num56)
				{
					num36 = 8;
				}
				if (num35 % num37 == num51)
				{
					num36 = 11;
				}
				if (num35 % num37 == num57)
				{
					num36 = 12;
				}
			}
			TargetClosest();
			NPCAimedTarget targetData5 = GetTargetData();
			bool flag12 = false;
			if (AI_120_HallowBoss_IsGenuinelyEnraged())
			{
				if (!Main.dayTime)
				{
					flag12 = true;
				}
				if (Main.dayTime && Main.time >= 53400.0)
				{
					flag12 = true;
				}
			}
			if (targetData5.Invalid || Distance(targetData5.Center) > num4 || flag12)
			{
				num36 = 13;
			}
			if (num36 == 8 && targetData5.Center.X > base.Center.X)
			{
				num36 = 9;
			}
			if (flag2 && num36 != 5 && num36 != 12)
			{
				velocity = DirectionFrom(targetData5.Center).SafeNormalize(Vector2.Zero).RotatedBy((float)Math.PI / 2f * (float)(targetData5.Center.X > base.Center.X).ToDirectionInt()) * 20f;
			}
			this.ai[0] = num36;
			this.ai[1] = 0f;
			this.ai[2] += 1f;
			netUpdate = true;
			break;
		}
		case 2:
		{
			if (this.ai[1] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item164, base.Center);
			}
			float num90 = 90f - (float)num17;
			Vector2 vector35 = new Vector2(-55f, -30f);
			NPCAimedTarget targetData11 = GetTargetData();
			Vector2 vector36 = (targetData11.Invalid ? base.Center : targetData11.Center);
			if (Distance(vector36 + vector) > num3)
			{
				SimpleFlyMovement(DirectionTo(vector36 + vector).SafeNormalize(Vector2.Zero) * num2, num);
			}
			if (this.ai[1] < 60f)
			{
				AI_120_HallowBoss_DoMagicEffect(base.Center + vector35, 1, Utils.GetLerpValue(0f, 60f, this.ai[1], clamped: true));
			}
			int num91 = 3;
			if (flag2)
			{
				num91 = 2;
			}
			if ((int)this.ai[1] % num91 == 0 && this.ai[1] < 60f)
			{
				float ai3 = this.ai[1] / 60f;
				Vector2 vector37 = new Vector2(0f, -6f).RotatedBy((float)Math.PI / 2f * Main.rand.NextFloatDirection());
				if (flag3)
				{
					vector37 = new Vector2(0f, -10f).RotatedBy((float)Math.PI * 2f * Main.rand.NextFloat());
				}
				if (Main.netMode != 1)
				{
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center + vector35, vector37, 873, num8, 0f, Main.myPlayer, target, ai3);
				}
				if (Main.netMode != 1)
				{
					int num92 = (int)(this.ai[1] / (float)num91);
					for (int num93 = 0; num93 < 255; num93++)
					{
						if (Boss_CanShootExtraAt(num93, num92 % 3, 3, 2400f))
						{
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center + vector35, vector37, 873, num8, 0f, Main.myPlayer, num93, ai3);
						}
					}
				}
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= 60f + num90)
			{
				this.ai[0] = 1f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			break;
		}
		case 3:
		{
			this.ai[1] += 1f;
			NPCAimedTarget targetData8 = GetTargetData();
			Vector2 vector22 = (targetData8.Invalid ? base.Center : targetData8.Center);
			if (Distance(vector22 + vector2) > num3)
			{
				SimpleFlyMovement(DirectionTo(vector22 + vector2).SafeNormalize(Vector2.Zero) * num2, num);
			}
			if ((int)this.ai[1] % 180 == 0)
			{
				Vector2 vector23 = new Vector2(0f, -100f);
				Projectile.NewProjectile(GetSpawnSource_ForProjectile(), targetData8.Center + vector23, Vector2.Zero, 874, num5, 0f, Main.myPlayer);
			}
			if (this.ai[1] >= 120f)
			{
				this.ai[0] = 1f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			break;
		}
		case 4:
		{
			float num81 = 20 - num17;
			new Vector2(0f, -100f);
			if (this.ai[1] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item162, base.Center);
			}
			if (this.ai[1] >= 6f && this.ai[1] < 54f)
			{
				AI_120_HallowBoss_DoMagicEffect(base.Center + new Vector2(-55f, -20f), 2, Utils.GetLerpValue(0f, 100f, this.ai[1], clamped: true));
				AI_120_HallowBoss_DoMagicEffect(base.Center + new Vector2(55f, -20f), 4, Utils.GetLerpValue(0f, 100f, this.ai[1], clamped: true));
			}
			NPCAimedTarget targetData10 = GetTargetData();
			Vector2 vector28 = (targetData10.Invalid ? base.Center : targetData10.Center);
			if (Distance(vector28 + vector3) > num3)
			{
				SimpleFlyMovement(DirectionTo(vector28 + vector3).SafeNormalize(Vector2.Zero) * num2, num);
			}
			int num82 = 4;
			if (flag2)
			{
				num82 = 5;
			}
			if ((int)this.ai[1] % 4 == 0 && this.ai[1] < 100f)
			{
				int num83 = 1;
				int num84 = 0;
				for (int n = 0; n < num83; n++)
				{
					int num85 = (int)this.ai[1] / 4;
					Vector2 vector29 = Vector2.UnitX.RotatedBy((float)Math.PI / (float)(num82 * 2) + (float)num85 * ((float)Math.PI / (float)num82) + 0f);
					if (!flag2)
					{
						vector29.X += ((vector29.X > 0f) ? 0.5f : (-0.5f));
					}
					vector29.Normalize();
					float num86 = 300f;
					if (flag2)
					{
						num86 = 450f;
					}
					Vector2 center4 = targetData10.Center;
					if (Distance(center4) > 2400f)
					{
						continue;
					}
					if (Vector2.Dot(targetData10.Velocity.SafeNormalize(Vector2.UnitY), vector29) > 0f)
					{
						vector29 *= -1f;
					}
					int num87 = 90;
					Vector2 vector30 = center4 + targetData10.Velocity * num87;
					Vector2 vector31 = center4 + vector29 * num86 - targetData10.Velocity * 30f;
					if (vector31.Distance(center4) < num86)
					{
						Vector2 vector32 = center4 - vector31;
						if (vector32 == Vector2.Zero)
						{
							vector32 = vector29;
						}
						vector31 = center4 - Vector2.Normalize(vector32) * num86;
					}
					Vector2 v4 = vector30 - vector31;
					if (Main.netMode != 1)
					{
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector31, Vector2.Zero, 919, num6, 0f, Main.myPlayer, v4.ToRotation(), this.ai[1] / 100f);
					}
					if (Main.netMode == 1)
					{
						continue;
					}
					int num88 = (int)(this.ai[1] / 4f);
					for (int num89 = 0; num89 < 255; num89++)
					{
						if (!Boss_CanShootExtraAt(num89, num88 % 3, 3, 2400f))
						{
							continue;
						}
						Player player2 = Main.player[num89];
						center4 = player2.Center;
						if (Vector2.Dot(player2.velocity.SafeNormalize(Vector2.UnitY), vector29) > 0f)
						{
							vector29 *= -1f;
						}
						Vector2 vector33 = center4 + player2.velocity * num87;
						vector31 = center4 + vector29 * num86 - player2.velocity * 30f;
						if (vector31.Distance(center4) < num86)
						{
							Vector2 vector34 = center4 - vector31;
							if (vector34 == Vector2.Zero)
							{
								vector34 = vector29;
							}
							vector31 = center4 - Vector2.Normalize(vector34) * num86;
						}
						v4 = vector33 - vector31;
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector31, Vector2.Zero, 919, num6, 0f, Main.myPlayer, v4.ToRotation(), this.ai[1] / 100f);
					}
				}
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= 100f + num81)
			{
				this.ai[0] = 1f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			break;
		}
		case 5:
		{
			if (this.ai[1] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item163, base.Center);
			}
			float num63 = 30f;
			num63 -= (float)num17;
			Vector2 vector18 = new Vector2(55f, -30f);
			Vector2 vector19 = base.Center + vector18;
			if (this.ai[1] < 42f)
			{
				AI_120_HallowBoss_DoMagicEffect(base.Center + vector18, 3, Utils.GetLerpValue(0f, 42f, this.ai[1], clamped: true));
			}
			NPCAimedTarget targetData7 = GetTargetData();
			Vector2 vector20 = (targetData7.Invalid ? base.Center : targetData7.Center);
			if (Distance(vector20 + vector4) > num3)
			{
				SimpleFlyMovement(DirectionTo(vector20 + vector4).SafeNormalize(Vector2.Zero) * num2, num);
			}
			if ((int)this.ai[1] % 42 == 0 && this.ai[1] < 42f)
			{
				float num64 = (float)Math.PI * 2f * Main.rand.NextFloat();
				for (float num65 = 0f; num65 < 1f; num65 += 1f / 13f)
				{
					float num66 = num65;
					Vector2 vector21 = Vector2.UnitY.RotatedBy((float)Math.PI / 2f + (float)Math.PI * 2f * num66 + num64);
					if (Main.netMode != 1)
					{
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector19 + vector21.RotatedBy(-1.5707963705062866) * 30f, vector21 * 8f, 872, num9, 0f, Main.myPlayer, 0f, num66);
					}
				}
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= 42f + num63)
			{
				this.ai[0] = 1f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			break;
		}
		case 6:
		{
			float num25 = 120 - num17;
			Vector2 vector8 = new Vector2(0f, -100f);
			Vector2 vector9 = base.Center + vector8;
			NPCAimedTarget targetData2 = GetTargetData();
			Vector2 vector10 = (targetData2.Invalid ? base.Center : targetData2.Center);
			if (Distance(vector10 + vector5) > num3)
			{
				SimpleFlyMovement(DirectionTo(vector10 + vector5).SafeNormalize(Vector2.Zero) * num2 * 0.3f, num * 0.7f);
			}
			if ((int)this.ai[1] % 60 == 0 && this.ai[1] < 180f)
			{
				int num26 = (int)this.ai[1] / 60;
				int num27 = ((targetData2.Center.X > base.Center.X) ? 1 : 0);
				float num28 = 6f;
				if (flag2)
				{
					num28 = 8f;
				}
				float num29 = 1f / num28;
				for (float num30 = 0f; num30 < 1f; num30 += num29)
				{
					float num31 = (num30 + num29 * 0.5f + (float)num26 * num29 * 0.5f) % 1f;
					float ai = (float)Math.PI * 2f * (num31 + (float)num27);
					if (Main.netMode != 1)
					{
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector9, Vector2.Zero, 923, num10, 0f, Main.myPlayer, ai, whoAmI);
					}
				}
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= 180f + num25)
			{
				this.ai[0] = 1f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			break;
		}
		case 7:
		{
			float num70 = 20f;
			float num71 = 60f;
			float num72 = num71 * 4f;
			if (flag2)
			{
				num70 = 40f;
				num71 = 40f;
				num72 = num71 * 6f;
			}
			num70 -= (float)num17;
			NPCAimedTarget targetData9 = GetTargetData();
			Vector2 vector24 = (targetData9.Invalid ? base.Center : targetData9.Center);
			if (Distance(vector24 + vector4) > num3)
			{
				SimpleFlyMovement(DirectionTo(vector24 + vector4).SafeNormalize(Vector2.Zero) * num2 * 0.4f, num);
			}
			if ((float)(int)this.ai[1] % num71 == 0f && this.ai[1] < num72)
			{
				SoundEngine.PlaySound(SoundID.Item162, base.Center);
				Main.rand.NextFloat();
				int num73 = (int)this.ai[1] / (int)num71;
				float num74 = 13f;
				float num75 = 150f;
				float num76 = num74 * num75;
				Vector2 center3 = targetData9.Center;
				if (Distance(center3) <= 3200f)
				{
					Vector2 vector25 = Vector2.Zero;
					Vector2 vector26 = Vector2.UnitY;
					float num77 = 0.4f;
					float num78 = 1.4f;
					float num79 = 1f;
					if (flag2)
					{
						num74 += 5f;
						num75 += 50f;
						num79 *= 1f;
						num76 *= 0.5f;
					}
					switch (num73)
					{
					case 0:
						center3 += new Vector2((0f - num76) / 2f, 0f) * num79;
						vector25 = new Vector2(0f, num76);
						vector26 = Vector2.UnitX;
						break;
					case 1:
						center3 += new Vector2(num76 / 2f, num75 / 2f) * num79;
						vector25 = new Vector2(0f, num76);
						vector26 = -Vector2.UnitX;
						break;
					case 2:
						center3 += new Vector2(0f - num76, 0f - num76) * num77 * num79;
						vector25 = new Vector2(num76 * num78, 0f);
						vector26 = new Vector2(1f, 1f);
						break;
					case 3:
						center3 += new Vector2(num76 * num77 + num75 / 2f, (0f - num76) * num77) * num79;
						vector25 = new Vector2((0f - num76) * num78, 0f);
						vector26 = new Vector2(-1f, 1f);
						break;
					case 4:
						center3 += new Vector2(0f - num76, num76) * num77 * num79;
						vector25 = new Vector2(num76 * num78, 0f);
						vector26 = center3.DirectionTo(targetData9.Center);
						break;
					case 5:
						center3 += new Vector2(num76 * num77 + num75 / 2f, num76 * num77) * num79;
						vector25 = new Vector2((0f - num76) * num78, 0f);
						vector26 = center3.DirectionTo(targetData9.Center);
						break;
					}
					for (float num80 = 0f; num80 <= 1f; num80 += 1f / num74)
					{
						Vector2 origin = center3 + vector25 * (num80 - 0.5f);
						Vector2 v3 = vector26;
						if (flag2)
						{
							Vector2 vector27 = targetData9.Velocity * 20f * num80;
							Vector2 value = origin.DirectionTo(targetData9.Center + vector27);
							v3 = Vector2.Lerp(vector26, value, 0.75f).SafeNormalize(Vector2.UnitY);
						}
						float ai2 = num80;
						if (Main.netMode != 1)
						{
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), origin, Vector2.Zero, 919, num7, 0f, Main.myPlayer, v3.ToRotation(), ai2);
						}
					}
				}
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= num72 + num70)
			{
				this.ai[0] = 1f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			break;
		}
		case 8:
		case 9:
		{
			float num32 = 20 - num17;
			Vector2 vector11 = new Vector2(0f, -100f);
			_ = base.Center + vector11;
			flag6 = !(this.ai[1] >= 6f) || !(this.ai[1] <= 40f);
			int num33 = ((this.ai[0] != 8f) ? 1 : (-1));
			AI_120_HallowBoss_DoMagicEffect(base.Center, 5, Utils.GetLerpValue(40f, 90f, this.ai[1], clamped: true));
			if (this.ai[1] <= 40f)
			{
				if (this.ai[1] == 20f)
				{
					SoundEngine.PlaySound(SoundID.Item160, base.Center);
				}
				NPCAimedTarget targetData3 = GetTargetData();
				Vector2 destination = (targetData3.Invalid ? base.Center : targetData3.Center) + new Vector2(num33 * -550, 0f);
				SimpleFlyMovement(DirectionTo(destination).SafeNormalize(Vector2.Zero) * num2, num * 2f);
				if (this.ai[1] == 40f)
				{
					velocity *= 0.3f;
				}
			}
			else if (this.ai[1] <= 90f)
			{
				velocity = Vector2.Lerp(value2: new Vector2(num33 * 50, 0f), value1: velocity, amount: 0.05f);
				if (this.ai[1] == 90f)
				{
					velocity *= 0.7f;
				}
				num16 *= 1.5f;
			}
			else
			{
				velocity *= 0.92f;
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= 90f + num32)
			{
				this.ai[0] = 1f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			break;
		}
		case 10:
		{
			float num94 = 20 - num17;
			if (this.ai[1] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item161, base.Center);
			}
			flag6 = !(this.ai[1] >= 30f) || !(this.ai[1] <= 170f);
			velocity *= 0.95f;
			if (this.ai[1] == 90f)
			{
				if (this.ai[3] == 0f)
				{
					this.ai[3] = 1f;
				}
				if (this.ai[3] == 2f)
				{
					this.ai[3] = 3f;
				}
				base.Center = GetTargetData().Center + new Vector2(0f, -250f);
				netUpdate = true;
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= 180f + num94)
			{
				this.ai[0] = 1f;
				this.ai[1] = 0f;
				this.ai[2] = 0f;
				netUpdate = true;
			}
			break;
		}
		case 11:
		{
			if (this.ai[1] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item162, base.Center);
			}
			float num58 = 20 - num17;
			new Vector2(0f, -100f);
			if (this.ai[1] >= 6f && this.ai[1] < 54f)
			{
				AI_120_HallowBoss_DoMagicEffect(base.Center + new Vector2(-55f, -20f), 2, Utils.GetLerpValue(0f, 100f, this.ai[1], clamped: true));
				AI_120_HallowBoss_DoMagicEffect(base.Center + new Vector2(55f, -20f), 4, Utils.GetLerpValue(0f, 100f, this.ai[1], clamped: true));
			}
			NPCAimedTarget targetData6 = GetTargetData();
			Vector2 vector12 = (targetData6.Invalid ? base.Center : targetData6.Center);
			if (Distance(vector12 + vector3) > num3)
			{
				SimpleFlyMovement(DirectionTo(vector12 + vector3).SafeNormalize(Vector2.Zero) * num2, num);
			}
			if ((int)this.ai[1] % 3 == 0 && this.ai[1] < 100f)
			{
				int num59 = 1;
				for (int k = 0; k < num59; k++)
				{
					Vector2 v = -targetData6.Velocity;
					v = v.SafeNormalize(-Vector2.UnitY);
					float num60 = 100f;
					Vector2 center2 = targetData6.Center;
					if (Distance(center2) > 2400f)
					{
						continue;
					}
					int num61 = 90;
					Vector2 vector13 = center2 + targetData6.Velocity * num61;
					Vector2 vector14 = center2 + v * num60;
					if (vector14.Distance(center2) < num60)
					{
						Vector2 vector15 = center2 - vector14;
						if (vector15 == Vector2.Zero)
						{
							vector15 = v;
						}
						vector14 = center2 - Vector2.Normalize(vector15) * num60;
					}
					Vector2 v2 = vector13 - vector14;
					if (Main.netMode != 1)
					{
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector14, Vector2.Zero, 919, num6, 0f, Main.myPlayer, v2.ToRotation(), this.ai[1] / 100f);
					}
					if (Main.netMode == 1)
					{
						continue;
					}
					int num62 = (int)(this.ai[1] / 3f);
					for (int l = 0; l < 255; l++)
					{
						if (!Boss_CanShootExtraAt(l, num62 % 3, 3, 2400f))
						{
							continue;
						}
						Player player = Main.player[l];
						v = -player.velocity;
						v = v.SafeNormalize(-Vector2.UnitY);
						num60 = 100f;
						center2 = player.Center;
						num61 = 90;
						Vector2 vector16 = center2 + player.velocity * num61;
						vector14 = center2 + v * num60;
						if (vector14.Distance(center2) < num60)
						{
							Vector2 vector17 = center2 - vector14;
							if (vector17 == Vector2.Zero)
							{
								vector17 = v;
							}
							vector14 = center2 - Vector2.Normalize(vector17) * num60;
						}
						v2 = vector16 - vector14;
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector14, Vector2.Zero, 919, num6, 0f, Main.myPlayer, v2.ToRotation(), this.ai[1] / 100f);
					}
				}
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= 100f + num58)
			{
				this.ai[0] = 1f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			break;
		}
		case 12:
		{
			float num21 = 90f - (float)num17;
			Vector2 vector6 = new Vector2(-55f, -30f);
			if (this.ai[1] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item165, base.Center);
				velocity = new Vector2(0f, -12f);
			}
			velocity *= 0.95f;
			bool flag11 = this.ai[1] < 60f && this.ai[1] >= 10f;
			if (flag11)
			{
				AI_120_HallowBoss_DoMagicEffect(base.Center + vector6, 1, Utils.GetLerpValue(0f, 60f, this.ai[1], clamped: true));
			}
			int num22 = 6;
			if (flag2)
			{
				num22 = 4;
			}
			float num23 = (this.ai[1] - 10f) / 50f;
			if ((int)this.ai[1] % num22 == 0 && flag11)
			{
				_ = this.ai[1] / 60f;
				Vector2 vector7 = (vector7 = new Vector2(0f, -20f).RotatedBy((float)Math.PI * 2f * num23));
				if (Main.netMode != 1)
				{
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center + vector6, vector7, 873, num8, 0f, Main.myPlayer, target, num23);
				}
				if (Main.netMode != 1)
				{
					int num24 = (int)(this.ai[1] % (float)num22);
					for (int j = 0; j < 255; j++)
					{
						if (Boss_CanShootExtraAt(j, num24 % 3, 3, 2400f))
						{
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center + vector6, vector7, 873, num8, 0f, Main.myPlayer, j, num23);
						}
					}
				}
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= 60f + num21)
			{
				this.ai[0] = 1f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			break;
		}
		case 13:
		{
			new Vector2(-55f, -30f);
			if (this.ai[1] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item165, base.Center);
				velocity = new Vector2(0f, -7f);
			}
			velocity *= 0.95f;
			TargetClosest();
			NPCAimedTarget targetData = GetTargetData();
			flag5 = false;
			bool flag7 = false;
			bool flag8 = false;
			if (!flag7)
			{
				if (AI_120_HallowBoss_IsGenuinelyEnraged())
				{
					if (!Main.dayTime)
					{
						flag8 = true;
					}
					if (Main.dayTime && Main.time >= 53400.0)
					{
						flag8 = true;
					}
				}
				flag7 = flag7 || flag8;
			}
			if (!flag7)
			{
				bool flag9 = targetData.Invalid || Distance(targetData.Center) > num4;
				flag7 = flag7 || flag9;
			}
			alpha = Utils.Clamp(alpha + flag7.ToDirectionInt() * 5, 0, 255);
			bool flag10 = alpha == 0 || alpha == 255;
			int num18 = 5;
			for (int i = 0; i < num18; i++)
			{
				float num19 = MathHelper.Lerp(1.3f, 0.7f, Opacity);
				Color newColor = Main.hslToRgb(Main.rand.NextFloat(), 1f, 0.5f);
				int num20 = Dust.NewDust(position - base.Size * 0.5f, width * 2, height * 2, 267, 0f, 0f, 0, newColor);
				Main.dust[num20].position = base.Center + Main.rand.NextVector2Circular(width, height);
				Main.dust[num20].velocity *= Main.rand.NextFloat() * 0.8f;
				Main.dust[num20].noGravity = true;
				Main.dust[num20].scale = 0.9f + Main.rand.NextFloat() * 1.2f;
				Main.dust[num20].fadeIn = 0.4f + Main.rand.NextFloat() * 1.2f * num19;
				Main.dust[num20].velocity += Vector2.UnitY * -2f;
				Main.dust[num20].scale = 0.35f;
				if (num20 != 6000)
				{
					Dust dust = Dust.CloneDust(num20);
					dust.scale /= 2f;
					dust.fadeIn *= 0.85f;
					dust.color = new Color(255, 255, 255, 255);
				}
			}
			this.ai[1] += 1f;
			if (!(this.ai[1] >= 20f && flag10))
			{
				break;
			}
			if (alpha == 255)
			{
				active = false;
				if (Main.netMode != 1)
				{
					NetMessage.SendData(23, -1, -1, null, whoAmI);
				}
				return;
			}
			this.ai[0] = 1f;
			this.ai[1] = 0f;
			netUpdate = true;
			break;
		}
		}
		dontTakeDamage = !flag6;
		damage = (int)((float)defDamage * num16);
		if (flag4)
		{
			damage = 9999;
		}
		if (flag)
		{
			defense = (int)((float)defDefense * 1.2f);
		}
		else
		{
			defense = defDefense;
		}
		if ((localAI[0] += 1f) >= 44f)
		{
			localAI[0] = 0f;
		}
		if (flag5)
		{
			alpha = Utils.Clamp(alpha - 5, 0, 255);
		}
		Lighting.AddLight(base.Center, Vector3.One * Opacity);
	}

	private void AI_120_HallowBoss_DashTo(Vector2 targetPosition)
	{
		DirectionTo(targetPosition);
		targetPosition += new Vector2(0f, -300f);
		if (Distance(targetPosition) > 200f)
		{
			targetPosition -= DirectionTo(targetPosition) * 100f;
		}
		Vector2 vector = targetPosition - base.Center;
		float lerpValue = Utils.GetLerpValue(100f, 600f, vector.Length(), clamped: true);
		float num = vector.Length();
		if (num > 18f)
		{
			num = 18f;
		}
		velocity = Vector2.Lerp(vector.SafeNormalize(Vector2.Zero) * num, vector / 6f, lerpValue);
	}

	public bool Boss_CanShootExtraAt(int playerIndex, int rotationIndexToAttack, int rotationSize, float attackScanDistance, bool alwaysSkipMainTarget = true)
	{
		if (playerIndex == target && alwaysSkipMainTarget)
		{
			return false;
		}
		if (playerIndex % rotationSize != rotationIndexToAttack)
		{
			return false;
		}
		Player player = Main.player[playerIndex];
		if (!player.active || player.dead || !playerInteraction[playerIndex])
		{
			return false;
		}
		if (Distance(player.Center) > attackScanDistance)
		{
			return false;
		}
		return true;
	}

	private void AI_119_Dandelion()
	{
		if (!Main.IsItAHappyWindyDay && timeLeft > 10)
		{
			timeLeft = 10;
		}
		bool flag = false;
		float num = 0f;
		float num2 = 0f;
		NPCUtils.TargetClosestDownwindFromNPC(this, 600f);
		NPCAimedTarget targetData = GetTargetData();
		if (targetData.Type == NPCTargetType.Player)
		{
			Rectangle hitbox = targetData.Hitbox;
			float windSpeedCurrent = Main.windSpeedCurrent;
			num = (float)hitbox.Center.X - base.Center.X;
			num2 = Math.Abs(num);
			flag = Math.Abs((float)hitbox.Center.Y - base.Center.Y) < 100f && num2 < 600f && ((num > 0f && windSpeedCurrent > 0f) || (num < 0f && windSpeedCurrent < 0f));
		}
		if (ai[0] == 1f)
		{
			localAI[0] = 0f;
			if (num2 < 500f)
			{
				localAI[0] = 1f;
			}
			if (Main.netMode == 1)
			{
				return;
			}
			if (!flag)
			{
				ai[0] = 0f;
				netUpdate = true;
			}
			else
			{
				if (localAI[0] != 1f)
				{
					return;
				}
				localAI[1] += 1f;
				if (localAI[1] > 80f)
				{
					ai[0] = 0f;
					netUpdate = true;
				}
				else
				{
					if (localAI[1] != 40f)
					{
						return;
					}
					for (int i = 0; i < 1 + Main.rand.Next(3); i++)
					{
						int num3 = -1;
						if (num > 0f)
						{
							num3 = 1;
						}
						Vector2 vector = new Vector2(num3 * Main.rand.Next(-2, 10), 10 + Main.rand.Next(-6, 6));
						Vector2 vector2 = new Vector2(2f * (float)num3, -2f);
						vector2 += vector * 0.25f;
						if (vector2.Y > -3f)
						{
							vector2.Y = -3f;
						}
						Vector2 vector3 = base.Center + vector;
						vector3.X += num3 * 6;
						int num4 = 7;
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector3, vector2, 836, num4, 1f, Main.myPlayer, 0f, target);
					}
					netUpdate = true;
				}
			}
		}
		else if (ai[0] == 0f)
		{
			localAI[0] = 0f;
			localAI[1] = 0f;
			if (Main.netMode != 1 && flag)
			{
				ai[0] = 1f;
				netUpdate = true;
			}
		}
	}

	private void AI_118_Seahorses()
	{
		noGravity = wet;
		Collision.GetWaterLineIterate(base.Center.ToTileCoordinates(), out var waterLineHeight);
		bool flag = waterLineHeight > 0f && base.Top.Y - waterLineHeight < 20f;
		if (!wet)
		{
			if (velocity.Y == 0f)
			{
				velocity.X *= 0.95f;
			}
			rotation += (velocity.X + velocity.Y) / 2f * 0.05f;
		}
		else
		{
			ai[1] -= 1f;
			if (ai[1] <= 0f)
			{
				velocity += ai[0].ToRotationVector2() * 0.06f;
				float num = velocity.Length();
				if (num > 3f || num < -3f)
				{
					velocity.X = Math.Min(3f, Math.Max(-3f, velocity.X));
					ai[1] = Main.rand.Next(450, 600);
					ai[0] = Main.rand.NextFloat() * ((float)Math.PI * 2f);
					if (flag && ai[0] > (float)Math.PI)
					{
						ai[0] -= (float)Math.PI;
					}
					netUpdate = true;
				}
			}
			else
			{
				velocity *= 0.95f;
			}
			rotation = velocity.X * 0.1f;
		}
		bool flag2 = collideY && wet && (!flag || velocity.Y < 0f);
		if (collideX || flag2)
		{
			Vector2 v = ai[0].ToRotationVector2();
			if (collideX)
			{
				v.X *= -1f;
			}
			if (flag2)
			{
				v.Y *= -1f;
			}
			ai[0] = v.ToRotation();
			velocity = ai[0].ToRotationVector2() * velocity.Length();
			netUpdate = true;
		}
	}

	private void AI_117_BloodNautilus()
	{
		float moveSpeed = 0.15f;
		float num = 7.5f;
		float num2 = 60f;
		float num3 = 90f;
		float num4 = 180f;
		float num5 = 90f;
		float num6 = 90f;
		int num7 = 3;
		float num8 = 180f;
		bool flag = false;
		if (localAI[0] == 0f)
		{
			localAI[0] = 1f;
			alpha = 255;
			if (Main.netMode != 1)
			{
				ai[0] = -1f;
				netUpdate = true;
			}
		}
		if (ai[0] != -1f && Main.rand.Next(4) == 0)
		{
			position += netOffset;
			Dust dust = Dust.NewDustDirect(position + new Vector2(5f), width - 10, height - 10, 5);
			dust.velocity *= 0.5f;
			if (dust.velocity.Y < 0f)
			{
				dust.velocity.Y *= -1f;
			}
			dust.alpha = 120;
			dust.scale = 1f + Main.rand.NextFloat() * 0.4f;
			dust.velocity += velocity * 0.3f;
			position -= netOffset;
		}
		if (target == 255)
		{
			TargetClosest();
			ai[2] = direction;
		}
		if (Main.player[target].dead || Vector2.Distance(Main.player[target].Center, base.Center) > 2000f)
		{
			TargetClosest();
		}
		NPCAimedTarget nPCAimedTarget = GetTargetData();
		if (Main.dayTime || !Main.bloodMoon)
		{
			nPCAimedTarget = default(NPCAimedTarget);
		}
		int num9 = -1;
		switch ((int)ai[0])
		{
		case -1:
		{
			velocity *= 0.98f;
			int num17 = Math.Sign(nPCAimedTarget.Center.X - base.Center.X);
			if (num17 != 0)
			{
				direction = num17;
				spriteDirection = -direction;
			}
			if (localAI[1] == 0f && alpha < 100)
			{
				localAI[1] = 1f;
				int num18 = 36;
				for (int l = 0; l < num18; l++)
				{
					position += netOffset;
					Vector2 vector3 = (Vector2.Normalize(velocity) * new Vector2((float)width / 2f, height) * 0.75f * 0.5f).RotatedBy((float)(l - (num18 / 2 - 1)) * ((float)Math.PI * 2f) / (float)num18) + base.Center;
					Vector2 vector4 = vector3 - base.Center;
					int num19 = Dust.NewDust(vector3 + vector4, 0, 0, 5, vector4.X * 2f, vector4.Y * 2f, 100, default(Color), 1.4f);
					Main.dust[num19].noGravity = true;
					Main.dust[num19].velocity = Vector2.Normalize(vector4) * 3f;
					position -= netOffset;
				}
			}
			if (ai[2] > 5f)
			{
				velocity.Y = -2.5f;
				alpha -= 10;
				if (Collision.SolidCollision(position, width, height))
				{
					alpha += 15;
					if (alpha > 150)
					{
						alpha = 150;
					}
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			ai[2] += 1f;
			if (ai[2] >= 50f)
			{
				ai[0] = 0f;
				ai[1] = 0f;
				ai[2] = 0f;
				ai[3] = 0f;
				netUpdate = true;
			}
			break;
		}
		case 0:
		{
			Vector2 destination = nPCAimedTarget.Center + new Vector2((0f - ai[2]) * 300f, -200f);
			if (base.Center.Distance(destination) > 50f)
			{
				Vector2 desiredVelocity = DirectionTo(destination) * num;
				SimpleFlyMovement(desiredVelocity, moveSpeed);
			}
			direction = ((base.Center.X < nPCAimedTarget.Center.X) ? 1 : (-1));
			float num15 = base.Center.DirectionTo(nPCAimedTarget.Center).ToRotation() - 0.47123894f * (float)spriteDirection;
			if (spriteDirection == -1)
			{
				num15 += (float)Math.PI;
			}
			if (spriteDirection != direction)
			{
				spriteDirection = direction;
				rotation = 0f - rotation;
				num15 = 0f - num15;
			}
			rotation = rotation.AngleTowards(num15, 0.02f);
			ai[1] += 1f;
			if (ai[1] > num2)
			{
				num9 = 1;
				int num16 = (int)ai[3];
				if (num16 % 7 == 3)
				{
					num9 = 3;
				}
				else if (num16 % 2 == 0)
				{
					SoundEngine.PlaySound(SoundID.Item170, base.Center);
					num9 = 2;
				}
				else
				{
					SoundEngine.PlaySound(SoundID.Item170, base.Center);
					num9 = 1;
				}
			}
			break;
		}
		case 1:
		{
			direction = ((!(base.Center.X < nPCAimedTarget.Center.X)) ? 1 : (-1));
			float num20 = base.Center.DirectionFrom(nPCAimedTarget.Center).ToRotation() - 0.47123894f * (float)spriteDirection;
			if (spriteDirection == -1)
			{
				num20 += (float)Math.PI;
			}
			bool flag2 = ai[1] < num3;
			if (spriteDirection != direction && flag2)
			{
				spriteDirection = direction;
				rotation = 0f - rotation;
				num20 = 0f - num20;
			}
			if (ai[1] < num3)
			{
				if (ai[1] == num3 - 1f)
				{
					SoundEngine.PlaySound(SoundID.Item172, base.Center);
				}
				flag = true;
				velocity *= 0.95f;
				rotation = rotation.AngleLerp(num20, 0.02f);
				position += netOffset;
				BloodNautilus_GetMouthPositionAndRotation(out var mouthPosition4, out var mouthDirection4);
				Dust dust6 = Dust.NewDustDirect(mouthPosition4 + mouthDirection4 * 60f - new Vector2(40f), 80, 80, 16, 0f, 0f, 150, Color.Transparent, 0.6f);
				dust6.fadeIn = 1f;
				dust6.velocity = dust6.position.DirectionTo(mouthPosition4 + Main.rand.NextVector2Circular(15f, 15f)) * dust6.velocity.Length();
				dust6.noGravity = true;
				dust6 = Dust.NewDustDirect(mouthPosition4 + mouthDirection4 * 100f - new Vector2(30f), 60, 60, 16, 0f, 0f, 100, Color.Transparent, 0.9f);
				dust6.fadeIn = 1.5f;
				dust6.velocity = dust6.position.DirectionTo(mouthPosition4 + Main.rand.NextVector2Circular(15f, 15f)) * (dust6.velocity.Length() + 5f);
				dust6.noGravity = true;
				position -= netOffset;
			}
			else if (ai[1] < num3 + num4)
			{
				position += netOffset;
				rotation = rotation.AngleLerp(num20, 0.05f);
				BloodNautilus_GetMouthPositionAndRotation(out var mouthPosition5, out var mouthDirection5);
				if (base.Center.Distance(nPCAimedTarget.Center) > 150f)
				{
					velocity = mouthDirection5 * -16f + base.Center.DirectionTo(nPCAimedTarget.Center) * 1.5f;
				}
				for (int m = 0; m < 4; m++)
				{
					Dust dust7 = Dust.NewDustDirect(mouthPosition5 + mouthDirection5 * 60f - new Vector2(15f), 30, 30, 5, 0f, 0f, 0, Color.Transparent, 1.5f);
					dust7.velocity = dust7.position.DirectionFrom(mouthPosition5 + Main.rand.NextVector2Circular(5f, 5f)) * dust7.velocity.Length();
					dust7.position -= mouthDirection5 * 60f;
					dust7 = Dust.NewDustDirect(mouthPosition5 + mouthDirection5 * 100f - new Vector2(20f), 40, 40, 5, 0f, 0f, 100, Color.Transparent, 1.5f);
					dust7.velocity = dust7.position.DirectionFrom(mouthPosition5 + Main.rand.NextVector2Circular(10f, 10f)) * (dust7.velocity.Length() + 5f);
					dust7.position -= mouthDirection5 * 100f;
				}
				position -= netOffset;
			}
			ai[1] += 1f;
			if (ai[1] >= num3 + num4)
			{
				num9 = 0;
			}
			break;
		}
		case 2:
		{
			direction = ((base.Center.X < nPCAimedTarget.Center.X) ? 1 : (-1));
			float num12 = base.Center.DirectionTo(nPCAimedTarget.Center).ToRotation() - 0.47123894f * (float)spriteDirection;
			if (spriteDirection == -1)
			{
				num12 += (float)Math.PI;
			}
			if (spriteDirection != direction)
			{
				spriteDirection = direction;
				rotation = 0f - rotation;
				num12 = 0f - num12;
			}
			rotation = rotation.AngleLerp(num12, 0.2f);
			if (ai[1] < num5)
			{
				position += netOffset;
				velocity *= 0.95f;
				BloodNautilus_GetMouthPositionAndRotation(out var mouthPosition2, out var mouthDirection2);
				if (Main.rand.Next(4) != 0)
				{
					Dust dust3 = Dust.NewDustDirect(mouthPosition2 + mouthDirection2 * 60f - new Vector2(60f), 120, 120, 16, 0f, 0f, 150, Color.Transparent, 0.6f);
					dust3.fadeIn = 1f;
					dust3.velocity = dust3.position.DirectionTo(mouthPosition2 + Main.rand.NextVector2Circular(15f, 15f)) * (dust3.velocity.Length() + 3f);
					dust3.noGravity = true;
					dust3 = Dust.NewDustDirect(mouthPosition2 + mouthDirection2 * 100f - new Vector2(80f), 160, 160, 16, 0f, 0f, 100, Color.Transparent, 0.9f);
					dust3.fadeIn = 1.5f;
					dust3.velocity = dust3.position.DirectionTo(mouthPosition2 + Main.rand.NextVector2Circular(15f, 15f)) * (dust3.velocity.Length() + 5f);
					dust3.noGravity = true;
				}
				position -= netOffset;
			}
			else if (ai[1] < num5 + num6)
			{
				position += netOffset;
				velocity *= 0.9f;
				float num13 = (ai[1] - num5) % (num6 / (float)num7);
				BloodNautilus_GetMouthPositionAndRotation(out var mouthPosition3, out var mouthDirection3);
				if (num13 < num6 / (float)num7 * 0.8f)
				{
					for (int i = 0; i < 5; i++)
					{
						Dust dust4 = Dust.NewDustDirect(mouthPosition3 + mouthDirection3 * 50f - new Vector2(15f), 30, 30, 5, 0f, 0f, 0, Color.Transparent, 1.5f);
						dust4.velocity = dust4.position.DirectionFrom(mouthPosition3 + Main.rand.NextVector2Circular(5f, 5f)) * dust4.velocity.Length();
						dust4.position -= mouthDirection3 * 60f;
						dust4 = Dust.NewDustDirect(mouthPosition3 + mouthDirection3 * 90f - new Vector2(20f), 40, 40, 5, 0f, 0f, 100, Color.Transparent, 1.5f);
						dust4.velocity = dust4.position.DirectionFrom(mouthPosition3 + Main.rand.NextVector2Circular(10f, 10f)) * (dust4.velocity.Length() + 5f);
						dust4.position -= mouthDirection3 * 100f;
					}
				}
				if ((int)num13 == 0)
				{
					velocity += mouthDirection3 * -8f;
					for (int j = 0; j < 20; j++)
					{
						Dust dust5 = Dust.NewDustDirect(mouthPosition3 + mouthDirection3 * 60f - new Vector2(15f), 30, 30, 5, 0f, 0f, 0, Color.Transparent, 1.5f);
						dust5.velocity = dust5.position.DirectionFrom(mouthPosition3 + Main.rand.NextVector2Circular(5f, 5f)) * dust5.velocity.Length();
						dust5.position -= mouthDirection3 * 60f;
						dust5 = Dust.NewDustDirect(mouthPosition3 + mouthDirection3 * 100f - new Vector2(20f), 40, 40, 5, 0f, 0f, 100, Color.Transparent, 1.5f);
						dust5.velocity = dust5.position.DirectionFrom(mouthPosition3 + Main.rand.NextVector2Circular(10f, 10f)) * (dust5.velocity.Length() + 5f);
						dust5.position -= mouthDirection3 * 100f;
					}
					if (Main.netMode != 1)
					{
						int num14 = Main.rand.Next(5, 11);
						Vector2 vector = mouthDirection3 * 10f;
						int attackDamage_ForProjectiles = GetAttackDamage_ForProjectiles(30f, 25f);
						for (int k = 0; k < num14; k++)
						{
							Vector2 vector2 = vector + Main.rand.NextVector2Square(-6f, 6f);
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), mouthPosition3 - mouthDirection3 * 5f, vector2, 814, attackDamage_ForProjectiles, 0f, Main.myPlayer);
						}
					}
				}
				position -= netOffset;
			}
			ai[1] += 1f;
			if (ai[1] >= num5 + num6)
			{
				num9 = 0;
			}
			break;
		}
		case 3:
		{
			direction = ((base.Center.X < nPCAimedTarget.Center.X) ? 1 : (-1));
			float targetAngle = 0f;
			spriteDirection = direction;
			if (ai[1] < num8)
			{
				position += netOffset;
				float num10 = MathHelper.Clamp(1f - ai[1] / num8 * 1.5f, 0f, 1f);
				velocity = Vector2.Lerp(value2: new Vector2(0f, num10 * -1.5f), value1: velocity, amount: 0.03f);
				velocity = Vector2.Zero;
				rotation = rotation.AngleLerp(targetAngle, 0.02f);
				BloodNautilus_GetMouthPositionAndRotation(out var _, out var _);
				float t = ai[1] / num8;
				float num11 = Utils.GetLerpValue(0f, 0.5f, t) * Utils.GetLerpValue(1f, 0.5f, t);
				Lighting.AddLight(base.Center, new Vector3(1f, 0.5f, 0.5f) * num11);
				if (Main.rand.Next(3) != 0)
				{
					Dust dust2 = Dust.NewDustDirect(base.Center - new Vector2(6f), 12, 12, 5, 0f, 0f, 60, Color.Transparent, 1.4f);
					dust2.position += new Vector2(spriteDirection * 12, 12f);
					dust2.velocity *= 0.1f;
				}
				position -= netOffset;
			}
			if (ai[1] == 10f || ai[1] == 20f || ai[1] == 30f)
			{
				BloodNautilus_CallForHelp();
			}
			ai[1] += 1f;
			if (ai[1] >= num8)
			{
				num9 = 0;
			}
			break;
		}
		}
		if (num9 != -1)
		{
			ai[0] = num9;
			ai[1] = 0f;
			ai[2] = 0f;
			netUpdate = true;
			TargetClosest();
			if (num9 == 0)
			{
				ai[2] = direction;
			}
			else
			{
				ai[3] += 1f;
			}
		}
		reflectsProjectiles = flag;
	}

	private void BloodNautilus_CallForHelp()
	{
		if (Main.netMode == 1 || !Main.player[target].active || Main.player[target].dead || Distance(Main.player[target].Center) > 2000f || CountNPCS(619) >= 3)
		{
			return;
		}
		Point point = base.Center.ToTileCoordinates();
		Point point2 = point;
		int num = 20;
		int num2 = 3;
		int num3 = 8;
		int num4 = 2;
		int num5 = 0;
		bool flag = false;
		while (!flag && num5 < 100)
		{
			num5++;
			int num6 = Main.rand.Next(point2.X - num, point2.X + num + 1);
			int num7 = Main.rand.Next(point2.Y - num, point2.Y + num + 1);
			if ((num7 < point2.Y - num3 || num7 > point2.Y + num3 || num6 < point2.X - num3 || num6 > point2.X + num3) && (num7 < point.Y - num2 || num7 > point.Y + num2 || num6 < point.X - num2 || num6 > point.X + num2) && !Main.tile[num6, num7].nactive())
			{
				bool flag2 = true;
				if (flag2 && Main.tile[num6, num7].lava())
				{
					flag2 = false;
				}
				if (flag2 && Collision.SolidTiles(num6 - num4, num6 + num4, num7 - num4, num7 + num4))
				{
					flag2 = false;
				}
				if (flag2 && !Collision.CanHitLine(base.Center, 0, 0, Main.player[target].Center, 0, 0))
				{
					flag2 = false;
				}
				if (flag2)
				{
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), num6 * 16 + 8, num7 * 16 + 8, 0f, 0f, 813, 0, 0f, Main.myPlayer);
					flag = true;
					break;
				}
			}
		}
	}

	private void AI_116_WaterStriders()
	{
		bool flag = false;
		if (Collision.GetWaterLine(base.Center.ToTileCoordinates(), out var waterLineHeight))
		{
			float num = base.Bottom.Y - 1f;
			if (base.Center.Y > waterLineHeight)
			{
				velocity.Y -= 0.8f;
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
				if (num + velocity.Y < waterLineHeight)
				{
					velocity.Y = waterLineHeight - num;
				}
			}
			else
			{
				velocity.Y = MathHelper.Min(velocity.Y, waterLineHeight - num);
				flag = true;
			}
		}
		else if (wet)
		{
			velocity.Y -= 0.2f;
		}
		if ((int)ai[0] != 0)
		{
			return;
		}
		ai[1] += 1f;
		velocity.X *= 0.9f;
		if (velocity.Y == 0f)
		{
			velocity.X *= 0.6f;
		}
		bool flag2 = wet || flag;
		bool flag3 = flag2 || velocity.Y == 0f;
		int num2 = Main.rand.Next(120, 241);
		if (!flag2)
		{
			num2 = Main.rand.Next(60, 241);
		}
		if (!flag3 || !(ai[1] >= (float)num2))
		{
			return;
		}
		ai[1] = 0f;
		velocity.X = Main.rand.NextFloatDirection() * 5f;
		netUpdate = true;
		if (!flag2)
		{
			if (velocity.Y == 0f)
			{
				velocity.Y = -2f;
			}
			ai[1] = 60f;
		}
	}

	private void AI_115_LadyBugs()
	{
		if (Main.netMode != 1)
		{
			if (ai[1] == 0f)
			{
				ai[1] = Main.rand.NextFloat() * 0.2f + 0.7f;
				netUpdate = true;
			}
			if ((localAI[0] -= 1f) <= 0f)
			{
				localAI[0] = Main.rand.Next(60, 181);
				if (Main.rand.Next(5) == 0)
				{
					if (ai[2] == 0f)
					{
						ai[2] = 1f;
						ai[0] = 0f;
						netUpdate = true;
					}
					else if (ai[2] == 1f)
					{
						TargetClosest();
						ai[2] = 0f;
						ai[0] = Main.rand.NextFloat() * ((float)Math.PI * 2f);
						if (Distance(Main.player[target].Center) > 700f)
						{
							ai[0] = AngleTo(Main.player[target].Center) + Main.rand.NextFloatDirection() * 0.3f;
						}
						netUpdate = true;
					}
				}
				TargetClosest();
				ai[0] = Main.rand.NextFloat() * ((float)Math.PI * 2f);
				if (Distance(Main.player[target].Center) > 700f)
				{
					ai[0] = AngleTo(Main.player[target].Center) + Main.rand.NextFloatDirection() * 0.3f;
				}
				netUpdate = true;
			}
		}
		scale = ai[1];
		if (ai[2] == 0f)
		{
			Vector2 value = ai[0].ToRotationVector2() * 1f;
			value.X += Main.windSpeedTarget * 0.8f;
			velocity = Vector2.Lerp(velocity, value, 0.0125f);
			if (velocity.Y > 0f)
			{
				int num = 4;
				int num2 = (int)base.Center.X / 16;
				int num3 = (int)base.Center.Y / 16;
				for (int i = num3; i < num3 + num; i++)
				{
					if (Main.tile[num2, i] != null && ((Main.tile[num2, i].nactive() && Main.tileSolid[Main.tile[num2, i].type]) || Main.tile[num2, i].liquid > 0))
					{
						ai[0] = 0f - ai[0];
						if (velocity.Y > 0f)
						{
							velocity.Y *= 0.9f;
						}
					}
				}
			}
			if (velocity.Y < 0f)
			{
				int num4 = 30;
				bool flag = false;
				int num5 = (int)base.Center.X / 16;
				int num6 = (int)base.Center.Y / 16;
				for (int j = num6; j < num6 + num4; j++)
				{
					if (Main.tile[num5, j] != null && ((Main.tile[num5, j].nactive() && Main.tileSolid[Main.tile[num5, j].type]) || Main.tile[num5, j].liquid > 0))
					{
						flag = true;
					}
				}
				if (!flag)
				{
					ai[0] = 0f - ai[0];
					if (velocity.Y < 0f)
					{
						velocity.Y *= 0.9f;
					}
				}
			}
			if (collideX)
			{
				ai[0] = 0f - ai[0] + (float)Math.PI;
				velocity.X *= -0.2f;
			}
		}
		else
		{
			if (velocity.Y > 0f)
			{
				int num7 = 4;
				int num8 = (int)base.Center.X / 16 + direction;
				int num9 = (int)base.Center.Y / 16;
				for (int k = num9; k < num9 + num7; k++)
				{
					if (Main.tile[num8, k] != null && Main.tile[num8, k].liquid > 0)
					{
						TargetClosest();
						velocity.Y = -1f;
						ai[2] = 0f;
						ai[0] = Main.rand.NextFloat() * ((float)Math.PI / 4f) - (float)Math.PI / 2f;
						if (Distance(Main.player[target].Center) > 700f)
						{
							ai[0] = AngleTo(Main.player[target].Center) + Main.rand.NextFloatDirection() * 0.3f;
						}
						netUpdate = true;
						return;
					}
				}
			}
			if (velocity.Y != 0f)
			{
				velocity.X *= 0.98f;
				velocity.Y = MathHelper.Lerp(velocity.Y, 2f, 0.005f);
			}
			else
			{
				velocity = Vector2.Lerp(velocity, Vector2.UnitX * direction, 0.05f);
				velocity.Y += 0.2f;
				if (collideX)
				{
					direction *= -1;
					velocity.X *= -0.2f;
					netUpdate = true;
				}
			}
		}
		direction = ((velocity.X > 0f) ? 1 : (-1));
	}

	private void AI_114_Dragonflies()
	{
		if (localAI[0] == 0f && Main.netMode != 1)
		{
			localAI[0] = 1f;
			Vector2 center = base.Center;
			ai[2] = center.X;
			ai[3] = center.Y;
			velocity = (Main.rand.NextVector2Circular(5f, 3f) + Main.rand.NextVector2CircularEdge(5f, 3f)) * 0.4f;
			ai[1] = 0f;
			ai[0] = 1f;
			netUpdate = true;
		}
		switch ((int)ai[0])
		{
		case 0:
			velocity *= 0.94f;
			if (Main.netMode != 1 && (ai[1] += 1f) >= (float)(60 + Main.rand.Next(60)))
			{
				Vector2 vector = new Vector2(ai[2], ai[3]);
				if (Distance(vector) > 96f)
				{
					velocity = DirectionTo(vector) * 3f;
				}
				else if (Distance(vector) > 16f)
				{
					velocity = DirectionTo(vector) * 1f + Main.rand.NextVector2Circular(1f, 0.5f);
				}
				else
				{
					velocity = (Main.rand.NextVector2Circular(5f, 3f) + Main.rand.NextVector2CircularEdge(5f, 3f)) * 0.4f;
				}
				ai[1] = 0f;
				ai[0] = 1f;
				netUpdate = true;
			}
			break;
		case 1:
		{
			int num = 4;
			Vector2 other = new Vector2(ai[2], ai[3]);
			if (Distance(other) > 112f)
			{
				num = 200;
			}
			if ((ai[1] += 1f) >= (float)num)
			{
				ai[1] = 0f;
				ai[0] = 0f;
				netUpdate = true;
			}
			int num2 = (int)base.Center.X / 16;
			int num3 = (int)base.Center.Y / 16;
			int num4 = 3;
			for (int i = num3; i < num3 + num4; i++)
			{
				if (Main.tile[num2, i] != null && ((Main.tile[num2, i].nactive() && Main.tileSolid[Main.tile[num2, i].type]) || Main.tile[num2, i].liquid > 0))
				{
					if (velocity.Y > 0f)
					{
						velocity.Y *= 0.9f;
					}
					velocity.Y -= 0.2f;
				}
			}
			if (!(velocity.Y < 0f))
			{
				break;
			}
			int num5 = 30;
			bool flag = false;
			for (int j = num3; j < num3 + num5; j++)
			{
				if (Main.tile[num2, j] != null && Main.tile[num2, j].nactive() && Main.tileSolid[Main.tile[num2, j].type])
				{
					flag = true;
					break;
				}
			}
			if (!flag && velocity.Y < 0f)
			{
				velocity.Y *= 0.9f;
			}
			break;
		}
		}
		if (velocity.X != 0f)
		{
			direction = ((velocity.X > 0f) ? 1 : (-1));
		}
		if (wet)
		{
			velocity.Y = -3f;
		}
		if (localAI[1] > 0f)
		{
			localAI[1] -= 1f;
			return;
		}
		localAI[1] = 15f;
		float num6 = 0f;
		Vector2 zero = Vector2.Zero;
		for (int k = 0; k < Main.maxNPCs; k++)
		{
			NPC nPC = Main.npc[k];
			if (nPC.active && nPC.damage > 0 && !nPC.friendly && nPC.Hitbox.Distance(base.Center) <= 100f)
			{
				num6 += 1f;
				zero += DirectionFrom(nPC.Center);
			}
		}
		for (int l = 0; l < 255; l++)
		{
			Player player = Main.player[l];
			if (player.active && player.Hitbox.Distance(base.Center) <= 150f)
			{
				num6 += 1f;
				zero += DirectionFrom(player.Center);
			}
		}
		if (num6 > 0f)
		{
			float num7 = 2f;
			zero /= num6;
			zero *= num7;
			velocity += zero;
			if (velocity.Length() > 16f)
			{
				velocity = velocity.SafeNormalize(Vector2.Zero) * 16f;
			}
			Vector2 vector2 = base.Center + zero * 10f;
			ai[1] = -10f;
			ai[0] = 1f;
			ai[2] = vector2.X;
			ai[3] = vector2.Y;
			netUpdate = true;
		}
		else
		{
			if (Main.netMode == 1 || !((new Vector2(ai[2], ai[3]) - base.Center).Length() < 16f))
			{
				return;
			}
			int maxValue = 30;
			if (Main.tile[(int)ai[2] / 16, (int)ai[3] / 16].type != 519)
			{
				maxValue = 4;
			}
			if (Main.rand.Next(maxValue) != 0)
			{
				return;
			}
			int cattailX = (int)ai[2];
			int cattailY = (int)ai[2];
			if (FindCattailTop((int)ai[2] / 16, (int)ai[3] / 16, out cattailX, out cattailY))
			{
				ai[2] = cattailX * 16;
				ai[3] = cattailY * 16;
				netUpdate = true;
				return;
			}
			int num8 = (int)(base.Center.X / 16f);
			int m;
			for (m = (int)(base.Center.Y / 16f); !WorldGen.SolidTile(num8, m) && (double)m < Main.worldSurface; m++)
			{
			}
			m -= Main.rand.Next(3, 6);
			ai[2] = num8 * 16;
			ai[3] = m * 16;
			netUpdate = true;
		}
	}

	private void AI_113_WindyBalloon()
	{
		if (localAI[0] == 0f && Main.netMode != 1)
		{
			TargetClosest();
			localAI[0] = 1f;
			ai[2] = Main.rand.Next(7) + 1;
			int num = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)position.X, (int)position.Y, 1);
			if (Main.rand.Next(180) == 0)
			{
				Main.npc[num].SetDefaults(-4);
			}
			else if (Main.rand.Next(10) == 0)
			{
				Main.npc[num].SetDefaults(-7);
			}
			else if (Main.rand.Next(3) == 0)
			{
				Main.npc[num].SetDefaults(-3);
			}
			Main.npc[num].ai[0] = -999f;
			Main.npc[num].netUpdate = true;
			ai[3] = num;
			netUpdate = true;
			ai[1] = Main.npc[num].scale;
		}
		position = base.Center;
		base.Size = new Vector2(20f, 20f) * ai[1];
		scale = ai[1];
		base.Center = position;
		NPC nPC = AI_113_WindyBalloon_GetSlaveNPC();
		rotation = velocity.X * 0.05f;
		if (nPC != null)
		{
			NPCAimedTarget targetData = GetTargetData();
			float num2 = float.PositiveInfinity;
			int num3 = 0;
			Vector2 zero = Vector2.Zero;
			if (!targetData.Invalid)
			{
				zero = targetData.Center - base.Bottom;
				if (zero.Y < 0f)
				{
					num3 = (int)zero.Y / -16;
				}
				num2 = zero.Length();
				if (direction != Math.Sign(zero.X))
				{
					num3 = 0;
				}
			}
			if (wet || nPC.wet || collideX || (collideY && oldVelocity.Y < 0f))
			{
				float num4 = oldVelocity.X + (float)(direction * 8);
				position.X -= num4;
				nPC.position.X -= num4;
				TargetClosest(faceTarget: false);
				direction *= -1;
				velocity.X = direction * 2;
				life = -1;
				HitEffect();
				active = false;
				netUpdate = true;
				SoundEngine.PlaySound(DeathSound, position);
				return;
			}
			if (collideY)
			{
				velocity.Y = ((oldVelocity.Y > 0f) ? 1 : (-1));
				TargetClosest(faceTarget: false);
			}
			float num5 = 2f + Math.Abs(Main.windSpeedTarget) * 2f;
			if (Math.Sign(velocity.X) != direction || Math.Abs(velocity.X) < num5)
			{
				velocity.X += (float)direction * 0.01f;
				if (velocity.X * (float)direction < 0f)
				{
					if (Math.Abs(velocity.X) > num5)
					{
						velocity.X += (float)direction * 0.1f;
					}
					else
					{
						velocity.X += (float)direction * 0.05f;
					}
				}
				else if (Math.Abs(velocity.X) > num5)
				{
					velocity.X = (float)direction * num5;
				}
			}
			int num6 = (int)((position.X + (float)(width / 2)) / 16f) + direction;
			int num7 = (int)((position.Y + (float)height) / 16f);
			bool flag = true;
			int num8 = 8 + num3;
			bool flag2 = false;
			for (int i = num7; i < num7 + num8; i++)
			{
				if (Main.tile[num6, i] == null)
				{
					Main.tile[num6, i] = new Tile();
				}
				if ((Main.tile[num6, i].nactive() && Main.tileSolid[Main.tile[num6, i].type]) || Main.tile[num6, i].liquid > 0)
				{
					if (i < num7 + 5 + num3)
					{
						flag2 = true;
					}
					flag = false;
					break;
				}
			}
			if (num2 < 400f && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
			{
				float num9 = 2f;
				float num10 = 0.035f;
				if (base.Center.Y + (float)(height / 4) > Main.player[target].position.Y + (float)(Main.player[target].height / 4) && velocity.Y > 0f - num9)
				{
					velocity.Y -= num10;
					if (velocity.Y > 0f)
					{
						velocity.Y -= num10;
					}
				}
				else if (base.Center.Y + (float)(height / 4) < Main.player[target].position.Y + (float)(Main.player[target].height / 4) && velocity.Y < num9)
				{
					velocity.Y += num10;
					if (velocity.Y < 0f)
					{
						velocity.Y += num10;
					}
				}
			}
			else
			{
				if (flag)
				{
					velocity.Y += 0.05f;
				}
				else
				{
					velocity.Y -= 0.1f;
				}
				if (flag2)
				{
					velocity.Y -= 0.2f;
				}
				if (velocity.Y > 2f)
				{
					velocity.Y = 2f;
				}
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
			}
			nPC.Center = base.Bottom + new Vector2(0f, -8f) + new Vector2(0f, 56f * ai[1]);
			nPC.velocity = velocity;
		}
		else
		{
			velocity.Y = MathHelper.Clamp(velocity.Y - 0.2f, -8f, 8f);
			velocity.X = MathHelper.Clamp(velocity.X + Main.windSpeedTarget * 0.3f, -4f, 4f);
			if (collideX || collideY)
			{
				float num11 = oldVelocity.X + (float)(direction * 8);
				position.X -= num11;
				TargetClosest(faceTarget: false);
				direction *= -1;
				velocity.X = direction * 2;
				life = -1;
				HitEffect();
				active = false;
				netUpdate = true;
				SoundEngine.PlaySound(DeathSound, position);
			}
		}
	}

	public NPC AI_113_WindyBalloon_GetSlaveNPC()
	{
		NPC nPC = null;
		int num = (int)ai[3];
		if (num >= 0 && num < Main.maxNPCs)
		{
			nPC = Main.npc[num];
			if (!nPC.active || nPC.type != 1 || nPC.ai[0] != -999f)
			{
				nPC = null;
				ai[3] = -1f;
				netUpdate = true;
			}
		}
		else
		{
			nPC = null;
		}
		return nPC;
	}

	private void AI_112_FairyCritter()
	{
		bool flag = false;
		lavaImmune = true;
		if (Main.netMode != 1 && ai[2] > 1f)
		{
			int num = 18000;
			localAI[1] += 1f;
			if (localAI[1] >= (float)num)
			{
				ai[2] = 7f;
				if (Main.player[target].Center.X < base.Center.X)
				{
					direction = 1;
				}
				else
				{
					direction = -1;
				}
				netUpdate = true;
			}
		}
		switch ((int)ai[2])
		{
		case 0:
		{
			lavaImmune = false;
			noTileCollide = false;
			if (ai[0] == 0f && ai[1] == 0f)
			{
				ai[0] = base.Center.X;
				ai[1] = base.Center.Y;
			}
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				velocity = new Vector2(MathHelper.Lerp(2f, 4f, Main.rand.NextFloat()) * (float)(Main.rand.Next(2) * 2 - 1), MathHelper.Lerp(1f, 2f, Main.rand.NextFloat()) * (float)(Main.rand.Next(2) * 2 - 1));
				velocity *= 0.7f;
				netUpdate = true;
			}
			Vector2 vector4 = new Vector2(ai[0], ai[1]) - base.Center;
			if (vector4.Length() > 20f)
			{
				Vector2 vector5 = new Vector2((vector4.X > 0f) ? 1 : (-1), (vector4.Y > 0f) ? 1 : (-1));
				velocity += vector5 * 0.04f;
				if (Math.Abs(velocity.Y) > 2f)
				{
					velocity.Y *= 0.95f;
				}
			}
			TargetClosest();
			Player player = Main.player[target];
			if (!player.dead && player.Distance(base.Center) < 250f)
			{
				ai[2] = 1f;
				direction = ((!(player.Center.X > base.Center.X)) ? 1 : (-1));
				if (velocity.X * (float)direction < 0f)
				{
					velocity.X = direction * 2;
				}
				ai[3] = 0f;
				netUpdate = true;
			}
			break;
		}
		case 1:
		{
			lavaImmune = false;
			noTileCollide = false;
			if (collideX)
			{
				direction *= -1;
				velocity.X = direction * 2;
			}
			if (collideY)
			{
				velocity.Y = ((oldVelocity.Y > 0f) ? 1 : (-1));
			}
			float num12 = 4.5f;
			if (Math.Sign(velocity.X) != direction || Math.Abs(velocity.X) < num12)
			{
				velocity.X += (float)direction * 0.04f;
				if (velocity.X * (float)direction < 0f)
				{
					if (Math.Abs(velocity.X) > num12)
					{
						velocity.X += (float)direction * 0.4f;
					}
					else
					{
						velocity.X += (float)direction * 0.2f;
					}
				}
				else if (Math.Abs(velocity.X) > num12)
				{
					velocity.X = (float)direction * num12;
				}
			}
			int num13 = (int)((position.X + (float)(width / 2)) / 16f);
			int num14 = 20;
			if (direction < 0)
			{
				num13 -= num14;
			}
			int num15 = (int)((position.Y + (float)height) / 16f);
			bool flag5 = true;
			int num16 = 8;
			bool flag6 = false;
			for (int i = num13; i <= num13 + num14; i++)
			{
				for (int j = num15; j < num15 + num16; j++)
				{
					if (Main.tile[i, j] == null)
					{
						Main.tile[i, j] = new Tile();
					}
					if ((Main.tile[i, j].nactive() && Main.tileSolid[Main.tile[i, j].type]) || Main.tile[i, j].liquid > 0)
					{
						if (j < num15 + 5)
						{
							flag6 = true;
						}
						flag5 = false;
						break;
					}
				}
			}
			if (flag5)
			{
				velocity.Y += 0.05f;
			}
			else
			{
				velocity.Y -= 0.2f;
			}
			if (flag6)
			{
				velocity.Y -= 0.3f;
			}
			if (velocity.Y > 3f)
			{
				velocity.Y = 3f;
			}
			if (velocity.Y < -5f)
			{
				velocity.Y = -5f;
			}
			break;
		}
		case 2:
		{
			noTileCollide = true;
			NPCAimedTarget targetData = GetTargetData();
			bool flag3 = false;
			if (targetData.Type == NPCTargetType.Player)
			{
				flag3 = Main.player[target].dead;
			}
			if (flag3)
			{
				ai[2] = 1f;
				direction = ((!(targetData.Center.X > base.Center.X)) ? 1 : (-1));
				if (velocity.X * (float)direction < 0f)
				{
					velocity.X = direction * 2;
				}
				ai[3] = 0f;
				netUpdate = true;
				break;
			}
			Rectangle r = Utils.CenteredRectangle(targetData.Center, new Vector2(targetData.Width + 60, targetData.Height / 2));
			if (Main.netMode != 1 && base.Hitbox.Intersects(r))
			{
				if (GetFairyTreasureCoords(out var treasureCoords2))
				{
					ai[0] = treasureCoords2.X;
					ai[1] = treasureCoords2.Y;
					ai[2] = 3f;
					ai[3] = 0f;
					netUpdate = true;
				}
				else
				{
					ai[2] = 6f;
					ai[3] = 0f;
					netUpdate = true;
				}
				break;
			}
			Vector2 vector3 = r.ClosestPointInRect(base.Center);
			Vector2 value = DirectionTo(vector3) * 2f;
			float num8 = Distance(vector3);
			if (num8 > 150f)
			{
				value *= 2f;
			}
			else if (num8 > 80f)
			{
				value *= 1.5f;
			}
			velocity = Vector2.Lerp(velocity, value, 0.07f);
			Point point = base.Center.ToTileCoordinates();
			if (ai[3] < 300f)
			{
				GetBirdFlightRecommendation(6, 3, point, out var goDownwards, out var goUpwards);
				if (goDownwards)
				{
					velocity.Y += 0.05f;
				}
				if (goUpwards)
				{
					velocity.Y -= 0.02f;
				}
				if (velocity.Y > 2f)
				{
					velocity.Y = 2f;
				}
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
			}
			if (WorldGen.InWorld(point.X, point.Y))
			{
				if (WorldGen.SolidTile(point))
				{
					ai[3] = Math.Min(ai[3] + 2f, 400f);
				}
				else
				{
					ai[3] = Math.Max(ai[3] - 1f, 0f);
				}
			}
			break;
		}
		case 3:
			noTileCollide = true;
			if (ai[3] == 15f)
			{
				SoundEngine.PlaySound(27, (int)position.X, (int)position.Y);
			}
			if (ai[3] <= 15f)
			{
				velocity *= 0.9f;
			}
			else
			{
				if (Main.player[target].Center.X > base.Center.X)
				{
					spriteDirection = -1;
				}
				else
				{
					spriteDirection = 1;
				}
				flag = true;
				float num6 = 0f;
				float num7 = ai[3] - 15f;
				float circleHeight = 22f;
				if (num7 <= 65f)
				{
					num6 = (float)Math.PI / 8f;
					circleHeight = 14f;
				}
				else if (num7 <= 130f)
				{
					num6 = -(float)Math.PI / 8f;
					circleHeight = 18f;
				}
				num6 *= (float)direction;
				Vector2 fairyCircleOffset3 = GetFairyCircleOffset(num7 / 65f, num6, circleHeight);
				Vector2 fairyCircleOffset4 = GetFairyCircleOffset(num7 / 65f + 1f / 65f, num6, circleHeight);
				velocity = fairyCircleOffset4 - fairyCircleOffset3;
			}
			ai[3] += 1f;
			if (ai[3] >= 210f)
			{
				ai[2] = 4f;
				TargetClosest();
				ai[3] = 0f;
				netUpdate = true;
			}
			break;
		case 6:
		{
			noTileCollide = true;
			Vector2 vector = Main.player[target].Center - base.Center;
			if (vector.Length() > 100f)
			{
				ai[2] = 2f;
				TargetClosest();
				ai[3] = 0f;
				netUpdate = true;
				break;
			}
			if (!Collision.SolidCollision(position, width, height))
			{
				noTileCollide = false;
				if (collideX)
				{
					velocity.X *= -1f;
				}
				if (collideY)
				{
					velocity.Y *= -1f;
				}
			}
			if (vector.Length() > 20f)
			{
				Vector2 vector2 = new Vector2((vector.X > 0f) ? 1 : (-1), (vector.Y > 0f) ? 1 : (-1));
				velocity += vector2 * 0.04f;
				if (Math.Abs(velocity.Y) > 2f)
				{
					velocity.Y *= 0.95f;
				}
			}
			if (Main.netMode != 1 && GetFairyTreasureCoords(out var treasureCoords))
			{
				ai[0] = treasureCoords.X;
				ai[1] = treasureCoords.Y;
				ai[2] = 3f;
				ai[3] = 0f;
				netUpdate = true;
			}
			break;
		}
		case 4:
		{
			noTileCollide = true;
			NPCAimedTarget targetData2 = GetTargetData();
			bool flag4 = false;
			if (targetData2.Type == NPCTargetType.Player)
			{
				flag4 = Main.player[target].dead;
			}
			if (flag4)
			{
				ai[2] = 1f;
				direction = ((!(targetData2.Center.X > base.Center.X)) ? 1 : (-1));
				if (velocity.X * (float)direction < 0f)
				{
					velocity.X = direction * 2;
				}
				ai[3] = 0f;
				netUpdate = true;
				break;
			}
			Rectangle r2 = Utils.CenteredRectangle(new Vector2(ai[0] * 16f + 8f, ai[1] * 16f + 8f), Vector2.One * 5f);
			if (base.Hitbox.Intersects(r2))
			{
				ai[2] = 5f;
				ai[3] = 0f;
				netUpdate = true;
				break;
			}
			float num9 = Distance(targetData2.Center);
			float num10 = 300f;
			if (num9 > num10)
			{
				if (num9 < num10 + 100f && !Collision.SolidCollision(position, width, height))
				{
					noTileCollide = false;
					if (collideX)
					{
						velocity.X *= -1f;
					}
					if (collideY)
					{
						velocity.Y *= -1f;
					}
				}
				flag = true;
				if (Main.player[target].Center.X > base.Center.X)
				{
					spriteDirection = -1;
				}
				else
				{
					spriteDirection = 1;
				}
				Vector2 vector6 = DirectionFrom(targetData2.Center);
				if (num9 > num10 + 60f)
				{
					velocity += vector6 * -0.1f;
					if (Main.rand.Next(30) == 0)
					{
						SoundEngine.PlaySound(27, (int)position.X, (int)position.Y);
					}
				}
				else if (num9 < num10 + 30f)
				{
					Vector2 destination = r2.ClosestPointInRect(base.Center);
					Vector2 vector7 = DirectionTo(destination);
					velocity += vector7 * 0.1f;
				}
				if (velocity.Length() > 1f)
				{
					velocity *= 1f / velocity.Length();
				}
				break;
			}
			Vector2 vector8 = r2.ClosestPointInRect(base.Center);
			Vector2 value2 = DirectionTo(vector8);
			float num11 = Distance(vector8);
			if (num11 > 150f)
			{
				value2 *= 3f;
			}
			else if (num11 > 80f)
			{
				value2 *= 2f;
			}
			Point point2 = base.Center.ToTileCoordinates();
			if (ai[3] < 300f)
			{
				velocity = Vector2.Lerp(velocity, value2, 0.07f);
				GetBirdFlightRecommendation(4, 2, point2, out var goDownwards2, out var goUpwards2);
				if (goDownwards2)
				{
					velocity.Y += 0.05f;
				}
				if (goUpwards2)
				{
					velocity.Y -= 0.05f;
				}
				if (velocity.Y > 1f)
				{
					velocity.Y = 1f;
				}
				if (velocity.Y < -1f)
				{
					velocity.Y = -1f;
				}
			}
			else
			{
				velocity = Vector2.Lerp(velocity, value2, 0.07f);
			}
			if (WorldGen.SolidTile(point2))
			{
				ai[3] = Math.Min(ai[3] + 2f, 400f);
			}
			else
			{
				ai[3] = Math.Max(ai[3] - 1f, 0f);
			}
			break;
		}
		case 5:
		{
			localAI[1] = 0f;
			noTileCollide = true;
			bool flag2 = false;
			Tile tileSafely = Framing.GetTileSafely(new Point((int)ai[0], (int)ai[1]));
			if (!tileSafely.active() || !SceneMetrics.IsValidForOreFinder(tileSafely))
			{
				flag2 = true;
			}
			if (ai[3] == 15f)
			{
				SoundEngine.PlaySound(27, (int)position.X, (int)position.Y);
			}
			if (ai[3] <= 15f)
			{
				velocity *= 0.9f;
			}
			else
			{
				flag = true;
				float num2 = 0f;
				float num3 = ai[3] - 15f;
				float num4 = 22f;
				int num5 = (int)(num3 / 50f);
				num2 = (float)Math.Cos((float)num5 * 1f) * ((float)Math.PI * 2f) / 16f;
				num4 = (float)Math.Cos((float)num5 * 2f) * 10f + 8f;
				num2 *= (float)direction;
				Vector2 fairyCircleOffset = GetFairyCircleOffset(num3 / 50f, num2, num4);
				Vector2 fairyCircleOffset2 = GetFairyCircleOffset(num3 / 50f + 0.02f, num2, num4);
				velocity = fairyCircleOffset2 - fairyCircleOffset;
				if (Main.player[target].Center.X > base.Center.X)
				{
					spriteDirection = -1;
				}
				else
				{
					spriteDirection = 1;
				}
			}
			ai[3] += 1f;
			if (Main.netMode != 1 && ai[3] > 200f)
			{
				active = false;
				if (Main.netMode == 0)
				{
					FairyEffects(base.Center, type - 583);
				}
				else if (Main.netMode == 2)
				{
					life = 0;
					NetMessage.SendData(23, -1, -1, null, whoAmI);
					NetMessage.SendData(112, -1, -1, null, 2, (int)base.Center.X, (int)base.Center.Y, 0f, type - 583);
				}
			}
			break;
		}
		case 7:
			noTileCollide = true;
			velocity.X += 0.05f * (float)direction;
			velocity.X = MathHelper.Clamp(velocity.X, -10f, 10f);
			velocity.Y -= 0.025f;
			velocity.Y = MathHelper.Clamp(velocity.Y, -5f, 5f);
			EncourageDespawn(10);
			break;
		}
		dontTakeDamage = (dontTakeDamageFromHostiles = ai[2] > 1f);
		for (int k = 0; k < Main.maxNPCs; k++)
		{
			if (k != whoAmI && Main.npc[k].active && Main.npc[k].aiStyle == 112 && Math.Abs(position.X - Main.npc[k].position.X) + Math.Abs(position.Y - Main.npc[k].position.Y) < (float)width * 1.5f)
			{
				if (position.Y < Main.npc[k].position.Y)
				{
					velocity.Y -= 0.05f;
				}
				else
				{
					velocity.Y += 0.05f;
				}
			}
		}
		if (!flag)
		{
			direction = ((velocity.X >= 0f) ? 1 : (-1));
			spriteDirection = -direction;
		}
		Color value3 = Color.HotPink;
		Color value4 = Color.LightPink;
		int num17 = 4;
		if (type == 584)
		{
			value3 = Color.LimeGreen;
			value4 = Color.LightSeaGreen;
		}
		if (type == 585)
		{
			value3 = Color.RoyalBlue;
			value4 = Color.LightBlue;
		}
		if ((int)Main.timeForVisualEffects % 2 == 0)
		{
			position += netOffset;
			Dust dust = Dust.NewDustDirect(base.Center - new Vector2(num17) * 0.5f, num17 + 4, num17 + 4, 278, 0f, 0f, 200, Color.Lerp(value3, value4, Main.rand.NextFloat()), 0.65f);
			dust.velocity *= 0f;
			dust.velocity += velocity * 0.3f;
			dust.noGravity = true;
			dust.noLight = true;
			position -= netOffset;
		}
		Lighting.AddLight(base.Center, value3.ToVector3() * 0.7f);
		if (Main.netMode != 2)
		{
			Player localPlayer = Main.LocalPlayer;
			if (!localPlayer.dead && localPlayer.HitboxForBestiaryNearbyCheck.Intersects(base.Hitbox))
			{
				AchievementsHelper.HandleSpecialEvent(localPlayer, 22);
			}
		}
	}

	public static void FairyEffects(Vector2 Position, int type)
	{
		Color value = Color.HotPink;
		Color value2 = Color.LightPink;
		int num = 4;
		if (type == 1)
		{
			value = Color.LimeGreen;
			value2 = Color.LightSeaGreen;
		}
		if (type == 2)
		{
			value = Color.RoyalBlue;
			value2 = Color.LightBlue;
		}
		for (int i = 0; i < 40; i++)
		{
			Dust dust = Dust.NewDustDirect(Position - new Vector2(num) * 0.5f, num + 4, num + 4, 278, 0f, 0f, 200, Color.Lerp(value, value2, Main.rand.NextFloat()), 0.65f);
			dust.velocity *= 1.5f;
			if (i >= 30)
			{
				dust.velocity *= 3.5f;
			}
			else if (i >= 20)
			{
				dust.velocity *= 2f;
			}
			dust.fadeIn = (float)Main.rand.Next(0, 17) * 0.1f;
			dust.noGravity = true;
		}
		SoundEngine.PlaySound(SoundID.Item4, (int)Position.X, (int)Position.Y);
	}

	private void GetBirdFlightRecommendation(int downScanRange, int upRange, Point tCoords, out bool goDownwards, out bool goUpwards)
	{
		tCoords.X += direction;
		goDownwards = true;
		goUpwards = false;
		int x = tCoords.X;
		for (int i = tCoords.Y; i < tCoords.Y + downScanRange && WorldGen.InWorld(x, i); i++)
		{
			Tile tile = Main.tile[x, i];
			if (tile == null)
			{
				break;
			}
			if ((tile.nactive() && Main.tileSolid[tile.type]) || tile.liquid > 0)
			{
				if (i < tCoords.Y + upRange)
				{
					goUpwards = true;
				}
				goDownwards = false;
				break;
			}
		}
	}

	private Vector2 GetFairyCircleOffset(float elapsedTime, float circleRotation, float circleHeight)
	{
		return ((((float)Math.PI * 2f * elapsedTime + (float)Math.PI / 2f).ToRotationVector2() + new Vector2(0f, -1f)) * new Vector2(6 * -direction, circleHeight)).RotatedBy(circleRotation);
	}

	private bool GetFairyTreasureCoords(out Point treasureCoords)
	{
		treasureCoords = default(Point);
		Point point = base.Center.ToTileCoordinates();
		Rectangle value = new Rectangle(point.X, point.Y, 1, 1);
		value.Inflate(75, 50);
		int num = 40;
		Rectangle value2 = new Rectangle(0, 0, Main.maxTilesX, Main.maxTilesY);
		value2.Inflate(-num, -num);
		value = Rectangle.Intersect(value, value2);
		int num2 = -1;
		float num3 = -1f;
		for (int i = value.Left; i <= value.Right; i++)
		{
			for (int j = value.Top; j <= value.Bottom; j++)
			{
				Tile tile = Main.tile[i, j];
				if (tile == null || !tile.active() || !TileID.Sets.FriendlyFairyCanLureTo[tile.type] || !SceneMetrics.IsValidForOreFinder(tile))
				{
					continue;
				}
				short num4 = Main.tileOreFinderPriority[tile.type];
				if (TileID.Sets.Ore[tile.type])
				{
					int num5 = 3;
					int num6 = 3;
					int num7 = 40;
					int num8 = 0;
					for (int k = i - num5; k <= i + num5; k++)
					{
						for (int l = j - num6; l <= j + num6; l++)
						{
							if (Main.tile[k, l].active() && Main.tile[k, l].type == tile.type)
							{
								num8++;
							}
						}
					}
					if (num8 < num7)
					{
						num4 = -1;
					}
				}
				if (num2 <= num4)
				{
					float num9 = Distance(new Vector2(i * 16 + 8, j * 16 + 8));
					if (num2 != num4 || !(num9 >= num3))
					{
						num2 = num4;
						num3 = num9;
						treasureCoords.X = i;
						treasureCoords.Y = j;
					}
				}
			}
		}
		return num2 != -1;
	}

	private void AI_069_DukeFishron()
	{
		bool expertMode = Main.expertMode;
		float num = (expertMode ? 1.2f : 1f);
		bool flag = (double)life <= (double)lifeMax * 0.5;
		bool flag2 = expertMode && (double)life <= (double)lifeMax * 0.15;
		bool flag3 = ai[0] > 4f;
		bool flag4 = ai[0] > 9f;
		int num2 = (flag3 ? 3 : 5);
		bool flag5 = ai[3] < (float)(num2 * 2);
		if (flag4)
		{
			damage = (int)((float)defDamage * 1.1f * num);
			defense = 0;
		}
		else if (flag3)
		{
			damage = (int)((float)defDamage * 1.2f * num);
			defense = (int)((float)defDefense * 0.8f);
		}
		else
		{
			damage = defDamage;
			defense = defDefense;
		}
		int num3 = (expertMode ? 40 : 60);
		float num4 = (expertMode ? 0.55f : 0.45f);
		float num5 = (expertMode ? 8.5f : 7.5f);
		if (flag4)
		{
			num4 = 0.7f;
			num5 = 12f;
			num3 = 30;
		}
		else if (flag3 && flag5)
		{
			num4 = (expertMode ? 0.6f : 0.5f);
			num5 = (expertMode ? 10f : 8f);
			num3 = (expertMode ? 40 : 20);
		}
		else if (flag5 && !flag3 && !flag4)
		{
			num3 = 30;
		}
		int num6 = (expertMode ? 28 : 30);
		float num7 = (expertMode ? 17f : 16f);
		if (flag4)
		{
			num6 = 25;
			num7 = 27f;
		}
		else if (flag5 && flag3)
		{
			num6 = (expertMode ? 27 : 30);
			if (expertMode)
			{
				num7 = 21f;
			}
		}
		int num8 = 80;
		int num9 = 4;
		float num10 = 0.3f;
		float num11 = 5f;
		int num12 = 90;
		int num13 = 180;
		int num14 = 180;
		int num15 = 30;
		int num16 = 120;
		int num17 = 4;
		float num18 = 6f;
		float num19 = 20f;
		float num20 = (float)Math.PI * 2f / (float)(num16 / 2);
		int num21 = 75;
		Vector2 center = base.Center;
		Player player = Main.player[target];
		if (target < 0 || target == 255 || player.dead || !player.active || Vector2.Distance(player.Center, center) > 5600f)
		{
			TargetClosest();
			player = Main.player[target];
			netUpdate = true;
		}
		if (player.dead || Vector2.Distance(player.Center, center) > 5600f)
		{
			velocity.Y -= 0.4f;
			EncourageDespawn(10);
			if (ai[0] > 4f)
			{
				ai[0] = 5f;
			}
			else
			{
				ai[0] = 0f;
			}
			ai[2] = 0f;
		}
		bool flag6 = player.position.Y < 800f || (double)player.position.Y > Main.worldSurface * 16.0 || (player.position.X > 6400f && player.position.X < (float)(Main.maxTilesX * 16 - 6400));
		if (flag6)
		{
			num3 = 10;
			damage = defDamage * 2;
			defense = defDefense * 2;
			num7 += 6f;
		}
		bool flag7 = true;
		if (localAI[0] == 0f)
		{
			localAI[0] = 1f;
			alpha = 255;
			rotation = 0f;
			if (Main.netMode != 1)
			{
				ai[0] = -1f;
				netUpdate = true;
			}
		}
		float num22 = (float)Math.Atan2(player.Center.Y - center.Y, player.Center.X - center.X);
		if (spriteDirection == 1)
		{
			num22 += (float)Math.PI;
		}
		if (num22 < 0f)
		{
			num22 += (float)Math.PI * 2f;
		}
		if (num22 > (float)Math.PI * 2f)
		{
			num22 -= (float)Math.PI * 2f;
		}
		if (ai[0] == -1f)
		{
			num22 = 0f;
		}
		if (ai[0] == 3f)
		{
			num22 = 0f;
		}
		if (ai[0] == 4f)
		{
			num22 = 0f;
		}
		if (ai[0] == 8f)
		{
			num22 = 0f;
		}
		float num23 = 0.04f;
		if (ai[0] == 1f || ai[0] == 6f)
		{
			num23 = 0f;
		}
		if (ai[0] == 7f)
		{
			num23 = 0f;
		}
		if (ai[0] == 3f)
		{
			num23 = 0.01f;
		}
		if (ai[0] == 4f)
		{
			num23 = 0.01f;
		}
		if (ai[0] == 8f)
		{
			num23 = 0.01f;
		}
		if (rotation < num22)
		{
			if ((double)(num22 - rotation) > Math.PI)
			{
				rotation -= num23;
			}
			else
			{
				rotation += num23;
			}
		}
		if (rotation > num22)
		{
			if ((double)(rotation - num22) > Math.PI)
			{
				rotation += num23;
			}
			else
			{
				rotation -= num23;
			}
		}
		if (rotation > num22 - num23 && rotation < num22 + num23)
		{
			rotation = num22;
		}
		if (rotation < 0f)
		{
			rotation += (float)Math.PI * 2f;
		}
		if (rotation > (float)Math.PI * 2f)
		{
			rotation -= (float)Math.PI * 2f;
		}
		if (rotation > num22 - num23 && rotation < num22 + num23)
		{
			rotation = num22;
		}
		if (ai[0] != -1f && ai[0] < 9f)
		{
			if (Collision.SolidCollision(position, width, height))
			{
				alpha += 15;
			}
			else
			{
				alpha -= 15;
			}
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (alpha > 150)
			{
				alpha = 150;
			}
		}
		if (ai[0] == -1f)
		{
			flag7 = false;
			velocity *= 0.98f;
			int num24 = Math.Sign(player.Center.X - center.X);
			if (num24 != 0)
			{
				direction = num24;
				spriteDirection = -direction;
			}
			if (ai[2] > 20f)
			{
				velocity.Y = -2f;
				alpha -= 5;
				if (Collision.SolidCollision(position, width, height))
				{
					alpha += 15;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (alpha > 150)
				{
					alpha = 150;
				}
			}
			if (ai[2] == (float)(num12 - 30))
			{
				int num25 = 36;
				for (int i = 0; i < num25; i++)
				{
					Vector2 vector = (Vector2.Normalize(velocity) * new Vector2((float)width / 2f, height) * 0.75f * 0.5f).RotatedBy((float)(i - (num25 / 2 - 1)) * ((float)Math.PI * 2f) / (float)num25) + base.Center;
					Vector2 vector2 = vector - base.Center;
					int num26 = Dust.NewDust(vector + vector2, 0, 0, 172, vector2.X * 2f, vector2.Y * 2f, 100, default(Color), 1.4f);
					Main.dust[num26].noGravity = true;
					Main.dust[num26].noLight = true;
					Main.dust[num26].velocity = Vector2.Normalize(vector2) * 3f;
				}
				SoundEngine.PlaySound(29, (int)center.X, (int)center.Y, 20);
			}
			ai[2] += 1f;
			if (ai[2] >= (float)num21)
			{
				ai[0] = 0f;
				ai[1] = 0f;
				ai[2] = 0f;
				netUpdate = true;
			}
		}
		else if (ai[0] == 0f && !player.dead)
		{
			if (ai[1] == 0f)
			{
				ai[1] = 300 * Math.Sign((center - player.Center).X);
			}
			Vector2 vector3 = Vector2.Normalize(player.Center + new Vector2(ai[1], -200f) - center - velocity) * num5;
			if (velocity.X < vector3.X)
			{
				velocity.X += num4;
				if (velocity.X < 0f && vector3.X > 0f)
				{
					velocity.X += num4;
				}
			}
			else if (velocity.X > vector3.X)
			{
				velocity.X -= num4;
				if (velocity.X > 0f && vector3.X < 0f)
				{
					velocity.X -= num4;
				}
			}
			if (velocity.Y < vector3.Y)
			{
				velocity.Y += num4;
				if (velocity.Y < 0f && vector3.Y > 0f)
				{
					velocity.Y += num4;
				}
			}
			else if (velocity.Y > vector3.Y)
			{
				velocity.Y -= num4;
				if (velocity.Y > 0f && vector3.Y < 0f)
				{
					velocity.Y -= num4;
				}
			}
			int num27 = Math.Sign(player.Center.X - center.X);
			if (num27 != 0)
			{
				if (ai[2] == 0f && num27 != direction)
				{
					rotation += (float)Math.PI;
				}
				direction = num27;
				if (spriteDirection != -direction)
				{
					rotation += (float)Math.PI;
				}
				spriteDirection = -direction;
			}
			ai[2] += 1f;
			if (ai[2] >= (float)num3)
			{
				int num28 = 0;
				switch ((int)ai[3])
				{
				case 0:
				case 1:
				case 2:
				case 3:
				case 4:
				case 5:
				case 6:
				case 7:
				case 8:
				case 9:
					num28 = 1;
					break;
				case 10:
					ai[3] = 1f;
					num28 = 2;
					break;
				case 11:
					ai[3] = 0f;
					num28 = 3;
					break;
				}
				if (flag6 && num28 == 2)
				{
					num28 = 3;
				}
				if (flag)
				{
					num28 = 4;
				}
				switch (num28)
				{
				case 1:
					ai[0] = 1f;
					ai[1] = 0f;
					ai[2] = 0f;
					velocity = Vector2.Normalize(player.Center - center) * num7;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X);
					if (num27 != 0)
					{
						direction = num27;
						if (spriteDirection == 1)
						{
							rotation += (float)Math.PI;
						}
						spriteDirection = -direction;
					}
					break;
				case 2:
					ai[0] = 2f;
					ai[1] = 0f;
					ai[2] = 0f;
					break;
				case 3:
					ai[0] = 3f;
					ai[1] = 0f;
					ai[2] = 0f;
					if (flag6)
					{
						ai[2] = num12 - 40;
					}
					break;
				case 4:
					ai[0] = 4f;
					ai[1] = 0f;
					ai[2] = 0f;
					break;
				}
				netUpdate = true;
			}
		}
		else if (ai[0] == 1f)
		{
			int num29 = 7;
			for (int j = 0; j < num29; j++)
			{
				Vector2 vector4 = (Vector2.Normalize(velocity) * new Vector2((float)(width + 50) / 2f, height) * 0.75f).RotatedBy((double)(j - (num29 / 2 - 1)) * Math.PI / (double)(float)num29) + center;
				Vector2 vector5 = ((float)(Main.rand.NextDouble() * 3.1415927410125732) - (float)Math.PI / 2f).ToRotationVector2() * Main.rand.Next(3, 8);
				int num30 = Dust.NewDust(vector4 + vector5, 0, 0, 172, vector5.X * 2f, vector5.Y * 2f, 100, default(Color), 1.4f);
				Main.dust[num30].noGravity = true;
				Main.dust[num30].noLight = true;
				Main.dust[num30].velocity /= 4f;
				Main.dust[num30].velocity -= velocity;
			}
			ai[2] += 1f;
			if (ai[2] >= (float)num6)
			{
				ai[0] = 0f;
				ai[1] = 0f;
				ai[2] = 0f;
				ai[3] += 2f;
				netUpdate = true;
			}
		}
		else if (ai[0] == 2f)
		{
			if (ai[1] == 0f)
			{
				ai[1] = 300 * Math.Sign((center - player.Center).X);
			}
			Vector2 vector6 = Vector2.Normalize(player.Center + new Vector2(ai[1], -200f) - center - velocity) * num11;
			if (velocity.X < vector6.X)
			{
				velocity.X += num10;
				if (velocity.X < 0f && vector6.X > 0f)
				{
					velocity.X += num10;
				}
			}
			else if (velocity.X > vector6.X)
			{
				velocity.X -= num10;
				if (velocity.X > 0f && vector6.X < 0f)
				{
					velocity.X -= num10;
				}
			}
			if (velocity.Y < vector6.Y)
			{
				velocity.Y += num10;
				if (velocity.Y < 0f && vector6.Y > 0f)
				{
					velocity.Y += num10;
				}
			}
			else if (velocity.Y > vector6.Y)
			{
				velocity.Y -= num10;
				if (velocity.Y > 0f && vector6.Y < 0f)
				{
					velocity.Y -= num10;
				}
			}
			if (ai[2] == 0f)
			{
				SoundEngine.PlaySound(29, (int)center.X, (int)center.Y, 20);
			}
			if (ai[2] % (float)num9 == 0f)
			{
				SoundEngine.PlaySound(4, (int)base.Center.X, (int)base.Center.Y, 19);
				if (Main.netMode != 1)
				{
					Vector2 vector7 = Vector2.Normalize(player.Center - center) * (width + 20) / 2f + center;
					NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)vector7.X, (int)vector7.Y + 45, 371);
				}
			}
			int num31 = Math.Sign(player.Center.X - center.X);
			if (num31 != 0)
			{
				direction = num31;
				if (spriteDirection != -direction)
				{
					rotation += (float)Math.PI;
				}
				spriteDirection = -direction;
			}
			ai[2] += 1f;
			if (ai[2] >= (float)num8)
			{
				ai[0] = 0f;
				ai[1] = 0f;
				ai[2] = 0f;
				netUpdate = true;
			}
		}
		else if (ai[0] == 3f)
		{
			velocity *= 0.98f;
			velocity.Y = MathHelper.Lerp(velocity.Y, 0f, 0.02f);
			if (ai[2] == (float)(num12 - 30))
			{
				SoundEngine.PlaySound(29, (int)center.X, (int)center.Y, 9);
			}
			if (Main.netMode != 1 && ai[2] == (float)(num12 - 30))
			{
				Vector2 vector8 = rotation.ToRotationVector2() * (Vector2.UnitX * direction) * (width + 20) / 2f + center;
				Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector8.X, vector8.Y, direction * 2, 8f, 385, 0, 0f, Main.myPlayer);
				Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector8.X, vector8.Y, -direction * 2, 8f, 385, 0, 0f, Main.myPlayer);
			}
			ai[2] += 1f;
			if (ai[2] >= (float)num12)
			{
				ai[0] = 0f;
				ai[1] = 0f;
				ai[2] = 0f;
				netUpdate = true;
			}
		}
		else if (ai[0] == 4f)
		{
			flag7 = false;
			velocity *= 0.98f;
			velocity.Y = MathHelper.Lerp(velocity.Y, 0f, 0.02f);
			if (ai[2] == (float)(num13 - 60))
			{
				SoundEngine.PlaySound(29, (int)center.X, (int)center.Y, 20);
			}
			ai[2] += 1f;
			if (ai[2] >= (float)num13)
			{
				ai[0] = 5f;
				ai[1] = 0f;
				ai[2] = 0f;
				ai[3] = 0f;
				netUpdate = true;
			}
		}
		else if (ai[0] == 5f && !player.dead)
		{
			if (ai[1] == 0f)
			{
				ai[1] = 300 * Math.Sign((center - player.Center).X);
			}
			Vector2 vector9 = Vector2.Normalize(player.Center + new Vector2(ai[1], -200f) - center - velocity) * num5;
			if (velocity.X < vector9.X)
			{
				velocity.X += num4;
				if (velocity.X < 0f && vector9.X > 0f)
				{
					velocity.X += num4;
				}
			}
			else if (velocity.X > vector9.X)
			{
				velocity.X -= num4;
				if (velocity.X > 0f && vector9.X < 0f)
				{
					velocity.X -= num4;
				}
			}
			if (velocity.Y < vector9.Y)
			{
				velocity.Y += num4;
				if (velocity.Y < 0f && vector9.Y > 0f)
				{
					velocity.Y += num4;
				}
			}
			else if (velocity.Y > vector9.Y)
			{
				velocity.Y -= num4;
				if (velocity.Y > 0f && vector9.Y < 0f)
				{
					velocity.Y -= num4;
				}
			}
			int num32 = Math.Sign(player.Center.X - center.X);
			if (num32 != 0)
			{
				if (ai[2] == 0f && num32 != direction)
				{
					rotation += (float)Math.PI;
				}
				direction = num32;
				if (spriteDirection != -direction)
				{
					rotation += (float)Math.PI;
				}
				spriteDirection = -direction;
			}
			ai[2] += 1f;
			if (ai[2] >= (float)num3)
			{
				int num33 = 0;
				switch ((int)ai[3])
				{
				case 0:
				case 1:
				case 2:
				case 3:
				case 4:
				case 5:
					num33 = 1;
					break;
				case 6:
					ai[3] = 1f;
					num33 = 2;
					break;
				case 7:
					ai[3] = 0f;
					num33 = 3;
					break;
				}
				if (flag2)
				{
					num33 = 4;
				}
				if (flag6 && num33 == 2)
				{
					num33 = 3;
				}
				switch (num33)
				{
				case 1:
					ai[0] = 6f;
					ai[1] = 0f;
					ai[2] = 0f;
					velocity = Vector2.Normalize(player.Center - center) * num7;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X);
					if (num32 != 0)
					{
						direction = num32;
						if (spriteDirection == 1)
						{
							rotation += (float)Math.PI;
						}
						spriteDirection = -direction;
					}
					break;
				case 2:
					velocity = Vector2.Normalize(player.Center - center) * num19;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X);
					if (num32 != 0)
					{
						direction = num32;
						if (spriteDirection == 1)
						{
							rotation += (float)Math.PI;
						}
						spriteDirection = -direction;
					}
					ai[0] = 7f;
					ai[1] = 0f;
					ai[2] = 0f;
					break;
				case 3:
					ai[0] = 8f;
					ai[1] = 0f;
					ai[2] = 0f;
					break;
				case 4:
					ai[0] = 9f;
					ai[1] = 0f;
					ai[2] = 0f;
					break;
				}
				netUpdate = true;
			}
		}
		else if (ai[0] == 6f)
		{
			int num34 = 7;
			for (int k = 0; k < num34; k++)
			{
				Vector2 vector10 = (Vector2.Normalize(velocity) * new Vector2((float)(width + 50) / 2f, height) * 0.75f).RotatedBy((double)(k - (num34 / 2 - 1)) * Math.PI / (double)(float)num34) + center;
				Vector2 vector11 = ((float)(Main.rand.NextDouble() * 3.1415927410125732) - (float)Math.PI / 2f).ToRotationVector2() * Main.rand.Next(3, 8);
				int num35 = Dust.NewDust(vector10 + vector11, 0, 0, 172, vector11.X * 2f, vector11.Y * 2f, 100, default(Color), 1.4f);
				Main.dust[num35].noGravity = true;
				Main.dust[num35].noLight = true;
				Main.dust[num35].velocity /= 4f;
				Main.dust[num35].velocity -= velocity;
			}
			ai[2] += 1f;
			if (ai[2] >= (float)num6)
			{
				ai[0] = 5f;
				ai[1] = 0f;
				ai[2] = 0f;
				ai[3] += 2f;
				netUpdate = true;
			}
		}
		else if (ai[0] == 7f)
		{
			if (ai[2] == 0f)
			{
				SoundEngine.PlaySound(29, (int)center.X, (int)center.Y, 20);
			}
			if (ai[2] % (float)num17 == 0f)
			{
				SoundEngine.PlaySound(4, (int)base.Center.X, (int)base.Center.Y, 19);
				if (Main.netMode != 1)
				{
					Vector2 vector12 = Vector2.Normalize(velocity) * (width + 20) / 2f + center;
					int num36 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)vector12.X, (int)vector12.Y + 45, 371);
					Main.npc[num36].target = target;
					Main.npc[num36].velocity = Vector2.Normalize(velocity).RotatedBy((float)Math.PI / 2f * (float)direction) * num18;
					Main.npc[num36].netUpdate = true;
					Main.npc[num36].ai[3] = (float)Main.rand.Next(80, 121) / 100f;
				}
			}
			velocity = velocity.RotatedBy((0f - num20) * (float)direction);
			rotation -= num20 * (float)direction;
			ai[2] += 1f;
			if (ai[2] >= (float)num16)
			{
				ai[0] = 5f;
				ai[1] = 0f;
				ai[2] = 0f;
				netUpdate = true;
			}
		}
		else if (ai[0] == 8f)
		{
			velocity *= 0.98f;
			velocity.Y = MathHelper.Lerp(velocity.Y, 0f, 0.02f);
			if (ai[2] == (float)(num12 - 30))
			{
				SoundEngine.PlaySound(29, (int)center.X, (int)center.Y, 20);
			}
			if (Main.netMode != 1 && ai[2] == (float)(num12 - 30))
			{
				Projectile.NewProjectile(GetSpawnSource_ForProjectile(), center.X, center.Y, 0f, 0f, 385, 0, 0f, Main.myPlayer, 1f, target + 1, flag6 ? 1 : 0);
			}
			ai[2] += 1f;
			if (ai[2] >= (float)num12)
			{
				ai[0] = 5f;
				ai[1] = 0f;
				ai[2] = 0f;
				netUpdate = true;
			}
		}
		else if (ai[0] == 9f)
		{
			flag7 = false;
			if (ai[2] < (float)(num14 - 90))
			{
				if (Collision.SolidCollision(position, width, height))
				{
					alpha += 15;
				}
				else
				{
					alpha -= 15;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (alpha > 150)
				{
					alpha = 150;
				}
			}
			else if (alpha < 255)
			{
				alpha += 4;
				if (alpha > 255)
				{
					alpha = 255;
				}
			}
			velocity *= 0.98f;
			velocity.Y = MathHelper.Lerp(velocity.Y, 0f, 0.02f);
			if (ai[2] == (float)(num14 - 60))
			{
				SoundEngine.PlaySound(29, (int)center.X, (int)center.Y, 20);
			}
			ai[2] += 1f;
			if (ai[2] >= (float)num14)
			{
				ai[0] = 10f;
				ai[1] = 0f;
				ai[2] = 0f;
				ai[3] = 0f;
				netUpdate = true;
			}
		}
		else if (ai[0] == 10f && !player.dead)
		{
			chaseable = false;
			if (alpha < 255)
			{
				alpha += 25;
				if (alpha > 255)
				{
					alpha = 255;
				}
			}
			if (ai[1] == 0f)
			{
				ai[1] = 360 * Math.Sign((center - player.Center).X);
			}
			Vector2 desiredVelocity = Vector2.Normalize(player.Center + new Vector2(ai[1], -200f) - center - velocity) * num5;
			SimpleFlyMovement(desiredVelocity, num4);
			int num37 = Math.Sign(player.Center.X - center.X);
			if (num37 != 0)
			{
				if (ai[2] == 0f && num37 != direction)
				{
					rotation += (float)Math.PI;
					for (int l = 0; l < oldPos.Length; l++)
					{
						oldPos[l] = Vector2.Zero;
					}
				}
				direction = num37;
				if (spriteDirection != -direction)
				{
					rotation += (float)Math.PI;
				}
				spriteDirection = -direction;
			}
			ai[2] += 1f;
			if (ai[2] >= (float)num3)
			{
				int num38 = 0;
				switch ((int)ai[3])
				{
				case 0:
				case 2:
				case 3:
				case 5:
				case 6:
				case 7:
					num38 = 1;
					break;
				case 1:
				case 4:
				case 8:
					num38 = 2;
					break;
				}
				switch (num38)
				{
				case 1:
					ai[0] = 11f;
					ai[1] = 0f;
					ai[2] = 0f;
					velocity = Vector2.Normalize(player.Center - center) * num7;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X);
					if (num37 != 0)
					{
						direction = num37;
						if (spriteDirection == 1)
						{
							rotation += (float)Math.PI;
						}
						spriteDirection = -direction;
					}
					break;
				case 2:
					ai[0] = 12f;
					ai[1] = 0f;
					ai[2] = 0f;
					break;
				case 3:
					ai[0] = 13f;
					ai[1] = 0f;
					ai[2] = 0f;
					break;
				}
				netUpdate = true;
			}
		}
		else if (ai[0] == 11f)
		{
			chaseable = true;
			alpha -= 25;
			if (alpha < 0)
			{
				alpha = 0;
			}
			int num39 = 7;
			for (int m = 0; m < num39; m++)
			{
				Vector2 vector13 = (Vector2.Normalize(velocity) * new Vector2((float)(width + 50) / 2f, height) * 0.75f).RotatedBy((double)(m - (num39 / 2 - 1)) * Math.PI / (double)(float)num39) + center;
				Vector2 vector14 = ((float)(Main.rand.NextDouble() * 3.1415927410125732) - (float)Math.PI / 2f).ToRotationVector2() * Main.rand.Next(3, 8);
				int num40 = Dust.NewDust(vector13 + vector14, 0, 0, 172, vector14.X * 2f, vector14.Y * 2f, 100, default(Color), 1.4f);
				Main.dust[num40].noGravity = true;
				Main.dust[num40].noLight = true;
				Main.dust[num40].velocity /= 4f;
				Main.dust[num40].velocity -= velocity;
			}
			ai[2] += 1f;
			if (ai[2] >= (float)num6)
			{
				ai[0] = 10f;
				ai[1] = 0f;
				ai[2] = 0f;
				ai[3] += 1f;
				netUpdate = true;
			}
		}
		else if (ai[0] == 12f)
		{
			flag7 = false;
			chaseable = false;
			if (alpha < 255)
			{
				alpha += 17;
				if (alpha > 255)
				{
					alpha = 255;
				}
			}
			velocity *= 0.98f;
			velocity.Y = MathHelper.Lerp(velocity.Y, 0f, 0.02f);
			if (ai[2] == (float)(num15 / 2))
			{
				SoundEngine.PlaySound(29, (int)center.X, (int)center.Y, 20);
			}
			if (Main.netMode != 1 && ai[2] == (float)(num15 / 2))
			{
				if (ai[1] == 0f)
				{
					ai[1] = 300 * Math.Sign((center - player.Center).X);
				}
				Vector2 vector15 = player.Center + new Vector2(0f - ai[1], -200f);
				Vector2 vector16 = (base.Center = vector15);
				center = vector16;
				int num41 = Math.Sign(player.Center.X - center.X);
				if (num41 != 0)
				{
					if (ai[2] == 0f && num41 != direction)
					{
						rotation += (float)Math.PI;
						for (int n = 0; n < oldPos.Length; n++)
						{
							oldPos[n] = Vector2.Zero;
						}
					}
					direction = num41;
					if (spriteDirection != -direction)
					{
						rotation += (float)Math.PI;
					}
					spriteDirection = -direction;
				}
			}
			ai[2] += 1f;
			if (ai[2] >= (float)num15)
			{
				ai[0] = 10f;
				ai[1] = 0f;
				ai[2] = 0f;
				ai[3] += 1f;
				if (ai[3] >= 9f)
				{
					ai[3] = 0f;
				}
				netUpdate = true;
			}
		}
		else if (ai[0] == 13f)
		{
			if (ai[2] == 0f)
			{
				SoundEngine.PlaySound(29, (int)center.X, (int)center.Y, 20);
			}
			velocity = velocity.RotatedBy((0f - num20) * (float)direction);
			rotation -= num20 * (float)direction;
			ai[2] += 1f;
			if (ai[2] >= (float)num16)
			{
				ai[0] = 10f;
				ai[1] = 0f;
				ai[2] = 0f;
				ai[3] += 1f;
				netUpdate = true;
			}
		}
		dontTakeDamage = !flag7;
	}

	private void AI_037_Destroyer()
	{
		int num = 0;
		int num2 = 10;
		if (IsMechQueenUp && type != 134)
		{
			int num3 = (int)ai[1];
			while (num3 > 0 && num3 < Main.maxNPCs)
			{
				if (Main.npc[num3].active && Main.npc[num3].type >= 134 && Main.npc[num3].type <= 136)
				{
					num++;
					if (Main.npc[num3].type == 134)
					{
						break;
					}
					if (num >= num2)
					{
						num = 0;
						break;
					}
					num3 = (int)Main.npc[num3].ai[1];
					continue;
				}
				num = 0;
				break;
			}
		}
		if (ai[3] > 0f)
		{
			realLife = (int)ai[3];
		}
		if (target < 0 || target == 255 || Main.player[target].dead)
		{
			TargetClosest();
		}
		if (type >= 134 && type <= 136)
		{
			velocity.Length();
			if (type == 134 || (type != 134 && Main.npc[(int)ai[1]].alpha < 128))
			{
				if (alpha != 0)
				{
					for (int i = 0; i < 2; i++)
					{
						int num4 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 182, 0f, 0f, 100, default(Color), 2f);
						Main.dust[num4].noGravity = true;
						Main.dust[num4].noLight = true;
					}
				}
				alpha -= 42;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
		}
		if (type > 134)
		{
			bool flag = false;
			if (ai[1] <= 0f)
			{
				flag = true;
			}
			else if (Main.npc[(int)ai[1]].life <= 0)
			{
				flag = true;
			}
			if (flag)
			{
				life = 0;
				HitEffect();
				checkDead();
			}
		}
		if (Main.netMode != 1)
		{
			if (ai[0] == 0f && type == 134)
			{
				ai[3] = whoAmI;
				realLife = whoAmI;
				int num5 = 0;
				int num6 = whoAmI;
				int destroyerSegmentsCount = GetDestroyerSegmentsCount();
				for (int j = 0; j <= destroyerSegmentsCount; j++)
				{
					int num7 = 135;
					if (j == destroyerSegmentsCount)
					{
						num7 = 136;
					}
					num5 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)(position.Y + (float)height), num7, whoAmI);
					Main.npc[num5].ai[3] = whoAmI;
					Main.npc[num5].realLife = whoAmI;
					Main.npc[num5].ai[1] = num6;
					Main.npc[num6].ai[0] = num5;
					NetMessage.SendData(23, -1, -1, null, num5);
					num6 = num5;
				}
			}
			if (type == 135)
			{
				localAI[0] += Main.rand.Next(4);
				if (localAI[0] >= (float)Main.rand.Next(1400, 26000))
				{
					localAI[0] = 0f;
					TargetClosest();
					if (Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
					{
						Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)(height / 2));
						float num8 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector.X + (float)Main.rand.Next(-20, 21);
						float num9 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector.Y + (float)Main.rand.Next(-20, 21);
						float num10 = (float)Math.Sqrt(num8 * num8 + num9 * num9);
						num10 = 8f / num10;
						num8 *= num10;
						num9 *= num10;
						num8 += (float)Main.rand.Next(-20, 21) * 0.05f;
						num9 += (float)Main.rand.Next(-20, 21) * 0.05f;
						int attackDamage_ForProjectiles = GetAttackDamage_ForProjectiles(22f, 18f);
						int num11 = 100;
						vector.X += num8 * 5f;
						vector.Y += num9 * 5f;
						int num12 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector.X, vector.Y, num8, num9, num11, attackDamage_ForProjectiles, 0f, Main.myPlayer);
						Main.projectile[num12].timeLeft = 300;
						netUpdate = true;
					}
				}
			}
		}
		int num13 = (int)(position.X / 16f) - 1;
		int num14 = (int)((position.X + (float)width) / 16f) + 2;
		int num15 = (int)(position.Y / 16f) - 1;
		int num16 = (int)((position.Y + (float)height) / 16f) + 2;
		if (num13 < 0)
		{
			num13 = 0;
		}
		if (num14 > Main.maxTilesX)
		{
			num14 = Main.maxTilesX;
		}
		if (num15 < 0)
		{
			num15 = 0;
		}
		if (num16 > Main.maxTilesY)
		{
			num16 = Main.maxTilesY;
		}
		bool flag2 = false;
		if (!flag2)
		{
			Vector2 vector2 = default(Vector2);
			for (int k = num13; k < num14; k++)
			{
				for (int l = num15; l < num16; l++)
				{
					if (Main.tile[k, l] != null && ((Main.tile[k, l].nactive() && (Main.tileSolid[Main.tile[k, l].type] || (Main.tileSolidTop[Main.tile[k, l].type] && Main.tile[k, l].frameY == 0))) || Main.tile[k, l].liquid > 64))
					{
						vector2.X = k * 16;
						vector2.Y = l * 16;
						if (position.X + (float)width > vector2.X && position.X < vector2.X + 16f && position.Y + (float)height > vector2.Y && position.Y < vector2.Y + 16f)
						{
							flag2 = true;
							break;
						}
					}
				}
			}
		}
		if (!flag2)
		{
			if (type != 135 || ai[2] != 1f)
			{
				Lighting.AddLight((int)((position.X + (float)(width / 2)) / 16f), (int)((position.Y + (float)(height / 2)) / 16f), 0.3f, 0.1f, 0.05f);
			}
			localAI[1] = 1f;
			if (type == 134)
			{
				Rectangle rectangle = new Rectangle((int)position.X, (int)position.Y, width, height);
				int num17 = 1000;
				bool flag3 = true;
				if (position.Y > Main.player[target].position.Y)
				{
					for (int m = 0; m < 255; m++)
					{
						if (Main.player[m].active)
						{
							Rectangle rectangle2 = new Rectangle((int)Main.player[m].position.X - num17, (int)Main.player[m].position.Y - num17, num17 * 2, num17 * 2);
							if (rectangle.Intersects(rectangle2))
							{
								flag3 = false;
								break;
							}
						}
					}
					if (flag3)
					{
						flag2 = true;
					}
				}
			}
		}
		else
		{
			localAI[1] = 0f;
		}
		float num18 = 16f;
		if (Main.IsItDay() || Main.player[target].dead)
		{
			flag2 = false;
			velocity.Y += 1f;
			if ((double)position.Y > Main.worldSurface * 16.0)
			{
				velocity.Y += 1f;
				num18 = 32f;
			}
			if ((double)position.Y > Main.rockLayer * 16.0)
			{
				for (int n = 0; n < Main.maxNPCs; n++)
				{
					if (Main.npc[n].aiStyle == aiStyle)
					{
						Main.npc[n].active = false;
					}
				}
			}
		}
		float num19 = 0.1f;
		float num20 = 0.15f;
		if (Main.getGoodWorld)
		{
			num19 *= 1.2f;
			num20 *= 1.2f;
		}
		Vector2 vector3 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
		float num21 = Main.player[target].position.X + (float)(Main.player[target].width / 2);
		float num22 = Main.player[target].position.Y + (float)(Main.player[target].height / 2);
		num21 = (int)(num21 / 16f) * 16;
		num22 = (int)(num22 / 16f) * 16;
		vector3.X = (int)(vector3.X / 16f) * 16;
		vector3.Y = (int)(vector3.Y / 16f) * 16;
		num21 -= vector3.X;
		num22 -= vector3.Y;
		float num23 = (float)Math.Sqrt(num21 * num21 + num22 * num22);
		if (ai[1] > 0f && ai[1] < (float)Main.npc.Length)
		{
			int num24 = (int)(44f * scale);
			try
			{
				vector3 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				num21 = Main.npc[(int)ai[1]].position.X + (float)(Main.npc[(int)ai[1]].width / 2) - vector3.X;
				num22 = Main.npc[(int)ai[1]].position.Y + (float)(Main.npc[(int)ai[1]].height / 2) - vector3.Y;
			}
			catch
			{
			}
			if (num > 0)
			{
				float num25 = (float)num24 - (float)num24 * (((float)num - 1f) * 0.1f);
				if (num25 < 0f)
				{
					num25 = 0f;
				}
				if (num25 > (float)num24)
				{
					num25 = num24;
				}
				num22 = Main.npc[(int)ai[1]].position.Y + (float)(Main.npc[(int)ai[1]].height / 2) + num25 - vector3.Y;
			}
			rotation = (float)Math.Atan2(num22, num21) + 1.57f;
			num23 = (float)Math.Sqrt(num21 * num21 + num22 * num22);
			if (num > 0)
			{
				num24 = num24 / num2 * num;
			}
			num23 = (num23 - (float)num24) / num23;
			num21 *= num23;
			num22 *= num23;
			velocity = Vector2.Zero;
			position.X += num21;
			position.Y += num22;
			num21 = Main.npc[(int)ai[1]].position.X + (float)(Main.npc[(int)ai[1]].width / 2) - vector3.X;
			num22 = Main.npc[(int)ai[1]].position.Y + (float)(Main.npc[(int)ai[1]].height / 2) - vector3.Y;
			rotation = (float)Math.Atan2(num22, num21) + 1.57f;
		}
		else
		{
			if (!flag2)
			{
				TargetClosest();
				velocity.Y += 0.15f;
				if (velocity.Y > num18)
				{
					velocity.Y = num18;
				}
				if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) < (double)num18 * 0.4)
				{
					if (velocity.X < 0f)
					{
						velocity.X -= num19 * 1.1f;
					}
					else
					{
						velocity.X += num19 * 1.1f;
					}
				}
				else if (velocity.Y == num18)
				{
					if (velocity.X < num21)
					{
						velocity.X += num19;
					}
					else if (velocity.X > num21)
					{
						velocity.X -= num19;
					}
				}
				else if (velocity.Y > 4f)
				{
					if (velocity.X < 0f)
					{
						velocity.X += num19 * 0.9f;
					}
					else
					{
						velocity.X -= num19 * 0.9f;
					}
				}
			}
			else
			{
				if (soundDelay == 0)
				{
					float num26 = num23 / 40f;
					if (num26 < 10f)
					{
						num26 = 10f;
					}
					if (num26 > 20f)
					{
						num26 = 20f;
					}
					soundDelay = (int)num26;
					SoundEngine.PlaySound(15, (int)position.X, (int)position.Y);
				}
				num23 = (float)Math.Sqrt(num21 * num21 + num22 * num22);
				float num27 = Math.Abs(num21);
				float num28 = Math.Abs(num22);
				float num29 = num18 / num23;
				num21 *= num29;
				num22 *= num29;
				if (((velocity.X > 0f && num21 > 0f) || (velocity.X < 0f && num21 < 0f)) && ((velocity.Y > 0f && num22 > 0f) || (velocity.Y < 0f && num22 < 0f)))
				{
					if (velocity.X < num21)
					{
						velocity.X += num20;
					}
					else if (velocity.X > num21)
					{
						velocity.X -= num20;
					}
					if (velocity.Y < num22)
					{
						velocity.Y += num20;
					}
					else if (velocity.Y > num22)
					{
						velocity.Y -= num20;
					}
				}
				if ((velocity.X > 0f && num21 > 0f) || (velocity.X < 0f && num21 < 0f) || (velocity.Y > 0f && num22 > 0f) || (velocity.Y < 0f && num22 < 0f))
				{
					if (velocity.X < num21)
					{
						velocity.X += num19;
					}
					else if (velocity.X > num21)
					{
						velocity.X -= num19;
					}
					if (velocity.Y < num22)
					{
						velocity.Y += num19;
					}
					else if (velocity.Y > num22)
					{
						velocity.Y -= num19;
					}
					if ((double)Math.Abs(num22) < (double)num18 * 0.2 && ((velocity.X > 0f && num21 < 0f) || (velocity.X < 0f && num21 > 0f)))
					{
						if (velocity.Y > 0f)
						{
							velocity.Y += num19 * 2f;
						}
						else
						{
							velocity.Y -= num19 * 2f;
						}
					}
					if ((double)Math.Abs(num21) < (double)num18 * 0.2 && ((velocity.Y > 0f && num22 < 0f) || (velocity.Y < 0f && num22 > 0f)))
					{
						if (velocity.X > 0f)
						{
							velocity.X += num19 * 2f;
						}
						else
						{
							velocity.X -= num19 * 2f;
						}
					}
				}
				else if (num27 > num28)
				{
					if (velocity.X < num21)
					{
						velocity.X += num19 * 1.1f;
					}
					else if (velocity.X > num21)
					{
						velocity.X -= num19 * 1.1f;
					}
					if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) < (double)num18 * 0.5)
					{
						if (velocity.Y > 0f)
						{
							velocity.Y += num19;
						}
						else
						{
							velocity.Y -= num19;
						}
					}
				}
				else
				{
					if (velocity.Y < num22)
					{
						velocity.Y += num19 * 1.1f;
					}
					else if (velocity.Y > num22)
					{
						velocity.Y -= num19 * 1.1f;
					}
					if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) < (double)num18 * 0.5)
					{
						if (velocity.X > 0f)
						{
							velocity.X += num19;
						}
						else
						{
							velocity.X -= num19;
						}
					}
				}
			}
			rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
			if (type == 134)
			{
				if (flag2)
				{
					if (localAI[0] != 1f)
					{
						netUpdate = true;
					}
					localAI[0] = 1f;
				}
				else
				{
					if (localAI[0] != 0f)
					{
						netUpdate = true;
					}
					localAI[0] = 0f;
				}
				if (((velocity.X > 0f && oldVelocity.X < 0f) || (velocity.X < 0f && oldVelocity.X > 0f) || (velocity.Y > 0f && oldVelocity.Y < 0f) || (velocity.Y < 0f && oldVelocity.Y > 0f)) && !justHit)
				{
					netUpdate = true;
				}
			}
		}
		if (IsMechQueenUp && type == 134)
		{
			NPC nPC = Main.npc[mechQueen];
			Vector2 mechQueenCenter = nPC.GetMechQueenCenter();
			Vector2 vector4 = new Vector2(0f, 100f);
			Vector2 spinningpoint = mechQueenCenter + vector4;
			float num30 = nPC.velocity.X * 0.025f;
			spinningpoint = spinningpoint.RotatedBy(num30, mechQueenCenter);
			position = spinningpoint - base.Size / 2f + nPC.velocity;
			velocity.X = 0f;
			velocity.Y = 0f;
			rotation = num30 * 0.75f + (float)Math.PI;
		}
	}

	private void AI_005_EaterOfSouls()
	{
		if (type == 210 || type == 211)
		{
			NPCUtils.TargetClosestNonBees(this);
		}
		else if (target < 0 || target <= 255 || Main.player[target].dead)
		{
			TargetClosest();
		}
		if (type == 619)
		{
			if (Main.dayTime)
			{
				velocity.Y -= 0.3f;
				EncourageDespawn(60);
			}
			position += netOffset;
			if (alpha == 255)
			{
				spriteDirection = direction;
				velocity.Y = -6f;
				for (int i = 0; i < 35; i++)
				{
					Dust dust = Dust.NewDustDirect(position, width, height, 5);
					dust.velocity *= 1f;
					dust.scale = 1f + Main.rand.NextFloat() * 0.5f;
					dust.fadeIn = 1.5f + Main.rand.NextFloat() * 0.5f;
					dust.velocity += velocity * 0.5f;
				}
			}
			alpha -= 15;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (alpha != 0)
			{
				for (int j = 0; j < 2; j++)
				{
					Dust dust2 = Dust.NewDustDirect(position, width, height, 5);
					dust2.velocity *= 1f;
					dust2.scale = 1f + Main.rand.NextFloat() * 0.5f;
					dust2.fadeIn = 1.5f + Main.rand.NextFloat() * 0.5f;
					dust2.velocity += velocity * 0.3f;
				}
			}
			position -= netOffset;
		}
		NPCAimedTarget targetData = GetTargetData();
		bool flag = false;
		if (targetData.Type == NPCTargetType.Player)
		{
			flag = Main.player[target].dead;
		}
		float num = 6f;
		float num2 = 0.05f;
		if (type == 6 || type == 173)
		{
			num = 4f;
			num2 = 0.02f;
			if (type == 6 && Main.expertMode)
			{
				num2 = 0.035f;
			}
			if (Main.remixWorld)
			{
				num2 = 0.06f;
				num = 5f;
			}
		}
		else if (type == 94)
		{
			num = 4.2f;
			num2 = 0.022f;
		}
		else if (type == 619)
		{
			num = 6f;
			num2 = 0.1f;
		}
		else if (type == 252)
		{
			if (targetData.Type != NPCTargetType.None && Collision.CanHit(this, targetData))
			{
				num = 6f;
				num2 = 0.1f;
			}
			else
			{
				num2 = 0.01f;
				num = 2f;
			}
		}
		else if (type == 42 || (type >= 231 && type <= 235))
		{
			num = 3.5f;
			num2 = 0.021f;
			if (type == 231)
			{
				num = 3f;
				num2 = 0.017f;
			}
			num *= 1f - scale;
			num2 *= 1f - scale;
			if ((double)(position.Y / 16f) < Main.worldSurface)
			{
				if (Main.player[target].position.Y - position.Y > 300f && velocity.Y < 0f)
				{
					velocity.Y *= 0.97f;
				}
				if (Main.player[target].position.Y - position.Y < 80f && velocity.Y > 0f)
				{
					velocity.Y *= 0.97f;
				}
			}
		}
		else if (type == 205)
		{
			num = 3.25f;
			num2 = 0.018f;
		}
		else if (type == 176)
		{
			num = 4f;
			num2 = 0.017f;
		}
		else if (type == 23)
		{
			num = 1f;
			num2 = 0.03f;
		}
		else if (type == 5)
		{
			num = 5f;
			num2 = 0.03f;
		}
		else if (type == 210 || type == 211)
		{
			ai[1] += 1f;
			float num3 = (ai[1] - 60f) / 60f;
			if (num3 > 1f)
			{
				num3 = 1f;
			}
			else
			{
				if (velocity.X > 6f)
				{
					velocity.X = 6f;
				}
				if (velocity.X < -6f)
				{
					velocity.X = -6f;
				}
				if (velocity.Y > 6f)
				{
					velocity.Y = 6f;
				}
				if (velocity.Y < -6f)
				{
					velocity.Y = -6f;
				}
			}
			num = 5f;
			num2 = 0.1f;
			num2 *= num3;
		}
		else if (type == 139 && Main.zenithWorld)
		{
			num = 3f;
		}
		Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
		float num4 = targetData.Position.X + (float)(targetData.Width / 2);
		float num5 = targetData.Position.Y + (float)(targetData.Height / 2);
		num4 = (int)(num4 / 8f) * 8;
		num5 = (int)(num5 / 8f) * 8;
		vector.X = (int)(vector.X / 8f) * 8;
		vector.Y = (int)(vector.Y / 8f) * 8;
		num4 -= vector.X;
		num5 -= vector.Y;
		float num6 = (float)Math.Sqrt(num4 * num4 + num5 * num5);
		float num7 = num6;
		bool flag2 = false;
		if (num6 > 600f)
		{
			flag2 = true;
		}
		if (num6 == 0f)
		{
			num4 = velocity.X;
			num5 = velocity.Y;
		}
		else
		{
			num6 = num / num6;
			num4 *= num6;
			num5 *= num6;
		}
		bool num8 = type == 6 || type == 139 || type == 173 || type == 205;
		bool flag3 = type == 42 || type == 94 || type == 619 || type == 176 || type == 210 || type == 211 || (type >= 231 && type <= 235);
		bool flag4 = type != 173 && type != 6 && type != 42 && (type < 231 || type > 235) && type != 94 && type != 139 && type != 619;
		if (num8 || flag3)
		{
			if (num7 > 100f || flag3)
			{
				ai[0] += 1f;
				if (ai[0] > 0f)
				{
					velocity.Y += 0.023f;
				}
				else
				{
					velocity.Y -= 0.023f;
				}
				if (ai[0] < -100f || ai[0] > 100f)
				{
					velocity.X += 0.023f;
				}
				else
				{
					velocity.X -= 0.023f;
				}
				if (ai[0] > 200f)
				{
					ai[0] = -200f;
				}
			}
			if (num7 < 150f && (type == 6 || type == 94 || type == 173 || type == 619))
			{
				velocity.X += num4 * 0.007f;
				velocity.Y += num5 * 0.007f;
			}
		}
		if (flag)
		{
			num4 = (float)direction * num / 2f;
			num5 = (0f - num) / 2f;
		}
		else if (type == 619 && base.Center.Y > targetData.Center.Y - 200f)
		{
			velocity.Y -= 0.3f;
		}
		if (type == 139 && ai[3] != 0f)
		{
			if (IsMechQueenUp)
			{
				NPC nPC = Main.npc[mechQueen];
				Vector2 vector2 = new Vector2(26f * ai[3], 0f);
				int num9 = (int)ai[2];
				if (num9 < 0 || num9 >= Main.maxNPCs)
				{
					num9 = FindFirstNPC(134);
					ai[2] = num9;
					netUpdate = true;
				}
				if (num9 > -1)
				{
					NPC nPC2 = Main.npc[num9];
					if (!nPC2.active || nPC2.type != 134)
					{
						dontTakeDamage = false;
						if (ai[3] > 0f)
						{
							netUpdate = true;
						}
						ai[3] = 0f;
					}
					else
					{
						Vector2 spinningpoint = nPC2.Center + vector2;
						spinningpoint = spinningpoint.RotatedBy(nPC2.rotation, nPC2.Center);
						base.Center = spinningpoint;
						velocity = nPC.velocity;
						dontTakeDamage = true;
					}
				}
				else
				{
					dontTakeDamage = false;
					if (ai[3] > 0f)
					{
						netUpdate = true;
					}
					ai[3] = 0f;
				}
			}
			else
			{
				dontTakeDamage = false;
				if (ai[3] > 0f)
				{
					netUpdate = true;
				}
				ai[3] = 0f;
			}
		}
		else
		{
			if (type == 139)
			{
				dontTakeDamage = false;
			}
			if (velocity.X < num4)
			{
				velocity.X += num2;
				if (flag4 && velocity.X < 0f && num4 > 0f)
				{
					velocity.X += num2;
				}
			}
			else if (velocity.X > num4)
			{
				velocity.X -= num2;
				if (flag4 && velocity.X > 0f && num4 < 0f)
				{
					velocity.X -= num2;
				}
			}
			if (velocity.Y < num5)
			{
				velocity.Y += num2;
				if (flag4 && velocity.Y < 0f && num5 > 0f)
				{
					velocity.Y += num2;
				}
			}
			else if (velocity.Y > num5)
			{
				velocity.Y -= num2;
				if (flag4 && velocity.Y > 0f && num5 < 0f)
				{
					velocity.Y -= num2;
				}
			}
		}
		if (type == 23)
		{
			if (num4 > 0f)
			{
				spriteDirection = 1;
				rotation = (float)Math.Atan2(num5, num4);
			}
			else if (num4 < 0f)
			{
				spriteDirection = -1;
				rotation = (float)Math.Atan2(num5, num4) + 3.14f;
			}
		}
		else if (type == 139)
		{
			localAI[0] += 1f;
			if (ai[3] != 0f)
			{
				localAI[0] += 2f;
			}
			if (justHit)
			{
				localAI[0] = 0f;
			}
			float num10 = 120f;
			if (IsMechQueenUp)
			{
				num10 = 360f;
			}
			if (Main.netMode != 1 && localAI[0] >= num10)
			{
				localAI[0] = 0f;
				if (targetData.Type != NPCTargetType.None && Collision.CanHit(this, targetData))
				{
					int attackDamage_ForProjectiles = GetAttackDamage_ForProjectiles(25f, 22f);
					int num11 = 84;
					Vector2 vector3 = new Vector2(num4, num5);
					if (IsMechQueenUp)
					{
						Vector2 v = targetData.Center - base.Center - targetData.Velocity * 20f;
						float num12 = 8f;
						vector3 = v.SafeNormalize(Vector2.UnitY) * num12;
					}
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector.X, vector.Y, vector3.X, vector3.Y, num11, attackDamage_ForProjectiles, 0f, Main.myPlayer);
				}
			}
			int num13 = (int)position.X + width / 2;
			int num14 = (int)position.Y + height / 2;
			num13 /= 16;
			num14 /= 16;
			if (WorldGen.InWorld(num13, num14) && !WorldGen.SolidTile(num13, num14))
			{
				Lighting.AddLight((int)((position.X + (float)(width / 2)) / 16f), (int)((position.Y + (float)(height / 2)) / 16f), 0.3f, 0.1f, 0.05f);
			}
			if (num4 > 0f)
			{
				spriteDirection = 1;
				rotation = (float)Math.Atan2(num5, num4);
			}
			if (num4 < 0f)
			{
				spriteDirection = -1;
				rotation = (float)Math.Atan2(num5, num4) + 3.14f;
			}
		}
		else if (type == 6 || type == 94 || type == 173 || type == 619)
		{
			rotation = (float)Math.Atan2(num5, num4) - 1.57f;
		}
		else if (type == 42 || type == 176 || type == 205 || (type >= 231 && type <= 235))
		{
			if (velocity.X > 0f)
			{
				spriteDirection = 1;
			}
			if (velocity.X < 0f)
			{
				spriteDirection = -1;
			}
			rotation = velocity.X * 0.1f;
		}
		else
		{
			rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
		}
		if (type == 6 || type == 619 || type == 23 || type == 42 || type == 94 || type == 139 || type == 173 || type == 176 || type == 205 || type == 210 || type == 211 || (type >= 231 && type <= 235))
		{
			float num15 = 0.7f;
			if (type == 6 || type == 173)
			{
				num15 = 0.4f;
			}
			if (collideX)
			{
				netUpdate = true;
				velocity.X = oldVelocity.X * (0f - num15);
				if (direction == -1 && velocity.X > 0f && velocity.X < 2f)
				{
					velocity.X = 2f;
				}
				if (direction == 1 && velocity.X < 0f && velocity.X > -2f)
				{
					velocity.X = -2f;
				}
			}
			if (collideY)
			{
				netUpdate = true;
				velocity.Y = oldVelocity.Y * (0f - num15);
				if (velocity.Y > 0f && (double)velocity.Y < 1.5)
				{
					velocity.Y = 2f;
				}
				if (velocity.Y < 0f && (double)velocity.Y > -1.5)
				{
					velocity.Y = -2f;
				}
			}
			position += netOffset;
			if (type == 619)
			{
				int num16 = Dust.NewDust(position, width, height, 5, velocity.X * 0.2f, velocity.Y * 0.2f, 100);
				Main.dust[num16].velocity *= 0.5f;
			}
			else if (type != 42 && type != 139 && type != 176 && type != 205 && type != 210 && type != 211 && type != 252 && (type < 231 || type > 235) && Main.rand.Next(20) == 0)
			{
				int num17 = 18;
				if (type == 173)
				{
					num17 = 5;
				}
				int num18 = Dust.NewDust(new Vector2(position.X, position.Y + (float)height * 0.25f), width, (int)((float)height * 0.5f), num17, velocity.X, 2f, 75, color, scale);
				Main.dust[num18].velocity.X *= 0.5f;
				Main.dust[num18].velocity.Y *= 0.1f;
			}
			position -= netOffset;
		}
		else if (type != 252 && Main.rand.Next(40) == 0)
		{
			int num19 = Dust.NewDust(new Vector2(position.X, position.Y + (float)height * 0.25f), width, (int)((float)height * 0.5f), 5, velocity.X, 2f);
			Main.dust[num19].velocity.X *= 0.5f;
			Main.dust[num19].velocity.Y *= 0.1f;
		}
		if ((type == 6 || type == 94 || type == 173 || type == 619) && wet)
		{
			if (velocity.Y > 0f)
			{
				velocity.Y *= 0.95f;
			}
			velocity.Y -= 0.3f;
			if (velocity.Y < -2f)
			{
				velocity.Y = -2f;
			}
		}
		if (type == 205 && wet)
		{
			if (velocity.Y > 0f)
			{
				velocity.Y *= 0.95f;
			}
			velocity.Y -= 0.5f;
			if (velocity.Y < -4f)
			{
				velocity.Y = -4f;
			}
			TargetClosest();
		}
		if (type == 42 || type == 176 || (type >= 231 && type <= 235))
		{
			if (wet)
			{
				if (velocity.Y > 0f)
				{
					velocity.Y *= 0.95f;
				}
				velocity.Y -= 0.5f;
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
				TargetClosest();
			}
			if (ai[1] == 101f)
			{
				SoundEngine.PlaySound(SoundID.Item17, position);
				ai[1] = 0f;
			}
			if (Main.netMode != 1)
			{
				ai[1] += (float)Main.rand.Next(5, 20) * 0.1f * scale;
				if (type == 176)
				{
					ai[1] += (float)Main.rand.Next(5, 20) * 0.1f * scale;
				}
				if (Main.getGoodWorld)
				{
					ai[1] += (float)Main.rand.Next(5, 20) * 0.1f * scale;
				}
				if (targetData.Type == NPCTargetType.Player)
				{
					Player player = Main.player[target];
					if (player != null && player.stealth == 0f && player.itemAnimation == 0)
					{
						ai[1] = 0f;
					}
				}
				if (ai[1] >= 130f)
				{
					if (targetData.Type != NPCTargetType.None && Collision.CanHit(this, targetData))
					{
						float num20 = 8f;
						Vector2 vector4 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)(height / 2));
						float num21 = targetData.Center.X - vector4.X + (float)Main.rand.Next(-20, 21);
						float num22 = targetData.Center.Y - vector4.Y + (float)Main.rand.Next(-20, 21);
						if ((num21 < 0f && velocity.X < 0f) || (num21 > 0f && velocity.X > 0f))
						{
							float num23 = (float)Math.Sqrt(num21 * num21 + num22 * num22);
							num23 = num20 / num23;
							num21 *= num23;
							num22 *= num23;
							int num24 = (int)(10f * scale);
							if (type == 176)
							{
								num24 = (int)(30f * scale);
							}
							int num25 = 55;
							int num26 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector4.X, vector4.Y, num21, num22, num25, num24, 0f, Main.myPlayer);
							Main.projectile[num26].timeLeft = 300;
							ai[1] = 101f;
							netUpdate = true;
						}
						else
						{
							ai[1] = 0f;
						}
					}
					else
					{
						ai[1] = 0f;
					}
				}
			}
		}
		if (type == 139 && flag2)
		{
			if ((velocity.X > 0f && num4 > 0f) || (velocity.X < 0f && num4 < 0f))
			{
				int num27 = 12;
				if (IsMechQueenUp)
				{
					num27 = 5;
				}
				if (Math.Abs(velocity.X) < (float)num27)
				{
					velocity.X *= 1.05f;
				}
			}
			else
			{
				velocity.X *= 0.9f;
			}
		}
		if (type == 139 && IsMechQueenUp && ai[2] == 0f)
		{
			Vector2 center = GetTargetData().Center;
			Vector2 v2 = center - base.Center;
			int num28 = 120;
			if (v2.Length() < (float)num28)
			{
				base.Center = center - v2.SafeNormalize(Vector2.UnitY) * num28;
			}
		}
		if (Main.netMode != 1)
		{
			if (Main.getGoodWorld && type == 6 && AnyNPCs(13))
			{
				if (justHit)
				{
					localAI[0] = 0f;
				}
				localAI[0] += 1f;
				if (localAI[0] == 60f)
				{
					if (targetData.Type != NPCTargetType.None && Collision.CanHit(this, targetData))
					{
						NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2) + velocity.X), (int)(position.Y + (float)(height / 2) + velocity.Y), 666);
					}
					localAI[0] = 0f;
				}
			}
			if (type == 94 && !flag)
			{
				if (justHit)
				{
					localAI[0] = 0f;
				}
				localAI[0] += 1f;
				if (localAI[0] == 180f)
				{
					if (targetData.Type != NPCTargetType.None && Collision.CanHit(this, targetData))
					{
						NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2) + velocity.X), (int)(position.Y + (float)(height / 2) + velocity.Y), 112);
					}
					localAI[0] = 0f;
				}
			}
			if (type == 619 && !flag)
			{
				if (justHit)
				{
					localAI[0] += 10f;
				}
				localAI[0] += 1f;
				if (localAI[0] >= 120f)
				{
					if (targetData.Type != NPCTargetType.None && Collision.CanHit(this, targetData))
					{
						if ((base.Center - targetData.Center).Length() < 400f)
						{
							Vector2 vector5 = DirectionTo(new Vector2(targetData.Center.X, targetData.Position.Y));
							velocity = -vector5 * 5f;
							netUpdate = true;
							localAI[0] = 0f;
							vector5 = DirectionTo(new Vector2(targetData.Center.X + (float)Main.rand.Next(-100, 101), targetData.Position.Y + (float)Main.rand.Next(-100, 101)));
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center, vector5 * 15f, 811, 35, 1f, Main.myPlayer);
						}
						else
						{
							localAI[0] = 50f;
						}
					}
					else
					{
						localAI[0] = 50f;
					}
				}
			}
		}
		if ((Main.IsItDay() && type != 173 && type != 619 && type != 6 && type != 23 && type != 42 && type != 94 && type != 176 && type != 205 && type != 210 && type != 211 && type != 252 && (type < 231 || type > 235)) || flag)
		{
			velocity.Y -= num2 * 2f;
			EncourageDespawn(10);
		}
		if (((velocity.X > 0f && oldVelocity.X < 0f) || (velocity.X < 0f && oldVelocity.X > 0f) || (velocity.Y > 0f && oldVelocity.Y < 0f) || (velocity.Y < 0f && oldVelocity.Y > 0f)) && !justHit)
		{
			netUpdate = true;
		}
	}

	public void CopyInteractions(NPC npc)
	{
		for (int i = 0; i < playerInteraction.Length; i++)
		{
			playerInteraction[i] = npc.playerInteraction[i];
		}
		lastInteraction = npc.lastInteraction;
	}

	public static int GetEaterOfWorldsSegmentsCount()
	{
		if (!Main.expertMode)
		{
			return 65;
		}
		return 70;
	}

	public static int GetBrainOfCthuluCreepersCount()
	{
		if (Main.getGoodWorld)
		{
			return 40;
		}
		return 20;
	}

	public static int GetDestroyerSegmentsCount()
	{
		if (Main.getGoodWorld)
		{
			return 100;
		}
		return 80;
	}

	public Vector2 GetMechQueenCenter()
	{
		if (IsMechQueenUp && type == 127)
		{
			return base.Center + new Vector2(0f, -14f);
		}
		return base.Center;
	}

	private void AI_006_Worms()
	{
		if (type == 117 && localAI[1] == 0f)
		{
			localAI[1] = 1f;
			SoundEngine.PlaySound(SoundID.NPCDeath13, position);
			int num = 1;
			if (velocity.X < 0f)
			{
				num = -1;
			}
			for (int i = 0; i < 20; i++)
			{
				Dust.NewDust(new Vector2(position.X - 20f, position.Y - 20f), width + 40, height + 40, 5, num * 8, -1f);
			}
		}
		if (type == 454 && localAI[3] == 0f)
		{
			SoundEngine.PlaySound(SoundID.Item119, position);
			localAI[3] = 1f;
		}
		if (type >= 454 && type <= 459)
		{
			dontTakeDamage = alpha > 0;
			if (type == 454 || (type != 454 && Main.npc[(int)ai[1]].alpha < 85))
			{
				if (dontTakeDamage)
				{
					for (int j = 0; j < 2; j++)
					{
						int num2 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 228, 0f, 0f, 100, default(Color), 2f);
						Main.dust[num2].noGravity = true;
						Main.dust[num2].noLight = true;
					}
				}
				alpha -= 42;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
		}
		if (type >= 621 && type <= 623)
		{
			position += netOffset;
			dontTakeDamage = alpha > 0;
			if (type == 621 || (type != 621 && Main.npc[(int)ai[1]].alpha < 85))
			{
				if (dontTakeDamage)
				{
					for (int k = 0; k < 2; k++)
					{
						Dust.NewDust(position, width, height, 5, 0f, 0f, 100);
					}
				}
				alpha -= 42;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			if (alpha == 0 && Main.rand.Next(5) == 0)
			{
				Dust.NewDust(position, width, height, 5, 0f, 0f, 100);
			}
			position -= netOffset;
		}
		else if (type == 402)
		{
			ai[2] += 1f;
			float num3 = 600f;
			float num4 = num3 - 30f;
			if (velocity.Length() >= 1f && ai[2] <= num4)
			{
				velocity *= Utils.Remap(ai[2], num4 * 0.5f, num4, 1f, 0.5f);
			}
			if (ai[2] == num4)
			{
				for (int l = 0; l < 50; l++)
				{
					Vector2 vector = Main.rand.NextVector2Circular(8f, 8f);
					if (Main.rand.Next(2) == 0)
					{
						int num5 = Dust.NewDust(position, width, height, 180, 0f, 0f, 100);
						Main.dust[num5].scale += (float)Main.rand.Next(50) * 0.04f;
						Main.dust[num5].noGravity = true;
						Main.dust[num5].velocity = vector;
						Main.dust[num5].fadeIn = Main.rand.NextFloat() * 1.5f;
					}
					if (Main.rand.Next(2) == 0)
					{
						int num6 = Dust.NewDust(position, width, height, 176, 0f, 0f, 100);
						Main.dust[num6].scale += 0.3f + (float)Main.rand.Next(50) * 0.01f;
						Main.dust[num6].noGravity = true;
						Main.dust[num6].velocity = vector;
						Main.dust[num6].fadeIn = Main.rand.NextFloat() * 1.5f;
					}
				}
				if (Main.netMode != 1)
				{
					SpawnStardustMark_StardustWorm();
					velocity = velocity.SafeNormalize(Vector2.Zero) * 6f;
					netUpdate = true;
				}
			}
			if (ai[2] >= num3 && Main.netMode != 1)
			{
				ai[2] = 0f;
				netUpdate = true;
			}
		}
		if (Main.netMode != 1 && Main.expertMode)
		{
			if (type == 14 && ((double)(position.Y / 16f) < Main.worldSurface || Main.getGoodWorld))
			{
				int num7 = (int)(base.Center.X / 16f);
				int num8 = (int)(base.Center.Y / 16f);
				if (WorldGen.InWorld(num7, num8) && Main.tile[num7, num8].wall == 0)
				{
					int num9 = 900;
					if (Main.getGoodWorld)
					{
						num9 /= 2;
					}
					if (Main.rand.Next(num9) == 0)
					{
						TargetClosest();
						if (Collision.CanHitLine(base.Center, 1, 1, Main.player[target].Center, 1, 1))
						{
							NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2) + velocity.X), (int)(position.Y + (float)(height / 2) + velocity.Y), 666, 0, 0f, 1f);
						}
					}
				}
			}
			else if (type == 13)
			{
				int num10 = 90;
				num10 += (int)((float)life / (float)lifeMax * 60f * 5f);
				if (Main.rand.Next(num10) == 0)
				{
					TargetClosest();
					if (Collision.CanHitLine(base.Center, 1, 1, Main.player[target].Center, 1, 1))
					{
						NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2) + velocity.X), (int)(position.Y + (float)(height / 2) + velocity.Y), 666, 0, 0f, 1f);
					}
				}
			}
		}
		bool flag = false;
		float num11 = 0.2f;
		switch (type)
		{
		case 513:
			flag = !Main.player[target].ZoneUndergroundDesert;
			num11 = 0.1f;
			break;
		case 10:
		case 39:
		case 95:
		case 117:
		case 510:
			flag = true;
			break;
		case 621:
			flag = false;
			break;
		}
		if (type >= 13 && type <= 15)
		{
			realLife = -1;
		}
		else if (ai[3] > 0f)
		{
			realLife = (int)ai[3];
		}
		if (target < 0 || target == 255 || Main.player[target].dead || (flag && (double)Main.player[target].position.Y < Main.worldSurface * 16.0))
		{
			TargetClosest();
		}
		if (Main.player[target].dead || (flag && (double)Main.player[target].position.Y < Main.worldSurface * 16.0))
		{
			EncourageDespawn(300);
			if (flag)
			{
				velocity.Y += num11;
			}
		}
		if (type == 621 && Main.dayTime)
		{
			EncourageDespawn(60);
			velocity.Y += 1f;
		}
		if (Main.netMode != 1)
		{
			if (type == 87 && ai[0] == 0f)
			{
				ai[3] = whoAmI;
				realLife = whoAmI;
				int num12 = 0;
				int num13 = whoAmI;
				for (int m = 0; m < 14; m++)
				{
					int num14 = 89;
					switch (m)
					{
					case 1:
					case 8:
						num14 = 88;
						break;
					case 11:
						num14 = 90;
						break;
					case 12:
						num14 = 91;
						break;
					case 13:
						num14 = 92;
						break;
					}
					num12 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)(position.Y + (float)height), num14, whoAmI);
					Main.npc[num12].ai[3] = whoAmI;
					Main.npc[num12].realLife = whoAmI;
					Main.npc[num12].ai[1] = num13;
					Main.npc[num12].CopyInteractions(this);
					Main.npc[num13].ai[0] = num12;
					NetMessage.SendData(23, -1, -1, null, num12);
					num13 = num12;
				}
			}
			if (type == 454 && ai[0] == 0f)
			{
				ai[3] = whoAmI;
				realLife = whoAmI;
				int num15 = 0;
				int num16 = whoAmI;
				for (int n = 0; n < 30; n++)
				{
					int num17 = 456;
					if ((n - 2) % 4 == 0 && n < 26)
					{
						num17 = 455;
					}
					else
					{
						switch (n)
						{
						case 27:
							num17 = 457;
							break;
						case 28:
							num17 = 458;
							break;
						case 29:
							num17 = 459;
							break;
						}
					}
					num15 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)(position.Y + (float)height), num17, whoAmI);
					Main.npc[num15].ai[3] = whoAmI;
					Main.npc[num15].realLife = whoAmI;
					Main.npc[num15].ai[1] = num16;
					Main.npc[num15].CopyInteractions(this);
					Main.npc[num16].ai[0] = num15;
					NetMessage.SendData(23, -1, -1, null, num15);
					num16 = num15;
				}
			}
			if (type == 513 && ai[0] == 0f)
			{
				ai[3] = whoAmI;
				realLife = whoAmI;
				int num18 = 0;
				int num19 = whoAmI;
				int num20 = Main.rand.Next(6, 10);
				for (int num21 = 0; num21 < num20; num21++)
				{
					int num22 = 514;
					if (num21 == num20 - 1)
					{
						num22 = 515;
					}
					num18 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)(position.Y + (float)height), num22, whoAmI);
					Main.npc[num18].ai[3] = whoAmI;
					Main.npc[num18].realLife = whoAmI;
					Main.npc[num18].ai[1] = num19;
					Main.npc[num18].CopyInteractions(this);
					Main.npc[num19].ai[0] = num18;
					NetMessage.SendData(23, -1, -1, null, num18);
					num19 = num18;
				}
			}
			if (type == 510 && ai[0] == 0f)
			{
				ai[3] = whoAmI;
				realLife = whoAmI;
				int num23 = 0;
				int num24 = whoAmI;
				int num25 = Main.rand.Next(12, 21);
				for (int num26 = 0; num26 < num25; num26++)
				{
					int num27 = 511;
					if (num26 == num25 - 1)
					{
						num27 = 512;
					}
					num23 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)(position.Y + (float)height), num27, whoAmI);
					Main.npc[num23].ai[3] = whoAmI;
					Main.npc[num23].realLife = whoAmI;
					Main.npc[num23].ai[1] = num24;
					Main.npc[num23].CopyInteractions(this);
					Main.npc[num24].ai[0] = num23;
					NetMessage.SendData(23, -1, -1, null, num23);
					num24 = num23;
				}
			}
			if (type == 621 && ai[0] == 0f)
			{
				ai[3] = whoAmI;
				realLife = whoAmI;
				int num28 = 0;
				int num29 = whoAmI;
				int num30 = 16;
				for (int num31 = 0; num31 < num30; num31++)
				{
					int num32 = 622;
					if (num31 == num30 - 1)
					{
						num32 = 623;
					}
					num28 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)(position.Y + (float)height), num32, whoAmI);
					Main.npc[num28].ai[3] = whoAmI;
					Main.npc[num28].realLife = whoAmI;
					Main.npc[num28].ai[1] = num29;
					Main.npc[num28].CopyInteractions(this);
					Main.npc[num29].ai[0] = num28;
					NetMessage.SendData(23, -1, -1, null, num28);
					num29 = num28;
				}
			}
			else if ((type == 7 || type == 8 || type == 10 || type == 11 || type == 13 || type == 14 || type == 39 || type == 40 || type == 95 || type == 96 || type == 98 || type == 99 || type == 117 || type == 118) && ai[0] == 0f)
			{
				if (type == 7 || type == 10 || type == 13 || type == 39 || type == 95 || type == 98 || type == 117)
				{
					if (type < 13 || type > 15)
					{
						ai[3] = whoAmI;
						realLife = whoAmI;
					}
					ai[2] = Main.rand.Next(8, 13);
					if (type == 10)
					{
						ai[2] = Main.rand.Next(4, 7);
					}
					if (type == 13)
					{
						ai[2] = GetEaterOfWorldsSegmentsCount();
					}
					if (type == 39)
					{
						ai[2] = Main.rand.Next(14, 23);
						if (Main.getGoodWorld)
						{
							ai[2] += 3f;
							if (Main.remixWorld)
							{
								ai[2] += 4f;
							}
						}
					}
					if (type == 95)
					{
						ai[2] = Main.rand.Next(6, 12);
					}
					if (type == 98)
					{
						ai[2] = Main.rand.Next(20, 26);
					}
					if (type == 117)
					{
						ai[2] = Main.rand.Next(3, 6);
					}
					if (type == 7 && Main.remixWorld)
					{
						ai[2] *= 2f;
					}
					ai[0] = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)(position.Y + (float)height), type + 1, whoAmI);
					Main.npc[(int)ai[0]].CopyInteractions(this);
				}
				else if ((type == 8 || type == 11 || type == 14 || type == 40 || type == 96 || type == 99 || type == 118) && ai[2] > 0f)
				{
					ai[0] = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)(position.Y + (float)height), type, whoAmI);
					Main.npc[(int)ai[0]].CopyInteractions(this);
				}
				else
				{
					ai[0] = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)(position.Y + (float)height), type + 1, whoAmI);
					Main.npc[(int)ai[0]].CopyInteractions(this);
				}
				if (type < 13 || type > 15)
				{
					Main.npc[(int)ai[0]].ai[3] = ai[3];
					Main.npc[(int)ai[0]].realLife = realLife;
				}
				Main.npc[(int)ai[0]].ai[1] = whoAmI;
				Main.npc[(int)ai[0]].ai[2] = ai[2] - 1f;
				netUpdate = true;
			}
			if (type == 412 && ai[0] == 0f)
			{
				ai[3] = whoAmI;
				realLife = whoAmI;
				int num33 = 0;
				int num34 = whoAmI;
				int num35 = 30;
				for (int num36 = 0; num36 < num35; num36++)
				{
					int num37 = 413;
					if (num36 == num35 - 1)
					{
						num37 = 414;
					}
					num33 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)(position.X + (float)(width / 2)), (int)(position.Y + (float)height), num37, whoAmI);
					Main.npc[num33].ai[3] = whoAmI;
					Main.npc[num33].realLife = whoAmI;
					Main.npc[num33].ai[1] = num34;
					Main.npc[num33].CopyInteractions(this);
					Main.npc[num34].ai[0] = num33;
					NetMessage.SendData(23, -1, -1, null, num33);
					num34 = num33;
				}
			}
			switch (type)
			{
			case 8:
			case 9:
			case 11:
			case 12:
			case 40:
			case 41:
			case 88:
			case 89:
			case 90:
			case 91:
			case 92:
			case 96:
			case 97:
			case 99:
			case 100:
			case 118:
			case 119:
			case 413:
			case 414:
			case 455:
			case 456:
			case 457:
			case 458:
			case 459:
			case 511:
			case 512:
			case 514:
			case 515:
			case 622:
			case 623:
				if (!Main.npc[(int)ai[1]].active || Main.npc[(int)ai[1]].aiStyle != aiStyle)
				{
					life = 0;
					HitEffect();
					checkDead();
					active = false;
					NetMessage.SendData(28, -1, -1, null, whoAmI, -1f);
					return;
				}
				break;
			}
			switch (type)
			{
			case 7:
			case 8:
			case 10:
			case 11:
			case 39:
			case 40:
			case 87:
			case 88:
			case 89:
			case 90:
			case 91:
			case 95:
			case 96:
			case 98:
			case 99:
			case 117:
			case 118:
			case 412:
			case 413:
			case 454:
			case 455:
			case 456:
			case 457:
			case 458:
			case 510:
			case 511:
			case 513:
			case 514:
			case 621:
			case 622:
				if (!Main.npc[(int)ai[0]].active || Main.npc[(int)ai[0]].aiStyle != aiStyle)
				{
					life = 0;
					HitEffect();
					checkDead();
					active = false;
					NetMessage.SendData(28, -1, -1, null, whoAmI, -1f);
					return;
				}
				break;
			}
			if (type == 13 || type == 14 || type == 15)
			{
				if (!Main.npc[(int)ai[1]].active && !Main.npc[(int)ai[0]].active)
				{
					NPCDamageTracker.AddDamageToLastAttack(this, life);
					life = 0;
					HitEffect();
					checkDead();
					active = false;
					NetMessage.SendData(28, -1, -1, null, whoAmI, -1f);
					return;
				}
				if (type == 13 && !Main.npc[(int)ai[0]].active)
				{
					NPCDamageTracker.AddDamageToLastAttack(this, life);
					life = 0;
					HitEffect();
					checkDead();
					active = false;
					NetMessage.SendData(28, -1, -1, null, whoAmI, -1f);
					return;
				}
				if (type == 15 && !Main.npc[(int)ai[1]].active)
				{
					NPCDamageTracker.AddDamageToLastAttack(this, life);
					life = 0;
					HitEffect();
					checkDead();
					active = false;
					NetMessage.SendData(28, -1, -1, null, whoAmI, -1f);
					return;
				}
				if (type == 14 && (!Main.npc[(int)ai[1]].active || Main.npc[(int)ai[1]].aiStyle != aiStyle))
				{
					Transform(13, ai[0]);
				}
				if (type == 14 && (!Main.npc[(int)ai[0]].active || Main.npc[(int)ai[0]].aiStyle != aiStyle))
				{
					Transform(15, 0f, ai[1]);
				}
			}
			if (!active && Main.netMode == 2)
			{
				NetMessage.SendData(28, -1, -1, null, whoAmI, -1f);
			}
		}
		int num38 = (int)(position.X / 16f) - 1;
		int num39 = (int)((position.X + (float)width) / 16f) + 2;
		int num40 = (int)(position.Y / 16f) - 1;
		int num41 = (int)((position.Y + (float)height) / 16f) + 2;
		if (num38 < 0)
		{
			num38 = 0;
		}
		if (num39 > Main.maxTilesX)
		{
			num39 = Main.maxTilesX;
		}
		if (num40 < 0)
		{
			num40 = 0;
		}
		if (num41 > Main.maxTilesY)
		{
			num41 = Main.maxTilesY;
		}
		bool flag2 = false;
		bool flag3 = false;
		bool flag4 = false;
		if (type >= 87 && type <= 92)
		{
			flag3 = true;
		}
		if (type >= 454 && type <= 459)
		{
			flag3 = true;
		}
		if (type >= 621 && type <= 623)
		{
			flag3 = true;
		}
		if (type >= 412 && type <= 414)
		{
			flag3 = true;
		}
		if (type == 402)
		{
			flag3 = true;
		}
		if (type >= 13 && type <= 15 && WorldGen.Skyblock.lowTiles)
		{
			flag2 = true;
			flag3 = true;
		}
		if (!flag3 || flag2)
		{
			Vector2 vector2 = default(Vector2);
			for (int num42 = num38; num42 < num39; num42++)
			{
				for (int num43 = num40; num43 < num41; num43++)
				{
					if (Main.tile[num42, num43] == null || ((!Main.tile[num42, num43].nactive() || (!Main.tileSolid[Main.tile[num42, num43].type] && (!Main.tileSolidTop[Main.tile[num42, num43].type] || Main.tile[num42, num43].frameY != 0))) && Main.tile[num42, num43].liquid <= 64))
					{
						continue;
					}
					vector2.X = num42 * 16;
					vector2.Y = num43 * 16;
					if (position.X + (float)width > vector2.X && position.X < vector2.X + 16f && position.Y + (float)height > vector2.Y && position.Y < vector2.Y + 16f)
					{
						flag4 = true;
						flag3 = true;
						if (Main.rand.Next(100) == 0 && type != 117 && Main.tile[num42, num43].nactive() && Main.tileSolid[Main.tile[num42, num43].type])
						{
							WorldGen.KillTile(num42, num43, fail: true, effectOnly: true);
						}
					}
				}
			}
		}
		if (!flag3 && (type == 7 || type == 10 || type == 13 || type == 39 || type == 95 || type == 98 || type == 117 || type == 375 || type == 454 || type == 510 || type == 513 || type == 621))
		{
			Rectangle rectangle = new Rectangle((int)position.X, (int)position.Y, width, height);
			int num44 = 1000;
			bool flag5 = true;
			for (int num45 = 0; num45 < 255; num45++)
			{
				if (Main.player[num45].active)
				{
					Rectangle rectangle2 = new Rectangle((int)Main.player[num45].position.X - num44, (int)Main.player[num45].position.Y - num44, num44 * 2, num44 * 2);
					if (rectangle.Intersects(rectangle2))
					{
						flag5 = false;
						break;
					}
				}
			}
			if (flag5)
			{
				flag3 = true;
			}
		}
		if ((type >= 87 && type <= 92) || (type >= 454 && type <= 459) || (type >= 621 && type <= 623))
		{
			if (velocity.X < 0f)
			{
				spriteDirection = 1;
			}
			else if (velocity.X > 0f)
			{
				spriteDirection = -1;
			}
		}
		if (type == 414)
		{
			if (justHit)
			{
				localAI[3] = 3f;
			}
			if (localAI[2] > 0f)
			{
				localAI[2] -= 16f;
				if (localAI[2] == 0f)
				{
					localAI[2] = -128f;
				}
			}
			else if (localAI[2] < 0f)
			{
				localAI[2] += 16f;
			}
			else if (localAI[3] > 0f)
			{
				localAI[2] = 128f;
				localAI[3] -= 1f;
			}
		}
		if (type == 412)
		{
			position += netOffset;
			Vector2 vector3 = base.Center + (rotation - (float)Math.PI / 2f).ToRotationVector2() * 8f;
			Vector2 vector4 = rotation.ToRotationVector2() * 16f;
			Dust obj = Main.dust[Dust.NewDust(vector3 + vector4, 0, 0, 6, velocity.X, velocity.Y, 100, Color.Transparent, 1f + Main.rand.NextFloat() * 3f)];
			obj.noGravity = true;
			obj.noLight = true;
			obj.position -= new Vector2(4f);
			obj.fadeIn = 1f;
			obj.velocity = Vector2.Zero;
			Dust obj2 = Main.dust[Dust.NewDust(vector3 - vector4, 0, 0, 6, velocity.X, velocity.Y, 100, Color.Transparent, 1f + Main.rand.NextFloat() * 3f)];
			obj2.noGravity = true;
			obj2.noLight = true;
			obj2.position -= new Vector2(4f);
			obj2.fadeIn = 1f;
			obj2.velocity = Vector2.Zero;
			position -= netOffset;
		}
		float num46 = 8f;
		float num47 = 0.07f;
		if (type == 95)
		{
			num46 = 5.5f;
			num47 = 0.045f;
		}
		if (type == 10)
		{
			num46 = 6f;
			num47 = 0.05f;
		}
		if (type == 513)
		{
			num46 = 7f;
			num47 = 0.1f;
		}
		if (type == 7)
		{
			num46 = 9f;
			num47 = 0.1f;
		}
		if (type == 13)
		{
			num46 = 10f;
			num47 = 0.07f;
			if (Main.expertMode)
			{
				num46 = 12f;
				num47 = 0.15f;
			}
			if (Main.getGoodWorld)
			{
				num46 += 4f;
				num47 += 0.05f;
			}
		}
		if (type == 510)
		{
			if (!Main.player[target].dead && Main.player[target].ZoneSandstorm)
			{
				num46 = 16f;
				num47 = 0.35f;
			}
			else
			{
				num46 = 10f;
				num47 = 0.25f;
			}
		}
		if (type == 87)
		{
			num46 = 11f;
			num47 = 0.25f;
		}
		if (type == 621)
		{
			num46 = 15f;
			num47 = 0.45f;
		}
		if (type == 375)
		{
			num46 = 6f;
			num47 = 0.15f;
		}
		if (type == 454)
		{
			num46 = 20f;
			num47 = 0.55f;
		}
		if (type == 402)
		{
			num46 = 9f;
			num47 = 0.3f;
		}
		if (type == 117 && Main.wofNPCIndex >= 0)
		{
			float num48 = (float)Main.npc[Main.wofNPCIndex].life / (float)Main.npc[Main.wofNPCIndex].lifeMax;
			if (num48 < 0.5f)
			{
				num46 += 1f;
				num47 += 0.1f;
			}
			if (num48 < 0.25f)
			{
				num46 += 1f;
				num47 += 0.1f;
			}
			if (num48 < 0.1f)
			{
				num46 += 2f;
				num47 += 0.1f;
			}
		}
		if (type == 39)
		{
			num46 = 9f;
			num47 = 0.1f;
			if (Main.getGoodWorld)
			{
				num46 = 10f;
				num47 = 0.12f;
			}
		}
		Vector2 center = base.Center;
		float num49 = Main.player[target].Center.X;
		float num50 = Main.player[target].Center.Y;
		if (type == 412)
		{
			num46 = 10f;
			num47 = 0.3f;
			int num51 = -1;
			int num52 = (int)(Main.player[target].Center.X / 16f);
			int num53 = (int)(Main.player[target].Center.Y / 16f);
			for (int num54 = num52 - 2; num54 <= num52 + 2; num54++)
			{
				for (int num55 = num53; num55 <= num53 + 15; num55++)
				{
					if (WorldGen.SolidTile2(num54, num55))
					{
						num51 = num55;
						break;
					}
				}
				if (num51 > 0)
				{
					break;
				}
			}
			if (num51 > 0)
			{
				num51 *= 16;
				int num56 = num51 - 800;
				if (Main.player[target].position.Y > (float)num56)
				{
					num50 = num56;
					if (Math.Abs(base.Center.X - Main.player[target].Center.X) < 500f)
					{
						num49 = ((!(velocity.X > 0f)) ? (Main.player[target].Center.X - 600f) : (Main.player[target].Center.X + 600f));
					}
				}
			}
			else
			{
				num46 = 14f;
				num47 = 0.5f;
			}
			float num57 = num46 * 1.3f;
			float num58 = num46 * 0.7f;
			float num59 = velocity.Length();
			if (num59 > 0f)
			{
				if (num59 > num57)
				{
					velocity.Normalize();
					velocity *= num57;
				}
				else if (num59 < num58)
				{
					velocity.Normalize();
					velocity *= num58;
				}
			}
			int num60 = 60;
			float num61 = 200f;
			if (num51 > 0)
			{
				num60 = 400;
				num61 = 1000f;
			}
			for (int num62 = 0; num62 < Main.maxNPCs; num62++)
			{
				if (Main.npc[num62].active && Main.npc[num62].type == type && num62 != whoAmI)
				{
					Vector2 vector5 = Main.npc[num62].Center - base.Center;
					if (vector5.Length() < (float)num60)
					{
						vector5.Normalize();
						vector5 *= num61;
						num49 -= vector5.X;
						num50 -= vector5.Y;
					}
				}
			}
		}
		num49 = (int)(num49 / 16f) * 16;
		num50 = (int)(num50 / 16f) * 16;
		center.X = (int)(center.X / 16f) * 16;
		center.Y = (int)(center.Y / 16f) * 16;
		num49 -= center.X;
		num50 -= center.Y;
		if (type == 375)
		{
			num49 *= -1f;
			num50 *= -1f;
		}
		float num63 = (float)Math.Sqrt(num49 * num49 + num50 * num50);
		if (ai[1] > 0f && ai[1] < (float)Main.npc.Length)
		{
			try
			{
				center = base.Center;
				num49 = Main.npc[(int)ai[1]].Center.X - center.X;
				num50 = Main.npc[(int)ai[1]].Center.Y - center.Y;
			}
			catch
			{
			}
			rotation = (float)Math.Atan2(num50, num49) + 1.57f;
			num63 = (float)Math.Sqrt(num49 * num49 + num50 * num50);
			float num64 = width;
			if (type >= 87 && type <= 92)
			{
				num64 = 42f;
			}
			if (type >= 454 && type <= 459)
			{
				num64 = 36f;
			}
			if (type >= 513 && type <= 515)
			{
				num64 -= 6f;
			}
			if (type >= 412 && type <= 414)
			{
				num64 += 6f;
			}
			if (type >= 621 && type <= 623)
			{
				num64 = 24f;
			}
			if (Main.getGoodWorld && type >= 13 && type <= 15)
			{
				num64 = 62f;
			}
			num63 = (num63 - num64) / num63;
			num49 *= num63;
			num50 *= num63;
			velocity = Vector2.Zero;
			position.X += num49;
			position.Y += num50;
			if ((type >= 87 && type <= 92) || (type >= 454 && type <= 459) || (type >= 621 && type <= 623))
			{
				if (num49 < 0f)
				{
					spriteDirection = 1;
				}
				else if (num49 > 0f)
				{
					spriteDirection = -1;
				}
			}
		}
		else
		{
			if (!flag3)
			{
				TargetClosest();
				if (type == 39 && velocity.Y < 0f)
				{
					velocity.Y += 0.08f;
				}
				else
				{
					velocity.Y += 0.11f;
				}
				if (velocity.Y > num46)
				{
					velocity.Y = num46;
				}
				if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) < (double)num46 * 0.4)
				{
					if (velocity.X < 0f)
					{
						velocity.X -= num47 * 1.1f;
					}
					else
					{
						velocity.X += num47 * 1.1f;
					}
				}
				else if (velocity.Y == num46)
				{
					if (velocity.X < num49)
					{
						velocity.X += num47;
					}
					else if (velocity.X > num49)
					{
						velocity.X -= num47;
					}
				}
				else if (velocity.Y > 4f)
				{
					if (velocity.X < 0f)
					{
						velocity.X += num47 * 0.9f;
					}
					else
					{
						velocity.X -= num47 * 0.9f;
					}
				}
			}
			else
			{
				if (type != 621 && type != 87 && type != 117 && type != 454 && type != 412 && soundDelay == 0 && (type < 13 || type > 15 || !WorldGen.Skyblock.lowTiles || flag4))
				{
					float num65 = num63 / 40f;
					if (num65 < 10f)
					{
						num65 = 10f;
					}
					if (num65 > 20f)
					{
						num65 = 20f;
					}
					soundDelay = (int)num65;
					if (type >= 13 && type <= 15)
					{
						SoundEngine.PlaySound(SoundID.EOWDiggin, (int)position.X, (int)position.Y);
					}
					else
					{
						SoundEngine.PlaySound(15, (int)position.X, (int)position.Y);
					}
				}
				num63 = (float)Math.Sqrt(num49 * num49 + num50 * num50);
				float num66 = Math.Abs(num49);
				float num67 = Math.Abs(num50);
				float num68 = num46 / num63;
				num49 *= num68;
				num50 *= num68;
				bool flag6 = false;
				if ((type == 7 || type == 13) && ((!Main.player[target].ZoneCorrupt && !Main.player[target].ZoneCrimson) || Main.player[target].dead))
				{
					flag6 = true;
				}
				if ((type == 513 && (double)Main.player[target].position.Y < Main.worldSurface * 16.0 && !Main.player[target].ZoneSandstorm && !Main.player[target].ZoneUndergroundDesert) || Main.player[target].dead)
				{
					flag6 = true;
				}
				if ((type == 510 && (double)Main.player[target].position.Y < Main.worldSurface * 16.0 && !Main.player[target].ZoneSandstorm && !Main.player[target].ZoneUndergroundDesert) || Main.player[target].dead)
				{
					flag6 = true;
				}
				if (flag6)
				{
					bool flag7 = true;
					for (int num69 = 0; num69 < 255; num69++)
					{
						if (Main.player[num69].active && !Main.player[num69].dead && Main.player[num69].ZoneCorrupt)
						{
							flag7 = false;
						}
					}
					if (flag7)
					{
						if (Main.netMode != 1 && (double)(position.Y / 16f) > (Main.rockLayer + (double)Main.maxTilesY) / 2.0)
						{
							active = false;
							int num70 = (int)ai[0];
							while (num70 > 0 && num70 < Main.maxNPCs && Main.npc[num70].active && Main.npc[num70].aiStyle == aiStyle)
							{
								int num71 = (int)Main.npc[num70].ai[0];
								Main.npc[num70].active = false;
								life = 0;
								if (Main.netMode == 2)
								{
									NetMessage.SendData(23, -1, -1, null, num70);
								}
								num70 = num71;
							}
							if (Main.netMode == 2)
							{
								NetMessage.SendData(23, -1, -1, null, whoAmI);
							}
						}
						num49 = 0f;
						num50 = num46;
					}
				}
				bool flag8 = false;
				if (type == 87)
				{
					if (((velocity.X > 0f && num49 < 0f) || (velocity.X < 0f && num49 > 0f) || (velocity.Y > 0f && num50 < 0f) || (velocity.Y < 0f && num50 > 0f)) && Math.Abs(velocity.X) + Math.Abs(velocity.Y) > num47 / 2f && num63 < 300f)
					{
						flag8 = true;
						if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < num46)
						{
							velocity *= 1.1f;
						}
					}
					if (base.Center.Y > Main.player[target].Center.Y || (double)(Main.player[target].Center.Y / 16f) > Main.worldSurface || Main.player[target].dead)
					{
						flag8 = true;
						if (Math.Abs(velocity.X) < num46 / 2f)
						{
							if (velocity.X == 0f)
							{
								velocity.X -= direction;
							}
							velocity.X *= 1.1f;
						}
						else if (velocity.Y > 0f - num46)
						{
							velocity.Y -= num47;
						}
					}
				}
				if (type == 454 || type == 621)
				{
					float num72 = 300f;
					if (type == 621)
					{
						num72 = 120f;
					}
					if (((velocity.X > 0f && num49 < 0f) || (velocity.X < 0f && num49 > 0f) || (velocity.Y > 0f && num50 < 0f) || (velocity.Y < 0f && num50 > 0f)) && Math.Abs(velocity.X) + Math.Abs(velocity.Y) > num47 / 2f && num63 < num72)
					{
						flag8 = true;
						if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < num46)
						{
							velocity *= 1.1f;
						}
					}
					if (position.Y > Main.player[target].position.Y || Main.player[target].dead)
					{
						flag8 = true;
						if (Math.Abs(velocity.X) < num46 / 2f)
						{
							if (velocity.X == 0f)
							{
								velocity.X -= direction;
							}
							velocity.X *= 1.1f;
						}
						else if (velocity.Y > 0f - num46)
						{
							velocity.Y -= num47;
						}
					}
				}
				if (!flag8)
				{
					if ((velocity.X > 0f && num49 > 0f) || (velocity.X < 0f && num49 < 0f) || (velocity.Y > 0f && num50 > 0f) || (velocity.Y < 0f && num50 < 0f))
					{
						if (velocity.X < num49)
						{
							velocity.X += num47;
						}
						else if (velocity.X > num49)
						{
							velocity.X -= num47;
						}
						if (velocity.Y < num50)
						{
							velocity.Y += num47;
						}
						else if (velocity.Y > num50)
						{
							velocity.Y -= num47;
						}
						if (Math.Abs(num50) < num46 * 0.2f && ((velocity.X > 0f && num49 < 0f) || (velocity.X < 0f && num49 > 0f)))
						{
							if (velocity.Y > 0f)
							{
								velocity.Y += num47 * 2f;
							}
							else
							{
								velocity.Y -= num47 * 2f;
							}
						}
						if (Math.Abs(num49) < num46 * 0.2f && ((velocity.Y > 0f && num50 < 0f) || (velocity.Y < 0f && num50 > 0f)))
						{
							if (velocity.X > 0f)
							{
								velocity.X += num47 * 2f;
							}
							else
							{
								velocity.X -= num47 * 2f;
							}
						}
					}
					else if (num66 > num67)
					{
						if (velocity.X < num49)
						{
							velocity.X += num47 * 1.1f;
						}
						else if (velocity.X > num49)
						{
							velocity.X -= num47 * 1.1f;
						}
						if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < num46 * 0.5f)
						{
							if (velocity.Y > 0f)
							{
								velocity.Y += num47;
							}
							else
							{
								velocity.Y -= num47;
							}
						}
					}
					else
					{
						if (velocity.Y < num50)
						{
							velocity.Y += num47 * 1.1f;
						}
						else if (velocity.Y > num50)
						{
							velocity.Y -= num47 * 1.1f;
						}
						if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < num46 * 0.5f)
						{
							if (velocity.X > 0f)
							{
								velocity.X += num47;
							}
							else
							{
								velocity.X -= num47;
							}
						}
					}
				}
			}
			rotation = (float)Math.Atan2(velocity.Y, velocity.X) + (float)Math.PI / 2f;
			if (type == 7 || type == 10 || type == 13 || type == 39 || type == 95 || type == 98 || type == 117 || type == 510 || type == 513 || type == 621)
			{
				if (flag3)
				{
					if (localAI[0] != 1f)
					{
						netUpdate = true;
					}
					localAI[0] = 1f;
				}
				else
				{
					if (localAI[0] != 0f)
					{
						netUpdate = true;
					}
					localAI[0] = 0f;
				}
				if (((velocity.X > 0f && oldVelocity.X < 0f) || (velocity.X < 0f && oldVelocity.X > 0f) || (velocity.Y > 0f && oldVelocity.Y < 0f) || (velocity.Y < 0f && oldVelocity.Y > 0f)) && !justHit)
				{
					netUpdate = true;
				}
			}
			if (type == 454)
			{
				float num73 = Vector2.Distance(Main.player[target].Center, base.Center);
				int num74 = 0;
				if (Vector2.Normalize(Main.player[target].Center - base.Center).ToRotation().AngleTowards(velocity.ToRotation(), (float)Math.PI / 2f) == velocity.ToRotation() && num73 < 350f)
				{
					num74 = 4;
				}
				if ((double)num74 > frameCounter)
				{
					frameCounter += 1.0;
				}
				if ((double)num74 < frameCounter)
				{
					frameCounter -= 1.0;
				}
				if (frameCounter < 0.0)
				{
					frameCounter = 0.0;
				}
				if (frameCounter > 4.0)
				{
					frameCounter = 4.0;
				}
			}
		}
		if (type < 13 || type > 15 || (type != 13 && (type == 13 || Main.npc[(int)ai[1]].alpha >= 85)))
		{
			return;
		}
		if (alpha > 0 && life > 0)
		{
			for (int num75 = 0; num75 < 2; num75++)
			{
				int num76 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 14, 0f, 0f, 100, default(Color), 2f);
				Main.dust[num76].noGravity = true;
				Main.dust[num76].noLight = true;
			}
		}
		if ((position - oldPosition).Length() > 2f)
		{
			alpha -= 42;
			if (alpha < 0)
			{
				alpha = 0;
			}
		}
	}

	private void AI_002_FloatingEye()
	{
		if ((type == 170 || type == 171 || type == 180) && Main.rand.Next(1000) == 0)
		{
			SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 9);
		}
		noGravity = true;
		if (!noTileCollide)
		{
			if (collideX)
			{
				velocity.X = oldVelocity.X * -0.5f;
				if (direction == -1 && velocity.X > 0f && velocity.X < 2f)
				{
					velocity.X = 2f;
				}
				if (direction == 1 && velocity.X < 0f && velocity.X > -2f)
				{
					velocity.X = -2f;
				}
			}
			if (collideY)
			{
				velocity.Y = oldVelocity.Y * -0.5f;
				if (velocity.Y > 0f && velocity.Y < 1f)
				{
					velocity.Y = 1f;
				}
				if (velocity.Y < 0f && velocity.Y > -1f)
				{
					velocity.Y = -1f;
				}
			}
		}
		if (DespawnEncouragement_AIStyle2_FloatingEye_IsDiscouraged(type, position, target))
		{
			EncourageDespawn(10);
			directionY = -1;
			if (velocity.Y > 0f)
			{
				direction = 1;
			}
			direction = -1;
			if (velocity.X > 0f)
			{
				direction = 1;
			}
		}
		else
		{
			TargetClosest();
		}
		if (type == 170 || type == 171 || type == 180)
		{
			if (Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
			{
				if (ai[1] > 0f && !Collision.SolidCollision(position, width, height))
				{
					ai[1] = 0f;
					ai[0] = 0f;
					netUpdate = true;
				}
			}
			else if (ai[1] == 0f)
			{
				ai[0] += 1f;
			}
			if (ai[0] >= 300f)
			{
				ai[1] = 1f;
				ai[0] = 0f;
				netUpdate = true;
			}
			if (ai[1] == 0f)
			{
				alpha = 0;
				noTileCollide = false;
			}
			else
			{
				wet = false;
				alpha = 200;
				noTileCollide = true;
			}
			rotation = velocity.Y * 0.1f * (float)direction;
			TargetClosest();
			if (direction == -1 && velocity.X > -4f && position.X > Main.player[target].position.X + (float)Main.player[target].width)
			{
				velocity.X -= 0.08f;
				if (velocity.X > 4f)
				{
					velocity.X -= 0.04f;
				}
				else if (velocity.X > 0f)
				{
					velocity.X -= 0.2f;
				}
				if (velocity.X < -4f)
				{
					velocity.X = -4f;
				}
			}
			else if (direction == 1 && velocity.X < 4f && position.X + (float)width < Main.player[target].position.X)
			{
				velocity.X += 0.08f;
				if (velocity.X < -4f)
				{
					velocity.X += 0.04f;
				}
				else if (velocity.X < 0f)
				{
					velocity.X += 0.2f;
				}
				if (velocity.X > 4f)
				{
					velocity.X = 4f;
				}
			}
			if (directionY == -1 && (double)velocity.Y > -2.5 && position.Y > Main.player[target].position.Y + (float)Main.player[target].height)
			{
				velocity.Y -= 0.1f;
				if ((double)velocity.Y > 2.5)
				{
					velocity.Y -= 0.05f;
				}
				else if (velocity.Y > 0f)
				{
					velocity.Y -= 0.15f;
				}
				if ((double)velocity.Y < -2.5)
				{
					velocity.Y = -2.5f;
				}
			}
			else if (directionY == 1 && (double)velocity.Y < 2.5 && position.Y + (float)height < Main.player[target].position.Y)
			{
				velocity.Y += 0.1f;
				if ((double)velocity.Y < -2.5)
				{
					velocity.Y += 0.05f;
				}
				else if (velocity.Y < 0f)
				{
					velocity.Y += 0.15f;
				}
				if ((double)velocity.Y > 2.5)
				{
					velocity.Y = 2.5f;
				}
			}
		}
		else if (type == 116)
		{
			TargetClosest();
			Lighting.AddLight((int)(position.X + (float)(width / 2)) / 16, (int)(position.Y + (float)(height / 2)) / 16, 0.3f, 0.2f, 0.1f);
			if (direction == -1 && velocity.X > -6f)
			{
				velocity.X -= 0.1f;
				if (velocity.X > 6f)
				{
					velocity.X -= 0.1f;
				}
				else if (velocity.X > 0f)
				{
					velocity.X -= 0.2f;
				}
				if (velocity.X < -6f)
				{
					velocity.X = -6f;
				}
			}
			else if (direction == 1 && velocity.X < 6f)
			{
				velocity.X += 0.1f;
				if (velocity.X < -6f)
				{
					velocity.X += 0.1f;
				}
				else if (velocity.X < 0f)
				{
					velocity.X += 0.2f;
				}
				if (velocity.X > 6f)
				{
					velocity.X = 6f;
				}
			}
			if (directionY == -1 && (double)velocity.Y > -2.5)
			{
				velocity.Y -= 0.04f;
				if ((double)velocity.Y > 2.5)
				{
					velocity.Y -= 0.05f;
				}
				else if (velocity.Y > 0f)
				{
					velocity.Y -= 0.15f;
				}
				if ((double)velocity.Y < -2.5)
				{
					velocity.Y = -2.5f;
				}
			}
			else if (directionY == 1 && (double)velocity.Y < 1.5)
			{
				velocity.Y += 0.04f;
				if ((double)velocity.Y < -2.5)
				{
					velocity.Y += 0.05f;
				}
				else if (velocity.Y < 0f)
				{
					velocity.Y += 0.15f;
				}
				if ((double)velocity.Y > 2.5)
				{
					velocity.Y = 2.5f;
				}
			}
			if (Main.rand.Next(40) == 0)
			{
				position += netOffset;
				int num = Dust.NewDust(new Vector2(position.X, position.Y + (float)height * 0.25f), width, (int)((float)height * 0.5f), 5, velocity.X, 2f);
				Main.dust[num].velocity.X *= 0.5f;
				Main.dust[num].velocity.Y *= 0.1f;
				position -= netOffset;
			}
		}
		else if (type == 133)
		{
			if ((double)life < (double)lifeMax * 0.5)
			{
				if (direction == -1 && velocity.X > -6f)
				{
					velocity.X -= 0.1f;
					if (velocity.X > 6f)
					{
						velocity.X -= 0.1f;
					}
					else if (velocity.X > 0f)
					{
						velocity.X += 0.05f;
					}
					if (velocity.X < -6f)
					{
						velocity.X = -6f;
					}
				}
				else if (direction == 1 && velocity.X < 6f)
				{
					velocity.X += 0.1f;
					if (velocity.X < -6f)
					{
						velocity.X += 0.1f;
					}
					else if (velocity.X < 0f)
					{
						velocity.X -= 0.05f;
					}
					if (velocity.X > 6f)
					{
						velocity.X = 6f;
					}
				}
				if (directionY == -1 && velocity.Y > -4f)
				{
					velocity.Y -= 0.1f;
					if (velocity.Y > 4f)
					{
						velocity.Y -= 0.1f;
					}
					else if (velocity.Y > 0f)
					{
						velocity.Y += 0.05f;
					}
					if (velocity.Y < -4f)
					{
						velocity.Y = -4f;
					}
				}
				else if (directionY == 1 && velocity.Y < 4f)
				{
					velocity.Y += 0.1f;
					if (velocity.Y < -4f)
					{
						velocity.Y += 0.1f;
					}
					else if (velocity.Y < 0f)
					{
						velocity.Y -= 0.05f;
					}
					if (velocity.Y > 4f)
					{
						velocity.Y = 4f;
					}
				}
			}
			else
			{
				if (direction == -1 && velocity.X > -4f)
				{
					velocity.X -= 0.1f;
					if (velocity.X > 4f)
					{
						velocity.X -= 0.1f;
					}
					else if (velocity.X > 0f)
					{
						velocity.X += 0.05f;
					}
					if (velocity.X < -4f)
					{
						velocity.X = -4f;
					}
				}
				else if (direction == 1 && velocity.X < 4f)
				{
					velocity.X += 0.1f;
					if (velocity.X < -4f)
					{
						velocity.X += 0.1f;
					}
					else if (velocity.X < 0f)
					{
						velocity.X -= 0.05f;
					}
					if (velocity.X > 4f)
					{
						velocity.X = 4f;
					}
				}
				if (directionY == -1 && (double)velocity.Y > -1.5)
				{
					velocity.Y -= 0.04f;
					if ((double)velocity.Y > 1.5)
					{
						velocity.Y -= 0.05f;
					}
					else if (velocity.Y > 0f)
					{
						velocity.Y += 0.03f;
					}
					if ((double)velocity.Y < -1.5)
					{
						velocity.Y = -1.5f;
					}
				}
				else if (directionY == 1 && (double)velocity.Y < 1.5)
				{
					velocity.Y += 0.04f;
					if ((double)velocity.Y < -1.5)
					{
						velocity.Y += 0.05f;
					}
					else if (velocity.Y < 0f)
					{
						velocity.Y -= 0.03f;
					}
					if ((double)velocity.Y > 1.5)
					{
						velocity.Y = 1.5f;
					}
				}
			}
		}
		else
		{
			float num2 = 4f;
			float num3 = 1.5f;
			num2 *= 1f + (1f - scale);
			num3 *= 1f + (1f - scale);
			if (direction == -1 && velocity.X > 0f - num2)
			{
				velocity.X -= 0.1f;
				if (velocity.X > num2)
				{
					velocity.X -= 0.1f;
				}
				else if (velocity.X > 0f)
				{
					velocity.X += 0.05f;
				}
				if (velocity.X < 0f - num2)
				{
					velocity.X = 0f - num2;
				}
			}
			else if (direction == 1 && velocity.X < num2)
			{
				velocity.X += 0.1f;
				if (velocity.X < 0f - num2)
				{
					velocity.X += 0.1f;
				}
				else if (velocity.X < 0f)
				{
					velocity.X -= 0.05f;
				}
				if (velocity.X > num2)
				{
					velocity.X = num2;
				}
			}
			if (directionY == -1 && velocity.Y > 0f - num3)
			{
				velocity.Y -= 0.04f;
				if (velocity.Y > num3)
				{
					velocity.Y -= 0.05f;
				}
				else if (velocity.Y > 0f)
				{
					velocity.Y += 0.03f;
				}
				if (velocity.Y < 0f - num3)
				{
					velocity.Y = 0f - num3;
				}
			}
			else if (directionY == 1 && velocity.Y < num3)
			{
				velocity.Y += 0.04f;
				if (velocity.Y < 0f - num3)
				{
					velocity.Y += 0.05f;
				}
				else if (velocity.Y < 0f)
				{
					velocity.Y -= 0.03f;
				}
				if (velocity.Y > num3)
				{
					velocity.Y = num3;
				}
			}
		}
		if ((type == 2 || type == 133 || type == 190 || type == 191 || type == 192 || type == 193 || type == 194) && Main.rand.Next(40) == 0)
		{
			position += netOffset;
			int num4 = Dust.NewDust(new Vector2(position.X, position.Y + (float)height * 0.25f), width, (int)((float)height * 0.5f), 5, velocity.X, 2f);
			Main.dust[num4].velocity.X *= 0.5f;
			Main.dust[num4].velocity.Y *= 0.1f;
			position -= netOffset;
		}
		if (wet && type != 170 && type != 171 && type != 180)
		{
			if (velocity.Y > 0f)
			{
				velocity.Y *= 0.95f;
			}
			velocity.Y -= 0.5f;
			if (velocity.Y < -4f)
			{
				velocity.Y = -4f;
			}
			TargetClosest();
		}
	}

	private void StingerExplosion()
	{
		int num = Main.rand.Next(4, 9);
		for (int i = 0; i < num; i++)
		{
			float num2 = 8f;
			Vector2 vector = new Vector2(Main.rand.NextFloat() - 0.5f, Main.rand.NextFloat() - 0.5f);
			vector.Normalize();
			vector *= num2;
			int num3 = (int)(10f * scale);
			if (type == 176)
			{
				num3 = (int)(30f * scale);
			}
			int num4 = 55;
			int num5 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, vector.X, vector.Y, num4, num3, 0f, Main.myPlayer);
			Main.projectile[num5].timeLeft = 300;
		}
	}

	public static bool DespawnEncouragement_AIStyle2_FloatingEye_IsDiscouraged(int npcID, Vector2 npcPosition, int target = 255)
	{
		if (!Main.player[target].ZoneGraveyard && Main.IsItDay() && (double)npcPosition.Y <= Main.worldSurface * 16.0)
		{
			if (npcID != 2 && npcID != 133 && npcID != 190 && npcID != 191 && npcID != 192 && npcID != 193 && npcID != 194 && npcID != 317)
			{
				return npcID == 318;
			}
			return true;
		}
		return false;
	}

	private bool AI_007_TownEntities_IsInAGoodRestingSpot(int tileX, int tileY, int idealRestX, int idealRestY)
	{
		if (!Main.dayTime && ai[0] == 5f)
		{
			if (Math.Abs(tileX - idealRestX) <= 7)
			{
				return Math.Abs(tileY - idealRestY) <= 7;
			}
			return false;
		}
		if ((type == 361 || type == 445 || type == 687) && wet)
		{
			return false;
		}
		if (tileX == idealRestX)
		{
			return tileY == idealRestY;
		}
		return false;
	}

	private bool SolidOrSlopedTileOrPlatform(Tile tile)
	{
		if (tile != null && tile.active() && ((Main.tileSolid[tile.type] && !Main.tileSolidTop[tile.type]) || TileID.Sets.Platforms[tile.type]))
		{
			return !tile.inActive();
		}
		return false;
	}

	private void AI_007_FindGoodRestingSpot(int myTileX, int myTileY, out int floorX, out int floorY)
	{
		floorX = homeTileX;
		floorY = homeTileY;
		if (floorX == -1 || floorY == -1)
		{
			return;
		}
		while (!SolidOrSlopedTileOrPlatform(Main.tile[floorX, floorY]) && floorY < Main.maxTilesY - 20)
		{
			floorY++;
		}
		if (Main.dayTime || (ai[0] == 5f && Math.Abs(myTileX - floorX) < 7 && Math.Abs(myTileY - floorY) < 7))
		{
			return;
		}
		Point point = new Point(floorX, floorY);
		Point point2 = new Point(-1, -1);
		int num = -1;
		if (type == 638 || type == 656 || NPCID.Sets.IsTownSlime[type] || ai[0] == 5f)
		{
			return;
		}
		int num2 = 7;
		int num3 = 6;
		int num4 = 2;
		int num5 = 1;
		int num6 = 2;
		for (int i = point.X - num2; i <= point.X + num2; i += num5)
		{
			for (int num7 = point.Y + num4; num7 >= point.Y - num3; num7 -= num6)
			{
				Tile tile = Main.tile[i, num7];
				if (tile != null && tile.active() && TileID.Sets.CanBeSatOnForNPCs[tile.type] && (tile.frameY % 40 != 0 || num7 + 1 <= point.Y + num4))
				{
					int num8 = Math.Abs(i - point.X) + Math.Abs(num7 - point.Y);
					if (num == -1 || num8 < num)
					{
						num = num8;
						point2.X = i;
						point2.Y = num7;
					}
				}
			}
		}
		if (num == -1)
		{
			return;
		}
		Tile tile2 = Main.tile[point2.X, point2.Y];
		if (tile2.type == 497 || tile2.type == 15)
		{
			if (tile2.frameY % 40 != 0)
			{
				point2.Y--;
			}
			point2.Y += 2;
		}
		for (int j = 0; j < Main.maxNPCs; j++)
		{
			if (Main.npc[j].active && Main.npc[j].aiStyle == 7 && Main.npc[j].townNPC && Main.npc[j].ai[0] == 5f && (Main.npc[j].Bottom + Vector2.UnitY * -2f).ToTileCoordinates() == point2)
			{
				return;
			}
		}
		floorX = point2.X;
		floorY = point2.Y;
	}

	private void AI_007_TryForcingSitting(int homeFloorX, int homeFloorY)
	{
		if (!WorldGen.InWorld(homeFloorX, homeFloorY))
		{
			return;
		}
		Tile tile = Main.tile[homeFloorX, homeFloorY - 1];
		bool flag = type != 638 && type != 656 && !NPCID.Sets.IsTownSlime[type] && ai[0] != 5f;
		if (flag)
		{
			flag &= tile != null && tile.active() && (tile.type == 15 || tile.type == 497);
		}
		if (flag)
		{
			flag &= tile.type != 15 || tile.frameY < 1080 || tile.frameY > 1098;
		}
		if (flag)
		{
			Point point = (base.Bottom + Vector2.UnitY * -2f).ToTileCoordinates();
			for (int i = 0; i < Main.maxNPCs; i++)
			{
				if (Main.npc[i].active && Main.npc[i].aiStyle == 7 && Main.npc[i].townNPC && Main.npc[i].ai[0] == 5f && (Main.npc[i].Bottom + Vector2.UnitY * -2f).ToTileCoordinates() == point)
				{
					flag = false;
					break;
				}
			}
		}
		if (flag)
		{
			ai[0] = 5f;
			ai[1] = 900 + Main.rand.Next(10800);
			direction = ((tile.frameX != 0) ? 1 : (-1));
			base.Bottom = new Vector2(homeFloorX * 16 + 8 + 2 * direction, homeFloorY * 16);
			velocity = Vector2.Zero;
			localAI[3] = 0f;
			netUpdate = true;
		}
	}

	public void UpdateHomeTileState(bool homeless, int x, int y)
	{
		bool num = x != homeTileX || y != homeTileY || this.homeless != homeless;
		oldHomeless = (this.homeless = homeless);
		oldHomeTileX = (homeTileX = x);
		oldHomeTileY = (homeTileY = y);
		if (num && Main.netMode != 1)
		{
			byte householdStatus = WorldGen.TownManager.GetHouseholdStatus(this);
			NetMessage.SendData(60, -1, -1, null, whoAmI, homeTileX, homeTileY, (int)householdStatus);
		}
	}

	public Color GetMagicAuraColor()
	{
		Color result = NPCID.Sets.MagicAuraColor[type];
		if (type == 160 && townNpcVariationIndex == 1)
		{
			result = new Color(result.B, result.G, result.R, result.A);
		}
		if (type == 20 && townNpcVariationIndex == 1)
		{
			result = new Color(90, 20, 210, result.A);
		}
		if (type == 663 && townNpcVariationIndex == 1)
		{
			result = new Color(255, 0, 77, result.A);
		}
		return result;
	}

	private void AI_007_TownEntities_UpdateSavedStates()
	{
		switch (type)
		{
		case 588:
			savedGolfer = true;
			break;
		case 441:
			savedTaxCollector = true;
			break;
		case 107:
			savedGoblin = true;
			break;
		case 108:
			savedWizard = true;
			break;
		case 124:
			savedMech = true;
			break;
		case 353:
			savedStylist = true;
			break;
		case 369:
			savedAngler = true;
			break;
		case 550:
			savedBartender = true;
			break;
		}
	}

	private void AI_007_TownEntities()
	{
		ShimmeredTownNPCs[type] = IsShimmerVariant;
		if (type == 441 && GivenName == "Andrew")
		{
			defDefense = 200;
		}
		if (Main.onlyShimmerOceanWorlds && type == 680 && GivenName == "Slimefors")
		{
			life = lifeMax;
			defDefense = 99999;
		}
		int num = 300;
		if (type == 638 || type == 656 || NPCID.Sets.IsTownSlime[type])
		{
			num = 0;
		}
		bool flag = Main.raining;
		if (!Main.dayTime)
		{
			flag = true;
		}
		if (Main.eclipse)
		{
			flag = true;
		}
		if (Main.slimeRain)
		{
			flag = true;
		}
		if (Main.IsItStorming && (double)(position.Y / 16f) < Main.worldSurface)
		{
			flag = true;
		}
		float num2 = 1f;
		if (Main.masterMode)
		{
			defense = (dryadWard ? (defDefense + 20) : defDefense);
		}
		else if (Main.expertMode)
		{
			defense = (dryadWard ? (defDefense + 15) : defDefense);
		}
		else
		{
			defense = (dryadWard ? (defDefense + 10) : defDefense);
		}
		float num3 = 2f;
		bool flag2 = false;
		if (isLikeATownNPC)
		{
			bool flag3 = life == lifeMax;
			lifeMax = defLifeMax;
			if (combatBookWasUsed)
			{
				lifeMax += 250;
				num3 *= 0.8f;
				num2 += 0.25f;
				defense += 8;
			}
			if (combatBookVolumeTwoWasUsed)
			{
				lifeMax += 250;
				num3 *= 0.8f;
				num2 += 0.25f;
				defense += 8;
			}
			if (lifeMax > defLifeMax && flag3)
			{
				life = lifeMax;
			}
			if (downedSlimeKing)
			{
				num3 *= 0.985f;
				num2 += 0.05f;
				defense += 2;
			}
			if (downedBoss1)
			{
				num3 *= 0.985f;
				num2 += 0.05f;
				defense += 2;
			}
			if (downedDeerclops)
			{
				num3 *= 0.985f;
				num2 += 0.1f;
				defense += 3;
			}
			if (downedBoss2)
			{
				num3 *= 0.985f;
				num2 += 0.1f;
				defense += 3;
			}
			if (downedBoss3)
			{
				num3 *= 0.985f;
				num2 += 0.1f;
				defense += 3;
			}
			if (downedQueenBee)
			{
				num3 *= 0.985f;
				num2 += 0.1f;
				defense += 3;
			}
			if (Main.hardMode)
			{
				num3 *= 0.985f;
				num2 += 0.4f;
				defense += 12;
			}
			if (downedQueenSlime)
			{
				num3 *= 0.985f;
				num2 += 0.15f;
				defense += 6;
			}
			if (downedMechBoss1)
			{
				num3 *= 0.985f;
				num2 += 0.15f;
				defense += 6;
			}
			if (downedMechBoss2)
			{
				num3 *= 0.985f;
				num2 += 0.15f;
				defense += 6;
			}
			if (downedMechBoss3)
			{
				num3 *= 0.985f;
				num2 += 0.15f;
				defense += 6;
			}
			if (downedPlantBoss)
			{
				num3 *= 0.985f;
				num2 += 0.15f;
				defense += 8;
			}
			if (downedEmpressOfLight)
			{
				num3 *= 0.985f;
				num2 += 0.15f;
				defense += 8;
			}
			if (downedFishron)
			{
				num3 *= 0.985f;
				num2 += 0.15f;
				defense += 8;
			}
			if (downedGolemBoss)
			{
				num3 *= 0.985f;
				num2 += 0.15f;
				defense += 8;
			}
			if (downedAncientCultist)
			{
				num3 *= 0.985f;
				num2 += 0.15f;
				defense += 20;
			}
			if (Main.infectedSeed && type == 20)
			{
				flag2 = true;
				life = lifeMax;
				defDefense = 99999;
				immortal = true;
			}
			if (Main.netMode != 1 && WorldGen.Skyblock.lowTiles)
			{
				if (num3 > 1f)
				{
					num3 = (num3 + 1f) / 2f;
				}
				num2 += 0.5f;
			}
			if (type == 209)
			{
				num3 /= 3f;
			}
			if (tipsy)
			{
				defense = (int)((double)defense * 1.1);
				num2 *= 1.1f;
				num3 *= 0.9f;
			}
		}
		if (type == 142 && Main.netMode != 1 && !Main.xMas)
		{
			StrikeNPCNoInteraction(9999, 0f, 0);
			if (Main.netMode == 2)
			{
				NetMessage.SendData(28, -1, -1, null, whoAmI, 9999f);
			}
		}
		if ((type == 148 || type == 149) && localAI[0] == 0f)
		{
			localAI[0] = Main.rand.Next(1, 5);
		}
		if (type == 124)
		{
			int num4 = lazyNPCOwnedProjectileSearchArray[whoAmI];
			bool flag4 = false;
			if (Main.projectile.IndexInRange(num4))
			{
				Projectile projectile = Main.projectile[num4];
				if (projectile.active && projectile.type == 582 && projectile.ai[1] == (float)whoAmI)
				{
					flag4 = true;
				}
			}
			localAI[0] = flag4.ToInt();
		}
		if ((type == 362 || type == 364 || type == 602 || type == 608) && Main.netMode != 1 && (velocity.Y > 4f || velocity.Y < -4f || wet))
		{
			Transform(type + 1);
			return;
		}
		AI_007_TownEntities_UpdateSavedStates();
		dontTakeDamage = false;
		if (ai[0] == 25f)
		{
			dontTakeDamage = true;
			if (ai[1] == 0f)
			{
				velocity.X = 0f;
			}
			shimmerWet = false;
			wet = false;
			lavaWet = false;
			honeyWet = false;
			if (ai[1] == 0f && Main.netMode == 1)
			{
				return;
			}
			if (ai[1] == 0f && ai[2] < 1f)
			{
				AI_007_TownEntities_Shimmer_TeleportToLandingSpot();
			}
			if (ai[2] > 0f)
			{
				ai[2] -= 1f;
				if (ai[2] <= 0f)
				{
					ai[1] = 1f;
				}
				return;
			}
			ai[1] += 1f;
			if (ai[1] >= 30f)
			{
				if (!Collision.WetCollision(position, width, height))
				{
					shimmerTransparency = MathHelper.Clamp(shimmerTransparency - 1f / 60f, 0f, 1f);
				}
				else
				{
					ai[1] = 30f;
				}
				velocity = new Vector2(0f, -4f * shimmerTransparency);
			}
			Rectangle hitbox = base.Hitbox;
			hitbox.Y += 20;
			hitbox.Height -= 20;
			float num5 = Main.rand.NextFloatDirection();
			Lighting.AddLight(base.Center, Main.hslToRgb((float)Main.timeForVisualEffects / 360f % 1f, 0.6f, 0.65f).ToVector3() * Utils.Remap(ai[1], 30f, 90f, 0f, 0.7f));
			if (Main.rand.NextFloat() > Utils.Remap(ai[1], 30f, 60f, 1f, 0.5f))
			{
				Dust.NewDustPerfect(Main.rand.NextVector2FromRectangle(hitbox) + Main.rand.NextVector2Circular(8f, 0f) + new Vector2(0f, 4f), 309, new Vector2(0f, -2f).RotatedBy(num5 * ((float)Math.PI * 2f) * 0.11f), 0, default(Color), 1.7f - Math.Abs(num5) * 1.3f);
			}
			if (ai[1] > 60f && Main.rand.Next(15) == 0)
			{
				for (int i = 0; i < 3; i++)
				{
					Vector2 vector = Main.rand.NextVector2FromRectangle(base.Hitbox);
					ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.ShimmerBlock, new ParticleOrchestraSettings
					{
						PositionInWorld = vector,
						MovementVector = DirectionTo(vector).RotatedBy((float)Math.PI * 9f / 20f * (float)(Main.rand.Next(2) * 2 - 1)) * Main.rand.NextFloat()
					});
				}
			}
			TargetClosest();
			NPCAimedTarget targetData = GetTargetData();
			if (ai[1] >= 75f && shimmerTransparency <= 0f && Main.netMode != 1)
			{
				ai[0] = 0f;
				ai[1] = 0f;
				ai[2] = 0f;
				ai[3] = 0f;
				Math.Sign(targetData.Center.X - base.Center.X);
				velocity = new Vector2(0f, -4f);
				localAI[0] = 0f;
				localAI[1] = 0f;
				localAI[2] = 0f;
				localAI[3] = 0f;
				netUpdate = true;
				townNpcVariationIndex = ((townNpcVariationIndex != 1) ? 1 : 0);
				NetMessage.SendData(56, -1, -1, null, whoAmI);
				Teleport(position, 12);
				ParticleOrchestrator.BroadcastParticleSpawn(ParticleOrchestraType.ShimmerTownNPC, new ParticleOrchestraSettings
				{
					PositionInWorld = base.Center
				});
				if (townNpcVariationIndex == 1)
				{
					AchievementsHelper.NotifyProgressionEvent(43);
				}
			}
			return;
		}
		if (type >= 0 && type < NPCID.Count && NPCID.Sets.TownCritter[type] && target == 255)
		{
			TargetClosest();
			if (position.X < Main.player[target].position.X)
			{
				direction = 1;
				spriteDirection = direction;
			}
			if (position.X > Main.player[target].position.X)
			{
				direction = -1;
				spriteDirection = direction;
			}
			if (homeTileX == -1)
			{
				UpdateHomeTileState(homeless, (int)((position.X + (float)(width / 2)) / 16f), homeTileY);
			}
		}
		else if (homeTileX == -1 && homeTileY == -1 && velocity.Y == 0f && !shimmering)
		{
			UpdateHomeTileState(homeless, (int)base.Center.X / 16, (int)(position.Y + (float)height + 4f) / 16);
		}
		bool flag5 = false;
		int num6 = (int)(position.X + (float)(width / 2)) / 16;
		int num7 = (int)(position.Y + (float)height + 1f) / 16;
		AI_007_FindGoodRestingSpot(num6, num7, out var floorX, out var floorY);
		if (type == 441)
		{
			taxCollector = true;
		}
		directionY = -1;
		if (direction == 0)
		{
			direction = 1;
		}
		bool num8 = ai[0] == 24f;
		int num9 = 0;
		if (!num8)
		{
			for (int j = 0; j < 255; j++)
			{
				if (!Main.player[j].active || Main.player[j].talkNPC != whoAmI)
				{
					continue;
				}
				flag5 = true;
				if (ai[0] != 10f && ai[0] != 12f && ai[0] != 14f && ai[0] != 15f)
				{
					if (ai[0] != 0f)
					{
						netUpdate = true;
					}
					ai[0] = 0f;
					ai[1] = 300f;
					localAI[3] = 100f;
					num9 = ((!(Main.player[j].position.X + (float)(Main.player[j].width / 2) < position.X + (float)(width / 2))) ? 1 : (-1));
				}
			}
		}
		if (ai[3] == 1f)
		{
			life = -1;
			HitEffect();
			active = false;
			netUpdate = true;
			if (type == 37 || type == 54)
			{
				SoundEngine.PlaySound(15, (int)position.X, (int)position.Y, 0);
			}
			return;
		}
		if (type == 37 && Main.netMode != 1)
		{
			UpdateHomeTileState(homeless: false, Main.dungeonX, Main.dungeonY);
			if (downedBoss3)
			{
				ai[3] = 1f;
				netUpdate = true;
			}
		}
		if (type == 368)
		{
			homeless = true;
			if (!Main.dayTime)
			{
				if (!shimmering)
				{
					UpdateHomeTileState(homeless, (int)(base.Center.X / 16f), (int)(position.Y + (float)height + 2f) / 16);
				}
				if (!flag5 && ai[0] == 0f)
				{
					ai[0] = 1f;
					ai[1] = 200f;
				}
				flag = false;
			}
		}
		if (type == 369 && homeless && wet)
		{
			if (base.Center.X / 16f < 380f || base.Center.X / 16f > (float)(Main.maxTilesX - 380))
			{
				UpdateHomeTileState(homeless, Main.spawnTileX, Main.spawnTileY);
				ai[0] = 1f;
				ai[1] = 200f;
			}
			if (position.X / 16f < 300f)
			{
				direction = 1;
			}
			else if (position.X / 16f > (float)(Main.maxTilesX - 300))
			{
				direction = -1;
			}
		}
		if (NPCID.Sets.CritterThatCanTurnOnPlayers[type])
		{
			if (Main.netMode != 1)
			{
				int num10 = Player.FindClosest(position, width, height);
				if (Collision.CanHit(this, Main.player[num10]) && (Main.player[num10].RollOnlyBadLuckExtreme(3000) == 0 || Main.player[num10].IsThisCenx()))
				{
					ai[3] = 2f;
					netUpdate = true;
				}
			}
			if (ai[3] != 0f)
			{
				if (lifeMax == 5)
				{
					lifeMax = 25;
					life = 25;
					defense = defDefense + 6;
					damage = 20;
				}
				aiStyle = 3;
			}
		}
		if (!WorldGen.InWorld(num6, num7) || Main.tile[num6, num7] == null)
		{
			return;
		}
		if (Main.tile[num6, num7].type == 666)
		{
			AddBuff(120, 180);
		}
		if (!homeless && Main.netMode != 1 && townNPC && (flag || (type == 37 && Main.tileDungeon[Main.tile[num6, num7].type])) && !AI_007_TownEntities_IsInAGoodRestingSpot(num6, num7, floorX, floorY))
		{
			bool flag6 = true;
			for (int k = 0; k < 2; k++)
			{
				if (!flag6)
				{
					break;
				}
				Rectangle rectangle = new Rectangle((int)(position.X + (float)(width / 2) - (float)(sWidth / 2) - (float)safeRangeX), (int)(position.Y + (float)(height / 2) - (float)(sHeight / 2) - (float)safeRangeY), sWidth + safeRangeX * 2, sHeight + safeRangeY * 2);
				if (k == 1)
				{
					rectangle = new Rectangle(floorX * 16 + 8 - sWidth / 2 - safeRangeX, floorY * 16 + 8 - sHeight / 2 - safeRangeY, sWidth + safeRangeX * 2, sHeight + safeRangeY * 2);
				}
				for (int l = 0; l < 255; l++)
				{
					if (Main.player[l].active && new Rectangle((int)Main.player[l].position.X, (int)Main.player[l].position.Y, Main.player[l].width, Main.player[l].height).Intersects(rectangle))
					{
						flag6 = false;
						break;
					}
				}
			}
			if (flag6)
			{
				AI_007_TownEntities_TeleportToHome(floorX, floorY);
			}
		}
		bool flag7 = type == 300 || type == 447 || type == 610;
		bool flag8 = type == 616 || type == 617 || type == 625;
		bool flag9 = type == 361 || type == 445 || type == 687;
		bool flag10 = NPCID.Sets.IsTownSlime[type];
		_ = NPCID.Sets.IsTownPet[type];
		bool flag11 = flag8 || flag9;
		bool flag12 = flag8 || flag9;
		bool flag13 = flag10;
		bool flag14 = flag10;
		float num11 = 200f;
		if (NPCID.Sets.DangerDetectRange[type] != -1)
		{
			num11 = NPCID.Sets.DangerDetectRange[type];
		}
		float num12 = num11;
		if (flag5 && NPCID.Sets.AttackType[type] == 3 && num12 < 250f)
		{
			num12 = 250f;
		}
		bool flag15 = false;
		bool flag16 = false;
		bool flag17 = false;
		bool flag18 = false;
		float num13 = -1f;
		float num14 = -1f;
		int num15 = 0;
		int num16 = -1;
		int num17 = -1;
		if (!flag8 && Main.netMode != 1)
		{
			for (int m = 0; m < Main.maxNPCs; m++)
			{
				if (!Main.npc[m].active || NPCID.Sets.CritterThatCanTurnOnPlayers[Main.npc[m].type] || Main.npc[m].type == 690 || ((Main.npc[m].friendly || Main.npc[m].damage <= 0) && !Main.npc[m].stinky) || m == whoAmI || !(Main.npc[m].Distance(base.Center) < num12) || (type == 453 && NPCID.Sets.Skeletons[Main.npc[m].type]) || (!Main.npc[m].noTileCollide && !Collision.CanHit(base.Center, 0, 0, Main.npc[m].Center, 0, 0)))
				{
					continue;
				}
				flag15 = true;
				if (Main.npc[m].Distance(base.Center) >= num11)
				{
					continue;
				}
				bool flag19 = Main.npc[m].CanBeChasedBy(this);
				flag16 = true;
				if (Main.npc[m].stinky)
				{
					flag17 = true;
				}
				float num18 = Main.npc[m].Center.X - base.Center.X;
				if (type == 614)
				{
					if (num18 < 0f && (num13 == -1f || num18 > num13))
					{
						num14 = num18;
						num17 = m;
					}
					if (num18 > 0f && (num14 == -1f || num18 < num14))
					{
						num13 = num18;
						num16 = m;
					}
					continue;
				}
				if (num18 < 0f && (num13 == -1f || num18 > num13))
				{
					num13 = num18;
					if (flag19)
					{
						num16 = m;
					}
				}
				if (num18 > 0f && (num14 == -1f || num18 < num14))
				{
					num14 = num18;
					if (flag19)
					{
						num17 = m;
					}
				}
			}
			if (!flag16 && !flag5)
			{
				for (int n = 0; n < 255; n++)
				{
					if (Main.player[n].active && !Main.player[n].dead && Main.player[n].stinky && Main.player[n].Distance(base.Center) < num11 && (Main.player[n].stinky || (type != 633 && type != 37 && type != 441 && type != 228 && type != 107 && type != 453)))
					{
						flag16 = true;
						flag17 = true;
						float num19 = Main.player[n].Center.X - base.Center.X;
						if (num19 < 0f && (num13 == -1f || num19 > num13))
						{
							num13 = num19;
							num16 = n;
						}
						if (num19 > 0f && (num14 == -1f || num19 < num14))
						{
							num14 = num19;
							num17 = n;
						}
					}
				}
			}
			if (flag16 && !flag5)
			{
				num15 = ((num13 == -1f) ? 1 : ((num14 != -1f) ? (num14 < 0f - num13).ToDirectionInt() : (-1)));
				float num20 = 0f;
				if (num13 != -1f)
				{
					num20 = 0f - num13;
				}
				if (num20 == 0f || (num14 < num20 && num14 > 0f))
				{
					num20 = num14;
				}
				if (ai[0] == 8f)
				{
					if (direction == -num15)
					{
						ai[0] = 1f;
						ai[1] = 300 + Main.rand.Next(300);
						ai[2] = 0f;
						localAI[3] = 0f;
						netUpdate = true;
					}
				}
				else if (ai[0] != 10f && ai[0] != 12f && ai[0] != 13f && ai[0] != 14f && ai[0] != 15f)
				{
					if (NPCID.Sets.PrettySafe[type] != -1 && (float)NPCID.Sets.PrettySafe[type] < num20)
					{
						flag16 = false;
					}
					else if (ai[0] != 1f)
					{
						int tileX = (int)((position.X + (float)(width / 2) + (float)(15 * direction)) / 16f);
						int tileY = (int)((position.Y + (float)height - 16f) / 16f);
						bool currentlyDrowning = wet && !flag11;
						AI_007_TownEntities_GetWalkPrediction(num6, floorX, flag11, currentlyDrowning, tileX, tileY, out var _, out var avoidFalling);
						if (!avoidFalling)
						{
							if (ai[0] == 3f || ai[0] == 4f || ai[0] == 16f || ai[0] == 17f)
							{
								NPC nPC = Main.npc[(int)ai[2]];
								if (nPC.active)
								{
									nPC.ai[0] = 1f;
									nPC.ai[1] = 120 + Main.rand.Next(120);
									nPC.ai[2] = 0f;
									nPC.localAI[3] = 0f;
									nPC.direction = -num15;
									nPC.netUpdate = true;
								}
							}
							ai[0] = 1f;
							ai[1] = 120 + Main.rand.Next(120);
							ai[2] = 0f;
							localAI[3] = 0f;
							if (flag2)
							{
								direction = num15;
							}
							else
							{
								direction = -num15;
							}
							netUpdate = true;
						}
					}
					else if (!flag2 && ai[0] == 1f && direction != -num15)
					{
						direction = -num15;
						netUpdate = true;
					}
				}
			}
		}
		if (ai[0] == 0f)
		{
			if (flag5 && num9 != 0 && !flag16 && !flag15)
			{
				direction = num9;
			}
			if (stinky)
			{
				ai[0] = 1f;
			}
			if (localAI[3] > 0f)
			{
				localAI[3] -= 1f;
			}
			int num21 = 120;
			if (type == 638)
			{
				num21 = 60;
			}
			if ((flag9 || flag10) && wet)
			{
				ai[0] = 1f;
				ai[1] = 200 + Main.rand.Next(500, 700);
				ai[2] = 0f;
				localAI[3] = 0f;
				netUpdate = true;
			}
			else if (flag && !flag5 && !NPCID.Sets.TownCritter[type])
			{
				if (Main.netMode != 1)
				{
					if (num6 == floorX && num7 == floorY)
					{
						if (velocity.X != 0f)
						{
							netUpdate = true;
						}
						if (velocity.X > 0.1f)
						{
							velocity.X -= 0.1f;
						}
						else if (velocity.X < -0.1f)
						{
							velocity.X += 0.1f;
						}
						else
						{
							velocity.X = 0f;
							AI_007_TryForcingSitting(floorX, floorY);
						}
						if (NPCID.Sets.IsTownPet[type])
						{
							AI_007_AttemptToPlayIdleAnimationsForPets(num21 * 4);
						}
					}
					else
					{
						if (num6 > floorX)
						{
							direction = -1;
						}
						else
						{
							direction = 1;
						}
						ai[0] = 1f;
						ai[1] = 200 + Main.rand.Next(200);
						ai[2] = 0f;
						localAI[3] = 0f;
						netUpdate = true;
					}
				}
			}
			else
			{
				if (flag7)
				{
					velocity.X *= 0.5f;
				}
				if (velocity.X > 0.1f)
				{
					velocity.X -= 0.1f;
				}
				else if (velocity.X < -0.1f)
				{
					velocity.X += 0.1f;
				}
				else
				{
					velocity.X = 0f;
				}
				if (Main.netMode != 1)
				{
					if (!flag5 && NPCID.Sets.IsTownPet[type] && ai[1] >= 100f && ai[1] <= 150f)
					{
						AI_007_AttemptToPlayIdleAnimationsForPets(num21);
					}
					if (ai[1] > 0f)
					{
						ai[1] -= 1f;
					}
					bool flag20 = true;
					int tileX2 = (int)((position.X + (float)(width / 2) + (float)(15 * direction)) / 16f);
					int tileY2 = (int)((position.Y + (float)height - 16f) / 16f);
					bool currentlyDrowning2 = wet && !flag11;
					AI_007_TownEntities_GetWalkPrediction(num6, floorX, flag11, currentlyDrowning2, tileX2, tileY2, out var _, out var avoidFalling2);
					if (wet && !flag11)
					{
						bool currentlyDrowning3 = Collision.DrownCollision(position, width, height, 1f, includeSlopes: true);
						if (AI_007_TownEntities_CheckIfWillDrown(currentlyDrowning3))
						{
							ai[0] = 1f;
							ai[1] = 200 + Main.rand.Next(300);
							ai[2] = 0f;
							if (NPCID.Sets.TownCritter[type])
							{
								ai[1] += Main.rand.Next(200, 400);
							}
							localAI[3] = 0f;
							netUpdate = true;
						}
					}
					if (avoidFalling2)
					{
						flag20 = false;
					}
					if (ai[1] <= 0f)
					{
						if (flag20 && !avoidFalling2)
						{
							ai[0] = 1f;
							ai[1] = 200 + Main.rand.Next(300);
							ai[2] = 0f;
							if (NPCID.Sets.TownCritter[type])
							{
								ai[1] += Main.rand.Next(200, 400);
							}
							localAI[3] = 0f;
							netUpdate = true;
						}
						else
						{
							direction *= -1;
							ai[1] = 60 + Main.rand.Next(120);
							netUpdate = true;
						}
					}
				}
			}
			if (Main.netMode != 1 && (!flag || AI_007_TownEntities_IsInAGoodRestingSpot(num6, num7, floorX, floorY)))
			{
				if (num6 < floorX - 25 || num6 > floorX + 25)
				{
					if (localAI[3] == 0f)
					{
						if (num6 < floorX - 50 && direction == -1)
						{
							direction = 1;
							netUpdate = true;
						}
						else if (num6 > floorX + 50 && direction == 1)
						{
							direction = -1;
							netUpdate = true;
						}
					}
				}
				else if (Main.rand.Next(80) == 0 && localAI[3] == 0f)
				{
					localAI[3] = 200f;
					direction *= -1;
					netUpdate = true;
				}
			}
		}
		else if (ai[0] == 1f)
		{
			if (Main.netMode != 1 && flag && AI_007_TownEntities_IsInAGoodRestingSpot(num6, num7, floorX, floorY) && !NPCID.Sets.TownCritter[type])
			{
				ai[0] = 0f;
				ai[1] = 200 + Main.rand.Next(200);
				localAI[3] = 60f;
				netUpdate = true;
			}
			else
			{
				bool flag21 = !flag11 && Collision.DrownCollision(position, width, height, 1f, includeSlopes: true);
				if (!flag21)
				{
					if (Main.netMode != 1 && !homeless && !Main.tileDungeon[Main.tile[num6, num7].type] && (num6 < floorX - 35 || num6 > floorX + 35))
					{
						if (position.X < (float)(floorX * 16) && direction == -1)
						{
							ai[1] -= 5f;
						}
						else if (position.X > (float)(floorX * 16) && direction == 1)
						{
							ai[1] -= 5f;
						}
					}
					ai[1] -= 1f;
				}
				if (ai[1] <= 0f)
				{
					ai[0] = 0f;
					ai[1] = 300 + Main.rand.Next(300);
					ai[2] = 0f;
					if (NPCID.Sets.TownCritter[type])
					{
						ai[1] -= Main.rand.Next(100);
					}
					else
					{
						ai[1] += Main.rand.Next(900);
					}
					localAI[3] = 60f;
					netUpdate = true;
				}
				if (closeDoor && ((position.X + (float)(width / 2)) / 16f > (float)(doorX + 2) || (position.X + (float)(width / 2)) / 16f < (float)(doorX - 2)))
				{
					Tile tileSafely = Framing.GetTileSafely(doorX, doorY);
					if (tileSafely.type == 11)
					{
						if (WorldGen.CloseDoor(doorX, doorY))
						{
							closeDoor = false;
							NetMessage.SendData(19, -1, -1, null, 1, doorX, doorY, direction);
						}
						if ((position.X + (float)(width / 2)) / 16f > (float)(doorX + 4) || (position.X + (float)(width / 2)) / 16f < (float)(doorX - 4) || (position.Y + (float)(height / 2)) / 16f > (float)(doorY + 4) || (position.Y + (float)(height / 2)) / 16f < (float)(doorY - 4))
						{
							closeDoor = false;
						}
					}
					else if (tileSafely.type == 389)
					{
						if (WorldGen.ShiftTallGate(doorX, doorY, closing: true))
						{
							closeDoor = false;
							NetMessage.SendData(19, -1, -1, null, 5, doorX, doorY);
						}
						if ((position.X + (float)(width / 2)) / 16f > (float)(doorX + 4) || (position.X + (float)(width / 2)) / 16f < (float)(doorX - 4) || (position.Y + (float)(height / 2)) / 16f > (float)(doorY + 4) || (position.Y + (float)(height / 2)) / 16f < (float)(doorY - 4))
						{
							closeDoor = false;
						}
					}
					else
					{
						closeDoor = false;
					}
				}
				float num22 = 1f;
				float num23 = 0.07f;
				if (type == 614 && flag16)
				{
					num22 = 1.5f;
					num23 = 0.1f;
				}
				else if (type == 299 || type == 539 || type == 538 || (type >= 639 && type <= 645))
				{
					num22 = 1.5f;
				}
				else if (flag8)
				{
					if (wet)
					{
						num23 = 1f;
						num22 = 2f;
					}
					else
					{
						num23 = 0.07f;
						num22 = 0.5f;
					}
				}
				if (type == 625)
				{
					if (wet)
					{
						num23 = 1f;
						num22 = 2.5f;
					}
					else
					{
						num23 = 0.07f;
						num22 = 0.2f;
					}
				}
				if (flag7)
				{
					num22 = 2f;
					num23 = 1f;
				}
				if (friendly && (flag16 || flag21))
				{
					num22 = 1.5f;
					float num24 = 1f - (float)life / (float)lifeMax;
					num22 += num24 * 0.9f;
					num23 = 0.1f;
				}
				if (flag13 && wet)
				{
					num22 = 2f;
					num23 = 0.2f;
				}
				if (flag9 && wet)
				{
					if (Math.Abs(velocity.X) < 0.05f && Math.Abs(velocity.Y) < 0.05f)
					{
						velocity.X += num22 * 10f * (float)direction;
					}
					else
					{
						velocity.X *= 0.9f;
					}
				}
				else if (velocity.X < 0f - num22 || velocity.X > num22)
				{
					if (velocity.Y == 0f)
					{
						velocity *= 0.8f;
					}
				}
				else if (velocity.X < num22 && direction == 1)
				{
					velocity.X += num23;
					if (velocity.X > num22)
					{
						velocity.X = num22;
					}
				}
				else if (velocity.X > 0f - num22 && direction == -1)
				{
					velocity.X -= num23;
					if (velocity.X > num22)
					{
						velocity.X = num22;
					}
				}
				bool flag22 = true;
				if ((float)(homeTileY * 16 - 32) > position.Y)
				{
					flag22 = false;
				}
				if (!flag22 && velocity.Y == 0f)
				{
					Collision.StepDown(ref position, ref velocity, width, height, ref stepSpeed, ref gfxOffY);
				}
				if (velocity.Y >= 0f)
				{
					Collision.StepUp(ref position, ref velocity, width, height, ref stepSpeed, ref gfxOffY, 1, flag22, 1);
				}
				if (velocity.Y == 0f)
				{
					int num25 = (int)((position.X + (float)(width / 2) + (float)(15 * direction)) / 16f);
					int num26 = (int)((position.Y + (float)height - 16f) / 16f);
					int num27 = 180;
					AI_007_TownEntities_GetWalkPrediction(num6, floorX, flag11, flag21, num25, num26, out var keepwalking3, out var avoidFalling3);
					bool flag23 = false;
					bool flag24 = false;
					if (wet && !flag11 && isLikeATownNPC && (flag24 = AI_007_TownEntities_CheckIfWillDrown(flag21)) && localAI[3] <= 0f)
					{
						avoidFalling3 = true;
						localAI[3] = num27;
						int num28 = 0;
						for (int num29 = 0; num29 <= 10 && Framing.GetTileSafely(num25 - direction, num26 - num29).liquid != 0; num29++)
						{
							num28++;
						}
						float num30 = 0.3f;
						float num31 = (float)Math.Sqrt((float)(num28 * 16 + 16) * 2f * num30);
						if (num31 > 26f)
						{
							num31 = 26f;
						}
						velocity.Y = 0f - num31;
						localAI[3] = position.X;
						flag23 = true;
					}
					if (avoidFalling3 && !flag23)
					{
						int num32 = (int)((position.X + (float)(width / 2)) / 16f);
						int num33 = 0;
						for (int num34 = -1; num34 <= 1; num34++)
						{
							Tile tileSafely2 = Framing.GetTileSafely(num32 + num34, num26 + 1);
							if (tileSafely2.nactive() && Main.tileSolid[tileSafely2.type])
							{
								num33++;
							}
						}
						if (num33 <= 2)
						{
							if (velocity.X != 0f)
							{
								netUpdate = true;
							}
							keepwalking3 = (avoidFalling3 = false);
							ai[0] = 0f;
							ai[1] = 50 + Main.rand.Next(50);
							ai[2] = 0f;
							localAI[3] = 40f;
						}
					}
					if (position.X == localAI[3] && !flag23)
					{
						direction *= -1;
						netUpdate = true;
						localAI[3] = num27;
					}
					if (flag21 && !flag23)
					{
						if (localAI[3] > (float)num27)
						{
							localAI[3] = num27;
						}
						if (localAI[3] > 0f)
						{
							localAI[3] -= 1f;
						}
					}
					else
					{
						localAI[3] = -1f;
					}
					Tile tileSafely3 = Framing.GetTileSafely(num25, num26);
					Tile tileSafely4 = Framing.GetTileSafely(num25, num26 - 1);
					Tile tileSafely5 = Framing.GetTileSafely(num25, num26 - 2);
					bool flag25 = height / 16 < 3;
					if (townNPC && tileSafely5.nactive() && (tileSafely5.type == 10 || tileSafely5.type == 388) && (Main.rand.Next(10) == 0 || flag))
					{
						if (Main.netMode != 1)
						{
							if (WorldGen.OpenDoor(num25, num26 - 2, direction))
							{
								closeDoor = true;
								doorX = num25;
								doorY = num26 - 2;
								NetMessage.SendData(19, -1, -1, null, 0, num25, num26 - 2, direction);
								netUpdate = true;
								ai[1] += 80f;
							}
							else if (WorldGen.OpenDoor(num25, num26 - 2, -direction))
							{
								closeDoor = true;
								doorX = num25;
								doorY = num26 - 2;
								NetMessage.SendData(19, -1, -1, null, 0, num25, num26 - 2, -direction);
								netUpdate = true;
								ai[1] += 80f;
							}
							else if (WorldGen.ShiftTallGate(num25, num26 - 2, closing: false))
							{
								closeDoor = true;
								doorX = num25;
								doorY = num26 - 2;
								NetMessage.SendData(19, -1, -1, null, 4, num25, num26 - 2);
								netUpdate = true;
								ai[1] += 80f;
							}
							else
							{
								direction *= -1;
								netUpdate = true;
							}
						}
					}
					else
					{
						if ((velocity.X < 0f && direction == -1) || (velocity.X > 0f && direction == 1))
						{
							bool flag26 = false;
							bool flag27 = false;
							if (tileSafely5.nactive() && Main.tileSolid[tileSafely5.type] && !Main.tileSolidTop[tileSafely5.type] && (!flag25 || (tileSafely4.nactive() && Main.tileSolid[tileSafely4.type] && !Main.tileSolidTop[tileSafely4.type])))
							{
								if (!Collision.SolidTilesVersatile(num25 - direction * 2, num25 - direction, num26 - 5, num26 - 1) && !Collision.SolidTiles(num25, num25, num26 - 5, num26 - 3))
								{
									velocity.Y = -6f;
									netUpdate = true;
								}
								else if (flag7)
								{
									if (WorldGen.SolidTile((int)(base.Center.X / 16f) + direction, (int)(base.Center.Y / 16f)))
									{
										direction *= -1;
										velocity.X *= 0f;
										netUpdate = true;
									}
								}
								else if (flag16)
								{
									flag27 = true;
									flag26 = true;
								}
								else if (!flag24)
								{
									flag26 = true;
								}
							}
							else if (tileSafely4.nactive() && Main.tileSolid[tileSafely4.type] && !Main.tileSolidTop[tileSafely4.type])
							{
								if (!Collision.SolidTilesVersatile(num25 - direction * 2, num25 - direction, num26 - 4, num26 - 1) && !Collision.SolidTiles(num25, num25, num26 - 4, num26 - 2))
								{
									velocity.Y = -5f;
									netUpdate = true;
								}
								else if (flag16)
								{
									flag27 = true;
									flag26 = true;
								}
								else
								{
									flag26 = true;
								}
							}
							else if (position.Y + (float)height - (float)(num26 * 16) > 20f && tileSafely3.nactive() && Main.tileSolid[tileSafely3.type] && !tileSafely3.topSlope())
							{
								if (!Collision.SolidTilesVersatile(num25 - direction * 2, num25, num26 - 3, num26 - 1))
								{
									velocity.Y = -4.4f;
									netUpdate = true;
								}
								else if (flag16)
								{
									flag27 = true;
									flag26 = true;
								}
								else
								{
									flag26 = true;
								}
							}
							else if (avoidFalling3)
							{
								if (!flag24)
								{
									flag26 = true;
								}
								if (flag16)
								{
									flag27 = true;
								}
							}
							else if (flag14 && !Collision.SolidTilesVersatile(num25 - direction * 2, num25 - direction, num26 - 2, num26 - 1))
							{
								velocity.Y = -5f;
								netUpdate = true;
							}
							if (flag27)
							{
								keepwalking3 = false;
								velocity.X = 0f;
								ai[0] = 8f;
								ai[1] = 240f;
								netUpdate = true;
							}
							if (flag26)
							{
								direction *= -1;
								velocity.X *= -1f;
								netUpdate = true;
							}
							if (keepwalking3)
							{
								ai[1] = 90f;
								netUpdate = true;
							}
							if (velocity.Y < 0f)
							{
								localAI[3] = position.X;
							}
						}
						if (velocity.Y < 0f && wet)
						{
							velocity.Y *= 1.2f;
						}
						if (velocity.Y < 0f && NPCID.Sets.TownCritter[type] && !flag7)
						{
							velocity.Y *= 1.2f;
						}
					}
				}
				else if (flag14 && !wet)
				{
					int num35 = (int)(base.Center.X / 16f);
					int num36 = (int)((position.Y + (float)height - 16f) / 16f);
					int num37 = 0;
					for (int num38 = -1; num38 <= 1; num38++)
					{
						for (int num39 = 1; num39 <= 6; num39++)
						{
							Tile tileSafely6 = Framing.GetTileSafely(num35 + num38, num36 + num39);
							if (tileSafely6.liquid > 0 || (tileSafely6.nactive() && Main.tileSolid[tileSafely6.type]))
							{
								num37++;
							}
						}
					}
					if (num37 <= 2)
					{
						if (velocity.X != 0f)
						{
							netUpdate = true;
						}
						velocity.X *= 0.2f;
						ai[0] = 0f;
						ai[1] = 50 + Main.rand.Next(50);
						ai[2] = 0f;
						localAI[3] = 40f;
					}
				}
			}
		}
		else if (ai[0] == 2f || ai[0] == 11f)
		{
			if (Main.netMode != 1)
			{
				localAI[3] -= 1f;
				if (Main.rand.Next(60) == 0 && localAI[3] == 0f)
				{
					localAI[3] = 60f;
					direction *= -1;
					netUpdate = true;
				}
			}
			ai[1] -= 1f;
			velocity.X *= 0.8f;
			if (ai[1] <= 0f)
			{
				localAI[3] = 40f;
				ai[0] = 0f;
				ai[1] = 60 + Main.rand.Next(60);
				netUpdate = true;
			}
		}
		else if (ai[0] == 3f || ai[0] == 4f || ai[0] == 5f || ai[0] == 8f || ai[0] == 9f || ai[0] == 16f || ai[0] == 17f || ai[0] == 20f || ai[0] == 21f || ai[0] == 22f || ai[0] == 23f)
		{
			velocity.X *= 0.8f;
			ai[1] -= 1f;
			if (ai[0] == 8f && ai[1] < 60f && flag16)
			{
				ai[1] = 180f;
				netUpdate = true;
			}
			if (ai[0] == 5f)
			{
				Point coords = (base.Bottom + Vector2.UnitY * -2f).ToTileCoordinates();
				Tile tile = Main.tile[coords.X, coords.Y];
				if (tile != null && tile.type != 15 && tile.type != 497)
				{
					ai[1] = 0f;
				}
				else
				{
					Main.sittingManager.AddNPC(whoAmI, coords);
				}
			}
			if (ai[1] <= 0f)
			{
				ai[0] = 0f;
				ai[1] = 60 + Main.rand.Next(60);
				ai[2] = 0f;
				localAI[3] = 30 + Main.rand.Next(60);
				netUpdate = true;
			}
		}
		else if (ai[0] == 6f || ai[0] == 7f || ai[0] == 18f || ai[0] == 19f)
		{
			if (ai[0] == 18f && (localAI[3] < 1f || localAI[3] > 2f))
			{
				localAI[3] = 2f;
			}
			velocity.X *= 0.8f;
			ai[1] -= 1f;
			int num40 = (int)ai[2];
			if (num40 < 0 || num40 > 255 || !Main.player[num40].CanBeTalkedTo || Main.player[num40].Distance(base.Center) > 200f || !Collision.CanHitLine(base.Top, 0, 0, Main.player[num40].Top, 0, 0))
			{
				ai[1] = 0f;
			}
			if (ai[1] > 0f)
			{
				int num41 = ((base.Center.X < Main.player[num40].Center.X) ? 1 : (-1));
				if (num41 != direction)
				{
					netUpdate = true;
				}
				direction = num41;
			}
			else
			{
				ai[0] = 0f;
				ai[1] = 60 + Main.rand.Next(60);
				ai[2] = 0f;
				localAI[3] = 30 + Main.rand.Next(60);
				netUpdate = true;
			}
		}
		else if (ai[0] == 10f)
		{
			int num42 = 0;
			int num43 = 0;
			float knockBack = 0f;
			float num44 = 0f;
			int num45 = 0;
			int num46 = 0;
			int maxValue = 0;
			float num47 = 0f;
			float num48 = NPCID.Sets.DangerDetectRange[type];
			float num49 = 0f;
			if ((float)NPCID.Sets.AttackTime[type] == ai[1])
			{
				frameCounter = 0.0;
				localAI[3] = 0f;
			}
			if (type == 38)
			{
				num42 = 30;
				num44 = 6f;
				num43 = 20;
				num45 = 10;
				num46 = 180;
				maxValue = 120;
				num47 = 16f;
				knockBack = 7f;
			}
			else if (type == 633)
			{
				num42 = 880;
				num44 = 24f;
				num43 = 15;
				num45 = 1;
				num47 = 0f;
				knockBack = 7f;
				num46 = 15;
				maxValue = 10;
				if (ShouldBestiaryGirlBeLycantrope())
				{
					num42 = 929;
					num43 = (int)((float)num43 * 1.5f);
				}
			}
			else if (type == 550)
			{
				num42 = 669;
				num44 = 6f;
				num43 = 24;
				num45 = 10;
				num46 = 120;
				maxValue = 60;
				num47 = 16f;
				knockBack = 9f;
			}
			else if (type == 588)
			{
				num42 = 721;
				num44 = 8f;
				num43 = 15;
				num45 = 5;
				num46 = 20;
				maxValue = 10;
				num47 = 16f;
				knockBack = 9f;
			}
			else if (type == 208)
			{
				num42 = 588;
				num44 = 6f;
				num43 = 30;
				num45 = 10;
				num46 = 60;
				maxValue = 120;
				num47 = 16f;
				knockBack = 6f;
			}
			else if (type == 17)
			{
				num42 = 48;
				num44 = 9f;
				num43 = 12;
				num45 = 10;
				num46 = 60;
				maxValue = 60;
				num47 = 16f;
				knockBack = 1.5f;
			}
			else if (type == 369)
			{
				num42 = 520;
				num44 = 12f;
				num43 = 10;
				num45 = 10;
				num46 = 0;
				maxValue = 1;
				num47 = 16f;
				knockBack = 3f;
			}
			else if (type == 453)
			{
				num42 = 21;
				num44 = 14f;
				num43 = 14;
				num45 = 10;
				num46 = 0;
				maxValue = 1;
				num47 = 16f;
				knockBack = 3f;
			}
			else if (type == 107)
			{
				num42 = 24;
				num44 = 5f;
				num43 = 15;
				num45 = 10;
				num46 = 60;
				maxValue = 60;
				num47 = 16f;
				knockBack = 1f;
			}
			else if (type == 124)
			{
				num42 = 582;
				num44 = 10f;
				num43 = 11;
				num45 = 1;
				num46 = 30;
				maxValue = 30;
				knockBack = 3.5f;
			}
			else if (type == 18)
			{
				num42 = 583;
				num44 = 8f;
				num43 = 8;
				num45 = 1;
				num46 = 15;
				maxValue = 10;
				knockBack = 2f;
				num47 = 10f;
			}
			else if (type == 142)
			{
				num42 = 589;
				num44 = 7f;
				num43 = 22;
				num45 = 1;
				num46 = 10;
				maxValue = 1;
				knockBack = 2f;
				num47 = 10f;
			}
			num43 = GetAttackDamage_ForTownNPC((float)num43 * num2);
			velocity.X *= 0.8f;
			ai[1] -= 1f;
			localAI[3] += 1f;
			if (localAI[3] == (float)num45 && Main.netMode != 1)
			{
				Vector2 vec = -Vector2.UnitY;
				if (num15 == 1 && spriteDirection == 1 && num17 != -1)
				{
					vec = DirectionTo(Main.npc[num17].Center + new Vector2(0f, (0f - num47) * MathHelper.Clamp(Distance(Main.npc[num17].Center) / num48, 0f, 1f)));
				}
				if (num15 == -1 && spriteDirection == -1 && num16 != -1)
				{
					vec = DirectionTo(Main.npc[num16].Center + new Vector2(0f, (0f - num47) * MathHelper.Clamp(Distance(Main.npc[num16].Center) / num48, 0f, 1f)));
				}
				if (vec.HasNaNs() || Math.Sign(vec.X) != spriteDirection)
				{
					vec = new Vector2(spriteDirection, -1f);
				}
				vec *= num44;
				vec += Utils.RandomVector2(Main.rand, 0f - num49, num49);
				int num50 = 1000;
				num50 = ((type == 124) ? Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X + (float)(spriteDirection * 16), base.Center.Y - 2f, vec.X, vec.Y, num42, num43, knockBack, Main.myPlayer, 0f, whoAmI, townNpcVariationIndex) : ((type != 142) ? Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X + (float)(spriteDirection * 16), base.Center.Y - 2f, vec.X, vec.Y, num42, num43, knockBack, Main.myPlayer) : Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X + (float)(spriteDirection * 16), base.Center.Y - 2f, vec.X, vec.Y, num42, num43, knockBack, Main.myPlayer, 0f, Main.rand.Next(5))));
				Main.projectile[num50].npcProj = true;
				Main.projectile[num50].noDropItem = true;
				if (type == 588)
				{
					Main.projectile[num50].timeLeft = 480;
				}
			}
			if (ai[1] <= 0f && 0 == 0)
			{
				ai[0] = ((localAI[2] == 8f && flag16) ? 8 : 0);
				ai[1] = num46 + Main.rand.Next(maxValue);
				ai[2] = 0f;
				localAI[1] = (localAI[3] = num46 / 2 + Main.rand.Next(maxValue));
				netUpdate = true;
			}
		}
		else if (ai[0] == 12f)
		{
			int num51 = 0;
			int num52 = 0;
			float num53 = 0f;
			int num54 = 0;
			int num55 = 0;
			int maxValue2 = 0;
			float knockBack2 = 0f;
			int num56 = 0;
			bool flag28 = false;
			float num57 = 0f;
			if ((float)NPCID.Sets.AttackTime[type] == ai[1])
			{
				frameCounter = 0.0;
				localAI[3] = 0f;
			}
			int num58 = -1;
			if (num15 == 1 && spriteDirection == 1)
			{
				num58 = num17;
			}
			if (num15 == -1 && spriteDirection == -1)
			{
				num58 = num16;
			}
			if (type == 19)
			{
				num51 = 14;
				num53 = 13f;
				num52 = 24;
				num55 = 14;
				maxValue2 = 4;
				knockBack2 = 3f;
				num54 = 1;
				num57 = 0.5f;
				if ((float)NPCID.Sets.AttackTime[type] == ai[1])
				{
					frameCounter = 0.0;
					localAI[3] = 0f;
				}
				if (Main.hardMode)
				{
					num52 = 15;
					if (localAI[3] > (float)num54)
					{
						num54 = 10;
						flag28 = true;
					}
					if (localAI[3] > (float)num54)
					{
						num54 = 20;
						flag28 = true;
					}
					if (localAI[3] > (float)num54)
					{
						num54 = 30;
						flag28 = true;
					}
				}
			}
			else if (type == 227)
			{
				num51 = 587;
				num53 = 10f;
				num52 = 8;
				num55 = 10;
				maxValue2 = 1;
				knockBack2 = 1.75f;
				num54 = 1;
				num57 = 0.5f;
				if (localAI[3] > (float)num54)
				{
					num54 = 12;
					flag28 = true;
				}
				if (localAI[3] > (float)num54)
				{
					num54 = 24;
					flag28 = true;
				}
				if (Main.hardMode)
				{
					num52 += 2;
				}
			}
			else if (type == 368)
			{
				num51 = 14;
				num53 = 13f;
				num52 = 24;
				num55 = 12;
				maxValue2 = 5;
				knockBack2 = 2f;
				num54 = 1;
				num57 = 0.2f;
				if (Main.hardMode)
				{
					num52 = 30;
					num51 = 357;
				}
			}
			else if (type == 22)
			{
				num53 = 10f;
				num52 = 12;
				num54 = 1;
				if (Main.hardMode)
				{
					num51 = 2;
					num55 = 15;
					maxValue2 = 10;
					num52 += 6;
				}
				else
				{
					num51 = 1;
					num55 = 30;
					maxValue2 = 20;
				}
				knockBack2 = 2.75f;
				num56 = 4;
				num57 = 0.7f;
			}
			else if (type == 228)
			{
				num51 = 267;
				num53 = 14f;
				num52 = 20;
				num54 = 1;
				num55 = 10;
				maxValue2 = 1;
				knockBack2 = 3f;
				num56 = 6;
				num57 = 0.4f;
			}
			else if (type == 178)
			{
				num51 = 242;
				num53 = 13f;
				num52 = ((!Main.hardMode) ? 11 : 15);
				num55 = 10;
				maxValue2 = 1;
				knockBack2 = 2f;
				num54 = 1;
				if (localAI[3] > (float)num54)
				{
					num54 = 8;
					flag28 = true;
				}
				if (localAI[3] > (float)num54)
				{
					num54 = 16;
					flag28 = true;
				}
				num57 = 0.3f;
			}
			else if (type == 229)
			{
				num51 = 14;
				num53 = 14f;
				num52 = 24;
				num55 = 10;
				maxValue2 = 1;
				knockBack2 = 2f;
				num54 = 1;
				num57 = 0.7f;
				if (localAI[3] > (float)num54)
				{
					num54 = 16;
					flag28 = true;
				}
				if (localAI[3] > (float)num54)
				{
					num54 = 24;
					flag28 = true;
				}
				if (localAI[3] > (float)num54)
				{
					num54 = 32;
					flag28 = true;
				}
				if (localAI[3] > (float)num54)
				{
					num54 = 40;
					flag28 = true;
				}
				if (localAI[3] > (float)num54)
				{
					num54 = 48;
					flag28 = true;
				}
				if (localAI[3] == 0f && num58 != -1 && Distance(Main.npc[num58].Center) < (float)NPCID.Sets.PrettySafe[type])
				{
					num57 = 0.1f;
					num51 = 162;
					num52 = 50;
					knockBack2 = 10f;
					num53 = 24f;
				}
			}
			else if (type == 209)
			{
				num51 = Utils.SelectRandom<int>(Main.rand, 134, 133, 135);
				num54 = 1;
				switch (num51)
				{
				case 135:
					num53 = 12f;
					num52 = 30;
					num55 = 30;
					maxValue2 = 10;
					knockBack2 = 7f;
					num57 = 0.2f;
					break;
				case 133:
					num53 = 10f;
					num52 = 25;
					num55 = 10;
					maxValue2 = 1;
					knockBack2 = 6f;
					num57 = 0.2f;
					break;
				case 134:
					num53 = 13f;
					num52 = 20;
					num55 = 20;
					maxValue2 = 10;
					knockBack2 = 4f;
					num57 = 0.1f;
					break;
				}
			}
			num52 = GetAttackDamage_ForTownNPC((float)num52 * num2);
			velocity.X *= 0.8f;
			ai[1] -= 1f;
			localAI[3] += 1f;
			if (localAI[3] == (float)num54 && Main.netMode != 1)
			{
				Vector2 vec2 = Vector2.Zero;
				if (num58 != -1)
				{
					vec2 = DirectionTo(Main.npc[num58].Center + new Vector2(0f, -num56));
				}
				if (vec2.HasNaNs() || Math.Sign(vec2.X) != spriteDirection)
				{
					vec2 = new Vector2(spriteDirection, 0f);
				}
				vec2 *= num53;
				vec2 += Utils.RandomVector2(Main.rand, 0f - num57, num57);
				int num59 = 1000;
				num59 = ((type != 227) ? Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X + (float)(spriteDirection * 16), base.Center.Y - 2f, vec2.X, vec2.Y, num51, num52, knockBack2, Main.myPlayer) : Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X + (float)(spriteDirection * 16), base.Center.Y - 2f, vec2.X, vec2.Y, num51, num52, knockBack2, Main.myPlayer, 0f, (float)Main.rand.Next(12) / 6f));
				Main.projectile[num59].npcProj = true;
				Main.projectile[num59].noDropItem = true;
			}
			if (localAI[3] == (float)num54 && flag28 && num58 != -1)
			{
				Vector2 vector2 = DirectionTo(Main.npc[num58].Center);
				if (vector2.Y <= 0.5f && vector2.Y >= -0.5f)
				{
					ai[2] = vector2.Y;
				}
			}
			if (ai[1] <= 0f && 0 == 0)
			{
				ai[0] = ((localAI[2] == 8f && flag16) ? 8 : 0);
				ai[1] = num55 + Main.rand.Next(maxValue2);
				ai[2] = 0f;
				localAI[1] = (localAI[3] = num55 / 2 + Main.rand.Next(maxValue2));
				netUpdate = true;
			}
		}
		else if (ai[0] == 13f)
		{
			velocity.X *= 0.8f;
			if ((float)NPCID.Sets.AttackTime[type] == ai[1])
			{
				frameCounter = 0.0;
			}
			ai[1] -= 1f;
			localAI[3] += 1f;
			if (localAI[3] == 1f && Main.netMode != 1)
			{
				Vector2 vec3 = DirectionTo(Main.npc[(int)ai[2]].Center + new Vector2(0f, -20f));
				if (vec3.HasNaNs() || Math.Sign(vec3.X) == -spriteDirection)
				{
					vec3 = new Vector2(spriteDirection, -1f);
				}
				vec3 *= 8f;
				int num60 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X + (float)(spriteDirection * 16), base.Center.Y - 2f, vec3.X, vec3.Y, 584, 0, 0f, Main.myPlayer, ai[2]);
				Main.projectile[num60].npcProj = true;
				Main.projectile[num60].noDropItem = true;
			}
			if (ai[1] <= 0f)
			{
				ai[0] = 0f;
				ai[1] = 10 + Main.rand.Next(10);
				ai[2] = 0f;
				localAI[3] = 5 + Main.rand.Next(10);
				netUpdate = true;
			}
		}
		else if (ai[0] == 14f)
		{
			int num61 = 0;
			int num62 = 0;
			float num63 = 0f;
			int num64 = 0;
			int num65 = 0;
			int maxValue3 = 0;
			float knockBack3 = 0f;
			float num66 = 0f;
			float num67 = NPCID.Sets.DangerDetectRange[type];
			float num68 = 1f;
			float num69 = 0f;
			if ((float)NPCID.Sets.AttackTime[type] == ai[1])
			{
				frameCounter = 0.0;
				localAI[3] = 0f;
			}
			int num70 = -1;
			if (num15 == 1 && spriteDirection == 1)
			{
				num70 = num17;
			}
			if (num15 == -1 && spriteDirection == -1)
			{
				num70 = num16;
			}
			if (type == 54)
			{
				num61 = 585;
				num63 = 10f;
				num62 = 16;
				num64 = 30;
				num65 = 20;
				maxValue3 = 15;
				knockBack3 = 2f;
				num69 = 1f;
			}
			else if (type == 108)
			{
				num61 = 15;
				num63 = 6f;
				num62 = 18;
				num64 = 15;
				num65 = 15;
				maxValue3 = 5;
				knockBack3 = 3f;
				num66 = 20f;
			}
			else if (type == 160)
			{
				num61 = 590;
				num62 = 40;
				num64 = 15;
				num65 = 10;
				maxValue3 = 1;
				knockBack3 = 3f;
				for (; localAI[3] > (float)num64; num64 += 15)
				{
				}
			}
			else if (type == 663)
			{
				num61 = 950;
				num62 = ((!Main.hardMode) ? 15 : 20);
				num64 = 15;
				num65 = 0;
				maxValue3 = 0;
				knockBack3 = 3f;
				for (; localAI[3] > (float)num64; num64 += 10)
				{
				}
			}
			else if (type == 20)
			{
				num61 = 586;
				num64 = 24;
				num65 = 10;
				maxValue3 = 1;
				knockBack3 = 3f;
			}
			num62 = GetAttackDamage_ForTownNPC((float)num62 * num2);
			velocity.X *= 0.8f;
			ai[1] -= 1f;
			localAI[3] += 1f;
			if (localAI[3] == (float)num64 && Main.netMode != 1)
			{
				Vector2 vec4 = Vector2.Zero;
				if (num70 != -1)
				{
					vec4 = DirectionTo(Main.npc[num70].Center + new Vector2(0f, (0f - num66) * MathHelper.Clamp(Distance(Main.npc[num70].Center) / num67, 0f, 1f)));
				}
				if (vec4.HasNaNs() || Math.Sign(vec4.X) != spriteDirection)
				{
					vec4 = new Vector2(spriteDirection, 0f);
				}
				vec4 *= num63;
				vec4 += Utils.RandomVector2(Main.rand, 0f - num69, num69);
				if (type == 108)
				{
					int num71 = Utils.SelectRandom<int>(Main.rand, 1, 1, 1, 1, 2, 2, 3);
					for (int num72 = 0; num72 < num71; num72++)
					{
						Vector2 vector3 = Utils.RandomVector2(Main.rand, -3.4f, 3.4f);
						int num73 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X + (float)(spriteDirection * 16), base.Center.Y - 2f, vec4.X + vector3.X, vec4.Y + vector3.Y, num61, num62, knockBack3, Main.myPlayer, 0f, 0f, townNpcVariationIndex);
						Main.projectile[num73].npcProj = true;
						Main.projectile[num73].noDropItem = true;
					}
				}
				else if (type == 160)
				{
					if (num70 != -1)
					{
						Vector2 vector4 = Main.npc[num70].position - Main.npc[num70].Size * 2f + Main.npc[num70].Size * Utils.RandomVector2(Main.rand, 0f, 1f) * 5f;
						int num74 = 10;
						while (num74 > 0 && WorldGen.SolidTile(Framing.GetTileSafely((int)vector4.X / 16, (int)vector4.Y / 16)))
						{
							num74--;
							vector4 = Main.npc[num70].position - Main.npc[num70].Size * 2f + Main.npc[num70].Size * Utils.RandomVector2(Main.rand, 0f, 1f) * 5f;
						}
						int num75 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector4.X, vector4.Y, 0f, 0f, num61, num62, knockBack3, Main.myPlayer, 0f, 0f, townNpcVariationIndex);
						Main.projectile[num75].npcProj = true;
						Main.projectile[num75].noDropItem = true;
					}
				}
				else if (type == 663)
				{
					if (num70 != -1)
					{
						Vector2 vector5 = Main.npc[num70].position + Main.npc[num70].Size * Utils.RandomVector2(Main.rand, 0f, 1f) * 1f;
						int num76 = 5;
						while (num76 > 0 && WorldGen.SolidTile(Framing.GetTileSafely((int)vector5.X / 16, (int)vector5.Y / 16)))
						{
							num76--;
							vector5 = Main.npc[num70].position + Main.npc[num70].Size * Utils.RandomVector2(Main.rand, 0f, 1f) * 1f;
						}
						int num77 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector5.X, vector5.Y, 0f, 0f, num61, num62, knockBack3, Main.myPlayer, 0f, 0f, townNpcVariationIndex);
						Main.projectile[num77].npcProj = true;
						Main.projectile[num77].noDropItem = true;
					}
				}
				else if (type == 20)
				{
					int num78 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X + (float)(spriteDirection * 16), base.Center.Y - 2f, vec4.X, vec4.Y, num61, num62, knockBack3, Main.myPlayer, 0f, whoAmI, townNpcVariationIndex);
					Main.projectile[num78].npcProj = true;
					Main.projectile[num78].noDropItem = true;
				}
				else
				{
					int num79 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X + (float)(spriteDirection * 16), base.Center.Y - 2f, vec4.X, vec4.Y, num61, num62, knockBack3, Main.myPlayer);
					Main.projectile[num79].npcProj = true;
					Main.projectile[num79].noDropItem = true;
				}
			}
			if (num68 > 0f)
			{
				Vector3 vector6 = GetMagicAuraColor().ToVector3() * num68;
				Lighting.AddLight(base.Center, vector6.X, vector6.Y, vector6.Z);
			}
			if (ai[1] <= 0f && 0 == 0)
			{
				ai[0] = ((localAI[2] == 8f && flag16) ? 8 : 0);
				ai[1] = num65 + Main.rand.Next(maxValue3);
				ai[2] = 0f;
				localAI[1] = (localAI[3] = num65 / 2 + Main.rand.Next(maxValue3));
				netUpdate = true;
			}
		}
		else if (ai[0] == 15f)
		{
			int num80 = 0;
			int maxValue4 = 0;
			if ((float)NPCID.Sets.AttackTime[type] == ai[1])
			{
				frameCounter = 0.0;
				localAI[3] = 0f;
			}
			int num81 = 0;
			float num82 = 0f;
			int num83 = 0;
			int num84 = 0;
			if (num15 == 1)
			{
				_ = spriteDirection;
				_ = 1;
			}
			if (num15 == -1)
			{
				_ = spriteDirection;
				_ = -1;
			}
			if (type == 207)
			{
				num81 = 11;
				num83 = (num84 = 32);
				num80 = 12;
				maxValue4 = 6;
				num82 = 4.25f;
			}
			else if (type == 441)
			{
				num81 = 9;
				num83 = (num84 = 28);
				num80 = 9;
				maxValue4 = 3;
				num82 = 3.5f;
				if (GivenName == "Andrew")
				{
					num81 *= 2;
					num82 *= 2f;
				}
			}
			else if (type == 353)
			{
				num81 = 10;
				num83 = (num84 = 32);
				num80 = 15;
				maxValue4 = 8;
				num82 = 5f;
			}
			else if (NPCID.Sets.IsTownPet[type])
			{
				num81 = 10;
				num83 = (num84 = 32);
				num80 = 15;
				maxValue4 = 8;
				num82 = 3f;
			}
			num81 = GetAttackDamage_ForTownNPC((float)num81 * num2);
			velocity.X *= 0.8f;
			ai[1] -= 1f;
			if (Main.netMode != 1)
			{
				Tuple<Vector2, float> swingStats = GetSwingStats(NPCID.Sets.AttackTime[type] * 2, (int)ai[1], spriteDirection, num83, num84);
				Rectangle itemRectangle = new Rectangle((int)swingStats.Item1.X, (int)swingStats.Item1.Y, num83, num84);
				if (spriteDirection == -1)
				{
					itemRectangle.X -= num83;
				}
				itemRectangle.Y -= num84;
				TweakSwingStats(NPCID.Sets.AttackTime[type] * 2, (int)ai[1], spriteDirection, ref itemRectangle);
				int myPlayer = Main.myPlayer;
				for (int num85 = 0; num85 < Main.maxNPCs; num85++)
				{
					NPC nPC2 = Main.npc[num85];
					if (nPC2.active && nPC2.immune[myPlayer] == 0 && !nPC2.dontTakeDamage && !nPC2.friendly && nPC2.damage > 0 && itemRectangle.Intersects(nPC2.Hitbox) && (nPC2.noTileCollide || Collision.CanHit(position, width, height, nPC2.position, nPC2.width, nPC2.height)))
					{
						nPC2.StrikeNPCNoInteraction(num81, num82, spriteDirection);
						if (Main.netMode != 0)
						{
							NetMessage.SendData(28, -1, -1, null, num85, num81, num82, spriteDirection);
						}
						nPC2.netUpdate = true;
						nPC2.immune[myPlayer] = (int)ai[1] + 2;
					}
				}
			}
			if (ai[1] <= 0f)
			{
				bool flag29 = false;
				if (flag16)
				{
					int num86 = -num15;
					if (!Collision.CanHit(base.Center, 0, 0, base.Center + Vector2.UnitX * num86 * 32f, 0, 0) || localAI[2] == 8f)
					{
						flag29 = true;
					}
					if (flag29)
					{
						int num87 = NPCID.Sets.AttackTime[type];
						int num88 = ((num15 == 1) ? num17 : num16);
						int num89 = ((num15 == 1) ? num16 : num17);
						if (num88 != -1 && !Collision.CanHit(base.Center, 0, 0, Main.npc[num88].Center, 0, 0))
						{
							num88 = ((num89 == -1 || !Collision.CanHit(base.Center, 0, 0, Main.npc[num89].Center, 0, 0)) ? (-1) : num89);
						}
						if (num88 != -1)
						{
							ai[0] = 15f;
							ai[1] = num87;
							ai[2] = 0f;
							localAI[3] = 0f;
							direction = ((position.X < Main.npc[num88].position.X) ? 1 : (-1));
							netUpdate = true;
						}
						else
						{
							flag29 = false;
						}
					}
				}
				if (!flag29)
				{
					ai[0] = ((localAI[2] == 8f && flag16) ? 8 : 0);
					ai[1] = num80 + Main.rand.Next(maxValue4);
					ai[2] = 0f;
					localAI[1] = (localAI[3] = num80 / 2 + Main.rand.Next(maxValue4));
					netUpdate = true;
				}
			}
		}
		else if (ai[0] == 24f)
		{
			velocity.X *= 0.8f;
			ai[1] -= 1f;
			localAI[3] += 1f;
			direction = 1;
			spriteDirection = 1;
			Vector3 vector7 = GetMagicAuraColor().ToVector3();
			Lighting.AddLight(base.Center, vector7.X, vector7.Y, vector7.Z);
			if (ai[1] <= 0f)
			{
				ai[0] = 0f;
				ai[1] = 480f;
				ai[2] = 0f;
				localAI[1] = 480f;
				netUpdate = true;
			}
		}
		if (flag13 && wet)
		{
			int num90 = (int)(base.Center.X / 16f);
			int num91 = 5;
			if (collideX || (num90 < num91 && direction == -1) || (num90 > Main.maxTilesX - num91 && direction == 1))
			{
				direction *= -1;
				velocity.X *= -0.25f;
				netUpdate = true;
			}
			velocity.Y *= 0.9f;
			velocity.Y -= 0.5f;
			if (velocity.Y < -15f)
			{
				velocity.Y = -15f;
			}
		}
		if (flag12 && wet)
		{
			if (flag9)
			{
				ai[1] = 50f;
			}
			int num92 = (int)(base.Center.X / 16f);
			int num93 = 5;
			if (collideX || (num92 < num93 && direction == -1) || (num92 > Main.maxTilesX - num93 && direction == 1))
			{
				direction *= -1;
				velocity.X *= -0.25f;
				netUpdate = true;
			}
			if (Collision.GetWaterLine(base.Center.ToTileCoordinates(), out var waterLineHeight))
			{
				float num94 = base.Center.Y + 1f;
				if (base.Center.Y > waterLineHeight)
				{
					velocity.Y -= 0.8f;
					if (velocity.Y < -4f)
					{
						velocity.Y = -4f;
					}
					if (num94 + velocity.Y < waterLineHeight)
					{
						velocity.Y = waterLineHeight - num94;
					}
				}
				else
				{
					velocity.Y = MathHelper.Min(velocity.Y, waterLineHeight - num94);
				}
			}
			else
			{
				velocity.Y -= 0.2f;
			}
		}
		if (Main.netMode != 1 && isLikeATownNPC && (!flag5 || flag16))
		{
			if (flag5)
			{
				num3 *= 0.8f;
				num15 = ((num13 == -1f) ? 1 : ((num14 != -1f) ? (num14 < 0f - num13).ToDirectionInt() : (-1)));
			}
			bool flag30 = ai[0] < 2f && !flag16 && !wet;
			bool flag31 = (ai[0] < 2f || ai[0] == 8f) && (flag16 || flag18) && !flag17;
			if (localAI[1] > 0f)
			{
				localAI[1] -= 1f;
			}
			if (localAI[1] > 0f)
			{
				flag31 = false;
			}
			if (flag31 && type == 124 && localAI[0] == 1f)
			{
				flag31 = false;
			}
			if (flag31 && type == 20)
			{
				flag31 = false;
				for (int num95 = 0; num95 < Main.maxNPCs; num95++)
				{
					NPC nPC3 = Main.npc[num95];
					if (nPC3.active && nPC3.townNPC && !(Distance(nPC3.Center) > 1200f) && nPC3.FindBuffIndex(165) == -1)
					{
						flag31 = true;
						break;
					}
				}
			}
			if (CanTalk && flag30 && ai[0] == 0f && velocity.Y == 0f && Main.rand.Next(300) == 0)
			{
				int num96 = 420;
				num96 = ((Main.rand.Next(2) != 0) ? (num96 * Main.rand.Next(1, 3)) : (num96 * Main.rand.Next(1, 4)));
				int num97 = 100;
				int num98 = 20;
				for (int num99 = 0; num99 < Main.maxNPCs; num99++)
				{
					NPC nPC4 = Main.npc[num99];
					bool flag32 = (nPC4.ai[0] == 1f && nPC4.closeDoor) || (nPC4.ai[0] == 1f && nPC4.ai[1] > 200f) || nPC4.ai[0] > 1f || nPC4.wet;
					if (nPC4 != this && nPC4.active && nPC4.CanBeTalkedTo && !flag32 && nPC4.Distance(base.Center) < (float)num97 && nPC4.Distance(base.Center) > (float)num98 && Collision.CanHit(base.Center, 0, 0, nPC4.Center, 0, 0))
					{
						int num100 = (position.X < nPC4.position.X).ToDirectionInt();
						ai[0] = 3f;
						ai[1] = num96;
						ai[2] = num99;
						direction = num100;
						netUpdate = true;
						nPC4.ai[0] = 4f;
						nPC4.ai[1] = num96;
						nPC4.ai[2] = whoAmI;
						nPC4.direction = -num100;
						nPC4.netUpdate = true;
						break;
					}
				}
			}
			else if (CanTalk && flag30 && ai[0] == 0f && velocity.Y == 0f && Main.rand.Next(1800) == 0)
			{
				int num101 = 420;
				num101 = ((Main.rand.Next(2) != 0) ? (num101 * Main.rand.Next(1, 3)) : (num101 * Main.rand.Next(1, 4)));
				int num102 = 100;
				int num103 = 20;
				for (int num104 = 0; num104 < Main.maxNPCs; num104++)
				{
					NPC nPC5 = Main.npc[num104];
					bool flag33 = (nPC5.ai[0] == 1f && nPC5.closeDoor) || (nPC5.ai[0] == 1f && nPC5.ai[1] > 200f) || nPC5.ai[0] > 1f || nPC5.wet;
					if (nPC5 != this && nPC5.active && nPC5.CanBeTalkedTo && !NPCID.Sets.IsTownPet[nPC5.type] && !flag33 && nPC5.Distance(base.Center) < (float)num102 && nPC5.Distance(base.Center) > (float)num103 && Collision.CanHit(base.Center, 0, 0, nPC5.Center, 0, 0))
					{
						int num105 = (position.X < nPC5.position.X).ToDirectionInt();
						ai[0] = 16f;
						ai[1] = num101;
						ai[2] = num104;
						localAI[2] = Main.rand.Next(4);
						localAI[3] = Main.rand.Next(3 - (int)localAI[2]);
						direction = num105;
						netUpdate = true;
						nPC5.ai[0] = 17f;
						nPC5.ai[1] = num101;
						nPC5.ai[2] = whoAmI;
						nPC5.localAI[2] = 0f;
						nPC5.localAI[3] = 0f;
						nPC5.direction = -num105;
						nPC5.netUpdate = true;
						break;
					}
				}
			}
			else if (!NPCID.Sets.IsTownPet[type] && flag30 && ai[0] == 0f && velocity.Y == 0f && Main.rand.Next(1200) == 0 && (type == 208 || (BirthdayParty.PartyIsUp && NPCID.Sets.AttackType[type] == NPCID.Sets.AttackType[208])))
			{
				int num106 = 300;
				int num107 = 150;
				for (int num108 = 0; num108 < 255; num108++)
				{
					Player player = Main.player[num108];
					if (player.active && !player.dead && player.Distance(base.Center) < (float)num107 && Collision.CanHitLine(base.Top, 0, 0, player.Top, 0, 0))
					{
						int num109 = (position.X < player.position.X).ToDirectionInt();
						ai[0] = 6f;
						ai[1] = num106;
						ai[2] = num108;
						direction = num109;
						netUpdate = true;
						break;
					}
				}
			}
			else if (flag30 && ai[0] == 0f && velocity.Y == 0f && Main.rand.Next(600) == 0 && type == 550)
			{
				int num110 = 300;
				int num111 = 150;
				for (int num112 = 0; num112 < 255; num112++)
				{
					Player player2 = Main.player[num112];
					if (player2.active && !player2.dead && player2.Distance(base.Center) < (float)num111 && Collision.CanHitLine(base.Top, 0, 0, player2.Top, 0, 0))
					{
						int num113 = (position.X < player2.position.X).ToDirectionInt();
						ai[0] = 18f;
						ai[1] = num110;
						ai[2] = num112;
						direction = num113;
						netUpdate = true;
						break;
					}
				}
			}
			else if (!NPCID.Sets.IsTownPet[type] && flag30 && ai[0] == 0f && velocity.Y == 0f && Main.rand.Next(1800) == 0)
			{
				ai[0] = 2f;
				ai[1] = 45 * Main.rand.Next(1, 2);
				netUpdate = true;
			}
			else if (flag30 && ai[0] == 0f && velocity.Y == 0f && Main.rand.Next(600) == 0 && type == 229 && !flag18)
			{
				ai[0] = 11f;
				ai[1] = 30 * Main.rand.Next(1, 4);
				netUpdate = true;
			}
			else if (flag30 && ai[0] == 0f && velocity.Y == 0f && Main.rand.Next(1200) == 0)
			{
				int num114 = 220;
				int num115 = 150;
				for (int num116 = 0; num116 < 255; num116++)
				{
					Player player3 = Main.player[num116];
					if (player3.CanBeTalkedTo && player3.Distance(base.Center) < (float)num115 && Collision.CanHitLine(base.Top, 0, 0, player3.Top, 0, 0))
					{
						int num117 = (position.X < player3.position.X).ToDirectionInt();
						ai[0] = 7f;
						ai[1] = num114;
						ai[2] = num116;
						direction = num117;
						netUpdate = true;
						break;
					}
				}
			}
			else if (flag30 && ai[0] == 1f && velocity.Y == 0f && num > 0 && Main.rand.Next(num) == 0)
			{
				Point point = (base.Bottom + Vector2.UnitY * -2f).ToTileCoordinates();
				bool flag34 = WorldGen.InWorld(point.X, point.Y, 1);
				if (flag34)
				{
					for (int num118 = 0; num118 < Main.maxNPCs; num118++)
					{
						if (Main.npc[num118].active && Main.npc[num118].aiStyle == 7 && Main.npc[num118].townNPC && Main.npc[num118].ai[0] == 5f && (Main.npc[num118].Bottom + Vector2.UnitY * -2f).ToTileCoordinates() == point)
						{
							flag34 = false;
							break;
						}
					}
					for (int num119 = 0; num119 < 255; num119++)
					{
						if (Main.player[num119].active && Main.player[num119].sitting.isSitting && Main.player[num119].Center.ToTileCoordinates() == point)
						{
							flag34 = false;
							break;
						}
					}
				}
				if (flag34)
				{
					Tile tile2 = Main.tile[point.X, point.Y];
					flag34 = tile2.type == 15 || tile2.type == 497;
					if (flag34 && tile2.type == 15 && tile2.frameY >= 1080 && tile2.frameY <= 1098)
					{
						flag34 = false;
					}
					if (flag34)
					{
						ai[0] = 5f;
						ai[1] = 900 + Main.rand.Next(10800);
						direction = ((tile2.frameX != 0) ? 1 : (-1));
						base.Bottom = new Vector2(point.X * 16 + 8 + 2 * direction, point.Y * 16 + 16);
						velocity = Vector2.Zero;
						localAI[3] = 0f;
						netUpdate = true;
					}
				}
			}
			else if (flag30 && ai[0] == 1f && velocity.Y == 0f && Main.rand.Next(600) == 0 && Utils.PlotTileLine(base.Top, base.Bottom, width, DelegateMethods.SearchAvoidedByNPCs))
			{
				Point point2 = (base.Center + new Vector2(direction * 10, 0f)).ToTileCoordinates();
				bool flag35 = WorldGen.InWorld(point2.X, point2.Y, 1);
				if (flag35)
				{
					Tile tileSafely7 = Framing.GetTileSafely(point2.X, point2.Y);
					if (!tileSafely7.nactive() || !TileID.Sets.InteractableByNPCs[tileSafely7.type])
					{
						flag35 = false;
					}
				}
				if (flag35)
				{
					ai[0] = 9f;
					ai[1] = 40 + Main.rand.Next(90);
					velocity = Vector2.Zero;
					localAI[3] = 0f;
					netUpdate = true;
				}
			}
			if (Main.netMode != 1 && ai[0] < 2f && velocity.Y == 0f && type == 18 && breath > 0)
			{
				int num120 = -1;
				for (int num121 = 0; num121 < Main.maxNPCs; num121++)
				{
					NPC nPC6 = Main.npc[num121];
					if (nPC6.active && nPC6.townNPC && nPC6.life != nPC6.lifeMax && (num120 == -1 || nPC6.lifeMax - nPC6.life > Main.npc[num120].lifeMax - Main.npc[num120].life) && Collision.CanHitLine(position, width, height, nPC6.position, nPC6.width, nPC6.height) && Distance(nPC6.Center) < 500f)
					{
						num120 = num121;
					}
				}
				if (num120 != -1)
				{
					ai[0] = 13f;
					ai[1] = 34f;
					ai[2] = num120;
					localAI[3] = 0f;
					direction = ((position.X < Main.npc[num120].position.X) ? 1 : (-1));
					netUpdate = true;
				}
			}
			int num122 = (int)((float)NPCID.Sets.AttackAverageChance[type] * num3);
			if (num122 < 1)
			{
				num122 = 1;
			}
			if (flag31 && velocity.Y == 0f && NPCID.Sets.AttackType[type] == 0 && NPCID.Sets.AttackAverageChance[type] > 0 && Main.rand.Next(num122) == 0)
			{
				int num123 = NPCID.Sets.AttackTime[type];
				int num124 = ((num15 == 1) ? num17 : num16);
				int num125 = ((num15 == 1) ? num16 : num17);
				if (num124 != -1 && !Collision.CanHit(base.Center, 0, 0, Main.npc[num124].Center, 0, 0))
				{
					num124 = ((num125 == -1 || !Collision.CanHit(base.Center, 0, 0, Main.npc[num125].Center, 0, 0)) ? (-1) : num125);
				}
				bool flag36 = num124 != -1;
				if (flag36 && type == 633)
				{
					flag36 = Vector2.Distance(base.Center, Main.npc[num124].Center) <= 50f;
				}
				if (flag36)
				{
					localAI[2] = ai[0];
					ai[0] = 10f;
					ai[1] = num123;
					ai[2] = 0f;
					localAI[3] = 0f;
					direction = ((position.X < Main.npc[num124].position.X) ? 1 : (-1));
					netUpdate = true;
				}
			}
			else if (flag31 && velocity.Y == 0f && NPCID.Sets.AttackType[type] == 1 && NPCID.Sets.AttackAverageChance[type] > 0 && Main.rand.Next(num122) == 0)
			{
				int num126 = NPCID.Sets.AttackTime[type];
				int num127 = ((num15 == 1) ? num17 : num16);
				int num128 = ((num15 == 1) ? num16 : num17);
				if (num127 != -1 && !Collision.CanHitLine(base.Center, 0, 0, Main.npc[num127].Center, 0, 0))
				{
					num127 = ((num128 == -1 || !Collision.CanHitLine(base.Center, 0, 0, Main.npc[num128].Center, 0, 0)) ? (-1) : num128);
				}
				if (num127 != -1)
				{
					Vector2 vector8 = DirectionTo(Main.npc[num127].Center);
					if (vector8.Y <= 0.5f && vector8.Y >= -0.5f)
					{
						localAI[2] = ai[0];
						ai[0] = 12f;
						ai[1] = num126;
						ai[2] = vector8.Y;
						localAI[3] = 0f;
						direction = ((position.X < Main.npc[num127].position.X) ? 1 : (-1));
						netUpdate = true;
					}
				}
			}
			if (flag31 && velocity.Y == 0f && NPCID.Sets.AttackType[type] == 2 && NPCID.Sets.AttackAverageChance[type] > 0 && Main.rand.Next(num122) == 0)
			{
				int num129 = NPCID.Sets.AttackTime[type];
				int num130 = ((num15 == 1) ? num17 : num16);
				int num131 = ((num15 == 1) ? num16 : num17);
				if (num130 != -1 && !Collision.CanHitLine(base.Center, 0, 0, Main.npc[num130].Center, 0, 0))
				{
					num130 = ((num131 == -1 || !Collision.CanHitLine(base.Center, 0, 0, Main.npc[num131].Center, 0, 0)) ? (-1) : num131);
				}
				if (num130 != -1)
				{
					localAI[2] = ai[0];
					ai[0] = 14f;
					ai[1] = num129;
					ai[2] = 0f;
					localAI[3] = 0f;
					direction = ((position.X < Main.npc[num130].position.X) ? 1 : (-1));
					netUpdate = true;
				}
				else if (type == 20)
				{
					localAI[2] = ai[0];
					ai[0] = 14f;
					ai[1] = num129;
					ai[2] = 0f;
					localAI[3] = 0f;
					netUpdate = true;
				}
			}
			if (flag31 && velocity.Y == 0f && NPCID.Sets.AttackType[type] == 3 && NPCID.Sets.AttackAverageChance[type] > 0 && Main.rand.Next(num122) == 0)
			{
				int num132 = NPCID.Sets.AttackTime[type];
				int num133 = ((num15 == 1) ? num17 : num16);
				int num134 = ((num15 == 1) ? num16 : num17);
				if (num133 != -1 && !Collision.CanHit(base.Center, 0, 0, Main.npc[num133].Center, 0, 0))
				{
					num133 = ((num134 == -1 || !Collision.CanHit(base.Center, 0, 0, Main.npc[num134].Center, 0, 0)) ? (-1) : num134);
				}
				if (num133 != -1)
				{
					localAI[2] = ai[0];
					ai[0] = 15f;
					ai[1] = num132;
					ai[2] = 0f;
					localAI[3] = 0f;
					direction = ((position.X < Main.npc[num133].position.X) ? 1 : (-1));
					netUpdate = true;
				}
			}
		}
		if (type == 681)
		{
			float R = 0f;
			float G = 0f;
			float B = 0f;
			TorchID.TorchColor(23, out R, out G, out B);
			float num135 = 0.35f;
			R *= num135;
			G *= num135;
			B *= num135;
			Lighting.AddLight(base.Center, R, G, B);
		}
		if (type == 683 || type == 687)
		{
			float num136 = Utils.WrappedLerp(0.75f, 1f, (float)Main.timeForVisualEffects % 120f / 120f);
			Lighting.AddLight(base.Center, 0.25f * num136, 0.25f * num136, 0.1f * num136);
		}
	}

	private void AI_007_TownEntities_Shimmer_TeleportToLandingSpot()
	{
		Vector2? vector = AI_007_TownEntities_Shimmer_ScanForBestSpotToLandOn();
		if (vector.HasValue)
		{
			Vector2 vector2 = position;
			position = vector.Value;
			Vector2 movementVector = position - vector2;
			int num = 560;
			if (movementVector.Length() >= (float)num)
			{
				ai[2] = 30f;
				ParticleOrchestrator.BroadcastParticleSpawn(ParticleOrchestraType.ShimmerTownNPCSend, new ParticleOrchestraSettings
				{
					PositionInWorld = vector2 + base.Size / 2f,
					MovementVector = movementVector
				});
			}
			netUpdate = true;
		}
	}

	private Vector2? AI_007_TownEntities_Shimmer_ScanForBestSpotToLandOn()
	{
		Point point = base.Top.ToTileCoordinates();
		int num = 30;
		Vector2? result = null;
		bool flag = homeless && (homeTileX == -1 || homeTileY == -1);
		for (int i = 1; i < num; i += 2)
		{
			Vector2? vector = ShimmerHelper.FindSpotWithoutShimmer(this, point.X, point.Y, i, flag);
			if (vector.HasValue)
			{
				result = vector.Value;
				break;
			}
		}
		if (!result.HasValue && homeTileX != -1 && homeTileY != -1)
		{
			for (int j = 1; j < num; j += 2)
			{
				Vector2? vector2 = ShimmerHelper.FindSpotWithoutShimmer(this, homeTileX, homeTileY, j, flag);
				if (vector2.HasValue)
				{
					result = vector2.Value;
					break;
				}
			}
		}
		if (!result.HasValue)
		{
			int num2 = (flag ? 30 : 0);
			num = 60;
			flag = true;
			for (int k = num2; k < num; k += 2)
			{
				Vector2? vector3 = ShimmerHelper.FindSpotWithoutShimmer(this, point.X, point.Y, k, flag);
				if (vector3.HasValue)
				{
					result = vector3.Value;
					break;
				}
			}
		}
		if (!result.HasValue && homeTileX != -1 && homeTileY != -1)
		{
			num = 60;
			flag = true;
			for (int l = 30; l < num; l += 2)
			{
				Vector2? vector4 = ShimmerHelper.FindSpotWithoutShimmer(this, homeTileX, homeTileY, l, flag);
				if (vector4.HasValue)
				{
					result = vector4.Value;
					break;
				}
			}
		}
		return result;
	}

	private void AI_007_TownEntities_TeleportToHome(int homeFloorX, int homeFloorY)
	{
		bool flag = false;
		for (int i = 0; i < 3; i++)
		{
			int num = homeFloorX + i switch
			{
				1 => -1, 
				0 => 0, 
				_ => 1, 
			};
			if (type == 37 || !Collision.SolidTiles(num - 1, num + 1, homeFloorY - 3, homeFloorY - 1))
			{
				velocity.X = 0f;
				velocity.Y = 0f;
				position.X = num * 16 + 8 - width / 2;
				position.Y = (float)(homeFloorY * 16 - height) - 0.1f;
				netUpdate = true;
				AI_007_TryForcingSitting(homeFloorX, homeFloorY);
				flag = true;
				break;
			}
		}
		if (!flag)
		{
			homeless = true;
			WorldGen.QuickFindHome(whoAmI);
		}
	}

	private void AI_007_TownEntities_GetWalkPrediction(int myTileX, int homeFloorX, bool canBreathUnderWater, bool currentlyDrowning, int tileX, int tileY, out bool keepwalking, out bool avoidFalling)
	{
		keepwalking = false;
		avoidFalling = true;
		bool flag = myTileX >= homeFloorX - 35 && myTileX <= homeFloorX + 35;
		if (isLikeATownNPC && ai[1] < 30f)
		{
			keepwalking = !Utils.PlotTileLine(base.Top, base.Bottom, width, DelegateMethods.SearchAvoidedByNPCs);
			if (!keepwalking)
			{
				Rectangle hitbox = base.Hitbox;
				hitbox.X -= 20;
				hitbox.Width += 40;
				for (int i = 0; i < Main.maxNPCs; i++)
				{
					if (Main.npc[i].active && Main.npc[i].friendly && i != whoAmI && Main.npc[i].velocity.X == 0f && hitbox.Intersects(Main.npc[i].Hitbox))
					{
						keepwalking = true;
						break;
					}
				}
			}
		}
		if (!keepwalking && currentlyDrowning)
		{
			keepwalking = true;
		}
		if (avoidFalling && (NPCID.Sets.TownCritter[type] || (!flag && direction == Math.Sign(homeFloorX - myTileX))))
		{
			avoidFalling = false;
		}
		if (!avoidFalling)
		{
			return;
		}
		bool flag2 = false;
		Point p = default(Point);
		int num = 0;
		for (int j = -1; j <= 4; j++)
		{
			Tile tileSafely = Framing.GetTileSafely(tileX, tileY + j);
			if (tileSafely.liquid > 0)
			{
				num++;
				if (tileSafely.lava())
				{
					flag2 = true;
					break;
				}
			}
			if (tileSafely.nactive() && Main.tileSolid[tileSafely.type])
			{
				if (num > 0)
				{
					p.X = tileX;
					p.Y = tileY + j;
				}
				avoidFalling = false;
				break;
			}
		}
		avoidFalling |= flag2;
		double num2 = Math.Ceiling((float)height / 16f);
		if ((double)num >= num2)
		{
			avoidFalling = true;
		}
		if (!avoidFalling && p.X != 0 && p.Y != 0)
		{
			Vector2 vector = p.ToWorldCoordinates(8f, 0f) + new Vector2(-width / 2, -height);
			avoidFalling = Collision.DrownCollision(vector, width, height, 1f);
		}
	}

	private bool AI_007_TownEntities_CheckIfWillDrown(bool currentlyDrowning)
	{
		return currentlyDrowning;
	}

	private void AI_007_AttemptToPlayIdleAnimationsForPets(int petIdleChance)
	{
		if (velocity.X == 0f && Main.netMode != 1 && Main.rand.Next(petIdleChance) == 0)
		{
			int num = 3;
			if (type == 638)
			{
				num = 2;
			}
			if (NPCID.Sets.IsTownSlime[type])
			{
				num = 0;
			}
			ai[0] = ((num == 0) ? 20 : Main.rand.Next(20, 20 + num));
			ai[1] = 200 + Main.rand.Next(300);
			if (ai[0] == 20f && type == 637)
			{
				ai[1] = 500 + Main.rand.Next(200);
			}
			if (ai[0] == 21f && type == 638)
			{
				ai[1] = 100 + Main.rand.Next(100);
			}
			if (ai[0] == 22f && type == 656)
			{
				ai[1] = 200 + Main.rand.Next(200);
			}
			if (ai[0] == 20f && NPCID.Sets.IsTownSlime[type])
			{
				ai[1] = 180 + Main.rand.Next(240);
			}
			ai[2] = 0f;
			localAI[3] = 0f;
			netUpdate = true;
		}
	}

	public bool NPCCanStickToWalls()
	{
		int num = (int)base.Center.X / 16;
		int num2 = (int)base.Center.Y / 16;
		int num3 = 0;
		for (int i = num - 1; i <= num + 1; i++)
		{
			for (int j = num2 - 1; j <= num2 + 1; j++)
			{
				Tile tileSafely = Framing.GetTileSafely(i, j);
				if ((!tileSafely.active() || !Main.tileSolid[tileSafely.type] || TileID.Sets.Platforms[tileSafely.type]) && tileSafely.wall > 0)
				{
					num3++;
					if (num3 > 4)
					{
						return true;
					}
				}
			}
		}
		return false;
	}

	private bool AI_003_Gnomes_ShouldTurnToStone()
	{
		if (Main.remixWorld)
		{
			return position.Y / 16f > (float)(Main.maxTilesY - 350);
		}
		if (Main.dayTime)
		{
			return WorldGen.InAPlaceWithWind(position, width, height);
		}
		return false;
	}

	private void AI_003_Fighters()
	{
		if (Main.player[target].position.Y + (float)Main.player[target].height == position.Y + (float)height)
		{
			directionY = -1;
		}
		bool flag = false;
		if (type == 624 && AI_003_Gnomes_ShouldTurnToStone())
		{
			int num = (int)(base.Center.X / 16f);
			int num2 = (int)(base.Bottom.Y / 16f);
			position += netOffset;
			int num3 = Dust.NewDust(position, width, height, 43, 0f, 0f, 254, Color.White, 0.5f);
			Main.dust[num3].velocity *= 0.2f;
			position -= netOffset;
			if (WorldGen.SolidTileAllowBottomSlope(num, num2))
			{
				for (int i = 0; i < 5; i++)
				{
					position += netOffset;
					int num4 = Dust.NewDust(position, width, height, 43, 0f, 0f, 254, Color.White, 0.5f);
					Main.dust[num4].velocity *= 0.2f;
					position -= netOffset;
				}
				if (Main.netMode != 1 && TileObject.CanPlace(num, num2 - 1, 567, 0, direction, out var _, onlyCheck: true) && WorldGen.PlaceTile(num, num2 - 1, 567, mute: false, forced: false, -1, Main.rand.Next(5)))
				{
					if (Main.netMode == 2)
					{
						NetMessage.SendTileSquare(-1, num, num2 - 2, 1, 2);
					}
					if (Main.netMode != 1)
					{
						if (IsNPCValidForBestiaryKillCredit())
						{
							Main.BestiaryTracker.Kills.RegisterKill(this);
						}
						CountKillForBannersAndDropThem();
					}
					life = 0;
					active = false;
					AchievementsHelper.NotifyProgressionEvent(24);
					return;
				}
			}
		}
		if (type == 466)
		{
			int num5 = 200;
			if (ai[2] == 0f)
			{
				alpha = num5;
				TargetClosest();
				if (!Main.player[target].dead && (Main.player[target].Center - base.Center).Length() < 170f)
				{
					ai[2] = -16f;
				}
				if (velocity.X != 0f || velocity.Y < 0f || velocity.Y > 2f || justHit)
				{
					ai[2] = -16f;
				}
				return;
			}
			if (ai[2] < 0f)
			{
				if (alpha > 0)
				{
					alpha -= num5 / 16;
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				ai[2] += 1f;
				if (ai[2] == 0f)
				{
					ai[2] = 1f;
					velocity.X = direction * 2;
				}
				return;
			}
			alpha = 0;
		}
		if (type == 166)
		{
			if (Main.netMode != 1 && Main.rand.Next(240) == 0)
			{
				ai[2] = Main.rand.Next(-480, -60);
				netUpdate = true;
			}
			if (ai[2] < 0f)
			{
				TargetClosest();
				if (justHit)
				{
					ai[2] = 0f;
				}
				if (Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
				{
					ai[2] = 0f;
				}
			}
			if (ai[2] < 0f)
			{
				velocity.X *= 0.9f;
				if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
				{
					velocity.X = 0f;
				}
				ai[2] += 1f;
				if (ai[2] == 0f)
				{
					velocity.X = (float)direction * 0.1f;
				}
				return;
			}
		}
		if (type == 461)
		{
			if (wet)
			{
				knockBackResist = 0f;
				ai[3] = -0.10101f;
				noGravity = true;
				Vector2 center = base.Center;
				width = 34;
				height = 24;
				position.X = center.X - (float)(width / 2);
				position.Y = center.Y - (float)(height / 2);
				TargetClosest();
				if (collideX)
				{
					velocity.X = 0f - oldVelocity.X;
				}
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				if (velocity.X > 0f)
				{
					direction = 1;
				}
				if (Collision.CanHit(position, width, height, Main.player[target].Center, 1, 1))
				{
					Vector2 vector = Main.player[target].Center - base.Center;
					vector.Normalize();
					vector *= 5f;
					velocity = (velocity * 19f + vector) / 20f;
					return;
				}
				float num6 = 5f;
				if (velocity.Y > 0f)
				{
					num6 = 3f;
				}
				if (velocity.Y < 0f)
				{
					num6 = 8f;
				}
				Vector2 vector2 = new Vector2(direction, -1f);
				vector2.Normalize();
				vector2 *= num6;
				if (num6 < 5f)
				{
					velocity = (velocity * 24f + vector2) / 25f;
				}
				else
				{
					velocity = (velocity * 9f + vector2) / 10f;
				}
				return;
			}
			knockBackResist = GetKnockbackMultiplier_ScaledByDifficulty(0.4f);
			noGravity = false;
			Vector2 center2 = base.Center;
			width = 18;
			height = 40;
			position.X = center2.X - (float)(width / 2);
			position.Y = center2.Y - (float)(height / 2);
			if (ai[3] == -0.10101f)
			{
				ai[3] = 0f;
				float num7 = velocity.Length();
				num7 *= 2f;
				if (num7 > 10f)
				{
					num7 = 10f;
				}
				velocity.Normalize();
				velocity *= num7;
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				if (velocity.X > 0f)
				{
					direction = 1;
				}
				spriteDirection = direction;
			}
		}
		if (type == 586)
		{
			if (alpha == 255)
			{
				TargetClosest();
				spriteDirection = direction;
				velocity.Y = -6f;
				netUpdate = true;
				for (int j = 0; j < 35; j++)
				{
					Dust dust = Dust.NewDustDirect(position, width, height, 5);
					dust.velocity *= 1f;
					dust.scale = 1f + Main.rand.NextFloat() * 0.5f;
					dust.fadeIn = 1.5f + Main.rand.NextFloat() * 0.5f;
					dust.velocity += velocity * 0.5f;
				}
			}
			alpha -= 15;
			if (alpha < 0)
			{
				alpha = 0;
			}
			position += netOffset;
			if (alpha != 0)
			{
				for (int k = 0; k < 2; k++)
				{
					Dust dust2 = Dust.NewDustDirect(position, width, height, 5);
					dust2.velocity *= 1f;
					dust2.scale = 1f + Main.rand.NextFloat() * 0.5f;
					dust2.fadeIn = 1.5f + Main.rand.NextFloat() * 0.5f;
					dust2.velocity += velocity * 0.3f;
				}
			}
			if (Main.rand.Next(3) == 0)
			{
				Dust dust3 = Dust.NewDustDirect(position, width, height, 5);
				dust3.velocity *= 0f;
				dust3.alpha = 120;
				dust3.scale = 0.7f + Main.rand.NextFloat() * 0.5f;
				dust3.velocity += velocity * 0.3f;
			}
			position -= netOffset;
			if (wet)
			{
				knockBackResist = 0f;
				ai[3] = -0.10101f;
				noGravity = true;
				Vector2 center3 = base.Center;
				position.X = center3.X - (float)(width / 2);
				position.Y = center3.Y - (float)(height / 2);
				TargetClosest();
				if (collideX)
				{
					velocity.X = 0f - oldVelocity.X;
				}
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				if (velocity.X > 0f)
				{
					direction = 1;
				}
				if (Collision.CanHit(position, width, height, Main.player[target].Center, 1, 1))
				{
					Vector2 vector3 = Main.player[target].Center - base.Center;
					vector3.Normalize();
					float num8 = 1f;
					num8 += Math.Abs(base.Center.Y - Main.player[target].Center.Y) / 40f;
					num8 = MathHelper.Clamp(num8, 5f, 20f);
					vector3 *= num8;
					if (velocity.Y > 0f)
					{
						velocity = (velocity * 29f + vector3) / 30f;
					}
					else
					{
						velocity = (velocity * 4f + vector3) / 5f;
					}
					return;
				}
				float num9 = 5f;
				if (velocity.Y > 0f)
				{
					num9 = 3f;
				}
				if (velocity.Y < 0f)
				{
					num9 = 8f;
				}
				Vector2 vector4 = new Vector2(direction, -1f);
				vector4.Normalize();
				vector4 *= num9;
				if (num9 < 5f)
				{
					velocity = (velocity * 24f + vector4) / 25f;
				}
				else
				{
					velocity = (velocity * 9f + vector4) / 10f;
				}
				return;
			}
			noGravity = false;
			Vector2 center4 = base.Center;
			position.X = center4.X - (float)(width / 2);
			position.Y = center4.Y - (float)(height / 2);
			if (ai[3] == -0.10101f)
			{
				ai[3] = 0f;
				float num10 = velocity.Length();
				num10 *= 2f;
				if (num10 > 15f)
				{
					num10 = 15f;
				}
				velocity.Normalize();
				velocity *= num10;
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				if (velocity.X > 0f)
				{
					direction = 1;
				}
				spriteDirection = direction;
			}
		}
		if (type == 379 || type == 380)
		{
			if (ai[3] < 0f)
			{
				directionY = -1;
				flag = false;
				damage = 0;
				velocity.X *= 0.93f;
				if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
				{
					velocity.X = 0f;
				}
				int num11 = (int)(0f - ai[3] - 1f);
				int num12 = Math.Sign(Main.npc[num11].Center.X - base.Center.X);
				if (num12 != direction)
				{
					velocity.X = 0f;
					direction = num12;
					netUpdate = true;
				}
				if (justHit && Main.netMode != 1 && Main.npc[num11].localAI[0] == 0f)
				{
					Main.npc[num11].localAI[0] = 1f;
				}
				if (ai[0] < 1000f)
				{
					ai[0] = 1000f;
				}
				if ((ai[0] += 1f) >= 1300f)
				{
					ai[0] = 1000f;
					netUpdate = true;
				}
				return;
			}
			if (ai[0] >= 1000f)
			{
				ai[0] = 0f;
			}
			damage = defDamage;
		}
		if (type == 383 && ai[2] == 0f && localAI[0] == 0f && Main.netMode != 1)
		{
			int num13 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y, 384, whoAmI);
			ai[2] = num13 + 1;
			localAI[0] = -1f;
			netUpdate = true;
			Main.npc[num13].ai[0] = whoAmI;
			Main.npc[num13].netUpdate = true;
		}
		if (type == 383)
		{
			int num14 = (int)ai[2] - 1;
			if (num14 != -1 && Main.npc[num14].active && Main.npc[num14].type == 384)
			{
				dontTakeDamage = true;
			}
			else
			{
				dontTakeDamage = false;
				ai[2] = 0f;
				if (localAI[0] == -1f)
				{
					localAI[0] = 180f;
				}
				if (localAI[0] > 0f)
				{
					localAI[0] -= 1f;
				}
			}
		}
		if (type == 482)
		{
			int num15 = 300;
			int num16 = 120;
			dontTakeDamage = false;
			if (ai[2] < 0f)
			{
				dontTakeDamage = true;
				ai[2] += 1f;
				velocity.X *= 0.9f;
				if ((double)Math.Abs(velocity.X) < 0.001)
				{
					velocity.X = 0.001f * (float)direction;
				}
				if (Math.Abs(velocity.Y) > 1f)
				{
					ai[2] += 10f;
				}
				if (ai[2] >= 0f)
				{
					netUpdate = true;
					velocity.X += (float)direction * 0.3f;
				}
				return;
			}
			if (ai[2] < (float)num15)
			{
				if (justHit)
				{
					ai[2] += 15f;
				}
				ai[2] += 1f;
			}
			else if (velocity.Y == 0f)
			{
				ai[2] = -num16;
				netUpdate = true;
			}
		}
		if (type == 631)
		{
			if (target < 0 || target == 255 || Main.player[target].dead || !Main.player[target].active)
			{
				TargetClosest(ai[2] > 0f);
			}
			Player player = Main.player[target];
			bool flag2 = !player.dead && player.active && base.Center.Distance(player.Center) < 320f;
			int num17 = 100;
			int num18 = 32;
			if (ai[2] == 0f)
			{
				ai[3] = 65f;
				if (flag2 && Collision.CanHit(player, this))
				{
					ai[2] = num17;
					ai[3] = 0f;
					velocity.X = (float)direction * 0.01f;
					netUpdate = true;
				}
			}
			else
			{
				if (ai[2] < (float)num17)
				{
					ai[2] += 1f;
					velocity.X *= 0.9f;
					if ((double)Math.Abs(velocity.X) < 0.001)
					{
						velocity.X = 0f;
					}
					if (Math.Abs(velocity.Y) > 1f)
					{
						ai[2] = 0f;
					}
					if (ai[2] == (float)(num17 - num18 / 2) && Main.netMode != 1 && !player.Hitbox.Intersects(base.Hitbox) && Collision.CanHit(player, this))
					{
						float num19 = 8f;
						Vector2 center5 = base.Center;
						Vector2 vector5 = DirectionTo(Main.player[target].Center) * num19;
						if (vector5.HasNaNs())
						{
							vector5 = new Vector2((float)direction * num19, 0f);
						}
						int num20 = 20;
						Vector2 v = vector5 + Utils.RandomVector2(Main.rand, -0.8f, 0.8f);
						v = v.SafeNormalize(Vector2.Zero);
						v *= num19;
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), center5.X, center5.Y, v.X, v.Y, 909, num20, 1f, Main.myPlayer);
					}
					if (ai[2] >= (float)num17)
					{
						ai[2] = num17;
						ai[3] = 0f;
						velocity.X = (float)direction * 0.01f;
						netUpdate = true;
					}
					return;
				}
				if (velocity.Y == 0f && flag2 && (player.Hitbox.Intersects(base.Hitbox) || Collision.CanHit(player, this)))
				{
					ai[2] = num17 - num18;
					netUpdate = true;
				}
			}
		}
		if (type == 480)
		{
			int num21 = 180;
			int num22 = 300;
			int num23 = 180;
			int num24 = 60;
			int num25 = 20;
			if (life < lifeMax / 3)
			{
				num21 = 120;
				num22 = 240;
				num23 = 240;
				num24 = 90;
			}
			if (ai[2] > 0f)
			{
				ai[2] -= 1f;
			}
			else if (ai[2] == 0f)
			{
				if (((Main.player[target].Center.X < base.Center.X && direction < 0) || (Main.player[target].Center.X > base.Center.X && direction > 0)) && velocity.Y == 0f && Distance(Main.player[target].Center) < 900f && Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
				{
					ai[2] = -num23 - num25;
					netUpdate = true;
				}
			}
			else
			{
				if (ai[2] < 0f && ai[2] < (float)(-num23))
				{
					position += netOffset;
					velocity.X *= 0.9f;
					if (velocity.Y < -2f || velocity.Y > 4f || justHit)
					{
						ai[2] = num21;
					}
					else
					{
						ai[2] += 1f;
						if (ai[2] == 0f)
						{
							ai[2] = num22;
						}
					}
					float num26 = ai[2] + (float)num23 + (float)num25;
					if (num26 == 1f)
					{
						SoundEngine.PlaySound(4, (int)position.X, (int)position.Y, 17);
					}
					if (num26 < (float)num25)
					{
						Vector2 vector6 = base.Top + new Vector2(spriteDirection * 6, 6f);
						float num27 = MathHelper.Lerp(20f, 30f, (num26 * 3f + 50f) / 182f);
						Main.rand.NextFloat();
						for (float num28 = 0f; num28 < 2f; num28 += 1f)
						{
							Vector2 vector7 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * (Main.rand.NextFloat() * 0.5f + 0.5f);
							Dust obj = Main.dust[Dust.NewDust(vector6, 0, 0, 228)];
							obj.position = vector6 + vector7 * num27;
							obj.noGravity = true;
							obj.velocity = vector7 * 2f;
							obj.scale = 0.5f + Main.rand.NextFloat() * 0.5f;
						}
					}
					Lighting.AddLight(base.Center, 0.9f, 0.75f, 0.1f);
					position -= netOffset;
					return;
				}
				if (ai[2] < 0f && ai[2] >= (float)(-num23))
				{
					position += netOffset;
					Lighting.AddLight(base.Center, 0.9f, 0.75f, 0.1f);
					velocity.X *= 0.9f;
					if (velocity.Y < -2f || velocity.Y > 4f || justHit)
					{
						ai[2] = num21;
					}
					else
					{
						ai[2] += 1f;
						if (ai[2] == 0f)
						{
							ai[2] = num22;
						}
					}
					float num29 = ai[2] + (float)num23;
					if (num29 < 180f && (Main.rand.Next(3) == 0 || ai[2] % 3f == 0f))
					{
						Vector2 vector8 = base.Top + new Vector2(spriteDirection * 10, 10f);
						float num30 = MathHelper.Lerp(20f, 30f, (num29 * 3f + 50f) / 182f);
						Main.rand.NextFloat();
						for (float num31 = 0f; num31 < 1f; num31 += 1f)
						{
							Vector2 vector9 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * (Main.rand.NextFloat() * 0.5f + 0.5f);
							Dust obj2 = Main.dust[Dust.NewDust(vector8, 0, 0, 228)];
							obj2.position = vector8 + vector9 * num30;
							obj2.noGravity = true;
							obj2.velocity = vector9 * 4f;
							obj2.scale = 0.5f + Main.rand.NextFloat();
						}
					}
					position -= netOffset;
					if (Main.netMode == 2)
					{
						return;
					}
					Player player2 = Main.player[Main.myPlayer];
					_ = Main.myPlayer;
					if (player2.dead || !player2.active || player2.FindBuffIndex(156) != -1)
					{
						return;
					}
					Vector2 vector10 = player2.Center - base.Center;
					if (!(vector10.Length() < 700f))
					{
						return;
					}
					bool flag3 = vector10.Length() < 30f;
					if (!flag3)
					{
						float x = ((float)Math.PI / 4f).ToRotationVector2().X;
						Vector2 vector11 = Vector2.Normalize(vector10);
						if (vector11.X > x || vector11.X < 0f - x)
						{
							flag3 = true;
						}
					}
					if (((player2.Center.X < base.Center.X && direction < 0 && player2.direction > 0) || (player2.Center.X > base.Center.X && direction > 0 && player2.direction < 0)) && flag3 && (Collision.CanHitLine(base.Center, 1, 1, player2.Center, 1, 1) || Collision.CanHitLine(base.Center - Vector2.UnitY * 16f, 1, 1, player2.Center, 1, 1) || Collision.CanHitLine(base.Center + Vector2.UnitY * 8f, 1, 1, player2.Center, 1, 1)) && !player2.creativeGodMode)
					{
						player2.AddBuff(156, num24 + (int)ai[2] * -1);
					}
					return;
				}
			}
		}
		if (type == 471)
		{
			if (ai[3] < 0f)
			{
				knockBackResist = 0f;
				defense = (int)((double)defDefense * 1.1);
				noGravity = true;
				noTileCollide = true;
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else if (velocity.X > 0f)
				{
					direction = 1;
				}
				rotation = velocity.X * 0.1f;
				if (Main.netMode != 1)
				{
					localAI[3] += 1f;
					if (localAI[3] > (float)Main.rand.Next(20, 180))
					{
						localAI[3] = 0f;
						Vector2 center6 = base.Center;
						center6 += velocity;
						NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)center6.X, (int)center6.Y, 30);
					}
				}
			}
			else
			{
				localAI[3] = 0f;
				knockBackResist = GetKnockbackMultiplier_ScaledByDifficulty(0.35f);
				rotation *= 0.9f;
				defense = defDefense;
				noGravity = false;
				noTileCollide = false;
			}
			if (ai[3] == 1f)
			{
				knockBackResist = 0f;
				defense += 10;
			}
			if (ai[3] == -1f)
			{
				TargetClosest();
				float num32 = 8f;
				float num33 = 40f;
				Vector2 vector12 = Main.player[target].Center - base.Center;
				float num34 = vector12.Length();
				num32 += num34 / 200f;
				vector12.Normalize();
				vector12 *= num32;
				velocity = (velocity * (num33 - 1f) + vector12) / num33;
				if (num34 < 500f && !Collision.SolidCollision(position, width, height))
				{
					ai[3] = 0f;
					ai[2] = 0f;
				}
				return;
			}
			if (ai[3] == -2f)
			{
				velocity.Y -= 0.2f;
				if (velocity.Y < -10f)
				{
					velocity.Y = -10f;
				}
				if (Main.player[target].Center.Y - base.Center.Y > 200f)
				{
					TargetClosest();
					ai[3] = -3f;
					if (Main.player[target].Center.X > base.Center.X)
					{
						ai[2] = 1f;
					}
					else
					{
						ai[2] = -1f;
					}
				}
				velocity.X *= 0.99f;
				return;
			}
			if (ai[3] == -3f)
			{
				if (direction == 0)
				{
					TargetClosest();
				}
				if (ai[2] == 0f)
				{
					ai[2] = direction;
				}
				velocity.Y *= 0.9f;
				velocity.X += ai[2] * 0.3f;
				if (velocity.X > 10f)
				{
					velocity.X = 10f;
				}
				if (velocity.X < -10f)
				{
					velocity.X = -10f;
				}
				float num35 = Main.player[target].Center.X - base.Center.X;
				if ((ai[2] < 0f && num35 > 300f) || (ai[2] > 0f && num35 < -300f))
				{
					ai[3] = -4f;
					ai[2] = 0f;
				}
				else if (Math.Abs(num35) > 800f)
				{
					ai[3] = -1f;
					ai[2] = 0f;
				}
				return;
			}
			if (ai[3] == -4f)
			{
				ai[2] += 1f;
				velocity.Y += 0.1f;
				if (velocity.Length() > 4f)
				{
					velocity *= 0.9f;
				}
				int num36 = (int)base.Center.X / 16;
				int num37 = (int)(position.Y + (float)height + 12f) / 16;
				bool flag4 = false;
				for (int l = num36 - 1; l <= num36 + 1; l++)
				{
					if (Main.tile[l, num37] == null)
					{
						Main.tile[num36, num37] = new Tile();
					}
					if (Main.tile[l, num37].active() && Main.tileSolid[Main.tile[l, num37].type])
					{
						flag4 = true;
					}
				}
				if (flag4 && !Collision.SolidCollision(position, width, height))
				{
					ai[3] = 0f;
					ai[2] = 0f;
				}
				else if (ai[2] > 300f || base.Center.Y > Main.player[target].Center.Y + 200f)
				{
					ai[3] = -1f;
					ai[2] = 0f;
				}
			}
			else
			{
				if (ai[3] == 1f)
				{
					Vector2 center7 = base.Center;
					center7.Y -= 70f;
					velocity.X *= 0.8f;
					ai[2] += 1f;
					if (ai[2] == 60f)
					{
						if (Main.netMode != 1)
						{
							NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)center7.X, (int)center7.Y + 18, 472);
						}
					}
					else if (ai[2] >= 90f)
					{
						ai[3] = -2f;
						ai[2] = 0f;
					}
					for (int m = 0; m < 2; m++)
					{
						Vector2 vector13 = center7;
						Vector2 vector14 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
						vector14.Normalize();
						vector14 *= (float)Main.rand.Next(0, 100) * 0.1f;
						Vector2 vector15 = vector13 + vector14;
						vector14.Normalize();
						vector14 *= (float)Main.rand.Next(50, 90) * 0.1f;
						int num38 = Dust.NewDust(vector15, 1, 1, 27);
						Main.dust[num38].velocity = -vector14 * 0.3f;
						Main.dust[num38].alpha = 100;
						if (Main.rand.Next(2) == 0)
						{
							Main.dust[num38].noGravity = true;
							Main.dust[num38].scale += 0.3f;
						}
					}
					return;
				}
				ai[2] += 1f;
				int num39 = 10;
				if (velocity.Y == 0f && CountNPCS(472) < num39)
				{
					if (ai[2] >= 180f)
					{
						ai[2] = 0f;
						ai[3] = 1f;
					}
				}
				else
				{
					if (CountNPCS(472) >= num39)
					{
						ai[2] += 1f;
					}
					if (ai[2] >= 360f)
					{
						ai[2] = 0f;
						ai[3] = -2f;
						velocity.Y -= 3f;
					}
				}
				if (target >= 0 && !Main.player[target].dead && (Main.player[target].Center - base.Center).Length() > 800f)
				{
					ai[3] = -1f;
					ai[2] = 0f;
				}
			}
			if (Main.player[target].dead)
			{
				TargetClosest();
				if (Main.player[target].dead)
				{
					EncourageDespawn(1);
				}
			}
		}
		if (type == 419)
		{
			reflectsProjectiles = false;
			takenDamageMultiplier = 1f;
			int num40 = 6;
			int num41 = 10;
			float num42 = 16f;
			if (ai[2] > 0f)
			{
				ai[2] -= 1f;
			}
			if (ai[2] == 0f)
			{
				if (((Main.player[target].Center.X < base.Center.X && direction < 0) || (Main.player[target].Center.X > base.Center.X && direction > 0)) && Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
				{
					ai[2] = -1f;
					netUpdate = true;
					TargetClosest();
				}
			}
			else
			{
				if (ai[2] < 0f && ai[2] > (float)(-num40))
				{
					ai[2] -= 1f;
					velocity.X *= 0.9f;
					return;
				}
				if (ai[2] == (float)(-num40))
				{
					ai[2] -= 1f;
					TargetClosest();
					Vector2 vector16 = DirectionTo(Main.player[target].Top + new Vector2(0f, -30f));
					if (vector16.HasNaNs())
					{
						vector16 = Vector2.Normalize(new Vector2(spriteDirection, -1f));
					}
					velocity = vector16 * num42;
					netUpdate = true;
					return;
				}
				if (ai[2] < (float)(-num40))
				{
					ai[2] -= 1f;
					if (velocity.Y == 0f)
					{
						ai[2] = 60f;
					}
					else if (ai[2] < (float)(-num40 - num41))
					{
						velocity.Y += 0.15f;
						if (velocity.Y > 24f)
						{
							velocity.Y = 24f;
						}
					}
					reflectsProjectiles = true;
					takenDamageMultiplier = 3f;
					if (justHit)
					{
						ai[2] = 60f;
						netUpdate = true;
					}
					return;
				}
			}
		}
		if (type == 415)
		{
			int num43 = 42;
			int num44 = 18;
			if (justHit)
			{
				ai[2] = 120f;
				netUpdate = true;
			}
			if (ai[2] > 0f)
			{
				ai[2] -= 1f;
			}
			if (ai[2] == 0f)
			{
				int num45 = 0;
				for (int n = 0; n < Main.maxNPCs; n++)
				{
					if (Main.npc[n].active && Main.npc[n].type == 516)
					{
						num45++;
					}
				}
				if (num45 > 6)
				{
					ai[2] = 90f;
				}
				else if (((Main.player[target].Center.X < base.Center.X && direction < 0) || (Main.player[target].Center.X > base.Center.X && direction > 0)) && Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
				{
					ai[2] = -1f;
					netUpdate = true;
					TargetClosest();
				}
			}
			else if (ai[2] < 0f && ai[2] > (float)(-num43))
			{
				ai[2] -= 1f;
				if (ai[2] == (float)(-num43))
				{
					ai[2] = 180 + 30 * Main.rand.Next(10);
				}
				velocity.X *= 0.8f;
				if (ai[2] == (float)(-num44) || ai[2] == (float)(-num44 - 8) || ai[2] == (float)(-num44 - 16))
				{
					position += netOffset;
					for (int num46 = 0; num46 < 20; num46++)
					{
						Vector2 vector17 = base.Center + Vector2.UnitX * spriteDirection * 40f;
						Dust obj3 = Main.dust[Dust.NewDust(vector17, 0, 0, 259)];
						Vector2 vector18 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						obj3.position = vector17 + vector18 * 4f;
						obj3.velocity = vector18 * 2f + Vector2.UnitX * Main.rand.NextFloat() * spriteDirection * 3f;
						obj3.scale = 0.3f + vector18.X * (float)(-spriteDirection);
						obj3.fadeIn = 0.7f;
						obj3.noGravity = true;
					}
					position -= netOffset;
					if (velocity.X > -0.5f && velocity.X < 0.5f)
					{
						velocity.X = 0f;
					}
					if (Main.netMode != 1)
					{
						NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X + spriteDirection * 45, (int)base.Center.Y + 8, 516, 0, 0f, 0f, 0f, 0f, target);
					}
				}
				return;
			}
		}
		if (type == 428)
		{
			localAI[0] += 1f;
			if (localAI[0] >= 300f)
			{
				int num47 = (int)base.Center.X / 16 - 1;
				int num48 = (int)base.Center.Y / 16 - 1;
				if (!Collision.SolidTiles(num47, num47 + 2, num48, num48 + 1) && Main.netMode != 1)
				{
					life = lifeMax;
					Transform(427);
					localAI[0] = 0f;
					return;
				}
			}
			int num49 = 0;
			num49 = ((localAI[0] < 60f) ? 16 : ((localAI[0] < 120f) ? 8 : ((localAI[0] < 180f) ? 4 : ((localAI[0] < 240f) ? 2 : ((!(localAI[0] < 300f)) ? 1 : 1)))));
			if (Main.rand.Next(num49) == 0)
			{
				position += netOffset;
				Dust dust4 = Main.dust[Dust.NewDust(position, width, height, 229)];
				dust4.noGravity = true;
				dust4.scale = 1f;
				dust4.noLight = true;
				dust4.velocity = DirectionFrom(dust4.position) * dust4.velocity.Length();
				dust4.position -= dust4.velocity * 5f;
				dust4.position.X += direction * 6;
				dust4.position.Y += 4f;
				position -= netOffset;
			}
		}
		if (type == 427)
		{
			localAI[0] += 1f;
			localAI[0] += Math.Abs(velocity.X) / 2f;
			if (localAI[0] >= 1200f && Main.netMode != 1)
			{
				int num50 = (int)base.Center.X / 16 - 2;
				int num51 = (int)base.Center.Y / 16 - 3;
				if (!Collision.SolidTiles(num50, num50 + 4, num51, num51 + 4))
				{
					life = lifeMax;
					Transform(426);
					localAI[0] = 0f;
					return;
				}
			}
			int num52 = 0;
			num52 = ((localAI[0] < 360f) ? 32 : ((localAI[0] < 720f) ? 16 : ((localAI[0] < 1080f) ? 6 : ((localAI[0] < 1440f) ? 2 : ((!(localAI[0] < 1800f)) ? 1 : 1)))));
			if (Main.rand.Next(num52) == 0)
			{
				position += netOffset;
				Dust obj4 = Main.dust[Dust.NewDust(position, width, height, 229)];
				obj4.noGravity = true;
				obj4.scale = 1f;
				obj4.noLight = true;
				position -= netOffset;
			}
		}
		if (type == 590)
		{
			position += netOffset;
			int num53 = (int)(position.Y + 6f) / 16;
			if (spriteDirection < 0)
			{
				int num54 = (int)(base.Center.X - 22f) / 16;
				Tile tileSafely = Framing.GetTileSafely(num54, num53);
				Tile tileSafely2 = Framing.GetTileSafely(num54 + 1, num53);
				if (WorldGen.InWorld(num54, num53) && tileSafely2.liquid == 0 && tileSafely.liquid == 0)
				{
					Lighting.AddLight(num54, num53, 1f, 0.95f, 0.8f);
					if (Main.rand.Next(30) == 0)
					{
						Dust.NewDust(new Vector2(base.Center.X - 22f, position.Y + 6f), 1, 1, 6);
					}
				}
			}
			else
			{
				int num55 = (int)(base.Center.X + 14f) / 16;
				Tile tileSafely3 = Framing.GetTileSafely(num55, num53);
				Tile tileSafely4 = Framing.GetTileSafely(num55 - 1, num53);
				if (WorldGen.InWorld(num55, num53) && tileSafely4.liquid == 0 && tileSafely3.liquid == 0)
				{
					Lighting.AddLight(num55, num53, 1f, 0.95f, 0.8f);
					if (Main.rand.Next(30) == 0)
					{
						Dust.NewDust(new Vector2(base.Center.X + 14f, position.Y + 6f), 1, 1, 6);
					}
				}
			}
			position -= netOffset;
		}
		else if (type == 591)
		{
			position += netOffset;
			if (!wet)
			{
				if (spriteDirection < 0)
				{
					Lighting.AddLight(new Vector2(base.Center.X - 36f, position.Y + 24f), 1f, 0.95f, 0.8f);
					if (ai[2] == 0f && Main.rand.Next(30) == 0)
					{
						Dust.NewDust(new Vector2(base.Center.X - 36f, position.Y + 24f), 1, 1, 6);
					}
				}
				else
				{
					Lighting.AddLight(new Vector2(base.Center.X + 28f, position.Y + 24f), 1f, 0.95f, 0.8f);
					if (ai[2] == 0f && Main.rand.Next(30) == 0)
					{
						Dust.NewDust(new Vector2(base.Center.X + 28f, position.Y + 24f), 1, 1, 6);
					}
				}
			}
			position -= netOffset;
		}
		if (type == 111)
		{
			if (ai[3] < 0f)
			{
				TargetClosest(faceTarget: false);
			}
			if (ai[3] < 0f && (justHit || Distance(Main.player[target].Center) < 200f))
			{
				ai[3] = 0f;
				ai[0] = 0f;
				netUpdate = true;
			}
			if (ai[3] < 0f)
			{
				directionY = -1;
				flag = false;
				velocity.X *= 0.93f;
				if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
				{
					velocity.X = 0f;
				}
				int num56 = (int)(0f - ai[3] - 1f);
				int num57 = Math.Sign(Main.npc[num56].Center.X - base.Center.X);
				if (num57 != direction)
				{
					velocity.X = 0f;
					direction = num57;
					netUpdate = true;
				}
				if (ai[0] < 1000f)
				{
					ai[0] = 1000f;
				}
				if ((ai[0] += 1f) >= 1300f)
				{
					ai[0] = 1000f;
					netUpdate = true;
				}
				return;
			}
			if (ai[0] >= 1000f)
			{
				ai[0] = 0f;
			}
		}
		bool flag5 = false;
		bool flag6 = false;
		if (velocity.X == 0f)
		{
			flag6 = true;
		}
		if (justHit)
		{
			flag6 = false;
		}
		if (Main.netMode != 1 && type == 198 && (double)life <= (double)lifeMax * 0.55)
		{
			Transform(199);
		}
		if (Main.netMode != 1 && type == 348 && (double)life <= (double)lifeMax * 0.55)
		{
			Transform(349);
		}
		int num58 = 60;
		if (type == 120)
		{
			num58 = 180;
			if (ai[3] == -120f)
			{
				velocity *= 0f;
				ai[3] = 0f;
				position += netOffset;
				SoundEngine.PlaySound(SoundID.Item8, position);
				Vector2 vector19 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num59 = oldPos[2].X + (float)width * 0.5f - vector19.X;
				float num60 = oldPos[2].Y + (float)height * 0.5f - vector19.Y;
				float num61 = (float)Math.Sqrt(num59 * num59 + num60 * num60);
				num61 = 2f / num61;
				num59 *= num61;
				num60 *= num61;
				for (int num62 = 0; num62 < 20; num62++)
				{
					int num63 = Dust.NewDust(position, width, height, 71, num59, num60, 200, default(Color), 2f);
					Main.dust[num63].noGravity = true;
					Main.dust[num63].velocity.X *= 2f;
				}
				for (int num64 = 0; num64 < 20; num64++)
				{
					int num65 = Dust.NewDust(oldPos[2], width, height, 71, 0f - num59, 0f - num60, 200, default(Color), 2f);
					Main.dust[num65].noGravity = true;
					Main.dust[num65].velocity.X *= 2f;
				}
				position -= netOffset;
			}
		}
		bool flag7 = false;
		bool flag8 = true;
		if (NPCID.Sets.CritterThatCanTurnOnPlayers[type])
		{
			flag8 = false;
		}
		if (type == 343 || type == 47 || type == 67 || type == 109 || type == 110 || type == 111 || type == 120 || type == 163 || type == 164 || type == 239 || type == 168 || type == 199 || type == 206 || type == 214 || type == 215 || type == 216 || type == 217 || type == 218 || type == 219 || type == 220 || type == 226 || type == 243 || type == 251 || type == 257 || type == 258 || type == 290 || type == 291 || type == 292 || type == 293 || type == 305 || type == 306 || type == 307 || type == 308 || type == 309 || type == 348 || type == 349 || type == 350 || type == 351 || type == 379 || (type >= 430 && type <= 436) || type == 591 || type == 380 || type == 381 || type == 382 || type == 383 || type == 386 || type == 391 || (type >= 449 && type <= 452) || type == 466 || type == 464 || type == 166 || type == 469 || type == 468 || type == 471 || type == 470 || type == 480 || type == 481 || type == 482 || type == 411 || type == 424 || type == 409 || (type >= 494 && type <= 506) || type == 425 || type == 427 || type == 426 || type == 428 || type == 580 || type == 508 || type == 415 || type == 419 || type == 520 || (type >= 524 && type <= 527) || type == 528 || type == 529 || type == 530 || type == 532 || type == 582 || type == 624 || type == 631)
		{
			flag8 = false;
		}
		bool flag9 = false;
		int num66 = type;
		if (num66 == 425 || num66 == 471)
		{
			flag9 = true;
		}
		bool flag10 = true;
		switch (type)
		{
		case 110:
		case 111:
		case 206:
		case 214:
		case 215:
		case 216:
		case 291:
		case 292:
		case 293:
		case 350:
		case 379:
		case 380:
		case 381:
		case 382:
		case 409:
		case 411:
		case 424:
		case 426:
		case 466:
		case 498:
		case 499:
		case 500:
		case 501:
		case 502:
		case 503:
		case 504:
		case 505:
		case 506:
		case 520:
			if (ai[2] > 0f)
			{
				flag10 = false;
			}
			break;
		}
		if (!flag9 && flag10)
		{
			if (velocity.Y == 0f && ((velocity.X > 0f && direction < 0) || (velocity.X < 0f && direction > 0)))
			{
				flag7 = true;
			}
			if (position.X == oldPosition.X || ai[3] >= (float)num58 || flag7)
			{
				ai[3] += 1f;
			}
			else if ((double)Math.Abs(velocity.X) > 0.9 && ai[3] > 0f)
			{
				ai[3] -= 1f;
			}
			if (ai[3] > (float)(num58 * 10))
			{
				ai[3] = 0f;
			}
			if (justHit)
			{
				ai[3] = 0f;
			}
			if (ai[3] == (float)num58)
			{
				netUpdate = true;
			}
			if (Main.player[target].Hitbox.Intersects(base.Hitbox))
			{
				ai[3] = 0f;
			}
		}
		if (type == 463 && Main.netMode != 1)
		{
			if (localAI[3] > 0f)
			{
				localAI[3] -= 1f;
			}
			if (justHit && localAI[3] <= 0f && Main.rand.Next(3) == 0)
			{
				localAI[3] = 30f;
				int num67 = Main.rand.Next(3, 6);
				int[] array = new int[num67];
				int num68 = 0;
				for (int num69 = 0; num69 < 255; num69++)
				{
					if (Main.player[num69].active && !Main.player[num69].dead && Collision.CanHitLine(position, width, height, Main.player[num69].position, Main.player[num69].width, Main.player[num69].height))
					{
						array[num68] = num69;
						num68++;
						if (num68 == num67)
						{
							break;
						}
					}
				}
				if (num68 > 1)
				{
					for (int num70 = 0; num70 < 100; num70++)
					{
						int num71 = Main.rand.Next(num68);
						int num72;
						for (num72 = num71; num72 == num71; num72 = Main.rand.Next(num68))
						{
						}
						int num73 = array[num71];
						array[num71] = array[num72];
						array[num72] = num73;
					}
				}
				Vector2 vector20 = new Vector2(-1f, -1f);
				for (int num74 = 0; num74 < num68; num74++)
				{
					Vector2 vector21 = Main.npc[array[num74]].Center - base.Center;
					vector21.Normalize();
					vector20 += vector21;
				}
				vector20.Normalize();
				for (int num75 = 0; num75 < num67; num75++)
				{
					float num76 = Main.rand.Next(8, 13);
					Vector2 vector22 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
					vector22.Normalize();
					if (num68 > 0)
					{
						vector22 += vector20;
						vector22.Normalize();
					}
					vector22 *= num76;
					if (num68 > 0)
					{
						num68--;
						vector22 = Main.player[array[num68]].Center - base.Center;
						vector22.Normalize();
						vector22 *= num76;
					}
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, position.Y + (float)(width / 4), vector22.X, vector22.Y, 498, (int)((double)damage * 0.15), 1f, Main.myPlayer);
				}
			}
		}
		if (type == 460)
		{
			if (velocity.Y < 0f - gravity || velocity.Y > gravity)
			{
				knockBackResist = 0f;
			}
			else
			{
				knockBackResist = GetKnockbackMultiplier_ScaledByDifficulty(0.25f);
			}
		}
		if (type == 469)
		{
			knockBackResist = GetKnockbackMultiplier_ScaledByDifficulty(0.45f);
			if (ai[2] == 1f)
			{
				knockBackResist = 0f;
			}
			bool flag11 = false;
			int num77 = (int)base.Center.X / 16;
			int num78 = (int)base.Center.Y / 16;
			for (int num79 = num77 - 1; num79 <= num77 + 1; num79++)
			{
				for (int num80 = num78 - 1; num80 <= num78 + 1; num80++)
				{
					if (Main.tile[num79, num80] != null && Main.tile[num79, num80].wall > 0)
					{
						flag11 = true;
						break;
					}
				}
				if (flag11)
				{
					break;
				}
			}
			if (ai[2] == 0f && flag11)
			{
				if (velocity.Y == 0f)
				{
					flag = true;
					velocity.Y = -4.6f;
					velocity.X *= 1.3f;
				}
				else if (velocity.Y > 0f && !Main.player[target].dead)
				{
					ai[2] = 1f;
				}
			}
			if (flag11 && ai[2] == 1f && !Main.player[target].dead && Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
			{
				Vector2 vector23 = Main.player[target].Center - base.Center;
				float num81 = vector23.Length();
				vector23.Normalize();
				vector23 *= 4.5f + num81 / 300f;
				velocity = (velocity * 29f + vector23) / 30f;
				noGravity = true;
				ai[2] = 1f;
				return;
			}
			noGravity = false;
			ai[2] = 0f;
		}
		if (type == 462 && velocity.Y == 0f && (Main.player[target].Center - base.Center).Length() < 150f && Math.Abs(velocity.X) > 3f && ((velocity.X < 0f && base.Center.X > Main.player[target].Center.X) || (velocity.X > 0f && base.Center.X < Main.player[target].Center.X)))
		{
			flag = true;
			velocity.X *= 1.75f;
			velocity.Y -= 4.5f;
			if (base.Center.Y - Main.player[target].Center.Y > 20f)
			{
				velocity.Y -= 0.5f;
			}
			if (base.Center.Y - Main.player[target].Center.Y > 40f)
			{
				velocity.Y -= 1f;
			}
			if (base.Center.Y - Main.player[target].Center.Y > 80f)
			{
				velocity.Y -= 1.5f;
			}
			if (base.Center.Y - Main.player[target].Center.Y > 100f)
			{
				velocity.Y -= 1.5f;
			}
			if (Math.Abs(velocity.X) > 7f)
			{
				if (velocity.X < 0f)
				{
					velocity.X = -7f;
				}
				else
				{
					velocity.X = 7f;
				}
			}
		}
		if (type == 624 && target < 255)
		{
			if (!Main.remixWorld && !Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
			{
				ai[3] = num58;
				directionY = -1;
				if (type == 624 && !AI_003_Gnomes_ShouldTurnToStone() && (base.Center - Main.player[target].Center).Length() > 500f)
				{
					velocity.X *= 0.95f;
					if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
					{
						velocity.X = 0f;
					}
					return;
				}
			}
			else if (Main.player[target].Center.Y > base.Center.Y - 128f)
			{
				ai[3] = 0f;
			}
		}
		if (ai[3] < (float)num58 && DespawnEncouragement_AIStyle3_Fighters_NotDiscouraged(type, position, this))
		{
			if (shimmerTransparency < 1f)
			{
				if ((type == 3 || type == 691 || type == 591 || type == 590 || type == 331 || type == 332 || type == 21 || (type >= 449 && type <= 452) || type == 31 || type == 294 || type == 295 || type == 296 || type == 77 || type == 110 || type == 132 || type == 167 || type == 161 || type == 162 || type == 186 || type == 187 || type == 188 || type == 189 || type == 197 || type == 200 || type == 201 || type == 202 || type == 203 || type == 223 || type == 291 || type == 292 || type == 293 || type == 320 || type == 321 || type == 319 || type == 481 || type == 632 || type == 635) && Main.rand.Next(1000) == 0)
				{
					SoundEngine.PlaySound(14, (int)position.X, (int)position.Y);
				}
				if ((type == 489 || type == 586) && Main.rand.Next(800) == 0)
				{
					SoundEngine.PlaySound(14, (int)position.X, (int)position.Y, type);
				}
				if ((type == 78 || type == 79 || type == 80 || type == 630) && Main.rand.Next(500) == 0)
				{
					SoundEngine.PlaySound(26, (int)position.X, (int)position.Y);
				}
				if (type == 159 && Main.rand.Next(500) == 0)
				{
					SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 7);
				}
				if (type == 162 && Main.rand.Next(500) == 0)
				{
					SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 6);
				}
				if (type == 181 && Main.rand.Next(500) == 0)
				{
					SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 8);
				}
				if (type >= 269 && type <= 280 && Main.rand.Next(1000) == 0)
				{
					SoundEngine.PlaySound(14, (int)position.X, (int)position.Y);
				}
			}
			TargetClosest();
			if (directionY > 0 && Main.player[target].Center.Y <= base.Bottom.Y)
			{
				directionY = -1;
			}
		}
		else if (!(ai[2] > 0f) || !DespawnEncouragement_AIStyle3_Fighters_CanBeBusyWithAction(type))
		{
			if (Main.IsItDay() && (double)(position.Y / 16f) < Main.worldSurface && type != 624 && type != 631)
			{
				EncourageDespawn(10);
			}
			if (velocity.X == 0f)
			{
				if (velocity.Y == 0f)
				{
					ai[0] += 1f;
					if (ai[0] >= 2f)
					{
						direction *= -1;
						spriteDirection = direction;
						ai[0] = 0f;
					}
				}
			}
			else
			{
				ai[0] = 0f;
			}
			if (direction == 0)
			{
				direction = 1;
			}
		}
		if (type == 159 || type == 349)
		{
			if (type == 159 && ((velocity.X > 0f && direction < 0) || (velocity.X < 0f && direction > 0)))
			{
				velocity.X *= 0.95f;
			}
			if (velocity.X < -6f || velocity.X > 6f)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.8f;
				}
			}
			else if (velocity.X < 6f && direction == 1)
			{
				if (velocity.Y == 0f && velocity.X < 0f)
				{
					velocity.X *= 0.99f;
				}
				velocity.X += 0.07f;
				if (velocity.X > 6f)
				{
					velocity.X = 6f;
				}
			}
			else if (velocity.X > -6f && direction == -1)
			{
				if (velocity.Y == 0f && velocity.X > 0f)
				{
					velocity.X *= 0.99f;
				}
				velocity.X -= 0.07f;
				if (velocity.X < -6f)
				{
					velocity.X = -6f;
				}
			}
		}
		else if (NPCID.Sets.CritterThatCanTurnOnPlayers[type])
		{
			if (!Main.player[target].dead && velocity.Y == 0f)
			{
				float num82 = (base.Center - Main.player[target].Center).Length();
				num82 = Math.Abs(base.Center.X - Main.player[target].Center.X);
				if (num82 > 0f && num82 < 100f && ((velocity.X < 0f && Main.player[target].Center.X < base.Center.X) || (velocity.X > 0f && Main.player[target].Center.X > base.Center.X)))
				{
					velocity.Y = -4f;
					velocity.X += (float)direction * 3f;
				}
			}
			float num83 = 3.5f;
			if (velocity.X < 0f - num83 || velocity.X > num83)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.8f;
				}
			}
			else if (velocity.X < num83 && direction == 1)
			{
				if (velocity.Y == 0f && velocity.X < 0f)
				{
					velocity.X *= 0.8f;
				}
				velocity.X += 0.1f;
				if (velocity.X > num83)
				{
					velocity.X = num83;
				}
			}
			else if (velocity.X > 0f - num83 && direction == -1)
			{
				if (velocity.Y == 0f && velocity.X > 0f)
				{
					velocity.X *= 0.8f;
				}
				velocity.X -= 0.1f;
				if (velocity.X < 0f - num83)
				{
					velocity.X = 0f - num83;
				}
			}
		}
		else if (type == 199)
		{
			if (velocity.X < -4f || velocity.X > 4f)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.8f;
				}
			}
			else if (velocity.X < 4f && direction == 1)
			{
				if (velocity.Y == 0f && velocity.X < 0f)
				{
					velocity.X *= 0.8f;
				}
				velocity.X += 0.1f;
				if (velocity.X > 4f)
				{
					velocity.X = 4f;
				}
			}
			else if (velocity.X > -4f && direction == -1)
			{
				if (velocity.Y == 0f && velocity.X > 0f)
				{
					velocity.X *= 0.8f;
				}
				velocity.X -= 0.1f;
				if (velocity.X < -4f)
				{
					velocity.X = -4f;
				}
			}
		}
		else if (type == 120 || type == 166 || type == 213 || type == 258 || type == 528 || type == 529)
		{
			if (velocity.X < -3f || velocity.X > 3f)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.8f;
				}
			}
			else if (velocity.X < 3f && direction == 1)
			{
				if (velocity.Y == 0f && velocity.X < 0f)
				{
					velocity.X *= 0.99f;
				}
				velocity.X += 0.07f;
				if (velocity.X > 3f)
				{
					velocity.X = 3f;
				}
			}
			else if (velocity.X > -3f && direction == -1)
			{
				if (velocity.Y == 0f && velocity.X > 0f)
				{
					velocity.X *= 0.99f;
				}
				velocity.X -= 0.07f;
				if (velocity.X < -3f)
				{
					velocity.X = -3f;
				}
			}
		}
		else if (type == 461 || type == 27 || type == 77 || type == 104 || type == 163 || type == 162 || type == 196 || type == 197 || type == 212 || type == 257 || type == 326 || type == 343 || type == 348 || type == 351 || (type >= 524 && type <= 527) || type == 530 || type == 236)
		{
			if (velocity.X < -2f || velocity.X > 2f)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.8f;
				}
			}
			else if (velocity.X < 2f && direction == 1)
			{
				velocity.X += 0.07f;
				if (velocity.X > 2f)
				{
					velocity.X = 2f;
				}
			}
			else if (velocity.X > -2f && direction == -1)
			{
				velocity.X -= 0.07f;
				if (velocity.X < -2f)
				{
					velocity.X = -2f;
				}
			}
		}
		else if (type == 109)
		{
			if (velocity.X < -2f || velocity.X > 2f)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.8f;
				}
			}
			else if (velocity.X < 2f && direction == 1)
			{
				velocity.X += 0.04f;
				if (velocity.X > 2f)
				{
					velocity.X = 2f;
				}
			}
			else if (velocity.X > -2f && direction == -1)
			{
				velocity.X -= 0.04f;
				if (velocity.X < -2f)
				{
					velocity.X = -2f;
				}
			}
		}
		else if (type == 21 || type == 26 || type == 31 || type == 294 || type == 295 || type == 296 || type == 47 || type == 73 || type == 140 || type == 164 || type == 239 || type == 167 || type == 168 || type == 185 || type == 198 || type == 201 || type == 202 || type == 203 || type == 217 || type == 218 || type == 219 || type == 226 || type == 181 || type == 254 || type == 338 || type == 339 || type == 340 || type == 342 || type == 385 || type == 389 || type == 462 || type == 463 || type == 466 || type == 464 || type == 469 || type == 470 || type == 480 || type == 482 || type == 425 || type == 429 || type == 586 || type == 631 || type == 635)
		{
			float num84 = 1.5f;
			if (type == 181 && Main.remixWorld)
			{
				num84 = 3.75f;
			}
			else if (type == 294)
			{
				num84 = 2f;
			}
			else if (type == 295)
			{
				num84 = 1.75f;
			}
			else if (type == 296)
			{
				num84 = 1.25f;
			}
			else if (type == 201)
			{
				num84 = 1.1f;
			}
			else if (type == 202)
			{
				num84 = 0.9f;
			}
			else if (type == 203)
			{
				num84 = 1.2f;
			}
			else if (type == 338)
			{
				num84 = 1.75f;
			}
			else if (type == 339)
			{
				num84 = 1.25f;
			}
			else if (type == 340)
			{
				num84 = 2f;
			}
			else if (type == 385)
			{
				num84 = 1.8f;
			}
			else if (type == 389)
			{
				num84 = 2.25f;
			}
			else if (type == 462)
			{
				num84 = 4f;
			}
			else if (type == 463)
			{
				num84 = 0.75f;
			}
			else if (type == 466)
			{
				num84 = 3.75f;
			}
			else if (type == 469)
			{
				num84 = 3.25f;
			}
			else if (type == 480)
			{
				num84 = 1.5f + (1f - (float)life / (float)lifeMax) * 2f;
			}
			else if (type == 425)
			{
				num84 = 6f;
			}
			else if (type == 429)
			{
				num84 = 4f;
			}
			else if (type == 631)
			{
				num84 = 0.9f;
			}
			else if (type == 586)
			{
				num84 = 1.5f + (1f - (float)life / (float)lifeMax) * 3.5f;
			}
			if (type == 21 || type == 201 || type == 202 || type == 203 || type == 342 || type == 635)
			{
				num84 *= 1f + (1f - scale);
			}
			if (velocity.X < 0f - num84 || velocity.X > num84)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.8f;
				}
			}
			else if (velocity.X < num84 && direction == 1)
			{
				if (type == 466 && velocity.X < -2f)
				{
					velocity.X *= 0.9f;
				}
				if (type == 586 && velocity.Y == 0f && velocity.X < -1f)
				{
					velocity.X *= 0.9f;
				}
				velocity.X += 0.07f;
				if (velocity.X > num84)
				{
					velocity.X = num84;
				}
			}
			else if (velocity.X > 0f - num84 && direction == -1)
			{
				if (type == 466 && velocity.X > 2f)
				{
					velocity.X *= 0.9f;
				}
				if (type == 586 && velocity.Y == 0f && velocity.X > 1f)
				{
					velocity.X *= 0.9f;
				}
				velocity.X -= 0.07f;
				if (velocity.X < 0f - num84)
				{
					velocity.X = 0f - num84;
				}
			}
			if (velocity.Y == 0f && type == 462 && ((direction > 0 && velocity.X < 0f) || (direction < 0 && velocity.X > 0f)))
			{
				velocity.X *= 0.9f;
			}
		}
		else if (type >= 269 && type <= 280)
		{
			float num85 = 1.5f;
			if (type == 269)
			{
				num85 = 2f;
			}
			if (type == 270)
			{
				num85 = 1f;
			}
			if (type == 271)
			{
				num85 = 1.5f;
			}
			if (type == 272)
			{
				num85 = 3f;
			}
			if (type == 273)
			{
				num85 = 1.25f;
			}
			if (type == 274)
			{
				num85 = 3f;
			}
			if (type == 275)
			{
				num85 = 3.25f;
			}
			if (type == 276)
			{
				num85 = 2f;
			}
			if (type == 277)
			{
				num85 = 2.75f;
			}
			if (type == 278)
			{
				num85 = 1.8f;
			}
			if (type == 279)
			{
				num85 = 1.3f;
			}
			if (type == 280)
			{
				num85 = 2.5f;
			}
			num85 *= 1f + (1f - scale);
			if (velocity.X < 0f - num85 || velocity.X > num85)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.8f;
				}
			}
			else if (velocity.X < num85 && direction == 1)
			{
				velocity.X += 0.07f;
				if (velocity.X > num85)
				{
					velocity.X = num85;
				}
			}
			else if (velocity.X > 0f - num85 && direction == -1)
			{
				velocity.X -= 0.07f;
				if (velocity.X < 0f - num85)
				{
					velocity.X = 0f - num85;
				}
			}
		}
		else if (type >= 305 && type <= 314)
		{
			float num86 = 1.5f;
			if (type == 305 || type == 310)
			{
				num86 = 2f;
			}
			if (type == 306 || type == 311)
			{
				num86 = 1.25f;
			}
			if (type == 307 || type == 312)
			{
				num86 = 2.25f;
			}
			if (type == 308 || type == 313)
			{
				num86 = 1.5f;
			}
			if (type == 309 || type == 314)
			{
				num86 = 1f;
			}
			if (type < 310)
			{
				if (velocity.Y == 0f)
				{
					velocity.X *= 0.85f;
					if ((double)velocity.X > -0.3 && (double)velocity.X < 0.3)
					{
						flag = true;
						velocity.Y = -7f;
						velocity.X = num86 * (float)direction;
					}
				}
				else if (spriteDirection == direction)
				{
					velocity.X = (velocity.X * 10f + num86 * (float)direction) / 11f;
				}
			}
			else if (velocity.X < 0f - num86 || velocity.X > num86)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.8f;
				}
			}
			else if (velocity.X < num86 && direction == 1)
			{
				velocity.X += 0.07f;
				if (velocity.X > num86)
				{
					velocity.X = num86;
				}
			}
			else if (velocity.X > 0f - num86 && direction == -1)
			{
				velocity.X -= 0.07f;
				if (velocity.X < 0f - num86)
				{
					velocity.X = 0f - num86;
				}
			}
		}
		else if (type == 67 || type == 220 || type == 428)
		{
			if (velocity.X < -0.5f || velocity.X > 0.5f)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.7f;
				}
			}
			else if (velocity.X < 0.5f && direction == 1)
			{
				velocity.X += 0.03f;
				if (velocity.X > 0.5f)
				{
					velocity.X = 0.5f;
				}
			}
			else if (velocity.X > -0.5f && direction == -1)
			{
				velocity.X -= 0.03f;
				if (velocity.X < -0.5f)
				{
					velocity.X = -0.5f;
				}
			}
		}
		else if (type == 78 || type == 79 || type == 80 || type == 630)
		{
			float num87 = 1f;
			float num88 = 0.05f;
			if (life < lifeMax / 2)
			{
				num87 = 2f;
				num88 = 0.1f;
			}
			if (type == 79 || type == 630)
			{
				num87 *= 1.5f;
			}
			if (velocity.X < 0f - num87 || velocity.X > num87)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.7f;
				}
			}
			else if (velocity.X < num87 && direction == 1)
			{
				velocity.X += num88;
				if (velocity.X > num87)
				{
					velocity.X = num87;
				}
			}
			else if (velocity.X > 0f - num87 && direction == -1)
			{
				velocity.X -= num88;
				if (velocity.X < 0f - num87)
				{
					velocity.X = 0f - num87;
				}
			}
		}
		else if (type == 287)
		{
			float num89 = 5f;
			float num90 = 0.2f;
			if (velocity.X < 0f - num89 || velocity.X > num89)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.7f;
				}
			}
			else if (velocity.X < num89 && direction == 1)
			{
				velocity.X += num90;
				if (velocity.X > num89)
				{
					velocity.X = num89;
				}
			}
			else if (velocity.X > 0f - num89 && direction == -1)
			{
				velocity.X -= num90;
				if (velocity.X < 0f - num89)
				{
					velocity.X = 0f - num89;
				}
			}
		}
		else if (type == 243)
		{
			float num91 = 1f;
			float num92 = 0.07f;
			num91 += (1f - (float)life / (float)lifeMax) * 1.5f;
			num92 += (1f - (float)life / (float)lifeMax) * 0.15f;
			if (velocity.X < 0f - num91 || velocity.X > num91)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.7f;
				}
			}
			else if (velocity.X < num91 && direction == 1)
			{
				velocity.X += num92;
				if (velocity.X > num91)
				{
					velocity.X = num91;
				}
			}
			else if (velocity.X > 0f - num91 && direction == -1)
			{
				velocity.X -= num92;
				if (velocity.X < 0f - num91)
				{
					velocity.X = 0f - num91;
				}
			}
		}
		else if (type == 251)
		{
			float num93 = 1f;
			float num94 = 0.08f;
			num93 += (1f - (float)life / (float)lifeMax) * 2f;
			num94 += (1f - (float)life / (float)lifeMax) * 0.2f;
			if (velocity.X < 0f - num93 || velocity.X > num93)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.7f;
				}
			}
			else if (velocity.X < num93 && direction == 1)
			{
				velocity.X += num94;
				if (velocity.X > num93)
				{
					velocity.X = num93;
				}
			}
			else if (velocity.X > 0f - num93 && direction == -1)
			{
				velocity.X -= num94;
				if (velocity.X < 0f - num93)
				{
					velocity.X = 0f - num93;
				}
			}
		}
		else if (type == 386)
		{
			if (ai[2] > 0f)
			{
				if (velocity.Y == 0f)
				{
					velocity.X *= 0.8f;
				}
			}
			else
			{
				float num95 = 0.15f;
				float num96 = 1.5f;
				if (velocity.X < 0f - num96 || velocity.X > num96)
				{
					if (velocity.Y == 0f)
					{
						velocity *= 0.7f;
					}
				}
				else if (velocity.X < num96 && direction == 1)
				{
					velocity.X += num95;
					if (velocity.X > num96)
					{
						velocity.X = num96;
					}
				}
				else if (velocity.X > 0f - num96 && direction == -1)
				{
					velocity.X -= num95;
					if (velocity.X < 0f - num96)
					{
						velocity.X = 0f - num96;
					}
				}
			}
		}
		else if (type == 460)
		{
			float num97 = 3f;
			float num98 = 0.1f;
			if (Math.Abs(velocity.X) > 2f)
			{
				num98 *= 0.8f;
			}
			if ((double)Math.Abs(velocity.X) > 2.5)
			{
				num98 *= 0.8f;
			}
			if (Math.Abs(velocity.X) > 3f)
			{
				num98 *= 0.8f;
			}
			if ((double)Math.Abs(velocity.X) > 3.5)
			{
				num98 *= 0.8f;
			}
			if (Math.Abs(velocity.X) > 4f)
			{
				num98 *= 0.8f;
			}
			if ((double)Math.Abs(velocity.X) > 4.5)
			{
				num98 *= 0.8f;
			}
			if (Math.Abs(velocity.X) > 5f)
			{
				num98 *= 0.8f;
			}
			if ((double)Math.Abs(velocity.X) > 5.5)
			{
				num98 *= 0.8f;
			}
			num97 += (1f - (float)life / (float)lifeMax) * 3f;
			if (velocity.X < 0f - num97 || velocity.X > num97)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.7f;
				}
			}
			else if (velocity.X < num97 && direction == 1)
			{
				if (velocity.X < 0f)
				{
					velocity.X *= 0.93f;
				}
				velocity.X += num98;
				if (velocity.X > num97)
				{
					velocity.X = num97;
				}
			}
			else if (velocity.X > 0f - num97 && direction == -1)
			{
				if (velocity.X > 0f)
				{
					velocity.X *= 0.93f;
				}
				velocity.X -= num98;
				if (velocity.X < 0f - num97)
				{
					velocity.X = 0f - num97;
				}
			}
		}
		else if (type == 508 || type == 580 || type == 582)
		{
			float num99 = 2.5f;
			float num100 = 10f;
			float num101 = Math.Abs(velocity.X);
			if (type == 582)
			{
				num99 = 2.25f;
				num100 = 7f;
				if (num101 > 2.5f)
				{
					num99 = 3f;
					num100 += 75f;
				}
				else if (num101 > 2f)
				{
					num99 = 2.75f;
					num100 += 55f;
				}
			}
			else if (num101 > 2.75f)
			{
				num99 = 3.5f;
				num100 += 80f;
			}
			else if ((double)num101 > 2.25)
			{
				num99 = 3f;
				num100 += 60f;
			}
			if ((double)Math.Abs(velocity.Y) < 0.5)
			{
				if (velocity.X > 0f && direction < 0)
				{
					velocity *= 0.95f;
				}
				if (velocity.X < 0f && direction > 0)
				{
					velocity *= 0.95f;
				}
			}
			if (Math.Abs(velocity.Y) > gravity)
			{
				float num102 = 3f;
				if (type == 582)
				{
					num102 = 2f;
				}
				num100 *= num102;
			}
			if (velocity.X <= 0f && direction < 0)
			{
				velocity.X = (velocity.X * num100 - num99) / (num100 + 1f);
			}
			else if (velocity.X >= 0f && direction > 0)
			{
				velocity.X = (velocity.X * num100 + num99) / (num100 + 1f);
			}
			else if (Math.Abs(base.Center.X - Main.player[target].Center.X) > 20f && Math.Abs(velocity.Y) <= gravity)
			{
				velocity.X *= 0.99f;
				velocity.X += (float)direction * 0.025f;
			}
		}
		else if (type == 391 || type == 427 || type == 415 || type == 419 || type == 518 || type == 532)
		{
			float num103 = 5f;
			float num104 = 0.25f;
			float num105 = 0.7f;
			if (type == 427)
			{
				num103 = 6f;
				num104 = 0.2f;
				num105 = 0.8f;
			}
			else if (type == 415)
			{
				num103 = 4f;
				num104 = 0.1f;
				num105 = 0.95f;
			}
			else if (type == 419)
			{
				num103 = 6f;
				num104 = 0.15f;
				num105 = 0.85f;
			}
			else if (type == 518)
			{
				num103 = 5f;
				num104 = 0.1f;
				num105 = 0.95f;
			}
			else if (type == 532)
			{
				num103 = 5f;
				num104 = 0.15f;
				num105 = 0.98f;
			}
			if (velocity.X < 0f - num103 || velocity.X > num103)
			{
				if (velocity.Y == 0f)
				{
					velocity *= num105;
				}
			}
			else if (velocity.X < num103 && direction == 1)
			{
				velocity.X += num104;
				if (velocity.X > num103)
				{
					velocity.X = num103;
				}
			}
			else if (velocity.X > 0f - num103 && direction == -1)
			{
				velocity.X -= num104;
				if (velocity.X < 0f - num103)
				{
					velocity.X = 0f - num103;
				}
			}
		}
		else if ((type >= 430 && type <= 436) || type == 494 || type == 495 || type == 591)
		{
			if (ai[2] == 0f)
			{
				damage = defDamage;
				float num106 = 1f;
				num106 *= 1f + (1f - scale);
				if (velocity.X < 0f - num106 || velocity.X > num106)
				{
					if (velocity.Y == 0f)
					{
						velocity *= 0.8f;
					}
				}
				else if (velocity.X < num106 && direction == 1)
				{
					velocity.X += 0.07f;
					if (velocity.X > num106)
					{
						velocity.X = num106;
					}
				}
				else if (velocity.X > 0f - num106 && direction == -1)
				{
					velocity.X -= 0.07f;
					if (velocity.X < 0f - num106)
					{
						velocity.X = 0f - num106;
					}
				}
				if (velocity.Y == 0f && (!Main.IsItDay() || (double)position.Y > Main.worldSurface * 16.0) && !Main.player[target].dead)
				{
					Vector2 vector24 = base.Center - Main.player[target].Center;
					int num107 = 50;
					if (type >= 494 && type <= 495)
					{
						num107 = 42;
					}
					if (vector24.Length() < (float)num107 && Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
					{
						velocity.X *= 0.7f;
						ai[2] = 1f;
					}
				}
			}
			else
			{
				damage = (int)((double)defDamage * 1.5);
				ai[3] = 1f;
				velocity.X *= 0.9f;
				if ((double)Math.Abs(velocity.X) < 0.1)
				{
					velocity.X = 0f;
				}
				ai[2] += 1f;
				if (ai[2] >= 20f || velocity.Y != 0f || (Main.IsItDay() && (double)position.Y < Main.worldSurface * 16.0))
				{
					ai[2] = 0f;
				}
			}
		}
		else if (type != 110 && type != 111 && type != 206 && type != 214 && type != 215 && type != 216 && type != 290 && type != 291 && type != 292 && type != 293 && type != 350 && type != 379 && type != 380 && type != 381 && type != 382 && (type < 449 || type > 452) && type != 468 && type != 481 && type != 411 && type != 409 && (type < 498 || type > 506) && type != 424 && type != 426 && type != 520)
		{
			float num108 = 1f;
			if (type == 624)
			{
				num108 = 2.5f;
			}
			if (type == 186)
			{
				num108 = 1.1f;
			}
			if (type == 187)
			{
				num108 = 0.9f;
			}
			if (type == 188)
			{
				num108 = 1.2f;
			}
			if (type == 189)
			{
				num108 = 0.8f;
			}
			if (type == 132)
			{
				num108 = 0.95f;
			}
			if (type == 200)
			{
				num108 = 0.87f;
			}
			if (type == 223)
			{
				num108 = 1.05f;
			}
			if (type == 632)
			{
				num108 = 0.8f;
			}
			if (type == 691)
			{
				num108 = 0.85f;
			}
			if (type == 489)
			{
				float num109 = (Main.player[target].Center - base.Center).Length();
				num109 *= 0.0025f;
				if ((double)num109 > 1.5)
				{
					num109 = 1.5f;
				}
				num108 = ((!Main.expertMode) ? (2.5f - num109) : (3f - num109));
				num108 *= 0.8f;
			}
			if (type == 489 || type == 3 || type == 132 || type == 186 || type == 187 || type == 188 || type == 189 || type == 200 || type == 223 || type == 331 || type == 332)
			{
				num108 *= 1f + (1f - scale);
			}
			if (velocity.X < 0f - num108 || velocity.X > num108)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.8f;
				}
			}
			else if (velocity.X < num108 && direction == 1)
			{
				velocity.X += 0.07f;
				if (velocity.X > num108)
				{
					velocity.X = num108;
				}
			}
			else if (velocity.X > 0f - num108 && direction == -1)
			{
				velocity.X -= 0.07f;
				if (velocity.X < 0f - num108)
				{
					velocity.X = 0f - num108;
				}
			}
		}
		if (type >= 277 && type <= 280)
		{
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.2f, 0.1f, 0f);
		}
		else if (type == 520)
		{
			Lighting.AddLight(base.Top + new Vector2(0f, 20f), 0.3f, 0.3f, 0.7f);
		}
		else if (type == 525)
		{
			Vector3 rgb = new Vector3(0.7f, 1f, 0.2f) * 0.5f;
			Lighting.AddLight(base.Top + new Vector2(0f, 15f), rgb);
		}
		else if (type == 526)
		{
			Vector3 rgb2 = new Vector3(1f, 1f, 0.5f) * 0.4f;
			Lighting.AddLight(base.Top + new Vector2(0f, 15f), rgb2);
		}
		else if (type == 527)
		{
			Vector3 rgb3 = new Vector3(0.6f, 0.3f, 1f) * 0.4f;
			Lighting.AddLight(base.Top + new Vector2(0f, 15f), rgb3);
		}
		else if (type == 415)
		{
			hide = false;
			for (int num110 = 0; num110 < Main.maxNPCs; num110++)
			{
				if (Main.npc[num110].active && Main.npc[num110].type == 416 && Main.npc[num110].ai[0] == (float)whoAmI)
				{
					hide = true;
					break;
				}
			}
		}
		else if (type == 258)
		{
			if (velocity.Y != 0f)
			{
				TargetClosest();
				spriteDirection = direction;
				if (Main.player[target].Center.X < position.X && velocity.X > 0f)
				{
					velocity.X *= 0.95f;
				}
				else if (Main.player[target].Center.X > position.X + (float)width && velocity.X < 0f)
				{
					velocity.X *= 0.95f;
				}
				if (Main.player[target].Center.X < position.X && velocity.X > -5f)
				{
					velocity.X -= 0.1f;
				}
				else if (Main.player[target].Center.X > position.X + (float)width && velocity.X < 5f)
				{
					velocity.X += 0.1f;
				}
			}
			else if (Main.player[target].Center.Y + 50f < position.Y && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
			{
				flag = true;
				velocity.Y = -7f;
			}
		}
		else if (type == 425)
		{
			if (localAI[3] == 0f)
			{
				localAI[3] = 1f;
				ai[3] = -120f;
			}
			if (velocity.Y == 0f)
			{
				ai[2] = 0f;
			}
			if (velocity.Y != 0f && ai[2] == 1f)
			{
				TargetClosest();
				spriteDirection = -direction;
				if (Collision.CanHit(base.Center, 0, 0, Main.player[target].Center, 0, 0))
				{
					float num111 = 0.3f;
					float num112 = 8f;
					float num113 = 0.3f;
					float num114 = 7f;
					float num115 = Main.player[target].Center.X - (float)(direction * 300) - base.Center.X;
					float num116 = Main.player[target].Bottom.Y - base.Bottom.Y;
					if (num115 < 0f && velocity.X > 0f)
					{
						velocity.X *= 0.9f;
					}
					else if (num115 > 0f && velocity.X < 0f)
					{
						velocity.X *= 0.9f;
					}
					if (num115 < 0f && velocity.X > 0f - num114)
					{
						velocity.X -= num113;
					}
					else if (num115 > 0f && velocity.X < num114)
					{
						velocity.X += num113;
					}
					if (velocity.X > num114)
					{
						velocity.X = num114;
					}
					if (velocity.X < 0f - num114)
					{
						velocity.X = 0f - num114;
					}
					if (num116 < -20f && velocity.Y > 0f)
					{
						velocity.Y *= 0.8f;
					}
					else if (num116 > 20f && velocity.Y < 0f)
					{
						velocity.Y *= 0.8f;
					}
					if (num116 < -20f && velocity.Y > 0f - num112)
					{
						velocity.Y -= num111;
					}
					else if (num116 > 20f && velocity.Y < num112)
					{
						velocity.Y += num111;
					}
				}
				if (Main.rand.Next(3) == 0)
				{
					position += netOffset;
					Vector2 vector25 = base.Center + new Vector2(direction * -14, -8f) - Vector2.One * 4f;
					Vector2 vector26 = new Vector2(direction * -6, 12f) * 0.2f + Utils.RandomVector2(Main.rand, -1f, 1f) * 0.1f;
					Dust obj5 = Main.dust[Dust.NewDust(vector25, 8, 8, 229, vector26.X, vector26.Y, 100, Color.Transparent, 1f + Main.rand.NextFloat() * 0.5f)];
					obj5.noGravity = true;
					obj5.velocity = vector26;
					obj5.customData = this;
					position -= netOffset;
				}
				for (int num117 = 0; num117 < Main.maxNPCs; num117++)
				{
					if (num117 != whoAmI && Main.npc[num117].active && Main.npc[num117].type == type && Math.Abs(position.X - Main.npc[num117].position.X) + Math.Abs(position.Y - Main.npc[num117].position.Y) < (float)width)
					{
						if (position.X < Main.npc[num117].position.X)
						{
							velocity.X -= 0.15f;
						}
						else
						{
							velocity.X += 0.15f;
						}
						if (position.Y < Main.npc[num117].position.Y)
						{
							velocity.Y -= 0.15f;
						}
						else
						{
							velocity.Y += 0.15f;
						}
					}
				}
			}
			else if (Main.player[target].Center.Y + 100f < position.Y && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
			{
				flag = true;
				velocity.Y = -5f;
				ai[2] = 1f;
			}
			if (ai[3] < 0f)
			{
				ai[3] += 1f;
			}
			int num118 = 30;
			int num119 = 10;
			int num120 = 180;
			if (ai[3] >= 0f && ai[3] <= (float)num118)
			{
				Vector2 vector27 = DirectionTo(Main.player[target].Center);
				bool flag12 = Math.Abs(vector27.Y) <= Math.Abs(vector27.X);
				bool flag13 = Distance(Main.player[target].Center) < 800f && flag12 && Collision.CanHitLine(base.Center, 0, 0, Main.player[target].Center, 0, 0);
				ai[3] = MathHelper.Clamp(ai[3] + (float)flag13.ToDirectionInt(), 0f, num118);
			}
			if (ai[3] >= (float)(num118 + 1) && (ai[3] += 1f) >= (float)(num118 + num119))
			{
				ai[3] = num118 - num120;
				netUpdate = true;
			}
			if (Main.netMode != 1 && ai[3] == (float)num118)
			{
				ai[3] += 1f;
				netUpdate = true;
				int num121 = 20;
				Vector2 chaserPosition = base.Center + new Vector2(direction * 30, 2f);
				Vector2 vector28 = DirectionTo(Main.player[target].Center) * num121;
				if (vector28.HasNaNs())
				{
					vector28 = new Vector2(direction * num121, 0f);
				}
				int num122 = 2;
				Utils.ChaseResults chaseResults = Utils.GetChaseResults(chaserPosition, num121, Main.player[target].Center, Main.player[target].velocity * 0.5f / num122);
				if (chaseResults.InterceptionHappens)
				{
					Vector2 vector29 = chaseResults.ChaserVelocity / num122;
					vector28.X = vector29.X;
					vector28.Y = vector29.Y;
				}
				int attackDamage_ForProjectiles = GetAttackDamage_ForProjectiles(75f, 50f);
				for (int num123 = 0; num123 < 4; num123++)
				{
					Vector2 vector30 = vector28 + Utils.RandomVector2(Main.rand, -0.8f, 0.8f) * ((num123 != 0) ? 1 : 0);
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), chaserPosition.X, chaserPosition.Y, vector30.X, vector30.Y, 577, attackDamage_ForProjectiles, 1f, Main.myPlayer);
				}
			}
		}
		else if (type == 427)
		{
			if (velocity.Y == 0f)
			{
				ai[2] = 0f;
				rotation = 0f;
			}
			else
			{
				rotation = velocity.X * 0.1f;
			}
			if (velocity.Y != 0f && ai[2] == 1f)
			{
				TargetClosest();
				spriteDirection = -direction;
				if (Collision.CanHit(base.Center, 0, 0, Main.player[target].Center, 0, 0))
				{
					float num124 = Main.player[target].Center.X - base.Center.X;
					float num125 = Main.player[target].Center.Y - base.Center.Y;
					if (num124 < 0f && velocity.X > 0f)
					{
						velocity.X *= 0.98f;
					}
					else if (num124 > 0f && velocity.X < 0f)
					{
						velocity.X *= 0.98f;
					}
					if (num124 < -20f && velocity.X > -6f)
					{
						velocity.X -= 0.015f;
					}
					else if (num124 > 20f && velocity.X < 6f)
					{
						velocity.X += 0.015f;
					}
					if (velocity.X > 6f)
					{
						velocity.X = 6f;
					}
					if (velocity.X < -6f)
					{
						velocity.X = -6f;
					}
					if (num125 < -20f && velocity.Y > 0f)
					{
						velocity.Y *= 0.98f;
					}
					else if (num125 > 20f && velocity.Y < 0f)
					{
						velocity.Y *= 0.98f;
					}
					if (num125 < -20f && velocity.Y > -6f)
					{
						velocity.Y -= 0.15f;
					}
					else if (num125 > 20f && velocity.Y < 6f)
					{
						velocity.Y += 0.15f;
					}
				}
				for (int num126 = 0; num126 < Main.maxNPCs; num126++)
				{
					if (num126 != whoAmI && Main.npc[num126].active && Main.npc[num126].type == type && Math.Abs(position.X - Main.npc[num126].position.X) + Math.Abs(position.Y - Main.npc[num126].position.Y) < (float)width)
					{
						if (position.X < Main.npc[num126].position.X)
						{
							velocity.X -= 0.05f;
						}
						else
						{
							velocity.X += 0.05f;
						}
						if (position.Y < Main.npc[num126].position.Y)
						{
							velocity.Y -= 0.05f;
						}
						else
						{
							velocity.Y += 0.05f;
						}
					}
				}
			}
			else if (Main.player[target].Center.Y + 100f < position.Y && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
			{
				flag = true;
				velocity.Y = -5f;
				ai[2] = 1f;
			}
		}
		else if (type == 426)
		{
			float num127 = 6f;
			float num128 = 0.2f;
			float num129 = 6f;
			if (ai[1] > 0f && velocity.Y > 0f)
			{
				velocity.Y *= 0.85f;
				if (velocity.Y == 0f)
				{
					velocity.Y = -0.4f;
				}
			}
			if (velocity.Y != 0f)
			{
				TargetClosest();
				spriteDirection = direction;
				if (Collision.CanHit(base.Center, 0, 0, Main.player[target].Center, 0, 0))
				{
					float num130 = Main.player[target].Center.X - (float)(direction * 300) - base.Center.X;
					if (num130 < 40f && velocity.X > 0f)
					{
						velocity.X *= 0.98f;
					}
					else if (num130 > 40f && velocity.X < 0f)
					{
						velocity.X *= 0.98f;
					}
					if (num130 < 40f && velocity.X > 0f - num127)
					{
						velocity.X -= num128;
					}
					else if (num130 > 40f && velocity.X < num127)
					{
						velocity.X += num128;
					}
					if (velocity.X > num127)
					{
						velocity.X = num127;
					}
					if (velocity.X < 0f - num127)
					{
						velocity.X = 0f - num127;
					}
				}
			}
			else if (Main.player[target].Center.Y + 100f < position.Y && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
			{
				flag = true;
				velocity.Y = 0f - num129;
			}
			for (int num131 = 0; num131 < Main.maxNPCs; num131++)
			{
				if (num131 != whoAmI && Main.npc[num131].active && Main.npc[num131].type == type && Math.Abs(position.X - Main.npc[num131].position.X) + Math.Abs(position.Y - Main.npc[num131].position.Y) < (float)width)
				{
					if (position.X < Main.npc[num131].position.X)
					{
						velocity.X -= 0.1f;
					}
					else
					{
						velocity.X += 0.1f;
					}
					if (position.Y < Main.npc[num131].position.Y)
					{
						velocity.Y -= 0.1f;
					}
					else
					{
						velocity.Y += 0.1f;
					}
				}
			}
			if (Main.rand.Next(6) == 0 && ai[1] <= 20f)
			{
				position += netOffset;
				Dust obj6 = Main.dust[Dust.NewDust(base.Center + new Vector2((spriteDirection == 1) ? 8 : (-20), -20f), 8, 8, 229, velocity.X, velocity.Y, 100)];
				obj6.velocity = obj6.velocity / 4f + velocity / 2f;
				obj6.scale = 0.6f;
				obj6.noLight = true;
				position -= netOffset;
			}
			if (ai[1] >= 57f)
			{
				position += netOffset;
				int num132 = Utils.SelectRandom<int>(Main.rand, 161, 229);
				Dust obj7 = Main.dust[Dust.NewDust(base.Center + new Vector2((spriteDirection == 1) ? 8 : (-20), -20f), 8, 8, num132, velocity.X, velocity.Y, 100)];
				obj7.velocity = obj7.velocity / 4f + DirectionTo(Main.player[target].Top);
				obj7.scale = 1.2f;
				obj7.noLight = true;
				position -= netOffset;
			}
			if (Main.rand.Next(6) == 0)
			{
				position += netOffset;
				Dust dust5 = Main.dust[Dust.NewDust(base.Center, 2, 2, 229)];
				dust5.position = base.Center + new Vector2((spriteDirection == 1) ? 26 : (-26), 24f);
				dust5.velocity.X = 0f;
				if (dust5.velocity.Y < 0f)
				{
					dust5.velocity.Y = 0f;
				}
				dust5.noGravity = true;
				dust5.scale = 1f;
				dust5.noLight = true;
				position -= netOffset;
			}
		}
		else if (type == 185)
		{
			if (velocity.Y == 0f)
			{
				rotation = 0f;
				localAI[0] = 0f;
			}
			else if (localAI[0] == 1f)
			{
				rotation += velocity.X * 0.05f;
			}
		}
		else if (type == 428)
		{
			if (velocity.Y == 0f)
			{
				rotation = 0f;
			}
			else
			{
				rotation += velocity.X * 0.08f;
			}
		}
		if (type == 159 && Main.netMode != 1)
		{
			Vector2 vector31 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num133 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector31.X;
			float num134 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector31.Y;
			if ((float)Math.Sqrt(num133 * num133 + num134 * num134) > 300f)
			{
				Transform(158);
			}
		}
		if (Main.netMode != 1)
		{
			if (Main.expertMode && target >= 0 && (type == 163 || type == 238 || type == 236 || type == 237) && Collision.CanHit(base.Center, 1, 1, Main.player[target].Center, 1, 1))
			{
				localAI[0] += 1f;
				if (justHit)
				{
					localAI[0] -= Main.rand.Next(20, 60);
					if (localAI[0] < 0f)
					{
						localAI[0] = 0f;
					}
				}
				if (localAI[0] > (float)Main.rand.Next(180, 900))
				{
					localAI[0] = 0f;
					Vector2 vector32 = Main.player[target].Center - base.Center;
					vector32.Normalize();
					vector32 *= 8f;
					int attackDamage_ForProjectiles2 = GetAttackDamage_ForProjectiles(18f, 18f);
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, vector32.X, vector32.Y, 472, attackDamage_ForProjectiles2, 0f, Main.myPlayer);
				}
			}
			if (velocity.Y == 0f)
			{
				int num135 = -1;
				switch (type)
				{
				case 164:
					num135 = 165;
					break;
				case 236:
					num135 = 237;
					break;
				case 163:
					num135 = 238;
					break;
				case 239:
					num135 = 240;
					break;
				case 530:
					num135 = 531;
					break;
				}
				if (num135 != -1 && NPCCanStickToWalls() && TryMoveToTransformableSpaceInto(num135))
				{
					Transform(num135, 0f, 0f, 0f, 0f, withReposition: false);
				}
			}
		}
		if (type == 243)
		{
			if (justHit && Main.rand.Next(3) == 0)
			{
				ai[2] -= Main.rand.Next(30);
			}
			if (ai[2] < 0f)
			{
				ai[2] = 0f;
			}
			if (confused)
			{
				ai[2] = 0f;
			}
			ai[2] += 1f;
			float num136 = Main.rand.Next(30, 900);
			num136 *= (float)life / (float)lifeMax;
			num136 += 30f;
			if (Main.netMode != 1 && ai[2] >= num136 && velocity.Y == 0f && !Main.player[target].dead && !Main.player[target].frozen && ((direction > 0 && base.Center.X < Main.player[target].Center.X) || (direction < 0 && base.Center.X > Main.player[target].Center.X)) && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
			{
				Vector2 vector33 = new Vector2(position.X + (float)width * 0.5f, position.Y + 20f);
				vector33.X += 10 * direction;
				float num137 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector33.X;
				float num138 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector33.Y;
				num137 += (float)Main.rand.Next(-40, 41);
				num138 += (float)Main.rand.Next(-40, 41);
				float num139 = (float)Math.Sqrt(num137 * num137 + num138 * num138);
				netUpdate = true;
				num139 = 15f / num139;
				num137 *= num139;
				num138 *= num139;
				int num140 = 32;
				int num141 = 257;
				vector33.X += num137 * 3f;
				vector33.Y += num138 * 3f;
				Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector33.X, vector33.Y, num137, num138, num141, num140, 0f, Main.myPlayer);
				ai[2] = 0f;
			}
		}
		if (type == 251)
		{
			if (justHit)
			{
				ai[2] -= Main.rand.Next(30);
			}
			if (ai[2] < 0f)
			{
				ai[2] = 0f;
			}
			if (confused)
			{
				ai[2] = 0f;
			}
			ai[2] += 1f;
			float num142 = Main.rand.Next(60, 1800);
			num142 *= (float)life / (float)lifeMax;
			num142 += 15f;
			if (Main.netMode != 1 && ai[2] >= num142 && velocity.Y == 0f && !Main.player[target].dead && !Main.player[target].frozen && ((direction > 0 && base.Center.X < Main.player[target].Center.X) || (direction < 0 && base.Center.X > Main.player[target].Center.X)) && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height))
			{
				Vector2 vector34 = new Vector2(position.X + (float)width * 0.5f, position.Y + 12f);
				vector34.X += 6 * direction;
				float num143 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector34.X;
				float num144 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector34.Y;
				num143 += (float)Main.rand.Next(-40, 41);
				num144 += (float)Main.rand.Next(-30, 0);
				float num145 = (float)Math.Sqrt(num143 * num143 + num144 * num144);
				netUpdate = true;
				num145 = 15f / num145;
				num143 *= num145;
				num144 *= num145;
				int num146 = 30;
				int num147 = 83;
				vector34.X += num143 * 3f;
				vector34.Y += num144 * 3f;
				Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector34.X, vector34.Y, num143, num144, num147, num146, 0f, Main.myPlayer);
				ai[2] = 0f;
			}
		}
		if (type == 386)
		{
			if (confused)
			{
				ai[2] = -60f;
			}
			else
			{
				if (ai[2] < 60f)
				{
					ai[2] += 1f;
				}
				if (ai[2] > 0f && CountNPCS(387) >= 4 * CountNPCS(386))
				{
					ai[2] = 0f;
				}
				if (justHit)
				{
					ai[2] = -30f;
				}
				if (ai[2] == 30f)
				{
					int num148 = (int)position.X / 16;
					int num149 = (int)position.Y / 16;
					int num150 = (int)position.X / 16;
					int num151 = (int)position.Y / 16;
					int num152 = 5;
					int num153 = 0;
					bool flag14 = false;
					int num154 = 2;
					int num155 = 0;
					while (!flag14 && num153 < 100)
					{
						num153++;
						int num156 = Main.rand.Next(num148 - num152, num148 + num152);
						for (int num157 = Main.rand.Next(num149 - num152, num149 + num152); num157 < num149 + num152; num157++)
						{
							if ((num157 < num149 - num154 || num157 > num149 + num154 || num156 < num148 - num154 || num156 > num148 + num154) && (num157 < num151 - num155 || num157 > num151 + num155 || num156 < num150 - num155 || num156 > num150 + num155) && Main.tile[num156, num157].nactive())
							{
								bool flag15 = true;
								if (Main.tile[num156, num157 - 1].lava())
								{
									flag15 = false;
								}
								if (flag15 && Main.tileSolid[Main.tile[num156, num157].type] && !Collision.SolidTiles(num156 - 1, num156 + 1, num157 - 4, num157 - 1))
								{
									int num158 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), num156 * 16 - width / 2, num157 * 16, 387);
									Main.npc[num158].position.Y = num157 * 16 - Main.npc[num158].height;
									flag14 = true;
									netUpdate = true;
									break;
								}
							}
						}
					}
				}
				if (ai[2] == 60f)
				{
					ai[2] = -120f;
				}
			}
		}
		if (type == 389)
		{
			if (confused)
			{
				ai[2] = -60f;
			}
			else
			{
				if (ai[2] < 20f)
				{
					ai[2] += 1f;
				}
				if (justHit)
				{
					ai[2] = -30f;
				}
				if (ai[2] == 20f && Main.netMode != 1)
				{
					ai[2] = -10 + Main.rand.Next(3) * -10;
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y + 8f, direction * 6, 0f, 437, 25, 1f, Main.myPlayer);
				}
			}
		}
		if (type == 110 || type == 111 || type == 206 || type == 214 || type == 215 || type == 216 || type == 290 || type == 291 || type == 292 || type == 293 || type == 350 || type == 379 || type == 380 || type == 381 || type == 382 || (type >= 449 && type <= 452) || type == 468 || type == 481 || type == 411 || type == 409 || (type >= 498 && type <= 506) || type == 424 || type == 426 || type == 520)
		{
			bool flag16 = type == 381 || type == 382 || type == 520;
			bool flag17 = type == 426;
			bool flag18 = true;
			int num159 = -1;
			int num160 = -1;
			if (type == 411)
			{
				flag16 = true;
				num159 = 120;
				num160 = 120;
				if (ai[1] <= 220f)
				{
					flag18 = false;
				}
			}
			if (ai[1] > 0f)
			{
				ai[1] -= 1f;
			}
			bool flag19 = false;
			if (justHit)
			{
				flag19 = ai[2] > 0f;
				ai[1] = 30f;
				ai[2] = 0f;
				netUpdate = true;
			}
			int num161 = 70;
			if (type == 379 || type == 380)
			{
				num161 = 80;
			}
			if (type == 381 || type == 382)
			{
				num161 = 80;
			}
			if (type == 520)
			{
				num161 = 15;
			}
			if (type == 350)
			{
				num161 = 110;
			}
			if (type == 291)
			{
				num161 = 200;
			}
			if (type == 292)
			{
				num161 = 120;
			}
			if (type == 293)
			{
				num161 = 90;
			}
			if (type == 111)
			{
				num161 = 180;
			}
			if (type == 206)
			{
				num161 = 50;
			}
			if (type == 481)
			{
				num161 = 100;
			}
			if (type == 214)
			{
				num161 = 50;
			}
			if (type == 215)
			{
				num161 = 90;
			}
			if (type == 290)
			{
				num161 = 30;
			}
			if (type == 411)
			{
				num161 = 330;
			}
			if (type == 409)
			{
				num161 = 60;
			}
			if (type == 424)
			{
				num161 = 180;
			}
			if (type == 426)
			{
				num161 = 60;
			}
			bool flag20 = false;
			if (type == 216)
			{
				if (localAI[2] >= 20f)
				{
					flag20 = true;
					if (flag19)
					{
						localAI[3] += 1f;
					}
					int num162 = (int)localAI[3];
					num161 = Math.Max(60, 180 - num162 * 20);
				}
				else
				{
					num161 = 9;
				}
			}
			int num163 = num161 / 2;
			if (type == 424)
			{
				num163 = num161 - 1;
			}
			if (type == 426)
			{
				num163 = num161 - 1;
			}
			if (type == 411)
			{
				num163 = 220;
			}
			if (confused)
			{
				ai[2] = 0f;
			}
			if (ai[2] > 0f)
			{
				if (flag18)
				{
					TargetClosest();
				}
				if (ai[1] == (float)num163)
				{
					if (type == 216)
					{
						localAI[2] += 1f;
					}
					float num164 = 11f;
					if (type == 111)
					{
						num164 = 9f;
					}
					if (type == 206)
					{
						num164 = 7f;
					}
					if (type == 290)
					{
						num164 = 9f;
					}
					if (type == 293)
					{
						num164 = 4f;
					}
					if (type == 216)
					{
						num164 = 9f;
						if (flag20)
						{
							num164 = 15f;
						}
					}
					if (type == 214)
					{
						num164 = 10f;
					}
					if (type == 215)
					{
						num164 = 14f;
					}
					if (type == 382)
					{
						num164 = 7f;
					}
					if (type == 520)
					{
						num164 = 8f;
					}
					if (type == 409)
					{
						num164 = 4f;
					}
					if (type >= 449 && type <= 452)
					{
						num164 = 7f;
					}
					if (type == 481)
					{
						num164 = 8f;
					}
					if (type == 468)
					{
						num164 = 7.5f;
					}
					if (type == 411)
					{
						num164 = 1f;
					}
					if (type >= 498 && type <= 506)
					{
						num164 = 7f;
					}
					Vector2 chaserPosition2 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					if (type == 481)
					{
						chaserPosition2.Y -= 14f;
					}
					if (type == 206)
					{
						chaserPosition2.Y -= 10f;
					}
					if (type == 290)
					{
						chaserPosition2.Y -= 10f;
					}
					if (type == 381 || type == 382)
					{
						chaserPosition2.Y += 6f;
					}
					if (type == 520)
					{
						chaserPosition2.Y = position.Y + 20f;
					}
					if (type >= 498 && type <= 506)
					{
						chaserPosition2.Y -= 8f;
					}
					if (type == 426)
					{
						chaserPosition2 += new Vector2(spriteDirection * 2, -12f);
						num164 = 7f;
					}
					float num165 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - chaserPosition2.X;
					float num166 = Math.Abs(num165) * 0.1f;
					if (type == 291 || type == 292)
					{
						num166 = 0f;
					}
					if (type == 215)
					{
						num166 = Math.Abs(num165) * 0.08f;
					}
					if (type == 214 || (type == 216 && !flag20))
					{
						num166 = 0f;
					}
					_ = type == 216 && flag20;
					if (type == 381 || type == 382 || type == 520)
					{
						num166 = 0f;
					}
					if (type >= 449 && type <= 452)
					{
						num166 = Math.Abs(num165) * (float)Main.rand.Next(10, 50) * 0.01f;
					}
					if (type == 468)
					{
						num166 = Math.Abs(num165) * (float)Main.rand.Next(10, 50) * 0.01f;
					}
					if (type == 481)
					{
						num166 = Math.Abs(num165) * (float)Main.rand.Next(-10, 11) * 0.0035f;
					}
					if (type >= 498 && type <= 506)
					{
						num166 = Math.Abs(num165) * (float)Main.rand.Next(1, 11) * 0.0025f;
					}
					float num167 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - chaserPosition2.Y - num166;
					if (type == 291)
					{
						num165 += (float)Main.rand.Next(-40, 41) * 0.2f;
						num167 += (float)Main.rand.Next(-40, 41) * 0.2f;
					}
					else if (type == 381 || type == 382 || type == 520)
					{
						num165 += (float)Main.rand.Next(-100, 101) * 0.4f;
						num167 += (float)Main.rand.Next(-100, 101) * 0.4f;
						num165 *= (float)Main.rand.Next(85, 116) * 0.01f;
						num167 *= (float)Main.rand.Next(85, 116) * 0.01f;
						if (type == 520)
						{
							num165 += (float)Main.rand.Next(-100, 101) * 0.6f;
							num167 += (float)Main.rand.Next(-100, 101) * 0.6f;
							num165 *= (float)Main.rand.Next(85, 116) * 0.015f;
							num167 *= (float)Main.rand.Next(85, 116) * 0.015f;
						}
					}
					else if (type == 481)
					{
						num165 += (float)Main.rand.Next(-40, 41) * 0.4f;
						num167 += (float)Main.rand.Next(-40, 41) * 0.4f;
					}
					else if (type >= 498 && type <= 506)
					{
						num165 += (float)Main.rand.Next(-40, 41) * 0.3f;
						num167 += (float)Main.rand.Next(-40, 41) * 0.3f;
					}
					else if (type == 426)
					{
						num165 += (float)Main.rand.Next(-30, 31) * 0.3f;
						num167 += (float)Main.rand.Next(-30, 31) * 0.3f;
					}
					else if (type == 214)
					{
						num165 += (float)Main.rand.Next(-45, 46);
						num167 += (float)Main.rand.Next(-45, 46);
					}
					else if (type == 216)
					{
						if (!flag20)
						{
							num165 += (float)Main.rand.Next(-50, 51);
							num167 += (float)Main.rand.Next(-50, 51);
						}
					}
					else if (type != 292)
					{
						num165 += (float)Main.rand.Next(-40, 41);
						num167 += (float)Main.rand.Next(-40, 41);
					}
					float num168 = (float)Math.Sqrt(num165 * num165 + num167 * num167);
					netUpdate = true;
					num168 = num164 / num168;
					num165 *= num168;
					num167 *= num168;
					int num169 = 35;
					int num170 = 82;
					if (type == 111)
					{
						num169 = 11;
					}
					if (type == 206)
					{
						num169 = 37;
					}
					if (type == 379 || type == 380)
					{
						num169 = 40;
					}
					if (type == 350)
					{
						num169 = 45;
					}
					if (type == 468)
					{
						num169 = 50;
					}
					if (type == 111)
					{
						num170 = 81;
					}
					if (type == 379 || type == 380)
					{
						num170 = 81;
					}
					if (type == 381)
					{
						num170 = 436;
						num169 = 24;
					}
					if (type == 382)
					{
						num170 = 438;
						num169 = 30;
					}
					if (type == 520)
					{
						num170 = 592;
						num169 = 35;
					}
					if (type >= 449 && type <= 452)
					{
						num170 = 471;
						num169 = 15;
					}
					if (type >= 498 && type <= 506)
					{
						num170 = 572;
						num169 = 14;
					}
					if (type == 481)
					{
						num170 = 508;
						num169 = 18;
					}
					if (type == 206)
					{
						num170 = 177;
					}
					if (type == 468)
					{
						num170 = 501;
					}
					if (type == 411)
					{
						num170 = 537;
						num169 = GetAttackDamage_ForProjectiles(60f, 45f);
					}
					if (type == 424)
					{
						num170 = 573;
						num169 = GetAttackDamage_ForProjectiles(60f, 45f);
					}
					if (type == 426)
					{
						num170 = 581;
						num169 = GetAttackDamage_ForProjectiles(60f, 45f);
					}
					if (type == 291)
					{
						num170 = 302;
						num169 = 100;
					}
					if (type == 290)
					{
						num170 = 300;
						num169 = 60;
					}
					if (type == 293)
					{
						num170 = 303;
						num169 = 60;
					}
					if (type == 214)
					{
						num170 = 180;
						num169 = 25;
					}
					if (type == 215)
					{
						num170 = 82;
						num169 = 35;
					}
					if (type == 292)
					{
						num169 = 50;
						num170 = 180;
					}
					if (type == 216)
					{
						num170 = 180;
						num169 = 30;
						if (flag20)
						{
							num169 = 100;
							num170 = 240;
							localAI[2] = 0f;
							localAI[3] = 0f;
						}
					}
					Player player3 = Main.player[target];
					Vector2? vector35 = null;
					if (type == 426)
					{
						vector35 = Main.rand.NextVector2FromRectangle(player3.Hitbox);
					}
					if (vector35.HasValue)
					{
						Utils.ChaseResults chaseResults2 = Utils.GetChaseResults(chaserPosition2, num164, vector35.Value, player3.velocity);
						if (chaseResults2.InterceptionHappens)
						{
							Vector2 vector36 = Utils.FactorAcceleration(chaseResults2.ChaserVelocity, chaseResults2.InterceptionTime, new Vector2(0f, 0.1f), 15);
							num165 = vector36.X;
							num167 = vector36.Y;
						}
					}
					chaserPosition2.X += num165;
					chaserPosition2.Y += num167;
					if (type == 214)
					{
						chaserPosition2.X += num165 * 1.5f;
						chaserPosition2.Y += num167 * 1.5f;
					}
					if (type == 290)
					{
						num169 = GetAttackDamage_ForProjectiles(num169, (float)num169 * 0.75f);
					}
					if (type >= 381 && type <= 392)
					{
						num169 = GetAttackDamage_ForProjectiles(num169, (float)num169 * 0.8f);
					}
					if (Main.netMode != 1)
					{
						if (type == 292)
						{
							for (int num171 = 0; num171 < 4; num171++)
							{
								num165 = player3.position.X + (float)player3.width * 0.5f - chaserPosition2.X;
								num167 = player3.position.Y + (float)player3.height * 0.5f - chaserPosition2.Y;
								num168 = (float)Math.Sqrt(num165 * num165 + num167 * num167);
								num168 = 12f / num168;
								num165 = (num165 += (float)Main.rand.Next(-40, 41));
								num167 = (num167 += (float)Main.rand.Next(-40, 41));
								num165 *= num168;
								num167 *= num168;
								Projectile.NewProjectile(GetSpawnSource_ForProjectile(), chaserPosition2.X, chaserPosition2.Y, num165, num167, num170, num169, 0f, Main.myPlayer);
							}
						}
						else if (type == 411)
						{
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), chaserPosition2.X, chaserPosition2.Y, num165, num167, num170, num169, 0f, Main.myPlayer, 0f, whoAmI);
						}
						else if (type == 424)
						{
							for (int num172 = 0; num172 < 4; num172++)
							{
								Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X - (float)(spriteDirection * 4), base.Center.Y + 6f, (float)(-3 + 2 * num172) * 0.15f, (float)(-Main.rand.Next(0, 3)) * 0.2f - 0.1f, num170, num169, 0f, Main.myPlayer, 0f, whoAmI);
							}
						}
						else if (type == 409)
						{
							int num173 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y, 410, whoAmI);
							Main.npc[num173].velocity = new Vector2(num165, -6f + num167);
						}
						else
						{
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), chaserPosition2.X, chaserPosition2.Y, num165, num167, num170, num169, 0f, Main.myPlayer);
						}
					}
					if (Math.Abs(num167) > Math.Abs(num165) * 2f)
					{
						if (num167 > 0f)
						{
							ai[2] = 1f;
						}
						else
						{
							ai[2] = 5f;
						}
					}
					else if (Math.Abs(num165) > Math.Abs(num167) * 2f)
					{
						ai[2] = 3f;
					}
					else if (num167 > 0f)
					{
						ai[2] = 2f;
					}
					else
					{
						ai[2] = 4f;
					}
				}
				if ((velocity.Y != 0f && !flag17) || ai[1] <= 0f)
				{
					ai[2] = 0f;
					ai[1] = 0f;
				}
				else if (!flag16 || (num159 != -1 && ai[1] >= (float)num159 && ai[1] < (float)(num159 + num160) && (!flag17 || velocity.Y == 0f)))
				{
					velocity.X *= 0.9f;
					spriteDirection = direction;
				}
			}
			if (type == 468 && !Main.eclipse)
			{
				flag16 = true;
			}
			else if ((ai[2] <= 0f || flag16) && (velocity.Y == 0f || flag17) && ai[1] <= 0f && !Main.player[target].dead)
			{
				bool flag21 = Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height);
				if (type == 520)
				{
					flag21 = Collision.CanHitLine(base.Top + new Vector2(0f, 20f), 0, 0, Main.player[target].position, Main.player[target].width, Main.player[target].height);
				}
				if (Main.player[target].stealth == 0f && Main.player[target].itemAnimation == 0)
				{
					flag21 = false;
				}
				if (flag21)
				{
					float num174 = 10f;
					Vector2 vector37 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num175 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector37.X;
					float num176 = Math.Abs(num175) * 0.1f;
					float num177 = Main.player[target].position.Y + (float)Main.player[target].height * 0.5f - vector37.Y - num176;
					num175 += (float)Main.rand.Next(-40, 41);
					num177 += (float)Main.rand.Next(-40, 41);
					float num178 = (float)Math.Sqrt(num175 * num175 + num177 * num177);
					float num179 = 700f;
					if (type == 214)
					{
						num179 = 500f;
					}
					if (type == 215)
					{
						num179 = 650f;
					}
					if (type >= 498 && type <= 506)
					{
						num179 = 190f;
					}
					if (type >= 449 && type <= 452)
					{
						num179 = 200f;
					}
					if (type == 481)
					{
						num179 = 400f;
					}
					if (type == 468)
					{
						num179 = 400f;
					}
					if (num178 < num179)
					{
						netUpdate = true;
						velocity.X *= 0.5f;
						num178 = num174 / num178;
						num175 *= num178;
						num177 *= num178;
						ai[2] = 3f;
						ai[1] = num161;
						if (Math.Abs(num177) > Math.Abs(num175) * 2f)
						{
							if (num177 > 0f)
							{
								ai[2] = 1f;
							}
							else
							{
								ai[2] = 5f;
							}
						}
						else if (Math.Abs(num175) > Math.Abs(num177) * 2f)
						{
							ai[2] = 3f;
						}
						else if (num177 > 0f)
						{
							ai[2] = 2f;
						}
						else
						{
							ai[2] = 4f;
						}
					}
				}
			}
			if (ai[2] <= 0f || (flag16 && (num159 == -1 || !(ai[1] >= (float)num159) || !(ai[1] < (float)(num159 + num160)))))
			{
				float num180 = 1f;
				float num181 = 0.07f;
				float num182 = 0.8f;
				if (type == 214)
				{
					num180 = 2f;
					num181 = 0.09f;
				}
				else if (type == 215)
				{
					num180 = 1.5f;
					num181 = 0.08f;
				}
				else if (type == 381 || type == 382)
				{
					num180 = 2f;
					num181 = 0.5f;
				}
				else if (type == 520)
				{
					num180 = 4f;
					num181 = 1f;
					num182 = 0.7f;
				}
				else if (type == 411)
				{
					num180 = 2f;
					num181 = 0.5f;
				}
				else if (type == 409)
				{
					num180 = 2f;
					num181 = 0.5f;
				}
				else if (type == 426)
				{
					num180 = 4f;
					num181 = 0.6f;
					num182 = 0.95f;
				}
				bool flag22 = false;
				if ((type == 381 || type == 382) && Vector2.Distance(base.Center, Main.player[target].Center) < 300f && Collision.CanHitLine(base.Center, 0, 0, Main.player[target].Center, 0, 0))
				{
					flag22 = true;
					ai[3] = 0f;
				}
				if (type == 520 && Vector2.Distance(base.Center, Main.player[target].Center) < 400f && Collision.CanHitLine(base.Center, 0, 0, Main.player[target].Center, 0, 0))
				{
					flag22 = true;
					ai[3] = 0f;
				}
				if (velocity.X < 0f - num180 || velocity.X > num180 || flag22)
				{
					if (velocity.Y == 0f)
					{
						velocity *= num182;
					}
				}
				else if (velocity.X < num180 && direction == 1)
				{
					velocity.X += num181;
					if (velocity.X > num180)
					{
						velocity.X = num180;
					}
				}
				else if (velocity.X > 0f - num180 && direction == -1)
				{
					velocity.X -= num181;
					if (velocity.X < 0f - num180)
					{
						velocity.X = 0f - num180;
					}
				}
			}
			if (type == 520)
			{
				localAI[2] += 1f;
				if (localAI[2] >= 6f)
				{
					localAI[2] = 0f;
					localAI[3] = Main.player[target].DirectionFrom(base.Top + new Vector2(0f, 20f)).ToRotation();
				}
			}
		}
		if (type == 109 && Main.netMode != 1 && !Main.player[target].dead)
		{
			if (justHit)
			{
				ai[2] = 0f;
			}
			ai[2] += 1f;
			if (ai[2] > 60f)
			{
				Vector2 vector38 = new Vector2(position.X + (float)width * 0.5f - (float)(direction * 24), position.Y + 4f);
				if (Main.rand.Next(5) != 0 || AnyNPCs(378))
				{
					int num183 = Main.rand.Next(3, 8) * direction;
					int num184 = Main.rand.Next(-8, -5);
					int num185 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector38.X, vector38.Y, num183, num184, 75, 80, 0f, Main.myPlayer);
					Main.projectile[num185].timeLeft = 300;
					ai[2] = 0f;
				}
				else
				{
					ai[2] = -120f;
					int number = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)vector38.X, (int)vector38.Y, 378);
					NetMessage.SendData(23, -1, -1, null, number);
				}
			}
		}
		if (velocity.Y == 0f || flag)
		{
			int num186 = (int)(position.Y + (float)height + 7f) / 16;
			int num187 = (int)(position.Y - 9f) / 16;
			int num188 = (int)position.X / 16;
			int num189 = (int)(position.X + (float)width) / 16;
			int num190 = (int)(position.X + 8f) / 16;
			int num191 = (int)(position.X + (float)width - 8f) / 16;
			bool flag23 = false;
			for (int num192 = num190; num192 <= num191; num192++)
			{
				Tile tile = Main.tile[num192, num186];
				Tile tile2 = Main.tile[num192, num187];
				if (num192 >= num188 && num192 <= num189 && tile == null)
				{
					flag23 = true;
					continue;
				}
				if (tile2 != null && WorldGen.SolidTileNoPlatforms(num192, num187))
				{
					flag5 = false;
					break;
				}
				if (!flag23 && num192 >= num188 && num192 <= num189 && WorldGen.SolidTileAllowBottomSlope(num192, num186))
				{
					flag5 = true;
				}
			}
			if (!flag5 && velocity.Y < 0f)
			{
				velocity.Y = 0f;
			}
			if (flag23)
			{
				return;
			}
		}
		if (type == 428)
		{
			flag5 = false;
		}
		if (velocity.Y >= 0f && (type != 580 || directionY != 1))
		{
			int num193 = 0;
			if (velocity.X < 0f)
			{
				num193 = -1;
			}
			if (velocity.X > 0f)
			{
				num193 = 1;
			}
			Vector2 vector39 = position;
			vector39.X += velocity.X;
			int num194 = (int)((vector39.X + (float)(width / 2) + (float)((width / 2 + 1) * num193)) / 16f);
			int num195 = (int)((vector39.Y + (float)height - 1f) / 16f);
			if (WorldGen.InWorld(num194, num195, 4))
			{
				if (Main.tile[num194, num195] == null)
				{
					Main.tile[num194, num195] = new Tile();
				}
				if (Main.tile[num194, num195 - 1] == null)
				{
					Main.tile[num194, num195 - 1] = new Tile();
				}
				if (Main.tile[num194, num195 - 2] == null)
				{
					Main.tile[num194, num195 - 2] = new Tile();
				}
				if (Main.tile[num194, num195 - 3] == null)
				{
					Main.tile[num194, num195 - 3] = new Tile();
				}
				if (Main.tile[num194, num195 + 1] == null)
				{
					Main.tile[num194, num195 + 1] = new Tile();
				}
				if (Main.tile[num194 - num193, num195 - 3] == null)
				{
					Main.tile[num194 - num193, num195 - 3] = new Tile();
				}
				if ((float)(num194 * 16) < vector39.X + (float)width && (float)(num194 * 16 + 16) > vector39.X && ((Main.tile[num194, num195].nactive() && !Main.tile[num194, num195].topSlope() && !Main.tile[num194, num195 - 1].topSlope() && Main.tileSolid[Main.tile[num194, num195].type] && !Main.tileSolidTop[Main.tile[num194, num195].type]) || (Main.tile[num194, num195 - 1].halfBrick() && Main.tile[num194, num195 - 1].nactive())) && (!Main.tile[num194, num195 - 1].nactive() || !Main.tileSolid[Main.tile[num194, num195 - 1].type] || Main.tileSolidTop[Main.tile[num194, num195 - 1].type] || (Main.tile[num194, num195 - 1].halfBrick() && (!Main.tile[num194, num195 - 4].nactive() || !Main.tileSolid[Main.tile[num194, num195 - 4].type] || Main.tileSolidTop[Main.tile[num194, num195 - 4].type]))) && (!Main.tile[num194, num195 - 2].nactive() || !Main.tileSolid[Main.tile[num194, num195 - 2].type] || Main.tileSolidTop[Main.tile[num194, num195 - 2].type]) && (!Main.tile[num194, num195 - 3].nactive() || !Main.tileSolid[Main.tile[num194, num195 - 3].type] || Main.tileSolidTop[Main.tile[num194, num195 - 3].type]) && (!Main.tile[num194 - num193, num195 - 3].nactive() || !Main.tileSolid[Main.tile[num194 - num193, num195 - 3].type]))
				{
					float num196 = num195 * 16;
					if (Main.tile[num194, num195].halfBrick())
					{
						num196 += 8f;
					}
					if (Main.tile[num194, num195 - 1].halfBrick())
					{
						num196 -= 8f;
					}
					if (num196 < vector39.Y + (float)height)
					{
						float num197 = vector39.Y + (float)height - num196;
						float num198 = 16.1f;
						if (type == 163 || type == 164 || type == 236 || type == 239 || type == 530)
						{
							num198 += 8f;
						}
						if (num197 <= num198)
						{
							gfxOffY += position.Y + (float)height - num196;
							position.Y = num196 - (float)height;
							if (num197 < 9f)
							{
								stepSpeed = 1f;
							}
							else
							{
								stepSpeed = 2f;
							}
						}
					}
				}
			}
		}
		if (flag5)
		{
			int num199 = (int)((position.X + (float)(width / 2) + (float)(15 * direction)) / 16f);
			int num200 = (int)((position.Y + (float)height - 15f) / 16f);
			if (type == 109 || type == 163 || type == 164 || type == 199 || type == 236 || type == 239 || type == 257 || type == 258 || type == 290 || type == 391 || type == 425 || type == 427 || type == 426 || type == 580 || type == 508 || type == 415 || type == 530 || type == 532 || type == 582)
			{
				num199 = (int)((position.X + (float)(width / 2) + (float)((width / 2 + 16) * direction)) / 16f);
			}
			if (Main.tile[num199, num200] == null)
			{
				Main.tile[num199, num200] = new Tile();
			}
			if (Main.tile[num199, num200 - 1] == null)
			{
				Main.tile[num199, num200 - 1] = new Tile();
			}
			if (Main.tile[num199, num200 - 2] == null)
			{
				Main.tile[num199, num200 - 2] = new Tile();
			}
			if (Main.tile[num199, num200 - 3] == null)
			{
				Main.tile[num199, num200 - 3] = new Tile();
			}
			if (Main.tile[num199, num200 + 1] == null)
			{
				Main.tile[num199, num200 + 1] = new Tile();
			}
			if (Main.tile[num199 + direction, num200 - 1] == null)
			{
				Main.tile[num199 + direction, num200 - 1] = new Tile();
			}
			if (Main.tile[num199 + direction, num200 + 1] == null)
			{
				Main.tile[num199 + direction, num200 + 1] = new Tile();
			}
			if (Main.tile[num199 - direction, num200 + 1] == null)
			{
				Main.tile[num199 - direction, num200 + 1] = new Tile();
			}
			Main.tile[num199, num200 + 1].halfBrick();
			if (Main.tile[num199, num200 - 1].nactive() && (Main.tile[num199, num200 - 1].type == 10 || Main.tile[num199, num200 - 1].type == 388) && flag8)
			{
				ai[2] += 1f;
				ai[3] = 0f;
				if (ai[2] >= 60f)
				{
					bool flag24 = type == 3 || type == 691 || type == 430 || type == 590 || type == 331 || type == 332 || type == 132 || type == 161 || type == 186 || type == 187 || type == 188 || type == 189 || type == 200 || type == 223 || type == 320 || type == 321 || type == 319 || type == 21 || type == 324 || type == 323 || type == 322 || type == 44 || type == 196 || type == 167 || type == 77 || type == 197 || type == 202 || type == 203 || type == 449 || type == 450 || type == 451 || type == 452 || type == 481 || type == 201 || type == 635;
					bool flag25 = Main.player[target].ZoneGraveyard && Main.rand.Next(60) == 0;
					bool flag26 = false;
					if (target >= 0)
					{
						Player player4 = Main.player[target];
						if (!player4.dead && !player4.ghost && player4.insideUnbreakableWalls)
						{
							flag26 = true;
						}
					}
					bool flag27 = (!Main.bloodMoon || Main.getGoodWorld) && !flag25 && flag24;
					if (flag26)
					{
						flag27 = false;
					}
					if (flag27)
					{
						ai[1] = 0f;
					}
					velocity.X = 0.5f * (float)(-direction);
					int num201 = 5;
					if (Main.tile[num199, num200 - 1].type == 388)
					{
						num201 = 2;
					}
					ai[1] += num201;
					if (flag26)
					{
						ai[1] += 6f;
					}
					else if (type == 27)
					{
						ai[1] += 1f;
					}
					else if (type == 31 || type == 294 || type == 295 || type == 296)
					{
						ai[1] += 6f;
					}
					ai[2] = 0f;
					bool flag28 = false;
					if (ai[1] >= 10f)
					{
						flag28 = true;
						ai[1] = 10f;
					}
					if (type == 460)
					{
						flag28 = true;
					}
					WorldGen.KillTile(num199, num200 - 1, fail: true);
					if ((Main.netMode != 1 || !flag28) && flag28 && Main.netMode != 1)
					{
						if (type == 26)
						{
							WorldGen.KillTile(num199, num200 - 1);
							if (Main.netMode == 2)
							{
								NetMessage.SendData(17, -1, -1, null, 0, num199, num200 - 1);
							}
						}
						else
						{
							if (Main.tile[num199, num200 - 1].type == 10)
							{
								bool flag29 = WorldGen.OpenDoor(num199, num200 - 1, direction);
								if (!flag29)
								{
									ai[3] = num58;
									netUpdate = true;
								}
								if (Main.netMode == 2 && flag29)
								{
									NetMessage.SendData(19, -1, -1, null, 0, num199, num200 - 1, direction);
								}
							}
							if (Main.tile[num199, num200 - 1].type == 388)
							{
								bool flag30 = WorldGen.ShiftTallGate(num199, num200 - 1, closing: false);
								if (!flag30)
								{
									ai[3] = num58;
									netUpdate = true;
								}
								if (Main.netMode == 2 && flag30)
								{
									NetMessage.SendData(19, -1, -1, null, 4, num199, num200 - 1);
								}
							}
						}
					}
				}
			}
			else
			{
				int num202 = spriteDirection;
				if (type == 425)
				{
					num202 *= -1;
				}
				if ((velocity.X < 0f && num202 == -1) || (velocity.X > 0f && num202 == 1))
				{
					if (height >= 32 && WorldGen.SolidTileNoPlatforms(num199, num200 - 2))
					{
						if (WorldGen.SolidTileNoPlatforms(num199, num200 - 3))
						{
							velocity.Y = -8f;
							netUpdate = true;
						}
						else
						{
							velocity.Y = -7f;
							netUpdate = true;
						}
					}
					else if (WorldGen.SolidTileNoPlatforms(num199, num200 - 1))
					{
						if (type == 624)
						{
							velocity.Y = -8f;
							int num203 = (int)(position.Y + (float)height) / 16;
							if (WorldGen.SolidTile((int)base.Center.X / 16, num203 - 8))
							{
								direction *= -1;
								spriteDirection = direction;
								velocity.X = 3 * direction;
							}
						}
						else
						{
							velocity.Y = -6f;
						}
						netUpdate = true;
					}
					else if (position.Y + (float)height - (float)(num200 * 16) > 20f && !Main.tile[num199, num200].topSlope() && WorldGen.SolidTileNoPlatforms(num199, num200))
					{
						velocity.Y = -5f;
						netUpdate = true;
					}
					else if (directionY < 0 && type != 67 && !WorldGen.SolidTileAllowBottomSlope(num199, num200 + 1) && !WorldGen.SolidTileAllowBottomSlope(num199 + direction, num200 + 1))
					{
						velocity.Y = -8f;
						velocity.X *= 1.5f;
						netUpdate = true;
					}
					else if (flag8)
					{
						ai[1] = 0f;
						ai[2] = 0f;
					}
					if (velocity.Y == 0f && flag6 && ai[3] == 1f)
					{
						velocity.Y = -5f;
					}
					if (velocity.Y == 0f && (Main.expertMode || type == 586) && Main.player[target].Bottom.Y < base.Top.Y && Math.Abs(base.Center.X - Main.player[target].Center.X) < (float)(Main.player[target].width * 3) && Collision.CanHit(this, Main.player[target]))
					{
						if (type == 586)
						{
							int num204 = (int)((base.Bottom.Y - 16f - Main.player[target].Bottom.Y) / 16f);
							if (num204 < 14 && Collision.CanHit(this, Main.player[target]))
							{
								if (num204 < 7)
								{
									velocity.Y = -8.8f;
								}
								else if (num204 < 8)
								{
									velocity.Y = -9.2f;
								}
								else if (num204 < 9)
								{
									velocity.Y = -9.7f;
								}
								else if (num204 < 10)
								{
									velocity.Y = -10.3f;
								}
								else if (num204 < 11)
								{
									velocity.Y = -10.6f;
								}
								else
								{
									velocity.Y = -11f;
								}
							}
						}
						if (velocity.Y == 0f)
						{
							int num205 = 6;
							if (Main.player[target].Bottom.Y > base.Top.Y - (float)(num205 * 16))
							{
								velocity.Y = -7.9f;
							}
							else
							{
								int num206 = (int)(base.Center.X / 16f);
								int num207 = (int)(base.Bottom.Y / 16f) - 1;
								for (int num208 = num207; num208 > num207 - num205; num208--)
								{
									if (Main.tile[num206, num208] != null && Main.tile[num206, num208].nactive() && TileID.Sets.Platforms[Main.tile[num206, num208].type])
									{
										velocity.Y = -7.9f;
										break;
									}
								}
							}
						}
					}
				}
				if ((type == 31 || type == 294 || type == 295 || type == 296 || type == 47 || type == 77 || type == 104 || type == 168 || type == 196 || type == 385 || type == 389 || type == 464 || type == 470 || (type >= 524 && type <= 527)) && velocity.Y == 0f)
				{
					int num209 = 100;
					int num210 = 50;
					if (type == 586)
					{
						num209 = 150;
						num210 = 150;
					}
					if (Math.Abs(position.X + (float)(width / 2) - (Main.player[target].position.X + (float)(Main.player[target].width / 2))) < (float)num209 && Math.Abs(position.Y + (float)(height / 2) - (Main.player[target].position.Y + (float)(Main.player[target].height / 2))) < (float)num210 && ((direction > 0 && velocity.X >= 1f) || (direction < 0 && velocity.X <= -1f)))
					{
						if (type == 586)
						{
							velocity.X += direction;
							velocity.X *= 2f;
							if (velocity.X > 8f)
							{
								velocity.X = 8f;
							}
							if (velocity.X < -8f)
							{
								velocity.X = -8f;
							}
							velocity.Y = -4.5f;
							if (position.Y > Main.player[target].position.Y + 40f)
							{
								velocity.Y -= 2f;
							}
							if (position.Y > Main.player[target].position.Y + 80f)
							{
								velocity.Y -= 2f;
							}
							if (position.Y > Main.player[target].position.Y + 120f)
							{
								velocity.Y -= 2f;
							}
						}
						else
						{
							velocity.X *= 2f;
							if (velocity.X > 3f)
							{
								velocity.X = 3f;
							}
							if (velocity.X < -3f)
							{
								velocity.X = -3f;
							}
							velocity.Y = -4f;
						}
						netUpdate = true;
					}
				}
				if (type == 120 && velocity.Y < 0f)
				{
					velocity.Y *= 1.1f;
				}
				if (type == 287 && velocity.Y == 0f && Math.Abs(position.X + (float)(width / 2) - (Main.player[target].position.X + (float)(Main.player[target].width / 2))) < 150f && Math.Abs(position.Y + (float)(height / 2) - (Main.player[target].position.Y + (float)(Main.player[target].height / 2))) < 50f && ((direction > 0 && velocity.X >= 1f) || (direction < 0 && velocity.X <= -1f)))
				{
					velocity.X = 8 * direction;
					velocity.Y = -4f;
					netUpdate = true;
				}
				if (type == 287 && velocity.Y < 0f)
				{
					velocity.X *= 1.2f;
					velocity.Y *= 1.1f;
				}
				if (type == 460 && velocity.Y < 0f)
				{
					velocity.X *= 1.3f;
					velocity.Y *= 1.1f;
				}
			}
		}
		else if (flag8)
		{
			ai[1] = 0f;
			ai[2] = 0f;
		}
		if (Main.netMode != 1 && type == 120 && ai[3] >= (float)num58)
		{
			int targetTileX = (int)Main.player[target].Center.X / 16;
			int targetTileY = (int)Main.player[target].Center.Y / 16;
			Vector2 chosenTile = Vector2.Zero;
			if (AI_AttemptToFindTeleportSpot(ref chosenTile, targetTileX, targetTileY, 20, 9))
			{
				position.X = chosenTile.X * 16f - (float)(width / 2);
				position.Y = chosenTile.Y * 16f - (float)height;
				ai[3] = -120f;
				netUpdate = true;
			}
		}
	}

	public static bool DespawnEncouragement_AIStyle3_Fighters_NotDiscouraged(int npcID, Vector2 position, NPC npcInstance)
	{
		if (!Main.eclipse && Main.IsItDay() && (npcInstance == null || !npcInstance.SpawnedFromStatue) && !((double)position.Y > Main.worldSurface * 16.0) && (npcInstance == null || !Main.player[npcInstance.target].ZoneGraveyard) && (!Main.snowMoon || (npcID != 343 && npcID != 350)) && (Main.invasionType != 1 || (npcID != 26 && npcID != 27 && npcID != 28 && npcID != 111 && npcID != 471)) && (!Main.dontStarveWorld || (npcID != 164 && npcID != 163)) && npcID != 73 && npcID != 624 && (npcID != 631 || !(npcInstance.ai[2] > 0f)) && (Main.invasionType != 3 || npcID < 212 || npcID > 216) && (Main.invasionType != 4 || (npcID != 381 && npcID != 382 && npcID != 383 && npcID != 385 && npcID != 386 && npcID != 389 && npcID != 391 && npcID != 520)) && npcID != 31 && npcID != 294 && npcID != 295 && npcID != 296 && npcID != 47 && npcID != 67 && npcID != 77 && npcID != 78 && npcID != 79 && npcID != 80 && npcID != 630 && npcID != 110 && npcID != 120 && npcID != 168 && npcID != 181 && npcID != 185 && npcID != 198 && npcID != 199 && npcID != 206 && npcID != 217 && npcID != 218 && npcID != 219 && npcID != 220 && npcID != 239 && npcID != 243 && npcID != 254 && npcID != 255 && npcID != 257 && npcID != 258 && npcID != 291 && npcID != 292 && npcID != 293 && npcID != 379 && npcID != 380 && npcID != 464 && npcID != 470 && npcID != 424 && (npcID != 411 || (npcInstance != null && !(npcInstance.ai[1] >= 180f) && !(npcInstance.ai[1] < 90f))))
		{
			switch (npcID)
			{
			default:
				if (npcID != 528 && npcID != 529 && npcID != 530 && npcID != 532)
				{
					return NPCID.Sets.CritterThatCanTurnOnPlayers[npcID];
				}
				break;
			case 409:
			case 415:
			case 419:
			case 425:
			case 427:
			case 428:
			case 429:
			case 508:
			case 524:
			case 525:
			case 526:
			case 527:
			case 580:
			case 582:
				break;
			}
		}
		return true;
	}

	public static bool DespawnEncouragement_AIStyle3_Fighters_CanBeBusyWithAction(int npcID)
	{
		if (npcID != 110 && npcID != 111 && npcID != 206 && npcID != 216 && npcID != 214 && npcID != 215 && npcID != 291 && npcID != 292 && npcID != 293 && npcID != 350 && npcID != 381 && npcID != 382 && npcID != 383 && npcID != 385 && npcID != 386 && npcID != 389 && npcID != 391 && npcID != 469 && npcID != 166 && npcID != 466 && npcID != 471 && npcID != 411 && npcID != 409 && npcID != 424 && npcID != 425 && npcID != 426 && npcID != 415 && npcID != 419)
		{
			return npcID == 520;
		}
		return true;
	}

	private void AI_001_Slimes()
	{
		if (type == 1 && ai[1] == 75f)
		{
			float num = 0.3f;
			Lighting.AddLight((int)(base.Center.X / 16f), (int)(base.Center.Y / 16f), 0.8f * num, 0.7f * num, 0.1f * num);
			if (Main.rand.Next(12) == 0)
			{
				Dust dust = Dust.NewDustPerfect(base.Center + new Vector2(0f, (float)height * 0.2f) + Main.rand.NextVector2CircularEdge(width, (float)height * 0.6f) * (0.3f + Main.rand.NextFloat() * 0.5f), 228, new Vector2(0f, (0f - Main.rand.NextFloat()) * 0.3f - 1.5f), 127);
				dust.scale = 0.5f;
				dust.fadeIn = 1.1f;
				dust.noGravity = true;
				dust.noLight = true;
			}
		}
		if (NPCID.Sets.SlimeCanContainItems[type] && ai[1] == 0f && Main.netMode != 1 && value > 0f)
		{
			ai[1] = -1f;
			int maxValue = 20;
			int maxValue2 = 40;
			int num2 = 1;
			if (WorldGen.Skyblock.lowTiles)
			{
				maxValue2 = 20;
				num2 += 4;
				maxValue = 15;
				if (netID == -6)
				{
					num2 += 5;
				}
			}
			else if (netID == -6)
			{
				num2 += 4;
			}
			if (Main.slimeRain)
			{
				num2 += 2;
			}
			for (int i = 0; i < num2; i++)
			{
				if (ai[1] != -1f)
				{
					break;
				}
				if (type == 59)
				{
					if (Main.remixWorld && Main.rand.Next(maxValue) == 0)
					{
						int num3 = AI_001_Slimes_GenerateItemInsideBody(ai[0] == -999f);
						ai[1] = num3;
					}
					else if (WorldGen.Skyblock.noHellstone && downedBoss3 && Main.rand.Next(15) == 0)
					{
						ai[1] = 174f;
					}
				}
				else if ((double)(position.Y / 16f) > Main.worldSurface && (type == 147 || type == 184))
				{
					if (WorldGen.Skyblock.lowTiles)
					{
						if (Main.rand.Next(maxValue2) == 0)
						{
							if (Main.rand.Next(2) == 0)
							{
								ai[1] = 1103f;
							}
							else
							{
								ai[1] = 593f;
							}
						}
					}
					else if (Main.rand.Next(maxValue2) == 0)
					{
						if (Main.rand.Next(2) == 0)
						{
							ai[1] = 1103f;
						}
						else
						{
							ai[1] = 593f;
						}
					}
				}
				else if (type == 537)
				{
					if (WorldGen.Skyblock.noFossils && Main.rand.Next(5) == 0)
					{
						ai[1] = 3347f;
					}
				}
				else
				{
					if (type != 1 || netID == -5 || netID == -4)
					{
						continue;
					}
					int num4 = 500;
					if (Main.noTrapsWorld)
					{
						num4 = 20;
					}
					else if (Main.getGoodWorld)
					{
						num4 = 100;
					}
					else if ((double)base.Center.Y < Main.worldSurface * 16.0)
					{
						num4 = -1;
					}
					if (WorldGen.isThisInTheRockLayer((int)(position.Y / 16f)) && (WorldGen.Skyblock.noLifeCrystals || WorldGen.Skyblock.lowTiles) && !AnyLifeCrystalSlimes() && Main.rand.Next(200) == 0)
					{
						ai[1] = 29f;
					}
					else if (WorldGen.Skyblock.lowTiles && (double)(position.Y / 16f) > Main.worldSurface && Main.rand.Next(1000) == 0)
					{
						ai[1] = Item.GetRandomVoiceItem();
					}
					else if (BirthdayParty.GenuineParty && (double)base.Center.Y < Main.worldSurface * 16.0)
					{
						if (Main.rand.Next(2) == 0)
						{
							ai[1] = Main.rand.Next(3736, 3739);
						}
						else
						{
							ai[1] = 1345f;
						}
					}
					else if (netID == -10 && Main.rand.Next(20) == 0)
					{
						int num5 = ((!Main.notTheBeesWorld) ? Main.rand.Next(3) : Main.rand.Next(4));
						ai[1] = num5 switch
						{
							1 => 1125, 
							2 => 314, 
							3 => 5395, 
							_ => 1124, 
						};
					}
					else if (Main.rand.Next(maxValue) == 0)
					{
						int num6 = AI_001_Slimes_GenerateItemInsideBody(ai[0] == -999f);
						ai[1] = num6;
					}
					else if (Main.rand.Next(maxValue2) == 0)
					{
						if ((double)(position.Y / 16f) <= Main.worldSurface)
						{
							if (WorldGen.Skyblock.lowTiles && (Main.moonPhase == 0 || Main.rand.Next(2) == 0))
							{
								if (Main.rand.Next(2) == 0)
								{
									if (Main.rand.Next(50) == 0)
									{
										ai[1] = 194f;
									}
									else if (Main.rand.Next(10) == 0)
									{
										ai[1] = 195f;
									}
									else
									{
										ai[1] = 62f;
									}
								}
								else
								{
									ai[1] = 27f;
								}
							}
							else
							{
								ai[1] = 751f;
							}
						}
						else if (!WorldGen.isThisInTheRockLayer((int)(position.Y / 16f)))
						{
							int num7 = Main.rand.Next(3) switch
							{
								1 => 3, 
								2 => 9, 
								_ => 2, 
							};
							ai[1] = num7;
						}
						else if (Main.rand.Next(10) == 0)
						{
							ai[1] = 3609f;
						}
						else if (WorldGen.Skyblock.lowTiles && Main.hardMode && Main.rand.Next(2) == 0)
						{
							int num8 = Main.rand.Next(6) switch
							{
								1 => 1104, 
								2 => 365, 
								3 => 1105, 
								4 => 366, 
								5 => 1106, 
								_ => 364, 
							};
							ai[1] = num8;
						}
						else
						{
							int num9 = Main.rand.Next(4) switch
							{
								1 => 150, 
								2 => 3086, 
								3 => 3081, 
								_ => 3, 
							};
							ai[1] = num9;
						}
					}
					else if (num4 > 0 && Main.rand.Next(num4) == 0)
					{
						ai[1] = 539f;
					}
					else if (Main.getGoodWorld && (double)(position.Y / 16f) > Main.worldSurface && Main.rand.Next(num4) == 0)
					{
						ai[1] = 147f;
					}
					else if (i == 0 && Main.remixWorld && ai[0] != -999f && Main.rand.Next(3) == 0)
					{
						ai[1] = 75f;
					}
					else if (Main.vampireSeed && !Main.remixWorld && Main.rand.Next(13) == 0 && (double)(position.Y / 16f) > Main.worldSurface)
					{
						ai[1] = 9f;
					}
				}
			}
			netUpdate = true;
		}
		if (type == 1)
		{
			bool flag = false;
			for (int j = (int)(base.Left.X / 16f); (float)j <= base.Right.X / 16f; j++)
			{
				int num10 = (int)((base.Bottom.Y + 1f) / 16f);
				if (WorldGen.SolidTile3(j, num10) && Main.tile[j, num10].color() > 0 && Main.tile[j, num10].color() != 30)
				{
					Color color = WorldGen.paintColor(Main.tile[j, num10].color());
					this.color = new Color((this.color.R * 19 + color.R) / 20, (this.color.G * 19 + color.G) / 20, (this.color.B * 19 + color.B) / 20, (this.color.A * 19 + 100) / 20);
					flag = true;
				}
			}
			if (ai[1] > 0f && !flag)
			{
				if (ai[1] == 751f)
				{
					this.color = new Color((this.color.R * 19 + 185) / 20, (this.color.G * 19 + 235) / 20, (this.color.B * 19 + 255) / 20, (this.color.A * 19 + 100) / 20);
				}
				else if (ai[1] == 2f)
				{
					this.color = new Color((this.color.R * 19 + 169) / 20, (this.color.G * 19 + 125) / 20, (this.color.B * 19 + 93) / 20, (this.color.A * 19 + 150) / 20);
				}
				else if (ai[1] == 3f)
				{
					this.color = new Color((this.color.R * 19 + 128) / 20, (this.color.G * 19 + 128) / 20, (this.color.B * 19 + 128) / 20, (this.color.A * 19 + 150) / 20);
				}
				else if (ai[1] == 9f)
				{
					this.color = new Color((this.color.R * 19 + 229) / 20, (this.color.G * 19 + 149) / 20, (this.color.B * 19 + 93) / 20, (this.color.A * 19 + 150) / 20);
				}
				else if (ai[1] == 150f)
				{
					this.color = new Color((this.color.R * 19 + 193) / 20, (this.color.G * 19 + 202) / 20, (this.color.B * 19 + 203) / 20, (this.color.A * 19 + 100) / 20);
				}
				else if (ai[1] == 3086f)
				{
					this.color = new Color((this.color.R * 19 + 59) / 20, (this.color.G * 19 + 28) / 20, (this.color.B * 19 + 136) / 20, (this.color.A * 19 + 150) / 20);
				}
				else if (ai[1] == 3081f)
				{
					this.color = new Color((this.color.R * 19 + 138) / 20, (this.color.G * 19 + 145) / 20, (this.color.B * 19 + 170) / 20, (this.color.A * 19 + 150) / 20);
				}
				else if (ai[1] == 147f)
				{
					this.color = new Color((this.color.R * 19 + 189) / 20, (this.color.G * 19 + 159) / 20, (this.color.B * 19 + 139) / 20, (this.color.A * 19 + 150) / 20);
				}
				else if (ai[1] == 29f)
				{
					this.color = new Color((this.color.R * 19 + 220) / 20, (this.color.G * 19 + 36) / 20, (this.color.B * 19 + 117) / 20, (this.color.A * 19 + 125) / 20);
				}
				else if (ai[1] == 3609f)
				{
					this.color = new Color((this.color.R * 19 + 232) / 20, (this.color.G * 19 + 172) / 20, (this.color.B * 19 + 162) / 20, (this.color.A * 19 + 150) / 20);
				}
				else if (ai[1] == 3736f)
				{
					this.color = new Color((this.color.R * 19 + 255) / 20, (this.color.G * 19 + 66) / 20, (this.color.B * 19 + 152) / 20, (this.color.A * 19 + 125) / 20);
				}
				else if (ai[1] == 3737f)
				{
					this.color = new Color((this.color.R * 19 + 179) / 20, (this.color.G * 19 + 132) / 20, (this.color.B * 19 + 255) / 20, (this.color.A * 19 + 125) / 20);
				}
				else if (ai[1] == 3738f)
				{
					this.color = new Color(this.color.R * 19 / 20, (this.color.G * 19 + 206) / 20, (this.color.B * 19 + 180) / 20, (this.color.A * 19 + 125) / 20);
				}
				else if (ai[1] == 1345f)
				{
					this.color = new Color((this.color.R * 19 + 200) / 20, (this.color.G * 19 + 200) / 20, (this.color.B * 19 + 200) / 20, (this.color.A * 19 + 50) / 20);
				}
				else if (ai[1] == 5395f)
				{
					this.color = new Color((this.color.R * 19 + 198) / 20, (this.color.G * 19 + 72) / 20, (this.color.B * 19 + 12) / 20, (this.color.A * 19 + 150) / 20);
				}
				else if (ai[1] == 1124f)
				{
					this.color = new Color((this.color.R * 19 + 255) / 20, (this.color.G * 19 + 158) / 20, (this.color.B * 19 + 49) / 20, (this.color.A * 19 + 150) / 20);
				}
				else if (ai[1] == 1125f)
				{
					this.color = new Color((this.color.R * 19 + 255) / 20, (this.color.G * 19 + 156) / 20, (this.color.B * 19 + 12) / 20, (this.color.A * 19 + 150) / 20);
				}
				else if (ai[1] == 314f)
				{
					this.color = new Color((this.color.R * 19 + 79) / 20, (this.color.G * 19 + 163) / 20, (this.color.B * 19 + 241) / 20, (this.color.A * 19 + 75) / 20);
				}
				else if (ai[1] == 364f)
				{
					this.color = new Color((this.color.R * 19 + 37) / 20, (this.color.G * 19 + 118) / 20, (this.color.B * 19 + 172) / 20, (this.color.A * 19 + 100) / 20);
				}
				else if (ai[1] == 1104f)
				{
					this.color = new Color((this.color.R * 19 + 227) / 20, (this.color.G * 19 + 52) / 20, (this.color.B * 19 + 14) / 20, (this.color.A * 19 + 100) / 20);
				}
				else if (ai[1] == 365f)
				{
					this.color = new Color((this.color.R * 19 + 22) / 20, (this.color.G * 19 + 119) / 20, (this.color.B * 19 + 125) / 20, (this.color.A * 19 + 100) / 20);
				}
				else if (ai[1] == 1105f)
				{
					this.color = new Color((this.color.R * 19 + 205) / 20, (this.color.G * 19 + 30) / 20, (this.color.B * 19 + 199) / 20, (this.color.A * 19 + 100) / 20);
				}
				else if (ai[1] == 366f)
				{
					this.color = new Color((this.color.R * 19 + 173) / 20, (this.color.G * 19 + 15) / 20, (this.color.B * 19 + 13) / 20, (this.color.A * 19 + 100) / 20);
				}
				else if (ai[1] == 1106f)
				{
					this.color = new Color((this.color.R * 19 + 91) / 20, (this.color.G * 19 + 90) / 20, (this.color.B * 19 + 119) / 20, (this.color.A * 19 + 100) / 20);
				}
				else if (ai[1] == 8f && Main.getGoodWorld)
				{
					this.color = new Color((this.color.R * 19 + 253) / 20, (this.color.G * 19 + 62) / 20, (this.color.B * 19 + 3) / 20, (this.color.A * 19 + 100) / 20);
				}
			}
		}
		bool flag2 = false;
		if (NPCID.Sets.SlimeCanContainItems[type] && ai[1] > 0f)
		{
			if (ai[1] == 539f && Main.netMode != 1)
			{
				int num11 = 300;
				if (Main.noTrapsWorld)
				{
					num11 -= 120;
				}
				if (Main.getGoodWorld)
				{
					num11 -= 120;
				}
				if (Main.rand.Next(num11) == 0 && target >= 0 && Main.player[target].active && !Main.player[target].dead && !Main.player[target].npcTypeNoAggro[type] && Collision.CanHit(this, Main.player[target]))
				{
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), (int)base.Center.X, base.Center.Y, direction * 12, 0f, 1073, 20, 2f, Main.myPlayer);
				}
			}
			else if (ai[1] == 364f || ai[1] == 1104f || ai[1] == 365f || ai[1] == 1105f || ai[1] == 366f || ai[1] == 1106f)
			{
				lavaImmune = true;
				defense = defDefense + 30;
				damage = defDamage * 3;
				buffImmune[70] = false;
				buffImmune[20] = false;
				knockBackResist = 0f;
				if (lifeMax == defLifeMax)
				{
					position.X += width / 2;
					position.Y += height;
					scale *= 1.2f;
					width = (int)((float)width * scale);
					height = (int)((float)height * scale);
					position.X -= width / 2;
					position.Y -= height;
					if (life == lifeMax)
					{
						life = defLifeMax * 3;
					}
					lifeMax = defLifeMax * 3;
				}
				if (base.Bottom.Y < Main.player[target].Top.Y && base.Right.X >= Main.player[target].Left.X && base.Left.X <= Main.player[target].Right.X && Collision.CanHitWithCheck(this, Main.player[target], DelegateMethods.NotSolidOrPlatforms))
				{
					flag2 = true;
					direction = 0;
					velocity.X *= 0.5f;
					if (velocity.Y < 0f)
					{
						velocity.Y = 0f;
					}
					velocity.Y += gravity;
				}
				else
				{
					if (velocity.Y > 0f)
					{
						velocity.Y += gravity;
					}
					if (velocity.Y < 0f)
					{
						velocity.Y -= gravity * 0.75f;
					}
				}
				Lighting.AddLight(position, (float)(int)this.color.R / 500f, (float)(int)this.color.G / 500f, (float)(int)this.color.B / 500f);
				extraValue = 0;
				if (ai[1] == 364f)
				{
					_givenName = Language.GetTextValue("SpecialNPCName.CobaltSlime");
				}
				else if (ai[1] == 1104f)
				{
					_givenName = Language.GetTextValue("SpecialNPCName.PalladiumSlime");
				}
				else if (ai[1] == 365f)
				{
					_givenName = Language.GetTextValue("SpecialNPCName.MythrilSlime");
				}
				else if (ai[1] == 1105f)
				{
					_givenName = Language.GetTextValue("SpecialNPCName.OrichalcumSlime");
				}
				else if (ai[1] == 366f)
				{
					_givenName = Language.GetTextValue("SpecialNPCName.AdamantiteSlime");
				}
				else if (ai[1] == 1106f)
				{
					_givenName = Language.GetTextValue("SpecialNPCName.TitaniumSlime");
				}
			}
			else if (ai[1] == 2f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.DirtSlime");
				if (velocity.Y == 0f)
				{
					ai[0] += 9f;
				}
			}
			else if (ai[1] == 9f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.WoodSlime");
				defense = defDefense + 16;
			}
			else if (ai[1] == 3f && velocity.Y != 0f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.StoneSlime");
				if (velocity.Y > 0f)
				{
					velocity.Y += gravity * 2f;
				}
			}
			else if (ai[1] == 751f && velocity.Y != 0f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.CloudSlime");
				velocity.Y -= gravity * 0.6f;
			}
			else if (ai[1] == 150f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.WebSlime");
				if (Main.netMode != 1 && Main.rand.Next(120) == 0)
				{
					int num12 = Main.rand.Next((int)(base.Left.X / 16f), (int)(base.Right.X / 16f) + 1);
					int num13 = Main.rand.Next((int)(base.Top.Y / 16f), (int)(base.Bottom.Y / 16f) + 1);
					if (!Main.tile[num12, num13].active())
					{
						WorldGen.PlaceTile(num12, num13, 51, mute: true);
						if (Main.netMode == 2)
						{
							NetMessage.SendTileSquare(-1, num12, num13);
						}
					}
				}
			}
			else if (ai[1] == 3086f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.GraniteSlime");
				defense = defDefense + 16;
				knockBackResist = 0f;
			}
			else if (ai[1] == 3081f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.MarbleSlime");
				defense = defDefense + 16;
				knockBackResist = 0f;
			}
			else if (ai[1] == 147f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.SpikeSlime");
				damage = defDamage * 2;
			}
			else if (ai[1] == 8f && Main.getGoodWorld)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.TorchSlime");
				AddBuff(24, 216000);
				buffImmune[323] = true;
				buffImmune[44] = true;
				buffImmune[324] = true;
				buffImmune[39] = true;
			}
			else if (ai[1] == 5395f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.PooSlime");
				if (Main.rand.Next(30) == 0)
				{
					Vector2 vector = Main.rand.NextVector2FromRectangle(base.Hitbox);
					ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.PooFly, new ParticleOrchestraSettings
					{
						PositionInWorld = vector + velocity * -1f
					});
				}
			}
			else if (ai[1] == 1124f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.HiveSlime");
				if (Main.netMode != 1 && Main.rand.Next(60) == 7 && target >= 0 && Collision.CanHit(this, Main.player[target]))
				{
					int num14 = Main.rand.Next(210, 212);
					int num15 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y, num14);
					Main.npc[num15].CanBeReplacedByOtherNPCs = true;
					Main.npc[num15].velocity *= 0f;
					Main.npc[num15].velocity.Y = -1f;
					Main.npc[num15].velocity.X = (float)Main.rand.Next(-20, 21) * 0.1f;
					Main.npc[num15].velocity.Normalize();
					Main.npc[num15].velocity *= 3f;
					Main.npc[num15].localAI[0] = 60f;
					Main.npc[num15].ai[1] = 60f;
					Main.npc[num15].netUpdate = true;
				}
			}
			else if (ai[1] == 1125f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.HoneySlime");
			}
			else if (ai[1] == 314f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.HerbSlime");
				if (Main.rand.Next(60) == 0)
				{
					Dust.NewDust(position, width, height, 41, 0f, 0f, 250, default(Color), 0.8f);
				}
				Lighting.AddLight((int)(base.Center.X / 16f), (int)(base.Center.Y / 16f), 0.4f, 0.9f, 1f);
				if (Main.netMode != 1 && velocity.Y == 0f && localAI[3] < 5f && Main.rand.Next(180) == 0)
				{
					int num16 = (int)(base.Center.X / 16f);
					int num17 = (int)((base.Bottom.Y - 8f) / 16f);
					if (WorldGen.InWorld(num16, num17) && !Main.tile[num16, num17].active())
					{
						WorldGen.PlaceSuitableHerbHere(num16, num17 + 1);
						if (Main.tile[num16, num17].active())
						{
							localAI[3] += 1f;
							if (Main.netMode == 2)
							{
								NetMessage.SendTileSquare(-1, num16, num17);
							}
						}
					}
				}
			}
			else if (ai[1] == 3736f || ai[1] == 3737f || ai[1] == 3738f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.BalloonSlime");
				if (collideY && oldVelocity.Y > 4f)
				{
					velocity.Y = (0f - oldVelocity.Y) * 0.7f;
				}
			}
			else if (ai[1] == 1345f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.ConfettiSlime");
				if (Main.rand.Next(30) == 0)
				{
					int num18 = Main.rand.Next(139, 143);
					int num19 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num18, 0f, -10f, 0, default(Color), 1.2f);
					Main.dust[num19].scale *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
					Main.dust[num19].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
				}
				if (Main.rand.Next(60) == 0)
				{
					int num20 = Main.rand.Next(276, 283);
					int num21 = Gore.NewGore(position, new Vector2(0f, -10f), num20);
					Main.gore[num21].scale *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
					Main.gore[num21].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
				}
			}
			else if (ai[1] == 1103f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.SlushSlime");
				if (Main.rand.Next(3) == 0)
				{
					position += netOffset;
					Dust dust2 = Dust.NewDustDirect(new Vector2(position.X - 2f, position.Y - 2f), width + 4, height + 4, 135, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 2.5f);
					dust2.noGravity = true;
					dust2.velocity *= 1.8f;
					dust2.velocity.Y -= 0.75f;
					if (Main.rand.Next(4) == 0)
					{
						dust2.noGravity = false;
						dust2.scale *= 0.5f;
					}
					position -= netOffset;
				}
			}
			else if (ai[1] == 593f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.SnowSlime");
				if (Main.rand.Next(3) == 0)
				{
					position += netOffset;
					Dust dust3 = Dust.NewDustDirect(new Vector2(position.X - 2f, position.Y - 2f), width + 4, height + 4, 135, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 2.5f);
					dust3.noGravity = true;
					dust3.velocity *= 1.8f;
					dust3.velocity.Y -= 0.75f;
					if (Main.rand.Next(4) == 0)
					{
						dust3.noGravity = false;
						dust3.scale *= 0.5f;
					}
					position -= netOffset;
				}
			}
			else if (ai[1] == 3347f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.FossilSlime");
				alpha = 125;
				ai[0] += 1f;
				damage = defDamage + 10;
			}
			else if (ai[1] == 29f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.HeartSlime");
				defense = defDefense + 4;
				if (lifeMax == defLifeMax)
				{
					if (life == lifeMax)
					{
						life = defLifeMax * 2;
					}
					lifeMax = defLifeMax * 2;
				}
			}
			else if (ai[1] == 3609f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.ConveyorSlime");
				defense = defDefense + 8;
				damage = defDamage + 6;
			}
			else if (ai[1] == 174f)
			{
				_givenName = Language.GetTextValue("SpecialNPCName.HellSlime");
				defense = defDefense + 14;
				damage = defDamage + 20;
				if (lifeMax == defLifeMax)
				{
					knockBackResist /= 3f;
					life *= 2;
					lifeMax *= 2;
					float num22 = 1.2f;
					scale *= num22;
					position.X += width / 2;
					position.Y += height;
					width = (int)((float)width * num22);
					height = (int)((float)height * num22);
					position.X -= width / 2;
					position.Y -= height;
				}
				position += netOffset;
				int num23 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 1.7f);
				Main.dust[num23].scale *= 0.6f;
				Main.dust[num23].velocity *= 2f;
				Main.dust[num23].velocity.Y -= 2f;
				position -= netOffset;
				num23 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 50);
				Main.dust[num23].scale = 0.1f + (float)Main.rand.Next(5) * 0.1f;
				Main.dust[num23].fadeIn = 1.5f + (float)Main.rand.Next(5) * 0.1f;
				Main.dust[num23].velocity.Y -= 5f;
				Main.dust[num23].noGravity = true;
			}
			else if (ai[1] > 0f && ai[1] < (float)ItemID.Count && ItemID.Sets.IsAVoiceChangeItem[(int)ai[1]] && lifeMax == defLifeMax)
			{
				if (life == lifeMax)
				{
					life = defLifeMax * 3;
				}
				lifeMax = defLifeMax * 3;
			}
		}
		if (type == 1 && direction == 0 && !flag2)
		{
			direction = 1;
			netUpdate = true;
		}
		if (ai[0] == -999f)
		{
			frame.Y = 0;
			frameCounter = 0.0;
			rotation = 0f;
			return;
		}
		if (type == 244)
		{
			float num24 = (float)Main.DiscoR / 255f;
			float num25 = (float)Main.DiscoG / 255f;
			float num26 = (float)Main.DiscoB / 255f;
			num24 *= 1f;
			num25 *= 1f;
			num26 *= 1f;
			Lighting.AddLight((int)((position.X + (float)(width / 2)) / 16f), (int)((position.Y + (float)(height / 2)) / 16f), num24, num25, num26);
			AI_001_SetRainbowSlimeColor();
		}
		bool flag3 = false;
		if (!Main.dayTime || life != lifeMax || (double)position.Y > Main.worldSurface * 16.0 || Main.slimeRain)
		{
			flag3 = true;
		}
		if (Main.remixWorld && type == 59 && life == lifeMax)
		{
			flag3 = false;
		}
		if (type == 81)
		{
			flag3 = true;
			if (Main.rand.Next(30) == 0)
			{
				position += netOffset;
				int num27 = Dust.NewDust(position, width, height, 14, 0f, 0f, alpha, this.color);
				Main.dust[num27].velocity *= 0.3f;
				position -= netOffset;
			}
		}
		if ((type == 377 || type == 446) && target != 255 && !Main.player[target].dead && Vector2.Distance(base.Center, Main.player[target].Center) <= 200f && !wet)
		{
			flag3 = true;
		}
		if (type == 183)
		{
			flag3 = true;
		}
		if (type == 304)
		{
			flag3 = true;
		}
		if (type == 667)
		{
			flag3 = true;
		}
		if (type == 244)
		{
			flag3 = true;
			ai[0] += 2f;
		}
		if (type == 147 && Main.rand.Next(10) == 0)
		{
			position += netOffset;
			int num28 = Dust.NewDust(position, width, height, 76);
			Main.dust[num28].noGravity = true;
			Main.dust[num28].velocity *= 0.1f;
			position -= netOffset;
		}
		if (type == 667)
		{
			Color color2 = new Color(204, 181, 72, 255);
			Lighting.AddLight((int)(base.Center.X / 16f), (int)(base.Center.Y / 16f), (float)(int)color2.R / 255f * 1.1f, (float)(int)color2.G / 255f * 1.1f, (float)(int)color2.B / 255f * 1.1f);
			if (velocity.Length() > 1f || Main.rand.Next(4) != 0)
			{
				int num29 = 8;
				Vector2 vector2 = position + new Vector2(-num29, -num29);
				int num30 = width + num29 * 2;
				int num31 = height + num29 * 2;
				position += netOffset;
				int num32 = Dust.NewDust(vector2, num30, num31, 246);
				Main.dust[num32].noGravity = true;
				Main.dust[num32].noLightEmittence = true;
				Main.dust[num32].velocity *= 0.2f;
				Main.dust[num32].scale = 1.5f;
				position -= netOffset;
			}
		}
		if (type == 676)
		{
			Lighting.AddLight(base.Center, 23);
			if ((velocity.Length() > 1f && Main.rand.Next(3) == 0) || Main.rand.Next(5) == 0)
			{
				Dust dust4 = Dust.NewDustPerfect(Main.rand.NextVector2FromRectangle(base.Hitbox), 306);
				dust4.noGravity = true;
				dust4.noLightEmittence = true;
				dust4.alpha = 127;
				dust4.color = Main.hslToRgb(((float)Main.timeForVisualEffects / 300f + Main.rand.NextFloat() * 0.1f) % 1f, 1f, 0.65f);
				dust4.color.A = 0;
				dust4.velocity = dust4.position - base.Center;
				dust4.velocity *= 0.1f;
				dust4.velocity.X *= 0.25f;
				if (dust4.velocity.Y > 0f)
				{
					dust4.velocity.Y *= -1f;
				}
				dust4.scale = Main.rand.NextFloat() * 0.3f + 0.5f;
				dust4.fadeIn = 0.9f;
				dust4.position += netOffset;
			}
		}
		if (type == 184)
		{
			if (Main.rand.Next(8) == 0)
			{
				position += netOffset;
				int num33 = Dust.NewDust(position - velocity, width, height, 76);
				Main.dust[num33].noGravity = true;
				Main.dust[num33].velocity *= 0.15f;
				position -= netOffset;
			}
			flag3 = true;
			if (localAI[0] > 0f)
			{
				localAI[0] -= 1f;
			}
			if (!wet && Main.player[target].active && !Main.player[target].dead && !Main.player[target].npcTypeNoAggro[type])
			{
				Vector2 vector3 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num34 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector3.X;
				float num35 = Main.player[target].position.Y - vector3.Y;
				float num36 = (float)Math.Sqrt(num34 * num34 + num35 * num35);
				if (Main.expertMode && num36 < 120f && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height) && velocity.Y == 0f)
				{
					ai[0] = -40f;
					if (velocity.Y == 0f)
					{
						velocity.X *= 0.9f;
					}
					if (Main.netMode != 1 && localAI[0] == 0f)
					{
						for (int k = 0; k < 5; k++)
						{
							Vector2 vector4 = new Vector2(k - 2, -4f);
							vector4.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.005f;
							vector4.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.005f;
							vector4.Normalize();
							vector4 *= 4f + (float)Main.rand.Next(-50, 51) * 0.01f;
							int attackDamage_ForProjectiles = GetAttackDamage_ForProjectiles(9f, 9f);
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector3.X, vector3.Y, vector4.X, vector4.Y, 174, attackDamage_ForProjectiles, 0f, Main.myPlayer);
							localAI[0] = 30f;
						}
					}
				}
				else if (num36 < 200f && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height) && velocity.Y == 0f)
				{
					ai[0] = -40f;
					if (velocity.Y == 0f)
					{
						velocity.X *= 0.9f;
					}
					if (Main.netMode != 1 && localAI[0] == 0f)
					{
						num35 = Main.player[target].position.Y - vector3.Y - (float)Main.rand.Next(0, 200);
						num36 = (float)Math.Sqrt(num34 * num34 + num35 * num35);
						num36 = 4.5f / num36;
						num34 *= num36;
						num35 *= num36;
						localAI[0] = 50f;
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector3.X, vector3.Y, num34, num35, 174, 9, 0f, Main.myPlayer);
					}
				}
			}
		}
		if (type == 535)
		{
			flag3 = true;
			if (localAI[0] > 0f)
			{
				localAI[0] -= 1f;
			}
			if (!wet && Main.player[target].active && !Main.player[target].dead && !Main.player[target].npcTypeNoAggro[type])
			{
				Vector2 vector5 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num37 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector5.X;
				float num38 = Main.player[target].position.Y - vector5.Y;
				float num39 = (float)Math.Sqrt(num37 * num37 + num38 * num38);
				if (Main.expertMode && num39 < 120f && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height) && velocity.Y == 0f)
				{
					ai[0] = -40f;
					if (velocity.Y == 0f)
					{
						velocity.X *= 0.9f;
					}
					if (Main.netMode != 1 && localAI[0] == 0f)
					{
						for (int l = 0; l < 5; l++)
						{
							Vector2 vector6 = new Vector2(l - 2, -4f);
							vector6.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.005f;
							vector6.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.005f;
							vector6.Normalize();
							vector6 *= 4f + (float)Main.rand.Next(-50, 51) * 0.01f;
							int attackDamage_ForProjectiles2 = GetAttackDamage_ForProjectiles(9f, 9f);
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector5.X, vector5.Y, vector6.X, vector6.Y, 605, attackDamage_ForProjectiles2, 0f, Main.myPlayer);
							localAI[0] = 30f;
						}
					}
				}
				else if (num39 < 200f && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height) && velocity.Y == 0f)
				{
					ai[0] = -40f;
					if (velocity.Y == 0f)
					{
						velocity.X *= 0.9f;
					}
					if (Main.netMode != 1 && localAI[0] == 0f)
					{
						num38 = Main.player[target].position.Y - vector5.Y - (float)Main.rand.Next(0, 200);
						num39 = (float)Math.Sqrt(num37 * num37 + num38 * num38);
						num39 = 4.5f / num39;
						num37 *= num39;
						num38 *= num39;
						localAI[0] = 50f;
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector5.X, vector5.Y, num37, num38, 605, 9, 0f, Main.myPlayer);
					}
				}
			}
		}
		if (type == 658)
		{
			flag3 = true;
			if (localAI[0] > 0f)
			{
				localAI[0] -= 1f;
			}
			if (!wet && Main.player[target].active && !Main.player[target].dead && !Main.player[target].npcTypeNoAggro[type])
			{
				Player obj = Main.player[target];
				Vector2 center = base.Center;
				float num40 = obj.Center.X - center.X;
				float num41 = obj.Center.Y - center.Y;
				float num42 = (float)Math.Sqrt(num40 * num40 + num41 * num41);
				int num43 = CountNPCS(658);
				if (Main.expertMode && num43 < 5 && Math.Abs(num40) < 500f && Math.Abs(num41) < 550f && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height) && velocity.Y == 0f)
				{
					ai[0] = -40f;
					if (velocity.Y == 0f)
					{
						velocity.X *= 0.9f;
					}
					if (Main.netMode != 1 && localAI[0] == 0f)
					{
						for (int m = 0; m < 3; m++)
						{
							Vector2 vector7 = new Vector2(m - 1, -4f);
							vector7.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.005f;
							vector7.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.005f;
							vector7.Normalize();
							vector7 *= 6f + (float)Main.rand.Next(-50, 51) * 0.01f;
							if (num42 > 350f)
							{
								vector7 *= 2f;
							}
							else if (num42 > 250f)
							{
								vector7 *= 1.5f;
							}
							int attackDamage_ForProjectiles_MultiLerp = GetAttackDamage_ForProjectiles_MultiLerp(15f, 17f, 20f);
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), center.X, center.Y, vector7.X, vector7.Y, 920, attackDamage_ForProjectiles_MultiLerp, 0f, Main.myPlayer);
							localAI[0] = 25f;
							if (num43 > 4)
							{
								break;
							}
						}
					}
				}
				else if (Math.Abs(num40) < 500f && Math.Abs(num41) < 550f && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height) && velocity.Y == 0f)
				{
					float num44 = num42;
					ai[0] = -40f;
					if (velocity.Y == 0f)
					{
						velocity.X *= 0.9f;
					}
					if (Main.netMode != 1 && localAI[0] == 0f)
					{
						num41 = Main.player[target].position.Y - center.Y - (float)Main.rand.Next(0, 200);
						num42 = (float)Math.Sqrt(num40 * num40 + num41 * num41);
						num42 = 4.5f / num42;
						num42 *= 2f;
						if (num44 > 350f)
						{
							num42 *= 2f;
						}
						else if (num44 > 250f)
						{
							num42 *= 1.5f;
						}
						num40 *= num42;
						num41 *= num42;
						localAI[0] = 50f;
						int attackDamage_ForProjectiles_MultiLerp2 = GetAttackDamage_ForProjectiles_MultiLerp(15f, 17f, 20f);
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), center.X, center.Y, num40, num41, 920, attackDamage_ForProjectiles_MultiLerp2, 0f, Main.myPlayer);
					}
				}
			}
		}
		if (type == 659)
		{
			flag3 = true;
			if (localAI[0] > 0f)
			{
				localAI[0] -= 1f;
			}
			if (!wet && Main.player[target].active && !Main.player[target].dead && !Main.player[target].npcTypeNoAggro[type])
			{
				Player obj2 = Main.player[target];
				Vector2 center2 = base.Center;
				float num45 = obj2.Center.X - center2.X;
				float num46 = obj2.Center.Y - center2.Y;
				float num47 = (float)Math.Sqrt(num45 * num45 + num46 * num46);
				float num48 = num47;
				if (Math.Abs(num45) < 500f && Math.Abs(num46) < 550f && Collision.CanHit(position, width, height, Main.player[target].position, Main.player[target].width, Main.player[target].height) && velocity.Y == 0f)
				{
					ai[0] = -40f;
					if (velocity.Y == 0f)
					{
						velocity.X *= 0.9f;
					}
					if (Main.netMode != 1 && localAI[0] == 0f)
					{
						num46 = Main.player[target].position.Y - center2.Y - (float)Main.rand.Next(0, 200);
						num47 = (float)Math.Sqrt(num45 * num45 + num46 * num46);
						num47 = 4.5f / num47;
						num47 *= 2f;
						if (num48 > 350f)
						{
							num47 *= 1.75f;
						}
						else if (num48 > 250f)
						{
							num47 *= 1.25f;
						}
						num45 *= num47;
						num46 *= num47;
						localAI[0] = 40f;
						if (Main.expertMode)
						{
							localAI[0] = 30f;
						}
						int attackDamage_ForProjectiles_MultiLerp3 = GetAttackDamage_ForProjectiles_MultiLerp(15f, 17f, 20f);
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), center2.X, center2.Y, num45, num46, 921, attackDamage_ForProjectiles_MultiLerp3, 0f, Main.myPlayer);
					}
				}
			}
		}
		if (type == 204)
		{
			flag3 = true;
			if (localAI[0] > 0f)
			{
				localAI[0] -= 1f;
			}
			if (!wet && Main.player[target].active && !Main.player[target].dead && !Main.player[target].npcTypeNoAggro[type])
			{
				Vector2 vector8 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num49 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector8.X;
				float num50 = Main.player[target].position.Y - vector8.Y;
				float num51 = (float)Math.Sqrt(num49 * num49 + num50 * num50);
				if (Main.expertMode && num51 < 200f && Collision.CanHit(new Vector2(position.X, position.Y - 20f), width, height + 20, Main.player[target].position, Main.player[target].width, Main.player[target].height) && velocity.Y == 0f)
				{
					ai[0] = -40f;
					if (velocity.Y == 0f)
					{
						velocity.X *= 0.9f;
					}
					if (Main.netMode != 1 && localAI[0] == 0f)
					{
						for (int n = 0; n < 5; n++)
						{
							Vector2 vector9 = new Vector2(n - 2, -2f);
							vector9.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.02f;
							vector9.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.02f;
							vector9.Normalize();
							vector9 *= 3f + (float)Main.rand.Next(-50, 51) * 0.01f;
							int attackDamage_ForProjectiles3 = GetAttackDamage_ForProjectiles(13f, 13f);
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector8.X, vector8.Y, vector9.X, vector9.Y, 176, attackDamage_ForProjectiles3, 0f, Main.myPlayer);
							localAI[0] = 80f;
						}
					}
				}
				if (num51 < 400f && Collision.CanHit(new Vector2(position.X, position.Y - 20f), width, height + 20, Main.player[target].position, Main.player[target].width, Main.player[target].height) && velocity.Y == 0f)
				{
					ai[0] = -80f;
					if (velocity.Y == 0f)
					{
						velocity.X *= 0.9f;
					}
					if (Main.netMode != 1 && localAI[0] == 0f)
					{
						num50 = Main.player[target].position.Y - vector8.Y - (float)Main.rand.Next(-30, 20);
						num50 -= num51 * 0.05f;
						num49 = Main.player[target].position.X - vector8.X - (float)Main.rand.Next(-20, 20);
						num51 = (float)Math.Sqrt(num49 * num49 + num50 * num50);
						num51 = 7f / num51;
						num49 *= num51;
						num50 *= num51;
						localAI[0] = 65f;
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector8.X, vector8.Y, num49, num50, 176, 13, 0f, Main.myPlayer);
					}
				}
			}
		}
		if (type == 377 || type == 446)
		{
			if (localAI[2] < 90f)
			{
				localAI[2] += 1f;
			}
			else
			{
				friendly = false;
			}
		}
		if (type == 59)
		{
			position += netOffset;
			Lighting.AddLight((int)((position.X + (float)(width / 2)) / 16f), (int)((position.Y + (float)(height / 2)) / 16f), 1f, 0.3f, 0.1f);
			int num52 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 1.7f);
			Main.dust[num52].noGravity = true;
			position -= netOffset;
		}
		if (ai[2] > 1f)
		{
			ai[2] -= 1f;
		}
		if (wet)
		{
			if (collideY)
			{
				velocity.Y = -2f;
			}
			if (velocity.Y < 0f && ai[3] == position.X)
			{
				direction *= -1;
				ai[2] = 200f;
			}
			if (velocity.Y > 0f)
			{
				ai[3] = position.X;
			}
			if (type == 59 && !Main.remixWorld)
			{
				if (velocity.Y > 2f)
				{
					velocity.Y *= 0.9f;
				}
				else if (directionY < 0)
				{
					velocity.Y -= 0.8f;
				}
				velocity.Y -= 0.5f;
				if (velocity.Y < -10f)
				{
					velocity.Y = -10f;
				}
			}
			else
			{
				if (velocity.Y > 2f)
				{
					velocity.Y *= 0.9f;
				}
				velocity.Y -= 0.5f;
				if (velocity.Y < -4f)
				{
					velocity.Y = -4f;
				}
			}
			if (ai[2] == 1f && flag3)
			{
				TargetClosest();
			}
		}
		aiAction = 0;
		if (ai[2] == 0f)
		{
			ai[0] = -100f;
			ai[2] = 1f;
			TargetClosest();
		}
		if (velocity.Y == 0f)
		{
			if (collideY && oldVelocity.Y != 0f && Collision.SolidCollision(position, width, height))
			{
				position.X -= velocity.X + (float)direction;
			}
			if (ai[3] == position.X)
			{
				direction *= -1;
				ai[2] = 200f;
			}
			ai[3] = 0f;
			if (ai[1] == 3609f)
			{
				if (direction < 0)
				{
					velocity.X -= 0.1f;
				}
				else
				{
					velocity.X += 0.1f;
				}
				velocity.X = Utils.Clamp(velocity.X, -2.5f, 2.5f);
			}
			else
			{
				velocity.X *= 0.8f;
				if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
				{
					velocity.X = 0f;
				}
			}
			if (flag3)
			{
				ai[0] += 1f;
			}
			ai[0] += 1f;
			if (type == 59 && !Main.remixWorld)
			{
				ai[0] += 2f;
			}
			if (type == 71)
			{
				ai[0] += 3f;
			}
			if (type == 667)
			{
				ai[0] += 3f;
			}
			if (type == 138)
			{
				ai[0] += 2f;
			}
			if (type == 183)
			{
				ai[0] += 1f;
			}
			if (type == 658)
			{
				ai[0] += 5f;
			}
			if (type == 659)
			{
				ai[0] += 3f;
			}
			if (type == 304)
			{
				float num53 = (1 - life / lifeMax) * 10;
				ai[0] += num53;
			}
			if (type == 377 || type == 446)
			{
				ai[0] += 3f;
			}
			if (type == 81)
			{
				if (scale >= 0f)
				{
					ai[0] += 4f;
				}
				else
				{
					ai[0] += 1f;
				}
			}
			float num54 = -1000f;
			if (type == 659)
			{
				num54 = -500f;
			}
			if (type == 667)
			{
				num54 = -400f;
			}
			int num55 = 0;
			if (ai[0] >= 0f)
			{
				num55 = 1;
			}
			if (ai[0] >= num54 && ai[0] <= num54 * 0.5f)
			{
				num55 = 2;
			}
			if (ai[0] >= num54 * 2f && ai[0] <= num54 * 1.5f)
			{
				num55 = 3;
			}
			if (num55 > 0)
			{
				netUpdate = true;
				if (flag3 && ai[2] == 1f)
				{
					TargetClosest();
				}
				if (num55 == 3)
				{
					velocity.Y = -8f;
					if (type == 59 && !Main.remixWorld)
					{
						velocity.Y -= 2f;
					}
					velocity.X += 3 * direction;
					if (type == 59 && !Main.remixWorld)
					{
						velocity.X += 0.5f * (float)direction;
					}
					ai[0] = -200f;
					ai[3] = position.X;
				}
				else
				{
					velocity.Y = -6f;
					velocity.X += 2 * direction;
					if (type == 59 && !Main.remixWorld)
					{
						velocity.X += 2 * direction;
					}
					ai[0] = -120f;
					if (num55 == 1)
					{
						ai[0] += num54;
					}
					else
					{
						ai[0] += num54 * 2f;
					}
				}
				if (type == 659)
				{
					velocity.Y *= 1.6f;
					velocity.X *= 1.2f;
				}
				if (type == 685)
				{
					velocity.Y *= 0.5f;
					velocity.X *= 0.2f;
					if (Main.rand.Next(2) == 0)
					{
						direction *= -1;
					}
				}
				if (type == 141)
				{
					velocity.Y *= 1.3f;
					velocity.X *= 1.2f;
				}
				if (type == 377 || type == 446)
				{
					velocity.Y *= 0.9f;
					velocity.X *= 0.6f;
					if (flag3)
					{
						direction = -direction;
						velocity.X *= -1f;
					}
					int i2 = (int)(base.Center.X / 16f);
					int j2 = (int)(base.Center.Y / 16f) - 1;
					if (WorldGen.SolidTile(i2, j2) && 0f - velocity.Y + (float)height > 16f)
					{
						velocity.Y = -(16 - height);
					}
				}
			}
			else if (ai[0] >= -30f)
			{
				aiAction = 1;
			}
		}
		else if (target < 255 && ((direction == 1 && velocity.X < 3f) || (direction == -1 && velocity.X > -3f)))
		{
			if (collideX && Math.Abs(velocity.X) == 0.2f)
			{
				position.X -= 1.4f * (float)direction;
			}
			if (collideY && oldVelocity.Y != 0f && Collision.SolidCollision(position, width, height))
			{
				position.X -= velocity.X + (float)direction;
			}
			if ((direction == -1 && (double)velocity.X < 0.01) || (direction == 1 && (double)velocity.X > -0.01))
			{
				velocity.X += 0.2f * (float)direction;
			}
			else
			{
				velocity.X *= 0.93f;
			}
		}
	}

	public void AI_001_SetRainbowSlimeColor()
	{
		color.R = (byte)Main.DiscoR;
		color.G = (byte)Main.DiscoG;
		color.B = (byte)Main.DiscoB;
		color.A = 100;
		alpha = 175;
	}

	private int AI_001_Slimes_GenerateItemInsideBody(bool isBallooned)
	{
		int num = Main.rand.Next(4);
		bool flag = isBallooned;
		if (WorldGen.Skyblock.lowTiles)
		{
			if (Main.rand.Next(3) != 0)
			{
				num = Main.rand.Next(1, 3);
			}
			if (Main.rand.Next(3) != 0)
			{
				flag = false;
			}
		}
		if (flag)
		{
			switch (Main.rand.Next(13))
			{
			default:
				return 4367;
			case 1:
				return 4368;
			case 2:
				return 4369;
			case 3:
				return 4370;
			case 4:
				return 4371;
			case 5:
				return 4612;
			case 6:
				return 4674;
			case 7:
			case 8:
			case 9:
				return 4343;
			case 10:
			case 11:
			case 12:
				return 4344;
			}
		}
		switch (num)
		{
		case 0:
			switch (Main.rand.Next(7))
			{
			case 0:
				return 290;
			case 1:
				return 292;
			case 2:
				return 296;
			case 3:
				return 2322;
			default:
				if (Main.netMode != 0 && Main.rand.Next(2) == 0)
				{
					return 2997;
				}
				return 2350;
			}
		case 1:
			num = Main.rand.Next(4);
			if (WorldGen.Skyblock.lowTiles)
			{
				if (Main.moonPhase == 0)
				{
					num = Main.rand.Next(2);
				}
				if (num == 2)
				{
					num = Main.rand.Next(4);
				}
			}
			return num switch
			{
				0 => 8, 
				1 => 965, 
				2 => 166, 
				_ => 58, 
			};
		case 2:
			if (WorldGen.isThisInTheRockLayer((int)(base.Center.Y / 16f)) && WorldGen.Skyblock.lowTiles && Main.hardMode && Main.rand.Next(2) == 0)
			{
				return Main.rand.Next(6) switch
				{
					1 => 1104, 
					2 => 365, 
					3 => 1105, 
					4 => 366, 
					5 => 1106, 
					_ => 364, 
				};
			}
			if (Main.rand.Next(2) == 0)
			{
				return Main.rand.Next(11, 15);
			}
			return Main.rand.Next(699, 703);
		default:
			num = Main.rand.Next(3);
			if (WorldGen.Skyblock.lowTiles && Main.rand.Next(5) != 0)
			{
				num = 0;
			}
			return num switch
			{
				0 => 71, 
				1 => 72, 
				_ => 73, 
			};
		}
	}

	private void AI_110_Betsy()
	{
		NPCUtils.TargetClosestBetsy(this, faceTarget: false);
		NPCAimedTarget targetData = GetTargetData();
		int num = -1;
		float num2 = 1f;
		int num3 = 35;
		int num4 = 35;
		float num5 = 10f;
		float num6 = 0.45f;
		float num7 = 7.5f;
		float num8 = 30f;
		float num9 = 30f;
		float num10 = 23f;
		float num11 = 600f;
		float num12 = 12f;
		float num13 = 40f;
		float num14 = 80f;
		float num15 = num13 + num14;
		float num16 = 1500f;
		float num17 = 60f;
		float num18 = 13f;
		float amount = 1f / 30f;
		float num19 = 12f;
		int num20 = 10;
		int num21 = 6 * num20;
		float num22 = 60f;
		float num23 = num17 + (float)num21 + num22;
		float num24 = 60f;
		float num25 = 1f;
		float num26 = (float)Math.PI * 2f * (num25 / num24);
		float num27 = 0.1f;
		float num28 = 32f;
		float num29 = 90f;
		float num30 = 20f;
		_ = ai[0];
		_ = -1f;
		if (ai[0] == 0f)
		{
			if ((ai[1] += 1f) >= num5)
			{
				ai[1] = 0f;
				ai[0] = 1f;
				ai[2] = 0f;
				netUpdate = true;
			}
		}
		else if (ai[0] == 1f)
		{
			if (ai[2] == 0f)
			{
				ai[2] = ((base.Center.X < targetData.Center.X) ? 1 : (-1));
			}
			Vector2 destination = targetData.Center + new Vector2((0f - ai[2]) * 300f, -200f);
			Vector2 desiredVelocity = DirectionTo(destination) * num7;
			SimpleFlyMovement(desiredVelocity, num6);
			int num31 = ((base.Center.X < targetData.Center.X) ? 1 : (-1));
			direction = (spriteDirection = num31);
			if ((ai[1] += 1f) >= num8)
			{
				int num32 = 1;
				if (ai[3] == 5f && Main.rand.Next(3) == 0)
				{
					ai[3] += 1f;
				}
				switch ((int)ai[3])
				{
				case 0:
				case 1:
				case 3:
					num32 = 2;
					break;
				case 2:
					num32 = 3;
					break;
				case 4:
					num32 = 4;
					break;
				case 5:
					num32 = 5;
					break;
				case 6:
					num32 = 3;
					break;
				case 7:
					num32 = 6;
					break;
				}
				ai[0] = num32;
				ai[1] = 0f;
				ai[2] = 0f;
				ai[3] += 1f;
				netUpdate = true;
				if (ai[3] >= 8f)
				{
					ai[3] = 0f;
				}
				switch (num32)
				{
				case 2:
				{
					Vector2 vector2 = DirectionTo(targetData.Center);
					spriteDirection = ((vector2.X > 0f) ? 1 : (-1));
					rotation = vector2.ToRotation();
					if (spriteDirection == -1)
					{
						rotation += (float)Math.PI;
					}
					velocity = vector2 * num10;
					break;
				}
				case 3:
				{
					Vector2 vector3 = new Vector2((targetData.Center.X > base.Center.X) ? 1 : (-1), 0f);
					spriteDirection = ((vector3.X > 0f) ? 1 : (-1));
					velocity = vector3 * -2f;
					break;
				}
				case 5:
				{
					Vector2 vector = DirectionTo(targetData.Center);
					spriteDirection = ((vector.X > 0f) ? 1 : (-1));
					rotation = vector.ToRotation();
					if (spriteDirection == -1)
					{
						rotation += (float)Math.PI;
					}
					velocity = vector * num28;
					break;
				}
				}
			}
		}
		else if (ai[0] == 2f)
		{
			if (ai[1] == 0f)
			{
				SoundEngine.PlayTrackedSound(SoundID.DD2_BetsyWindAttack, base.Center);
			}
			if ((ai[1] += 1f) >= num9)
			{
				ai[0] = 1f;
				ai[1] = 0f;
				ai[2] = 0f;
			}
		}
		else if (ai[0] == 3f)
		{
			ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2]));
			if (activeSound != null)
			{
				activeSound.Position = base.Center;
			}
			ai[1] += 1f;
			int num33 = ((base.Center.X < targetData.Center.X) ? 1 : (-1));
			ai[2] = num33;
			if (ai[1] < num13)
			{
				Vector2 vector4 = targetData.Center + new Vector2((float)num33 * (0f - num11), -250f);
				Vector2 vector5 = DirectionTo(vector4) * num12;
				if (Distance(vector4) < num12)
				{
					base.Center = vector4;
				}
				else
				{
					position += vector5;
				}
				if (Vector2.Distance(vector4, base.Center) < 16f)
				{
					ai[1] = num13 - 1f;
				}
				num2 = 1.5f;
			}
			if (ai[1] == num13)
			{
				int num34 = ((targetData.Center.X > base.Center.X) ? 1 : (-1));
				velocity = new Vector2(num34, 0f) * 10f;
				direction = (spriteDirection = num34);
				if (Main.netMode != 1)
				{
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center, velocity, 687, num3, 0f, Main.myPlayer, 0f, whoAmI);
				}
				localAI[2] = SoundEngine.PlayTrackedSound(SoundID.DD2_BetsyFlameBreath, base.Center).ToFloat();
			}
			if (ai[1] >= num13)
			{
				num2 = 1.5f;
				if (Math.Abs(targetData.Center.X - base.Center.X) > 550f && Math.Abs(velocity.X) < 20f)
				{
					velocity.X += (float)Math.Sign(velocity.X) * 0.5f;
				}
			}
			if (ai[1] >= num15)
			{
				ai[0] = 1f;
				ai[1] = 0f;
				ai[2] = 0f;
			}
		}
		else if (ai[0] == 4f)
		{
			int num35 = ((base.Center.X < targetData.Center.X) ? 1 : (-1));
			ai[2] = num35;
			if (ai[1] < num17)
			{
				Vector2 vector6 = targetData.Center + new Vector2((float)num35 * (0f - num16), -350f);
				Vector2 value = DirectionTo(vector6) * num18;
				velocity = Vector2.Lerp(velocity, value, amount);
				int num36 = ((base.Center.X < targetData.Center.X) ? 1 : (-1));
				direction = (spriteDirection = num36);
				if (Vector2.Distance(vector6, base.Center) < 16f)
				{
					ai[1] = num17 - 1f;
				}
				num2 = 1.5f;
			}
			else if (ai[1] == num17)
			{
				Vector2 v = DirectionTo(targetData.Center);
				v.Y *= 0.25f;
				v = v.SafeNormalize(Vector2.UnitX * direction);
				spriteDirection = ((v.X > 0f) ? 1 : (-1));
				rotation = v.ToRotation();
				if (spriteDirection == -1)
				{
					rotation += (float)Math.PI;
				}
				velocity = v * num19;
			}
			else
			{
				position.X += DirectionTo(targetData.Center).X * 7f;
				position.Y += DirectionTo(targetData.Center + new Vector2(0f, -400f)).Y * 6f;
				if (ai[1] <= num23 - num22)
				{
					num2 = 1.5f;
				}
				float num37 = 30f;
				Vector2 vector7 = base.Center + new Vector2((110f + num37) * (float)direction, 20f).RotatedBy(rotation);
				int num38 = (int)(ai[1] - num17 + 1f);
				if (num38 <= num21 && num38 % num20 == 0 && Main.netMode != 1)
				{
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector7, velocity, 686, num4, 0f, Main.myPlayer);
				}
			}
			if (ai[1] > num23 - num22)
			{
				velocity.Y -= 0.1f;
			}
			ai[1] += 1f;
			if (ai[1] >= num23)
			{
				ai[0] = 1f;
				ai[1] = 0f;
				ai[2] = 0f;
			}
		}
		else if (ai[0] == 5f)
		{
			velocity = velocity.RotatedBy((0f - num26) * (float)direction);
			position.Y -= num27;
			position += DirectionTo(targetData.Center) * 10f;
			rotation -= num26 * (float)direction;
			num2 *= 0.7f;
			if (ai[1] == 1f)
			{
				SoundEngine.PlayTrackedSound(SoundID.DD2_BetsyFlyingCircleAttack, base.Center);
			}
			if ((ai[1] += 1f) >= num24)
			{
				ai[0] = 1f;
				ai[1] = 0f;
				ai[2] = 0f;
				velocity /= 2f;
			}
		}
		else if (ai[0] == 6f)
		{
			if (ai[1] == 0f)
			{
				Vector2 destination2 = targetData.Center + new Vector2(0f, -200f);
				Vector2 desiredVelocity2 = DirectionTo(destination2) * num7 * 2f;
				SimpleFlyMovement(desiredVelocity2, num6 * 2f);
				int num39 = ((base.Center.X < targetData.Center.X) ? 1 : (-1));
				direction = (spriteDirection = num39);
				ai[2] += 1f;
				if (Distance(targetData.Center) < 350f || ai[2] >= 180f)
				{
					ai[1] = 1f;
					netUpdate = true;
				}
			}
			else
			{
				if (ai[1] == 1f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_BetsyScream, base.Center);
				}
				if (ai[1] < num30)
				{
					velocity *= 0.95f;
				}
				else
				{
					velocity *= 0.98f;
				}
				if (ai[1] == num30)
				{
					if (velocity.Y > 0f)
					{
						velocity.Y /= 3f;
					}
					velocity.Y -= 3f;
				}
				num2 *= 0.85f;
				if (ai[1] == 20f || ai[1] == 25f || ai[1] == 30f)
				{
					Point point = base.Center.ToTileCoordinates();
					int num40 = 30;
					int num41 = 35;
					int num42 = 4;
					for (int i = point.X - num40; i <= point.X + num40; i++)
					{
						bool flag = false;
						for (int j = point.Y - num41 / 3; j < point.Y + num41; j++)
						{
							Tile tileSafely = Framing.GetTileSafely(i, j);
							bool flag2 = tileSafely.active() && Main.tileSolid[tileSafely.type] && !Main.tileFrameImportant[tileSafely.type];
							if (flag && flag2)
							{
								int num43 = WorldGen.KillTile_GetTileDustAmount(fail: true, tileSafely);
								for (int k = 0; k < num43; k++)
								{
									Dust obj = Main.dust[WorldGen.KillTile_MakeTileDust(i, j, tileSafely)];
									obj.velocity.Y -= 3f + (float)num42 * 1.5f;
									obj.velocity.Y *= Main.rand.NextFloat();
									obj.scale += (float)num42 * 0.03f;
								}
								for (int l = 0; l < num43 - 1; l++)
								{
									Dust obj2 = Main.dust[WorldGen.KillTile_MakeTileDust(i, j, tileSafely)];
									obj2.velocity.Y -= 1f + (float)num42;
									obj2.velocity.Y *= Main.rand.NextFloat();
								}
								if (num43 > 0 && Main.rand.Next(3) != 0)
								{
									float num44 = Math.Abs(point.X - i) / (num40 / 2);
									Gore gore = Gore.NewGoreDirect(position, Vector2.Zero, 61 + Main.rand.Next(3), 1f - (float)num42 * 0.15f + num44 * 0.5f);
									gore.velocity.Y -= 0.1f + (float)num42 * 0.5f + num44 * (float)num42 * 1f;
									gore.velocity.Y *= Main.rand.NextFloat();
									gore.position = new Vector2(i * 16 + 20, j * 16 + 20);
								}
							}
							flag = !flag2;
						}
					}
				}
				bool flag3 = ai[1] == 20f || ai[1] == 45f || ai[1] == 70f;
				if (CountNPCS(560) > 4)
				{
					flag3 = false;
				}
				if (flag3 && Main.netMode != 1)
				{
					for (int m = 0; m < 1; m++)
					{
						Vector2 vector8 = base.Center + ((float)Math.PI * 2f * Main.rand.NextFloat()).ToRotationVector2() * new Vector2(2f, 1f) * 300f * (0.6f + Main.rand.NextFloat() * 0.4f);
						if (Vector2.Distance(vector8, targetData.Center) > 100f)
						{
							Point point2 = vector8.ToPoint();
							NewNPC(GetSpawnSourceForNPCFromNPCAI(), point2.X, point2.Y, 560, whoAmI);
							SoundEngine.PlayTrackedSound(SoundID.DD2_BetsySummon, vector8);
						}
					}
					List<NPC> list = new List<NPC>();
					for (int n = 0; n < Main.maxNPCs; n++)
					{
						NPC nPC = Main.npc[n];
						if (nPC.active && nPC.type == 549)
						{
							list.Add(nPC);
						}
					}
					if (list.Count > 0)
					{
						for (int num45 = 0; num45 < 3; num45++)
						{
							NPC nPC2 = list[Main.rand.Next(list.Count)];
							Point point3 = nPC2.Center.ToPoint();
							NewNPC(GetSpawnSourceForNPCFromNPCAI(), point3.X, point3.Y, 560);
							SoundEngine.PlayTrackedSound(SoundID.DD2_BetsySummon, nPC2.Center);
						}
					}
				}
				ai[1] += 1f;
			}
			if (ai[1] >= num29)
			{
				ai[0] = 1f;
				ai[1] = 0f;
				ai[2] = 0f;
			}
		}
		localAI[0] += num2;
		if (localAI[0] >= 36f)
		{
			localAI[0] = 0f;
		}
		if (num != -1)
		{
			localAI[0] = num * 4;
		}
		if ((localAI[1] += 1f) >= 60f)
		{
			localAI[1] = 0f;
		}
		float num46 = DirectionTo(targetData.Center).ToRotation();
		float num47 = 0.04f;
		switch ((int)ai[0])
		{
		case 2:
		case 5:
			num47 = 0f;
			break;
		case 3:
			num47 = 0.01f;
			num46 = 0f;
			if (spriteDirection == -1)
			{
				num46 -= (float)Math.PI;
			}
			if (ai[1] >= num13)
			{
				num46 += (float)spriteDirection * (float)Math.PI / 12f;
				num47 = 0.05f;
			}
			break;
		case 4:
			num47 = 0.01f;
			num46 = (float)Math.PI;
			if (spriteDirection == 1)
			{
				num46 += (float)Math.PI;
			}
			break;
		case 6:
			num47 = 0.02f;
			num46 = 0f;
			if (spriteDirection == -1)
			{
				num46 -= (float)Math.PI;
			}
			break;
		}
		if (spriteDirection == -1)
		{
			num46 += (float)Math.PI;
		}
		if (num47 != 0f)
		{
			rotation = rotation.AngleTowards(num46, num47);
		}
		if (SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2])) == null)
		{
			localAI[2] = SlotId.Invalid.ToFloat();
		}
	}

	private static bool AI_FindNearbyBook(Point searchPosition, int searchWidth, int searchHeight, out Point bookPosition, bool closestBook = false, bool checkPlayerScreenRanges = false)
	{
		bookPosition = Point.Zero;
		Point[] nearbyBooks = _nearbyBooks;
		int num = nearbyBooks.Length;
		int num2 = 0;
		int num3 = Math.Max(0, searchPosition.X);
		int num4 = Math.Min(searchPosition.X + searchWidth, Main.maxTilesX);
		int num5 = Math.Max(0, searchPosition.Y);
		int num6 = Math.Min(searchPosition.Y + searchHeight, Main.maxTilesY);
		float num7 = 9999999f;
		Vector2 vector = searchPosition.ToVector2();
		Vector2 vector2 = vector;
		for (int i = num5; i < num6; i++)
		{
			for (int j = num3; j < num4; j++)
			{
				Tile tile = Main.tile[j, i];
				if (!tile.active() || tile.type != 50)
				{
					continue;
				}
				Vector2 vector3 = new Vector2(j, i);
				if (checkPlayerScreenRanges && !Spawner.CheckNotSpawningOnScreen((int)vector3.X, (int)vector3.Y))
				{
					continue;
				}
				float num8 = vector3.Distance(vector2);
				if (closestBook && num8 < num7)
				{
					num7 = num8;
					vector = vector3;
					continue;
				}
				nearbyBooks[num2++] = new Point(j, i);
				if (num2 >= num)
				{
					break;
				}
			}
		}
		if (closestBook)
		{
			bookPosition = vector.ToPoint();
			if (vector.X == vector2.X)
			{
				return vector.Y != vector2.Y;
			}
			return true;
		}
		if (num2 == 0)
		{
			return false;
		}
		bookPosition = nearbyBooks[Main.rand.Next(num2)];
		return true;
	}

	private void AI_026_Unicorns()
	{
		int num = 30;
		int num2 = 10;
		bool flag = false;
		bool flag2 = false;
		bool flag3 = false;
		if (velocity.Y == 0f && ((velocity.X > 0f && direction < 0) || (velocity.X < 0f && direction > 0)))
		{
			flag2 = true;
			ai[3] += 1f;
		}
		if (type == 546)
		{
			num2 = 4;
			bool flag4 = velocity.Y == 0f;
			for (int i = 0; i < Main.maxNPCs; i++)
			{
				if (i != whoAmI && Main.npc[i].active && Main.npc[i].type == type && Math.Abs(position.X - Main.npc[i].position.X) + Math.Abs(position.Y - Main.npc[i].position.Y) < (float)width)
				{
					if (position.X < Main.npc[i].position.X)
					{
						velocity.X -= 0.05f;
					}
					else
					{
						velocity.X += 0.05f;
					}
					if (position.Y < Main.npc[i].position.Y)
					{
						velocity.Y -= 0.05f;
					}
					else
					{
						velocity.Y += 0.05f;
					}
				}
			}
			if (flag4)
			{
				velocity.Y = 0f;
			}
		}
		if (type == 315)
		{
			int num3 = 480;
			if (localAI[0]++ >= (float)num3)
			{
				localAI[0] = 0f;
				int num4 = target;
				if (Main.netMode != 1 && num4 != 255)
				{
					int attackDamage_ForProjectiles = GetAttackDamage_ForProjectiles(40f, 30f);
					Projectile.NewProjectile(GetSpawnSourceForNPCFromNPCAI(), base.Center + Main.rand.NextVector2Circular(40f, 40f), new Vector2(velocity.X, Main.rand.NextFloatDirection() * 3f), 1001, attackDamage_ForProjectiles, 0f, Main.myPlayer, num4);
				}
			}
			Lighting.AddLight(base.Center, 0.4f, 0.36f, 0.2f);
			int num5 = frame.Height;
			if (num5 < 1)
			{
				num5 = 1;
			}
			int num6 = frame.Y / num5;
			if (num6 >= 4 && num6 <= 7)
			{
				Vector2 vector = base.Bottom + new Vector2(-30f, -8f);
				Vector2 vector2 = new Vector2(60f, 8f);
				if (Main.rand.Next(3) != 0)
				{
					Dust dust = Dust.NewDustPerfect(vector + new Vector2(Main.rand.NextFloat() * vector2.X, Main.rand.NextFloat() * vector2.Y), 6, velocity);
					dust.scale = 0.6f;
					dust.fadeIn = 1.1f;
					dust.noGravity = true;
					dust.noLight = true;
				}
			}
		}
		if (position.X == oldPosition.X || ai[3] >= (float)num || flag2)
		{
			ai[3] += 1f;
			flag3 = true;
		}
		else if (ai[3] > 0f)
		{
			ai[3] -= 1f;
		}
		if (ai[3] > (float)(num * num2))
		{
			ai[3] = 0f;
		}
		if (justHit)
		{
			ai[3] = 0f;
		}
		if (ai[3] == (float)num)
		{
			netUpdate = true;
		}
		Vector2 vector3 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
		float num7 = Main.player[target].position.X + (float)Main.player[target].width * 0.5f - vector3.X;
		float num8 = Main.player[target].position.Y - vector3.Y;
		float num9 = (float)Math.Sqrt(num7 * num7 + num8 * num8);
		if (num9 < 200f && !flag3)
		{
			ai[3] = 0f;
		}
		if (type == 410)
		{
			ai[1] += 1f;
			bool flag5 = ai[1] >= 240f;
			if (!flag5 && velocity.Y == 0f)
			{
				for (int j = 0; j < 255; j++)
				{
					if (Main.player[j].active && !Main.player[j].dead && Main.player[j].Distance(base.Center) < 800f && Main.player[j].Center.Y < base.Center.Y && Math.Abs(Main.player[j].Center.X - base.Center.X) < 20f)
					{
						flag5 = true;
						break;
					}
				}
			}
			if (flag5 && Main.netMode != 1)
			{
				for (int k = 0; k < 3; k++)
				{
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, (Main.rand.NextFloat() - 0.5f) * 2f, -4f - 10f * Main.rand.NextFloat(), 538, 50, 0f, Main.myPlayer);
				}
				life = 0;
				HitEffect(0, 9999.0);
				active = false;
				return;
			}
		}
		else if (type == 423)
		{
			if (ai[2] == 1f)
			{
				ai[1] += 1f;
				velocity.X *= 0.7f;
				if (ai[1] < 30f)
				{
					Vector2 vector4 = base.Center + Vector2.UnitX * spriteDirection * -20f;
					Dust obj = Main.dust[Dust.NewDust(vector4, 0, 0, 242)];
					Vector2 vector5 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
					obj.position = vector4 + vector5 * 20f;
					obj.velocity = -vector5 * 2f;
					obj.scale = 0.5f + vector5.X * (float)(-spriteDirection);
					obj.fadeIn = 1f;
					obj.noGravity = true;
				}
				else if (ai[1] == 30f)
				{
					for (int l = 0; l < 20; l++)
					{
						Vector2 vector6 = base.Center + Vector2.UnitX * spriteDirection * -20f;
						Dust obj2 = Main.dust[Dust.NewDust(vector6, 0, 0, 242)];
						Vector2 vector7 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						obj2.position = vector6 + vector7 * 4f;
						obj2.velocity = vector7 * 4f + Vector2.UnitX * Main.rand.NextFloat() * spriteDirection * -5f;
						obj2.scale = 0.5f + vector7.X * (float)(-spriteDirection);
						obj2.fadeIn = 1f;
						obj2.noGravity = true;
					}
				}
				if (velocity.X > -0.5f && velocity.X < 0.5f)
				{
					velocity.X = 0f;
				}
				if (ai[1] == 30f && Main.netMode != 1)
				{
					int attackDamage_ForProjectiles2 = GetAttackDamage_ForProjectiles(50f, 35f);
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X + (float)(spriteDirection * -20), base.Center.Y, spriteDirection * -7, 0f, 575, attackDamage_ForProjectiles2, 0f, Main.myPlayer, target);
				}
				if (ai[1] >= 60f)
				{
					ai[1] = -Main.rand.Next(320, 601);
					ai[2] = 0f;
				}
			}
			else
			{
				ai[1] += 1f;
				if (ai[1] >= 180f && num9 < 500f && velocity.Y == 0f)
				{
					flag = true;
					ai[1] = 0f;
					ai[2] = 1f;
					netUpdate = true;
				}
				else if (velocity.Y == 0f && num9 < 100f && Math.Abs(velocity.X) > 3f && ((base.Center.X < Main.player[target].Center.X && velocity.X > 0f) || (base.Center.X > Main.player[target].Center.X && velocity.X < 0f)))
				{
					velocity.Y -= 4f;
				}
			}
		}
		else if (type == 155 || type == 329)
		{
			if (velocity.Y == 0f && num9 < 100f && Math.Abs(velocity.X) > 3f && ((position.X + (float)(width / 2) < Main.player[target].position.X + (float)(Main.player[target].width / 2) && velocity.X > 0f) || (position.X + (float)(width / 2) > Main.player[target].position.X + (float)(Main.player[target].width / 2) && velocity.X < 0f)))
			{
				velocity.Y -= 4f;
			}
		}
		else if (type == 546 && velocity.Y == 0f && Math.Abs(velocity.X) > 3f && ((base.Center.X < Main.player[target].Center.X && velocity.X > 0f) || (base.Center.X > Main.player[target].Center.X && velocity.X < 0f)))
		{
			velocity.Y -= 4f;
			SoundEngine.PlaySound(3, base.Center, 11);
		}
		if (type == 546 && !Main.player[target].ZoneDesert)
		{
			int num10 = direction;
			TargetClosest();
			if (!Main.player[target].ZoneDesert)
			{
				EncourageDespawn(10);
				ai[3] = num;
				direction = num10;
			}
		}
		if (ai[3] < (float)num)
		{
			if ((type == 329 || type == 315) && !Main.pumpkinMoon)
			{
				EncourageDespawn(10);
			}
			else
			{
				TargetClosest();
			}
		}
		else
		{
			if (velocity.X == 0f)
			{
				if (velocity.Y == 0f)
				{
					ai[0] += 1f;
					if (ai[0] >= 2f)
					{
						direction *= -1;
						spriteDirection = direction;
						ai[0] = 0f;
					}
				}
			}
			else
			{
				ai[0] = 0f;
			}
			directionY = -1;
			if (direction == 0)
			{
				direction = 1;
			}
		}
		float num11 = 6f;
		float num12 = 0.07f;
		if (!flag && (velocity.Y == 0f || wet || (velocity.X <= 0f && direction < 0) || (velocity.X >= 0f && direction > 0)))
		{
			if (type == 155)
			{
				if (velocity.X > 0f && direction < 0)
				{
					velocity.X *= 0.95f;
				}
				if (velocity.X < 0f && direction > 0)
				{
					velocity.X *= 0.95f;
				}
			}
			else if (type == 329)
			{
				if (velocity.X > 0f && direction < 0)
				{
					velocity.X *= 0.9f;
				}
				if (velocity.X < 0f && direction > 0)
				{
					velocity.X *= 0.9f;
				}
				if (direction > 0 && velocity.X < 3f)
				{
					velocity.X += 0.1f;
				}
				if (direction < 0 && velocity.X > -3f)
				{
					velocity.X -= 0.1f;
				}
			}
			else if (type == 315)
			{
				if (velocity.X > 0f && direction < 0)
				{
					velocity.X *= 0.95f;
				}
				if (velocity.X < 0f && direction > 0)
				{
					velocity.X *= 0.95f;
				}
				if (velocity.X < 0f - num11 || velocity.X > num11)
				{
					if (velocity.Y == 0f)
					{
						velocity *= 0.8f;
					}
				}
				else if (velocity.X < num11 && direction == 1)
				{
					velocity.X += 0.07f;
					if (velocity.X > num11)
					{
						velocity.X = num11;
					}
				}
				else if (velocity.X > 0f - num11 && direction == -1)
				{
					velocity.X -= 0.07f;
					if (velocity.X < 0f - num11)
					{
						velocity.X = 0f - num11;
					}
				}
			}
			else if (type == 410)
			{
				if (Math.Sign(velocity.X) != direction)
				{
					velocity.X *= 0.9f;
				}
				num11 = 6f;
				num12 = 0.2f;
			}
			else if (type == 423)
			{
				if (Math.Sign(velocity.X) != direction)
				{
					velocity.X *= 0.85f;
				}
				num11 = 10f;
				num12 = 0.2f;
			}
			else if (type == 546)
			{
				if (Math.Sign(velocity.X) != direction)
				{
					velocity.X *= 0.92f;
				}
				float num13 = MathHelper.Lerp(0.6f, 1f, Math.Abs(Main.windSpeedTarget)) * (float)Math.Sign(Main.windSpeedTarget);
				if (!Main.player[target].ZoneSandstorm)
				{
					num13 = 0f;
				}
				num11 = 4f + num13 * (float)direction * 3f;
				num12 = 0.05f;
			}
			if (velocity.X < 0f - num11 || velocity.X > num11)
			{
				if (velocity.Y == 0f)
				{
					velocity *= 0.8f;
				}
			}
			else if (velocity.X < num11 && direction == 1)
			{
				velocity.X += num12;
				if (velocity.X > num11)
				{
					velocity.X = num11;
				}
			}
			else if (velocity.X > 0f - num11 && direction == -1)
			{
				velocity.X -= num12;
				if (velocity.X < 0f - num11)
				{
					velocity.X = 0f - num11;
				}
			}
		}
		if (velocity.Y >= 0f)
		{
			int num14 = 0;
			if (velocity.X < 0f)
			{
				num14 = -1;
			}
			if (velocity.X > 0f)
			{
				num14 = 1;
			}
			Vector2 vector8 = position;
			vector8.X += velocity.X;
			int num15 = (int)((vector8.X + (float)(width / 2) + (float)((width / 2 + 1) * num14)) / 16f);
			int num16 = (int)((vector8.Y + (float)height - 1f) / 16f);
			if (Main.tile[num15, num16] == null)
			{
				Main.tile[num15, num16] = new Tile();
			}
			if (Main.tile[num15, num16 - 1] == null)
			{
				Main.tile[num15, num16 - 1] = new Tile();
			}
			if (Main.tile[num15, num16 - 2] == null)
			{
				Main.tile[num15, num16 - 2] = new Tile();
			}
			if (Main.tile[num15, num16 - 3] == null)
			{
				Main.tile[num15, num16 - 3] = new Tile();
			}
			if (Main.tile[num15, num16 + 1] == null)
			{
				Main.tile[num15, num16 + 1] = new Tile();
			}
			if ((float)(num15 * 16) < vector8.X + (float)width && (float)(num15 * 16 + 16) > vector8.X && ((Main.tile[num15, num16].nactive() && !Main.tile[num15, num16].topSlope() && !Main.tile[num15, num16 - 1].topSlope() && Main.tileSolid[Main.tile[num15, num16].type] && !Main.tileSolidTop[Main.tile[num15, num16].type]) || (Main.tile[num15, num16 - 1].halfBrick() && Main.tile[num15, num16 - 1].nactive())) && (!Main.tile[num15, num16 - 1].nactive() || !Main.tileSolid[Main.tile[num15, num16 - 1].type] || Main.tileSolidTop[Main.tile[num15, num16 - 1].type] || (Main.tile[num15, num16 - 1].halfBrick() && (!Main.tile[num15, num16 - 4].nactive() || !Main.tileSolid[Main.tile[num15, num16 - 4].type] || Main.tileSolidTop[Main.tile[num15, num16 - 4].type]))) && (!Main.tile[num15, num16 - 2].nactive() || !Main.tileSolid[Main.tile[num15, num16 - 2].type] || Main.tileSolidTop[Main.tile[num15, num16 - 2].type]) && (!Main.tile[num15, num16 - 3].nactive() || !Main.tileSolid[Main.tile[num15, num16 - 3].type] || Main.tileSolidTop[Main.tile[num15, num16 - 3].type]) && (!Main.tile[num15 - num14, num16 - 3].nactive() || !Main.tileSolid[Main.tile[num15 - num14, num16 - 3].type]))
			{
				float num17 = num16 * 16;
				if (Main.tile[num15, num16].halfBrick())
				{
					num17 += 8f;
				}
				if (Main.tile[num15, num16 - 1].halfBrick())
				{
					num17 -= 8f;
				}
				if (num17 < vector8.Y + (float)height)
				{
					float num18 = vector8.Y + (float)height - num17;
					if ((double)num18 <= 16.1)
					{
						gfxOffY += position.Y + (float)height - num17;
						position.Y = num17 - (float)height;
						if (num18 < 9f)
						{
							stepSpeed = 1f;
						}
						else
						{
							stepSpeed = 2f;
						}
					}
				}
			}
		}
		if (velocity.Y == 0f)
		{
			bool flag6 = true;
			int num19 = (int)(position.Y - 7f) / 16;
			int num20 = (int)(position.X - 7f) / 16;
			int num21 = (int)(position.X + (float)width + 7f) / 16;
			for (int m = num20; m <= num21; m++)
			{
				if (Main.tile[m, num19] != null && Main.tile[m, num19].nactive() && Main.tileSolid[Main.tile[m, num19].type])
				{
					flag6 = false;
					break;
				}
			}
			if (flag6)
			{
				int num22 = (int)((position.X + (float)(width / 2) + (float)((width / 2 + 2) * direction) + velocity.X * 5f) / 16f);
				int num23 = (int)((position.Y + (float)height - 15f) / 16f);
				if (Main.tile[num22, num23] == null)
				{
					Main.tile[num22, num23] = new Tile();
				}
				if (Main.tile[num22, num23 - 1] == null)
				{
					Main.tile[num22, num23 - 1] = new Tile();
				}
				if (Main.tile[num22, num23 - 2] == null)
				{
					Main.tile[num22, num23 - 2] = new Tile();
				}
				if (Main.tile[num22, num23 - 3] == null)
				{
					Main.tile[num22, num23 - 3] = new Tile();
				}
				if (Main.tile[num22, num23 + 1] == null)
				{
					Main.tile[num22, num23 + 1] = new Tile();
				}
				if (Main.tile[num22, num23 + 2] == null)
				{
					Main.tile[num22, num23 + 2] = new Tile();
				}
				if (Main.tile[num22 + direction, num23 - 1] == null)
				{
					Main.tile[num22 + direction, num23 - 1] = new Tile();
				}
				if (Main.tile[num22 + direction, num23 + 1] == null)
				{
					Main.tile[num22 + direction, num23 + 1] = new Tile();
				}
				if (Main.tile[num22 - direction, num23 + 1] == null)
				{
					Main.tile[num22 - direction, num23 + 1] = new Tile();
				}
				if (Main.tile[num22 + direction, num23 + 3] == null)
				{
					Main.tile[num22 + direction, num23 + 3] = new Tile();
				}
				int num24 = spriteDirection;
				if (type == 423 || type == 410 || type == 546)
				{
					num24 *= -1;
				}
				if ((velocity.X < 0f && num24 == -1) || (velocity.X > 0f && num24 == 1))
				{
					bool flag7 = type == 410 || type == 423;
					float num25 = 3f;
					if (Main.tile[num22, num23 - 2].nactive() && Main.tileSolid[Main.tile[num22, num23 - 2].type])
					{
						if (Main.tile[num22, num23 - 3].nactive() && Main.tileSolid[Main.tile[num22, num23 - 3].type])
						{
							velocity.Y = -8.5f;
							netUpdate = true;
						}
						else
						{
							velocity.Y = -7.5f;
							netUpdate = true;
						}
					}
					else if (Main.tile[num22, num23 - 1].nactive() && !Main.tile[num22, num23 - 1].topSlope() && Main.tileSolid[Main.tile[num22, num23 - 1].type])
					{
						velocity.Y = -7f;
						netUpdate = true;
					}
					else if (position.Y + (float)height - (float)(num23 * 16) > 20f && Main.tile[num22, num23].nactive() && !Main.tile[num22, num23].topSlope() && Main.tileSolid[Main.tile[num22, num23].type])
					{
						velocity.Y = -6f;
						netUpdate = true;
					}
					else if ((directionY < 0 || Math.Abs(velocity.X) > num25) && (!flag7 || !Main.tile[num22, num23 + 1].nactive() || !Main.tileSolid[Main.tile[num22, num23 + 1].type]) && (!Main.tile[num22, num23 + 2].nactive() || !Main.tileSolid[Main.tile[num22, num23 + 2].type]) && (!Main.tile[num22 + direction, num23 + 3].nactive() || !Main.tileSolid[Main.tile[num22 + direction, num23 + 3].type]))
					{
						velocity.Y = -8f;
						netUpdate = true;
					}
				}
			}
		}
		if (type == 423 && Math.Abs(velocity.X) >= num11 * 0.95f)
		{
			Rectangle hitbox = base.Hitbox;
			for (int n = 0; n < 2; n++)
			{
				if (Main.rand.Next(3) == 0)
				{
					Dust obj3 = Main.dust[Dust.NewDust(hitbox.TopLeft(), hitbox.Width, hitbox.Height, 242)];
					obj3.velocity = Vector2.Zero;
					obj3.noGravity = true;
					obj3.fadeIn = 1f;
					obj3.scale = 0.5f + Main.rand.NextFloat();
				}
			}
		}
		if (type == 546)
		{
			rotation += velocity.X * 0.05f;
			spriteDirection = -direction;
		}
	}

	private void AI_107_ImprovedWalkers()
	{
		bool flag = velocity.X == 0f && velocity.Y == 0f && !justHit;
		bool flag2 = false;
		bool flag3 = false;
		bool flag4 = false;
		int num = 32;
		int num2 = 15;
		float num3 = 9f;
		bool flag5 = false;
		float num4 = 40f;
		int num5 = 30;
		int num6 = 0;
		bool flag6 = false;
		bool flag7 = true;
		float num7 = 0.9f;
		bool flag8 = false;
		bool flag9 = false;
		bool flag10 = false;
		bool flag11 = false;
		bool flag12 = false;
		bool flag13 = false;
		bool flag14 = false;
		bool flag15 = true;
		int num8 = 70;
		int num9 = num8 / 2;
		float num10 = 11f;
		Vector2 vector = Vector2.Zero;
		int num11 = 1;
		int num12 = 81;
		float num13 = 700f;
		float num14 = 0f;
		float num15 = 0.1f;
		Vector2? vector2 = null;
		float num16 = 0.5f;
		int num17 = 1;
		float num18 = 1f;
		bool flag16 = false;
		float num19 = 30f;
		float num20 = 0f;
		bool flag17 = false;
		bool flag18 = true;
		bool flag19 = false;
		int num21 = 30;
		bool flag20 = false;
		bool flag21 = false;
		bool flag22 = false;
		bool flag23 = false;
		LegacySoundStyle style = null;
		int num22 = 0;
		bool flag24 = false;
		float num23 = 1f;
		float num24 = 0.07f;
		float num25 = 0.8f;
		float num26 = width / 2 + 6;
		bool flag25 = directionY < 0;
		bool flag26 = false;
		int num27 = 1;
		bool flag27 = false;
		float num28 = 5f;
		float num29 = 3f;
		float num30 = 8f;
		float amount = 0.05f;
		float amount2 = 0.04f;
		float amount3 = 0.1f;
		bool flag28 = false;
		float num31 = 0.025f;
		NPCAimedTarget targetData = GetTargetData();
		NPCUtils.NPCTargetingMethod nPCTargetingMethod = NPCUtils.TargetClosestCommon;
		if (NPCID.Sets.BelongsToInvasionOldOnesArmy[type])
		{
			nPCTargetingMethod = NPCUtils.TargetClosestOldOnesInvasion;
		}
		if (targetData.Type == NPCTargetType.NPC && Main.npc[TranslatedTargetIndex].type == 548 && Main.npc[TranslatedTargetIndex].dontTakeDamageFromHostiles)
		{
			nPCTargetingMethod(this, faceTarget: true, null);
			targetData = GetTargetData();
		}
		if (NPCID.Sets.FighterUsesDD2PortalAppearEffect[type])
		{
			if (!targetData.Invalid)
			{
				flag2 = !Collision.CanHit(base.Center, 0, 0, targetData.Center, 0, 0) && (direction == Math.Sign(targetData.Center.X - base.Center.X) || (noGravity && Distance(targetData.Center) > 50f && base.Center.Y > targetData.Center.Y));
			}
			flag2 &= ai[0] <= 0f;
		}
		if (flag2)
		{
			if (velocity.Y == 0f || Math.Abs(targetData.Center.Y - base.Center.Y) > 800f)
			{
				noGravity = true;
				noTileCollide = true;
			}
		}
		else
		{
			noGravity = false;
			noTileCollide = false;
		}
		bool flag29 = NPCID.Sets.FighterUsesDD2PortalAppearEffect[type];
		bool flag30 = true;
		switch (type)
		{
		case 576:
		case 577:
			num22 = 700;
			style = SoundID.DD2_OgreRoar;
			num26 -= 32f;
			flag5 = true;
			num6 = 60;
			num4 = 130f;
			num5 = 44;
			flag21 = DD2Event.EnemiesShouldChasePlayers;
			num7 = 0.7f;
			if (localAI[0] > 0f)
			{
				localAI[0] -= 1f;
			}
			if (ai[0] <= 0f)
			{
				float num34 = ai[1];
				float num35 = Distance(targetData.Center);
				if (localAI[3] >= 60f)
				{
					if (num35 <= num4 + 300f && localAI[0] <= 0f)
					{
						ai[1] = 2f;
					}
					else if (num35 > num4 + 30f)
					{
						ai[1] = 1f;
					}
					else if (!(num35 > num4))
					{
						ai[1] = 0f;
						if (num34 == 1f)
						{
							ai[0] = 0f;
						}
					}
				}
				if (num34 != ai[1])
				{
					netUpdate = true;
				}
			}
			else if (ai[1] == 2f)
			{
				localAI[0] = 300f;
			}
			switch ((int)ai[1])
			{
			case 0:
				num5 = 44;
				if (ai[0] == 40f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_OgreAttack, base.Center);
				}
				break;
			case 2:
				num5 = 90;
				num4 = 250f;
				flag4 = true;
				num11 = GetAttackDamage_ForProjectiles(60f, 40f);
				num9 = 36;
				num = 56;
				num2 = 41;
				num3 = 13f;
				flag3 = true;
				num12 = 683;
				flag15 = false;
				vector = new Vector2(-direction * 20, height / 2 - 1);
				if (ai[0] == 40f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_OgreGroundPound, base.Center);
				}
				break;
			case 1:
				flag3 = true;
				num5 = 90;
				num4 = 1000f;
				num6 = 240;
				num11 = GetAttackDamage_ForProjectiles(40f, 30f);
				flag15 = false;
				vector = new Vector2(direction * 30, -70f);
				num12 = 676;
				if (ai[0] == 80f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_OgreSpit, base.Center);
				}
				break;
			}
			if (ai[0] < (float)(-num6))
			{
				ai[0] = -num6;
			}
			break;
		case 552:
		case 553:
		case 554:
			style = SoundID.DD2_GoblinScream;
			num22 = 1000;
			flag5 = true;
			flag21 = DD2Event.EnemiesShouldChasePlayers;
			if (type == 553)
			{
				num24 += 0.01f;
				num23 += 0.2f;
			}
			if (type == 554)
			{
				num24 += 0.02f;
				num23 += 0.4f;
			}
			if (!(localAI[3] >= 60f))
			{
				num24 = 0.01f + localAI[3] / 60f * 0.05f;
			}
			break;
		case 570:
		case 571:
			flag21 = DD2Event.EnemiesShouldChasePlayers;
			flag24 = true;
			flag12 = true;
			flag15 = ai[1] > 40f;
			num8 = 60;
			num9 = 40;
			if (type == 571 && ai[1] > 10f && ai[1] <= 40f && (int)ai[1] % 6 == 0)
			{
				num9 = (int)ai[1] - 1;
			}
			if (type == 570 && ai[1] > 10f && ai[1] <= 40f && (int)ai[1] % 9 == 0)
			{
				num9 = (int)ai[1] - 1;
			}
			num12 = 671;
			vector.X += 22 * direction;
			num15 = 0.15f;
			num16 = 1.5f;
			num13 = 600f;
			num10 = 13f;
			num17 = 1;
			num18 = 0f;
			if (type == 570)
			{
				num16 = 2.5f;
			}
			num11 = GetAttackDamage_ForProjectiles(35f, 25f);
			if (type == 571)
			{
				num11 = GetAttackDamage_ForProjectiles(60f, 45f);
			}
			num23 = 0.77f;
			if (ai[0] > 0f)
			{
				if (ai[1] == 40f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_DrakinShot, base.Center);
				}
				else if (ai[1] == 60f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_DrakinBreathIn, base.Center);
				}
			}
			if (!(localAI[3] >= 60f))
			{
				num13 = 1f;
				num24 = 0.01f + localAI[3] / 60f * 0.05f;
			}
			break;
		case 572:
		case 573:
			if (localAI[3] == 0f)
			{
				localAI[0] = SlotId.Invalid.ToFloat();
				localAI[1] = SlotId.Invalid.ToFloat();
			}
			flag21 = DD2Event.EnemiesShouldChasePlayers;
			if (ai[1] == 2f)
			{
				SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[0]))?.Stop();
				SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]))?.Stop();
				position = base.Center;
				width = (height = 192);
				base.Center = position;
				velocity = Vector2.Zero;
				damage = GetAttackDamage_ScaledByDifficulty(80f);
				alpha = 255;
				for (int k = 0; k < 4; k++)
				{
					int num37 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num37].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				}
				for (int l = 0; l < 20; l++)
				{
					int num38 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 200, default(Color), 3.7f);
					Main.dust[num38].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Main.dust[num38].noGravity = true;
					Main.dust[num38].velocity *= 3f;
					num38 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num38].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 4f;
					Main.dust[num38].velocity *= 2f;
					Main.dust[num38].noGravity = true;
					Main.dust[num38].fadeIn = 2.5f;
				}
				for (int m = 0; m < 6; m++)
				{
					int num39 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 0, default(Color), 2.7f);
					Main.dust[num39].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num39].noGravity = true;
					Main.dust[num39].velocity *= 3f;
				}
				for (int n = 0; n < 12; n++)
				{
					int num40 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num40].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num40].noGravity = true;
					Main.dust[num40].velocity *= 3f;
				}
				for (int num41 = 0; num41 < 5; num41++)
				{
					int num42 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num42].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Main.gore[num42].velocity *= 0.3f;
					Main.gore[num42].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num42].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
				ai[0] += 1f;
				if (ai[0] >= 3f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_KoboldExplosion, base.Center);
					life = 0;
					HitEffect();
					active = false;
				}
				return;
			}
			if (ai[0] > 0f && ai[1] == 0f && life > 0)
			{
				if (!SlotId.FromFloat(localAI[0]).IsValid)
				{
					localAI[0] = SoundEngine.PlayTrackedSound(SoundID.DD2_KoboldIgnite, base.Center).ToFloat();
				}
				localAI[2] += 1f;
				if (localAI[2] == 30f)
				{
					localAI[0] = SoundEngine.PlayTrackedSound(SoundID.DD2_KoboldIgniteLoop, base.Center).ToFloat();
					localAI[1] = SoundEngine.PlayTrackedSound(SoundID.DD2_KoboldScreamChargeLoop, base.Center).ToFloat();
				}
			}
			if (ai[0] > 0f && ai[1] == 1f)
			{
				ai[0] = 0f;
				ai[1] = 2f;
				netUpdate = true;
				return;
			}
			num23 = 0.88f;
			if (ai[0] == 1f)
			{
				ai[1] = 1f;
			}
			if (ai[0] == 0f && ai[1] == 1f)
			{
				ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[0]));
				if (activeSound == null)
				{
					localAI[0] = SoundEngine.PlayTrackedSound(SoundID.DD2_KoboldIgniteLoop, base.Center).ToFloat();
				}
				else
				{
					activeSound.Position = base.Center;
				}
				ActiveSound activeSound2 = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]));
				if (activeSound2 == null)
				{
					localAI[1] = SoundEngine.PlayTrackedSound(SoundID.DD2_KoboldScreamChargeLoop, base.Center).ToFloat();
				}
				else
				{
					activeSound2.Position = base.Center;
				}
			}
			if (ai[1] > 0f && ai[0] == 0f)
			{
				flag5 = true;
				num5 = 40;
				num4 = 64f;
				num24 = 0.3f;
				num23 = 4f;
				Vector2 vector3 = base.Center + new Vector2(spriteDirection * 12, 0f);
				if (Main.rand.Next(6) == 0)
				{
					Dust dust3 = Dust.NewDustDirect(vector3, 1, 1, 213, Main.rand.Next(-2, 3), Main.rand.Next(-2, 3), 100, new Color(255, 255, 255, 0));
					dust3.noGravity = true;
					dust3.fadeIn = dust3.scale + 1f + 0.01f * (float)Main.rand.Next(0, 51);
					dust3.velocity *= 0.3f;
					dust3.velocity.X += (float)(-spriteDirection) * 1.2f;
					dust3.velocity.Y += -3.5f;
					dust3.velocity.X += velocity.X;
				}
				if (Main.rand.Next(12) == 0)
				{
					Dust dust4 = Dust.NewDustPerfect(vector3, 6, velocity, 100);
					dust4.noGravity = true;
					dust4.velocity.Y -= 1f + Main.rand.NextFloat();
					dust4.scale = 1.1f;
					dust4.fadeIn = 0.5f;
					dust4.customData = this;
				}
			}
			else
			{
				flag5 = true;
				num5 = 40;
				num4 = 700f;
			}
			if (!(localAI[3] >= 60f))
			{
				num24 = 0.01f + localAI[3] / 60f * 0.05f;
			}
			break;
		case 568:
		case 569:
		{
			num5 = 110;
			num24 = 0.16f;
			num25 = 0.7f;
			num23 = 1.4f;
			flag5 = true;
			num4 = 600f;
			flag21 = DD2Event.EnemiesShouldChasePlayers;
			if (!(localAI[3] >= 60f))
			{
				num24 = 0.01f + localAI[3] / 60f * 0.05f;
			}
			if (ai[0] == 0f)
			{
				localAI[1] = SlotId.Invalid.ToFloat();
			}
			if (ai[0] != 1f)
			{
				break;
			}
			HitSound = SoundID.DD2_WitherBeastCrystalImpact;
			ai[0] += 1f;
			if (Main.rand.Next(10) == 0)
			{
				Dust dust7 = Dust.NewDustDirect(base.TopLeft, width, height, 271, 0f, -3f, 0, Color.Transparent, 0.6f);
				dust7.velocity.X /= 2f;
				dust7.noGravity = true;
				dust7.fadeIn = 1.5f;
				dust7.position.Y += 4f;
			}
			ActiveSound activeSound3 = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]));
			if (activeSound3 == null)
			{
				localAI[1] = SoundEngine.PlayTrackedSound(SoundID.DD2_WitherBeastAuraPulse, base.Center).ToFloat();
			}
			else
			{
				activeSound3.Position = base.Center;
			}
			localAI[0] += 1f;
			if (localAI[0] > 60f && Main.rand.Next(10) == 0)
			{
				Vector2 vec = base.Center + (Main.rand.NextFloat() * ((float)Math.PI * 2f)).ToRotationVector2() * 400f * (0.3f + 0.7f * Main.rand.NextFloat());
				Point point = vec.ToTileCoordinates();
				if (!WorldGen.SolidTile(point.X, point.Y))
				{
					Dust dust8 = Dust.NewDustPerfect(vec, 27, new Vector2(0f, -3f), 0, new Color(255, 255, 255, 127), 1.5f);
					dust8.velocity = DirectionTo(dust8.position) * dust8.velocity.Length();
					dust8.fadeIn = 1.5f;
				}
			}
			if (Main.netMode != 2)
			{
				Player player = Main.player[Main.myPlayer];
				if (!player.dead && player.active && (player.Center - base.Center).Length() < 400f && !player.creativeGodMode)
				{
					player.AddBuff(195, 3);
				}
			}
			if (ai[1] > 0f)
			{
				ai[1] -= 1f;
			}
			if (!(ai[1] <= 0f))
			{
				break;
			}
			ai[1] = 60f;
			if (Main.netMode != 1)
			{
				int num51 = lifeMax / 20;
				if (num51 > lifeMax - life)
				{
					num51 = lifeMax - life;
				}
				if (num51 > 0)
				{
					life += num51;
					HealEffect(num51);
					netUpdate = true;
				}
			}
			break;
		}
		case 561:
		case 562:
		case 563:
		{
			bool num36 = localAI[3] >= 60f;
			if (ai[1] == 82f)
			{
				SoundEngine.PlayTrackedSound(SoundID.DD2_JavelinThrowersAttack, base.Center);
				num22 = 7;
				style = SoundID.DD2_JavelinThrowersTaunt;
			}
			flag21 = DD2Event.EnemiesShouldChasePlayers;
			flag24 = true;
			flag12 = true;
			flag15 = ai[1] > 82f;
			num8 = 90;
			num9 = 82;
			num12 = 662;
			if (type == 563)
			{
				num12 = 685;
			}
			vector.Y -= 14f;
			num15 = 0f;
			num16 = 0.5f;
			num13 = 600f;
			num10 = 13f;
			if (!num36)
			{
				num13 = 1f;
				num24 = 0.01f + localAI[3] / 60f * 0.05f;
			}
			if (type == 561)
			{
				num23 = 0.88f;
				num16 = 0.6f;
				num11 = GetAttackDamage_ForProjectiles(15f, 10f);
				num10 = 11.5f;
				num13 -= 100f;
			}
			if (type == 562)
			{
				num23 = 0.94f;
				num16 = 0.5f;
				num11 = GetAttackDamage_ForProjectiles(30f, 20f);
				num10 = 12.2f;
				num13 -= 50f;
			}
			if (type == 563)
			{
				num23 = 1f;
				num16 = 0.4f;
				num11 = GetAttackDamage_ForProjectiles(45f, 30f);
			}
			break;
		}
		case 555:
		case 556:
		case 557:
		{
			num22 = 800;
			style = SoundID.DD2_GoblinBomberScream;
			bool num33 = localAI[3] >= 60f;
			flag21 = DD2Event.EnemiesShouldChasePlayers;
			flag24 = true;
			flag12 = true;
			flag15 = ai[1] > 18f;
			num8 = 42;
			num9 = 18;
			num12 = 681;
			num11 = 10;
			vector.Y -= 14f;
			num15 = 0.4f;
			num16 = 0.5f;
			num13 = 280f;
			num10 = 6f;
			if (!num33)
			{
				num13 = 1f;
				num24 = 0.01f + localAI[3] / 60f * 0.05f;
			}
			if (type == 555)
			{
				num23 = 0.88f;
				num16 = 0.6f;
				num11 = GetAttackDamage_ForProjectiles(20f, 15f);
			}
			if (type == 556)
			{
				num23 = 0.88f;
				num16 = 0.6f;
				num11 = GetAttackDamage_ForProjectiles(30f, 25f);
			}
			if (type == 557)
			{
				num23 = 1.12f;
				num16 = 0.4f;
				num11 = GetAttackDamage_ForProjectiles(40f, 35f);
			}
			if (ai[1] == (float)num9)
			{
				SoundEngine.PlayTrackedSound(SoundID.DD2_GoblinBomberThrow, base.Center);
			}
			break;
		}
		case 566:
		case 567:
		{
			DelegateMethods.v3_1 = new Vector3(0.3f, 0.05f, 0.45f) * 1.5f;
			Utils.PlotTileLine(base.Top, base.Bottom, width, DelegateMethods.CastLightOpen);
			flag21 = DD2Event.EnemiesShouldChasePlayers;
			bool num43 = localAI[3] >= 120f;
			if (!num43)
			{
				num24 = 0f;
			}
			if (num43)
			{
				dontTakeDamage = false;
				break;
			}
			dontTakeDamage = true;
			velocity.X = 0f;
			flag24 = true;
			flag20 = true;
			ai[3] = 0f;
			if (localAI[3] == 0f)
			{
				alpha = 255;
			}
			localAI[3] += 1f;
			float num44 = localAI[3];
			if (num44 >= 110f)
			{
				alpha -= 26;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			if (num44 >= 100f)
			{
				int num45 = (int)localAI[3] / 20;
				float num46 = base.Size.Length() / 2f;
				num46 /= 20f;
				int maxValue = 5;
				for (int num47 = 0; num47 < num45 * 2; num47++)
				{
					if (Main.rand.Next(maxValue) == 0)
					{
						Dust dust5 = Dust.NewDustDirect(position, width, height, 236, velocity.X * 1f);
						dust5.scale = 1f;
						dust5.fadeIn = 0.3f;
						dust5.velocity = new Vector2(Main.rand.NextFloatDirection() * 1f, 0f - dust5.velocity.Length()) * 1.25f * num46;
					}
				}
			}
			else
			{
				int num48 = (int)localAI[3] / 10;
				float num49 = base.Size.Length() / 2f;
				num49 /= 20f;
				int maxValue2 = 5;
				for (int num50 = 0; (float)num50 < (float)num48 * 1.3f; num50++)
				{
					if (Main.rand.Next(maxValue2) == 0)
					{
						Dust dust6 = Dust.NewDustDirect(position + new Vector2(-width / 2, 8f), width + width, height, 27, velocity.X * 1f, 0f, 100);
						dust6.scale = 1.1f;
						dust6.fadeIn = 0.1f;
						dust6.velocity = new Vector2(Main.rand.NextFloatDirection() * 0.1f, 0f - dust6.velocity.Length()) * 1.05f * num49 * Main.rand.NextFloat();
						dust6.velocity.Y *= Utils.GetLerpValue((float)width * 0.75f, 0f, Math.Abs(dust6.position.X - base.Center.X), clamped: true);
					}
				}
			}
			if (num44 > 100f && (int)num44 % 4 == 0)
			{
				Gore.NewGoreDirect(base.Left, new Vector2(0f, -3f), Utils.SelectRandom<int>(Main.rand, 971, 972), 0.85f).velocity.X *= 0.8f;
			}
			break;
		}
		case 620:
		{
			flag27 = wet;
			flag30 = false;
			flag16 = true;
			num20 = 150f;
			num19 = 20f;
			bool dayTime = Main.dayTime;
			flag21 = !dayTime;
			flag24 = true;
			flag12 = true;
			flag15 = ai[1] > 40f;
			num8 = 60;
			num9 = 40;
			if (ai[1] > 10f && ai[1] <= 40f && (int)ai[1] % 5 == 0)
			{
				num9 = (int)ai[1] - 1;
			}
			num12 = 811;
			vector.X -= 4 * direction;
			vector.Y -= 20f;
			num15 = 0.15f;
			num16 = 2.5f;
			num13 = 600f;
			num10 = 13f;
			num17 = 1;
			num18 = 0f;
			num11 = GetAttackDamage_ForProjectiles(40f, 30f);
			num23 = 8f;
			num24 *= 3f;
			num25 = 0.9f;
			if (ai[0] > 0f)
			{
				if (ai[1] == 40f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_DrakinShot, base.Center);
				}
				else if (ai[1] == 60f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_DrakinBreathIn, base.Center);
				}
			}
			position += netOffset;
			if (alpha == 255)
			{
				spriteDirection = direction;
				velocity.Y = -6f;
				netUpdate = true;
				for (int i = 0; i < 35; i++)
				{
					Dust dust = Dust.NewDustDirect(position, width, height, 5);
					dust.velocity *= 1f;
					dust.scale = 1f + Main.rand.NextFloat() * 0.5f;
					dust.fadeIn = 1.5f + Main.rand.NextFloat() * 0.5f;
					dust.velocity += velocity * 0.5f;
				}
			}
			alpha -= 15;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (alpha != 0)
			{
				for (int j = 0; j < 2; j++)
				{
					Dust dust2 = Dust.NewDustDirect(position, width, height, 5);
					dust2.velocity *= 1f;
					dust2.scale = 1f + Main.rand.NextFloat() * 0.5f;
					dust2.fadeIn = 1.5f + Main.rand.NextFloat() * 0.5f;
					dust2.velocity += velocity * 0.3f;
				}
			}
			if (Main.rand.Next(3) == 0)
			{
				Dust.NewDustDirect(position, width, height, 5, 0f, 0f, 50, default(Color), 1.3f).velocity = Vector2.Zero;
			}
			position -= netOffset;
			if (dayTime)
			{
				flag12 = false;
				flag24 = false;
				flag23 = true;
			}
			else
			{
				if (velocity.Y != 0f || !((float)targetData.Hitbox.Bottom < base.Top.Y) || !(Math.Abs(base.Center.X - (float)targetData.Hitbox.Center.X) < (float)(width * 3)) || !Collision.CanHit(base.Hitbox.TopLeft(), base.Hitbox.Width, base.Hitbox.Height, targetData.Hitbox.TopLeft(), targetData.Hitbox.Width, targetData.Hitbox.Height))
				{
					break;
				}
				int num32 = (int)((base.Bottom.Y - 16f - (float)targetData.Hitbox.Bottom) / 16f);
				if (num32 < 27)
				{
					if (num32 < 11)
					{
						velocity.Y = -11f;
					}
					else if (num32 < 15)
					{
						velocity.Y = -13f;
					}
					else if (num32 < 19)
					{
						velocity.Y = -14f;
					}
					else
					{
						velocity.Y = -15.9f;
					}
				}
			}
			break;
		}
		}
		if (flag28)
		{
			bool flag31 = velocity.Y == 0f;
			for (int num52 = 0; num52 < Main.maxNPCs; num52++)
			{
				if (num52 != whoAmI && Main.npc[num52].active && Main.npc[num52].type == type && Math.Abs(position.X - Main.npc[num52].position.X) + Math.Abs(position.Y - Main.npc[num52].position.Y) < (float)width)
				{
					if (position.X < Main.npc[num52].position.X)
					{
						velocity.X -= num31;
					}
					else
					{
						velocity.X += num31;
					}
					if (position.Y < Main.npc[num52].position.Y)
					{
						velocity.Y -= num31;
					}
					else
					{
						velocity.Y += num31;
					}
				}
			}
			if (flag31)
			{
				velocity.Y = 0f;
			}
		}
		if (flag29)
		{
			if (localAI[3] == 0f)
			{
				alpha = 255;
			}
			if (localAI[3] == 30f)
			{
				SoundEngine.PlayTrackedSound(SoundID.DD2_EtherianPortalSpawnEnemy, base.Center);
			}
			if (localAI[3] < 60f)
			{
				localAI[3] += 1f;
				alpha -= 5;
				if (alpha < 0)
				{
					alpha = 0;
				}
				int num53 = (int)localAI[3] / 10;
				float num54 = base.Size.Length() / 2f;
				num54 /= 20f;
				int maxValue3 = 5;
				if (type == 576 || type == 577)
				{
					maxValue3 = 1;
				}
				for (int num55 = 0; num55 < num53; num55++)
				{
					if (Main.rand.Next(maxValue3) == 0)
					{
						Dust dust9 = Dust.NewDustDirect(position, width, height, 27, velocity.X * 1f, 0f, 100);
						dust9.scale = 0.55f;
						dust9.fadeIn = 0.7f;
						dust9.velocity *= 0.1f * num54;
						dust9.velocity += velocity;
					}
				}
			}
		}
		if (flag27)
		{
			noGravity = true;
			TargetClosest(faceTarget: false);
			if (collideX)
			{
				velocity.X = 0f - oldVelocity.X;
			}
			if (velocity.X != 0f)
			{
				direction = Math.Sign(direction);
			}
			if (Collision.CanHit(position, width, height, targetData.Position, targetData.Width, targetData.Height))
			{
				Vector2 value = targetData.Center - base.Center;
				value.Normalize();
				value *= num28;
				velocity = Vector2.Lerp(velocity, value, amount);
				return;
			}
			float num56 = num28;
			if (velocity.Y > 0f)
			{
				num56 = num29;
			}
			if (velocity.Y < 0f)
			{
				num56 = num30;
			}
			Vector2 value2 = new Vector2(direction, -1f);
			value2.Normalize();
			value2 *= num56;
			if (num56 < num28)
			{
				velocity = Vector2.Lerp(velocity, value2, amount2);
			}
			else
			{
				velocity = Vector2.Lerp(velocity, value2, amount3);
			}
			return;
		}
		bool flag32 = false;
		if ((flag12 || flag5) && ai[0] > 0f)
		{
			flag18 = false;
		}
		if (flag12 && ai[1] > 0f)
		{
			flag22 = true;
		}
		if (flag5 && ai[0] > 0f)
		{
			flag22 = true;
		}
		if (flag5)
		{
			if (ai[0] < 0f)
			{
				ai[0] += 1f;
				flag = false;
			}
			if (ai[0] == 0f && (velocity.Y == 0f || flag6) && targetData.Type != NPCTargetType.None && (Collision.CanHit(position, width, height, targetData.Position, targetData.Width, targetData.Height) || Collision.CanHitLine(position, width, height, targetData.Position, targetData.Width, targetData.Height)) && (targetData.Center - base.Center).Length() < num4)
			{
				ai[0] = num5;
				netUpdate = true;
			}
			if (ai[0] > 0f)
			{
				spriteDirection = direction * num27;
				if (flag7)
				{
					velocity.X *= num7;
					flag24 = true;
					flag20 = true;
					ai[3] = 0f;
					netUpdate = true;
				}
				ai[0] -= 1f;
				if (ai[0] == 0f)
				{
					ai[0] = -num6;
					netUpdate = true;
				}
			}
		}
		if (flag3 && ai[0] > 0f)
		{
			if (flag15)
			{
				nPCTargetingMethod(this, faceTarget: true, null);
				targetData = GetTargetData();
			}
			if (ai[0] == (float)num9)
			{
				Vector2 vector4 = base.Center + vector;
				Vector2 v = targetData.Center - vector4;
				v.Y -= Math.Abs(v.X) * num15;
				Vector2 vector5 = v.SafeNormalize(-Vector2.UnitY) * num10;
				for (int num57 = 0; num57 < num17; num57++)
				{
					Vector2 vector6 = vector5;
					Vector2 vector7 = vector4;
					if (vector2.HasValue)
					{
						vector6 += vector2.Value;
					}
					else
					{
						vector6 += Utils.RandomVector2(Main.rand, 0f - num16, num16);
					}
					vector7 += vector5 * num18;
					if (Main.netMode != 1)
					{
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector7, vector6, num12, num11, 0f, Main.myPlayer);
					}
				}
			}
		}
		if (flag4 && ai[0] > 0f)
		{
			if (velocity.Y != 0f && ai[0] < (float)num2)
			{
				ai[0] = num2;
			}
			if (ai[0] == (float)num)
			{
				velocity.Y = 0f - num3;
			}
		}
		if (!flag17 && flag18)
		{
			if (velocity.Y == 0f && velocity.X * (float)direction < 0f)
			{
				flag19 = true;
			}
			if (position.X == oldPosition.X || ai[3] >= (float)num21 || flag19)
			{
				ai[3] += 1f;
			}
			else if (Math.Abs(velocity.X) > 0.9f && ai[3] > 0f)
			{
				ai[3] -= 1f;
			}
			if (ai[3] > (float)(num21 * 10))
			{
				ai[3] = 0f;
			}
			if (justHit && !flag30)
			{
				ai[3] = 0f;
			}
			if (targetData.Hitbox.Intersects(base.Hitbox))
			{
				ai[3] = 0f;
			}
			if (ai[3] == (float)num21)
			{
				netUpdate = true;
				if (flag30)
				{
					noGravity = true;
					noTileCollide = true;
					position.X += direction * width * 2;
					int num58 = 20;
					float num59 = base.Size.Length() / 2f;
					num59 /= 20f;
					int maxValue4 = 5;
					if (type == 576 || type == 577)
					{
						maxValue4 = 1;
					}
					for (int num60 = 0; num60 < num58; num60++)
					{
						if (Main.rand.Next(maxValue4) == 0)
						{
							Dust dust10 = Dust.NewDustDirect(position, width, height, 27, velocity.X * 1f, 0f, 100);
							dust10.scale = 0.55f;
							dust10.fadeIn = 0.7f;
							dust10.velocity *= 3f * num59;
							dust10.noGravity = true;
							dust10.fadeIn = 1.5f;
							dust10.velocity *= 3f;
						}
					}
					return;
				}
			}
		}
		if (!flag20)
		{
			if (ai[3] < (float)num21 && flag21)
			{
				if (num22 > 0 && Main.rand.Next(num22) == 0)
				{
					SoundEngine.PlayTrackedSound(style, base.Center);
				}
				bool hasValidTarget = HasValidTarget;
				nPCTargetingMethod(this, faceTarget: true, null);
				targetData = GetTargetData();
				if (hasValidTarget != HasValidTarget)
				{
					netUpdate = true;
				}
			}
			else if (!flag22)
			{
				if (flag23)
				{
					EncourageDespawn(10);
				}
				if (velocity.X == 0f)
				{
					if (velocity.Y == 0f)
					{
						ai[2] += 1f;
						if (ai[2] >= 2f)
						{
							direction *= -1;
							spriteDirection = direction * num27;
							ai[2] = 0f;
							netUpdate = true;
						}
					}
				}
				else if (ai[2] != 0f)
				{
					ai[2] = 0f;
					netUpdate = true;
				}
				if (direction == 0)
				{
					direction = 1;
				}
			}
		}
		if (!flag24)
		{
			if (velocity.X < 0f - num23 || velocity.X > num23)
			{
				if (velocity.Y == 0f)
				{
					velocity *= num25;
				}
			}
			else if ((velocity.X < num23 && direction == 1) || (velocity.X > 0f - num23 && direction == -1))
			{
				velocity.X = MathHelper.Clamp(velocity.X + num24 * (float)direction, 0f - num23, num23);
			}
		}
		if (flag12)
		{
			if (confused)
			{
				ai[0] = 0f;
			}
			else
			{
				if (ai[1] > 0f)
				{
					ai[1] -= 1f;
				}
				if (justHit)
				{
					ai[1] = num19;
					ai[0] = 0f;
				}
				if (ai[0] > 0f)
				{
					if (flag15)
					{
						nPCTargetingMethod(this, faceTarget: true, null);
						targetData = GetTargetData();
					}
					if (ai[1] == (float)num9)
					{
						Vector2 vector8 = base.Center + vector;
						Vector2 v2 = targetData.Center - vector8;
						v2.Y -= Math.Abs(v2.X) * num15;
						Vector2 vector9 = v2.SafeNormalize(-Vector2.UnitY) * num10;
						for (int num61 = 0; num61 < num17; num61++)
						{
							Vector2 vector10 = vector8;
							Vector2 vector11 = vector9;
							if (vector2.HasValue)
							{
								vector11 += vector2.Value;
							}
							else
							{
								vector11 += Utils.RandomVector2(Main.rand, 0f - num16, num16);
							}
							vector10 += vector11 * num18;
							if (Main.netMode != 1)
							{
								Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector10, vector11, num12, num11, 0f, Main.myPlayer);
							}
						}
						if (Math.Abs(vector9.Y) > Math.Abs(vector9.X) * 2f)
						{
							ai[0] = ((vector9.Y > 0f) ? 1 : 5);
						}
						else if (Math.Abs(vector9.X) > Math.Abs(vector9.Y) * 2f)
						{
							ai[0] = 3f;
						}
						else
						{
							ai[0] = ((vector9.Y > 0f) ? 2 : 4);
						}
						if (flag16)
						{
							direction = ((vector9.X > 0f) ? 1 : (-1));
						}
					}
					bool flag33 = true;
					if ((velocity.Y != 0f && !flag14) || ai[1] <= 0f)
					{
						bool flag34 = false;
						if (num20 != 0f && ai[1] <= 0f)
						{
							flag34 = true;
						}
						ai[0] = 0f;
						ai[1] = (flag34 ? num20 : 0f);
					}
					else if (!flag13 || (!flag33 && (!flag14 || velocity.Y == 0f)))
					{
						velocity.X *= 0.9f;
						spriteDirection = direction * num27;
					}
				}
				if ((ai[0] <= 0f || flag13) && (velocity.Y == 0f || flag14) && ai[1] <= 0f && targetData.Type != NPCTargetType.None && Collision.CanHit(position, width, height, targetData.Position, targetData.Width, targetData.Height))
				{
					Vector2 vector12 = targetData.Center - base.Center;
					if (vector12.Length() < num13)
					{
						netUpdate = true;
						velocity.X *= 0.5f;
						ai[0] = 3f;
						ai[1] = num8;
						if (Math.Abs(vector12.Y) > Math.Abs(vector12.X) * 2f)
						{
							ai[0] = ((vector12.Y > 0f) ? 1 : 5);
						}
						else if (Math.Abs(vector12.X) > Math.Abs(vector12.Y) * 2f)
						{
							ai[0] = 3f;
						}
						else
						{
							ai[0] = ((vector12.Y > 0f) ? 2 : 4);
						}
						if (flag16)
						{
							direction = ((vector12.X > 0f) ? 1 : (-1));
						}
					}
				}
				if (ai[0] <= 0f || flag13)
				{
					bool flag35 = Distance(targetData.Center) < num14;
					if (flag35 && Collision.CanHitLine(position, width, height, targetData.Position, targetData.Width, targetData.Height))
					{
						ai[3] = 0f;
					}
					if (velocity.X < 0f - num23 || velocity.X > num23 || flag35)
					{
						if (velocity.Y == 0f)
						{
							velocity.X *= num25;
						}
					}
					else if ((velocity.X < num23 && direction == 1) || (velocity.X > 0f - num23 && direction == -1))
					{
						velocity.X = MathHelper.Clamp(velocity.X + num24 * (float)direction, 0f - num23, num23);
					}
				}
			}
		}
		if (velocity.Y == 0f)
		{
			int num62 = (int)(base.Bottom.Y + 7f) / 16;
			int num63 = (int)base.Left.X / 16;
			int num64 = (int)base.Right.X / 16;
			int num65;
			for (num65 = num63; num65 <= num64; num65++)
			{
				num65 = Utils.Clamp(num65, 0, Main.maxTilesX);
				num62 = Utils.Clamp(num62, 0, Main.maxTilesY);
				Tile tile = Main.tile[num65, num62];
				if (tile == null)
				{
					return;
				}
				if (tile.nactive() && Main.tileSolid[tile.type])
				{
					flag32 = true;
					break;
				}
			}
		}
		Point point2 = base.Center.ToTileCoordinates();
		if (WorldGen.InWorld(point2.X, point2.Y, 5) && !noGravity)
		{
			GetTileCollisionParameters(out var cPosition, out var cWidth, out var cHeight);
			Vector2 vector13 = position - cPosition;
			Collision.StepUp(ref cPosition, ref velocity, cWidth, cHeight, ref stepSpeed, ref gfxOffY);
			position = cPosition + vector13;
		}
		if (flag32)
		{
			int num66 = (int)(base.Center.X + num26 * (float)direction) / 16;
			int num67 = ((int)base.Bottom.Y - 15) / 16;
			bool flag36 = position.Y + (float)height - (float)(num67 * 16) > 20f;
			Tile tileSafely = Framing.GetTileSafely(num66 + direction, num67 + 1);
			Tile tileSafely2 = Framing.GetTileSafely(num66, num67 + 1);
			Tile tileSafely3 = Framing.GetTileSafely(num66, num67);
			Tile tileSafely4 = Framing.GetTileSafely(num66, num67 - 1);
			Tile tileSafely5 = Framing.GetTileSafely(num66, num67 - 2);
			Tile tileSafely6 = Framing.GetTileSafely(num66, num67 - 3);
			if (flag8 && tileSafely4.nactive() && (tileSafely4.type == 10 || tileSafely4.type == 388))
			{
				ai[0] += 1f;
				ai[3] = 0f;
				if (ai[0] >= 60f)
				{
					if (flag9)
					{
						ai[1] = 0f;
					}
					int num68 = 5;
					if (Main.tile[num66, num67 - 1].type == 388)
					{
						num68 = 2;
					}
					velocity.X = 0.5f * (float)(-direction);
					ai[1] += num68;
					bool flag37 = false;
					if (ai[1] >= 10f)
					{
						flag37 = true;
						ai[1] = 10f;
					}
					if (flag10)
					{
						flag37 = true;
					}
					WorldGen.KillTile(num66, num67 - 1, fail: true);
					if (Main.netMode != 1 && flag37)
					{
						if (flag11)
						{
							WorldGen.KillTile(num66, num67 - 1);
							if (Main.netMode == 2)
							{
								NetMessage.SendData(17, -1, -1, null, 0, num66, num67 - 1);
							}
						}
						else
						{
							if (tileSafely4.type == 10)
							{
								bool flag38 = WorldGen.OpenDoor(num66, num67 - 1, direction);
								if (!flag38)
								{
									ai[3] = num21;
									netUpdate = true;
								}
								if (Main.netMode == 2 && flag38)
								{
									NetMessage.SendData(19, -1, -1, null, 0, num66, num67 - 1, direction);
								}
							}
							if (tileSafely4.type == 388)
							{
								bool flag39 = WorldGen.ShiftTallGate(num66, num67 - 1, closing: false);
								if (!flag39)
								{
									ai[3] = num21;
									netUpdate = true;
								}
								if (Main.netMode == 2 && flag39)
								{
									NetMessage.SendData(19, -1, -1, null, 4, num66, num67 - 1, direction);
								}
							}
						}
					}
				}
			}
			else
			{
				int num69 = spriteDirection * num27;
				if (velocity.X * (float)num69 > 0f)
				{
					if (height >= 32 && tileSafely5.nactive() && Main.tileSolid[tileSafely5.type])
					{
						netUpdate = true;
						velocity.Y = -7f;
						if (tileSafely6.nactive() && Main.tileSolid[tileSafely6.type])
						{
							velocity.Y = -8f;
						}
					}
					else if (tileSafely4.nactive() && Main.tileSolid[tileSafely4.type])
					{
						velocity.Y = -6f;
						netUpdate = true;
					}
					else if (flag36 && tileSafely3.nactive() && !tileSafely3.topSlope() && Main.tileSolid[tileSafely3.type])
					{
						velocity.Y = -5f;
						netUpdate = true;
					}
					else if (flag25 && (!tileSafely2.nactive() || !Main.tileSolid[tileSafely2.type]) && (!tileSafely.nactive() || !Main.tileSolid[tileSafely.type]))
					{
						velocity.X *= 1.5f;
						velocity.Y = -8f;
						netUpdate = true;
					}
					else if (flag8)
					{
						ai[0] = 0f;
						ai[1] = 0f;
					}
					if (velocity.Y == 0f && flag && ai[3] == 1f)
					{
						velocity.Y = -5f;
						netUpdate = true;
					}
				}
				if (flag26 && velocity.Y == 0f && Math.Abs(targetData.Center.X - base.Center.X) < 100f && Math.Abs(targetData.Center.Y - base.Center.Y) < 50f && Math.Abs(velocity.X) >= 1f && velocity.X * (float)direction > 0f)
				{
					velocity.X = MathHelper.Clamp(velocity.X * 2f, -3f, 3f);
					velocity.Y = -4f;
					netAlways = true;
				}
			}
		}
		else if (flag8)
		{
			ai[0] = 0f;
			ai[1] = 0f;
		}
		if (!flag2 || !noTileCollide)
		{
			return;
		}
		wet = false;
		if (flag29)
		{
			if (alpha < 60)
			{
				alpha += 20;
			}
			localAI[3] = 40f;
		}
		bool num70 = velocity.Y == 0f;
		if (Math.Abs(base.Center.X - targetData.Center.X) > 200f)
		{
			spriteDirection = (direction = ((targetData.Center.X > base.Center.X) ? 1 : (-1)));
			velocity.X = MathHelper.Lerp(velocity.X, direction, 0.05f);
		}
		int num71 = 80;
		int num72 = height;
		Vector2 vector14 = new Vector2(base.Center.X - (float)(num71 / 2), position.Y + (float)height - (float)num72);
		bool flag40 = false;
		if (position.Y + (float)height < targetData.Position.Y + (float)targetData.Height - 16f)
		{
			flag40 = true;
		}
		if (flag40)
		{
			velocity.Y += 0.5f;
		}
		else if (Collision.SolidCollision(vector14, num71, num72) || targetData.Center.Y - base.Center.Y < -100f || (targetData.Center.Y - base.Center.Y < 10f && Math.Abs(targetData.Center.X - base.Center.X) < 60f))
		{
			if (velocity.Y > 0f)
			{
				velocity.Y = 0f;
			}
			if ((double)velocity.Y > -0.2)
			{
				velocity.Y -= 0.025f;
			}
			else
			{
				velocity.Y -= 0.2f;
			}
			if (velocity.Y < -4f)
			{
				velocity.Y = -4f;
			}
		}
		else
		{
			if (velocity.Y < 0f)
			{
				velocity.Y = 0f;
			}
			if ((double)velocity.Y < 0.1)
			{
				velocity.Y += 0.025f;
			}
			else
			{
				velocity.Y += 0.5f;
			}
		}
		if (velocity.Y > 10f)
		{
			velocity.Y = 10f;
		}
		if (num70)
		{
			velocity.Y = 0f;
		}
	}

	private void AI_084_LunaticCultist()
	{
		if (this.ai[0] != -1f && Main.rand.Next(1000) == 0)
		{
			SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(88, 92));
		}
		bool expertMode = Main.expertMode;
		bool flag = life <= lifeMax / 2;
		int num = 120;
		int attackDamage_ForProjectiles = GetAttackDamage_ForProjectiles(35f, 25f);
		if (expertMode)
		{
			num = 90;
		}
		if (Main.getGoodWorld)
		{
			num -= 30;
		}
		int num2 = 18;
		int num3 = 3;
		int attackDamage_ForProjectiles2 = GetAttackDamage_ForProjectiles(30f, 20f);
		if (expertMode)
		{
			num2 = 12;
			num3 = 4;
		}
		if (Main.getGoodWorld)
		{
			num2 = 10;
			num3 = 5;
		}
		int num4 = 80;
		int attackDamage_ForProjectiles3 = GetAttackDamage_ForProjectiles(45f, 30f);
		if (expertMode)
		{
			num4 = 40;
		}
		if (Main.getGoodWorld)
		{
			num4 -= 20;
		}
		int num5 = 20;
		int num6 = 2;
		if (expertMode)
		{
			num5 = 30;
			num6 = 2;
		}
		int num7 = 20;
		int num8 = 3;
		bool flag2 = type == 439;
		bool flag3 = false;
		bool flag4 = false;
		if (flag)
		{
			defense = (int)((float)defDefense * 0.65f);
		}
		if (!flag2)
		{
			if (this.ai[3] < 0f || !Main.npc[(int)this.ai[3]].active || Main.npc[(int)this.ai[3]].type != 439)
			{
				life = 0;
				HitEffect();
				active = false;
				return;
			}
			this.ai[0] = Main.npc[(int)this.ai[3]].ai[0];
			this.ai[1] = Main.npc[(int)this.ai[3]].ai[1];
			if (this.ai[0] == 5f)
			{
				if (justHit)
				{
					life = 0;
					HitEffect();
					active = false;
					if (Main.netMode != 1)
					{
						NetMessage.SendData(23, -1, -1, null, whoAmI);
					}
					NPC obj = Main.npc[(int)this.ai[3]];
					obj.ai[0] = 6f;
					obj.ai[1] = 0f;
					obj.netUpdate = true;
				}
			}
			else
			{
				flag3 = true;
				flag4 = true;
			}
		}
		else if (this.ai[0] == 5f && this.ai[1] >= 120f && this.ai[1] < 420f && justHit)
		{
			this.ai[0] = 0f;
			this.ai[1] = 0f;
			this.ai[3] += 1f;
			velocity = Vector2.Zero;
			netUpdate = true;
			List<int> list = new List<int>();
			for (int i = 0; i < Main.maxNPCs; i++)
			{
				if (Main.npc[i].active && Main.npc[i].type == 440 && Main.npc[i].ai[3] == (float)whoAmI)
				{
					list.Add(i);
				}
			}
			int num9 = 10;
			if (Main.expertMode)
			{
				num9 = 3;
			}
			foreach (int item in list)
			{
				NPC nPC = Main.npc[item];
				if (nPC.localAI[1] == localAI[1] && num9 > 0)
				{
					num9--;
					nPC.life = 0;
					nPC.HitEffect();
					nPC.active = false;
					if (Main.netMode != 1)
					{
						NetMessage.SendData(23, -1, -1, null, item);
					}
				}
				else if (num9 > 0)
				{
					num9--;
					nPC.life = 0;
					nPC.HitEffect();
					nPC.active = false;
				}
			}
			Main.projectile[(int)this.ai[2]].ai[1] = -1f;
			Main.projectile[(int)this.ai[2]].netUpdate = true;
		}
		Vector2 center = base.Center;
		Player player = Main.player[target];
		float num10 = 5600f;
		if (target < 0 || target == 255 || player.dead || !player.active || Vector2.Distance(player.Center, center) > num10)
		{
			TargetClosest(faceTarget: false);
			player = Main.player[target];
			netUpdate = true;
		}
		if (player.dead || !player.active || Vector2.Distance(player.Center, center) > num10)
		{
			life = 0;
			HitEffect();
			active = false;
			if (Main.netMode != 1)
			{
				NetMessage.SendData(28, -1, -1, null, whoAmI, -1f);
			}
			new List<int>().Add(whoAmI);
			for (int j = 0; j < Main.maxNPCs; j++)
			{
				if (Main.npc[j].active && Main.npc[j].type == 440 && Main.npc[j].ai[3] == (float)whoAmI)
				{
					Main.npc[j].life = 0;
					Main.npc[j].HitEffect();
					Main.npc[j].active = false;
					if (Main.netMode != 1)
					{
						NetMessage.SendData(28, -1, -1, null, whoAmI, -1f);
					}
				}
			}
		}
		float num11 = this.ai[3];
		if (localAI[0] == 0f)
		{
			SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 89);
			localAI[0] = 1f;
			alpha = 255;
			rotation = 0f;
			if (Main.netMode != 1)
			{
				this.ai[0] = -1f;
				netUpdate = true;
			}
		}
		if (this.ai[0] == -1f)
		{
			alpha -= 5;
			if (alpha < 0)
			{
				alpha = 0;
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= 420f)
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				netUpdate = true;
			}
			else if (this.ai[1] > 360f)
			{
				velocity *= 0.95f;
				if (localAI[2] != 13f)
				{
					SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 105);
				}
				localAI[2] = 13f;
			}
			else if (this.ai[1] > 300f)
			{
				velocity = -Vector2.UnitY;
				localAI[2] = 10f;
			}
			else if (this.ai[1] > 120f)
			{
				localAI[2] = 1f;
			}
			else
			{
				localAI[2] = 0f;
			}
			flag3 = true;
			flag4 = true;
		}
		if (this.ai[0] == 0f)
		{
			if (this.ai[1] == 0f)
			{
				TargetClosest(faceTarget: false);
			}
			localAI[2] = 10f;
			int num12 = Math.Sign(player.Center.X - center.X);
			if (num12 != 0)
			{
				direction = (spriteDirection = num12);
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= 40f && flag2)
			{
				int num13 = 0;
				if (flag)
				{
					switch ((int)this.ai[3])
					{
					case 0:
						num13 = 0;
						break;
					case 1:
						num13 = 1;
						break;
					case 2:
						num13 = 0;
						break;
					case 3:
						num13 = 5;
						break;
					case 4:
						num13 = 0;
						break;
					case 5:
						num13 = 3;
						break;
					case 6:
						num13 = 0;
						break;
					case 7:
						num13 = 5;
						break;
					case 8:
						num13 = 0;
						break;
					case 9:
						num13 = 2;
						break;
					case 10:
						num13 = 0;
						break;
					case 11:
						num13 = 3;
						break;
					case 12:
						num13 = 0;
						break;
					case 13:
						num13 = 4;
						this.ai[3] = -1f;
						break;
					default:
						this.ai[3] = -1f;
						break;
					}
				}
				else
				{
					switch ((int)this.ai[3])
					{
					case 0:
						num13 = 0;
						break;
					case 1:
						num13 = 1;
						break;
					case 2:
						num13 = 0;
						break;
					case 3:
						num13 = 2;
						break;
					case 4:
						num13 = 0;
						break;
					case 5:
						num13 = 3;
						break;
					case 6:
						num13 = 0;
						break;
					case 7:
						num13 = 1;
						break;
					case 8:
						num13 = 0;
						break;
					case 9:
						num13 = 2;
						break;
					case 10:
						num13 = 0;
						break;
					case 11:
						num13 = 4;
						this.ai[3] = -1f;
						break;
					default:
						this.ai[3] = -1f;
						break;
					}
				}
				int maxValue = 6;
				if (life < lifeMax / 3)
				{
					maxValue = 4;
				}
				if (life < lifeMax / 4)
				{
					maxValue = 3;
				}
				if (expertMode && flag && Main.rand.Next(maxValue) == 0 && num13 != 0 && num13 != 4 && num13 != 5 && CountNPCS(523) < 10)
				{
					num13 = 6;
				}
				if (num13 == 0)
				{
					float num14 = (float)Math.Ceiling((player.Center + new Vector2(0f, -100f) - center).Length() / 50f);
					if (num14 == 0f)
					{
						num14 = 1f;
					}
					List<int> list2 = new List<int>();
					int num15 = 0;
					list2.Add(whoAmI);
					for (int k = 0; k < Main.maxNPCs; k++)
					{
						if (Main.npc[k].active && Main.npc[k].type == 440 && Main.npc[k].ai[3] == (float)whoAmI)
						{
							list2.Add(k);
						}
					}
					bool flag5 = list2.Count % 2 == 0;
					foreach (int item2 in list2)
					{
						NPC nPC2 = Main.npc[item2];
						Vector2 center2 = nPC2.Center;
						float num16 = (float)((num15 + flag5.ToInt() + 1) / 2) * ((float)Math.PI * 2f) * 0.4f / (float)list2.Count;
						if (num15 % 2 == 1)
						{
							num16 *= -1f;
						}
						if (list2.Count == 1)
						{
							num16 = 0f;
						}
						Vector2 vector = new Vector2(0f, -1f).RotatedBy(num16) * new Vector2(300f, 200f);
						Vector2 vector2 = player.Center + vector - center2;
						nPC2.ai[0] = 1f;
						nPC2.ai[1] = num14 * 2f;
						nPC2.velocity = vector2 / num14;
						if (whoAmI >= nPC2.whoAmI)
						{
							nPC2.position -= nPC2.velocity;
						}
						nPC2.netUpdate = true;
						num15++;
					}
				}
				switch (num13)
				{
				case 1:
					this.ai[0] = 3f;
					this.ai[1] = 0f;
					break;
				case 2:
					this.ai[0] = 2f;
					this.ai[1] = 0f;
					break;
				case 3:
					this.ai[0] = 4f;
					this.ai[1] = 0f;
					break;
				case 4:
					this.ai[0] = 5f;
					this.ai[1] = 0f;
					break;
				}
				if (num13 == 5)
				{
					this.ai[0] = 7f;
					this.ai[1] = 0f;
				}
				if (num13 == 6)
				{
					this.ai[0] = 8f;
					this.ai[1] = 0f;
				}
				netUpdate = true;
			}
		}
		else if (this.ai[0] == 1f)
		{
			flag3 = true;
			localAI[2] = 10f;
			if ((float)(int)this.ai[1] % 2f != 0f && this.ai[1] != 1f)
			{
				position -= velocity;
			}
			this.ai[1] -= 1f;
			if (this.ai[1] <= 0f)
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				this.ai[3] += 1f;
				velocity = Vector2.Zero;
				netUpdate = true;
			}
		}
		else if (this.ai[0] == 2f)
		{
			localAI[2] = 11f;
			Vector2 vec = Vector2.Normalize(player.Center - center);
			if (vec.HasNaNs())
			{
				vec = new Vector2(direction, 0f);
			}
			if (this.ai[1] >= 4f && flag2 && (int)(this.ai[1] - 4f) % num == 0)
			{
				if (Main.netMode != 1)
				{
					List<int> list3 = new List<int>();
					for (int l = 0; l < Main.maxNPCs; l++)
					{
						if (Main.npc[l].active && Main.npc[l].type == 440 && Main.npc[l].ai[3] == (float)whoAmI)
						{
							list3.Add(l);
						}
					}
					foreach (int item3 in list3)
					{
						NPC nPC3 = Main.npc[item3];
						Vector2 center3 = nPC3.Center;
						int num17 = Math.Sign(player.Center.X - center3.X);
						if (num17 != 0)
						{
							nPC3.direction = (nPC3.spriteDirection = num17);
						}
						if (Main.netMode != 1)
						{
							vec = Vector2.Normalize(player.Center - center3 + player.velocity * 20f);
							if (vec.HasNaNs())
							{
								vec = new Vector2(direction, 0f);
							}
							Vector2 vector3 = center3 + new Vector2(direction * 30, 12f);
							for (int m = 0; m < 1; m++)
							{
								Vector2 spinninpoint = vec * (6f + (float)Main.rand.NextDouble() * 4f);
								spinninpoint = spinninpoint.RotatedByRandom(0.5235987901687622);
								Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector3.X, vector3.Y, spinninpoint.X, spinninpoint.Y, 468, 18, 0f, Main.myPlayer);
							}
						}
					}
				}
				if (Main.netMode != 1)
				{
					vec = Vector2.Normalize(player.Center - center + player.velocity * 20f);
					if (vec.HasNaNs())
					{
						vec = new Vector2(direction, 0f);
					}
					Vector2 vector4 = base.Center + new Vector2(direction * 30, 12f);
					for (int n = 0; n < 1; n++)
					{
						Vector2 vector5 = vec * 4f;
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector4.X, vector4.Y, vector5.X, vector5.Y, 464, attackDamage_ForProjectiles, 0f, Main.myPlayer, 0f, 1f);
					}
				}
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= (float)(4 + num))
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				this.ai[3] += 1f;
				velocity = Vector2.Zero;
				netUpdate = true;
			}
		}
		else if (this.ai[0] == 3f)
		{
			localAI[2] = 11f;
			Vector2 vec2 = Vector2.Normalize(player.Center - center);
			if (vec2.HasNaNs())
			{
				vec2 = new Vector2(direction, 0f);
			}
			if (this.ai[1] >= 4f && flag2 && (int)(this.ai[1] - 4f) % num2 == 0)
			{
				if ((int)(this.ai[1] - 4f) / num2 == 2)
				{
					List<int> list4 = new List<int>();
					for (int num18 = 0; num18 < Main.maxNPCs; num18++)
					{
						if (Main.npc[num18].active && Main.npc[num18].type == 440 && Main.npc[num18].ai[3] == (float)whoAmI)
						{
							list4.Add(num18);
						}
					}
					if (Main.netMode != 1)
					{
						foreach (int item4 in list4)
						{
							NPC nPC4 = Main.npc[item4];
							Vector2 center4 = nPC4.Center;
							int num19 = Math.Sign(player.Center.X - center4.X);
							if (num19 != 0)
							{
								nPC4.direction = (nPC4.spriteDirection = num19);
							}
							if (Main.netMode != 1)
							{
								vec2 = Vector2.Normalize(player.Center - center4 + player.velocity * 20f);
								if (vec2.HasNaNs())
								{
									vec2 = new Vector2(direction, 0f);
								}
								Vector2 vector6 = center4 + new Vector2(direction * 30, 12f);
								for (int num20 = 0; num20 < 1; num20++)
								{
									Vector2 spinninpoint2 = vec2 * (6f + (float)Main.rand.NextDouble() * 4f);
									spinninpoint2 = spinninpoint2.RotatedByRandom(0.5235987901687622);
									Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector6.X, vector6.Y, spinninpoint2.X, spinninpoint2.Y, 468, 18, 0f, Main.myPlayer);
								}
							}
						}
					}
				}
				int num21 = Math.Sign(player.Center.X - center.X);
				if (num21 != 0)
				{
					direction = (spriteDirection = num21);
				}
				if (Main.netMode != 1)
				{
					vec2 = Vector2.Normalize(player.Center - center + player.velocity * 20f);
					if (vec2.HasNaNs())
					{
						vec2 = new Vector2(direction, 0f);
					}
					Vector2 vector7 = base.Center + new Vector2(direction * 30, 12f);
					for (int num22 = 0; num22 < 1; num22++)
					{
						Vector2 spinninpoint3 = vec2 * (6f + (float)Main.rand.NextDouble() * 4f);
						spinninpoint3 = spinninpoint3.RotatedByRandom(0.5235987901687622);
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector7.X, vector7.Y, spinninpoint3.X, spinninpoint3.Y, 467, attackDamage_ForProjectiles2, 0f, Main.myPlayer);
					}
				}
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= (float)(4 + num2 * num3))
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				this.ai[3] += 1f;
				velocity = Vector2.Zero;
				netUpdate = true;
			}
		}
		else if (this.ai[0] == 4f)
		{
			if (flag2)
			{
				localAI[2] = 12f;
			}
			else
			{
				localAI[2] = 11f;
			}
			if (this.ai[1] == 20f && flag2 && Main.netMode != 1)
			{
				List<int> list5 = new List<int>();
				for (int num23 = 0; num23 < Main.maxNPCs; num23++)
				{
					if (Main.npc[num23].active && Main.npc[num23].type == 440 && Main.npc[num23].ai[3] == (float)whoAmI)
					{
						list5.Add(num23);
					}
				}
				foreach (int item5 in list5)
				{
					NPC nPC5 = Main.npc[item5];
					Vector2 center5 = nPC5.Center;
					int num24 = Math.Sign(player.Center.X - center5.X);
					if (num24 != 0)
					{
						nPC5.direction = (nPC5.spriteDirection = num24);
					}
					if (Main.netMode != 1)
					{
						Vector2 vector8 = Vector2.Normalize(player.Center - center5 + player.velocity * 20f);
						if (vector8.HasNaNs())
						{
							vector8 = new Vector2(direction, 0f);
						}
						Vector2 vector9 = center5 + new Vector2(direction * 30, 12f);
						for (int num25 = 0; num25 < 1; num25++)
						{
							Vector2 spinninpoint4 = vector8 * (6f + (float)Main.rand.NextDouble() * 4f);
							spinninpoint4 = spinninpoint4.RotatedByRandom(0.5235987901687622);
							Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector9.X, vector9.Y, spinninpoint4.X, spinninpoint4.Y, 468, 18, 0f, Main.myPlayer);
						}
					}
				}
				if ((int)(this.ai[1] - 20f) % num4 == 0)
				{
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y - 100f, 0f, 0f, 465, attackDamage_ForProjectiles3, 0f, Main.myPlayer);
				}
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= (float)(20 + num4))
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				this.ai[3] += 1f;
				velocity = Vector2.Zero;
				netUpdate = true;
			}
		}
		else if (this.ai[0] == 5f)
		{
			localAI[2] = 10f;
			if (Vector2.Normalize(player.Center - center).HasNaNs())
			{
				new Vector2(direction, 0f);
			}
			if (this.ai[1] >= 0f && this.ai[1] < 30f)
			{
				flag3 = true;
				flag4 = true;
				float num26 = (this.ai[1] - 0f) / 30f;
				alpha = (int)(num26 * 255f);
			}
			else if (this.ai[1] >= 30f && this.ai[1] < 90f)
			{
				if (this.ai[1] == 30f && Main.netMode != 1 && flag2)
				{
					localAI[1] += 1f;
					Vector2 spinningpoint = new Vector2(180f, 0f);
					List<int> list6 = new List<int>();
					for (int num27 = 0; num27 < Main.maxNPCs; num27++)
					{
						if (Main.npc[num27].active && Main.npc[num27].type == 440 && Main.npc[num27].ai[3] == (float)whoAmI)
						{
							list6.Add(num27);
						}
					}
					int num28 = 6 - list6.Count;
					if (num28 > 2)
					{
						num28 = 2;
					}
					int num29 = list6.Count + num28 + 1;
					float[] array = new float[num29];
					for (int num30 = 0; num30 < array.Length; num30++)
					{
						array[num30] = Vector2.Distance(base.Center + spinningpoint.RotatedBy((float)num30 * ((float)Math.PI * 2f) / (float)num29 - (float)Math.PI / 2f), player.Center);
					}
					int num31 = 0;
					for (int num32 = 1; num32 < array.Length; num32++)
					{
						if (array[num31] > array[num32])
						{
							num31 = num32;
						}
					}
					num31 = ((num31 >= num29 / 2) ? (num31 - num29 / 2) : (num31 + num29 / 2));
					int num33 = num28;
					for (int num34 = 0; num34 < array.Length; num34++)
					{
						if (num31 != num34)
						{
							Vector2 center6 = base.Center + spinningpoint.RotatedBy((float)num34 * ((float)Math.PI * 2f) / (float)num29 - (float)Math.PI / 2f);
							if (num33-- > 0)
							{
								int num35 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)center6.X, (int)center6.Y + height / 2, 440, whoAmI);
								Main.npc[num35].ai[3] = whoAmI;
								Main.npc[num35].netUpdate = true;
								Main.npc[num35].localAI[1] = localAI[1];
							}
							else
							{
								int num36 = list6[-num33 - 1];
								Main.npc[num36].Center = center6;
								NetMessage.SendData(23, -1, -1, null, num36);
							}
						}
					}
					this.ai[2] = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, 0f, 0f, 490, 0, 0f, Main.myPlayer, 0f, whoAmI);
					base.Center += spinningpoint.RotatedBy((float)num31 * ((float)Math.PI * 2f) / (float)num29 - (float)Math.PI / 2f);
					netUpdate = true;
					list6.Clear();
				}
				flag3 = true;
				flag4 = true;
				alpha = 255;
				if (flag2)
				{
					Vector2 vector10 = Main.projectile[(int)this.ai[2]].Center;
					vector10 -= base.Center;
					if (vector10 == Vector2.Zero)
					{
						vector10 = -Vector2.UnitY;
					}
					vector10.Normalize();
					if (Math.Abs(vector10.Y) < 0.77f)
					{
						localAI[2] = 11f;
					}
					else if (vector10.Y < 0f)
					{
						localAI[2] = 12f;
					}
					else
					{
						localAI[2] = 10f;
					}
					int num37 = Math.Sign(vector10.X);
					if (num37 != 0)
					{
						direction = (spriteDirection = num37);
					}
				}
				else
				{
					Vector2 vector11 = Main.projectile[(int)Main.npc[(int)this.ai[3]].ai[2]].Center;
					vector11 -= base.Center;
					if (vector11 == Vector2.Zero)
					{
						vector11 = -Vector2.UnitY;
					}
					vector11.Normalize();
					if (Math.Abs(vector11.Y) < 0.77f)
					{
						localAI[2] = 11f;
					}
					else if (vector11.Y < 0f)
					{
						localAI[2] = 12f;
					}
					else
					{
						localAI[2] = 10f;
					}
					int num38 = Math.Sign(vector11.X);
					if (num38 != 0)
					{
						direction = (spriteDirection = num38);
					}
				}
			}
			else if (this.ai[1] >= 90f && this.ai[1] < 120f)
			{
				flag3 = true;
				flag4 = true;
				float num39 = (this.ai[1] - 90f) / 30f;
				alpha = 255 - (int)(num39 * 255f);
			}
			else if (this.ai[1] >= 120f && this.ai[1] < 420f)
			{
				flag4 = true;
				alpha = 0;
				if (flag2)
				{
					Vector2 vector12 = Main.projectile[(int)this.ai[2]].Center;
					vector12 -= base.Center;
					if (vector12 == Vector2.Zero)
					{
						vector12 = -Vector2.UnitY;
					}
					vector12.Normalize();
					if (Math.Abs(vector12.Y) < 0.77f)
					{
						localAI[2] = 11f;
					}
					else if (vector12.Y < 0f)
					{
						localAI[2] = 12f;
					}
					else
					{
						localAI[2] = 10f;
					}
					int num40 = Math.Sign(vector12.X);
					if (num40 != 0)
					{
						direction = (spriteDirection = num40);
					}
				}
				else
				{
					Vector2 vector13 = Main.projectile[(int)Main.npc[(int)this.ai[3]].ai[2]].Center;
					vector13 -= base.Center;
					if (vector13 == Vector2.Zero)
					{
						vector13 = -Vector2.UnitY;
					}
					vector13.Normalize();
					if (Math.Abs(vector13.Y) < 0.77f)
					{
						localAI[2] = 11f;
					}
					else if (vector13.Y < 0f)
					{
						localAI[2] = 12f;
					}
					else
					{
						localAI[2] = 10f;
					}
					int num41 = Math.Sign(vector13.X);
					if (num41 != 0)
					{
						direction = (spriteDirection = num41);
					}
				}
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= 420f)
			{
				flag4 = true;
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				this.ai[3] += 1f;
				velocity = Vector2.Zero;
				netUpdate = true;
			}
		}
		else if (this.ai[0] == 6f)
		{
			localAI[2] = 13f;
			this.ai[1] += 1f;
			if (this.ai[1] >= 120f)
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				this.ai[3] += 1f;
				velocity = Vector2.Zero;
				netUpdate = true;
			}
		}
		else if (this.ai[0] == 7f)
		{
			localAI[2] = 11f;
			Vector2 vec3 = Vector2.Normalize(player.Center - center);
			if (vec3.HasNaNs())
			{
				vec3 = new Vector2(direction, 0f);
			}
			if (this.ai[1] >= 4f && flag2 && (int)(this.ai[1] - 4f) % num5 == 0)
			{
				if ((int)(this.ai[1] - 4f) / num5 == 2)
				{
					List<int> list7 = new List<int>();
					for (int num42 = 0; num42 < Main.maxNPCs; num42++)
					{
						if (Main.npc[num42].active && Main.npc[num42].type == 440 && Main.npc[num42].ai[3] == (float)whoAmI)
						{
							list7.Add(num42);
						}
					}
					foreach (int item6 in list7)
					{
						NPC nPC6 = Main.npc[item6];
						Vector2 center7 = nPC6.Center;
						int num43 = Math.Sign(player.Center.X - center7.X);
						if (num43 != 0)
						{
							nPC6.direction = (nPC6.spriteDirection = num43);
						}
						if (Main.netMode != 1)
						{
							vec3 = Vector2.Normalize(player.Center - center7 + player.velocity * 20f);
							if (vec3.HasNaNs())
							{
								vec3 = new Vector2(direction, 0f);
							}
							Vector2 vector14 = center7 + new Vector2(direction * 30, 12f);
							for (int num44 = 0; (float)num44 < 5f; num44++)
							{
								Vector2 spinninpoint5 = vec3 * (6f + (float)Main.rand.NextDouble() * 4f);
								spinninpoint5 = spinninpoint5.RotatedByRandom(1.2566370964050293);
								Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector14.X, vector14.Y, spinninpoint5.X, spinninpoint5.Y, 468, 18, 0f, Main.myPlayer);
							}
						}
					}
				}
				int num45 = Math.Sign(player.Center.X - center.X);
				if (num45 != 0)
				{
					direction = (spriteDirection = num45);
				}
				if (Main.netMode != 1)
				{
					vec3 = Vector2.Normalize(player.Center - center + player.velocity * 20f);
					if (vec3.HasNaNs())
					{
						vec3 = new Vector2(direction, 0f);
					}
					Vector2 vector15 = base.Center + new Vector2(direction * 30, 12f);
					float num46 = 8f;
					float num47 = (float)Math.PI * 2f / 25f;
					for (int num48 = 0; (float)num48 < 5f; num48++)
					{
						Vector2 spinningpoint2 = vec3 * num46;
						spinningpoint2 = spinningpoint2.RotatedBy(num47 * (float)num48 - ((float)Math.PI * 2f / 5f - num47) / 2f);
						float ai = (Main.rand.NextFloat() - 0.5f) * 0.3f * ((float)Math.PI * 2f) / 60f;
						int num49 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)vector15.X, (int)vector15.Y + 7, 522, 0, 0f, ai, spinningpoint2.X, spinningpoint2.Y);
						Main.npc[num49].velocity = spinningpoint2;
						Main.npc[num49].netUpdate = true;
					}
				}
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= (float)(4 + num5 * num6))
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				this.ai[3] += 1f;
				velocity = Vector2.Zero;
				netUpdate = true;
			}
		}
		else if (this.ai[0] == 8f)
		{
			localAI[2] = 13f;
			if (this.ai[1] >= 4f && flag2 && (int)(this.ai[1] - 4f) % num7 == 0)
			{
				List<int> list8 = new List<int>();
				for (int num50 = 0; num50 < Main.maxNPCs; num50++)
				{
					if (Main.npc[num50].active && Main.npc[num50].type == 440 && Main.npc[num50].ai[3] == (float)whoAmI)
					{
						list8.Add(num50);
					}
				}
				int num51 = list8.Count + 1;
				if (num51 > 3)
				{
					num51 = 3;
				}
				int num52 = Math.Sign(player.Center.X - center.X);
				if (num52 != 0)
				{
					direction = (spriteDirection = num52);
				}
				if (Main.netMode != 1)
				{
					for (int num53 = 0; num53 < num51; num53++)
					{
						Point point = base.Center.ToTileCoordinates();
						Point point2 = Main.player[target].Center.ToTileCoordinates();
						Vector2 vector16 = Main.player[target].Center - base.Center;
						int num54 = 20;
						int num55 = 3;
						int num56 = 7;
						int num57 = 2;
						int num58 = 0;
						bool flag6 = false;
						if (vector16.Length() > 2000f)
						{
							flag6 = true;
						}
						while (!flag6 && num58 < 100)
						{
							num58++;
							int num59 = Main.rand.Next(point2.X - num54, point2.X + num54 + 1);
							int num60 = Main.rand.Next(point2.Y - num54, point2.Y + num54 + 1);
							if ((num60 < point2.Y - num56 || num60 > point2.Y + num56 || num59 < point2.X - num56 || num59 > point2.X + num56) && (num60 < point.Y - num55 || num60 > point.Y + num55 || num59 < point.X - num55 || num59 > point.X + num55) && !Main.tile[num59, num60].nactive())
							{
								bool flag7 = true;
								if (flag7 && Collision.SolidTiles(num59 - num57, num59 + num57, num60 - num57, num60 + num57))
								{
									flag7 = false;
								}
								if (flag7)
								{
									NewNPC(GetSpawnSourceForNPCFromNPCAI(), num59 * 16 + 8, num60 * 16 + 8, 523, 0, whoAmI);
									flag6 = true;
									break;
								}
							}
						}
					}
				}
			}
			this.ai[1] += 1f;
			if (this.ai[1] >= (float)(4 + num7 * num8))
			{
				this.ai[0] = 0f;
				this.ai[1] = 0f;
				this.ai[3] += 1f;
				velocity = Vector2.Zero;
				netUpdate = true;
			}
		}
		if (!flag2)
		{
			this.ai[3] = num11;
		}
		dontTakeDamage = flag3;
		chaseable = !flag4;
	}

	private void AI_108_DivingFlyer()
	{
		rotation = velocity.ToRotation();
		float normalKnockbackMult = 0.4f;
		float num = 10f;
		float num2 = 200f;
		float num3 = 750f;
		float num4 = 30f;
		float num5 = 30f;
		float num6 = 0.95f;
		int num7 = 50;
		float num8 = 14f;
		float num9 = 30f;
		float num10 = 100f;
		float num11 = 20f;
		float num12 = 0f;
		float num13 = 7f;
		bool flag = true;
		bool flag2 = true;
		int num14 = 120;
		bool flag3 = false;
		bool flag4 = false;
		float num15 = 0.05f;
		float num16 = 0f;
		bool flag5 = false;
		switch (type)
		{
		case 558:
		case 559:
		case 560:
			flag4 = true;
			normalKnockbackMult = 0.7f;
			if (type == 559)
			{
				normalKnockbackMult = 0.5f;
			}
			if (type == 560)
			{
				normalKnockbackMult = 0.2f;
			}
			num = 3f;
			num2 = 400f;
			num3 = 500f;
			num4 = 90f;
			num5 = 20f;
			num6 = 0.95f;
			num7 = 0;
			num8 = 8f;
			num9 = 30f;
			num10 = 150f;
			num11 = 60f;
			num12 = 0.05f;
			num13 = 6f;
			flag2 = false;
			flag5 = true;
			break;
		case 574:
		case 575:
			flag4 = true;
			normalKnockbackMult = 0.6f;
			if (type == 575)
			{
				normalKnockbackMult = 0.4f;
			}
			num = 4f;
			num2 = 400f;
			num3 = 500f;
			num4 = 90f;
			num5 = 30f;
			num6 = 0.95f;
			num7 = 3;
			num8 = 8f;
			num9 = 30f;
			num10 = 150f;
			num11 = 10f;
			num12 = 0.05f;
			num13 = 0f;
			num16 = -0.1f;
			flag3 = true;
			flag5 = true;
			break;
		}
		NPCUtils.TargetClosestOldOnesInvasion(this);
		NPCAimedTarget targetData = GetTargetData();
		if (flag5)
		{
			if (localAI[0] == 0f)
			{
				alpha = 255;
			}
			if (localAI[0] == 30f)
			{
				SoundEngine.PlayTrackedSound(SoundID.DD2_EtherianPortalSpawnEnemy, base.Center);
			}
			if (localAI[0] < 60f)
			{
				localAI[0] += 1f;
				alpha -= 5;
				if (alpha < 0)
				{
					alpha = 0;
				}
				int num17 = (int)localAI[0] / 10;
				float num18 = base.Size.Length() / 2f;
				num18 /= 20f;
				int maxValue = 5;
				if (type == 576 || type == 577)
				{
					maxValue = 1;
				}
				for (int i = 0; i < num17; i++)
				{
					if (Main.rand.Next(maxValue) == 0)
					{
						Dust dust = Dust.NewDustDirect(position, width, height, 27, velocity.X * 1f, 0f, 100);
						dust.scale = 0.55f;
						dust.fadeIn = 0.7f;
						dust.velocity *= 0.1f * num18;
						dust.velocity += velocity;
					}
				}
			}
		}
		if (flag4)
		{
			for (int j = 0; j < Main.maxNPCs; j++)
			{
				if (j != whoAmI && Main.npc[j].active && Main.npc[j].type == type && Math.Abs(position.X - Main.npc[j].position.X) + Math.Abs(position.Y - Main.npc[j].position.Y) < (float)width)
				{
					if (position.X < Main.npc[j].position.X)
					{
						velocity.X -= num15;
					}
					else
					{
						velocity.X += num15;
					}
					if (position.Y < Main.npc[j].position.Y)
					{
						velocity.Y -= num15;
					}
					else
					{
						velocity.Y += num15;
					}
				}
			}
		}
		if (Math.Sign(velocity.X) != 0)
		{
			spriteDirection = -Math.Sign(velocity.X);
		}
		if (rotation < -(float)Math.PI / 2f)
		{
			rotation += (float)Math.PI;
		}
		if (rotation > (float)Math.PI / 2f)
		{
			rotation -= (float)Math.PI;
		}
		num12 *= num11;
		if (ai[0] == 0f)
		{
			knockBackResist = GetKnockbackMultiplier_ScaledByDifficulty(normalKnockbackMult);
			float num19 = num;
			Vector2 center = base.Center;
			Vector2 vector = targetData.Center - center;
			Vector2 vector2 = vector - Vector2.UnitY * num2;
			float num20 = vector.Length();
			vector = Vector2.Normalize(vector) * num19;
			vector2 = Vector2.Normalize(vector2) * num19;
			bool flag6 = Collision.CanHit(base.Center, 1, 1, targetData.Center, 1, 1);
			if (ai[3] >= (float)num14)
			{
				flag6 = true;
			}
			float num21 = 8f;
			flag6 = flag6 && vector.ToRotation() > (float)Math.PI / num21 && vector.ToRotation() < (float)Math.PI - (float)Math.PI / num21;
			if (num20 > num3 || !flag6)
			{
				velocity.X = (velocity.X * (num4 - 1f) + vector2.X) / num4;
				velocity.Y = (velocity.Y * (num4 - 1f) + vector2.Y) / num4;
				if (targetData.Center.Y < base.Center.Y)
				{
					velocity.Y -= 0.2f;
					if (velocity.Y < -10f)
					{
						velocity.Y = -10f;
					}
				}
				if (!flag6)
				{
					ai[3] += 1f;
					if (ai[3] == (float)num14)
					{
						netUpdate = true;
					}
				}
				else
				{
					ai[3] = 0f;
				}
			}
			else
			{
				ai[0] = 1f;
				ai[2] = vector.X;
				ai[3] = vector.Y;
				netUpdate = true;
			}
		}
		else if (ai[0] == 1f)
		{
			knockBackResist = 0f;
			velocity *= num6;
			velocity.Y += num16;
			ai[1] += 1f;
			if (ai[1] == num5)
			{
				if (type == 558 || type == 559 || type == 560)
				{
					localAI[1] = SoundEngine.PlayTrackedSound(SoundID.DD2_WyvernDiveDown, base.Center).ToFloat();
					if (Main.rand.Next(5) == 0)
					{
						localAI[2] = SoundEngine.PlayTrackedSound(SoundID.DD2_WyvernScream, base.Center).ToFloat();
					}
				}
				else if (type == 574 || type == 575)
				{
					localAI[1] = SoundEngine.PlayTrackedSound(SoundID.DD2_KoboldFlyerChargeScream, base.Center).ToFloat();
					SoundEngine.PlayTrackedSound(SoundID.DD2_KoboldIgnite, base.Center);
				}
			}
			if (ai[1] >= num5)
			{
				ai[0] = 2f;
				ai[1] = 0f;
				netUpdate = true;
				Vector2 vector3 = new Vector2(ai[2], ai[3]) + new Vector2(Main.rand.Next(-num7, num7 + 1), Main.rand.Next(-num7, num7 + 1)) * 0.04f;
				vector3.Normalize();
				vector3 *= num8;
				velocity = vector3;
			}
		}
		else if (ai[0] == 2f)
		{
			if (ai[1] >= 20f && (type == 574 || type == 575))
			{
				ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2]));
				if (activeSound == null)
				{
					localAI[2] = SoundEngine.PlayTrackedSound(SoundID.DD2_KoboldIgniteLoop, base.Center).ToFloat();
				}
				else
				{
					activeSound.Position = base.Center;
				}
			}
			knockBackResist = 0f;
			float num22 = num9;
			ai[1] += 1f;
			bool flag7 = Vector2.Distance(base.Center, targetData.Center) > num10 && base.Center.Y > targetData.Center.Y;
			if (flag3)
			{
				flag7 = false;
			}
			if ((ai[1] >= num22 && flag7) || velocity.Length() < num13)
			{
				ai[0] = 0f;
				ai[1] = 0f;
				ai[2] = 0f;
				ai[3] = 0f;
				velocity /= 2f;
				netUpdate = true;
				if (flag)
				{
					ai[1] = 45f;
					ai[0] = 4f;
				}
			}
			else
			{
				Vector2 center2 = base.Center;
				Vector2 vector4 = targetData.Center - center2;
				vector4.Normalize();
				if (vector4.HasNaNs())
				{
					vector4 = new Vector2(direction, 0f);
				}
				velocity = (velocity * (num11 - 1f) + vector4 * (velocity.Length() + num12)) / num11;
			}
			if (flag2 && Collision.SolidCollision(position, width, height))
			{
				ai[0] = 3f;
				ai[1] = 0f;
				ai[2] = 0f;
				ai[3] = 0f;
				netUpdate = true;
			}
		}
		else if (ai[0] == 4f)
		{
			ai[1] -= 3f;
			if (ai[1] <= 0f)
			{
				ai[0] = 0f;
				ai[1] = 0f;
				netUpdate = true;
			}
			velocity *= 0.95f;
		}
		ActiveSound activeSound2 = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]));
		if (activeSound2 != null)
		{
			activeSound2.Position = base.Center;
		}
		else
		{
			localAI[1] = SlotId.Invalid.ToFloat();
		}
		if (type == 558 || type == 559 || type == 560)
		{
			activeSound2 = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2]));
			if (activeSound2 != null)
			{
				activeSound2.Position = base.Center;
			}
			else
			{
				localAI[2] = SlotId.Invalid.ToFloat();
			}
		}
		if (flag2 && ai[0] != 3f && Vector2.Distance(base.Center, targetData.Center) < 64f)
		{
			ai[0] = 3f;
			ai[1] = 0f;
			ai[2] = 0f;
			ai[3] = 0f;
			netUpdate = true;
		}
		if (ai[0] != 3f)
		{
			return;
		}
		position = base.Center;
		width = (height = 192);
		position.X -= width / 2;
		position.Y -= height / 2;
		velocity = Vector2.Zero;
		damage = GetAttackDamage_ScaledByDifficulty(80f);
		alpha = 255;
		if (ai[1] == 0f && (type == 574 || type == 575))
		{
			for (int k = 0; k < 4; k++)
			{
				int num23 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num23].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
			}
			for (int l = 0; l < 20; l++)
			{
				int num24 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 200, default(Color), 3.7f);
				Main.dust[num24].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Main.dust[num24].noGravity = true;
				Main.dust[num24].velocity *= 3f;
				num24 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num24].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 4f;
				Main.dust[num24].velocity *= 2f;
				Main.dust[num24].noGravity = true;
				Main.dust[num24].fadeIn = 2.5f;
			}
			for (int m = 0; m < 6; m++)
			{
				int num25 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 0, default(Color), 2.7f);
				Main.dust[num25].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num25].noGravity = true;
				Main.dust[num25].velocity *= 3f;
			}
			for (int n = 0; n < 12; n++)
			{
				int num26 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
				Main.dust[num26].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
				Main.dust[num26].noGravity = true;
				Main.dust[num26].velocity *= 3f;
			}
			for (int num27 = 0; num27 < 5; num27++)
			{
				int num28 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
				Main.gore[num28].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				Main.gore[num28].velocity *= 0.3f;
				Main.gore[num28].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
				Main.gore[num28].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
			}
		}
		ai[1] += 1f;
		if (ai[1] >= 3f)
		{
			SoundEngine.PlaySound(SoundID.Item14, position);
			life = 0;
			HitEffect();
			active = false;
		}
	}

	private void AI_109_DarkMage()
	{
		bool flag = false;
		bool flag2 = false;
		bool flag3 = true;
		bool flag4 = false;
		int num = 4;
		int num2 = 3;
		int num3 = 0;
		float num4 = 0.2f;
		float num5 = 2f;
		float num6 = -0.2f;
		float num7 = -4f;
		bool flag5 = true;
		float num8 = 2f;
		float num9 = 0.1f;
		float num10 = 1f;
		float num11 = 0.04f;
		bool flag6 = false;
		float num12 = 0.96f;
		bool flag7 = true;
		NPCAimedTarget targetData = GetTargetData();
		if (type == 564 || type == 565)
		{
			flag5 = false;
			rotation = velocity.X * 0.04f;
			spriteDirection = ((direction > 0) ? 1 : (-1));
			num3 = 2;
			num6 = -0.05f;
			num7 = -0.4f;
			num4 = 0.05f;
			num5 = 0.2f;
			num10 = 0.5f;
			num11 = 0.02f;
			num8 = 0.5f;
			num9 = 0.1f;
			localAI[2] = 0f;
			DelegateMethods.v3_1 = new Vector3(0.3f, 0.05f, 0.45f) * 1.5f;
			Utils.PlotTileLine(base.Top, base.Bottom, width, DelegateMethods.CastLightOpen);
			if (ai[0] < 0f)
			{
				ai[0] = MathHelper.Min(ai[0] + 1f, 0f);
			}
			if (ai[0] > 0f)
			{
				flag7 = false;
				flag6 = true;
				num12 = 0.9f;
				ai[0] -= 1f;
				if (ai[0] == 80f && ai[1] == 2f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_DarkMageSummonSkeleton, base.Center);
				}
				if (ai[1] == 2f && ai[0] == 64f && Main.netMode != 1)
				{
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center + new Vector2(direction * 24, -40f), Vector2.Zero, 673, 0, 0f, Main.myPlayer);
					DD2Event.RaiseGoblins(this, base.Center);
				}
				if (ai[1] == 0f && ai[0] == 32f)
				{
					Vector2 vector = (targetData.Center - (base.Center + new Vector2(direction * 10, -16f))).SafeNormalize(Vector2.UnitY) * 14f;
					direction = ((vector.X > 0f) ? 1 : (-1));
					if (Main.netMode != 1)
					{
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center + new Vector2(direction * 10, -16f), vector, 675, 40, 0f, Main.myPlayer);
					}
				}
				if (ai[0] == 126f && ai[1] == 1f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_DarkMageCastHeal, base.Center);
				}
				if (ai[1] == 1f && Main.netMode != 1 && (ai[0] == 40f || ai[0] == 48f || ai[0] == 56f) && WorldUtils.Find(new Vector2(base.Center.X + (float)(direction * 240), base.Center.Y).ToTileCoordinates(), Searches.Chain(new Searches.Down(50), new Terraria.WorldBuilding.Conditions.IsSolid()), out var result))
				{
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), result.ToWorldCoordinates(8f, 0f), Vector2.Zero, 674, 0, 0f, Main.myPlayer);
				}
				if (ai[0] <= 0f)
				{
					float num13 = ai[1];
					ai[1] += 1f;
					if (ai[1] >= 3f)
					{
						ai[1] = 0f;
					}
					ai[0] = -120f;
					if (num13 == 0f)
					{
						ai[0] = -20f;
					}
					netUpdate = true;
				}
			}
			if (ai[0] == 0f && localAI[3] >= 60f)
			{
				bool flag8 = false;
				Vector2 minimum = base.Center + new Vector2(-600f, -200f);
				Vector2 maximum = base.Center + new Vector2(600f, 200f);
				int num14 = 0;
				for (int i = 0; i < Main.maxNPCs; i++)
				{
					NPC nPC = Main.npc[i];
					if (nPC.active && nPC.lifeMax != nPC.life && nPC.Center.Between(minimum, maximum) && ++num14 >= 2)
					{
						flag8 = true;
						break;
					}
				}
				if (!flag8)
				{
					ai[1] = 2f;
				}
				if (ai[1] == 2f && !DD2Event.CanRaiseGoblinsHere(base.Center))
				{
					ai[1] = 0f;
				}
				bool flag9 = true;
				if (ai[1] == 0f && (Distance(targetData.Center) >= 1000f || !Collision.CanHitLine(base.Center, 0, 0, targetData.Center, 0, 0)))
				{
					flag9 = false;
				}
				if (flag9)
				{
					switch ((int)ai[1])
					{
					case 0:
						ai[0] = 97f;
						break;
					case 1:
						ai[0] = 127f;
						break;
					case 2:
						ai[0] = 183f;
						break;
					}
					netUpdate = true;
					flag6 = true;
				}
			}
			if (localAI[3] == 0f)
			{
				alpha = 255;
			}
			if (localAI[3] == 30f)
			{
				SoundEngine.PlayTrackedSound(SoundID.DD2_EtherianPortalSpawnEnemy, base.Center);
			}
			if (localAI[3] < 60f)
			{
				localAI[3] += 1f;
				alpha -= 5;
				if (alpha < 0)
				{
					alpha = 0;
				}
				int num15 = (int)localAI[3] / 10;
				float num16 = base.Size.Length() / 2f;
				num16 /= 20f;
				int maxValue = 5;
				if (type == 576 || type == 577)
				{
					maxValue = 1;
				}
				for (int j = 0; j < num15; j++)
				{
					if (Main.rand.Next(maxValue) == 0)
					{
						Dust dust = Dust.NewDustDirect(position, width, height, 27, velocity.X * 1f, 0f, 100);
						dust.scale = 0.55f;
						dust.fadeIn = 0.7f;
						dust.velocity *= 0.1f * num16;
						dust.velocity += velocity;
					}
				}
			}
		}
		if (justHit)
		{
			localAI[2] = 0f;
		}
		if (!flag2)
		{
			if (localAI[2] >= 0f)
			{
				float num17 = 16f;
				bool flag10 = false;
				bool flag11 = false;
				if (position.X > localAI[0] - num17 && position.X < localAI[0] + num17)
				{
					flag10 = true;
				}
				else if ((velocity.X < 0f && direction > 0) || (velocity.X > 0f && direction < 0))
				{
					flag10 = true;
					num17 += 24f;
				}
				if (position.Y > localAI[1] - num17 && position.Y < localAI[1] + num17)
				{
					flag11 = true;
				}
				if (flag10 && flag11)
				{
					localAI[2] += 1f;
					if (localAI[2] >= 30f && num17 == 16f)
					{
						flag = true;
					}
					if (localAI[2] >= 60f)
					{
						localAI[2] = -180f;
						direction *= -1;
						velocity.X *= -1f;
						collideX = false;
					}
				}
				else
				{
					localAI[0] = position.X;
					localAI[1] = position.Y;
					localAI[2] = 0f;
				}
				if (flag7)
				{
					NPCUtils.TargetClosestOldOnesInvasion(this);
				}
			}
			else
			{
				localAI[2] += 1f;
				direction = ((targetData.Center.X > base.Center.X) ? 1 : (-1));
			}
		}
		int num18 = (int)((position.X + (float)(width / 2)) / 16f) + direction * 2;
		int num19 = (int)((position.Y + (float)height) / 16f);
		int num20 = (int)base.Bottom.Y / 16;
		int num21 = (int)base.Bottom.X / 16;
		if (flag6)
		{
			velocity *= num12;
			return;
		}
		for (int k = num19; k < num19 + num; k++)
		{
			if (Main.tile[num18, k] == null)
			{
				Main.tile[num18, k] = new Tile();
			}
			if ((Main.tile[num18, k].nactive() && Main.tileSolid[Main.tile[num18, k].type]) || Main.tile[num18, k].liquid > 0)
			{
				if (k <= num19 + 1)
				{
					flag4 = true;
				}
				flag3 = false;
				break;
			}
		}
		for (int l = num20; l < num20 + num3; l++)
		{
			if (Main.tile[num21, l] == null)
			{
				Main.tile[num21, l] = new Tile();
			}
			if ((Main.tile[num21, l].nactive() && Main.tileSolid[Main.tile[num21, l].type]) || Main.tile[num21, l].liquid > 0)
			{
				flag4 = true;
				flag3 = false;
				break;
			}
		}
		if (flag5)
		{
			for (int m = num19 - num2; m < num19; m++)
			{
				if (Main.tile[num18, m] == null)
				{
					Main.tile[num18, m] = new Tile();
				}
				if ((Main.tile[num18, m].nactive() && Main.tileSolid[Main.tile[num18, m].type]) || Main.tile[num18, m].liquid > 0)
				{
					flag4 = false;
					flag = true;
					break;
				}
			}
		}
		if (flag)
		{
			flag4 = false;
			flag3 = true;
		}
		if (flag3)
		{
			velocity.Y += num4;
			if (velocity.Y > num5)
			{
				velocity.Y = num5;
			}
		}
		else
		{
			if ((directionY < 0 && velocity.Y > 0f) || flag4)
			{
				velocity.Y += num6;
			}
			if (velocity.Y < num7)
			{
				velocity.Y = num7;
			}
		}
		if (collideX)
		{
			velocity.X = oldVelocity.X * -0.4f;
			if (direction == -1 && velocity.X > 0f && velocity.X < 1f)
			{
				velocity.X = 1f;
			}
			if (direction == 1 && velocity.X < 0f && velocity.X > -1f)
			{
				velocity.X = -1f;
			}
		}
		if (collideY)
		{
			velocity.Y = oldVelocity.Y * -0.25f;
			if (velocity.Y > 0f && velocity.Y < 1f)
			{
				velocity.Y = 1f;
			}
			if (velocity.Y < 0f && velocity.Y > -1f)
			{
				velocity.Y = -1f;
			}
		}
		if (direction == -1 && velocity.X > 0f - num8)
		{
			velocity.X -= num9;
			if (velocity.X > num8)
			{
				velocity.X -= num9;
			}
			else if (velocity.X > 0f)
			{
				velocity.X += num9 / 2f;
			}
			if (velocity.X < 0f - num8)
			{
				velocity.X = 0f - num8;
			}
		}
		else if (direction == 1 && velocity.X < num8)
		{
			velocity.X += num9;
			if (velocity.X < 0f - num8)
			{
				velocity.X += num9;
			}
			else if (velocity.X < 0f)
			{
				velocity.X -= num9 / 2f;
			}
			if (velocity.X > num8)
			{
				velocity.X = num8;
			}
		}
		if (directionY == -1 && velocity.Y > 0f - num10)
		{
			velocity.Y -= num11;
			if (velocity.Y > num10)
			{
				velocity.Y -= num11 * 1.25f;
			}
			else if (velocity.Y > 0f)
			{
				velocity.Y += num11 * 0.75f;
			}
			if (velocity.Y < 0f - num10)
			{
				velocity.Y = 0f - num8;
			}
		}
		else if (directionY == 1 && velocity.Y < num10)
		{
			velocity.Y += num11;
			if (velocity.Y < 0f - num10)
			{
				velocity.Y += num11 * 1.25f;
			}
			else if (velocity.Y < 0f)
			{
				velocity.Y -= num11 * 0.75f;
			}
			if (velocity.Y > num10)
			{
				velocity.Y = num10;
			}
		}
	}

	private void AI_111_DD2LightningBug()
	{
		bool flag = true;
		float num = 7f;
		float num2 = 60f;
		float num3 = 60f;
		float num4 = 1f;
		float num5 = 0.96f;
		int num6 = 30;
		int num7 = 20;
		float num8 = 200f;
		int num9 = 40;
		int num10 = 438;
		float num11 = 10f;
		float num12 = 100f;
		bool flag2 = false;
		float num13 = 0.05f;
		Vector2 center = base.Center;
		NPCUtils.TargetClosestOldOnesInvasion(this);
		NPCAimedTarget targetData = GetTargetData();
		bool flag3 = false;
		int num14 = type;
		if (num14 == 578)
		{
			num = 4f;
			num2 = 20f;
			num3 = 20f;
			flag3 = true;
			flag2 = true;
			num13 = 0.1f;
			num10 = 682;
			num9 = 50;
			num11 = 10f;
			num12 = 50f;
			num6 = 5;
			num7 = 30;
			center += new Vector2(-spriteDirection * 20, 10f);
			position += netOffset;
			if (Main.rand.Next(15) == 0)
			{
				Vector2 vector = position;
				if (direction == -1)
				{
					vector.X += width / 2;
				}
				Dust dust = Dust.NewDustDirect(vector, width / 2, height, 272);
				dust.scale = 0.65f;
				dust.velocity.Y -= 0.8f;
				if (dust.velocity.X * (float)direction > 0f)
				{
					dust.velocity.X *= -1f;
				}
				if (dust.velocity.Y > 0f)
				{
					dust.velocity *= -0.5f;
				}
			}
			if (Main.rand.Next(80) == 0)
			{
				Vector2 vector2 = (Main.rand.NextFloat() * ((float)Math.PI * 2f)).ToRotationVector2();
				Dust dust2 = Dust.NewDustPerfect(base.Center, 272, vector2);
				dust2.velocity *= 1.1f;
				dust2.noGravity = true;
				dust2.customData = this;
				Dust dust3 = Dust.NewDustPerfect(base.Center, 272, vector2);
				dust3.velocity *= 1.5f;
				dust3.noGravity = true;
				dust3.customData = this;
			}
			position -= netOffset;
		}
		if (flag3)
		{
			if (localAI[1] == 0f)
			{
				alpha = 255;
			}
			if (localAI[1] == 30f)
			{
				SoundEngine.PlayTrackedSound(SoundID.DD2_EtherianPortalSpawnEnemy, base.Center);
			}
			if (localAI[1] < 60f)
			{
				localAI[1] += 1f;
				alpha -= 5;
				if (alpha < 0)
				{
					alpha = 0;
				}
				int num15 = (int)localAI[1] / 10;
				float num16 = base.Size.Length() / 2f;
				num16 /= 20f;
				int maxValue = 5;
				if (type == 576 || type == 577)
				{
					maxValue = 1;
				}
				for (int i = 0; i < num15; i++)
				{
					if (Main.rand.Next(maxValue) == 0)
					{
						Dust dust4 = Dust.NewDustDirect(position, width, height, 27, velocity.X * 1f, 0f, 100);
						dust4.scale = 0.55f;
						dust4.fadeIn = 0.7f;
						dust4.velocity *= 0.1f * num16;
						dust4.velocity += velocity;
					}
				}
			}
		}
		if (flag2)
		{
			for (int j = 0; j < Main.maxNPCs; j++)
			{
				if (j != whoAmI && Main.npc[j].active && Main.npc[j].type == type && Math.Abs(position.X - Main.npc[j].position.X) + Math.Abs(position.Y - Main.npc[j].position.Y) < (float)width)
				{
					if (position.X < Main.npc[j].position.X)
					{
						velocity.X -= num13;
					}
					else
					{
						velocity.X += num13;
					}
					if (position.Y < Main.npc[j].position.Y)
					{
						velocity.Y -= num13;
					}
					else
					{
						velocity.Y += num13;
					}
				}
			}
		}
		rotation = Math.Abs(velocity.X) * (float)direction * 0.1f;
		spriteDirection = direction;
		Vector2 vector3 = center;
		Vector2 vector4 = targetData.Center - vector3;
		Vector2 vector5 = vector4.SafeNormalize(Vector2.UnitY) * num;
		bool flag4 = Collision.CanHit(base.Center, 1, 1, targetData.Center, 1, 1);
		if (localAI[0] < 0f)
		{
			localAI[0] += 1f;
		}
		if (!flag)
		{
			velocity = (velocity * (num2 - 1f) + vector5) / num2;
			EncourageDespawn(10);
		}
		else if (vector4.Length() > num8 || !flag4)
		{
			velocity = (velocity * (num3 - 1f) + vector5) / num3;
		}
		else if (vector4.Y < num12)
		{
			velocity.Y -= 0.03f;
		}
		else if (localAI[0] >= 0f)
		{
			velocity *= num5;
			if (velocity.Length() < num4 && Main.netMode != 1)
			{
				localAI[0] += 1f;
				if (localAI[0] >= (float)num6)
				{
					localAI[0] = -num7;
					direction = (spriteDirection = ((vector5.X > 0f) ? 1 : (-1)));
					vector5 = vector4 + Utils.RandomVector2(Main.rand, -25f, 25f);
					vector5.X *= 1f + (float)Main.rand.Next(-20, 21) * 0.005f;
					vector5.Y *= 1f + (float)Main.rand.Next(-20, 21) * 0.005f;
					vector5 = vector5.SafeNormalize(Vector2.UnitY) * num11;
					vector5.X *= 1f + (float)Main.rand.Next(-20, 21) * (1f / 160f);
					vector5.Y *= 1f + (float)Main.rand.Next(-20, 21) * (1f / 160f);
					Projectile.NewProjectile(GetSpawnSource_ForProjectile(), vector3, vector5, num10, num9, 0f, Main.myPlayer);
				}
			}
		}
		if (!flag)
		{
			return;
		}
		bool flag5 = false;
		if (targetData.Center.Y < base.Center.Y)
		{
			flag5 = true;
		}
		if (!flag5)
		{
			Point point = base.Center.ToTileCoordinates();
			if (WorldGen.InWorld(point.X, point.Y, 2))
			{
				Tile tile = Main.tile[point.X, point.Y];
				if (tile != null && tile.active() && WorldGen.SolidTile(tile))
				{
					flag5 = true;
				}
			}
		}
		if (flag5)
		{
			velocity.Y -= 0.2f;
			if (velocity.Y < -10f)
			{
				velocity.Y = -10f;
			}
		}
	}

	public void ReflectProjectiles(Rectangle myRect)
	{
		for (int i = 0; i < 1000; i++)
		{
			if (Main.projectile[i].active && Main.projectile[i].CanBeReflected() && CanReflectProjectile(Main.projectile[i]))
			{
				ReflectProjectile(Main.projectile[i]);
			}
		}
	}

	public bool CanReflectProjectile(Projectile proj)
	{
		bool result = proj.Hitbox.Intersects(base.Hitbox);
		int num = type;
		if (num == 618)
		{
			BloodNautilus_GetMouthPositionAndRotation(out var _, out var _);
		}
		return result;
	}

	public void BloodNautilus_GetMouthPositionAndRotation(out Vector2 mouthPosition, out Vector2 mouthDirection)
	{
		float num = rotation + 0.47123894f * (float)spriteDirection;
		if (spriteDirection == -1)
		{
			num += (float)Math.PI;
		}
		mouthDirection = num.ToRotationVector2();
		mouthPosition = base.Center + mouthDirection * 50f;
	}

	public void ReflectProjectile(Projectile proj)
	{
		SoundEngine.PlaySound(SoundID.Item150, proj.position);
		for (int i = 0; i < 3; i++)
		{
			int num = Dust.NewDust(proj.position, proj.width, proj.height, 31);
			Main.dust[num].velocity *= 0.3f;
		}
		proj.reflected = true;
		proj.hostile = true;
		proj.friendly = false;
		Vector2 vector = Main.player[proj.owner].Center - proj.Center;
		vector.Normalize();
		vector *= proj.oldVelocity.Length();
		proj.velocity = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
		proj.velocity.Normalize();
		proj.velocity *= vector.Length();
		proj.velocity += vector * 20f;
		proj.velocity.Normalize();
		proj.velocity *= vector.Length();
		proj.damage /= 2;
		proj.damage /= 2;
		proj.penetrate = 1;
	}

	public int GetShootingFrame(float circleY)
	{
		int num = -4;
		if (circleY < -0.3f)
		{
			num = 1;
		}
		if (circleY < -0.1f)
		{
			num = 0;
		}
		if (circleY > 0.1f)
		{
			num = 2;
		}
		if (circleY > 0.3f)
		{
			num = 3;
		}
		if (type == 228 || type == 229 || type == 209 || type == 22 || type == 368)
		{
			if (num == -4)
			{
				num = 1;
			}
			if (circleY >= -0.1f)
			{
				num++;
			}
		}
		return num;
	}

	public Tuple<Vector2, float> GetSwingStats(int swingMax, int swingCurrent, int aimDir, int itemWidth, int itemHeight)
	{
		Vector2 zero = Vector2.Zero;
		if ((double)swingCurrent < (double)swingMax * 0.333)
		{
			float num = 10f;
			if (itemWidth > 32)
			{
				num = 14f;
			}
			if (itemWidth >= 52)
			{
				num = 24f;
			}
			if (itemWidth >= 64)
			{
				num = 28f;
			}
			if (itemWidth >= 92)
			{
				num = 38f;
			}
			zero.X = base.Center.X + ((float)itemWidth * 0.5f - num) * (float)aimDir;
			zero.Y = position.Y + 24f;
		}
		else if ((double)swingCurrent < (double)swingMax * 0.666)
		{
			float num2 = 10f;
			if (itemWidth > 32)
			{
				num2 = 18f;
			}
			if (itemWidth >= 52)
			{
				num2 = 24f;
			}
			if (itemWidth >= 64)
			{
				num2 = 28f;
			}
			if (itemWidth >= 92)
			{
				num2 = 38f;
			}
			zero.X = base.Center.X + ((float)itemWidth * 0.5f - num2) * (float)aimDir;
			num2 = 10f;
			if (itemHeight > 32)
			{
				num2 = 8f;
			}
			if (itemHeight > 52)
			{
				num2 = 12f;
			}
			if (itemHeight > 64)
			{
				num2 = 14f;
			}
			zero.Y = position.Y + num2;
		}
		else
		{
			float num3 = 6f;
			if (itemWidth > 32)
			{
				num3 = 14f;
			}
			if (itemWidth >= 48)
			{
				num3 = 18f;
			}
			if (itemWidth >= 52)
			{
				num3 = 24f;
			}
			if (itemWidth >= 64)
			{
				num3 = 28f;
			}
			if (itemWidth >= 92)
			{
				num3 = 38f;
			}
			zero.X = base.Center.X - ((float)itemWidth * 0.5f - num3) * (float)aimDir;
			num3 = 10f;
			if (itemHeight > 32)
			{
				num3 = 10f;
			}
			if (itemHeight > 52)
			{
				num3 = 12f;
			}
			if (itemHeight > 64)
			{
				num3 = 14f;
			}
			zero.Y = position.Y + num3;
		}
		float item = ((float)swingCurrent / (float)swingMax - 0.5f) * (float)(-aimDir) * 3.5f - (float)aimDir * 0.3f;
		return Tuple.Create(zero, item);
	}

	public void TweakSwingStats(int swingMax, int swingCurrent, int aimDir, ref Rectangle itemRectangle)
	{
		if ((double)swingCurrent < (double)swingMax * 0.333)
		{
			if (aimDir == -1)
			{
				itemRectangle.X -= (int)((double)itemRectangle.Width * 1.4 - (double)itemRectangle.Width);
			}
			itemRectangle.Width = (int)((double)itemRectangle.Width * 1.4);
			itemRectangle.Y += (int)((double)itemRectangle.Height * 0.5);
			itemRectangle.Height = (int)((double)itemRectangle.Height * 1.1);
		}
		else if (!((double)swingCurrent < (double)swingMax * 0.666))
		{
			if (aimDir == 1)
			{
				itemRectangle.X -= (int)((double)itemRectangle.Width * 1.2);
			}
			itemRectangle.Width *= 2;
			itemRectangle.Y -= (int)((double)itemRectangle.Height * 1.4 - (double)itemRectangle.Height);
			itemRectangle.Height = (int)((double)itemRectangle.Height * 1.4);
		}
	}

	public bool UsesPartyHat()
	{
		if (type == 441 || type == 37 || type == 633)
		{
			return false;
		}
		if (type == 20 && townNpcVariationIndex == 1)
		{
			return false;
		}
		if (ForcePartyHatOn)
		{
			return true;
		}
		if (!IsAPortraitDummy && IsABestiaryIconDummy)
		{
			return false;
		}
		if (frame.Height > 0 && townNPC)
		{
			return BirthdayParty.PartyIsUp;
		}
		return false;
	}

	public PartyHatColor GetPartyHatColor()
	{
		if (!UsesPartyHat() || string.IsNullOrEmpty(GivenOrTypeName))
		{
			return PartyHatColor.None;
		}
		int num = GivenOrTypeName.Length + GivenOrTypeName[0];
		int num2 = Main.moonPhase;
		if (Main.dayTime)
		{
			num2--;
		}
		num += whoAmI;
		num += num2 * (whoAmI % 2 == 0).ToDirectionInt();
		if (num < 0)
		{
			num += 5;
		}
		num %= 5;
		if (num == 0)
		{
			num++;
		}
		return (PartyHatColor)num;
	}

	public void SetFrameSize()
	{
		Main.instance.LoadNPC(type);
		if (setFrameSize)
		{
			frame = new Rectangle(0, 0, TextureAssets.Npc[type].Width(), TextureAssets.Npc[type].Height() / Main.npcFrameCount[type]);
			setFrameSize = false;
		}
	}

	public bool RedHatSkeletronAdjustmentsEnabled()
	{
		if ((type != 35 || ai[3] != 1f) && (type != 36 || localAI[3] != 1f) && (type != 32 || localAI[3] != 1f))
		{
			if (type == 33)
			{
				return ai[3] == 1f;
			}
			return false;
		}
		return true;
	}

	public void FindFrame()
	{
		position += netOffset;
		int num = 1;
		if (!Main.dedServ)
		{
			if (!TextureAssets.Npc[type].IsLoaded)
			{
				return;
			}
			num = TextureAssets.Npc[type].Height() / Main.npcFrameCount[type];
		}
		int num2 = 0;
		if (aiAction == 0)
		{
			num2 = ((velocity.Y < 0f) ? 2 : ((velocity.Y > 0f) ? 3 : ((velocity.X != 0f) ? 1 : 0)));
		}
		else if (aiAction == 1)
		{
			num2 = 4;
		}
		switch (type)
		{
		case 695:
			if (ai[0] == 1f)
			{
				frame.Y = num * 2;
			}
			else if (ai[0] == 2f)
			{
				frame.Y = num;
			}
			else
			{
				frame.Y = 0;
			}
			break;
		case 696:
			if (ai[0] == 1f)
			{
				if (frame.Y < 0 || frame.Y >= 8)
				{
					frame.Y = 0;
				}
				if ((frameCounter += 1.0) >= 4.0)
				{
					frameCounter = 0.0;
					if (++frame.Y >= 8)
					{
						frame.Y = 0;
					}
				}
				break;
			}
			if (ai[0] == 2f)
			{
				if (frame.Y < 45 || frame.Y >= 53)
				{
					frame.Y = 45;
				}
				if ((frameCounter += 1.0) >= 4.0)
				{
					frameCounter = 0.0;
					if (++frame.Y >= 53)
					{
						frame.Y = 45;
					}
				}
				break;
			}
			if (frame.Y < 9 || frame.Y >= 17)
			{
				frame.Y = 9;
			}
			if ((frameCounter += 1.0) >= 10.0)
			{
				frameCounter = 0.0;
				if (++frame.Y >= 17)
				{
					frame.Y = 9;
				}
			}
			break;
		case 35:
			if (RedHatSkeletronAdjustmentsEnabled())
			{
				frame.Y = num;
			}
			break;
		case 36:
			if (RedHatSkeletronAdjustmentsEnabled())
			{
				frame.Y = num;
			}
			break;
		case 668:
		{
			int y = frame.Y;
			int num193 = y;
			frame.Width = 180;
			if (ai[0] == 1f)
			{
				spriteDirection = direction;
				int num194 = 12;
				int num195 = 17;
				if (y < num194 || y > num195)
				{
					y = num194;
					frameCounter = 0.0;
					if (!IsABestiaryIconDummy && y != num193)
					{
						SoundEngine.PlaySound(SoundID.DeerclopsScream, base.Center);
					}
				}
				frameCounter += 1.0;
				int sequenceFrame = (int)frameCounter / 4;
				y = FindFrame_Deerclops_GetAttack1Frame(sequenceFrame);
			}
			else if (ai[0] == 2f)
			{
				spriteDirection = direction;
				int num196 = 12;
				int num197 = 18;
				if (y < num196 || y > num197)
				{
					y = num196;
					frameCounter = 0.0;
					if (!IsABestiaryIconDummy && y != num193)
					{
						SoundEngine.PlaySound(SoundID.DeerclopsScream, base.Center);
					}
				}
				frameCounter += 1.0;
				int sequenceFrame2 = (int)frameCounter / 4;
				y = FindFrame_Deerclops_GetAttack2Frame(sequenceFrame2);
				spriteDirection = direction;
			}
			else if (ai[0] == 3f || ai[0] == 5f || ai[0] == 7f || ai[0] == 8f)
			{
				spriteDirection = direction;
				int num198 = 19;
				int num199 = 24;
				if (y < num198 || y > num199)
				{
					y = num198;
					frameCounter = 0.0;
				}
				frameCounter += 1.0;
				int sequenceFrame3 = (int)frameCounter / 4;
				y = FindFrame_Deerclops_GetAttack3Frame(sequenceFrame3);
				if (y == 21)
				{
					spriteDirection = direction;
				}
			}
			else if (ai[0] == 4f)
			{
				spriteDirection = direction;
				int num200 = 12;
				int num201 = 17;
				if (y < num200 || y > num201)
				{
					y = num200;
					frameCounter = 0.0;
					if (!IsABestiaryIconDummy && y != num193)
					{
						SoundEngine.PlaySound(SoundID.DeerclopsScream, base.Center);
					}
				}
				frameCounter += 1.0;
				int sequenceFrame4 = (int)frameCounter / 4;
				y = FindFrame_Deerclops_GetAttack1Frame(sequenceFrame4);
			}
			else
			{
				if (velocity.Y == 0f)
				{
					spriteDirection = direction;
				}
				if (velocity.Y > 0f || localAI[0] == 1f)
				{
					frameCounter = 0.0;
					y = 1;
				}
				else if (velocity.X == 0f)
				{
					frameCounter = 0.0;
					y = 0;
				}
				else
				{
					frameCounter += Math.Abs(velocity.X);
					int num202 = 10;
					int num203 = 15;
					if (frameCounter >= (double)(num202 * num203) || frameCounter < 0.0)
					{
						frameCounter = 0.0;
					}
					y = 2 + (int)(frameCounter / (double)num203);
					if (num193 != y && !IsABestiaryIconDummy && (y == 4 || y == 9))
					{
						SoundEngine.PlaySound(SoundID.DeerclopsStep, base.Bottom);
					}
				}
			}
			frame.Y = y;
			break;
		}
		case 657:
		{
			bool flag13 = life <= lifeMax / 2;
			frame.Width = 180;
			int num298 = frame.Y / num;
			if ((flag13 && noGravity) || velocity.Y < 0f)
			{
				if (num298 < 20 || num298 > 23)
				{
					if (num298 < 4 || num298 > 7)
					{
						num298 = 4;
						frameCounter = -1.0;
					}
					if ((frameCounter += 1.0) >= 4.0)
					{
						frameCounter = 0.0;
						num298++;
						if (num298 >= 7)
						{
							num298 = ((!flag13) ? 7 : 22);
						}
					}
				}
				else if ((frameCounter += 1.0) >= 5.0)
				{
					frameCounter = 0.0;
					num298++;
					if (num298 >= 24)
					{
						num298 = 20;
					}
				}
				frame.Y = num298 * num;
			}
			else if (velocity.Y > 0f)
			{
				if (num298 < 8 || num298 > 10)
				{
					num298 = 8;
					frameCounter = -1.0;
				}
				if ((frameCounter += 1.0) >= 8.0)
				{
					frameCounter = 0.0;
					num298++;
					if (num298 >= 10)
					{
						num298 = 10;
					}
				}
				frame.Y = num298 * num;
			}
			else
			{
				if (velocity.Y != 0f)
				{
					break;
				}
				if (ai[0] == 5f)
				{
					frameCounter = 0.0;
					num298 = ((int)ai[1] / 3 % 3) switch
					{
						1 => 14, 
						2 => 15, 
						_ => 13, 
					};
				}
				else if (ai[0] == 4f)
				{
					frameCounter = 0.0;
					switch ((int)ai[1] / 15)
					{
					default:
						num298 = 12;
						break;
					case 1:
						num298 = 11;
						break;
					case 2:
					case 3:
						num298 = 10;
						break;
					}
				}
				else
				{
					bool flag14 = num298 >= 10 && num298 <= 12;
					int num299 = 10;
					if (flag14)
					{
						num299 = 6;
					}
					if (!flag14 && num298 >= 4)
					{
						num298 = 0;
						frameCounter = -1.0;
					}
					if ((frameCounter += 1.0) >= (double)num299)
					{
						frameCounter = 0.0;
						num298++;
						if ((!flag14 || num298 == 13) && num298 >= 4)
						{
							num298 = 0;
						}
					}
				}
				frame.Y = num298 * num;
			}
			break;
		}
		case 604:
		case 605:
		{
			spriteDirection = direction;
			int num183 = 2;
			int num184 = 4;
			if (velocity != Vector2.Zero && (frameCounter += 1.0) >= (double)(num184 * num183))
			{
				frameCounter = 0.0;
			}
			if (velocity.Y == 0f)
			{
				frame.Y = num * ((int)frameCounter / num183);
			}
			else
			{
				frame.Y = num * (4 + (int)frameCounter / num183);
			}
			break;
		}
		case 669:
		{
			spriteDirection = direction;
			int num132 = 2;
			int num133 = 4;
			if (velocity != Vector2.Zero && (frameCounter += 1.0) >= (double)(num133 * num132))
			{
				frameCounter = 0.0;
			}
			if (velocity.Y == 0f)
			{
				frame.Y = num * ((int)frameCounter / num132);
			}
			else
			{
				frame.Y = num * (4 + (int)frameCounter / num132);
			}
			break;
		}
		case 618:
			if ((frameCounter += 1.0) >= 5.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 619:
			if ((frameCounter += 1.0) >= 6.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 636:
			frame.Y = (AI_120_HallowBoss_IsInPhase2() ? num : 0);
			break;
		case 568:
		case 569:
			if (ai[0] > 0f)
			{
				int num154 = frame.Y / num;
				spriteDirection = direction;
				if (num154 < 5 || num154 > 16)
				{
					frameCounter = 0.0;
				}
				num154 = 7;
				frameCounter += 1.0;
				int num155 = 0;
				double num156 = frameCounter;
				int num60 = num155 + 1;
				num155 = num60;
				if (num156 >= (double)(5 * num60))
				{
					num154 = 8;
				}
				double num157 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num157 >= (double)(5 * num60))
				{
					num154 = 9;
				}
				double num158 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num158 >= (double)(5 * num60))
				{
					num154 = 10;
				}
				double num159 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num159 >= (double)(5 * num60))
				{
					num154 = 7;
				}
				double num160 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num160 >= (double)(5 * num60))
				{
					num154 = 8;
				}
				double num161 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num161 >= (double)(5 * num60))
				{
					num154 = 9;
				}
				double num162 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num162 >= (double)(5 * num60))
				{
					num154 = 10;
				}
				double num163 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num163 >= (double)(5 * num60))
				{
					num154 = 7;
				}
				double num164 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num164 >= (double)(5 * num60))
				{
					num154 = 8;
				}
				double num165 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num165 >= (double)(5 * num60))
				{
					num154 = 9;
				}
				double num166 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num166 >= (double)(5 * num60))
				{
					num154 = 10;
				}
				double num167 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num167 >= (double)(5 * num60))
				{
					num154 = 7;
				}
				double num168 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num168 >= (double)(5 * num60))
				{
					num154 = 8;
				}
				double num169 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num169 >= (double)(5 * num60))
				{
					num154 = 9;
				}
				double num170 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num170 >= (double)(5 * num60))
				{
					num154 = 10;
				}
				double num171 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num171 >= (double)(5 * num60))
				{
					num154 = 7;
				}
				double num172 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num172 >= (double)(5 * num60))
				{
					num154 = 8;
				}
				double num173 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num173 >= (double)(5 * num60))
				{
					num154 = 9;
				}
				double num174 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num174 >= (double)(5 * num60))
				{
					num154 = 10;
				}
				double num175 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num175 >= (double)(5 * num60))
				{
					num154 = 7;
				}
				double num176 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num176 >= (double)(5 * num60))
				{
					num154 = 8;
				}
				double num177 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num177 >= (double)(5 * num60))
				{
					num154 = 9;
				}
				double num178 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num178 >= (double)(5 * num60))
				{
					num154 = 10;
				}
				double num179 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num179 >= (double)(5 * num60))
				{
					num154 = 11;
				}
				double num180 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num180 >= (double)(5 * num60))
				{
					num154 = 12;
				}
				double num181 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num181 >= (double)(5 * num60))
				{
					num154 = 13;
				}
				double num182 = frameCounter;
				num60 = num155 + 1;
				num155 = num60;
				if (num182 >= (double)(5 * num60))
				{
					num154 = 14;
				}
				if (frameCounter >= 270.0)
				{
					num154 = 14;
					frameCounter -= 10.0;
				}
				frame.Y = num * num154;
				break;
			}
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			if (velocity.Y != 0f || (direction == -1 && velocity.X > 0f) || (direction == 1 && velocity.X < 0f))
			{
				frameCounter = 0.0;
				frame.Y = num * 4;
				break;
			}
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = num * 6;
				break;
			}
			frameCounter += Math.Abs(velocity.X);
			if (frameCounter >= 56.0 || frameCounter < 0.0)
			{
				frameCounter = 0.0;
			}
			frame.Y = num * (int)(frameCounter / 8.0);
			break;
		case 551:
		{
			int num268 = frame.Y / num;
			if (ai[0] == 4f)
			{
				float num269 = 60f;
				int num270 = 10;
				int num271 = 6 * num270;
				if (num268 < 5)
				{
					frameCounter = 0.0;
				}
				num268 = 5;
				frameCounter = (int)ai[1];
				int num272 = 0;
				double num273 = frameCounter;
				int num60 = num272 + 1;
				num272 = num60;
				if (num273 >= (double)(5 * num60))
				{
					num268 = 6;
				}
				num272 = 0;
				if (frameCounter >= (double)(num269 - 6f))
				{
					num268 = 7;
				}
				if (frameCounter >= (double)(num269 - 3f))
				{
					num268 = 8;
				}
				if (frameCounter >= (double)num269)
				{
					num268 = 9 + (int)frameCounter / 3 % 2;
				}
				num272 = 0;
				if (frameCounter >= (double)(num269 + (float)num271 + 3f))
				{
					num268 = 8;
				}
				double num274 = frameCounter;
				float num275 = num269 + (float)num271 + 3f;
				num60 = num272 + 1;
				num272 = num60;
				if (num274 >= (double)(num275 + (float)(5 * num60)))
				{
					num268 = 7;
				}
				double num276 = frameCounter;
				float num277 = num269 + (float)num271 + 3f;
				num60 = num272 + 1;
				num272 = num60;
				if (num276 >= (double)(num277 + (float)(5 * num60)))
				{
					num268 = 0;
				}
			}
			else if (ai[0] == 3f)
			{
				float num278 = 40f;
				float num279 = 80f;
				float num280 = num278 + num279;
				float num281 = 25f;
				if (num268 < 5)
				{
					frameCounter = 0.0;
				}
				num268 = 5;
				frameCounter = (int)ai[1];
				int num282 = 0;
				double num283 = frameCounter;
				int num60 = num282 + 1;
				num282 = num60;
				if (num283 >= (double)(5 * num60))
				{
					num268 = 6;
				}
				num282 = 0;
				if (frameCounter >= (double)(num278 - 6f))
				{
					num268 = 7;
				}
				if (frameCounter >= (double)(num278 - 3f))
				{
					num268 = 8;
				}
				if (frameCounter >= (double)num278)
				{
					num268 = 9 + (int)frameCounter / 3 % 2;
				}
				num282 = 0;
				if (frameCounter >= (double)(num280 - num281 + 3f))
				{
					num268 = 8;
				}
				double num284 = frameCounter;
				float num285 = num280 - num281 + 3f;
				num60 = num282 + 1;
				num282 = num60;
				if (num284 >= (double)(num285 + (float)(5 * num60)))
				{
					num268 = 7;
				}
				double num286 = frameCounter;
				float num287 = num280 - num281 + 3f;
				num60 = num282 + 1;
				num282 = num60;
				if (num286 >= (double)(num287 + (float)(5 * num60)))
				{
					num268 = 0;
				}
			}
			else if (ai[0] == 5f)
			{
				num268 = 3;
			}
			else if (ai[0] == 6f)
			{
				if (num268 > 4)
				{
					frameCounter = 0.0;
				}
				num268 = 1;
				frameCounter = (int)ai[1];
				int num288 = 0;
				double num289 = frameCounter;
				int num60 = num288 + 1;
				num288 = num60;
				if (num289 >= (double)(8 * num60))
				{
					num268 = 2;
				}
				double num290 = frameCounter;
				num60 = num288 + 1;
				num288 = num60;
				if (num290 >= (double)(8 * num60))
				{
					num268 = 3;
				}
				double num291 = frameCounter;
				num60 = num288 + 1;
				num288 = num60;
				if (num291 >= (double)(8 * num60))
				{
					num268 = 4;
				}
				double num292 = frameCounter;
				num60 = num288 + 1;
				num288 = num60;
				if (num292 >= (double)(8 * num60))
				{
					num268 = 3;
				}
				double num293 = frameCounter;
				num60 = num288 + 1;
				num288 = num60;
				if (num293 >= (double)(8 * num60))
				{
					num268 = 4;
				}
				double num294 = frameCounter;
				num60 = num288 + 1;
				num288 = num60;
				if (num294 >= (double)(8 * num60))
				{
					num268 = 3;
				}
				double num295 = frameCounter;
				num60 = num288 + 1;
				num288 = num60;
				if (num295 >= (double)(8 * num60))
				{
					num268 = 2;
				}
				double num296 = frameCounter;
				num60 = num288 + 1;
				num288 = num60;
				if (num296 >= (double)(8 * num60))
				{
					num268 = 1;
				}
				double num297 = frameCounter;
				num60 = num288 + 1;
				num288 = num60;
				if (num297 >= (double)(8 * num60))
				{
					num268 = 0;
				}
			}
			else
			{
				num268 = 0;
			}
			frame.Y = num * num268;
			break;
		}
		case 552:
		case 553:
		case 554:
			if (ai[0] > 0f)
			{
				spriteDirection = direction;
				if (frame.Y < num * 10 || frame.Y > num * 13 || ai[1] == 29f)
				{
					frame.Y = num * 10;
					frameCounter = 0.0;
				}
				if ((frameCounter += 1.0) >= 6.0 && frame.Y < num * 13)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				break;
			}
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			if (velocity.Y != 0f || (direction == -1 && velocity.X > 0f) || (direction == 1 && velocity.X < 0f))
			{
				frameCounter = 0.0;
				frame.Y = num * 8;
				break;
			}
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = num * 9;
				break;
			}
			frameCounter += Math.Abs(velocity.X);
			if (frameCounter >= 64.0 || frameCounter < 0.0)
			{
				frameCounter = 0.0;
			}
			frame.Y = num * (int)(frameCounter / 8.0);
			break;
		case 572:
		case 573:
			if (ai[0] > 0f && ai[1] == 0f)
			{
				spriteDirection = direction;
				if (frame.Y != num * 8 || frameCounter > 2.0)
				{
					frame.Y = num * 8;
					frameCounter = 0.0;
				}
				if (frameCounter == 0.0)
				{
					frameCounter = 1.0;
					EmoteBubble.NewBubble(3, new WorldUIAnchor(this), 60);
				}
				break;
			}
			if (ai[1] == 1f)
			{
				if (velocity.Y == 0f)
				{
					spriteDirection = direction;
				}
				if (velocity.Y != 0f || (direction == -1 && velocity.X > 0f) || (direction == 1 && velocity.X < 0f))
				{
					frameCounter = 0.0;
					frame.Y = num * 17;
					break;
				}
				if (velocity.X == 0f)
				{
					frameCounter = 0.0;
					frame.Y = num * 8;
					break;
				}
				frameCounter += Math.Abs(velocity.X);
				if (frameCounter >= 64.0 || frameCounter < 0.0)
				{
					frameCounter = 0.0;
				}
				frame.Y = num * ((int)(frameCounter / 8.0) + 8);
				break;
			}
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			if (velocity.Y != 0f || (direction == -1 && velocity.X > 0f) || (direction == 1 && velocity.X < 0f))
			{
				frameCounter = 0.0;
				frame.Y = num * 16;
				break;
			}
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
				break;
			}
			frameCounter += Math.Abs(velocity.X);
			if (frameCounter >= 64.0 || frameCounter < 0.0)
			{
				frameCounter = 0.0;
			}
			frame.Y = num * (int)(frameCounter / 8.0);
			break;
		case 566:
		case 567:
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			if (velocity.Y != 0f || (direction == -1 && velocity.X > 0f) || (direction == 1 && velocity.X < 0f))
			{
				frameCounter = 0.0;
				frame.Y = num * 8;
				break;
			}
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
				break;
			}
			frameCounter += Math.Abs(velocity.X);
			if (frameCounter >= 64.0 || frameCounter < 0.0)
			{
				frameCounter = 0.0;
			}
			frame.Y = num * (int)(frameCounter / 8.0);
			break;
		case 576:
		case 577:
		{
			int num142 = frame.Y;
			frame.Width = 80;
			if (ai[0] > 0f && ai[1] == 0f)
			{
				spriteDirection = direction;
				if (num142 < 11 || num142 > 20)
				{
					num142 = 11;
					frameCounter = 0.0;
				}
				int num143 = 4;
				if (num142 == 13 || num142 == 19)
				{
					num143 = 8;
				}
				if (num142 == 14 || num142 == 18)
				{
					num143 = 2;
				}
				if ((frameCounter += 1.0) >= (double)num143 && num142 < 20)
				{
					frameCounter = 0.0;
					num142++;
				}
			}
			else if (ai[0] > 0f && ai[1] == 2f)
			{
				spriteDirection = direction;
				if (num142 < 37 || num142 > 47)
				{
					num142 = 39;
					frameCounter = 0.0;
				}
				int num144 = 5;
				if (num142 == 42)
				{
					num144 = 6;
				}
				if (num142 == 45)
				{
					num144 = 8;
				}
				if (num142 == 46)
				{
					num144 = 4;
				}
				if (num142 == 47)
				{
					num144 = 26;
				}
				if (num142 == 37 || num142 == 38)
				{
					num144 = 7;
				}
				bool flag12 = true;
				if (num142 == 46 && velocity.Y != 0f)
				{
					flag12 = false;
				}
				if (num142 == 38)
				{
					flag12 = false;
				}
				if (flag12)
				{
					frameCounter += 1.0;
				}
				if (frameCounter >= (double)num144)
				{
					if (num142 < 47)
					{
						frameCounter = 0.0;
						num142++;
					}
					else
					{
						num142 = 37;
						frameCounter = 0.0;
					}
				}
			}
			else if (ai[0] > 0f && ai[1] == 1f)
			{
				spriteDirection = direction;
				if (num142 < 21 || num142 > 38)
				{
					num142 = 21;
					frameCounter = 0.0;
				}
				int num145 = 5;
				if ((frameCounter += 1.0) >= (double)num145 && num142 < 38)
				{
					frameCounter = 0.0;
					num142++;
				}
			}
			else
			{
				if (velocity.Y == 0f)
				{
					spriteDirection = direction;
				}
				if (velocity.Y != 0f)
				{
					frameCounter = 0.0;
					num142 = 43;
				}
				else if (velocity.X == 0f)
				{
					frameCounter = 0.0;
					num142 = 0;
				}
				else
				{
					frameCounter += Math.Abs(velocity.X);
					if (frameCounter >= 60.0 || frameCounter < 0.0)
					{
						frameCounter = 0.0;
					}
					num142 = 1 + (int)(frameCounter / 6.0);
				}
			}
			frame.Y = num142;
			break;
		}
		case 570:
		case 571:
			if (ai[1] > 0f && ai[0] > 0f)
			{
				spriteDirection = direction;
				if (frame.Y < num * 10 || frame.Y > num * 15 || ai[1] == 59f)
				{
					frame.Y = num * 10;
					frameCounter = 0.0;
				}
				int num192 = 5;
				if (frame.Y == num * 14)
				{
					num192 = 35;
				}
				if ((frameCounter += 1.0) >= (double)num192 && frame.Y < num * 15)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				break;
			}
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			if (velocity.Y != 0f || (direction == -1 && velocity.X > 0f) || (direction == 1 && velocity.X < 0f))
			{
				frameCounter = 0.0;
				frame.Y = num;
				break;
			}
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = num * 9;
				break;
			}
			frameCounter += Math.Abs(velocity.X);
			if (frameCounter >= 64.0 || frameCounter < 0.0)
			{
				frameCounter = 0.0;
			}
			frame.Y = num * (int)(frameCounter / 8.0 + 2.0);
			break;
		case 561:
		case 562:
		case 563:
			if (ai[1] > 0f && ai[0] > 0f)
			{
				spriteDirection = direction;
				if (frame.Y < num * 10 || frame.Y > num * 13 || ai[1] == 89f)
				{
					frame.Y = num * 10;
					frameCounter = 0.0;
				}
				if ((frameCounter += 1.0) >= 6.0 && frame.Y < num * 13)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				break;
			}
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			if (velocity.Y != 0f || (direction == -1 && velocity.X > 0f) || (direction == 1 && velocity.X < 0f))
			{
				frameCounter = 0.0;
				frame.Y = num * 8;
				break;
			}
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = num * 9;
				break;
			}
			frameCounter += Math.Abs(velocity.X);
			if (frameCounter >= 64.0 || frameCounter < 0.0)
			{
				frameCounter = 0.0;
			}
			frame.Y = num * (int)(frameCounter / 8.0);
			break;
		case 555:
		case 556:
		case 557:
			if (ai[1] > 0f && ai[0] > 0f)
			{
				spriteDirection = direction;
				if (frame.Y < num * 10 || frame.Y > num * 16 || ai[1] == 41f)
				{
					frame.Y = num * 10;
					frameCounter = 0.0;
				}
				if ((frameCounter += 1.0) >= 6.0 && frame.Y < num * 16)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				break;
			}
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			if (velocity.Y != 0f || (direction == -1 && velocity.X > 0f) || (direction == 1 && velocity.X < 0f))
			{
				frameCounter = 0.0;
				frame.Y = num;
				break;
			}
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
				break;
			}
			frameCounter += Math.Abs(velocity.X);
			if (frameCounter >= 64.0 || frameCounter < 0.0)
			{
				frameCounter = 0.0;
			}
			frame.Y = num * ((int)(frameCounter / 8.0) + 2);
			break;
		case 558:
		case 559:
		case 560:
		{
			if (velocity.X > 0f)
			{
				spriteDirection = 1;
			}
			if (velocity.X < 0f)
			{
				spriteDirection = -1;
			}
			float num122 = velocity.ToRotation();
			if (velocity.X < 0f)
			{
				num122 += (float)Math.PI;
			}
			if (ai[0] != 2f)
			{
				num122 = velocity.X * 0.1f;
			}
			rotation = num122;
			if (ai[0] == 2f)
			{
				frame.Y = num * 4;
			}
			else if ((frameCounter += 1.0) >= 6.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
				if (frame.Y >= num * 4)
				{
					frame.Y = 0;
				}
			}
			break;
		}
		case 578:
			rotation = velocity.X * 0.1f;
			if ((frameCounter += 1.0) >= 4.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
				if (frame.Y >= num * 4)
				{
					frame.Y = 0;
				}
			}
			break;
		case 574:
		case 575:
		{
			if (velocity.X > 0f)
			{
				spriteDirection = 1;
			}
			if (velocity.X < 0f)
			{
				spriteDirection = -1;
			}
			float num186 = velocity.ToRotation();
			if (velocity.X < 0f)
			{
				num186 += (float)Math.PI;
			}
			rotation = rotation.AngleTowards(num186, 0.02f);
			if (ai[0] != 0f)
			{
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
					frameCounter = 0.0;
				}
				int num187 = 4;
				if (frame.Y >= num * 5)
				{
					num187 = 8;
				}
				Vector2 vector4 = base.Center + new Vector2(56 * spriteDirection, -30f).RotatedBy(rotation);
				if ((frameCounter += 1.0) >= (double)num187 && frame.Y < num * 9)
				{
					frameCounter = 0.0;
					frame.Y += num;
					if (frame.Y == num * 9)
					{
						for (int m = 0; m < 8; m++)
						{
							Dust dust2 = Dust.NewDustDirect(vector4, 0, 0, 6, 0f, 0f, 100);
							Dust dust = dust2;
							dust.velocity *= 3f;
							dust2.scale = 0.6f;
							dust2.fadeIn = 1.2f;
							dust2.noGravity = true;
							dust2.noLight = true;
						}
					}
				}
				if (frame.Y < num * 9 || !(ai[0] < 3f))
				{
					break;
				}
				Vector2 value = vector4;
				Vector2 value2 = vector4 + (oldPos[3] - position);
				int maxValue = 5;
				if (frameCounter > 60.0)
				{
					maxValue = 4;
				}
				if (frameCounter > 180.0)
				{
					maxValue = 3;
				}
				if (frameCounter > 300.0)
				{
					maxValue = 2;
				}
				if (frameCounter > 600.0)
				{
					maxValue = 1;
				}
				for (int n = 0; n < 2; n++)
				{
					if (Main.rand.Next(maxValue) == 0)
					{
						Dust dust3 = Dust.NewDustDirect(Vector2.Lerp(value2, value, (float)n / 10f + 0.1f), 0, 0, 6, 0f, 0f, 50);
						dust3.scale = 0.3f;
						dust3.fadeIn = 1.5f;
						dust3.noGravity = true;
						dust3.noLight = true;
					}
				}
			}
			else if ((frameCounter += 1.0) >= 6.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
				if (frame.Y >= num * 2)
				{
					frame.Y = 0;
				}
			}
			break;
		}
		case 549:
			spriteDirection = 1;
			rotation = 0f;
			if ((frameCounter += 1.0) >= 6.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
				if (frame.Y >= num * Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 594:
			spriteDirection = 1;
			frame.Y = (int)ai[2];
			frame.Width = 32;
			break;
		case 564:
		case 565:
		{
			int y3 = frame.Y;
			frame.Width = 80;
			frame.Height = 80;
			if (ai[0] > 0f && ai[1] == 0f)
			{
				spriteDirection = direction;
				if (y3 < 5 || y3 > 13)
				{
					frameCounter = 0.0;
				}
				y3 = 5;
				frameCounter += 1.0;
				int num210 = 0;
				double num211 = frameCounter;
				int num60 = num210 + 1;
				num210 = num60;
				if (num211 >= (double)(7 * num60))
				{
					y3 = 6;
				}
				double num212 = frameCounter;
				num60 = num210 + 1;
				num210 = num60;
				if (num212 >= (double)(7 * num60))
				{
					y3 = 7;
				}
				double num213 = frameCounter;
				num60 = num210 + 1;
				num210 = num60;
				if (num213 >= (double)(7 * num60))
				{
					y3 = 5;
				}
				double num214 = frameCounter;
				num60 = num210 + 1;
				num210 = num60;
				if (num214 >= (double)(7 * num60))
				{
					y3 = 6;
				}
				double num215 = frameCounter;
				num60 = num210 + 1;
				num210 = num60;
				if (num215 >= (double)(7 * num60))
				{
					y3 = 7;
				}
				double num216 = frameCounter;
				num60 = num210 + 1;
				num210 = num60;
				if (num216 >= (double)(7 * num60))
				{
					y3 = 5;
				}
				double num217 = frameCounter;
				num60 = num210 + 1;
				num210 = num60;
				if (num217 >= (double)(7 * num60))
				{
					y3 = 6;
				}
				double num218 = frameCounter;
				num60 = num210 + 1;
				num210 = num60;
				if (num218 >= (double)(7 * num60))
				{
					y3 = 7;
				}
				double num219 = frameCounter;
				num60 = num210 + 1;
				num210 = num60;
				if (num219 >= (double)(7 * num60))
				{
					y3 = 8;
				}
				double num220 = frameCounter;
				num60 = num210 + 1;
				num210 = num60;
				if (num220 >= (double)(7 * num60))
				{
					y3 = 9;
				}
				double num221 = frameCounter;
				num60 = num210 + 1;
				num210 = num60;
				if (num221 >= (double)(7 * num60))
				{
					y3 = 10;
				}
				double num222 = frameCounter;
				num60 = num210 + 1;
				num210 = num60;
				if (num222 >= (double)(7 * num60))
				{
					y3 = 11;
				}
				double num223 = frameCounter;
				num60 = num210 + 1;
				num210 = num60;
				if (num223 >= (double)(7 * num60))
				{
					y3 = 12;
				}
				double num224 = frameCounter;
				num60 = num210 + 1;
				num210 = num60;
				if (num224 >= (double)(7 * num60))
				{
					y3 = 5;
					frameCounter = 0.0;
				}
			}
			else if (ai[0] > 0f && ai[1] == 1f)
			{
				spriteDirection = direction;
				if (y3 < 13 || y3 > 25)
				{
					frameCounter = 0.0;
				}
				y3 = 13;
				frameCounter += 1.0;
				int num225 = 0;
				double num226 = frameCounter;
				int num60 = num225 + 1;
				num225 = num60;
				if (num226 >= (double)(8 * num60))
				{
					y3 = 14;
				}
				double num227 = frameCounter;
				num60 = num225 + 1;
				num225 = num60;
				if (num227 >= (double)(8 * num60))
				{
					y3 = 15;
				}
				double num228 = frameCounter;
				num60 = num225 + 1;
				num225 = num60;
				if (num228 >= (double)(8 * num60))
				{
					y3 = 16;
				}
				double num229 = frameCounter;
				num60 = num225 + 1;
				num225 = num60;
				if (num229 >= (double)(8 * num60))
				{
					y3 = 17;
				}
				double num230 = frameCounter;
				num60 = num225 + 1;
				num225 = num60;
				if (num230 >= (double)(8 * num60))
				{
					y3 = 18;
				}
				double num231 = frameCounter;
				num60 = num225 + 1;
				num225 = num60;
				if (num231 >= (double)(8 * num60))
				{
					y3 = 19;
				}
				double num232 = frameCounter;
				num60 = num225 + 1;
				num225 = num60;
				if (num232 >= (double)(8 * num60))
				{
					y3 = 20;
				}
				double num233 = frameCounter;
				num60 = num225 + 1;
				num225 = num60;
				if (num233 >= (double)(8 * num60))
				{
					y3 = 18;
				}
				double num234 = frameCounter;
				num60 = num225 + 1;
				num225 = num60;
				if (num234 >= (double)(8 * num60))
				{
					y3 = 19;
				}
				double num235 = frameCounter;
				num60 = num225 + 1;
				num225 = num60;
				if (num235 >= (double)(8 * num60))
				{
					y3 = 20;
				}
				double num236 = frameCounter;
				num60 = num225 + 1;
				num225 = num60;
				if (num236 >= (double)(8 * num60))
				{
					y3 = 21;
				}
				double num237 = frameCounter;
				num60 = num225 + 1;
				num225 = num60;
				if (num237 >= (double)(8 * num60))
				{
					y3 = 22;
				}
				double num238 = frameCounter;
				num60 = num225 + 1;
				num225 = num60;
				if (num238 >= (double)(8 * num60))
				{
					y3 = 23;
				}
				double num239 = frameCounter;
				num60 = num225 + 1;
				num225 = num60;
				if (num239 >= (double)(8 * num60))
				{
					y3 = 24;
				}
				double num240 = frameCounter;
				num60 = num225 + 1;
				num225 = num60;
				if (num240 >= (double)(8 * num60))
				{
					y3 = 25;
				}
				double num241 = frameCounter;
				num60 = num225 + 1;
				num225 = num60;
				if (num241 >= (double)(8 * num60))
				{
					y3 = 14;
					frameCounter = 0.0;
				}
			}
			else if (ai[0] > 0f && ai[1] == 2f)
			{
				spriteDirection = direction;
				if (y3 < 26 || y3 > 40)
				{
					frameCounter = 0.0;
				}
				y3 = 26;
				frameCounter += 1.0;
				int num242 = 0;
				double num243 = frameCounter;
				int num60 = num242 + 1;
				num242 = num60;
				if (num243 >= (double)(8 * num60))
				{
					y3 = 27;
				}
				double num244 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num244 >= (double)(8 * num60))
				{
					y3 = 28;
				}
				double num245 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num245 >= (double)(8 * num60))
				{
					y3 = 29;
				}
				double num246 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num246 >= (double)(8 * num60))
				{
					y3 = 26;
				}
				double num247 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num247 >= (double)(8 * num60))
				{
					y3 = 27;
				}
				double num248 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num248 >= (double)(8 * num60))
				{
					y3 = 28;
				}
				double num249 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num249 >= (double)(8 * num60))
				{
					y3 = 29;
				}
				double num250 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num250 >= (double)(8 * num60))
				{
					y3 = 26;
				}
				double num251 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num251 >= (double)(8 * num60))
				{
					y3 = 27;
				}
				double num252 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num252 >= (double)(8 * num60))
				{
					y3 = 28;
				}
				double num253 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num253 >= (double)(8 * num60))
				{
					y3 = 29;
				}
				double num254 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num254 >= (double)(8 * num60))
				{
					y3 = 30;
				}
				double num255 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num255 >= (double)(8 * num60))
				{
					y3 = 31;
				}
				double num256 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num256 >= (double)(8 * num60))
				{
					y3 = 32;
				}
				double num257 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num257 >= (double)(8 * num60))
				{
					y3 = 33;
				}
				double num258 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num258 >= (double)(8 * num60))
				{
					y3 = 34;
				}
				double num259 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num259 >= (double)(8 * num60))
				{
					y3 = 35;
				}
				double num260 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num260 >= (double)(8 * num60))
				{
					y3 = 36;
				}
				double num261 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num261 >= (double)(8 * num60))
				{
					y3 = 37;
				}
				double num262 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num262 >= (double)(8 * num60))
				{
					y3 = 38;
				}
				double num263 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num263 >= (double)(8 * num60))
				{
					y3 = 39;
				}
				double num264 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num264 >= (double)(8 * num60))
				{
					y3 = 40;
				}
				double num265 = frameCounter;
				num60 = num242 + 1;
				num242 = num60;
				if (num265 >= (double)(8 * num60))
				{
					y3 = 26;
					frameCounter = 0.0;
				}
			}
			else
			{
				frameCounter = frameCounter + (double)(velocity.Length() * 0.1f) + 1.0;
				if (frameCounter >= 40.0 || frameCounter < 0.0)
				{
					frameCounter = 0.0;
				}
				y3 = (int)(frameCounter / 8.0);
			}
			frame.Y = y3;
			break;
		}
		case 620:
			if (ai[1] > 0f && ai[0] > 0f)
			{
				spriteDirection = direction;
				if (frame.Y < num * 14 || frame.Y > num * 20 || ai[1] == 59f)
				{
					frame.Y = num * 14;
					frameCounter = 0.0;
				}
				int num47 = 5;
				if (frame.Y == num * 17 || frame.Y == num * 16)
				{
					num47 = 3;
				}
				if ((frameCounter += 1.0) >= (double)num47 && frame.Y < num * 20)
				{
					frameCounter = 0.0;
					frame.Y += num;
					if (ai[1] > 0f && frame.Y == num * 18)
					{
						frame.Y = num * 16;
					}
				}
				break;
			}
			if (wet)
			{
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				if (velocity.X > 0f)
				{
					direction = 1;
				}
				if (spriteDirection != direction)
				{
					rotation *= -1f;
					spriteDirection = direction;
				}
				float num48 = (float)Math.Atan2(velocity.Y * (float)direction, velocity.X * (float)direction);
				if (Math.Abs(rotation - num48) >= (float)Math.PI)
				{
					if (num48 < rotation)
					{
						rotation -= (float)Math.PI * 2f;
					}
					else
					{
						rotation += (float)Math.PI * 2f;
					}
				}
				rotation = (rotation * 4f + num48) / 5f;
				frameCounter += Math.Abs(velocity.Length());
				frameCounter += 1.0;
				if (frameCounter > 8.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num > 13)
				{
					frame.Y = num * 8;
				}
				else if (frame.Y / num < 8)
				{
					frame.Y = num * 13;
				}
				break;
			}
			if ((double)rotation > 3.14)
			{
				rotation -= 6.28f;
			}
			if ((double)rotation > -0.01 && (double)rotation < 0.01)
			{
				rotation = 0f;
			}
			else
			{
				rotation *= 0.9f;
			}
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
				frameCounter += Math.Abs(velocity.X);
				frameCounter += 1.0;
				if (frameCounter > 9.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num > 7)
				{
					frame.Y = num * 2;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num;
			}
			break;
		case 17:
		case 18:
		case 19:
		case 20:
		case 21:
		case 22:
		case 26:
		case 27:
		case 28:
		case 31:
		case 37:
		case 38:
		case 44:
		case 54:
		case 73:
		case 77:
		case 78:
		case 79:
		case 80:
		case 104:
		case 107:
		case 108:
		case 120:
		case 124:
		case 140:
		case 142:
		case 159:
		case 160:
		case 162:
		case 167:
		case 178:
		case 181:
		case 185:
		case 196:
		case 197:
		case 198:
		case 201:
		case 202:
		case 203:
		case 207:
		case 208:
		case 209:
		case 212:
		case 213:
		case 227:
		case 228:
		case 229:
		case 287:
		case 294:
		case 295:
		case 296:
		case 310:
		case 311:
		case 312:
		case 313:
		case 314:
		case 322:
		case 323:
		case 324:
		case 326:
		case 338:
		case 339:
		case 340:
		case 353:
		case 368:
		case 369:
		case 441:
		case 453:
		case 460:
		case 462:
		case 463:
		case 489:
		case 534:
		case 550:
		case 588:
		case 630:
		case 632:
		case 633:
		case 635:
		case 637:
		case 638:
		case 656:
		case 663:
		case 670:
		case 678:
		case 679:
		case 680:
		case 681:
		case 682:
		case 683:
		case 684:
		{
			int num57 = (isLikeATownNPC ? NPCID.Sets.ExtraFramesCount[type] : 0);
			bool flag7 = NPCID.Sets.IsTownSlime[type];
			if (false && !Main.dedServ && TownNPCProfiles.Instance.GetProfile(type, out var profile))
			{
				Asset<Texture2D> textureNPCShouldUse = profile.GetTextureNPCShouldUse(this);
				if (textureNPCShouldUse.IsLoaded)
				{
					num = textureNPCShouldUse.Height() / Main.npcFrameCount[type];
					frame.Width = textureNPCShouldUse.Width();
					frame.Height = num;
				}
			}
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (NPCID.Sets.IsTownSlime[type])
				{
					spriteDirection *= -1;
				}
				int num58 = Main.npcFrameCount[type] - NPCID.Sets.AttackFrameCount[type];
				if (ai[0] == 23f)
				{
					frameCounter += 1.0;
					int num59 = frame.Y / num;
					int num60 = num58 - num59;
					if ((uint)(num60 - 1) > 1u && (uint)(num60 - 4) > 1u && num59 != 0)
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
					int num61 = 0;
					num61 = ((!(frameCounter < 6.0)) ? (num58 - 4) : (num58 - 5));
					if (ai[1] < 6f)
					{
						num61 = num58 - 5;
					}
					frame.Y = num * num61;
				}
				else if (ai[0] >= 20f && ai[0] <= 22f)
				{
					int num62 = frame.Y / num;
					switch ((int)ai[0])
					{
					case 20:
						if (flag7)
						{
							if (ai[1] > 30f && (num62 < 8 || num62 > 13))
							{
								num62 = 8;
							}
							if (num62 > 0)
							{
								frameCounter += 1.0;
							}
							if (frameCounter >= 12.0)
							{
								frameCounter = 0.0;
								num62++;
								if (num62 > 13 && ai[1] > 30f)
								{
									num62 = 8;
								}
								if (num62 > 13)
								{
									num62 = 0;
								}
							}
						}
						if (type == 656)
						{
							if (ai[1] > 30f && (num62 < 7 || num62 > 9))
							{
								num62 = 7;
							}
							if (num62 > 0)
							{
								frameCounter += 1.0;
							}
							if (frameCounter > 4.0)
							{
								frameCounter = 0.0;
								num62++;
								if (num62 > 8 && ai[1] > 30f)
								{
									num62 = 8;
								}
								if (num62 > 9)
								{
									num62 = 0;
								}
							}
						}
						if (type == 637)
						{
							if (ai[1] > 30f && (num62 < 10 || num62 > 16))
							{
								num62 = 10;
							}
							if (num62 > 0)
							{
								frameCounter += 1.0;
							}
							if (frameCounter > 4.0)
							{
								frameCounter = 0.0;
								num62++;
								if (num62 > 13 && ai[1] > 30f)
								{
									num62 = 13;
								}
								if (num62 > 16)
								{
									num62 = 0;
								}
							}
						}
						if (type != 638)
						{
							break;
						}
						if (ai[1] > 30f && (num62 < 23 || num62 > 27))
						{
							num62 = 23;
						}
						if (num62 > 0)
						{
							frameCounter += 1.0;
						}
						if (frameCounter > 4.0)
						{
							frameCounter = 0.0;
							num62++;
							if (num62 > 26 && ai[1] > 30f)
							{
								num62 = 24;
							}
							if (num62 > 27)
							{
								num62 = 0;
							}
						}
						break;
					case 21:
						if (type == 656)
						{
							if (ai[1] > 30f && (num62 < 10 || num62 > 16))
							{
								num62 = 10;
							}
							if (num62 > 0)
							{
								frameCounter += 1.0;
							}
							if (frameCounter > 4.0)
							{
								frameCounter = 0.0;
								num62++;
								if (num62 > 13 && ai[1] > 30f)
								{
									num62 = 13;
								}
								if (num62 > 16)
								{
									num62 = 0;
								}
							}
						}
						if (type == 637)
						{
							if (ai[1] > 30f && (num62 < 17 || num62 > 21))
							{
								num62 = 17;
							}
							if (num62 > 0)
							{
								frameCounter += 1.0;
							}
							if (frameCounter > 4.0)
							{
								frameCounter = 0.0;
								num62++;
								if (num62 > 19 && ai[1] > 30f)
								{
									num62 = 19;
								}
								if (num62 > 21)
								{
									num62 = 0;
								}
							}
						}
						if (type != 638)
						{
							break;
						}
						if (ai[1] > 30f && (num62 < 17 || num62 > 22))
						{
							num62 = 17;
						}
						if (num62 > 0)
						{
							frameCounter += 1.0;
						}
						if (frameCounter > 4.0)
						{
							frameCounter = 0.0;
							num62++;
							if (num62 > 21 && ai[1] > 30f)
							{
								num62 = 18;
							}
							if (num62 > 22)
							{
								num62 = 0;
							}
						}
						break;
					case 22:
						if (type == 656)
						{
							int num63 = Main.npcFrameCount[type];
							if (ai[1] > 40f && (num62 < 17 || num62 >= num63))
							{
								num62 = 17;
							}
							if (num62 > 0)
							{
								frameCounter += 1.0;
							}
							if (frameCounter > 4.0)
							{
								frameCounter = 0.0;
								num62++;
								if (num62 > 20 && ai[1] > 40f)
								{
									num62 = 19;
								}
								if (num62 >= num63)
								{
									num62 = 0;
								}
							}
						}
						if (type != 637)
						{
							break;
						}
						if (ai[1] > 30f && (num62 < 17 || num62 > 27))
						{
							num62 = 17;
						}
						if (num62 > 0)
						{
							frameCounter += 1.0;
						}
						if (frameCounter > 4.0)
						{
							frameCounter = 0.0;
							num62++;
							if (num62 > 27)
							{
								num62 = ((!(ai[1] <= 30f)) ? 22 : 20);
							}
							else if (ai[1] <= 30f && num62 == 22)
							{
								num62 = 0;
							}
							else if (ai[1] > 30f && num62 > 19 && num62 < 22)
							{
								num62 = 22;
							}
						}
						break;
					}
					frame.Y = num62 * num;
				}
				else if (ai[0] == 2f)
				{
					frameCounter += 1.0;
					if (frame.Y / num == num58 - 1 && frameCounter >= 5.0)
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
					else if (frame.Y / num == 0 && frameCounter >= 40.0)
					{
						frame.Y = num * (num58 - 1);
						frameCounter = 0.0;
					}
					else if (frame.Y != 0 && frame.Y != num * (num58 - 1))
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
				}
				else if (ai[0] == 11f)
				{
					frameCounter += 1.0;
					if (frame.Y / num == num58 - 1 && frameCounter >= 50.0)
					{
						if (frameCounter == 50.0)
						{
							int num64 = Main.rand.Next(4);
							for (int k = 0; k < 3 + num64; k++)
							{
								int num65 = Dust.NewDust(base.Center + Vector2.UnitX * -direction * 8f - Vector2.One * 5f + Vector2.UnitY * 8f, 3, 6, 216, -direction, 1f);
								Dust dust = Main.dust[num65];
								dust.velocity /= 2f;
								Main.dust[num65].scale = 0.8f;
							}
							if (Main.rand.Next(30) == 0)
							{
								int num66 = Gore.NewGore(base.Center + Vector2.UnitX * -direction * 8f, Vector2.Zero, Main.rand.Next(580, 583));
								Gore gore = Main.gore[num66];
								gore.velocity /= 2f;
								Main.gore[num66].velocity.Y = Math.Abs(Main.gore[num66].velocity.Y);
								Main.gore[num66].velocity.X = (0f - Math.Abs(Main.gore[num66].velocity.X)) * (float)direction;
							}
						}
						if (frameCounter >= 100.0 && Main.rand.Next(20) == 0)
						{
							frame.Y = 0;
							frameCounter = 0.0;
						}
					}
					else if (frame.Y / num == 0 && frameCounter >= 20.0)
					{
						frame.Y = num * (num58 - 1);
						frameCounter = 0.0;
						EmoteBubble.NewBubble(89, new WorldUIAnchor(this), 90);
					}
					else if (frame.Y != 0 && frame.Y != num * (num58 - 1))
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
				}
				else if (ai[0] == 5f)
				{
					frame.Y = num * (num58 - 3);
					if (type == 637)
					{
						frame.Y = num * 19;
					}
					frameCounter = 0.0;
				}
				else if (ai[0] == 6f)
				{
					frameCounter += 1.0;
					int num67 = frame.Y / num;
					int num60 = num58 - num67;
					if ((uint)(num60 - 1) > 1u && (uint)(num60 - 4) > 1u && num67 != 0)
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
					int num68 = 0;
					num68 = ((!(frameCounter < 10.0)) ? ((frameCounter < 16.0) ? (num58 - 5) : ((frameCounter < 46.0) ? (num58 - 4) : ((frameCounter < 60.0) ? (num58 - 5) : ((!(frameCounter < 66.0)) ? ((frameCounter < 72.0) ? (num58 - 5) : ((frameCounter < 102.0) ? (num58 - 4) : ((frameCounter < 108.0) ? (num58 - 5) : ((!(frameCounter < 114.0)) ? ((frameCounter < 120.0) ? (num58 - 5) : ((frameCounter < 150.0) ? (num58 - 4) : ((frameCounter < 156.0) ? (num58 - 5) : ((!(frameCounter < 162.0)) ? ((frameCounter < 168.0) ? (num58 - 5) : ((frameCounter < 198.0) ? (num58 - 4) : ((frameCounter < 204.0) ? (num58 - 5) : ((!(frameCounter < 210.0)) ? ((frameCounter < 216.0) ? (num58 - 5) : ((frameCounter < 246.0) ? (num58 - 4) : ((frameCounter < 252.0) ? (num58 - 5) : ((!(frameCounter < 258.0)) ? ((frameCounter < 264.0) ? (num58 - 5) : ((frameCounter < 294.0) ? (num58 - 4) : ((frameCounter < 300.0) ? (num58 - 5) : 0))) : 0)))) : 0)))) : 0)))) : 0)))) : 0)))) : 0);
					if (num68 == num58 - 4 && num67 == num58 - 5)
					{
						Vector2 vector2 = base.Center + new Vector2(10 * direction, -4f);
						for (int l = 0; l < 8; l++)
						{
							int num69 = Main.rand.Next(139, 143);
							int num70 = Dust.NewDust(vector2, 0, 0, num69, velocity.X + (float)direction, velocity.Y - 2.5f, 0, default(Color), 1.2f);
							Main.dust[num70].velocity.X += (float)direction * 1.5f;
							Dust dust = Main.dust[num70];
							dust.position -= new Vector2(4f);
							dust = Main.dust[num70];
							dust.velocity *= 2f;
							Main.dust[num70].scale = 0.7f + Main.rand.NextFloat() * 0.3f;
						}
					}
					frame.Y = num * num68;
					if (frameCounter >= 300.0)
					{
						frameCounter = 0.0;
					}
				}
				else if ((ai[0] == 7f || ai[0] == 19f) && !NPCID.Sets.IsTownPet[type])
				{
					frameCounter += 1.0;
					int num71 = frame.Y / num;
					int num60 = num58 - num71;
					if ((uint)(num60 - 1) > 1u && (uint)(num60 - 4) > 1u && num71 != 0)
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
					int num72 = 0;
					if (frameCounter < 16.0)
					{
						num72 = 0;
					}
					else if (frameCounter == 16.0)
					{
						EmoteBubble.NewBubbleNPC(new WorldUIAnchor(this), 112);
					}
					else if (frameCounter < 128.0)
					{
						num72 = ((frameCounter % 16.0 < 8.0) ? (num58 - 2) : 0);
					}
					else if (frameCounter < 160.0)
					{
						num72 = 0;
					}
					else if (frameCounter != 160.0)
					{
						num72 = ((frameCounter < 220.0) ? ((frameCounter % 12.0 < 6.0) ? (num58 - 2) : 0) : 0);
					}
					else
					{
						EmoteBubble.NewBubbleNPC(new WorldUIAnchor(this), 60);
					}
					frame.Y = num * num72;
					if (frameCounter >= 220.0)
					{
						frameCounter = 0.0;
					}
				}
				else if (ai[0] == 9f)
				{
					frameCounter += 1.0;
					int num73 = frame.Y / num;
					int num60 = num58 - num73;
					if ((uint)(num60 - 1) > 1u && (uint)(num60 - 4) > 1u && num73 != 0)
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
					int num74 = 0;
					num74 = ((!(frameCounter < 10.0)) ? ((!(frameCounter < 16.0)) ? (num58 - 4) : (num58 - 5)) : 0);
					if (ai[1] < 16f)
					{
						num74 = num58 - 5;
					}
					if (ai[1] < 10f)
					{
						num74 = 0;
					}
					frame.Y = num * num74;
				}
				else if (ai[0] == 18f)
				{
					frameCounter += 1.0;
					int num75 = frame.Y / num;
					int num60 = num58 - num75;
					if ((uint)(num60 - 1) > 1u && (uint)(num60 - 4) > 1u && num75 != 0)
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
					int num76 = 0;
					if (frameCounter < 10.0)
					{
						num76 = 0;
					}
					else if (frameCounter < 16.0)
					{
						num76 = num58 - 1;
					}
					else
					{
						num76 = num58 - 2;
					}
					if (ai[1] < 16f)
					{
						num76 = num58 - 1;
					}
					if (ai[1] < 10f)
					{
						num76 = 0;
					}
					num76 = Main.npcFrameCount[type] - 2;
					frame.Y = num * num76;
				}
				else if (ai[0] == 10f || ai[0] == 13f)
				{
					frameCounter += 1.0;
					int num77 = frame.Y / num;
					int num60 = num77 - num58;
					if ((uint)num60 > 3u && num77 != 0)
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
					int num78 = 10;
					int num79 = 6;
					if (type == 633)
					{
						num78 = 0;
						num79 = 2;
					}
					int num80 = 0;
					num80 = ((!(frameCounter < (double)num78)) ? ((frameCounter < (double)(num78 + num79)) ? num58 : ((frameCounter < (double)(num78 + num79 * 2)) ? (num58 + 1) : ((frameCounter < (double)(num78 + num79 * 3)) ? (num58 + 2) : ((frameCounter < (double)(num78 + num79 * 4)) ? (num58 + 3) : 0)))) : 0);
					frame.Y = num * num80;
				}
				else if (ai[0] == 15f)
				{
					frameCounter += 1.0;
					int num81 = frame.Y / num;
					int num60 = num81 - num58;
					if ((uint)num60 > 3u && num81 != 0)
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
					float num82 = ai[1] / (float)NPCID.Sets.AttackTime[type];
					int num83 = 0;
					num83 = ((num82 > 0.65f) ? num58 : ((num82 > 0.5f) ? (num58 + 1) : ((num82 > 0.35f) ? (num58 + 2) : ((num82 > 0f) ? (num58 + 3) : 0))));
					frame.Y = num * num83;
				}
				else if (ai[0] == 25f)
				{
					frame.Y = num;
				}
				else if (ai[0] == 12f)
				{
					frameCounter += 1.0;
					int num84 = frame.Y / num;
					int num60 = num84 - num58;
					if ((uint)num60 > 4u && num84 != 0)
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
					int num85 = num58 + GetShootingFrame(ai[2]);
					frame.Y = num * num85;
				}
				else if (ai[0] == 14f || ai[0] == 24f)
				{
					frameCounter += 1.0;
					int num86 = frame.Y / num;
					int num60 = num86 - num58;
					if ((uint)num60 > 1u && num86 != 0)
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
					int num87 = 12;
					int num88 = ((frameCounter % (double)num87 * 2.0 < (double)num87) ? num58 : (num58 + 1));
					frame.Y = num * num88;
					if (ai[0] == 24f)
					{
						if (frameCounter == 60.0)
						{
							EmoteBubble.NewBubble(87, new WorldUIAnchor(this), 60);
						}
						if (frameCounter == 150.0)
						{
							EmoteBubble.NewBubble(3, new WorldUIAnchor(this), 90);
						}
						if (frameCounter >= 240.0)
						{
							frame.Y = 0;
						}
					}
				}
				else if (ai[0] == 1001f)
				{
					frame.Y = num * (num58 - 1);
					frameCounter = 0.0;
				}
				else if (CanTalk && (ai[0] == 3f || ai[0] == 4f))
				{
					frameCounter += 1.0;
					int num89 = frame.Y / num;
					int num60 = num58 - num89;
					if ((uint)(num60 - 1) > 1u && (uint)(num60 - 4) > 1u && num89 != 0)
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
					bool flag8 = ai[0] == 3f;
					int num90 = 0;
					int num91 = 0;
					int num92 = -1;
					int num93 = -1;
					if (frameCounter < 10.0)
					{
						num90 = 0;
					}
					else if (frameCounter < 16.0)
					{
						num90 = num58 - 5;
					}
					else if (frameCounter < 46.0)
					{
						num90 = num58 - 4;
					}
					else if (frameCounter < 60.0)
					{
						num90 = num58 - 5;
					}
					else if (frameCounter < 216.0)
					{
						num90 = 0;
					}
					else if (frameCounter == 216.0 && Main.netMode != 1)
					{
						num92 = 70;
					}
					else if (frameCounter < 286.0)
					{
						num90 = ((frameCounter % 12.0 < 6.0) ? (num58 - 2) : 0);
					}
					else if (frameCounter < 320.0)
					{
						num90 = 0;
					}
					else if (frameCounter != 320.0 || Main.netMode == 1)
					{
						num90 = ((frameCounter < 420.0) ? ((frameCounter % 16.0 < 8.0) ? (num58 - 2) : 0) : 0);
					}
					else
					{
						num92 = 100;
					}
					if (frameCounter < 70.0)
					{
						num91 = 0;
					}
					else if (frameCounter != 70.0 || Main.netMode == 1)
					{
						num91 = ((frameCounter < 160.0) ? ((frameCounter % 16.0 < 8.0) ? (num58 - 2) : 0) : ((frameCounter < 166.0) ? (num58 - 5) : ((frameCounter < 186.0) ? (num58 - 4) : ((frameCounter < 200.0) ? (num58 - 5) : ((!(frameCounter < 320.0)) ? ((frameCounter < 326.0) ? (num58 - 1) : 0) : 0)))));
					}
					else
					{
						num93 = 90;
					}
					if (flag8)
					{
						NPC nPC = Main.npc[(int)ai[2]];
						if (num92 != -1)
						{
							EmoteBubble.NewBubbleNPC(new WorldUIAnchor(this), num92, new WorldUIAnchor(nPC));
						}
						if (num93 != -1 && nPC.CanTalk)
						{
							EmoteBubble.NewBubbleNPC(new WorldUIAnchor(nPC), num93, new WorldUIAnchor(this));
						}
					}
					frame.Y = num * (flag8 ? num90 : num91);
					if (frameCounter >= 420.0)
					{
						frameCounter = 0.0;
					}
				}
				else if (CanTalk && (ai[0] == 16f || ai[0] == 17f))
				{
					frameCounter += 1.0;
					int num94 = frame.Y / num;
					int num60 = num58 - num94;
					if ((uint)(num60 - 1) > 1u && (uint)(num60 - 4) > 1u && num94 != 0)
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
					bool flag9 = ai[0] == 16f;
					int num95 = 0;
					int num96 = -1;
					if (frameCounter < 10.0)
					{
						num95 = 0;
					}
					else if (frameCounter < 16.0)
					{
						num95 = num58 - 5;
					}
					else if (frameCounter < 22.0)
					{
						num95 = num58 - 4;
					}
					else if (frameCounter < 28.0)
					{
						num95 = num58 - 5;
					}
					else if (frameCounter < 34.0)
					{
						num95 = num58 - 4;
					}
					else if (frameCounter < 40.0)
					{
						num95 = num58 - 5;
					}
					else if (frameCounter == 40.0 && Main.netMode != 1)
					{
						num96 = 45;
					}
					else if (frameCounter < 70.0)
					{
						num95 = num58 - 4;
					}
					else if (frameCounter < 76.0)
					{
						num95 = num58 - 5;
					}
					else if (frameCounter < 82.0)
					{
						num95 = num58 - 4;
					}
					else if (frameCounter < 88.0)
					{
						num95 = num58 - 5;
					}
					else if (frameCounter < 94.0)
					{
						num95 = num58 - 4;
					}
					else if (frameCounter < 100.0)
					{
						num95 = num58 - 5;
					}
					else if (frameCounter == 100.0 && Main.netMode != 1)
					{
						num96 = 45;
					}
					else if (frameCounter < 130.0)
					{
						num95 = num58 - 4;
					}
					else if (frameCounter < 136.0)
					{
						num95 = num58 - 5;
					}
					else if (frameCounter < 142.0)
					{
						num95 = num58 - 4;
					}
					else if (frameCounter < 148.0)
					{
						num95 = num58 - 5;
					}
					else if (frameCounter < 154.0)
					{
						num95 = num58 - 4;
					}
					else if (frameCounter < 160.0)
					{
						num95 = num58 - 5;
					}
					else if (frameCounter != 160.0 || Main.netMode == 1)
					{
						num95 = ((frameCounter < 220.0) ? (num58 - 4) : ((frameCounter < 226.0) ? (num58 - 5) : 0));
					}
					else
					{
						num96 = 75;
					}
					if (flag9 && num96 != -1)
					{
						int num97 = (int)localAI[2];
						int num98 = (int)localAI[3];
						int num99 = (int)Main.npc[(int)ai[2]].localAI[3];
						int num100 = (int)Main.npc[(int)ai[2]].localAI[2];
						int num101 = 3 - num97 - num98;
						int num102 = 0;
						if (frameCounter == 40.0)
						{
							num102 = 1;
						}
						if (frameCounter == 100.0)
						{
							num102 = 2;
						}
						if (frameCounter == 160.0)
						{
							num102 = 3;
						}
						int num103 = 3 - num102;
						int num104 = -1;
						int num105 = 0;
						while (num104 < 0)
						{
							num60 = num105 + 1;
							num105 = num60;
							if (num60 >= 100)
							{
								break;
							}
							num104 = Main.rand.Next(2);
							if (num104 == 0 && num100 >= num98)
							{
								num104 = -1;
							}
							if (num104 == 1 && num99 >= num97)
							{
								num104 = -1;
							}
							if (num104 == -1 && num103 <= num101)
							{
								num104 = 2;
							}
						}
						if (num104 == 0)
						{
							Main.npc[(int)ai[2]].localAI[3] += 1f;
							num99++;
						}
						if (num104 == 1)
						{
							Main.npc[(int)ai[2]].localAI[2] += 1f;
							num100++;
						}
						int num106 = Utils.SelectRandom<int>(Main.rand, 38, 37, 36);
						int num107 = num106;
						switch (num104)
						{
						case 0:
							switch (num106)
							{
							case 38:
								num107 = 37;
								break;
							case 37:
								num107 = 36;
								break;
							case 36:
								num107 = 38;
								break;
							}
							break;
						case 1:
							switch (num106)
							{
							case 38:
								num107 = 36;
								break;
							case 37:
								num107 = 38;
								break;
							case 36:
								num107 = 37;
								break;
							}
							break;
						}
						if (num103 == 0)
						{
							if (num99 >= 2)
							{
								num106 -= 3;
							}
							if (num100 >= 2)
							{
								num107 -= 3;
							}
						}
						EmoteBubble.NewBubble(num106, new WorldUIAnchor(this), num96);
						EmoteBubble.NewBubble(num107, new WorldUIAnchor(Main.npc[(int)ai[2]]), num96);
					}
					frame.Y = num * (flag9 ? num95 : num95);
					if (frameCounter >= 420.0)
					{
						frameCounter = 0.0;
					}
				}
				else if (velocity.X == 0f)
				{
					if (type == 638)
					{
						int num108 = frame.Y / num;
						if (num108 > 7)
						{
							num108 = 0;
						}
						frameCounter += 1.0;
						if (frameCounter > 4.0)
						{
							frameCounter = 0.0;
							num108++;
							if (num108 > 7)
							{
								num108 = 0;
							}
						}
						frame.Y = num108 * num;
					}
					else if (type == 140 || type == 489)
					{
						frame.Y = num;
						frameCounter = 0.0;
					}
					else
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
				}
				else
				{
					int num109 = 6;
					if (type == 632)
					{
						num109 = 12;
					}
					if (type == 534)
					{
						num109 = 12;
					}
					if (type == 638)
					{
						num109 = 12;
					}
					if (type == 656)
					{
						num109 = 12;
					}
					if (flag7)
					{
						num109 = 12;
					}
					if (type == 489)
					{
						num109 = 8;
						frameCounter += Math.Abs(velocity.X) * 1f;
						frameCounter += 0.5;
					}
					else
					{
						frameCounter += Math.Abs(velocity.X) * 2f;
						frameCounter += 1.0;
					}
					if (type == 462)
					{
						num109 = 9;
					}
					int num110 = num * 2;
					if (type == 638)
					{
						num110 = num * 9;
					}
					if (type == 656)
					{
						num110 = num;
					}
					if (flag7)
					{
						num110 = num;
					}
					if (frame.Y < num110)
					{
						frame.Y = num110;
					}
					if (frameCounter > (double)num109)
					{
						frame.Y += num;
						frameCounter = 0.0;
					}
					if (frame.Y / num >= Main.npcFrameCount[type] - num57)
					{
						frame.Y = num110;
					}
				}
				break;
			}
			if (type == 462)
			{
				frameCounter = 0.0;
				if (velocity.Y < 0f)
				{
					frame.Y = num;
				}
				else
				{
					frame.Y = num * 2;
				}
				break;
			}
			if (flag7)
			{
				spriteDirection = -direction;
				int num111 = frame.Y / num;
				if (velocity.Y < 0f)
				{
					if (num111 < 2 || num111 > 3)
					{
						num111 = 2;
						frameCounter = -1.0;
					}
					if ((frameCounter += 1.0) >= 4.0)
					{
						frameCounter = 0.0;
						num111++;
						if (num111 >= 3)
						{
							num111 = 3;
						}
					}
					frame.Y = num111 * num;
				}
				else if (velocity.Y > 0f)
				{
					if (num111 < 3 || num111 > 6)
					{
						num111 = 3;
						frameCounter = -1.0;
					}
					if ((frameCounter += 1.0) >= 4.0)
					{
						frameCounter = 0.0;
						num111++;
						if (num111 >= 6)
						{
							num111 = 6;
						}
					}
					frame.Y = num111 * num;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num;
			}
			if (type == 489 || type == 21 || type == 31 || type == 294 || type == 326 || type == 295 || type == 296 || type == 44 || type == 77 || type == 120 || type == 140 || type == 159 || type == 167 || type == 197 || type == 201 || type == 202)
			{
				frame.Y = 0;
			}
			if (type == 638)
			{
				frame.Y = num * 8;
			}
			break;
		}
		case 494:
		case 495:
			if (ai[2] > 0f)
			{
				if (ai[2] < 7f)
				{
					frame.Y = num * 5;
				}
				else if (ai[2] < 14f)
				{
					frame.Y = num * 6;
				}
				else if (ai[2] < 20f)
				{
					frame.Y = num * 7;
				}
				break;
			}
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
			}
			if (velocity.Y != 0f || (direction == -1 && velocity.X > 0f) || (direction == 1 && velocity.X < 0f))
			{
				frameCounter = 0.0;
				if (velocity.Y < 0f)
				{
					frame.Y = num * 2;
				}
				else
				{
					frame.Y = num * 3;
				}
				break;
			}
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
				break;
			}
			frameCounter += Math.Abs(velocity.X);
			if (frameCounter < 8.0)
			{
				frame.Y = 0;
				break;
			}
			if (frameCounter < 16.0)
			{
				frame.Y = num;
				break;
			}
			if (frameCounter < 24.0)
			{
				frame.Y = num * 2;
				break;
			}
			if (frameCounter < 32.0)
			{
				frame.Y = num * 3;
				break;
			}
			if (frameCounter < 39.0)
			{
				frame.Y = num * 4;
				break;
			}
			frame.Y = num * 4;
			frameCounter = 0.0;
			break;
		case 541:
			if (ai[0] > 0f)
			{
				float num147 = ai[0];
				if (num147 < 6f)
				{
					frame.Y = num * 4;
				}
				else if (num147 < 105f)
				{
					frame.Y = num * (int)(num147 / 8f % 4f + 5f);
				}
				else if (num147 < 114f)
				{
					frame.Y = num * 9;
				}
				else if (num147 < 135f)
				{
					frame.Y = num * (int)((num147 - 99f - 15f) / 7f + 10f);
				}
				else
				{
					frame.Y = num;
				}
			}
			else
			{
				frameCounter = frameCounter + (double)(velocity.Length() * 0.1f) + 1.0;
				if (frameCounter >= 8.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y >= num * 4)
				{
					frame.Y = 0;
				}
			}
			break;
		case 612:
		case 613:
		{
			if (IsABestiaryIconDummy)
			{
				frameCounter += 1.0;
				if (frameCounter > 50.0)
				{
					frameCounter = 0.0;
					frame.Y = 0;
				}
				frame.Y = (int)Utils.WrappedLerp(0f, 4f, (float)frameCounter / 50f) * num;
				break;
			}
			bool flag = true;
			if (frame.Y == 0 && Main.rand.Next(180) != 0)
			{
				flag = false;
			}
			if (flag)
			{
				frameCounter += 1.0;
			}
			if (velocity.X != 0f)
			{
				spriteDirection = Math.Sign(velocity.X);
			}
			int num9 = 10;
			bool flag2 = Math.Abs(velocity.X) > 1f;
			if (ai[1] == 1f)
			{
				frameCounter = 0.0;
				frame.Y = num * 4;
			}
			if (Math.Abs(velocity.Y) > 0.1f || flag2)
			{
				frameCounter = 0.0;
				frame.Y = num * 4;
			}
			else if (frame.Y == 0)
			{
				num9 = 2;
			}
			if (frame.Y == num * 4)
			{
				num9 = 60;
				if (!flag2)
				{
					num9 = 2;
				}
			}
			if (frameCounter >= (double)num9)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num >= 5)
				{
					frame.Y = 0;
				}
			}
			break;
		}
		case 583:
		case 584:
		case 585:
			rotation = velocity.X * 0.1f;
			if ((frameCounter += 1.0) >= 4.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
				if (frame.Y >= num * 4)
				{
					frame.Y = 0;
				}
			}
			break;
		case 498:
		case 499:
		case 500:
		case 501:
		case 502:
		case 503:
		case 504:
		case 505:
		case 506:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (ai[2] > 0f)
				{
					spriteDirection = direction;
					if (ai[1] < 12f)
					{
						frame.Y = num * 8;
					}
					else if (ai[1] < 34f)
					{
						frame.Y = num * 9;
					}
					else
					{
						frame.Y = num * 8;
					}
					frameCounter = 0.0;
					break;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					break;
				}
				frameCounter += Math.Abs(velocity.X) * 1f;
				if (frameCounter > 4.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y > num * 7)
				{
					frame.Y = 0;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num * 10;
			}
			break;
		case 524:
		case 525:
		case 526:
		case 527:
			if (velocity.Y == 0f)
			{
				if (direction != 0)
				{
					spriteDirection = direction;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				if (frame.Y <= num)
				{
					frame.Y = num * 2;
				}
				frameCounter += Math.Abs(velocity.X);
				frameCounter += 1.0;
				if (frameCounter > 9.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 2;
				}
			}
			else
			{
				frame.Y = num;
				frameCounter = 0.0;
			}
			break;
		case 528:
		case 529:
			if (velocity.Y == 0f)
			{
				if (direction != 0)
				{
					spriteDirection = direction;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				frameCounter += Math.Abs(velocity.X);
				frameCounter += 1.0;
				if (frameCounter > 9.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type] - 1)
				{
					frame.Y = num;
				}
			}
			else
			{
				frame.Y = num * (Main.npcFrameCount[type] - 1);
				frameCounter = 0.0;
			}
			break;
		case 533:
			if (velocity.Y == 0f && direction != 0)
			{
				spriteDirection = direction;
			}
			frameCounter += 1.0;
			if (frameCounter >= 48.0)
			{
				frameCounter = 0.0;
			}
			frame.Y = (int)(frameCounter / 6.0) * num;
			if (ai[1] > 0f)
			{
				frame.Y += num * 8;
			}
			break;
		case 496:
		case 497:
			if (ai[0] == 0f)
			{
				rotation = 0f;
				if (velocity.Y == 0f)
				{
					spriteDirection = direction;
				}
				else if (velocity.Y < 0f)
				{
					frameCounter = 0.0;
				}
				frameCounter += Math.Abs(velocity.X) * 1.1f;
				if (frameCounter < 6.0)
				{
					frame.Y = 0;
				}
				else if (frameCounter < 12.0)
				{
					frame.Y = num;
				}
				else if (frameCounter < 18.0)
				{
					frame.Y = num * 2;
				}
				else if (frameCounter < 24.0)
				{
					frame.Y = num * 3;
				}
				else
				{
					frameCounter = 0.0;
				}
			}
			else if (ai[0] == 1f)
			{
				frameCounter = 0.0;
				if (ai[1] < 10f)
				{
					frame.Y = num * 4;
				}
				else if (ai[1] < 20f)
				{
					frame.Y = num * 5;
				}
				else
				{
					frame.Y = num * 6;
				}
			}
			else if (ai[0] == 5f)
			{
				frameCounter = 0.0;
				if (ai[1] < 10f)
				{
					frame.Y = num * 10;
				}
				else if (ai[1] < 20f)
				{
					frame.Y = num * 11;
				}
				else
				{
					frame.Y = num * 3;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num * 7;
			}
			break;
		case 508:
		case 532:
		case 580:
		case 582:
			if (velocity.Y != 0f)
			{
				frame.Y = num;
				break;
			}
			if (velocity.X == 0f)
			{
				frame.Y = 0;
				break;
			}
			if (direction < 0 && velocity.X < 0f)
			{
				spriteDirection = -1;
			}
			if (direction > 0 && velocity.X > 0f)
			{
				spriteDirection = 1;
			}
			if (frame.Y / num < 2)
			{
				frame.Y = num * 2;
			}
			frameCounter += 1f + Math.Abs(velocity.X) / 2f;
			if (frameCounter > 6.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y / num >= Main.npcFrameCount[type])
			{
				frame.Y = num * 2;
			}
			break;
		case 509:
		case 581:
			if ((velocity.X > 0f && direction > 0) || (velocity.X < 0f && direction < 0))
			{
				spriteDirection = direction;
			}
			if ((frameCounter += 1.0) >= 3.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 415:
			if (ai[2] < 0f)
			{
				if (frame.Y / num != 8 && frame.Y / num != 9 && frame.Y / num != 0)
				{
					frameCounter = 0.0;
				}
				frameCounter += 1.0;
				int num129 = 0;
				int num130 = 18;
				int num131 = 4;
				if (frameCounter > (double)(num130 - num131 * 2))
				{
					num129 = 8 + (int)frameCounter / 4 % 2;
				}
				if (frameCounter > (double)(num130 + num131 * 6))
				{
					num129 = 0;
					frameCounter = 0.0;
				}
				frame.Y = num * num129;
			}
			else if (velocity.Y == 0f)
			{
				if (direction != 0)
				{
					spriteDirection = direction;
				}
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
				frameCounter += Math.Abs(velocity.X) * 0.5f;
				if (frameCounter >= 8.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type] - 2)
				{
					frame.Y = num * 2;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num;
			}
			break;
		case 416:
			if (IsABestiaryIconDummy)
			{
				frameCounter += 1.0;
				if (frameCounter > 5.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y < num * 2 || frame.Y > num * 7)
				{
					frame.Y = num * 2;
				}
			}
			else if (Main.netMode != 2 && !Main.dedServ)
			{
				int num153 = (int)ai[0];
				if (Main.npc[num153].active && Main.npc[num153].type == 415 && TextureAssets.Npc[415].IsLoaded)
				{
					frame.Y = Main.npc[num153].frame.Y / (TextureAssets.Npc[415].Height() / Main.npcFrameCount[415]) * num;
				}
			}
			break;
		case 417:
			if (ai[0] == 0f)
			{
				rotation = 0f;
				if (velocity.Y == 0f)
				{
					spriteDirection = direction;
				}
				else if (velocity.Y < 0f)
				{
					frameCounter = 0.0;
				}
				frameCounter += Math.Abs(velocity.X) * 1.1f;
				frame.Y = (int)(frameCounter / 6.0) * num;
				if (frameCounter >= 48.0)
				{
					frameCounter = 0.0;
				}
			}
			else if (ai[0] == 1f)
			{
				frameCounter = 0.0;
				frame.Y = num * (9 + (int)(ai[1] / 6f));
			}
			else if (ai[0] == 5f)
			{
				frameCounter = 0.0;
				frame.Y = num * (13 - (int)(ai[1] / 6f));
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num * 14;
			}
			break;
		case 518:
			if (velocity.Y == 0f)
			{
				if (direction != 0)
				{
					spriteDirection = direction;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
				frameCounter += Math.Abs(velocity.X) * 1f;
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 2;
				}
			}
			else
			{
				frame.Y = num;
				frameCounter = 0.0;
			}
			break;
		case 419:
			if (ai[2] < 0f)
			{
				int num116 = 1;
				if (direction != 0)
				{
					spriteDirection = direction;
				}
				if (frame.Y / num >= 9)
				{
					frame.Y = num * 2;
					frameCounter = 0.0;
				}
				if (frame.Y / num < 2)
				{
					frame.Y = num * 2;
					frameCounter = 0.0;
				}
				frameCounter += 1.0;
				if (frameCounter >= (double)(num116 * 4 + 6))
				{
					frameCounter = 8.0;
				}
				if (frameCounter < 6.0)
				{
					frame.Y = num * (int)(2.0 + frameCounter / 3.0);
				}
				else
				{
					frame.Y = num * (int)(4.0 + (frameCounter - 6.0) / (double)num116);
				}
			}
			else if (velocity.Y == 0f)
			{
				if (direction != 0)
				{
					spriteDirection = direction;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				frameCounter += Math.Abs(velocity.X) * 1f;
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 9;
				}
				if (frame.Y / num < 9)
				{
					frame.Y = num * 9;
				}
			}
			else
			{
				frame.Y = num;
				frameCounter = 0.0;
			}
			break;
		case 425:
			if (direction != 0)
			{
				spriteDirection = -direction;
			}
			if (ai[2] == 1f)
			{
				frameCounter += 1.0;
				if (frameCounter >= 3.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y > num * 12 || frame.Y < num * 10)
				{
					frame.Y = num * 10;
				}
			}
			else if (velocity.Y != 0f)
			{
				frameCounter = 0.0;
				frame.Y = num;
			}
			else if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
			}
			else
			{
				frameCounter += Math.Abs(velocity.X);
				if (frameCounter >= 8.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y > num * 9 || frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
			}
			break;
		case 427:
			if (direction != 0)
			{
				spriteDirection = direction;
			}
			if (velocity.Y != 0f)
			{
				frameCounter += 1.0;
				if (frameCounter >= 2.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y >= num * 9 || frame.Y < num * 6)
				{
					frame.Y = num * 6;
				}
			}
			else if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
			}
			else
			{
				frameCounter += Math.Abs(velocity.X);
				if (frameCounter >= 8.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y > num * 5 || frame.Y < num)
				{
					frame.Y = num;
				}
			}
			break;
		case 426:
			if (direction != 0)
			{
				spriteDirection = direction;
			}
			if (ai[1] >= 45f)
			{
				if (velocity.Y == 0f)
				{
					frame.Y = num * 8;
					break;
				}
				frameCounter += 1.0;
				if (frameCounter >= 2.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y >= num * 15 || frame.Y < num * 12)
				{
					frame.Y = num * 12;
				}
			}
			else if (velocity.Y != 0f)
			{
				frameCounter += 1.0;
				if (frameCounter >= 2.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y >= num * 12 || frame.Y < num * 9)
				{
					frame.Y = num * 9;
				}
			}
			else if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
			}
			else
			{
				frameCounter += Math.Abs(velocity.X);
				if (frameCounter >= 10.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y > num * 7 || frame.Y < num)
				{
					frame.Y = num;
				}
			}
			break;
		case 429:
			if (velocity.Y == 0f)
			{
				if (direction != 0)
				{
					spriteDirection = direction;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
				frameCounter += Math.Abs(velocity.X) * 1f;
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 2;
				}
			}
			else
			{
				frame.Y = num;
				frameCounter = 0.0;
			}
			break;
		case 428:
			if (velocity.Y == 0f)
			{
				if (direction != 0)
				{
					spriteDirection = direction;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				frameCounter += Math.Abs(velocity.X) * 1f;
				if ((frameCounter += 1.0) > 10.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type] - 1)
				{
					frame.Y = 0;
				}
			}
			else if (frame.Y / num != 4)
			{
				if (frameCounter > 0.0)
				{
					frameCounter = 0.0;
				}
				if ((frameCounter -= 1.0) < -10.0 || velocity.Y > 0.6f)
				{
					frame.Y = num * 4;
					frameCounter = 0.0;
				}
			}
			break;
		case 423:
			if (ai[2] == 1f)
			{
				int num49 = 2;
				if (ai[1] >= 30f && ai[1] < 45f)
				{
					num49 = 3;
				}
				frame.Y = num49 * num;
				break;
			}
			if (velocity.Y != 0f)
			{
				frame.Y = num;
				break;
			}
			if (velocity.X == 0f)
			{
				frame.Y = 0;
				break;
			}
			if (velocity.X != 0f)
			{
				spriteDirection = Math.Sign(0f - velocity.X);
			}
			if (frame.Y / num < 4)
			{
				frame.Y = num * 4;
			}
			frameCounter += 1f + Math.Abs(velocity.X) / 2f;
			if (frameCounter > 6.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y / num >= Main.npcFrameCount[type])
			{
				frame.Y = num * 4;
			}
			break;
		case 421:
			if (ai[0] == 5f)
			{
				frameCounter += 1.0;
			}
			if ((frameCounter += 1.0) >= 5.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 424:
			if (velocity.Y == 0f)
			{
				if (direction != 0)
				{
					spriteDirection = -direction;
				}
				if (ai[2] > 0f)
				{
					frame.Y = num * ((ai[1] > 90f) ? (Main.npcFrameCount[type] - 2) : (Main.npcFrameCount[type] - 1));
					frameCounter = 0.0;
					break;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					break;
				}
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
				frameCounter += Math.Abs(velocity.X);
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type] - 2)
				{
					frame.Y = num * 2;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num;
			}
			break;
		case 420:
			if ((frameCounter += 1.0) >= 5.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 411:
			if (ai[1] >= 120f && ai[1] < 240f)
			{
				spriteDirection = -direction;
				frame.Y = num * (Main.npcFrameCount[type] - 1);
				frameCounter = 0.0;
			}
			else if (velocity.Y == 0f)
			{
				if (direction != 0)
				{
					spriteDirection = -direction;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
				frameCounter += Math.Abs(velocity.X) * 1f;
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type] - 1)
				{
					frame.Y = num * 2;
				}
			}
			else
			{
				frame.Y = num;
				frameCounter = 0.0;
			}
			break;
		case 409:
			if (velocity.Y == 0f && ai[1] <= 30f && ai[1] > 0f)
			{
				frame.Y = num * (Main.npcFrameCount[type] - 1);
				frameCounter = 0.0;
				break;
			}
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			if ((frameCounter += 1.0) >= 6.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num >= Main.npcFrameCount[type] - 2)
				{
					frame.Y = 0;
				}
			}
			break;
		case 410:
			frameCounter += Math.Abs(velocity.X);
			if (frameCounter >= 10.0)
			{
				frameCounter -= 10.0;
				frame.Y += num;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 407:
			if ((frameCounter += 1.0) >= 6.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 405:
		case 406:
			if ((frameCounter += 1.0) >= 4.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 516:
			if (localAI[1] == 0f)
			{
				localAI[1] = 1f;
				frame.Y = num * Main.rand.Next(3);
				frameCounter += Main.rand.Next(3);
			}
			frameCounter += 1.0;
			if (frameCounter > 3.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y > num * 3)
				{
					frame.Y = 0;
				}
			}
			break;
		case 418:
			if (ai[0] == 0f || ai[0] == 1f || ai[0] == -1f)
			{
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y > num * 4)
				{
					frame.Y = 0;
				}
			}
			else if (ai[0] == 2f)
			{
				if (ai[1] < 10f)
				{
					frame.Y = num * 5;
				}
				else if (ai[1] < 20f)
				{
					frame.Y = num * 6;
				}
				else
				{
					frame.Y = num * 7;
				}
			}
			else if (ai[0] == -2f)
			{
				frameCounter += 1.0;
				if (frameCounter > 12.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y > num * 7)
				{
					frame.Y = num * 5;
				}
			}
			break;
		case 1:
		case 16:
		case 59:
		case 71:
		case 81:
		case 138:
		case 147:
		case 183:
		case 184:
		case 204:
		case 225:
		case 302:
		case 304:
		case 333:
		case 334:
		case 335:
		case 336:
		case 535:
		case 537:
		case 658:
		case 659:
		case 667:
		case 676:
			if (type == 302 || type == 304)
			{
				spriteDirection = direction;
			}
			frameCounter += 1.0;
			if (num2 > 0)
			{
				frameCounter += 1.0;
			}
			if (num2 == 4)
			{
				frameCounter += 1.0;
			}
			if (frameCounter >= 8.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * Main.npcFrameCount[type])
			{
				frame.Y = 0;
			}
			break;
		case 488:
		{
			int num139 = (int)localAI[1];
			if (Framing.GetTileSafely((int)ai[0], (int)ai[1]).frameX >= 36)
			{
				num139 *= -1;
			}
			if (localAI[0] > 24f)
			{
				localAI[0] = 24f;
			}
			if (localAI[0] > 0f)
			{
				localAI[0] -= 1f;
			}
			if (localAI[0] < 0f)
			{
				localAI[0] = 0f;
			}
			int num140 = ((num139 == -1) ? 4 : 6);
			int num141 = (int)localAI[0] / num140;
			if (localAI[0] % (float)num140 != 0f)
			{
				num141++;
			}
			if (num141 != 0 && num139 == 1)
			{
				num141 += 5;
			}
			frame.Y = num141 * num;
			break;
		}
		case 430:
		case 431:
		case 432:
		case 433:
		case 434:
		case 435:
		case 436:
		case 591:
			if (ai[2] > 0f)
			{
				if (ai[2] < 5f)
				{
					frame.Y = num * 3;
				}
				else if (ai[2] < 10f)
				{
					frame.Y = num * 4;
				}
				else if (ai[2] < 15f)
				{
					frame.Y = num * 5;
				}
				else
				{
					frame.Y = num * 6;
				}
				break;
			}
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
			}
			if (velocity.Y != 0f || (direction == -1 && velocity.X > 0f) || (direction == 1 && velocity.X < 0f))
			{
				frameCounter = 0.0;
				frame.Y = num * 2;
				break;
			}
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
				break;
			}
			frameCounter += Math.Abs(velocity.X);
			if (frameCounter < 8.0)
			{
				frame.Y = 0;
			}
			else if (frameCounter < 16.0)
			{
				frame.Y = num;
			}
			else if (frameCounter < 24.0)
			{
				frame.Y = num * 2;
			}
			else if (frameCounter < 32.0)
			{
				frame.Y = num;
			}
			else
			{
				frameCounter = 0.0;
			}
			break;
		case 454:
		{
			int num209 = (int)(frameCounter / 2.0);
			frame.Y = num * num209;
			break;
		}
		case 377:
		case 446:
			if (IsABestiaryIconDummy)
			{
				frameCounter += 1.0;
				if (frameCounter > 4.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y > num)
				{
					frame.Y = 0;
				}
			}
			else if (velocity.Y != 0f)
			{
				frame.Y = num;
			}
			else
			{
				frame.Y = 0;
			}
			spriteDirection = direction;
			break;
		case 378:
		{
			if (velocity.Y != 0f && frame.Y < num * 2)
			{
				frame.Y += num * 2;
			}
			if (velocity.Y == 0f && frame.Y > num * 2)
			{
				frame.Y -= num * 2;
			}
			frameCounter += 1.0;
			int num146 = 6;
			if (frameCounter >= (double)num146)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (velocity.Y != 0f && frame.Y >= num * 4)
				{
					frame.Y = num * 2;
				}
				if (velocity.Y == 0f && frame.Y >= num * 2)
				{
					frame.Y = 0;
				}
			}
			break;
		}
		case 376:
			frameCounter += 1.0;
			if (frameCounter > 30.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y >= num * 2)
				{
					frame.Y = 0;
				}
			}
			break;
		case 589:
		{
			int num40 = frame.Y / num;
			frameCounter += 1.0;
			if (velocity.Y != 0f)
			{
				frame.Y = 0;
				frameCounter = 0.0;
			}
			if (num40 >= 12)
			{
				if (frameCounter > 6.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
					if (frame.Y >= num * Main.npcFrameCount[type])
					{
						frame.Y = 0;
					}
				}
			}
			else if (num40 >= 11)
			{
				if (frameCounter > (double)Main.rand.Next(40, 140))
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
			}
			else if (num40 >= 8)
			{
				if (!(frameCounter > 3.0))
				{
					break;
				}
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y == num * 9)
				{
					Vector2 vector = position;
					vector.Y += height - 6;
					if (direction == 1)
					{
						vector.X += 30f;
					}
					else
					{
						vector.X -= 22f;
					}
					for (int i = 0; i < 4; i++)
					{
						Dust.NewDust(vector, 1, 1, 32);
					}
				}
			}
			else if (num40 >= 7)
			{
				if (frameCounter > (double)Main.rand.Next(30, 90))
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
			}
			else if (num40 >= 4)
			{
				if (frameCounter > 4.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
			}
			else if (num40 >= 1)
			{
				if (frameCounter > 4.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
					if (frame.Y >= num * 4 && Main.rand.Next(3) != 0)
					{
						frame.Y = 0;
					}
				}
			}
			else if (frameCounter > (double)Main.rand.Next(90, 450))
			{
				frameCounter = 0.0;
				frame.Y += num;
			}
			break;
		}
		case 375:
			frameCounter += 1.0;
			if (frameCounter > 4.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y >= num * 4)
				{
					frame.Y = 0;
				}
			}
			break;
		case 374:
			localAI[0] = -2f;
			if (velocity.Y == 0f)
			{
				rotation = 0f;
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
					if (frame.Y >= num * 4)
					{
						frame.Y = num;
					}
				}
				break;
			}
			rotation += (float)direction * 0.1f;
			frameCounter += 1.0;
			if (frameCounter > 3.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y >= num * 4)
				{
					frame.Y = num;
				}
			}
			break;
		case 492:
			frame.Y = num * (int)ai[2];
			break;
		case 473:
		case 474:
		case 475:
		case 476:
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			if (ai[0] == 0f || ai[0] == 7f)
			{
				rotation = 0f;
				frameCounter = 0.0;
				frame.Y = 0;
			}
			else if (ai[0] == 1f)
			{
				rotation = 0f;
				frameCounter = 0.0;
				int num24 = 6;
				if (ai[1] < (float)num24)
				{
					frame.Y = num;
				}
				else if (ai[1] < (float)(num24 * 2))
				{
					frame.Y = num * 2;
				}
				else if (ai[1] < (float)(num24 * 3))
				{
					frame.Y = num * 3;
				}
				else if (ai[1] < (float)(num24 * 4))
				{
					frame.Y = num * 4;
				}
				else if (ai[1] < (float)(num24 * 5))
				{
					frame.Y = num * 5;
				}
				else
				{
					frame.Y = num * 6;
				}
			}
			else if (ai[0] == 8f)
			{
				rotation = 0f;
				frameCounter += 1.0;
				if (frameCounter >= 24.0)
				{
					frameCounter = 0.0;
				}
				frame.Y = num * Math.Min(6, Math.Max(3, 3 + (int)frameCounter / 6));
			}
			else if (ai[0] == 2f || ai[0] == 6f)
			{
				rotation = 0f;
				if (velocity.Y == 0f)
				{
					int num25 = 6;
					frameCounter += 1.0;
					if (frame.Y < num * 7)
					{
						frame.Y = num * 12;
					}
					if (frame.Y < num * 10)
					{
						if (frameCounter > 8.0)
						{
							frame.Y += num;
							frameCounter = 0.0;
							if (frame.Y == num * 10)
							{
								frameCounter = num25 * 2;
							}
						}
					}
					else if (frameCounter < (double)num25)
					{
						frame.Y = num * 12;
					}
					else if (frameCounter < (double)(num25 * 2))
					{
						frame.Y = num * 11;
					}
					else if (frameCounter < (double)(num25 * 3))
					{
						frame.Y = num * 10;
					}
					else
					{
						frame.Y = num * 11;
						if (frameCounter >= (double)(num25 * 4 - 1))
						{
							frameCounter = 0.0;
						}
					}
				}
				else
				{
					frame.Y = num * 13;
					frameCounter = 0.0;
				}
			}
			else if (ai[0] == 3f)
			{
				rotation = 0f;
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frameCounter = 0.0;
					if (frame.Y > num * 7)
					{
						frame.Y -= num;
					}
				}
			}
			else if (ai[0] == 4f || ai[0] == 5f)
			{
				if (ai[0] == 4f && ai[2] == 1f)
				{
					rotation = 0f;
				}
				frame.Y = num * 13;
				frameCounter = 0.0;
			}
			else
			{
				if (ai[0] != 4.1f)
				{
					break;
				}
				rotation = 0f;
				if (frame.Y > num * 6)
				{
					frameCounter = 0.0;
				}
				frameCounter += 1.0;
				int num26 = 4;
				if (frameCounter < (double)num26)
				{
					frame.Y = num * 6;
					break;
				}
				if (frameCounter < (double)(num26 * 2))
				{
					frame.Y = num * 5;
					break;
				}
				if (frameCounter < (double)(num26 * 3))
				{
					frame.Y = num * 4;
					break;
				}
				if (frameCounter < (double)(num26 * 4))
				{
					frame.Y = num * 3;
					break;
				}
				if (frameCounter < (double)(num26 * 5))
				{
					frame.Y = num * 4;
					break;
				}
				frame.Y = num * 5;
				if (frameCounter >= (double)(num26 * 6 - 1))
				{
					frameCounter = 0.0;
				}
			}
			break;
		case 477:
			frameCounter += velocity.Length() / 4f;
			frameCounter += 1.0;
			if (frameCounter >= 6.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
			}
			if (frame.Y / num > 5)
			{
				frame.Y = 0;
			}
			break;
		case 479:
		{
			frameCounter += 1.0;
			int num8 = 4;
			if (frameCounter < (double)num8)
			{
				frame.Y = 0;
			}
			else if (frameCounter < (double)(num8 * 2))
			{
				frame.Y = num;
			}
			else if (frameCounter < (double)(num8 * 3))
			{
				frame.Y = num * 2;
			}
			else if (frameCounter < (double)(num8 * 4 - 1))
			{
				frame.Y = num;
			}
			else
			{
				frameCounter = 0.0;
			}
			break;
		}
		case 472:
			if (velocity.X < 0f)
			{
				direction = -1;
			}
			else
			{
				direction = 1;
			}
			if (direction == 1)
			{
				spriteDirection = 1;
			}
			if (direction == -1)
			{
				spriteDirection = -1;
			}
			rotation = (float)Math.Atan2(velocity.Y * (float)direction, velocity.X * (float)direction);
			frameCounter += 1.0;
			if (frameCounter > 4.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y / num >= 6)
			{
				frame.Y = 0;
			}
			break;
		case 449:
		case 450:
		case 451:
		case 452:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (ai[2] > 0f)
				{
					spriteDirection = direction;
					int num118 = 0;
					int num119 = Main.npcFrameCount[type] - 5;
					int num120 = 5;
					int num121 = 7;
					num118 = ((ai[1] >= 50f) ? 1 : ((ai[1] >= (float)(50 - num121)) ? 2 : ((ai[1] >= (float)(50 - num121 * 2)) ? 3 : ((ai[1] >= (float)(50 - num121 * 3)) ? 4 : 0))));
					frame.Y = num * (num119 + num118);
					frameCounter = 0.0;
					break;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					break;
				}
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
				frameCounter += Math.Abs(velocity.X) * 2f;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= 15)
				{
					frame.Y = num * 2;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num;
			}
			break;
		case 481:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (ai[2] > 0f)
				{
					spriteDirection = direction;
					int num45 = 0;
					if (ai[1] < 22f)
					{
						num45 = -14;
					}
					else if (ai[1] < 28f)
					{
						num45 = 3;
					}
					else if (ai[1] < 34f)
					{
						num45 = 2;
					}
					else if (ai[1] < 40f)
					{
						num45 = 1;
					}
					frame.Y = num * (15 + num45);
					frameCounter = 0.0;
				}
				else if (velocity.X == 0f)
				{
					frame.Y = num;
				}
				else
				{
					if (frame.Y < num * 2)
					{
						frame.Y = num * 2;
					}
					frameCounter += Math.Abs(velocity.X) * 2f;
					if (frameCounter > 6.0)
					{
						frame.Y += num;
						frameCounter = 0.0;
					}
					if (frame.Y / num >= 15)
					{
						frame.Y = num * 2;
					}
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = 0;
			}
			break;
		case 468:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (ai[2] > 0f)
				{
					spriteDirection = direction;
					int num205 = 0;
					if (ai[1] < 22f)
					{
						num205 = -15;
					}
					else if (ai[1] < 28f)
					{
						num205 = 3;
					}
					else if (ai[1] < 34f)
					{
						num205 = 2;
					}
					else if (ai[1] < 40f)
					{
						num205 = 1;
					}
					frame.Y = num * (15 + num205);
					frameCounter = 0.0;
				}
				else if (velocity.X == 0f)
				{
					frame.Y = 0;
				}
				else
				{
					if (frame.Y < num * 2)
					{
						frame.Y = num * 2;
					}
					frameCounter += Math.Abs(velocity.X) * 2f;
					if (frameCounter > 6.0)
					{
						frame.Y += num;
						frameCounter = 0.0;
					}
					if (frame.Y / num >= 15)
					{
						frame.Y = num * 2;
					}
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num;
			}
			break;
		case 379:
		case 380:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (ai[2] > 0f)
				{
					spriteDirection = direction;
					frame.Y = num * ((int)ai[2] - 1 + 2);
					frameCounter = 0.0;
					break;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					break;
				}
				if (frame.Y < num * 7)
				{
					frame.Y = num * 7;
				}
				frameCounter += Math.Abs(velocity.X) * 2f;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 7;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num;
			}
			break;
		case 381:
		case 382:
		case 383:
		case 385:
		case 389:
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
				if (type == 389 || type == 385)
				{
					frameCounter += (double)Math.Abs(velocity.X) * 1.2;
				}
				else
				{
					frameCounter += Math.Abs(velocity.X) * 2f;
				}
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 2;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num;
			}
			break;
		case 387:
			if (ai[0] > 0f)
			{
				frameCounter += 1.0;
				if (ai[0] >= 20f)
				{
					frameCounter += 1.0;
				}
				if (ai[0] >= 40f)
				{
					frameCounter += 1.0;
				}
				if (frameCounter >= 10.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
					if (frame.Y >= num * 2)
					{
						frame.Y = 0;
					}
				}
				break;
			}
			frameCounter += 1.0;
			if (frameCounter >= 15.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y >= num * 2)
				{
					frame.Y = 0;
				}
			}
			break;
		case 386:
			if (ai[2] > 0f)
			{
				int num41 = (int)ai[2] / 12;
				frame.Y = num * (9 + num41 % 2);
			}
			else if (velocity.Y == 0f)
			{
				spriteDirection = direction;
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
				frameCounter += Math.Abs(velocity.X) * 2f;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= 9)
				{
					frame.Y = num * 2;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num;
			}
			break;
		case 388:
		{
			frameCounter += 1.0;
			int num42 = 6;
			if (frameCounter >= (double)num42)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y >= num * 2)
				{
					frame.Y = 0;
				}
			}
			break;
		}
		case 391:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = -1;
				}
				if (direction == -1)
				{
					spriteDirection = 1;
				}
				if (frame.Y < num)
				{
					frame.Y = num;
				}
				frameCounter += Math.Abs(velocity.X) * 0.5f;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = 0;
			}
			break;
		case 390:
			if (IsABestiaryIconDummy)
			{
				frameCounter += Math.Abs(velocity.X) * 0.5f;
				if (frameCounter > 6.0)
				{
					frameCounter = 0.0;
					localAI[3] += 1f;
					if (localAI[3] >= (float)Main.npcFrameCount[391])
					{
						localAI[3] = 0f;
					}
				}
			}
			if (direction != 0)
			{
				spriteDirection = -direction;
			}
			if (ai[2] > 0f)
			{
				frame.Y = num * ((int)ai[2] - 1);
			}
			else
			{
				frame.Y = num * 2;
			}
			break;
		case 393:
		{
			int num134 = 0;
			Vector2 vector3 = ai[2].ToRotationVector2();
			num134 = ((vector3.Y > Math.Abs(vector3.X) * 2f) ? 4 : ((vector3.Y > Math.Abs(vector3.X) * 1.5f) ? ((vector3.X > 0f) ? 5 : 3) : ((Math.Abs(vector3.X) > vector3.Y * 2f) ? ((vector3.X > 0f) ? 8 : 0) : ((!(Math.Abs(vector3.X) > vector3.Y * 1.5f)) ? ((vector3.X > 0f) ? 6 : 2) : ((!(vector3.X > 0f)) ? 1 : 7)))));
			frame.Y = num * num134;
			float num135 = 280f;
			float num136 = 140f;
			if (ai[3] >= num135 && ai[3] < num135 + num136 && (int)ai[3] % 6 <= 2)
			{
				frame.Y += num * 9;
			}
			break;
		}
		case 394:
		{
			int num188 = (int)ai[3] - 300;
			if (num188 >= 120)
			{
				num188 -= 120;
				if (num188 >= 160)
				{
					frame.Y = num * (7 - (num188 - 160) / 5);
				}
				else if (num188 >= 20)
				{
					frame.Y = num * (num188 / 4 % 4);
				}
				else
				{
					frame.Y = num * (4 + num188 / 5);
				}
			}
			else
			{
				frame.Y = num * 4;
			}
			break;
		}
		case 395:
		{
			float num124 = 20f;
			float num125 = 240f;
			bool flag10 = ai[3] >= num124 && ai[3] < num124 + num125;
			frameCounter += 1.0;
			if (frameCounter >= 66.0)
			{
				frameCounter = 0.0;
			}
			if (flag10)
			{
				frameCounter += 1.0;
				if (frameCounter >= 54.0 || frameCounter < 36.0)
				{
					frameCounter = 36.0;
				}
			}
			int num126 = (int)frameCounter % 66;
			num126 /= 6;
			frame.Y = num * num126;
			break;
		}
		case 392:
		{
			float num54 = 20f;
			float num55 = 240f;
			bool flag6 = ai[3] >= num54 && ai[3] < num54 + num55;
			frameCounter += 1.0;
			if (flag6)
			{
				frameCounter += 1.0;
			}
			if (frameCounter >= 12.0)
			{
				frameCounter = 0.0;
			}
			int num56 = (int)frameCounter % 12;
			num56 /= 3;
			frame.Y = num * num56;
			break;
		}
		case 399:
			frameCounter = (frameCounter + 0.25) % 4.0 + (double)((ai[0] != 0f) ? 4 : 0);
			frame.Y = num * (int)frameCounter;
			break;
		case 520:
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
				frameCounter += Math.Abs(velocity.X) * 1f;
				if (frameCounter > 6.0)
				{
					if (Math.Abs(velocity.X) < 0.2f)
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
					else
					{
						frame.Y += num;
						frameCounter = 0.0;
					}
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num;
			}
			break;
		case 398:
		{
			if (ai[0] <= 0f)
			{
				frame.Y = 0;
				break;
			}
			if (frame.Y == 0)
			{
				Gore.NewGore(position + new Vector2(-10f, -15f), velocity, 619);
				Gore.NewGore(position + new Vector2(10f, -15f), velocity, 620);
				Gore.NewGore(position + new Vector2(-10f, 15f), velocity, 621);
				Gore.NewGore(position + new Vector2(10f, 15f), velocity, 622);
				for (int j = 0; j < 50; j++)
				{
					frame.Y = num;
					Dust.NewDust(position, width, height, 209);
				}
			}
			frameCounter += 1.0;
			if (frameCounter >= 30.0)
			{
				frameCounter = 6.0;
			}
			int num43 = (int)frameCounter % 30;
			num43 /= 6;
			frame.Y = num * num43;
			break;
		}
		case 396:
		{
			int num14 = 4;
			int num15 = 8;
			frameCounter += 1.0;
			if (Main.rand.Next(10) == 0)
			{
				frameCounter += 1.0;
			}
			if (frameCounter >= (double)(num14 * num15))
			{
				frameCounter = 0.0;
			}
			frame.Y = (int)(frameCounter / (double)num14);
			break;
		}
		case 397:
		{
			int num23 = (int)frameCounter / 7;
			frame.Y = num * num23;
			break;
		}
		case 400:
		{
			frameCounter += 1.0;
			if (ai[0] == 0f || ai[0] == 3f)
			{
				frameCounter += 1.0;
			}
			if (frameCounter >= 16.0)
			{
				frameCounter = 0.0;
			}
			int num10 = (int)frameCounter % 16;
			num10 /= 4;
			frame.Y = num * num10;
			break;
		}
		case 437:
		{
			frameCounter += 1.0;
			if (frameCounter >= 20.0)
			{
				frameCounter = 0.0;
			}
			int num11 = (int)frameCounter % 20;
			num11 /= 5;
			frame.Y = num * num11;
			break;
		}
		case 438:
		{
			frameCounter += 1.0;
			if (ai[1] == 1f)
			{
				frameCounter += 1.0;
			}
			if (frameCounter >= 49.0)
			{
				frameCounter = 0.0;
			}
			int num16 = (int)frameCounter % 49;
			num16 /= 7;
			if (num16 >= 4)
			{
				num16 = 6 - num16;
			}
			frame.Y = num * num16;
			break;
		}
		case 439:
		case 440:
		{
			int num267 = (int)localAI[2];
			if (IsABestiaryIconDummy)
			{
				if (frameCounter > 5.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y < num * 4 || frame.Y > num * 6)
				{
					frame.Y = num * 4;
				}
			}
			else
			{
				switch (num267)
				{
				case 0:
					if (frameCounter >= 15.0)
					{
						frameCounter = 0.0;
						frame.Y = 0;
					}
					else if (frame.Y != 0)
					{
						frame.Y = ((int)frameCounter / 5 + 4) * num;
					}
					break;
				case 10:
					if (frameCounter >= 15.0)
					{
						frameCounter = 0.0;
					}
					frame.Y = ((int)frameCounter / 5 + 4) * num;
					break;
				case 1:
					if (frameCounter >= 15.0)
					{
						frameCounter = 0.0;
						frame.Y = num;
					}
					else if (frame.Y != num)
					{
						frame.Y = ((int)frameCounter / 5 + 10) * num;
					}
					break;
				case 11:
					if (frameCounter >= 15.0)
					{
						frameCounter = 0.0;
					}
					frame.Y = ((int)frameCounter / 5 + 10) * num;
					break;
				case 2:
					if (frameCounter >= 15.0)
					{
						frameCounter = 0.0;
						frame.Y = num * 2;
					}
					else if (frame.Y != num * 2)
					{
						frame.Y = ((int)frameCounter / 5 + 7) * num;
					}
					break;
				case 12:
					if (frameCounter >= 15.0)
					{
						frameCounter = 0.0;
					}
					frame.Y = ((int)frameCounter / 5 + 7) * num;
					break;
				case 13:
					if (frameCounter >= 15.0)
					{
						frameCounter = 0.0;
					}
					frame.Y = ((int)frameCounter / 5 + 13) * num;
					break;
				}
			}
			frameCounter += 1.0;
			break;
		}
		case 521:
			if (velocity.X < 0f)
			{
				direction = -1;
			}
			else
			{
				direction = 1;
			}
			if (direction != 0)
			{
				spriteDirection = direction;
			}
			rotation = (float)Math.Atan2(velocity.Y * (float)spriteDirection, velocity.X * (float)spriteDirection) + velocity.X * 0.1f;
			if ((frameCounter += 1.0) >= 5.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 523:
			if ((frameCounter += 1.0) >= 6.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 371:
		case 372:
		case 373:
			frame.Y = num;
			break;
		case 370:
		{
			if (ai[0] == 0f || ai[0] == 5f)
			{
				int num51 = 5;
				if (ai[0] == 5f)
				{
					num51 = 4;
				}
				frameCounter += 1.0;
				if (frameCounter > (double)num51)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y >= num * 6)
				{
					frame.Y = 0;
				}
			}
			if (ai[0] == 1f || ai[0] == 6f)
			{
				if (ai[2] < 10f)
				{
					frame.Y = num * 6;
				}
				else
				{
					frame.Y = num * 7;
				}
			}
			if (ai[0] == 2f || ai[0] == 7f)
			{
				if (ai[2] < 10f)
				{
					frame.Y = num * 6;
				}
				else
				{
					frame.Y = num * 7;
				}
			}
			if (ai[0] == 3f || ai[0] == 8f || ai[0] == -1f)
			{
				int num52 = 90;
				if (ai[2] < (float)(num52 - 30) || ai[2] > (float)(num52 - 10))
				{
					frameCounter += 1.0;
					if (frameCounter > 5.0)
					{
						frameCounter = 0.0;
						frame.Y += num;
					}
					if (frame.Y >= num * 6)
					{
						frame.Y = 0;
					}
				}
				else
				{
					frame.Y = num * 6;
					if (ai[2] > (float)(num52 - 20) && ai[2] < (float)(num52 - 15))
					{
						frame.Y = num * 7;
					}
				}
			}
			if (ai[0] != 4f && ai[0] != 9f)
			{
				break;
			}
			int num53 = 180;
			if (ai[2] < (float)(num53 - 60) || ai[2] > (float)(num53 - 20))
			{
				frameCounter += 1.0;
				if (frameCounter > 5.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y >= num * 6)
				{
					frame.Y = 0;
				}
			}
			else
			{
				frame.Y = num * 6;
				if (ai[2] > (float)(num53 - 50) && ai[2] < (float)(num53 - 25))
				{
					frame.Y = num * 7;
				}
			}
			break;
		}
		case 359:
		case 360:
		case 655:
			if (velocity.Y > 1f)
			{
				frameCounter += 1.0;
				int num38 = 6;
				if (frameCounter < (double)num38)
				{
					frame.Y = num * 4;
					break;
				}
				frame.Y = num * 5;
				if (frameCounter >= (double)(num38 * 2 - 1))
				{
					frameCounter = 0.0;
				}
			}
			else
			{
				if (!(velocity != Vector2.Zero))
				{
					break;
				}
				frameCounter += 1.0;
				int num39 = 10;
				if (frameCounter < (double)num39)
				{
					frame.Y = 0;
					break;
				}
				if (frameCounter < (double)(num39 * 2))
				{
					frame.Y = num;
					break;
				}
				if (frameCounter < (double)(num39 * 3))
				{
					frame.Y = num * 2;
					break;
				}
				if (frameCounter < (double)(num39 * 4))
				{
					frame.Y = num * 3;
					break;
				}
				if (frameCounter < (double)(num39 * 5))
				{
					frame.Y = num * 2;
					break;
				}
				frame.Y = num;
				if (frameCounter >= (double)(num39 * 6 - 1))
				{
					frameCounter = 0.0;
				}
			}
			break;
		case 327:
			if (ai[3] == 0f)
			{
				if (frame.Y > num * 5)
				{
					frameCounter += 1.0;
				}
				else if (frame.Y > 0)
				{
					frameCounter -= 1.0;
				}
			}
			else if (ai[3] == 1f)
			{
				if (frame.Y > num * 10)
				{
					frameCounter += 1.0;
				}
				else if (frame.Y > num * 4)
				{
					frameCounter -= 1.0;
				}
				else if (frame.Y < num * 4)
				{
					frameCounter += 1.0;
				}
			}
			else if (ai[3] == 2f)
			{
				if (frame.Y < num * 2)
				{
					frameCounter -= 1.0;
				}
				else if (frame.Y > num * 8)
				{
					frameCounter -= 1.0;
				}
				else if (frame.Y < num * 8)
				{
					frameCounter += 1.0;
				}
			}
			if (frameCounter > 6.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y > num * 11)
				{
					frame.Y = 0;
				}
			}
			if (frameCounter < 0.0)
			{
				frameCounter = 6.0;
				frame.Y -= num;
				if (frame.Y < 0)
				{
					frame.Y = num * 11;
				}
			}
			break;
		case 347:
			frameCounter += 1.0;
			if (frameCounter > 1.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y > num * 3)
			{
				frame.Y = 0;
			}
			break;
		case 346:
			if (ai[0] == 1f)
			{
				spriteDirection = direction;
				frameCounter += 1.0;
				if (frameCounter > 2.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y > num * 8)
				{
					frame.Y = num * 6;
				}
				if (frame.Y < num * 6)
				{
					frame.Y = num * 6;
				}
				break;
			}
			if (velocity.X == 0f)
			{
				ref int y2 = ref frame.Y;
				y2 = y2;
				frameCounter = 0.0;
				break;
			}
			spriteDirection = direction;
			frameCounter += 1.0;
			frameCounter += Math.Abs(velocity.X) / 2f;
			if (frameCounter > 4.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y > num * 5)
			{
				frame.Y = num;
			}
			if (frame.Y < num)
			{
				frame.Y = num;
			}
			break;
		case 352:
			frameCounter += 1.0;
			if (frameCounter > 3.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y > num * 5)
			{
				frame.Y = 0;
			}
			break;
		case 345:
			if (ai[0] == 0f)
			{
				if (ai[3] >= 0f)
				{
					frame.Y = 0;
				}
				else if (velocity.X < 0f)
				{
					frame.Y = num;
				}
				else
				{
					frame.Y = num * 2;
				}
			}
			else if (ai[0] == 1f)
			{
				frameCounter += 1.0;
				if (frameCounter > 5.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y > num * 4)
				{
					frame.Y = num * 3;
				}
				if (frame.Y < num * 3)
				{
					frame.Y = num * 3;
				}
			}
			else if (ai[0] == 2f)
			{
				frame.Y = num * 5;
			}
			break;
		case 344:
			if (velocity.X == 0f)
			{
				frameCounter += 1.0;
				if (frameCounter > 5.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y > num * 9)
				{
					frame.Y = 0;
				}
			}
			else
			{
				frameCounter += Math.Max(1f, Math.Abs(velocity.X) * 0.75f);
				if (frameCounter > 5.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y > num * 9)
				{
					frame.Y = 0;
				}
			}
			break;
		case 325:
			if (velocity.X == 0f)
			{
				frameCounter += 1.0;
				if (frameCounter > 4.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y > num * 4)
				{
					frame.Y = 0;
				}
				break;
			}
			frameCounter += 1.0;
			if (frameCounter > 4.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
			}
			if (frame.Y < num * 5)
			{
				frame.Y = num * 5;
			}
			if (frame.Y > num * 9)
			{
				frame.Y = num * 5;
			}
			break;
		case 490:
			rotation = velocity.X * 0.15f;
			frameCounter += 1.0;
			if (frameCounter > 6.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
			}
			if (frame.Y >= num * Main.npcFrameCount[type])
			{
				frame.Y = 0;
			}
			break;
		case 266:
			frameCounter += 1.0;
			if (frameCounter > 6.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
			}
			if (ai[0] >= 0f && localAI[2] == 0f)
			{
				if (frame.Y > num * 3)
				{
					frame.Y = 0;
				}
				break;
			}
			if (frame.Y < num * 4)
			{
				frame.Y = num * 4;
			}
			if (frame.Y > num * 7)
			{
				frame.Y = num * 4;
			}
			break;
		case 262:
			frameCounter += 1.0;
			if (frameCounter > 6.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
			}
			if (life > lifeMax / 2)
			{
				if (frame.Y > num * 3)
				{
					frame.Y = 0;
				}
				break;
			}
			if (frame.Y < num * 4)
			{
				frame.Y = num * 4;
			}
			if (frame.Y > num * 7)
			{
				frame.Y = num * 4;
			}
			break;
		case 305:
		case 306:
		case 307:
		case 308:
		case 309:
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			if (velocity.Y < -3f)
			{
				frame.Y = num * 5;
			}
			else if (velocity.Y <= 0f)
			{
				frame.Y = 0;
			}
			else if (velocity.Y < 2f)
			{
				frame.Y = num * 3;
			}
			else
			{
				frame.Y = num;
			}
			rotation = velocity.X * 0.1f;
			break;
		case 263:
			if (velocity.X == 0f && velocity.Y == 0f)
			{
				if (frame.Y > 0)
				{
					frameCounter += 1.0;
					if (frameCounter > 4.0)
					{
						frameCounter = 0.0;
						frame.Y -= num;
					}
				}
			}
			else if (frame.Y < 2)
			{
				frameCounter += 1.0;
				if (frameCounter > 4.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
			}
			break;
		case 244:
			frameCounter += 1.0;
			if (num2 > 0)
			{
				frameCounter += 1.0;
			}
			if (num2 == 4)
			{
				frameCounter += 1.0;
			}
			if (frameCounter >= 8.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * Main.npcFrameCount[type])
			{
				frame.Y = 0;
			}
			break;
		case 289:
			frameCounter += 1.0;
			if (frameCounter < 4.0)
			{
				frame.Y = 0;
			}
			else if (frameCounter < 8.0)
			{
				frame.Y = num;
			}
			else
			{
				frame.Y = num * 2;
				frameCounter = 0.0;
				if (frameCounter > 12.0)
				{
					frameCounter = 0.0;
				}
			}
			if (ai[3] == 1f)
			{
				frame.Y += num * 3;
			}
			break;
		case 288:
			frameCounter += 1.0;
			if (frameCounter >= 6.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * Main.npcFrameCount[type])
			{
				frame.Y = 0;
			}
			break;
		case 355:
		case 358:
		case 654:
			spriteDirection = direction;
			frameCounter += 1.0;
			if (frameCounter < 4.0)
			{
				frame.Y = 0;
			}
			else
			{
				frame.Y = num;
				if (frameCounter >= 7.0)
				{
					frameCounter = 0.0;
				}
			}
			if (localAI[2] <= 0f)
			{
				frame.Y += num * 2;
			}
			break;
		case 677:
			spriteDirection = direction;
			frameCounter += 1.0;
			if ((frameCounter += 1.0) >= 6.0)
			{
				frameCounter = 0.0;
				if (++frame.Y >= 5)
				{
					frame.Y = 0;
				}
			}
			break;
		case 595:
		case 596:
		case 597:
		case 598:
		case 599:
		case 600:
		case 601:
		{
			spriteDirection = direction;
			int num204 = 3;
			if ((frameCounter += 1.0) >= (double)(Main.npcFrameCount[type] * num204))
			{
				frameCounter = 0.0;
			}
			frame.Y = num * ((int)frameCounter / num204);
			break;
		}
		case 356:
		case 444:
		case 653:
		case 661:
		{
			int num185 = 7;
			rotation = velocity.X * 0.3f;
			spriteDirection = direction;
			frameCounter = frameCounter + 1.0 + (double)((Math.Abs(velocity.X) + Math.Abs(velocity.Y)) / 2f);
			if (frameCounter < (double)num185)
			{
				frame.Y = 0;
			}
			else if (frameCounter < (double)(num185 * 2))
			{
				frame.Y = num;
			}
			else if (frameCounter < (double)(num185 * 3))
			{
				frame.Y = num * 2;
			}
			else
			{
				frame.Y = num;
				if (frameCounter >= (double)(num185 * 4 - 1))
				{
					frameCounter = 0.0;
				}
			}
			if (type != 444 && type != 653 && type != 661)
			{
				frame.Y += (int)((float)(num * 3) * (ai[2] - 1f));
			}
			break;
		}
		case 357:
		case 448:
		case 484:
		case 606:
		{
			localAI[0] = -2f;
			if (velocity.Y == 0f)
			{
				rotation = 0f;
				if (velocity.X == 0f)
				{
					frame.Y = num;
					frameCounter = 0.0;
				}
				else
				{
					frameCounter += 1.0;
					if (frameCounter > 12.0)
					{
						frameCounter = 0.0;
						frame.Y += num;
						if (frame.Y > num)
						{
							frame.Y = 0;
						}
					}
				}
			}
			else
			{
				rotation += (float)direction * 0.1f;
				frame.Y = num;
			}
			int i3 = (int)base.Center.X / 16;
			int j3 = (int)position.Y / 16;
			Tile tileSafely2 = Framing.GetTileSafely(i3, j3);
			if (tileSafely2 != null)
			{
				if (tileSafely2.slope() == 0)
				{
					j3++;
					tileSafely2 = Framing.GetTileSafely(i3, j3);
				}
				if (tileSafely2.slope() == 1)
				{
					rotation = 0.785f;
					localAI[0] = 0f;
				}
				else if (tileSafely2.slope() == 2)
				{
					rotation = -0.785f;
					localAI[0] = 0f;
				}
			}
			break;
		}
		case 485:
		case 486:
		case 487:
		{
			spriteDirection = direction;
			localAI[0] = -2f;
			if (velocity.Y == 0f)
			{
				rotation = 0f;
				if (velocity.X == 0f)
				{
					frame.Y = num;
					frameCounter = 0.0;
				}
				else
				{
					frameCounter += Math.Abs(velocity.X * 5f);
					if (frameCounter > 10.0)
					{
						frameCounter = 0.0;
						frame.Y += num;
						if (frame.Y > num * 3)
						{
							frame.Y = 0;
						}
					}
				}
			}
			else
			{
				rotation += (float)direction * 0.1f;
				frame.Y = num;
			}
			int i2 = (int)base.Center.X / 16;
			int j2 = (int)position.Y / 16;
			Tile tileSafely = Framing.GetTileSafely(i2, j2);
			if (tileSafely != null)
			{
				if (tileSafely.slope() == 0)
				{
					j2++;
					tileSafely = Framing.GetTileSafely(i2, j2);
				}
				if (tileSafely.slope() == 1)
				{
					rotation = 0.785f;
					localAI[0] = 0f;
				}
				else if (tileSafely.slope() == 2)
				{
					rotation = -0.785f;
					localAI[0] = 0f;
				}
			}
			break;
		}
		case 250:
		case 264:
		case 268:
			frameCounter += 1.0;
			if (frameCounter >= 6.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * Main.npcFrameCount[type])
			{
				frame.Y = 0;
			}
			break;
		case 245:
			if (ai[0] == 0f)
			{
				if (ai[1] < -16f)
				{
					frame.Y = 0;
				}
				else if (ai[1] < -12f)
				{
					frame.Y = num;
				}
				else if (ai[1] < -8f)
				{
					frame.Y = num * 2;
				}
				else if (ai[1] < -4f)
				{
					frame.Y = num * 3;
				}
				else if (ai[1] < 0f)
				{
					frame.Y = num * 4;
				}
				else
				{
					frame.Y = 0;
				}
			}
			else if (ai[0] == 1f)
			{
				frame.Y = 1;
			}
			break;
		case 246:
			if (ai[0] == 0f)
			{
				if (localAI[0] == 1f)
				{
					frame.Y = num;
				}
				else
				{
					frame.Y = 0;
				}
			}
			else if (ai[0] == 1f)
			{
				if (localAI[0] == 1f)
				{
					frame.Y = num;
				}
				else
				{
					frame.Y = 0;
				}
				if (localAI[1] == -1f)
				{
					frame.Y += num * 4;
				}
				if (localAI[1] == 1f)
				{
					frame.Y += num * 2;
				}
			}
			break;
		case 249:
			if (localAI[0] == 1f)
			{
				frame.Y = num;
			}
			else
			{
				frame.Y = 0;
			}
			if ((frameCounter += 1.0) >= 16.0)
			{
				frameCounter = 0.0;
			}
			break;
		case 141:
			spriteDirection = direction;
			if (velocity.Y != 0f)
			{
				frame.Y = num * 2;
				break;
			}
			frameCounter += 1.0;
			if (frameCounter >= 8.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y > num)
			{
				frame.Y = 0;
			}
			break;
		case 243:
			if (frameCounter < 0.0)
			{
				if (velocity.Y == 0f)
				{
					frameCounter += 1.0;
					if (frameCounter < -12.0)
					{
						if (frame.Y > num * 9)
						{
							frame.Y = num * 11;
						}
					}
					else if (frameCounter < -6.0)
					{
						if (frame.Y > num * 9)
						{
							frame.Y = num * 12;
						}
					}
					else if (frameCounter < 0.0)
					{
						frameCounter = 0.0;
						if (frame.Y > num * 9)
						{
							frame.Y = num * 11;
						}
					}
				}
				else
				{
					frameCounter = -18.0;
					if (velocity.Y < 0f)
					{
						frame.Y = num * 14;
					}
					else
					{
						frame.Y = num * 13;
					}
				}
				break;
			}
			spriteDirection = direction;
			frameCounter += Math.Abs(velocity.X * 1.1f);
			if (frameCounter >= 6.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y > num * 9)
				{
					frame.Y = 0;
				}
			}
			if (velocity.Y < -2f || velocity.Y > 5f)
			{
				frameCounter = -18.0;
			}
			break;
		case 222:
			frameCounter += 1.0;
			if (localAI[0] == 1f)
			{
				if (frameCounter > 4.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y >= num * 4)
				{
					frame.Y = 0;
				}
				break;
			}
			if (frameCounter > 4.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y < num * 4)
			{
				frame.Y = num * 4;
			}
			if (frame.Y >= num * 12)
			{
				frame.Y = num * 4;
			}
			break;
		case 164:
		case 236:
		case 239:
		case 530:
			if (velocity.Y != 0f)
			{
				frameCounter = 0.0;
				if (velocity.Y < 0f)
				{
					frame.Y = num * 4;
				}
				else
				{
					frame.Y = 0;
				}
				break;
			}
			spriteDirection = direction;
			frameCounter += Math.Abs(velocity.X) * 1.1f;
			while (frameCounter >= 6.0)
			{
				frameCounter -= 6.0;
				frame.Y += num;
				if (frame.Y > num * 3)
				{
					frame.Y = 0;
				}
			}
			break;
		case 165:
		case 237:
		case 238:
		case 240:
		case 531:
		{
			float num208 = 0.5f;
			if (type == 531)
			{
				num208 = 0.4f;
			}
			frameCounter += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * num208;
			if (frameCounter < 6.0)
			{
				frame.Y = 0;
			}
			else if (frameCounter < 12.0)
			{
				frame.Y = num;
			}
			else if (frameCounter < 18.0)
			{
				frame.Y = num * 2;
			}
			else if (frameCounter < 24.0)
			{
				frame.Y = num * 3;
			}
			else
			{
				frameCounter = 0.0;
			}
			break;
		}
		case 195:
			if (ai[0] < 3f)
			{
				frame.Y = 0;
			}
			else if (ai[0] < 6f)
			{
				frame.Y = num;
			}
			else if (ai[0] < 9f)
			{
				frame.Y = num * 2;
			}
			else if (ai[0] < 12f)
			{
				frame.Y = num * 3;
			}
			else if (ai[0] < 15f)
			{
				frame.Y = num * 4;
			}
			else
			{
				frame.Y = num * 5;
			}
			break;
		case 174:
			if (IsABestiaryIconDummy)
			{
				frameCounter += 1.0;
				if (frameCounter > 5.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y > num * 4)
				{
					frame.Y = 0;
				}
			}
			else if (velocity.Y == 0f)
			{
				frame.Y = 0;
			}
			else if ((double)velocity.Y < -1.5)
			{
				frame.Y = num;
			}
			else if ((double)velocity.Y > 1.5)
			{
				frame.Y = num * 3;
			}
			else
			{
				frame.Y = num * 2;
			}
			break;
		case 177:
			if (velocity.Y == 0f)
			{
				frameCounter += 1.0;
				if (frameCounter >= 10.0)
				{
					frameCounter = 30.0;
					frame.Y = 0;
				}
				else
				{
					frame.Y = num;
				}
			}
			else if (velocity.Y < 0f)
			{
				frame.Y = num * 2;
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num * 2;
			}
			break;
		case 163:
			if (velocity.Y != 0f)
			{
				frameCounter = -12.0;
				if (velocity.Y < 0f)
				{
					frame.Y = num * 5;
				}
				else
				{
					frame.Y = num * 6;
				}
				break;
			}
			spriteDirection = direction;
			frameCounter += Math.Abs(velocity.X) * 1.1f;
			if (frameCounter < -6.0)
			{
				frame.Y = num * 6;
			}
			else if (frameCounter < 0.0)
			{
				frame.Y = num * 7;
			}
			else if (frameCounter < 6.0)
			{
				frame.Y = num;
			}
			else if (frameCounter < 12.0)
			{
				frame.Y = num * 2;
			}
			else if (frameCounter < 18.0)
			{
				frame.Y = num * 3;
			}
			else
			{
				frameCounter = 0.0;
			}
			break;
		case 143:
			if (velocity.Y > 0f)
			{
				frameCounter += 1.0;
			}
			else if (velocity.Y < 0f)
			{
				frameCounter -= 1.0;
			}
			if (frameCounter < 6.0)
			{
				frame.Y = num;
			}
			else if (frameCounter < 12.0)
			{
				frame.Y = num * 2;
			}
			else if (frameCounter < 18.0)
			{
				frame.Y = num * 3;
			}
			if (frameCounter < 0.0)
			{
				frameCounter = 0.0;
			}
			if (frameCounter > 17.0)
			{
				frameCounter = 17.0;
			}
			break;
		case 144:
			if (velocity.X == 0f && velocity.Y == 0f)
			{
				localAI[3] += 1f;
				if (localAI[3] < 6f)
				{
					frame.Y = 0;
				}
				else if (localAI[3] < 12f)
				{
					frame.Y = num;
				}
				if (localAI[3] >= 11f)
				{
					localAI[3] = 0f;
				}
				break;
			}
			if (velocity.Y > 0f)
			{
				frameCounter += 1.0;
			}
			else if (velocity.Y < 0f)
			{
				frameCounter -= 1.0;
			}
			if (frameCounter < 6.0)
			{
				frame.Y = num * 2;
			}
			else if (frameCounter < 12.0)
			{
				frame.Y = num * 3;
			}
			else if (frameCounter < 18.0)
			{
				frame.Y = num * 4;
			}
			if (frameCounter < 0.0)
			{
				frameCounter = 0.0;
			}
			if (frameCounter > 17.0)
			{
				frameCounter = 17.0;
			}
			break;
		case 145:
			if (velocity.X == 0f && velocity.Y == 0f)
			{
				if (ai[2] < 4f)
				{
					frame.Y = 0;
				}
				else if (ai[2] < 8f)
				{
					frame.Y = num;
				}
				else if (ai[2] < 12f)
				{
					frame.Y = num * 2;
				}
				else if (ai[2] < 16f)
				{
					frame.Y = num * 3;
				}
				break;
			}
			if (velocity.Y > 0f)
			{
				frameCounter += 1.0;
			}
			else if (velocity.Y < 0f)
			{
				frameCounter -= 1.0;
			}
			if (frameCounter < 6.0)
			{
				frame.Y = num * 4;
			}
			else if (frameCounter < 12.0)
			{
				frame.Y = num * 5;
			}
			else if (frameCounter < 18.0)
			{
				frame.Y = num * 6;
			}
			if (frameCounter < 0.0)
			{
				frameCounter = 0.0;
			}
			if (frameCounter > 17.0)
			{
				frameCounter = 17.0;
			}
			break;
		case 50:
			if (velocity.Y != 0f)
			{
				if (frame.Y < num * 4)
				{
					frame.Y = num * 4;
					frameCounter = 0.0;
				}
				if ((frameCounter += 1.0) >= 4.0)
				{
					frame.Y = num * 5;
				}
				break;
			}
			if (frame.Y >= num * 5)
			{
				frame.Y = num * 4;
				frameCounter = 0.0;
			}
			frameCounter += 1.0;
			if (num2 > 0)
			{
				frameCounter += 1.0;
			}
			if (num2 == 4)
			{
				frameCounter += 1.0;
			}
			if (frameCounter >= 8.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
				if (frame.Y >= num * 4)
				{
					frame.Y = 0;
				}
			}
			break;
		case 170:
		case 171:
		case 180:
			spriteDirection = direction;
			frameCounter += 1.0;
			if (frameCounter >= 4.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * 14)
			{
				frame.Y = 0;
			}
			break;
		case 135:
			if (ai[2] == 0f)
			{
				frame.Y = 0;
			}
			else
			{
				frame.Y = num;
			}
			break;
		case 85:
		case 341:
		case 629:
			if (ai[0] == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
			}
			else
			{
				int num189 = 3;
				if (velocity.Y == 0f)
				{
					frameCounter -= 1.0;
				}
				else
				{
					frameCounter += 1.0;
				}
				if (frameCounter < 0.0)
				{
					frameCounter = 0.0;
				}
				if (frameCounter > (double)(num189 * 4))
				{
					frameCounter = num189 * 4;
				}
				if (frameCounter < (double)num189)
				{
					frame.Y = num;
				}
				else if (frameCounter < (double)(num189 * 2))
				{
					frame.Y = num * 2;
				}
				else if (frameCounter < (double)(num189 * 3))
				{
					frame.Y = num * 3;
				}
				else if (frameCounter < (double)(num189 * 4))
				{
					frame.Y = num * 4;
				}
				else if (frameCounter < (double)(num189 * 5))
				{
					frame.Y = num * 5;
				}
				else if (frameCounter < (double)(num189 * 6))
				{
					frame.Y = num * 4;
				}
				else if (frameCounter < (double)(num189 * 7))
				{
					frame.Y = num * 3;
				}
				else
				{
					frame.Y = num * 2;
					if (frameCounter >= (double)(num189 * 8))
					{
						frameCounter = num189;
					}
				}
			}
			if (ai[3] == 2f || (IsABestiaryIconDummy && type == 85))
			{
				frame.Y += num * 6;
			}
			else if (ai[3] == 3f)
			{
				frame.Y += num * 12;
			}
			break;
		case 113:
		case 114:
			if (ai[2] == 0f)
			{
				frameCounter += 1.0;
				if (frameCounter >= 12.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y >= num * Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			else
			{
				frame.Y = 0;
				frameCounter = -60.0;
			}
			break;
		case 61:
		{
			spriteDirection = direction;
			rotation = velocity.X * 0.1f;
			if (velocity.X == 0f && velocity.Y == 0f)
			{
				frame.Y = 0;
				frameCounter = 0.0;
				break;
			}
			int num148 = 5;
			int num149 = 5;
			frameCounter += 1.0;
			if (frameCounter >= (double)(num148 * num149))
			{
				frameCounter = 0.0;
			}
			int num150 = (int)(frameCounter / (double)num148);
			frame.Y = (num150 + 1) * num;
			break;
		}
		case 252:
		case 301:
			if (type == 301)
			{
				if (velocity.Y == 0f)
				{
					spriteDirection = -direction;
				}
				else
				{
					if ((double)velocity.X > 0.5)
					{
						spriteDirection = -1;
					}
					if ((double)velocity.X < -0.5)
					{
						spriteDirection = 1;
					}
				}
			}
			else
			{
				if ((double)velocity.X > 0.5)
				{
					spriteDirection = 1;
				}
				if ((double)velocity.X < -0.5)
				{
					spriteDirection = -1;
				}
			}
			rotation = velocity.X * 0.1f;
			if (velocity.X == 0f && velocity.Y == 0f)
			{
				frame.Y = 0;
				frameCounter = 0.0;
				break;
			}
			frameCounter += 1.0;
			if (frameCounter > 4.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
			}
			if (frame.Y > num * 4 || frame.Y == 0)
			{
				frame.Y = num;
			}
			break;
		case 122:
			spriteDirection = direction;
			rotation = velocity.X * 0.05f;
			if (ai[3] > 0f)
			{
				int num128 = (int)(ai[3] / 8f);
				frameCounter = 0.0;
				frame.Y = (num128 + 3) * num;
				break;
			}
			frameCounter += 1.0;
			if (frameCounter >= 8.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * 3)
			{
				frame.Y = 0;
			}
			break;
		case 74:
		case 297:
		case 298:
		case 442:
		{
			spriteDirection = direction;
			rotation = velocity.X * 0.1f;
			if (velocity.X == 0f && velocity.Y == 0f)
			{
				frame.Y = num * 4;
				frameCounter = 0.0;
				break;
			}
			int num127 = Main.npcFrameCount[type] - 1;
			frameCounter += 1.0;
			if (frameCounter >= 4.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * num127)
			{
				frame.Y = 0;
			}
			break;
		}
		case 671:
		case 672:
		case 673:
		case 674:
		case 675:
		{
			spriteDirection = direction;
			rotation = velocity.X * 0.1f;
			if (velocity.X == 0f && velocity.Y == 0f)
			{
				frame.Y = 0;
				frameCounter = 0.0;
				break;
			}
			int num123 = Main.npcFrameCount[type];
			frameCounter += 1.0;
			if (frameCounter >= 4.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
			}
			if (frame.Y >= num * num123)
			{
				frame.Y = num;
			}
			break;
		}
		case 611:
		case 689:
			spriteDirection = -direction;
			rotation = velocity.X * 0.1f;
			if (velocity.X == 0f && velocity.Y == 0f)
			{
				int num112 = frame.Y / num;
				if (num112 < 0 || num112 >= 8)
				{
					frame.Y = 0;
				}
				if ((int)frameCounter % 40 != 0 || Main.rand.Next(80) == 0)
				{
					frameCounter += 1.0;
				}
				if ((frameCounter + 1.0) % 40.0 == 39.0)
				{
					frameCounter = 40 * Main.rand.Next(3);
				}
				int num113 = (int)frameCounter % 40 / 10;
				int num114 = (int)frameCounter / 40;
				int num115 = 0;
				switch (num114)
				{
				case 0:
					if (num113 == 3)
					{
						num113 = 1;
					}
					num115 = num113;
					break;
				case 1:
					if (num113 == 3)
					{
						num113 = 1;
					}
					num115 = 0;
					if (num113 != 0)
					{
						num115 = 2 + num113;
					}
					break;
				case 2:
					num115 = 0;
					if (num113 != 0)
					{
						num115 = 4 + num113;
					}
					break;
				}
				frame.Y = num * num115;
			}
			else
			{
				frameCounter += 1.0;
				if (frameCounter >= 5.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y >= num * Main.npcFrameCount[type] || frame.Y < num * 8)
				{
					frame.Y = num * 8;
				}
			}
			break;
		case 362:
		case 364:
		case 608:
			spriteDirection = direction;
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
				break;
			}
			frameCounter += 1.0;
			if (frameCounter >= 4.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * 10)
			{
				frame.Y = num * 3;
			}
			if (frame.Y < num * 3)
			{
				frame.Y = num * 3;
			}
			break;
		case 363:
		case 365:
		case 609:
			spriteDirection = direction;
			if (wet)
			{
				frameCounter += 1.0;
				if (frameCounter >= 8.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y > num * 2)
				{
					frame.Y = num;
				}
				if (frame.Y < num)
				{
					frame.Y = num;
				}
				rotation = 0f;
			}
			else if (velocity.X == 0f && velocity.Y == 0f)
			{
				frame.Y = num;
				frameCounter = 0.0;
				rotation = 0f;
			}
			else
			{
				rotation = velocity.X * 0.1f;
				frameCounter += 1.0;
				if (frameCounter >= 4.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y >= num * Main.npcFrameCount[type])
				{
					frame.Y = num * 11;
				}
				if (frame.Y < num * 11)
				{
					frame.Y = num * 11;
				}
			}
			break;
		case 602:
			spriteDirection = direction;
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
				break;
			}
			frameCounter += 1.0;
			if (frameCounter >= 4.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * 10)
			{
				frame.Y = num * 3;
			}
			if (frame.Y < num * 3)
			{
				frame.Y = num * 3;
			}
			break;
		case 603:
			spriteDirection = direction;
			if (wet)
			{
				frameCounter += 1.0;
				if (frameCounter >= 8.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y > num * 2)
				{
					frame.Y = num;
				}
				if (frame.Y < num)
				{
					frame.Y = num;
				}
				rotation = 0f;
			}
			else if (velocity.X == 0f && velocity.Y == 0f)
			{
				frame.Y = num;
				frameCounter = 0.0;
				rotation = 0f;
			}
			else
			{
				rotation = velocity.X * 0.1f;
				frameCounter += 1.0;
				if (frameCounter >= 4.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y >= num * Main.npcFrameCount[type])
				{
					frame.Y = num * 11;
				}
				if (frame.Y < num * 11)
				{
					frame.Y = num * 11;
				}
			}
			break;
		case 62:
		case 66:
		{
			spriteDirection = direction;
			rotation = velocity.X * 0.1f;
			int num5 = 5;
			int num6 = 5;
			frameCounter += 1.0;
			if (frameCounter >= (double)(num5 * num6))
			{
				frameCounter = 0.0;
			}
			int num7 = (int)(frameCounter / (double)num5);
			frame.Y = num7 * num;
			break;
		}
		case 156:
		{
			spriteDirection = direction;
			rotation = velocity.X * 0.1f;
			frameCounter += 1.0;
			if (frameCounter >= 20.0)
			{
				frameCounter = 0.0;
			}
			int num300 = (int)frameCounter / 4;
			frame.Y = num300 * num;
			break;
		}
		case 63:
		case 64:
		case 103:
		case 242:
		case 256:
			if ((type == 63 || type == 64 || type == 103 || type == 242) && ai[1] == 1f)
			{
				frameCounter += 1.0;
				if (frameCounter > 4.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y > num * 6)
				{
					frame.Y = num * 4;
				}
				if (frame.Y < num * 4)
				{
					frame.Y = num * 4;
				}
				return;
			}
			frameCounter += 1.0;
			if (frameCounter < 6.0)
			{
				frame.Y = 0;
				break;
			}
			if (frameCounter < 12.0)
			{
				frame.Y = num;
				break;
			}
			if (frameCounter < 18.0)
			{
				frame.Y = num * 2;
				break;
			}
			frame.Y = num * 3;
			if (frameCounter >= 23.0)
			{
				frameCounter = 0.0;
			}
			break;
		case 221:
			if (localAI[2] == 1f)
			{
				if (localAI[0] == 1f)
				{
					frame.Y = 0;
					localAI[0] = 0f;
				}
				frameCounter += 1.0;
				if (frameCounter >= 8.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y >= num * Main.npcFrameCount[type])
				{
					frame.Y = num * Main.npcFrameCount[type] - num;
				}
			}
			else
			{
				frameCounter += 1.0;
				if (frameCounter >= 13.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y >= num * Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 2:
		case 23:
		case 121:
		case 169:
		case 190:
		case 191:
		case 192:
		case 193:
		case 194:
		case 317:
		case 318:
		case 660:
		{
			if (type == 23)
			{
				int num137 = Dust.NewDust(new Vector2(position.X - velocity.X, position.Y - velocity.Y), width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
				Main.dust[num137].noGravity = true;
				Main.dust[num137].velocity.X *= 0.3f;
				Main.dust[num137].velocity.Y *= 0.3f;
			}
			if ((type == 121 || type == 660) && localAI[0] == 0f)
			{
				localAI[0] = 1f;
				frame.Y = num * 2;
			}
			if (type == 2 || type == 190 || type == 191 || type == 192 || type == 193 || type == 194 || type == 317 || type == 318)
			{
				if (velocity.X > 0f)
				{
					spriteDirection = 1;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X);
				}
				if (velocity.X < 0f)
				{
					spriteDirection = -1;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 3.14f;
				}
			}
			else if (type == 2 || type == 121 || type == 660)
			{
				if (velocity.X > 0f)
				{
					spriteDirection = 1;
				}
				if (velocity.X < 0f)
				{
					spriteDirection = -1;
				}
				rotation = velocity.X * 0.1f;
			}
			frameCounter++;
			float num138 = 8f;
			if (type == 660)
			{
				num138 = 6f;
			}
			if (frameCounter >= (double)num138)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * Main.npcFrameCount[type])
			{
				frame.Y = 0;
			}
			break;
		}
		case 133:
			if (velocity.X > 0f)
			{
				spriteDirection = 1;
				rotation = (float)Math.Atan2(velocity.Y, velocity.X);
			}
			if (velocity.X < 0f)
			{
				spriteDirection = -1;
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 3.14f;
			}
			frameCounter += 1.0;
			if (frameCounter >= 8.0)
			{
				frame.Y = num;
			}
			else
			{
				frame.Y = 0;
			}
			if (frameCounter >= 16.0)
			{
				frame.Y = 0;
				frameCounter = 0.0;
			}
			if ((double)life < (double)lifeMax * 0.5)
			{
				frame.Y += num * 2;
			}
			break;
		case 116:
			if (velocity.X > 0f)
			{
				spriteDirection = 1;
				rotation = (float)Math.Atan2(velocity.Y, velocity.X);
			}
			if (velocity.X < 0f)
			{
				spriteDirection = -1;
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 3.14f;
			}
			frameCounter += 1.0;
			if (frameCounter >= 5.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * Main.npcFrameCount[type])
			{
				frame.Y = 0;
			}
			break;
		case 75:
			if (velocity.X > 0f)
			{
				spriteDirection = 1;
			}
			else
			{
				spriteDirection = -1;
			}
			rotation = velocity.X * 0.1f;
			frameCounter += 1.0;
			if (frameCounter >= 4.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * Main.npcFrameCount[type])
			{
				frame.Y = 0;
			}
			break;
		case 157:
		{
			spriteDirection = direction;
			frameCounter += 1.0;
			if (!wet)
			{
				frameCounter += 1.0;
			}
			int num50 = 5;
			if (frameCounter < (double)num50)
			{
				frame.Y = 0;
			}
			else if (frameCounter < (double)(num50 * 2))
			{
				frame.Y = num;
			}
			else if (frameCounter < (double)(num50 * 3))
			{
				frame.Y = num * 2;
			}
			else if (frameCounter < (double)(num50 * 4))
			{
				frame.Y = num;
			}
			else if (frameCounter < (double)(num50 * 5))
			{
				frame.Y = num * 3;
			}
			else if (frameCounter < (double)(num50 * 6))
			{
				frame.Y = num * 4;
			}
			else if (frameCounter < (double)(num50 * 7))
			{
				frame.Y = num * 5;
			}
			else if (frameCounter < (double)(num50 * 8))
			{
				frame.Y = num * 4;
			}
			else
			{
				frameCounter = 0.0;
			}
			break;
		}
		case 55:
		case 57:
		case 58:
		case 102:
		case 241:
		case 465:
		case 592:
		case 607:
			spriteDirection = direction;
			frameCounter += 1.0;
			if (wet)
			{
				if (frameCounter < 6.0)
				{
					frame.Y = 0;
				}
				else if (frameCounter < 12.0)
				{
					frame.Y = num;
				}
				else if (frameCounter < 18.0)
				{
					frame.Y = num * 2;
				}
				else if (frameCounter < 24.0)
				{
					frame.Y = num * 3;
				}
				else
				{
					frameCounter = 0.0;
				}
			}
			else if (frameCounter < 6.0)
			{
				frame.Y = num * 4;
			}
			else if (frameCounter < 12.0)
			{
				frame.Y = num * 5;
			}
			else
			{
				frameCounter = 0.0;
			}
			break;
		case 615:
			spriteDirection = direction;
			if (!wet && ai[2] == 1f)
			{
				frame.Y = 4 * num;
				break;
			}
			if (!wet)
			{
				frameCounter++;
			}
			if ((frameCounter += 1.0) >= (double)(7 * (Main.npcFrameCount[type] - 1)))
			{
				frameCounter = 0.0;
			}
			frame.Y = (int)(frameCounter / 7.0) * num;
			break;
		case 688:
			spriteDirection = direction;
			if (ai[2] == 1f)
			{
				if (frame.Y != num * 5)
				{
					int num31 = 6;
					frameCounter++;
					if (frameCounter >= (double)num31)
					{
						frameCounter = 0.0;
						frame.Y += num;
					}
				}
				if (frame.Y < num * 4 || frame.Y > num * 5)
				{
					frame.Y = num * 4;
				}
			}
			else if (!wet)
			{
				int num32 = 12;
				frameCounter++;
				if (frameCounter >= (double)num32)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y < num * 4 || frame.Y > num * 5)
				{
					frame.Y = num * 4;
				}
			}
			else
			{
				frameCounter++;
				if (frameCounter >= 8.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y > num * 3)
				{
					frame.Y = 0;
				}
			}
			break;
		case 69:
			if (ai[0] < 190f)
			{
				frameCounter += 1.0;
				if (frameCounter >= 6.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
					if (frame.Y / num >= Main.npcFrameCount[type] - 1)
					{
						frame.Y = 0;
					}
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num * (Main.npcFrameCount[type] - 1);
			}
			break;
		case 155:
		{
			int num266 = frame.Y / num;
			if (IsABestiaryIconDummy && num266 < 3)
			{
				num266 = 3;
			}
			if (velocity.Y < 0f)
			{
				num266 = 10;
			}
			else if (velocity.Y > 0f)
			{
				num266 = 11;
			}
			else if (velocity.X == 0f)
			{
				num266 = 0;
				frameCounter = 0.0;
			}
			else if (((direction > 0 && velocity.X < 0f) || (direction < 0 && velocity.X > 0f)) && Math.Abs(velocity.X) < 4f)
			{
				spriteDirection = direction;
				if (num266 > 2)
				{
					num266 = 0;
					frameCounter = 0.0;
				}
				if (num266 < 2)
				{
					frameCounter++;
					if (frameCounter > 5.0)
					{
						frameCounter = 0.0;
						num266++;
					}
				}
				else
				{
					frameCounter = 0.0;
				}
			}
			else
			{
				spriteDirection = ((!(velocity.X < 0f)) ? 1 : (-1));
				frameCounter += Math.Abs(velocity.X) * 0.4f;
				if (num266 == 10 || num266 == 11)
				{
					num266 = 12;
					frameCounter = 0.0;
				}
				else if (frameCounter > 8.0)
				{
					frameCounter -= 8.0;
					num266++;
					if (num266 > 9)
					{
						num266 = 3;
					}
				}
			}
			frame.Y = num266 * num;
			break;
		}
		case 329:
			if (velocity.Y > 0f)
			{
				frame.Y = num * 3;
				frameCounter = 0.0;
				break;
			}
			if (velocity.Y < 0f)
			{
				frame.Y = num * 2;
				frameCounter = 0.0;
				break;
			}
			spriteDirection = direction;
			frameCounter += Math.Abs(velocity.X) * 0.4f;
			if (frameCounter > 4.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
				if (frame.Y > num * 9)
				{
					frame.Y = num * 2;
				}
			}
			break;
		case 86:
			if (velocity.Y == 0f || wet)
			{
				if (velocity.X < -2f)
				{
					spriteDirection = -1;
				}
				else if (velocity.X > 2f)
				{
					spriteDirection = 1;
				}
				else
				{
					spriteDirection = direction;
				}
			}
			if (velocity.Y != 0f)
			{
				frame.Y = num * 15;
				frameCounter = 0.0;
				break;
			}
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
				break;
			}
			if (Math.Abs(velocity.X) < 3f)
			{
				frameCounter += Math.Abs(velocity.X);
				if (frameCounter >= 6.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
					if (frame.Y / num >= 9)
					{
						frame.Y = num;
					}
					if (frame.Y / num <= 0)
					{
						frame.Y = num;
					}
				}
				break;
			}
			frameCounter += Math.Abs(velocity.X);
			if (frameCounter >= 10.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num >= 15)
				{
					frame.Y = num * 9;
				}
				if (frame.Y / num <= 8)
				{
					frame.Y = num * 9;
				}
			}
			break;
		case 315:
			if (velocity.Y == 0f || wet)
			{
				if (velocity.X < -1f)
				{
					spriteDirection = -1;
				}
				else if (velocity.X > 1f)
				{
					spriteDirection = 1;
				}
				else
				{
					spriteDirection = direction;
				}
			}
			if (velocity.Y != 0f)
			{
				frame.Y = 0;
				frameCounter = 0.0;
				break;
			}
			frameCounter += Math.Abs(velocity.X);
			if (frameCounter >= 8.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num > 10)
				{
					frame.Y = num;
				}
			}
			break;
		case 127:
			if (IsMechQueenUp)
			{
				if (ai[1] == 0f)
				{
					frameCounter += 1.0;
					if (frameCounter >= 12.0)
					{
						frameCounter = 0.0;
						frame.Y += num;
						if (frame.Y / num >= 5)
						{
							frame.Y = num * 3;
						}
					}
				}
				else
				{
					frameCounter = 0.0;
					frame.Y = num * 5;
				}
			}
			else if (ai[1] == 0f)
			{
				frameCounter += 1.0;
				if (frameCounter >= 12.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
					if (frame.Y / num >= 2)
					{
						frame.Y = 0;
					}
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num * 2;
			}
			break;
		case 129:
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			frameCounter += 1.0;
			if (frameCounter >= 2.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 130:
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			frameCounter += 1.0;
			if (frameCounter >= 8.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 67:
		case 217:
		case 218:
		case 219:
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			frameCounter += 1.0;
			if (frameCounter >= 6.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 220:
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			frameCounter += 1.0;
			if (frameCounter >= 10.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 109:
			if (velocity.Y == 0f && ((velocity.X <= 0f && direction < 0) || (velocity.X >= 0f && direction > 0)))
			{
				spriteDirection = direction;
			}
			frameCounter += Math.Abs(velocity.X);
			if (frameCounter >= 7.0)
			{
				frameCounter -= 7.0;
				frame.Y += num;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 83:
		case 84:
		case 179:
			if (ai[0] == 2f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
				break;
			}
			frameCounter += 1.0;
			if (frameCounter >= 4.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 72:
			frameCounter += 1.0;
			if (frameCounter >= 3.0)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			break;
		case 65:
			spriteDirection = direction;
			frameCounter += 1.0;
			if (wet && type == 65)
			{
				if (frameCounter < 6.0)
				{
					frame.Y = 0;
				}
				else if (frameCounter < 12.0)
				{
					frame.Y = num;
				}
				else if (frameCounter < 18.0)
				{
					frame.Y = num * 2;
				}
				else if (frameCounter < 24.0)
				{
					frame.Y = num * 3;
				}
				else
				{
					frameCounter = 0.0;
				}
			}
			break;
		case 542:
		case 543:
		case 544:
		case 545:
			spriteDirection = direction;
			frameCounter += 1.0;
			if (frameCounter >= 16.0)
			{
				frameCounter = 0.0;
			}
			frame.Y = num * (int)(frameCounter / 4.0);
			break;
		case 692:
		{
			if (!IsABestiaryIconDummy)
			{
				spriteDirection = -direction;
			}
			int num33 = Main.npcFrameCount[type] / 2;
			int num34 = frame.Y / num;
			int num35 = num34 % num33;
			bool flag5 = ai[0] == 0f;
			int num36 = 7;
			if (flag5)
			{
				num36 = 5;
			}
			if (wet)
			{
				frameCounter++;
				if (frameCounter >= (double)num36)
				{
					num35++;
					if (num35 >= num33)
					{
						num35 = 0;
					}
					frameCounter = 0.0;
				}
			}
			else
			{
				int num37 = 1;
				if (velocity.Y > 0f)
				{
					num37 = 7;
				}
				else if (velocity.Y < 0f)
				{
					num37 = 3;
				}
				if (num35 != num37)
				{
					frameCounter++;
					if (frameCounter >= 4.0)
					{
						if (num35 < num37)
						{
							num35++;
						}
						else if (num35 > num37)
						{
							num35--;
						}
						if (num35 == num33)
						{
							num35 = num37;
						}
						frameCounter = 0.0;
					}
				}
			}
			if (flag5)
			{
				num35 += num33;
			}
			if (num35 != num34)
			{
				frame.Y = num35 * num;
			}
			break;
		}
		case 224:
		case 587:
			if (velocity.X > 0f)
			{
				spriteDirection = 1;
				rotation = velocity.Y * 0.2f;
			}
			if (velocity.X < 0f)
			{
				spriteDirection = -1;
				rotation = (0f - velocity.Y) * 0.2f;
			}
			frameCounter += 1.0;
			if (frameCounter >= 6.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * 4)
			{
				frame.Y = 0;
			}
			break;
		case 150:
		case 151:
		case 152:
		case 158:
		case 226:
			if (type == 151)
			{
				int num12 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
				Main.dust[num12].noGravity = true;
			}
			if (type == 150 && Main.rand.Next(10) == 0)
			{
				int num13 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 67, velocity.X * 0.5f, velocity.Y * 0.5f, 90, default(Color), 1.5f);
				Main.dust[num13].noGravity = true;
				Dust dust = Main.dust[num13];
				dust.velocity *= 0.2f;
				Main.dust[num13].noLight = true;
			}
			if (velocity.X > 0f)
			{
				spriteDirection = 1;
			}
			if (velocity.X < 0f)
			{
				spriteDirection = -1;
			}
			rotation = velocity.X * 0.1f;
			frameCounter += 1.0;
			if (frameCounter >= 6.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * 4)
			{
				frame.Y = 0;
			}
			break;
		case 48:
		case 49:
		case 51:
		case 60:
		case 82:
		case 93:
		case 137:
		case 182:
		case 210:
		case 211:
		case 253:
		case 316:
		case 634:
		case 662:
		case 664:
		{
			if (type == 60)
			{
				int num302 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
				Main.dust[num302].noGravity = true;
			}
			if (type == 634 && Main.rand.Next(10) == 0)
			{
				int num303 = Dust.NewDust(position, width, height, 165, velocity.X, velocity.Y, 50);
				Dust dust = Main.dust[num303];
				dust.velocity *= 0.1f;
				Main.dust[num303].noGravity = true;
			}
			if (velocity.X > 0f)
			{
				spriteDirection = 1;
			}
			if (velocity.X < 0f)
			{
				spriteDirection = -1;
			}
			rotation = velocity.X * 0.1f;
			if (type == 210 || type == 211)
			{
				frameCounter += 1.0;
				rotation = velocity.X * 0.2f;
			}
			frameCounter += 1.0;
			int num304 = 6;
			int num305 = Main.npcFrameCount[type];
			if (type == 49 || type == 51 || type == 60 || type == 634)
			{
				num305--;
			}
			if (type == 48)
			{
				num304 = 5;
			}
			if (frameCounter >= (double)num304)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * num305)
			{
				frame.Y = 0;
			}
			break;
		}
		case 330:
			if (velocity.X > 0f)
			{
				spriteDirection = 1;
			}
			if (velocity.X < 0f)
			{
				spriteDirection = -1;
			}
			rotation = velocity.X * 0.15f;
			frameCounter += 1.0;
			if (frameCounter >= 8.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * Main.npcFrameCount[type])
			{
				frame.Y = 0;
			}
			break;
		case 42:
		case 231:
		case 232:
		case 233:
		case 234:
		case 235:
			frameCounter += 1.0;
			if (frameCounter < 2.0)
			{
				frame.Y = 0;
			}
			else if (frameCounter < 4.0)
			{
				frame.Y = num;
			}
			else if (frameCounter < 6.0)
			{
				frame.Y = num * 2;
			}
			else if (frameCounter < 8.0)
			{
				frame.Y = num;
			}
			else
			{
				frameCounter = 0.0;
			}
			break;
		case 205:
			frameCounter += 0.5;
			if (frameCounter < 2.0)
			{
				frame.Y = 0;
			}
			else if (frameCounter < 4.0)
			{
				frame.Y = num;
			}
			else if (frameCounter < 6.0)
			{
				frame.Y = num * 2;
			}
			else if (frameCounter < 8.0)
			{
				frame.Y = num;
			}
			else
			{
				frameCounter = 0.0;
			}
			break;
		case 176:
			frameCounter += 1.0;
			if (frameCounter > 4.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y > num)
			{
				frame.Y = 0;
			}
			break;
		case 43:
		case 56:
		case 175:
			frameCounter += 1.0;
			if (frameCounter < 6.0)
			{
				frame.Y = 0;
			}
			else if (frameCounter < 12.0)
			{
				frame.Y = num;
			}
			else if (frameCounter < 18.0)
			{
				frame.Y = num * 2;
			}
			else if (frameCounter < 24.0)
			{
				frame.Y = num;
			}
			if (frameCounter == 23.0)
			{
				frameCounter = 0.0;
			}
			break;
		case 115:
			frameCounter += 1.0;
			if (frameCounter < 3.0)
			{
				frame.Y = 0;
			}
			else if (frameCounter < 6.0)
			{
				frame.Y = num;
			}
			else if (frameCounter < 12.0)
			{
				frame.Y = num * 2;
			}
			else if (frameCounter < 15.0)
			{
				frame.Y = num;
			}
			if (frameCounter == 15.0)
			{
				frameCounter = 0.0;
			}
			break;
		case 101:
			frameCounter += 1.0;
			if (frameCounter > 6.0)
			{
				frame.Y += num * 2;
				frameCounter = 0.0;
			}
			if (frame.Y > num * 2)
			{
				frame.Y = 0;
			}
			break;
		case 199:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
			}
			if (frame.Y < num * 3)
			{
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
			}
			else
			{
				if (velocity.Y != 0f)
				{
					break;
				}
				frameCounter += Math.Abs(velocity.X);
				if (frameCounter > 12.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
					if (frame.Y > num * 7)
					{
						frame.Y = num * 3;
					}
				}
			}
			break;
		case 467:
			if (ai[0] == 1f || IsABestiaryIconDummy)
			{
				frameCounter += 1.0;
				if (frameCounter > 4.0)
				{
					frameCounter = 0.0;
					if (frame.Y < num * 6)
					{
						frame.Y += num;
						frameCounter = 0.0;
					}
					else if (IsABestiaryIconDummy)
					{
						frame.Y = 0;
					}
				}
				break;
			}
			frameCounter += 1.0;
			if (frameCounter > 4.0)
			{
				frameCounter = 0.0;
				if (frame.Y > num * 3)
				{
					frame.Y = num * 3;
				}
				if (frame.Y > 0)
				{
					frame.Y -= num;
					frameCounter = 0.0;
				}
			}
			break;
		case 480:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (ai[2] < 0f)
				{
					frameCounter += 1.0;
					if (frameCounter > 3.0)
					{
						frame.Y += num;
						frameCounter = 0.0;
					}
					if (frame.Y >= Main.npcFrameCount[type] * num)
					{
						frame.Y = num * 21;
					}
					else if (frame.Y < num * 21)
					{
						frame.Y = num * 21;
					}
				}
				else if (velocity.X == 0f)
				{
					frameCounter += 1.0;
					if (frameCounter > 4.0)
					{
						frame.Y += num;
						frameCounter = 0.0;
					}
					if (frame.Y / num > 7)
					{
						frame.Y = 0;
					}
				}
				else
				{
					frameCounter += 1f + Math.Abs(velocity.X);
					if (frameCounter > 6.0)
					{
						frame.Y += num;
						frameCounter = 0.0;
					}
					if (frame.Y / num >= Main.npcFrameCount[type] - 4)
					{
						frame.Y = num * 10;
					}
					else if (frame.Y / num < 10)
					{
						frame.Y = num * 10;
					}
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num * 8;
			}
			break;
		case 483:
			if (ai[0] == -1f)
			{
				frameCounter += 1.0;
				if (frameCounter > 4.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y > num * 21)
				{
					frame.Y = num * 21;
				}
				else if (frame.Y < num * 13)
				{
					frame.Y = num * 13;
				}
				rotation += velocity.X * 0.2f;
			}
			else
			{
				frameCounter += 1.0;
				if (frameCounter > 4.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y > num * 11)
				{
					frame.Y = 0;
				}
				rotation = velocity.X * 0.1f;
			}
			break;
		case 482:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (ai[2] < 0f)
				{
					frameCounter += 1.0;
					if (frameCounter > 3.0)
					{
						frame.Y += num;
						frameCounter = 0.0;
					}
					if (frame.Y >= Main.npcFrameCount[type] * num)
					{
						frame.Y = num * 11;
					}
					else if (frame.Y < num * 11)
					{
						frame.Y = num * 11;
					}
				}
				else if (velocity.X == 0f)
				{
					frameCounter += 1.0;
					frame.Y = 0;
				}
				else
				{
					frameCounter += 0.2f + Math.Abs(velocity.X);
					if (frameCounter > 8.0)
					{
						frame.Y += num;
						frameCounter = 0.0;
					}
					if (frame.Y / num >= Main.npcFrameCount[type] - 10)
					{
						frame.Y = num * 2;
					}
					else if (frame.Y / num < 2)
					{
						frame.Y = num * 2;
					}
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num;
			}
			break;
		case 631:
		{
			int num27 = 100;
			int num28 = 32;
			int num29 = 8;
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
				if (ai[2] != 0f && ai[2] < (float)num27)
				{
					float num30 = ai[2] - (float)(num27 - num28);
					float amount = num30 / (float)num28;
					Player player = Main.player[target];
					bool flag3 = player != null && ((player.Center.X < base.Center.X) ? (direction == -1) : (direction == 1));
					bool flag4 = player?.Hitbox.Intersects(base.Hitbox) ?? false;
					if (player != null && flag3 && !flag4 && Collision.CanHit(player, this))
					{
						frame.Y = (int)MathHelper.Lerp(15f, Main.npcFrameCount[type], amount) * num;
					}
					else if (flag3 && flag4)
					{
						frame.Y = (int)MathHelper.Lerp(10f, 15f, amount) * num;
					}
					else
					{
						frame.Y = 0;
					}
				}
				else if (velocity.X == 0f)
				{
					frameCounter = 0.0;
					frame.Y = 0;
				}
				else
				{
					frameCounter += 0.2f + Math.Abs(velocity.X);
					if (frameCounter > 8.0)
					{
						frame.Y += num;
						frameCounter = 0.0;
					}
					if (frame.Y >= num29 * num)
					{
						frame.Y = num;
					}
					else if (frame.Y / num < 1)
					{
						frame.Y = num;
					}
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = 0;
			}
			break;
		}
		case 461:
			if (wet)
			{
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				if (velocity.X > 0f)
				{
					direction = 1;
				}
				if (spriteDirection != direction)
				{
					rotation *= -1f;
					spriteDirection = direction;
				}
				float num301 = (float)Math.Atan2(velocity.Y * (float)direction, velocity.X * (float)direction);
				if ((double)Math.Abs(rotation - num301) >= 3.14)
				{
					if (num301 < rotation)
					{
						rotation -= 6.28f;
					}
					else
					{
						rotation += 6.28f;
					}
				}
				rotation = (rotation * 4f + num301) / 5f;
				frameCounter += Math.Abs(velocity.Length());
				frameCounter += 1.0;
				if (frameCounter > 8.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num > 20)
				{
					frame.Y = num * 16;
				}
				else if (frame.Y / num < 16)
				{
					frame.Y = num * 19;
				}
				break;
			}
			if ((double)rotation > 3.14)
			{
				rotation -= 6.28f;
			}
			if ((double)rotation > -0.01 && (double)rotation < 0.01)
			{
				rotation = 0f;
			}
			else
			{
				rotation *= 0.9f;
			}
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
				frameCounter += Math.Abs(velocity.X) * 2f;
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num > 15)
				{
					frame.Y = num * 2;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num;
			}
			break;
		case 586:
		{
			if (wet)
			{
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				if (velocity.X > 0f)
				{
					direction = 1;
				}
				spriteDirection = direction;
				frameCounter += Math.Abs(velocity.Length());
				frameCounter += 1.0;
				if (frameCounter > 60.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num > 1)
				{
					frame.Y = 0;
				}
				else if (frame.Y / num < 0)
				{
					frame.Y = 0;
				}
				break;
			}
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			if (velocity.X == 0f)
			{
				frame.Y = num;
				frameCounter = 0.0;
				break;
			}
			int num207 = 6;
			num207 = 8;
			frameCounter += Math.Abs(velocity.X) * 1f;
			frameCounter += 0.5;
			if (frameCounter > (double)num207)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y / num >= Main.npcFrameCount[type])
			{
				frame.Y = 0;
			}
			break;
		}
		case 466:
			if (!IsABestiaryIconDummy && ai[2] <= 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (ai[2] == 0f)
				{
					frame.Y = 0;
				}
				else if (ai[2] < -8f)
				{
					frame.Y = num;
				}
				else
				{
					frame.Y = num * 2;
				}
			}
			else if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (velocity.X == 0f)
				{
					frame.Y = num * 2;
					frameCounter = 0.0;
					break;
				}
				if (frame.Y / num < 4)
				{
					frame.Y = num * 4;
				}
				frameCounter += Math.Abs(velocity.X) * 2f;
				frameCounter += 1.0;
				if (frameCounter > 7.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num > 17)
				{
					frame.Y = num * 4;
				}
				if (frame.Y / num < 4)
				{
					frame.Y = num * 4;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num * 3;
			}
			break;
		case 471:
		{
			bool flag11 = false;
			if (ai[3] < 0f)
			{
				flag11 = true;
			}
			if (flag11)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				frameCounter += Math.Abs(velocity.Length()) * 0.5f;
				frameCounter += 1.0;
				if (frameCounter < 6.0)
				{
					frame.Y = num * 17;
					break;
				}
				if (frameCounter < 12.0)
				{
					frame.Y = num * 18;
					break;
				}
				if (frameCounter < 18.0)
				{
					frame.Y = num * 19;
					break;
				}
				if (frameCounter < 23.0)
				{
					frame.Y = num * 18;
					break;
				}
				frame.Y = num * 18;
				frameCounter = 0.0;
			}
			else if (ai[3] == 1f)
			{
				frame.Y = num * 16;
				frameCounter = 0.0;
			}
			else if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				frameCounter += Math.Abs(velocity.X) * 2f;
				frameCounter += 1.0;
				if (frameCounter > 7.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num > 15)
				{
					frame.Y = num * 2;
				}
				if (frame.Y / num < 2)
				{
					frame.Y = num * 2;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num;
			}
			break;
		}
		case 166:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (velocity.X == 0f)
				{
					frameCounter += 2.0;
					if (frameCounter > 7.0)
					{
						frame.Y += num;
						frameCounter = 0.0;
					}
					if (frame.Y / num > 5)
					{
						frame.Y = 0;
					}
					break;
				}
				frameCounter += Math.Abs(velocity.X);
				frameCounter += 1.0;
				if (frameCounter > 9.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num > 12)
				{
					frame.Y = num * 7;
				}
				if (frame.Y / num < 7)
				{
					frame.Y = num * 7;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num * 6;
			}
			break;
		case 469:
			if (ai[2] == 1f)
			{
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				if (velocity.X > 0f)
				{
					direction = 1;
				}
				spriteDirection = direction;
				frameCounter += Math.Abs(velocity.Length());
				if (frameCounter > 11.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num > 5)
				{
					frame.Y = num * 2;
				}
				if (frame.Y / num < 2)
				{
					frame.Y = num * 2;
				}
				break;
			}
			rotation = 0f;
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (velocity.X == 0f)
				{
					frameCounter = 0.0;
					frame.Y = 0;
					break;
				}
				frameCounter += Math.Abs(velocity.X);
				frameCounter += 1.0;
				if (frameCounter > 9.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num > 11)
				{
					frame.Y = num * 6;
				}
				if (frame.Y / num < 6)
				{
					frame.Y = num * 6;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num;
			}
			break;
		case 351:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
				frameCounter += Math.Abs(velocity.X) * 1f;
				frameCounter += 1.0;
				if (frameCounter > 8.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 2;
				}
			}
			else
			{
				if (velocity.Y < 0f)
				{
					frame.Y = num;
				}
				else
				{
					frame.Y = num;
				}
				frameCounter = 0.0;
			}
			break;
		case 343:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (velocity.X == 0f)
				{
					frame.Y = num * 2;
					frameCounter = 0.0;
					break;
				}
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
				frameCounter += Math.Abs(velocity.X) * 1f;
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 2;
				}
			}
			else
			{
				if (velocity.Y < 0f)
				{
					frame.Y = 0;
				}
				else
				{
					frame.Y = num;
				}
				frameCounter = 0.0;
			}
			break;
		case 269:
		case 270:
		case 271:
		case 272:
		case 273:
		case 274:
		case 275:
		case 276:
		case 277:
		case 278:
		case 279:
		case 280:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (velocity.X == 0f)
				{
					if (type == 140)
					{
						frame.Y = num;
						frameCounter = 0.0;
					}
					else
					{
						frame.Y = 0;
						frameCounter = 0.0;
					}
					break;
				}
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
				frameCounter += Math.Abs(velocity.X) * 2f;
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 2;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = 0;
			}
			break;
		case 230:
			if (velocity.Y == 0f)
			{
				rotation = 0f;
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				frameCounter += Math.Abs(velocity.X) * 2f;
				frameCounter += 1.0;
				if (frameCounter > 10.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = 0;
				if (velocity.Y > 4f)
				{
					rotation -= velocity.Y * 0.01f;
				}
			}
			break;
		case 593:
			if (velocity.Y == 0f)
			{
				rotation = 0f;
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				frameCounter += Math.Abs(velocity.X) * 2f;
				frameCounter += 1.0;
				if (frameCounter > 10.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = 0;
				if (velocity.Y > 4f)
				{
					rotation -= velocity.Y * 0.01f;
				}
			}
			break;
		case 290:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (ai[2] > 0f)
				{
					if (ai[1] < 10f)
					{
						frame.Y = num * 11;
					}
					else if (ai[1] < 20f)
					{
						frame.Y = num * 10;
					}
					else
					{
						frame.Y = num * 9;
					}
					break;
				}
				if (velocity.X == 0f)
				{
					frameCounter = 0.0;
					frame.Y = 0;
					break;
				}
				if (frame.Y < num * 2)
				{
					frame.Y = num * 2;
				}
				frameCounter += Math.Abs(velocity.X) * 1f;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y > num * 8)
				{
					frame.Y = num * 2;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num;
			}
			break;
		case 110:
		case 214:
		case 215:
		case 216:
		case 293:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (ai[2] > 0f)
				{
					spriteDirection = direction;
					frame.Y = num * (int)ai[2];
					frameCounter = 0.0;
					break;
				}
				if (frame.Y < num * 6)
				{
					frame.Y = num * 6;
				}
				frameCounter += Math.Abs(velocity.X) * 3f;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 6;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = 0;
			}
			break;
		case 206:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (ai[2] > 0f)
				{
					spriteDirection = direction;
					frame.Y = num * (int)ai[2];
					frameCounter = 0.0;
					break;
				}
				if (frame.Y < num * 6)
				{
					frame.Y = num * 6;
				}
				frameCounter += Math.Abs(velocity.X) * 3f;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 6;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = 0;
			}
			break;
		case 350:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (ai[2] > 0f)
				{
					spriteDirection = direction;
					frame.Y = num * ((int)ai[2] - 1);
					frameCounter = 0.0;
					break;
				}
				if (frame.Y < num * 7)
				{
					frame.Y = num * 7;
				}
				frameCounter += Math.Abs(velocity.X) * 3.3f;
				if (frameCounter > 4.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 7;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num * 5;
			}
			break;
		case 111:
		case 291:
		case 292:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (ai[2] > 0f)
				{
					spriteDirection = direction;
					frame.Y = num * ((int)ai[2] - 1);
					frameCounter = 0.0;
					break;
				}
				if (frame.Y < num * 7)
				{
					frame.Y = num * 7;
				}
				frameCounter += Math.Abs(velocity.X) * 3.3f;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 7;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num * 6;
			}
			break;
		case 257:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
			}
			if (velocity.Y != 0f || (direction == -1 && velocity.X > 0f) || (direction == 1 && velocity.X < 0f))
			{
				frameCounter = 0.0;
				frame.Y = num * 4;
				break;
			}
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
				break;
			}
			frameCounter += Math.Abs(velocity.X);
			if (frameCounter < 8.0)
			{
				frame.Y = 0;
			}
			else if (frameCounter < 16.0)
			{
				frame.Y = num;
			}
			else if (frameCounter < 24.0)
			{
				frame.Y = num * 2;
			}
			else if (frameCounter < 32.0)
			{
				frame.Y = num * 3;
			}
			else
			{
				frameCounter = 0.0;
			}
			break;
		case 258:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
			}
			if (velocity.Y != 0f || (direction == -1 && velocity.X > 0f) || (direction == 1 && velocity.X < 0f))
			{
				frameCounter += 1.0;
				if (frameCounter > 1.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y > num * 5 || frame.Y < num * 3)
				{
					frame.Y = num * 3;
				}
			}
			else if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
			}
			else
			{
				frameCounter += Math.Abs(velocity.X);
				if (frameCounter < 8.0)
				{
					frame.Y = 0;
				}
				else if (frameCounter < 16.0)
				{
					frame.Y = num;
				}
				else if (frameCounter < 24.0)
				{
					frame.Y = num * 2;
				}
				else
				{
					frameCounter = 0.0;
				}
			}
			break;
		case 348:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
			}
			if (velocity.Y != 0f)
			{
				frameCounter = 0.0;
				frame.Y = num * 8;
				break;
			}
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
				break;
			}
			frameCounter += Math.Abs(velocity.X);
			frameCounter += 1.0;
			if (frameCounter > 6.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y > num * 7)
			{
				frame.Y = num;
			}
			break;
		case 349:
			frameCounter += 1.0;
			if (frameCounter > 3.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y > num * 7)
			{
				frame.Y = 0;
			}
			break;
		case 3:
		case 52:
		case 53:
		case 132:
		case 161:
		case 186:
		case 187:
		case 188:
		case 189:
		case 200:
		case 223:
		case 251:
		case 254:
		case 255:
		case 319:
		case 320:
		case 321:
		case 331:
		case 332:
		case 342:
		case 536:
		case 590:
		case 691:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
			}
			if (velocity.Y != 0f || (direction == -1 && velocity.X > 0f) || (direction == 1 && velocity.X < 0f))
			{
				frameCounter = 0.0;
				frame.Y = num * 2;
				break;
			}
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
				break;
			}
			frameCounter += Math.Abs(velocity.X);
			if (frameCounter < 8.0)
			{
				frame.Y = 0;
			}
			else if (frameCounter < 16.0)
			{
				frame.Y = num;
			}
			else if (frameCounter < 24.0)
			{
				frame.Y = num * 2;
			}
			else if (frameCounter < 32.0)
			{
				frame.Y = num;
			}
			else
			{
				frameCounter = 0.0;
			}
			break;
		case 148:
		case 149:
		case 168:
		case 470:
		{
			int num44 = 0;
			if (localAI[0] == 2f)
			{
				num44 = 3;
			}
			if (localAI[0] == 3f)
			{
				num44 = 6;
			}
			if (localAI[0] == 4f)
			{
				num44 = 9;
			}
			num44 *= num;
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (velocity.X == 0f)
				{
					frame.Y = num44;
					frameCounter = 0.0;
					break;
				}
				frameCounter += Math.Abs(velocity.X) * 1f;
				if (frameCounter < 6.0)
				{
					frame.Y = num44;
					break;
				}
				if (frameCounter < 12.0)
				{
					frame.Y = num + num44;
					break;
				}
				if (frameCounter < 15.0)
				{
					frame.Y = num * 2 + num44;
					break;
				}
				frameCounter = 0.0;
				frame.Y = num * 2 + num44;
			}
			else if (velocity.Y < 0f)
			{
				frameCounter = 0.0;
				frame.Y = num * 2 + num44;
			}
			else if (velocity.Y > 0f)
			{
				frameCounter = 0.0;
				frame.Y = num * 2 + num44;
			}
			break;
		}
		case 299:
		case 538:
		case 539:
		case 639:
		case 640:
		case 641:
		case 642:
		case 643:
		case 644:
		case 645:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (aiStyle == 3 && ((direction < 0 && velocity.X > 0f) || (direction > 0 && velocity.X < 0f)))
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				frameCounter += Math.Abs(velocity.X) * 0.5f;
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type] - 1)
				{
					frame.Y = num;
				}
			}
			else if (velocity.Y < 0f)
			{
				frameCounter = 0.0;
				frame.Y = num * 2;
			}
			else if (velocity.Y > 0f)
			{
				frameCounter = 0.0;
				frame.Y = num * 4;
			}
			break;
		case 300:
		case 447:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (velocity.X == 0f)
				{
					frameCounter += 1.0;
					if (frameCounter > 8.0)
					{
						frame.Y += num;
						frameCounter = 0.0;
					}
					if (frame.Y / num > 1)
					{
						frame.Y = 0;
					}
					break;
				}
				frameCounter += Math.Abs(velocity.X) * 0.5f;
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 2;
				}
			}
			else
			{
				frameCounter += Math.Abs(velocity.X) * 0.5f;
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 2;
				}
			}
			break;
		case 610:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (velocity.X == 0f)
				{
					frameCounter += 1.0;
					if (frameCounter > 8.0)
					{
						frame.Y += num;
						frameCounter = 0.0;
					}
					if (frame.Y / num > 1)
					{
						frame.Y = 0;
					}
					break;
				}
				frameCounter += Math.Abs(velocity.X) * 0.5f;
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 2;
				}
			}
			else
			{
				frameCounter += Math.Abs(velocity.X) * 0.5f;
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = num * 2;
				}
			}
			break;
		case 361:
		case 445:
		case 687:
			spriteDirection = direction;
			if (wet)
			{
				frameCounter = 0.0;
				if (velocity.X > 0.25f || velocity.X < -0.25f)
				{
					frame.Y = num * 10;
				}
				else if (velocity.X > 0.15f || velocity.X < -0.15f)
				{
					frame.Y = num * 11;
				}
				else
				{
					frame.Y = num * 12;
				}
			}
			else if (velocity.Y == 0f)
			{
				if (velocity.X == 0f)
				{
					frameCounter += 1.0;
					if (frameCounter > 6.0)
					{
						frameCounter = 0.0;
						frame.Y += num;
					}
					if (frame.Y > num * 5)
					{
						frame.Y = 0;
					}
					break;
				}
				frameCounter += 1.0;
				int num206 = 6;
				if (frameCounter < (double)num206)
				{
					frame.Y = 0;
					break;
				}
				if (frameCounter < (double)(num206 * 2))
				{
					frame.Y = num * 6;
					break;
				}
				if (frameCounter < (double)(num206 * 3))
				{
					frame.Y = num * 8;
					break;
				}
				frame.Y = num * 9;
				if (frameCounter >= (double)(num206 * 4 - 1))
				{
					frameCounter = 0.0;
				}
			}
			else if (velocity.Y > 0f)
			{
				frame.Y = num * 9;
			}
			else
			{
				frame.Y = num * 8;
			}
			break;
		case 616:
		case 617:
		{
			int num190 = 8;
			int num191 = 5;
			if (velocity.X == 0f)
			{
				num191 = 10;
			}
			spriteDirection = direction;
			if (wet)
			{
				frameCounter++;
				if (frameCounter > (double)num191)
				{
					frameCounter = 0.0;
					frame.Y += num;
					if (frame.Y > num * 13)
					{
						frame.Y = num * 8;
					}
				}
				break;
			}
			frameCounter++;
			if (frameCounter > (double)num190)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y > num * 7)
				{
					frame.Y = 0;
				}
			}
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
			}
			if (velocity.Y != 0f)
			{
				frameCounter = 0.0;
				frame.Y = num * 8;
			}
			break;
		}
		case 625:
		{
			int num151 = 7;
			int num152 = 4;
			if (velocity.X == 0f)
			{
				num152 = 8;
			}
			spriteDirection = direction;
			if (wet)
			{
				if (frame.Y < num * 6)
				{
					frame.Y = num * 6;
				}
				frameCounter++;
				if (frameCounter > (double)num152)
				{
					frameCounter = 0.0;
					frame.Y += num;
					if (frame.Y > num * 11)
					{
						frame.Y = num * 6;
					}
				}
				break;
			}
			if (frame.Y > num * 5)
			{
				frame.Y = 0;
			}
			frameCounter++;
			if (frameCounter > (double)num151)
			{
				frameCounter = 0.0;
				frame.Y += num;
				if (frame.Y > num * 5)
				{
					frame.Y = 0;
				}
			}
			if (velocity.X == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
			}
			break;
		}
		case 626:
		case 627:
			if (velocity.X != 0f)
			{
				spriteDirection = ((!(velocity.X < 0f)) ? 1 : (-1));
			}
			if (IsABestiaryIconDummy)
			{
				frameCounter++;
				if (frameCounter > 5.0)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y > num * 5)
				{
					frame.Y = 0;
				}
			}
			else if (!wet)
			{
				frame.Y = 0;
			}
			else if (velocity.Length() > 0.15f)
			{
				frame.Y = num * 3;
			}
			else if (velocity.Length() > 0.05f)
			{
				frame.Y = num * 2;
			}
			else if (velocity.Length() > 0.025f)
			{
				frame.Y = num;
			}
			else
			{
				frame.Y = 0;
			}
			break;
		case 366:
		case 367:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
			}
			if (velocity.X == 0f)
			{
				frame.Y = 0;
				frameCounter = 0.0;
				break;
			}
			frameCounter += Math.Abs(velocity.X) * 1f;
			frameCounter += 1.0;
			if (frameCounter > 6.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y / num >= Main.npcFrameCount[type])
			{
				frame.Y = 0;
			}
			break;
		case 46:
		case 47:
		case 303:
		case 337:
		case 443:
		case 464:
		case 540:
		case 614:
		case 646:
		case 647:
		case 648:
		case 649:
		case 650:
		case 651:
		case 652:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
				if (velocity.X == 0f)
				{
					frame.Y = 0;
					frameCounter = 0.0;
					break;
				}
				frameCounter += Math.Abs(velocity.X) * 1f;
				frameCounter += 1.0;
				if (frameCounter > 6.0)
				{
					frame.Y += num;
					frameCounter = 0.0;
				}
				if (frame.Y / num >= Main.npcFrameCount[type])
				{
					frame.Y = 0;
				}
			}
			else if (velocity.Y < 0f)
			{
				frameCounter = 0.0;
				frame.Y = num * 4;
			}
			else if (velocity.Y > 0f)
			{
				frameCounter = 0.0;
				frame.Y = num * 6;
			}
			break;
		case 4:
		case 125:
		case 126:
			frameCounter += 1.0;
			if (frameCounter < 7.0)
			{
				frame.Y = 0;
			}
			else if (frameCounter < 14.0)
			{
				frame.Y = num;
			}
			else if (frameCounter < 21.0)
			{
				frame.Y = num * 2;
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = 0;
			}
			if (ai[0] > 1f)
			{
				frame.Y += num * 3;
			}
			break;
		case 5:
			frameCounter += 1.0;
			if (frameCounter >= 8.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * Main.npcFrameCount[type])
			{
				frame.Y = 0;
			}
			break;
		case 94:
			frameCounter += 1.0;
			if (frameCounter < 6.0)
			{
				frame.Y = 0;
				break;
			}
			if (frameCounter < 12.0)
			{
				frame.Y = num;
				break;
			}
			if (frameCounter < 18.0)
			{
				frame.Y = num * 2;
				break;
			}
			frame.Y = num;
			if (frameCounter >= 23.0)
			{
				frameCounter = 0.0;
			}
			break;
		case 6:
		case 173:
			frameCounter += 1.0;
			if (frameCounter >= 8.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * Main.npcFrameCount[type])
			{
				frame.Y = 0;
			}
			break;
		case 24:
		{
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			int num117 = 5;
			if (ai[1] > 0f)
			{
				if (frame.Y < num * 4 || frame.Y > num * 9)
				{
					frameCounter = 0.0;
					frame.Y = num * 4;
				}
				frameCounter++;
				if (frameCounter > (double)num117)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y > num * 9)
				{
					frame.Y = num * 9;
				}
			}
			else
			{
				frameCounter++;
				if (frameCounter > (double)num117)
				{
					frameCounter = 0.0;
					frame.Y += num;
				}
				if (frame.Y > num * 3)
				{
					frame.Y = 0;
				}
			}
			break;
		}
		case 29:
		case 32:
		case 45:
		case 172:
		case 281:
		case 282:
		case 283:
		case 284:
		case 285:
		case 286:
		case 693:
			if (velocity.Y == 0f)
			{
				if (direction == 1)
				{
					spriteDirection = 1;
				}
				if (direction == -1)
				{
					spriteDirection = -1;
				}
			}
			frame.Y = 0;
			if (velocity.Y != 0f)
			{
				frame.Y += num * 2;
			}
			else if (ai[1] > 0f)
			{
				frame.Y += num;
			}
			if (type == 32 && localAI[3] == 1f)
			{
				frame.Y += num * 3;
			}
			break;
		case 34:
			frameCounter += 1.0;
			if (frameCounter >= 4.0)
			{
				frame.Y += num;
				frameCounter = 0.0;
			}
			if (frame.Y >= num * Main.npcFrameCount[type])
			{
				frame.Y = 0;
			}
			break;
		case 624:
			if (velocity.Y == 0f)
			{
				spriteDirection = direction;
			}
			if (velocity.X == 0f && velocity.Y == 0f)
			{
				frameCounter = 0.0;
				frame.Y = 0;
				break;
			}
			if (velocity.Y < 0f)
			{
				frameCounter = 0.0;
				frame.Y = 9 * num;
				break;
			}
			if (velocity.Y > 0f)
			{
				frameCounter = 0.0;
				frame.Y = 10 * num;
				break;
			}
			frameCounter += Math.Abs(velocity.X);
			if (frameCounter > 8.0)
			{
				int num46 = frame.Y / num;
				frameCounter -= 8.0;
				num46++;
				if (num46 > 8)
				{
					num46 = 1;
				}
				frame.Y = num46 * num;
			}
			break;
		case 628:
			spriteDirection = ((!(Main.WindForVisuals > 0f)) ? 1 : (-1));
			if (IsABestiaryIconDummy)
			{
				int num17 = frame.Y / num;
				int num18 = 5;
				spriteDirection = 1;
				frameCounter++;
				if (frameCounter > (double)num18)
				{
					frameCounter -= num18;
					num17++;
					if (num17 > 5)
					{
						num17 = 0;
					}
					frame.Y = num17 * num;
				}
			}
			else if (ai[0] == 0f)
			{
				int num19 = frame.Y / num;
				int num20 = 8;
				if (num19 == 6)
				{
					frameCounter += 1f + 0.5f * Math.Abs(Main.WindForVisuals);
					if (frameCounter > (double)num20)
					{
						frameCounter -= num20;
						num19 = 0;
						frame.Y = num19 * num;
					}
					break;
				}
				if (num19 > 5)
				{
					num19 = 6;
					frameCounter = 0.0;
					frame.Y = num19 * num;
					break;
				}
				frameCounter += 1f + 0.5f * Math.Abs(Main.WindForVisuals);
				if (frameCounter > (double)num20)
				{
					frameCounter -= num20;
					num19++;
					if (num19 > 5)
					{
						num19 = 0;
					}
					frame.Y = num19 * num;
				}
			}
			else if (localAI[0] == 0f)
			{
				frameCounter++;
				if (!(frameCounter > 4.0))
				{
					break;
				}
				frameCounter = 0.0;
				int num21 = frame.Y / num;
				if (num21 == 6)
				{
					num21 = 7;
				}
				else if (num21 < 7)
				{
					num21 = 6;
				}
				else
				{
					num21++;
					if (num21 > 10)
					{
						num21 = 7;
					}
				}
				frame.Y = num21 * num;
			}
			else if (localAI[0] == 1f)
			{
				int num22 = frame.Y / num;
				num22 = (int)MathHelper.Lerp(7f, 20f, (float)frameCounter / 80f);
				if (num22 > 19)
				{
					num22 = 19;
				}
				if (num22 > 16)
				{
					num22 -= 9;
				}
				frameCounter++;
				if (frameCounter > 80.0)
				{
					frameCounter = 0.0;
				}
				frame.Y = num22 * num;
			}
			break;
		case 694:
		{
			int num3 = frame.Y / num;
			if (ai[3] == 3f)
			{
				num3 = 0;
				frameCounter = 0.0;
			}
			else if (ai[3] == 4f)
			{
				frameCounter++;
				if (frameCounter >= 5.0)
				{
					frameCounter = 0.0;
					num3++;
					if (num3 > 16)
					{
						num3 = 16;
					}
				}
			}
			else if (ai[3] == 2f)
			{
				float num4 = ai[2];
				if (num4 == 0f)
				{
					num3 = 17;
				}
				if (num3 < 17 || num3 > 23)
				{
					num3 = 17;
				}
				frameCounter++;
				if (frameCounter >= 5.0)
				{
					frameCounter = 0.0;
					num3++;
					if (num4 < 40f && num3 > 19)
					{
						num3 = 19;
					}
					if (num3 > 23)
					{
						num3 = 23;
					}
				}
			}
			else if (ai[3] == 1f)
			{
				if (num3 < 24 || num3 > 29)
				{
					num3 = 24;
				}
				frameCounter++;
				if (frameCounter >= 5.0)
				{
					frameCounter = 0.0;
					num3++;
					if (num3 > 29)
					{
						num3 = 29;
					}
				}
			}
			else
			{
				if (num3 < 17 || num3 > 23)
				{
					num3 = 17;
				}
				frameCounter++;
				if (frameCounter >= 6.0)
				{
					frameCounter = 0.0;
					num3 = num3 switch
					{
						17 => 22, 
						22 => 23, 
						_ => 17, 
					};
				}
				if (num3 >= Main.npcFrameCount[type])
				{
					num3 = 0;
				}
			}
			frame.Y = num3 * num;
			break;
		}
		}
		if (aiStyle == 39 && type != 417)
		{
			if (ai[0] == 0f)
			{
				rotation = 0f;
				if (velocity.Y == 0f)
				{
					spriteDirection = direction;
				}
				else if (velocity.Y < 0f)
				{
					frameCounter = 0.0;
				}
				frameCounter += Math.Abs(velocity.X) * 1.1f;
				if (frameCounter < 6.0)
				{
					frame.Y = 0;
				}
				else if (frameCounter < 12.0)
				{
					frame.Y = num;
				}
				else if (frameCounter < 18.0)
				{
					frame.Y = num * 2;
				}
				else if (frameCounter < 24.0)
				{
					frame.Y = num * 3;
				}
				else if (frameCounter < 32.0)
				{
					frame.Y = num * 4;
				}
				else
				{
					frameCounter = 0.0;
				}
			}
			else if (ai[0] == 1f)
			{
				frameCounter = 0.0;
				if (ai[1] < 10f)
				{
					frame.Y = num * 5;
				}
				else if (ai[1] < 20f)
				{
					frame.Y = num * 6;
				}
				else
				{
					frame.Y = num * 7;
				}
			}
			else if (ai[0] == 5f)
			{
				frameCounter = 0.0;
				if (ai[1] < 10f)
				{
					frame.Y = num * 7;
				}
				else if (ai[1] < 20f)
				{
					frame.Y = num * 6;
				}
				else
				{
					frame.Y = num * 5;
				}
			}
			else
			{
				frameCounter = 0.0;
				frame.Y = num * 7;
			}
		}
		position -= netOffset;
	}

	private static int FindFrame_FromSequence(int sequenceFrame, int[] frames)
	{
		int num = sequenceFrame;
		if (num >= frames.Length)
		{
			num = frames.Length - 1;
		}
		return frames[num];
	}

	private static int FindFrame_Deerclops_GetAttack1Frame(int sequenceFrame)
	{
		return FindFrame_FromSequence(sequenceFrame, _deerclopsAttack1Frames);
	}

	private static int FindFrame_Deerclops_GetAttack2Frame(int sequenceFrame)
	{
		return FindFrame_FromSequence(sequenceFrame, _deerclopsAttack2Frames);
	}

	private static int FindFrame_Deerclops_GetAttack3Frame(int sequenceFrame)
	{
		return FindFrame_FromSequence(sequenceFrame, _deerclopsAttack3Frames);
	}

	public void SimpleFlyMovement(Vector2 desiredVelocity, float moveSpeed)
	{
		if (velocity.X < desiredVelocity.X)
		{
			velocity.X += moveSpeed;
			if (velocity.X < 0f && desiredVelocity.X > 0f)
			{
				velocity.X += moveSpeed;
			}
		}
		else if (velocity.X > desiredVelocity.X)
		{
			velocity.X -= moveSpeed;
			if (velocity.X > 0f && desiredVelocity.X < 0f)
			{
				velocity.X -= moveSpeed;
			}
		}
		if (velocity.Y < desiredVelocity.Y)
		{
			velocity.Y += moveSpeed;
			if (velocity.Y < 0f && desiredVelocity.Y > 0f)
			{
				velocity.Y += moveSpeed;
			}
		}
		else if (velocity.Y > desiredVelocity.Y)
		{
			velocity.Y -= moveSpeed;
			if (velocity.Y > 0f && desiredVelocity.Y < 0f)
			{
				velocity.Y -= moveSpeed;
			}
		}
	}

	public void HealEffect(int healAmount, bool broadcast = true)
	{
		HealEffect(new Rectangle((int)position.X, (int)position.Y, width, height), healAmount, broadcast);
	}

	public static void HealEffect(Rectangle r, int healAmount, bool broadcast = true)
	{
		if (broadcast && Main.netMode == 2)
		{
			NetMessage.SendData(81, -1, -1, null, (int)CombatText.HealLife.PackedValue, r.Center.X, r.Center.Y, healAmount);
		}
		else
		{
			CombatText.NewText(r, CombatText.HealLife, healAmount);
		}
	}

	public int FindClosestPlayer()
	{
		float distanceToPlayer;
		return FindClosestPlayer(out distanceToPlayer);
	}

	public int FindClosestPlayer(out float distanceToPlayer)
	{
		Vector2 center = base.Center;
		float num = float.MaxValue;
		int num2 = -1;
		for (int i = 0; i < 255; i++)
		{
			Player player = Main.player[i];
			if (player.active && !player.dead && !player.ghost)
			{
				float num3 = Vector2.DistanceSquared(center, player.Center);
				if (num3 < num)
				{
					num = num3;
					num2 = i;
				}
			}
		}
		if (num2 < 0)
		{
			for (int j = 0; j < 255; j++)
			{
				Player player = Main.player[j];
				if (player.active)
				{
					float num4 = Vector2.DistanceSquared(center, player.Center);
					if (num4 < num)
					{
						num = num4;
						num2 = j;
					}
				}
			}
		}
		distanceToPlayer = (float)Math.Sqrt(num);
		return num2;
	}

	public void BigMimicSpawnSmoke()
	{
		if (Main.netMode == 2)
		{
			NetMessage.SendData(51, -1, -1, null, whoAmI, 4f);
			return;
		}
		for (int i = 0; i < 20; i++)
		{
			int num = Dust.NewDust(position, width, height, 54, 0f, 0f, 50, default(Color), 1.5f);
			Main.dust[num].velocity *= 2f;
			Main.dust[num].noGravity = true;
		}
		for (int j = 0; j < 3; j++)
		{
			for (int k = 0; k < 2; k++)
			{
				int num2 = Gore.NewGore(new Vector2(position.X + (float)(width * j) * 0.45f - 20f, position.Y + (float)(height * k) * 0.5f + 10f), new Vector2(0f, 0f), 99, 1.1f);
				Main.gore[num2].velocity *= 0.3f;
			}
		}
	}

	public static bool BigMimicSummonCheck(int x, int y, Player user)
	{
		if (Main.netMode == 1 || !Main.hardMode)
		{
			return false;
		}
		int num = Chest.FindChest(x, y);
		if (num < 0)
		{
			return false;
		}
		int num2 = 0;
		int num3 = 0;
		int num4 = 0;
		Chest chest = Main.chest[num];
		ushort num5 = Main.tile[chest.x, chest.y].type;
		int num6 = Main.tile[chest.x, chest.y].frameX / 36;
		for (int i = 0; i < chest.maxItems; i++)
		{
			if (TileID.Sets.BasicChest[num5] && (num5 != 21 || num6 < 5 || num6 > 6) && chest.item[i] != null && chest.item[i].type > 0)
			{
				if (chest.item[i].type == 3092)
				{
					num2 += chest.item[i].stack;
				}
				else if (chest.item[i].type == 3091)
				{
					num3 += chest.item[i].stack;
				}
				else
				{
					num4++;
				}
			}
		}
		if (num4 == 0 && num2 + num3 == 1)
		{
			if (num2 != 1)
			{
				_ = 1;
			}
			if (TileID.Sets.BasicChest[Main.tile[x, y].type])
			{
				if (Main.tile[x, y].frameX % 36 != 0)
				{
					x--;
				}
				if (Main.tile[x, y].frameY % 36 != 0)
				{
					y--;
				}
				int number = Chest.FindChest(x, y);
				Chest chest2 = Main.chest[num];
				int maxItems = chest2.maxItems;
				for (int j = 0; j < maxItems; j++)
				{
					chest2.item[j] = new Item();
				}
				Chest.DestroyChest(x, y);
				for (int k = x; k <= x + 1; k++)
				{
					for (int l = y; l <= y + 1; l++)
					{
						if (TileID.Sets.BasicChest[Main.tile[k, l].type])
						{
							Main.tile[k, l].ClearTile();
						}
					}
				}
				int number2 = 1;
				if (Main.tile[x, y].type == 467)
				{
					number2 = 5;
				}
				NetMessage.SendData(34, -1, -1, null, number2, x, y, 0f, number);
				NetMessage.SendTileSquare(-1, x, y, 3);
			}
			int num7 = 475;
			if (num3 == 1)
			{
				num7 = ((!WorldGen.crimson) ? 473 : 474);
			}
			int num8 = NewNPC(user.GetNPCSource_TileInteraction(x, y), x * 16 + 16, y * 16 + 32, num7);
			Main.npc[num8].whoAmI = num8;
			NetMessage.SendData(23, -1, -1, null, num8);
			Main.npc[num8].BigMimicSpawnSmoke();
		}
		return false;
	}

	public bool ShouldFaceTarget(ref NPCUtils.TargetSearchResults searchResults, NPCUtils.TargetType? overrideTargetType = null)
	{
		NPCUtils.TargetType nearestTargetType = searchResults.NearestTargetType;
		if (overrideTargetType.HasValue)
		{
			nearestTargetType = overrideTargetType.Value;
		}
		switch (nearestTargetType)
		{
		case NPCUtils.TargetType.NPC:
		case NPCUtils.TargetType.TankPet:
			return true;
		case NPCUtils.TargetType.Player:
		{
			bool flag = true;
			Player nearestTankOwner = searchResults.NearestTankOwner;
			if (nearestTankOwner.dead || (nearestTankOwner.npcTypeNoAggro[type] && direction != 0))
			{
				flag = false;
			}
			if (!flag)
			{
				break;
			}
			float num = (float)(nearestTankOwner.width + nearestTankOwner.height + width + height) / 4f + 800f;
			if (nearestTankOwner.itemAnimation == 0 && nearestTankOwner.aggro < 0 && searchResults.NearestTankDistance > num)
			{
				if (oldTarget >= 0)
				{
					return oldTarget >= 255;
				}
				return true;
			}
			return true;
		}
		}
		return false;
	}

	public void FaceTarget()
	{
		direction = ((!((float)targetRect.Center.X < base.Center.X)) ? 1 : (-1));
		directionY = ((!((float)targetRect.Center.Y < base.Center.Y)) ? 1 : (-1));
	}

	public void TargetClosestUpgraded(bool faceTarget = true, Vector2? checkPosition = null)
	{
		int num = -1;
		int num2 = -1;
		int num3 = -1;
		Vector2 center = base.Center;
		if (checkPosition.HasValue)
		{
			center = checkPosition.Value;
		}
		bool flag = direction == 0;
		float num4 = 9999999f;
		for (int i = 0; i < 255; i++)
		{
			Player player = Main.player[i];
			if (!player.active || player.dead || player.ghost)
			{
				continue;
			}
			float num5 = Vector2.Distance(center, player.Center);
			num5 -= (float)player.aggro;
			bool flag2 = player.npcTypeNoAggro[type];
			if (flag2 && !flag)
			{
				num5 += 1000f;
			}
			if (num5 < num4)
			{
				num = i;
				num2 = -1;
				num4 = num5;
			}
			if (player.tankPet >= 0 && !flag2)
			{
				num5 = Vector2.Distance(center, Main.projectile[player.tankPet].Center);
				num5 -= 200f;
				if (num5 < num4 && num5 < 200f && Collision.CanHit(base.Center, 0, 0, Main.projectile[player.tankPet].Center, 0, 0))
				{
					num2 = player.tankPet;
					num4 = num5;
				}
			}
		}
		for (int j = 0; j < Main.maxNPCs; j++)
		{
			NPC nPC = Main.npc[j];
			if (nPC.active && nPC.type == 548)
			{
				float num6 = Vector2.Distance(center, nPC.Center);
				if (num4 > num6)
				{
					num3 = j;
					num = -1;
					num2 = -1;
					num4 = num6;
				}
			}
		}
		if (num4 == 9999999f)
		{
			return;
		}
		if (num3 >= 0)
		{
			target = Main.npc[num3].WhoAmIToTargettingIndex;
			targetRect = Main.npc[num3].Hitbox;
			direction = ((!((float)targetRect.Center.X < base.Center.X)) ? 1 : (-1));
			directionY = ((!((float)targetRect.Center.Y < base.Center.Y)) ? 1 : (-1));
			return;
		}
		if (num2 >= 0)
		{
			target = Main.projectile[num2].owner;
			targetRect = Main.projectile[num2].Hitbox;
			direction = ((!((float)targetRect.Center.X < base.Center.X)) ? 1 : (-1));
			directionY = ((!((float)targetRect.Center.Y < base.Center.Y)) ? 1 : (-1));
			return;
		}
		if (num < 0 || num >= 255)
		{
			num = 0;
		}
		Player player2 = Main.player[num];
		targetRect = player2.Hitbox;
		target = num;
		if (player2.dead || (player2.npcTypeNoAggro[type] && !flag))
		{
			faceTarget = false;
		}
		if (faceTarget)
		{
			float num7 = (float)(player2.width + player2.height + width + height) / 4f + 800f;
			float num8 = num4 - (float)player2.aggro;
			if (player2.itemAnimation != 0 || player2.aggro >= 0 || !(num8 > num7) || oldTarget < 0 || oldTarget >= 255)
			{
				direction = ((!((float)targetRect.Center.X < base.Center.X)) ? 1 : (-1));
				directionY = ((!((float)targetRect.Center.Y < base.Center.Y)) ? 1 : (-1));
			}
		}
	}

	public void TargetClosest(bool faceTarget = true)
	{
		float distance = 0f;
		float realDist = 0f;
		bool t = false;
		int tankTarget = -1;
		for (int i = 0; i < 255; i++)
		{
			if (Main.player[i].active && !Main.player[i].dead && !Main.player[i].ghost)
			{
				TryTrackingTarget(ref distance, ref realDist, ref t, ref tankTarget, i);
			}
		}
		SetTargetTrackingValues(faceTarget, realDist, tankTarget);
	}

	public void TargetClosest_WOF(bool faceTarget = true)
	{
		float distance = 0f;
		float realDist = 0f;
		bool t = false;
		int tankTarget = -1;
		for (int i = 0; i < 255; i++)
		{
			if (Main.player[i].active && !Main.player[i].dead && !Main.player[i].ghost && Main.player[i].gross)
			{
				TryTrackingTarget(ref distance, ref realDist, ref t, ref tankTarget, i);
			}
		}
		SetTargetTrackingValues(faceTarget, realDist, tankTarget);
	}

	private void TryTrackingTarget(ref float distance, ref float realDist, ref bool t, ref int tankTarget, int j)
	{
		float num = Math.Abs(Main.player[j].position.X + (float)(Main.player[j].width / 2) - position.X + (float)(width / 2)) + Math.Abs(Main.player[j].position.Y + (float)(Main.player[j].height / 2) - position.Y + (float)(height / 2));
		num -= (float)Main.player[j].aggro;
		if (Main.player[j].npcTypeNoAggro[type] && direction != 0)
		{
			num += 1000f;
		}
		if (!t || num < distance)
		{
			t = true;
			tankTarget = -1;
			realDist = Math.Abs(Main.player[j].position.X + (float)(Main.player[j].width / 2) - position.X + (float)(width / 2)) + Math.Abs(Main.player[j].position.Y + (float)(Main.player[j].height / 2) - position.Y + (float)(height / 2));
			distance = num;
			target = j;
		}
		if (Main.player[j].tankPet >= 0 && !Main.player[j].npcTypeNoAggro[type])
		{
			int tankPet = Main.player[j].tankPet;
			float num2 = Math.Abs(Main.projectile[tankPet].position.X + (float)(Main.projectile[tankPet].width / 2) - position.X + (float)(width / 2)) + Math.Abs(Main.projectile[tankPet].position.Y + (float)(Main.projectile[tankPet].height / 2) - position.Y + (float)(height / 2));
			num2 -= 200f;
			if (num2 < distance && num2 < 200f && Collision.CanHit(base.Center, 1, 1, Main.projectile[tankPet].Center, 1, 1))
			{
				tankTarget = tankPet;
			}
		}
	}

	private void SetTargetTrackingValues(bool faceTarget, float realDist, int tankTarget)
	{
		if (tankTarget >= 0)
		{
			targetRect = new Rectangle((int)Main.projectile[tankTarget].position.X, (int)Main.projectile[tankTarget].position.Y, Main.projectile[tankTarget].width, Main.projectile[tankTarget].height);
			direction = 1;
			if ((float)(targetRect.X + targetRect.Width / 2) < position.X + (float)(width / 2))
			{
				direction = -1;
			}
			directionY = 1;
			if ((float)(targetRect.Y + targetRect.Height / 2) < position.Y + (float)(height / 2))
			{
				directionY = -1;
			}
		}
		else
		{
			if (target < 0 || target >= 255)
			{
				target = 0;
			}
			targetRect = new Rectangle((int)Main.player[target].position.X, (int)Main.player[target].position.Y, Main.player[target].width, Main.player[target].height);
			if (Main.player[target].dead)
			{
				faceTarget = false;
			}
			if (Main.player[target].npcTypeNoAggro[type] && direction != 0)
			{
				faceTarget = false;
			}
			if (faceTarget)
			{
				_ = Main.player[target].aggro;
				_ = (Main.player[target].height + Main.player[target].width + height + width) / 4;
				bool flag = oldTarget >= 0 && oldTarget <= 254;
				bool num = Main.player[target].itemAnimation == 0 && Main.player[target].aggro < 0;
				bool flag2 = !boss;
				if (!(num && flag && flag2))
				{
					direction = 1;
					if ((float)(targetRect.X + targetRect.Width / 2) < position.X + (float)(width / 2))
					{
						direction = -1;
					}
					directionY = 1;
					if ((float)(targetRect.Y + targetRect.Height / 2) < position.Y + (float)(height / 2))
					{
						directionY = -1;
					}
				}
			}
		}
		if (confused)
		{
			direction *= -1;
		}
		if ((direction != oldDirection || directionY != oldDirectionY || target != oldTarget) && !collideX && !collideY)
		{
			netUpdate = true;
		}
	}

	public bool DoesntDespawnToInactivityAndCountsNPCSlots()
	{
		return type == 668;
	}

	public bool DoesntDespawnToInactivity()
	{
		switch (type)
		{
		case 8:
		case 9:
		case 11:
		case 12:
		case 14:
		case 15:
		case 36:
		case 40:
		case 41:
		case 88:
		case 89:
		case 90:
		case 91:
		case 92:
		case 96:
		case 97:
		case 99:
		case 100:
		case 113:
		case 114:
		case 115:
		case 118:
		case 119:
		case 128:
		case 129:
		case 130:
		case 131:
		case 134:
		case 135:
		case 136:
		case 246:
		case 247:
		case 248:
		case 249:
		case 263:
		case 267:
		case 328:
		case 379:
		case 380:
		case 392:
		case 393:
		case 394:
		case 396:
		case 397:
		case 398:
		case 400:
		case 422:
		case 437:
		case 438:
		case 439:
		case 440:
		case 488:
		case 492:
		case 493:
		case 507:
		case 517:
		case 548:
		case 549:
		case 551:
		case 564:
		case 565:
			return true;
		case 139:
			if (npcsFoundForCheckActive[134])
			{
				return true;
			}
			break;
		case 552:
		case 553:
		case 554:
		case 555:
		case 556:
		case 557:
		case 558:
		case 559:
		case 560:
		case 561:
		case 562:
		case 563:
		case 566:
		case 567:
		case 568:
		case 569:
		case 570:
		case 571:
		case 572:
		case 573:
		case 574:
		case 575:
		case 576:
		case 577:
		case 578:
			if (npcsFoundForCheckActive[548])
			{
				return true;
			}
			break;
		}
		return false;
	}

	public void CheckActive()
	{
		if (!active || (type == 690 && ai[0] == 0f) || DoesntDespawnToInactivity() || townNPC)
		{
			return;
		}
		bool flag = DoesntDespawnToInactivityAndCountsNPCSlots();
		bool flag2 = false;
		Rectangle rectangle = new Rectangle((int)(position.X + (float)(width / 2) - (float)activeRangeX), (int)(position.Y + (float)(height / 2) - (float)activeRangeY), activeRangeX * 2, activeRangeY * 2);
		Rectangle rectangle2 = new Rectangle((int)((double)(position.X + (float)(width / 2)) - (double)sWidth * 0.5 - (double)width), (int)((double)(position.Y + (float)(height / 2)) - (double)sHeight * 0.5 - (double)height), sWidth + width * 2, sHeight + height * 2);
		for (int i = 0; i < 255; i++)
		{
			if (!Main.player[i].active)
			{
				continue;
			}
			Rectangle hitbox = Main.player[i].Hitbox;
			if (rectangle.Intersects(hitbox))
			{
				flag2 = true;
				if (type != 25 && type != 30 && type != 33 && releaseOwner == 255 && lifeMax > 0)
				{
					if (Main.slimeRain && Main.slimeRainNPC[type])
					{
						Main.player[i].nearbyActiveNPCs += npcSlots * Main.slimeRainNPCSlots;
					}
					else
					{
						Main.player[i].nearbyActiveNPCs += npcSlots;
					}
				}
			}
			if (flag)
			{
				continue;
			}
			if (rectangle2.Intersects(hitbox))
			{
				timeLeft = activeTime;
				despawnEncouraged = false;
				if (i == Main.myPlayer && (type == 604 || type == 605))
				{
					LadyBugLuck(i, type == 605);
				}
			}
			if (boss)
			{
				flag2 = true;
			}
			switch (type)
			{
			case 7:
			case 10:
			case 13:
			case 35:
			case 36:
			case 39:
			case 87:
			case 127:
			case 128:
			case 129:
			case 130:
			case 131:
			case 392:
			case 393:
			case 394:
			case 491:
			case 492:
				flag2 = true;
				break;
			case 399:
				if (ai[0] == 2f || ai[0] == 1f)
				{
					timeLeft = activeTime;
				}
				flag2 = true;
				break;
			case 583:
			case 584:
			case 585:
				if (!Main.dayTime && ai[2] == 0f)
				{
					flag2 = true;
					timeLeft = activeTime;
				}
				break;
			}
		}
		if (flag)
		{
			return;
		}
		timeLeft--;
		if (timeLeft <= 0)
		{
			flag2 = false;
		}
		if (!flag2 && Main.netMode != 1)
		{
			noSpawnCycle = true;
			active = false;
			if (Main.netMode == 2)
			{
				life = 0;
				NetMessage.SendData(23, -1, -1, null, whoAmI);
			}
			if (extraValue > 0)
			{
				RevengeManager.CacheEnemy(this);
			}
			CheckActive_WormSegments();
		}
	}

	private void CheckActive_WormSegments()
	{
		if (aiStyle != 6)
		{
			return;
		}
		int num = (int)ai[0];
		while (num != whoAmI && num > 0 && num < Main.maxNPCs)
		{
			NPC nPC = Main.npc[num];
			if (nPC.active && nPC.aiStyle == 6)
			{
				nPC.active = false;
				if (Main.netMode == 2)
				{
					NetMessage.SendData(23, -1, -1, null, num);
				}
				num = (int)nPC.ai[0];
				continue;
			}
			break;
		}
	}

	public void checkDead()
	{
		if (!active || (realLife >= 0 && realLife != whoAmI) || life > 0)
		{
			return;
		}
		if (type == 35 && ai[3] == 1f)
		{
			if (Main.netMode == 0)
			{
				Main.NewText(Language.GetTextValue("SkeletronText.Taunt1"), byte.MaxValue, 0, 0);
			}
			else if (Main.netMode == 2)
			{
				ChatHelper.BroadcastChatMessage(NetworkText.FromKey("SkeletronText.Taunt1"), new Color(255, 0, 0));
			}
		}
		if (type == 604 || type == 605)
		{
			LadyBugKilled(base.Center, type == 605);
		}
		if (type == 397 || type == 396)
		{
			if (ai[0] != -2f)
			{
				ai[0] = -2f;
				life = lifeMax;
				netUpdate = true;
				dontTakeDamage = true;
				if (Main.netMode != 1)
				{
					int num = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)base.Center.Y, 400);
					Main.npc[num].ai[3] = ai[3];
					Main.npc[num].netUpdate = true;
				}
			}
			return;
		}
		if (type == 398 && ai[0] != 2f)
		{
			ai[0] = 2f;
			life = lifeMax;
			netUpdate = true;
			dontTakeDamage = true;
			return;
		}
		if ((type == 517 || type == 422 || type == 507 || type == 493) && ai[2] != 1f)
		{
			ai[2] = 1f;
			ai[1] = 0f;
			life = lifeMax;
			dontTakeDamage = true;
			netUpdate = true;
			return;
		}
		if (type == 548 && ai[1] != 1f)
		{
			ai[1] = 1f;
			ai[0] = 0f;
			life = lifeMax;
			dontTakeDamageFromHostiles = true;
			netUpdate = true;
			return;
		}
		if (Main.netMode != 1 && Main.getGoodWorld && (type == 42 || type == 176 || (type >= 231 && type <= 235)))
		{
			StingerExplosion();
		}
		if (Main.netMode != 1 && Main.getGoodWorld)
		{
			if (type == 13)
			{
				int num2 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X, (int)(position.Y + (float)height), -12);
				if (Main.netMode == 2 && num2 < Main.maxNPCs)
				{
					NetMessage.SendData(23, -1, -1, null, num2);
				}
			}
			if (type == 36)
			{
				int num3 = 3;
				for (int i = 0; i < num3; i++)
				{
					int num4 = 1000;
					for (int j = 0; j < num4; j++)
					{
						int num5 = (int)(base.Center.X / 16f) + Main.rand.Next(-50, 51);
						int k;
						for (k = (int)(base.Center.Y / 16f) + Main.rand.Next(-50, 51); k < Main.maxTilesY - 200 && !WorldGen.SolidTile(num5, k); k++)
						{
						}
						k--;
						if (!WorldGen.SolidTile(num5, k))
						{
							int num6 = NewNPC(GetSpawnSourceForNPCFromNPCAI(), num5 * 16 + 8, k * 16, 32);
							if (Main.netMode == 2 && num6 < Main.maxNPCs)
							{
								NetMessage.SendData(23, -1, -1, null, num6);
							}
							break;
						}
					}
				}
			}
		}
		noSpawnCycle = true;
		if (townNPC && type != 37 && type != 453)
		{
			if (Main.netMode != 2)
			{
				NPCLuck();
			}
			bool flag = true;
			NetworkText fullNetName = GetFullNetName();
			int num7 = 19;
			if (type == 369 || type == 663 || NPCID.Sets.IsTownPet[type])
			{
				num7 = 36;
				flag = false;
			}
			NetworkText networkText = NetworkText.FromKey(Lang.misc[num7].Key, fullNetName);
			if (flag)
			{
				for (int l = 0; l < 255; l++)
				{
					Player player = Main.player[l];
					if (player != null && player.active && player.difficulty != 2)
					{
						flag = false;
						break;
					}
				}
			}
			if (flag)
			{
				DropTombstoneTownNPC(networkText);
			}
			if (Main.netMode == 0)
			{
				Main.NewText(networkText.ToString(), byte.MaxValue, 25, 25);
			}
			else if (Main.netMode == 2)
			{
				ChatHelper.BroadcastChatMessage(networkText, new Color(255, 25, 25));
			}
		}
		if (Main.netMode != 1 && !Main.IsItDay() && type == 54 && !AnyNPCs(35))
		{
			for (int m = 0; m < 255; m++)
			{
				if (Main.player[m].active && !Main.player[m].dead && Main.player[m].killClothier)
				{
					SpawnSkeletron(m);
					break;
				}
			}
		}
		if (townNPC && Main.netMode != 1 && homeless && WorldGen.prioritizedTownNPCType == type)
		{
			WorldGen.prioritizedTownNPCType = 0;
		}
		LegacySoundStyle legacySoundStyle = DeathSound;
		if (type == 229 && IsShimmerVariant)
		{
			legacySoundStyle = SoundID.NPCDeath6;
		}
		if (legacySoundStyle != null)
		{
			SoundEngine.PlaySound(legacySoundStyle, position);
		}
		if (type == 13 || type == 14 || type == 15)
		{
			DropEoWLoot();
		}
		else if (type == 134)
		{
			Vector2 vector = position;
			Vector2 center = Main.player[target].Center;
			float num8 = 100000000f;
			Vector2 vector2 = position;
			for (int n = 0; n < Main.maxNPCs; n++)
			{
				if (Main.npc[n].active && (Main.npc[n].type == 134 || Main.npc[n].type == 135 || Main.npc[n].type == 136))
				{
					float num9 = Math.Abs(Main.npc[n].Center.X - center.X) + Math.Abs(Main.npc[n].Center.Y - center.Y);
					if (num9 < num8)
					{
						num8 = num9;
						vector2 = Main.npc[n].position;
					}
				}
			}
			position = vector2;
			NPCLoot();
			position = vector;
		}
		else
		{
			NPCLoot();
		}
		active = false;
		if (Main.getGoodWorld && Main.netMode != 1 && type == 631)
		{
			Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center, Vector2.Zero, 99, 70, 10f, Main.myPlayer);
		}
		DD2Event.CheckProgress(type);
		CheckProgressFrostMoon();
		CheckProgressPumpkinMoon();
		int nPCInvasionGroup = GetNPCInvasionGroup(type);
		if (nPCInvasionGroup <= 0 || nPCInvasionGroup != Main.invasionType)
		{
			return;
		}
		int num10 = 1;
		switch (type)
		{
		case 216:
			num10 = 5;
			break;
		case 395:
			num10 = 10;
			break;
		case 491:
			num10 = 10;
			break;
		case 471:
			num10 = 10;
			break;
		case 472:
			num10 = 0;
			break;
		case 387:
			num10 = 0;
			break;
		}
		if (num10 > 0)
		{
			Main.invasionSize -= num10;
			if (Main.invasionSize < 0)
			{
				Main.invasionSize = 0;
			}
			if (Main.netMode != 1)
			{
				Main.ReportInvasionProgress(Main.invasionSizeStart - Main.invasionSize, Main.invasionSizeStart, nPCInvasionGroup + 3, 0);
			}
			if (Main.netMode == 2)
			{
				NetMessage.SendData(78, -1, -1, null, Main.invasionProgress, Main.invasionProgressMax, Main.invasionProgressIcon);
			}
		}
	}

	public void DropTombstoneTownNPC(NetworkText deathText)
	{
		if (Main.netMode != 1)
		{
			float num = 0.1f;
			if (Main.rand.Next(2) == 0)
			{
				num = -0.1f;
			}
			float num2;
			for (num2 = (float)Main.rand.Next(-35, 36) * 0.1f; num2 < 2f && num2 > -2f; num2 += (float)Main.rand.Next(-30, 31) * 0.1f)
			{
			}
			int num3 = Main.rand.Next(6);
			if (type != 17 && type != 441)
			{
				num3 = ((num3 != 0) ? (num3 + 200) : 43);
			}
			else
			{
				num3 = Main.rand.Next(5);
				num3 += 527;
			}
			int num4 = Projectile.NewProjectile(GetSpawnSource_ForProjectile(), position.X + (float)(width / 2), position.Y + (float)(height / 2), (float)Main.rand.Next(10, 30) * num + num2, (float)Main.rand.Next(-40, -20) * 0.1f, num3, 0, 0f, Main.myPlayer);
			Main.projectile[num4].miscText = deathText.ToString();
		}
	}

	public static int GetNPCInvasionGroup(int npcID)
	{
		int result = 0;
		switch (npcID)
		{
		case 26:
		case 27:
		case 28:
		case 29:
		case 111:
		case 471:
		case 472:
			result = 1;
			break;
		case 143:
		case 144:
		case 145:
			result = 2;
			break;
		case 212:
		case 213:
		case 214:
		case 215:
		case 216:
		case 252:
		case 491:
		case 492:
		case 662:
			result = 3;
			break;
		case 381:
		case 382:
		case 383:
		case 385:
		case 386:
		case 387:
		case 388:
		case 389:
		case 390:
		case 391:
		case 394:
		case 395:
		case 520:
			result = 4;
			break;
		case 338:
		case 339:
		case 340:
		case 341:
		case 342:
		case 343:
		case 344:
		case 345:
		case 346:
		case 347:
		case 348:
		case 349:
		case 350:
		case 351:
		case 352:
			result = -1;
			break;
		case 305:
		case 306:
		case 307:
		case 308:
		case 309:
		case 310:
		case 311:
		case 312:
		case 313:
		case 314:
		case 315:
		case 325:
		case 326:
		case 327:
		case 329:
		case 330:
			result = -2;
			break;
		case 547:
		case 548:
		case 549:
		case 551:
		case 552:
		case 553:
		case 554:
		case 555:
		case 556:
		case 557:
		case 558:
		case 559:
		case 560:
		case 561:
		case 562:
		case 563:
		case 564:
		case 565:
		case 566:
		case 567:
		case 568:
		case 569:
		case 570:
		case 571:
		case 572:
		case 573:
		case 574:
		case 575:
		case 576:
		case 577:
		case 578:
			result = -3;
			break;
		}
		return result;
	}

	private void DropEoWLoot(bool fromCheckDead = true)
	{
		bool flag = true;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (i != whoAmI && Main.npc[i].active && (Main.npc[i].type == 13 || Main.npc[i].type == 14 || Main.npc[i].type == 15))
			{
				flag = false;
				break;
			}
		}
		if (flag)
		{
			boss = true;
		}
		NPCLoot();
	}

	private float GetMoonEventPointScalar()
	{
		if (Main.masterMode)
		{
			return 2.5f;
		}
		if (Main.expertMode)
		{
			return 2f;
		}
		return 1f;
	}

	private void CheckProgressFrostMoon()
	{
		if (!Main.snowMoon)
		{
			return;
		}
		int num = 0;
		NetworkText networkText = NetworkText.Empty;
		num = MoonEventRequiredPointsPerWaveLookup[waveNumber];
		switch (waveNumber)
		{
		case 1:
			networkText = Lang.GetInvasionWaveText(2, 338, 350);
			break;
		case 2:
			networkText = Lang.GetInvasionWaveText(3, 338, 350, 342, 348);
			break;
		case 3:
			networkText = Lang.GetInvasionWaveText(4, 344, 338, 350, 342);
			break;
		case 4:
			networkText = Lang.GetInvasionWaveText(5, 344, 338, 350, 348);
			break;
		case 5:
			networkText = Lang.GetInvasionWaveText(6, 344, 350, 348, 347);
			break;
		case 6:
			networkText = Lang.GetInvasionWaveText(7, 346, 342, 350, 338);
			break;
		case 7:
			networkText = Lang.GetInvasionWaveText(8, 346, 347, 350, 348, 351);
			break;
		case 8:
			networkText = Lang.GetInvasionWaveText(9, 346, 344, 348, 347, 342);
			break;
		case 9:
			networkText = Lang.GetInvasionWaveText(10, 346, 344, 351, 338, 347);
			break;
		case 10:
			networkText = Lang.GetInvasionWaveText(11, 345, 352, 338, 342);
			break;
		case 11:
			networkText = Lang.GetInvasionWaveText(12, 345, 344, 342, 343, 338);
			break;
		case 12:
			networkText = Lang.GetInvasionWaveText(13, 345, 346, 342, 352, 343, 347);
			break;
		case 13:
			networkText = Lang.GetInvasionWaveText(14, 345, 346, 344, 343, 351);
			break;
		case 14:
			networkText = Lang.GetInvasionWaveText(15, 345, 346, 344, 343, 347);
			break;
		case 15:
			networkText = Lang.GetInvasionWaveText(16, 345, 346, 344, 343, 352);
			break;
		case 16:
			networkText = Lang.GetInvasionWaveText(17, 345, 346, 344, 343, 351, 347);
			break;
		case 17:
			networkText = Lang.GetInvasionWaveText(18, 345, 346, 344, 343, 348, 351);
			break;
		case 18:
			networkText = Lang.GetInvasionWaveText(19, 345, 346, 344, 343);
			break;
		case 19:
			networkText = Lang.GetInvasionWaveText(-1, 345, 346, 344);
			break;
		}
		float num2 = 0f;
		switch (type)
		{
		case 338:
		case 339:
		case 340:
			num2 = 1f;
			break;
		case 341:
			num2 = 20f;
			break;
		case 342:
			num2 = 2f;
			break;
		case 343:
			num2 = 18f;
			break;
		case 344:
			num2 = 50f;
			break;
		case 345:
			num2 = 150f;
			break;
		case 346:
			num2 = 100f;
			break;
		case 347:
			num2 = 8f;
			break;
		case 348:
		case 349:
			num2 = 4f;
			break;
		case 350:
			num2 = 3f;
			break;
		case 351:
			num2 = 10f;
			break;
		case 352:
			num2 = 5f;
			break;
		}
		num2 *= GetMoonEventPointScalar();
		float num3 = waveKills;
		waveKills += num2;
		totalInvasionPoints += num2;
		if (waveKills >= (float)num && num != 0)
		{
			waveKills = 0f;
			waveNumber++;
			num = MoonEventRequiredPointsPerWaveLookup[waveNumber];
			if (networkText != NetworkText.Empty)
			{
				if (Main.netMode == 0)
				{
					Main.NewText(networkText.ToString(), 175, 75);
				}
				else if (Main.netMode == 2)
				{
					ChatHelper.BroadcastChatMessage(networkText, new Color(175, 75, 255));
				}
				if (waveNumber == 15)
				{
					AchievementsHelper.NotifyProgressionEvent(14);
				}
			}
		}
		if (waveKills != num3 && num2 != 0f)
		{
			if (Main.netMode != 1)
			{
				Main.ReportInvasionProgress((int)waveKills, num, 1, waveNumber);
			}
			if (Main.netMode == 2)
			{
				NetMessage.SendData(78, -1, -1, null, Main.invasionProgress, Main.invasionProgressMax, 1f, waveNumber);
			}
		}
	}

	private void CheckProgressPumpkinMoon()
	{
		if (!Main.pumpkinMoon)
		{
			return;
		}
		int num = 0;
		NetworkText networkText = NetworkText.Empty;
		num = MoonEventRequiredPointsPerWaveLookup[waveNumber];
		switch (waveNumber)
		{
		case 1:
			networkText = Lang.GetInvasionWaveText(2, 326, 305);
			break;
		case 2:
			networkText = Lang.GetInvasionWaveText(3, 329, 326);
			break;
		case 3:
			networkText = Lang.GetInvasionWaveText(4, 330, 326, 305);
			break;
		case 4:
			networkText = Lang.GetInvasionWaveText(5, 315, 329);
			break;
		case 5:
			networkText = Lang.GetInvasionWaveText(6, 325, 326, 305);
			break;
		case 6:
			networkText = Lang.GetInvasionWaveText(7, 325, 330, 329);
			break;
		case 7:
			networkText = Lang.GetInvasionWaveText(8, 315, 330, 329);
			break;
		case 8:
			networkText = Lang.GetInvasionWaveText(9, 325, 330, 329, 326, 305);
			break;
		case 9:
			networkText = Lang.GetInvasionWaveText(10, 327, 329, 326);
			break;
		case 10:
			networkText = Lang.GetInvasionWaveText(11, 325, 330, 326);
			break;
		case 11:
			networkText = Lang.GetInvasionWaveText(12, 327, 330);
			break;
		case 12:
			networkText = Lang.GetInvasionWaveText(13, 325, 315, 330, 329, 326);
			break;
		case 13:
			networkText = Lang.GetInvasionWaveText(14, 327, 325, 315, 330, 329, 326, 305);
			break;
		case 14:
			networkText = Lang.GetInvasionWaveText(15, 327, 325, 330, 326, 305);
			break;
		case 15:
			networkText = Lang.GetInvasionWaveText(16, 327, 315, 330, 329, 326);
			break;
		case 16:
			networkText = Lang.GetInvasionWaveText(17, 327, 325, 315, 330, 329);
			break;
		case 17:
			networkText = Lang.GetInvasionWaveText(18, 327, 325, 315, 330);
			break;
		case 18:
			networkText = Lang.GetInvasionWaveText(19, 327, 325, 315);
			break;
		case 19:
			networkText = Lang.GetInvasionWaveText(-1, 327, 325, 315);
			break;
		}
		float num2 = 0f;
		switch (type)
		{
		case 305:
		case 306:
		case 307:
		case 308:
		case 309:
		case 310:
		case 311:
		case 312:
		case 313:
		case 314:
			num2 = 1f;
			break;
		case 315:
			num2 = 50f;
			break;
		case 325:
			num2 = 75f;
			break;
		case 326:
			num2 = 2f;
			break;
		case 327:
			num2 = 150f;
			break;
		case 329:
			num2 = 5f;
			break;
		case 330:
			num2 = 10f;
			break;
		}
		num2 *= GetMoonEventPointScalar();
		float num3 = waveKills;
		waveKills += num2;
		totalInvasionPoints += num2;
		if (waveKills >= (float)num && num != 0)
		{
			waveKills = 0f;
			waveNumber++;
			num = MoonEventRequiredPointsPerWaveLookup[waveNumber];
			if (networkText != NetworkText.Empty)
			{
				if (Main.netMode == 0)
				{
					Main.NewText(networkText.ToString(), 175, 75);
				}
				else if (Main.netMode == 2)
				{
					ChatHelper.BroadcastChatMessage(networkText, new Color(175, 75, 255));
				}
				if (waveNumber == 15)
				{
					AchievementsHelper.NotifyProgressionEvent(15);
				}
			}
		}
		if (waveKills != num3 && num2 != 0f)
		{
			if (Main.netMode != 1)
			{
				Main.ReportInvasionProgress((int)waveKills, num, 2, waveNumber);
			}
			if (Main.netMode == 2)
			{
				NetMessage.SendData(78, -1, -1, null, Main.invasionProgress, Main.invasionProgressMax, 2f, waveNumber);
			}
		}
	}

	public bool AnyInteractions()
	{
		if (Main.netMode == 0)
		{
			if (playerInteraction[Main.myPlayer])
			{
				return true;
			}
		}
		else
		{
			for (int i = 0; i < 255; i++)
			{
				if (playerInteraction[i])
				{
					return true;
				}
			}
		}
		return false;
	}

	public bool IsDamageDodgeable()
	{
		switch (type)
		{
		case 35:
		case 68:
		case 127:
			return ai[1] != 2f;
		case 636:
			return !ShouldEmpressBeEnraged();
		default:
			return true;
		}
	}

	public static void SetEventFlagCleared(ref bool eventFlag, int gameEventId)
	{
		bool flag = eventFlag;
		eventFlag = true;
		if (eventFlag != flag)
		{
			OnGameEventClearedForTheFirstTime(gameEventId);
		}
	}

	public static void OnGameEventClearedForTheFirstTime(int gameEventId)
	{
		switch (gameEventId)
		{
		default:
			LanternNight.NextNightIsLanternNight = true;
			break;
		case 10:
			LanternNight.NextNightIsLanternNight = true;
			CreditsRollEvent.TryStartingCreditsRoll();
			break;
		case 16:
		case 17:
		case 18:
			LanternNight.NextNightIsLanternNight = true;
			if (Main.netMode != 1 && Main.hardMode && downedMechBoss1 && downedMechBoss2 && downedMechBoss3)
			{
				WorldGen.GeneratePlanteraBulbOnAllMechsDefeated();
			}
			break;
		case 4:
		case 21:
		case 22:
			break;
		}
		if (Main.dualDungeonsSeed)
		{
			switch (gameEventId)
			{
			case 11:
			case 13:
				WorldGen.ClearUnbreakableWallsWithPaintUpTo(DualDungeonUnbreakableWallTiers.EarlyGame);
				break;
			case 14:
				WorldGen.ClearUnbreakableWallsWithPaintUpTo(DualDungeonUnbreakableWallTiers.EvilBoss);
				break;
			case 8:
				WorldGen.ClearUnbreakableWallsWithPaintUpTo(DualDungeonUnbreakableWallTiers.JungleBoss);
				break;
			case 15:
			case 19:
				WorldGen.ClearUnbreakableWallsWithPaintUpTo(DualDungeonUnbreakableWallTiers.Dungeon);
				break;
			case 16:
			case 17:
			case 18:
			case 24:
				WorldGen.ClearUnbreakableWallsWithPaintUpTo(DualDungeonUnbreakableWallTiers.Hallow);
				break;
			case 9:
			case 10:
			case 12:
			case 20:
			case 21:
			case 22:
			case 23:
				break;
			}
		}
	}

	public void NPCLoot()
	{
		if (Main.netMode == 1 || type >= NPCID.Count || ((Main.getGoodWorld || !Main.isThereAWorldSurface) && !downedBoss3 && !Main.onlyShimmerOceanWorlds && (type == 31 || type == 294 || type == 296 || type == 295 || type == 32 || type == 34 || type == 71 || type == 693 || type == 694)) || (type == 32 && localAI[3] == 1f))
		{
			return;
		}
		Player closestPlayer = Main.player[Player.FindClosest(position, width, height)];
		if (0 == 0)
		{
			CountKillForAchievements();
			if (GetWereThereAnyInteractions())
			{
				if (IsNPCValidForBestiaryKillCredit())
				{
					Main.BestiaryTracker.Kills.RegisterKill(this);
				}
				CountKillForBannersAndDropThem();
			}
		}
		if ((SpawnedFromStatue && NPCID.Sets.NoEarlymodeLootWhenSpawnedFromStatue[type] && !Main.hardMode) || (SpawnedFromStatue && NPCID.Sets.StatueSpawnedDropRarity[type] != -1f && (Main.rand.NextFloat() >= NPCID.Sets.StatueSpawnedDropRarity[type] || !AnyInteractions())))
		{
			return;
		}
		bool flag = downedMechBoss1 && downedMechBoss2 && downedMechBoss3;
		DoDeathEvents_BeforeLoot(closestPlayer);
		NPCLoot_DropItems(closestPlayer);
		DoDeathEvents(closestPlayer);
		if (SpecialSeedFeatures.Mechdusa)
		{
			int num = type;
			if ((uint)(num - 125) <= 2u || num == 134)
			{
				bool flag2 = type == 127 || !AnyNPCs(127);
				bool flag3 = type == 134 || !AnyNPCs(134);
				bool num2 = type == 126 || !AnyNPCs(126);
				bool flag4 = type == 125 || !AnyNPCs(125);
				if (num2 && flag4 && flag3 && flag2)
				{
					AchievementsHelper.NotifyProgressionEvent(31);
				}
			}
		}
		if (!flag && downedMechBoss1 && downedMechBoss2 && downedMechBoss3 && Main.hardMode)
		{
			if (Main.netMode == 0)
			{
				Main.NewText(Lang.misc[32].Value, 50, byte.MaxValue, 130);
			}
			else if (Main.netMode == 2)
			{
				ChatHelper.BroadcastChatMessage(NetworkText.FromKey(Lang.misc[32].Key), new Color(50, 255, 130));
			}
		}
		if (IsNPCValidForBestiaryKillCredit())
		{
			if (type == 4 && WorldGen.Skyblock.noAltars)
			{
				NPCLoot_DropAltar();
			}
			if ((type == 14 || type == 13 || type == 15 || type == 266) && WorldGen.Skyblock.noDungeon)
			{
				NPCLoot_DropDungeonStuff();
			}
			if (type == 35 && WorldGen.Skyblock.noHellforge)
			{
				NPCLoot_DropHellforge();
			}
			if (type == 262 && WorldGen.Skyblock.noTemple)
			{
				NPCLoot_DropLihzahrdStuff();
			}
			if (type == 245 && WorldGen.Skyblock.lowTiles)
			{
				NPCLoot_DropTempleTraps();
			}
		}
		NPCLoot_DropMoney(closestPlayer);
		NPCLoot_DropHeals(closestPlayer);
	}

	public bool IsNPCValidForBestiaryKillCredit()
	{
		switch (type)
		{
		case 121:
			return false;
		case 13:
		case 14:
		case 15:
			return boss;
		default:
			return true;
		}
	}

	private void DoDeathEvents_BeforeLoot(Player closestPlayer)
	{
		int num = type;
		if ((uint)(num - 125) <= 1u && AnyNPCs((type == 125) ? 126 : 125))
		{
			value = 0f;
			boss = false;
		}
	}

	private void NPCLoot_DropItems(Player closestPlayer)
	{
		DropAttemptInfo info = new DropAttemptInfo
		{
			player = closestPlayer,
			npc = this,
			IsExpertMode = Main.expertMode,
			IsMasterMode = Main.masterMode,
			IsInSimulation = false,
			rng = Main.rand
		};
		Main.ItemDropSolver.TryDropping(info);
	}

	public static void ResetBadgerHatTime()
	{
		EoCKilledToday = false;
		WoFKilledToday = false;
	}

	private void DoDeathEvents_DropBossPotionsAndHearts()
	{
		int stack = Main.rand.Next(5, 16);
		int num = 28;
		if (type == 113)
		{
			num = 188;
		}
		else if (type == 35)
		{
			num = 188;
		}
		else if (type == 668)
		{
			num = 188;
		}
		else if (type == 222)
		{
			num = 1134;
		}
		else if (type == 657)
		{
			num = 499;
		}
		else if (type > 113 && type < 222)
		{
			num = 499;
		}
		else if (type == 636)
		{
			num = 499;
		}
		else if (type == 245 || type == 262)
		{
			num = 499;
		}
		else if (type == 370)
		{
			num = 499;
		}
		else if (type == 395)
		{
			num = 499;
		}
		else if (type == 439)
		{
			num = 499;
		}
		else if (type == 398)
		{
			num = 3544;
		}
		Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, num, stack);
		int num2 = Main.rand.Next(5) + 5;
		for (int i = 0; i < num2; i++)
		{
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 58);
		}
		if (type == 4)
		{
			EoCKilledToday = true;
		}
		else if (type == 113)
		{
			WoFKilledToday = true;
		}
		if (EoCKilledToday && WoFKilledToday)
		{
			ResetBadgerHatTime();
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 5004);
		}
	}

	private void DoDeathEvents_CelebrateBossDeath()
	{
		NPCDamageTracker.BossKilled(this);
		if (type == 125 || type == 126)
		{
			if (Main.netMode == 0)
			{
				Main.NewText(Language.GetTextValue("Announcement.HasBeenDefeated_Plural", Language.GetTextValue("Enemies.TheTwins")), 175, 75);
			}
			else if (Main.netMode == 2)
			{
				ChatHelper.BroadcastChatMessage(NetworkText.FromKey("Announcement.HasBeenDefeated_Plural", NetworkText.FromKey("Enemies.TheTwins")), new Color(175, 75, 255));
			}
		}
		else if (type == 398)
		{
			if (Main.netMode == 0)
			{
				Main.NewText(Language.GetTextValue("Announcement.HasBeenDefeated_Single", Language.GetTextValue("Enemies.MoonLord")), 175, 75);
			}
			else if (Main.netMode == 2)
			{
				ChatHelper.BroadcastChatMessage(NetworkText.FromKey("Announcement.HasBeenDefeated_Single", NetworkText.FromKey("Enemies.MoonLord")), new Color(175, 75, 255));
			}
		}
		else if (Main.netMode == 0)
		{
			Main.NewText(Language.GetTextValue("Announcement.HasBeenDefeated_Single", TypeName), 175, 75);
		}
		else if (Main.netMode == 2)
		{
			ChatHelper.BroadcastChatMessage(NetworkText.FromKey("Announcement.HasBeenDefeated_Single", GetTypeNetName()), new Color(175, 75, 255));
		}
	}

	private void CreateBrickBoxForWallOfFlesh()
	{
		int num = (int)(position.X + (float)(width / 2)) / 16;
		int num2 = (int)(position.Y + (float)(height / 2)) / 16;
		int num3 = width / 2 / 16 + 1;
		for (int i = num - num3; i <= num + num3; i++)
		{
			for (int j = num2 - num3; j <= num2 + num3; j++)
			{
				if ((i == num - num3 || i == num + num3 || j == num2 - num3 || j == num2 + num3) && !Main.tile[i, j].active())
				{
					Main.tile[i, j].type = (ushort)(WorldGen.crimson ? 347 : 140);
					Main.tile[i, j].active(active: true);
				}
				Main.tile[i, j].lava(lava: false);
				Main.tile[i, j].liquid = 0;
				if (Main.netMode == 2)
				{
					NetMessage.SendTileSquare(-1, i, j);
				}
				else
				{
					WorldGen.SquareTileFrame(i, j);
				}
			}
		}
	}

	private void DoDeathEvents_SummonDungeonSpirit(Player closestPlayer)
	{
		if (lifeMax > 100 && type != 288 && value > 0f && HasPlayerTarget && Main.hardMode && downedPlantBoss && Main.player[target].ZoneDungeon)
		{
			int range = 13;
			if (Main.expertMode)
			{
				range = 9;
			}
			if (closestPlayer.RollLuck(range) == 0 && Main.wallDungeon[Main.tile[(int)base.Center.X / 16, (int)base.Center.Y / 16].wall])
			{
				NewNPC(GetSpawnSource_NPCHurt(), (int)base.Center.X, (int)base.Center.Y, 288);
			}
		}
	}

	private void DoDeathEvents_AdvanceSlimeRain(Player closestPlayer)
	{
		if (Main.slimeRain && Main.slimeRainNPC[type] && !AnyNPCs(50))
		{
			int num = 150;
			if (downedSlimeKing)
			{
				num /= 2;
			}
			Main.slimeRainKillCount++;
			if (Main.slimeRainKillCount >= num)
			{
				SpawnOnPlayer(closestPlayer.whoAmI, 50);
				Main.slimeRainKillCount = -num / 2;
			}
		}
	}

	private void NPCLoot_DropHeals(Player closestPlayer)
	{
		NPCLoot_DropCommonLifeAndMana(closestPlayer);
		switch (type)
		{
		case 305:
		case 306:
		case 307:
		case 308:
		case 309:
		case 310:
		case 311:
		case 312:
		case 313:
		case 314:
		case 329:
		case 330:
			if (closestPlayer.RollLuck(4) == 0)
			{
				Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 58);
			}
			break;
		case 326:
			if (closestPlayer.RollLuck(6) == 0)
			{
				Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 58);
			}
			break;
		case 315:
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 58);
			break;
		case 341:
		{
			int num2 = Main.rand.Next(5, 11);
			for (int j = 0; j < num2; j++)
			{
				Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 58);
			}
			break;
		}
		case 338:
		case 339:
		case 340:
			if (closestPlayer.RollLuck(5) == 0)
			{
				Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 58);
			}
			break;
		case 342:
			if (Main.rand.Next(3) != 0)
			{
				Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 58);
			}
			break;
		case 325:
		case 327:
		case 344:
		case 345:
		case 346:
		{
			int num = Main.rand.Next(6) + 6;
			for (int i = 0; i < num; i++)
			{
				Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 58);
			}
			break;
		}
		case 267:
			if (Main.rand.Next(2) == 0 && closestPlayer.statLife < closestPlayer.statLifeMax2)
			{
				Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 58);
			}
			break;
		case 13:
		case 14:
		case 15:
			if (Main.rand.Next(4) == 0 && closestPlayer.statLife < closestPlayer.statLifeMax2)
			{
				Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 58);
			}
			break;
		case 116:
		case 117:
		case 118:
		case 119:
			if (!Main.expertMode || Main.rand.Next(5) == 0)
			{
				Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 58);
			}
			break;
		case 139:
			if (Main.rand.Next(2) == 0)
			{
				Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 58);
			}
			break;
		}
	}

	private void DoDeathEvents(Player closestPlayer)
	{
		DoDeathEvents_AdvanceSlimeRain(closestPlayer);
		DoDeathEvents_SummonDungeonSpirit(closestPlayer);
		if (Main.remixWorld && !downedSlimeKing && AnyInteractions() && Main.AnyPlayerReadyToFightKingSlime() && type == 1 && !AnyNPCs(50) && Main.rand.Next(200) == 0)
		{
			SpawnOnPlayer(closestPlayer.whoAmI, 50);
		}
		switch (type)
		{
		case 216:
			SpawnBoss((int)position.X, (int)position.Y, 662, target);
			break;
		case 327:
			if (Main.pumpkinMoon)
			{
				SetEventFlagCleared(ref downedHalloweenKing, 5);
			}
			break;
		case 325:
			if (Main.pumpkinMoon)
			{
				SetEventFlagCleared(ref downedHalloweenTree, 4);
			}
			break;
		case 344:
			if (Main.snowMoon)
			{
				SetEventFlagCleared(ref downedChristmasTree, 21);
			}
			break;
		case 345:
			if (Main.snowMoon)
			{
				SetEventFlagCleared(ref downedChristmasIceQueen, 20);
			}
			break;
		case 346:
			if (Main.snowMoon)
			{
				SetEventFlagCleared(ref downedChristmasSantank, 22);
			}
			break;
		case 552:
		case 553:
		case 554:
			if (DD2Event.Ongoing)
			{
				DD2Event.AnnounceGoblinDeath(this);
				if (DD2Event.ShouldDropCrystals())
				{
					Item.NewItem(GetItemSource_Loot(), position, base.Size, 3822);
				}
			}
			break;
		case 555:
		case 556:
		case 557:
		case 558:
		case 559:
		case 560:
		case 561:
		case 562:
		case 563:
		case 564:
		case 565:
		case 568:
		case 569:
		case 570:
		case 571:
		case 572:
		case 573:
		case 574:
		case 575:
		case 576:
		case 577:
		case 578:
			if (DD2Event.ShouldDropCrystals())
			{
				Item.NewItem(GetItemSource_Loot(), position, base.Size, 3822);
			}
			break;
		case 412:
		case 413:
		case 414:
		case 415:
		case 416:
		case 417:
		case 418:
		case 419:
		case 518:
			if (ShieldStrengthTowerSolar > 0)
			{
				Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, 0f, 0f, 629, 0, 0f, Main.myPlayer, FindFirstNPC(517));
			}
			break;
		case 425:
		case 426:
		case 427:
		case 429:
			if (ShieldStrengthTowerVortex > 0)
			{
				Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, 0f, 0f, 629, 0, 0f, Main.myPlayer, FindFirstNPC(422));
			}
			break;
		case 420:
		case 421:
		case 423:
		case 424:
			if (ShieldStrengthTowerNebula > 0)
			{
				Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, 0f, 0f, 629, 0, 0f, Main.myPlayer, FindFirstNPC(507));
			}
			break;
		case 402:
		case 405:
		case 407:
		case 409:
		case 411:
			if (ShieldStrengthTowerStardust > 0)
			{
				Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, 0f, 0f, 629, 0, 0f, Main.myPlayer, FindFirstNPC(493));
			}
			break;
		case 517:
			downedTowerSolar = true;
			TowerActiveSolar = false;
			WorldGen.UpdateLunarApocalypse();
			WorldGen.MessageLunarApocalypse();
			break;
		case 422:
			downedTowerVortex = true;
			TowerActiveVortex = false;
			WorldGen.UpdateLunarApocalypse();
			WorldGen.MessageLunarApocalypse();
			break;
		case 507:
			downedTowerNebula = true;
			TowerActiveNebula = false;
			WorldGen.UpdateLunarApocalypse();
			WorldGen.MessageLunarApocalypse();
			break;
		case 493:
			downedTowerStardust = true;
			TowerActiveStardust = false;
			WorldGen.UpdateLunarApocalypse();
			WorldGen.MessageLunarApocalypse();
			break;
		case 245:
			SetEventFlagCleared(ref downedGolemBoss, 6);
			break;
		case 370:
			SetEventFlagCleared(ref downedFishron, 7);
			break;
		case 636:
			SetEventFlagCleared(ref downedEmpressOfLight, 23);
			break;
		case 668:
			SetEventFlagCleared(ref downedDeerclops, 25);
			break;
		case 657:
			SetEventFlagCleared(ref downedQueenSlime, 24);
			break;
		case 22:
			if (Collision.LavaCollision(position, width, height))
			{
				SpawnWOF(position);
			}
			break;
		case 614:
		{
			int num2 = 175;
			if (SpawnedFromStatue)
			{
				num2 = 0;
			}
			Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, 0f, 0f, 281, num2, 0f, Main.myPlayer, -2f, releaseOwner + 1);
			break;
		}
		case 109:
			if (!downedClown)
			{
				downedClown = true;
				if (Main.netMode == 2)
				{
					NetMessage.SendData(7);
				}
			}
			break;
		case 222:
			SetEventFlagCleared(ref downedQueenBee, 8);
			if (Main.netMode == 2)
			{
				NetMessage.SendData(7);
			}
			break;
		case 439:
			SetEventFlagCleared(ref downedAncientCultist, 9);
			WorldGen.TriggerLunarApocalypse();
			break;
		case 398:
			SetEventFlagCleared(ref downedMoonlord, 10);
			LunarApocalypseIsUp = false;
			if (Main.getGoodWorld)
			{
				AchievementsHelper.NotifyProgressionEvent(30);
			}
			break;
		case 50:
			if (Main.slimeRain)
			{
				Main.StopSlimeRain();
				AchievementsHelper.NotifyProgressionEvent(16);
			}
			if (Main.netMode != 1 && !unlockedSlimeBlueSpawn)
			{
				unlockedSlimeBlueSpawn = true;
				ViolentlySpawnNerdySlime();
			}
			SetEventFlagCleared(ref downedSlimeKing, 11);
			if (Main.netMode == 2)
			{
				NetMessage.SendData(7);
			}
			break;
		case 125:
		case 126:
			if (boss)
			{
				SetEventFlagCleared(ref downedMechBoss2, 17);
				downedMechBossAny = true;
			}
			break;
		case 262:
		{
			bool num3 = downedPlantBoss;
			SetEventFlagCleared(ref downedPlantBoss, 12);
			if (!num3)
			{
				if (Main.netMode == 0)
				{
					Main.NewText(Lang.misc[33].Value, 50, byte.MaxValue, 130);
				}
				else if (Main.netMode == 2)
				{
					ChatHelper.BroadcastChatMessage(NetworkText.FromKey(Lang.misc[33].Key), new Color(50, 255, 130));
				}
			}
			break;
		}
		case 4:
			SetEventFlagCleared(ref downedBoss1, 13);
			break;
		case 13:
		case 14:
		case 15:
		case 266:
			if (boss)
			{
				if (WorldGen.Skyblock.lowTiles)
				{
					WorldGen.shadowOrbSmashed = true;
				}
				if (!downedBoss2 || Main.rand.Next(2) == 0)
				{
					WorldGen.spawnMeteor = true;
				}
				SetEventFlagCleared(ref downedBoss2, 14);
			}
			break;
		case 35:
			if (boss)
			{
				SetEventFlagCleared(ref downedBoss3, 15);
			}
			break;
		case 127:
			if (boss)
			{
				SetEventFlagCleared(ref downedMechBoss3, 18);
				downedMechBossAny = true;
			}
			break;
		case 134:
			if (boss)
			{
				SetEventFlagCleared(ref downedMechBoss1, 16);
				downedMechBossAny = true;
			}
			break;
		case 113:
		{
			if (Main.netMode == 1)
			{
				break;
			}
			CreateBrickBoxForWallOfFlesh();
			bool eventFlag = Main.hardMode;
			WorldGen.StartHardmode();
			if (downedMechBoss1 && downedMechBoss2 && downedMechBoss3 && !eventFlag)
			{
				if (Main.netMode == 0)
				{
					Main.NewText(Lang.misc[32].Value, 50, byte.MaxValue, 130);
				}
				else if (Main.netMode == 2)
				{
					ChatHelper.BroadcastChatMessage(NetworkText.FromKey(Lang.misc[32].Key), new Color(50, 255, 130));
				}
			}
			SetEventFlagCleared(ref eventFlag, 19);
			break;
		}
		case 661:
			if (Main.netMode != 1 && GetWereThereAnyInteractions())
			{
				int num = 636;
				if (!AnyNPCs(num))
				{
					Vector2 vector = base.Center + new Vector2(0f, -200f) + Main.rand.NextVector2Circular(50f, 50f);
					SpawnBoss((int)vector.X, (int)vector.Y, num, closestPlayer.whoAmI);
				}
			}
			break;
		}
		if (boss)
		{
			DoDeathEvents_DropBossPotionsAndHearts();
			DoDeathEvents_CelebrateBossDeath();
			if (Main.netMode == 2)
			{
				NetMessage.SendData(7);
			}
		}
	}

	private void ViolentlySpawnNerdySlime()
	{
		int num = NewNPC(GetSpawnSourceForNPCFromNPCAI(), (int)base.Center.X - 10, (int)base.Center.Y, 670);
		NPC obj = Main.npc[num];
		Vector2 movementVector = (obj.velocity = new Vector2(Main.rand.NextFloatDirection() * 3f, -10f));
		obj.netUpdate = true;
		WorldGen.CheckAchievement_RealEstateAndTownSlimes();
		ParticleOrchestrator.BroadcastParticleSpawn(ParticleOrchestraType.TownSlimeTransform, new ParticleOrchestraSettings
		{
			PositionInWorld = base.Center,
			MovementVector = movementVector,
			UniqueInfoPiece = 0
		});
	}

	private void NPCLoot_DropCommonLifeAndMana(Player closestPlayer)
	{
		if (type != 16 && type != 81 && type != 121 && closestPlayer.RollLuck(6) == 0 && lifeMax > 1 && damage > 0)
		{
			if (Main.rand.Next(2) == 0 && closestPlayer.statMana < closestPlayer.statManaMax2)
			{
				Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 184);
			}
			else if (Main.rand.Next(2) == 0 && closestPlayer.statLife < closestPlayer.statLifeMax2)
			{
				Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 58);
			}
		}
		if (type != 16 && type != 81 && type != 121 && closestPlayer.RollLuck(2) == 0 && lifeMax > 1 && damage > 0 && closestPlayer.statMana < closestPlayer.statManaMax2)
		{
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 184);
		}
	}

	private void NPCLoot_DropDungeonStuff()
	{
		WorldGen.Skyblock.noDungeon = false;
		switch (Main.rand.Next(3))
		{
		case 0:
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 134, Main.rand.Next(500, 601));
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 5365, Main.rand.Next(400, 501));
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 5367, Main.rand.Next(400, 501));
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 5366, Main.rand.Next(400, 501));
			break;
		case 1:
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 137, Main.rand.Next(500, 601));
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 5371, Main.rand.Next(400, 501));
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 5373, Main.rand.Next(400, 501));
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 5372, Main.rand.Next(400, 501));
			break;
		default:
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 139, Main.rand.Next(500, 601));
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 5368, Main.rand.Next(400, 501));
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 5370, Main.rand.Next(400, 501));
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 5369, Main.rand.Next(400, 501));
			break;
		}
	}

	private void NPCLoot_DropTempleTraps()
	{
		int num = Main.rand.Next(4);
		num = ((num == 0) ? 1149 : ((num == 0) ? 1147 : ((num != 0) ? 1146 : 1148)));
		Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, num, Main.rand.Next(5, 11));
	}

	private void NPCLoot_DropLihzahrdStuff()
	{
		WorldGen.Skyblock.noTemple = false;
		Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 1294);
		Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 1292);
		Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 1101, Main.rand.Next(500, 601));
		Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 5376, Main.rand.Next(1200, 1501));
	}

	private void NPCLoot_DropAltar()
	{
		WorldGen.Skyblock.noAltars = false;
		if (WorldGen.crimson)
		{
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 5533);
		}
		else
		{
			Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 5532);
		}
	}

	private void NPCLoot_DropHellforge()
	{
		WorldGen.Skyblock.noHellforge = false;
		Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 221);
	}

	private void NPCLoot_DropMoney(Player closestPlayer)
	{
		float num = 0f;
		float luck = closestPlayer.luck;
		int num2 = 1;
		if (Main.rand.NextFloat() < Math.Abs(luck))
		{
			num2 = 2;
		}
		for (int i = 0; i < num2; i++)
		{
			float num3 = value;
			if (midas)
			{
				num3 *= 1f + (float)Main.rand.Next(10, 51) * 0.01f;
			}
			num3 *= 1f + (float)Main.rand.Next(-20, 76) * 0.01f;
			if (Main.rand.Next(2) == 0)
			{
				num3 *= 1f + (float)Main.rand.Next(5, 11) * 0.01f;
			}
			if (Main.rand.Next(4) == 0)
			{
				num3 *= 1f + (float)Main.rand.Next(10, 21) * 0.01f;
			}
			if (Main.rand.Next(8) == 0)
			{
				num3 *= 1f + (float)Main.rand.Next(15, 31) * 0.01f;
			}
			if (Main.rand.Next(16) == 0)
			{
				num3 *= 1f + (float)Main.rand.Next(20, 41) * 0.01f;
			}
			if (Main.rand.Next(32) == 0)
			{
				num3 *= 1f + (float)Main.rand.Next(25, 51) * 0.01f;
			}
			if (Main.rand.Next(64) == 0)
			{
				num3 *= 1f + (float)Main.rand.Next(50, 101) * 0.01f;
			}
			if (Main.bloodMoon)
			{
				num3 *= 1f + (float)Main.rand.Next(101) * 0.01f;
			}
			if (i == 0)
			{
				num = num3;
			}
			else if (luck < 0f)
			{
				if (num3 < num)
				{
					num = num3;
				}
			}
			else if (num3 > num)
			{
				num = num3;
			}
		}
		num += (float)extraValue;
		while ((int)num > 0)
		{
			if (num > 1000000f)
			{
				int num4 = (int)(num / 1000000f);
				if (num4 > 50 && Main.rand.Next(5) == 0)
				{
					num4 /= Main.rand.Next(3) + 1;
				}
				if (Main.rand.Next(5) == 0)
				{
					num4 /= Main.rand.Next(3) + 1;
				}
				int num5 = num4;
				while (num5 > 999)
				{
					num5 -= 999;
					Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 74, 999);
				}
				num -= (float)(1000000 * num4);
				Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 74, num5);
			}
			else if (num > 10000f)
			{
				int num6 = (int)(num / 10000f);
				if (num6 > 50 && Main.rand.Next(5) == 0)
				{
					num6 /= Main.rand.Next(3) + 1;
				}
				if (Main.rand.Next(5) == 0)
				{
					num6 /= Main.rand.Next(3) + 1;
				}
				num -= (float)(10000 * num6);
				Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 73, num6);
			}
			else if (num > 100f)
			{
				int num7 = (int)(num / 100f);
				if (num7 > 50 && Main.rand.Next(5) == 0)
				{
					num7 /= Main.rand.Next(3) + 1;
				}
				if (Main.rand.Next(5) == 0)
				{
					num7 /= Main.rand.Next(3) + 1;
				}
				num -= (float)(100 * num7);
				Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 72, num7);
			}
			else
			{
				int num8 = (int)num;
				if (num8 > 50 && Main.rand.Next(5) == 0)
				{
					num8 /= Main.rand.Next(3) + 1;
				}
				if (Main.rand.Next(5) == 0)
				{
					num8 /= Main.rand.Next(4) + 1;
				}
				if (num8 < 1)
				{
					num8 = 1;
				}
				num -= (float)num8;
				Item.NewItem(GetItemSource_Loot(), (int)position.X, (int)position.Y, width, height, 71, num8);
			}
		}
	}

	public static int GetStackForSlimeItemDrop(int item)
	{
		int num = 1;
		if (item == 8)
		{
			num = Main.rand.Next(5, 11);
		}
		else if (item == 166)
		{
			num = Main.rand.Next(2, 7);
		}
		else if (item == 965)
		{
			num = Main.rand.Next(20, 46);
		}
		else if ((item >= 11 && item <= 14) || (item >= 699 && item <= 702))
		{
			num = Main.rand.Next(3, 9);
			if (Main.rand.Next(2) == 0)
			{
				num += 5;
			}
		}
		else
		{
			switch (item)
			{
			case 71:
				num = Main.rand.Next(50, 100);
				break;
			case 72:
				num = Main.rand.Next(20, 100);
				break;
			case 73:
				num = Main.rand.Next(1, 3);
				break;
			}
		}
		return num;
	}

	public bool ExcludedFromDeathTally()
	{
		if (netID < 0)
		{
			if (netID != -5)
			{
				return netID == -1;
			}
			return true;
		}
		if (!NPCID.Sets.ProjectileNPC[netID])
		{
			return NPCID.Sets.PositiveNPCTypesExcludedFromDeathTally[netID];
		}
		return true;
	}

	private void CountKillForBannersAndDropThem()
	{
		if (!ExcludedFromDeathTally())
		{
			int num = lastInteraction;
			if (!Main.player[num].active || Main.player[num].dead)
			{
				num = FindClosestPlayer();
			}
			BannerSystem.AddNPCKillBy(BannerID(), num);
		}
	}

	public bool GetWereThereAnyInteractions()
	{
		bool flag = false;
		if (realLife >= 0)
		{
			return Main.npc[realLife].AnyInteractions();
		}
		return AnyInteractions();
	}

	private void CountKillForAchievements()
	{
		switch (type)
		{
		case 125:
		case 126:
			if (!AnyNPCs((type == 126) ? 125 : 126))
			{
				AchievementsHelper.NotifyNPCKilled(this);
				AchievementsHelper.MechaMayhem_Kill(type);
			}
			break;
		case 127:
		case 134:
			AchievementsHelper.MechaMayhem_Kill(type);
			AchievementsHelper.NotifyNPCKilled(this);
			break;
		case 13:
		case 14:
		case 15:
			if (boss)
			{
				AchievementsHelper.NotifyNPCKilled(this);
			}
			break;
		default:
			AchievementsHelper.NotifyNPCKilled(this);
			break;
		}
	}

	private bool TryTeleportingCaughtMysticFrog()
	{
		if (Main.netMode == 1)
		{
			return false;
		}
		if (type != 687)
		{
			return false;
		}
		Vector2 chosenTile = Vector2.Zero;
		Point point = base.Center.ToTileCoordinates();
		if (AI_AttemptToFindTeleportSpot(ref chosenTile, point.X, point.Y, 15, 8))
		{
			Vector2 newPos = new Vector2(chosenTile.X * 16f - (float)(width / 2), chosenTile.Y * 16f - (float)height);
			NetMessage.SendData(23, -1, -1, null, whoAmI);
			Teleport(newPos, 13);
			return true;
		}
		Vector2 vector = base.Center - new Vector2(20f);
		Utils.PoofOfSmoke(vector);
		active = false;
		NetMessage.SendData(23, -1, -1, null, whoAmI);
		NetMessage.SendData(106, -1, -1, null, (int)vector.X, vector.Y);
		return false;
	}

	public static void CatchNPC(int i, int who = -1)
	{
		if (!Main.npc[i].active)
		{
			return;
		}
		if (who == -1)
		{
			who = Main.myPlayer;
		}
		if (Main.netMode == 1)
		{
			Main.npc[i].active = false;
			NetMessage.SendData(70, -1, -1, null, i, who);
		}
		else if (Main.npc[i].catchItem > 0)
		{
			if (Main.npc[i].type == 687)
			{
				Main.npc[i].TryTeleportingCaughtMysticFrog();
			}
			else if (Main.npc[i].SpawnedFromStatue)
			{
				Vector2 vector = Main.npc[i].Center - new Vector2(20f);
				Utils.PoofOfSmoke(vector);
				Main.npc[i].active = false;
				NetMessage.SendData(23, -1, -1, null, i);
				NetMessage.SendData(106, -1, -1, null, (int)vector.X, vector.Y);
			}
			else
			{
				new Item().SetDefaults(Main.npc[i].catchItem);
				Item.NewItem(GetSpawnSource_NPCCatch(who), (int)Main.player[who].Center.X, (int)Main.player[who].Center.Y, 0, 0, Main.npc[i].catchItem, 1, noBroadcast: false, 0, noGrabDelay: true);
				Main.npc[i].active = false;
				NetMessage.SendData(23, -1, -1, null, i);
			}
		}
	}

	public void DropItemInstanced(Vector2 Position, Vector2 HitboxSize, int itemType, int itemStack = 1, bool interactionRequired = true)
	{
		if (itemType <= 0)
		{
			return;
		}
		if (Main.netMode == 2)
		{
			int num = Item.NewItem(GetItemSource_Loot(), (int)Position.X, (int)Position.Y, (int)HitboxSize.X, (int)HitboxSize.Y, itemType, itemStack, noBroadcast: true);
			Main.timeItemSlotCannotBeReusedFor[num] = 54000;
			for (int i = 0; i < 255; i++)
			{
				if (Main.player[i].active && (playerInteraction[i] || !interactionRequired))
				{
					NetMessage.SendData(90, i, -1, null, num);
				}
			}
			Main.item[num].TurnToAir();
		}
		else if (Main.netMode == 0)
		{
			Item.NewItem(GetItemSource_Loot(), (int)Position.X, (int)Position.Y, (int)HitboxSize.X, (int)HitboxSize.Y, itemType, itemStack);
		}
		value = 0f;
	}

	public void PlayerInteraction(int player)
	{
		bool flag = false;
		if ((realLife < 0) ? (lastInteraction == player) : (Main.npc[realLife].lastInteraction == player))
		{
			return;
		}
		if (type == 13 || type == 14 || type == 15)
		{
			for (int i = 0; i < Main.maxNPCs; i++)
			{
				if (i != whoAmI && Main.npc[i].active && (Main.npc[i].type == 13 || Main.npc[i].type == 14 || Main.npc[i].type == 15))
				{
					Main.npc[i].ApplyInteraction(player);
				}
			}
		}
		if (type == 134 || type == 135 || type == 136)
		{
			for (int j = 0; j < Main.maxNPCs; j++)
			{
				if (j != whoAmI && Main.npc[j].active && (Main.npc[j].type == 134 || Main.npc[j].type == 135 || Main.npc[j].type == 136))
				{
					Main.npc[j].ApplyInteraction(player);
				}
			}
		}
		if (type == 35 || type == 36)
		{
			for (int k = 0; k < Main.maxNPCs; k++)
			{
				if (k != whoAmI && Main.npc[k].active && (Main.npc[k].type == 35 || Main.npc[k].type == 36))
				{
					Main.npc[k].ApplyInteraction(player);
				}
			}
		}
		if (type == 113 || type == 114)
		{
			for (int l = 0; l < Main.maxNPCs; l++)
			{
				if (l != whoAmI && Main.npc[l].active && (Main.npc[l].type == 113 || Main.npc[l].type == 114))
				{
					Main.npc[l].ApplyInteraction(player);
				}
			}
		}
		if (type >= 127 && type <= 131)
		{
			for (int m = 0; m < Main.maxNPCs; m++)
			{
				if (m != whoAmI && Main.npc[m].active && Main.npc[m].type >= 127 && Main.npc[m].type <= 131)
				{
					Main.npc[m].ApplyInteraction(player);
				}
			}
		}
		if (type >= 245 && type <= 249)
		{
			for (int n = 0; n < Main.maxNPCs; n++)
			{
				if (n != whoAmI && Main.npc[n].active && Main.npc[n].type >= 245 && Main.npc[n].type <= 249)
				{
					Main.npc[n].ApplyInteraction(player);
				}
			}
		}
		if ((type == 396 || type == 397) && Main.npc[(int)ai[3]].active && Main.npc[(int)ai[3]].type == 398)
		{
			Main.npc[(int)ai[3]].ApplyInteraction(player);
		}
		if ((type == 393 || type == 394) && Main.npc[(int)ai[0]].active && Main.npc[(int)ai[0]].type == 395)
		{
			Main.npc[(int)ai[0]].ApplyInteraction(player);
		}
		if (type == 492 && Main.npc[(int)ai[0]].active && Main.npc[(int)ai[0]].type == 491)
		{
			Main.npc[(int)ai[0]].ApplyInteraction(player);
		}
		if (type == 125 || type == 126)
		{
			for (int num = 0; num < Main.maxNPCs; num++)
			{
				if (num != whoAmI && Main.npc[num].active && (Main.npc[num].type == 125 || Main.npc[num].type == 126))
				{
					Main.npc[num].ApplyInteraction(player);
				}
			}
		}
		ApplyInteraction(player);
	}

	public void ApplyInteraction(int player)
	{
		if (realLife >= 0)
		{
			Main.npc[realLife].playerInteraction[player] = true;
		}
		else
		{
			playerInteraction[player] = true;
		}
		if (player < 255)
		{
			if (realLife >= 0)
			{
				Main.npc[realLife].lastInteraction = player;
			}
			else
			{
				lastInteraction = player;
			}
		}
	}

	public static bool CanReleaseNPCs(int who)
	{
		float num = 0.7f;
		if (Main.netMode != 1)
		{
			num += 0.05f;
		}
		int num2 = 0;
		int num3 = 0;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (Main.npc[i].active)
			{
				num3++;
				if (Main.npc[i].releaseOwner == who)
				{
					num2++;
				}
			}
		}
		int num4 = 0;
		for (int j = 0; j < 255; j++)
		{
			if (Main.player[j].active)
			{
				num4++;
			}
		}
		int num5 = (int)((float)Main.maxNPCs * num / (float)num4);
		if ((float)num3 < (float)Main.maxNPCs * num && num2 < num5)
		{
			return true;
		}
		return false;
	}

	public static int ReleaseNPC(int x, int y, int Type, int Style, int who)
	{
		int num = -1;
		if (Main.netMode == 1)
		{
			NetMessage.SendData(71, -1, -1, null, x, y, Type, Style);
		}
		else if (Type >= 0 && Type < NPCID.Count && (Main.npcCatchable[Type] || who == Main.myPlayer) && CanReleaseNPCs(who))
		{
			switch (Type)
			{
			case 583:
			case 584:
			case 585:
				num = NewNPC(GetSpawnSource_NPCRelease(who), x, y, Type);
				Main.npc[num].releaseOwner = (short)who;
				Main.npc[num].ai[2] = 2f;
				Main.npc[num].TargetClosest();
				Main.npc[num].ai[3] = 0f;
				Main.npc[num].netUpdate = true;
				break;
			case 356:
				num = NewNPC(GetSpawnSource_NPCRelease(who), x, y, Type);
				Main.npc[num].ai[2] = Style;
				Main.npc[num].releaseOwner = (short)who;
				break;
			case 148:
			{
				int num3 = Type + Main.rand.Next(2);
				num = NewNPC(GetSpawnSource_NPCRelease(who), x, y, num3);
				Main.npc[num].releaseOwner = (short)who;
				break;
			}
			case 614:
			{
				num = NewNPC(GetSpawnSource_NPCRelease(who), x, y, Type);
				Main.npc[num].releaseOwner = (short)who;
				int num2 = Main.player[who].direction;
				if (Style > 2)
				{
					Style -= 2;
					Main.npc[num].SpawnedFromStatue = true;
					Main.npc[num].CanBeReplacedByOtherNPCs = true;
				}
				if (Style == 1)
				{
					num2 = 1;
				}
				if (Style == 2)
				{
					num2 = -1;
				}
				Main.npc[num].direction = num2;
				Main.npc[num].spriteDirection = num2;
				Main.npc[num].netUpdate = true;
				break;
			}
			default:
				num = NewNPC(GetSpawnSource_NPCRelease(who), x, y, Type);
				Main.npc[num].releaseOwner = (short)who;
				break;
			}
		}
		return num;
	}

	public static void SpawnNPC()
	{
		if (noSpawnCycle)
		{
			noSpawnCycle = false;
			return;
		}
		RevengeManager.CheckRespawns();
		new Spawner().SpawnNPC();
	}

	public static bool FindCattailTop(int landX, int landY, out int cattailX, out int cattailY)
	{
		cattailX = landX;
		cattailY = landY;
		if (!WorldGen.InWorld(landX, landY, 31))
		{
			return false;
		}
		int num = 1;
		for (int i = landX - 30; i <= landX + 30; i++)
		{
			for (int j = landY - 20; j <= landY + 20; j++)
			{
				Tile tile = Main.tile[i, j];
				if (tile != null && tile.active() && tile.type == 519 && tile.frameX >= 180 && Main.rand.Next(num) == 0)
				{
					cattailX = i;
					cattailY = j;
					num++;
				}
			}
		}
		if (cattailX != landX || cattailY != landY)
		{
			return true;
		}
		return false;
	}

	public static bool FindTreeBranch(int landX, int landY, out int treeBranchX, out int treeBranchY)
	{
		treeBranchX = landX;
		treeBranchY = landY;
		if (!WorldGen.InWorld(landX, landY, 11))
		{
			return false;
		}
		int num = 1;
		for (int i = landX - 10; i <= landX + 10; i++)
		{
			for (int j = landY - 30; j <= landY + 30; j++)
			{
				Tile tile = Main.tile[i, j];
				if (tile != null && tile.active() && TileID.Sets.IsATreeTrunk[tile.type])
				{
					int num2 = tile.frameX / 22;
					int num3 = tile.frameY / 66;
					if (((num2 == 3 && num3 == 0) || (num2 == 3 && num3 == 3) || (num2 == 4 && num3 == 1) || (num2 == 4 && num3 == 3) || (num2 == 2 && num3 == 3)) && Main.rand.Next(num) == 0)
					{
						treeBranchX = i;
						treeBranchY = j;
						num++;
					}
				}
			}
		}
		if (treeBranchX != landX || treeBranchY != landY)
		{
			return true;
		}
		return false;
	}

	public static bool AnyDanger(bool quickBossNPCCheck = false, bool ignorePillarsAndMoonlordCountdown = false)
	{
		bool flag = false;
		if (!ignorePillarsAndMoonlordCountdown && MoonLordCountdown > 0)
		{
			flag = true;
		}
		if (Main.invasionType > 0)
		{
			flag = true;
		}
		if (Main.snowMoon || Main.pumpkinMoon || DD2Event.Ongoing)
		{
			flag = true;
		}
		if (!flag)
		{
			if (quickBossNPCCheck)
			{
				flag |= Main.CurrentFrameFlags.AnyActiveBossNPC;
			}
			else
			{
				for (int i = 0; i < Main.maxNPCs; i++)
				{
					if (!Main.npc[i].active || (!Main.npc[i].boss && !NPCID.Sets.DangerThatPreventsOtherDangers[Main.npc[i].type]))
					{
						continue;
					}
					if (ignorePillarsAndMoonlordCountdown)
					{
						switch (Main.npc[i].type)
						{
						case 422:
						case 493:
						case 507:
						case 517:
							continue;
						}
					}
					flag = true;
				}
			}
		}
		return flag;
	}

	public static bool AnyoneNearCultists()
	{
		int num = FindFirstNPC(437);
		if (num == -1)
		{
			return false;
		}
		Rectangle rectangle = Utils.CenteredRectangle(Main.npc[num].Center, new Vector2(2500f, 1500f));
		Rectangle r = new Rectangle(0, 0, 2500, 1500);
		Vector2 vector = r.Size() / 2f;
		for (int i = 0; i < 255; i++)
		{
			if (Main.player[i].active)
			{
				r.X = (int)Main.player[i].Center.X - (int)vector.X;
				r.Y = (int)Main.player[i].Center.Y - (int)vector.Y;
				if (rectangle.Intersects(r))
				{
					return true;
				}
			}
		}
		return false;
	}

	public static void SpawnWOF(Vector2 pos)
	{
		if (pos.Y / 16f < (float)(Main.maxTilesY - 205) || Main.wofNPCIndex >= 0 || Main.netMode == 1 || AnyNPCs(113))
		{
			return;
		}
		Player.FindClosest(pos, 16, 16);
		int num = 1;
		if (pos.X / 16f > (float)(Main.maxTilesX / 2))
		{
			num = -1;
		}
		bool flag = false;
		int num2 = (int)pos.X;
		int targetPlayerIndex = 0;
		while (!flag)
		{
			flag = true;
			for (int i = 0; i < 255; i++)
			{
				if (Main.player[i].active && Main.player[i].position.X > (float)(num2 - 1200) && Main.player[i].position.X < (float)(num2 + 1200))
				{
					num2 -= num * 16;
					flag = false;
					targetPlayerIndex = i;
				}
			}
			if (num2 / 16 < 20 || num2 / 16 > Main.maxTilesX - 20)
			{
				flag = true;
			}
		}
		int num3 = (int)pos.Y;
		int num4 = num2 / 16;
		int num5 = num3 / 16;
		int num6 = 0;
		int num7 = 1000;
		if (!WorldGen.InWorld(num4, num5, 2) || WorldGen.SolidTile(num4, num5) || Main.tile[num4, num5 - num6].liquid >= 100)
		{
			while (true)
			{
				num7--;
				if (num7 <= 0)
				{
					break;
				}
				try
				{
					if (WorldGen.InWorld(num4, num5 - num6, 2) && !WorldGen.SolidTile(num4, num5 - num6) && Main.tile[num4, num5 - num6].liquid < 100)
					{
						num5 -= num6;
						break;
					}
					if (WorldGen.InWorld(num4, num5 + num6, 2) && !WorldGen.SolidTile(num4, num5 + num6) && Main.tile[num4, num5 + num6].liquid < 100)
					{
						num5 += num6;
						break;
					}
					num6++;
				}
				catch
				{
					break;
				}
			}
		}
		int num8 = Main.UnderworldLayer + 10;
		int num9 = num8 + 70;
		if (num5 < num8)
		{
			num5 = num8;
		}
		if (num5 > num9)
		{
			num5 = num9;
		}
		num3 = num5 * 16;
		int num10 = NewNPC(GetBossSpawnSource(targetPlayerIndex), num2, num3, 113);
		if (Main.netMode == 0)
		{
			Main.NewText(Language.GetTextValue("Announcement.HasAwoken", Main.npc[num10].TypeName), 175, 75);
		}
		else if (Main.netMode == 2)
		{
			ChatHelper.BroadcastChatMessage(NetworkText.FromKey("Announcement.HasAwoken", Main.npc[num10].GetTypeNetName()), new Color(175, 75, 255));
		}
	}

	public static void RedHatSkeletron(int onWho)
	{
		if (Main.netMode == 1 || Main.IsItDay())
		{
			return;
		}
		Player player = Main.player[onWho];
		if (!player.killClothier)
		{
			return;
		}
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			NPC nPC = Main.npc[i];
			if (nPC != null && nPC.active && nPC.type == 54 && Collision.CanHit(player, nPC))
			{
				SpawnSkeletron(onWho, redHatMode: true);
				Main.npc[i].ai[3] = 1f;
				if (Main.netMode == 2)
				{
					NetMessage.SendData(23, -1, -1, null, i);
				}
				break;
			}
		}
	}

	public static void SpawnSkeletron(int onWho, bool redHatMode = false)
	{
		bool flag = true;
		bool flag2 = false;
		Vector2 zero = Vector2.Zero;
		int num = 0;
		int num2 = 0;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (Main.npc[i].active && Main.npc[i].type == 35)
			{
				flag = false;
				break;
			}
		}
		for (int j = 0; j < Main.maxNPCs; j++)
		{
			if (!Main.npc[j].active)
			{
				continue;
			}
			if (Main.npc[j].type == 37)
			{
				flag2 = true;
				Main.npc[j].ai[3] = 1f;
				zero = Main.npc[j].position;
				num = Main.npc[j].width;
				num2 = Main.npc[j].height;
				if (Main.netMode == 2)
				{
					NetMessage.SendData(23, -1, -1, null, j);
				}
			}
			else if (Main.npc[j].type == 54)
			{
				flag2 = true;
				zero = Main.npc[j].position;
				num = Main.npc[j].width;
				num2 = Main.npc[j].height;
			}
		}
		if (flag && flag2)
		{
			int num3 = NewNPC(GetBossSpawnSource(onWho), (int)zero.X + num / 2, (int)zero.Y + num2 / 2, 35);
			if (redHatMode)
			{
				Main.npc[num3].ai[3] = 1f;
			}
			Main.npc[num3].netUpdate = true;
			string nPCNameValue = Lang.GetNPCNameValue(35);
			if (Main.netMode == 0)
			{
				Main.NewText(Language.GetTextValue("Announcement.HasAwoken", nPCNameValue), 175, 75);
			}
			else if (Main.netMode == 2)
			{
				ChatHelper.BroadcastChatMessage(NetworkText.FromKey("Announcement.HasAwoken", Lang.GetNPCName(35).ToNetworkText()), new Color(175, 75, 255));
			}
		}
	}

	public static void SpawnOnPlayer(int plr, int npcType, float ai0 = 0f, float ai1 = 0f, float ai2 = 0f, float ai3 = 0f)
	{
		if (Main.netMode == 1 || (npcType == 262 && AnyNPCs(262)))
		{
			return;
		}
		switch (npcType)
		{
		case 245:
			if (AnyNPCs(245))
			{
				return;
			}
			try
			{
				int num = (int)Main.player[plr].Center.X / 16;
				int num2 = (int)Main.player[plr].Center.Y / 16;
				int num3 = 0;
				int num4 = 0;
				for (int i = num - 20; i < num + 20; i++)
				{
					for (int j = num2 - 20; j < num2 + 20; j++)
					{
						if (Main.tile[i, j].active() && Main.tile[i, j].type == 237 && Main.tile[i, j].frameX == 18 && Main.tile[i, j].frameY == 0)
						{
							num3 = i;
							num4 = j;
						}
					}
				}
				if (num3 <= 0 || num4 <= 0)
				{
					return;
				}
				int num5 = num4 - 15;
				int num6 = num4 - 15;
				for (int num7 = num4; num7 > num4 - 50; num7--)
				{
					if (WorldGen.SolidTile(num3, num7))
					{
						num5 = num7;
						break;
					}
				}
				for (int k = num4; k < num4 + 50; k++)
				{
					if (WorldGen.SolidTile(num3, k))
					{
						num6 = k;
						break;
					}
				}
				num4 = (num5 + num5 + num6) / 3;
				int num8 = NewNPC(GetBossSpawnSource(plr), num3 * 16 + 8, num4 * 16, npcType);
				Main.npc[num8].target = plr;
				string typeName = Main.npc[num8].TypeName;
				if (Main.netMode == 0)
				{
					Main.NewText(Language.GetTextValue("Announcement.HasAwoken", typeName), 175, 75);
				}
				else if (Main.netMode == 2)
				{
					ChatHelper.BroadcastChatMessage(NetworkText.FromKey("Announcement.HasAwoken", Main.npc[num8].GetTypeNetName()), new Color(175, 75, 255));
				}
				return;
			}
			catch
			{
				return;
			}
		case 370:
		{
			Player player = Main.player[plr];
			if (!player.active || player.dead)
			{
				return;
			}
			for (int l = 0; l < 1000; l++)
			{
				Projectile projectile = Main.projectile[l];
				if (projectile.active && projectile.bobber && projectile.owner == plr)
				{
					int num9 = NewNPC(GetBossSpawnSource(plr), (int)projectile.Center.X, (int)projectile.Center.Y + 100, 370);
					string typeName2 = Main.npc[num9].TypeName;
					if (Main.netMode == 0)
					{
						Main.NewText(Language.GetTextValue("Announcement.HasAwoken", typeName2), 175, 75);
					}
					else if (Main.netMode == 2)
					{
						ChatHelper.BroadcastChatMessage(NetworkText.FromKey("Announcement.HasAwoken", Main.npc[num9].GetTypeNetName()), new Color(175, 75, 255));
					}
					break;
				}
			}
			return;
		}
		case 398:
			if (!AnyNPCs(npcType))
			{
				Player player2 = Main.player[plr];
				NewNPC(GetBossSpawnSource(plr), (int)player2.Center.X, (int)player2.Center.Y - 150, npcType);
				if (Main.netMode == 0)
				{
					Main.NewText(Language.GetTextValue("Announcement.HasAwoken", Language.GetTextValue("Enemies.MoonLord")), 175, 75);
				}
				else if (Main.netMode == 2)
				{
					ChatHelper.BroadcastChatMessage(NetworkText.FromKey("Announcement.HasAwoken", NetworkText.FromKey("Enemies.MoonLord")), new Color(175, 75, 255));
				}
			}
			return;
		}
		bool flag = false;
		int num10 = 0;
		int num11 = 0;
		int num12 = 500;
		int num13 = 50;
		if (npcType == 316 || npcType == 82)
		{
			num12 = 200;
			num13 = 30;
		}
		int num14 = num12 / 2;
		Spawner.GetSpawnArea(Main.player[plr], out var spawnArea, out var safeArea);
		for (int m = 0; m < num12; m++)
		{
			bool flag2 = m == num12 - 1;
			bool flag3 = false;
			if (m >= num14 && WorldGen.Skyblock.lowTiles && npcType >= 0 && NPCID.Sets.SpawnOnPlayerCanSpawnInMidairOnSkyblock[npcType])
			{
				flag3 = true;
			}
			for (int n = 0; n < num13; n++)
			{
				int num15 = Main.rand.Next(spawnArea.Left, spawnArea.Right);
				int num16 = Main.rand.Next(spawnArea.Top, spawnArea.Bottom);
				if ((Main.tile[num15, num16].nactive() && Main.tileSolid[Main.tile[num15, num16].type]) || (Main.wallHouse[Main.tile[num15, num16].wall] && m < num12 - 1) || (npcType == 50 && m < num14 && Main.tile[num16, num16].wall > 0))
				{
					continue;
				}
				for (int num17 = num16; num17 < spawnArea.Bottom; num17++)
				{
					if ((flag3 || (Main.tile[num15, num17].nactive() && Main.tileSolid[Main.tile[num15, num17].type])) && (flag2 || !safeArea.Contains(num15, num16)))
					{
						_ = Main.tile[num15, num17].type;
						num10 = num15;
						num11 = num17;
						flag = true;
						break;
					}
				}
				if (flag && npcType == 50 && m < num12 - 100)
				{
					int num18 = 20;
					if (!Collision.CanHit(new Vector2(num10, num11 - 1) * 16f, 16, 16, new Vector2(num10, num11 - 1 - num18) * 16f, 16, 16) || !Collision.CanHit(new Vector2(num10, num11 - 1 - num18) * 16f, 16, 16, Main.player[plr].Center, 0, 0))
					{
						num10 = 0;
						num11 = 0;
						flag = false;
						continue;
					}
				}
				if (flag && !flag2 && !Spawner.HasTileSpawnSpace(num10, num11))
				{
					flag = false;
				}
				if (flag)
				{
					break;
				}
			}
			if ((!flag || flag2 || Spawner.CheckNotSpawningOnScreen(num10, num11)) && flag)
			{
				break;
			}
		}
		if (flag)
		{
			int spawnPositionX = num10 * 16 + 8;
			int spawnPositionY = num11 * 16;
			SpawnBoss(spawnPositionX, spawnPositionY, npcType, plr, ai0, ai1, ai2, ai3);
		}
	}

	public static int GetAvailableAmountOfNPCsToSpawnUpToSlot(int amountWeWant, int highestNPCSlotIndexWeWillPick = 100)
	{
		if (amountWeWant <= 0)
		{
			return 0;
		}
		int num = 0;
		for (int i = 0; i < highestNPCSlotIndexWeWillPick; i++)
		{
			if (!Main.npc[i].active)
			{
				num++;
				if (num >= amountWeWant)
				{
					return amountWeWant;
				}
			}
		}
		return num;
	}

	public static IEntitySource GetBossSpawnSource(int targetPlayerIndex)
	{
		return new EntitySource_BossSpawn(Main.player[targetPlayerIndex]);
	}

	public static void SpawnBoss(int spawnPositionX, int spawnPositionY, int Type, int targetPlayerIndex, float ai0 = 0f, float ai1 = 0f, float ai2 = 0f, float ai3 = 0f)
	{
		int maxNPCs = Main.maxNPCs;
		bool flag = Type == 134 || Type == 127 || Type == 126 || Type == 125;
		if (flag)
		{
			AchievementsHelper.MechaMayhem_Clear();
		}
		if (Type == 127 && mechQueen != -1)
		{
			maxNPCs = (mechQueen = NewNPC(GetBossSpawnSource(targetPlayerIndex), spawnPositionX, spawnPositionY, Type, 100, ai0, ai1, ai2, ai3, targetPlayerIndex));
			Main.npc[mechQueen].ai[3] = mechQueen;
		}
		else
		{
			maxNPCs = NewNPC(GetBossSpawnSource(targetPlayerIndex), spawnPositionX, spawnPositionY, Type, 1, ai0, ai1, ai2, ai3, targetPlayerIndex);
		}
		if (maxNPCs == Main.maxNPCs)
		{
			return;
		}
		if (flag)
		{
			AchievementsHelper.MechaMayhem_Start();
		}
		Main.npc[maxNPCs].timeLeft *= 20;
		string typeName = Main.npc[maxNPCs].TypeName;
		if (Main.netMode == 2 && maxNPCs < Main.maxNPCs)
		{
			NetMessage.SendData(23, -1, -1, null, maxNPCs);
		}
		if (Type == 127 && mechQueen == maxNPCs)
		{
			if (Main.netMode == 0)
			{
				Main.NewText(Lang.misc[107].Value, 175, 75);
			}
			else if (Main.netMode == 2)
			{
				ChatHelper.BroadcastChatMessage(Lang.misc[107].ToNetworkText(), new Color(175, 75, 255));
			}
			return;
		}
		switch (Type)
		{
		case 125:
			if (Main.netMode == 0)
			{
				Main.NewText(Lang.misc[48].Value, 175, 75);
			}
			else if (Main.netMode == 2)
			{
				ChatHelper.BroadcastChatMessage(Lang.misc[48].ToNetworkText(), new Color(175, 75, 255));
			}
			return;
		case 50:
		case 82:
		case 126:
		case 316:
		case 398:
		case 551:
		case 662:
			return;
		}
		if (Main.netMode == 0)
		{
			Main.NewText(Language.GetTextValue("Announcement.HasAwoken", typeName), 175, 75);
		}
		else if (Main.netMode == 2)
		{
			ChatHelper.BroadcastChatMessage(NetworkText.FromKey("Announcement.HasAwoken", Main.npc[maxNPCs].GetTypeNetName()), new Color(175, 75, 255));
		}
	}

	public static void UpdateProtectedSpawnSlots()
	{
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			spawnSlotProtected[i] = Math.Max(Main.npc[i].active ? 2 : (spawnSlotProtected[i] - 1), 0);
		}
	}

	public static int NewNPC(IEntitySource source, int X, int Y, int Type, int Start = 0, float ai0 = 0f, float ai1 = 0f, float ai2 = 0f, float ai3 = 0f, int Target = 255)
	{
		if (Main.getGoodWorld && Main.rand.Next(3) != 0)
		{
			if (Type == 46)
			{
				Type = 614;
			}
			if (Type == 62)
			{
				Type = 66;
			}
		}
		int availableNPCSlot = GetAvailableNPCSlot(Type, Start);
		if (availableNPCSlot >= 0)
		{
			spawnSlotProtected[availableNPCSlot] = 2;
			NPC nPC = new NPC();
			Main.npc[availableNPCSlot] = nPC;
			nPC.whoAmI = availableNPCSlot;
			nPC.ResetForNewNPC();
			nPC.SetDefaults(Type);
			GiveTownUniqueDataToNPCsThatNeedIt(Type, availableNPCSlot);
			nPC.Bottom = new Vector2(X, Y);
			nPC.active = true;
			nPC.timeLeft = (int)((double)activeTime * 1.25);
			if (!nPC.noTileCollide)
			{
				nPC.wet = Collision.WetCollision(nPC.position, nPC.width, nPC.height);
			}
			nPC.ai[0] = ai0;
			nPC.ai[1] = ai1;
			nPC.ai[2] = ai2;
			nPC.ai[3] = ai3;
			nPC.target = Target;
			if (Main.netMode == 2)
			{
				nPC.spawnNeedsSyncing = true;
			}
			if (Type == 50)
			{
				if (Main.netMode == 0)
				{
					Main.NewText(Language.GetTextValue("Announcement.HasAwoken", nPC.TypeName), 175, 75);
				}
				else if (Main.netMode == 2)
				{
					ChatHelper.BroadcastChatMessage(NetworkText.FromKey("Announcement.HasAwoken", nPC.GetTypeNetName()), new Color(175, 75, 255));
				}
			}
			return availableNPCSlot;
		}
		return Main.maxNPCs;
	}

	private static int GetAvailableNPCSlot(int Type, int startIndex)
	{
		Type = NPCID.FromNetId(Type);
		bool num = NPCID.Sets.SearchSpawnSlotsInReverse[Type];
		if (startIndex == 0 && NPCID.Sets.CannotSpawnInSlot0[Type])
		{
			startIndex = 1;
		}
		int t = Main.maxNPCs;
		int num2 = 1;
		if (num)
		{
			t--;
			Utils.Swap(ref startIndex, ref t);
			num2 = -1;
		}
		for (int i = startIndex; i != t; i += num2)
		{
			if (!IsSpawnSlotInUse(i))
			{
				return i;
			}
		}
		for (int j = startIndex; j != t; j += num2)
		{
			if (Main.npc[j].CanBeReplacedByOtherNPCs)
			{
				return j;
			}
		}
		return -1;
	}

	private static bool IsSpawnSlotInUse(int slot)
	{
		if (!Main.npc[slot].active)
		{
			return spawnSlotProtected[slot] > 0;
		}
		return true;
	}

	private static void GiveTownUniqueDataToNPCsThatNeedIt(int Type, int nextNPC)
	{
		NPC nPC = Main.npc[nextNPC];
		if (nPC.isLikeATownNPC)
		{
			nPC.GivenName = getNewNPCName(Type);
			if (TownNPCProfiles.Instance.GetProfile(Type, out var profile))
			{
				nPC.townNpcVariationIndex = profile.RollVariation();
				nPC.GivenName = profile.GetNameForVariant(nPC);
			}
			if (ShimmeredTownNPCs[Type])
			{
				nPC.townNpcVariationIndex = 1;
			}
			nPC.needsUniqueInfoUpdate = true;
		}
	}

	public PlayerPettingInfo GetPettingInfo(Player player)
	{
		int num = ((base.Center.X > player.Center.X) ? 1 : (-1));
		int num2 = 36;
		bool isPetSmall = false;
		switch (type)
		{
		case 637:
			isPetSmall = true;
			num2 = 28;
			break;
		case 656:
			isPetSmall = true;
			num2 = 24;
			break;
		case 670:
		case 678:
		case 679:
		case 680:
		case 681:
		case 683:
			isPetSmall = true;
			num2 = 26;
			break;
		case 682:
			isPetSmall = true;
			num2 = 22;
			break;
		case 684:
			isPetSmall = true;
			num2 = 20;
			break;
		}
		return new PlayerPettingInfo(this, new Vector2(-num * num2, 0f), isPetSmall);
	}

	public static void UnlockOrExchangePet(ref bool petBoughtFlag, int npcType, string textKeyForLicense, int netMessageData)
	{
		Color color = new Color(50, 255, 130);
		if (Main.netMode == 1)
		{
			if (!petBoughtFlag || AnyNPCs(npcType))
			{
				NetMessage.SendData(61, -1, -1, null, Main.myPlayer, netMessageData);
			}
		}
		else if (!petBoughtFlag)
		{
			petBoughtFlag = true;
			ChatHelper.BroadcastChatMessage(NetworkText.FromKey(textKeyForLicense), color);
			NetMessage.TrySendData(7);
		}
		else if (RerollVariationForNPCType(npcType))
		{
			ChatHelper.BroadcastChatMessage(NetworkText.FromKey("Misc.PetExchangeSuccess"), color);
		}
		else
		{
			ChatHelper.BroadcastChatMessage(NetworkText.FromKey("Misc.PetExchangeFail"), color);
		}
	}

	public static bool RerollVariationForNPCType(int npcType)
	{
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			NPC nPC = Main.npc[i];
			if (nPC.active && nPC.type == npcType)
			{
				return nPC.RerollVariation();
			}
		}
		return false;
	}

	public bool RerollVariation()
	{
		if (!TownNPCProfiles.Instance.GetProfile(type, out var profile))
		{
			return false;
		}
		int num = townNpcVariationIndex;
		int num2 = 0;
		while (num2++ < 100 && townNpcVariationIndex == num)
		{
			townNpcVariationIndex = profile.RollVariation();
		}
		if (num == townNpcVariationIndex)
		{
			return false;
		}
		GivenName = profile.GetNameForVariant(this);
		life = lifeMax;
		if (Main.netMode != 1)
		{
			ParticleOrchestraSettings settings = new ParticleOrchestraSettings
			{
				PositionInWorld = base.Center,
				MovementVector = velocity
			};
			ParticleOrchestrator.BroadcastParticleSpawn(ParticleOrchestraType.PetExchange, settings);
		}
		NetMessage.TrySendData(56, -1, -1, null, whoAmI);
		return true;
	}

	public void TransformVisuals(int oldType, int newType)
	{
		position += netOffset;
		if ((oldType == 158 && newType == 159) || (oldType == 159 && newType == 158))
		{
			SoundEngine.PlaySound(SoundID.Item8, position);
			int num = Gore.NewGore(new Vector2(position.X, position.Y - 10f), velocity, 99, scale);
			Main.gore[num].velocity *= 0.3f;
			num = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 10f), velocity, 99, scale);
			Main.gore[num].velocity *= 0.3f;
			num = Gore.NewGore(new Vector2(position.X, position.Y + (float)height - 10f), velocity, 99, scale);
			Main.gore[num].velocity *= 0.3f;
		}
		else if (oldType == 478 && newType == 479)
		{
			for (int i = 0; i < 30; i++)
			{
				int num2 = Dust.NewDust(position, width, height, 238, 0f, -2f);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num2].noGravity = true;
				}
			}
			Gore.NewGore(position, velocity, 684, scale);
			Gore.NewGore(position, velocity, 685, scale);
			Gore.NewGore(position, velocity, 686, scale);
			Gore.NewGore(position, velocity, 684 + Main.rand.Next(3), scale);
		}
		else if (oldType == 406 && newType == 405)
		{
			float num3 = Main.rand.Next(10, 21);
			float num4 = (float)Math.PI * 2f * Main.rand.NextFloat();
			Vector2 vector = new Vector2(22f, 22f);
			for (float num5 = 0f; num5 < num3; num5 += 1f)
			{
				Dust dust = Main.dust[Dust.NewDust(base.Center, 0, 0, 229)];
				Vector2 vector2 = Vector2.UnitY.RotatedBy(num5 * ((float)Math.PI * 2f) / num3 + num4);
				dust.position = base.Center + vector2 * vector / 2f;
				dust.velocity = vector2;
				dust.noGravity = true;
				dust.scale = 0.6f + Main.rand.NextFloat() * 1.8f;
				dust.velocity *= dust.scale;
				dust.fadeIn = Main.rand.NextFloat() * 2f;
			}
		}
		if (oldType == 428 && newType == 427)
		{
			for (int j = 0; j < 20; j++)
			{
				int num6 = Utils.SelectRandom<int>(Main.rand, 229, 240);
				Dust dust2 = Main.dust[Dust.NewDust(position, width, height, num6)];
				dust2.noGravity = true;
				dust2.scale = 0.6f + Main.rand.NextFloat() * 1.8f;
				dust2.fadeIn = 0.25f;
				dust2.velocity *= dust2.scale / 2f;
			}
		}
		if (oldType == 427 && newType == 426)
		{
			for (int k = 0; k < 30; k++)
			{
				int num7 = Utils.SelectRandom<int>(Main.rand, 229, 240, 240);
				Dust dust3 = Main.dust[Dust.NewDust(position, width, height, num7)];
				dust3.noGravity = true;
				dust3.scale = 0.6f + Main.rand.NextFloat() * 1.8f;
				dust3.fadeIn = 0.25f;
				dust3.velocity *= dust3.scale * 0.75f;
			}
		}
		position -= netOffset;
	}

	public void Teleport(Vector2 newPos, int Style = 0, int extraInfo = 0)
	{
		int extraInfo2 = 0;
		if (Style == 4)
		{
			extraInfo2 = lastPortalColorIndex;
		}
		float dustCountMult = ((teleportTime > 0f) ? 0.3f : 1f);
		Vector2 otherPosition = position;
		Main.TeleportEffect(getRect(), Style, extraInfo2, dustCountMult, TeleportationSide.Entry, newPos);
		position = newPos;
		if (Style == 4)
		{
			lastPortalColorIndex = extraInfo;
			extraInfo2 = lastPortalColorIndex;
		}
		Main.TeleportEffect(getRect(), Style, extraInfo2, dustCountMult, TeleportationSide.Exit, otherPosition);
		teleportTime = 1f;
		teleportStyle = Style;
		if (Main.netMode == 2 && Style != 4)
		{
			NetMessage.SendData(65, -1, -1, null, 1, whoAmI, newPos.X, newPos.Y, Style);
		}
	}

	public bool TryMoveToTransformableSpaceInto(int targetType)
	{
		if (!ContentSamples.NpcsByNetId.TryGetValue(targetType, out var nPC))
		{
			return false;
		}
		if (!Collision.TryChangingSizeFromBottomCenter(base.Hitbox, nPC.width, nPC.height, out var changedHitbox))
		{
			return false;
		}
		position = changedHitbox.TopLeft();
		return true;
	}

	public void Transform(int newType, float ai0 = 0f, float ai1 = 0f, float ai2 = 0f, float ai3 = 0f, bool withReposition = true)
	{
		if (Main.netMode != 1)
		{
			bool num = value == 0f;
			int oldType = type;
			int num2 = life;
			int num3 = lifeMax;
			if (withReposition)
			{
				position.Y += height;
			}
			SetDefaults(newType);
			if (withReposition)
			{
				position.Y -= height;
			}
			TargetClosest();
			if (num)
			{
				value = 0f;
			}
			life = num2 * lifeMax / num3;
			if (life <= 0)
			{
				life = 1;
			}
			ai[0] = ai0;
			ai[1] = ai1;
			ai[2] = ai2;
			ai[3] = ai3;
			switch (newType)
			{
			case 107:
			case 108:
			case 124:
			case 353:
			case 369:
			case 550:
			case 588:
			case 679:
			case 680:
			case 683:
			case 684:
				UpdateHomeTileState(homeless: true, (int)(position.X + (float)(width / 2)) / 16, (int)(position.Y + (float)height) / 16);
				break;
			}
			if (Main.netMode == 2)
			{
				NetMessage.SendData(23, -1, -1, null, whoAmI);
				NetMessage.SendData(54, -1, -1, null, whoAmI);
			}
			TransformVisuals(oldType, newType);
			GiveTownUniqueDataToNPCsThatNeedIt(type, whoAmI);
			if (townNPC)
			{
				homeless = true;
				WorldGen.CheckAchievement_RealEstateAndTownSlimes();
			}
			altTexture = 0;
		}
	}

	public int checkArmorPenetration(int armorPenetration, float armorPenetrationPercent)
	{
		if (ichor)
		{
			armorPenetration += 15;
		}
		if (brokenArmor)
		{
			armorPenetration += 20;
		}
		if (betsysCurse)
		{
			armorPenetration += 40;
		}
		armorPenetration += (int)((float)defense * armorPenetrationPercent);
		if (armorPenetration <= 0 || defense <= 0)
		{
			return 0;
		}
		if (armorPenetration > defense)
		{
			return defense / 2;
		}
		return armorPenetration / 2;
	}

	public double StrikeNPCNoInteraction(int Damage, float knockBack, int hitDirection, bool crit = false, bool noEffect = false, bool fromNet = false)
	{
		if (Main.netMode == 0)
		{
			ignorePlayerInteractions++;
		}
		return StrikeNPC(Damage, knockBack, hitDirection, crit, noEffect, fromNet, 255);
	}

	public int KeyBrandStrike(int plr, int dmg, Vector2 bestSwordSpot)
	{
		float t = (float)life / (float)lifeMax;
		float lerpValue = Utils.GetLerpValue(1f, 0.1f, t, clamped: true);
		float num = 1f * lerpValue;
		dmg = (int)((float)dmg * (1f + num));
		Vector2 positionInWorld = base.Hitbox.ClosestPointInRect(bestSwordSpot);
		ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.Keybrand, new ParticleOrchestraSettings
		{
			PositionInWorld = positionInWorld
		}, plr);
		return dmg;
	}

	public double StrikeNPC(int Damage, float knockBack, int hitDirection, bool crit = false, bool noEffect = false, bool fromNet = false, int owner = -1)
	{
		if (owner < 0)
		{
			owner = Main.myPlayer;
		}
		if (Main.onlyShimmerOceanWorlds && type == 680 && GivenName == "Slimefors")
		{
			return 0.0;
		}
		bool flag = Main.netMode == 0;
		if (flag && ignorePlayerInteractions > 0)
		{
			ignorePlayerInteractions--;
			flag = false;
		}
		if (!active || life <= 0)
		{
			return 0.0;
		}
		NetUpdateLowPriority();
		double num = Damage;
		num = Main.CalculateDamageNPCsTake((int)num, defense);
		if (crit)
		{
			num *= 2.0;
		}
		if (RedHatSkeletronAdjustmentsEnabled())
		{
			num = (int)(num * 0.699999988079071);
			if (num < 1.0)
			{
				num = 1.0;
			}
		}
		if (takenDamageMultiplier > 1f)
		{
			num *= (double)takenDamageMultiplier;
		}
		if ((takenDamageMultiplier > 1f || Damage != 9999) && lifeMax > 1)
		{
			if (friendly)
			{
				Color color = (crit ? CombatText.DamagedFriendlyCrit : CombatText.DamagedFriendly);
				CombatText.NewText(new Rectangle((int)position.X, (int)position.Y, width, height), color, (int)num, crit);
			}
			else
			{
				Color color2 = (crit ? CombatText.DamagedHostileCrit : CombatText.DamagedHostile);
				if (fromNet)
				{
					color2 = (crit ? CombatText.OthersDamagedHostileCrit : CombatText.OthersDamagedHostile);
				}
				CombatText.NewText(new Rectangle((int)position.X, (int)position.Y, width, height), color2, (int)num, crit);
			}
		}
		if (num >= 1.0)
		{
			if (flag)
			{
				PlayerInteraction(Main.myPlayer);
			}
			justHit = true;
			if ((type == 438 || type == 379) && Main.netMode != 1)
			{
				int num2 = (int)(0f - ai[3] - 1f);
				if (num2 > -1 && Main.npc[num2].localAI[0] == 0f)
				{
					Main.npc[num2].localAI[0] = 1f;
				}
			}
			if (townNPC)
			{
				if (aiStyle == 7 && (ai[0] == 3f || ai[0] == 4f || ai[0] == 16f || ai[0] == 17f))
				{
					NPC nPC = Main.npc[(int)ai[2]];
					if (nPC.active)
					{
						nPC.ai[0] = 1f;
						nPC.ai[1] = 300 + Main.rand.Next(300);
						nPC.ai[2] = 0f;
						nPC.localAI[3] = 0f;
						nPC.direction = hitDirection;
						nPC.netUpdate = true;
					}
				}
				ai[0] = 1f;
				ai[1] = 300 + Main.rand.Next(300);
				ai[2] = 0f;
				localAI[3] = 0f;
				direction = hitDirection;
				netUpdate = true;
			}
			if (Main.netMode != 1 && aiStyle == 87 && ai[0] == 0f)
			{
				ai[0] = 1f;
				ai[1] = 0f;
				netUpdate = true;
			}
			if (aiStyle == 8)
			{
				if (Main.netMode != 1)
				{
					if (type == 172)
					{
						ai[0] = 450f;
					}
					else if (type == 283 || type == 284)
					{
						if (Main.rand.Next(2) == 0)
						{
							ai[0] = 390f;
							netUpdate = true;
						}
					}
					else if (type == 533)
					{
						if (Main.rand.Next(3) != 0)
						{
							ai[0] = 181f;
							netUpdate = true;
						}
					}
					else
					{
						ai[0] = 400f;
					}
					TargetClosest();
				}
				if (type == 693)
				{
					localAI[1] = localAI[0] + 250f;
					localAI[2] = 10f;
				}
			}
			if (aiStyle == 97 && Main.netMode != 1)
			{
				localAI[1] = 1f;
				TargetClosest();
			}
			if (type == 371)
			{
				num = 0.0;
				ai[0] = 1f;
				ai[1] = 4f;
				dontTakeDamage = true;
			}
			if (type == 346 && (double)life >= (double)lifeMax * 0.5 && (double)life - num < (double)lifeMax * 0.5)
			{
				Gore.NewGore(position, velocity, 517);
			}
			if (type == 184)
			{
				localAI[0] = 60f;
			}
			if (type == 535)
			{
				localAI[0] = 60f;
			}
			if (type == 185)
			{
				localAI[0] = 1f;
			}
			if (!immortal)
			{
				bool flag2 = Damage >= 9999 && owner == 255;
				if (Main.netMode != 1 && !flag2)
				{
					NPCDamageTracker.AddDamage(this, owner, (int)num);
				}
				if (realLife >= 0)
				{
					Main.npc[realLife].life -= (int)num;
					life = Main.npc[realLife].life;
					lifeMax = Main.npc[realLife].lifeMax;
				}
				else
				{
					life -= (int)num;
				}
			}
			if (knockBack > 0f && knockBackResist > 0f)
			{
				float num3 = knockBack * knockBackResist;
				if (onFire2)
				{
					num3 *= 1.1f;
				}
				if (num3 > 8f)
				{
					float num4 = num3 - 8f;
					num4 *= 0.9f;
					num3 = 8f + num4;
				}
				if (num3 > 10f)
				{
					float num5 = num3 - 10f;
					num5 *= 0.8f;
					num3 = 10f + num5;
				}
				if (num3 > 12f)
				{
					float num6 = num3 - 12f;
					num6 *= 0.7f;
					num3 = 12f + num6;
				}
				if (num3 > 14f)
				{
					float num7 = num3 - 14f;
					num7 *= 0.6f;
					num3 = 14f + num7;
				}
				if (num3 > 16f)
				{
					num3 = 16f;
				}
				if (crit)
				{
					num3 *= 1.4f;
				}
				int num8 = (int)num * 10;
				if (Main.expertMode)
				{
					num8 = (int)num * 15;
				}
				if (num8 > lifeMax)
				{
					if (hitDirection < 0 && velocity.X > 0f - num3)
					{
						if (velocity.X > 0f)
						{
							velocity.X -= num3;
						}
						velocity.X -= num3;
						if (velocity.X < 0f - num3)
						{
							velocity.X = 0f - num3;
						}
					}
					else if (hitDirection > 0 && velocity.X < num3)
					{
						if (velocity.X < 0f)
						{
							velocity.X += num3;
						}
						velocity.X += num3;
						if (velocity.X > num3)
						{
							velocity.X = num3;
						}
					}
					if (type == 185)
					{
						num3 *= 1.5f;
					}
					num3 = (noGravity ? (num3 * -0.5f) : (num3 * -0.75f));
					if (velocity.Y > num3)
					{
						velocity.Y += num3;
						if (velocity.Y < num3)
						{
							velocity.Y = num3;
						}
					}
				}
				else
				{
					if (!noGravity)
					{
						velocity.Y = (0f - num3) * 0.75f * knockBackResist;
					}
					else
					{
						velocity.Y = (0f - num3) * 0.5f * knockBackResist;
					}
					velocity.X = num3 * (float)hitDirection * knockBackResist;
				}
			}
			if ((type == 113 || type == 114) && life <= 0)
			{
				for (int i = 0; i < Main.maxNPCs; i++)
				{
					if (Main.npc[i].active && (Main.npc[i].type == 113 || Main.npc[i].type == 114))
					{
						Main.npc[i].HitEffect(hitDirection, num);
					}
				}
			}
			else
			{
				HitEffect(hitDirection, num);
			}
			if (type == 1)
			{
				switch ((int)ai[1])
				{
				case 5507:
					SoundEngine.PlaySound(SoundID.BalloonHurt, position);
					break;
				case 5502:
					SoundEngine.PlaySound(SoundID.CatHurt, position);
					break;
				case 5485:
					if (Main.rand.Next(5) == 0)
					{
						SoundEngine.PlaySound(SoundID.ChickenHurtRare, position);
					}
					else
					{
						SoundEngine.PlaySound(SoundID.ChickenHurt, position);
					}
					break;
				case 5484:
					SoundEngine.PlaySound(SoundID.BellHurt, position);
					break;
				case 5506:
					SoundEngine.PlaySound(SoundID.CrowHurt, position);
					break;
				case 5503:
					SoundEngine.PlaySound(SoundID.DogHurt, position);
					break;
				case 5534:
					SoundEngine.PlaySound(SoundID.FairyHurt, position);
					break;
				case 5499:
					SoundEngine.PlaySound(SoundID.FrogHurt, position);
					break;
				case 5500:
					SoundEngine.PlaySound(SoundID.GoatHurt, position);
					break;
				case 5505:
					SoundEngine.PlaySound(SoundID.GoblinHurt, position);
					break;
				case 5501:
					SoundEngine.PlaySound(SoundID.RetroHurt, position);
					break;
				case 5504:
					SoundEngine.PlaySound(SoundID.TurkeyHurt, position);
					break;
				case 5508:
					SoundEngine.PlaySound(SoundID.UndeadHurt, position);
					break;
				case 5509:
					SoundEngine.PlaySound(SoundID.VampireHurt, position);
					break;
				default:
					if (HitSound != null)
					{
						SoundEngine.PlaySound(HitSound, position);
					}
					break;
				}
			}
			else if (HitSound != null)
			{
				SoundEngine.PlaySound(HitSound, position);
			}
			if (realLife >= 0)
			{
				Main.npc[realLife].checkDead();
			}
			else
			{
				checkDead();
			}
			return num;
		}
		return 0.0;
	}

	public static void LadyBugKilled(Vector2 Position, bool GoldLadyBug = false)
	{
		Main.ladyBugRainBoost += ladyBugRainTime;
		if (Main.ladyBugRainBoost > maximumAmountOfTimesLadyBugRainCanStack)
		{
			Main.ladyBugRainBoost = maximumAmountOfTimesLadyBugRainCanStack;
		}
		int myPlayer = Main.myPlayer;
		if (!Main.player[myPlayer].active || Main.player[myPlayer].dead)
		{
			return;
		}
		Vector2 vector = Position - Main.player[myPlayer].Center;
		int num = 400;
		if (vector.Length() < (float)num)
		{
			if (vector.Length() < 100f)
			{
				vector = default(Vector2);
			}
			double num2 = 1.0 - (double)vector.Length() / (double)num;
			int num3 = (int)((double)ladyBugBadLuckTime * num2);
			if (GoldLadyBug)
			{
				num3 *= 2;
			}
			if (num3 < Main.player[myPlayer].ladyBugLuckTimeLeft)
			{
				Main.player[myPlayer].ladyBugLuckTimeLeft = num3;
				Main.player[myPlayer].luckNeedsSync = true;
			}
		}
	}

	private void LadyBugLuck(int plr, bool GoldLadyBug = false)
	{
		if (releaseOwner != 255 || Main.player[plr].ladyBugLuckTimeLeft < 0)
		{
			return;
		}
		Vector2 vector = base.Center - Main.player[plr].Center;
		int num = 800;
		if (vector.Length() < (float)num)
		{
			if (vector.Length() < 30f)
			{
				vector = default(Vector2);
			}
			double x = 1.0 - (double)vector.Length() / (double)num;
			x = Math.Pow(x, 6.0);
			int num2 = (int)((double)ladyBugGoodLuckTime * x);
			if (GoldLadyBug)
			{
				num2 *= 2;
			}
			if (num2 > Main.player[plr].ladyBugLuckTimeLeft)
			{
				Main.player[plr].ladyBugLuckTimeLeft = num2;
				Main.player[plr].luckNeedsSync = true;
			}
		}
	}

	private void NPCLuck()
	{
		int myPlayer = Main.myPlayer;
		if (type == 22)
		{
			if (Main.player[myPlayer].ladyBugLuckTimeLeft >= 0 && Main.player[myPlayer].active && !Main.player[myPlayer].dead)
			{
				int num = ladyBugGoodLuckTime / 3;
				if (num > Main.player[myPlayer].ladyBugLuckTimeLeft)
				{
					Main.player[myPlayer].ladyBugLuckTimeLeft = num;
					Main.player[myPlayer].luckNeedsSync = true;
				}
			}
		}
		else if (type != 54 && Main.player[myPlayer].active && !Main.player[myPlayer].dead)
		{
			int num2 = ladyBugBadLuckTime / 3;
			if (num2 < Main.player[myPlayer].ladyBugLuckTimeLeft)
			{
				Main.player[myPlayer].ladyBugLuckTimeLeft = num2;
				Main.player[myPlayer].luckNeedsSync = true;
			}
		}
	}

	public void HitEffect(int hitDirection = 0, double dmg = 10.0)
	{
		if (!active)
		{
			return;
		}
		if (townNPC && life <= 0 && UsesPartyHat())
		{
			bool isShimmerVariant = IsShimmerVariant;
			bool flag = true;
			switch (type)
			{
			case 38:
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1298 : 927);
				break;
			case 207:
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1305 : 928);
				break;
			case 17:
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1321 : 929);
				break;
			case 18:
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1325 : 930);
				break;
			case 227:
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1331 : 931);
				break;
			case 229:
				if (!IsShimmerVariant)
				{
					Gore.NewGore(position, velocity, 932);
				}
				break;
			case 142:
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1339 : 933);
				break;
			case 453:
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1343 : 934);
				break;
			case 178:
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1348 : 935);
				break;
			case 353:
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1351 : 936);
				break;
			case 368:
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1363 : 937);
				break;
			case 108:
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1373 : 938);
				break;
			case 588:
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1311 : 1112);
				break;
			}
			if (flag)
			{
				int num = 926;
				switch (GetPartyHatColor())
				{
				case PartyHatColor.Cyan:
					num = 940;
					break;
				case PartyHatColor.Pink:
					num = 939;
					break;
				case PartyHatColor.Purple:
					num = 941;
					break;
				case PartyHatColor.White:
					num = 942;
					break;
				}
				Gore.NewGore(position, velocity, num);
			}
		}
		if (daybreak && life <= 0)
		{
			Rectangle hitbox = base.Hitbox;
			for (int i = 0; i < 20; i++)
			{
				int num2 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
				int num3 = Dust.NewDust(hitbox.TopLeft(), width, height, num2, 0f, -2.5f);
				Main.dust[num3].alpha = 200;
				Dust dust = Main.dust[num3];
				dust.velocity *= 1.4f;
				dust = Main.dust[num3];
				dust.scale += Main.rand.NextFloat();
			}
			if (Main.netMode != 1)
			{
				for (int j = 0; j < Main.maxNPCs; j++)
				{
					NPC nPC = Main.npc[j];
					if (nPC.active && !nPC.buffImmune[189] && Distance(nPC.Center) < 100f && !nPC.dontTakeDamage && nPC.lifeMax > 5 && !nPC.friendly && !nPC.townNPC)
					{
						nPC.AddBuff(189, 300);
					}
				}
			}
		}
		if (type == 686 && life <= 0)
		{
			int num4 = 1143;
			Vector2 vector = base.Bottom + (-Vector2.UnitY * 50f).RotatedBy(rotation);
			for (int k = 0; k < 3; k++)
			{
				Vector2 vector2 = vector + Main.rand.NextVector2Circular(15f, 15f);
				Gore gore = Gore.NewGorePerfect(vector2, Main.rand.NextVector2Circular(2f, 2f), num4 + Main.rand.Next(3));
				gore.velocity.Y -= Main.rand.NextFloat();
				Gore gore2 = gore;
				gore2.velocity *= 4f;
			}
			for (int l = 0; l < 1; l++)
			{
				Vector2 vector3 = base.Bottom + (-Vector2.UnitY * 50f).RotatedBy(rotation) + Main.rand.NextVector2Circular(5f, 5f);
				Gore gore3 = Gore.NewGorePerfect(vector3, Main.rand.NextVector2Circular(2f, 2f), 1146);
				gore3.velocity.Y -= Main.rand.NextFloat();
				Gore gore2 = gore3;
				gore2.velocity *= 4f;
			}
			if (Main.netMode != 1)
			{
				position = base.Bottom + new Vector2(0f, 48f);
				Transform(680);
				if (!unlockedSlimePurpleSpawn)
				{
					unlockedSlimePurpleSpawn = true;
					if (Main.netMode == 2)
					{
						NetMessage.SendData(7);
					}
				}
			}
		}
		if (type == 690)
		{
			for (int m = 0; m < 10; m++)
			{
				Dust.NewDust(position, width, height, 1, hitDirection, -1f, 0, default(Color), 1.2f);
			}
		}
		if (type == 594 && life <= 0)
		{
			int num5 = 1125;
			num5 += (int)(ai[2] - 1f) * 3;
			Vector2 vector4 = base.Bottom + (-Vector2.UnitY * 50f).RotatedBy(rotation);
			for (int n = 0; n < 3; n++)
			{
				Vector2 vector5 = vector4 + Main.rand.NextVector2Circular(15f, 15f);
				Gore gore4 = Gore.NewGorePerfect(vector5, Main.rand.NextVector2Circular(2f, 2f), num5 + Main.rand.Next(3));
				gore4.velocity.Y -= Main.rand.NextFloat();
				Gore gore2 = gore4;
				gore2.velocity *= 4f;
			}
			for (int num6 = 0; num6 < 1; num6++)
			{
				Vector2 vector6 = base.Bottom + (-Vector2.UnitY * 50f).RotatedBy(rotation) + Main.rand.NextVector2Circular(5f, 5f);
				Gore gore5 = Gore.NewGorePerfect(vector6, Main.rand.NextVector2Circular(2f, 2f), 1146);
				gore5.velocity.Y -= Main.rand.NextFloat();
				Gore gore2 = gore5;
				gore2.velocity *= 4f;
			}
			NPC nPC2 = AI_113_WindyBalloon_GetSlaveNPC();
			if (nPC2 != null)
			{
				nPC2.ai[0] = 0f;
				nPC2.position.Y -= 10f;
				nPC2.netUpdate = true;
			}
		}
		if (type == 661)
		{
			if (life > 0)
			{
				for (int num7 = 0; (double)num7 < dmg / (double)lifeMax * 100.0; num7++)
				{
					if (Main.rand.Next(5) == 0)
					{
						int num8 = 1;
						Color newColor = Main.hslToRgb((float)num7 / 100f % 1f, 1f, 0.5f) * 0.5f;
						int num9 = Dust.NewDust(position, width, height, 267, 0f, 0f, 0, newColor);
						Main.dust[num9].position = base.Center + Main.rand.NextVector2Circular(width, height);
						Main.dust[num9].velocity = Main.dust[num9].position - base.Center;
						Main.dust[num9].noGravity = true;
						Main.dust[num9].fadeIn = 0.6f + Main.rand.NextFloat() * 0.7f * (float)num8;
						Main.dust[num9].scale = 0.35f;
						if (num9 != 6000)
						{
							Dust dust2 = Dust.CloneDust(num9);
							Dust dust = dust2;
							dust.scale /= 2f;
							dust = dust2;
							dust.fadeIn *= 0.85f;
							dust2.color = new Color(255, 255, 255, 255) * 0.5f;
						}
					}
				}
			}
			else
			{
				for (int num10 = 0; (float)num10 < 100f; num10++)
				{
					if (Main.rand.Next(5) == 0)
					{
						int num11 = 1;
						Color newColor2 = Main.hslToRgb((float)num10 / 100f % 1f, 1f, 0.5f) * 0.5f;
						int num12 = Dust.NewDust(position, width, height, 267, 0f, 0f, 0, newColor2);
						Main.dust[num12].position = base.Center + Main.rand.NextVector2Circular(width, height);
						Main.dust[num12].velocity = (Main.dust[num12].position - base.Center) * 0.6f;
						Main.dust[num12].noGravity = true;
						Main.dust[num12].fadeIn = 0.7f + Main.rand.NextFloat() * 1.1f * (float)num11;
						Main.dust[num12].scale = 0.35f;
						if (num12 != 6000)
						{
							Dust dust3 = Dust.CloneDust(num12);
							Dust dust = dust3;
							dust.scale /= 2f;
							dust = dust3;
							dust.fadeIn *= 0.85f;
							dust3.color = new Color(255, 255, 255, 255) * 0.5f;
						}
					}
				}
			}
		}
		if (type == 521)
		{
			if (life > 0)
			{
				for (int num13 = 0; (double)num13 < dmg / (double)lifeMax * 200.0; num13++)
				{
					Dust dust4 = Dust.NewDustDirect(position, width, height, 228, 6 * hitDirection, velocity.Y, 0, Color.Transparent, 3f);
					dust4.noGravity = true;
					Dust dust = dust4;
					dust.velocity *= 5f;
				}
			}
			else
			{
				for (int num14 = 0; (float)num14 < 200f; num14++)
				{
					Dust dust5 = Dust.NewDustDirect(position, width, height, 228, 6 * hitDirection, velocity.Y, 0, Color.Transparent, 3f);
					dust5.noGravity = true;
					Dust dust = dust5;
					dust.velocity *= 5f;
				}
			}
		}
		if (type == 668)
		{
			if (life > 0)
			{
				for (int num15 = 0; (double)num15 < dmg / (double)lifeMax * 100.0; num15++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f, 0, default(Color), 1.2f);
				}
			}
			else
			{
				int num16 = 15;
				Vector2 vector7 = position - new Vector2(num16, num16);
				for (int num17 = 0; num17 < 120; num17++)
				{
					int num18 = Dust.NewDust(vector7, width + num16 * 2, height + num16 * 2, 5, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num18].velocity = Main.rand.NextVector2Circular(4f, 4f);
				}
				Vector2 vector8 = velocity * 0.6f;
				Gore.NewGore(base.Bottom + new Vector2(-10f, 0f), vector8, 1274, scale);
				Gore.NewGore(base.Bottom + new Vector2(10f, 0f), vector8, 1274, scale);
				Gore.NewGore(base.Center, vector8, 1272, scale);
				Gore.NewGore(base.Center + new Vector2(-10f, 0f), vector8, 1273, scale);
				Gore.NewGore(base.Center + new Vector2(10f, 0f), vector8, 1273, scale);
				Gore.NewGore(base.Top, vector8, 1270, scale);
				Gore.NewGore(base.Top, vector8, 1271, scale);
			}
		}
		if (type == 636)
		{
			if (life > 0)
			{
				for (int num19 = 0; (double)num19 < dmg / (double)lifeMax * 100.0; num19++)
				{
					if (Main.rand.Next(2) == 0)
					{
						Dust.NewDust(position, width, height, 67, hitDirection, -1f);
					}
					else
					{
						Dust.NewDust(position, width, height, 69, hitDirection, -1f);
					}
				}
			}
			else
			{
				for (int num20 = 0; num20 < 50; num20++)
				{
					if (Main.rand.Next(2) == 0)
					{
						Dust.NewDust(position, width, height, 67, hitDirection, -1f);
					}
					else
					{
						Dust.NewDust(position, width, height, 69, 2 * hitDirection, -1f);
					}
				}
				Vector2 vector9 = velocity * 0.6f;
				Gore.NewGore(position + new Vector2(10f, -20f), vector9, 1262, scale);
				Gore.NewGore(position + new Vector2(10f, 40f), vector9, 1263, scale);
				Gore.NewGore(position + new Vector2(50f, 20f), vector9, 1264, scale);
				Gore.NewGore(position + new Vector2(-10f, -20f), vector9, 1265, scale);
				Gore.NewGore(position, vector9, 1266, scale);
				Gore.NewGore(position + new Vector2(-20f, -20f), vector9, 1267, scale);
				Gore.NewGore(position + new Vector2(-20f, 10f), vector9, 1268, scale);
				Gore.NewGore(position + new Vector2(60f, -20f), vector9, 1267, scale);
				Gore.NewGore(position + new Vector2(60f, 10f), vector9, 1268, scale);
			}
		}
		if (type == 657)
		{
			if (life <= 0)
			{
				Gore.NewGore(position, velocity, 1259, 0.8f);
				Gore.NewGore(position + base.Size * 0.5f, velocity, 1259, 0.8f);
				Gore.NewGore(position, velocity, 1258, scale);
				int num21 = 10;
				for (int num22 = 0; num22 < 150; num22++)
				{
					Color newColor3 = AI_121_QueenSlime_GetDustColor();
					newColor3.A = 200;
					int num23 = Dust.NewDust(position - new Vector2(num21, num21), width + num21 * 2, height + num21 * 2, 4, 8f * Main.rand.NextFloatDirection(), -2f + 6f * Main.rand.NextFloatDirection(), 50, newColor3, 1f + Main.rand.NextFloat() * 0.5f);
					Dust dust = Main.dust[num23];
					dust.velocity *= 0.65f;
					dust = Main.dust[num23];
					dust.velocity += velocity * 0.5f;
					if (Main.rand.Next(5) == 0)
					{
						Main.dust[num23].noGravity = true;
						dust = Main.dust[num23];
						dust.scale *= 1.2f;
					}
				}
			}
			else
			{
				for (int num24 = 0; num24 < 12; num24++)
				{
					Color newColor4 = AI_121_QueenSlime_GetDustColor();
					newColor4.A = 150;
					int num25 = Dust.NewDust(position, width, height, 4, 2 * hitDirection, -1f, 50, newColor4);
					Dust dust = Main.dust[num25];
					dust.velocity *= 0.3f;
					dust = Main.dust[num25];
					dust.velocity += velocity * 0.3f;
					if (Main.rand.Next(3) == 0)
					{
						Main.dust[num25].noGravity = true;
						dust = Main.dust[num25];
						dust.scale *= 1.2f;
					}
				}
			}
		}
		if (type >= 658 && type <= 660)
		{
			int num26 = 7;
			float num27 = 1f;
			int num28 = 4;
			Color newColor5 = new Color(78, 136, 255, 150);
			if (type == 659)
			{
				num28 = 243;
				newColor5 = default(Color);
			}
			if (type == 660)
			{
				newColor5 = new Color(150, 100, 200, 150);
			}
			if (life <= 0)
			{
				num27 = 1.5f;
				num26 = 40;
				if (type == 660)
				{
					Gore.NewGore(position, velocity, 1260, scale);
					Gore.NewGore(position, velocity, 1260, scale);
				}
			}
			for (int num29 = 0; num29 < num26; num29++)
			{
				int num30 = Dust.NewDust(position, width, height, num28, 2 * hitDirection, -1f, 80, newColor5, num27);
				if (Main.rand.Next(3) != 0)
				{
					Main.dust[num30].noGravity = true;
				}
			}
		}
		if (type == 667)
		{
			int num31 = 7;
			float num32 = 1.1f;
			int num33 = 10;
			Color newColor6 = default(Color);
			if (life <= 0)
			{
				num32 = 1.5f;
				num31 = 40;
				for (int num34 = 0; num34 < 8; num34++)
				{
					int num35 = Gore.NewGore(new Vector2(position.X, base.Center.Y - 10f), Vector2.Zero, 1218);
					Main.gore[num35].velocity = new Vector2((float)Main.rand.Next(1, 10) * 0.3f * 2.5f * (float)hitDirection, 0f - (3f + (float)Main.rand.Next(4) * 0.3f));
				}
			}
			else
			{
				for (int num36 = 0; num36 < 3; num36++)
				{
					int num37 = Gore.NewGore(new Vector2(position.X, base.Center.Y - 10f), Vector2.Zero, 1218);
					Main.gore[num37].velocity = new Vector2((float)Main.rand.Next(1, 10) * 0.3f * 2f * (float)hitDirection, 0f - (2.5f + (float)Main.rand.Next(4) * 0.3f));
				}
			}
			for (int num38 = 0; num38 < num31; num38++)
			{
				int num39 = Dust.NewDust(position, width, height, num33, 2 * hitDirection, -1f, 80, newColor6, num32);
				if (Main.rand.Next(3) != 0)
				{
					Main.dust[num39].noGravity = true;
				}
			}
		}
		if (type == 676)
		{
			int num40 = 8;
			float num41 = 1.1f;
			short num42 = 310;
			if (life <= 0)
			{
				num41 = 1.5f;
				num40 = 40;
			}
			for (int num43 = 0; num43 < num40; num43++)
			{
				Dust dust6 = Main.dust[Dust.NewDust(position, width, height, num42, 2 * hitDirection, -1f, 80, default(Color), num41)];
				if (Main.rand.Next(3) != 0)
				{
					dust6.noGravity = true;
				}
				Dust dust = dust6;
				dust.velocity *= 1.5f;
				dust = dust6;
				dust.velocity += velocity * 0.1f;
			}
		}
		if (type == 552 || type == 553 || type == 554)
		{
			if (life > 0)
			{
				for (int num44 = 0; (double)num44 < dmg / (double)lifeMax * 20.0; num44++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num45 = 0; (float)num45 < 20f; num45++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
				int num46 = 983;
				if (type == 553)
				{
					num46 = 1067;
				}
				else if (type == 554)
				{
					num46 = 1071;
				}
				Gore.NewGore(position, velocity, num46, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num46 + 3, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num46 + 2, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, num46 + 1, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, num46 + 1, scale);
			}
		}
		else if (type == 561 || type == 562 || type == 563)
		{
			if (life > 0)
			{
				for (int num47 = 0; (double)num47 < dmg / (double)lifeMax * 20.0; num47++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num48 = 0; (float)num48 < 20f; num48++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
				int num49 = 987;
				if (type == 562)
				{
					num49 = 1055;
				}
				else if (type == 563)
				{
					num49 = 1061;
				}
				Gore.NewGore(position, velocity, num49 + 3, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num49, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num49 + 4, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num49 + 5, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num49 + 2, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, num49 + 1, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, num49 + 1, scale);
			}
		}
		else if (type == 555 || type == 556 || type == 557)
		{
			if (life > 0)
			{
				for (int num50 = 0; (double)num50 < dmg / (double)lifeMax * 20.0; num50++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				int num51 = 1031;
				if (type == 556)
				{
					num51 = 1034;
				}
				if (type == 557)
				{
					num51 = 1037;
				}
				for (int num52 = 0; (float)num52 < 20f; num52++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
				Gore.NewGore(new Vector2(position.X, position.Y), velocity, num51, scale);
				Gore.NewGore(new Vector2(position.X + 10f, position.Y + 20f), velocity, num51 + 1, scale);
				Gore.NewGore(new Vector2(position.X + 10f, position.Y + 30f), velocity, num51 + 2, scale);
			}
		}
		else if (type == 551)
		{
			int num53 = (int)((float)life / (float)lifeMax * 100f);
			int num54 = (int)(((double)life + dmg) / (double)(float)lifeMax * 100.0);
			if (num53 != num54 && life > 0 && Main.netMode != 1)
			{
				DD2Event.CheckProgress(type);
			}
			if (life > 0)
			{
				for (int num55 = 0; (double)num55 < dmg / (double)lifeMax * 20.0; num55++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num56 = 0; (float)num56 < 20f; num56++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
				if (spriteDirection != -1)
				{
					Gore.NewGore(position + new Vector2(0f, 54f), velocity, 1079, scale);
					Gore.NewGore(position + new Vector2(72f, 90f), velocity, 1080, scale);
					Gore.NewGore(position + new Vector2(102f, 94f), velocity, 1080, scale);
					Gore.NewGore(position + new Vector2(178f, 0f), velocity, 1081, scale);
					Gore.NewGore(position + new Vector2(136f, 12f), velocity, 1082, scale);
					Gore.NewGore(position + new Vector2(82f, 18f), velocity, 1083, scale);
					Gore.NewGore(position + new Vector2(100f, 26f), velocity, 1084, scale);
					Gore.NewGore(position + new Vector2(170f, 16f), velocity, 1085, scale);
					Gore.NewGore(position + new Vector2(190f, 10f), velocity, 1085, scale);
					Gore.NewGore(position + new Vector2(100f, 36f), velocity, 1086, scale);
				}
				else
				{
					Gore.NewGore(position + new Vector2(176f, 54f), velocity, 1079, scale);
					Gore.NewGore(position + new Vector2(158f, 90f), velocity, 1080, scale);
					Gore.NewGore(position + new Vector2(128f, 94f), velocity, 1080, scale);
					Gore.NewGore(position + new Vector2(0f, 0f), velocity, 1081, scale);
					Gore.NewGore(position + new Vector2(60f, 12f), velocity, 1082, scale);
					Gore.NewGore(position + new Vector2(88f, 18f), velocity, 1083, scale);
					Gore.NewGore(position + new Vector2(86f, 26f), velocity, 1084, scale);
					Gore.NewGore(position + new Vector2(40f, 16f), velocity, 1085, scale);
					Gore.NewGore(position + new Vector2(20f, 10f), velocity, 1085, scale);
					Gore.NewGore(position + new Vector2(142f, 36f), velocity, 1086, scale);
				}
			}
		}
		else if (type == 572 || type == 573)
		{
			if (life > 0)
			{
				for (int num57 = 0; (double)num57 < dmg / (double)lifeMax * 20.0; num57++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[0]))?.Stop();
				SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]))?.Stop();
				for (int num58 = 0; (float)num58 < 20f; num58++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
				Vector2 vector10 = base.Center - new Vector2(10f, 10f);
				Gore.NewGore(vector10, velocity, 993, scale);
				Gore.NewGore(new Vector2(vector10.X, vector10.Y + 20f), velocity, 996, scale);
				Gore.NewGore(new Vector2(vector10.X, vector10.Y + 20f), velocity, 995, scale);
				Gore.NewGore(new Vector2(vector10.X, vector10.Y + 34f), velocity, 994, scale);
				Gore.NewGore(new Vector2(vector10.X, vector10.Y + 34f), velocity, 994, scale);
			}
		}
		else if (type == 574 || type == 575)
		{
			if (life > 0)
			{
				for (int num59 = 0; (double)num59 < dmg / (double)lifeMax * 20.0; num59++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2]))?.Stop();
				for (int num60 = 0; (float)num60 < 20f; num60++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
				int num61 = 1050;
				Vector2 vector11 = base.Center - new Vector2(30f, 10f);
				Gore.NewGore(new Vector2(vector11.X, vector11.Y + 10f), velocity, num61, scale);
				Gore.NewGore(new Vector2(vector11.X, vector11.Y + 30f), velocity, num61 + 1, scale);
				Gore.NewGore(new Vector2(vector11.X, vector11.Y + 30f), velocity, num61 + 2, scale);
				Gore.NewGore(new Vector2(vector11.X, vector11.Y + 0f), velocity, num61 + 3, scale);
				Gore.NewGore(new Vector2(vector11.X, vector11.Y + 0f), velocity, num61 + 4, scale);
			}
		}
		else if (type == 570 || type == 571)
		{
			if (life > 0)
			{
				for (int num62 = 0; (double)num62 < dmg / (double)lifeMax * 20.0; num62++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num63 = 0; (float)num63 < 20f; num63++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
				int num64 = ((type == 570) ? 1075 : 979);
				Gore.NewGore(position, velocity, num64, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num64 + 2, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num64 + 2, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num64 + 3, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, num64 + 1, scale);
			}
		}
		else if (type == 568 || type == 569)
		{
			if (life > 0)
			{
				for (int num65 = 0; (double)num65 < dmg / (double)lifeMax * 20.0; num65++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num66 = 0; (float)num66 < 20f; num66++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
				Gore.NewGore(position, velocity, 1020, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 1021, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 1023, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 1022, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 1022, scale);
			}
		}
		else if (type == 558 || type == 559 || type == 560)
		{
			if (life > 0)
			{
				for (int num67 = 0; (double)num67 < dmg / (double)lifeMax * 20.0; num67++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num68 = 0; (float)num68 < 20f; num68++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
				int num69 = 974;
				if (type == 559)
				{
					num69 = 1040;
				}
				if (type == 560)
				{
					num69 = 1045;
				}
				Gore.NewGore(position, velocity, num69 + 2, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 10f), velocity, num69, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 10f), velocity, num69, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 10f), velocity, num69 + 4, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 24f), velocity, num69 + 1, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 24f), velocity, num69 + 3, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 24f), velocity, num69 + 3, scale);
			}
		}
		else if (type == 566 || type == 567)
		{
			if (life > 0)
			{
				for (int num70 = 0; (double)num70 < dmg / (double)lifeMax * 20.0; num70++)
				{
					Dust.NewDust(position, width, height, 236, hitDirection, -1f);
				}
			}
			else
			{
				for (int num71 = 0; (float)num71 < 20f; num71++)
				{
					Dust.NewDust(position, width, height, 236, hitDirection, -1f);
				}
				Gore.NewGore(position, velocity, 970, scale);
				if (Main.rand.Next(2) == 0)
				{
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 972, scale);
				}
				if (Main.rand.Next(2) == 0)
				{
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 972, scale);
				}
				if (Main.rand.Next(2) == 0)
				{
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 973, scale);
				}
				if (Main.rand.Next(2) == 0)
				{
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 973, scale);
				}
				if (Main.rand.Next(2) == 0)
				{
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 971, scale);
				}
				if (Main.rand.Next(2) == 0)
				{
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 971, scale);
				}
			}
		}
		else if (type == 576 || type == 577)
		{
			if (life > 0)
			{
				for (int num72 = 0; (double)num72 < dmg / (double)lifeMax * 20.0; num72++)
				{
					Dust.NewDust(position, width, height, 273, hitDirection, -1f);
				}
			}
			else
			{
				for (int num73 = 0; (float)num73 < 20f; num73++)
				{
					Dust.NewDust(position, width, height, 273, hitDirection, -1f);
				}
				if (spriteDirection == -1)
				{
					Gore.NewGore(position + new Vector2(0f, 0f), velocity, 1005 + ((Main.rand.Next(5) == 0) ? 1 : 0), scale);
					Gore.NewGore(position + new Vector2(18f, 28f), velocity, 1000, scale);
					int num74 = Gore.NewGore(position + new Vector2(-40f, 70f), velocity, 1001, scale);
					Main.gore[num74].rotation = (float)Math.PI;
					num74 = Gore.NewGore(position + new Vector2(4f, 28f), velocity, 1002, scale);
					Main.gore[num74].rotation = (float)Math.PI;
					Gore.NewGore(position + new Vector2(36f, 90f), velocity, 1003, scale);
					Gore.NewGore(position + new Vector2(32f, 90f), velocity, 1004, scale);
				}
				else
				{
					Gore.NewGore(position + new Vector2(48f, 0f), velocity, 1005 + ((Main.rand.Next(5) == 0) ? 1 : 0), scale);
					Gore.NewGore(position + new Vector2(22f, 28f), velocity, 1000, scale);
					Gore.NewGore(position + new Vector2(48f, 70f), velocity, 1001, scale);
					Gore.NewGore(position + new Vector2(4f, 28f), velocity, 1002, scale);
					Gore.NewGore(position + new Vector2(36f, 90f), velocity, 1003, scale);
					Gore.NewGore(position + new Vector2(32f, 90f), velocity, 1004, scale);
				}
			}
		}
		else if (type == 564 || type == 565)
		{
			if (life > 0)
			{
				for (int num75 = 0; (double)num75 < dmg / (double)lifeMax * 20.0; num75++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num76 = 0; (float)num76 < 20f; num76++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
				int num77 = 1009;
				Gore.NewGore(new Vector2(position.X, position.Y), velocity, num77, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 15f), velocity, num77 + 1, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 15f), velocity, num77 + 2, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 15f), velocity, num77 + 3, scale);
				Gore.NewGore(new Vector2(position.X - 20f, position.Y + 35f), velocity, num77 + 4, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 35f), velocity, num77 + 5, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 35f), velocity, num77 + 6, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 35f), velocity, num77 + 10, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 25f), velocity, num77 + 7, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 25f), velocity, num77 + 8, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 25f), velocity, num77 + 9, scale);
			}
		}
		else if (type == 578)
		{
			if (life > 0)
			{
				for (int num78 = 0; (double)num78 < dmg / (double)lifeMax * 20.0; num78++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num79 = 0; (float)num79 < 20f; num79++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
				Gore.NewGore(position, velocity, 999, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 10f), velocity, 998, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 10f), velocity, 998, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 10f), velocity, 997, scale);
			}
		}
		else if (type == 620)
		{
			if (life > 0)
			{
				for (int num80 = 0; (double)num80 < dmg / (double)lifeMax * 150.0; num80++)
				{
					Dust dust7 = Dust.NewDustDirect(position, width, height, 5, hitDirection, -1f);
					Dust dust = dust7;
					dust.velocity *= 2.5f;
					dust7.scale = 1.7f;
				}
			}
			else
			{
				for (int num81 = 0; (float)num81 < 150f; num81++)
				{
					Dust dust8 = Dust.NewDustDirect(position, width, height, 5, hitDirection, -1f);
					Dust dust = dust8;
					dust.velocity *= 2.5f;
					dust8.scale = 1.7f;
				}
				int num82 = 1183;
				Gore.NewGore(position, velocity, num82, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num82 + 2, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num82 + 3, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, num82 + 1, scale);
			}
		}
		else if (type == 619)
		{
			if (life > 0)
			{
				for (int num83 = 0; (double)num83 < dmg / (double)lifeMax * 150.0; num83++)
				{
					Dust dust9 = Dust.NewDustDirect(position, width, height, 5, hitDirection, -1f);
					Dust dust = dust9;
					dust.velocity *= 2.5f;
					dust9.fadeIn = 1.7f;
				}
			}
			else
			{
				for (int num84 = 0; (float)num84 < 150f; num84++)
				{
					Dust dust10 = Dust.NewDustDirect(position, width, height, 5, hitDirection, -1f);
					Dust dust = dust10;
					dust.velocity *= 2.5f;
					dust10.fadeIn = 1.7f;
				}
				int num85 = 1179;
				Gore.NewGore(position, velocity, num85, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num85 + 2, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num85 + 3, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, num85 + 1, scale);
			}
		}
		else if (type == 618)
		{
			if (life > 0)
			{
				for (int num86 = 0; (double)num86 < dmg / (double)lifeMax * 200.0; num86++)
				{
					Dust dust11 = Dust.NewDustDirect(position, width, height, 5, hitDirection, -1f);
					Dust dust = dust11;
					dust.velocity *= 2.5f;
					dust11.scale = 2f;
				}
			}
			else
			{
				for (int num87 = 0; (float)num87 < 200f; num87++)
				{
					Dust dust12 = Dust.NewDustDirect(position, width, height, 5, hitDirection, -1f);
					Dust dust = dust12;
					dust.velocity *= 2.5f;
					dust12.scale = 2.5f;
				}
				int num88 = 1172;
				Gore.NewGore(new Vector2(base.Right.X - 30f, position.Y), velocity, num88, scale);
				Gore.NewGore(position, velocity, num88, scale);
				Gore.NewGore(new Vector2(base.Right.X - 30f, position.Y), velocity, num88 + 1, scale);
				Gore.NewGore(position, velocity, num88 + 1, scale);
				Gore.NewGore(position, velocity, num88 + 2, scale);
				Gore.NewGore(position, velocity, num88 + 3, scale);
				Gore.NewGore(position, velocity, num88 + 4, scale);
				Gore.NewGore(position, velocity, num88 + 4, scale);
				Gore.NewGore(position, velocity, num88 + 5, scale);
				Gore.NewGore(position, velocity, num88 + 5, scale);
				Gore.NewGore(position, velocity, num88 + 6, scale);
				Gore.NewGore(position, velocity, num88 + 6, scale);
			}
		}
		else if (type == 541)
		{
			Color color = new Color(222, 108, 48) * 0.7f;
			if (life > 0)
			{
				for (int num89 = 0; (double)num89 < dmg / (double)lifeMax * 200.0; num89++)
				{
					Dust dust13 = Main.dust[Dust.NewDust(position, width, height, 268)];
					dust13.color = color;
					dust13.noGravity = true;
					dust13.scale = 1.5f;
					dust13.fadeIn = 0.7f;
					Dust dust = dust13;
					dust.velocity *= 3f;
					dust13 = Main.dust[Dust.NewDust(position, width, height, 268)];
					dust13.color = color;
					dust13.noGravity = true;
					dust13.scale = 1.5f;
					dust13.fadeIn = 0.7f;
					dust = dust13;
					dust.velocity *= 3f;
				}
			}
			else
			{
				for (int num90 = 0; num90 < 30; num90++)
				{
					Dust dust14 = Main.dust[Dust.NewDust(position, width, height, 268)];
					dust14.color = color;
					dust14.noGravity = true;
					dust14.scale = 1.5f;
					dust14.fadeIn = 0.7f;
					Dust dust = dust14;
					dust.velocity *= 3f;
					dust14 = Main.dust[Dust.NewDust(position, width, height, 268)];
					dust14.color = color;
					dust14.noGravity = true;
					dust14.scale = 1.5f;
					dust14.fadeIn = 0.7f;
					dust = dust14;
					dust.velocity *= 3f;
				}
				Gore.NewGore(position, velocity, 960, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 961, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 963, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 40f), velocity, 962, scale);
			}
		}
		else if (type == 546)
		{
			Color color2 = new Color(150, 108, 78) * 0.7f;
			if (life > 0)
			{
				for (int num91 = 0; (double)num91 < dmg / (double)lifeMax * 50.0; num91++)
				{
					Dust dust15 = Main.dust[Dust.NewDust(position, width, height, 268)];
					dust15.color = color2;
					dust15.noGravity = true;
					dust15.scale = 1.5f;
					dust15.fadeIn = 0.7f;
					Dust dust = dust15;
					dust.velocity *= 3f;
					dust15 = Main.dust[Dust.NewDust(position, width, height, 268)];
					dust15.color = color2;
					dust15.noGravity = true;
					dust15.scale = 1.5f;
					dust15.fadeIn = 0.7f;
					dust = dust15;
					dust.velocity *= 3f;
				}
			}
			else
			{
				for (int num92 = 0; num92 < 20; num92++)
				{
					Dust dust16 = Main.dust[Dust.NewDust(position, width, height, 268)];
					dust16.color = color2;
					dust16.noGravity = true;
					dust16.scale = 1.5f;
					dust16.fadeIn = 0.7f;
					Dust dust = dust16;
					dust.velocity *= 3f;
					dust16 = Main.dust[Dust.NewDust(position, width, height, 268)];
					dust16.color = color2;
					dust16.noGravity = true;
					dust16.scale = 1.5f;
					dust16.fadeIn = 0.7f;
					dust = dust16;
					dust.velocity *= 3f;
				}
				for (int num93 = 0; num93 < 20; num93++)
				{
					int num94 = Dust.NewDust(position, width, height, 54, 0f, 0f, 50, default(Color), 1.5f);
					Dust dust = Main.dust[num94];
					dust.velocity *= 2f;
					Main.dust[num94].noGravity = true;
				}
				Gore.NewGore(position, velocity, 964, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 965, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 966, scale);
			}
		}
		if (type == 378)
		{
			if (life > 0)
			{
				for (int num95 = 0; (double)num95 < dmg / (double)lifeMax * 50.0; num95++)
				{
					Dust.NewDust(position, width, height, 7);
				}
			}
			else
			{
				for (int num96 = 0; num96 < 20; num96++)
				{
					Dust.NewDust(position, width, height, 7);
				}
			}
		}
		if (type == 437 && dmg == 9999.0)
		{
			for (int num97 = 0; num97 < 6; num97++)
			{
				int num98 = Gore.NewGore(base.Center - new Vector2(10f), Vector2.UnitY.RotatedByRandom(6.2831854820251465) * 5f, 728 + num97);
			}
		}
		if (type == 398 && dmg == 1337.0 && Main.netMode != 2)
		{
			MoonlordDeathDrama.ThrowPieces(base.Center, Main.rand.Next(100));
		}
		if (type == 488)
		{
			localAI[0] = (int)dmg;
			if (localAI[0] < 20f)
			{
				localAI[0] = 20f;
			}
			if (localAI[0] > 120f)
			{
				localAI[0] = 120f;
			}
			localAI[1] = hitDirection;
		}
		if (type == 583 || type == 584 || type == 585)
		{
			Color value = Color.HotPink;
			Color value2 = Color.LightPink;
			int num99 = 4;
			if (type == 584)
			{
				value = Color.LimeGreen;
				value2 = Color.LightSeaGreen;
			}
			if (type == 585)
			{
				value = Color.RoyalBlue;
				value2 = Color.LightBlue;
			}
			if (life > 0)
			{
				for (int num100 = 0; (double)num100 < dmg / (double)lifeMax * 50.0; num100++)
				{
					Dust dust17 = Dust.NewDustDirect(base.Center - new Vector2(num99) * 0.5f, num99 + 4, num99 + 4, 278, 0f, 0f, 200, Color.Lerp(value, value2, Main.rand.NextFloat()), 0.65f);
					dust17.noGravity = true;
				}
			}
			else
			{
				for (int num101 = 0; num101 < 20; num101++)
				{
					Dust dust18 = Dust.NewDustDirect(base.Center - new Vector2(num99) * 0.5f, num99 + 4, num99 + 4, 278, 0f, 0f, 200, Color.Lerp(value, value2, Main.rand.NextFloat()), 0.65f);
					Dust dust = dust18;
					dust.velocity *= 1.5f;
					dust18.noGravity = true;
				}
			}
		}
		else if (type >= 513 && type <= 515)
		{
			if (life > 0)
			{
				for (int num102 = 0; (double)num102 < dmg / (double)lifeMax * 100.0; num102++)
				{
					Dust.NewDust(position, width, height, 250, hitDirection, -1f, alpha, this.color, scale);
				}
			}
			else
			{
				for (int num103 = 0; num103 < 50; num103++)
				{
					Dust.NewDust(position, width, height, 250, hitDirection, -2f, alpha, this.color, scale);
				}
				int num104 = Gore.NewGore(position, velocity, type - 513 + 822);
				Main.gore[num104].alpha = alpha;
			}
		}
		else if (type >= 510 && type <= 512)
		{
			if (life > 0)
			{
				for (int num105 = 0; (double)num105 < dmg / (double)lifeMax * 100.0; num105++)
				{
					Dust.NewDust(position, width, height, 250, hitDirection, -1f, alpha, this.color, scale);
				}
			}
			else
			{
				for (int num106 = 0; num106 < 50; num106++)
				{
					Dust.NewDust(position, width, height, 250, hitDirection, -2f, alpha, this.color, scale);
				}
				int num107 = Gore.NewGore(position, velocity, type - 510 + 819);
				Main.gore[num107].alpha = alpha;
			}
		}
		else if (type >= 621 && type <= 623)
		{
			if (life > 0)
			{
				for (int num108 = 0; (double)num108 < dmg / (double)lifeMax * 100.0; num108++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f, alpha, this.color, scale);
				}
			}
			else
			{
				for (int num109 = 0; num109 < 50; num109++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -2f, alpha, this.color, scale);
				}
				int num110 = Gore.NewGore(position, velocity, type - 621 + 1187);
				Main.gore[num110].alpha = alpha;
			}
		}
		else if (type == 518 || type == 416)
		{
			if (life > 0)
			{
				for (int num111 = 0; (double)num111 < dmg / (double)lifeMax * 20.0; num111++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					if (Main.rand.Next(4) == 0)
					{
						Dust dust19 = Main.dust[Dust.NewDust(position, width, height, 6)];
						dust19.noGravity = true;
						dust19.scale = 1.5f;
						dust19.fadeIn = 1f;
						Dust dust = dust19;
						dust.velocity *= 3f;
					}
				}
			}
			else
			{
				for (int num112 = 0; num112 < 20; num112++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					if (Main.rand.Next(3) == 0)
					{
						Dust dust20 = Main.dust[Dust.NewDust(position, width, height, 6)];
						dust20.noGravity = true;
						dust20.scale = 1.5f;
						dust20.fadeIn = 1f;
						Dust dust = dust20;
						dust.velocity *= 3f;
					}
				}
				Gore.NewGore(position, velocity, 844, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 845, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 847, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 835, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 836, scale);
			}
		}
		else if (type == 419)
		{
			if (life > 0)
			{
				for (int num113 = 0; (double)num113 < dmg / (double)lifeMax * 20.0; num113++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					if (Main.rand.Next(4) == 0)
					{
						Dust dust21 = Main.dust[Dust.NewDust(position, width, height, 6)];
						dust21.noGravity = true;
						dust21.scale = 1.5f;
						dust21.fadeIn = 1f;
						Dust dust = dust21;
						dust.velocity *= 3f;
					}
				}
			}
			else
			{
				for (int num114 = 0; num114 < 20; num114++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					if (Main.rand.Next(3) == 0)
					{
						Dust dust22 = Main.dust[Dust.NewDust(position, width, height, 6)];
						dust22.noGravity = true;
						dust22.scale = 1.5f;
						dust22.fadeIn = 1f;
						Dust dust = dust22;
						dust.velocity *= 3f;
					}
				}
				Gore.NewGore(position, velocity, 844, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 845, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 846, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 846, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 847, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 847, scale);
			}
		}
		else if (type == 412 || type == 413 || type == 414)
		{
			if (life > 0)
			{
				for (int num115 = 0; (double)num115 < dmg / (double)lifeMax * 50.0; num115++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
				}
			}
			else
			{
				for (int num116 = 0; num116 < 6; num116++)
				{
					Dust.NewDust(position, width, height, 241, 2.5f * (float)hitDirection, -2.5f);
				}
				for (int num117 = 0; num117 < 2; num117++)
				{
					Dust.NewDust(position, width, height, 6, 2.5f * (float)hitDirection, -2.5f, 100, Color.Transparent, 2f);
				}
				Gore.NewGore(position, velocity, type - 412 + 828);
			}
		}
		else if (type == 415)
		{
			if (life > 0)
			{
				for (int num118 = 0; (double)num118 < dmg / (double)lifeMax * 20.0; num118++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					if (Main.rand.Next(4) == 0)
					{
						Dust dust23 = Main.dust[Dust.NewDust(position, width, height, 6)];
						dust23.noGravity = true;
						dust23.scale = 1.5f;
						dust23.fadeIn = 1f;
						Dust dust = dust23;
						dust.velocity *= 3f;
					}
				}
			}
			else
			{
				for (int num119 = 0; num119 < 40; num119++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					Dust dust24 = Main.dust[Dust.NewDust(position, width, height, 6)];
					dust24.noGravity = true;
					dust24.scale = 1.5f;
					dust24.fadeIn = 1f;
					Dust dust = dust24;
					dust.velocity *= 3f;
				}
				Gore.NewGore(base.Center, velocity * 0.8f, 831);
				Gore.NewGore(base.Center, velocity * 0.8f, 832);
				Gore.NewGore(base.Center, velocity * 0.9f, 833);
				Gore.NewGore(base.Center, velocity * 0.9f, 834);
			}
		}
		else if (type == 417)
		{
			if (life > 0)
			{
				for (int num120 = 0; (double)num120 < dmg / (double)lifeMax * 20.0; num120++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					if (Main.rand.Next(4) == 0)
					{
						Dust dust25 = Main.dust[Dust.NewDust(position, width, height, 6)];
						dust25.noGravity = true;
						dust25.scale = 1.5f;
						dust25.fadeIn = 1f;
						Dust dust = dust25;
						dust.velocity *= 3f;
					}
				}
			}
			else
			{
				for (int num121 = 0; num121 < 30; num121++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					if (Main.rand.Next(2) == 0)
					{
						Dust dust26 = Main.dust[Dust.NewDust(position, width, height, 6)];
						dust26.noGravity = true;
						dust26.scale = 1.5f;
						dust26.fadeIn = 1f;
						Dust dust = dust26;
						dust.velocity *= 3f;
					}
				}
				Gore.NewGore(position, velocity, 837, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 838, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 838, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 838, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 839, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 839, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 38f), velocity, 840, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 38f), velocity, 840, scale);
			}
		}
		else if (type == 418)
		{
			if (life > 0)
			{
				for (int num122 = 0; (double)num122 < dmg / (double)lifeMax * 20.0; num122++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					if (Main.rand.Next(2) == 0)
					{
						Dust dust27 = Main.dust[Dust.NewDust(position, width, height, 6)];
						dust27.noGravity = true;
						dust27.scale = 1.5f;
						dust27.fadeIn = 1f;
						Dust dust = dust27;
						dust.velocity *= 3f;
					}
				}
			}
			else
			{
				for (int num123 = 0; num123 < 20; num123++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					Dust dust28 = Main.dust[Dust.NewDust(position, width, height, 6)];
					dust28.noGravity = true;
					dust28.scale = 1.5f;
					dust28.fadeIn = 1f;
					Dust dust = dust28;
					dust.velocity *= 3f;
				}
				Gore.NewGore(base.Center, velocity * 0.8f, 841);
				Gore.NewGore(base.Center, velocity * 0.8f, 842);
				Gore.NewGore(base.Center, velocity * 0.8f, 842);
				Gore.NewGore(base.Center, velocity * 0.9f, 843);
				Gore.NewGore(base.Center, velocity * 0.9f, 843);
			}
		}
		if (type == 516)
		{
			for (int num124 = 0; num124 < 20; num124++)
			{
				int num125 = Dust.NewDust(position, width, height, 6, 2.5f * (float)hitDirection, -2.5f);
				Dust dust = Main.dust[num125];
				dust.velocity *= 3f;
				dust = Main.dust[num125];
				dust.scale += Main.rand.NextFloat();
				if (Main.rand.Next(2) == 0)
				{
					num125 = Dust.NewDust(position, width, height, 259, 2.5f * (float)hitDirection, -2.5f);
					Main.dust[num125].noGravity = true;
				}
			}
		}
		if (type == 519)
		{
			Rectangle hitbox2 = base.Hitbox;
			for (int num126 = 0; num126 < oldPos.Length; num126 += 3)
			{
				hitbox2.X = (int)oldPos[num126].X;
				hitbox2.Y = (int)oldPos[num126].Y;
				for (int num127 = 0; num127 < 5; num127++)
				{
					int num128 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
					int num129 = Dust.NewDust(hitbox2.TopLeft(), width, height, num128, 2.5f * (float)hitDirection, -2.5f);
					Main.dust[num129].alpha = 200;
					Dust dust = Main.dust[num129];
					dust.velocity *= 2.4f;
					dust = Main.dust[num129];
					dust.scale += Main.rand.NextFloat();
				}
			}
		}
		if (type == 522)
		{
			Vector2 spinningpoint = new Vector2(0f, -3f).RotatedByRandom(3.1415927410125732);
			float num130 = 24f;
			Vector2 vector12 = new Vector2(1.05f, 1f);
			for (float num131 = 0f; num131 < num130; num131++)
			{
				int num132 = Dust.NewDust(base.Center, 0, 0, 66, 0f, 0f, 0, Color.Transparent);
				Main.dust[num132].position = base.Center;
				Main.dust[num132].velocity = spinningpoint.RotatedBy((float)Math.PI * 2f * num131 / num130) * vector12 * (0.8f + Main.rand.NextFloat() * 0.4f) * 2f;
				Main.dust[num132].color = Color.SkyBlue;
				Main.dust[num132].noGravity = true;
				Dust dust = Main.dust[num132];
				dust.scale += 0.5f + Main.rand.NextFloat();
			}
		}
		else if (type == 426)
		{
			if (life > 0)
			{
				for (int num133 = 0; (double)num133 < dmg / (double)lifeMax * 50.0; num133++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					if (Main.rand.Next(4) == 0)
					{
						Dust dust29 = Main.dust[Dust.NewDust(position, width, height, 229)];
						dust29.noGravity = true;
						dust29.scale = 1.5f;
						dust29.fadeIn = 1f;
						Dust dust = dust29;
						dust.velocity *= 3f;
					}
				}
			}
			else
			{
				for (int num134 = 0; num134 < 20; num134++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
				}
				for (int num135 = 0; num135 < 30; num135++)
				{
					int num136 = Utils.SelectRandom<int>(Main.rand, 229, 240, 161);
					Dust dust30 = Main.dust[Dust.NewDust(position, width, height, num136)];
					dust30.noGravity = true;
					dust30.scale = 1.25f + Main.rand.NextFloat();
					dust30.fadeIn = 0.25f;
					Dust dust = dust30;
					dust.velocity *= 2f;
					dust30.noLight = true;
				}
				Gore.NewGore(base.Top, velocity * 0.7f, 799);
				Gore.NewGore(base.Center, velocity * 0.8f, 800);
				Gore.NewGore(base.Center, velocity * 0.9f, 801);
				if (Main.netMode != 1)
				{
					int num137 = CountNPCS(428) + CountNPCS(427) + CountNPCS(426) * 3;
					int num138 = 20;
					if (num137 < num138)
					{
						for (int num139 = 0; num139 < 3; num139++)
						{
							int num140 = NewNPC(GetSpawnSource_NPCHurt(), (int)base.Center.X, (int)base.Center.Y, 428, whoAmI);
							Main.npc[num140].velocity = -Vector2.UnitY.RotatedByRandom(6.2831854820251465) * Main.rand.Next(3, 6) - Vector2.UnitY * 2f;
							Main.npc[num140].netUpdate = true;
						}
					}
				}
			}
		}
		else if (type == 427)
		{
			if (life > 0)
			{
				for (int num141 = 0; (double)num141 < dmg / (double)lifeMax * 20.0; num141++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					if (Main.rand.Next(2) == 0)
					{
						Dust dust31 = Main.dust[Dust.NewDust(position, width, height, 229)];
						dust31.noGravity = true;
						dust31.scale = 1.5f;
						dust31.fadeIn = 1f;
						Dust dust = dust31;
						dust.velocity *= 3f;
					}
				}
			}
			else
			{
				for (int num142 = 0; num142 < 10; num142++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
				}
				for (int num143 = 0; num143 < 20; num143++)
				{
					int num144 = Utils.SelectRandom<int>(Main.rand, 229, 229, 240);
					Dust dust32 = Main.dust[Dust.NewDust(position, width, height, num144)];
					dust32.noGravity = true;
					dust32.scale = 1.25f + Main.rand.NextFloat();
					dust32.fadeIn = 0.25f;
					Dust dust = dust32;
					dust.velocity *= 3f;
					dust32.noLight = true;
				}
				Gore.NewGore(base.Center, velocity * 0.8f, 802);
				Gore.NewGore(base.Center, velocity * 0.9f, 803);
				Gore.NewGore(base.Center, velocity * 0.9f, 804);
				Gore.NewGore(base.Center, velocity * 0.8f, 805);
			}
		}
		else if (type == 429)
		{
			if (life > 0)
			{
				for (int num145 = 0; (double)num145 < dmg / (double)lifeMax * 20.0; num145++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					if (Main.rand.Next(4) == 0)
					{
						Dust dust33 = Main.dust[Dust.NewDust(position, width, height, 229)];
						dust33.noGravity = true;
						dust33.scale = 1.5f;
						dust33.fadeIn = 1f;
						Dust dust = dust33;
						dust.velocity *= 3f;
					}
				}
			}
			else
			{
				for (int num146 = 0; num146 < 20; num146++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					if (Main.rand.Next(3) == 0)
					{
						Dust dust34 = Main.dust[Dust.NewDust(position, width, height, 229)];
						dust34.noGravity = true;
						dust34.scale = 1.5f;
						dust34.fadeIn = 1f;
						Dust dust = dust34;
						dust.velocity *= 3f;
					}
				}
				Gore.NewGore(position, velocity, 808, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 809, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 809, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 810, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 810, scale);
				if (Main.netMode != 1)
				{
					Point point = base.Center.ToTileCoordinates();
					Point point2 = Main.player[target].Center.ToTileCoordinates();
					Vector2 vector13 = Main.player[target].Center - base.Center;
					int num147 = 20;
					int num148 = 3;
					int num149 = 7;
					int num150 = 2;
					int num151 = 0;
					bool flag2 = false;
					if (vector13.Length() > 2000f)
					{
						flag2 = true;
					}
					while (!flag2 && num151 < 100)
					{
						num151++;
						int num152 = Main.rand.Next(point2.X - num147, point2.X + num147 + 1);
						int num153 = Main.rand.Next(point2.Y - num147, point2.Y - Math.Abs(num152 - point2.X) + 1);
						if ((num153 < point2.Y - num149 || num153 > point2.Y + num149 || num152 < point2.X - num149 || num152 > point2.X + num149) && (num153 < point.Y - num148 || num153 > point.Y + num148 || num152 < point.X - num148 || num152 > point.X + num148) && !Main.tile[num152, num153].nactive())
						{
							bool flag3 = true;
							if (flag3 && Main.tile[num152, num153].lava())
							{
								flag3 = false;
							}
							if (flag3 && Collision.SolidTiles(num152 - num150, num152 + num150, num153 - num150, num153 + num150))
							{
								flag3 = false;
							}
							if (flag3 && !Collision.CanHitLine(base.Center, 0, 0, Main.player[target].Center, 0, 0))
							{
								flag3 = false;
							}
							if (flag3)
							{
								Projectile.NewProjectile(GetSpawnSource_ForProjectile(), num152 * 16 + 8, num153 * 16 + 8, 0f, 0f, 578, 0, 1f, Main.myPlayer);
								flag2 = true;
								break;
							}
						}
					}
				}
			}
		}
		else if (type == 425)
		{
			if (life > 0)
			{
				for (int num154 = 0; (double)num154 < dmg / (double)lifeMax * 20.0; num154++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					if (Main.rand.Next(4) == 0)
					{
						Dust dust35 = Main.dust[Dust.NewDust(position, width, height, 229)];
						dust35.noGravity = true;
						dust35.scale = 1.5f;
						dust35.fadeIn = 1f;
						Dust dust = dust35;
						dust.velocity *= 3f;
					}
				}
			}
			else
			{
				for (int num155 = 0; num155 < 20; num155++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					if (Main.rand.Next(3) == 0)
					{
						Dust dust36 = Main.dust[Dust.NewDust(position, width, height, 229)];
						dust36.noGravity = true;
						dust36.scale = 1.5f;
						dust36.fadeIn = 1f;
						Dust dust = dust36;
						dust.velocity *= 3f;
					}
				}
				Gore.NewGore(position, velocity, 796, scale);
				Gore.NewGore(base.Center, velocity, 797, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 798, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 809, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 809, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 810, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 810, scale);
			}
		}
		else if (type == 428)
		{
			if (life > 0)
			{
				for (int num156 = 0; (double)num156 < dmg / (double)lifeMax * 20.0; num156++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
				}
			}
			else
			{
				for (int num157 = 0; num157 < 10; num157++)
				{
					Dust.NewDust(position, width, height, 241, hitDirection, -1f);
					if (Main.rand.Next(2) == 0)
					{
						Dust.NewDust(position, width, height, 229);
					}
					else
					{
						Dust.NewDust(position, width, height, 240);
					}
				}
				Gore.NewGore(position, velocity * 0.8f, 806);
				Gore.NewGore(position, velocity * 0.8f, 807);
			}
		}
		else if (type == 424)
		{
			if (life > 0)
			{
				for (int num158 = 0; (double)num158 < dmg / (double)lifeMax * 20.0; num158++)
				{
					Dust.NewDust(position, width, height, 249, hitDirection, -1f);
					if (Main.rand.Next(4) == 0)
					{
						Dust dust37 = Main.dust[Dust.NewDust(position, width, height, 242)];
						dust37.noGravity = true;
						dust37.scale = 1.5f;
						dust37.fadeIn = 1f;
						Dust dust = dust37;
						dust.velocity *= 3f;
					}
				}
			}
			else
			{
				for (int num159 = 0; num159 < 20; num159++)
				{
					Dust.NewDust(position, width, height, 249, hitDirection, -1f);
					if (Main.rand.Next(3) == 0)
					{
						Dust dust38 = Main.dust[Dust.NewDust(position, width, height, 242)];
						dust38.noGravity = true;
						dust38.scale = 1.5f;
						dust38.fadeIn = 1f;
						Dust dust = dust38;
						dust.velocity *= 3f;
					}
				}
				Gore.NewGore(position, velocity, 793, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 794, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 794, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 795, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 795, scale);
			}
		}
		else if (type == 423)
		{
			if (life > 0)
			{
				for (int num160 = 0; (double)num160 < dmg / (double)lifeMax * 50.0; num160++)
				{
					Dust.NewDust(position, width, height, 249, hitDirection, -1f);
					if (Main.rand.Next(4) == 0)
					{
						Dust dust39 = Main.dust[Dust.NewDust(position, width, height, 242)];
						dust39.noGravity = true;
						dust39.scale = 1.5f;
						dust39.fadeIn = 1f;
						Dust dust = dust39;
						dust.velocity *= 3f;
					}
				}
			}
			else
			{
				for (int num161 = 0; num161 < 20; num161++)
				{
					Dust.NewDust(position, width, height, 249, hitDirection, -1f);
					Dust dust40 = Main.dust[Dust.NewDust(position, width, height, 242)];
					dust40.noGravity = true;
					dust40.scale = 1.5f;
					dust40.fadeIn = 1f;
					Dust dust = dust40;
					dust.velocity *= 3f;
				}
				Gore.NewGore(base.Center, velocity * 0.8f, 790);
				Gore.NewGore(base.Center, velocity * 0.8f, 791);
				Gore.NewGore(base.Center, velocity * 0.9f, 792);
			}
		}
		else if (type == 421)
		{
			if (life > 0)
			{
				for (int num162 = 0; (double)num162 < dmg / (double)lifeMax * 20.0; num162++)
				{
					Dust.NewDust(position, width, height, 249, hitDirection, -1f);
					if (Main.rand.Next(2) == 0)
					{
						Dust dust41 = Main.dust[Dust.NewDust(position, width, height, 242)];
						dust41.noGravity = true;
						dust41.scale = 1.5f;
						dust41.fadeIn = 1f;
						Dust dust = dust41;
						dust.velocity *= 3f;
					}
				}
			}
			else
			{
				for (int num163 = 0; num163 < 10; num163++)
				{
					Dust.NewDust(position, width, height, 249, hitDirection, -1f);
					Dust dust42 = Main.dust[Dust.NewDust(position, width, height, 242)];
					dust42.noGravity = true;
					dust42.scale = 1.5f;
					dust42.fadeIn = 1f;
					Dust dust = dust42;
					dust.velocity *= 3f;
				}
				Gore.NewGore(base.Center, velocity * 0.8f, 785);
				Gore.NewGore(base.Center, velocity * 0.8f, 786);
				Gore.NewGore(base.Center, velocity * 0.9f, 787);
			}
		}
		else if (type == 420)
		{
			if (life > 0)
			{
				for (int num164 = 0; (double)num164 < dmg / (double)lifeMax * 20.0; num164++)
				{
					Dust.NewDust(position, width, height, 249, hitDirection, -1f);
					if (Main.rand.Next(2) == 0)
					{
						Dust dust43 = Main.dust[Dust.NewDust(position, width, height, 242)];
						dust43.noGravity = true;
						dust43.scale = 1.5f;
						dust43.fadeIn = 1f;
						Dust dust = dust43;
						dust.velocity *= 3f;
					}
				}
			}
			else
			{
				for (int num165 = 0; num165 < 10; num165++)
				{
					Dust.NewDust(position, width, height, 249, hitDirection, -1f);
					Dust dust44 = Main.dust[Dust.NewDust(position, width, height, 242)];
					dust44.noGravity = true;
					dust44.scale = 1.5f;
					dust44.fadeIn = 1f;
					Dust dust = dust44;
					dust.velocity *= 3f;
				}
				Gore.NewGore(base.Center, velocity * 0.8f, 782);
				Gore.NewGore(base.Center, velocity * 0.8f, 783);
				Gore.NewGore(base.Center, velocity * 0.9f, 784);
			}
		}
		else if (type == 406 || type == 405)
		{
			if (life > 0)
			{
				for (int num166 = 0; (double)num166 < 10.0 + dmg / 10.0; num166++)
				{
					int num167 = width / 4;
					Vector2 vector14 = ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2() * Main.rand.Next(24, 41) / 8f;
					int num168 = Dust.NewDust(base.Center - Vector2.One * num167, num167 * 2, num167 * 2, 229);
					Dust dust45 = Main.dust[num168];
					Vector2 vector15 = Vector2.Normalize(dust45.position - base.Center);
					dust45.position = base.Center + vector15 * num167 * scale - new Vector2(4f);
					if (num166 < 30)
					{
						dust45.velocity = vector15 * dust45.velocity.Length() * 2f;
					}
					else
					{
						dust45.velocity = 2f * vector15 * Main.rand.Next(45, 91) / 10f;
					}
					dust45.noGravity = true;
					dust45.scale = 0.7f + Main.rand.NextFloat();
				}
			}
			else
			{
				for (int num169 = 0; num169 < 60; num169++)
				{
					int num170 = width / 4;
					Vector2 vector16 = ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2() * Main.rand.Next(24, 41) / 8f;
					int num171 = Dust.NewDust(base.Center - Vector2.One * num170, num170 * 2, num170 * 2, 229);
					Dust dust46 = Main.dust[num171];
					Vector2 vector17 = Vector2.Normalize(dust46.position - base.Center);
					dust46.position = base.Center + vector17 * num170 * scale - new Vector2(4f);
					if (num169 < 30)
					{
						dust46.velocity = vector17 * dust46.velocity.Length() * 2f;
					}
					else
					{
						dust46.velocity = 2f * vector17 * Main.rand.Next(45, 91) / 10f;
					}
					dust46.noGravity = true;
					dust46.scale = 0.7f;
				}
				if (type == 405)
				{
					int num172 = CountNPCS(406) + CountNPCS(405);
					int num173 = 4;
					if (num172 >= 4)
					{
						num173 = 3;
					}
					if (num172 >= 7)
					{
						num173 = 2;
					}
					if (num172 >= 10)
					{
						num173 = 1;
					}
					for (int num174 = 0; num174 < num173; num174++)
					{
						Vector2 vector18 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * (3f + Main.rand.NextFloat() * 4f);
						int num175 = NewNPC(GetSpawnSource_NPCHurt(), (int)base.Center.X, (int)base.Bottom.Y, 406, whoAmI);
						Main.npc[num175].velocity = vector18;
					}
				}
			}
		}
		else if (type == 409)
		{
			if (life > 0)
			{
				for (int num176 = 0; (double)num176 < dmg / (double)lifeMax * 50.0; num176++)
				{
					Dust.NewDust(position, width, height, 17, hitDirection, -1f);
					if (Main.rand.Next(4) == 0)
					{
						Dust dust47 = Main.dust[Dust.NewDust(position, width, height, 229)];
						dust47.noGravity = true;
					}
				}
			}
			else
			{
				for (int num177 = 0; num177 < 20; num177++)
				{
					Dust.NewDust(position, width, height, 17, hitDirection, -1f);
					Dust dust48 = Main.dust[Dust.NewDust(position, width, height, 229)];
					dust48.noGravity = true;
					Dust dust = dust48;
					dust.velocity *= 3f;
				}
				Gore.NewGore(base.Center, velocity * 0.8f, 775);
				Gore.NewGore(base.Center, velocity * 0.8f, 776);
				Gore.NewGore(base.Center, velocity * 0.9f, 777);
			}
		}
		else if (type == 410)
		{
			if (life > 0)
			{
				for (int num178 = 0; (double)num178 < dmg / (double)lifeMax * 10.0; num178++)
				{
					Dust.NewDust(position, width, height, 17, hitDirection, -1f);
					if (Main.rand.Next(4) == 0)
					{
						Dust dust49 = Main.dust[Dust.NewDust(position, width, height, 229)];
						dust49.noGravity = true;
					}
				}
			}
			else
			{
				for (int num179 = 0; num179 < 5; num179++)
				{
					Dust.NewDust(position, width, height, 17, hitDirection, -1f);
					Dust dust50 = Main.dust[Dust.NewDust(position, width, height, 229)];
					dust50.noGravity = true;
					Dust dust = dust50;
					dust.velocity *= 3f;
				}
			}
		}
		else if (type == 407)
		{
			if (life > 0)
			{
				for (int num180 = 0; (double)num180 < dmg / (double)lifeMax * 50.0; num180++)
				{
					Dust.NewDust(position, width, height, 17, hitDirection, -1f, 0, Color.Transparent, 0.75f);
					if (Main.rand.Next(2) == 0)
					{
						Dust dust51 = Main.dust[Dust.NewDust(position, width, height, 229)];
						dust51.noGravity = true;
					}
				}
			}
			else
			{
				for (int num181 = 0; num181 < 20; num181++)
				{
					if (Main.rand.Next(3) != 0)
					{
						Dust.NewDust(position, width, height, 17, hitDirection, -1f);
					}
					Dust dust52 = Main.dust[Dust.NewDust(position, width, height, 229)];
					dust52.noGravity = true;
					Dust dust = dust52;
					dust.velocity *= 3f;
				}
				Gore.NewGore(base.Top, velocity * 0.8f, 778);
				Gore.NewGore(base.Top, velocity * 0.8f, 779);
				Gore.NewGore(base.Center, velocity * 0.9f, 780);
				Gore.NewGore(base.Center, velocity * 0.9f, 781);
				Gore.NewGore(base.Center, velocity * 0.9f, 780);
				Gore.NewGore(base.Center, velocity * 0.9f, 781);
			}
		}
		else if (type == 402)
		{
			if (life > 0)
			{
				for (int num182 = 0; (double)num182 < dmg / (double)lifeMax * 3.0; num182++)
				{
					if (Main.rand.Next(3) == 0)
					{
						Dust.NewDust(position, width, height, 17, hitDirection, -1f, 0, Color.Transparent, 0.75f);
					}
					if (Main.rand.Next(2) == 0)
					{
						Dust dust53 = Main.dust[Dust.NewDust(position, width, height, 229)];
						dust53.noGravity = true;
					}
					for (int num183 = 0; num183 < oldPos.Length; num183++)
					{
						if (Main.rand.Next(4) == 0)
						{
							if (oldPos[num183] == Vector2.Zero)
							{
								break;
							}
							if (Main.rand.Next(3) == 0)
							{
								Dust.NewDust(oldPos[num183], width, height, 17, hitDirection, -1f, 0, Color.Transparent, 0.75f);
							}
							if (Main.rand.Next(2) == 0)
							{
								Dust dust54 = Main.dust[Dust.NewDust(oldPos[num183], width, height, 229)];
								dust54.noGravity = true;
							}
						}
					}
				}
			}
			else
			{
				for (int num184 = 0; num184 < 5; num184++)
				{
					if (Main.rand.Next(3) == 0)
					{
						Dust.NewDust(position, width, height, 17, hitDirection, -1f);
					}
					Dust dust55 = Main.dust[Dust.NewDust(position, width, height, 229)];
					dust55.noGravity = true;
					Dust dust = dust55;
					dust.velocity *= 3f;
				}
				for (int num185 = 0; num185 < oldPos.Length; num185++)
				{
					if (Main.rand.Next(4) != 0)
					{
						continue;
					}
					if (oldPos[num185] == Vector2.Zero)
					{
						break;
					}
					for (int num186 = 0; num186 < 2; num186++)
					{
						if (Main.rand.Next(3) == 0)
						{
							Dust.NewDust(oldPos[num185], width, height, 17, hitDirection, -1f);
						}
						Dust dust56 = Main.dust[Dust.NewDust(oldPos[num185], width, height, 229)];
						dust56.noGravity = true;
						Dust dust = dust56;
						dust.velocity *= 3f;
					}
				}
			}
		}
		else if (type == 411)
		{
			if (life > 0)
			{
				for (int num187 = 0; (double)num187 < dmg / (double)lifeMax * 20.0; num187++)
				{
					Dust.NewDust(position, width, height, 17, hitDirection, -1f);
					if (Main.rand.Next(4) == 0)
					{
						Dust dust57 = Main.dust[Dust.NewDust(position, width, height, 229)];
						dust57.noGravity = true;
					}
				}
			}
			else
			{
				for (int num188 = 0; num188 < 20; num188++)
				{
					Dust.NewDust(position, width, height, 17, hitDirection, -1f);
					if (Main.rand.Next(2) == 0)
					{
						Dust dust58 = Main.dust[Dust.NewDust(position, width, height, 229)];
						dust58.noGravity = true;
					}
				}
				Gore.NewGore(position, velocity, 772, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 773, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 773, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 774, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 774, scale);
			}
		}
		else if (type == 491)
		{
			if (life <= 0)
			{
				Vector2 vector19 = base.Center - new Vector2(60f);
				Vector2 vector20 = new Vector2((spriteDirection != 1) ? 1 : (-1), 0f).RotatedBy(rotation);
				Gore.NewGore(vector19 + vector20 * (width / 2), velocity, 858, scale);
				Gore.NewGore(vector19 + vector20 * (width / 3), velocity, 857, scale);
				for (int num189 = -1; num189 < 2; num189++)
				{
					Gore.NewGore(vector19 + vector20 * ((float)width * (0.45f + (float)num189 * 0.1f)), velocity, 859, scale);
					Gore.NewGore(vector19 + vector20 * ((float)width * (0.4f + (float)num189 * 0.1f)), velocity, 859, scale);
					Gore.NewGore(vector19 + vector20 * ((float)width * (0.35f + (float)num189 * 0.1f)), velocity, 859, scale);
				}
				for (int num190 = -1; num190 < 2; num190++)
				{
					Gore.NewGore(vector19 + vector20 * ((float)width * 0.35f) - new Vector2(0f, 200f) + Utils.RandomVector2(Main.rand, -40f, 40f), velocity, Utils.SelectRandom<int>(Main.rand, 860, 892, 893), scale);
					Gore.NewGore(vector19 + vector20 * ((float)width * 0.15f) - new Vector2(0f, 200f) + Utils.RandomVector2(Main.rand, -40f, 40f), velocity, Utils.SelectRandom<int>(Main.rand, 860, 892, 893), scale);
					Gore.NewGore(vector19 + vector20 * ((float)width * -0.35f) - new Vector2(0f, 200f) + Utils.RandomVector2(Main.rand, -40f, 40f), velocity, Utils.SelectRandom<int>(Main.rand, 860, 892, 893), scale);
					Gore.NewGore(vector19 + vector20 * ((float)width * -0.15f) - new Vector2(0f, 300f) + Utils.RandomVector2(Main.rand, -40f, 40f), velocity, Utils.SelectRandom<int>(Main.rand, 860, 892, 893), scale);
					Gore.NewGore(vector19 + vector20 * ((float)width * -0.15f) - new Vector2(0f, 300f) + Utils.RandomVector2(Main.rand, -40f, 40f), velocity, Utils.SelectRandom<int>(Main.rand, 860, 892, 893), scale);
				}
				for (int num191 = 0; num191 < 2; num191++)
				{
					Gore.NewGore(vector19 + vector20 * ((float)width * 0.15f) - new Vector2(0f, 160 + 60 * num191), velocity, 855, scale);
					Gore.NewGore(vector19 + vector20 * ((float)width * -0.15f) - new Vector2(0f, 160 + 60 * num191), velocity, 855, scale);
				}
				for (int num192 = -1; num192 < 2; num192++)
				{
					Gore.NewGore(vector19 + vector20 * ((float)width * (0.25f + (float)num192 * 0.1f)) - new Vector2(0f, 20 + 40 * num192), velocity, 854, scale);
					Gore.NewGore(vector19 + vector20 * ((float)width * (-0.45f + (float)num192 * 0.1f)) - new Vector2(0f, 20 + 40 * num192), velocity, 853, scale);
					Gore.NewGore(vector19 + vector20 * ((float)width * (0.05f + (float)num192 * 0.1f)) - new Vector2(0f, 20 + 40 * num192), velocity, 856, scale);
				}
				for (int num193 = 0; num193 < 30; num193++)
				{
					int num194 = Main.rand.Next(861, 863);
					int num195 = Gore.NewGore(base.Center - new Vector2(60f), Vector2.Zero, num194);
					Main.gore[num195].alpha = 100;
					Main.gore[num195].velocity = Vector2.Transform(new Vector2(4f, 0f), Matrix.CreateRotationZ((float)(Main.rand.NextDouble() * 6.2831854820251465)));
					Main.gore[num195].position = new Vector2(position.X - 20f + ((float)width + 40f) * Main.rand.NextFloat(), position.Y - 240f + (float)(height + 240 - 20) * Main.rand.NextFloat());
				}
				for (int num196 = 0; num196 < 120; num196++)
				{
					int num197 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
					Main.dust[num197].noGravity = true;
					Dust dust = Main.dust[num197];
					dust.velocity *= 5f;
					num197 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
					dust = Main.dust[num197];
					dust.velocity *= 4f;
					Main.dust[num197].noGravity = true;
				}
				if (Main.netMode != 1)
				{
					for (int num198 = 0; num198 < 4; num198++)
					{
						float num199 = (float)(num198 < 2).ToDirectionInt() * ((float)Math.PI / 8f + (float)Math.PI / 4f * Main.rand.NextFloat());
						Vector2 vector21 = new Vector2(0f, (0f - Main.rand.NextFloat()) * 0.5f - 0.5f).RotatedBy(num199) * 6f;
						Projectile.NewProjectile(GetSpawnSource_ForProjectile(), base.Center.X, base.Center.Y, vector21.X, vector21.Y, 594, 0, 0f, Main.myPlayer);
					}
				}
			}
		}
		else if (type == 492)
		{
			if (life <= 0)
			{
				for (int num200 = 0; num200 < 7; num200++)
				{
					int num201 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Dust dust = Main.dust[num201];
					dust.velocity *= 1.4f;
				}
				for (int num202 = 0; num202 < 10; num202++)
				{
					int num203 = Main.rand.Next(61, 64);
					int num204 = Gore.NewGore(position, Vector2.Zero, num203);
					Main.gore[num204].alpha = 100;
					Main.gore[num204].velocity = Vector2.Transform(new Vector2(1f, 0f), Matrix.CreateRotationZ((float)(Main.rand.NextDouble() * 6.2831854820251465)));
				}
			}
		}
		else if (type >= 524 && type <= 527)
		{
			int num205 = 0;
			int num206 = 5;
			int num207 = 863;
			if (type == 525)
			{
				num205 = 75;
				num207 = 867;
			}
			else if (type == 526)
			{
				num205 = 170;
				num207 = 871;
			}
			else if (type == 527)
			{
				num205 = 67;
				num207 = 879;
			}
			if (life > 0)
			{
				for (int num208 = 0; (double)num208 < dmg / (double)lifeMax * 20.0; num208++)
				{
					Dust.NewDust(position, width, height, num206, hitDirection, -1f);
					if (Main.rand.Next(4) == 0 && num205 > 0)
					{
						Dust dust59 = Main.dust[Dust.NewDust(position, width, height, num205)];
						dust59.noGravity = true;
						dust59.scale = 1.5f;
						dust59.fadeIn = 1f;
						Dust dust = dust59;
						dust.velocity *= 3f;
					}
				}
			}
			else
			{
				for (int num209 = 0; num209 < 20; num209++)
				{
					Dust.NewDust(position, width, height, num206, hitDirection, -1f);
					if (Main.rand.Next(3) == 0 && num205 > 0)
					{
						Dust dust60 = Main.dust[Dust.NewDust(position, width, height, num205)];
						dust60.noGravity = true;
						dust60.scale = 1.5f;
						dust60.fadeIn = 1f;
						Dust dust = dust60;
						dust.velocity *= 3f;
					}
				}
				Gore.NewGore(position, velocity, num207, scale);
				Gore.NewGore(position, velocity, num207 + 1, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num207 + 2, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num207 + 2, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, num207 + 3, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, num207 + 3, scale);
			}
		}
		else if (type >= 528 && type <= 529)
		{
			int num210 = 5;
			int num211 = 875;
			if (type == 529)
			{
				num211 = 876;
			}
			if (life > 0)
			{
				for (int num212 = 0; (double)num212 < dmg / (double)lifeMax * 20.0; num212++)
				{
					Dust.NewDust(position, width, height, num210, hitDirection, -1f);
				}
			}
			else
			{
				for (int num213 = 0; num213 < 20; num213++)
				{
					Dust.NewDust(position, width, height, num210, hitDirection, -1f);
				}
				Gore.NewGore(position, velocity, num211, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 877, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 877, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 878, scale);
			}
		}
		else if (type == 530 || type == 531)
		{
			if (life > 0)
			{
				for (int num214 = 0; (double)num214 < dmg / (double)lifeMax * 30.0; num214++)
				{
					Dust.NewDust(position, width, height, 250, hitDirection, -1f, 100);
				}
			}
			else
			{
				for (int num215 = 0; num215 < 20; num215++)
				{
					Dust.NewDust(position, width, height, 250, 2.5f * (float)hitDirection, -2.5f, 100);
				}
				Gore.NewGore(position, velocity, 883);
				Gore.NewGore(position, velocity, 884);
				Gore.NewGore(position, velocity, 885);
				Gore.NewGore(position, velocity, 886);
				Gore.NewGore(position, velocity, 887);
			}
		}
		else if (type == 532)
		{
			if (life > 0)
			{
				for (int num216 = 0; (double)num216 < dmg / (double)lifeMax * 50.0; num216++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f, 100);
				}
			}
			else
			{
				for (int num217 = 0; num217 < 50; num217++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f, 100);
				}
				Gore.NewGore(position, velocity, 888);
				Gore.NewGore(position, velocity, 889);
				Gore.NewGore(position, velocity, 890);
				Gore.NewGore(position, velocity, 891);
			}
		}
		else if (type == 533)
		{
			if (life > 0)
			{
				for (int num218 = 0; (double)num218 < dmg / (double)lifeMax * 50.0; num218++)
				{
					int num219 = Dust.NewDust(position, width, height, 27, 0f, 0f, 50, default(Color), 1.5f);
					Dust dust = Main.dust[num219];
					dust.velocity *= 2f;
					Main.dust[num219].noGravity = true;
				}
			}
			else
			{
				for (int num220 = 0; num220 < 40; num220++)
				{
					int num221 = Dust.NewDust(position, width, height, 27, 0f, 0f, 50, default(Color), 1.5f);
					Dust dust = Main.dust[num221];
					dust.velocity *= 2f;
					Main.dust[num221].noGravity = true;
					Main.dust[num221].fadeIn = 1f;
				}
			}
		}
		else if (type == 460)
		{
			if (life > 0)
			{
				for (int num222 = 0; (double)num222 < dmg / (double)lifeMax * 100.0; num222++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num223 = 0; num223 < 50; num223++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 643, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 645, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 644, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 646, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 646, scale);
			}
		}
		else if (type == 477)
		{
			if (life > 0)
			{
				for (int num224 = 0; (double)num224 < dmg / (double)lifeMax * 100.0; num224++)
				{
					Dust.NewDust(position, width, height, 237, hitDirection, -1f);
				}
			}
			else
			{
				for (int num225 = 0; num225 < 50; num225++)
				{
					Dust.NewDust(position, width, height, 237, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 687, scale);
				Gore.NewGore(position, velocity, 688, scale);
				Gore.NewGore(position, velocity, 689, scale);
				Gore.NewGore(position, velocity, 690, scale);
				Gore.NewGore(position, velocity, 691, scale);
			}
		}
		else if (type == 479)
		{
			if (life > 0)
			{
				for (int num226 = 0; (double)num226 < dmg / (double)lifeMax * 100.0; num226++)
				{
					Dust.NewDust(position, width, height, 237, hitDirection, -1f);
				}
			}
			else
			{
				for (int num227 = 0; num227 < 50; num227++)
				{
					Dust.NewDust(position, width, height, 237, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 681, scale);
				Gore.NewGore(position, velocity, 682, scale);
				Gore.NewGore(position, velocity, 683, scale);
			}
		}
		else if (type == 478)
		{
			if (life > 0)
			{
				for (int num228 = 0; num228 < 10; num228++)
				{
					int num229 = Dust.NewDust(position, width, height, 238, hitDirection, -1f);
					Main.dust[num229].noGravity = true;
				}
			}
			else
			{
				for (int num230 = 0; num230 < 50; num230++)
				{
					Dust.NewDust(position, width, height, 237 + Main.rand.Next(2), 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 684, scale);
				Gore.NewGore(position, velocity, 685, scale);
				Gore.NewGore(position, velocity, 686, scale);
				Gore.NewGore(position, velocity, 684 + Main.rand.Next(3), scale);
			}
		}
		else if (type == 466)
		{
			if (life > 0)
			{
				for (int num231 = 0; (double)num231 < dmg / (double)lifeMax * 100.0; num231++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num232 = 0; num232 < 50; num232++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 656, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 657, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 659, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 658, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 658, scale);
			}
		}
		else if (type == 468)
		{
			if (life > 0)
			{
				for (int num233 = 0; (double)num233 < dmg / (double)lifeMax * 100.0; num233++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num234 = 0; num234 < 50; num234++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 662, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 663, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 663, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 664, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 664, scale);
			}
		}
		else if (type == 469)
		{
			if (life > 0)
			{
				for (int num235 = 0; (double)num235 < dmg / (double)lifeMax * 100.0; num235++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num236 = 0; num236 < 50; num236++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 665, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 666, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 666, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 667, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 667, scale);
			}
		}
		else if (type == 463)
		{
			if (life > 0)
			{
				for (int num237 = 0; (double)num237 < dmg / (double)lifeMax * 100.0; num237++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num238 = 0; num238 < 50; num238++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 653, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 654, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 654, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 655, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 655, scale);
			}
		}
		else if (type == 461)
		{
			if (life > 0)
			{
				for (int num239 = 0; (double)num239 < dmg / (double)lifeMax * 100.0; num239++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num240 = 0; num240 < 50; num240++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 647, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 648, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 648, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 649, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 649, scale);
			}
		}
		else if (type == 462)
		{
			if (life > 0)
			{
				for (int num241 = 0; (double)num241 < dmg / (double)lifeMax * 100.0; num241++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num242 = 0; num242 < 50; num242++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 650, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 651, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 651, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 652, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 652, scale);
			}
		}
		else if (type == 379 || type == 438)
		{
			if (life > 0)
			{
				for (int num243 = 0; (double)num243 < dmg / (double)(lifeMax * 50); num243++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num244 = 0; num244 < 30; num244++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 900, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 901, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 901, scale);
			}
		}
		else if (type == 439)
		{
			if (life > 0)
			{
				for (int num245 = 0; (double)num245 < dmg / (double)lifeMax * 100.0; num245++)
				{
					int num246 = Dust.NewDust(position, width, height, 5, 0f, 0f, 0, default(Color), 1.5f);
					Dust dust = Main.dust[num246];
					dust.velocity *= 1.5f;
					Main.dust[num246].noGravity = true;
				}
			}
			else
			{
				for (int num247 = 0; num247 < 30; num247++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				for (int num248 = 0; num248 < 10; num248++)
				{
					int num249 = Dust.NewDust(position, width, height, 16, 0f, 0f, 0, default(Color), 1.5f);
					Dust dust = Main.dust[num249];
					dust.velocity *= 2f;
					Main.dust[num249].noGravity = true;
				}
				int num250 = Main.rand.Next(1, 4);
				for (int num251 = 0; num251 < num250; num251++)
				{
					int num252 = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 10f), new Vector2(hitDirection, 0f), Main.rand.Next(11, 14), scale);
					Gore gore2 = Main.gore[num252];
					gore2.velocity *= 0.8f;
				}
				Gore.NewGore(position, velocity, 902, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 10f), velocity, 903, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 901, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 901, scale);
			}
		}
		else if (type == 440)
		{
			if (life <= 0)
			{
				for (int num253 = 0; num253 < 10; num253++)
				{
					int num254 = Dust.NewDust(position, width, height, 16, 0f, 0f, 0, default(Color), 1.5f);
					Dust dust = Main.dust[num254];
					dust.velocity *= 2f;
					Main.dust[num254].noGravity = true;
				}
				int num255 = Main.rand.Next(1, 4);
				for (int num256 = 0; num256 < num255; num256++)
				{
					int num257 = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 10f), new Vector2(hitDirection, 0f), Main.rand.Next(11, 14), scale);
					Gore gore2 = Main.gore[num257];
					gore2.velocity *= 0.8f;
				}
			}
		}
		else if (type >= 454 && type <= 459)
		{
			if (life > 0)
			{
				for (int num258 = 0; (double)num258 < dmg / (double)lifeMax * 50.0; num258++)
				{
					int num259 = Dust.NewDust(position, width, height, 16, 0f, 0f, 0, default(Color), 1.5f);
					Dust dust = Main.dust[num259];
					dust.velocity *= 1.5f;
					Main.dust[num259].noGravity = true;
				}
			}
			else
			{
				for (int num260 = 0; num260 < 10; num260++)
				{
					int num261 = Dust.NewDust(position, width, height, 16, 0f, 0f, 0, default(Color), 1.5f);
					Dust dust = Main.dust[num261];
					dust.velocity *= 2f;
					Main.dust[num261].noGravity = true;
				}
				int num262 = Main.rand.Next(1, 4);
				for (int num263 = 0; num263 < num262; num263++)
				{
					int num264 = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 10f), new Vector2(hitDirection, 0f), Main.rand.Next(11, 14), scale);
					Gore gore2 = Main.gore[num264];
					gore2.velocity *= 0.8f;
				}
			}
		}
		if (type == 372 || type == 373)
		{
			if (life > 0)
			{
				for (int num265 = 0; (double)num265 < dmg / (double)lifeMax * 100.0; num265++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num266 = 0; num266 < 75; num266++)
				{
					int num267 = Dust.NewDust(base.Center - Vector2.One * 25f, 50, 50, 5, 2 * hitDirection, -2f);
					Dust dust = Main.dust[num267];
					dust.velocity /= 2f;
				}
				Gore.NewGore(base.Center, velocity * 0.8f, 583);
				Gore.NewGore(base.Center, velocity * 0.8f, 577);
				Gore.NewGore(base.Center, velocity * 0.9f, 578);
				Gore.NewGore(base.Center, velocity, 579);
			}
		}
		if (type == 371)
		{
			SoundEngine.PlaySound(4, (int)position.X, (int)position.Y, 3);
			if (life <= 0)
			{
				Vector2 center = base.Center;
				for (int num268 = 0; num268 < 60; num268++)
				{
					int num269 = 25;
					Vector2 vector22 = ((float)Main.rand.NextDouble() * ((float)Math.PI * 2f)).ToRotationVector2() * Main.rand.Next(24, 41) / 8f;
					int num270 = Dust.NewDust(base.Center - Vector2.One * num269, num269 * 2, num269 * 2, 212);
					Dust dust61 = Main.dust[num270];
					Vector2 vector23 = Vector2.Normalize(dust61.position - base.Center);
					dust61.position = base.Center + vector23 * 25f * scale;
					if (num268 < 30)
					{
						dust61.velocity = vector23 * dust61.velocity.Length();
					}
					else
					{
						dust61.velocity = vector23 * Main.rand.Next(45, 91) / 10f;
					}
					dust61.color = Main.hslToRgb((float)(0.4000000059604645 + Main.rand.NextDouble() * 0.20000000298023224), 0.9f, 0.5f);
					dust61.color = Color.Lerp(dust61.color, Color.White, 0.3f);
					dust61.noGravity = true;
					dust61.scale = 0.7f;
				}
			}
		}
		if (type == 370)
		{
			if (life > 0)
			{
				for (int num271 = 0; (double)num271 < dmg / (double)lifeMax * 100.0; num271++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
			}
			else
			{
				for (int num272 = 0; num272 < 150; num272++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(base.Center - Vector2.UnitX * 20f * direction, velocity, 576, scale);
				Gore.NewGore(base.Center - Vector2.UnitY * 30f, velocity, 574, scale);
				Gore.NewGore(base.Center, velocity, 575, scale);
				Gore.NewGore(base.Center + Vector2.UnitX * 20f * direction, velocity, 573, scale);
				Gore.NewGore(base.Center - Vector2.UnitY * 30f, velocity, 574, scale);
				Gore.NewGore(base.Center, velocity, 575, scale);
			}
		}
		else if (type == 381)
		{
			if (life > 0)
			{
				for (int num273 = 0; (double)num273 < dmg / (double)(lifeMax * 50); num273++)
				{
					Dust.NewDust(position, width, height, 227, hitDirection, -1f);
				}
			}
			else
			{
				for (int num274 = 0; num274 < 30; num274++)
				{
					Dust.NewDust(position, width, height, 227, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 587, scale);
				Gore.NewGore(position, velocity, 590, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 588, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 589, scale);
			}
		}
		else if (type == 382 || type == 390)
		{
			if (life > 0)
			{
				for (int num275 = 0; (double)num275 < dmg / (double)(lifeMax * 50); num275++)
				{
					Dust.NewDust(position, width, height, 227, hitDirection, -1f);
				}
			}
			else
			{
				for (int num276 = 0; num276 < 30; num276++)
				{
					Dust.NewDust(position, width, height, 227, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 591, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 592, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 593, scale);
			}
		}
		else if (type == 383)
		{
			if (life > 0)
			{
				for (int num277 = 0; (double)num277 < dmg / (double)(lifeMax * 50); num277++)
				{
					Dust.NewDust(position, width, height, 227, hitDirection, -1f);
				}
			}
			else
			{
				for (int num278 = 0; num278 < 30; num278++)
				{
					Dust.NewDust(position, width, height, 227, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 594, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 595, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 596, scale);
			}
		}
		else if (type == 384)
		{
			if (life > 0)
			{
				for (int num279 = 0; (double)num279 < dmg / (double)lifeMax * 50.0; num279++)
				{
					int num280 = Dust.NewDust(position, width, height, 226, -1 * hitDirection, -1f);
					Main.dust[num280].position = Vector2.Lerp(Main.dust[num280].position, base.Center, 0.25f);
					Main.dust[num280].scale = 0.5f;
				}
			}
			else
			{
				for (int num281 = 0; num281 < 70; num281++)
				{
					int num282 = Dust.NewDust(position, width, height, 226, -2.5f * (float)hitDirection, -2.5f);
					Main.dust[num282].scale = 0.5f;
				}
			}
		}
		else if (type == 385)
		{
			if (life > 0)
			{
				for (int num283 = 0; (double)num283 < dmg / (double)(lifeMax * 50); num283++)
				{
					Dust.NewDust(position, width, height, 227, hitDirection, -1f);
				}
			}
			else
			{
				for (int num284 = 0; num284 < 30; num284++)
				{
					Dust.NewDust(position, width, height, 227, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 597, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 598, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 599, scale);
			}
		}
		else if (type == 386)
		{
			if (life > 0)
			{
				for (int num285 = 0; (double)num285 < dmg / (double)(lifeMax * 50); num285++)
				{
					Dust.NewDust(position, width, height, 227, hitDirection, -1f);
				}
			}
			else
			{
				for (int num286 = 0; num286 < 30; num286++)
				{
					Dust.NewDust(position, width, height, 227, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 600, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 601, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 602, scale);
			}
		}
		if (type == 387)
		{
			if (life > 0)
			{
				for (int num287 = 0; (double)num287 < dmg / (double)lifeMax * 20.0; num287++)
				{
					int num288 = Dust.NewDust(position, width, height, 226, -1 * hitDirection, -1f);
					Main.dust[num288].position = Vector2.Lerp(Main.dust[num288].position, base.Center, 0.25f);
					Main.dust[num288].scale = 0.5f;
				}
			}
			else
			{
				for (int num289 = 0; num289 < 30; num289++)
				{
					int num290 = Dust.NewDust(position, width, height, 226, -1.5f * (float)hitDirection, -1.5f);
					Main.dust[num290].scale = 0.5f;
				}
				Gore.NewGore(position, velocity, 603, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 603, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 604, scale);
			}
		}
		if (type == 520)
		{
			if (life > 0)
			{
				for (int num291 = 0; (double)num291 < dmg / (double)lifeMax * 20.0; num291++)
				{
					int num292 = Dust.NewDust(position, width, height, 226, -1 * hitDirection, -1f);
					Main.dust[num292].position = Vector2.Lerp(Main.dust[num292].position, base.Center, 0.25f);
					Main.dust[num292].scale = 0.5f;
				}
			}
			else
			{
				for (int num293 = 0; num293 < 30; num293++)
				{
					int num294 = Dust.NewDust(position, width, height, 226, -1.5f * (float)hitDirection, -1.5f);
					Main.dust[num294].scale = 0.5f;
				}
				Gore.NewGore(position, velocity, 851, scale);
				Gore.NewGore(position, velocity, 852, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 80f), velocity, 848, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 80f), velocity, 849, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 80f), velocity, 850, scale);
			}
		}
		else if (type == 389)
		{
			if (life > 0)
			{
				for (int num295 = 0; (double)num295 < dmg / (double)(lifeMax * 50); num295++)
				{
					Dust.NewDust(position, width, height, 227, hitDirection, -1f);
				}
			}
			else
			{
				for (int num296 = 0; num296 < 30; num296++)
				{
					Dust.NewDust(position, width, height, 227, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 904, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 905, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 906, scale);
			}
		}
		else if (type == 388)
		{
			if (life > 0)
			{
				for (int num297 = 0; (double)num297 < dmg / (double)(lifeMax * 50); num297++)
				{
					int num298 = Dust.NewDust(position, width, height, 226, -1 * hitDirection, -1f);
					Main.dust[num298].position = Vector2.Lerp(Main.dust[num298].position, base.Center, 0.25f);
					Main.dust[num298].scale = 0.5f;
				}
			}
			else
			{
				for (int num299 = 0; num299 < 10; num299++)
				{
					int num300 = Dust.NewDust(position, width, height, 226, -2.5f * (float)hitDirection, -2.5f);
					Main.dust[num300].scale = 0.5f;
				}
				Vector2 vector24 = velocity;
				if (ai[0] == 3f)
				{
					vector24 = rotation.ToRotationVector2();
					if (spriteDirection == 1)
					{
						vector24.X *= -1f;
					}
					vector24 *= 5f;
				}
				Gore.NewGore(base.Center - new Vector2(10f, 10f), vector24, 605, scale);
				Gore.NewGore(base.Center - new Vector2(10f, 10f), vector24, 606, scale);
			}
		}
		else if (type == 399)
		{
			if (life > 0)
			{
				for (int num301 = 0; (double)num301 < dmg / (double)(lifeMax * 50); num301++)
				{
					int num302 = Dust.NewDust(position, width, height, 226, -1 * hitDirection, -1f);
					Main.dust[num302].position = Vector2.Lerp(Main.dust[num302].position, base.Center, 0.25f);
					Main.dust[num302].scale = 0.5f;
				}
			}
			else
			{
				for (int num303 = 0; num303 < 10; num303++)
				{
					int num304 = Dust.NewDust(position, width, height, 226, -2.5f * (float)hitDirection, -2.5f);
					Main.dust[num304].scale = 0.5f;
				}
				Vector2 vector25 = velocity;
				if (ai[0] == 3f)
				{
					vector25 = rotation.ToRotationVector2();
					if (spriteDirection == 1)
					{
						vector25.X *= -1f;
					}
					vector25 *= 5f;
				}
				Gore.NewGore(base.Center - new Vector2(10f, 10f), vector25, 898, scale);
				Gore.NewGore(base.Center - new Vector2(10f, 10f), vector25, 899, scale);
			}
		}
		else if (type == 391)
		{
			if (life > 0)
			{
				for (int num305 = 0; (double)num305 < dmg / (double)(lifeMax * 50); num305++)
				{
					Dust.NewDust(position, width, height, 227, hitDirection, -1f);
				}
			}
			else
			{
				for (int num306 = 0; num306 < 30; num306++)
				{
					Dust.NewDust(position, width, height, 227, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position + Vector2.UnitX * width / 2f, velocity, 607, scale);
				Gore.NewGore(position + Vector2.UnitX * width / 2f, velocity, 608, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 609, scale);
			}
		}
		if (type == 392 || type == 394 || type == 393 || type == 395)
		{
			if (life > 0)
			{
				for (int num307 = 0; (double)num307 < dmg / (double)lifeMax * 20.0; num307++)
				{
					int num308 = Dust.NewDust(position, width, height, 228, -1 * hitDirection, -1f);
					Main.dust[num308].position = Vector2.Lerp(Main.dust[num308].position, base.Center, 0.25f);
					Main.dust[num308].scale = 0.5f;
				}
			}
			else
			{
				for (int num309 = 0; num309 < 30; num309++)
				{
					int num310 = Dust.NewDust(position, width, height, 228, -1.5f * (float)hitDirection, -1.5f);
					Main.dust[num310].scale = 0.5f;
				}
				Vector2 center2 = base.Center;
				if (type == 395)
				{
					Gore.NewGore(center2 + new Vector2(-20f, -10f), velocity, 610, scale);
					Gore.NewGore(center2 + new Vector2(20f, -10f), velocity, 611, scale);
					Gore.NewGore(center2 + new Vector2(-50f, 0f), velocity, 612, scale);
					Gore.NewGore(center2 + new Vector2(50f, 0f), velocity, 613, scale);
					Gore.NewGore(center2 + new Vector2(-60f, 10f), velocity, 614, scale);
					Gore.NewGore(center2 + new Vector2(0f, 30f), velocity, 615, scale);
				}
				if (type == 393)
				{
					Gore.NewGore(center2, velocity, 616, scale);
				}
				if (type == 394)
				{
					Gore.NewGore(center2, velocity, 617, scale);
				}
			}
		}
		else if (type == 482 || type == 483)
		{
			if (life > 0)
			{
				for (int num311 = 0; (double)num311 < dmg / (double)(lifeMax * 50); num311++)
				{
					Dust.NewDust(position, width, height, 240, hitDirection, -1f);
				}
			}
			else
			{
				for (int num312 = 0; num312 < 30; num312++)
				{
					Dust.NewDust(position, width, height, 240, 2.5f * (float)hitDirection, -2.5f);
				}
				if (type == 482)
				{
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 718, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 10f), velocity, 719, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 720, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 40f), velocity, 721, scale);
				}
			}
		}
		else if (type == 631)
		{
			if (life > 0)
			{
				for (int num313 = 0; (double)num313 < dmg / (double)(lifeMax * 50); num313++)
				{
					Dust.NewDust(position, width, height, 1, hitDirection, -1f);
				}
			}
			else
			{
				for (int num314 = 0; num314 < 30; num314++)
				{
					Dust.NewDust(position, width, height, 1, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(new Vector2(position.X, position.Y), velocity, 1210, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 10f), velocity, 1211, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 1212, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 40f), velocity, 1213, scale);
			}
		}
		if (type >= 0 && NPCID.Sets.IsGoldCritter[type])
		{
			if (life > 0)
			{
				for (int num315 = 0; num315 < 10; num315++)
				{
					Dust.NewDust(position, width, height, Main.rand.Next(232, 234), hitDirection, -1f);
				}
			}
			else
			{
				for (int num316 = 0; num316 < 20; num316++)
				{
					Dust.NewDust(position, width, height, Main.rand.Next(232, 234), 2 * hitDirection, -2f);
				}
			}
		}
		if (type == 653 && life <= 0)
		{
			for (int num317 = 0; num317 < 6; num317++)
			{
				int num318 = Dust.NewDust(position, width, height, 174, 2 * hitDirection, -2f);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num318].noGravity = true;
					Main.dust[num318].scale = 1.5f * scale;
				}
				else
				{
					Main.dust[num318].scale = 0.8f * scale;
				}
			}
		}
		if (type == 333 || type == 334 || type == 335 || type == 336)
		{
			Color newColor7 = Color.White;
			if (type == 333)
			{
				newColor7 = new Color(73, 147, 221, 200);
			}
			if (type == 334)
			{
				newColor7 = new Color(24, 146, 79, 200);
			}
			if (type == 335)
			{
				newColor7 = new Color(194, 46, 50, 200);
			}
			if (type == 336)
			{
				newColor7 = new Color(228, 200, 1, 200);
			}
			if (life > 0)
			{
				for (int num319 = 0; (double)num319 < dmg / (double)lifeMax * 100.0; num319++)
				{
					Dust.NewDust(position, width, height, 4, hitDirection, -1f, 150, newColor7);
				}
			}
			else
			{
				for (int num320 = 0; num320 < 50; num320++)
				{
					Dust.NewDust(position, width, height, 4, 2 * hitDirection, -2f, 150, newColor7);
				}
			}
		}
		if (type == 537)
		{
			if (life > 0)
			{
				for (int num321 = 0; (double)num321 < dmg / (double)lifeMax * 100.0; num321++)
				{
					Dust.NewDust(position, width, height, 32, hitDirection, -1f);
				}
			}
			else
			{
				for (int num322 = 0; num322 < 50; num322++)
				{
					Dust.NewDust(position, width, height, 32, 2 * hitDirection, -2f);
				}
			}
		}
		if (type == 1 || type == 16 || type == 71 || type == 244 || type == 535)
		{
			if (type == 1 && ai[1] == 1345f)
			{
				int num323 = 5;
				if (life <= 0)
				{
					num323 *= 3;
				}
				for (int num324 = 0; num324 < num323 * 2; num324++)
				{
					int num325 = Main.rand.Next(139, 143);
					int num326 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num325, 0f, -10f, 0, default(Color), 1.2f);
					Dust dust = Main.dust[num326];
					dust.scale *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
					Main.dust[num326].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
				}
				for (int num327 = 0; num327 < num323; num327++)
				{
					int num328 = Main.rand.Next(276, 283);
					int num329 = Gore.NewGore(position, new Vector2(0f, -10f), num328);
					Gore gore2 = Main.gore[num329];
					gore2.scale *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
					Main.gore[num329].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
				}
			}
			if (life > 0)
			{
				for (int num330 = 0; (double)num330 < dmg / (double)lifeMax * 100.0; num330++)
				{
					Dust.NewDust(position, width, height, 4, hitDirection, -1f, alpha, this.color);
				}
			}
			else
			{
				for (int num331 = 0; num331 < 50; num331++)
				{
					Dust.NewDust(position, width, height, 4, 2 * hitDirection, -2f, alpha, this.color);
				}
				if (Main.netMode != 1 && type == 16)
				{
					int num332 = Main.rand.Next(2) + 2;
					for (int num333 = 0; num333 < num332; num333++)
					{
						int num334 = NewNPC(GetSpawnSource_NPCHurt(), (int)(position.X + (float)(width / 2)), (int)(position.Y + (float)height), 1);
						Main.npc[num334].SetDefaults(-5);
						Main.npc[num334].velocity.X = velocity.X * 2f;
						Main.npc[num334].velocity.Y = velocity.Y;
						Main.npc[num334].velocity.X += (float)Main.rand.Next(-20, 20) * 0.1f + (float)(num333 * direction) * 0.3f;
						Main.npc[num334].velocity.Y -= (float)Main.rand.Next(0, 10) * 0.1f + (float)num333;
						Main.npc[num334].ai[0] = -1000 * Main.rand.Next(3);
						if (Main.netMode == 2 && num334 < Main.maxNPCs)
						{
							NetMessage.SendData(23, -1, -1, null, num334);
						}
					}
				}
			}
		}
		if (type == 352)
		{
			if (life > 0)
			{
				for (int num335 = 0; (double)num335 < dmg / (double)lifeMax * 100.0; num335++)
				{
					int num336 = Dust.NewDust(position, width, height, 67, hitDirection, -1f);
					Main.dust[num336].noGravity = true;
				}
			}
			else
			{
				for (int num337 = 0; num337 < 60; num337++)
				{
					int num338 = Dust.NewDust(position, width, height, 67, 2 * hitDirection, -2f);
					Main.dust[num338].noGravity = true;
				}
			}
		}
		if (type >= 305 && type <= 314)
		{
			if (life > 0)
			{
				for (int num339 = 0; (double)num339 < dmg / (double)lifeMax * 100.0; num339++)
				{
					Dust.NewDust(position, width, height, 194, hitDirection, -1f, 0, default(Color), 1.1f);
				}
			}
			else
			{
				for (int num340 = 0; num340 < 60; num340++)
				{
					Dust.NewDust(position, width, height, 194, 2 * hitDirection, -2f, 0, default(Color), 1.1f);
				}
				Gore.NewGore(position, velocity, 441, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 442, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 443, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 444, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 445, scale);
			}
		}
		if (type == 327)
		{
			if (life > 0)
			{
				for (int num341 = 0; (double)num341 < dmg / (double)lifeMax * 100.0; num341++)
				{
					Dust.NewDust(position, width, height, 189, hitDirection, -1f, 0, default(Color), 1.1f);
				}
			}
			else
			{
				for (int num342 = 0; num342 < 60; num342++)
				{
					Dust.NewDust(position, width, height, 189, 2 * hitDirection, -2f, 0, default(Color), 1.1f);
				}
				for (int num343 = 476; num343 <= 484; num343++)
				{
					Gore.NewGore(new Vector2(position.X, position.Y), velocity * 0f, num343, scale);
				}
			}
		}
		if (type == 325)
		{
			if (life > 0)
			{
				for (int num344 = 0; (double)num344 < dmg / (double)lifeMax * 100.0; num344++)
				{
					Dust.NewDust(position, width, height, 191, hitDirection, -1f, 0, default(Color), 1.1f);
				}
			}
			else
			{
				for (int num345 = 0; num345 < 60; num345++)
				{
					Dust.NewDust(position, width, height, 191, 2 * hitDirection, -2f, 0, default(Color), 1.1f);
				}
				for (int num346 = 469; num346 <= 475; num346++)
				{
					Gore.NewGore(new Vector2(position.X, position.Y), velocity * 0f, num346, scale);
				}
			}
		}
		if (type == 345 && life <= 0)
		{
			Gore.NewGore(new Vector2(position.X, position.Y), velocity * 0f, 513, scale);
			Gore.NewGore(new Vector2(position.X, position.Y), velocity * 0f, 514, scale);
			Gore.NewGore(new Vector2(position.X, position.Y), velocity * 0f, 514, scale);
			Gore.NewGore(new Vector2(position.X, position.Y), velocity * 0f, 515, scale);
			Gore.NewGore(new Vector2(position.X, position.Y), velocity * 0f, 516, scale);
		}
		if (type == 344)
		{
			if (life > 0)
			{
				for (int num347 = 0; (double)num347 < dmg / (double)lifeMax * 100.0; num347++)
				{
					Dust.NewDust(position, width, height, 196, hitDirection, -1f);
				}
			}
			else
			{
				for (int num348 = 0; num348 < 60; num348++)
				{
					Dust.NewDust(position, width, height, 196, 2 * hitDirection, -2f);
				}
				for (int num349 = 508; num349 <= 512; num349++)
				{
					Gore.NewGore(new Vector2(position.X, position.Y), velocity * 0f, num349, scale);
				}
				for (int num350 = 509; num350 <= 512; num350++)
				{
					Gore.NewGore(new Vector2(position.X, position.Y), velocity * 0f, num350, scale);
				}
			}
		}
		if (type == 326)
		{
			if (life > 0)
			{
				for (int num351 = 0; (double)num351 < dmg / (double)lifeMax * 100.0; num351++)
				{
					Dust.NewDust(position, width, height, 191, hitDirection, -1f, 0, default(Color), 1.1f);
				}
			}
			else
			{
				for (int num352 = 0; num352 < 60; num352++)
				{
					Dust.NewDust(position, width, height, 191, 2 * hitDirection, -2f, 0, default(Color), 1.1f);
				}
			}
		}
		if (type == 304)
		{
			if (life > 0)
			{
				for (int num353 = 0; (double)num353 < dmg / (double)lifeMax * 100.0; num353++)
				{
					Dust.NewDust(position, width, height, 189, hitDirection, -1f, 0, default(Color), 1.3f);
				}
			}
			else
			{
				for (int num354 = 0; num354 < 60; num354++)
				{
					Dust.NewDust(position, width, height, 189, 2 * hitDirection, -2f, 0, default(Color), 1.3f);
				}
			}
		}
		if (type == 302)
		{
			if (life > 0)
			{
				for (int num355 = 0; (double)num355 < dmg / (double)lifeMax * 100.0; num355++)
				{
					Dust.NewDust(position, width, height, 192, hitDirection, -1f, 100, new Color(100, 100, 100, 100));
				}
			}
			else
			{
				for (int num356 = 0; num356 < 50; num356++)
				{
					Dust.NewDust(position, width, height, 192, 2 * hitDirection, -2f, 100, new Color(100, 100, 100, 100));
				}
				Gore.NewGore(position, velocity, 440, scale);
			}
		}
		if (type >= 245 && type <= 249)
		{
			if (life > 0)
			{
				for (int num357 = 0; (double)num357 < dmg / (double)lifeMax * 100.0; num357++)
				{
					Dust.NewDust(position, width, height, 148, hitDirection, -1f);
				}
			}
			else if (type == 246)
			{
				if (Main.netMode != 1)
				{
					NewNPC(GetSpawnSource_NPCHurt(), (int)base.Center.X, (int)position.Y + height, 249, whoAmI);
				}
			}
			else
			{
				for (int num358 = 0; num358 < 50; num358++)
				{
					Dust.NewDust(position, width, height, 148, 2 * hitDirection, -2f);
				}
				if (type == 245)
				{
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 368, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 370, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 368, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 370, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 368, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 370, scale);
					Gore.NewGore(position, velocity, 360, scale);
					Gore.NewGore(position, velocity, 361, scale);
					Gore.NewGore(position, velocity, 362, scale);
					Gore.NewGore(position, velocity, 363, scale);
					Gore.NewGore(position, velocity, 364, scale);
					Gore.NewGore(position, velocity, 367, scale);
					Gore.NewGore(position, velocity, 366, scale);
				}
				else if (type == 249)
				{
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 368, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 370, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 368, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 370, scale);
					Gore.NewGore(position, velocity, 365, scale);
					Gore.NewGore(position, velocity, 363, scale);
					Gore.NewGore(position, velocity, 362, scale);
				}
				else
				{
					Gore.NewGore(position, velocity, 369, scale);
					Gore.NewGore(position, velocity, 371, scale);
					Gore.NewGore(position, velocity, 370, scale);
				}
			}
		}
		if (type == 288 && life <= 0)
		{
			for (int num359 = 0; num359 < 50; num359++)
			{
				int num360 = Dust.NewDust(position, width, height, 180, velocity.X, velocity.Y);
				Dust dust = Main.dust[num360];
				dust.velocity *= 2f;
				Main.dust[num360].noGravity = true;
				Main.dust[num360].scale = 1.4f;
			}
		}
		if (type == 204)
		{
			if (life > 0)
			{
				for (int num361 = 0; (double)num361 < dmg / (double)lifeMax * 100.0; num361++)
				{
					Dust.NewDust(position, width, height, 4, hitDirection, -1f, 100, new Color(149, 208, 104));
				}
			}
			else
			{
				for (int num362 = 0; num362 < 50; num362++)
				{
					Dust.NewDust(position, width, height, 4, 2 * hitDirection, -2f, 100, new Color(149, 208, 104));
				}
			}
		}
		if (type == 225)
		{
			if (life > 0)
			{
				for (int num363 = 0; (double)num363 < dmg / (double)lifeMax * 100.0; num363++)
				{
					Dust.NewDust(position, width, height, 4, hitDirection, -1f, 100, new Color(0, 80, 255, 100));
				}
			}
			else
			{
				for (int num364 = 0; num364 < 50; num364++)
				{
					Dust.NewDust(position, width, height, 4, 2 * hitDirection, -2f, 100, new Color(0, 80, 255, 100));
				}
				Gore.NewGore(position, velocity, 314, scale);
			}
		}
		if (type == 243)
		{
			if (life > 0)
			{
				for (int num365 = 0; (double)num365 < dmg / (double)lifeMax * 150.0; num365++)
				{
					Dust.NewDust(position, width, height, 161, hitDirection, -1f);
				}
			}
			else
			{
				for (int num366 = 0; num366 < 200; num366++)
				{
					Dust.NewDust(position, width, height, 161, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 359, scale);
			}
		}
		if ((type == 210 || type == 211) && life <= 0)
		{
			for (int num367 = 0; num367 < 6; num367++)
			{
				int num368 = Dust.NewDust(position, width, height, 150, 2 * hitDirection, -2f);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num368].noGravity = true;
					Main.dust[num368].scale = 1.5f;
				}
				else
				{
					Main.dust[num368].scale = 0.8f;
				}
			}
		}
		if ((type == 355 || type == 358 || type == 654) && life <= 0)
		{
			for (int num369 = 0; num369 < 6; num369++)
			{
				int num370 = Dust.NewDust(position, width, height, 198, 2 * hitDirection, -2f);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num370].noGravity = true;
					Main.dust[num370].scale = 1.5f * scale;
				}
				else
				{
					Main.dust[num370].scale = 0.8f * scale;
				}
			}
		}
		if (type == 677 && life <= 0)
		{
			ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.ShimmerArrow, new ParticleOrchestraSettings
			{
				PositionInWorld = base.Center,
				MovementVector = velocity
			});
			for (int num371 = 0; num371 < 6; num371++)
			{
				int num372 = Dust.NewDust(position, width, height, 310, 2 * hitDirection, -2f);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num372].noGravity = true;
					Main.dust[num372].scale = 1.5f * scale;
				}
				else
				{
					Main.dust[num372].scale = 0.8f * scale;
				}
			}
		}
		if (type == 604 && life <= 0)
		{
			for (int num373 = 0; num373 < 6; num373++)
			{
				int num374 = Dust.NewDust(position, width, height, 198, 2 * hitDirection, -2f);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num374].noGravity = true;
					Main.dust[num374].scale = 1.5f * scale;
				}
				else
				{
					Main.dust[num374].scale = 0.8f * scale;
				}
			}
			if (Main.rand.Next(2) == 0)
			{
				Gore.NewGore(position, velocity, 1148);
			}
			if (Main.rand.Next(2) == 0)
			{
				Gore.NewGore(position, velocity, 1149);
			}
		}
		if (type == 669 && life <= 0)
		{
			for (int num375 = 0; num375 < 6; num375++)
			{
				int num376 = Dust.NewDust(position, width, height, 198, 2 * hitDirection, -2f);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num376].noGravity = true;
					Main.dust[num376].scale = 1.5f * scale;
				}
				else
				{
					Main.dust[num376].scale = 0.8f * scale;
				}
			}
			if (Main.rand.Next(2) == 0)
			{
				Gore.NewGore(position, velocity, 1275);
			}
			if (Main.rand.Next(2) == 0)
			{
				Gore.NewGore(position, velocity, 1276);
			}
		}
		if (type == 356 && life <= 0)
		{
			for (int num377 = 0; num377 < 6; num377++)
			{
				int num378 = Dust.NewDust(position, width, height, 199, 2 * hitDirection, -2f);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num378].noGravity = true;
					Main.dust[num378].scale = 1.5f * scale;
				}
				else
				{
					Main.dust[num378].scale = 0.8f * scale;
				}
			}
		}
		if (type >= 484 && type <= 487 && life <= 0)
		{
			for (int num379 = 0; num379 < 6; num379++)
			{
				int num380 = Dust.NewDust(position, width, height, 248 + type - 484, 2 * hitDirection, -2f);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num380].noGravity = true;
					Main.dust[num380].scale = 1.2f * scale;
				}
				else
				{
					Main.dust[num380].scale = 0.7f * scale;
				}
			}
		}
		if (type == 357 && life <= 0)
		{
			for (int num381 = 0; num381 < 6; num381++)
			{
				int num382 = Dust.NewDust(position, width, height, 200, 2 * hitDirection, -2f);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num382].noGravity = true;
					Main.dust[num382].scale = 1.2f * scale;
				}
				else
				{
					Main.dust[num382].scale = 0.7f * scale;
				}
			}
		}
		if (type == 606 && life <= 0)
		{
			for (int num383 = 0; num383 < 6; num383++)
			{
				int num384 = Dust.NewDust(position, width, height, 124, 2 * hitDirection, -2f);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num384].noGravity = true;
					Main.dust[num384].scale = 1.2f * scale;
				}
				else
				{
					Main.dust[num384].scale = 0.7f * scale;
				}
			}
		}
		if (type == 377 && life <= 0)
		{
			for (int num385 = 0; num385 < 6; num385++)
			{
				int num386 = Dust.NewDust(position, width, height, 40, 2 * hitDirection, -2f);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num386].noGravity = true;
					Main.dust[num386].scale = 1.2f * scale;
				}
				else
				{
					Main.dust[num386].scale = 0.7f * scale;
				}
			}
		}
		if (type == 374 || type == 375)
		{
			for (int num387 = 0; num387 < 6; num387++)
			{
				int num388 = Dust.NewDust(position, width, height, 165, 0f, 0f, 50, default(Color), 1.5f);
				Dust dust = Main.dust[num388];
				dust.velocity *= 2f;
				Main.dust[num388].noGravity = true;
			}
		}
		if (type == 359)
		{
			if (life <= 0)
			{
				for (int num389 = 0; num389 < 6; num389++)
				{
					int num390 = Dust.NewDust(position, width, height, 201, 2 * hitDirection, -2f);
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num390].noGravity = true;
						Main.dust[num390].scale = 1.2f * scale;
					}
					else
					{
						Main.dust[num390].scale = 0.7f * scale;
					}
				}
			}
			Gore.NewGore(position, velocity, 547, scale);
			Gore.NewGore(position, velocity, 548, scale);
		}
		if (type == 360)
		{
			if (life <= 0)
			{
				for (int num391 = 0; num391 < 6; num391++)
				{
					int num392 = Dust.NewDust(position, width, height, 202, 2 * hitDirection, -2f);
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num392].noGravity = true;
						Main.dust[num392].scale = 1.2f * scale;
					}
					else
					{
						Main.dust[num392].scale = 0.7f * scale;
					}
				}
			}
			Gore.NewGore(position, velocity, 549, scale);
			Gore.NewGore(position, velocity, 550, scale);
		}
		if (type == 655)
		{
			if (life <= 0)
			{
				for (int num393 = 0; num393 < 6; num393++)
				{
					int num394 = Dust.NewDust(position, width, height, 174, 2 * hitDirection, -2f);
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num394].noGravity = true;
						Main.dust[num394].scale = 1.2f * scale;
					}
					else
					{
						Main.dust[num394].scale = 0.7f * scale;
					}
				}
			}
			Gore.NewGore(position, velocity, 1256, scale);
		}
		if (type == 154)
		{
			if (life > 0)
			{
				for (int num395 = 0; (double)num395 < dmg / (double)lifeMax * 50.0; num395++)
				{
					int num396 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 67, velocity.X, velocity.Y, 90, default(Color), 1.5f);
					Main.dust[num396].noGravity = true;
					Dust dust = Main.dust[num396];
					dust.velocity *= 0.2f;
				}
			}
			else
			{
				for (int num397 = 0; num397 < 50; num397++)
				{
					int num398 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 67, velocity.X, velocity.Y, 90, default(Color), 1.5f);
					Main.dust[num398].noGravity = true;
					Dust dust = Main.dust[num398];
					dust.velocity *= 0.2f;
				}
				Gore.NewGore(position, velocity, 180, scale);
			}
		}
		if (type == 147 || type == 184)
		{
			if (life > 0)
			{
				for (int num399 = 0; (double)num399 < dmg / (double)lifeMax * 50.0; num399++)
				{
					int num400 = Dust.NewDust(position, width, height, 76, hitDirection, -1f);
					Main.dust[num400].noGravity = true;
					Dust.NewDust(position, width, height, 4, hitDirection, -1f, 100, new Color(97, 200, 255, 100));
				}
			}
			else
			{
				for (int num401 = 0; num401 < 30; num401++)
				{
					int num402 = Dust.NewDust(position, width, height, 76, hitDirection, -2f);
					Main.dust[num402].noGravity = true;
					Dust.NewDust(position, width, height, 4, hitDirection, -2f, 100, new Color(97, 200, 255, 100));
				}
			}
		}
		if (type == 143 || type == 144 || type == 145)
		{
			if (life > 0)
			{
				for (int num403 = 0; (double)num403 < dmg / (double)lifeMax * 100.0; num403++)
				{
					int num404 = Dust.NewDust(position, width, height, 76, hitDirection, -1f);
					Main.dust[num404].noGravity = true;
				}
			}
			else
			{
				for (int num405 = 0; num405 < 50; num405++)
				{
					int num406 = Dust.NewDust(position, width, height, 76, hitDirection, -1f);
					Main.dust[num406].noGravity = true;
					Dust dust = Main.dust[num406];
					dust.scale *= 1.2f;
				}
			}
		}
		if (type == 141)
		{
			if (life > 0)
			{
				for (int num407 = 0; (double)num407 < dmg / (double)lifeMax * 100.0; num407++)
				{
					Dust.NewDust(position, width, height, 4, hitDirection, -1f, alpha, new Color(210, 230, 140));
				}
			}
			else
			{
				for (int num408 = 0; num408 < 50; num408++)
				{
					Dust.NewDust(position, width, height, 4, 2 * hitDirection, -2f, alpha, new Color(210, 230, 140));
				}
			}
		}
		if (type == 112 || type == 666)
		{
			for (int num409 = 0; num409 < 20; num409++)
			{
				int num410 = Dust.NewDust(new Vector2(position.X, position.Y + 2f), width, height, 18, 0f, 0f, 100, default(Color), 2f);
				if (Main.rand.Next(2) == 0)
				{
					Dust dust = Main.dust[num410];
					dust.scale *= 0.6f;
				}
				else
				{
					Dust dust = Main.dust[num410];
					dust.velocity *= 1.4f;
					Main.dust[num410].noGravity = true;
				}
			}
		}
		if (type == 183)
		{
			if (life > 0)
			{
				for (int num411 = 0; (double)num411 < dmg / (double)lifeMax * 100.0; num411++)
				{
					Dust.NewDust(position, width, height, 136, 0f, 0f, alpha, this.color);
				}
			}
			else
			{
				for (int num412 = 0; num412 < 50; num412++)
				{
					int num413 = Dust.NewDust(position, width, height, 136, hitDirection, 0f, alpha, this.color);
					Dust dust = Main.dust[num413];
					dust.velocity *= 2f;
				}
			}
		}
		if (type == 81 || type == 121)
		{
			if (life > 0)
			{
				for (int num414 = 0; (double)num414 < dmg / (double)lifeMax * 100.0; num414++)
				{
					Dust.NewDust(position, width, height, 14, 0f, 0f, alpha, this.color);
				}
			}
			else
			{
				for (int num415 = 0; num415 < 50; num415++)
				{
					int num416 = Dust.NewDust(position, width, height, 14, hitDirection, 0f, alpha, this.color);
					Dust dust = Main.dust[num416];
					dust.velocity *= 2f;
				}
				if (Main.netMode != 1)
				{
					if (type == 121)
					{
						int num417 = NewNPC(GetSpawnSource_NPCHurt(), (int)(position.X + (float)(width / 2)), (int)(position.Y + (float)height), 81);
						Main.npc[num417].SetDefaults(-2);
						Main.npc[num417].velocity.X = velocity.X;
						Main.npc[num417].velocity.Y = velocity.Y;
						Gore.NewGore(position, velocity, 94, scale);
						if (Main.netMode == 2 && num417 < Main.maxNPCs)
						{
							NetMessage.SendData(23, -1, -1, null, num417);
						}
					}
					else if (scale >= 1f)
					{
						int num418 = Main.rand.Next(2) + 2;
						for (int num419 = 0; num419 < num418; num419++)
						{
							int num420 = NewNPC(GetSpawnSource_NPCHurt(), (int)(position.X + (float)(width / 2)), (int)(position.Y + (float)height), 1);
							Main.npc[num420].SetDefaults(-1);
							Main.npc[num420].velocity.X = velocity.X * 3f;
							Main.npc[num420].velocity.Y = velocity.Y;
							Main.npc[num420].velocity.X += (float)Main.rand.Next(-10, 10) * 0.1f + (float)(num419 * direction) * 0.3f;
							Main.npc[num420].velocity.Y -= (float)Main.rand.Next(0, 10) * 0.1f + (float)num419;
							Main.npc[num420].ai[1] = num419;
							if (Main.netMode == 2 && num420 < Main.maxNPCs)
							{
								NetMessage.SendData(23, -1, -1, null, num420);
							}
						}
					}
				}
			}
		}
		if (type == 120 || type == 137 || type == 138)
		{
			if (life > 0)
			{
				for (int num421 = 0; (double)num421 < dmg / (double)lifeMax * 50.0; num421++)
				{
					int num422 = Dust.NewDust(position, width, height, 71, 0f, 0f, 200);
					Dust dust = Main.dust[num422];
					dust.velocity *= 1.5f;
				}
			}
			else
			{
				for (int num423 = 0; num423 < 50; num423++)
				{
					int num424 = Dust.NewDust(position, width, height, 71, hitDirection, 0f, 200);
					Dust dust = Main.dust[num424];
					dust.velocity *= 1.5f;
				}
			}
		}
		if (type == 122)
		{
			if (life > 0)
			{
				for (int num425 = 0; (double)num425 < dmg / (double)lifeMax * 50.0; num425++)
				{
					int num426 = Dust.NewDust(position, width, height, 72, 0f, 0f, 200);
					Dust dust = Main.dust[num426];
					dust.velocity *= 1.5f;
				}
			}
			else
			{
				for (int num427 = 0; num427 < 50; num427++)
				{
					int num428 = Dust.NewDust(position, width, height, 72, hitDirection, 0f, 200);
					Dust dust = Main.dust[num428];
					dust.velocity *= 1.5f;
				}
			}
		}
		if (type == 75)
		{
			if (life > 0)
			{
				for (int num429 = 0; (double)num429 < dmg / (double)lifeMax * 50.0; num429++)
				{
					Dust.NewDust(position, width, height, 55, 0f, 0f, 200, this.color);
				}
			}
			else
			{
				for (int num430 = 0; num430 < 50; num430++)
				{
					int num431 = Dust.NewDust(position, width, height, 55, hitDirection, 0f, 200, this.color);
					Dust dust = Main.dust[num431];
					dust.velocity *= 2f;
				}
			}
		}
		if (type == 63 || type == 64 || type == 103)
		{
			Color newColor8 = new Color(50, 120, 255, 100);
			if (type == 64)
			{
				newColor8 = new Color(225, 70, 140, 100);
			}
			if (type == 103)
			{
				newColor8 = new Color(70, 225, 140, 100);
			}
			if (life > 0)
			{
				for (int num432 = 0; (double)num432 < dmg / (double)lifeMax * 50.0; num432++)
				{
					Dust.NewDust(position, width, height, 4, hitDirection, -1f, 0, newColor8);
				}
			}
			else
			{
				for (int num433 = 0; num433 < 25; num433++)
				{
					Dust.NewDust(position, width, height, 4, 2 * hitDirection, -2f, 0, newColor8);
				}
			}
		}
		else
		{
			if (type == 59 || type == 60 || type == 151)
			{
				if (life > 0)
				{
					for (int num434 = 0; (double)num434 < dmg / (double)lifeMax * 80.0; num434++)
					{
						int num435 = Dust.NewDust(position, width, height, 6, hitDirection * 2, -1f, alpha, default(Color), 1.5f);
						if (Main.rand.Next(8) != 0)
						{
							Main.dust[num435].noGravity = true;
						}
					}
					return;
				}
				for (int num436 = 0; num436 < 40; num436++)
				{
					int num437 = Dust.NewDust(position, width, height, 6, hitDirection * 2, -1f, alpha, default(Color), 1.5f);
					if (Main.rand.Next(8) != 0)
					{
						Main.dust[num437].noGravity = true;
					}
				}
				if ((Main.expertMode || WorldGen.Skyblock.lowTiles) && type == 59 && Main.netMode != 1 && !Main.remixWorld)
				{
					try
					{
						if (WorldGen.Skyblock.lowTiles)
						{
							int num438 = (int)(base.Left.X / 16f);
							int num439 = (int)(base.Right.X / 16f);
							int num440 = (int)(base.Top.Y / 16f);
							int num441 = (int)(base.Bottom.Y / 16f);
							for (int num442 = num438; num442 <= num439; num442++)
							{
								for (int num443 = num440; num443 <= num441; num443++)
								{
									if (!WorldGen.SolidTile(num442, num443) && Main.tile[num442, num443].liquid == 0)
									{
										Main.tile[num442, num443].liquid = byte.MaxValue;
										Main.tile[num442, num443].lava(lava: true);
										Main.tile[num442, num443].honey(honey: false);
										WorldGen.SquareTileFrame(num442, num443);
									}
								}
							}
						}
						else
						{
							int num444 = (int)(base.Center.X / 16f);
							int num445 = (int)(base.Center.Y / 16f);
							if (!WorldGen.SolidTile(num444, num445) && Main.tile[num444, num445].liquid == 0)
							{
								Main.tile[num444, num445].liquid = (byte)Main.rand.Next(50, 150);
								Main.tile[num444, num445].lava(lava: true);
								Main.tile[num444, num445].honey(honey: false);
								WorldGen.SquareTileFrame(num444, num445);
							}
						}
					}
					catch
					{
					}
				}
				if ((type != 151 && type != 60) || Main.netMode == 1 || !Main.remixWorld || (!Main.getGoodWorld && !WorldGen.Skyblock.lowTiles))
				{
					return;
				}
				try
				{
					if (WorldGen.Skyblock.lowTiles)
					{
						int num446 = (int)(base.Left.X / 16f);
						int num447 = (int)(base.Right.X / 16f);
						int num448 = (int)(base.Top.Y / 16f);
						int num449 = (int)(base.Bottom.Y / 16f);
						for (int num450 = num446; num450 <= num447; num450++)
						{
							for (int num451 = num448; num451 <= num449; num451++)
							{
								if (!WorldGen.SolidTile(num450, num451) && Main.tile[num450, num451].liquid == 0)
								{
									Main.tile[num450, num451].liquid = byte.MaxValue;
									Main.tile[num450, num451].lava(lava: true);
									Main.tile[num450, num451].honey(honey: false);
									WorldGen.SquareTileFrame(num450, num451);
								}
							}
						}
					}
					else
					{
						int num452 = (int)(base.Center.X / 16f);
						int num453 = (int)(base.Center.Y / 16f);
						if (!WorldGen.SolidTile(num452, num453) && Main.tile[num452, num453].liquid == 0)
						{
							Main.tile[num452, num453].liquid = (byte)Main.rand.Next(50, 150);
							Main.tile[num452, num453].lava(lava: true);
							Main.tile[num452, num453].honey(honey: false);
							WorldGen.SquareTileFrame(num452, num453);
						}
					}
					return;
				}
				catch
				{
					return;
				}
			}
			if (type == 50)
			{
				if (life > 0)
				{
					for (int num454 = 0; (double)num454 < dmg / (double)lifeMax * 300.0; num454++)
					{
						Dust.NewDust(position, width, height, 4, hitDirection, -1f, 175, new Color(0, 80, 255, 100));
					}
					return;
				}
				for (int num455 = 0; num455 < 200; num455++)
				{
					Dust.NewDust(position, width, height, 4, 2 * hitDirection, -2f, 175, new Color(0, 80, 255, 100));
				}
				Gore.NewGore(base.Center + new Vector2(-40f, -height / 2), velocity, 734);
				if (Main.netMode == 1)
				{
					return;
				}
				int num456 = Main.rand.Next(4) + 4;
				for (int num457 = 0; num457 < num456; num457++)
				{
					int x = (int)(position.X + (float)Main.rand.Next(width - 32));
					int y = (int)(position.Y + (float)Main.rand.Next(height - 32));
					int num458 = NewNPC(GetSpawnSource_NPCHurt(), x, y, 1, whoAmI + 1);
					Main.npc[num458].SetDefaults(1);
					Main.npc[num458].velocity.X = (float)Main.rand.Next(-15, 16) * 0.1f;
					Main.npc[num458].velocity.Y = (float)Main.rand.Next(-30, 1) * 0.1f;
					Main.npc[num458].ai[0] = -1000 * Main.rand.Next(3);
					Main.npc[num458].ai[1] = 0f;
					if (Main.netMode == 2 && num458 < Main.maxNPCs)
					{
						NetMessage.SendData(23, -1, -1, null, num458);
					}
				}
			}
			else if (type == 153)
			{
				if (life > 0)
				{
					for (int num459 = 0; (double)num459 < dmg / (double)lifeMax * 30.0; num459++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num460 = 0; num460 < 15; num460++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 177);
				Gore.NewGore(position, velocity, 178);
				Gore.NewGore(position, velocity, 179);
				Gore.NewGore(position, velocity, 179);
			}
			else if (type == 177)
			{
				if (life > 0)
				{
					for (int num461 = 0; (double)num461 < dmg / (double)lifeMax * 30.0; num461++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num462 = 0; num462 < 15; num462++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 234);
				Gore.NewGore(position, velocity, 235);
				Gore.NewGore(position, velocity, 236);
				Gore.NewGore(position, velocity, 236);
			}
			else if (type >= 494 && type <= 495)
			{
				if (life > 0)
				{
					for (int num463 = 0; (double)num463 < dmg / (double)lifeMax * 30.0; num463++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num464 = 0; num464 < 15; num464++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				int num465 = (type - 494) * 2;
				Gore.NewGore(position, velocity, 736 + num465);
				Gore.NewGore(position, velocity, 735 + num465);
			}
			else if (type >= 496 && type <= 497)
			{
				if (life > 0)
				{
					for (int num466 = 0; (double)num466 < dmg / (double)lifeMax * 30.0; num466++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num467 = 0; num467 < 15; num467++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				int num468 = type - 496;
				Gore.NewGore(position, velocity, 739 + num468);
			}
			else if (type >= 498 && type <= 506)
			{
				if (life > 0)
				{
					for (int num469 = 0; (double)num469 < dmg / (double)lifeMax * 30.0; num469++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num470 = 0; num470 < 15; num470++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				int num471 = type - 498;
				Gore.NewGore(position, velocity, 750 + num471);
				Gore.NewGore(new Vector2(position.X, position.Y + 16f), velocity, 741 + num471);
				Gore.NewGore(new Vector2(position.X, position.Y + 18f), velocity, 759 + num471);
			}
			else if (type == 49 || type == 51 || type == 93 || type == 150 || type == 152 || type == 226)
			{
				if (life > 0)
				{
					for (int num472 = 0; (double)num472 < dmg / (double)lifeMax * 30.0; num472++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num473 = 0; num473 < 15; num473++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				if (type == 51)
				{
					Gore.NewGore(position, velocity, 83);
				}
				else if (type == 93)
				{
					Gore.NewGore(position, velocity, 107);
				}
				else if (type == 150)
				{
					Gore.NewGore(position, velocity, 164);
					Gore.NewGore(position, velocity, 165);
				}
				else if (type == 152)
				{
					Gore.NewGore(position, velocity, 175);
					Gore.NewGore(position, velocity, 176);
					Gore.NewGore(position, velocity, 176);
				}
				else if (type == 226)
				{
					Gore.NewGore(position, velocity, 317);
					Gore.NewGore(position, velocity, 318);
					Gore.NewGore(position, velocity, 318);
					Gore.NewGore(position, velocity, 319);
				}
				else
				{
					Gore.NewGore(position, velocity, 82);
				}
			}
			else if (type == 611 || type == 689)
			{
				if (life > 0)
				{
					for (int num474 = 0; (double)num474 < dmg / (double)lifeMax * 30.0; num474++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num475 = 0; num475 < 15; num475++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 1164);
				Gore.NewGore(position, velocity, 1164);
				Gore.NewGore(position, velocity, 1165);
			}
			else if (type == 624)
			{
				if (life > 0)
				{
					for (int num476 = 0; (double)num476 < dmg / (double)lifeMax * 20.0; num476++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num477 = 0; num477 < 10; num477++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 1190);
				Gore.NewGore(position, velocity, 1191);
				Gore.NewGore(position, velocity, 1192);
				Gore.NewGore(position, velocity, 1193);
			}
			else if (type == 628)
			{
				if (life > 0)
				{
					for (int num478 = 0; (double)num478 < dmg / (double)lifeMax * 20.0; num478++)
					{
						Dust.NewDust(position, width, height, 3, hitDirection, -1f);
					}
					return;
				}
				for (int num479 = 0; num479 < 10; num479++)
				{
					Dust.NewDust(position, width, height, 3, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 1205);
				Gore.NewGore(position, velocity, 1206);
				Gore.NewGore(position, velocity, 1206);
				Gore.NewGore(position, velocity, 1207);
			}
			else if (type >= 646 && type <= 652)
			{
				int num480 = 138;
				if (type < 652)
				{
					num480 = 86 + (type - 646);
				}
				if (life > 0)
				{
					for (int num481 = 0; (double)num481 < dmg / (double)lifeMax * 20.0; num481++)
					{
						Dust.NewDust(position, width, height, num480, hitDirection, -1f);
					}
					return;
				}
				for (int num482 = 0; num482 < 10; num482++)
				{
					Dust.NewDust(position, width, height, num480, 2 * hitDirection, -2f);
				}
				int num483 = (type - 646) * 2;
				Gore.NewGore(position, velocity, 1234 + num483);
				Gore.NewGore(position, velocity, 1235 + num483);
			}
			else if (type >= 639 && type <= 645)
			{
				int num484 = 138;
				if (type < 645)
				{
					num484 = 86 + (type - 639);
				}
				if (life > 0)
				{
					for (int num485 = 0; (double)num485 < dmg / (double)lifeMax * 20.0; num485++)
					{
						Dust.NewDust(position, width, height, num484, hitDirection, -1f);
					}
					return;
				}
				for (int num486 = 0; num486 < 10; num486++)
				{
					Dust.NewDust(position, width, height, num484, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 1227 + (type - 639));
			}
			else if (type == 46 || type == 55 || type == 67 || type == 74 || type == 102 || type == 224 || type == 230 || type == 297 || type == 298 || type == 299 || type == 300 || type == 303 || type == 337 || type == 538 || type == 540 || type == 587 || type == 610 || type == 614 || type == 616 || type == 617 || type == 625 || type == 626 || type == 627 || type == 615 || type == 671 || type == 672 || type == 673 || type == 674 || type == 675)
			{
				if (life > 0)
				{
					for (int num487 = 0; (double)num487 < dmg / (double)lifeMax * 20.0; num487++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num488 = 0; num488 < 10; num488++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				if (type == 46 || type == 303 || type == 337 || type == 540)
				{
					Gore.NewGore(position, velocity, 76);
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 77);
					if (type == 303)
					{
						for (int num489 = 0; num489 < 10; num489++)
						{
							Dust.NewDust(position, width, height, 193, 2 * hitDirection, -2f);
						}
					}
					if (type == 540)
					{
						Gore.NewGore(position, velocity, 926);
					}
				}
				else if (type == 67)
				{
					Gore.NewGore(position, velocity, 95);
					Gore.NewGore(position, velocity, 95);
					Gore.NewGore(position, velocity, 96);
				}
				else if (type == 55 || type == 230)
				{
					Gore.NewGore(position, velocity, 553);
					Gore.NewGore(position, velocity, 554);
				}
				else if (type == 615)
				{
					Gore.NewGore(position, velocity, 1198);
					Gore.NewGore(position, velocity, 1199);
					Gore.NewGore(position, velocity, 1200);
					Gore.NewGore(position, velocity, 1200);
				}
				else if (type == 74)
				{
					Gore.NewGore(position, velocity, 100);
				}
				else if (type == 297)
				{
					Gore.NewGore(position, velocity, 431);
				}
				else if (type == 298)
				{
					Gore.NewGore(position, velocity, 432);
				}
				else if (type == 671)
				{
					Gore.NewGore(position, velocity, 1277);
					Gore.NewGore(base.Center + new Vector2(4f, 0f), velocity, 1279);
					Gore.NewGore(base.Center + new Vector2(-4f, 0f), velocity, 1279);
				}
				else if (type == 672)
				{
					Gore.NewGore(position, velocity, 1280);
					Gore.NewGore(base.Center + new Vector2(4f, 0f), velocity, 1281);
					Gore.NewGore(base.Center + new Vector2(-4f, 0f), velocity, 1281);
				}
				else if (type == 673)
				{
					Gore.NewGore(position, velocity, 1282);
					Gore.NewGore(base.Center + new Vector2(4f, 0f), velocity, 1283);
					Gore.NewGore(base.Center + new Vector2(-4f, 0f), velocity, 1283);
				}
				else if (type == 674)
				{
					Gore.NewGore(position, velocity, 1284);
					Gore.NewGore(base.Center + new Vector2(4f, 0f), velocity, 1285);
					Gore.NewGore(base.Center + new Vector2(-4f, 0f), velocity, 1285);
				}
				else if (type == 675)
				{
					Gore.NewGore(position, velocity, 1286);
					Gore.NewGore(base.Center + new Vector2(4f, 0f), velocity, 1287);
					Gore.NewGore(base.Center + new Vector2(-4f, 0f), velocity, 1287);
				}
				else if (type == 299)
				{
					Gore.NewGore(position, velocity, 433);
				}
				else if (type == 538)
				{
					Gore.NewGore(position, velocity, 897);
				}
				else if (type == 300)
				{
					Gore.NewGore(position, velocity, 434);
				}
				else if (type == 610)
				{
					Gore.NewGore(position, velocity, 1163);
				}
				else if (type == 626)
				{
					Gore.NewGore(position, velocity, 1197);
				}
				else if (type == 102)
				{
					Gore.NewGore(position, velocity, 116);
				}
				else if (type == 224)
				{
					Gore.NewGore(position, velocity, 312);
					Gore.NewGore(position, velocity, 313);
				}
				else if (type == 587)
				{
					for (int num490 = 0; num490 < 50; num490++)
					{
						Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
					}
					Gore.NewGore(position, velocity, 1104);
					Gore.NewGore(position, velocity, 1105);
				}
				else if (type == 616)
				{
					Gore.NewGore(position, velocity, 1166);
					Gore.NewGore(position, velocity, 1167);
					Gore.NewGore(position, velocity, 1168);
					Gore.NewGore(position, velocity, 1168);
				}
				else if (type == 617)
				{
					Gore.NewGore(position, velocity, 1169);
					Gore.NewGore(position, velocity, 1170);
					Gore.NewGore(position, velocity, 1171);
					Gore.NewGore(position, velocity, 1171);
				}
				else if (type == 625)
				{
					Gore.NewGore(position, velocity, 1194);
					Gore.NewGore(position, velocity, 1195);
					Gore.NewGore(position, velocity, 1196);
					Gore.NewGore(position, velocity, 1196);
				}
			}
			else if (type == 148 || type == 149 || type == 168 || type == 470)
			{
				if (life > 0)
				{
					for (int num491 = 0; (double)num491 < dmg / (double)lifeMax * 20.0; num491++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num492 = 0; num492 < 10; num492++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				if (type == 148)
				{
					Gore.NewGore(position, velocity, 160);
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 161);
				}
				else if (type == 149)
				{
					Gore.NewGore(position, velocity, 162);
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 163);
				}
				else if (type == 168)
				{
					Gore.NewGore(position, velocity, 215);
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 216);
				}
				else if (type == 470)
				{
					Gore.NewGore(position, velocity, 673);
					Gore.NewGore(position, velocity, 672);
					Gore.NewGore(position, velocity, 674);
				}
			}
			else if (type == 361)
			{
				if (life > 0)
				{
					for (int num493 = 0; (double)num493 < dmg / (double)lifeMax * 20.0; num493++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num494 = 0; num494 < 10; num494++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 551);
				Gore.NewGore(new Vector2(position.X, position.Y), velocity, 552);
			}
			else if (type == 687)
			{
				if (life > 0)
				{
					for (int num495 = 0; (double)num495 < dmg / (double)lifeMax * 20.0; num495++)
					{
						Dust.NewDust(position, width, height, 16, hitDirection, -1f);
					}
				}
				else
				{
					Vector2 vector26 = base.Center - new Vector2(20f);
					Utils.PoofOfSmoke(vector26);
				}
			}
			else if (type == 685)
			{
				if (life > 0)
				{
					for (int num496 = 0; (double)num496 < dmg / (double)lifeMax * 20.0; num496++)
					{
						Dust.NewDust(position, width, height, 0, hitDirection, -1f);
					}
				}
				else
				{
					Vector2 vector27 = base.Center - new Vector2(20f);
					Utils.PoofOfSmoke(vector27);
				}
			}
			else if (type == 607)
			{
				if (life > 0)
				{
					for (int num497 = 0; (double)num497 < dmg / (double)lifeMax * 20.0; num497++)
					{
						Dust.NewDust(position, width, height, 45, hitDirection, -1f);
					}
					return;
				}
				for (int num498 = 0; num498 < 10; num498++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 1152);
				Gore.NewGore(new Vector2(position.X, position.Y), velocity, 1153);
			}
			else if (type == 688)
			{
				if (life > 0)
				{
					for (int num499 = 0; (double)num499 < dmg / (double)lifeMax * 20.0; num499++)
					{
						Dust.NewDust(position, width, height, 45, hitDirection, -1f);
					}
					return;
				}
				for (int num500 = 0; num500 < 10; num500++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				if (ai[2] == 1f)
				{
					Gore.NewGore(position, velocity, 1388);
					Gore.NewGore(position, velocity, 1388);
					Gore.NewGore(position, velocity, 1389);
					Gore.NewGore(position, velocity, 1390);
				}
				else
				{
					Gore.NewGore(position, velocity, 1386);
					Gore.NewGore(position, velocity, 1387);
				}
			}
			else if (type == 366 || type == 367)
			{
				if (life > 0)
				{
					for (int num501 = 0; (double)num501 < dmg / (double)lifeMax * 20.0; num501++)
					{
						Dust.NewDust(position, width, height, 203, hitDirection, -1f);
					}
					return;
				}
				for (int num502 = 0; num502 < 10; num502++)
				{
					Dust.NewDust(position, width, height, 203, 2 * hitDirection, -2f);
				}
				if (type == 366)
				{
					Gore.NewGore(position, velocity, 561);
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 562);
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 563);
				}
				else
				{
					Gore.NewGore(position, velocity, 564);
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 565);
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 566);
				}
			}
			else if (type >= 362 && type <= 365)
			{
				if (life > 0)
				{
					for (int num503 = 0; (double)num503 < dmg / (double)lifeMax * 20.0; num503++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num504 = 0; num504 < 10; num504++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				if (type == 362 || type == 363)
				{
					Gore.NewGore(position, velocity, 555);
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 556);
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 557);
				}
				else
				{
					Gore.NewGore(position, velocity, 558);
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 559);
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 560);
				}
			}
			else if (type == 602 || type == 603)
			{
				if (life > 0)
				{
					for (int num505 = 0; (double)num505 < dmg / (double)lifeMax * 20.0; num505++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num506 = 0; num506 < 10; num506++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				if (type == 602 || type == 603)
				{
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 1150);
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 1151);
				}
			}
			else if (type == 608 || type == 609)
			{
				if (life > 0)
				{
					for (int num507 = 0; (double)num507 < dmg / (double)lifeMax * 20.0; num507++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num508 = 0; num508 < 10; num508++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				if (type == 608 || type == 609)
				{
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 1154);
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 1155);
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 1156);
				}
			}
			else if (type == 348 || type == 349)
			{
				if (life > 0)
				{
					for (int num509 = 0; (double)num509 < dmg / (double)lifeMax * 20.0; num509++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num510 = 0; num510 < 10; num510++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 528);
				Gore.NewGore(position, velocity, 529);
				Gore.NewGore(position, velocity, 530);
				Gore.NewGore(position, velocity, 531);
				Gore.NewGore(position, velocity, 532);
			}
			else if (type == 351)
			{
				if (life > 0)
				{
					for (int num511 = 0; (double)num511 < dmg / (double)lifeMax * 20.0; num511++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num512 = 0; num512 < 10; num512++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 538);
				Gore.NewGore(position, velocity, 539);
				Gore.NewGore(position, velocity, 540);
				Gore.NewGore(position, velocity, 541);
				Gore.NewGore(position, velocity, 542);
			}
			else if (type == 350)
			{
				if (life > 0)
				{
					for (int num513 = 0; (double)num513 < dmg / (double)lifeMax * 20.0; num513++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num514 = 0; num514 < 10; num514++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 533);
				Gore.NewGore(position, velocity, 534);
				Gore.NewGore(position, velocity, 535);
				Gore.NewGore(position, velocity, 536);
			}
			else if (type == 47 || type == 57 || type == 58 || type == 464 || type == 465)
			{
				if (life > 0)
				{
					for (int num515 = 0; (double)num515 < dmg / (double)lifeMax * 20.0; num515++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num516 = 0; num516 < 10; num516++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				if (type == 57)
				{
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 84);
				}
				else if (type == 58)
				{
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 85);
				}
				else if (type == 464)
				{
					Gore.NewGore(position, velocity, 668);
					Gore.NewGore(position, velocity, 669);
				}
				else if (type == 465)
				{
					Gore.NewGore(position, velocity, 670);
					Gore.NewGore(position, velocity, 671);
				}
				else
				{
					Gore.NewGore(position, velocity, 78);
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 79);
				}
			}
			else if (type == 173 || type == 174 || type == 181 || type == 182 || type == 268)
			{
				if (life > 0)
				{
					for (int num517 = 0; (double)num517 < dmg / (double)lifeMax * 100.0; num517++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f, alpha);
					}
					return;
				}
				for (int num518 = 0; num518 < 50; num518++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f, alpha);
				}
				if (type == 173)
				{
					Gore.NewGore(position, velocity, 223);
					Gore.NewGore(position, velocity, 224);
				}
				else if (type == 174)
				{
					Gore.NewGore(position, velocity, 225);
					Gore.NewGore(position, velocity, 226);
				}
				else if (type == 181)
				{
					Gore.NewGore(position, velocity, 237);
				}
				else if (type == 182)
				{
					Gore.NewGore(position, velocity, 238);
					Gore.NewGore(position, velocity, 239);
				}
				else if (type == 268)
				{
					Gore.NewGore(position, velocity, 403);
					Gore.NewGore(position, velocity, 404);
					Gore.NewGore(position, velocity, 405);
				}
			}
			else if (type == 2 || type == 190 || type == 191 || type == 192 || type == 193 || type == 194 || type == 317 || type == 318)
			{
				if (life > 0)
				{
					for (int num519 = 0; (double)num519 < dmg / (double)lifeMax * 100.0; num519++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num520 = 0; num520 < 50; num520++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				if (type == 190)
				{
					Gore.NewGore(position, velocity, 249, scale);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity, 2, scale);
				}
				else if (type == 191)
				{
					Gore.NewGore(position, velocity, 248, scale);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity, 2, scale);
				}
				else if (type == 192)
				{
					Gore.NewGore(position, velocity, 247, scale);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity, 2, scale);
				}
				else if (type == 193)
				{
					Gore.NewGore(position, velocity, 252, scale);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity, 253, scale);
				}
				else if (type == 194)
				{
					Gore.NewGore(position, velocity, 250, scale);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity, 251, scale);
				}
				else if (type == 317)
				{
					Gore.NewGore(position, velocity, 447, scale);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity, 448, scale);
				}
				else if (type == 318)
				{
					Gore.NewGore(position, velocity, 449, scale);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity, 450, scale);
				}
				else
				{
					Gore.NewGore(position, velocity, 1, scale);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity, 2, scale);
				}
			}
			else if (type == 157)
			{
				if (life > 0)
				{
					for (int num521 = 0; (double)num521 < dmg / (double)lifeMax * 100.0; num521++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num522 = 0; num522 < 50; num522++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 186);
				Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity, 187);
			}
			else if (type == 133)
			{
				if (life > 0)
				{
					for (int num523 = 0; (double)num523 < dmg / (double)lifeMax * 100.0; num523++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					if ((float)life < (float)lifeMax * 0.5f && localAI[0] == 0f)
					{
						localAI[0] = 1f;
						Gore.NewGore(position, velocity, 1);
					}
				}
				else
				{
					for (int num524 = 0; num524 < 50; num524++)
					{
						Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
					}
					Gore.NewGore(position, velocity, 155);
					Gore.NewGore(new Vector2(position.X, position.Y + 14f), velocity, 155);
				}
			}
			else if (type == 69 || type == 581 || type == 580 || type == 508 || type == 509 || type == 582)
			{
				float num525 = 100f;
				float num526 = 50f;
				if (type == 582)
				{
					num525 = 30f;
					num526 = 10f;
				}
				if (life > 0)
				{
					for (int num527 = 0; (double)num527 < dmg / (double)lifeMax * (double)num525; num527++)
					{
						Dust.NewDust(position, width, height, 250, hitDirection, -1f);
					}
					return;
				}
				for (int num528 = 0; (float)num528 < num526; num528++)
				{
					Dust.NewDust(position, width, height, 250, 2 * hitDirection, -2f);
				}
				if (type == 69)
				{
					Gore.NewGore(position, velocity, 97);
					Gore.NewGore(position, velocity, 98);
				}
				else if (type == 580)
				{
					Gore.NewGore(position, velocity, 1094);
					Gore.NewGore(position, velocity, 1095);
					Gore.NewGore(position, velocity, 1096);
					Gore.NewGore(position, velocity, 1097);
				}
				else if (type == 581)
				{
					Gore.NewGore(position, velocity, 1098);
					Gore.NewGore(position, velocity, 1099);
					Gore.NewGore(position, velocity, 1100);
					Gore.NewGore(position, velocity, 1101);
					Gore.NewGore(position, velocity, 1101);
				}
				else if (type == 508)
				{
					Gore.NewGore(position, velocity, 811);
					Gore.NewGore(position, velocity, 812);
					Gore.NewGore(position, velocity, 813);
					Gore.NewGore(position, velocity, 814);
				}
				else if (type == 509)
				{
					Gore.NewGore(position, velocity, 815);
					Gore.NewGore(position, velocity, 816);
					Gore.NewGore(position, velocity, 817);
					Gore.NewGore(position, velocity, 818);
					Gore.NewGore(position, velocity, 818);
				}
				else if (type == 582)
				{
					Gore.NewGore(position, velocity, 1102);
					Gore.NewGore(position, velocity, 1103);
				}
			}
			else if (type == 61)
			{
				if (life > 0)
				{
					for (int num529 = 0; (double)num529 < dmg / (double)lifeMax * 100.0; num529++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num530 = 0; num530 < 50; num530++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 86);
				Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity, 87);
				Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity, 88);
			}
			else if (type == 301)
			{
				if (life > 0)
				{
					for (int num531 = 0; (double)num531 < dmg / (double)lifeMax * 100.0; num531++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num532 = 0; num532 < 50; num532++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 438);
				Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity, 439);
			}
			else if (type == 252)
			{
				if (life > 0)
				{
					for (int num533 = 0; (double)num533 < dmg / (double)lifeMax * 100.0; num533++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num534 = 0; num534 < 50; num534++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 373);
				Gore.NewGore(position, velocity, 374);
			}
			else if (type == 489 || type == 586)
			{
				if (life > 0)
				{
					for (int num535 = 0; (double)num535 < dmg / (double)lifeMax * 100.0; num535++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num536 = 0; num536 < 50; num536++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				if (type == 489)
				{
					Gore.NewGore(position, velocity, 722, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 723, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 723, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 724, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 724, scale);
				}
				if (type == 586)
				{
					Gore.NewGore(position, velocity, 1106, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 1107, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 1107, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 1108, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 1108, scale);
				}
			}
			else if (type == 534)
			{
				if (life > 0)
				{
					for (int num537 = 0; (double)num537 < dmg / (double)lifeMax * 100.0; num537++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num538 = 0; num538 < 50; num538++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 894, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 895, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 895, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 896, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 896, scale);
			}
			else if (type == 490)
			{
				if (life > 0)
				{
					for (int num539 = 0; (double)num539 < dmg / (double)lifeMax * 100.0; num539++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num540 = 0; num540 < 50; num540++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 725, scale);
				Gore.NewGore(position, velocity, 726, scale);
				Gore.NewGore(position, velocity, 727, scale);
				Gore.NewGore(position, velocity, 725 + Main.rand.Next(3), scale);
				Gore.NewGore(position, velocity, 725 + Main.rand.Next(3), scale);
			}
			else if (type == 65 || (type >= 542 && type <= 545) || type == 692)
			{
				if (life > 0)
				{
					for (int num541 = 0; (double)num541 < dmg / (double)lifeMax * 150.0; num541++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num542 = 0; num542 < 75; num542++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				if (type == 65)
				{
					Gore.NewGore(position, velocity * 0.8f, 89);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 90);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 91);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 92);
				}
				if (type == 692)
				{
					Gore.NewGore(position, velocity * 0.8f, 1403);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 1404);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 1405);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 1406);
				}
				if (type == 542)
				{
					Gore.NewGore(position, velocity * 0.8f, 944);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 945);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 946);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 947);
				}
				if (type == 543)
				{
					Gore.NewGore(position, velocity * 0.8f, 948);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 949);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 950);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 951);
				}
				if (type == 544)
				{
					Gore.NewGore(position, velocity * 0.8f, 952);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 953);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 954);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 955);
				}
				if (type == 545)
				{
					Gore.NewGore(position, velocity * 0.8f, 956);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 957);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 958);
					Gore.NewGore(new Vector2(position.X + 14f, position.Y), velocity * 0.8f, 959);
				}
			}
			else if (type == 195 || type == 196)
			{
				if (life > 0)
				{
					for (int num543 = 0; (double)num543 < dmg / (double)lifeMax * 150.0; num543++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num544 = 0; num544 < 75; num544++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 254, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 255, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 255, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 256, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 256, scale);
			}
			else if (type == 198 || type == 199)
			{
				if (life > 0)
				{
					for (int num545 = 0; (double)num545 < dmg / (double)lifeMax * 150.0; num545++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num546 = 0; num546 < 75; num546++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 258, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 259, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 259, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 260, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 260, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 261, scale);
			}
			else if (type == 206)
			{
				if (life > 0)
				{
					for (int num547 = 0; (double)num547 < dmg / (double)lifeMax * 150.0; num547++)
					{
						Dust.NewDust(position, width, height, 137, hitDirection, -1f);
					}
					return;
				}
				for (int num548 = 0; num548 < 75; num548++)
				{
					Dust.NewDust(position, width, height, 137, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 273, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 274, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 274, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 275, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 275, scale);
			}
			else if (type == 342)
			{
				if (life > 0)
				{
					for (int num549 = 0; (double)num549 < dmg / (double)lifeMax * 100.0; num549++)
					{
						Dust.NewDust(position, width, height, 0, hitDirection, -1f);
					}
					return;
				}
				for (int num550 = 0; num550 < 50; num550++)
				{
					Dust.NewDust(position, width, height, 0, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 500, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 501, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 501, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 502, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 502, scale);
			}
			else if (type >= 338 && type <= 340)
			{
				if (life > 0)
				{
					for (int num551 = 0; (double)num551 < dmg / (double)lifeMax * 100.0; num551++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num552 = 0; num552 < 50; num552++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				if (type == 338)
				{
					Gore.NewGore(position, velocity, 494, scale);
				}
				if (type == 339)
				{
					Gore.NewGore(position, velocity, 495, scale);
				}
				if (type == 340)
				{
					Gore.NewGore(position, velocity, 496, scale);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 497, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 498, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 499, scale);
			}
			else if (type == 343)
			{
				if (life > 0)
				{
					for (int num553 = 0; (double)num553 < dmg / (double)lifeMax * 100.0; num553++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num554 = 0; num554 < 50; num554++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 503, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 504, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 505, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 506, scale);
			}
			else if (type == 691)
			{
				if (life > 0)
				{
					for (int num555 = 0; (double)num555 < dmg / (double)lifeMax * 100.0; num555++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num556 = 0; num556 < 50; num556++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 1391, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 1392, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 1392, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 1393, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 1393, scale);
			}
			else if ((type >= 430 && type <= 436) || type == 590 || type == 591 || type == 3 || type == 52 || type == 53 || type == 536 || type == 104 || type == 109 || type == 331 || type == 332 || type == 132 || type == 161 || type == 162 || type == 186 || type == 187 || type == 188 || type == 189 || type == 200 || type == 223 || type == 251 || type == 319 || type == 320 || type == 321 || type == 632)
			{
				if (life > 0)
				{
					for (int num557 = 0; (double)num557 < dmg / (double)lifeMax * 100.0; num557++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					if (type == 186 && Main.rand.Next(5) == 0)
					{
						Gore.NewGore(position, velocity, 242);
					}
					if (type == 632 && Main.rand.Next(5) == 0)
					{
						Gore.NewGore(position, velocity, 1217);
					}
					if (type == 187)
					{
						for (int num558 = 0; (double)num558 < dmg / (double)lifeMax * 200.0; num558++)
						{
							Dust.NewDust(position, width, 24, 4, hitDirection, -1f, 125, new Color(0, 80, 255, 100));
						}
					}
					if ((type == 590 || type == 591) && !wet)
					{
						for (int num559 = 0; num559 < 3; num559++)
						{
							Dust.NewDust(position, width, 24, 6, hitDirection, -1f, 125, new Color(0, 80, 255, 100));
						}
					}
					return;
				}
				for (int num560 = 0; num560 < 50; num560++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				if (type == 187 || type == 433)
				{
					for (int num561 = 0; num561 < 25; num561++)
					{
						Dust.NewDust(position, width, 24, 4, hitDirection, -1f, 125, new Color(0, 80, 255, 100));
					}
				}
				if (type == 104)
				{
					Gore.NewGore(position, velocity, 117, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 118, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 118, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 119, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 119, scale);
					return;
				}
				if (type == 632)
				{
					Gore.NewGore(position, velocity, 1214, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 1215, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 1215, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 1216, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 1216, scale);
					if (Main.netMode != 1)
					{
						int num562 = Main.rand.Next(2) + 2;
						for (int num563 = 0; num563 < num562; num563++)
						{
							Vector2 vector28 = new Vector2((float)Main.rand.Next(-10, 10) * 0.2f, -3.5f - (float)Main.rand.Next(5, 10) * 0.3f - (float)num563 * 0.5f);
							int num564 = NewNPC(GetSpawnSource_NPCHurt(), (int)(position.X + (float)(width / 2)), (int)position.Y + Main.rand.Next(height / 2) + 10, 606);
							Main.npc[num564].velocity = vector28;
							Main.npc[num564].netUpdate = true;
						}
					}
					return;
				}
				if (type == 331)
				{
					Gore.NewGore(position, velocity, 488, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 489, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 489, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 490, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 490, scale);
					return;
				}
				if (type == 332)
				{
					Gore.NewGore(position, velocity, 491, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 492, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 492, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 493, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 493, scale);
					return;
				}
				if (type == 109)
				{
					Gore.NewGore(position, velocity, 121, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 122, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 122, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 123, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 123, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 46f), velocity, 120, scale);
					return;
				}
				if (type == 161 || type == 431)
				{
					Gore.NewGore(position, velocity, 191, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 192, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 192, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 193, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 193, scale);
					return;
				}
				if (type == 162)
				{
					Gore.NewGore(position, velocity, 194, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 195, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 195, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 196, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 196, scale);
					return;
				}
				if (type == 188 || type == 434)
				{
					Gore.NewGore(position, velocity, 243, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 244, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 244, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 245, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 245, scale);
					return;
				}
				if (type == 200 || type == 436)
				{
					Gore.NewGore(position, velocity, 262, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 263, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 263, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 264, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 264, scale);
					return;
				}
				if (type == 319)
				{
					Gore.NewGore(position, velocity, 451, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 453, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 453, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 452, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 452, scale);
					return;
				}
				if (type == 320)
				{
					Gore.NewGore(position, velocity, 454, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 455, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 456, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 456, scale);
					return;
				}
				if (type == 321)
				{
					Gore.NewGore(position, velocity, 457, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 458, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 458, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 459, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 459, scale);
					return;
				}
				if (type == 223)
				{
					Gore.NewGore(position, velocity, 309, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 310, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 310, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 311, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 311, scale);
					return;
				}
				if (type == 132)
				{
					Gore.NewGore(position, velocity, 154);
				}
				else if (type == 186 || type == 432)
				{
					Gore.NewGore(position, velocity, 241);
				}
				else if (type == 189 || type == 435)
				{
					Gore.NewGore(position, velocity, 246);
				}
				else if (type == 251)
				{
					Gore.NewGore(position, velocity, 372);
				}
				else if (type != 187 && type != 433)
				{
					Gore.NewGore(position, velocity, 3);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 4);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 4);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 5);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 5);
				if (type == 186 || type == 432)
				{
					Gore.NewGore(position, velocity, 242);
				}
				if ((type == 186 || type == 432) && Main.rand.Next(2) == 0)
				{
					Gore.NewGore(position, velocity, 242);
				}
			}
			else if (type == 83 || type == 84 || type == 179)
			{
				if (life > 0)
				{
					for (int num565 = 0; (double)num565 < dmg / (double)lifeMax * 50.0; num565++)
					{
						int num566 = Dust.NewDust(position, width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
						Main.dust[num566].noGravity = true;
					}
					return;
				}
				for (int num567 = 0; num567 < 20; num567++)
				{
					int num568 = Dust.NewDust(position, width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
					Dust dust = Main.dust[num568];
					dust.velocity *= 2f;
					Main.dust[num568].noGravity = true;
				}
				int num569 = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 10f), new Vector2(Main.rand.Next(-2, 3), Main.rand.Next(-2, 3)), 61, scale);
				Gore gore2 = Main.gore[num569];
				gore2.velocity *= 0.5f;
				num569 = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 10f), new Vector2(Main.rand.Next(-2, 3), Main.rand.Next(-2, 3)), 61, scale);
				gore2 = Main.gore[num569];
				gore2.velocity *= 0.5f;
				num569 = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 10f), new Vector2(Main.rand.Next(-2, 3), Main.rand.Next(-2, 3)), 61, scale);
				gore2 = Main.gore[num569];
				gore2.velocity *= 0.5f;
			}
			else if (type == 262 || type == 263 || type == 264)
			{
				if (life > 0)
				{
					for (int num570 = 0; (double)num570 < dmg / (double)lifeMax * 100.0; num570++)
					{
						if (type == 262 && life > lifeMax / 2 && Main.rand.Next(3) != 0)
						{
							Dust.NewDust(position, width, height, 166, hitDirection, -1f);
						}
						else if (type == 265 && Main.rand.Next(3) != 0)
						{
							Dust.NewDust(position, width, height, 166, hitDirection, -1f);
						}
						else
						{
							Dust.NewDust(position, width, height, 167, hitDirection, -1f);
						}
					}
					return;
				}
				for (int num571 = 0; num571 < 150; num571++)
				{
					if (type == 265 && Main.rand.Next(3) != 0)
					{
						Dust.NewDust(position, width, height, 166, 2 * hitDirection, -2f);
					}
					else
					{
						Dust.NewDust(position, width, height, 167, 2 * hitDirection, -2f);
					}
				}
				if (type == 262)
				{
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 381, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 382, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 383, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 384, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 385, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 386, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 386, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 387, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 387, scale);
				}
				if (type == 263)
				{
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 390, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 391, scale);
				}
				if (type == 264)
				{
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 388, scale);
					Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), velocity, 389, scale);
				}
			}
			else if (type == 265)
			{
				if (life >= 0)
				{
					return;
				}
				for (int num572 = 0; num572 < 15; num572++)
				{
					if (Main.rand.Next(3) != 0)
					{
						Dust.NewDust(position, width, height, 166, hitDirection, -1f);
					}
					else
					{
						Dust.NewDust(position, width, height, 167, hitDirection, -1f);
					}
				}
			}
			else if (type == 266)
			{
				if (life > 0)
				{
					for (int num573 = 0; (double)num573 < dmg / (double)lifeMax * 100.0; num573++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num574 = 0; num574 < 150; num574++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 396);
				Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 397);
				Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 398);
				Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 399);
				Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 400);
				Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 401);
			}
			else if (type == 267)
			{
				if (life > 0)
				{
					for (int num575 = 0; (double)num575 < dmg / (double)lifeMax * 50.0; num575++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num576 = 0; num576 < 20; num576++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 402);
			}
			else if (type == 4 || type == 126 || type == 125)
			{
				if (life > 0)
				{
					for (int num577 = 0; (double)num577 < dmg / (double)lifeMax * 100.0; num577++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num578 = 0; num578 < 150; num578++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				for (int num579 = 0; num579 < 2; num579++)
				{
					Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 2);
					Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 7);
					Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 9);
					if (type == 4)
					{
						Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 10);
						SoundEngine.PlaySound(15, (int)position.X, (int)position.Y, 0);
					}
					else if (type == 125)
					{
						Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 146);
					}
					else if (type == 126)
					{
						Gore.NewGore(position, new Vector2((float)Main.rand.Next(-30, 31) * 0.2f, (float)Main.rand.Next(-30, 31) * 0.2f), 145);
					}
				}
				if (type == 125 || type == 126)
				{
					for (int num580 = 0; num580 < 10; num580++)
					{
						int num581 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust = Main.dust[num581];
						dust.velocity *= 1.4f;
					}
					for (int num582 = 0; num582 < 5; num582++)
					{
						int num583 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num583].noGravity = true;
						Dust dust = Main.dust[num583];
						dust.velocity *= 5f;
						num583 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust = Main.dust[num583];
						dust.velocity *= 3f;
					}
					int num584 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num584];
					gore2.velocity *= 0.4f;
					Main.gore[num584].velocity.X += 1f;
					Main.gore[num584].velocity.Y += 1f;
					num584 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num584];
					gore2.velocity *= 0.4f;
					Main.gore[num584].velocity.X -= 1f;
					Main.gore[num584].velocity.Y += 1f;
					num584 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num584];
					gore2.velocity *= 0.4f;
					Main.gore[num584].velocity.X += 1f;
					Main.gore[num584].velocity.Y -= 1f;
					num584 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num584];
					gore2.velocity *= 0.4f;
					Main.gore[num584].velocity.X -= 1f;
					Main.gore[num584].velocity.Y -= 1f;
				}
			}
			else if (type == 5)
			{
				if (life > 0)
				{
					for (int num585 = 0; (double)num585 < dmg / (double)lifeMax * 50.0; num585++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num586 = 0; num586 < 20; num586++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 6);
				Gore.NewGore(position, velocity, 7);
			}
			else if (type == 113 || type == 114)
			{
				if (life > 0)
				{
					for (int num587 = 0; num587 < 20; num587++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num588 = 0; num588 < 50; num588++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -1f);
				}
				if (type == 114)
				{
					Gore.NewGore(new Vector2(position.X, position.Y), velocity, 137, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2)), velocity, 139, scale);
					Gore.NewGore(new Vector2(position.X + (float)(width / 2), position.Y), velocity, 139, scale);
					Gore.NewGore(new Vector2(position.X + (float)(width / 2), position.Y + (float)(height / 2)), velocity, 137, scale);
					return;
				}
				Gore.NewGore(new Vector2(position.X, position.Y), velocity, 137, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2)), velocity, 138, scale);
				Gore.NewGore(new Vector2(position.X + (float)(width / 2), position.Y), velocity, 138, scale);
				Gore.NewGore(new Vector2(position.X + (float)(width / 2), position.Y + (float)(height / 2)), velocity, 137, scale);
				if (!(Main.player[Main.myPlayer].position.Y / 16f > (float)(Main.maxTilesY - 250)))
				{
					return;
				}
				int num589 = (int)Main.screenPosition.Y;
				int num590 = num589 + Main.screenWidth;
				int num591 = (int)position.X;
				if (direction > 0)
				{
					num591 -= 80;
				}
				int num592 = num591 + 140;
				int num593 = num591;
				for (int num594 = num589; num594 < num590; num594 += 50)
				{
					for (; num593 < num592; num593 += 46)
					{
						for (int num595 = 0; num595 < 5; num595++)
						{
							Dust.NewDust(new Vector2(num593, num594), 32, 32, 5, (float)Main.rand.Next(-60, 61) * 0.1f, (float)Main.rand.Next(-60, 61) * 0.1f);
						}
						Gore.NewGore(Velocity: new Vector2((float)Main.rand.Next(-80, 81) * 0.1f, (float)Main.rand.Next(-60, 21) * 0.1f), Position: new Vector2(num593, num594), Type: Main.rand.Next(140, 143));
					}
					num593 = num591;
				}
			}
			else if (type == 115 || type == 116)
			{
				if (life > 0)
				{
					for (int num596 = 0; num596 < 5; num596++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				if (type == 115 && Main.netMode != 1)
				{
					NewNPC(GetSpawnSource_NPCHurt(), (int)(position.X + (float)(width / 2)), (int)(position.Y + (float)height), 116);
					for (int num597 = 0; num597 < 10; num597++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num598 = 0; num598 < 20; num598++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
				Gore.NewGore(position, velocity, 132, scale);
				Gore.NewGore(position, velocity, 133, scale);
			}
			else if (type >= 117 && type <= 119)
			{
				if (life > 0)
				{
					for (int num599 = 0; num599 < 5; num599++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num600 = 0; num600 < 10; num600++)
				{
					Dust.NewDust(position, width, height, 5, hitDirection, -1f);
				}
				Gore.NewGore(position, velocity, 134 + type - 117, scale);
			}
			else if (type == 217 || type == 218 || type == 219)
			{
				if (life > 0)
				{
					for (int num601 = 0; (double)num601 < dmg / (double)lifeMax * 100.0; num601++)
					{
						Dust.NewDust(position, width, height, 18, hitDirection, -1f, alpha, this.color, scale);
					}
					return;
				}
				for (int num602 = 0; num602 < 50; num602++)
				{
					Dust.NewDust(position, width, height, 18, hitDirection, -2f, alpha, this.color, scale);
				}
				if (type == 217)
				{
					int num603 = Gore.NewGore(position, velocity, 292, scale);
					num603 = Gore.NewGore(position, velocity, 293, scale);
				}
				if (type == 218)
				{
					int num603 = Gore.NewGore(position, velocity, 295, scale);
					num603 = Gore.NewGore(position, velocity, 296, scale);
				}
				if (type == 219)
				{
					int num603 = Gore.NewGore(position, velocity, 294, scale);
				}
			}
			else if (type == 222)
			{
				if (life > 0)
				{
					for (int num604 = 0; (double)num604 < dmg / (double)lifeMax * 100.0; num604++)
					{
						Dust.NewDust(position, width, height, 18, hitDirection, -1f, alpha, this.color, scale);
					}
					return;
				}
				for (int num605 = 0; num605 < 50; num605++)
				{
					Dust.NewDust(position, width, height, 18, hitDirection, -2f, alpha, this.color, scale);
				}
				Gore.NewGore(new Vector2(position.X, position.Y - 35f), velocity, 303, scale);
				Gore.NewGore(new Vector2(position.X, position.Y - 45f), velocity, 304, scale);
				Gore.NewGore(new Vector2(position.X, position.Y), velocity, 305, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 306, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 10f), velocity, 307, scale);
				Gore.NewGore(new Vector2(position.X, position.Y - 10f), velocity, 308, scale);
			}
			else if (type == 6 || type == 94 || type == 166)
			{
				if (life > 0)
				{
					for (int num606 = 0; (double)num606 < dmg / (double)lifeMax * 100.0; num606++)
					{
						Dust.NewDust(position, width, height, 18, hitDirection, -1f, alpha, this.color, scale);
					}
					return;
				}
				for (int num607 = 0; num607 < 50; num607++)
				{
					Dust.NewDust(position, width, height, 18, hitDirection, -2f, alpha, this.color, scale);
				}
				if (type == 94)
				{
					int num608 = Gore.NewGore(position, velocity, 108, scale);
					num608 = Gore.NewGore(position, velocity, 108, scale);
					num608 = Gore.NewGore(position, velocity, 109, scale);
					num608 = Gore.NewGore(position, velocity, 110, scale);
				}
				else if (type == 166)
				{
					int num608 = Gore.NewGore(position, velocity, 209, scale);
					num608 = Gore.NewGore(position, velocity, 210, scale);
					num608 = Gore.NewGore(position, velocity, 211, scale);
				}
				else
				{
					int num608 = Gore.NewGore(position, velocity, 14, scale);
					Main.gore[num608].alpha = alpha;
					num608 = Gore.NewGore(position, velocity, 15, scale);
					Main.gore[num608].alpha = alpha;
				}
			}
			else if (type == 101)
			{
				if (life > 0)
				{
					for (int num609 = 0; (double)num609 < dmg / (double)lifeMax * 100.0; num609++)
					{
						Dust.NewDust(position, width, height, 18, hitDirection, -1f, alpha, this.color, scale);
					}
					return;
				}
				for (int num610 = 0; num610 < 50; num610++)
				{
					Dust.NewDust(position, width, height, 18, hitDirection, -2f, alpha, this.color, scale);
				}
				int num611 = Gore.NewGore(position, velocity, 110, scale);
				num611 = Gore.NewGore(position, velocity, 114, scale);
				num611 = Gore.NewGore(position, velocity, 114, scale);
				num611 = Gore.NewGore(position, velocity, 115, scale);
			}
			else if (type == 7 || type == 8 || type == 9)
			{
				if (life > 0)
				{
					for (int num612 = 0; (double)num612 < dmg / (double)lifeMax * 100.0; num612++)
					{
						Dust.NewDust(position, width, height, 18, hitDirection, -1f, alpha, this.color, scale);
					}
					return;
				}
				for (int num613 = 0; num613 < 50; num613++)
				{
					Dust.NewDust(position, width, height, 18, hitDirection, -2f, alpha, this.color, scale);
				}
				int num614 = Gore.NewGore(position, velocity, type - 7 + 18);
				Main.gore[num614].alpha = alpha;
			}
			else if (type == 98 || type == 99 || type == 100)
			{
				if (life > 0)
				{
					for (int num615 = 0; (double)num615 < dmg / (double)lifeMax * 100.0; num615++)
					{
						Dust.NewDust(position, width, height, 18, hitDirection, -1f, alpha, this.color, scale);
					}
					return;
				}
				for (int num616 = 0; num616 < 50; num616++)
				{
					Dust.NewDust(position, width, height, 18, hitDirection, -2f, alpha, this.color, scale);
				}
				int num617 = Gore.NewGore(position, velocity, 110);
				Main.gore[num617].alpha = alpha;
			}
			else if (type == 10 || type == 11 || type == 12)
			{
				if (life > 0)
				{
					for (int num618 = 0; (double)num618 < dmg / (double)lifeMax * 50.0; num618++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num619 = 0; num619 < 10; num619++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, type - 7 + 18);
			}
			else if (type == 95 || type == 96 || type == 97)
			{
				if (life > 0)
				{
					for (int num620 = 0; (double)num620 < dmg / (double)lifeMax * 50.0; num620++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num621 = 0; num621 < 10; num621++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, type - 95 + 111);
			}
			else if (type == 13 || type == 14 || type == 15)
			{
				if (life > 0)
				{
					for (int num622 = 0; (double)num622 < dmg / (double)lifeMax * 100.0; num622++)
					{
						Dust.NewDust(position, width, height, 18, hitDirection, -1f, alpha, this.color, scale);
					}
					return;
				}
				for (int num623 = 0; num623 < 50; num623++)
				{
					Dust.NewDust(position, width, height, 18, hitDirection, -2f, alpha, this.color, scale);
				}
				if (type == 13)
				{
					Gore.NewGore(position, velocity, 24);
					Gore.NewGore(position, velocity, 25);
				}
				else if (type == 14)
				{
					Gore.NewGore(position, velocity, 26);
					Gore.NewGore(position, velocity, 27);
				}
				else
				{
					Gore.NewGore(position, velocity, 28);
					Gore.NewGore(position, velocity, 29);
				}
			}
			else if (type == 17)
			{
				if (life > 0)
				{
					for (int num624 = 0; (double)num624 < dmg / (double)lifeMax * 100.0; num624++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num625 = 0; num625 < 50; num625++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				if (altTexture == 0)
				{
					Gore.NewGore(position, velocity, IsShimmerVariant ? 1320 : 30);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1322 : 31);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1322 : 31);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1323 : 32);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1323 : 32);
			}
			else if (type == 441)
			{
				if (life > 0)
				{
					for (int num626 = 0; (double)num626 < dmg / (double)lifeMax * 100.0; num626++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num627 = 0; num627 < 50; num627++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1358 : 768);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1359 : 769);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1361 : 770);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1360 : 771);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1360 : 771);
			}
			else if (type == 86)
			{
				if (life > 0)
				{
					for (int num628 = 0; (double)num628 < dmg / (double)lifeMax * 100.0; num628++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num629 = 0; num629 < 50; num629++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 101);
				Gore.NewGore(position, velocity, 102);
				Gore.NewGore(position, velocity, 103);
				Gore.NewGore(position, velocity, 103);
				Gore.NewGore(position, velocity, 104);
				Gore.NewGore(position, velocity, 104);
				Gore.NewGore(position, velocity, 105);
			}
			else if (type == 155)
			{
				if (life > 0)
				{
					for (int num630 = 0; (double)num630 < dmg / (double)lifeMax * 100.0; num630++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num631 = 0; num631 < 50; num631++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 181);
				Gore.NewGore(position, velocity, 182);
				Gore.NewGore(position, velocity, 183);
			}
			else if (type == 329)
			{
				if (life > 0)
				{
					for (int num632 = 0; (double)num632 < dmg / (double)lifeMax * 100.0; num632++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num633 = 0; num633 < 50; num633++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 485);
				Gore.NewGore(position, velocity, 486);
				Gore.NewGore(position, velocity, 487);
			}
			else if (type == 163 || type == 238)
			{
				if (life > 0)
				{
					for (int num634 = 0; (double)num634 < dmg / (double)lifeMax * 100.0; num634++)
					{
						Dust.NewDust(position, width, height, 18, hitDirection, -1f);
					}
					return;
				}
				for (int num635 = 0; num635 < 50; num635++)
				{
					Dust.NewDust(position, width, height, 18, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 205);
				Gore.NewGore(position, velocity, 206);
				Gore.NewGore(position, velocity, 206);
				Gore.NewGore(position, velocity, 206);
				Gore.NewGore(position, velocity, 206);
			}
			else if (type == 164 || type == 165)
			{
				if (life > 0)
				{
					for (int num636 = 0; (double)num636 < dmg / (double)lifeMax * 100.0; num636++)
					{
						Dust.NewDust(position, width, height, 18, hitDirection, -1f);
					}
					return;
				}
				for (int num637 = 0; num637 < 50; num637++)
				{
					Dust.NewDust(position, width, height, 18, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 207);
				Gore.NewGore(position, velocity, 208);
				Gore.NewGore(position, velocity, 208);
				Gore.NewGore(position, velocity, 208);
				Gore.NewGore(position, velocity, 208);
			}
			else if (type == 239 || type == 240)
			{
				if (life > 0)
				{
					for (int num638 = 0; (double)num638 < dmg / (double)lifeMax * 100.0; num638++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num639 = 0; num639 < 50; num639++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 351);
				Gore.NewGore(position, velocity, 352);
				Gore.NewGore(position, velocity, 352);
				Gore.NewGore(position, velocity, 353);
				Gore.NewGore(position, velocity, 353);
			}
			else if (type == 236 || type == 237)
			{
				if (life > 0)
				{
					for (int num640 = 0; (double)num640 < dmg / (double)lifeMax * 100.0; num640++)
					{
						Dust.NewDust(position, width, height, 18, hitDirection, -1f);
					}
					return;
				}
				for (int num641 = 0; num641 < 50; num641++)
				{
					Dust.NewDust(position, width, height, 18, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 332);
				Gore.NewGore(position, velocity, 333);
				Gore.NewGore(position, velocity, 334);
				Gore.NewGore(position, velocity, 335);
				Gore.NewGore(position, velocity, 335);
			}
			else if (type == 241)
			{
				if (life > 0)
				{
					for (int num642 = 0; (double)num642 < dmg / (double)lifeMax * 100.0; num642++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num643 = 0; num643 < 50; num643++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 354);
				Gore.NewGore(position, velocity, 355);
			}
			else if (type == 242)
			{
				if (life > 0)
				{
					for (int num644 = 0; (double)num644 < dmg / (double)lifeMax * 100.0; num644++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num645 = 0; num645 < 50; num645++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 356);
				Gore.NewGore(position, velocity, 357);
				Gore.NewGore(position, velocity, 357);
				Gore.NewGore(position, velocity, 358);
				Gore.NewGore(position, velocity, 358);
			}
			else if (type >= 105 && type <= 108)
			{
				if (life > 0)
				{
					for (int num646 = 0; (double)num646 < dmg / (double)lifeMax * 100.0; num646++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num647 = 0; num647 < 50; num647++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				if (type == 105 || type == 107)
				{
					Gore.NewGore(position, velocity, IsShimmerVariant ? 1308 : 124);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1309 : 125);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1309 : 125);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1310 : 126);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1310 : 126);
					return;
				}
				if (altTexture == 0 || type == 106)
				{
					Gore.NewGore(position, velocity, IsShimmerVariant ? 1373 : 127);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1374 : 128);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1375 : 128);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1376 : 129);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1376 : 129);
			}
			else if (type == 123 || type == 124)
			{
				if (life > 0)
				{
					for (int num648 = 0; (double)num648 < dmg / (double)lifeMax * 100.0; num648++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num649 = 0; num649 < 50; num649++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1317 : 151);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1318 : 152);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1318 : 152);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1319 : 153);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1319 : 153);
			}
			else if (type == 22)
			{
				if (life > 0)
				{
					for (int num650 = 0; (double)num650 < dmg / (double)lifeMax * 100.0; num650++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num651 = 0; num651 < 50; num651++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1314 : 73);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1315 : 74);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1315 : 74);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1316 : 75);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1316 : 75);
			}
			else if (type == 550)
			{
				if (life > 0)
				{
					for (int num652 = 0; (double)num652 < dmg / (double)lifeMax * 100.0; num652++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num653 = 0; num653 < 50; num653++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 0f), velocity, IsShimmerVariant ? 1355 : 967);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1356 : 968);
				Gore.NewGore(new Vector2(position.X + 8f, position.Y + 20f), velocity, IsShimmerVariant ? 1356 : 968);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1357 : 969);
				Gore.NewGore(new Vector2(position.X + 8f, position.Y + 34f), velocity, IsShimmerVariant ? 1357 : 969);
			}
			else if (type == 588 || type == 589)
			{
				if (life > 0)
				{
					for (int num654 = 0; (double)num654 < dmg / (double)lifeMax * 100.0; num654++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num655 = 0; num655 < 50; num655++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				if (altTexture == 0)
				{
					Gore.NewGore(new Vector2(position.X, position.Y + 0f), velocity, IsShimmerVariant ? 1311 : 1109);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1312 : 1110);
				Gore.NewGore(new Vector2(position.X + 8f, position.Y + 20f), velocity, IsShimmerVariant ? 1312 : 1110);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1313 : 1111);
				Gore.NewGore(new Vector2(position.X + 8f, position.Y + 34f), velocity, IsShimmerVariant ? 1313 : 1111);
			}
			else if (type == 633)
			{
				if (life > 0)
				{
					for (int num656 = 0; (double)num656 < dmg / (double)lifeMax * 100.0; num656++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num657 = 0; num657 < 50; num657++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				int num658 = 1219;
				int num659 = 1220;
				if (altTexture == 2)
				{
					num658 = 1223;
					num659 = 1224;
				}
				if (IsShimmerVariant)
				{
					num658 = 1377;
					num659 = 1379;
					if (altTexture == 2)
					{
						num658 = 1378;
						num659 = 1380;
					}
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 0f), velocity, num658);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num659);
				Gore.NewGore(new Vector2(position.X + 8f, position.Y + 20f), velocity, num659);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1382 : 1221);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1381 : 1222);
				Gore.NewGore(new Vector2(position.X + 8f, position.Y + 34f), velocity, IsShimmerVariant ? 1381 : 1222);
			}
			else if (type == 368)
			{
				if (life > 0)
				{
					for (int num660 = 0; (double)num660 < dmg / (double)lifeMax * 100.0; num660++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num661 = 0; num661 < 50; num661++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				if (altTexture == 0)
				{
					Gore.NewGore(position, velocity, IsShimmerVariant ? 1362 : 567);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1364 : 568);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1364 : 568);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1365 : 569);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1365 : 569);
			}
			else if (type == 369 || type == 376 || type == 663 || NPCID.Sets.IsTownPet[type] || type == 695 || type == 696)
			{
				if (life <= 0)
				{
					for (int num662 = 0; num662 < 25; num662++)
					{
						int num663 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 2f);
						Dust dust = Main.dust[num663];
						dust.velocity *= 1.4f;
						Main.dust[num663].noLight = true;
						Main.dust[num663].noGravity = true;
					}
					int num664 = 0;
					num664 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num664].scale = 1f;
					Main.gore[num664].velocity.X += 1f;
					Main.gore[num664].velocity.Y += 1f;
					num664 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num664].scale = 1f;
					Main.gore[num664].velocity.X -= 1f;
					Main.gore[num664].velocity.Y += 1f;
					num664 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num664].scale = 1f;
					Main.gore[num664].velocity.X += 1f;
					Main.gore[num664].velocity.Y -= 1f;
					num664 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num664].scale = 1f;
					Main.gore[num664].velocity.X -= 1f;
					Main.gore[num664].velocity.Y -= 1f;
				}
			}
			else if (type == 227)
			{
				if (life > 0)
				{
					for (int num665 = 0; (double)num665 < dmg / (double)lifeMax * 100.0; num665++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num666 = 0; num666 < 50; num666++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				if (altTexture == 0)
				{
					Gore.NewGore(position, velocity, IsShimmerVariant ? 1331 : 320);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1334 : 321);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1333 : 322);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1332 : 323);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1332 : 323);
			}
			else if (type == 228)
			{
				if (life > 0)
				{
					for (int num667 = 0; (double)num667 < dmg / (double)lifeMax * 100.0; num667++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num668 = 0; num668 < 50; num668++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1369 : 324);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1370 : 325);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1372 : 326);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1371 : 327);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1371 : 327);
			}
			else if (type == 229)
			{
				if (life > 0)
				{
					for (int num669 = 0; (double)num669 < dmg / (double)lifeMax * 100.0; num669++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				if (IsShimmerVariant)
				{
					for (int num670 = 0; num670 < 50; num670++)
					{
						int num671 = Dust.NewDust(position, width, height, 180, velocity.X, velocity.Y);
						Dust dust = Main.dust[num671];
						dust.velocity *= 2f;
						Main.dust[num671].noGravity = true;
						Main.dust[num671].scale = 1.4f;
					}
					return;
				}
				for (int num672 = 0; num672 < 50; num672++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				if (altTexture == 0)
				{
					Gore.NewGore(position, velocity, 328);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 329);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 329);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 330);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 330);
			}
			else if (type == 142)
			{
				if (life > 0)
				{
					for (int num673 = 0; (double)num673 < dmg / (double)lifeMax * 100.0; num673++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num674 = 0; num674 < 50; num674++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				if (altTexture == 0)
				{
					Gore.NewGore(position, velocity, IsShimmerVariant ? 1338 : 157);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1340 : 158);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1340 : 158);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1341 : 159);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1341 : 159);
			}
			else if (type == 178)
			{
				if (life > 0)
				{
					for (int num675 = 0; (double)num675 < dmg / (double)lifeMax * 100.0; num675++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num676 = 0; num676 < 50; num676++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				if (altTexture == 0)
				{
					Gore.NewGore(position, velocity, IsShimmerVariant ? 1348 : 231);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1349 : 232);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1349 : 232);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1350 : 233);
			}
			else if (type == 353 || type == 354)
			{
				if (life > 0)
				{
					for (int num677 = 0; (double)num677 < dmg / (double)lifeMax * 100.0; num677++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num678 = 0; num678 < 50; num678++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				if (altTexture == 0)
				{
					Gore.NewGore(position, velocity, IsShimmerVariant ? 1353 : 544);
				}
				if (!IsShimmerVariant)
				{
					Gore.NewGore(position, velocity, 543);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1353 : 546);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1353 : 546);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1354 : 545);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1354 : 545);
			}
			else if (type == 37)
			{
				if (life > 0)
				{
					for (int num679 = 0; (double)num679 < dmg / (double)lifeMax * 100.0; num679++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num680 = 0; num680 < 50; num680++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1328 : 58);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1329 : 59);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1329 : 59);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1330 : 60);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1330 : 60);
			}
			else if (type == 54)
			{
				if (life > 0)
				{
					for (int num681 = 0; (double)num681 < dmg / (double)lifeMax * 100.0; num681++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num682 = 0; num682 < 50; num682++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1291 : 58);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1292 : 59);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1292 : 59);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1293 : 60);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1293 : 60);
			}
			else if (type == 160)
			{
				if (life > 0)
				{
					for (int num683 = 0; (double)num683 < dmg / (double)lifeMax * 100.0; num683++)
					{
						Dust.NewDust(position, width, height, 26, hitDirection, -1f);
					}
					return;
				}
				for (int num684 = 0; num684 < 50; num684++)
				{
					Dust.NewDust(position, width, height, 26, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1366 : 188);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1367 : 189);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1367 : 189);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1368 : 190);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1368 : 190);
			}
			else if (type == 18)
			{
				if (life > 0)
				{
					for (int num685 = 0; (double)num685 < dmg / (double)lifeMax * 100.0; num685++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num686 = 0; num686 < 50; num686++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				if (altTexture == 0)
				{
					Gore.NewGore(position, velocity, IsShimmerVariant ? 1324 : 33);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1326 : 34);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1326 : 34);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1327 : 35);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1327 : 35);
			}
			else if (type == 19)
			{
				if (life > 0)
				{
					for (int num687 = 0; (double)num687 < dmg / (double)lifeMax * 100.0; num687++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num688 = 0; num688 < 50; num688++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1288 : 36);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1289 : 37);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1289 : 37);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1290 : 38);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1290 : 38);
			}
			else if (type == 38)
			{
				if (life > 0)
				{
					for (int num689 = 0; (double)num689 < dmg / (double)lifeMax * 100.0; num689++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num690 = 0; num690 < 50; num690++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				if (altTexture == 0)
				{
					Gore.NewGore(position, velocity, IsShimmerVariant ? 1297 : 64);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1299 : 65);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1299 : 65);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1300 : 66);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1300 : 66);
			}
			else if (type == 20)
			{
				if (life > 0)
				{
					for (int num691 = 0; (double)num691 < dmg / (double)lifeMax * 100.0; num691++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num692 = 0; num692 < 50; num692++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1301 : 39);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1302 : 40);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1302 : 40);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1303 : 41);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1303 : 41);
			}
			else if (type == 207)
			{
				if (life > 0)
				{
					for (int num693 = 0; (double)num693 < dmg / (double)lifeMax * 100.0; num693++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num694 = 0; num694 < 50; num694++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				if (altTexture == 0)
				{
					Gore.NewGore(position, velocity, IsShimmerVariant ? 1304 : 283);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1306 : 284);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1306 : 284);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1307 : 285);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1307 : 285);
			}
			else if (type == 208)
			{
				if (life > 0)
				{
					for (int num695 = 0; (double)num695 < dmg / (double)lifeMax * 100.0; num695++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num696 = 0; num696 < 50; num696++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1335 : 286);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1336 : 287);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1336 : 287);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1337 : 288);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1337 : 288);
			}
			else if (type == 663)
			{
				if (life > 0)
				{
					for (int num697 = 0; (double)num697 < dmg / (double)lifeMax * 100.0; num697++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
				}
				else
				{
					for (int num698 = 0; num698 < 50; num698++)
					{
						Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
					}
				}
			}
			else if (type == 209)
			{
				if (life > 0)
				{
					for (int num699 = 0; (double)num699 < dmg / (double)lifeMax * 100.0; num699++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num700 = 0; num700 < 50; num700++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, IsShimmerVariant ? 1294 : 289);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1295 : 290);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1295 : 290);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1296 : 291);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1296 : 291);
			}
			else if (type >= 212 && type <= 216)
			{
				if (life > 0)
				{
					for (int num701 = 0; (double)num701 < dmg / (double)lifeMax * 100.0; num701++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num702 = 0; num702 < 50; num702++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				if (type == 212)
				{
					Gore.NewGore(position, velocity, 336);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 337);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 337);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 338);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 338);
				}
				else if (type == 213)
				{
					Gore.NewGore(position, velocity, 339);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 340);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 340);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 341);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 341);
				}
				else if (type == 214)
				{
					Gore.NewGore(position, velocity, 342);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 343);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 343);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 344);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 344);
				}
				else if (type == 215)
				{
					Gore.NewGore(position, velocity, 345);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 346);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 346);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 347);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 347);
				}
				else if (type == 216)
				{
					Gore.NewGore(position, velocity, 348);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 349);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 349);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 350);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 350);
				}
			}
			else if (type == 220 || type == 221)
			{
				if (life > 0)
				{
					for (int num703 = 0; (double)num703 < dmg / (double)lifeMax * 50.0; num703++)
					{
						Dust.NewDust(position, width, height, 151, hitDirection, -1f, 0, default(Color), 0.7f);
					}
					return;
				}
				for (int num704 = 0; num704 < 20; num704++)
				{
					Dust.NewDust(position, width, height, 151, 2.5f * (float)hitDirection, -2.5f, 0, default(Color), 0.7f);
				}
				if (type == 221)
				{
					Gore.NewGore(position, velocity, 298, scale);
					Gore.NewGore(position, velocity, 299, scale);
				}
				else
				{
					Gore.NewGore(position, velocity, 297, scale);
				}
			}
			else if (type == 21 || type == 31 || type == 294 || type == 295 || type == 296 || type == 32 || type == 44 || type == 45 || type == 77 || type == 110 || type == 167 || type == 197 || type == 201 || type == 202 || type == 203 || type == 287 || type == 291 || type == 292 || type == 293 || (type >= 322 && type <= 324) || type == 481 || (type >= 449 && type <= 452) || type == 693)
			{
				if (life > 0)
				{
					for (int num705 = 0; (double)num705 < dmg / (double)lifeMax * 50.0; num705++)
					{
						Dust.NewDust(position, width, height, 26, hitDirection, -1f);
					}
					return;
				}
				for (int num706 = 0; num706 < 20; num706++)
				{
					Dust.NewDust(position, width, height, 26, 2.5f * (float)hitDirection, -2.5f);
				}
				if (type == 167)
				{
					Gore.NewGore(position, velocity, 213, scale);
					Gore.NewGore(position, velocity, 214, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 43, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 43, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 212, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 212, scale);
					return;
				}
				if (type == 197)
				{
					Gore.NewGore(position, velocity, 257, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 43, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 43, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 212, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 212, scale);
					return;
				}
				if (type == 481)
				{
					Gore.NewGore(position, velocity, 695, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 696, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 696, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 697, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 697, scale);
					return;
				}
				if (type == 201 || type == 450)
				{
					Gore.NewGore(position, velocity, 265, scale);
					Gore.NewGore(position, velocity, 267, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 43, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 43, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 44, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 44, scale);
					return;
				}
				if (type == 202 || type == 451)
				{
					Gore.NewGore(position, velocity, 268, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 43, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 43, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 44, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 44, scale);
					return;
				}
				if (type == 203 || type == 452)
				{
					Gore.NewGore(position, velocity, 269, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 43, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 43, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 266, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 266, scale);
					return;
				}
				if (type == 322)
				{
					Gore.NewGore(position, velocity, 460, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 461, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 462, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 461, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 462, scale);
					return;
				}
				if (type == 323)
				{
					Gore.NewGore(position, velocity, 463, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 465, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 464, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 464, scale);
					return;
				}
				if (type == 324)
				{
					Gore.NewGore(position, velocity, 466, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 467, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 467, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 468, scale);
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 468, scale);
					return;
				}
				Gore.NewGore(position, velocity, 42, scale);
				if (type == 77)
				{
					Gore.NewGore(position, velocity, 106, scale);
				}
				if (type == 110)
				{
					Gore.NewGore(position, velocity, 130, scale);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 43, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 43, scale);
				if (type == 110)
				{
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 131, scale);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 44, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 44, scale);
			}
			else if (type == 694)
			{
				if (life > 0)
				{
					int num707 = Math.Max(1, Math.Min(5, (int)(dmg / (double)lifeMax * 3.0)));
					for (int num708 = 0; num708 < num707; num708++)
					{
						Vector2 vector29 = base.Center + new Vector2((float)(-width + (int)((float)width * Main.rand.NextFloat())) * 0.5f, (float)(-height + (int)((float)height * Main.rand.NextFloat())) * 0.5f);
						Gore.NewGore(vector29, velocity, 1008, scale);
					}
					return;
				}
				for (int num709 = 0; num709 < 5; num709++)
				{
					Vector2 vector30 = base.Center + new Vector2((float)(-width + (int)((float)width * Main.rand.NextFloat())) * 0.5f, (float)(-height + (int)((float)height * Main.rand.NextFloat())) * 0.5f);
					Gore.NewGore(vector30, velocity, 1008, scale);
					if (num709 < 3)
					{
						vector30 = base.Center + new Vector2((float)(-width + (int)((float)width * Main.rand.NextFloat())) * 0.5f, (float)(-height + (int)((float)height * Main.rand.NextFloat())) * 0.5f);
						Gore.NewGore(vector30, velocity, 1007, scale);
					}
				}
			}
			else if (type == 453)
			{
				if (life > 0)
				{
					for (int num710 = 0; (double)num710 < dmg / (double)lifeMax * 50.0; num710++)
					{
						Dust.NewDust(position, width, height, 26, hitDirection, -1f);
					}
					return;
				}
				for (int num711 = 0; num711 < 20; num711++)
				{
					Dust.NewDust(position, width, height, 26, 2.5f * (float)hitDirection, -2.5f);
				}
				if (altTexture == 0)
				{
					Gore.NewGore(position, velocity, IsShimmerVariant ? 1342 : 638, scale);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1346 : 639, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, IsShimmerVariant ? 1345 : 640, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1344 : 641, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, IsShimmerVariant ? 1347 : 642, scale);
			}
			else if ((type >= 269 && type <= 276) || (type >= 281 && type <= 286))
			{
				if (life > 0)
				{
					for (int num712 = 0; (double)num712 < dmg / (double)lifeMax * 50.0; num712++)
					{
						Dust.NewDust(position, width, height, 26, hitDirection, -1f);
					}
					return;
				}
				for (int num713 = 0; num713 < 20; num713++)
				{
					Dust.NewDust(position, width, height, 26, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 42, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 43, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 43, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 44, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 44, scale);
				if (type == 269)
				{
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 406, scale);
				}
				if (type == 270)
				{
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 407, scale);
				}
				if (type == 271 || type == 272)
				{
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 408, scale);
				}
				if (type == 274)
				{
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 409, scale);
				}
				if (type == 276)
				{
					Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 410, scale);
				}
			}
			else if (type >= 277 && type <= 280)
			{
				if (life > 0)
				{
					for (int num714 = 0; (double)num714 < dmg / (double)lifeMax * 100.0; num714++)
					{
						int num715 = Dust.NewDust(position, width, height, 174, hitDirection, -1f);
						Main.dust[num715].scale = 1.1f;
						Main.dust[num715].noGravity = true;
					}
					return;
				}
				for (int num716 = 0; num716 < 75; num716++)
				{
					int num717 = Dust.NewDust(position, width, height, 174, 1.5f * (float)hitDirection, -0.5f);
					Dust dust = Main.dust[num717];
					dust.velocity *= 2f;
					Main.dust[num717].scale = 1.4f;
					Main.dust[num717].noGravity = true;
				}
			}
			else if (type == 341)
			{
				int num718 = 196;
				if (life > 0)
				{
					for (int num719 = 0; (double)num719 < dmg / (double)lifeMax * 50.0; num719++)
					{
						Dust.NewDust(position, width, height, num718);
					}
					return;
				}
				for (int num720 = 0; num720 < 20; num720++)
				{
					Dust.NewDust(position, width, height, num718);
				}
				int num721 = Gore.NewGore(new Vector2(position.X, position.Y - 10f), new Vector2(hitDirection, 0f), 61, scale);
				Gore gore2 = Main.gore[num721];
				gore2.velocity *= 0.3f;
				num721 = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 10f), new Vector2(hitDirection, 0f), 62, scale);
				gore2 = Main.gore[num721];
				gore2.velocity *= 0.3f;
				num721 = Gore.NewGore(new Vector2(position.X, position.Y + (float)height - 10f), new Vector2(hitDirection, 0f), 63, scale);
				gore2 = Main.gore[num721];
				gore2.velocity *= 0.3f;
			}
			else if (type == 85 || type == 629)
			{
				int num722 = 7;
				if (ai[3] == 2f)
				{
					num722 = 10;
				}
				if (ai[3] == 3f)
				{
					num722 = 37;
				}
				if (life > 0)
				{
					for (int num723 = 0; (double)num723 < dmg / (double)lifeMax * 50.0; num723++)
					{
						Dust.NewDust(position, width, height, num722);
					}
					return;
				}
				for (int num724 = 0; num724 < 20; num724++)
				{
					Dust.NewDust(position, width, height, num722);
				}
				int num725 = Gore.NewGore(new Vector2(position.X, position.Y - 10f), new Vector2(hitDirection, 0f), 61, scale);
				Gore gore2 = Main.gore[num725];
				gore2.velocity *= 0.3f;
				num725 = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 10f), new Vector2(hitDirection, 0f), 62, scale);
				gore2 = Main.gore[num725];
				gore2.velocity *= 0.3f;
				num725 = Gore.NewGore(new Vector2(position.X, position.Y + (float)height - 10f), new Vector2(hitDirection, 0f), 63, scale);
				gore2 = Main.gore[num725];
				gore2.velocity *= 0.3f;
			}
			else if (type == 473 || type == 474 || type == 475 || type == 476)
			{
				int num726 = 31;
				if (life > 0)
				{
					for (int num727 = 0; (double)num727 < dmg / (double)lifeMax * 50.0; num727++)
					{
						Dust.NewDust(position, width, height, num726);
					}
					return;
				}
				for (int num728 = 0; num728 < 20; num728++)
				{
					Dust.NewDust(position, width, height, num726);
				}
				int num729 = Gore.NewGore(base.Center, new Vector2(hitDirection, 0f), 61, scale);
				Gore gore2 = Main.gore[num729];
				gore2.velocity *= 0.3f;
				num729 = Gore.NewGore(base.Center, new Vector2(hitDirection, 0f), 62, scale);
				gore2 = Main.gore[num729];
				gore2.velocity *= 0.3f;
				num729 = Gore.NewGore(base.Center, new Vector2(hitDirection, 0f), 63, scale);
				gore2 = Main.gore[num729];
				gore2.velocity *= 0.3f;
			}
			else if (type == 169)
			{
				if (life > 0)
				{
					for (int num730 = 0; (double)num730 < dmg / (double)lifeMax * 50.0; num730++)
					{
						int num731 = Dust.NewDust(position, width, height, 92, 0f, 0f, 0, default(Color), 1.5f);
						Dust dust = Main.dust[num731];
						dust.velocity *= 1.5f;
						Main.dust[num731].noGravity = true;
					}
					return;
				}
				for (int num732 = 0; num732 < 100; num732++)
				{
					int num733 = Dust.NewDust(position, width, height, 92, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num733].scale = 1.5f;
					Dust dust = Main.dust[num733];
					dust.velocity *= 2f;
					Main.dust[num733].noGravity = true;
				}
			}
			else if (type == 170 || type == 180)
			{
				if (life > 0)
				{
					for (int num734 = 0; (double)num734 < dmg / (double)lifeMax * 50.0; num734++)
					{
						int num735 = Dust.NewDust(position, width, height, 54, 0f, 0f, 0, default(Color), 1.5f);
						Dust dust = Main.dust[num735];
						dust.velocity *= 1.5f;
						Main.dust[num735].noGravity = true;
					}
					return;
				}
				for (int num736 = 0; num736 < 10; num736++)
				{
					int num737 = Dust.NewDust(position, width, height, 54, 0f, 0f, 0, default(Color), 1.5f);
					Dust dust = Main.dust[num737];
					dust.velocity *= 2f;
					Main.dust[num737].noGravity = true;
				}
				for (int num738 = 0; num738 < 4; num738++)
				{
					int num739 = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 10f), new Vector2(hitDirection, 0f), 99, scale);
					Gore gore2 = Main.gore[num739];
					gore2.velocity *= 0.3f;
				}
			}
			else if (type == 171)
			{
				if (life > 0)
				{
					for (int num740 = 0; (double)num740 < dmg / (double)lifeMax * 50.0; num740++)
					{
						int num741 = Dust.NewDust(position, width, height, 16, 0f, 0f, 0, default(Color), 1.5f);
						Dust dust = Main.dust[num741];
						dust.velocity *= 1.5f;
						Main.dust[num741].noGravity = true;
					}
					return;
				}
				for (int num742 = 0; num742 < 10; num742++)
				{
					int num743 = Dust.NewDust(position, width, height, 16, 0f, 0f, 0, default(Color), 1.5f);
					Dust dust = Main.dust[num743];
					dust.velocity *= 2f;
					Main.dust[num743].noGravity = true;
				}
				for (int num744 = 0; num744 < 4; num744++)
				{
					int num745 = 11 + num744;
					if (num745 > 13)
					{
						num745 = Main.rand.Next(11, 14);
					}
					int num746 = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 10f), new Vector2(hitDirection, 0f), num745, scale);
					Gore gore2 = Main.gore[num746];
					gore2.velocity *= 0.3f;
				}
			}
			else if (type == 290)
			{
				if (life <= 0)
				{
					for (int num747 = 0; num747 < 10; num747++)
					{
						int num748 = Dust.NewDust(position, width, height, 16, 0f, 0f, 0, default(Color), 1.5f);
						Dust dust = Main.dust[num748];
						dust.velocity *= 2f;
						Main.dust[num748].noGravity = true;
					}
					int num749 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(11, 14), scale);
					Gore gore2 = Main.gore[num749];
					gore2.velocity *= 0.5f;
					num749 = Gore.NewGore(new Vector2(position.X, position.Y + 20f), default(Vector2), Main.rand.Next(11, 14), scale);
					gore2 = Main.gore[num749];
					gore2.velocity *= 0.5f;
					num749 = Gore.NewGore(new Vector2(position.X, position.Y + 40f), default(Vector2), Main.rand.Next(11, 14), scale);
					gore2 = Main.gore[num749];
					gore2.velocity *= 0.5f;
				}
			}
			else if (type >= 87 && type <= 92)
			{
				if (life > 0)
				{
					for (int num750 = 0; (double)num750 < dmg / (double)lifeMax * 50.0; num750++)
					{
						int num751 = Dust.NewDust(position, width, height, 16, 0f, 0f, 0, default(Color), 1.5f);
						Dust dust = Main.dust[num751];
						dust.velocity *= 1.5f;
						Main.dust[num751].noGravity = true;
					}
					return;
				}
				for (int num752 = 0; num752 < 10; num752++)
				{
					int num753 = Dust.NewDust(position, width, height, 16, 0f, 0f, 0, default(Color), 1.5f);
					Dust dust = Main.dust[num753];
					dust.velocity *= 2f;
					Main.dust[num753].noGravity = true;
				}
				int num754 = Main.rand.Next(1, 4);
				for (int num755 = 0; num755 < num754; num755++)
				{
					int num756 = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 10f), new Vector2(hitDirection, 0f), Main.rand.Next(11, 14), scale);
					Gore gore2 = Main.gore[num756];
					gore2.velocity *= 0.8f;
				}
			}
			else if (type == 78 || type == 79 || type == 80 || type == 630)
			{
				if (life > 0)
				{
					for (int num757 = 0; (double)num757 < dmg / (double)lifeMax * 50.0; num757++)
					{
						int num758 = Dust.NewDust(position, width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
						Dust dust = Main.dust[num758];
						dust.velocity *= 2f;
						Main.dust[num758].noGravity = true;
					}
					return;
				}
				for (int num759 = 0; num759 < 20; num759++)
				{
					int num760 = Dust.NewDust(position, width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
					Dust dust = Main.dust[num760];
					dust.velocity *= 2f;
					Main.dust[num760].noGravity = true;
				}
				int num761 = Gore.NewGore(new Vector2(position.X, position.Y - 10f), new Vector2(hitDirection, 0f), 61, scale);
				Gore gore2 = Main.gore[num761];
				gore2.velocity *= 0.3f;
				num761 = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 10f), new Vector2(hitDirection, 0f), 62, scale);
				gore2 = Main.gore[num761];
				gore2.velocity *= 0.3f;
				num761 = Gore.NewGore(new Vector2(position.X, position.Y + (float)height - 10f), new Vector2(hitDirection, 0f), 63, scale);
				gore2 = Main.gore[num761];
				gore2.velocity *= 0.3f;
			}
			else if (type == 82 || type == 158 || type == 159 || type == 250 || type == 253)
			{
				if (life > 0)
				{
					for (int num762 = 0; (double)num762 < dmg / (double)lifeMax * 50.0; num762++)
					{
						int num763 = Dust.NewDust(position, width, height, 54, 0f, 0f, 50, default(Color), 1.5f);
						Dust dust = Main.dust[num763];
						dust.velocity *= 2f;
						Main.dust[num763].noGravity = true;
					}
					return;
				}
				for (int num764 = 0; num764 < 20; num764++)
				{
					int num765 = Dust.NewDust(position, width, height, 54, 0f, 0f, 50, default(Color), 1.5f);
					Dust dust = Main.dust[num765];
					dust.velocity *= 2f;
					Main.dust[num765].noGravity = true;
				}
				int num766 = Gore.NewGore(new Vector2(position.X, position.Y - 10f), new Vector2(hitDirection, 0f), 99, scale);
				Gore gore2 = Main.gore[num766];
				gore2.velocity *= 0.3f;
				num766 = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 15f), new Vector2(hitDirection, 0f), 99, scale);
				gore2 = Main.gore[num766];
				gore2.velocity *= 0.3f;
				num766 = Gore.NewGore(new Vector2(position.X, position.Y + (float)height - 20f), new Vector2(hitDirection, 0f), 99, scale);
				gore2 = Main.gore[num766];
				gore2.velocity *= 0.3f;
			}
			else if (type == 316 || type == 330)
			{
				if (life > 0)
				{
					for (int num767 = 0; (double)num767 < dmg / (double)lifeMax * 100.0; num767++)
					{
						int num768 = Dust.NewDust(position, width, height, 192, hitDirection, -1f, 100, new Color(100, 100, 100, 100));
						Main.dust[num768].noGravity = true;
					}
				}
				else
				{
					for (int num769 = 0; num769 < 50; num769++)
					{
						int num770 = Dust.NewDust(position, width, height, 192, 2 * hitDirection, -2f, 100, new Color(100, 100, 100, 100));
						Main.dust[num770].noGravity = true;
					}
				}
			}
			else if (type == 662)
			{
				if (life > 0)
				{
					for (int num771 = 0; (double)num771 < dmg / (double)lifeMax * 100.0; num771++)
					{
						int num772 = Dust.NewDust(position, width, height, 180, velocity.X, velocity.Y);
						Dust dust = Main.dust[num772];
						dust.velocity *= 2f;
						Main.dust[num772].noGravity = true;
						Main.dust[num772].scale = 1.4f;
					}
				}
				else
				{
					for (int num773 = 0; num773 < 50; num773++)
					{
						int num774 = Dust.NewDust(position, width, height, 180, velocity.X, velocity.Y);
						Dust dust = Main.dust[num774];
						dust.velocity *= 2f;
						Main.dust[num774].noGravity = true;
						Main.dust[num774].scale = 1.4f;
					}
				}
			}
			else if (type == 315)
			{
				if (life > 0)
				{
					for (int num775 = 0; (double)num775 < dmg / (double)lifeMax * 50.0; num775++)
					{
						int num776 = Dust.NewDust(position, width, height, 54, 0f, 0f, 50, default(Color), 1.5f);
						Dust dust = Main.dust[num776];
						dust.velocity *= 2f;
						Main.dust[num776].noGravity = true;
					}
					return;
				}
				for (int num777 = 0; num777 < 20; num777++)
				{
					int num778 = Dust.NewDust(position, width, height, 54, 0f, 0f, 50, default(Color), 1.5f);
					Dust dust = Main.dust[num778];
					dust.velocity *= 2f;
					Main.dust[num778].noGravity = true;
				}
				int num779 = Gore.NewGore(new Vector2(position.X, position.Y - 10f), new Vector2(hitDirection, 0f), 99, scale);
				Gore gore2 = Main.gore[num779];
				gore2.velocity *= 0.3f;
				num779 = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 15f), new Vector2(hitDirection, 0f), 99, scale);
				gore2 = Main.gore[num779];
				gore2.velocity *= 0.3f;
				num779 = Gore.NewGore(new Vector2(position.X, position.Y + (float)height - 20f), new Vector2(hitDirection, 0f), 99, scale);
				gore2 = Main.gore[num779];
				gore2.velocity *= 0.3f;
				num779 = Gore.NewGore(new Vector2(position.X, position.Y), new Vector2(hitDirection, 0f), 446, scale);
				gore2 = Main.gore[num779];
				gore2.velocity *= 0.1f;
			}
			else if (type == 254 || type == 255 || type == 256 || type == 257 || type == 258 || type == 259 || type == 260 || type == 261 || type == 634 || type == 635)
			{
				if (life > 0)
				{
					for (int num780 = 0; (double)num780 < dmg / (double)lifeMax * 50.0; num780++)
					{
						int num781 = Dust.NewDust(position, width, height, 165, 0f, 0f, 50, default(Color), 1.5f);
						Dust dust = Main.dust[num781];
						dust.velocity *= 2f;
						Main.dust[num781].noGravity = true;
					}
					return;
				}
				for (int num782 = 0; num782 < 20; num782++)
				{
					int num783 = Dust.NewDust(position, width, height, 165, 0f, 0f, 50, default(Color), 1.5f);
					Dust dust = Main.dust[num783];
					dust.velocity *= 2f;
					Main.dust[num783].noGravity = true;
				}
				if (type != 261)
				{
					int num784 = Gore.NewGore(new Vector2(position.X, position.Y - 10f), new Vector2(hitDirection, 0f), 375, scale);
					Gore gore2 = Main.gore[num784];
					gore2.velocity *= 0.3f;
					num784 = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 15f), new Vector2(hitDirection, 0f), 376, scale);
					gore2 = Main.gore[num784];
					gore2.velocity *= 0.3f;
					num784 = Gore.NewGore(new Vector2(position.X, position.Y + (float)height - 20f), new Vector2(hitDirection, 0f), 377, scale);
					gore2 = Main.gore[num784];
					gore2.velocity *= 0.3f;
				}
			}
			else if (type == 140)
			{
				if (life <= 0)
				{
					for (int num785 = 0; num785 < 20; num785++)
					{
						int num786 = Dust.NewDust(position, width, height, 54, 0f, 0f, 50, default(Color), 1.5f);
						Dust dust = Main.dust[num786];
						dust.velocity *= 2f;
						Main.dust[num786].noGravity = true;
					}
					int num787 = Gore.NewGore(new Vector2(position.X, position.Y - 10f), new Vector2(hitDirection, 0f), 99, scale);
					Gore gore2 = Main.gore[num787];
					gore2.velocity *= 0.3f;
					num787 = Gore.NewGore(new Vector2(position.X, position.Y + (float)(height / 2) - 15f), new Vector2(hitDirection, 0f), 99, scale);
					gore2 = Main.gore[num787];
					gore2.velocity *= 0.3f;
					num787 = Gore.NewGore(new Vector2(position.X, position.Y + (float)height - 20f), new Vector2(hitDirection, 0f), 99, scale);
					gore2 = Main.gore[num787];
					gore2.velocity *= 0.3f;
				}
			}
			else if (type == 39 || type == 40 || type == 41)
			{
				if (life > 0)
				{
					for (int num788 = 0; (double)num788 < dmg / (double)lifeMax * 50.0; num788++)
					{
						Dust.NewDust(position, width, height, 26, hitDirection, -1f);
					}
					return;
				}
				for (int num789 = 0; num789 < 20; num789++)
				{
					Dust.NewDust(position, width, height, 26, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, type - 39 + 67);
			}
			else if (type == 34)
			{
				if (life > 0)
				{
					for (int num790 = 0; (double)num790 < dmg / (double)lifeMax * 30.0; num790++)
					{
						int num791 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 15, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100, default(Color), 1.8f);
						Main.dust[num791].noLight = true;
						Main.dust[num791].noGravity = true;
						Dust dust = Main.dust[num791];
						dust.velocity *= 1.3f;
						num791 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 26, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 0, default(Color), 0.9f);
						Main.dust[num791].noLight = true;
						dust = Main.dust[num791];
						dust.velocity *= 1.3f;
					}
				}
				else
				{
					for (int num792 = 0; num792 < 15; num792++)
					{
						int num793 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 15, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100, default(Color), 1.8f);
						Main.dust[num793].noLight = true;
						Main.dust[num793].noGravity = true;
						Dust dust = Main.dust[num793];
						dust.velocity *= 1.3f;
						num793 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 26, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 0, default(Color), 0.9f);
						Main.dust[num793].noLight = true;
						dust = Main.dust[num793];
						dust.velocity *= 1.3f;
					}
				}
			}
			else if (type == 289)
			{
				if (life > 0)
				{
					for (int num794 = 0; (double)num794 < dmg / (double)lifeMax * 30.0; num794++)
					{
						int num795 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 181, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100, default(Color), 1.8f);
						Main.dust[num795].noLight = true;
						Main.dust[num795].noGravity = true;
						Dust dust = Main.dust[num795];
						dust.velocity *= 1.3f;
					}
				}
				else
				{
					for (int num796 = 0; num796 < 50; num796++)
					{
						int num797 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 181, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100, default(Color), 1.8f);
						Main.dust[num797].noLight = true;
						Main.dust[num797].noGravity = true;
						Dust dust = Main.dust[num797];
						dust.velocity *= 1.3f;
					}
				}
			}
			else if (type == 35 || type == 36 || type == 68)
			{
				if (life > 0)
				{
					for (int num798 = 0; (double)num798 < dmg / (double)lifeMax * 100.0; num798++)
					{
						Dust.NewDust(position, width, height, 26, hitDirection, -1f);
					}
					return;
				}
				for (int num799 = 0; num799 < 150; num799++)
				{
					Dust.NewDust(position, width, height, 26, 2.5f * (float)hitDirection, -2.5f);
				}
				if (type == 35 || type == 68)
				{
					if (RedHatSkeletronAdjustmentsEnabled())
					{
						Gore.NewGore(position, velocity, 1398);
						Gore.NewGore(position, velocity, 1399);
						Gore.NewGore(position, velocity, 1400);
					}
					else
					{
						Gore.NewGore(position, velocity, 54);
						Gore.NewGore(position, velocity, 55);
					}
				}
				else if (RedHatSkeletronAdjustmentsEnabled())
				{
					Gore.NewGore(position, velocity, 1401);
					Gore.NewGore(position, velocity, 1402);
					Gore.NewGore(position, velocity, 1402);
					Gore.NewGore(position, velocity, 1402);
				}
				else
				{
					Gore.NewGore(position, velocity, 56);
					Gore.NewGore(position, velocity, 57);
					Gore.NewGore(position, velocity, 57);
					Gore.NewGore(position, velocity, 57);
				}
			}
			else if (type == 139)
			{
				if (life <= 0)
				{
					for (int num800 = 0; num800 < 10; num800++)
					{
						int num801 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust = Main.dust[num801];
						dust.velocity *= 1.4f;
					}
					for (int num802 = 0; num802 < 5; num802++)
					{
						int num803 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num803].noGravity = true;
						Dust dust = Main.dust[num803];
						dust.velocity *= 5f;
						num803 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust = Main.dust[num803];
						dust.velocity *= 3f;
					}
					int num804 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num804];
					gore2.velocity *= 0.4f;
					Main.gore[num804].velocity.X += 1f;
					Main.gore[num804].velocity.Y += 1f;
					num804 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num804];
					gore2.velocity *= 0.4f;
					Main.gore[num804].velocity.X -= 1f;
					Main.gore[num804].velocity.Y += 1f;
					num804 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num804];
					gore2.velocity *= 0.4f;
					Main.gore[num804].velocity.X += 1f;
					Main.gore[num804].velocity.Y -= 1f;
					num804 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num804];
					gore2.velocity *= 0.4f;
					Main.gore[num804].velocity.X -= 1f;
					Main.gore[num804].velocity.Y -= 1f;
				}
			}
			else if (type == 467)
			{
				if (life <= 0)
				{
					for (int num805 = 0; num805 < 7; num805++)
					{
						int num806 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust = Main.dust[num806];
						dust.velocity *= 1.4f;
					}
					for (int num807 = 0; num807 < 3; num807++)
					{
						int num808 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num808].noGravity = true;
						Dust dust = Main.dust[num808];
						dust.velocity *= 5f;
						num808 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust = Main.dust[num808];
						dust.velocity *= 3f;
					}
					Gore.NewGore(position, velocity, 660);
					Gore.NewGore(position, velocity, 660);
				}
			}
			else if (type >= 134 && type <= 136)
			{
				if (type == 135 && life > 0 && Main.netMode != 1)
				{
					int maxValue = 25;
					if (IsMechQueenUp)
					{
						maxValue = 50;
					}
					if (ai[2] == 0f && Main.rand.Next(maxValue) == 0)
					{
						ai[2] = 1f;
						int num809 = NewNPC(GetSpawnSource_NPCHurt(), (int)(position.X + (float)(width / 2)), (int)(position.Y + (float)height), 139);
						if (Main.netMode == 2 && num809 < Main.maxNPCs)
						{
							NetMessage.SendData(23, -1, -1, null, num809);
						}
						netUpdate = true;
					}
				}
				if (life > 0)
				{
					return;
				}
				Gore.NewGore(position, velocity, 156);
				if (Main.rand.Next(2) == 0)
				{
					for (int num810 = 0; num810 < 10; num810++)
					{
						int num811 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust = Main.dust[num811];
						dust.velocity *= 1.4f;
					}
					for (int num812 = 0; num812 < 5; num812++)
					{
						int num813 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num813].noGravity = true;
						Dust dust = Main.dust[num813];
						dust.velocity *= 5f;
						num813 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust = Main.dust[num813];
						dust.velocity *= 3f;
					}
					int num814 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num814];
					gore2.velocity *= 0.4f;
					Main.gore[num814].velocity.X += 1f;
					Main.gore[num814].velocity.Y += 1f;
					num814 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num814];
					gore2.velocity *= 0.4f;
					Main.gore[num814].velocity.X -= 1f;
					Main.gore[num814].velocity.Y += 1f;
					num814 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num814];
					gore2.velocity *= 0.4f;
					Main.gore[num814].velocity.X += 1f;
					Main.gore[num814].velocity.Y -= 1f;
					num814 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num814];
					gore2.velocity *= 0.4f;
					Main.gore[num814].velocity.X -= 1f;
					Main.gore[num814].velocity.Y -= 1f;
				}
			}
			else if (type == 347)
			{
				if (life <= 0)
				{
					Gore.NewGore(position, velocity, 524);
					Gore.NewGore(position, velocity, 525);
					Gore.NewGore(position, velocity, 526);
					Gore.NewGore(position, velocity, 527);
					for (int num815 = 0; num815 < 7; num815++)
					{
						int num816 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust = Main.dust[num816];
						dust.velocity *= 1.4f;
					}
					for (int num817 = 0; num817 < 4; num817++)
					{
						int num818 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num818].noGravity = true;
						Dust dust = Main.dust[num818];
						dust.velocity *= 5f;
						num818 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust = Main.dust[num818];
						dust.velocity *= 3f;
					}
					int num819 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num819];
					gore2.velocity *= 0.4f;
					Main.gore[num819].velocity.X += 1f;
					Main.gore[num819].velocity.Y += 1f;
					num819 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num819];
					gore2.velocity *= 0.4f;
					Main.gore[num819].velocity.X -= 1f;
					Main.gore[num819].velocity.Y -= 1f;
				}
			}
			else if (type == 346)
			{
				if (life <= 0)
				{
					Gore.NewGore(position, velocity, 518);
					Gore.NewGore(position, velocity, 519);
					Gore.NewGore(position, velocity, 520);
					Gore.NewGore(position, velocity, 521);
					Gore.NewGore(position, velocity, 522);
					Gore.NewGore(position, velocity, 523);
					for (int num820 = 0; num820 < 10; num820++)
					{
						int num821 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust = Main.dust[num821];
						dust.velocity *= 1.4f;
					}
					for (int num822 = 0; num822 < 5; num822++)
					{
						int num823 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num823].noGravity = true;
						Dust dust = Main.dust[num823];
						dust.velocity *= 5f;
						num823 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust = Main.dust[num823];
						dust.velocity *= 3f;
					}
					int num824 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num824];
					gore2.velocity *= 0.4f;
					Main.gore[num824].velocity.X += 1f;
					Main.gore[num824].velocity.Y += 1f;
					num824 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num824];
					gore2.velocity *= 0.4f;
					Main.gore[num824].velocity.X -= 1f;
					Main.gore[num824].velocity.Y += 1f;
					num824 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num824];
					gore2.velocity *= 0.4f;
					Main.gore[num824].velocity.X += 1f;
					Main.gore[num824].velocity.Y -= 1f;
					num824 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num824];
					gore2.velocity *= 0.4f;
					Main.gore[num824].velocity.X -= 1f;
					Main.gore[num824].velocity.Y -= 1f;
				}
			}
			else if (type == 127)
			{
				if (life <= 0)
				{
					Gore.NewGore(position, velocity, 149);
					Gore.NewGore(position, velocity, 150);
					for (int num825 = 0; num825 < 10; num825++)
					{
						int num826 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust = Main.dust[num826];
						dust.velocity *= 1.4f;
					}
					for (int num827 = 0; num827 < 5; num827++)
					{
						int num828 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num828].noGravity = true;
						Dust dust = Main.dust[num828];
						dust.velocity *= 5f;
						num828 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust = Main.dust[num828];
						dust.velocity *= 3f;
					}
					int num829 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num829];
					gore2.velocity *= 0.4f;
					Main.gore[num829].velocity.X += 1f;
					Main.gore[num829].velocity.Y += 1f;
					num829 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num829];
					gore2.velocity *= 0.4f;
					Main.gore[num829].velocity.X -= 1f;
					Main.gore[num829].velocity.Y += 1f;
					num829 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num829];
					gore2.velocity *= 0.4f;
					Main.gore[num829].velocity.X += 1f;
					Main.gore[num829].velocity.Y -= 1f;
					num829 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num829];
					gore2.velocity *= 0.4f;
					Main.gore[num829].velocity.X -= 1f;
					Main.gore[num829].velocity.Y -= 1f;
				}
			}
			else if (type >= 128 && type <= 131)
			{
				if (life <= 0)
				{
					Gore.NewGore(position, velocity, 147);
					Gore.NewGore(position, velocity, 148);
					for (int num830 = 0; num830 < 10; num830++)
					{
						int num831 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust = Main.dust[num831];
						dust.velocity *= 1.4f;
					}
					for (int num832 = 0; num832 < 5; num832++)
					{
						int num833 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num833].noGravity = true;
						Dust dust = Main.dust[num833];
						dust.velocity *= 5f;
						num833 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust = Main.dust[num833];
						dust.velocity *= 3f;
					}
					int num834 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num834];
					gore2.velocity *= 0.4f;
					Main.gore[num834].velocity.X += 1f;
					Main.gore[num834].velocity.Y += 1f;
					num834 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num834];
					gore2.velocity *= 0.4f;
					Main.gore[num834].velocity.X -= 1f;
					Main.gore[num834].velocity.Y += 1f;
					num834 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num834];
					gore2.velocity *= 0.4f;
					Main.gore[num834].velocity.X += 1f;
					Main.gore[num834].velocity.Y -= 1f;
					num834 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num834];
					gore2.velocity *= 0.4f;
					Main.gore[num834].velocity.X -= 1f;
					Main.gore[num834].velocity.Y -= 1f;
				}
			}
			else if (type == 23)
			{
				if (life > 0)
				{
					for (int num835 = 0; (double)num835 < dmg / (double)lifeMax * 100.0; num835++)
					{
						int num836 = 25;
						if (Main.rand.Next(2) == 0)
						{
							num836 = 6;
						}
						Dust.NewDust(position, width, height, num836, hitDirection, -1f);
						int num837 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
						Main.dust[num837].noGravity = true;
					}
					return;
				}
				for (int num838 = 0; num838 < 50; num838++)
				{
					int num839 = 25;
					if (Main.rand.Next(2) == 0)
					{
						num839 = 6;
					}
					Dust.NewDust(position, width, height, num839, 2 * hitDirection, -2f);
				}
				for (int num840 = 0; num840 < 50; num840++)
				{
					int num841 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2.5f);
					Dust dust = Main.dust[num841];
					dust.velocity *= 6f;
					Main.dust[num841].noGravity = true;
				}
			}
			else if (type == 24)
			{
				if (life > 0)
				{
					for (int num842 = 0; (double)num842 < dmg / (double)lifeMax * 100.0; num842++)
					{
						int num843 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, velocity.X, velocity.Y, 100, default(Color), 2.5f);
						Main.dust[num843].noGravity = true;
					}
					return;
				}
				for (int num844 = 0; num844 < 50; num844++)
				{
					int num845 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, velocity.X, velocity.Y, 100, default(Color), 2.5f);
					Main.dust[num845].noGravity = true;
					Dust dust = Main.dust[num845];
					dust.velocity *= 2f;
				}
				Gore.NewGore(position, velocity, 45);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 46);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 46);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 47);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 47);
			}
			else if (type == 25)
			{
				SoundEngine.PlaySound(SoundID.Item10, position);
				for (int num846 = 0; num846 < 20; num846++)
				{
					int num847 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100, default(Color), 2f);
					Main.dust[num847].noGravity = true;
					Dust dust = Main.dust[num847];
					dust.velocity *= 2f;
					num847 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100);
					dust = Main.dust[num847];
					dust.velocity *= 2f;
				}
			}
			else if (type == 33)
			{
				SoundEngine.PlaySound(SoundID.Item10, position);
				for (int num848 = 0; num848 < 20; num848++)
				{
					int num849 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 172, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100, default(Color), 1.2f);
					Main.dust[num849].noGravity = true;
					Dust dust = Main.dust[num849];
					dust.velocity *= 2f;
					num849 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 172, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100, default(Color), 0.6f);
					dust = Main.dust[num849];
					dust.velocity *= 2f;
				}
			}
			else if (type == 26 || type == 27 || type == 28 || type == 29 || type == 73 || type == 111)
			{
				if (life > 0)
				{
					for (int num850 = 0; (double)num850 < dmg / (double)lifeMax * 100.0; num850++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num851 = 0; num851 < 50; num851++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				int num852 = 48;
				int num853 = 49;
				int num854 = 50;
				if (type == 111)
				{
					num852 = 623;
					num853 = 624;
					num854 = 625;
				}
				else if (type == 26)
				{
					num852 = 626;
					num853 = 627;
					num854 = 628;
				}
				else if (type == 73)
				{
					num852 = 629;
					num853 = 630;
					num854 = 631;
				}
				else if (type == 27)
				{
					num852 = 632;
					num853 = 633;
					num854 = 634;
				}
				else if (type == 28)
				{
					num852 = 635;
					num853 = 636;
					num854 = 637;
				}
				Gore.NewGore(position, velocity, num852, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num853, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, num853, scale);
				if (type == 111)
				{
					Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 131, scale);
				}
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, num854, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, num854, scale);
			}
			else if (type == 471)
			{
				if (life > 0)
				{
					for (int num855 = 0; (double)num855 < dmg / (double)lifeMax * 100.0; num855++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num856 = 0; num856 < 50; num856++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 675, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 676, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 677, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 678, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 678, scale);
			}
			else if (type == 472)
			{
				if (life > 0)
				{
					for (int num857 = 0; (double)num857 < dmg / (double)lifeMax * 100.0; num857++)
					{
						int num858 = Dust.NewDust(position, width, height, 5, hitDirection, -1f);
						if (Main.rand.Next(3) != 0)
						{
							Main.dust[num858].noGravity = true;
						}
						Main.dust[num858].alpha = 100;
					}
					return;
				}
				for (int num859 = 0; num859 < 50; num859++)
				{
					int num860 = Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
					if (Main.rand.Next(3) != 0)
					{
						Main.dust[num860].noGravity = true;
					}
					Main.dust[num860].alpha = 100;
				}
				Gore.NewGore(position, velocity, 679, scale);
				Gore.NewGore(position, velocity, 680, scale);
			}
			else if (type == 480)
			{
				if (life > 0)
				{
					for (int num861 = 0; (double)num861 < dmg / (double)lifeMax * 100.0; num861++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num862 = 0; num862 < 50; num862++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 692, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 693, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 20f), velocity, 693, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 694, scale);
				Gore.NewGore(new Vector2(position.X, position.Y + 34f), velocity, 694, scale);
			}
			else if (type == 185)
			{
				if (life > 0)
				{
					for (int num863 = 0; (double)num863 < dmg / (double)lifeMax * 100.0; num863++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num864 = 0; num864 < 50; num864++)
				{
					Dust.NewDust(position, width, height, 5, 2.5f * (float)hitDirection, -2.5f);
				}
				Gore.NewGore(position, velocity, 240, scale);
			}
			else if (type == 30 || type == 665)
			{
				SoundEngine.PlaySound(SoundID.Item10, position);
				for (int num865 = 0; num865 < 20; num865++)
				{
					int num866 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100, default(Color), 2f);
					Main.dust[num866].noGravity = true;
					Dust dust = Main.dust[num866];
					dust.velocity *= 2f;
					num866 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100);
					dust = Main.dust[num866];
					dust.velocity *= 2f;
				}
			}
			else if (type == 42 || type == 176 || type == 205 || (type >= 231 && type <= 235))
			{
				if (life > 0)
				{
					for (int num867 = 0; (double)num867 < dmg / (double)lifeMax * 100.0; num867++)
					{
						Dust.NewDust(position, width, height, 18, hitDirection, -1f, alpha, this.color, scale);
					}
					return;
				}
				for (int num868 = 0; num868 < 50; num868++)
				{
					Dust.NewDust(position, width, height, 18, hitDirection, -2f, alpha, this.color, scale);
				}
				if (type == 205)
				{
					Gore.NewGore(position, velocity, 270, scale);
					Gore.NewGore(position, velocity, 271, scale);
					Gore.NewGore(position, velocity, 271, scale);
					Gore.NewGore(position, velocity, 272, scale);
					return;
				}
				if (type == 176)
				{
					Gore.NewGore(position, velocity, 229, scale);
					Gore.NewGore(position, velocity, 230, scale);
					return;
				}
				int num869 = 70;
				if (type == 232)
				{
					num869 = 1384;
				}
				else if (type == 234)
				{
					num869 = 1385;
				}
				Gore.NewGore(position, velocity, num869, scale);
				Gore.NewGore(position, velocity, 71, scale);
			}
			else if (type == 43 || type == 56)
			{
				if (life > 0)
				{
					for (int num870 = 0; (double)num870 < dmg / (double)lifeMax * 100.0; num870++)
					{
						Dust.NewDust(position, width, height, 40, hitDirection, -1f, alpha, this.color, 1.2f);
					}
					return;
				}
				for (int num871 = 0; num871 < 50; num871++)
				{
					Dust.NewDust(position, width, height, 40, hitDirection, -2f, alpha, this.color, 1.2f);
				}
				Gore.NewGore(position, velocity, 72);
				Gore.NewGore(position, velocity, 72);
			}
			else if (type == 175)
			{
				if (life > 0)
				{
					for (int num872 = 0; (double)num872 < dmg / (double)lifeMax * 100.0; num872++)
					{
						Dust.NewDust(position, width, height, 40, hitDirection, -1f, alpha, this.color, 1.2f);
					}
					return;
				}
				for (int num873 = 0; num873 < 50; num873++)
				{
					Dust.NewDust(position, width, height, 40, hitDirection, -2f, alpha, this.color, 1.2f);
				}
				Gore.NewGore(position, velocity, 227);
				Gore.NewGore(position, velocity, 228);
			}
			else if (type == 48)
			{
				if (life > 0)
				{
					for (int num874 = 0; (double)num874 < dmg / (double)lifeMax * 100.0; num874++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num875 = 0; num875 < 50; num875++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 80);
				Gore.NewGore(position, velocity, 81);
			}
			else if (type == 62 || type == 66)
			{
				if (life > 0)
				{
					for (int num876 = 0; (double)num876 < dmg / (double)lifeMax * 100.0; num876++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num877 = 0; num877 < 50; num877++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 93);
				Gore.NewGore(position, velocity, 94);
				Gore.NewGore(position, velocity, 94);
			}
			else
			{
				if (type != 156)
				{
					return;
				}
				if (life > 0)
				{
					for (int num878 = 0; (double)num878 < dmg / (double)lifeMax * 100.0; num878++)
					{
						Dust.NewDust(position, width, height, 5, hitDirection, -1f);
					}
					return;
				}
				for (int num879 = 0; num879 < 50; num879++)
				{
					Dust.NewDust(position, width, height, 5, 2 * hitDirection, -2f);
				}
				Gore.NewGore(position, velocity, 184);
				Gore.NewGore(position, velocity, 185);
				Gore.NewGore(position, velocity, 185);
			}
		}
	}

	public static int CountNPCS(int Type)
	{
		int num = 0;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (Main.npc[i].active && Main.npc[i].type == Type)
			{
				num++;
			}
		}
		return num;
	}

	public static bool AnyHelpfulFairies()
	{
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (Main.npc[i].active && (Main.npc[i].type == 583 || Main.npc[i].type == 584 || Main.npc[i].type == 585) && Main.npc[i].ai[2] > 1f)
			{
				return true;
			}
		}
		return false;
	}

	private static bool AnyLifeCrystalSlimes()
	{
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (Main.npc[i].active && Main.npc[i].type == 1 && Main.npc[i].ai[1] == 29f)
			{
				return true;
			}
		}
		return false;
	}

	public static bool AnyNPCs(int Type)
	{
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (Main.npc[i].active && Main.npc[i].type == Type)
			{
				return true;
			}
		}
		return false;
	}

	public static int FindFirstNPC(int Type)
	{
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (Main.npc[i].active && Main.npc[i].type == Type)
			{
				return i;
			}
		}
		return -1;
	}

	public static bool NearSpikeBall(int x, int y)
	{
		Rectangle rectangle = new Rectangle(x * 16 - 300, y * 16 - 300, 600, 600);
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (Main.npc[i].active && Main.npc[i].aiStyle == 20)
			{
				Rectangle rectangle2 = new Rectangle((int)Main.npc[i].ai[1], (int)Main.npc[i].ai[2], 20, 20);
				if (rectangle.Intersects(rectangle2))
				{
					return true;
				}
			}
		}
		return false;
	}

	public int FindBuffIndex(int type)
	{
		if (buffImmune[type])
		{
			return -1;
		}
		for (int i = 0; i < maxBuffs; i++)
		{
			if (buffTime[i] >= 1 && buffType[i] == type)
			{
				return i;
			}
		}
		return -1;
	}

	public void AddBuff(int type, int time, bool quiet = false)
	{
		if (buffImmune[type])
		{
			return;
		}
		if (!quiet && Main.netMode == 1)
		{
			NetMessage.SendData(53, -1, -1, null, whoAmI, type, time);
		}
		int num = -1;
		for (int i = 0; i < maxBuffs; i++)
		{
			if (buffType[i] == type)
			{
				if (buffTime[i] >= time)
				{
					return;
				}
				num = i;
				break;
			}
		}
		while (num == -1)
		{
			int num2 = -1;
			for (int j = 0; j < maxBuffs; j++)
			{
				if (!Main.debuff[buffType[j]])
				{
					num2 = j;
					break;
				}
			}
			if (num2 == -1)
			{
				return;
			}
			for (int k = num2; k < maxBuffs; k++)
			{
				if (buffType[k] == 0)
				{
					num = k;
					break;
				}
			}
			if (num == -1)
			{
				DelBuff(num2, quiet: true);
			}
		}
		buffType[num] = type;
		buffTime[num] = time;
		if (!quiet && Main.netMode == 2)
		{
			NetMessage.SendData(54, -1, -1, null, whoAmI);
		}
	}

	public void RequestBuffRemoval(int buffTypeToRemove)
	{
		if (buffTypeToRemove < 0 || buffTypeToRemove >= BuffID.Count || !BuffID.Sets.CanBeRemovedByNetMessage[buffTypeToRemove])
		{
			return;
		}
		int num = FindBuffIndex(buffTypeToRemove);
		if (num != -1)
		{
			DelBuff(num);
			if (Main.netMode == 1)
			{
				NetMessage.SendData(137, -1, -1, null, whoAmI, buffTypeToRemove);
			}
		}
	}

	public void DelBuff(int buffIndex, bool quiet = false)
	{
		buffTime[buffIndex] = 0;
		buffType[buffIndex] = 0;
		for (int i = 0; i < maxBuffs - 1; i++)
		{
			if (buffTime[i] == 0 || buffType[i] == 0)
			{
				for (int j = i + 1; j < maxBuffs; j++)
				{
					buffTime[j - 1] = buffTime[j];
					buffType[j - 1] = buffType[j];
					buffTime[j] = 0;
					buffType[j] = 0;
				}
			}
		}
		if (!quiet && Main.netMode == 2)
		{
			NetMessage.SendData(54, -1, -1, null, whoAmI);
		}
	}

	public Rectangle getRect()
	{
		return new Rectangle((int)position.X, (int)position.Y, width, height);
	}

	public bool CanBeChasedBy(object attacker = null, bool ignoreDontTakeDamage = false)
	{
		if (active && chaseable && lifeMax > 5 && (!dontTakeDamage || ignoreDontTakeDamage) && !friendly)
		{
			if (!DebugOptions.LetProjectilesAimAtTargetDummies)
			{
				return !immortal;
			}
			return true;
		}
		return false;
	}

	public bool HittableForOnHitRewards()
	{
		if (CountsAsACritter || immortal)
		{
			return false;
		}
		return true;
	}

	public void moneyPing(Vector2 pos)
	{
		SoundEngine.PlaySound(38, pos);
		int num = 244;
		if (extraValue >= 1000000)
		{
			num = 247;
		}
		else if (extraValue >= 10000)
		{
			num = 246;
		}
		else if (extraValue >= 100)
		{
			num = 245;
		}
		for (int i = 0; i < 20; i++)
		{
			int num2 = Dust.NewDust(pos - new Vector2(1f, 2f), 10, 14, num, 0f, 0f, 254, default(Color), 0.25f);
			Main.dust[num2].velocity *= 0.2f;
		}
	}

	public void IdleSounds()
	{
		if (!(shimmerTransparency > 0f))
		{
			if ((type == 239 || type == 240) && Main.rand.Next(900) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(24, 26));
			}
			else if ((type == 62 || type == 156) && Main.rand.Next(700) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(26, 30));
			}
			else if (type == 177 && Main.rand.Next(600) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(30, 32));
			}
			else if (type == 226 && Main.rand.Next(800) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 32);
			}
			else if (type == 153 && Main.rand.Next(1000) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 33);
			}
			else if (wet && (type == 63 || type == 64 || type == 103) && Main.rand.Next(1000) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(34, 36));
			}
			else if ((type == 198 || type == 199) && Main.rand.Next(1000) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(36, 38));
			}
			else if ((type == 170 || type == 180 || type == 171) && Main.rand.Next(600) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(38, 41));
			}
			else if (type == 250 && Main.rand.Next(700) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(41, 44));
			}
			else if (type == 580 && Main.rand.Next(800) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 44);
			}
			else if (type == 582 && Main.rand.Next(800) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 44);
			}
			else if (type == 581 && Main.rand.Next(800) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(44, 47));
			}
			else if (type == 508 && Main.rand.Next(800) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 44);
			}
			else if (type == 509 && Main.rand.Next(800) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(44, 47));
			}
			else if (type == 494 && Main.rand.Next(600) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 47);
			}
			else if (type == 467 && Main.rand.Next(700) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(48, 50));
			}
			else if (type == 468 && Main.rand.Next(700) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(50, 53));
			}
			else if (type == 288 && Main.rand.Next(400) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(53, 55));
			}
			else if ((type == 524 || type == 525 || type == 526 || type == 527) && Main.rand.Next(700) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(55, 57));
			}
			else if ((type == 496 || type == 497) && Main.rand.Next(600) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(57, 59));
			}
			else if (type == 389 && Main.rand.Next(800) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(59, 61));
			}
			else if (type == 471 && Main.rand.Next(600) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(61, 63));
			}
			else if (type == 482 && Main.rand.Next(600) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(63, 66));
			}
			else if (type == 388 && Main.rand.Next(700) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(66, 69));
			}
			else if (type == 520 && Main.rand.Next(800) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(69, 73));
			}
			else if (type == 477 && Main.rand.Next(600) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 73);
			}
			else if (type == 258 && Main.rand.Next(700) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(74, 78));
			}
			else if (type == 252 && Main.rand.Next(700) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 78);
			}
			else if (type == 469 && Main.rand.Next(700) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(79, 81));
			}
			else if ((type == 253 || type == 82) && Main.rand.Next(700) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(81, 84));
			}
			else if (type >= 498 && type <= 506 && Main.rand.Next(600) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(84, 86));
			}
			else if (type == 391 && Main.rand.Next(700) == 0)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, Main.rand.Next(86, 87));
			}
		}
	}

	public void UpdateAltTexture()
	{
		if (townNPC)
		{
			int oldAltTexture = altTexture;
			bool flag = BirthdayParty.PartyIsUp || ForcePartyHatOn;
			if (type == 441 || type == 453 || type == 633)
			{
				flag = false;
			}
			altTexture = 0;
			if (flag)
			{
				altTexture = 1;
			}
			if (type == 633 && ShouldBestiaryGirlBeLycantrope())
			{
				altTexture = 2;
			}
			if (!ForcePartyHatOn)
			{
				MakeTransitionEffectsForTextureChanges(oldAltTexture, altTexture);
			}
		}
	}

	private void MakeTransitionEffectsForTextureChanges(int oldAltTexture, int currentAltTexture)
	{
		if (oldAltTexture == 0 && currentAltTexture == 1)
		{
			for (int i = 0; i < 20; i++)
			{
				Dust.NewDust(position, width, height / 4, 139 + Main.rand.Next(4), 0f, -2f);
			}
		}
		if (oldAltTexture == 1 && currentAltTexture == 0)
		{
			Utils.PoofOfSmoke(position);
		}
		if (type != 633)
		{
			return;
		}
		int num = 2;
		if ((oldAltTexture == 0 && currentAltTexture == num) || (oldAltTexture == num && currentAltTexture == 0))
		{
			for (int j = 0; j < 20; j++)
			{
				Dust dust = Dust.NewDustDirect(position, width, height, 262, 0f, -2f);
				dust.noGravity = true;
				dust.scale = 2f;
			}
		}
	}

	public static void ResetNetOffsets()
	{
		offSetDelayTime = 180;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			Main.npc[i].netOffset *= 0f;
		}
	}

	public void UpdateNPC(int i)
	{
		whoAmI = i;
		if (!active)
		{
			return;
		}
		if (Main.netMode == 2 || offSetDelayTime > 0 || Main.multiplayerNPCSmoothingRange <= 0 || NPCID.Sets.NoMultiplayerSmoothingByType[type] || NPCID.Sets.NoMultiplayerSmoothingByAI[aiStyle] || (townNPC && ai[0] == 25f))
		{
			netOffset *= 0f;
		}
		else if (DebugOptions.FakeNetOffset != Vector2.Zero)
		{
			netOffset = DebugOptions.FakeNetOffset;
		}
		else if (netOffset != new Vector2(0f, 0f))
		{
			float num = 2f;
			float num2 = Main.multiplayerNPCSmoothingRange;
			float num3 = netOffset.Length();
			if (num3 > num2)
			{
				netOffset.Normalize();
				netOffset *= num2;
				num3 = netOffset.Length();
			}
			num += num3 / num2 * num;
			Vector2 vector = netOffset;
			vector.Normalize();
			vector *= num;
			netOffset -= vector;
			if (netOffset.Length() < num)
			{
				netOffset *= 0f;
			}
			if (townNPC && Vector2.Distance(position, new Vector2(homeTileX * 16 + 8 - width / 2, (float)(homeTileY * 16 - height) - 0.1f)) < 1f)
			{
				netOffset *= 0f;
			}
			if (netOffset != Vector2.Zero && DebugOptions.ShowNetOffsetDust)
			{
				Dust.QuickDust(position + netOffset, Color.Green).scale = 0.5f;
			}
		}
		UpdateAltTexture();
		if (type == 368)
		{
			travelNPC = true;
		}
		if (Main.netMode != 2)
		{
			UpdateNPC_CastLights();
		}
		UpdateNPC_TeleportVisuals();
		UpdateNPC_CritterSounds();
		if (lookForHomeTimeout > 0)
		{
			lookForHomeTimeout--;
		}
		TrySyncingUniqueTownNPCData(i);
		if (aiStyle == 7 && position.Y > Main.bottomWorld - 640f + (float)height && Main.netMode != 1)
		{
			StrikeNPCNoInteraction(9999, 0f, 0);
			if (Main.netMode == 2)
			{
				NetMessage.SendData(28, -1, -1, null, whoAmI, 9999f);
			}
		}
		if (Main.netMode == 1 && NPCID.Sets.SkipUpdateInUnsyncedTiles[type])
		{
			bool flag = false;
			int num4 = (int)(position.X + (float)(width / 2)) / 16;
			int num5 = (int)(position.Y + (float)(height / 2)) / 16;
			try
			{
				if (num4 >= 4 && num4 <= Main.maxTilesX - 4 && num5 >= 4 && num5 <= Main.maxTilesY - 4)
				{
					if (Main.tile[num4, num5] == null)
					{
						flag = true;
					}
					else if (Main.tile[num4 - 3, num5] == null)
					{
						flag = true;
					}
					else if (Main.tile[num4 + 3, num5] == null)
					{
						flag = true;
					}
					else if (Main.tile[num4, num5 - 3] == null)
					{
						flag = true;
					}
					else if (Main.tile[num4, num5 + 3] == null)
					{
						flag = true;
					}
				}
			}
			catch
			{
				flag = true;
			}
			if (flag)
			{
				return;
			}
		}
		UpdateNPC_BuffFlagsReset();
		UpdateNPC_BuffSetFlags();
		UpdateNPC_SoulDrainDebuff();
		UpdateNPC_BuffClearExpiredBuffs();
		UpdateNPC_BuffApplyDOTs();
		UpdateNPC_BuffApplyVFX();
		UpdateNPC_BloodMoonTransformations();
		UpdateNPC_UpdateGravity(out var maxFallSpeed);
		if (soundDelay > 0)
		{
			soundDelay--;
		}
		if (life <= 0)
		{
			active = false;
			UpdateNetworkCode(i);
			netUpdate = false;
			justHit = false;
			return;
		}
		oldTarget = target;
		oldDirection = direction;
		oldDirectionY = directionY;
		float num6 = 1f + Math.Abs(velocity.X) / 3f;
		if (gfxOffY > 0f)
		{
			gfxOffY -= num6 * stepSpeed;
			if (gfxOffY < 0f)
			{
				gfxOffY = 0f;
			}
		}
		else if (gfxOffY < 0f)
		{
			gfxOffY += num6 * stepSpeed;
			if (gfxOffY > 0f)
			{
				gfxOffY = 0f;
			}
		}
		if (gfxOffY > 16f)
		{
			gfxOffY = 16f;
		}
		if (gfxOffY < -16f)
		{
			gfxOffY = -16f;
		}
		TryPortalJumping();
		IdleSounds();
		AI();
		SubAI_HandleTemporaryCatchableNPCPlayerInvulnerability();
		if (Main.netMode != 2 && extraValue > 0)
		{
			int num7 = 244;
			float num8 = 30f;
			if (extraValue >= 1000000)
			{
				num7 = 247;
				num8 *= 0.25f;
			}
			else if (extraValue >= 10000)
			{
				num7 = 246;
				num8 *= 0.5f;
			}
			else if (extraValue >= 100)
			{
				num7 = 245;
				num8 *= 0.75f;
			}
			if (Main.rand.Next((int)num8) == 0)
			{
				position += netOffset;
				int num9 = Dust.NewDust(position, width, height, num7, 0f, 0f, 254, default(Color), 0.25f);
				Main.dust[num9].velocity *= 0.1f;
				position -= netOffset;
			}
		}
		for (int j = 0; j < 256; j++)
		{
			if (immune[j] > 0)
			{
				immune[j]--;
			}
		}
		if (!noGravity && !noTileCollide)
		{
			int num10 = (int)(position.X + (float)(width / 2)) / 16;
			int num11 = (int)(position.Y + (float)(height / 2)) / 16;
			if (WorldGen.InWorld(num10, num11) && Main.tile[num10, num11] == null)
			{
				gravity = 0f;
				velocity.X = 0f;
				velocity.Y = 0f;
			}
		}
		if (!noGravity)
		{
			velocity.Y += gravity;
			if (velocity.Y > maxFallSpeed)
			{
				velocity.Y = maxFallSpeed;
			}
		}
		if ((double)velocity.X < 0.005 && (double)velocity.X > -0.005)
		{
			velocity.X = 0f;
		}
		if (Main.netMode != 1 && type != 37 && (friendly || NPCID.Sets.TakesDamageFromHostilesWithoutBeingFriendly[type]))
		{
			if (townNPC)
			{
				CheckDrowning();
			}
			CheckLifeRegen();
			GetHurtByOtherNPCs(NPCID.Sets.AllNPCs);
		}
		if (Main.netMode != 1 && (npcsFoundForCheckActive[210] || npcsFoundForCheckActive[211]) && NPCID.Sets.CanBeHurtByBees[type] && (type != 1 || (ai[1] != 1124f && ai[1] != 1125f)))
		{
			GetHurtByOtherNPCs(NPCID.Sets.HurtingBees);
		}
		if (!noTileCollide)
		{
			UpdateCollision();
		}
		else
		{
			oldPosition = position;
			oldDirection = direction;
			position += velocity;
			if (Collision.WetCollision(position, width, height))
			{
				TryRemovingWaterPerishableEffects(isInLava: false);
			}
		}
		if (Main.netMode != 1 && !noTileCollide && lifeMax > 1 && Collision.SwitchTiles(this, position, width, height, oldPosition, 2) && (type == 46 || type == 148 || type == 149 || type == 303 || type == 361 || type == 362 || type == 364 || type == 366 || type == 367 || (type >= 442 && type <= 448) || type == 602 || type == 608 || type == 614 || type == 687))
		{
			ai[0] = 1f;
			ai[1] = 400f;
			ai[2] = 0f;
		}
		CheckDialogue();
		FindFrame();
		UpdateNPC_UpdateTrails();
		UpdateNetworkCode(i);
		CheckActive();
		netUpdate = false;
		justHit = false;
	}

	private void CheckDialogue()
	{
		if (Main.netMode != 2)
		{
			if ((Main.GameUpdateCount + whoAmI) % 10 == 0L)
			{
				ConditionalDialogue.TryGetPendingDialogue(this, out nextDialogue);
			}
			else if (nextDialogue != null && !nextDialogue.ConditionsMet(this))
			{
				nextDialogue = null;
			}
		}
	}

	private void SubAI_HandleTemporaryCatchableNPCPlayerInvulnerability()
	{
		if (type >= 0 && type < NPCID.Count && Main.npcCatchable[type])
		{
			if (releaseOwner != 255 || SpawnedFromStatue)
			{
				catchableNPCTempImmunityCounter = 0;
			}
			bool num = friendly;
			if (catchableNPCTempImmunityCounter > 0)
			{
				catchableNPCTempImmunityCounter--;
				friendly = true;
			}
			else
			{
				friendly = false;
			}
			if (num != friendly)
			{
				netUpdate = true;
			}
		}
	}

	private void TrySyncingUniqueTownNPCData(int npcIndex)
	{
		if (Main.netMode == 1 && needsUniqueInfoUpdate && isLikeATownNPC)
		{
			needsUniqueInfoUpdate = false;
			NetMessage.SendData(56, -1, -1, null, npcIndex);
		}
	}

	public void NetUpdateIgnoreSpamLimit()
	{
		int num = (boss ? netSpamTicksPerPacketForBosses : netSpamTicksPerPacket);
		if (!netUpdate || netSpam > num * netSpamPacketLimit)
		{
			netSpam -= num;
		}
		netUpdate = true;
	}

	public void NetUpdateLowPriority()
	{
		netUpdatePendingFullSpamCooldown = true;
	}

	private void UpdateNetworkCode(int i)
	{
		whoAmI = i;
		if (!active)
		{
			netUpdate = true;
		}
		if (Main.netMode != 2)
		{
			return;
		}
		if (townNPC)
		{
			netSpam = Math.Min(netSpam, netSpamTicksPerPacket);
		}
		if (!active)
		{
			netSpam = 0;
		}
		if (netUpdate || netUpdatePendingSpamCooldown || (netUpdatePendingFullSpamCooldown && netSpam == 0))
		{
			int num = (boss ? netSpamTicksPerPacketForBosses : netSpamTicksPerPacket);
			if (netSpam <= netSpamPacketLimit * num)
			{
				netSpam += num;
				NetMessage.SendData(23, -1, -1, null, whoAmI);
			}
			else
			{
				netUpdatePendingSpamCooldown = true;
			}
		}
		if (netSpam > 0)
		{
			netSpam--;
		}
		RecheckSectionsForSkippedUpdates();
		StreamUpdatesToNearbyPlayers();
		if (active && townNPC && TypeToDefaultHeadIndex(type) > 0)
		{
			if (homeless != oldHomeless || homeTileX != oldHomeTileX || homeTileY != oldHomeTileY)
			{
				byte householdStatus = WorldGen.TownManager.GetHouseholdStatus(this);
				NetMessage.SendData(60, -1, -1, null, whoAmI, homeTileX, homeTileY, (int)householdStatus);
			}
			oldHomeless = homeless;
			oldHomeTileX = homeTileX;
			oldHomeTileY = homeTileY;
		}
	}

	private void StreamUpdatesToNearbyPlayers()
	{
		if (Main.npcStreamSpeed <= 0 || townNPC || !NPCID.Sets.UsesMultiplayerProximitySyncing[type] || (double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) <= 0.5)
		{
			return;
		}
		netStream++;
		if (netStream < Main.npcStreamSpeed)
		{
			return;
		}
		netStream = 0;
		for (int i = 0; i < 255; i++)
		{
			if (Main.player[i].active)
			{
				float num = base.Center.Distance(Main.player[i].ReportedCameraPosition);
				int num2 = (boss ? 8 : ((num < 250f) ? 8 : ((num < 500f) ? 4 : ((num < 1000f) ? 2 : ((num < 1500f) ? 1 : 0)))));
				playerNetSyncState[i].streamCounter += (byte)num2;
				if (playerNetSyncState[i].streamCounter >= 8)
				{
					NetMessage.SendData(23, i, -1, null, whoAmI);
				}
			}
		}
	}

	private void RecheckSectionsForSkippedUpdates()
	{
		PlayerNetSyncState[] array = playerNetSyncState;
		for (int i = 0; i < array.Length; i++)
		{
			if (array[i].skippedSyncs > 0 && Main.player[i].active && Netplay.Clients[i].IsSectionActive(NetSectionCoordinates))
			{
				NetMessage.SendData(23, i, -1, null, whoAmI);
			}
		}
	}

	public IEntitySource GetItemSource_Misc(int itemSourceId)
	{
		return new EntitySource_ByItemSourceId(this, itemSourceId);
	}

	public static IEntitySource GetSpawnSource_NPCRelease(int whoReleasedIt)
	{
		return new EntitySource_Parent(Main.player[whoReleasedIt]);
	}

	public static IEntitySource GetSpawnSource_NPCCatch(int whoCatchedIt)
	{
		return new EntitySource_Parent(Main.player[whoCatchedIt]);
	}

	public IEntitySource GetSpawnSource_NPCHurt()
	{
		return new EntitySource_Parent(this);
	}

	public IEntitySource GetSpawnSource_ForProjectile()
	{
		return new EntitySource_Parent(this);
	}

	public IEntitySource GetSpawnSourceForProjectileNPC()
	{
		return new EntitySource_Parent(this);
	}

	public static IEntitySource GetSpawnSourceForNaturalSpawn()
	{
		return new EntitySource_SpawnNPC();
	}

	public static IEntitySource GetSpawnSourceForTownSpawn()
	{
		return new EntitySource_SpawnNPC();
	}

	public IEntitySource GetSpawnSourceForNPCFromNPCAI()
	{
		return new EntitySource_Parent(this);
	}

	public IEntitySource GetItemSource_Loot()
	{
		return new EntitySource_Loot(this);
	}

	private void UpdateNPC_UpdateTrails()
	{
		int num = NPCID.Sets.TrailingMode[type];
		if (num == 0)
		{
			if (localAI[3] <= 0f)
			{
				localAI[3] = 2f;
				for (int num2 = oldPos.Length - 1; num2 > 0; num2--)
				{
					oldPos[num2] = oldPos[num2 - 1];
				}
				oldPos[0] = position + netOffset;
			}
			localAI[3] -= 1f;
		}
		if (num == 1)
		{
			for (int num3 = oldPos.Length - 1; num3 > 0; num3--)
			{
				oldPos[num3] = oldPos[num3 - 1];
			}
			oldPos[0] = position + netOffset;
		}
		if (num == 2)
		{
			if ((int)ai[0] == 4 || ai[0] == 5f || ai[0] == 6f)
			{
				for (int num4 = oldPos.Length - 1; num4 > 0; num4--)
				{
					oldPos[num4] = oldPos[num4 - 1];
					oldRot[num4] = oldRot[num4 - 1];
				}
				oldPos[0] = position + netOffset;
				oldRot[0] = rotation;
			}
			else
			{
				for (int num5 = oldPos.Length - 1; num5 >= 0; num5--)
				{
					oldPos[num5] = position + netOffset;
					oldRot[num5] = rotation;
				}
			}
		}
		if (num == 3)
		{
			for (int num6 = oldPos.Length - 1; num6 > 0; num6--)
			{
				oldPos[num6] = oldPos[num6 - 1];
				oldRot[num6] = oldRot[num6 - 1];
			}
			oldPos[0] = position + netOffset;
			oldRot[0] = rotation;
		}
		switch (num)
		{
		case 4:
		{
			for (int num9 = oldPos.Length - 1; num9 > 0; num9--)
			{
				oldPos[num9] = oldPos[num9 - 1];
				Lighting.AddLight((int)position.X / 16, (int)position.Y / 16, 0.3f, 0f, 0.2f);
			}
			oldPos[0] = position + netOffset;
			break;
		}
		case 5:
		{
			for (int num8 = oldPos.Length - 1; num8 > 0; num8--)
			{
				oldPos[num8] = oldPos[num8 - 1];
			}
			oldPos[0] = position + netOffset;
			break;
		}
		case 6:
		{
			for (int num10 = oldPos.Length - 1; num10 > 0; num10--)
			{
				oldPos[num10] = oldPos[num10 - 1];
			}
			oldPos[0] = position + netOffset;
			break;
		}
		case 7:
		{
			for (int num7 = oldPos.Length - 1; num7 > 0; num7--)
			{
				oldPos[num7] = oldPos[num7 - 1];
				oldRot[num7] = oldRot[num7 - 1];
			}
			oldPos[0] = position + netOffset;
			oldRot[0] = rotation;
			break;
		}
		}
	}

	private void UpdateNPC_UpdateGravity(out float maxFallSpeed)
	{
		maxFallSpeed = 10f;
		gravity = 0.3f;
		if (type == 258)
		{
			gravity = 0.1f;
			if (velocity.Y > 3f)
			{
				velocity.Y = 3f;
			}
		}
		else if (type == 425 && ai[2] == 1f)
		{
			gravity = 0.1f;
		}
		else if ((type == 576 || type == 577) && ai[0] > 0f && ai[1] == 2f)
		{
			gravity = 0.45f;
			if (velocity.Y > 32f)
			{
				velocity.Y = 32f;
			}
		}
		else if (type == 427 && ai[2] == 1f)
		{
			gravity = 0.1f;
			if (velocity.Y > 4f)
			{
				velocity.Y = 4f;
			}
		}
		else if (type == 426)
		{
			gravity = 0.1f;
			if (velocity.Y > 3f)
			{
				velocity.Y = 3f;
			}
		}
		else if (type == 541)
		{
			gravity = 0f;
		}
		else if (aiStyle == 7 && ai[0] == 25f)
		{
			gravity = 0f;
		}
		float num = (float)Main.maxTilesX / 4200f;
		num *= num;
		float num2 = (float)((double)(position.Y / 16f - (60f + 10f * num)) / (Main.worldSurface / 6.0));
		if ((double)num2 < 0.25)
		{
			num2 = 0.25f;
		}
		if (num2 > 1f)
		{
			num2 = 1f;
		}
		gravity *= num2;
		if (wet)
		{
			if (shimmerWet)
			{
				gravity = 0.15f;
				maxFallSpeed = 5.5f;
			}
			else if (honeyWet)
			{
				gravity = 0.1f;
				maxFallSpeed = 4f;
			}
			else
			{
				gravity = 0.2f;
				maxFallSpeed = 7f;
			}
		}
	}

	private void UpdateNPC_SoulDrainDebuff()
	{
		if (!soulDrain)
		{
			return;
		}
		int num = 1100;
		for (int i = 0; i < 255; i++)
		{
			if (Main.player[i].active && !Main.player[i].dead && (base.Center - Main.player[i].position).Length() < (float)num && Main.player[i].inventory[Main.player[i].selectedItem].type == 3006 && Main.player[i].itemAnimation > 0)
			{
				if (i == Main.myPlayer)
				{
					Main.player[i].soulDrain++;
				}
				if (Main.rand.Next(3) != 0)
				{
					Vector2 center = base.Center;
					center.X += (float)Main.rand.Next(-100, 100) * 0.05f;
					center.Y += (float)Main.rand.Next(-100, 100) * 0.05f;
					center += velocity;
					int num2 = Dust.NewDust(center, 1, 1, 235);
					Main.dust[num2].velocity *= 0f;
					Main.dust[num2].scale = (float)Main.rand.Next(70, 85) * 0.01f;
					Main.dust[num2].fadeIn = i + 1;
				}
			}
		}
	}

	public static Color buffColor(Color newColor, float R, float G, float B, float A)
	{
		newColor.R = (byte)((float)(int)newColor.R * R);
		newColor.G = (byte)((float)(int)newColor.G * G);
		newColor.B = (byte)((float)(int)newColor.B * B);
		newColor.A = (byte)((float)(int)newColor.A * A);
		return newColor;
	}

	public bool CurrentlyShimmerTransparent()
	{
		if (shimmerTransparency > 0f)
		{
			if (CanApplyHunterPotionEffects())
			{
				return AppearsFriendlyToHunterPotion();
			}
			return true;
		}
		return false;
	}

	public bool AppearsFriendlyToHunterPotion()
	{
		bool result = friendly || catchItem > 0 || (damage == 0 && lifeMax == 5);
		bool? flag = NPCID.Sets.HunterPotionFriendlyOverride[type];
		if (flag.HasValue)
		{
			result = flag.Value;
		}
		return result;
	}

	public bool CanApplyHunterPotionEffects()
	{
		return Main.SceneMetrics.PerspectivePlayer.detectCreature;
	}

	public Color GetNPCColorTintedByBuffs(Color npcColor)
	{
		if (!canDisplayBuffs)
		{
			return npcColor;
		}
		float num = 1f;
		float num2 = 1f;
		float num3 = 1f;
		float a = 1f;
		if (brokenArmor)
		{
			num *= 0.75f;
			num2 *= 0.75f;
			num3 *= 0.75f;
			npcColor = buffColor(npcColor, num, num2, num3, a);
		}
		if (poisoned)
		{
			num *= 0.65f;
			num3 *= 0.75f;
			npcColor = buffColor(npcColor, num, num2, num3, a);
		}
		if (venom)
		{
			num2 *= 0.45f;
			num *= 0.75f;
			npcColor = buffColor(npcColor, num, num2, num3, a);
		}
		if (bleeding || hemorrhage)
		{
			num2 *= 0.85f;
			num3 *= 0.85f;
			npcColor = buffColor(npcColor, num, num2, num3, a);
		}
		if (midas)
		{
			num3 *= 0.3f;
			num *= 0.85f;
			npcColor = buffColor(npcColor, num, num2, num3, a);
		}
		if (betsysCurse)
		{
			num *= 0.8f;
			num2 *= 0.6f;
			npcColor = buffColor(npcColor, num, num2, num3, a);
		}
		if (oiled)
		{
			num *= 0.4f;
			num2 *= 0.4f;
			num3 *= 0.4f;
			npcColor = buffColor(npcColor, num, num2, num3, a);
		}
		if (stinky)
		{
			num *= 0.7f;
			num3 *= 0.55f;
			npcColor = buffColor(npcColor, num, num2, num3, a);
		}
		if (drippingSlime)
		{
			num *= 0.8f;
			num2 *= 0.8f;
			npcColor = buffColor(npcColor, num, num2, num3, a);
		}
		if (drippingSparkleSlime)
		{
			num3 *= 0.85f;
			num2 *= 0.75f;
			npcColor = buffColor(npcColor, num, num2, num3, a);
		}
		if (ichor)
		{
			npcColor = new Color(255, 255, 0, 255);
		}
		if (CanApplyHunterPotionEffects() && lifeMax > 1)
		{
			byte b;
			byte b2;
			byte b3;
			if (AppearsFriendlyToHunterPotion())
			{
				b = 50;
				b2 = byte.MaxValue;
				b3 = 50;
			}
			else
			{
				b = byte.MaxValue;
				b2 = 50;
				b3 = 50;
			}
			if (npcColor.R < b)
			{
				npcColor.R = b;
			}
			if (npcColor.G < b2)
			{
				npcColor.G = b2;
			}
			if (npcColor.B < b3)
			{
				npcColor.B = b3;
			}
		}
		return npcColor;
	}

	private void UpdateNPC_BuffApplyVFX()
	{
		if (!canDisplayBuffs)
		{
			return;
		}
		position += netOffset;
		if (markedByEelWhip && Main.rand.Next(3) == 0)
		{
			ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.BlueLightningSmall, new ParticleOrchestraSettings
			{
				MovementVector = Main.rand.NextVector2Circular(1f, 1f),
				PositionInWorld = Main.rand.NextVector2FromRectangle(base.Hitbox)
			});
		}
		if (markedByScytheWhip && Main.rand.Next(3) == 0)
		{
			ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.BlackLightningSmall, new ParticleOrchestraSettings
			{
				MovementVector = Main.rand.NextVector2Circular(1f, 1f),
				PositionInWorld = Main.rand.NextVector2FromRectangle(base.Hitbox)
			});
		}
		if (poisoned && Main.rand.Next(30) == 0)
		{
			Dust dust = Dust.NewDustDirect(position, width, height, 46, 0f, 0f, 120, default(Color), 0.2f);
			dust.noGravity = true;
			dust.fadeIn = 1.9f;
		}
		if (venom && Main.rand.Next(10) == 0)
		{
			Dust dust2 = Dust.NewDustDirect(position, width, height, 171, 0f, 0f, 100, default(Color), 0.5f);
			dust2.noGravity = true;
			dust2.fadeIn = 1.5f;
		}
		if ((bleeding || hemorrhage) && Main.rand.Next(2) == 0)
		{
			Dust dust3 = Dust.NewDustDirect(position, width, height, 5);
			dust3.velocity.Y += 0.5f;
			dust3.velocity *= 0.35f;
		}
		if (shadowFlame && Main.rand.Next(5) < 4)
		{
			Dust dust4 = Dust.NewDustDirect(new Vector2(position.X - 2f, position.Y - 2f), width + 4, height + 4, 27, velocity.X * 0.4f, velocity.Y * 0.4f, 180, default(Color), 1.95f);
			dust4.noGravity = true;
			dust4.velocity *= 0.75f;
			dust4.velocity.X *= 0.75f;
			dust4.velocity.Y -= 1f;
			if (Main.rand.Next(4) == 0)
			{
				dust4.noGravity = false;
				dust4.scale *= 0.5f;
			}
		}
		if (onFire)
		{
			if (Main.rand.Next(4) < 3)
			{
				Dust dust5 = Dust.NewDustDirect(new Vector2(position.X - 2f, position.Y - 2f), width + 4, height + 4, 6, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 3.5f);
				dust5.noGravity = true;
				dust5.velocity *= 1.8f;
				dust5.velocity.Y -= 0.5f;
				if (Main.rand.Next(4) == 0)
				{
					dust5.noGravity = false;
					dust5.scale *= 0.5f;
				}
			}
			Lighting.AddLight((int)(position.X / 16f), (int)(position.Y / 16f + 1f), 1f, 0.3f, 0.1f);
		}
		if (onFire3)
		{
			if (Main.rand.Next(4) < 3)
			{
				Dust dust6 = Dust.NewDustDirect(new Vector2(position.X - 2f, position.Y - 2f), width + 4, height + 4, 6, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 3.5f);
				dust6.noGravity = true;
				dust6.velocity *= 1.8f;
				dust6.velocity.Y -= 0.5f;
				if (Main.rand.Next(4) == 0)
				{
					dust6.noGravity = false;
					dust6.scale *= 0.5f;
				}
				dust6.customData = 0;
			}
			Lighting.AddLight((int)(position.X / 16f), (int)(position.Y / 16f + 1f), 1f, 0.3f, 0.1f);
		}
		if (daybreak)
		{
			if (Main.rand.Next(4) < 3)
			{
				Dust dust7 = Dust.NewDustDirect(new Vector2(position.X - 2f, position.Y - 2f), width + 4, height + 4, 158, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 3.5f);
				dust7.noGravity = true;
				dust7.velocity *= 2.8f;
				dust7.velocity.Y -= 0.5f;
				if (Main.rand.Next(4) == 0)
				{
					dust7.noGravity = false;
					dust7.scale *= 0.5f;
				}
			}
			Lighting.AddLight((int)(position.X / 16f), (int)(position.Y / 16f + 1f), 1f, 0.3f, 0.1f);
		}
		if (betsysCurse)
		{
			if (Main.rand.Next(4) < 3)
			{
				Dust dust8 = Dust.NewDustDirect(new Vector2(position.X - 2f, position.Y - 2f), width + 4, height + 4, 55, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 3.5f);
				dust8.noGravity = true;
				dust8.velocity *= 2.8f;
				dust8.velocity.Y -= 1.5f;
				dust8.noGravity = false;
				dust8.scale = 0.9f;
				dust8.color = new Color(0, 0, 180, 255);
				dust8.velocity *= 0.2f;
			}
			Lighting.AddLight((int)(position.X / 16f), (int)(position.Y / 16f + 1f), 0.6f, 0.1f, 0.9f);
		}
		if (oiled && Main.rand.Next(3) != 0)
		{
			int num = 175;
			Color newColor = new Color(0, 0, 0, 250);
			Vector2 vector = position;
			vector.X -= 2f;
			vector.Y -= 2f;
			if (Main.rand.Next(2) == 0)
			{
				Dust dust9 = Dust.NewDustDirect(vector, width + 4, height + 2, 4, 0f, 0f, num, newColor, 1.4f);
				if (Main.rand.Next(2) == 0)
				{
					dust9.alpha += 25;
				}
				if (Main.rand.Next(2) == 0)
				{
					dust9.alpha += 25;
				}
				dust9.noLight = true;
				dust9.velocity *= 0.2f;
				dust9.velocity.Y += 0.2f;
				dust9.velocity += velocity;
			}
		}
		if (dryadWard && velocity.X != 0f && Main.rand.Next(4) == 0)
		{
			Dust dust10 = Dust.NewDustDirect(new Vector2(position.X - 2f, position.Y + (float)height - 2f), width + 4, 4, 163, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 1.5f);
			dust10.noGravity = true;
			dust10.noLight = true;
			dust10.velocity *= 0f;
		}
		if (dryadBane && Main.rand.Next(4) == 0)
		{
			Dust dust11 = Dust.NewDustDirect(new Vector2(position.X - 2f, position.Y), width + 4, height, 163, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 1.5f);
			dust11.noGravity = true;
			dust11.velocity *= new Vector2(Main.rand.NextFloat() * 4f - 2f, 0f);
			dust11.noLight = true;
		}
		if (loveStruck && Main.rand.Next(5) == 0)
		{
			Vector2 vector2 = new Vector2(Main.rand.Next(-10, 11), Main.rand.Next(-10, 11));
			vector2.Normalize();
			vector2.X *= 0.66f;
			int num2 = Gore.NewGore(position + new Vector2(Main.rand.Next(width + 1), Main.rand.Next(height + 1)), vector2 * Main.rand.Next(3, 6) * 0.33f, 331, (float)Main.rand.Next(40, 121) * 0.01f);
			Main.gore[num2].sticky = false;
			Main.gore[num2].velocity *= 0.4f;
			Main.gore[num2].velocity.Y -= 0.6f;
		}
		if (stinky && Main.rand.Next(5) == 0)
		{
			Vector2 vector3 = new Vector2(Main.rand.Next(-10, 11), Main.rand.Next(-10, 11));
			vector3.Normalize();
			vector3.X *= 0.66f;
			vector3.Y = Math.Abs(vector3.Y);
			Vector2 vector4 = vector3 * Main.rand.Next(3, 5) * 0.25f;
			Dust dust12 = Dust.NewDustDirect(position, width, height, 188, vector4.X, vector4.Y * 0.5f, 100, default(Color), 1.5f);
			dust12.velocity *= 0.1f;
			dust12.velocity.Y -= 0.5f;
		}
		if (dripping && Main.rand.Next(4) != 0)
		{
			Vector2 vector5 = position;
			vector5.X -= 2f;
			vector5.Y -= 2f;
			if (Main.rand.Next(2) == 0)
			{
				Dust dust13 = Dust.NewDustDirect(vector5, width + 4, height + 2, 211, 0f, 0f, 50, default(Color), 0.8f);
				if (Main.rand.Next(2) == 0)
				{
					dust13.alpha += 25;
				}
				if (Main.rand.Next(2) == 0)
				{
					dust13.alpha += 25;
				}
				dust13.noLight = true;
				dust13.velocity *= 0.2f;
				dust13.velocity.Y += 0.2f;
				dust13.velocity += velocity;
			}
			else
			{
				Dust dust14 = Dust.NewDustDirect(vector5, width + 8, height + 8, 211, 0f, 0f, 50, default(Color), 1.1f);
				if (Main.rand.Next(2) == 0)
				{
					dust14.alpha += 25;
				}
				if (Main.rand.Next(2) == 0)
				{
					dust14.alpha += 25;
				}
				dust14.noLight = true;
				dust14.noGravity = true;
				dust14.velocity *= 0.2f;
				dust14.velocity.Y += 1f;
				dust14.velocity += velocity;
			}
		}
		if (tipsy && Main.rand.Next(4) == 0)
		{
			Color newColor2 = new Color(245, 200, 30, 155);
			int num3 = 75;
			Vector2 vector6 = position;
			vector6.X -= 2f;
			vector6.Y -= 2f;
			if (Main.rand.Next(2) == 0)
			{
				Dust dust15 = Dust.NewDustDirect(vector6, width + 4, height + 2, 4, 0f, 0f, num3, newColor2, 0.9f);
				if (Main.rand.Next(2) == 0)
				{
					dust15.alpha += 25;
				}
				if (Main.rand.Next(2) == 0)
				{
					dust15.alpha += 25;
				}
				dust15.noLight = true;
				dust15.velocity *= 0.2f;
				dust15.velocity.Y += 0.2f;
				dust15.velocity += velocity;
			}
		}
		if (drippingSlime && Main.rand.Next(4) != 0)
		{
			int num4 = 175;
			Color newColor3 = new Color(0, 80, 255, 100);
			Vector2 vector7 = position;
			vector7.X -= 2f;
			vector7.Y -= 2f;
			if (Main.rand.Next(2) == 0)
			{
				Dust dust16 = Dust.NewDustDirect(vector7, width + 4, height + 2, 4, 0f, 0f, num4, newColor3, 1.4f);
				if (Main.rand.Next(2) == 0)
				{
					dust16.alpha += 25;
				}
				if (Main.rand.Next(2) == 0)
				{
					dust16.alpha += 25;
				}
				dust16.noLight = true;
				dust16.velocity *= 0.2f;
				dust16.velocity.Y += 0.2f;
				dust16.velocity += velocity;
			}
		}
		if (drippingSparkleSlime && Main.rand.Next(4) != 0)
		{
			int num5 = 150;
			Vector2 vector8 = position;
			vector8.X -= 2f;
			vector8.Y -= 2f;
			if (Main.rand.Next(2) == 0)
			{
				Dust dust17 = Dust.NewDustDirect(vector8, width + 4, height + 2, 243, 0f, 0f, num5);
				if (Main.rand.Next(2) == 0)
				{
					dust17.alpha += 25;
				}
				if (Main.rand.Next(2) == 0)
				{
					dust17.alpha += 25;
				}
				dust17.noLight = true;
				dust17.velocity *= 0.2f;
				dust17.velocity.Y += 0.2f;
				dust17.velocity += velocity;
			}
		}
		if (onFrostBurn)
		{
			if (Main.rand.Next(4) < 3)
			{
				Dust dust18 = Dust.NewDustDirect(new Vector2(position.X - 2f, position.Y - 2f), width + 4, height + 4, 135, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 3.5f);
				dust18.noGravity = true;
				dust18.velocity *= 1.8f;
				dust18.velocity.Y -= 0.5f;
				if (Main.rand.Next(4) == 0)
				{
					dust18.noGravity = false;
					dust18.scale *= 0.5f;
				}
			}
			Lighting.AddLight((int)(position.X / 16f), (int)(position.Y / 16f + 1f), 0.1f, 0.6f, 1f);
		}
		if (onFrostBurn2)
		{
			if (Main.rand.Next(4) < 3)
			{
				Dust dust19 = Dust.NewDustDirect(new Vector2(position.X - 2f, position.Y - 2f), width + 4, height + 4, 135, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 3.5f);
				dust19.noGravity = true;
				dust19.velocity *= 1.8f;
				dust19.velocity.Y -= 0.5f;
				if (Main.rand.Next(4) == 0)
				{
					dust19.noGravity = false;
					dust19.scale *= 0.5f;
				}
			}
			Lighting.AddLight((int)(position.X / 16f), (int)(position.Y / 16f + 1f), 0.1f, 0.6f, 1f);
		}
		if (onFire2)
		{
			if (Main.rand.Next(4) < 3)
			{
				Dust dust20 = Dust.NewDustDirect(new Vector2(position.X - 2f, position.Y - 2f), width + 4, height + 4, 75, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 3.5f);
				dust20.noGravity = true;
				dust20.velocity *= 1.8f;
				dust20.velocity.Y -= 0.5f;
				if (Main.rand.Next(4) == 0)
				{
					dust20.noGravity = false;
					dust20.scale *= 0.5f;
				}
			}
			Lighting.AddLight((int)(position.X / 16f), (int)(position.Y / 16f + 1f), 1f, 0.3f, 0.1f);
		}
		if (shimmering)
		{
			shimmerTransparency += 0.01f;
			if (Main.netMode != 1 && (double)shimmerTransparency > 0.9)
			{
				GetShimmered();
			}
			if (shimmerTransparency > 1f)
			{
				shimmerTransparency = 1f;
			}
		}
		else if (shimmerTransparency > 0f)
		{
			if (justHit)
			{
				shimmerTransparency -= 0.1f;
			}
			if (buffImmune[353])
			{
				shimmerTransparency -= 0.015f;
			}
			else
			{
				shimmerTransparency -= 0.001f;
			}
			if (shimmerTransparency < 0f)
			{
				shimmerTransparency = 0f;
			}
		}
		position -= netOffset;
	}

	private void GetShimmered()
	{
		if (SpawnedFromStatue)
		{
			if (Main.netMode == 0)
			{
				WorldItem.ShimmerEffect(base.Center);
			}
			else
			{
				NetMessage.SendData(146, -1, -1, null, 0, (int)base.Center.X, (int)base.Center.Y);
			}
			noSpawnCycle = true;
			active = false;
			if (Main.netMode == 2)
			{
				life = 0;
				NetMessage.SendData(23, -1, -1, null, whoAmI);
			}
		}
		else if (NPCID.Sets.ShimmerTransformToNPC[type] >= 0)
		{
			Transform(NPCID.Sets.ShimmerTransformToNPC[type]);
			if (Main.netMode == 0)
			{
				WorldItem.ShimmerEffect(base.Center);
			}
			else
			{
				NetMessage.SendData(146, -1, -1, null, 0, (int)base.Center.X, (int)base.Center.Y);
			}
		}
		else if (NPCID.Sets.ShimmerTransformToItem[type] >= 0)
		{
			int num = Item.NewItem(GetItemSource_Misc(ItemSourceID.Shimmer), (int)position.X, (int)position.Y, width, height, NPCID.Sets.ShimmerTransformToItem[type]);
			Main.item[num].stack = 1;
			Main.item[num].shimmerTime = 1f;
			Main.item[num].shimmered = true;
			Main.item[num].shimmerWet = true;
			Main.item[num].wet = true;
			Main.item[num].velocity *= 0.1f;
			Main.item[num].playerIndexTheItemIsReservedFor = Main.myPlayer;
			NetMessage.SendData(145, -1, -1, null, num, 1f);
			if (Main.netMode == 0)
			{
				WorldItem.ShimmerEffect(base.Center);
			}
			else
			{
				NetMessage.SendData(146, -1, -1, null, 0, (int)base.Center.X, (int)base.Center.Y);
			}
			noSpawnCycle = true;
			active = false;
			if (Main.netMode == 2)
			{
				life = 0;
				NetMessage.SendData(23, -1, -1, null, whoAmI);
			}
		}
		else if (NPCID.Sets.ShimmerTownTransform[type])
		{
			ai[0] = 25f;
			ai[1] = 0f;
			ai[2] = 0f;
			ai[3] = 0f;
			netUpdate = true;
			shimmerTransparency = 0.89f;
			int num2 = FindBuffIndex(353);
			if (num2 != -1)
			{
				DelBuff(num2);
			}
		}
	}

	private void UpdateNPC_BuffApplyDOTs()
	{
		if (dontTakeDamage)
		{
			return;
		}
		int num = lifeRegenExpectedLossPerSecond;
		if (poisoned)
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			lifeRegen -= 12;
		}
		if (bleeding)
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			lifeRegen -= 24;
			if (num < 4)
			{
				num = 4;
			}
		}
		if (hemorrhage)
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			lifeRegen -= 200;
			if (num < 40)
			{
				num = 40;
			}
		}
		if (onFire && (type != 1 || ai[1] != 8f || !Main.getGoodWorld))
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			lifeRegen -= 8;
			if (drippingSlime)
			{
				lifeRegen -= 8;
			}
			if (type == 1 && ai[1] == 9f)
			{
				lifeRegen -= 16;
			}
		}
		if (onFire3)
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			lifeRegen -= 30;
			if (drippingSlime)
			{
				lifeRegen -= 30;
			}
			if (num < 5)
			{
				num = 5;
			}
		}
		if (onFrostBurn)
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			lifeRegen -= 16;
			if (drippingSlime)
			{
				lifeRegen -= 16;
			}
			if (num < 2)
			{
				num = 2;
			}
			if (type == 1 && ai[1] == 9f)
			{
				lifeRegen -= 16;
			}
		}
		if (onFrostBurn2)
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			lifeRegen -= 50;
			if (drippingSlime)
			{
				lifeRegen -= 50;
			}
			if (num < 10)
			{
				num = 10;
			}
		}
		if (onFire2)
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			lifeRegen -= 48;
			if (drippingSlime)
			{
				lifeRegen -= 48;
			}
			if (num < 10)
			{
				num = 10;
			}
		}
		if (venom)
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			lifeRegen -= 60;
			if (num < 15)
			{
				num = 15;
			}
		}
		if (shadowFlame)
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			lifeRegen -= 30;
			if (drippingSlime)
			{
				lifeRegen -= 30;
			}
			if (num < 5)
			{
				num = 5;
			}
		}
		if (oiled && (onFire || onFire2 || onFire3 || onFrostBurn || onFrostBurn2 || shadowFlame))
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			lifeRegen -= 50;
			if (num < 10)
			{
				num = 10;
			}
		}
		if (javelined)
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			int num2 = 0;
			int num3 = 1;
			for (int i = 0; i < 1000; i++)
			{
				if (Main.projectile[i].active && Main.projectile[i].type == 598 && Main.projectile[i].ai[0] == 1f && Main.projectile[i].ai[1] == (float)whoAmI)
				{
					num2++;
				}
			}
			lifeRegen -= num2 * 2 * 3;
			if (num < num2 * 3 / num3)
			{
				num = num2 * 3 / num3;
			}
		}
		if (tentacleSpiked)
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			int num4 = 0;
			int num5 = 1;
			for (int j = 0; j < 1000; j++)
			{
				if (Main.projectile[j].active && Main.projectile[j].type == 971 && Main.projectile[j].ai[0] == 1f && Main.projectile[j].ai[1] == (float)whoAmI)
				{
					num4++;
				}
			}
			lifeRegen -= num4 * 2 * 3;
			if (num < num4 * 3 / num5)
			{
				num = num4 * 3 / num5;
			}
		}
		if (markedByEelWhip)
		{
			ApplyEelWhipDoT();
		}
		if (bloodButchered)
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			int num6 = 0;
			int num7 = 1;
			for (int k = 0; k < 1000; k++)
			{
				if (Main.projectile[k].active && Main.projectile[k].type == 975 && Main.projectile[k].ai[0] == 1f && Main.projectile[k].ai[1] == (float)whoAmI)
				{
					num6++;
				}
			}
			lifeRegen -= num6 * 2 * 4;
			if (num < num6 * 4 / num7)
			{
				num = num6 * 4 / num7;
			}
		}
		if (daybreak)
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			int num8 = 0;
			int num9 = 4;
			for (int l = 0; l < 1000; l++)
			{
				if (Main.projectile[l].active && Main.projectile[l].type == 636 && Main.projectile[l].ai[0] == 1f && Main.projectile[l].ai[1] == (float)whoAmI)
				{
					num8++;
				}
			}
			if (num8 == 0)
			{
				num8 = 1;
			}
			lifeRegen -= num8 * 2 * 100;
			if (num < num8 * 100 / num9)
			{
				num = num8 * 100 / num9;
			}
		}
		if (celled)
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			int num10 = 0;
			for (int m = 0; m < 1000; m++)
			{
				if (Main.projectile[m].active && Main.projectile[m].type == 614 && Main.projectile[m].ai[0] == 1f && Main.projectile[m].ai[1] == (float)whoAmI)
				{
					num10++;
				}
			}
			lifeRegen -= num10 * 2 * 20;
			if (num < num10 * 20)
			{
				num = num10 * 20 / 2;
			}
		}
		if (dryadBane)
		{
			int num11 = 4;
			float num12 = 1f;
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			if (downedBoss1)
			{
				num12 += 0.1f;
			}
			if (downedBoss2)
			{
				num12 += 0.1f;
			}
			if (downedBoss3)
			{
				num12 += 0.1f;
			}
			if (downedQueenBee)
			{
				num12 += 0.1f;
			}
			if (Main.hardMode)
			{
				num12 += 0.4f;
			}
			if (downedQueenSlime)
			{
				num12 += 0.15f;
			}
			if (downedMechBoss1)
			{
				num12 += 0.15f;
			}
			if (downedMechBoss2)
			{
				num12 += 0.15f;
			}
			if (downedMechBoss3)
			{
				num12 += 0.15f;
			}
			if (downedPlantBoss)
			{
				num12 += 0.15f;
			}
			if (downedGolemBoss)
			{
				num12 += 0.15f;
			}
			if (downedAncientCultist)
			{
				num12 += 0.15f;
			}
			if (downedEmpressOfLight)
			{
				num12 += 0.15f;
			}
			if (downedFishron)
			{
				num12 += 0.15f;
			}
			if (Main.infectedSeed)
			{
				num11 *= 2;
			}
			num11 = GetAttackDamage_ForTownNPC((float)num11 * num12);
			lifeRegen -= 2 * num11;
			if (num < num11)
			{
				num = num11 / 3;
			}
		}
		if (soulDrain && realLife == -1)
		{
			if (lifeRegen > 0)
			{
				lifeRegen = 0;
			}
			lifeRegen -= 50;
			if (num < 5)
			{
				num = 5;
			}
		}
		if (type == 59 && ai[1] == 174f && lavaWet)
		{
			lifeRegen += 32;
		}
		if (type == 1)
		{
			if (ai[1] == 29f)
			{
				lifeRegen += 16;
			}
			else if (ai[1] == 364f || ai[1] == 1104f || ai[1] == 365f || ai[1] == 1105f || ai[1] == 366f || ai[1] == 1106f)
			{
				lifeRegen += 24;
			}
		}
		if (lifeRegen <= -240 && num < 2)
		{
			num = 2;
		}
		lifeRegenCount += lifeRegen;
		while (lifeRegenCount >= 120)
		{
			lifeRegenCount -= 120;
			if (!immortal)
			{
				if (life < lifeMax)
				{
					life++;
				}
				if (life > lifeMax)
				{
					life = lifeMax;
				}
			}
		}
		if (num > 0)
		{
			while (lifeRegenCount <= -120 * num)
			{
				lifeRegenCount += 120 * num;
				GetHurtByDebuff(num);
			}
		}
		else
		{
			while (lifeRegenCount <= -120)
			{
				lifeRegenCount += 120;
				GetHurtByDebuff(1);
			}
		}
	}

	private void ApplyEelWhipDoT()
	{
		float num = 60f;
		int num2 = 0;
		int num3 = 3;
		int num4 = 50;
		int num5 = 50;
		if ((float)(++electricEelCounter) < num)
		{
			return;
		}
		electricEelCounter = 0;
		int num6 = 0;
		for (int i = 0; i < 255; i++)
		{
			Player player = Main.player[i];
			if (player.active && player.TagEffectState.Type == 5478 && player.TagEffectState.IsNPCTagged(whoAmI))
			{
				num6++;
			}
		}
		if (num6 == 0)
		{
			return;
		}
		int num7 = 600;
		if (!immortal)
		{
			for (int j = 0; j < Main.maxNPCs; j++)
			{
				if (num2 >= num3)
				{
					break;
				}
				if (j != whoAmI)
				{
					NPC nPC = Main.npc[j];
					if (nPC.active && nPC.markedByEelWhip && !nPC.immortal && (realLife == -1 || realLife != nPC.realLife) && !(Distance(nPC.Hitbox.ClosestPointInRect(base.Center)) > (float)num7))
					{
						num2++;
						Vector2 vector = Main.rand.NextVector2FromRectangle(base.Hitbox);
						Vector2 vector2 = Main.rand.NextVector2FromRectangle(nPC.Hitbox);
						ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.BlueLightningSmallLong, new ParticleOrchestraSettings
						{
							PositionInWorld = vector,
							MovementVector = vector2 - vector
						});
					}
				}
			}
		}
		SoundEngine.PlaySound(HitSound, base.Center);
		if (Main.netMode != 1)
		{
			int num8 = (num4 + num2 * num5) * num6;
			GetHurtByDebuff(num8);
			if (Main.netMode == 2)
			{
				NetMessage.TrySendData(153, -1, -1, null, whoAmI, num8);
			}
		}
	}

	public void GetHurtByDebuff(int amount)
	{
		if (Main.netMode != 1)
		{
			NPCDamageTracker.AddDamage(this, 255, amount);
		}
		int num = whoAmI;
		if (realLife >= 0)
		{
			num = realLife;
		}
		if (!Main.npc[num].immortal)
		{
			Main.npc[num].life -= amount;
		}
		CombatText.NewText(new Rectangle((int)position.X, (int)position.Y, width, height), CombatText.LifeRegenNegative, amount, dramatic: false, dot: true);
		if (Main.npc[num].life > 0 || Main.npc[num].immortal)
		{
			return;
		}
		Main.npc[num].life = 1;
		if (Main.netMode != 1)
		{
			Main.npc[num].StrikeNPCNoInteraction(9999, 0f, 0);
			if (Main.netMode == 2)
			{
				NetMessage.SendData(28, -1, -1, null, num, 9999f);
			}
		}
	}

	private void UpdateNPC_BuffClearExpiredBuffs()
	{
		if (Main.netMode == 1)
		{
			return;
		}
		bool flag = false;
		for (int i = 0; i < maxBuffs; i++)
		{
			if (buffType[i] > 0 && buffTime[i] <= 0)
			{
				DelBuff(i, quiet: true);
				flag = true;
			}
		}
		if (flag && Main.netMode == 2)
		{
			NetMessage.SendData(54, -1, -1, null, whoAmI);
		}
	}

	private void UpdateNPC_BloodMoonTransformations()
	{
		if (Main.netMode != 1 && Main.bloodMoon)
		{
			bool flag = false;
			if (value == 0f)
			{
				flag = true;
			}
			AttemptToConvertNPCToEvil(WorldGen.crimson);
			if (flag)
			{
				value = 0f;
			}
		}
	}

	public void AttemptToConvertNPCToEvil(bool crimson)
	{
		if (type == 46 || type == 303 || type == 337 || type == 443 || type == 540)
		{
			if (crimson)
			{
				Transform(464);
			}
			else
			{
				Transform(47);
			}
		}
		else if (type == 55 || type == 230 || type == 592 || type == 593)
		{
			if (crimson)
			{
				Transform(465);
			}
			else
			{
				Transform(57);
			}
		}
		else if (type == 148 || type == 149)
		{
			if (crimson)
			{
				Transform(470);
			}
			else
			{
				Transform(168);
			}
		}
	}

	public void UpdateNPC_BuffSetFlags(bool lowerBuffTime = true)
	{
		for (int i = 0; i < maxBuffs; i++)
		{
			if (buffType[i] <= 0 || buffTime[i] <= 0)
			{
				continue;
			}
			if (lowerBuffTime)
			{
				buffTime[i]--;
			}
			if (buffType[i] == 20)
			{
				poisoned = true;
			}
			if (buffType[i] == 25)
			{
				tipsy = true;
			}
			if (buffType[i] == 30)
			{
				bleeding = true;
			}
			if (buffType[i] == 375)
			{
				hemorrhage = true;
			}
			if (buffType[i] == 70)
			{
				venom = true;
			}
			if (buffType[i] == 24)
			{
				if (type == 1 && ai[1] == 9f)
				{
					buffTime[i] = 60;
				}
				onFire = true;
			}
			if (buffType[i] == 72)
			{
				midas = true;
			}
			if (buffType[i] == 69)
			{
				ichor = true;
			}
			if (buffType[i] == 36)
			{
				brokenArmor = true;
			}
			if (buffType[i] == 31)
			{
				confused = true;
			}
			if (buffType[i] == 39)
			{
				onFire2 = true;
			}
			if (buffType[i] == 44)
			{
				if (type == 1 && ai[1] == 9f)
				{
					buffTime[i] = 60;
				}
				onFrostBurn = true;
			}
			if (buffType[i] == 103)
			{
				dripping = true;
			}
			if (buffType[i] == 137)
			{
				drippingSlime = true;
			}
			if (buffType[i] == 320)
			{
				drippingSparkleSlime = true;
			}
			if (buffType[i] == 119)
			{
				loveStruck = true;
			}
			if (buffType[i] == 120)
			{
				stinky = true;
			}
			if (buffType[i] == 151)
			{
				soulDrain = true;
			}
			if (buffType[i] == 153)
			{
				shadowFlame = true;
			}
			if (buffType[i] == 165)
			{
				dryadWard = true;
			}
			if (buffType[i] == 169)
			{
				javelined = true;
			}
			if (buffType[i] == 337)
			{
				tentacleSpiked = true;
			}
			if (buffType[i] == 344)
			{
				bloodButchered = true;
			}
			if (buffType[i] == 183)
			{
				celled = true;
			}
			if (buffType[i] == 186)
			{
				dryadBane = true;
			}
			if (buffType[i] == 189)
			{
				daybreak = true;
			}
			if (buffType[i] == 203)
			{
				betsysCurse = true;
			}
			if (buffType[i] == 204)
			{
				oiled = true;
			}
			if (buffType[i] == 310)
			{
				markedByScytheWhip = true;
			}
			if (buffType[i] == 362)
			{
				markedByEelWhip = true;
			}
			if (buffType[i] == 323)
			{
				onFire3 = true;
			}
			if (buffType[i] == 324)
			{
				onFrostBurn2 = true;
			}
			if (buffType[i] == 353)
			{
				if (buffImmune[353])
				{
					DelBuff(i);
				}
				else
				{
					shimmering = true;
				}
			}
		}
		if (dripping)
		{
			TryRemovingWaterPerishableEffects(isInLava: false);
		}
	}

	private void UpdateNPC_BuffFlagsReset()
	{
		lifeRegen = 0;
		soulDrain = false;
		poisoned = false;
		venom = false;
		tipsy = false;
		bleeding = false;
		hemorrhage = false;
		shadowFlame = false;
		onFire = false;
		midas = false;
		ichor = false;
		brokenArmor = false;
		onFrostBurn = false;
		onFrostBurn2 = false;
		onFire2 = false;
		onFire3 = false;
		confused = false;
		loveStruck = false;
		dryadWard = false;
		stinky = false;
		dripping = false;
		drippingSlime = false;
		drippingSparkleSlime = false;
		daybreak = false;
		javelined = false;
		tentacleSpiked = false;
		bloodButchered = false;
		celled = false;
		dryadBane = false;
		betsysCurse = false;
		oiled = false;
		markedByScytheWhip = false;
		markedByEelWhip = false;
		shimmering = false;
		lifeRegenExpectedLossPerSecond = -1;
	}

	private void UpdateNPC_TeleportVisuals()
	{
		if (!(teleportTime > 0f))
		{
			return;
		}
		if (teleportStyle == 0)
		{
			if ((float)Main.rand.Next(100) <= 100f * teleportTime * 2f)
			{
				int num = Dust.NewDust(new Vector2(getRect().X, getRect().Y), getRect().Width, getRect().Height, 159);
				Main.dust[num].scale = teleportTime * 1.5f;
				Main.dust[num].noGravity = true;
				Main.dust[num].velocity *= 1.1f;
			}
		}
		else if (teleportStyle == 4)
		{
			teleportTime -= 0.02f;
			if ((float)Main.rand.Next(100) <= 100f * teleportTime)
			{
				Dust obj = Main.dust[Dust.NewDust(position, width, height, 263)];
				obj.color = PortalHelper.GetPortalColor(lastPortalColorIndex);
				obj.noLight = true;
				obj.noGravity = true;
				obj.scale = 1.2f;
				obj.fadeIn = 0.4f;
			}
		}
		else if (teleportStyle == 12)
		{
			teleportTime -= 0.02f;
			if ((float)Main.rand.Next(100) <= 100f * teleportTime)
			{
				Dust obj2 = Main.dust[Dust.NewDust(position, width, height, 263)];
				obj2.color = Main.hslToRgb((float)(Main.timeForVisualEffects / 60.0) % 1f, 1f, 0.75f, 0);
				obj2.noLight = true;
				obj2.noGravity = true;
				obj2.scale = 1.2f;
				obj2.fadeIn = 0.4f;
			}
		}
		else if (teleportStyle == 13)
		{
			teleportTime = 0f;
		}
		teleportTime = Math.Max(0f, teleportTime - 0.005f);
	}

	private void UpdateNPC_CritterSounds()
	{
		if (Main.netMode == 2)
		{
			return;
		}
		if ((type == 611 || type == 689) && !Main.dayTime && Main.rand.Next(700) == 0)
		{
			SoundEngine.PlaySound(46, (int)position.X, (int)position.Y);
		}
		if (type >= 602 && type <= 603 && Main.dayTime && Main.rand.Next(1200) == 0)
		{
			SoundEngine.PlaySound(44, (int)position.X, (int)position.Y);
		}
		if (type >= 362 && type <= 365)
		{
			if (Main.dayTime && Main.rand.Next(200) == 0)
			{
				SoundEngine.PlaySound(30, (int)position.X, (int)position.Y);
			}
		}
		else if (type == 361 || type == 445 || type == 687)
		{
			if ((double)Math.Abs(velocity.X) < 0.5 && (!Main.dayTime || (double)position.Y > Main.worldSurface * 16.0) && Main.rand.Next(200) == 0)
			{
				SoundEngine.PlaySound(31, (int)position.X, (int)position.Y);
			}
		}
		else if (type == 74 || type == 297 || type == 298 || type == 442 || type == 671 || type == 672 || type == 673 || type == 674 || type == 675)
		{
			if (!Main.dayTime || !(Main.time < 18000.0))
			{
				return;
			}
			int maxValue = 400;
			if (Main.rand.Next(maxValue) != 0)
			{
				return;
			}
			if (type == 74)
			{
				if (Main.rand.Next(3) != 0)
				{
					SoundEngine.PlaySound(32, (int)position.X, (int)position.Y, 14);
				}
				else
				{
					SoundEngine.PlaySound(32, (int)position.X, (int)position.Y, 18);
				}
			}
			if (type == 297)
			{
				SoundEngine.PlaySound(32, (int)position.X, (int)position.Y, 16);
			}
			if (type == 298)
			{
				if (Main.rand.Next(3) != 0)
				{
					SoundEngine.PlaySound(32, (int)position.X, (int)position.Y, 17);
				}
				else
				{
					SoundEngine.PlaySound(32, (int)position.X, (int)position.Y, 19);
				}
			}
			if (type == 674 || type == 675)
			{
				SoundEngine.PlaySound(67, (int)position.X, (int)position.Y);
			}
			if (type == 671 || type == 672)
			{
				SoundEngine.PlaySound(68, (int)position.X, (int)position.Y);
			}
			if (type == 673)
			{
				SoundEngine.PlaySound(69, (int)position.X, (int)position.Y);
			}
			if (type == 442)
			{
				switch (Main.rand.Next(5))
				{
				case 0:
					SoundEngine.PlaySound(32, (int)position.X, (int)position.Y, 16);
					break;
				case 1:
					SoundEngine.PlaySound(32, (int)position.X, (int)position.Y, 17);
					break;
				case 2:
					SoundEngine.PlaySound(32, (int)position.X, (int)position.Y, 19);
					break;
				case 3:
					SoundEngine.PlaySound(32, (int)position.X, (int)position.Y, 14);
					break;
				default:
					SoundEngine.PlaySound(32, (int)position.X, (int)position.Y, 18);
					break;
				}
			}
		}
		else if ((type == 300 || type == 447 || type == 610) && Main.rand.Next(1800) == 0)
		{
			SoundEngine.PlaySound(33, (int)position.X, (int)position.Y);
		}
	}

	private void UpdateNPC_CastLights()
	{
		if (type >= 0 && NPCID.Sets.IsGoldCritter[type])
		{
			position += netOffset;
			Color color = Lighting.GetColor((int)base.Center.X / 16, (int)base.Center.Y / 16);
			if (color.R > 20 || color.B > 20 || color.G > 20)
			{
				int num = color.R;
				if (color.G > num)
				{
					num = color.G;
				}
				if (color.B > num)
				{
					num = color.B;
				}
				num /= 30;
				if (Main.rand.Next(300) < num)
				{
					int num2 = Dust.NewDust(position, width, height, 43, 0f, 0f, 254, new Color(255, 255, 0), 0.5f);
					Main.dust[num2].velocity *= 0f;
				}
			}
			position -= netOffset;
		}
		if (type == 160)
		{
			float num3 = (float)Main.rand.Next(28, 42) * 0.005f;
			num3 += (float)(270 - Main.mouseTextColor) / 500f;
			float num4 = 0.1f;
			float num5 = 0.3f + num3 / 2f;
			float num6 = 0.6f + num3;
			if (townNpcVariationIndex == 1)
			{
				float num7 = num4;
				num4 = num6;
				num6 = num7;
			}
			float num8 = 0.35f;
			num4 *= num8;
			num5 *= num8;
			num6 *= num8;
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, num4, num5, num6);
		}
		if ((type >= 254 && type <= 261) || type == 634 || type == 635)
		{
			float num9 = (float)Main.rand.Next(28, 42) * 0.005f;
			num9 += (float)(270 - Main.mouseTextColor) / 500f;
			float num10 = 0.1f;
			float num11 = 0.3f + num9 / 2f;
			float num12 = 0.6f + num9;
			float num13 = 0.35f;
			if (type == 634)
			{
				num13 = 0.65f;
			}
			num10 *= num13;
			num11 *= num13;
			num12 *= num13;
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, num10, num11, num12);
		}
		if (type == 209)
		{
			float num14 = (float)Main.rand.Next(28, 42) * 0.005f;
			num14 += (float)(270 - Main.mouseTextColor) / 500f;
			float num15 = 0.1f;
			float num16 = 0.3f + num14 / 2f;
			float num17 = 0.4f + num14 / 2f;
			float num18 = 0.35f;
			num15 *= num18;
			num16 *= num18;
			num17 *= num18;
			Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, num15, num16, num17);
			if (ai[0] == 12f)
			{
				Lighting.AddLight(base.Top, 0.3f, 0.1f, 0.1f);
			}
		}
		if (type == 44)
		{
			Lighting.AddLight((int)(position.X + (float)(width / 2)) / 16, (int)(position.Y + 4f) / 16, 0.9f, 0.75f, 0.5f);
		}
	}

	private void GetHurtByOtherNPCs(bool[] acceptableNPCIDs)
	{
		if (dontTakeDamage || dontTakeDamageFromHostiles || immortal || (NPCID.Sets.CritterThatCanTurnOnPlayers[type] && aiStyle == 3))
		{
			return;
		}
		int specialHitSetter = 1;
		float damageMultiplier = 1f;
		if (immune[255] != 0)
		{
			return;
		}
		Rectangle hitbox = base.Hitbox;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (i == whoAmI)
			{
				continue;
			}
			NPC nPC = Main.npc[i];
			if (acceptableNPCIDs[nPC.type] && nPC.active && !nPC.friendly && nPC.damage > 0 && !NPCID.Sets.CritterThatCanTurnOnPlayers[nPC.type])
			{
				Rectangle npcRect = nPC.Hitbox;
				GetMeleeCollisionData(hitbox, i, ref specialHitSetter, ref damageMultiplier, ref npcRect);
				if (hitbox.Intersects(npcRect) && (type != 453 || !NPCID.Sets.Skeletons[nPC.type]) && nPC.type != 624 && nPC.type != 690)
				{
					BeHurtByOtherNPC(i, nPC);
					break;
				}
			}
		}
	}

	private void BeHurtByOtherNPC(int npcIndex, NPC thatNPC)
	{
		int num = 30;
		if (type == 548)
		{
			num = 20;
		}
		int num2 = Main.DamageVar(thatNPC.damage);
		int num3 = 6;
		int num4 = ((!(thatNPC.Center.X > base.Center.X)) ? 1 : (-1));
		double num5 = StrikeNPCNoInteraction(num2, num3, num4);
		if (Main.netMode != 0)
		{
			NetMessage.SendData(28, -1, -1, null, whoAmI, num2, num3, num4);
		}
		immune[255] = num;
		if (dryadWard)
		{
			num2 = (int)num5 / 3;
			num3 = 6;
			num4 *= -1;
			thatNPC.StrikeNPCNoInteraction(num2, num3, num4);
			if (Main.netMode != 0)
			{
				NetMessage.SendData(28, -1, -1, null, npcIndex, num2, num3, num4);
			}
			thatNPC.immune[255] = num;
		}
		if (NPCID.Sets.HurtingBees[thatNPC.type])
		{
			num2 = damage;
			num3 = 6;
			num4 *= -1;
			thatNPC.StrikeNPCNoInteraction(num2, num3, num4);
			if (Main.netMode != 0)
			{
				NetMessage.SendData(28, -1, -1, null, npcIndex, num2, num3, num4);
			}
			thatNPC.immune[255] = num;
		}
	}

	private void CheckLifeRegen()
	{
		if (life < lifeMax)
		{
			int num = 1;
			if (dryadWard)
			{
				num += 10;
			}
			switch (type)
			{
			case 22:
				num += 5;
				break;
			case 209:
				num += 9;
				break;
			}
			friendlyRegen += num;
			if (friendlyRegen > 180)
			{
				friendlyRegen = 0;
				life++;
				NetUpdateLowPriority();
			}
		}
	}

	public void GetImmuneTime(int fromWho, int time)
	{
		if (fromWho == -1)
		{
			for (int i = 0; i < immune.Length; i++)
			{
				immune[i] = time;
			}
		}
		else if (fromWho >= 0 && fromWho < immune.Length)
		{
			immune[fromWho] = time;
		}
	}

	private void UpdateCollision()
	{
		Collision_WalkDownSlopes();
		bool lava = Collision_LavaCollision();
		lava = Collision_WaterCollision(lava);
		if (!wet)
		{
			lavaWet = false;
			honeyWet = false;
			shimmerWet = false;
		}
		if (wetCount > 0)
		{
			wetCount--;
		}
		bool fall = Collision_DecideFallThroughPlatforms();
		oldVelocity = velocity;
		collideX = false;
		collideY = false;
		FishTransformationDuringRain();
		GetTileCollisionParameters(out var cPosition, out var cWidth, out var cHeight);
		Vector2 oldDryVelocity = velocity;
		ApplyTileCollision(fall, cPosition, cWidth, cHeight);
		if (wet)
		{
			if (shimmerWet)
			{
				Collision_MoveWhileWet(oldDryVelocity, shimmerMovementSpeed);
			}
			else if (honeyWet)
			{
				Collision_MoveWhileWet(oldDryVelocity, honeyMovementSpeed);
			}
			else if (lavaWet)
			{
				Collision_MoveWhileWet(oldDryVelocity, lavaMovementSpeed);
			}
			else
			{
				Collision_MoveWhileWet(oldDryVelocity, waterMovementSpeed);
			}
		}
		else
		{
			Collision_MoveWhileDry();
		}
		if (aiStyle == 67)
		{
			Collision_MoveSnailOnSlopes();
		}
		else if (type != 72 && type != 247 && type != 248 && (type < 542 || type > 545) && (!NPCID.Sets.BelongsToInvasionOldOnesArmy[type] || !noGravity))
		{
			Collision_MoveSlopesAndStairFall(fall);
			if (ConveyorBeltCollision())
			{
				Collision.StepConveyorBelt(this, 1f);
			}
		}
	}

	private bool ConveyorBeltCollision()
	{
		if (townNPC || (lifeMax == 5 && damage == 0) || NPCID.Sets.ConveyorBeltCollision[type])
		{
			return true;
		}
		return false;
	}

	private void Collision_MoveWhileDry()
	{
		if (Collision.up)
		{
			velocity.Y = 0.01f;
		}
		if (oldVelocity.X != velocity.X)
		{
			collideX = true;
		}
		if (oldVelocity.Y != velocity.Y)
		{
			collideY = true;
		}
		oldPosition = position;
		oldDirection = direction;
		position += velocity;
	}

	private void ApplyTileCollision(bool fall, Vector2 cPosition, int cWidth, int cHeight)
	{
		if (type == 72)
		{
			Collision_MoveBlazingWheel();
		}
		else if (type >= 542 && type <= 545)
		{
			Collision_MoveSandshark(fall, cPosition, cWidth, cHeight);
		}
		else if (type == 405 || type == 406)
		{
			Collision_MoveStardustCell(fall, cPosition, cWidth, cHeight);
		}
		else if (type == 417)
		{
			Collision_MoveSolarSroller(fall, cPosition, cWidth, cHeight);
		}
		else
		{
			Collision_MoveNormal(fall, cPosition, cWidth, cHeight);
		}
	}

	private void Collision_MoveSlopesAndStairFall(bool fall)
	{
		if (fall)
		{
			stairFall = true;
		}
		if (aiStyle == 7)
		{
			int num = (int)base.Center.X / 16;
			int num2 = (int)position.Y / 16;
			if (WorldGen.InWorld(num, num2))
			{
				int num3 = 16;
				bool flag = false;
				if (Main.tile[num, num2] != null && Main.tile[num, num2].active() && Main.tileSolid[Main.tile[num, num2].type])
				{
					flag = true;
				}
				if (!townNPC)
				{
					flag = false;
				}
				if (!Main.dayTime || Main.eclipse)
				{
					flag = true;
				}
				else
				{
					int num4 = (int)(position.Y + (float)height) / 16;
					if (homeTileY - num4 > num3)
					{
						flag = true;
					}
				}
				if (flag)
				{
					if ((position.Y + (float)height - 8f) / 16f < (float)homeTileY)
					{
						stairFall = true;
					}
					else
					{
						stairFall = false;
					}
				}
			}
		}
		GetTileCollisionParameters(out var cPosition, out var cWidth, out var cHeight);
		Vector2 vector = position - cPosition;
		Vector4 vector2 = Collision.SlopeCollision(cPosition, velocity, cWidth, cHeight, gravity, stairFall);
		if (Collision.stairFall)
		{
			stairFall = true;
		}
		else if (!fall)
		{
			stairFall = false;
		}
		if (Collision.stair && Math.Abs(vector2.Y - position.Y) > 8f)
		{
			gfxOffY -= vector2.Y - position.Y;
			stepSpeed = 2f;
		}
		position.X = vector2.X;
		position.Y = vector2.Y;
		velocity.X = vector2.Z;
		velocity.Y = vector2.W;
		position += vector;
	}

	private void Collision_MoveSnailOnSlopes()
	{
		Vector4 vector = Collision.SlopeCollision(position, velocity, width, height, gravity);
		if (position.X != vector.X || position.Y != vector.Y)
		{
			if (ai[2] == 0f && velocity.Y > 0f && ((direction < 0 && rotation == 1.57f && spriteDirection == 1) || (direction > 0 && rotation == 4.71f && spriteDirection == -1)))
			{
				direction *= -direction;
			}
			ai[2] = 2f;
			directionY = 1;
			rotation = 0f;
		}
		position.X = vector.X;
		position.Y = vector.Y;
		velocity.X = vector.Z;
		velocity.Y = vector.W;
	}

	private void Collision_MoveNormal(bool fall, Vector2 cPosition, int cWidth, int cHeight)
	{
		velocity = Collision.TileCollision(cPosition, velocity, cWidth, cHeight, fall, fall);
	}

	private void Collision_MoveSandshark(bool fall, Vector2 cPosition, int cWidth, int cHeight)
	{
		if (!Main.remixWorld)
		{
			velocity = Collision.AdvancedTileCollision(TileID.Sets.ForAdvancedCollision.ForSandshark, cPosition, velocity, cWidth, cHeight, fall, fall);
		}
	}

	private void Collision_MoveSolarSroller(bool fall, Vector2 cPosition, int cWidth, int cHeight)
	{
		velocity = Collision.TileCollision(cPosition, velocity, cWidth, cHeight, fall, fall);
		if (ai[0] != 6f || !(velocity != oldVelocity))
		{
			return;
		}
		ai[2] -= 1f;
		ai[3] = 1f;
		if (ai[2] > 0f)
		{
			if (velocity.X != 0f && velocity.X != oldVelocity.X)
			{
				velocity.X = (0f - oldVelocity.X) * 0.9f;
				direction *= -1;
			}
			if (velocity.Y != 0f && velocity.Y != oldVelocity.Y)
			{
				velocity.Y = (0f - oldVelocity.Y) * 0.9f;
			}
		}
	}

	private void Collision_MoveStardustCell(bool fall, Vector2 cPosition, int cWidth, int cHeight)
	{
		velocity = Collision.TileCollision(cPosition, velocity, cWidth, cHeight, fall, fall);
		if (velocity != oldVelocity)
		{
			if (velocity.X != 0f && velocity.X != oldVelocity.X)
			{
				velocity.X = (0f - oldVelocity.X) * 0.8f;
			}
			if (velocity.Y != 0f && velocity.Y != oldVelocity.Y)
			{
				velocity.Y = (0f - oldVelocity.Y) * 0.8f;
			}
		}
	}

	private void Collision_MoveBlazingWheel()
	{
		Vector2 vector = new Vector2(position.X + (float)(width / 2), position.Y + (float)(height / 2));
		int num = 12;
		int num2 = 12;
		vector.X -= num / 2;
		vector.Y -= num2 / 2;
		velocity = Collision.noSlopeCollision(vector, velocity, num, num2, fallThrough: true, fall2: true);
	}

	private void Collision_MoveWhileWet(Vector2 oldDryVelocity, float Slowdown = 0.5f)
	{
		if (Collision.up)
		{
			velocity.Y = 0.01f;
		}
		Vector2 vector = velocity * Slowdown;
		if (velocity.X != oldDryVelocity.X)
		{
			vector.X = velocity.X;
			collideX = true;
		}
		if (velocity.Y != oldDryVelocity.Y)
		{
			vector.Y = velocity.Y;
			collideY = true;
		}
		oldPosition = position;
		oldDirection = direction;
		position += vector;
	}

	public void GetTileCollisionParameters(out Vector2 cPosition, out int cWidth, out int cHeight)
	{
		cPosition = position;
		cWidth = width;
		cHeight = height;
		if (type == 594)
		{
			int num = (int)(44f + 20f * ai[1]);
			cPosition.Y += num;
			cHeight += num;
			cPosition.X += cWidth / 2;
			cWidth = (int)(6f + 26f * ai[1]);
			cPosition.X -= cWidth / 2;
		}
		if (type == 686)
		{
			int num2 = 64;
			cPosition.Y += num2;
			cHeight += num2;
			cPosition.X += cWidth / 2;
			cWidth = 32;
			cPosition.X -= cWidth / 2;
		}
		if (type == 243)
		{
			cHeight = 90;
		}
		if (type == 290)
		{
			cHeight = 40;
		}
		if (type == 351)
		{
			cHeight = 40;
		}
		if (type == 482)
		{
			cHeight = 40;
		}
		if (type == 351 || type == 343 || type == 348 || type == 349)
		{
			cHeight = 40;
		}
		if (type == 391)
		{
			for (int i = 0; i < Main.maxNPCs; i++)
			{
				if (Main.npc[i].active && Main.npc[i].type == 390 && Main.npc[i].ai[0] == (float)whoAmI)
				{
					cHeight = 62;
					break;
				}
			}
		}
		if (type == 415)
		{
			for (int j = 0; j < Main.maxNPCs; j++)
			{
				if (Main.npc[j].active && Main.npc[j].type == 416 && Main.npc[j].ai[0] == (float)whoAmI)
				{
					cHeight = 62;
					break;
				}
			}
		}
		if (type == 576 || type == 577)
		{
			cPosition.X += 32f;
			cWidth -= 64;
		}
		if (cHeight != height)
		{
			cPosition.Y += height - cHeight;
		}
	}

	private void FishTransformationDuringRain()
	{
		if (Main.netMode == 1)
		{
			return;
		}
		if (type == 230 && wet)
		{
			Transform(55);
			if (velocity.Y < 0f)
			{
				velocity.Y = 0f;
			}
		}
		else if (type == 55 && !wet && Main.raining)
		{
			Transform(230);
			UpdateHomeTileState(homeless, (int)(position.X / 16f) + 10 * direction, homeTileY);
		}
		else if (type == 593 && wet)
		{
			Transform(592);
			if (velocity.Y < 0f)
			{
				velocity.Y = 0f;
			}
		}
		else if (type == 592 && !wet && Main.raining)
		{
			Transform(593);
			UpdateHomeTileState(homeless, (int)(position.X / 16f) + 10 * direction, homeTileY);
		}
	}

	private bool Collision_DecideFallThroughPlatforms()
	{
		bool result = false;
		if (type == 2 || type == -43 || type == 190 || type == 191 || type == 192 || type == 193 || type == 194 || type == 317 || type == 318 || type == 133)
		{
			result = true;
		}
		if (aiStyle == 10)
		{
			result = true;
		}
		if (aiStyle == 5)
		{
			result = true;
		}
		if (aiStyle == 40)
		{
			result = true;
		}
		if (aiStyle == 44)
		{
			result = true;
		}
		if (type == 467)
		{
			result = true;
		}
		if (type == 477)
		{
			result = true;
		}
		if (aiStyle == 22)
		{
			result = true;
		}
		if (aiStyle == 49)
		{
			result = true;
		}
		if (aiStyle == 14)
		{
			result = true;
		}
		if (type == 173)
		{
			result = true;
		}
		if (type == 469 && ai[2] == 1f)
		{
			result = true;
		}
		if (aiStyle == 3 && directionY == 1)
		{
			result = true;
		}
		if (type == 210 || type == 211)
		{
			result = true;
		}
		if (type == 50 && target >= 0 && Main.player[target].position.Y > position.Y + (float)height)
		{
			result = true;
		}
		if (type == 657 && target >= 0 && Main.player[target].position.Y > base.Bottom.Y)
		{
			result = true;
		}
		if (aiStyle == 26 && target >= 0 && Main.player[target].Bottom.Y - velocity.Y > base.Bottom.Y)
		{
			result = true;
		}
		if (type == 247 || type == 248)
		{
			result = true;
		}
		if (type == 245 && target >= 0 && Main.player[target].position.Y > position.Y + (float)height)
		{
			result = true;
		}
		if (type >= 542 && type <= 545)
		{
			result = true;
		}
		if (aiStyle == 107 && directionY == 1)
		{
			result = true;
		}
		if (type == 418)
		{
			result = true;
		}
		if (aiStyle == 87 && Main.player[target].position.Y > position.Y + (float)height)
		{
			result = true;
		}
		if (type == 405 || type == 406)
		{
			result = true;
		}
		if (type == 490)
		{
			result = true;
		}
		if (type == 301)
		{
			result = true;
		}
		if (aiStyle == 7)
		{
			int num = 16;
			bool flag = false;
			if (townNPC && (!Main.dayTime || Main.invasionType > 0 || Main.eclipse))
			{
				flag = true;
			}
			else
			{
				int num2 = (int)(position.Y + (float)height) / 16;
				if (homeTileY - num2 > num)
				{
					result = true;
				}
			}
			if (flag && (position.Y + (float)height - 8f) / 16f < (float)(homeTileY - 1))
			{
				result = true;
			}
		}
		if (type == 620)
		{
			result = ((target >= 0 && Main.player[target].position.Y > base.Bottom.Y) ? true : false);
		}
		return result;
	}

	private bool Collision_WaterCollision(bool lava)
	{
		bool flag = false;
		if ((type == 690 && ai[0] == 0f) || type == 72 || aiStyle == 21 || aiStyle == 67 || type == 376 || type == 579 || type == 541 || (aiStyle == 7 && ai[0] == 25f))
		{
			flag = false;
			wetCount = 0;
			lava = false;
		}
		else
		{
			flag = Collision.WetCollision(position, width, height);
			if (Collision.honey)
			{
				honeyWet = true;
			}
			if (Collision.shimmer)
			{
				shimmerWet = true;
				if (Main.netMode != 1)
				{
					TryAddingRepeatedBuff(353, 100);
				}
			}
		}
		if (aiStyle == 116)
		{
			wetCount = 10;
		}
		if (flag)
		{
			TryRemovingWaterPerishableEffects(lavaWet);
		}
		if (flag)
		{
			if (!wet && wetCount == 0)
			{
				wetCount = 10;
				if (!lava)
				{
					if (shimmerWet)
					{
						if (type != 617 && type != 616 && type != 625)
						{
							for (int i = 0; i < 30; i++)
							{
								int num = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 308);
								Main.dust[num].velocity.Y -= 4f;
								Main.dust[num].velocity.X *= 2.5f;
								Main.dust[num].scale = 0.8f;
								Main.dust[num].noGravity = true;
								switch (Main.rand.Next(6))
								{
								case 0:
									Main.dust[num].color = new Color(255, 255, 210);
									break;
								case 1:
									Main.dust[num].color = new Color(190, 245, 255);
									break;
								case 2:
									Main.dust[num].color = new Color(255, 150, 255);
									break;
								default:
									Main.dust[num].color = new Color(190, 175, 255);
									break;
								}
							}
							if ((type != 376 && type != 579 && aiStyle != 1 && type != 1 && type != 16 && type != 147 && type != 59 && type != 300 && aiStyle != 39 && aiStyle != 68 && type != 362 && type != 364 && type != 361 && type != 445 && !noGravity) || type == 615)
							{
								SoundEngine.PlaySound(19, (int)position.X, (int)position.Y, 4);
							}
						}
					}
					else if (honeyWet)
					{
						for (int j = 0; j < 10; j++)
						{
							int num2 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 152);
							Main.dust[num2].velocity.Y -= 1f;
							Main.dust[num2].velocity.X *= 2.5f;
							Main.dust[num2].scale = 1.3f;
							Main.dust[num2].alpha = 100;
							Main.dust[num2].noGravity = true;
						}
						if (aiStyle != 1 && type != 1 && type != 16 && type != 147 && type != 59 && type != 300 && aiStyle != 39 && !noGravity)
						{
							SoundEngine.PlaySound(19, (int)position.X, (int)position.Y);
						}
					}
					else if (type != 617 && type != 616 && type != 625)
					{
						for (int k = 0; k < 30; k++)
						{
							int num3 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, Dust.dustWater());
							Main.dust[num3].velocity.Y -= 4f;
							Main.dust[num3].velocity.X *= 2.5f;
							Main.dust[num3].scale *= 0.8f;
							Main.dust[num3].alpha = 100;
							Main.dust[num3].noGravity = true;
						}
						if ((type != 376 && type != 579 && aiStyle != 1 && type != 1 && type != 16 && type != 147 && type != 59 && type != 300 && aiStyle != 39 && aiStyle != 68 && type != 362 && type != 364 && type != 361 && type != 445 && !noGravity) || type == 615)
						{
							SoundEngine.PlaySound(19, (int)position.X, (int)position.Y, 0);
						}
					}
				}
				else
				{
					for (int l = 0; l < 10; l++)
					{
						int num4 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 35);
						Main.dust[num4].velocity.Y -= 1.5f;
						Main.dust[num4].velocity.X *= 2.5f;
						Main.dust[num4].scale = 1.3f;
						Main.dust[num4].alpha = 100;
						Main.dust[num4].noGravity = true;
					}
					if (aiStyle != 1 && type != 1 && type != 16 && type != 147 && type != 59 && type != 300 && aiStyle != 39 && !noGravity)
					{
						SoundEngine.PlaySound(19, (int)position.X, (int)position.Y);
					}
				}
			}
			wet = true;
		}
		else if (wet)
		{
			velocity.X *= 0.5f;
			wet = false;
			if (type == 620 && GetTargetData().Center.Y < base.Center.Y)
			{
				velocity.Y -= 8f;
			}
			if (wetCount == 0)
			{
				wetCount = 10;
				if (!lavaWet)
				{
					if (shimmerWet)
					{
						if (type != 617 && type != 616 && type != 625)
						{
							for (int m = 0; m < 30; m++)
							{
								int num5 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 308);
								Main.dust[num5].velocity.Y -= 4f;
								Main.dust[num5].velocity.X *= 2.5f;
								Main.dust[num5].scale = 0.8f;
								Main.dust[num5].noGravity = true;
								switch (Main.rand.Next(6))
								{
								case 0:
									Main.dust[num5].color = new Color(255, 255, 210);
									break;
								case 1:
									Main.dust[num5].color = new Color(190, 245, 255);
									break;
								case 2:
									Main.dust[num5].color = new Color(255, 150, 255);
									break;
								default:
									Main.dust[num5].color = new Color(190, 175, 255);
									break;
								}
							}
							if ((type != 376 && type != 579 && aiStyle != 1 && type != 1 && type != 16 && type != 147 && type != 59 && type != 300 && aiStyle != 39 && aiStyle != 68 && type != 362 && type != 364 && type != 361 && type != 445 && !noGravity) || type == 615)
							{
								SoundEngine.PlaySound(19, (int)position.X, (int)position.Y, 5);
							}
						}
					}
					else if (honeyWet)
					{
						for (int n = 0; n < 10; n++)
						{
							int num6 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 152);
							Main.dust[num6].velocity.Y -= 1f;
							Main.dust[num6].velocity.X *= 2.5f;
							Main.dust[num6].scale = 1.3f;
							Main.dust[num6].alpha = 100;
							Main.dust[num6].noGravity = true;
						}
						if (aiStyle != 1 && type != 1 && type != 16 && type != 147 && type != 300 && type != 59 && aiStyle != 39 && !noGravity)
						{
							SoundEngine.PlaySound(19, (int)position.X, (int)position.Y);
						}
					}
					else if (type != 617 && type != 616 && type != 625)
					{
						for (int num7 = 0; num7 < 30; num7++)
						{
							int num8 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, Dust.dustWater());
							Main.dust[num8].velocity.Y -= 4f;
							Main.dust[num8].velocity.X *= 2.5f;
							Main.dust[num8].scale *= 0.8f;
							Main.dust[num8].alpha = 100;
							Main.dust[num8].noGravity = true;
						}
						if ((type != 376 && type != 579 && aiStyle != 1 && type != 1 && type != 16 && type != 59 && type != 300 && aiStyle != 39 && aiStyle != 68 && type != 362 && type != 364 && type != 361 && type != 445 && !noGravity) || type == 615)
						{
							SoundEngine.PlaySound(19, (int)position.X, (int)position.Y, 0);
						}
					}
				}
				else
				{
					for (int num9 = 0; num9 < 10; num9++)
					{
						int num10 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 35);
						Main.dust[num10].velocity.Y -= 1.5f;
						Main.dust[num10].velocity.X *= 2.5f;
						Main.dust[num10].scale = 1.3f;
						Main.dust[num10].alpha = 100;
						Main.dust[num10].noGravity = true;
					}
					if (aiStyle != 1 && type != 1 && type != 16 && type != 59 && type != 300 && aiStyle != 39 && !noGravity)
					{
						SoundEngine.PlaySound(19, (int)position.X, (int)position.Y);
					}
				}
			}
		}
		return lava;
	}

	private void TryRemovingWaterPerishableEffects(bool isInLava)
	{
		if ((onFire || onFire3) && !isInLava && Main.netMode != 1)
		{
			for (int i = 0; i < maxBuffs; i++)
			{
				int num = buffType[i];
				if (num == 24 || num == 323)
				{
					DelBuff(i);
				}
			}
		}
		if (!stinky || Main.netMode == 1)
		{
			return;
		}
		for (int j = 0; j < maxBuffs; j++)
		{
			if (buffType[j] == 120)
			{
				DelBuff(j);
			}
		}
	}

	private void TryAddingRepeatedBuff(int buffId, int timeToGive, int lowThresholdUndeathToAllowBuff = 10)
	{
		if (!buffImmune[buffId])
		{
			int num = FindBuffIndex(buffId);
			if (num == -1 || buffTime[num] <= lowThresholdUndeathToAllowBuff)
			{
				AddBuff(buffId, timeToGive);
			}
		}
	}

	private bool Collision_LavaCollision()
	{
		bool flag = Collision.LavaCollision(position, width, height);
		if (type == 441)
		{
			flag = false;
		}
		if (flag)
		{
			lavaWet = true;
			if (!lavaImmune && !dontTakeDamage && Main.netMode != 1 && immune[255] == 0)
			{
				immune[255] = 30;
				if (Main.remixWorld && !friendly)
				{
					AddBuff(24, 180);
				}
				else
				{
					AddBuff(24, 420);
					StrikeNPCNoInteraction(50, 0f, 0);
					if (Main.netMode == 2)
					{
						NetMessage.SendData(28, -1, -1, null, whoAmI, 50f);
					}
				}
			}
		}
		return flag;
	}

	private void Collision_WalkDownSlopes()
	{
		_ = velocity;
		Vector4 vector = Collision.WalkDownSlope(position, velocity, width, height, gravity);
		position.X = vector.X;
		position.Y = vector.Y;
		velocity.X = vector.Z;
		velocity.Y = vector.W;
	}

	public static void setFireFlyChance()
	{
		if (Main.rand == null)
		{
			Main.rand = new UnifiedRandom((int)DateTime.Now.Ticks);
		}
		if (WorldGen.genRand.Next(9) == 0)
		{
			fireFlyChance = Main.rand.Next(5, 10);
			fireFlyFriendly = Main.rand.Next(1, 4);
			fireFlyMultiple = Main.rand.Next(3, 8);
		}
		else if (WorldGen.genRand.Next(3) == 0)
		{
			fireFlyChance = 999999;
			fireFlyFriendly = 999999;
			fireFlyMultiple = 999999;
		}
		else
		{
			fireFlyChance = Main.rand.Next(10, 60);
			fireFlyFriendly = Main.rand.Next(2, 15);
			fireFlyMultiple = Main.rand.Next(6, 30);
		}
		if (Main.rand.Next(3) == 0)
		{
			butterflyChance = 999999;
			stinkBugChance = Main.rand.Next(1, 14);
			if (WorldGen.genRand.Next(5) == 0)
			{
				stinkBugChance = 999999;
			}
		}
		else
		{
			stinkBugChance = 999999;
			butterflyChance = Main.rand.Next(1, 21);
			if (WorldGen.genRand.Next(5) == 0)
			{
				butterflyChance = 999999;
			}
		}
		if (Main.tenthAnniversaryWorld)
		{
			fireFlyChance = Math.Max(1, (int)((float)fireFlyChance * 0.5f));
			butterflyChance = Math.Max(1, (int)((float)butterflyChance * 0.5f));
		}
	}

	public Color GetBestiaryEntryColor()
	{
		return Color.White;
	}

	public Color GetAlpha(Color newColor)
	{
		if (IsABestiaryIconDummy)
		{
			newColor = Color.White;
		}
		float num = (float)(255 - alpha) / 255f;
		int num2 = (int)((float)(int)newColor.R * num);
		int num3 = (int)((float)(int)newColor.G * num);
		int num4 = (int)((float)(int)newColor.B * num);
		int num5 = newColor.A - alpha;
		if (type == 694)
		{
			if (ai[3] == 3f)
			{
				return newColor;
			}
			if (ai[3] == 4f)
			{
				float num6 = (float)frame.Y / 40f;
				float num7 = 17f;
				return Color.Lerp(newColor, Color.White, Math.Max(0f, Math.Min(1f, num6 / num7)));
			}
			return Color.White;
		}
		if (type == 1 && (ai[1] == 364f || ai[1] == 1104f || ai[1] == 365f || ai[1] == 1105f || ai[1] == 366f || ai[1] == 1106f))
		{
			return this.color;
		}
		if (type == 1 && ai[1] == 8f && Main.getGoodWorld)
		{
			return this.color;
		}
		if ((type == 147 || type == 184) && ai[1] == 1103f)
		{
			return new Color(200, 200, 200, 100);
		}
		if ((type == 147 || type == 184) && ai[1] == 593f)
		{
			return new Color(200, 200, 200, 100);
		}
		if (type == 402)
		{
			return new Color(255, 255, 255, 255);
		}
		if (type == 484)
		{
			return new Color(250, 250, 250, 200);
		}
		if (type >= 542 && type <= 545 && num2 + num3 + num4 > 10 && num2 + num3 + num4 >= 60)
		{
			num2 *= 2;
			num3 *= 2;
			num4 *= 2;
			if (num2 > 255)
			{
				num2 = 255;
			}
			if (num3 > 255)
			{
				num3 = 255;
			}
			if (num4 > 255)
			{
				num4 = 255;
			}
		}
		if (type == 681)
		{
			return Color.Lerp(newColor, Color.White, 0.4f) * Opacity;
		}
		if (type == 683 || type == 687)
		{
			float num8 = Utils.Remap(Utils.WrappedLerp(0.75f, 1f, (float)Main.timeForVisualEffects % 120f / 120f), 0f, 1f, 0.5f, 1f);
			Color result = Color.Lerp(newColor, new Color(255, 255, 100), 0.4f * num8) * Opacity;
			if (result.B < num4)
			{
				result.B = (byte)num4;
			}
			return result;
		}
		if (type == 658 || type == 659 || type == 660)
		{
			return Color.Lerp(newColor, Color.White, 0.4f) * Opacity;
		}
		if (type == 662)
		{
			Color color = Color.Lerp(Color.White, Color.Cyan, 0.5f);
			color.A /= 4;
			return color * Opacity;
		}
		if ((type >= 454 && type <= 459) || type == 521)
		{
			newColor = Color.Lerp(newColor, Color.White, 0.4f);
			newColor.A = 150;
			newColor *= (float)num5 / 255f;
			return newColor;
		}
		if (type == 636)
		{
			newColor = Color.Lerp(newColor, Color.White, 0.25f);
			return newColor * Opacity;
		}
		if (type == 440)
		{
			byte b = 180;
			if (Main.expertMode)
			{
				b = 210;
			}
			b = (byte)((float)(int)b * num);
			return new Color(b, b, b, b);
		}
		if (type == 583 || type == 584 || type == 585)
		{
			newColor = Color.Lerp(newColor, Color.White, 0.5f);
			return newColor;
		}
		if (type == 516)
		{
			return new Color(alpha, alpha, alpha, alpha);
		}
		if (type == 522)
		{
			return new Color(255 - alpha, 255 - alpha, 255 - alpha, 255 - alpha);
		}
		if (type == 523)
		{
			return new Color(255 - alpha, 255 - alpha, 255 - alpha, 255 - alpha);
		}
		if (type == 395 || type == 519)
		{
			newColor = Color.Lerp(newColor, Color.White, 0.4f);
			return newColor;
		}
		if (type == 370 && ai[0] != -1f && ai[0] < 9f)
		{
			float num9 = MathHelper.Lerp(num, 1f, 0.25f);
			if (num9 > 1f)
			{
				num9 = 1f;
			}
			num4 = (int)((float)(int)newColor.B * num9);
		}
		if (type == 30 || type == 665)
		{
			return new Color(250, 250, 250, 100);
		}
		if (!IsABestiaryIconDummy && (type == 25 || type == 30 || type == 665 || type == 59 || type == 60))
		{
			return new Color(200, 200, 200, 0);
		}
		if (type == 360)
		{
			num2 = newColor.R;
			num3 = newColor.G;
			num4 = newColor.B;
			if (num2 < 75)
			{
				num2 = 75;
			}
			if (num3 < 175)
			{
				num3 = 175;
			}
			if (num4 < 255)
			{
				num4 = 255;
			}
			return new Color(num2, num3, num4, 255);
		}
		if (type == 655)
		{
			num2 = newColor.R;
			num3 = newColor.G;
			num4 = newColor.B;
			if (num2 < 255)
			{
				num2 = 255;
			}
			if (num3 < 100)
			{
				num3 = 100;
			}
			if (num4 < 50)
			{
				num4 = 50;
			}
			return new Color(num2, num3, num4, 255);
		}
		if (type == 352)
		{
			return new Color(255, 255, 255, 200);
		}
		if (type == 72)
		{
			num2 = newColor.R;
			num3 = newColor.G;
			num4 = newColor.B;
		}
		else
		{
			if (type == 288)
			{
				return new Color(200, 200, 200, 0);
			}
			if (type == 289)
			{
				return new Color(250, 250, 250, 50);
			}
			if (type >= 254 && type <= 261)
			{
				num4 = 255;
				if (num2 < 100)
				{
					num2 = 100;
				}
				if (num3 < 150)
				{
					num3 = 150;
				}
			}
			else if (type == 374 || type == 375 || type == 634 || type == 635)
			{
				num4 = 255;
				if (num2 < 100)
				{
					num2 = 100;
				}
				if (num3 < 150)
				{
					num3 = 150;
				}
			}
			else
			{
				if (type == 549)
				{
					newColor = Color.Lerp(newColor, Color.White, 0.4f);
					newColor *= (float)num5 / 255f;
					return newColor;
				}
				if (type == 64 || type == 63 || type == 75 || type == 103 || type == 400)
				{
					num2 = (int)((double)(int)newColor.R * 1.5);
					num3 = (int)((double)(int)newColor.G * 1.5);
					num4 = (int)((double)(int)newColor.B * 1.5);
					if (num2 > 255)
					{
						num2 = 255;
					}
					if (num3 > 255)
					{
						num3 = 255;
					}
					if (num4 > 255)
					{
						num4 = 255;
					}
				}
			}
		}
		if (CurrentlyShimmerTransparent())
		{
			num2 = (byte)((float)num2 * (1f - shimmerTransparency));
			num3 = (byte)((float)num3 * (1f - shimmerTransparency));
			num4 = (byte)((float)num4 * (1f - shimmerTransparency));
			num5 = (byte)((float)num5 * (1f - shimmerTransparency));
		}
		if (num5 < 0)
		{
			num5 = 0;
		}
		if (num5 > 255)
		{
			num5 = 255;
		}
		return new Color(num2, num3, num4, num5);
	}

	public Color GetShimmerColor(Color newColor)
	{
		if (CurrentlyShimmerTransparent())
		{
			newColor.R = (byte)((float)(int)newColor.R * (1f - shimmerTransparency));
			newColor.G = (byte)((float)(int)newColor.G * (1f - shimmerTransparency));
			newColor.B = (byte)((float)(int)newColor.B * (1f - shimmerTransparency));
			newColor.A = (byte)((float)(int)newColor.A * (1f - shimmerTransparency));
		}
		return newColor;
	}

	public Color GetColor(Color newColor)
	{
		if (IsABestiaryIconDummy)
		{
			newColor = GetBestiaryEntryColor();
		}
		int num = color.R - (255 - newColor.R);
		int num2 = color.G - (255 - newColor.G);
		int num3 = color.B - (255 - newColor.B);
		int num4 = color.A - (255 - newColor.A);
		if (type == 1)
		{
			num = color.R * newColor.R / 255;
			num2 = color.G * newColor.G / 255;
			num3 = color.B * newColor.B / 255;
		}
		if (num < 0)
		{
			num = 0;
		}
		if (num > 255)
		{
			num = 255;
		}
		if (num2 < 0)
		{
			num2 = 0;
		}
		if (num2 > 255)
		{
			num2 = 255;
		}
		if (num3 < 0)
		{
			num3 = 0;
		}
		if (num3 > 255)
		{
			num3 = 255;
		}
		if (num4 < 0)
		{
			num4 = 0;
		}
		if (num4 > 255)
		{
			num4 = 255;
		}
		if (CurrentlyShimmerTransparent())
		{
			num = (byte)((float)num * (1f - shimmerTransparency));
			num2 = (byte)((float)num2 * (1f - shimmerTransparency));
			num3 = (byte)((float)num3 * (1f - shimmerTransparency));
			num4 = (byte)((float)num4 * (1f - shimmerTransparency));
		}
		return new Color(num, num2, num3, num4);
	}

	public static bool ShouldBestiaryGirlBeLycantrope()
	{
		if (!Main.bloodMoon || Main.dayTime)
		{
			if (Main.moonPhase == 0)
			{
				return !Main.dayTime;
			}
			return false;
		}
		return true;
	}

	public string GetChat()
	{
		if (nextDialogue != null)
		{
			return nextDialogue.GetChatAndClearCondition(this);
		}
		PreventJojaColaDialog = false;
		RerollDryadText = 0;
		bool flag = false;
		bool flag2 = false;
		bool flag3 = false;
		bool flag4 = false;
		bool flag5 = false;
		bool flag6 = false;
		bool flag7 = false;
		bool flag8 = false;
		bool flag9 = false;
		bool flag10 = false;
		bool flag11 = false;
		bool flag12 = false;
		bool flag13 = false;
		bool flag14 = false;
		bool flag15 = false;
		bool flag16 = false;
		bool flag17 = false;
		for (int i = 0; i < Main.maxNPCs; i++)
		{
			if (Main.npc[i].active)
			{
				if (Main.npc[i].type == 17)
				{
					flag = true;
				}
				else if (Main.npc[i].type == 18)
				{
					flag2 = true;
				}
				else if (Main.npc[i].type == 19)
				{
					flag3 = true;
				}
				else if (Main.npc[i].type == 20)
				{
					flag4 = true;
				}
				else if (Main.npc[i].type == 37)
				{
					flag5 = true;
				}
				else if (Main.npc[i].type == 38)
				{
					flag6 = true;
				}
				else if (Main.npc[i].type == 124)
				{
					flag7 = true;
				}
				else if (Main.npc[i].type == 107)
				{
					flag8 = true;
				}
				else if (Main.npc[i].type == 54)
				{
					flag9 = true;
				}
				else if (Main.npc[i].type == 160)
				{
					flag10 = true;
				}
				else if (Main.npc[i].type == 178)
				{
					flag11 = true;
				}
				else if (Main.npc[i].type == 229)
				{
					flag12 = true;
				}
				else if (Main.npc[i].type == 209)
				{
					flag13 = true;
				}
				else if (Main.npc[i].type == 208)
				{
					flag14 = true;
				}
				else if (Main.npc[i].type == 353)
				{
					flag15 = true;
				}
				else if (Main.npc[i].type == 22)
				{
					flag16 = true;
				}
				else if (Main.npc[i].type == 441)
				{
					flag17 = true;
				}
			}
		}
		string result = "";
		string specialEventText = "";
		if (type == 17)
		{
			result = (HasSpecialEventText("Merchant", out specialEventText) ? specialEventText : ((!downedBoss1 && Main.rand.Next(3) == 0) ? ((Main.player[Main.myPlayer].statLifeMax < 200) ? Lang.dialog(1) : ((Main.player[Main.myPlayer].statDefense > 10) ? Lang.dialog(3) : Lang.dialog(2))) : (Main.dayTime ? ((Main.time < 16200.0) ? (Main.rand.Next(3) switch
			{
				0 => Lang.dialog(4), 
				1 => Lang.dialog(5), 
				_ => Lang.dialog(6), 
			}) : ((Main.time > 37800.0) ? (Main.rand.Next(3) switch
			{
				0 => Lang.dialog(7), 
				1 => Lang.dialog(8), 
				_ => Lang.dialog(9), 
			}) : (Main.rand.Next(3) switch
			{
				0 => Lang.dialog(10), 
				1 => Lang.dialog(11), 
				_ => Lang.dialog(12), 
			}))) : (Main.bloodMoon ? ((flag2 && flag7 && Main.rand.Next(3) == 0) ? Lang.dialog(13) : (Main.rand.Next(4) switch
			{
				0 => Lang.dialog(14), 
				1 => Lang.dialog(15), 
				2 => Lang.dialog(16), 
				_ => Lang.dialog(17), 
			})) : ((Main.time < 9720.0) ? ((Main.rand.Next(2) != 0) ? Lang.dialog(19) : Lang.dialog(18)) : ((Main.time > 22680.0) ? ((Main.rand.Next(2) != 0) ? Lang.dialog(21) : Lang.dialog(20)) : (Main.rand.Next(3) switch
			{
				0 => Lang.dialog(22), 
				1 => Lang.dialog(23), 
				_ => Lang.dialog(24), 
			})))))));
		}
		else if (type == 18)
		{
			if (HasSpecialEventText("Nurse", out specialEventText))
			{
				result = specialEventText;
			}
			else if (Main.bloodMoon)
			{
				result = (((double)Main.player[Main.myPlayer].statLife < (double)Main.player[Main.myPlayer].statLifeMax2 * 0.66) ? (Main.rand.Next(3) switch
				{
					0 => Lang.dialog(25), 
					1 => Lang.dialog(26), 
					_ => Lang.dialog(27), 
				}) : (Main.rand.Next(4) switch
				{
					0 => Lang.dialog(28), 
					1 => Lang.dialog(29), 
					2 => Lang.dialog(30), 
					_ => Lang.dialog(31), 
				}));
			}
			else if (Main.rand.Next(5) == 0 && Main.LocalPlayer.numberOfDeathsPVE > 1)
			{
				int numberOfDeathsPVE = Main.LocalPlayer.numberOfDeathsPVE;
				int num = 25;
				int num2 = 100;
				string text = "Low";
				if (numberOfDeathsPVE >= num2)
				{
					text = "High";
				}
				else if (numberOfDeathsPVE >= num)
				{
					text = "Medium";
				}
				result = Language.GetTextValue("NurseSpecialText.DeathCount" + text);
			}
			else if (Main.rand.Next(3) == 0 && !downedBoss3)
			{
				result = Lang.dialog(32);
			}
			else if (flag6 && Main.rand.Next(4) == 0)
			{
				result = Lang.dialog(33);
			}
			else if (flag3 && Main.rand.Next(4) == 0)
			{
				result = Lang.dialog(34);
			}
			else if (flag16 && Main.rand.Next(4) == 0)
			{
				result = Lang.dialog(35);
			}
			else if ((double)Main.player[Main.myPlayer].statLife < (double)Main.player[Main.myPlayer].statLifeMax2 * 0.33)
			{
				result = Main.rand.Next(5) switch
				{
					0 => Lang.dialog(36), 
					1 => Lang.dialog(37), 
					2 => Lang.dialog(38), 
					3 => Lang.dialog(39), 
					_ => Lang.dialog(40), 
				};
			}
			else if ((double)Main.player[Main.myPlayer].statLife < (double)Main.player[Main.myPlayer].statLifeMax2 * 0.66)
			{
				result = Main.rand.Next(7) switch
				{
					0 => Lang.dialog(41), 
					1 => Lang.dialog(42), 
					2 => Lang.dialog(43), 
					3 => Lang.dialog(44), 
					4 => Lang.dialog(45), 
					5 => Lang.dialog(46), 
					_ => Lang.dialog(47), 
				};
			}
			else
			{
				LocalizedText[] array = Language.FindAll(Lang.CreateDialogFilter("NurseChatter."));
				int num3 = Main.rand.Next(4 + array.Length);
				result = ((num3 >= 4) ? array[num3 - 4].Value : (num3 switch
				{
					0 => Lang.dialog(48), 
					1 => Lang.dialog(49), 
					2 => Lang.dialog(50), 
					_ => Lang.dialog(51), 
				}));
			}
		}
		else if (type == 19)
		{
			result = (HasSpecialEventText("ArmsDealer", out specialEventText) ? specialEventText : ((flag16 && downedBoss3 && !Main.hardMode) ? Lang.dialog(58) : ((flag2 && Main.rand.Next(5) == 0) ? Lang.dialog(59) : ((flag2 && Main.rand.Next(5) == 0) ? Lang.dialog(60) : ((flag4 && Main.rand.Next(5) == 0) ? Lang.dialog(61) : ((flag6 && Main.rand.Next(5) == 0) ? Lang.dialog(62) : ((flag6 && Main.rand.Next(5) == 0) ? Lang.dialog(63) : (Main.bloodMoon ? ((Main.rand.Next(2) != 0) ? Lang.dialog(65) : Lang.dialog(64)) : (Main.rand.Next(3) switch
			{
				0 => Lang.dialog(66), 
				1 => Lang.dialog(67), 
				_ => Lang.dialog(68), 
			})))))))));
		}
		else if (type == 20)
		{
			result = (HasSpecialEventText("Dryad", out specialEventText) ? specialEventText : ((DD2Event.DownedInvasionT1 && Main.rand.Next(6) == 0) ? ((!DD2Event.DownedInvasionT2) ? Language.GetTextValue("DryadSpecialText.AfterDD2Tier1") : Language.GetTextValue("DryadSpecialText.AfterDD2Tier2")) : ((!downedBoss2 && Main.rand.Next(3) == 0) ? ((!WorldGen.crimson) ? Lang.dialog(69) : Lang.dialog(332)) : ((flag3 && Main.rand.Next(6) == 0) ? Lang.dialog(70) : ((flag && Main.rand.Next(6) == 0) ? Lang.dialog(71) : ((flag5 && Main.rand.Next(6) == 0) ? Lang.dialog(72) : ((flag10 && Main.rand.Next(6) == 0) ? Lang.dialog(238) : (Main.bloodMoon ? (Main.rand.Next(4) switch
			{
				0 => Lang.dialog(73), 
				1 => Lang.dialog(74), 
				2 => Lang.dialog(75), 
				_ => Lang.dialog(76), 
			}) : (Main.rand.Next(5) switch
			{
				0 => (!WorldGen.crimson) ? Lang.dialog(77) : Lang.dialog(333), 
				1 => Lang.dialog(78), 
				2 => Lang.dialog(79), 
				3 => Lang.dialog(80), 
				_ => Lang.dialog(81), 
			})))))))));
			if (Main.LocalPlayer.HasItem(5275))
			{
				result = Language.GetTextValue("StardewTalk.PlayerHasColaButIsNotHoldingIt");
			}
		}
		else if (type == 37)
		{
			result = ((!Main.dayTime || Main.remixWorld) ? ((Main.player[Main.myPlayer].statLifeMax < 300 || Main.player[Main.myPlayer].statDefense < 10) ? (Main.rand.Next(4) switch
			{
				0 => Lang.dialog(85), 
				1 => Lang.dialog(86), 
				2 => Lang.dialog(87), 
				_ => Lang.dialog(88), 
			}) : (Main.rand.Next(4) switch
			{
				0 => Lang.dialog(89), 
				1 => Lang.dialog(90), 
				2 => Lang.dialog(91), 
				_ => Lang.dialog(92), 
			})) : (Main.rand.Next(3) switch
			{
				0 => Lang.dialog(82), 
				1 => Lang.dialog(83), 
				_ => Lang.dialog(84), 
			}));
		}
		else if (type == 38)
		{
			result = (HasSpecialEventText("Demolitionist", out specialEventText) ? specialEventText : ((!downedBoss2 && Main.rand.Next(3) == 0) ? Lang.dialog(93) : (Main.bloodMoon ? (Main.rand.Next(3) switch
			{
				0 => Lang.dialog(94), 
				1 => Lang.dialog(95), 
				_ => Lang.dialog(96), 
			}) : (((DD2Event.DownedInvasionT1 || DD2Event.Ongoing) && Main.rand.Next(5) == 0) ? Language.GetTextValue("DemolitionistSpecialText.AfterDD2Start") : ((flag3 && Main.rand.Next(5) == 0) ? Lang.dialog(97) : ((flag3 && Main.rand.Next(5) == 0) ? Lang.dialog(98) : ((flag2 && Main.rand.Next(4) == 0) ? Lang.dialog(99) : ((flag4 && Main.rand.Next(4) == 0) ? Lang.dialog(100) : ((!Main.dayTime) ? (Main.rand.Next(4) switch
			{
				0 => Lang.dialog(101), 
				1 => Lang.dialog(102), 
				2 => Lang.dialog(103), 
				_ => Lang.dialog(104), 
			}) : (Main.rand.Next(5) switch
			{
				0 => Lang.dialog(105), 
				1 => Lang.dialog(106), 
				2 => Lang.dialog(107), 
				3 => Lang.dialog(108), 
				_ => Lang.dialog(109), 
			}))))))))));
		}
		else if (type == 54)
		{
			result = (HasSpecialEventText("Clothier", out specialEventText) ? specialEventText : ((!flag7 && Main.rand.Next(2) == 0) ? Lang.dialog(110) : ((flag10 && Main.rand.Next(6) == 0) ? Lang.dialog(237) : (Main.bloodMoon ? Lang.dialog(111) : ((flag2 && Main.rand.Next(4) == 0) ? Lang.dialog(112) : ((Main.player[Main.myPlayer].head == 24) ? Lang.dialog(113) : (Main.rand.Next(6) switch
			{
				0 => Lang.dialog(114), 
				1 => Lang.dialog(115), 
				2 => Lang.dialog(116), 
				3 => Lang.dialog(117), 
				4 => Lang.dialog(118), 
				_ => Lang.dialog(119), 
			})))))));
		}
		else if (type == 105)
		{
			result = Lang.dialog(120);
		}
		else if (type == 107)
		{
			if (homeless)
			{
				result = Main.rand.Next(5) switch
				{
					0 => Lang.dialog(121), 
					1 => Lang.dialog(122), 
					2 => Lang.dialog(123), 
					3 => Lang.dialog(124), 
					_ => Lang.dialog(125), 
				};
			}
			else if (HasSpecialEventText("GoblinTinkerer", out specialEventText))
			{
				result = specialEventText;
			}
			else if (flag7 && Main.rand.Next(5) == 0)
			{
				result = Lang.dialog(126);
			}
			else if (flag15 && Main.rand.Next(5) == 0)
			{
				result = Lang.dialog(309);
			}
			else
			{
				LocalizedText[] array2 = Language.FindAll(Lang.CreateDialogFilter("GoblinTinkererChatter."));
				int num4 = Main.rand.Next(array2.Length + 5);
				result = ((num4 >= 5) ? array2[num4 - 5].Value : ((!Main.dayTime) ? (num4 switch
				{
					0 => Lang.dialog(127), 
					1 => Lang.dialog(128), 
					2 => Lang.dialog(129), 
					3 => Lang.dialog(130), 
					_ => Lang.dialog(131), 
				}) : (num4 switch
				{
					0 => Lang.dialog(132), 
					1 => Lang.dialog(133), 
					2 => Lang.dialog(134), 
					3 => Lang.dialog(135), 
					_ => Lang.dialog(136), 
				})));
			}
		}
		else if (type == 106)
		{
			result = Lang.dialog(137);
		}
		else if (type == 108)
		{
			if (homeless)
			{
				int num5 = Main.rand.Next(3);
				if (num5 == 0)
				{
					result = Lang.dialog(138);
				}
				else if (num5 == 1 && !Main.player[Main.myPlayer].Male)
				{
					result = Lang.dialog(139);
				}
				else
				{
					switch (num5)
					{
					case 1:
						result = Lang.dialog(140);
						break;
					case 2:
						result = Lang.dialog(141);
						break;
					}
				}
			}
			else if (HasLuckTextForWizard(out specialEventText))
			{
				result = specialEventText;
			}
			else if (HasSpecialEventText("Wizard", out specialEventText))
			{
				result = specialEventText;
			}
			else if (DD2Event.DownedInvasionT1 && Main.rand.Next(6) == 0)
			{
				result = Language.GetTextValue("WizardSpecialText.AfterDD2Tier1");
			}
			else if (Main.player[Main.myPlayer].Male && flag16 && Main.rand.Next(6) == 0)
			{
				result = Lang.dialog(142);
			}
			else if (Main.player[Main.myPlayer].Male && flag6 && Main.rand.Next(6) == 0)
			{
				result = Lang.dialog(143);
			}
			else if (Main.player[Main.myPlayer].Male && flag8 && Main.rand.Next(6) == 0)
			{
				result = Lang.dialog(144);
			}
			else if (!Main.player[Main.myPlayer].Male && flag2 && Main.rand.Next(6) == 0)
			{
				result = Lang.dialog(145);
			}
			else if (!Main.player[Main.myPlayer].Male && flag7 && Main.rand.Next(6) == 0)
			{
				result = Lang.dialog(146);
			}
			else if (!Main.player[Main.myPlayer].Male && flag4 && Main.rand.Next(6) == 0)
			{
				result = Lang.dialog(147);
			}
			else if (Main.dayTime)
			{
				result = Main.rand.Next(5) switch
				{
					0 => Lang.dialog(151), 
					1 => Lang.dialog(152), 
					2 => Lang.dialog(153), 
					3 => Lang.dialog(154), 
					_ => Lang.dialog(155), 
				};
			}
			else
			{
				switch (Main.rand.Next(3))
				{
				case 0:
					result = Lang.dialog(148);
					break;
				case 1:
					result = Lang.dialog(149);
					break;
				case 2:
					result = Lang.dialog(150);
					break;
				}
			}
		}
		else if (type == 123)
		{
			result = Lang.dialog(156);
		}
		else if (type == 124)
		{
			if (homeless)
			{
				result = Main.rand.Next(4) switch
				{
					0 => Lang.dialog(157), 
					1 => Lang.dialog(158), 
					2 => Lang.dialog(159), 
					_ => Lang.dialog(160), 
				};
			}
			else if (HasSpecialEventText("Mechanic", out specialEventText))
			{
				result = specialEventText;
			}
			else if (Main.bloodMoon)
			{
				result = Main.rand.Next(4) switch
				{
					0 => Lang.dialog(161), 
					1 => Lang.dialog(162), 
					2 => Lang.dialog(163), 
					_ => Lang.dialog(164), 
				};
			}
			else if (flag8 && Main.rand.Next(6) == 0)
			{
				result = Lang.dialog(165);
			}
			else if (flag3 && Main.rand.Next(6) == 0)
			{
				result = Lang.dialog(166);
			}
			else
			{
				LocalizedText[] array3 = Language.FindAll(Lang.CreateDialogFilter("MechanicChatter."));
				int num6 = Main.rand.Next(3 + array3.Length);
				result = ((num6 >= 3) ? array3[num6 - 3].Value : (num6 switch
				{
					0 => Lang.dialog(167), 
					1 => Lang.dialog(168), 
					_ => Lang.dialog(169), 
				}));
			}
		}
		else if (type == 22)
		{
			result = (HasSpecialEventText("Guide", out specialEventText) ? specialEventText : (Main.bloodMoon ? (Main.rand.Next(3) switch
			{
				0 => Lang.dialog(170), 
				1 => Lang.dialog(171), 
				_ => Lang.dialog(172), 
			}) : ((LanternNight.LanternsUp && !downedMoonlord) ? Language.GetTextValue("GuideSpecialText.Lantern1") : ((LanternNight.LanternsUp && downedMoonlord) ? Language.GetTextValue("GuideSpecialText.Lantern2") : (Main.eclipse ? Language.GetTextValue("GuideSpecialText.Eclipse") : (Main.slimeRain ? Language.GetTextValue("GuideSpecialText.SlimeRain") : ((!Main.dayTime) ? Lang.dialog(173) : ((Main.hardMode && flag17 && Main.rand.Next(8) == 0) ? Language.GetTextValue("GuideChatter.Chatter_1") : ((Main.hardMode && Main.rand.Next(8) == 0) ? Language.GetTextValue("GuideChatter.Chatter_2") : (Main.rand.Next(3) switch
			{
				0 => Lang.dialog(174), 
				1 => Lang.dialog(175), 
				_ => Lang.dialog(176), 
			}))))))))));
		}
		else if (type == 142)
		{
			int num7 = Main.rand.Next(3);
			if (HasSpecialEventText("Santa", out specialEventText))
			{
				result = specialEventText;
			}
			else
			{
				switch (num7)
				{
				case 0:
					result = Lang.dialog(224);
					break;
				case 1:
					result = Lang.dialog(225);
					break;
				case 2:
					result = Lang.dialog(226);
					break;
				}
			}
		}
		else if (type == 160)
		{
			int num8 = Main.rand.Next(6);
			if (HasSpecialEventText("Truffle", out specialEventText))
			{
				result = specialEventText;
			}
			else if (flag4 && Main.rand.Next(6) == 0)
			{
				result = Lang.dialog(232);
			}
			else if (flag9 && Main.rand.Next(6) == 0)
			{
				result = Lang.dialog(236);
			}
			else
			{
				switch (num8)
				{
				case 0:
					result = Lang.dialog(231);
					break;
				case 1:
					result = Lang.dialog(233);
					break;
				case 2:
					result = Lang.dialog(234);
					break;
				case 3:
					result = Lang.dialog(235);
					break;
				case 4:
					result = Lang.dialog(240);
					break;
				case 5:
					result = Lang.dialog(241);
					break;
				}
			}
		}
		else if (type == 178)
		{
			int num9 = Main.rand.Next(5);
			if (HasSpecialEventText("Steampunker", out specialEventText))
			{
				result = specialEventText;
			}
			else if (Main.bloodMoon && Main.rand.Next(3) == 0)
			{
				result = Lang.dialog(245);
			}
			else if (flag13 && Main.rand.Next(6) == 0)
			{
				result = Lang.dialog(246);
			}
			else if (flag12 && Main.rand.Next(6) == 0)
			{
				result = Lang.dialog(247);
			}
			else
			{
				switch (num9)
				{
				case 0:
					result = Lang.dialog(242);
					break;
				case 1:
					result = Lang.dialog(243);
					break;
				case 2:
					result = Lang.dialog(244);
					break;
				case 3:
					result = Lang.dialog(248);
					break;
				case 4:
					result = Lang.dialog(249);
					break;
				}
			}
		}
		else if (type == 207)
		{
			int num10 = Main.rand.Next(3);
			if (HasSpecialEventText("DyeTrader", out specialEventText))
			{
				result = specialEventText;
			}
			else if (flag12 && Main.rand.Next(6) == 0)
			{
				result = Lang.dialog(260);
			}
			else
			{
				switch (num10)
				{
				case 0:
					result = Lang.dialog(257);
					break;
				case 1:
					result = Lang.dialog(258);
					break;
				case 2:
					result = Lang.dialog(259);
					break;
				}
			}
		}
		else if (type == 208)
		{
			int num11 = Main.rand.Next(7);
			if (HasSpecialEventText("PartyGirl", out specialEventText))
			{
				result = specialEventText;
			}
			else if (DD2Event.DownedInvasionT1 && Main.rand.Next(5) == 0)
			{
				result = Language.GetTextValue("PartyGirlSpecialText.AfterDD2Tier1");
			}
			else if (Main.player[Main.myPlayer].Male && Main.rand.Next(5) == 0)
			{
				result = Lang.dialog(268);
			}
			else if (flag15 && Main.rand.Next(5) == 0)
			{
				result = Lang.dialog(310);
			}
			else
			{
				switch (num11)
				{
				case 0:
					result = Lang.dialog(265);
					break;
				case 1:
					result = Lang.dialog(266);
					break;
				case 2:
					result = Lang.dialog(267);
					break;
				case 3:
					result = Lang.dialog(269);
					break;
				case 4:
					result = Lang.dialog(270);
					break;
				case 5:
					result = Lang.dialog(271);
					break;
				case 6:
					result = Lang.dialog(272);
					break;
				}
			}
		}
		else if (type == 209)
		{
			if (HasSpecialEventText("Cyborg", out specialEventText))
			{
				result = specialEventText;
			}
			else if (flag12 && Main.rand.Next(6) == 0)
			{
				result = Lang.dialog(284);
			}
			else if (flag11 && Main.rand.Next(6) == 0)
			{
				result = Lang.dialog(283);
			}
			else
			{
				LocalizedText[] array4 = Language.FindAll(Lang.CreateDialogFilter("CyborgChatter."));
				int num12 = Main.rand.Next(5 + array4.Length);
				if (num12 >= 5)
				{
					result = array4[num12 - 5].Value;
				}
				else
				{
					switch (num12)
					{
					case 0:
						result = Lang.dialog(280);
						break;
					case 1:
						result = Lang.dialog(281);
						break;
					case 2:
						result = Lang.dialog(282);
						break;
					case 3:
						result = Lang.dialog(285);
						break;
					case 4:
						result = Lang.dialog(286);
						break;
					}
				}
			}
		}
		else if (type == 227)
		{
			int num13 = Main.rand.Next(5);
			if (HasSpecialEventText("Painter", out specialEventText))
			{
				result = specialEventText;
			}
			else if (Main.hardMode && Main.rand.Next(7) == 0)
			{
				result = Lang.dialog(250);
			}
			else if (flag14 && Main.rand.Next(6) == 0)
			{
				result = Lang.dialog(251);
			}
			else
			{
				switch (num13)
				{
				case 0:
					result = Lang.dialog(252);
					break;
				case 1:
					result = Lang.dialog(253);
					break;
				case 2:
					result = Lang.dialog(254);
					break;
				case 3:
					result = Lang.dialog(255);
					break;
				case 4:
					result = Lang.dialog(256);
					break;
				}
			}
		}
		else if (type == 228)
		{
			int num14 = Main.rand.Next(4);
			if (HasSpecialEventText("WitchDoctor", out specialEventText))
			{
				result = specialEventText;
			}
			else if (flag2 && Main.rand.Next(4) == 0)
			{
				result = Lang.dialog(263);
			}
			else
			{
				switch (num14)
				{
				case 0:
					result = Lang.dialog(261);
					break;
				case 1:
					result = Lang.dialog(262);
					break;
				case 2:
					result = Lang.dialog(264);
					break;
				case 3:
					result = Language.GetTextValue("WitchDoctorSpecialText.AfterDD2Tier1");
					break;
				}
			}
		}
		else if (type == 229)
		{
			LocalizedText[] array5 = Language.FindAll(Lang.CreateDialogFilter("PirateChatter."));
			int num15 = Main.rand.Next(6 + array5.Length);
			if (num15 >= 6)
			{
				result = array5[num15 - 6].Value;
			}
			else if (HasSpecialEventText("Pirate", out specialEventText))
			{
				result = specialEventText;
			}
			else if (!Main.player[Main.myPlayer].Male && Main.rand.Next(5) == 0)
			{
				result = Lang.dialog(276);
			}
			else
			{
				switch (num15)
				{
				case 0:
					result = Lang.dialog(273);
					break;
				case 1:
					result = Lang.dialog(274);
					break;
				case 2:
					result = Lang.dialog(275);
					break;
				case 3:
					result = Lang.dialog(277);
					break;
				case 4:
					result = Lang.dialog(278);
					break;
				case 5:
					result = Lang.dialog(279);
					break;
				}
			}
		}
		else if (type == 354)
		{
			result = Lang.dialog(Main.rand.Next(315, 319));
		}
		else if (type == 353)
		{
			if (HasSpecialEventText("Stylist", out specialEventText))
			{
				result = specialEventText;
			}
			else if (Main.bloodMoon)
			{
				switch (Main.rand.Next(3))
				{
				case 0:
					result = Lang.dialog(304);
					break;
				case 1:
					result = Lang.dialog(305);
					break;
				case 2:
					result = Lang.dialog(306);
					break;
				}
			}
			else if (Main.dayTime && Main.time < 16200.0 && Main.rand.Next(3) == 0)
			{
				result = Lang.dialog(311);
			}
			else if (Main.player[Main.myPlayer].Male && Main.rand.Next(3) == 0)
			{
				switch (Main.rand.Next(2))
				{
				case 0:
					result = Lang.dialog(293);
					break;
				case 1:
					result = Lang.dialog(300);
					break;
				}
			}
			else if (!Main.player[Main.myPlayer].Male && Main.rand.Next(3) == 0)
			{
				switch (Main.rand.Next(3))
				{
				case 0:
					result = Lang.dialog(291);
					break;
				case 1:
					result = Lang.dialog(292);
					break;
				case 2:
					result = Lang.dialog(312);
					break;
				}
			}
			else if (flag14 && flag7 && flag2 && flag3 && Main.rand.Next(5) == 0)
			{
				result = Lang.dialog(307);
			}
			else if (flag14 && Main.rand.Next(5) == 0)
			{
				result = Lang.dialog(302);
			}
			else if (flag6 && Main.rand.Next(5) == 0)
			{
				result = Lang.dialog(303);
			}
			else if (flag13 && Main.rand.Next(5) == 0)
			{
				result = Lang.dialog(308);
			}
			else
			{
				LocalizedText[] array6 = Language.FindAll(Lang.CreateDialogFilter("StylistChatter."));
				int num16 = ((Main.moonPhase < 3) ? 5 : 4);
				int num17 = Main.rand.Next(num16 + array6.Length);
				if (num17 >= num16)
				{
					result = array6[num17 - num16].Value;
				}
				else if (Main.moonPhase < 3)
				{
					switch (num17)
					{
					case 0:
						result = Lang.dialog(287);
						break;
					case 1:
						result = Lang.dialog(288);
						break;
					case 2:
						result = Lang.dialog(289);
						break;
					case 3:
						result = Lang.dialog(290);
						break;
					case 4:
						result = Lang.dialog(294);
						break;
					}
				}
				else if (Main.moonPhase < 6)
				{
					switch (num17)
					{
					case 0:
						result = Lang.dialog(295);
						break;
					case 1:
						result = Lang.dialog(296);
						break;
					case 2:
						result = Lang.dialog(297);
						break;
					case 3:
						result = Lang.dialog(298);
						break;
					}
				}
				else
				{
					switch (num17)
					{
					case 0:
						result = Lang.dialog(299);
						break;
					case 1:
						result = Lang.dialog(301);
						break;
					case 2:
						result = Lang.dialog(313);
						break;
					case 3:
						result = Lang.dialog(314);
						break;
					}
				}
			}
		}
		else if (type == 368)
		{
			result = (HasSpecialEventText("TravellingMerchant", out specialEventText) ? specialEventText : ((flag16 && Main.rand.Next(5) == 0) ? Lang.dialog(319) : ((flag && Main.rand.Next(5) == 0) ? Lang.dialog(320) : ((!flag9 || Main.rand.Next(5) != 0) ? Lang.dialog(Main.rand.Next(322, 331)) : Lang.dialog(321)))));
		}
		else if (type == 376)
		{
			result = Lang.dialog(Main.rand.Next(353, 356));
		}
		else if (type == 369)
		{
			result = ((Main.rand.Next(5) == 0 && Main.LocalPlayer.anglerQuestsFinished > 1) ? Lang.AnglerQuestCountChat() : (HasSpecialEventText("Angler", out specialEventText) ? specialEventText : (Main.bloodMoon ? ((Main.rand.Next(3) == 0) ? Language.SelectRandom(Lang.CreateDialogFilter("AnglerSpecialText.BloodMoonFishing")).Value : (Main.anglerQuestFinished ? Lang.dialog(Main.rand.Next(350, 353)) : Lang.dialog(Main.rand.Next(348, 350)))) : ((!Main.anglerQuestFinished) ? Lang.dialog(Main.rand.Next(334, 338)) : ((!flag4 || Main.rand.Next(5) != 0) ? Language.SelectRandom(Lang.CreateDialogFilter("AnglerChatter.")).Value : Lang.dialog(347))))));
		}
		else if (type == 453)
		{
			if (HasSpecialEventText("SkeletonMerchant", out specialEventText))
			{
				result = specialEventText;
			}
			else
			{
				int num18 = 8;
				int categorySize = Language.GetCategorySize("SkeletonMerchantChatter");
				int num19 = Main.rand.Next(num18 + categorySize);
				result = ((num19 >= num18) ? Language.RandomFromCategory("SkeletonMerchantChatter").Value : Lang.dialog(356 + num19));
			}
		}
		else if (type == 441)
		{
			result = (HasSpecialEventText("TaxCollector", out specialEventText) ? specialEventText : ((Main.rand.Next(6) == 0 && flag4) ? Lang.dialog(371) : ((Main.rand.Next(6) == 0 && flag3) ? Lang.dialog(372) : ((Main.rand.Next(6) == 0 && flag6) ? Lang.dialog(373) : ((!(Main.rand.Next(6) == 0 && flag)) ? Lang.dialog(Main.rand.Next(364, 371)) : Lang.dialog(374))))));
		}
		else if (type == 579)
		{
			result = Language.GetTextValue("BartenderSpecialText.FirstMeeting");
		}
		else if (type == 550)
		{
			result = ((!HasSpecialEventText("Bartender", out specialEventText)) ? Lang.BartenderChat() : specialEventText);
		}
		else if (type == 589)
		{
			result = ((Main.rand.Next(2) != 0) ? Language.GetTextValue("GolferSpecialText.FirstMeeting2") : Language.GetTextValue("GolferSpecialText.FirstMeeting1"));
		}
		else if (type == 588)
		{
			if (Main.rand.Next(3) != 0 && HasSpecialEventText("Golfer", out specialEventText))
			{
				result = specialEventText;
			}
			else if (Main.rand.Next(3) == 0)
			{
				string text2 = ((Main.LocalPlayer.golferScoreAccumulated >= 2000) ? "GolferQuestsChatterMaster" : ((Main.LocalPlayer.golferScoreAccumulated >= 1000) ? "GolferQuestsChatterJourneyman" : ((Main.LocalPlayer.golferScoreAccumulated < 500) ? "GolferQuestsChatterBeginner" : "GolferQuestsChatterApprentice")));
				result = Language.SelectRandom(Lang.CreateDialogFilter(text2 + ".")).Value;
			}
			else
			{
				result = Lang.GolferChat();
			}
		}
		else if (type == 633)
		{
			result = ((ShouldBestiaryGirlBeLycantrope() || !HasSpecialEventText("BestiaryGirl", out specialEventText)) ? Lang.BestiaryGirlChat() : specialEventText);
		}
		else if (type == 663)
		{
			result = ((!HasSpecialEventText("Princess", out specialEventText)) ? Lang.PrincessChat() : specialEventText);
		}
		else if (type == 637)
		{
			result = ((!HasSpecialEventText("Cat", out specialEventText)) ? Lang.CatChat() : specialEventText);
		}
		else if (type == 638)
		{
			result = ((!HasSpecialEventText("Dog", out specialEventText)) ? Lang.DogChat() : specialEventText);
		}
		else if (type == 656)
		{
			result = ((!HasSpecialEventText("Bunny", out specialEventText)) ? Lang.BunnyChat() : specialEventText);
		}
		else if (NPCID.Sets.IsTownSlime[type])
		{
			result = ((!HasSpecialEventText("Slime", out specialEventText)) ? Lang.SlimeChat(this) : specialEventText);
		}
		return result;
	}

	public object Clone()
	{
		return MemberwiseClone();
	}

	public static bool CanShowHomelessText(int npcIndex)
	{
		_ = Main.LocalPlayer;
		if (npcIndex < 0)
		{
			return false;
		}
		NPC nPC = Main.npc[npcIndex];
		if (nPC.homeless && nPC.type != 37 && nPC.type != 368)
		{
			return nPC.type != 453;
		}
		return false;
	}

	public bool HasLuckTextForWizard(out string specialEventText)
	{
		specialEventText = null;
		if (Main.rand.Next(3) == 0)
		{
			float normalizedLuck = Main.player[Main.myPlayer].NormalizedLuck;
			if (normalizedLuck == 0f)
			{
				return false;
			}
			string text = null;
			text = ((normalizedLuck < -0.6f) ? "WizardSpecialText.LuckIsCursed" : ((normalizedLuck < -0.4f) ? "WizardSpecialText.LuckIsTerrible" : ((normalizedLuck < -0.2f) ? "WizardSpecialText.LuckIsPoor" : ((normalizedLuck < 0f) ? "WizardSpecialText.LuckIsBad" : ((normalizedLuck < 0.25f) ? "WizardSpecialText.LuckIsGood" : ((normalizedLuck < 0.5f) ? "WizardSpecialText.LuckIsGreat" : ((!(normalizedLuck < 0.75f)) ? "WizardSpecialText.LuckIsGodly" : "WizardSpecialText.LuckIsAmazing")))))));
			specialEventText = Language.SelectRandom(Lang.CreateDialogFilter(text)).Value;
			return true;
		}
		return false;
	}

	public bool HasSpecialEventText(string specialTextCategoryKey, out string specialEventText)
	{
		specialEventText = null;
		if (Main.LocalPlayer.ZoneGraveyard && Main.rand.Next(3) == 0 && GetSpecialEventTextIfNotEmpty(specialTextCategoryKey + "SpecialText.Graveyard", ref specialEventText))
		{
			return true;
		}
		if (BirthdayParty.PartyIsUp && Main.rand.Next(3) == 0 && !NPCID.Sets.HasNoPartyText[type] && GetSpecialEventTextIfNotEmpty(specialTextCategoryKey + "SpecialText.Party", ref specialEventText))
		{
			return true;
		}
		if (Main.raining && !Main.IsItStorming && Main.rand.Next(3) == 0 && GetSpecialEventTextIfNotEmpty(specialTextCategoryKey + "SpecialText.Rain", ref specialEventText))
		{
			return true;
		}
		if (Main.IsItAHappyWindyDay && Main.rand.Next(3) == 0 && GetSpecialEventTextIfNotEmpty(specialTextCategoryKey + "SpecialText.Windy", ref specialEventText))
		{
			return true;
		}
		if (Main.IsItStorming && Main.rand.Next(3) == 0 && GetSpecialEventTextIfNotEmpty(specialTextCategoryKey + "SpecialText.Storm", ref specialEventText))
		{
			return true;
		}
		return false;
	}

	public bool GetSpecialEventTextIfNotEmpty(string specialTextKey, ref string specialEventText)
	{
		LocalizedText localizedText = Language.SelectRandom(Lang.CreateDialogFilter(specialTextKey));
		if (localizedText != LocalizedText.Empty)
		{
			specialEventText = localizedText.Value;
			return true;
		}
		return false;
	}

	public void CheckDrowning()
	{
		bool flag = Collision.DrownCollision(position, width, height, 1f);
		if (Main.netMode != 1)
		{
			if (flag)
			{
				if (++breathCounter >= 7)
				{
					breathCounter = 0;
					breath--;
					if (breath <= 0)
					{
						friendlyRegen = 0;
						breath = 0;
						life -= 2;
						NetUpdateLowPriority();
						if (life <= 0)
						{
							life = 1;
							StrikeNPCNoInteraction(2, 0f, 0);
							if (Main.netMode != 0)
							{
								NetMessage.SendData(28, -1, -1, null, whoAmI, 2f);
							}
						}
					}
				}
			}
			else
			{
				breath += 3;
				if (breath > 200)
				{
					breath = 200;
				}
				breathCounter = 0;
			}
		}
		if (flag && Main.rand.Next(20) == 0 && !lavaWet && !honeyWet && !shimmerWet)
		{
			int num = 0;
			int num2 = 0;
			if (type == 369)
			{
				num2 = 8;
			}
			Dust.NewDust(new Vector2(position.X + (float)((10 + num) * direction), position.Y + (float)num2 + 4f), width - 8, 8, 34, 0f, 0f, 0, default(Color), 1.2f);
		}
	}

	public void TryPortalJumping()
	{
		if (townNPC && Main.netMode != 1)
		{
			PortalHelper.TryGoingThroughPortals(this);
		}
	}

	public static void GetMeleeCollisionData(Rectangle victimHitbox, int enemyIndex, ref int specialHitSetter, ref float damageMultiplier, ref Rectangle npcRect)
	{
		NPC nPC = Main.npc[enemyIndex];
		if (((nPC.type >= 430 && nPC.type <= 436) || nPC.type == 591) && nPC.ai[2] > 5f)
		{
			int num = 34;
			if (nPC.spriteDirection < 0)
			{
				npcRect.X -= num;
				npcRect.Width += num;
			}
			else
			{
				npcRect.Width += num;
			}
			damageMultiplier *= 1.25f;
		}
		else if (nPC.type >= 494 && nPC.type <= 495 && nPC.ai[2] > 5f)
		{
			int num2 = 18;
			if (nPC.spriteDirection < 0)
			{
				npcRect.X -= num2;
				npcRect.Width += num2;
			}
			else
			{
				npcRect.Width += num2;
			}
			damageMultiplier *= 1.25f;
		}
		else if (nPC.type == 460)
		{
			Rectangle rectangle = new Rectangle(0, 0, 30, 14);
			rectangle.X = (int)nPC.Center.X;
			if (nPC.direction < 0)
			{
				rectangle.X -= rectangle.Width;
			}
			rectangle.Y = (int)nPC.position.Y + nPC.height - 20;
			if (victimHitbox.Intersects(rectangle))
			{
				npcRect = rectangle;
				damageMultiplier *= 1.35f;
			}
		}
		else if (nPC.type == 417 && nPC.ai[0] == 6f && nPC.ai[3] > 0f && nPC.ai[3] < 4f)
		{
			Rectangle rectangle2 = Utils.CenteredRectangle(nPC.Center, new Vector2(100f));
			if (victimHitbox.Intersects(rectangle2))
			{
				npcRect = rectangle2;
				damageMultiplier *= 1.35f;
			}
		}
		else if (nPC.type == 466)
		{
			Rectangle rectangle3 = new Rectangle(0, 0, 30, 8);
			rectangle3.X = (int)nPC.Center.X;
			if (nPC.direction < 0)
			{
				rectangle3.X -= rectangle3.Width;
			}
			rectangle3.Y = (int)nPC.position.Y + nPC.height - 32;
			if (victimHitbox.Intersects(rectangle3))
			{
				npcRect = rectangle3;
				damageMultiplier *= 1.75f;
			}
		}
		else if (nPC.type == 576 || nPC.type == 577)
		{
			NPC nPC2 = nPC;
			bool flag = true;
			int y = nPC2.frame.Y;
			int num3 = 0;
			int num4 = 0;
			Rectangle rectangle4 = new Rectangle(0, 0, 30, 8);
			switch (y)
			{
			case 15:
				specialHitSetter = 2;
				rectangle4.Width = 120;
				rectangle4.Height = 30;
				num4 = 24;
				break;
			case 16:
				specialHitSetter = 2;
				rectangle4.Width = 120;
				rectangle4.Height = 60;
				num3 = 10;
				break;
			case 17:
				specialHitSetter = 2;
				rectangle4.Width = 100;
				rectangle4.Height = 90;
				num3 = 50;
				break;
			case 18:
				specialHitSetter = 2;
				rectangle4.Width = 100;
				rectangle4.Height = 50;
				num3 = 90;
				num4 = 10;
				break;
			default:
				flag = false;
				break;
			}
			if (flag)
			{
				rectangle4.X = (int)nPC2.Center.X - num3 * nPC2.direction;
				if (nPC2.direction < 0)
				{
					rectangle4.X -= rectangle4.Width;
				}
				rectangle4.Y = (int)nPC2.Center.Y - rectangle4.Height + num4;
				if (victimHitbox.Intersects(rectangle4))
				{
					npcRect = rectangle4;
					damageMultiplier *= 1.75f;
				}
			}
		}
		else if ((nPC.type == 552 || nPC.type == 553 || nPC.type == 554) && nPC.ai[0] > 0f && nPC.ai[0] < 24f)
		{
			Rectangle rectangle5 = new Rectangle(0, 0, 34, 14);
			rectangle5.X = (int)nPC.Center.X;
			if (nPC.direction < 0)
			{
				rectangle5.X -= rectangle5.Width;
			}
			rectangle5.Y = (int)nPC.position.Y + nPC.height - 20;
			if (victimHitbox.Intersects(rectangle5))
			{
				npcRect = rectangle5;
				damageMultiplier *= 1.35f;
			}
		}
		else
		{
			if (nPC.type != 668)
			{
				return;
			}
			npcRect.Height -= 80;
			NPC nPC3 = nPC;
			bool flag2 = true;
			int y2 = nPC3.frame.Y;
			int num5 = 0;
			int num6 = 0;
			Rectangle rectangle6 = new Rectangle(0, 0, 30, 8);
			if (y2 == 15)
			{
				rectangle6.Width = 64;
				rectangle6.Height = 180;
				num6 = 80;
				num5 = -42;
				if (nPC3.ai[0] == 4f)
				{
					flag2 = false;
				}
			}
			else
			{
				flag2 = false;
			}
			if (flag2)
			{
				rectangle6.X = (int)nPC3.Center.X - num5 * nPC3.direction;
				if (nPC3.direction < 0)
				{
					rectangle6.X -= rectangle6.Width;
				}
				rectangle6.Y = (int)nPC3.Center.Y - rectangle6.Height + num6;
				if (victimHitbox.Intersects(rectangle6))
				{
					npcRect = rectangle6;
				}
			}
		}
	}

	public string GetBestiaryCreditId()
	{
		return ContentSamples.NpcBestiaryCreditIdsByNpcNetIds[netID];
	}

	public override string ToString()
	{
		return "name:" + TypeName + ", active:" + active.ToString() + ", whoAmI:" + whoAmI;
	}
}
